<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Lighting, Shadows and Background &mdash; User Manual: Blend4Web v14.12</title>
    
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '14.12',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="User Manual: Blend4Web v14.12" href="index.html" />
    <link rel="next" title="Postprocessing Effects" href="postprocessing_effects.html" />
    <link rel="prev" title="Node Materials" href="node_materials.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="index.html">
            <img class="logo" src="_static/b4w_logo.png" alt="Logo"/>
          </a></p>
        <div class="headertitle"><a
          href="index.html">User Manual: Blend4Web v14.12</a></div>
        <div class="rel">
          <a href="node_materials.html" title="Node Materials"
             accesskey="P">previous</a> |
          <a href="postprocessing_effects.html" title="Postprocessing Effects"
             accesskey="N">next</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="lighting"></span><div class="section" id="index-0">
<span id="id1"></span><h1>Lighting, Shadows and Background<a class="headerlink" href="#index-0" title="Permalink to this headline">¶</a></h1>
<div class="section" id="index-1">
<span id="id2"></span><h2>Shading Types<a class="headerlink" href="#index-1" title="Permalink to this headline">¶</a></h2>
<p>Lighting (shading) depends on the direction of normal vectors. The standard Blender&#8217;s shading types are supported: <tt class="docutils literal"><span class="pre">Shading:</span> <span class="pre">Flat</span></tt> (face normals are used), <tt class="docutils literal"><span class="pre">Shading:</span> <span class="pre">Smooth</span></tt> (interpolated vertex normals are used) and their combinations.</p>
<a class="reference internal image-reference" href="_images/flat_smooth_shading.png"><img alt="_images/flat_smooth_shading.png" class="align-center" src="_images/flat_smooth_shading.png" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>If the required effect is impossible to achieve with the standard tools, you can use the <a class="reference internal" href="#normals-editor"><em>normals editor</em></a>.</p>
<p>The result of applying different shading types and using the normals editor:</p>
<a class="reference internal image-reference" href="_images/different_shadings_comparison.jpg"><img alt="_images/different_shadings_comparison.jpg" class="align-center" src="_images/different_shadings_comparison.jpg" style="width: 100%;" /></a>
<ol class="arabic simple">
<li>Flat Shading</li>
<li>Smooth Shading</li>
<li><p class="first">Smooth Shading + bevel</p>
</li>
<li><p class="first">Smooth Shading + bevel + editing normals</p>
</li>
</ol>
<span class="target" id="normals-editor"></span></div>
<div class="section" id="index-2">
<span id="id3"></span><h2>Normals Editor<a class="headerlink" href="#index-2" title="Permalink to this headline">¶</a></h2>
<p>Using the normals editor you may achieve the effect which is similar to the result of using <a class="reference internal" href="textures.html#normal-map"><em>normal maps</em></a>. At the same time editing normals is preferred because it is more computationally effective and consumes less video memory.</p>
<p>The normals editor interface is located on the tools panel <tt class="docutils literal"><span class="pre">Blend4Web</span> <span class="pre">&gt;</span> <span class="pre">B4W</span> <span class="pre">Vertex</span> <span class="pre">Normals</span> <span class="pre">Editor</span></tt>. The <tt class="docutils literal"><span class="pre">Shading:</span> <span class="pre">Smooth</span></tt> mode should be enabled before starting to work with the editor.</p>
<p>Normals editor workflow example:</p>
<a class="reference internal image-reference" href="_images/functional_example.gif"><img alt="_images/functional_example.gif" class="align-center" src="_images/functional_example.gif" style="width: 100%;" /></a>
<ol class="arabic simple">
<li><p class="first">Demonstration of how Scale and Show/Hide button work</p>
</li>
<li><p class="first">Demonstration of the Face function</p>
</li>
<li><p class="first">Demonstration of the Foliage function</p>
</li>
<li><p class="first">Demonstration of how the vector parameters can be entered by hand (XYZ)</p>
</li>
</ol>
<p>The normals can be changed only for selected vertices. Vectors for the selected vertices will be tinted with bright blue color and for the nonselected ones - with dull blue color. To select vertices you should switch to the edit mode, select the required vertices and return back to to the object mode.</p>
<p>After a vector is edited its direction must be saved because the normals are discarded upon entering the edit mode and switching back. The vector can be assigned in several ways: by hand, by copying from the existing object that already has edited normals and by using some other options.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you have edited a group of normals and saved them you must press <tt class="docutils literal"><span class="pre">Reload</span> <span class="pre">Normals</span></tt> before selecting the next group in order to return the edited normals to the original direction, and only then you may proceed to the next group. Otherwise you&#8217;ll lose the result of the previous editing after you press the <tt class="docutils literal"><span class="pre">Save</span></tt> button again.</p>
</div>
<dl class="docutils">
<dt><em>Reload normals</em></dt>
<dd><p class="first last">Restores the normals to the last direction saved by the tool.</p>
</dd>
<dt><em>Clean Up</em></dt>
<dd><p class="first last">Discards all the edits by resetting the normals into the initial state.</p>
</dd>
<dt><em>Save</em> and <em>Autosave</em></dt>
<dd><p class="first last">Save the normal editing. When <tt class="docutils literal"><span class="pre">Autosave</span></tt> is activated every edit is saved automatically.</p>
</dd>
<dt><em>Size</em></dt>
<dd><p class="first last">Length of the segment that visualizes the normal direction.</p>
</dd>
<dt><em>Show/Hide</em></dt>
<dd><p class="first last">Show/Hide normals.</p>
</dd>
<dt><em>Inv Sel</em></dt>
<dd><p class="first last">Invert selection. Similar to CTRL+I of the edit mode.</p>
</dd>
<dt><em>Cycle Sel</em></dt>
<dd><p class="first last">Cycle selection. Switches to the next number vertex. This button may be useful for vertex-by-vertex editing.</p>
</dd>
<dt><em>Copy</em> and <em>Paste</em></dt>
<dd><p class="first last">Copy the vector direction and assign it to another vertex. Works only with a single vertex per operation.</p>
</dd>
<dt><em>XYZ scale and direction sphere</em></dt>
<dd><p class="first last">Tools for editing the vector direction by hand.</p>
</dd>
<dt><em>Tree</em>, <em>Foliage</em> and <em>Face</em></dt>
<dd><p class="first last">The <tt class="docutils literal"><span class="pre">Tree</span></tt> button directs the normals outward the 3D cursor for all the selected vertices, <tt class="docutils literal"><span class="pre">Foliage</span></tt> directs the normals straight upward (useful for setting up particles of <a class="reference internal" href="particles_instancing.html#particles-grass"><em>grass</em></a> and <a class="reference internal" href="particles_instancing.html#particles-leaves"><em>tree leaves</em></a>), <tt class="docutils literal"><span class="pre">Face</span></tt> assigns the selected face direction to the normals.</p>
</dd>
<dt><em>Copy from source mesh</em> and <em>Approximate from source mesh</em></dt>
<dd><p class="first last">These buttons copy the normal vectors from one object to another. To do this you should sequentially select the source and target objects. The difference between these options is as follows. The first method requires the exact fitness of the objects and copies the normals direction perfectly. Vertices which do not coincide with the original are not affected. The second method works with arbitrary geometry and leads to approximate results. In practice the second method can be even more suitable than the first one and works with acceptable precision.</p>
</dd>
</dl>
<p>An example of using the <tt class="docutils literal"><span class="pre">Approximate</span> <span class="pre">from</span> <span class="pre">source</span> <span class="pre">mesh</span></tt> function:</p>
<a class="reference internal image-reference" href="_images/approximate_example.gif"><img alt="_images/approximate_example.gif" class="align-center" src="_images/approximate_example.gif" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In the general case the algorithm for normals editing is as follows:</p>
<ol class="arabic simple">
<li><p class="first">Entering to the edit mode</p>
</li>
<li><p class="first">Selecting the needed vertices</p>
</li>
<li><p class="first">Entering to the object mode</p>
</li>
<li><em>Reload Normals</em></li>
<li><p class="first">Editing the selected normals</p>
</li>
<li><p class="first"><em>Save</em> (if <em>Autosave</em> is inactive)</p>
</li>
</ol>
<p>The edited normals are assigned to the mesh vertices using their numbers, which by-turn can change upon editing the mesh geometry. This may require to re-edit the normals from scratch. Also the normals edits can become overridden by some modifiers because they may change the vertices number or order. To avoid this it is advisable to edit normals after the modifiers are applied. The <tt class="docutils literal"><span class="pre">Armature</span></tt> modifier doesn&#8217;t affect the tool work.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you need to change the mesh geometry with edited normals but want to keep the normals edits you may consider to do the following. Make a temporary copy of this object, edit the original mesh, reset its normals with the <tt class="docutils literal"><span class="pre">Clean</span> <span class="pre">Up</span></tt> button and then transfer the normals from the object&#8217;s copy using the <tt class="docutils literal"><span class="pre">Copy</span> <span class="pre">from</span> <span class="pre">source</span> <span class="pre">mesh</span></tt> or <tt class="docutils literal"><span class="pre">Approximate</span> <span class="pre">from</span> <span class="pre">source</span> <span class="pre">mesh</span></tt> button. Save the results of copying or approximation.</p>
</div>
</div>
<div class="section" id="index-3">
<span id="id4"></span><h2>Lighting with Light Sources<a class="headerlink" href="#index-3" title="Permalink to this headline">¶</a></h2>
<p>A scene can have multiple (but not less than one) light sources of different types.</p>
<div class="section" id="id5">
<h3>Light source types<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>The following light source types are supported:</p>
<dl class="docutils">
<dt><em>Point</em></dt>
<dd><p class="first last">Light propagates from one point uniformly to all directions with gradual attenuation.</p>
</dd>
<dt><em>Sun</em></dt>
<dd><p class="first last">Light propagates from an infinite plane in one direction without attenuation.</p>
</dd>
<dt><em>Spot</em></dt>
<dd><p class="first last">Light propagates from one point within the angular limit, with gradual attenuation.</p>
</dd>
<dt><em>Hemi</em></dt>
<dd><p class="first last">Hemispherical. Light propagates from an infinite hemisphere without attenuation.</p>
</dd>
</dl>
</div>
<div class="section" id="id6">
<h3>Light source setup<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Performed in the <tt class="docutils literal"><span class="pre">Object</span> <span class="pre">Data</span></tt> tab when a lamp object is selected.</p>
<a class="reference internal image-reference" href="_images/lighting_setup.jpg"><img alt="_images/lighting_setup.jpg" class="align-center" src="_images/lighting_setup.jpg" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="docutils">
<dt><em>Color</em></dt>
<dd><p class="first last">Light color. The default value is (1.0, 1.0, 1.0) (i.e. white).</p>
</dd>
<dt><em>Energy</em></dt>
<dd><p class="first last">Radiation intensity. The default value is 1.0.</p>
</dd>
<dt><em>Falloff</em></dt>
<dd><p class="first last">Attenuation type. The value is exported but the engine always uses <tt class="docutils literal"><span class="pre">Inverse</span> <span class="pre">Square</span></tt>. It is applicable to the <tt class="docutils literal"><span class="pre">Point</span></tt> and <tt class="docutils literal"><span class="pre">Spot</span></tt> light source types. The default value is <tt class="docutils literal"><span class="pre">Inverse</span> <span class="pre">Square</span></tt>.</p>
</dd>
<dt><em>Distance</em></dt>
<dd><p class="first last">Attenuation parameter. It is applicable to the <tt class="docutils literal"><span class="pre">Point</span></tt> and <tt class="docutils literal"><span class="pre">Spot</span></tt> light source types. The default value is 25.0.</p>
</dd>
<dt><em>Specular</em></dt>
<dd><p class="first last">Create specular highlights. Enabled by default.</p>
</dd>
<dt><em>Diffuse</em></dt>
<dd><p class="first last">Do diffuse shading. Enabled by default.</p>
</dd>
<dt><em>Spot Shape &gt; Size</em></dt>
<dd><p class="first last">Cone angle in degrees. It is applicable to the <tt class="docutils literal"><span class="pre">Spot</span></tt> light source type. The default value is 45º.</p>
</dd>
<dt><em>Spot Shape &gt; Blend</em></dt>
<dd><p class="first last">Parameter for blurring light spot edges. It is applicable to the <tt class="docutils literal"><span class="pre">Spot</span></tt> light source type. The default value is 0.15.</p>
</dd>
<dt><em>Blend4Web &gt; Do not export</em></dt>
<dd><p class="first last">Don&#8217;t export the light source. Disabled by default.</p>
</dd>
<dt><em>Blend4Web &gt; Generate shadows</em></dt>
<dd><p class="first last">Use this light source for shadow calculation. Should be used when multiple light sources are present. Disabled by default.</p>
</dd>
<dt><em>Blend4Web &gt; Dynamic intesity</em></dt>
<dd><p class="first last">Use this light source for calculating the time of day. Applicable only to the <tt class="docutils literal"><span class="pre">Sun</span></tt> light source type. Disabled by default.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="environment-lighting">
<span id="id7"></span><h2>Environment Lighting (Ambient)<a class="headerlink" href="#environment-lighting" title="Permalink to this headline">¶</a></h2>
<p>The engine supports 3 methods of the environment lighting simulation.</p>
<ol class="arabic simple">
<li><p class="first">Flat white lighting.</p>
</li>
<li><p class="first">Hemispherical lighting model in which horizon and zenith colors should be specified. As a result objects are filled with a gradient between these two colors depending on the direction of normals.</p>
</li>
<li><p class="first">Lighting using an <a class="reference internal" href="textures.html#environment-map"><em>environment map</em></a> - so called image-based lighting.</p>
</li>
</ol>
<div class="section" id="id8">
<h3>Activation<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Enable the <tt class="docutils literal"><span class="pre">Environment</span> <span class="pre">Lighting</span></tt> checkbox on the <tt class="docutils literal"><span class="pre">World</span></tt> tab.</p>
<a class="reference internal image-reference" href="_images/lighting_environment.jpg"><img alt="_images/lighting_environment.jpg" class="align-center" src="_images/lighting_environment.jpg" style="width: 100%;" /></a>
</div>
<div class="section" id="id9">
<h3>Setup<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><em>World &gt; Environment Lighting &gt; Energy</em></dt>
<dd><p class="first last">Environment lighting intensity. The default value is 1.0.</p>
</dd>
<dt><em>World &gt; Environment Lighting &gt; Environment Color</em></dt>
<dd><p class="first last">Selection of the environment lighting simulation method: <tt class="docutils literal"><span class="pre">White</span></tt> - flat white lighting, <tt class="docutils literal"><span class="pre">Sky</span> <span class="pre">Color</span></tt> - hemisperical model, <tt class="docutils literal"><span class="pre">Sky</span> <span class="pre">Texture</span></tt> - lighting using an <a class="reference internal" href="textures.html#environment-map"><em>environment map</em></a>. The default value is <tt class="docutils literal"><span class="pre">White</span></tt>.</p>
</dd>
<dt><em>World &gt; Horizon Color</em> and <em>World &gt; Zenith Color</em></dt>
<dd><p class="first last">If the hemisperical model (<tt class="docutils literal"><span class="pre">Sky</span> <span class="pre">Color</span></tt>) is selected the horizon and zenith colors can be specified by means of the <tt class="docutils literal"><span class="pre">World</span> <span class="pre">&gt;</span> <span class="pre">Horizon</span> <span class="pre">Color</span></tt> and <tt class="docutils literal"><span class="pre">World</span> <span class="pre">&gt;</span> <span class="pre">Zenith</span> <span class="pre">Color</span></tt> color pickers. It is recommended to activate the <tt class="docutils literal"><span class="pre">World</span> <span class="pre">&gt;</span> <span class="pre">Blend</span> <span class="pre">Sky</span></tt> option for better color selection.</p>
</dd>
</dl>
</div>
<div class="section" id="id10">
<h3>Environment map method<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>To use an environment map for environment lighting:</p>
<ol class="arabic simple">
<li><p class="first">Enable the <tt class="docutils literal"><span class="pre">Environment</span> <span class="pre">Lighting</span></tt> checkbox on the <tt class="docutils literal"><span class="pre">World</span></tt> tab.</p>
</li>
<li><p class="first">Select the <tt class="docutils literal"><span class="pre">Environment</span> <span class="pre">Lighting</span> <span class="pre">&gt;</span> <span class="pre">Environment</span> <span class="pre">Color</span> <span class="pre">&gt;</span> <span class="pre">Sky</span> <span class="pre">Texture</span></tt> method.</p>
</li>
<li><p class="first">Go from the <tt class="docutils literal"><span class="pre">World</span></tt> tab to the <tt class="docutils literal"><span class="pre">Texture</span></tt> tab.</p>
</li>
<li><p class="first">Create an <a class="reference internal" href="textures.html#environment-map"><em>environment map</em></a>, load the corresponding image to it.</p>
</li>
<li><p class="first">For the environment map select <tt class="docutils literal"><span class="pre">ENVIRONMENT_LIGHTING</span></tt> or <tt class="docutils literal"><span class="pre">BOTH</span></tt> as the <tt class="docutils literal"><span class="pre">Sky</span> <span class="pre">texture</span> <span class="pre">usage</span></tt> value on the <tt class="docutils literal"><span class="pre">Blend4Web</span></tt> panel (the <tt class="docutils literal"><span class="pre">BOTH</span></tt> option also enables using this texture as a <a class="reference internal" href="textures.html#skydome-texture"><em>skydome texture</em></a>).</p>
</li>
</ol>
<a class="reference internal image-reference" href="_images/lighting_environment_texture.jpg"><img alt="_images/lighting_environment_texture.jpg" class="align-center" src="_images/lighting_environment_texture.jpg" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="shadows">
<span id="id11"></span><h2>Shadows<a class="headerlink" href="#shadows" title="Permalink to this headline">¶</a></h2>
<p>Shadows are exceptionally important for rendering the final picture. They provide the viewer not only with information about the objects&#8217; outline but also about their height and relative position, light source position and so on.</p>
<p>Blend4Web implements the following shadow rendering techniques: cascaded shadow maps (CSM) and softened shadows (PCF). For calculations of shadows from light sources of any type the directional model is always used (like <tt class="docutils literal"><span class="pre">Sun</span></tt>).</p>
<div class="section" id="id12">
<h3>Activation<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p class="first">Enable the <tt class="docutils literal"><span class="pre">Blend4Web</span> <span class="pre">&gt;</span> <span class="pre">Shadows</span> <span class="pre">Cast</span></tt> checkbox under the <tt class="docutils literal"><span class="pre">Object</span></tt> tab for the objects which <strong>cast</strong> shadows.</p>
</li>
<li><p class="first">Enable the <tt class="docutils literal"><span class="pre">Blend4Web</span> <span class="pre">&gt;</span> <span class="pre">Shadows</span> <span class="pre">Receive</span></tt> checkbox under the <tt class="docutils literal"><span class="pre">Object</span></tt> tab for the objects which <strong>receive</strong> shadows.</p>
</li>
<li><p class="first">Make sure that the <tt class="docutils literal"><span class="pre">Blend4Web</span> <span class="pre">&gt;</span> <span class="pre">Render</span> <span class="pre">shadows</span></tt> checkbox is enabled in the <tt class="docutils literal"><span class="pre">Scene</span></tt> tab.</p>
</li>
</ol>
</div>
<div class="section" id="id13">
<h3>Setup<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><em>Direction</em></dt>
<dd><p class="first last">If there are multiple light sources, it is recommended to specify the exact light source which is used for shadow calculations, by enabling the <tt class="docutils literal"><span class="pre">Blend4Web</span> <span class="pre">&gt;</span> <span class="pre">Generate</span> <span class="pre">shadows</span></tt> checkbox under the <tt class="docutils literal"><span class="pre">Object</span> <span class="pre">Data</span></tt> tab for the selected lamp object.</p>
</dd>
<dt><em>Color</em></dt>
<dd><p class="first last">The shadow color is determined by the <a class="reference internal" href="#environment-lighting"><em>environment lighting</em></a> settings.</p>
</dd>
</dl>
<p>The following additional settings are located on the <tt class="docutils literal"><span class="pre">Blend4Web</span> <span class="pre">&gt;</span> <span class="pre">Shadow</span> <span class="pre">Settings</span></tt> panel of the <tt class="docutils literal"><span class="pre">World</span></tt> tab:</p>
<img alt="_images/b4w_shadow_settings.png" class="align-center" src="_images/b4w_shadow_settings.png" />
<dl class="docutils">
<dt><em>Resolution</em></dt>
<dd><p class="first last">Shadow map resolution. The default value is 2048x2048px.</p>
</dd>
<dt><em>Self-shadow polygon offset</em></dt>
<dd><p class="first last">Coefficient for shifting polygons relative to light source orientation. The default value is 1.</p>
</dd>
<dt><em>Self-shadow normal offset</em></dt>
<dd><p class="first last">Coefficient for shifting polygons along their normals. The default value is 0.01.</p>
</dd>
</dl>
<p>The last two parameters can be used to reduce self-shadowing artifacts. These artifacts appear for the objects that cast and receive shadows at the same time. The <tt class="docutils literal"><span class="pre">Self-shadow</span> <span class="pre">polygon</span> <span class="pre">offset</span></tt> parameter is more effective for fighting against artifacts in inner areas of poligons while <tt class="docutils literal"><span class="pre">Self-shadow</span> <span class="pre">normal</span> <span class="pre">offset</span></tt> is better for the boundary areas. Both these parameters lead to shadow distortions so we recommend to set them as low as possible.</p>
<a class="reference internal image-reference" href="_images/self_shadow_artifacts.png"><img alt="_images/self_shadow_artifacts.png" class="align-center" src="_images/self_shadow_artifacts.png" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="docutils">
<dt><em>Enable CSM</em></dt>
<dd><p class="first last">Activates the using of cascaded shadows model; reveals additional options. Disabled by default.</p>
</dd>
</dl>
<p>This option allows to choose between the following shadow generation models:</p>
<ul class="simple">
<li><p class="first">Generic model which uses a single optimized shadow map for the whole scene (<tt class="docutils literal"><span class="pre">Enable</span> <span class="pre">CSM</span></tt> is turned off).</p>
</li>
<li><p class="first">Shadow cascades (<tt class="docutils literal"><span class="pre">Enable</span> <span class="pre">CSM</span></tt> is turned on).</p>
</li>
</ul>
<dl class="docutils">
<dt><em>Blur radius</em></dt>
<dd><p class="first last">Blur ratio for setting up softened shadows. The default value is 3. Zero value produces hard shadows.</p>
</dd>
</dl>
<a class="reference internal image-reference" href="_images/blur_radius.png"><img alt="_images/blur_radius.png" class="align-center" src="_images/blur_radius.png" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Softened shadows can improve visual quality and realism. They hide the jugged edges inevitable when using image-based techniques, that is especially noticable for low-resolution shadow maps. The using of softened shadows often allows to decrease resolution without substantial quality loss.</p>
<div class="section" id="id14">
<h4>Generic shadows<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>This option suits well smaller scenes with a limited number of objects. Thanks to optimizations applied for such scenes, one can achieve better shadow quality as compared with cascaded shadows. Also this option is simpler and faster for setting up, while using a single shadow map greatly improves the performance.</p>
</div>
<div class="section" id="id15">
<h4>Shadow cascades<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<p>In order to provide acceptable shadow quality and to cover considerable space at the same time it is required to use multiple stages for shadow generation (cascades). Thus the best quality cascades are situated near the observer while the worst quality cascades are in the distance. This option suits well middle-to-large scenes, e.g. game levels.</p>
<p>When enabled the following extended settings are revealed:</p>
<img alt="_images/b4w_shadow_settings_csm.png" class="align-center" src="_images/b4w_shadow_settings_csm.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="docutils">
<dt><em>CSM number</em></dt>
<dd><p class="first last">Number of shadow cascades. From 1 to 4 cascades are supported. The default value is 1.</p>
</dd>
<dt><em>CSM first cascade border</em></dt>
<dd><p class="first last">First cascade size. The default value is 10.0.</p>
</dd>
<dt><em>CSM last cascade border</em></dt>
<dd><p class="first last">Last cascade size. The default value is 100.0.</p>
</dd>
</dl>
<p>The sizes of the intermediate cascades are interpolated between the two above-mentioned parameters.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When setting up the shadows keep in mind that the bigger the cascade size is, the worse and less detailed are the shadows inside it. On the other hand, reducing the <tt class="docutils literal"><span class="pre">CSM</span> <span class="pre">first</span> <span class="pre">cascade</span> <span class="pre">border</span></tt> parameter makes the subsequent less detailed cascades closer to the camera and thus more noticeable. Reducing the <tt class="docutils literal"><span class="pre">CSM</span> <span class="pre">last</span> <span class="pre">cascade</span> <span class="pre">border</span></tt> parameter forces shadows to disappear at more close distance from the camera. However when softened shadows are used the overall quality will improve thanks to blurring at the edges.</p>
</div>
<a class="reference internal image-reference" href="_images/csm_cascade_distance.png"><img alt="_images/csm_cascade_distance.png" class="align-center" src="_images/csm_cascade_distance.png" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="docutils">
<dt><em>CSM first cascade blur radius</em></dt>
<dd><p class="first last">Blur ratio for the first cascade. The default value is 3. Zero value produces hard shadows.</p>
</dd>
<dt><em>CSM last cascade blur radius</em></dt>
<dd><p class="first last">Blur ratio for the last cascade. The default value is 1.5. Zero value produces hard shadows.</p>
</dd>
</dl>
<p>The blur radii of the intermediate cascades are interpolated between the two above-mentioned parameters.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We recommend to start setting up the softened shadows with the first cascade (using <tt class="docutils literal"><span class="pre">CSM</span> <span class="pre">first</span> <span class="pre">cascade</span> <span class="pre">blur</span> <span class="pre">radius</span></tt>) and then proceed to other cascades (using <tt class="docutils literal"><span class="pre">CSM</span> <span class="pre">last</span> <span class="pre">cascade</span> <span class="pre">blur</span> <span class="pre">radius</span></tt>). Often the last cascade may need less blurring than the first one. This may be needed to prevent the shadows on the last cascade being too faded due to low resolution. This also reduces undesirable self-shadowing artifacts.</p>
</div>
<dl class="docutils">
<dt><em>Fade-out last cascade</em></dt>
<dd><p class="first last">Smooth dying-out of the last cascade. Enabled by default.</p>
</dd>
<dt><em>Blend between cascades</em></dt>
<dd><p class="first last">Smoothing the boundaries between the cascades. Enabled by default.</p>
</dd>
</dl>
<a class="reference internal image-reference" href="_images/blend_between_cascades.png"><img alt="_images/blend_between_cascades.png" class="align-center" src="_images/blend_between_cascades.png" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="index-4">
<span id="id16"></span><h2>Background<a class="headerlink" href="#index-4" title="Permalink to this headline">¶</a></h2>
<p>You can change the background in the following ways:</p>
<ol class="arabic">
<li><p class="first">Place the whole scene inside a model (e.g. a cube or a sphere) with its normals directed inside, with a material and an optional texture.</p>
</li>
<li><p class="first">Use a <a class="reference internal" href="textures.html#skydome-texture"><em>skydome</em></a>.</p>
</li>
<li><p class="first">Set up the procedurally generated <a class="reference internal" href="outdoor_rendering.html#atmosphere"><em>atmosphere</em></a>.</p>
</li>
<li><p class="first">Set the engine&#8217;s <tt class="docutils literal"><span class="pre">background_color</span></tt> parameter with the <tt class="docutils literal"><span class="pre">config.set()</span></tt> method. This value is used as argument for the WebGL <tt class="docutils literal"><span class="pre">clearColor()</span></tt> method. For correct results, it&#8217;s recommended to turn the WebGL context transparency off (the <tt class="docutils literal"><span class="pre">alpha</span></tt> parameter). Such the configuration is used by default in the engine&#8217;s standard web player.</p>
<blockquote>
<div><div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">m_cfg</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">m_main</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">);</span>

<span class="nx">m_cfg</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;background_color&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">([</span><span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]));</span> <span class="c1">// gray</span>
<span class="nx">m_cfg</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="nx">m_main</span><span class="p">.</span><span class="nx">init</span><span class="p">(...);</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">You can use any HTML content behind the <tt class="docutils literal"><span class="pre">canvas</span></tt> element, to which the rendering is performed, as a background. To do this, activate the WebGL context transparency (the <tt class="docutils literal"><span class="pre">alpha</span></tt> parameter). For correct results, it&#8217;s recommended to set absolutely transparent black background color. Such the configuration is used by default in the <a class="reference internal" href="viewer.html#viewer"><em>scene viewer</em></a> of Blend4Web SDK.</p>
<blockquote>
<div><div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">m_cfg</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">m_main</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">);</span>

<span class="nx">m_cfg</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;background_color&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]));</span>
<span class="nx">m_cfg</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="nx">m_main</span><span class="p">.</span><span class="nx">init</span><span class="p">(...);</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="gamma_alpha.html#alpha-compositing"><em>Alpha Compositing</em></a></p>
</div>
</div></blockquote>
</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">The Engine Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_steps.html">Quick Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Development Environment Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="viewer.html">Scene Viewer</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_player.html">Web Player</a></li>
<li class="toctree-l1"><a class="reference internal" href="addon.html">The Add-on</a></li>
<li class="toctree-l1"><a class="reference internal" href="objects.html">Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="camera.html">Camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="materials.html">Materials</a></li>
<li class="toctree-l1"><a class="reference internal" href="textures.html">Textures</a></li>
<li class="toctree-l1"><a class="reference internal" href="node_materials.html">Node Materials</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Lighting, Shadows and Background</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#index-1">Shading Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#index-2">Normals Editor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#index-3">Lighting with Light Sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environment-lighting">Environment Lighting (Ambient)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shadows">Shadows</a></li>
<li class="toctree-l2"><a class="reference internal" href="#index-4">Background</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="postprocessing_effects.html">Postprocessing Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="particles.html">Particle System</a></li>
<li class="toctree-l1"><a class="reference internal" href="particles_instancing.html">Particle System for Instancing Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="animation.html">Animation</a></li>
<li class="toctree-l1"><a class="reference internal" href="outdoor_rendering.html">Outdoor Rendering</a></li>
<li class="toctree-l1"><a class="reference internal" href="gamma_alpha.html">Gamma Correction and Alpha Compositing</a></li>
<li class="toctree-l1"><a class="reference internal" href="audio.html">Audio System</a></li>
<li class="toctree-l1"><a class="reference internal" href="physics.html">Physics</a></li>
<li class="toctree-l1"><a class="reference internal" href="nla.html">Non-Linear Animation</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers.html">For Application Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers_advanced.html">For Engine Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_short_manual.html">Team Work. Using Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="problems_and_solutions.html">Problems and Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="node_materials.html" title="Node Materials"
             >previous</a> |
          <a href="postprocessing_effects.html" title="Postprocessing Effects"
             >next</a> |
          <a href="genindex.html" title="General Index"
             >index</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2014, Triumph LLC.
      Last updated on 2014-12-24.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>