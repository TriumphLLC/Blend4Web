var b4w=function(a){var p={};a.module=p;var c={};a.register=function(a,b){if(p[a])throw Error('Module "'+a+'" already registered');p[a]=b};a.require=function(a,b){if(!p[a])throw Error('Module "'+a+'" not found');b=b||"__B4W_DEF_NS";c[b]||(c[b]=function(a){return function(b){var d=p[b];if(!d)throw Error('Module "'+b+'" not found');d.Xh||(d.Xh={});d.Xh[a]||(d.Xh[a]={},d(d.Xh[a],c[a]));return d.Xh[a]}}(b));return c[b](a)};a.module_check=function(a){return p[a]?!0:!1};return a}({});"object"==typeof module&&module.sm&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a){function p(){var a=c,d=a.getDate(),d=10>d?"0"+String(d):String(d),g=a.getMonth()+1,g=10>g?"0"+String(g):String(g),h=String(a.getFullYear()),k=a.getHours(),k=10>k?"0"+String(k):String(k),n=a.getMinutes(),n=10>n?"0"+String(n):String(n),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return d+"."+g+"."+h+" "+k+":"+n+":"+a}var c=new Date(2015,6,29,10,15,56),d=[15,7];a.version=function(){return d};a.version_str=function(){for(var a="",c=0;c<d.length;c++)a=1==c?a+(10>d[c]?
"0"+d[c]:d[c]):a+d[c],c!=d.length-1&&(a+=".");return a};a.type=function(){return"RELEASE"};a.date=function(){return c};a.date_str=p;a.timestamp=function(){var a=p(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.sm&&b4w.module.__version(exports);b4w.module.__config=function(a,p){function c(){return b4w.module_check(a.Tb.Ij)}function d(){for(var c=a.Tb,d=null,e=document.getElementsByTagName("script"),n=0;n<e.length;n++){for(var f=e[n].src,l=0;l<c.pr.length;l++)if(0<=f.indexOf(c.pr[l])){d=f;break}if(null!==d)break}d||(b.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),d=document.location.href);c=d.indexOf("?");0<=c&&(d=d.substring(0,c));return d.substring(0,d.lastIndexOf("/")+1)}var b=p("__print"),
e=p("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.yw=e.ka(a.context);a.p={alpha_sort:!0,alpha_sort_threshold:.1,vl:!1,Ii:[5,4],bd:1E4,console_verbose:!1,do_not_load_resources:!1,bl:!1,sq:1.5,Nx:10,background_color:[0,0,0,0],gg:.01,render_resolution_factor:1,canvas_resolution_factor:1,Xk:3,allow_cors:!1,Am:!1,zj:!0,show_hud_debug_info:!1,KD:!0,aj:!0,anaglyph_use:!1,Nk:!0,fc:!0,xe:!0,Wg:!0,bh:!0,Og:!0,ph:!0,Sg:!0,antialiasing:!0,smaa:!1,
wireframe_debug:!1,Ct:!1,Yg:!0,Oi:!0,wb:!0,Hk:!0,water_dynamic:!0,shore_smoothing:!0,zh:!0,Kb:1024,jg:512,pt:!0,precision:"highp",quality:a.P_HIGH,sl:!0,Gz:!1,Es:!1,cq:!1,wt:!1,$f:!1,Sl:!1,Op:!1,cr:!1,Tl:!1,bF:!1,Vc:!1,allow_hidpi:!1,gyro_use:!1,oq:!1,un:!1,Ym:!1,enable_selectable:!0,enable_outlining:!0,Se:!0,yr:128,Vm:!1,fr:!1,tz:!1,mn:[0,0]};a.mx=e.ka(a.p);a.Sd={Ha:-1,tq:!1,Tf:1};a.controls={Ez:1/120};a.Td={dir:"ASSETS=../../assets/",zz:15,gs:!0,sn:!1,im:!1};a.Dv=e.ka(a.Td);a.Tb={shaders_dir:"",
$A:"include/",ZE:"postprocessing/",Ij:"built_in_data",pr:["b4w.min.js","b4w.full.min.js","src/b4w.js","USER_DEFINED_MODULE"],us:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.Wa={enabled:!0,bd:60,gj:"",Nl:!1,ping:!1};a.Rz=e.ka(a.Wa);a.wh={ak:1024,Rj:384,Vp:32,fx:128,ex:256,ds:.25,Uz:.5,Tz:1};a.zA=e.ka(a.wh);a.hd={Eo:!0,rk:!1,hp:!1,Ep:!1,dq:!1};a.ZA=e.ka(a.hd);a.Fb={outlining_overview_mode:!1,bf:[1,.4,.05],dd:1,yk:.2,zk:3.8,Ak:1};a.jm={enabled:!1,EB:"MAIN_OPAQUE",DB:0,cB:"COLOR"};a.ix=
e.ka(a.jm);a.yv=function(){var b=a.p,c=a.Wa,d=a.wh;switch(b.quality){case a.P_ULTRA:b.aj=!0;b.shore_smoothing=!0;b.xe=!0;b.Wg=!0;b.bh=!0;b.Og=!0;b.Nk=!0;b.fc=!0;b.Yg=!0;b.Oi=!0;b.wb=!0;b.Hk=!0;b.render_resolution_factor=1.75;d.ak=2048;b.Xk=3;b.zj=!0;b.bl=!1;b.precision="highp";b.water_dynamic=!0;b.zh=!0;b.antialiasing=!0;b.smaa=!0;b.Sg=!0;b.ph=!0;b.allow_hidpi=!0;b.enable_outlining=!0;b.Se=!0;c.bd=120;break;case a.P_HIGH:b.aj=!0;b.shore_smoothing=!0;b.xe=!0;b.Wg=!0;b.bh=!0;b.Og=!0;b.Nk=!0;b.fc=!0;
b.Yg=!0;b.Oi=!0;b.wb=!0;b.Hk=!0;b.render_resolution_factor=1;d.ak=1024;b.Xk=3;b.zj=!0;b.bl=!1;b.precision="highp";b.water_dynamic=!0;b.zh=!0;b.antialiasing=!0;b.smaa=!1;b.Sg=!0;b.ph=!0;b.allow_hidpi=!1;b.enable_outlining=!0;b.Se=!0;c.bd=60;break;case a.P_LOW:b.aj=!1,b.shore_smoothing=!1,b.xe=!1,b.Wg=!1,b.bh=!1,b.Og=!1,b.Nk=!1,b.fc=!1,b.Yg=!1,b.Oi=!1,b.wb=!1,b.Hk=!1,b.render_resolution_factor=1,d.ak=512,b.Xk=2,b.zj=!1,b.bl=!0,b.precision="mediump",b.water_dynamic=!1,b.zh=!1,b.antialiasing=!1,b.smaa=
!1,b.Sg=!1,b.ph=!1,b.allow_hidpi=!1,b.enable_outlining=!1,b.Se=!1,c.bd=60}};a.set=function(c,d){switch(c){case "allow_cors":a.p.allow_cors=d;break;case "allow_hidpi":a.p.allow_hidpi=d;break;case "alpha":a.context.alpha=d;break;case "alpha_sort":a.p.alpha_sort=d;break;case "alpha_sort_threshold":a.p.alpha_sort_threshold=d;break;case "anaglyph_use":a.p.anaglyph_use=d;break;case "animation_framerate":a.Sd.Ha=d;break;case "antialiasing":a.p.antialiasing=d;break;case "assets_dds_available":a.Td.im=d;break;
case "assets_min50_available":a.Td.sn=d;break;case "audio":a.hd.Eo=d;break;case "background_color":a.p.background_color=d;break;case "built_in_module_name":a.Tb.Ij=d;break;case "canvas_resolution_factor":a.p.canvas_resolution_factor=d;break;case "console_verbose":a.p.console_verbose=d;break;case "do_not_load_resources":a.p.do_not_load_resources=d;break;case "gyro_use":a.p.gyro_use=d;break;case "physics_enabled":a.Wa.enabled=d;break;case "physics_uranium_path":a.Wa.gj=d;break;case "physics_calc_fps":a.Wa.Nl=
d;break;case "precision":a.p.precision=d;break;case "quality":a.p.quality=d;break;case "render_resolution_factor":a.p.render_resolution_factor=d;break;case "sfx_mix_mode":a.hd.rk=d;break;case "shaders_dir":a.Tb.shaders_dir=d;break;case "show_hud_debug_info":a.p.show_hud_debug_info=d;break;case "smaa":a.p.smaa=d;break;case "smaa_search_texture_path":a.Tb.smaa_search_texture_path=d;break;case "smaa_area_texture_path":a.Tb.smaa_area_texture_path=d;break;case "wireframe_debug":a.p.wireframe_debug=d;break;
case "enable_selectable":a.p.enable_selectable=d;break;case "enable_outlining":a.p.enable_outlining=d;break;case "outlining_overview_mode":a.Fb.outlining_overview_mode=d;break;case "glow_materials":a.p.Se=d;break;default:b.error("Unknown config property: "+c)}};a.get=function(c){switch(c){case "allow_cors":return a.p.allow_cors;case "allow_hidpi":return a.p.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.p.alpha_sort;case "alpha_sort_threshold":return a.p.alpha_sort_threshold;
case "anaglyph_use":return a.p.anaglyph_use;case "animation_framerate":return a.Sd.Ha;case "antialiasing":return a.p.antialiasing;case "assets_dds_available":return a.Td.im;case "assets_min50_available":return a.Td.sn;case "audio":return a.hd.Eo;case "background_color":return a.p.background_color;case "built_in_module_name":return a.Tb.Ij;case "canvas_resolution_factor":return a.p.canvas_resolution_factor;case "console_verbose":return a.p.console_verbose;case "do_not_load_resources":return a.p.do_not_load_resources;
case "gyro_use":return a.p.gyro_use;case "physics_enabled":return a.Wa.enabled;case "physics_uranium_path":return a.Wa.gj;case "physics_calc_fps":return a.Wa.Nl;case "precision":return a.p.precision;case "quality":return a.p.quality;case "render_resolution_factor":return a.p.render_resolution_factor;case "sfx_mix_mode":return a.hd.rk;case "shaders_dir":return a.Tb.shaders_dir;case "show_hud_debug_info":return a.p.show_hud_debug_info;case "smaa":return a.p.smaa;case "smaa_search_texture_path":return a.Tb.smaa_search_texture_path;
case "smaa_area_texture_path":return a.Tb.smaa_area_texture_path;case "wireframe_debug":return a.p.wireframe_debug;case "enable_selectable":return a.p.enable_selectable;case "enable_outlining":return a.p.enable_outlining;case "outlining_overview_mode":return a.Fb.outlining_overview_mode;case "glow_materials":return a.p.Se;default:b.error("Unknown config property: "+c)}};a.reset=function(){a.context=e.ka(a.yw);a.p=e.ka(a.mx);a.Td=e.ka(a.Dv);a.Wa=e.ka(a.Rz);a.wh=e.ka(a.zA);a.hd=e.ka(a.ZA);a.jm=e.ka(a.ix)};
a.az=c;a.PA=function(){var b=a.Tb,h=a.Wa;c()||""!=b.shaders_dir||(b.shaders_dir=d()+"../shaders/");if(c())b.smaa_search_texture_path="smaa_search_texture.png",b.smaa_area_texture_path="smaa_area_texture.png";else if(""==b.smaa_search_texture_path||""==b.smaa_area_texture_path){var e=d()+b.us;b.smaa_search_texture_path=b.smaa_search_texture_path||e+"smaa_search_texture.png";b.smaa_area_texture_path=b.smaa_area_texture_path||e+"smaa_area_texture.png"}h.enabled&&""==h.gj&&(e=d()+b.us,h.gj=e+"uranium.js")};
a.get_std_assets_path=function(){return a.Td.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,p){function c(a,c){var h=document.createElement("div"),g=h.style;g.position="absolute";g.backgroundColor="black";g.borderRadius="20px 20px 20px 0px";g.boxShadow="0px 0px 10px rgb(180, 180, 200)";g.opacity=1;g.padding="8px 12px";g.lineHeight="15px";g.visibility="hidden";g.fontSize="12px";var q=n.get_container();q.appendChild(h);var l=f.get_meta_tags(a),k=document.createElement("span"),t=k.style;k.innerHTML=l.title||a.name;t.fontWeight="bold";t.fontSize="12px";t.lineHeight=
"15px";t.color="#fff";t.fontFamily="Arial";e(k);h.appendChild(k);var u=l.description;if(u){var l=document.createElement("div"),B=l.style;B.position="absolute";B.bottom="0px";B.left="0px";B.backgroundColor="#000";B.borderRadius="20px 20px 20px 0px";B.boxShadow="0px 0px 10px rgb(180, 180, 200)";B.visibility="hidden";B.padding="8px 12px";B.overflow="hidden";B.lineHeight="15px";B.fontSize="12px";B.zIndex="2";h.appendChild(l);var J=document.createElement("span"),K=J.style;J.innerHTML=u;K.fontSize="12px";
K.fontFamily="Arial";K.fontWeight="bold";K.lineHeight="15px";K.color="#fff";K.visibility="hidden";l.appendChild(J);var P=!1,R=!1;q.addEventListener("click",function(a){if(!(P||R||D))if(a.target!=k&&a.target!=h||"hidden"!=B.visibility||1!=g.opacity)"visible"==B.visibility&&(g.visibility="visible",t.visibility="visible",B.visibility="hidden",K.visibility="hidden");else{g.visibility="hidden";t.visibility="hidden";B.visibility="visible";P=R=!0;a=h.offsetWidth-24;var J=h.offsetHeight-16,f=Math.min(c,d(u)),
w=b(u,f);w==J&&(B.height=w+"px");f!=a?z.animate(a,f,200,function(a){a==f&&("visible"==B.visibility&&(K.visibility="visible"),P=!1);B.width=a+"px"}):P=!1;w!=J?z.animate(J,w,200,function(a){a==w&&("visible"==B.visibility&&(K.visibility="visible"),R=!1);B.height=a+"px"}):R=!1;R||P||(K.visibility="visible")}},!1)}return h}function d(a){var b=document.createElement("div"),c=document.createElement("span"),d=b.style;c.innerHTML=a;c.style.fontSize="12px";c.style.fontFamily="Arial";c.style.fontWeight="bold";
c.style.color="#fff";c.style.visibility="hidden";d.lineHeight="15px";b.appendChild(c);d.position="absolute";d.visibility="hidden";d.fontSize="12px";d.display="inline-block";d.lineHeight="15px";document.body.appendChild(b);a=b.offsetWidth+1;document.body.removeChild(b);return a}function b(a,b){var c=document.createElement("div"),d=document.createElement("span"),f=c.style;d.innerHTML=a;d.style.fontSize="12px";d.style.fontFamily="Arial";d.style.fontWeight="bold";d.style.color="#fff";d.style.visibility=
"hidden";f.lineHeight="15px";c.appendChild(d);f.position="absolute";f.visibility="hidden";f.fontSize="12px";f.display="inline-block";f.width=b+"px";f.lineHeight="15px";document.body.appendChild(c);d=c.offsetHeight;document.body.removeChild(c);return d}function e(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]="none";a.style.cursor="default"}
function g(){for(var a=0,b=0;b<A.length;b++)A[b].lm&&a++;H=new Float32Array(3*a)}var h=p("__batch"),k=p("__camera"),n=p("__container"),f=p("__objects"),l=p("__print"),t=p("__renderer"),x=p("__scenes"),z=p("__time");p("__util");p("__config");var D=!1,A=[],H=new Float32Array(0),u=new Uint8Array(16),y=new Float32Array(2),q=new Float32Array(3);a.append=function(a){var b;a:{for(b=0;b<A.length;b++)if(A[b].obj==a){b=!0;break a}b=!1}if(!b){b=a.b4w_anchor.detect_visibility&&Boolean(x.Z(x.ah(),"ANCHOR_VISIBILITY"));
b={type:a.b4w_anchor.type,obj:a,x:0,y:0,depth:0,Mg:"out",lm:b,element:null,qh:null,fv:a.b4w_anchor.max_width,ap:0};switch(b.type){case "ANNOTATION":b.element=c(a,b.fv);b.ap=b.element.offsetHeight;break;case "ELEMENT":b.element=document.getElementById(a.b4w_anchor.element_id),b.element||(l.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}A.push(b);g()}};a.remove=function(a){for(var b=0;b<A.length;b++){var c=A[b];if(c.obj==a){"ANNOTATION"==c.type&&(a=c,n.get_container().removeChild(a.element));
A.splice(b,1);g();break}}};a.update=function(){for(var a=0,b=A.length;b--;){var c=A[b];c.lm&&(H.set(c.obj.e.h,3*a),a++);var d,f=c,e=q;d=x.Yj(x.ah());d=e=k.project_point(d,f.obj.e.h,e);f=d[0];e=d[1];d=d[2];if(f!=c.x||e!=c.y||d!=c.depth){switch(c.type){case "ANNOTATION":var g=c.element;g.style.left=Math.floor(f)+"px";g.style.top=Math.floor(e-c.ap)+"px";break;case "ELEMENT":var g=c.element,l=g.getBoundingClientRect();g.style.cssText+="left:"+Math.floor(f-l.width/2)+"px;top:"+Math.floor(e-l.height/2)+
"px;"}c.x=f;c.y=e;c.depth=d;c.qh&&c.qh(f,e,c.Mg,c.obj,g)}}0<a&&(a=x.Z(x.ah(),"ANCHOR_VISIBILITY").q[0].B,h.SB(a,H))};a.mC=function(){for(var a=n.get_container(),b=A.length;b--;){var c=A[b],d=c.obj,f=c.x,e=c.y,h=c.depth,h=0>f||0>e||0>h||1<h||x.is_hidden(d)||f>=a.clientWidth||e>=a.clientHeight?"out":"visible";if(c.lm&&"out"!=h){var h=c,g=x.Z(x.ah(),"ANCHOR_VISIBILITY").j,l=n.Ql(h.x,h.y,y,g);t.ps(g.he,l[0],g.height-l[1],2,2,u);h=1020==u[0]+u[4]+u[8]+u[12]?"visible":"out"==h.Mg||0==u[0]+u[4]+u[8]+u[12]?
"covered":h.Mg}if(h!=c.Mg){switch(c.type){case "ANNOTATION":case "ELEMENT":var B=c.element;if(!B)break;"out"==h?(B.style.visibility="hidden",B.children.length&&(B.children[0].style.visibility="hidden"),"ANNOTATION"==c.type&&1<B.children.length&&(g=B.children[1],g.style.visibility="hidden",g.children.length&&(g.children[0].style.visibility="hidden"))):"visible"==h?(B.style.visibility="visible",B.children.length&&(B.children[0].style.visibility="visible"),B.style.opacity=1):(B.style.visibility="visible",
B.style.opacity=.1,B.children.length&&(B.children[0].style.visibility="visible"),"ANNOTATION"==c.type&&1<B.children.length&&(g=B.children[1],g.style.visibility="hidden",g.children.length&&(g.children[0].style.visibility="hidden")))}c.Mg=h;c.qh&&c.qh(f,e,c.Mg,d,B)}}};a.attach_move_cb=function(a,b){for(var c=0;c<A.length;c++)A[c].obj==a&&(A[c].qh=b)};a.detach_move_cb=function(a){for(var b=0;b<A.length;b++)A[b].obj==a&&(A[b].qh=null)};a.cleanup=function(){for(var a=0;a<A.length;a++){var b=A[a];"ANNOTATION"==
b.type&&n.get_container().removeChild(b.element)}A.length=0};a.is_anchor=function(a){return a.b4w_anchor?!0:!1};a.get_element_id=function(a){return a.b4w_anchor&&a.b4w_anchor.element_id?a.b4w_anchor.element_id:!1};a.pause=function(){D=!0};a.resume=function(){D=!1}};b4w.module.__boundings=function(a,p){function c(a,b){for(var c=a[0],d=a[1],f=a[2],h=a[0],e=a[1],g=a[2],l=3;l<a.length;l+=3)var w=a[l],m=a[l+1],k=a[l+2],c=Math.max(c,w),d=Math.max(d,m),f=Math.max(f,k),h=Math.min(h,w),e=Math.min(e,m),g=Math.min(g,k);b.max_x=c;b.max_y=d;b.max_z=f;b.min_x=h;b.min_y=e;b.min_z=g;return b}function d(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,f=a.max_z,h=a.min_x,e=a.min_y,g=a.min_z;b[0]=h;b[1]=e;b[2]=g;b[3]=c;b[4]=e;b[5]=g;b[6]=c;b[7]=d;b[8]=g;b[9]=h;b[10]=
d;b[11]=g;b[12]=h;b[13]=e;b[14]=f;b[15]=c;b[16]=e;b[17]=f;b[18]=c;b[19]=d;b[20]=f;b[21]=h;b[22]=d;b[23]=f;return b}function b(a,b,c){h.add(b,c,a.F);h.scale(a.F,.5,a.F);a.Da=h.distance(a.F,b);return a}var e=p("__util"),g=p("__tsr"),h=p("vec3"),k=new Float32Array(24),n=new Float32Array(3),f=new Float32Array(3),l=new Float32Array(3);a.Mp=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.sD=function(){return{max_x:1E12,min_x:-1E12,max_y:1E12,
min_y:-1E12,max_z:1E12,min_z:-1E12}};a.Ld=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.hq=function(a,b){var c=a.max_y,d=a.max_z,f=a.min_x,h=a.min_y,e=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,f);a.min_y=Math.min(b.min_y,h);a.min_z=Math.min(b.min_z,e)};a.Kv=c;a.Jl=function(b,f,h){h||(h=a.Ld());b=d(b,k);e.df(b,f,b);return c(b,h)};a.Gx=d;a.aF=function(b,c,d){d||(d=a.Ld());
var f=c.min_x,h=c.max_x,e=c.min_y,g=c.max_y,l=c.min_z;c=c.max_z;if(f>=b.max_x||h<=b.min_x||e>=b.max_y||g<=b.min_y||l>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,f);d.max_x=Math.min(b.max_x,h);d.min_y=Math.max(b.min_y,e);d.max_y=Math.min(b.max_y,g);d.min_z=Math.max(b.min_z,l);d.max_z=Math.min(b.max_z,c);return d};a.eF=function(b,c,d){d||(d=a.Ld());var f=b.max_x-b.min_x,h=b.max_y-b.min_y,e=b.max_z-b.min_z;d.min_x=b.min_x-
.5*(c-1)*f;d.max_x=b.max_x+.5*(c-1)*f;d.min_y=b.min_y-.5*(c-1)*h;d.max_y=b.max_y+.5*(c-1)*h;d.min_z=b.min_z-.5*(c-1)*e;d.max_z=b.max_z+.5*(c-1)*e;return d};a.Ll=function(b,c,d){d||(d=a.mj());h.transformMat4(b.F,c,d.F);d.Da=b.Da*e.qn(c);return d};a.Kl=function(a,b,c){c||(c={Bf:new Float32Array(3),Cf:new Float32Array(3),Df:new Float32Array(3),F:new Float32Array([0,0,0])});g.transform_vec3(a.F,b,c.F);h.copy(a.Bf,c.Bf);h.copy(a.Cf,c.Cf);h.copy(a.Df,c.Df);g.transform_dir_vec3(c.Bf,b,c.Bf);g.transform_dir_vec3(c.Cf,
b,c.Cf);g.transform_dir_vec3(c.Df,b,c.Df);return c};a.bm=function(a,b){return{Da:a,F:new Float32Array(b)}};a.mj=function(){return{F:new Float32Array([0,0,0]),Da:0}};a.am=function(a,b,c,d){return{Bf:new Float32Array(a),Cf:new Float32Array(b),Df:new Float32Array(c),F:new Float32Array([d[0],d[1],d[2]])}};a.Mv=function(){return{F:new Float32Array([0,0,0]),Da:1E12}};a.Cx=function(a,b){var c=h.subtract(b.F,a.F,h.create());0==h.length(c)&&h.set(1,0,0,c);var d=h.normalize(c,h.create()),c=h.scale(d,a.Da,h.create());
h.add(c,a.F,c);var f=h.scale(d,-a.Da,h.create());h.add(f,a.F,f);var e=h.scale(d,b.Da,h.create());h.add(e,b.F,e);var g=h.scale(d,-b.Da,h.create());h.add(g,b.F,g);c=[c,f,e,g];d=h.normalize(d,h.create());f=c[0];e=c[0];for(g=1;g<c.length;g++){var l=h.dot(c[g],d);l<h.dot(f,d)&&(f=c[g]);l>h.dot(e,d)&&(e=c[g])}d=[f,e];c=d[0];d=d[1];a.F=h.scale(h.add(c,d,h.create()),.5,h.create());a.Da=h.length(h.subtract(d,c,h.create()))/2};a.Pp=function(a,b){var c=b.max_y,d=b.min_y,f=Math.max(0,c-d-2*a);return{Da:a,height:f,
F:new Float32Array([0,(c+d)/2,0])}};a.Rp=function(a,b){var c=b.max_y,d=b.min_y,f=Math.max(0,c-d);return{Da:a,height:f,F:new Float32Array([0,(c+d)/2,0])}};a.Qp=function(a,b){var c=b.max_y,d=b.min_y,f=Math.max(0,c-d);return{Da:a,height:f,F:new Float32Array([0,(c+d)/2,0])}};a.wD=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.fA=function(a){for(var b=0,c=0,d=0,f=0,h=0,e=0,g=0,l=0,w=0;w<a.submeshes.length;w++){var m=
a.submeshes[w];if(m.position.length){b=f=m.position[0];c=h=m.position[1];d=e=m.position[2];break}}for(w=0;w<a.submeshes.length;w++)for(var m=a.submeshes[w],m=m.position,k=0;k<m.length/3;k++)var n=m[3*k],I=m[3*k+1],F=m[3*k+2],b=Math.max(n,b),c=Math.max(I,c),d=Math.max(F,d),f=Math.min(n,f),h=Math.min(I,h),e=Math.min(F,e),g=Math.max(Math.sqrt(n*n+I*I+F*F),g),l=Math.max(Math.sqrt(n*n+F*F),l);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=f;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=h;a.b4w_bounding_box.max_z=
d;a.b4w_bounding_box.min_z=e;a.b4w_bounding_box_source.max_x=b;a.b4w_bounding_box_source.min_x=f;a.b4w_bounding_box_source.max_y=c;a.b4w_bounding_box_source.min_y=h;a.b4w_bounding_box_source.max_z=d;a.b4w_bounding_box_source.min_z=e;a.b4w_bounding_sphere_radius=g;a.b4w_bounding_cylinder_radius=l};a.xy=function(c){var d=c.subarray(0,3),g=c.subarray(6,9),k=c.subarray(12,15),A=c.subarray(18,21);c=h.subtract(g,d,n);h.normalize(c,c);var H=e.Ay(d,g,k,f),H=h.cross(H,c,H);h.normalize(H,H);var u=h.create(),
y=h.create();h.subtract(g,d,l);y[0]=h.dot(l,c);y[1]=h.dot(l,H);g=h.create();h.subtract(k,d,l);g[0]=h.dot(l,c);g[1]=h.dot(l,H);k=h.create();h.subtract(A,d,l);k[0]=h.dot(l,c);k[1]=h.dot(l,H);A=a.mj();k=[u,y,g,k];u=b(A,k[0],k[1]);for(A=2;A<k.length;A++)if(h.distance(u.F,k[A])>u.Da){for(var q=u,u=k,y=k[A],g=A-1,q=b(q,y,u[0]),w=1;w<=g;w++)if(h.distance(q.F,u[w])>q.Da){for(var m=q,q=u,r=y,E=u[w],I=w-1,m=b(m,r,E),F=0;F<=I;F++)if(h.distance(m.F,q[F])>m.Da){var M=r,L=E,O=q[F],B=h.subtract(L,O,l),B=h.squaredLength(B),
J=h.subtract(M,O,l),K=h.squaredLength(J),J=h.subtract(M,L,l),P=h.squaredLength(J),J=B*(K+P-B),R=K*(P+B-K),B=P*(B+K-P),K=J+R+B;h.copy(M,m.F);h.scale(m.F,J/K,m.F);h.scaleAndAdd(m.F,L,R/K,m.F);h.scaleAndAdd(m.F,O,B/K,m.F);m.Da=h.distance(m.F,M)}q=m}u=q}A=u;c=h.scale(c,A.F[0],l);h.scaleAndAdd(c,H,A.F[1],c);h.add(c,d,A.F);return A}};b4w.module.__compat=function(a,p){function c(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function d(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function b(){return!window.ActiveXObject&&"ActiveXObject"in window}var e=p("__config"),g=p("__extensions"),h=p("__print");
p("__util");a.rx=function(a){a.getError()==a.INVALID_ENUM&&h.warn("Possible Tegra invalid enum issue detected, ignoring")};a.JA=function(a){var n=e.Sd,f=e.p,l=e.context,t=e.wh,x=e.hd;f.yr=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);f.Kb=a.getParameter(a.MAX_TEXTURE_SIZE);f.jg=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var z=Boolean(g.sy());c("Firefox/28.0")&&(c("Linux")||c("Macintosh"))&&(h.warn("Firefox 28 detected, applying depth hack"),z=!1);c("iPad")||c("iPhone")?(h.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack, applying ios depth hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
l.alpha||(f.background_color[3]=1),f.wt=!0,f.smaa=!1,f.xe=!1,f.precision="highp",f.cr=!0,f.fr=!0):c("Mac OS X")&&c("Safari")&&!c("Chrome")&&(h.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),x.hp=!0,x.Ep=!0);c("Windows")&&(c("Chrome/40")||c("Firefox/33")||c("Firefox/34")||c("Firefox/35")||c("Firefox/36"))&&(h.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),f.Tl=!0);d()&&(h.warn("Mobile detected, applying various hacks for video textures."),
f.$f=!0,c("iPad")||c("iPhone")||(h.warn("Mobile (not iOS) detected, disable playback rate for video textures."),x.dq=!0));(c("Firefox/35.0")||c("Firefox/36.0"))&&c("Windows")&&(h.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),f.oq=!0);if(c("iPhone")||b())h.warn("iPhone or IE11 detected. Enable sequential video fallback for video textures."),f.Vc=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(h.warn("Not enough varyings, disable shadows on blend objects"),f.cq=!0);if(l=g.Jq())c("Macintosh")&&
-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(h.warn("OS X / Intel HD 3000 detected, applying depth hack"),z=!1),c("Windows")&&c("Chrome")&&-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("Intel")&&(h.warn("Chrome / Windows / Intel GPU detected, applying cubemap mipmap/rgb hack"),f.Ym=!0),-1<a.getParameter(l.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(h.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),
z=!1,n.tq=!0),-1<a.getParameter(l.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(h.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),f.precision="highp",f.aj=!1),-1<a.getParameter(l.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T760")&&(h.warn('ARM Mali-T760 detected, set "highp" precision and disable SSAO.'),f.precision="highp",f.xe=!1),-1<a.getParameter(l.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&
-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(h.warn("Qualcomm Adreno detected, applying shader constants hack."),f.Es=!0,-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(h.warn('Qualcomm Adreno305 detected, set "highp" precision.'),f.precision="highp"),-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(h.warn('Qualcomm Adreno330 detected, set "highp" precision.'),f.precision="highp")),-1<a.getParameter(l.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(l.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&
(h.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),f.Am=!0),c("Windows")&&c("Chrome")&&a.getParameter(l.UNMASKED_RENDERER_WEBGL).match(/NVIDIA GeForce 8..0/)&&(h.warn("Chrome / Windows / NVIDIA GeForce 8000 series detected, setting max cubemap size to 256."),f.jg=256);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(h.warn("Vertex textures are not allowed. Disabling vertex textures"),f.sl=!1);f.allow_hidpi&&1<window.devicePixelRatio&&(h.log("%cENABLE HIDPI MODE",
"color: #00a"),f.render_resolution_factor=1,f.smaa=!1);z||(f.Yg=!1,f.Oi=!1,f.wb=!1,f.water_dynamic=!1,f.shore_smoothing=!1,f.zh=!1,f.smaa=!1);f.pt=Boolean(g.Kq());f.ni=z;0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(f.precision="mediump");b()&&(h.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),t.Rj=512);b()&&c("Touch")&&(h.warn("IE11 and touchscreen detected. Behaviour of the mouse move sensor will be changed."),f.Vm=!0);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&
(h.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),f.Am=!0);c("Chrome")&&(h.log("Chrome detected. Some of deprecated functions related to the Doppler effect won't be called."),f.Sl=!0,f.Op=!0);if(b()||c("iPad"))h.warn("iPad or Internet Explorer detected. Applying alpha clip hack."),f.vl=!0;d()&&c("Firefox")&&(h.log("Mobile firefox detected. Applying autoplay media hack."),f.un=!0)};a.detect_mobile=d;a.wv=function(){c("Firefox/35.0")&&c("Windows")&&(h.warn("Windows/Firefox 35 detected, forcing context's alpha"),
e.context.alpha=!0)};a.$m=b};b4w.module.__constraints=function(a,p){function c(a){var b={};b.type=a;return b}function d(a,c){a.$a&&a.$a.P&&e(a.$a.P,a);c.P&&b(c.P,a);a.$a=c}function b(a,b){if(-1==a.Mc.indexOf(b))a.Mc.push(b);else throw"Descendant object override is forbidden";}function e(a,b){var c=a.Mc.indexOf(b);if(-1!=c)a.Mc.splice(c,1);else throw"No descendant object";}function g(a,b,c){switch(b.type){case 1:var d=a.e.quat,e=b.P.e.V;c=b.P.e.quat;b.gc?(z.copy(b.gc,d),z.multiply(c,d,d)):z.copy(c,d);x.transformMat4(b.offset,
e,a.e.h);a.e.scale=b.Ok*b.P.e.scale;break;case 9:var g=a.e.h,d=a.e.quat,e=b.P.e.V;c=b.P.e.quat;z.multiply(z.invert(b.sg,b.sg),d,d);z.multiply(c,d,d);x.transformMat4(b.offset,e,g);z.copy(c,b.sg);break;case 10:g=a.e.h;d=a.e.quat;e=b.P.e.V;c=b.P.e.quat;z.multiply(z.invert(b.sg,b.sg),d,d);z.multiply(c,d,d);x.transformMat4(b.offset,e,g);z.copy(c,b.sg);g=a.e.quat;d=z.multiply(b.P.e.quat,b.gc,m);d=t.Cq(d,A);g=t.Cq(g,H);t.rotate_eye_camera(a,l.Je(g[0],d[0]+b.ow,d[0]+b.nw),l.Je(g[1],d[1]+b.mw,d[1]+b.pw));
break;case 12:var g=a.e.h,d=a.e.quat,e=b.P.e.V,q=b.P.e.h,r=b.fB,y=u,I=m;x.transformMat4(b.offset,e,y);l.smooth_v(y,g,c,r,g);e=u;x.sub(q,g,e);x.normalize(e,e);var p=d,g=F,q=g.subarray(0,3),y=g.subarray(3,6),pa=g.subarray(6,9);x.copy(e,y);x.negate(y,y);x.normalize(y,y);Boolean(.999999<Math.abs(x.dot(e,l.AXIS_Y)))?(e=D.fromQuat(z.normalize(p,I),M),x.copy(e.subarray(0,3),q)):x.cross(l.AXIS_Y,y,q);x.normalize(q,q);x.cross(q,y,pa);x.normalize(pa,pa);z.fromMat3(g,I);z.normalize(I,I);l.Ns(I,d,c,.16*r,d);
break;case 2:d=a.e.quat;g=w;c=m;n(b.P,b.Sv,!0,g,c);b.gc?(z.copy(b.gc,d),z.multiply(c,d,d)):z.copy(c,d);a.e.scale=b.Ok*g[3];l.transform_vec3(b.offset,g[3],c,g,a.e.h);break;case 3:g=a.e.h;d=a.e.quat;c=b.P.e.h;h(g,d,c);break;case 4:g=a.e.h;d=a.e.quat;c=b.target;h(g,d,c);break;case 5:g=a.e.h;d=a.e.quat;c=b.P.e.h;h(g,d,c);d=x.dist(g,c);if(d=d>b.dist_max?d-b.dist_max:d<b.oi?d-b.oi:0)x.sub(c,g,u),x.normalize(u,u),x.scale(u,d,u),x.add(g,u,g);break;case 6:g=a.e.h;d=a.e.quat;c=b.target;h(g,d,c);d=x.dist(g,
c);if(d=d>b.dist_max?d-b.dist_max:d<b.oi?d-b.oi:0)x.sub(c,g,u),x.normalize(u,u),x.scale(u,d,u),x.add(g,u,g);break;case 7:e=b.P.e.V;x.transformMat4(b.offset,e,a.e.h);break;case 8:q=b.P.e.h;g=a.e.h;x.add(q,b.offset,g);break;case 13:d=a.e.quat;e=b.P.e.V;c=b.P.e.quat;b.gc?(z.copy(b.gc,d),z.multiply(c,d,d)):z.copy(c,d);x.transformMat4(b.offset,e,a.e.h);break;case 11:g=b.P.e;c=f.create_sep(g.h,g.scale,g.quat,E);f.multiply(c,b.ht,c);g=a.e.h;g[0]=c[0];g[1]=c[1];g[2]=c[2];a.e.scale=c[3];d=a.e.quat;d[0]=c[4];
d[1]=c[5];d[2]=c[6];d[3]=c[7];break;case 14:c=b.P,d=t.vy(c),g=a.e.h,r=t.Zj(d,"TOP"),I=t.Zj(d,"BOTTOM"),e=r-I,b.tr?(q=t.Zj(d,"LEFT"),g[0]=q+e*b.gn):(q=t.Zj(d,"RIGHT"),g[0]=q-e*b.gn),g[2]=b.ft?-(r-e*b.oo):-(I+e*b.oo),t.iz(d)?g[1]=-b.distance:(g[1]=-1,x.normalize(g,g),x.scale(g,b.distance/Math.abs(g[1]),g)),f.transform_dir_vec3(g,c.e.Bb,g),x.add(c.e.h,g,g),d=a.e.quat,b.gc?(z.copy(b.gc,d),z.multiply(c.e.quat,d,d)):z.copy(c.e.quat,d)}"CAMERA"==a.e.type&&(g=l.AXIS_Y,10==b.type&&(c=b.P.e.quat,g=x.transformQuat(g,
c,L)),t.uo(a),k(a,g))}function h(a,b,c){var d=u;l.quat_to_dir(b,l.AXIS_MY,d);x.normalize(d,d);var f=y;x.subtract(c,a,f);x.normalize(f,f);a=l.vA(d,f,w);z.multiply(a,b,b);z.normalize(b,b)}function k(a,b){var c=a.e,d=c.quat,f=l.quat_to_dir(c.quat,l.AXIS_Y,u);x.normalize(f,f);if(.999999<Math.abs(x.dot(b,f)))f=z.identity(m);else{var g=x.cross(b,f,y);x.normalize(g,g);if(c.wa==t.MS_TARGET_CONTROLS)c.ko&&x.negate(g,g);else{var e=l.quat_to_dir(c.quat,l.AXIS_Z,q);0<x.dot(e,b)&&x.negate(g,g)}c=l.quat_to_dir(c.quat,
l.AXIS_X,q);x.normalize(c,c);var e=l.clamp(x.dot(c,g),-1,1),h=Math.acos(e),f=-.999999>=e?z.setAxisAngle(f,h,m):z.rotationTo(c,g,m);z.normalize(f,f)}z.multiply(f,d,d);t.uo(a)}function n(a,b,c,d,g){var e=a.e,h=e.Sf,l=e.Oc[b];b=l.mi;a=a.pose.bones[l.Fn];var l=a.Vo,q=w,k=e.Jc,u=e.Ic,n=e.Bc,t=e.Ac,F=k[4*b+1],L=k[4*b+2],x=k[4*b+3],y=u[4*b+1],H=u[4*b+2],M=u[4*b+3];q[0]=(1-h)*k[4*b]+h*u[4*b];q[1]=(1-h)*F+h*y;q[2]=(1-h)*L+h*H;q[3]=(1-h)*x+h*M;k=m;u=r;k[0]=n[4*b];k[1]=n[4*b+1];k[2]=n[4*b+2];k[3]=n[4*b+3];u[0]=
t[4*b];u[1]=t[4*b+1];u[2]=t[4*b+2];u[3]=t[4*b+3];z.slerp(k,u,h,k);h=E;f.set_transcale(q,h);f.set_quat(k,h);c?(c=I,f.translate(l,a.dv,c),f.multiply(h,c,h)):f.multiply(h,l,h);f.multiply(e.Bb,h,h);d[0]=h[0];d[1]=h[1];d[2]=h[2];d[3]=h[3];g&&(g[0]=h[4],g[1]=h[5],g[2]=h[6],g[3]=h[7])}var f=p("__tsr"),l=p("__util"),t=p("__camera"),x=p("vec3");p("vec4");var z=p("quat"),D=p("mat3");p("mat4");a.UC=1;a.TC=2;a.YC=3;a.ZC=4;a.OC=5;a.PC=6;a.VC=7;a.NC=8;a.SC=9;a.RC=10;a.Nd=11;a.QC=12;a.WC=13;a.XC=14;var A=new Float32Array(2),
H=new Float32Array(2),u=new Float32Array(3),y=new Float32Array(3),q=new Float32Array(3),w=new Float32Array(4),m=new Float32Array(4),r=new Float32Array(4),E=new Float32Array(16),I=new Float32Array(16),F=new Float32Array(9),M=new Float32Array(9),E=new Float32Array(8),L=new Float32Array(3);a.wl=function(a,b,f,e,h){var m=c(1);m.P=b;m.offset=new Float32Array(f);m.gc=e?new Float32Array(e):null;m.Ok=h;d(a,m);g(a,m,0)};a.bp=function(a,b,f,e,h,m){var l=c(2);l.P=b;l.Sv=f;l.offset=new Float32Array(e);l.gc=h?
new Float32Array(h):null;l.Ok=m;d(a,l);g(a,l,0)};a.ov=function(a,b,f,e){var h=c(9),m=a.e.quat,l=b.e.quat;h.P=b;h.offset=new Float32Array(f);h.sg=new Float32Array(l);e&&(z.copy(e,m),z.multiply(l,m,m));d(a,h);g(a,h,0)};a.nv=function(a,b,f,h,e,m,q,w){var k=c(10),r=a.e.quat,u=b.e.quat;k.P=b;k.offset=new Float32Array(f);k.sg=new Float32Array(u);k.nw=l.angle_wrap_0_2pi(e);k.ow=l.angle_wrap_0_2pi(m);k.pw=l.angle_wrap_periodic(q,-Math.PI,Math.PI);k.mw=l.angle_wrap_periodic(w,-Math.PI,Math.PI);h?(k.gc=new Float32Array(h),
z.copy(h,r),z.multiply(u,r,r)):k.gc=z.create();d(a,k);g(a,k,0)};a.mv=function(a,b,f,h){var e=c(12);e.P=b;e.offset=new Float32Array(f);e.fB=h;d(a,e);g(a,e,0)};a.qv=function(a,b,f,e){var h=c(13);h.P=b;h.offset=new Float32Array(f);h.Ok=1;h.gc=e?new Float32Array(e):null;d(a,h);g(a,h,0)};a.oD=b;a.UE=e;a.sv=function(a,b){var f=c(3);f.P=b;d(a,f);g(a,f,0)};a.tv=function(a,b){var f=c(4);f.target=new Float32Array(b);d(a,f);g(a,f,0)};a.jv=function(a,b,f,h){var e=c(5);e.P=b;e.oi=f;e.dist_max=h;d(a,e);g(a,e,0)};
a.kv=function(a,b,f,e){var h=c(6);h.target=new Float32Array(b);h.oi=f;h.dist_max=e;d(a,h);g(a,h,0)};a.pv=function(a,b,f){var h=c(7);h.P=b;h.offset=new Float32Array(f);d(a,h);g(a,h,0)};a.iv=function(a,b,f){var h=c(8);h.P=b;h.offset=new Float32Array(f);d(a,h);g(a,h,0)};a.hv=function(a,b,f){var h=c(11);h.P=b;h.ht=new Float32Array(f);d(a,h);g(a,h,0)};a.append_stiff_viewport=function(a,b,f){var h=c(14);h.P=b;if("left"in f)h.tr=!0,h.gn=f.left;else if("right"in f)h.tr=!1,h.gn=f.right;else{m_print.error("append_stiff_viewport: Wrong positioning params");
return}if("top"in f)h.ft=!0,h.oo=f.top;else if("bottom"in f)h.ft=!1,h.oo=f.bottom;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}"distance"in f?(h.distance=f.distance,h.gc="rotation"in f?new Float32Array(f.rotation):null,d(a,h),g(a,h,0)):m_print.error("append_stiff_viewport: Wrong positioning params")};a.aC=function(a,b){a.$a&&g(a,a.$a,b)};a.uA=h;a.correct_up=k;a.ew=function(a){return a.$a?!0:!1};a.remove=function(a){a.$a.P&&e(a.$a.P,a);a.$a=null};a.je=function(a){return a.$a?
a.$a.type:null};a.get_parent=function(a){return a.$a&&a.$a.P?a.$a.P:null};a.ie=function(a){return a.$a&&11==a.$a.type?a.$a.ht:null};a.ny=n};b4w.module.__container=function(a,p){var c,d,b,e,g;function h(a,b){c=a;d=b}function k(){var a=l.getBoundingClientRect();h(a.left,a.top)}var n=p("__print"),f=p("__util"),l=null,t=null,x=!1;e=b=0;g=1;c=d=0;a.get_canvas=function(){return l};a.get_container=function(){return t};a.init=function(a){a&&a.parentNode?(l=a,t=a.parentNode):f.fa("canvas container is not available")};a.insert_to_container=function(a,b){b=b||"LAST";switch(b){case "FIRST":t.insertBefore(a,t.firstElementChild);break;case "JUST_BEFORE_CANVAS":t.insertBefore(a,
l);break;case "JUST_AFTER_CANVAS":l.nextElementSibling?t.insertBefore(a,l.nextElementSibling):t.appendChild(a,l);break;case "LAST":t.appendChild(a,l);break;default:n.error(b+" invalid stack order")}};a.Ky=function(){return b};a.Jy=function(){return e};a.set_canvas_offsets=h;a.update_canvas_offsets=k;a.YA=function(a,c,d){b=a;e=c;g=d;k()};a.force_offsets_updating=function(){x=!0};a.client_to_canvas_coords=function(a,b,f){f||(f=new Float32Array(2));var h=f;x&&(k(),x=!1);h[0]=a-c;a=f;x&&(k(),x=!1);a[1]=
b-d;return f};a.Ql=function(a,c,d,f){d||(d=new Float32Array(2));d[0]=a*g;d[1]=c*g;f&&(a=f.width/b,d[0]*=a,d[1]*=a);return d};a.EC=function(a,c,d,f){d||(d=new Float32Array(2));d[0]=a/g;d[1]=c/g;f&&(a=f.width/b,d[0]/=a,d[1]/=a)};a.hr=function(b){return b&&b.parentNode?b.parentNode==t?!0:a.hr(b.parentNode):!1}};b4w.module.__controls=function(a,p){function c(a){return{type:a,value:0,ca:null,$c:!1,key:0,Qa:"",rd:!1,Wl:null,Vl:function(){},Ul:null,Gp:function(){},ve:null,O:new Float32Array(3),pa:new Float32Array(3),gr:!1,ek:!1,os:0,ns:function(){},axis:"",Hc:0,Nh:new Float32Array(3),Ik:new Float32Array(4),threshold:0,ks:new Float32Array(4),Cj:0,Bj:0,ws:0,Dj:0,Tc:0,repeat:!1,ip:!1,dk:0,ck:0,bk:0,Qm:0,Pm:0,Om:0}}function d(a,v){a.value=Number(v)}function b(a){for(var v=a.fd,b=a.EA,c=0;c<v.length;c++)b[c]=v[c].value;
return a.sz(b)}function e(a){a=B.indexOf(a);-1<a?B.splice(a,1):w.error("Wrong object")}function g(a,v){for(var b=0,c=0;c<v.length;c++)for(var d=v[c].Fe,f=0;f<d.length;f++)for(var B=d[f].fd,G=0;G<B.length;G++)B[G]===a&&b++;return b}function h(a,v){switch(a.type){case 80:m.remove_collision_test(a.Wl,a.Qa,a.Vl);a.$c=!0;break;case 90:m.clear_collision_impulse_test(a.Ul);a.$c=!0;break;case 100:m.remove_ray_test(a.os);a.$c=!0;break;case 130:a.$c=!0}var b=v.indexOf(a);-1<b&&v.splice(b,1)}function k(a){for(var v=
0;v<J.length;v++){var b=J[v];20==b.type&&a.keyCode==b.key&&d(b,1)}W&&a.preventDefault();aa&&aa(a)}function n(a){for(var v=0;v<J.length;v++){var b=J[v];20==b.type&&0==a.keyCode&&16==b.key&&d(b,0);20==b.type&&a.keyCode==b.key&&d(b,0)}W&&a.preventDefault();aa&&aa(a)}function f(a){var b=!1,c=null;la=!0;Q=a.clientX;X=a.clientY;R=a.clientX;T=a.clientY;for(var f=0;f<J.length;f++){var B=J[f];50==B.type&&(d(B,1),B.ca=a.which);160==B.type&&(b||(b=q.client_to_canvas_coords(a.clientX,a.clientY,ga),c=r.pick_object(b[0],
b[1]),b=!0),B.value=c==B.ve?1:0)}ba&&a.preventDefault();v&&v(a)}function l(a){for(var b=0;b<J.length;b++){var c=J[b];50==c.type&&d(c,0);160==c.type&&c.ip&&(c.value=0)}la=!1;ba&&!da&&a.preventDefault();v&&v(a)}function t(a){var b=a.clientX,c=a.clientY;R=b;T=c;if(!O.Vm||la)for(var f=b-Q,B=c-X,G=Math.sqrt(f*f+B*B),h=0;h<J.length;h++){var e=J[h];if(40===e.type)switch(e.axis){case "X":d(e,f);e.ca=b;break;case "Y":d(e,B);e.ca=c;break;case "XY":d(e,G),e.ca[0]=b,e.ca[1]=c}}ba&&!da&&a.preventDefault();v&&
v(a)}function x(a){q.hr(a.relatedTarget)||l(a)}function z(a){var v=a.wheelDelta||-40*a.detail,v=v*L.Ez;P+=v;for(v=0;v<J.length;v++){var b=J[v];30===b.type&&d(b,P)}ma&&a.preventDefault();G&&G(a)}function D(a){var v=a.targetTouches;if(1==v.length){for(var b=v[0],v=b.clientX,b=b.clientY,c=!1,d=null,f=0;f<J.length;f++){var B=J[f];160==B.type&&(c||(c=q.client_to_canvas_coords(v,b,ga),d=r.pick_object(c[0],c[1]),c=!0),B.value=d==B.ve)}S[0]=v;S[1]=-1;qa[0]=b;qa[1]=-1}else 1<v.length&&(Y=ea=u(v),S[0]=v[0].clientX,
S[1]=v[1].clientX,qa[0]=v[0].clientY,qa[1]=v[1].clientY);U.set(S);pa.set(qa);oa&&oa(a)}function A(v){var b=v.targetTouches;if(0!==b.length){if(1===b.length){U[0]=b[0].clientX;U[1]=-1;pa[0]=b[0].clientY;pa[1]=-1;var b=U[0]-S[0],c=pa[0]-qa[0],f=Math.sqrt(b*b+c*c);if(-1!=S[1]&&-1!=qa[1]){var B=U[0]-S[1],G=pa[0]-qa[1],h=Math.sqrt(B*B+G*G);h<f&&(b=B,c=G,f=h)}for(h=0;h<J.length;h++){var e=J[h];if(60===e.type)switch(e.ca=a.PL_SINGLE_TOUCH_MOVE,e.axis){case "X":d(e,b);break;case "Y":d(e,c);break;case "XY":d(e,
f)}}}else if(1<b.length){U[0]=b[0].clientX;U[1]=b[1].clientX;pa[0]=b[0].clientY;pa[1]=b[1].clientY;Y=u(b);f=Y-ea;B=ga;B[0]=(U[0]+U[1])/2;B[1]=(pa[0]+pa[1])/2;G=ha;G[0]=(S[0]+S[1])/2;G[1]=(qa[0]+qa[1])/2;var g,b=B[0],c=B[1],h=G[0],e=G[1];g=Math.sqrt((b-h)*(b-h)+(c-e)*(c-e));for(h=0;h<J.length;h++)if(e=J[h],70===e.type&&Math.abs(g)<Math.abs(f)&&(e.ca=a.PL_MULTITOUCH_MOVE_ZOOM,d(e,f)),60===e.type&&Math.abs(g)>Math.abs(f))switch(e.ca=a.PL_MULTITOUCH_MOVE_PAN,e.axis){case "X":b=B[0]-G[0];d(e,b);break;
case "Y":c=B[1]-G[1];d(e,c);break;case "XY":d(e,g)}}fa&&v.preventDefault();oa&&oa(v)}}function H(a){for(var v=0;v<J.length;v++){var b=J[v];if(170==b.type||180==b.type)b.ck=a.beta,b.dk=a.gamma,b.bk=a.alpha,b.value||(b.Qm=a.gamma,b.Pm=a.beta,b.Om=a.alpha,d(b,1))}}function u(a){var v=a[0],b=a[1];a=v.clientX;var v=v.clientY,c=b.clientX,b=b.clientY;return Math.sqrt((a-c)*(a-c)+(v-b)*(v-b))}var y=p("__config"),q=p("__container"),w=p("__print"),m=p("__physics"),r=p("__scenes"),E=p("__time"),I=p("__util"),
F=p("vec3"),M=p("quat"),L=y.controls,O=y.p,B=[],J=[],K={},P=0,R=0,T=0,Q=0,X=0,la=!1,U=new Float32Array(2),pa=new Float32Array(2),S=new Float32Array(2),qa=new Float32Array(2),ga=new Float32Array(2),ha=new Float32Array(2),Y=0,ea=0,Z=!1,C=0,W=!1,ba=!1,ma=!1,fa=!1,da=!1,aa=null,v=null,G=null,oa=null;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.CT_CHANGE=50;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.update=function(v,c){for(var f=0;f<J.length;f++){var G=
J[f],h=v,e=c;if(e)switch(G.type){case 110:var g=G.ve,m=g.e.h,g=g.e.quat,l=F.dist(G.Nh,m),q=G.ks;M.invert(G.Ik,q);M.multiply(g,q,q);M.normalize(q,q);q=Math.abs(2*Math.acos(q[3]));l/=e;G.Cj=I.smooth(l,G.Cj,e,.3);G.ca[0]=l;l=q/e;G.Bj=I.smooth(l,G.Bj,e,.3);G.ca[1]=l;G.Cj>=G.threshold||G.Bj>=G.ws?d(G,1):d(G,0);F.copy(m,G.Nh);M.copy(g,G.Ik);G.Hc=h;break;case 120:g=G.ve;m=g.e.h;g=Math.abs(m[1]-G.Nh[1])/e;G.Dj=I.smooth(g,G.Dj,e,.3);G.ca=g;G.Dj>=G.threshold?d(G,1):d(G,0);F.copy(m,G.Nh);G.Hc=h;break;case 130:!G.$c&&
0<=G.Tc&&h-G.Hc>=G.Tc&&(d(G,1),G.repeat?G.Hc=h:G.Tc=-G.Tc);break;case 140:G.Hc||(G.Hc=h);d(G,h-G.Hc);G.Hc=h;break;case 150:d(G,h);break;case 170:G.ca[0]=Math.PI*(G.dk-G.Qm)/180;G.ca[1]=Math.PI*(G.ck-G.Pm)/180;G.ca[2]=Math.PI*(G.bk-G.Om)/180;G.Qm=G.dk;G.Pm=G.ck;G.Om=G.bk;break;case 180:G.ca[0]=Math.PI*G.dk/180,G.ca[1]=Math.PI*G.ck/180,G.ca[2]=Math.PI*G.bk/180}}for(f=0;f<B.length;f++)for(e=B[f],G=e.Fe,h=0;h<G.length;h++)if(m=G[h],m.jt!=C){m.jt=C;q=m;g=0;switch(q.type){case a.CT_CONTINUOUS:g=q.me;(l=
b(q))?(g=1,q.me=1):1==g?(g=-1,q.me=-1):g=0;break;case a.CT_TRIGGER:g=q.me;(l=b(q))&&-1==g?(g=1,q.me=1):l||1!=g?g=0:(g=-1,q.me=-1);break;case a.CT_SHOT:g=q.me;(l=b(q))&&-1==g?(g=1,q.me=1):l||1!=g?g=0:(g=0,q.me=-1);break;case a.CT_LEVEL:l=b(q);q.qr!=l?(g=1,q.qr=l):g=0;break;case a.CT_CHANGE:for(var l=q.fd,q=q.nz,w=0;w<l.length;w++){var k=l[w].value;g||k==q[w]||(g=1);q[w]=k}break;default:I.fa("Wrong sensor manifold type: "+q.type)}if(g&&(l=e==K?null:e,Z=!1,m.callback(l,m.id,g,m.Vv),Z)){f=-1;break}}for(f=
0;f<B.length;f++)for(e=B[f],G=e.Fe,h=0;h<G.length;h++)for(m=G[h],e=m.fd,m=0;m<e.length;m++)switch(g=e[m],g.type){case 30:d(g,0);break;case 40:d(g,0);break;case 60:d(g,0);break;case 70:d(g,0);break;case 130:d(g,0)}P=0;Q=R;X=T;S.set(U);qa.set(pa);ea=Y;C++};a.create_custom_sensor=function(a){var v=c(10);d(v,a);return v};a.create_keyboard_sensor=function(a){var v=c(20);v.key=a;return v};a.create_collision_sensor=function(a,v,b){if(!a||!m.has_physics(a))return w.error("Wrong collision object"),null;var G=
c(80);G.Wl=a;G.Qa=v;G.rd=b;G.ca={coll_obj:null,coll_pos:b?new Float32Array(3):null,coll_norm:b?new Float32Array(3):null,coll_dist:0};G.Vl=function(a,v,b,c,f){d(G,a);a=G.ca;a.coll_obj=v;G.rd&&(a.coll_pos.set(b),a.coll_norm.set(c),a.coll_dist=f)};G.$c=!0;return G};a.create_collision_impulse_sensor=function(a){if(!a||!a.n)return w.error("Wrong collision impulse object"),null;var v=c(90);v.Ul=a;v.Gp=function(a){d(v,a)};v.$c=!0;return v};a.create_ray_sensor=function(a,v,b,G,f,B,h){var e=c(100);e.ve=a;
e.O=v;e.pa=b;e.Qa=G;e.gr=f;e.rd=B;e.ek=h;e.ca={hit_fract:0,obj_hit:null,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3)};e.ns=function(a,v,b,c,G,f){e.gr?d(e,-1==v?0:1):d(e,v);e.ca.hit_fract=v;e.ca.obj_hit=b;e.ca.hit_time=c;e.rd&&(e.ca.hit_pos.set(G),e.ca.hit_norm.set(f))};e.$c=!0;return e};a.create_mouse_click_sensor=function(){return c(50)};a.create_mouse_wheel_sensor=function(){return c(30)};a.create_mouse_move_sensor=function(a){var v=c(40);v.axis=a||"XY";v.ca="XY"==v.axis?
new Float32Array(2):0;return v};a.create_touch_move_sensor=function(a){var v=c(60);v.axis=a||"XY";v.ca=0;return v};a.create_touch_zoom_sensor=function(){var a=c(70);a.ca=0;return a};a.create_motion_sensor=function(a,v,b){if(!a)return w.error("Wrong collision object"),null;var d=c(110);d.ve=a;var G=a.e.h;a=a.e.quat;d.ks=new Float32Array(4);d.Nh=new Float32Array(G);d.Ik=new Float32Array(a);d.Cj=0;d.Bj=0;d.threshold=v||.1;d.ws=b||.1;d.Hc=0;d.ca=new Float32Array([0,0]);return d};a.create_vertical_velocity_sensor=
function(a,v){if(!a)return w.error("Wrong collision object"),null;var b=c(120);b.ve=a;var d=a.e.quat;b.Nh=new Float32Array(a.e.h);b.Ik=new Float32Array(d);b.Dj=0;b.threshold=v||1;b.Hc=0;b.ca=0;return b};a.create_timer_sensor=function(a,v){var b=c(130);b.Tc=a;b.repeat=v;b.$c=!0;return b};a.reset_timer_sensor=function(a,v,b,c){a=a||K;a=a.Wc;if(!a||!a[v])return w.error("reset_timer_sensor(): wrong object"),null;v=a[v].fd[b];if(!v)return w.error("reset_timer_sensor(): sensor not found"),null;v.Hc=E.get_timeline();
v.Tc=c};a.create_elapsed_sensor=function(){var a=c(140);a.Hc=0;return a};a.create_gyro_delta_sensor=function(){var a=c(170);a.ca=new Float32Array(3);return a};a.create_gyro_angles_sensor=function(){var a=c(180);a.ca=new Float32Array(3);return a};a.create_timeline_sensor=function(){return c(150)};a.create_selection_sensor=function(a,v){var b=c(160);b.ve=a;b.ip=v;return b};a.DA=d;a.get_sensor_value=function(a,v,b){a=a||K;a=a.Wc;if(!a||!a[v])return w.error("get_sensor_value(): wrong object"),null;v=
a[v].fd[b];return v?v.value:(w.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=function(a,v,b){a=a||K;a=a.Wc;if(!a||!a[v])return w.error("get_sensor_payload(): wrong object"),null;v=a[v].fd[b];return v?v.ca:(w.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){B=[];J=[];K={}};a.check_sensor_manifold=function(a,v){a=a||K;if(!a.Wc)return!1;if(v&&a.Wc[v])return!0;if(!v)for(var b in a.Wc)return!0;return!1};a.remove_sensor_manifold=function(a,v){a=a||
K;var b=a.Wc;if(b){var c=a.Fe;if(v){var d=b[v];if(d){for(var G=d.fd,f=0;f<G.length;f++)1===g(G[f],B)&&h(G[f],J);delete b[v];d=c.indexOf(d);-1<d?c.splice(d,1):I.fa("Incorrect manifolds array");Object.getOwnPropertyNames(b).length||e(a)}}else{for(v in b){d=b[v];G=d.fd;for(f=0;f<G.length;f++)1===g(G[f],B)&&h(G[f],J);delete b[v];d=c.indexOf(d);-1<d?c.splice(d,1):I.fa("Incorrect manifolds array")}e(a);Z=!0}}};a.create_sensor_manifold=function(a,v,b,c,d,G,f){a=a||K;a.Wc=a.Wc||{};a.Fe=a.Fe||[];var e=a.Wc,
l=a.Fe,q=e[v];if(q){c=q.fd;for(var w=0;w<c.length;w++)1===g(c[w],B)&&h(c[w],J);q=l.indexOf(q);-1<q?l.splice(q,1):I.fa("Incorrect manifolds array")}b={id:v,type:b,fd:c.slice(0),sz:d,EA:Array(c.length),callback:G,Vv:f,me:-1,qr:0,nz:Array(c.length),jt:-1};e[v]=b;l.push(b);-1==B.indexOf(a)&&B.push(a);a=b.fd;for(v=0;v<a.length;v++){e=a[v];if(e.$c){switch(e.type){case 80:m.append_collision_test(e.Wl,e.Qa,e.Vl,e.rd);break;case 90:m.apply_collision_impulse_test(e.Ul,e.Gp);break;case 100:e.os=m.append_ray_test(e.ve,
e.O,e.pa,e.Qa,e.ns,!1,!1,e.rd,e.ek);break;case 130:e.Hc=E.get_timeline(),0>e.Tc&&(e.Tc=-e.Tc)}e.$c=!1}-1==J.indexOf(e)&&J.push(e)}Z=!0};a.$p=function(a){for(var v=0;v<a.length;v++)if(!a[v])return a[v];return a[a.length-1]};a.lx=function(a){for(var v=0;v<a.length;v++)if(a[v])return a[v];return a[a.length-1]};a.reset=function(){for(var a=0;a<B.length;a++){var v=B[a],b=v.Wc,v=v.Fe,c;for(c in b)delete b[c];v.splice(0,v.length)}for(a=0;a<J.length;a++)h(J[a],J),a--;B.splice(0,B.length)};a.debug=function(){w.log(String(B.length)+
" objects with manifolds",B);w.log(String(J.length)+" sensors",J);for(var a=[],v=[],b=0;b<J.length;b++){var c=J[b];80==c.type&&a.push(c);100==c.type&&v.push(c)}w.log(String(a.length)+" collision sensors",a);w.log(String(v.length)+" ray sensors",v)};a.register_keyboard_events=function(a,v){a.addEventListener("keydown",k,!1);a.addEventListener("keyup",n,!1);W=v};a.register_mouse_events=function(a,v,b){if(b)var c=window;else c=a,c.addEventListener("mouseout",x,!1);a.addEventListener("mousedown",f,!1);
c.addEventListener("mousemove",t,!1);c.addEventListener("mouseup",l,!1);ba=v;da=b};a.register_wheel_events=function(a,v){a.addEventListener("mousewheel",z,!1);a.addEventListener("DOMMouseScroll",z,!1);ma=v};a.register_touch_events=function(a,v){a.addEventListener("touchstart",D,!1);a.addEventListener("touchmove",A,!1);document.addEventListener("touchstart",function(){});fa=v};a.register_device_orientation=function(){window.DeviceOrientationEvent&&O.gyro_use&&window.addEventListener("deviceorientation",
H,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",k,!1);a.removeEventListener("keyup",n,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",f,!1);a.removeEventListener("mousemove",t,!1);a.removeEventListener("mouseout",x,!1);a.removeEventListener("mouseup",l,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",z,!1);a.removeEventListener("DOMMouseScroll",z,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",
D,!1);a.removeEventListener("touchmove",A,!1);document.removeEventListener("touchstart",function(){})};a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&O.gyro_use&&window.removeEventListener("deviceorientation",H,!1)};a.mD=function(a){aa=a};a.nD=function(a){v=a};a.qD=function(a){G=a};a.pD=function(a){oa=a}};b4w.module.__curve=function(a,p){function c(a,b,c,d,f){var e=d.length;f||(f=new Float32Array(e));for(var t=e+a,x=new Float32Array(t),z=1;z<=t-1;z++)x[z-1]=b>=c[z-1]&&b<c[z+1-1]?1:0;for(var D=2;D<=a;D++)for(z=1;z<=t-D;z++)x[z-1]=(0!=x[z-1]?(b-c[z-1])*x[z-1]/(c[z+D-1-1]-c[z-1]):0)+(0!=x[z+1-1]?(c[z+D-1]-b)*x[z+1-1]/(c[z+D-1]-c[z+1-1]):0);b==c[t-1]&&(x[e-1]=1);a=0;for(z=1;z<=e;z++)a+=x[z-1]*d[z-1];for(z=1;z<=e;z++)f[z-1]=0!=a?x[z-1]*d[z-1]/a:0;return f}function d(a){a=a.nk;return a[a.length-1]}function b(a){a=
a.Wp;return a[a.length-1]}var e=p("__util");a.Xw=function(a){var b={},d=a.data;a=d.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var e=a.order_u;b.af=e;a=a.points;var f=a.length/5,l=[],t=f+e,f=f+2;l[0]=0;for(var x=2;x<=t;x++)l[x-1]=x>e&&x<f?l[x-2]+1:l[x-2];b.nk=l;if("2D"==d.dimensions)b.Xe=!1;else if("3D"==d.dimensions)b.Xe=!0;else throw"Wrong curve dimensions";e=[];l=[];for(d=0;d<a.length;d+=5)e.push(a[d]),e.push(a[d+1]),e.push(a[d+2]),b.Xe&&e.push(a[d+3]),l.push(a[d+4]);b.$l=
e;b.Fo=l;a=[];for(var d=b.$l,e=b.Xe?4:3,l=b.Fo,t=b.nk,f=b.af,x=d.length/e,z=x+f,D=0,A=t[z-1]/999,H=0;1E3>H;H++){5E-6>t[z-1]-D&&(D=t[z-1]);for(var u=c(f,D,t,l),y=0;y<e;y++)for(var q=a[e*H+y]=0;q<x;q++)a[e*H+y]+=u[q]*d[e*q+y];D+=A}e=b.Xe?4:3;l=new Float32Array(1E3);l[0]=0;for(d=1;1E3>d;d+=1)t=a[(d-1)*e],f=a[(d-1)*e+1],x=a[(d-1)*e+2],z=a[d*e],D=a[d*e+1],A=a[d*e+2],l[d]=l[d-1]+Math.sqrt((z-t)*(z-t)+(D-f)*(D-f)+(A-x)*(A-x));b.Wp=l;return b};a.sB=function(a,b,e){e||(e=[]);var n=b,f=Math.max(n,0);b=f=Math.min(n,
d(a));var n=a.$l,f=a.Xe?4:3,l=a.Fo,t=a.nk,x=a.af;a=n.length/f;var z=a+x;5E-6>t[z-1]-b&&(b=t[z-1]);z=new Float32Array(a);c(x,b,t,l,z);for(b=0;b<f;b++)for(l=e[b]=0;l<a;l++)e[b]+=z[l]*n[f*l+b]};a.pB=function(a,b,c){c||(c=[]);var d=a.$l,f=a.Xe?4:3,e=a.Fo,t=a.nk,x=a.af;a=d.length/f;var z=a+x;5E-6>t[z-1]-b&&(b=t[z-1]);var z=new Float32Array(a),D=b;b=z;var A=e.length;b||(b=new Float32Array(A));var H=new Float32Array(A),u=new Float32Array(A),y=H,q=u;y||(y=new Float32Array(A));q||(q=new Float32Array(A));for(var w=
A+x,m=new Float32Array(w),r=new Float32Array(w),E=1;E<=w-1;E++)m[E-1]=D>=t[E-1]&&D<t[E+1-1]?1:0;D==t[w-1]&&(m[A-1]=1);for(var I=2;I<=x;I++)for(E=1;E<=w-I;E++){var F=0!=m[E-1]?m[E-1]/(t[E+I-1-1]-t[E-1]):0,M=0!=m[E+1-1]?-m[E+1-1]/(t[E+I-1]-t[E+1-1]):0,L=0!=r[E-1]?(D-t[E-1])*r[E-1]/(t[E+I-1-1]-t[E-1]):0,O=0!=r[E+1-1]?(t[E+I-1]-D)*r[E+1-1]/(t[E+I-1]-t[E+1-1]):0;m[E-1]=(0!=m[E-1]?(D-t[E-1])*m[E-1]/(t[E+I-1-1]-t[E-1]):0)+(0!=m[E+1-1]?(t[E+I-1]-D)*m[E+1-1]/(t[E+I-1]-t[E+1-1]):0);r[E-1]=F+M+L+O}for(E=1;E<=
A;E++)y[E-1]=m[E-1],q[E-1]=r[E-1];t=0;for(x=1;x<=A;x++)t+=H[x-1]*e[x-1];D=0;for(x=1;x<=A;x++)D+=u[x-1]*e[x-1];for(x=1;x<=A;x++)b[x-1]=0!=t?u[x-1]*e[x-1]/t+H[x-1]*e[x-1]*D/(t*t):0;for(e=0;e<f;e++)for(t=c[e]=0;t<a;t++)c[e]+=z[t]*d[f*t+e]};a.cF=d;a.rB=b;a.qB=function(a,c){if(0>=c)return 0;var k=d(a);if(c>=b(a))return k;var n=a.Wp,f=e.Fj(n,c,0,n.length-1);return k*(f+(c-n[f])/(n[f+1]-n[f]))/1E3}};b4w.module.__dds=function(a,p){function c(a,b,c,d){var e=new Uint16Array(4),f=new Uint16Array(c*d),h=0,g=0,k=0,q=g=h=0,w=0,m=0,r=0,n=c/4;d/=4;for(var I=0;I<d;I++)for(var F=0;F<n;F++)k=b+4*(I*n+F),e[0]=a[k],e[1]=a[k+1],h=e[0]&31,g=e[0]&2016,q=e[0]&63488,w=e[1]&31,m=e[1]&2016,r=e[1]&63488,e[2]=5*h+3*w>>3|5*g+3*m>>3&2016|5*q+3*r>>3&63488,e[3]=5*w+3*h>>3|5*m+3*g>>3&2016|5*r+3*q>>3&63488,h=a[k+2],g=4*I*c+4*F,f[g]=e[h&3],f[g+1]=e[h>>2&3],f[g+2]=e[h>>4&3],f[g+3]=e[h>>6&3],g+=c,f[g]=e[h>>8&3],f[g+1]=e[h>>
10&3],f[g+2]=e[h>>12&3],f[g+3]=e[h>>14],h=a[k+3],g+=c,f[g]=e[h&3],f[g+1]=e[h>>2&3],f[g+2]=e[h>>4&3],f[g+3]=e[h>>6&3],g+=c,f[g]=e[h>>8&3],f[g+1]=e[h>>10&3],f[g+2]=e[h>>12&3],f[g+3]=e[h>>14];return f}function d(a,b,d,e){var D=new Int32Array(d,0,31),A,H,u,y,q,w;if(542327876!=D[0])return h.error("Invalid magic number in DDS header"),0;if(!D[20]&4)return h.error("Unsupported format, must contain a FourCC code"),0;A=D[21];switch(A){case k:H=8;u=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case n:H=16;u=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case f:H=16;u=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return h.error("Unsupported FourCC code:",g(A)),null}w=1;D[2]&131072&&!1!==e&&(w=Math.max(1,D[7]));y=D[4];q=D[3];D=D[1]+4;if(b)for(A=0;A<w;++A)e=Math.max(4,y)/4*Math.max(4,q)/4*H,b=new Uint8Array(d,D,e),a.compressedTexImage2D(a.TEXTURE_2D,A,u,y,q,0,b),D+=e,y=Math.max(.5*y,1),q=Math.max(.5*q,1);else if(A==k)Math.max(4,y),Math.max(4,q),b=new Uint16Array(d),d=c(b,D/2,y,q),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,y,q,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,d),e&&a.generateMipmap(a.TEXTURE_2D);else return h.error("No manual decoder for",g(A),"and no native support"),0;return w}function b(a,b,c,e,f,h){var g=new XMLHttpRequest;g.open("GET",c,!0);g.responseType="arraybuffer";g.onload=function(){if(200==g.status){a.bindTexture(a.TEXTURE_2D,e);var c=d(a,b,g.response,f);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<c?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}h&&
h(e)};g.send(null);return e}function e(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function g(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var h=p("__print"),k=e("DXT1"),n=e("DXT3"),f=e("DXT5");a.ND=c;a.nC=d;a.Nq=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.qy=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case k:b=6;break;case n:case f:b=4;break;default:h.error("Unsupported FourCC code:",g(a))}return b};
a.IE=b;a.HE=function(a,c,d,e){var f=a.createTexture();b(a,c,d,f,!0,e);return f}};b4w.module.__debug=function(a,p){function c(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function d(a,b){typeof a!=typeof b&&h.fa("Structure assertion failed: incompatible types");for(var c in a)c in b||h.fa("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||h.fa("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&h.fa("Structure assertion failed: incompatible types for key "+c)}var b=
p("__extensions"),e=p("__print"),g=p("__textures"),h=p("__util"),k=null,n={},f=!1,l={},t=[],x=-1,z=null,D=!1;a.Qo={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.gd=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(n[a[d]]=d)}k=a};a.gw=function(a){if(f){var b=k.getError();b!=k.NO_ERROR&&(b in n?h.fa("GL Error: "+b+", gl."+n[b]+" ("+
a+")"):h.fa("Unknown GL error: "+b+" ("+a+")"))}};a.cw=function(){if(f)switch(k.checkFramebufferStatus(k.FRAMEBUFFER)){case k.FRAMEBUFFER_COMPLETE:break;case k.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case k.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case k.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case k.FRAMEBUFFER_UNSUPPORTED:e.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:e.error("FRAMEBUFFER CHECK FAILED")}};a.Ap=function(){if(-1!=x)return x;k.bindFramebuffer(k.FRAMEBUFFER,k.createFramebuffer());var a=g.Pj("DEBUG",g.Wh);g.resize(a,1,1);k.framebufferTexture2D(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,a.Ob,a.Za,0);k.checkFramebufferStatus(k.FRAMEBUFFER)!=k.FRAMEBUFFER_COMPLETE?(x=!0,e.warn("depth-only issue was found")):x=!1;k.bindFramebuffer(k.FRAMEBUFFER,null);return x};
a.hw=function(a,b,d){if(f&&!k.getShaderParameter(a,k.COMPILE_STATUS))throw d=c(d),e.error("shader compilation failed:\n"+d+"\n"+k.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.iw=function(a,d,h,g,w,m){if(f&&!k.getProgramParameter(a,k.LINK_STATUS)){var l=b.Eq();l&&(w=l.getTranslatedShaderSource(h),m=l.getTranslatedShaderSource(g));w=c(w);m=c(m);e.error("shader linking failed:\n"+w+"\n\n\n"+m+"\n"+k.getProgramInfoLog(a)+" ("+d+")");throw"Engine failed: see above for error messages";
}};a.set_check_gl_errors=function(a){f=a};a.OD=function(a){l[a]=a in l?l[a]+1:1};a.update=function(){for(var a in l)e.log(a,l[a]),l[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(h.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}t.push(a)};a.msg=function(){for(var a=1,b=0;b<t.length;b++){var c=t[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],h.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);
else c.push(arguments[b]);t.push(c)};var A=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},d=Math.max(0,performance.now()-1E3*a),f=0;f<t.length;f++){var h=t[f];a=h[0];if(!(a<d)){var g=String(h[1]);c[g]||(c[g]=A[b++%A.length]);a=["%c"+(a/1E3).toFixed(6),c[g],g];for(g=2;g<h.length;g++)a.push(h[g]);e.log.apply(this,a)}}t.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-
1E3*a),d=0;d<t.length;d++){var f=t[d];a=f[0];if(!(a<c))for(var h=2;h<f.length;h++){var g=String(f[1]);3<f.length&&(g+="_"+String(h-2));b[g]||(b[g]=g+"\n");b[g]+=String(a)+" "+f[h]+"\n"}}a="";for(g in b)a+=b[g]+"\n\n";e.log(a);t.splice(0)};a.xD=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&b("firefox");case "msie":return b("mozilla")&&
b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(h.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.jD=function(a,b){a.constructor!=b&&h.fa("Type assertion failed: value <"+a+"> has type <"+a.constructor+">, required <"+b+">")};a.kD=d;a.lD=function(a){D?d(a,z):D=!0;z=a}};b4w.module.__extensions=function(a,p){function c(a){if(a in e)return e[a];var c=b.getExtension(a)||null;e[a]=c;d.log("%cGET EXTENSION","color: #"+(c?"0a0":"a00"),a);return c}var d=p("__print"),b=null,e={};a.gd=function(a){b=a};a.Kq=function(){return c("WEBGL_compressed_texture_s3tc")||c("WEBKIT_WEBGL_compressed_texture_s3tc")||c("MOZ_WEBGL_compressed_texture_s3tc")};a.sy=function(){return c("WEBGL_depth_texture")||c("WEBKIT_WEBGL_depth_texture")||c("MOZ_WEBGL_depth_texture")};a.ky=function(){return c("EXT_texture_filter_anisotropic")||
c("WEBKIT_EXT_texture_filter_anisotropic")||c("MOZ_EXT_texture_filter_anisotropic")};a.Eq=function(){return c("WEBGL_debug_shaders")};a.Jq=function(){return c("WEBGL_debug_renderer_info")};a.Fq=function(){return c("OES_element_index_uint")};a.Fy=function(){return c("OES_standard_derivatives")};a.cleanup=function(){e={}}};b4w.module.__graph=function(a,p){function c(a,b,c){c||(c=null);if(d(a,b))throw"Graph already has node with given ID";a.N.push(b,c)}function d(a,b){for(var c=a.N,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function b(a,b,c,e){e||(e=null);if(d(a,b)&&d(a,c))a.U.push(b,c,e);else throw"Wrong node IDs";}function e(a,b){if(!d(a,b))throw"Node not found";for(var c=a.N,e=0;e<c.length;e+=2)c[e]==b&&(c.splice(e,2),e-=2)}function g(a,b,c,d){if(!E(a,b,c))throw"Edge not found";a=a.U;for(var e=0,f=0;f<a.length;f+=
3)if(a[f]==b&&a[f+1]==c){if(-1==d)a.splice(f,3);else{if(d==e){a.splice(f,3);break}e++}f-=3}}function h(a){a=a.N;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}function k(a,b){for(var c=a.N,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function n(a){var b=[],c={};f(a,c);for(var d=a.N,e=0;e<d.length;e+=2)0==w(a,d[e])&&l(a,d[e],c,b);return{N:b,U:a.U.slice(0)}}function f(a,b){for(var c=a.N,d=0;d<c.length;d+=2)b[c[d]]=!1}function l(a,b,c,d){if(!c[b]){c[b]=!0;for(var e=0;e<q(a,b);e++)l(a,
m(a,b,e),c,d);d.unshift(b,y(a,b))}}function t(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var e=0;e<q(a,b);e++){var f=m(a,b,e);t(a,f,c,d)}if(20==d||30==d)for(e=0;e<w(a,b);e++)f=r(a,b,e),t(a,f,c,d)}}function x(a){for(var b=[],c=a.N,d=0;d<c.length;d+=2){var e=c[d];q(a,e)||b.push(e)}return b}function z(a){var b=a.N;a=a.U;for(var c=[],d=[],e=[],f=0;f<b.length;f++)e[b[2*f]]=f,c.push(f,b[2*f+1]);for(f=0;f<a.length;f+=3)d.push(e[a[f]],e[a[f+1]],a[f+2]);return{N:c,U:d}}function D(a,b,c){if(c.sd==c.$e){for(var d=
0,e=0;d<c.$e;d++)-1!=c.Zd[d]&&(a[e]=d,b[e]=c.Zd[d],e++);return!0}if(c.$e>c.rh||c.nf>c.of||c.Kh>c.Mh||c.Jh>c.Lh)return!1;for(var e=d=-1,f=!1;!f&&A(c,O,d,e);)if(d=O[0],e=O[1],H(c,d,e)){var h;h=c;f={};f.xi=h.xi;f.yi=h.yi;f.xn=h.xn;f.Vj=h.Vj;f.$e=h.$e;f.rh=h.rh;f.af=h.af;f.sd=f.vk=h.sd;f.Jh=h.Jh;f.Kh=h.Kh;f.nf=h.nf;f.Lh=h.Lh;f.Mh=h.Mh;f.of=h.of;f.$h=-1;f.Zd=h.Zd;f.Mf=h.Mf;f.Yf=h.Yf;f.Zf=h.Zf;f.og=h.og;f.pg=h.pg;f.Rk=h.Rk;h.Rk[0]+=1;var f=h=f,g=d,l=e,k=f.xi,n=f.yi,t=f.$e,F=f.rh,L=f.Zd,x=f.Mf,E=f.Yf,y=
f.Zf,z=f.og,C=f.pg;u(g<t);u(l<F);u(f.sd<t);u(f.sd<F);t=++f.sd;f.$h=g;E[g]||(E[g]=t,f.Jh++,z[g]&&f.nf++);z[g]||(z[g]=t,f.Kh++,E[g]&&f.nf++);y[l]||(y[l]=t,f.Lh++,C[l]&&f.of++);C[l]||(C[l]=t,f.Mh++,y[l]&&f.of++);L[g]=l;x[l]=g;for(L=0;L<w(k,g);L++)x=r(k,g,L),E[x]||(E[x]=t,f.Jh++,z[x]&&f.nf++);for(L=0;L<q(k,g);L++)x=m(k,g,L),z[x]||(z[x]=t,f.Kh++,E[x]&&f.nf++);for(L=0;L<w(n,l);L++)x=r(n,l,L),y[x]||(y[x]=t,f.Lh++,C[x]&&f.of++);for(L=0;L<q(n,l);L++)x=m(n,l,L),C[x]||(C[x]=t,f.Mh++,y[x]&&f.of++);f=D(a,b,h);
u(1>=h.sd-h.vk);u(-1!=h.$h);x=h.xi;g=h.yi;l=h.sd;k=h.$h;n=h.Zd;E=h.Mf;t=h.Yf;y=h.Zf;F=h.og;z=h.pg;if(h.vk<l){t[k]==l&&(t[k]=0);for(C=0;C<w(x,k);C++)L=r(x,k,C),t[L]==l&&(t[L]=0);F[k]==l&&(F[k]=0);for(C=0;C<q(x,k);C++)L=m(x,k,C),F[L]==l&&(F[L]=0);x=n[k];y[x]==l&&(y[x]=0);for(C=0;C<w(g,x);C++)L=r(g,x,C),y[L]==l&&(y[L]=0);z[x]==l&&(z[x]=0);for(C=0;C<q(g,x);C++)L=m(g,x,C),z[L]==l&&(z[L]=0);n[k]=-1;E[x]=-1;h.sd=h.vk;h.$h=-1}}return f}function A(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var f=a.nf,e=a.of,h=a.Kh,
g=a.Mh,m=a.Jh,q=a.Lh,l=a.sd,w=a.$e,k=a.rh,r=a.Zd,n=a.Mf,t=a.Yf,L=a.Zf,F=a.og,C=a.pg;if(f>l&&e>l)for(;c<w&&(-1!=r[c]||0==F[c]||0==t[c]);)c++,d=0;else if(h>l&&g>l)for(;c<w&&(-1!=r[c]||0==F[c]);)c++,d=0;else if(m>l&&q>l)for(;c<w&&(-1!=r[c]||0==t[c]);)c++,d=0;else if(0==c&&0!=a.af){for(t=0;t<w&&-1!=r[c=a.af[t]];)t++;t==w&&(c=w)}else for(;c<w&&-1!=r[c];)c++,d=0;if(f>l&&e>l)for(;d<k&&(-1!=n[d]||0==C[d]||0==L[d]);)d++;else if(h>l&&g>l)for(;d<k&&(-1!=n[d]||0==C[d]);)d++;else if(m>l&&q>l)for(;d<k&&(-1!=n[d]||
0==L[d]);)d++;else for(;d<k&&-1!=n[d];)d++;return c<w&&d<k?(b[0]=c,b[1]=d,!0):!1}function H(a,b,c){var d=a.xi,f=a.yi,e=a.rh,h=a.Zd,g=a.Mf,l=a.Yf,k=a.Zf,t=a.og,n=a.pg;u(b<a.$e);u(c<e);u(-1==h[b]);u(-1==g[c]);if(!(0,a.xn)(y(d,b),y(f,c)))return!1;for(var L=e=0,F=0,x=0,z=0,O=0,M=0;M<q(d,b);M++){var C=m(d,b,M);if(-1!=h[C]){var W=h[C];if(!E(f,c,W)||!I(a.Vj,d,b,C,f,c,W))return!1}else l[C]&&F++,t[C]&&e++,l[C]||t[C]||z++}for(M=0;M<w(d,b);M++)if(C=r(d,b,M),-1!=h[C]){if(W=h[C],!E(f,W,c)||!I(a.Vj,d,C,b,f,W,c))return!1}else l[C]&&
F++,t[C]&&e++,l[C]||t[C]||z++;for(M=0;M<q(f,c);M++)if(W=m(f,c,M),-1!=g[W]){if(C=g[W],!E(d,b,C))return!1}else k[W]&&x++,n[W]&&L++,k[W]||n[W]||O++;for(M=0;M<w(f,c);M++)if(W=r(f,c,M),-1!=g[W]){if(C=g[W],!E(d,C,b))return!1}else k[W]&&x++,n[W]&&L++,k[W]||n[W]||O++;return F<=x&&e<=L&&z<=O}function u(a){if(!a)throw"Assertion failed";}function y(a,b){for(var c=a.N,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function q(a,b){for(var c=a.U,d=0,f=0;f<c.length;f+=3)c[f]==b&&d++;return d}function w(a,
b){for(var c=a.U,d=0,f=0;f<c.length;f+=3)c[f+1]==b&&d++;return d}function m(a,b,c){a=a.U;for(var d=0,f=0;f<a.length;f+=3)if(a[f]==b){if(d==c)return a[f+1];d++}return-1}function r(a,b,c){a=a.U;for(var d=0,f=0;f<a.length;f+=3)if(a[f+1]==b){if(d==c)return a[f];d++}return-1}function E(a,b,c){a=a.U;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function I(a,b,c,d,f,e,h){for(var g=F(b,c,d),m=F(f,e,h),l=0;l<g;l++){for(var q=!1,w=0;w<m;w++)if(a(M(b,c,d,l),M(f,e,h,w))){q=!0;break}if(!q)return!1}return!0}
function F(a,b,c){var d=0;a=a.U;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&d++;return d}function M(a,b,c,d){a=a.U;for(var f=0,e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==c){if(f==d)return a[e+2];f++}return null}var L=p("__util"),O=[-1,-1];a.Mo=-1;a.aD=10;a.il=20;a.dD=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var f=a[d];switch(f.length){case 2:b.push(f[0],f[1]);break;case 3:c.push(f[0],f[1],f[2]);break;default:throw"Wrong graph constructor params";}}return{N:b,U:c}};
a.clone=function(a,b,c){if(b)for(var d=Array(a.N.length),f=0;f<a.N.length;f+=2)d[f]=a.N[f],d[f+1]=b(a.N[f+1]);else d=L.ka(a.N);if(c)for(b=Array(a.U.length),f=0;f<a.U.length;f+=3)b[f]=a.U[f],b[f+1]=a.U[f+1],b[f+2]=c(a.U[f+2]);else b=L.ka(a.U);return a={N:d,U:b}};a.ED=function(a,b){for(var c=[],d=[],f=0;f<a.length;f++)c.push(a[f][0],a[f][1]);for(f=0;f<b.length;f++)d.push(b[f][0],b[f][1],b[f][2]);return{N:c,U:d}};a.Aj=c;a.nE=d;a.Xc=b;a.vh=e;a.vg=g;a.ss=function(a,b,c,d){if(!E(a,b,c))throw"Edge not found";
a=a.U;for(var f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c&&a[f+2][0]==d[0]&&a[f+2][1]==d[1]){a.splice(f,3);break}};a.u=function(a,b){if(-1==k(a,b)){var d=h(a);c(a,d,b);return d}throw"Non-unique attribute";};a.pA=function(a,b,c,d,f){a=a.U;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&a[e+2]==d&&(a[e+2]=f)};a.wq=h;a.kg=k;a.m=function(a,c,d,f){c=k(a,c);d=k(a,d);if(-1!=c&&-1!=d)b(a,c,d,f);else throw"Attributes not found";};a.R=function(a,b){for(var c=a.N,d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};a.Hd=function(a,
b){for(var c=a.U,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.Ae=function(a,b,c){for(var d=a.U,f=0;f<d.length;f+=3)if(d[f+1]==b){var e=d[f];if(c(e,y(a,e),d[f+2]))break}};a.qf=function(a,b,c){for(var d=a.U,f=0;f<d.length;f+=3)if(d[f]==b){var e=d[f+1];if(c(e,y(a,e),d[f+2]))break}};a.po=n;a.KB=function(a){a=n(a).N;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.xE=function(){};a.fo=function(a,b,c){if(!d(a,b))throw"No such node";var e={};f(a,e);t(a,b,e,c);b=[];for(var h in e)e[h]&&(h=
Number(h),b.push(h,y(a,h)));a={N:b,U:a.U.slice(0)};e=a.U;for(h=0;h<e.length;h+=3)b=e[h+1],d(a,e[h])&&d(a,b)||(e.splice(h,3),h-=3);return a};a.Ey=function(a){for(var b=[],c=a.N,d=0;d<c.length;d+=2){var f=c[d];w(a,f)||b.push(f)}return b};a.Mq=x;a.match=function(a,b,c,d){var f={};f.xi=z(a);f.yi=z(b);f.xn=c||function(a,b){return a==b};f.Vj=d||function(a,b){return a==b};d=a.N.length/2;var e=b.N.length/2;f.$e=d;f.rh=e;f.af=0;f.sd=f.vk=0;f.nf=f.Jh=f.Kh=0;f.of=f.Lh=f.Mh=0;f.$h=-1;f.Zd=Array(d);f.Mf=Array(e);
f.Yf=Array(d);f.Zf=Array(e);f.og=Array(d);f.pg=Array(e);f.Rk=[1];for(c=0;c<d;c++)f.Zd[c]=-1,f.Yf[c]=0,f.og[c]=0;for(c=0;c<e;c++)f.Mf[c]=-1,f.Zf[c]=0,f.pg[c]=0;e=Array(d);d=Array(d);if(D(e,d,f)){for(c=0;c<e.length;c++)e[c]=a.N[2*e[c]],d[c]=b.N[2*d[c]];return[e,d]}return null};a.Ta=y;a.qg=q;a.ar=w;a.Wf=m;a.$j=r;a.fE=F;a.Vf=M;a.replace=function(a,b,d){for(var f=a.U,g=h(a),m=0;m<b.length;m++){var l=b[m];e(a,l);for(var q=0;q<f.length;q+=3)f[q]==l&&(f[q]=g),f[q+1]==l&&(f[q+1]=g),f[q]==f[q+1]&&(f.splice(q,
3),q-=3)}c(a,g,d)};a.gA=function(a,b,c,d,f){if(!E(a,b,c))throw"Edge not found";a=a.U;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&(a[e]=d,a[e+1]=f)};a.Ax=function(a,b){function c(a,b){if(-1!=m.indexOf(a)){var d=m.slice(m.indexOf(a));if(-1!=f[d[d.length-1]].indexOf(d[0])){l.push([a,d[d.length-1]]);return}}m.push(a);for(d=0;d<b.length;d++)b[d]in f&&c(b[d],f[b[d]])}b||(b=x(a)[0]);var d=a.U;if(d.length){for(var f={},e=0,h=0;h<d.length;h+=3)d[h+1]in f?f[d[h+1]].push(d[h]):f[d[h+1]]=[d[h]],e++;var m=
[],l=[];c(b,f[b]);for(h=0;h<l.length;h++)for(var q=e=0;q<d.length;q+=3)l[h][1]==d[q+1]&&l[h][0]==d[q]&&g(a,d[q],d[q+1],e),e++}};a.GD=function(a,b){var c=a.N,d=a.U,f;f="digraph debug {\n    node [shape=box];\n";for(var e=0;e<c.length;e+=2){var h=c[e],g=c[e+1],g=b?b(h,g):String(h);f+="    ";f+=String(h)+' [label="'+g.replace(/\"/g,'\\"')+'"];\n'}for(e=0;e<d.length;e+=3)c=d[e],h=d[e+1],f+="    ",f+=String(c)+" -> "+String(h)+";\n";return f+="}"}};b4w.module.__ipc=function(a){function p(a){for(var b=0;b<a.length;b++){var c=a[b],d=0,f;for(f in c){var e=c[f];switch(e.constructor){case Float32Array:d+=e.length;break;case Number:d+=1}}--d;c.len=d}}a.Qt=0;var c=a.It=1,d=a.Kt=2;a.Jt=3;a.Mt=4;a.Nt=5;a.Ot=6;a.Rt=7;var b=a.Tt=8,e=a.Lo=9,g=a.Ut=10;a.Vt=11;var h=a.Wt=12;a.Xt=13;a.St=14;a.Pt=15;a.Lt=16;a.xu=100;a.Zt=101;a.$t=102;a.au=103;a.bu=104;a.du=105;a.cu=106;a.eu=107;a.fu=108;a.gu=109;a.hu=110;a.iu=111;a.ju=112;a.lu=113;a.mu=114;a.Au=115;a.nu=116;
a.ou=117;a.pu=118;a.ru=119;a.su=120;a.tu=121;a.vu=122;a.wu=123;a.yu=124;a.ku=125;a.Cu=126;a.qu=127;a.Oo=128;a.Bu=129;a.Du=130;a.Eu=131;a.Fu=132;a.Gu=133;a.Hu=134;a.Iu=135;a.Ju=136;a.Ku=137;a.Lu=138;a.Mu=139;a.Po=140;var k=a.rj=141;a.Nu=142;a.No=143;a.Ou=144;a.Pu=145;a.zu=146;a.uu=147;var n=null,f=[],l={xc:h,H:0,time:0,h:new Float32Array(3),quat:new Float32Array(4),yd:new Float32Array(3),pd:new Float32Array(3),len:0},t={xc:b,Rl:0,Hn:0,h:new Float32Array(3),quat:new Float32Array(4),len:0},x={xc:e,id:0,
Pg:0,hit_fract:0,hit_time:0,len:0},z={xc:g,id:0,Pg:0,hit_fract:0,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),len:0},D={xc:c,Gf:0,Hf:0,result:0,len:0},A={xc:d,Gf:0,Hf:0,result:0,Lf:new Float32Array(3),coll_norm:new Float32Array(3),coll_dist:0,len:0},H={xc:k,H:0,h:new Float32Array(3),quat:new Float32Array(4),len:0},u=[l,t,x,z,D,A,H];a.init=function(a,f){function w(a){if(a.constructor==ArrayBuffer)a=new Float32Array(a);else if(a[0].constructor==ArrayBuffer){for(var r=0;r<a.length;r++)w(a[r]);
return}r=a[0]|0;switch(r){case h:var n=l;n.H=a[1]|0;n.time=a[2];n.h[0]=a[3];n.h[1]=a[4];n.h[2]=a[5];n.quat[0]=a[6];n.quat[1]=a[7];n.quat[2]=a[8];n.quat[3]=a[9];n.yd[0]=a[10];n.yd[1]=a[11];n.yd[2]=a[12];n.pd[0]=a[13];n.pd[1]=a[14];n.pd[2]=a[15];break;case b:n=t;n.Rl=a[1]|0;n.Hn=a[2]|0;n.h[0]=a[3];n.h[1]=a[4];n.h[2]=a[5];n.quat[0]=a[6];n.quat[1]=a[7];n.quat[2]=a[8];n.quat[3]=a[9];break;case e:n=x;n.id=a[1]|0;n.Pg=a[2]|0;n.hit_fract=a[3];n.hit_time=a[4];break;case g:n=z;n.id=a[1]|0;n.Pg=a[2]|0;n.hit_fract=
a[3];n.hit_time=a[4];n.hit_pos[0]=a[5];n.hit_pos[1]=a[6];n.hit_pos[2]=a[7];n.hit_norm[0]=a[8];n.hit_norm[1]=a[9];n.hit_norm[2]=a[10];break;case c:n=D;n.Gf=a[1]|0;n.Hf=a[2]|0;n.result=!!a[3];break;case d:n=A;n.Gf=a[1]|0;n.Hf=a[2]|0;n.result=!!a[3];n.Lf[0]=a[4];n.Lf[1]=a[5];n.Lf[2]=a[6];n.coll_norm[0]=a[7];n.coll_norm[1]=a[8];n.coll_norm[2]=a[9];n.coll_dist=a[10];break;case k:n=H;n.H=a[1]|0;n.h[0]=a[2];n.h[1]=a[3];n.h[2]=a[4];n.quat[0]=a[5];n.quat[1]=a[6];n.quat[2]=a[7];n.quat[3]=a[8];break;default:n=
a}f(r,n)}p(u);a.addEventListener("message",function(a){w(a.data)},!1);n=a};a.cleanup=function(){n=null;f.length=0};a.w=function(a){if(n)switch(a){case h:var q=l,w=new Float32Array(q.len);w[0]=q.xc;w[1]=q.H;w[2]=q.time;w[3]=q.h[0];w[4]=q.h[1];w[5]=q.h[2];w[6]=q.quat[0];w[7]=q.quat[1];w[8]=q.quat[2];w[9]=q.quat[3];w[10]=q.yd[0];w[11]=q.yd[1];w[12]=q.yd[2];w[13]=q.pd[0];w[14]=q.pd[1];w[15]=q.pd[2];f.push(w.buffer);break;case b:q=t;w=new Float32Array(q.len);w[0]=q.xc;w[1]=q.Rl;w[2]=q.Hn;w[3]=q.h[0];w[4]=
q.h[1];w[5]=q.h[2];w[6]=q.quat[0];w[7]=q.quat[1];w[8]=q.quat[2];w[9]=q.quat[3];f.push(w.buffer);break;case e:q=x;w=new Float32Array(q.len);w[0]=q.xc;w[1]=q.id;w[2]=q.Pg;w[3]=q.hit_fract;w[4]=q.hit_time;f.push(w.buffer);break;case g:q=z;w=new Float32Array(q.len);w[0]=q.xc;w[1]=q.id;w[2]=q.Pg;w[3]=q.hit_fract;w[4]=q.hit_time;w[5]=q.hit_pos[0];w[6]=q.hit_pos[1];w[7]=q.hit_pos[2];w[8]=q.hit_norm[0];w[9]=q.hit_norm[1];w[10]=q.hit_norm[2];f.push(w.buffer);break;case c:q=D;w=new Float32Array(q.len);w[0]=
q.xc;w[1]=q.Gf;w[2]=q.Hf;w[3]=q.result;f.push(w.buffer);break;case d:q=A;w=new Float32Array(q.len);w[0]=q.xc;w[1]=q.Gf;w[2]=q.Hf;w[3]=q.result;w[4]=q.Lf[0];w[5]=q.Lf[1];w[6]=q.Lf[2];w[7]=q.coll_norm[0];w[8]=q.coll_norm[1];w[9]=q.coll_norm[2];w[10]=q.coll_dist;f.push(w.buffer);break;case k:q=H;w=new Float32Array(q.len);w[0]=q.xc;w[1]=q.H;w[2]=q.h[0];w[3]=q.h[1];w[4]=q.h[2];w[5]=q.quat[0];w[6]=q.quat[1];w[7]=q.quat[2];w[8]=q.quat[3];f.push(w.buffer);break;default:w=[];for(q=0;q<arguments.length;q++)w.push(arguments[q]);
n.postMessage(w)}};a.Yz=function(){f.length&&(n.postMessage(f),f.length=0)};a.Iq=function(a){switch(a){case h:return l;case b:return t;case e:return x;case g:return z;case c:return D;case d:return A;case k:return H;default:return null}}};b4w.module.__hud=function(a,p){function c(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function d(a){b(' SCENE "'+a.name+'"');if(a.e){var c=0,d=0;k.R(a.e.ib,function(a,f){if("SINK"==f.type)b(" (F)",f.type);else{var e=f.type,h=Math.round(f.j.width)+"x"+Math.round(f.j.height),g=f.q.length,l=f.li,q=f.enqueue&&f.Ra;q?b(" (A)",e,f.mg,h,l,"of",g):b(" (P)",e,f.mg,h,l,"of",g);f.li=0;q&&(c+=g,d+=l)}});return[c,d]}b("No INFO")}function b(){for(var a=80+20*f[0],b=[5,
18,3,10,4,3,5],c=arguments[0],d=1;d<arguments.length;d++){for(var e="",h=0;h<b[d]-String(arguments[d]).length;h++)e+=" ";c+=e+arguments[d]}f[0]++;n.fillText(c,30,a)}function e(a,b,c){b*=a.Ea;c.x=a.x+b;c.y=a.y;c.Ea=a.Ea-2*b;c.Aa=a.Aa}function g(a){return a.x+a.Ea/2}function h(a){var b=n,c={x:0,y:0,Ea:0,Aa:0},d=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.Ea=d;c.Aa=b;e(c,.01,c);d=.02*c.Aa;c.x=c.x;c.y+=d;c.Ea=c.Ea;c.Aa-=2*d;d=c.Ea/8;c.x+=d*a;c.y=c.y;c.Ea=d;c.Aa=c.Aa;e(c,.02,c);return c}var k=p("__graph"),
n=null,f=[0,0];a.init=function(a){a=a.getContext("2d");c(a);return n=a};a.Oh=function(){n&&c(n)};a.reset=function(){var a=n;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),f[0]=0,f[1]=0)};a.bB=function(a,c){var e=n;if(e){e.textAlign="left";e.fillStyle="rgba(0,255,0,255)";b(" FPS",(1/c).toFixed(2));f[0]++;for(var h=e=0,g=0;g<a.length;g++){var k=d(a[g]),e=e+k[0],h=h+k[1];f[0]++}b(" ---------------------------------------------");
b("    ","TOTAL ACTIVE","","",h,"of",e)}};a.print=function(){var a=n;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",b.apply(Math,arguments))};a.plot_array=function(a,b,c,d,f,e,k){var u=n;if(u){b=h(b);var y=b.Aa/5;b.x=b.x;b.y+=4*y;b.Ea=b.Ea;b.Aa=y;u.textAlign="center";u.fillStyle="#00FF00";n.fillText(a,g(b),b.y-10);u.strokeStyle="#00FF00";u.lineWidth=.5;u.beginPath();u.moveTo(b.x,b.y);u.lineTo(b.x+b.Ea,b.y);u.lineTo(b.x+b.Ea,b.y+b.Aa);u.lineTo(b.x,b.y+b.Aa);u.closePath();u.stroke();if(!e&&
!k)for(e=1E6,k=-1E6,a=0;a<c.length;a++)e=Math.min(e,c[a]),k=Math.max(k,c[a]);u.textAlign="right";n.fillText(String(e),b.x-10,b.y+b.Aa);n.fillText(String(k),b.x-10,b.y);u.textAlign="center";n.fillText(String(d),b.x,b.y+b.Aa+15);n.fillText(String(f),b.x+b.Ea,b.y+b.Aa+15);u.strokeStyle="#FF0000";u.lineWidth=1.5;u.beginPath();d=b.Ea/(c.length-1);k=b.Aa/(k-e);for(a=0;a<c.length;a++)f=b.x+d*a,y=b.y+b.Aa-(c[a]-e)*k,0==a?u.moveTo(f,y):u.lineTo(f,y);u.stroke()}};a.draw_mixer_strip=function(a,b,c,d,f,e,k){var u=
n;if(u)for(u.textAlign="center",u.fillStyle="#00FF00",u.font="bold 12px Courier",c=h(c),n.fillText(b?"["+a+"]":a,g(c),c.y),0<=e&&n.fillText(e?"[M]":"[ ]",g(c)-15,c.y+30),0<=k&&n.fillText(k?"[S]":"[ ]",g(c)+15,c.y+30),a={x:0,y:0,Ea:0,Aa:0},b=0;b<d.length;b++){e=d[b];var y="VOLUME"==e[0];if(y){k=c.y+350;var q=c.Ea,w=a;w.x=c.x;w.y=k;w.Ea=q;w.Aa=250}else{k=c.y+10+50*b;var q=c.Ea,w=c.Aa,m=a;m.x=c.x;m.y=k;m.Ea=q;m.Aa=w}k=u;var q=a,m=b==f,r=e[0],w=e[1],E=e[2],I=e[3],F=(I-E)/e[4],F=1>F?Math.floor(1/F-1E-5).toFixed(0).length:
0;e=e[5]?Math.log(w/E)/Math.log(I/E):(w-E)/(I-E);k.textAlign="center";m?k.fillText("["+r+"]",g(q),q.y):k.fillText(r,g(q),q.y);k.strokeStyle="#00FF00";k.lineWidth=y?3:1;y?(k.textAlign="right",k.fillText(I.toFixed(F),g(q)-10,q.y+15),k.textAlign="right",k.fillText(E.toFixed(F),g(q)-10,q.y+q.Aa-15)):(k.textAlign="right",k.fillText(E.toFixed(F),q.x+28,q.y+15),k.textAlign="left",k.fillText(I.toFixed(F),q.x+q.Ea-28,q.y+15));k.beginPath();if(y){var M=q.y+15+(q.Aa-30)*(1-e);k.moveTo(g(q),q.y+15);k.lineTo(g(q),
q.y+q.Aa-15);k.moveTo(g(q)-5,q.y+15);k.lineTo(g(q)+5,q.y+15);k.moveTo(g(q)-5,q.y+q.Aa-15);k.lineTo(g(q)+5,q.y+q.Aa-15);k.moveTo(g(q)-5,M);k.lineTo(g(q)+5,M)}else{var L=q.x+30+(q.Ea-60)*e;k.moveTo(q.x+30,q.y+15);k.lineTo(q.x+q.Ea-30,q.y+15);k.moveTo(q.x+30,q.y+15-5);k.lineTo(q.x+30,q.y+15+5);k.moveTo(q.x+q.Ea-30,q.y+15-5);k.lineTo(q.x+q.Ea-30,q.y+15+5);k.moveTo(L,q.y+15-5);k.lineTo(L,q.y+15+5)}k.stroke();"EQ_Q"==r?(e=Math.log(1+1/(2*w*w)+Math.sqrt((2+1/(w*w))*(2+1/(w*w))/4-1))/Math.log(2),y?(k.textAlign=
"left",k.fillText(w.toFixed(F),g(q)+10,M),k.textAlign="left",k.fillText("("+e.toFixed(F+1)+")",g(q)+10,M+10)):(k.textAlign="right",k.fillText(w.toFixed(F),L,q.y+30),k.textAlign="left",k.fillText("("+e.toFixed(F+1)+")",L,q.y+30))):y?(k.textAlign="left",k.fillText(w.toFixed(F),g(q)+10,M)):(k.textAlign="center",k.fillText(w.toFixed(F),L,q.y+30))}}};b4w.module.__renderer=function(a,p){function c(a){for(var c=a.j,d=a.q,f=0;f<d.length;f++){var h=d[f];if(h.Ra){var g=a,k=c,l=h.cd,n=h.B,x=n.Xb;u.useProgram(x.Ui);for(var h=n.T,B=n.gp,J=x.gt,K=J.length;K--;){var P=J[K];P.Fm(u,P.fg,g,l,n,k)}k=n.Kp;u.colorMask(k,k,k,k);u.depthMask(n.Y);n.La?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE);k=n.M;for(n=0;n<k.length;n++)J=k[n],u.activeTexture(u.TEXTURE0+n),u.bindTexture(J.Ob,J.Za);if("SKY"==g.type){k=g;x=x.dj;n=k.j.hb.Za;J=k.ki;for(K=0;6>K;K++)if(P=e(K),t.Tl?
(u.bindTexture(u.TEXTURE_CUBE_MAP,n),u.texImage2D(P,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,H)):(u.uniformMatrix4fv(x.u_cube_view_matrix,!1,J[K]),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,P,n,0),b(h,B,l.wo)),k.sk&&3!=K){var P=k,R=K,z=y;t.Tl?z.set(H):(u.readPixels(191,191,1,1,u.RGBA,u.UNSIGNED_BYTE,z),255!=z[0]&&255!=z[1]&&255!=z[2]||u.readPixels(191,220,1,1,u.RGBA,u.UNSIGNED_BYTE,z));var D=z[0],A=z[1],z=z[2],D=D/255,A=A/255,z=z/255;2===R?(P.oc[3]=D,P.oc[7]=A,P.oc[11]=z):2>R?(P.oc[4*R]=
D,P.oc[4*R+1]=A,P.oc[4*R+2]=z):(P.oc[4*(R-2)]=D,P.oc[4*(R-2)+1]=A,P.oc[4*(R-2)+2]=z)}g.li+=6}else b(h,B,l.wo),g.li++}}}function d(a){if(a){var b=(a.da?u.COLOR_BUFFER_BIT:0)|(a.ja?u.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "MAIN_GLOW":a=A;break;case "SHADOW_CAST":a=x;break;case "DEPTH":a=z;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=D;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=A;break;default:a=t.background_color}}else b=
u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT,a=t.background_color;u.colorMask(!0,!0,!0,!0);u.depthMask(!0);u.clearColor(a[0],a[1],a[2],a[3]);u.clear(b)}function b(a,b,c){u.bindBuffer(u.ARRAY_BUFFER,a.sf);for(var d=0;d<b.length;d++){var f=b[d];u.enableVertexAttribArray(f.fg);u.vertexAttribPointer(f.fg,f.zd,u.FLOAT,!1,0,f.Iv+f.Ox*c)}a.ke?(u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a.ke),u.drawElements(a.mode,a.count,a.Um,0)):u.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)f=b[d],u.disableVertexAttribArray(f.fg)}
function e(a){switch(a){case 0:return u.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return u.TEXTURE_CUBE_MAP_NEGATIVE_X;case 2:return u.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return u.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return u.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return u.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function g(a){var b=a.dj,c=[],d=[],f={},e;for(e in b){var h=!1;switch(e){case "u_proj_matrix":var g=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.ta)},h=!0;break;case "u_view_matrix":case "u_view_matrix_frag":g=
function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.qa)};h=!0;break;case "u_shadow_cast_billboard_view_matrix":g=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.Fs)};h=!0;break;case "u_view_proj_prev":g=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.dA)};h=!0;break;case "u_view_proj_inverse":g=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.Rh)};h=!0;break;case "u_sky_vp_inverse":g=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.Bd)};h=!0;break;case "u_camera_eye":case "u_camera_eye_frag":g=function(a,
b,c,d,f,e){a.uniform3fv(b,e.Re)};h=!0;break;case "u_camera_eye_last":g=function(a,b,c,d,f,e){a.uniform3fv(b,e.nq)};h=!0;break;case "u_camera_quat":g=function(a,b,c,d,f,e){a.uniform4fv(b,e.quat)};h=!0;break;case "u_view_max_depth":g=function(a,b,c,d,f,e){a.uniform1f(b,e.Sa)};h=!0;break;case "u_camera_range":g=function(a,b,c,d,f,e){a.uniform2f(b,e.Ua,e.Sa)};break;case "u_csm_center_dists":g=function(a,b,c,d,f,e){a.uniform4fv(b,e.Up)};break;case "u_cam_water_depth":g=function(a,b,c){a.uniform1f(b,c.Pl)};
h=!0;break;case "u_waves_height":g=function(a,b,c){a.uniform1f(b,c.wf)};break;case "u_waves_length":g=function(a,b,c){a.uniform1f(b,c.Hg)};break;case "u_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.uc)};break;case "u_underwater_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.md)};break;case "u_bloom_key":g=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":g=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":g=function(a,b,c){a.uniform1f(b,c.time)};
h=!0;break;case "u_wind":g=function(a,b,c){a.uniform3fv(b,c.kj)};break;case "u_sky_tex_dvar":g=function(a,b,c){a.uniform1f(b,c.Js)};break;case "u_sky_tex_fac":g=function(a,b,c){a.uniform4fv(b,c.Ks)};break;case "u_sky_tex_color":g=function(a,b,c){a.uniform3fv(b,c.Is)};break;case "u_horizon_color":g=function(a,b,c){a.uniform3fv(b,c.Ue)};break;case "u_zenith_color":g=function(a,b,c){a.uniform3fv(b,c.xf)};break;case "u_environment_energy":g=function(a,b,c){a.uniform1f(b,c.Qe)};break;case "u_sky_color":g=
function(a,b,c){a.uniform3fv(b,c.Bh)};break;case "u_rayleigh_brightness":g=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":g=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":g=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":g=function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":g=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":g=function(a,
b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":g=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":g=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":g=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;case "u_light_positions":g=function(a,b,c){a.uniform3fv(b,c.Ye)};break;case "u_light_directions":g=function(a,b,c){a.uniform3fv(b,c.cg)};break;case "u_light_color_intensities":g=
function(a,b,c){a.uniform3fv(b,c.bg)};break;case "u_light_factors":g=function(a,b,c){a.uniform4fv(b,c.dg)};break;case "u_sun_quaternion":g=function(a,b,c){a.uniform4fv(b,c.bt)};break;case "u_sun_intensity":g=function(a,b,c){a.uniform3fv(b,c.at)};break;case "u_sun_direction":g=function(a,b,c){a.uniform3fv(b,c.Wk)};break;case "u_height":g=function(a,b,c,d,f,e){a.uniform1f(b,e.height)};h=!0;break;case "u_model_matrix":g=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.V)};h=!0;break;case "u_transb":g=function(a,
b,c,d){a.uniform4fv(b,d.Jc)};h=!0;break;case "u_transa":g=function(a,b,c,d){a.uniform4fv(b,d.Ic)};h=!0;break;case "u_arm_rel_trans":g=function(a,b,c,d){a.uniform4fv(b,d.yl)};h=!0;break;case "u_arm_rel_quat":g=function(a,b,c,d){a.uniform4fv(b,d.xl)};h=!0;break;case "u_quat":g=function(a,b,c,d){a.uniform4fv(b,d.quat)};h=!0;break;case "u_quatsb":g=function(a,b,c,d){a.uniform4fv(b,d.Bc)};h=!0;break;case "u_quatsa":g=function(a,b,c,d){a.uniform4fv(b,d.Ac)};h=!0;break;case "u_frame_factor":g=function(a,
b,c,d){a.uniform1f(b,d.Sf)};h=!0;break;case "au_center_pos":g=function(){};h=!0;break;case "au_wind_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.Kd)};h=!0;break;case "au_wind_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.Be)};h=!0;break;case "au_detail_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.ae)};h=!0;break;case "au_detail_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.$d)};h=!0;break;case "au_branch_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.Vd)};h=!0;break;case "u_node_values":g=
function(a,b,c,d){a.uniform1fv(b,d.oe)};h=!0;break;case "u_node_rgbs":g=function(a,b,c,d){a.uniform3fv(b,d.wc)};h=!0;break;case "u_diffuse_color":g=function(a,b,c,d,f){a.uniform4fv(b,f.Qc)};h=!0;break;case "u_diffuse_intensity":g=function(a,b,c,d,f){a.uniform1f(b,f.Ne)};h=!0;break;case "u_diffuse_params":g=function(a,b,c,d,f){a.uniform2fv(b,f.sc)};h=!0;break;case "u_emit":g=function(a,b,c,d,f){a.uniform1f(b,f.fe)};h=!0;break;case "u_ambient":g=function(a,b,c,d,f){a.uniform1f(b,f.Rd)};h=!0;break;case "u_specular_color":g=
function(a,b,c,d,f){a.uniform3fv(b,f.Cd)};h=!0;break;case "u_specular_alpha":g=function(a,b,c,d,f){a.uniform1f(b,f.Yn)};h=!0;break;case "u_specular_params":g=function(a,b,c,d,f){a.uniform3fv(b,f.jc)};h=!0;break;case "u_reflect_factor":g=function(a,b,c,d,f){a.uniform1f(b,f.reflect_factor)};h=!0;break;case "u_mirror_factor":g=function(a,b,c,d,f){a.uniform1f(b,f.tn)};h=!0;break;case "u_grass_map_dim":g=function(a,b,c,d,f){a.uniform3fv(b,f.ac)};h=!0;break;case "u_grass_size":g=function(a,b,c,d,f){a.uniform1f(b,
f.Nm)};h=!0;break;case "u_scale_threshold":g=function(a,b,c,d,f){a.uniform1f(b,f.Oq)};h=!0;break;case "u_cube_fog":g=function(a,b,c,d,f){a.uniformMatrix4fv(b,!1,f.oc)};break;case "u_jitter_amp":g=function(a,b,c,d,f){a.uniform1f(b,f.nr)};h=!0;break;case "u_jitter_freq":g=function(a,b,c,d,f){a.uniform1f(b,f.or)};h=!0;break;case "u_wireframe_mode":g=function(a,b,c,d,f){a.uniform1i(b,f.wireframe_mode)};break;case "u_wireframe_edge_color":g=function(a,b,c,d,f){a.uniform3fv(b,f.wireframe_edge_color)};break;
case "u_subpixel_jitter":g=function(a,b,c){a.uniform2fv(b,c.jz)};h=!0;break;case "u_subsample_indices":g=function(a,b,c){a.uniform4fv(b,c.kz)};h=!0;break;case "u_refr_bump":g=function(a,b,c,d,f){a.uniform1f(b,f.qs)};h=!0;break;case "u_lamp_light_positions":g=function(a,b,c,d,f){a.uniform3fv(b,f.dn)};break;case "u_lamp_light_directions":g=function(a,b,c,d,f){a.uniform3fv(b,f.bn)};break;case "u_lamp_light_color_intensities":g=function(a,b,c,d,f){a.uniform3fv(b,f.an)};break;case "u_lamp_light_factors":g=
function(a,b,c,d,f){a.uniform4fv(b,f.cn)};break;case "u_halo_size":g=function(a,b,c,d,f){a.uniform1f(b,f.Tq)};h=!0;break;case "u_halo_hardness":g=function(a,b,c,d,f){a.uniform1f(b,f.Qq)};h=!0;break;case "u_halo_rings_color":g=function(a,b,c,d,f){a.uniform3fv(b,f.Sq)};h=!0;break;case "u_halo_lines_color":g=function(a,b,c,d,f){a.uniform3fv(b,f.Rq)};h=!0;break;case "u_halo_stars_blend":g=function(a,b,c,d,f){a.uniform1f(b,f.Uq)};h=!0;break;case "u_halo_stars_height":g=function(a,b,c,d,f){a.uniform1f(b,
f.Vq)};h=!0;break;case "u_fresnel_params":g=function(a,b,c,d,f){a.uniform4fv(b,f.ad)};h=!0;break;case "u_texture_scale":g=function(a,b,c,d,f){a.uniform3fv(b,f.pf)};h=!0;break;case "u_parallax_scale":g=function(a,b,c,d,f){a.uniform1f(b,f.parallax_scale)};h=!0;break;case "u_color_id":g=function(a,b,c,d){a.uniform3fv(b,d.Mj)};h=!0;break;case "u_line_points":g=function(a,b,c,d,f){a.uniform3fv(b,f.GE)};h=!0;break;case "u_diffuse_color_factor":g=function(a,b,c,d,f){a.uniform1f(b,f.Me)};h=!0;break;case "u_alpha_factor":g=
function(a,b,c,d,f){a.uniform1f(b,f.Ge)};h=!0;break;case "u_specular_color_factor":g=function(a,b,c,d,f){a.uniform1f(b,f.Qs)};h=!0;break;case "u_normal_factor":g=function(a,b,c,d,f){a.uniform1f(b,f.Fr)};h=!0;break;case "u_normalmap0_scale":g=function(a,b,c,d,f){a.uniform2fv(b,f.lg[0])};h=!0;break;case "u_normalmap1_scale":g=function(a,b,c,d,f){a.uniform2fv(b,f.lg[1])};h=!0;break;case "u_normalmap2_scale":g=function(a,b,c,d,f){a.uniform2fv(b,f.lg[2])};h=!0;break;case "u_normalmap3_scale":g=function(a,
b,c,d,f){a.uniform2fv(b,f.lg[3])};h=!0;break;case "u_foam_factor":g=function(a,b,c,d,f){a.uniform1f(b,f.foam_factor)};h=!0;break;case "u_foam_uv_freq":g=function(a,b,c,d,f){a.uniform2fv(b,f.qq)};h=!0;break;case "u_foam_mag":g=function(a,b,c,d,f){a.uniform2fv(b,f.pq)};h=!0;break;case "u_foam_scale":g=function(a,b,c,d,f){a.uniform2fv(b,f.zm)};h=!0;break;case "u_water_norm_uv_velocity":g=function(a,b,c,d,f){a.uniform1f(b,f.Uh)};h=!0;break;case "u_shallow_water_col":g=function(a,b,c,d,f){a.uniform3fv(b,
f.shallow_water_col)};h=!0;break;case "u_shore_water_col":g=function(a,b,c,d,f){a.uniform3fv(b,f.shore_water_col)};h=!0;break;case "u_water_shallow_col_fac":g=function(a,b,c,d,f){a.uniform1f(b,f.shallow_water_col_fac)};h=!0;break;case "u_water_shore_col_fac":g=function(a,b,c,d,f){a.uniform1f(b,f.shore_water_col_fac)};h=!0;break;case "u_p_length":g=function(a,b,c,d,f){a.uniform1f(b,f.Vr)};h=!0;break;case "u_p_cyclic":g=function(a,b,c,d,f){a.uniform1i(b,f.Rr)};h=!0;break;case "u_p_max_lifetime":g=function(a,
b,c,d,f){a.uniform1f(b,f.Xr)};h=!0;break;case "u_p_fade_in":g=function(a,b,c,d,f){a.uniform1f(b,f.Sr)};h=!0;break;case "u_p_fade_out":g=function(a,b,c,d,f){a.uniform1f(b,f.Tr)};h=!0;break;case "u_p_size":g=function(a,b,c,d,f){a.uniform1f(b,f.Cn)};h=!0;break;case "u_p_alpha_start":g=function(a,b,c,d,f){a.uniform1f(b,f.Or)};h=!0;break;case "u_p_alpha_end":g=function(a,b,c,d,f){a.uniform1f(b,f.Nr)};h=!0;break;case "u_p_nfactor":g=function(a,b,c,d,f){a.uniform1f(b,f.Bn)};h=!0;break;case "u_p_gravity":g=
function(a,b,c,d,f){a.uniform1f(b,f.Ur)};h=!0;break;case "u_p_mass":g=function(a,b,c,d,f){a.uniform1f(b,f.Wr)};h=!0;break;case "u_p_size_ramp":g=function(a,b,c,d,f){a.uniform2fv(b,f.Yr)};h=!0;break;case "u_p_color_ramp":g=function(a,b,c,d,f){a.uniform4fv(b,f.Pr)};h=!0;break;case "u_p_wind":g=function(a,b,c,d,f){a.uniform3fv(b,f.Bk)};h=!0;break;case "u_texel_size":g=function(a,b,c){a.uniform2fv(b,c.mo)};h=!0;break;case "u_p_time":g=function(a,b,c,d,f){a.uniform1f(b,f.yc.S.time)};h=!0;break;case "u_position":g=
function(a,b,c,d,f){a.uniform3fv(b,f.Ti)};h=!0;break;case "u_va_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.tt)};h=!0;break;case "u_perspective_cast_far_bound":g=function(a,b,c){a.uniform1f(b,c.Qz)};break;case "u_normal_offset":g=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":g=function(a,b,c,d,f,e){a.uniform4fv(b,e.Fk)};break;case "u_v_light_matrix":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.st)};h=!0;break;case "u_b_light_matrix":g=function(a,b,
c){a.uniformMatrix4fv(b,!1,c.lp)};break;case "u_p_light_matrix0":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.rg[0])};h=!0;break;case "u_p_light_matrix1":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.rg[1])};h=!0;break;case "u_p_light_matrix2":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.rg[2])};h=!0;break;case "u_p_light_matrix3":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.rg[3])};h=!0;break;case "u_motion_blur_exp":g=function(a,b,c){a.uniform1f(b,c.Ar)};h=!0;break;case "u_motion_blur_decay_threshold":g=
function(a,b,c){a.uniform1f(b,c.mb_decay_threshold)};h=!0;break;case "u_refl_plane":g=function(a,b,c,d){a.uniform4fv(b,d.ec)};break;case "u_radial_blur_step":g=function(a,b,c){a.uniform1f(b,c.Kk)};break;case "u_god_rays_intensity":g=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":g=function(a,b,c){a.uniform1f(b,c.Eh)};break;case "u_ssao_blur_discard_value":g=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};h=!0;break;case "u_ssao_influence":g=function(a,
b,c){a.uniform1f(b,c.Dh)};break;case "u_ssao_dist_factor":g=function(a,b,c){a.uniform1f(b,c.Ch)};break;case "u_dof_dist":g=function(a,b,c,d,f,e){a.uniform1f(b,e.dof_distance)};h=!0;break;case "u_dof_front":g=function(a,b,c,d,f,e){a.uniform1f(b,e.dof_front)};h=!0;break;case "u_dof_rear":g=function(a,b,c,d,f,e){a.uniform1f(b,e.dof_rear)};h=!0;break;case "u_outline_intensity":g=function(a,b,c,d){a.uniform1f(b,d.dd)};h=!0;break;case "u_outline_color":g=function(a,b,c){a.uniform3fv(b,c.bf)};break;case "u_draw_outline":g=
function(a,b,c){a.uniform1f(b,c.nm)};h=!0;break;case "u_glow_mask_small_coeff":g=function(a,b,c){a.uniform1f(b,c.small_glow_mask_coeff)};h=!0;break;case "u_glow_mask_large_coeff":g=function(a,b,c){a.uniform1f(b,c.large_glow_mask_coeff)};h=!0;break;case "u_brightness":g=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":g=function(a,b,c){a.uniform1f(b,c.contrast)};break;case "u_exposure":g=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":g=function(a,b,c){a.uniform1f(b,
c.saturation)};break;default:g=null}g&&(g={name:e,Fm:g,fg:b[e]},h?c.push(g):(d.push(g),f[e]=g))}a.gt=c;a.Pi=d;a.En=f}var h=p("__config"),k=p("__debug"),n=p("__textures"),f=p("__util"),l=p("__camera");p("mat4");var t=h.p,x=[1,1,1,1],z=[1,1,1,1],D=[0,0,0,1],A=[0,0,0,0],H=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var u=null,y=new Uint8Array(4);a.gd=function(a){var b=t.background_color;a.clearColor(b[0],
b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);u=a};a.pi=function(a){if(a.Ra){var b=a.j;u.bindFramebuffer(u.FRAMEBUFFER,b.he);if(a.zl){var f=b.hb;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,f.Ob,f.Za,0)}u.viewport(0,0,b.width,b.height);"MAIN_CUBE_REFLECT"!=a.type&&d(a);a.Ca?u.enable(u.BLEND):u.disable(u.BLEND);a.Eb?u.enable(u.DEPTH_TEST):
u.disable(u.DEPTH_TEST);if(a.na){for(var b=a.j,f=a.q,h=0;h<f.length;h++){var n=f[h],x=n.B,z=x.Xb;u.useProgram(z.Ui);n=n.cd;z.Pi.length||g(z);for(var z=z.Pi,y=z.length;y--;){var D=z[y];D.Fm(u,D.fg,a,n,x,b)}}a.na=!1}switch(a.type){case "DEPTH":t.fr?(u.enable(u.POLYGON_OFFSET_FILL),u.polygonOffset(5,5)):u.disable(u.POLYGON_OFFSET_FILL);u.cullFace(u.BACK);break;case "SHADOW_CAST":u.enable(u.POLYGON_OFFSET_FILL);u.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);u.cullFace(u.BACK);
break;case "MAIN_PLANE_REFLECT":u.disable(u.POLYGON_OFFSET_FILL);u.cullFace(u.FRONT);break;default:u.disable(u.POLYGON_OFFSET_FILL),u.cullFace(u.BACK)}if("MAIN_CUBE_REFLECT"==a.type)for(b=a.j,f=b.hb.Za,h=0;6>h;h++){x=e(h);b.qa=a.ki[h];l.Ol(b);u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,x,f,0);d(a);x=a.q;for(n=0;n<x.length;n++)x[n].Ra=x[n].mm[h];c(a)}else c(a);k.gw("draw subscene: "+a.type);u.bindFramebuffer(u.FRAMEBUFFER,null)}};a.clear=function(a){u.bindFramebuffer(u.FRAMEBUFFER,a.j.he);
d(a)};a.cp=function(a){var b=a.gp;b.length=0;var c=a.T;a=a.Xb;c&&a||f.fa("Incomplete batch");c=c.Ub;a=a.attributes;for(var d in a){var e=c[d];b.push({fg:a[d],Iv:4*e.offset,Ox:1<e.frames?4*e.length:0,zd:e.zd})}};a.Hv=g;a.ep=function(a){var b=a.Xb,c=a.M;a=a.Gb;u.useProgram(b.Ui);for(var d=0;d<c.length;d++)u.uniform1i(b.dj[a[d]],d)};a.ps=function(a,b,c,d,e,h){d||(d=1);e||(e=1);h||(h=new Uint8Array(4*d*e));h.length!=4*d*e&&f.fa("read_pixels(): Wrong storage");u.bindFramebuffer(u.FRAMEBUFFER,a);u.readPixels(b,
c,d,e,u.RGBA,u.UNSIGNED_BYTE,h);u.bindFramebuffer(u.FRAMEBUFFER,null);return h};a.VB=function(a){var b=a.Xb;u.useProgram(b.Ui);b.Pi.length||g(b);b=b.En.u_cube_fog;b.Fm(u,b.fg,null,null,a,null)};a.oA=function(a,b){var c=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,c);if(a){var d=a,f=d.Za,d=d.Ob==u.TEXTURE_CUBE_MAP?u.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.Ob;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,d,f,0)}n.jr(b)?u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,
b.tf):n.Fi(b)&&(d=b,f=d.Za,d=d.Ob,u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,d,f,0));k.cw();u.bindFramebuffer(u.FRAMEBUFFER,null);return c};a.nA=function(a,b,c,d,f){null==a?(u.bindFramebuffer(u.FRAMEBUFFER,a),u.viewport(0,0,d,f),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT)):(n.Fi(b)&&u.deleteTexture(b.Za),n.jr(c)?u.deleteRenderbuffer(c.tf):n.Fi(c)&&u.deleteTexture(c.Za),u.deleteFramebuffer(a))};a.qE=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,p){function c(a,b,c){var f=a.Oe;"string"==typeof c&&(a=d(a,c))&&(c=a[1]);for(a=0;a<f.length;a++)if(f[a][0]==b){f[a][1]=c;return}f.push([b,c])}function d(a,b){for(var c=a.Oe,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function b(a,b){var c=a+b;if(u[c])return u[c];if(y){var d=y[b];if(!d)return null;d=p("__gpp_parser").RE.parse(d)}else if(d=p("shader_texts")[b],!d)return null;return u[c]=d}function e(a,c,d){function f(c){c=c.a;for(var d=0;d<c.length;d++){var q=
c[d];switch(q.type){case "condition":a:for(var q=q.a,R=0;R<q.length;R++){var y=q[R];switch(y.type){case "if":case "elif":if(e(y.c)){f(y.group);break a}break;case "else":f(y.group);break a;case "ifdef":y.name in w&&f(y.group);break;case "ifndef":y.name in w||f(y.group)}}break;case "include":q=b(A.shaders_dir,A.$A+q.file);f(q);break;case "var":case "export":case "import":break;case "define":R=q.name;w[R]=q.b;q.Va&&(r[R]=q.Va);break;case "error":throw"Shader error: #error "+q.b.join(" ");case "line":break;
case "pragma":l.push("#pragma "+q.name+" "+q.b.join(" "));break;case "undef":q=q.name;delete w[q];delete r[q];break;case "warning":t.warn("Shader warning: #warning "+q.b.join(" "));break;case "extension":q=g(q.b,w,r,!1);l.push("#extension "+q.join(" "));break;case "#":break;case "node":u[q.name]=q;break;case "nodes_global":q=k;for(R=0;R<q.length;R++){var y=q[R],C=u[y.id];if(C)for(var F=0,I=0;I<C.i.length;I++){var D=C.i[I];"node_param"==D.type&&(D=D.qualifier.join(" ")+" ","vert"==a?D+=y.Th[F]:"frag"==
a&&(D+=y.Va[F],null!==y.Ck[F]&&(D+=" = "+y.Ck[F])),D+=";",l.push(D),F++)}}break;case "nodes_main":q=k;for(R=0;R<q.length;R++)if(y=q[R],C=u[y.id]){F={};I={};for(D=0;D<y.be.length;D++)I[y.be[D][0]]=[y.be[D][1]];qa=H=p=0;for(var D=y,fa=C.i,U=F,aa=I,v=0;v<fa.length;v++){var G=fa[v];switch(G.type){case "node_in":var oa=D.G[p];if(null!==D.Xm[p]){if(("MATERIAL"==D.id&&3===p||"MATERIAL_EXT"==D.id&&3===p||"TEXTURE_COLOR"==D.id||"TEXTURE_NORMAL"==D.id)&&G.f){U[G.name]=D.Xm[p];p++;continue}var Ka=G.qualifier.join(" ")+
" ",Ka=Ka+oa,Ka=Ka+(" = "+D.Xm[p]),Ka=Ka+";";l.push(Ka)}U[G.name]=oa;p++;break;case "node_out":oa=D.xa[H];if(!G.f||-1<z.indexOf(oa))Ka=G.qualifier.join(" ")+" ",Ka+=oa,Ka+=";",l.push(Ka),U[G.name]=oa;-1<z.indexOf(oa)&&(aa["USE_OUT_"+G.name]=[1]);H++;break;case "node_param":"vert"==a?oa=D.Th[qa]:"frag"==a&&(oa=D.Va[qa]),U[G.name]=oa,qa++}}l.push("{");h(y,C.g,F,I);l.push("}")}break;case "lamp":x[q.name]=q;break;case "lamps_main":q=m;for(R=0;R<q.length;R++)if(y=q[R],y.hz){l.push("{");C=x[y.type].g;for(F=
0;F<C.length;F++){I=C[F];D=[];for(fa=0;fa<I.b.length;fa++){U=I.b[fa];switch(U){case "LAMP_IND":U=y.index;break;case "LAMP_LIGHT_FACT_IND":U=y.pz;break;case "LAMP_FAC_CHANNELS":U=y.oz;break;case "LAMP_SPOT_SIZE":U=n(y.jd);break;case "LAMP_SPOT_BLEND":U=n(y.zg||.01);break;case "LAMP_LIGHT_DIST":U=n(y.distance);break;case "LAMP_SHADOW_MAP_IND":U=y.Ux?1:0}D.push(U)}l.push(D.join(" "))}l.push("}")}break;case "textline":q=g(q.b,w,r,!1);l.push(q.join(" "));break;default:throw"Unknown element type: "+q.type;
}}}function e(a,b){var c;c=g(a,w,r,!0,b);for(var d=[],f=0;f<c.length;f++)if(c[f]instanceof Object)switch(c[f].type){case "conditional_expr":var h=d.pop(),k=d.pop();d.pop()?d.push(k):d.push(h);break;case "logical_or_expr":h=d.pop();for(k=0;k<c[f].d-1;k++)m=d.pop(),h=h||m;d.push(h);break;case "logical_and_expr":h=d.pop();for(k=0;k<c[f].d-1;k++)m=d.pop(),h=h&&m;d.push(h);break;case "logical_bitor_expr":h=d.pop();for(k=0;k<c[f].d-1;k++)h|=d.pop();d.push(h);break;case "logical_bitxor_expr":h=d.pop();for(k=
0;k<c[f].d-1;k++)h^=d.pop();d.push(h);break;case "logical_bitand_expr":h=d.pop();for(k=0;k<c[f].d-1;k++)h&=d.pop();d.push(h);break;case "equal_expr":h=d.pop();k=d.pop();d.push(k==h);break;case "non_equal_expr":h=d.pop();k=d.pop();d.push(k!=h);break;case "le_expr":h=d.pop();k=d.pop();d.push(k<=h);break;case "ge_expr":h=d.pop();k=d.pop();d.push(k>=h);break;case "l_expr":h=d.pop();k=d.pop();d.push(k<h);break;case "g_expr":h=d.pop();k=d.pop();d.push(k>h);break;case "left_shift_expr":k=d.pop();h=d.pop();
d.push(k<<h);break;case "right_shift_expr":k=d.pop();h=d.pop();d.push(k>>h);break;case "add_expr":k=d.pop();h=d.pop();d.push(k+h);break;case "sub_expr":k=d.pop();h=d.pop();d.push(k-h);break;case "mul_expr":k=d.pop();h=d.pop();d.push(k*h);break;case "div_expr":k=d.pop();h=d.pop();d.push(k/h);break;case "mod_expr":k=d.pop();h=d.pop();d.push(k%h);break;case "pre_inc_expr":case "post_inc_expr":m=d.pop();d.push(++m);break;case "pre_dec_expr":case "post_dec_expr":m=d.pop();d.push(--m);break;case "positive_expr":m=
d.pop();d.push(+m);break;case "negative_expr":m=d.pop();d.push(-m);break;case "one_compl_expr":m=d.pop();d.push(~m);break;case "logic_negative_expr":m=d.pop();d.push(!m);break;default:D.fa("Unknown operation type: "+c[f].type)}else{var m=c[f];/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(m)?d.push(0):d.push(parseFloat(c[f]))}1==d.length?c=d[0]:(D.fa("Incorrect expression: "+c.join(" ")),c=void 0);return c}function h(a,b,c,d){for(var f=0;f<b.length;f++){var k=b[f];switch(k.type){case "node_condition":a:for(var m=
a,k=k.a,q=c,n=d,J=0;J<k.length;J++){var B=k[J];switch(B.type){case "node_if":case "node_elif":if(e(B.c,n)){h(m,B.g,q,n);break a}break;case "node_else":h(m,B.g,q,n);break a;case "node_ifdef":(B.name in w||B.name in n)&&h(m,B.g,q,n);break;case "node_ifndef":B.name in w||B.name in n||h(m,B.g,q,n)}}break;case "textline":m=[];for(q=0;q<k.b.length;q++)n=k.b[q],n in c?m.push(c[n]):m.push(n);m=g(m,w,r,!0,d);l.push(m.join(" "))}}}var k=d.yn,m=d.hn;d=d.Oe||[];for(var l=[],w={},q=0;q<d.length;q++)w[d[q][0]]=
[d[q][1]];for(q=0;q<k.length;q++)w["USE_NODE_"+k[q].id]=[1];var r={},u={},x={},z=[];for(q in k)for(var y in k[q].G)z.push(k[q].G[y]);f(c);var p=0,H=0,qa=0;return l.join("\n")}function g(a,b,c,d,f){var e=[];h(a,b,c,d,e,f);return e}function h(a,b,c,d,f,e){for(var g=0;g<a.length;g++){var k=a[g];k in b||e&&k in e?(k=e&&e[k]||b[k],0==k.length&&d?f.push(0):h(k,b,c,d,f,e)):f.push(k)}}function k(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);x.hw(d,b,c);return d}function n(a,b){!b&&a.length?
b=a.length:b||(b=1);switch(b){case 1:return f(a);case 2:return"vec2("+f(a[0])+","+f(a[1])+")";case 3:return"vec3("+f(a[0])+","+f(a[1])+","+f(a[2])+")";case 4:return"vec4("+f(a[0])+","+f(a[1])+","+f(a[2])+","+f(a[3])+")";case 9:return"mat3("+f(a[0])+","+f(a[1])+","+f(a[2])+","+f(a[3])+","+f(a[4])+","+f(a[5])+","+f(a[6])+","+f(a[7])+","+f(a[8])+")";case 16:return"mat4("+f(a[0])+","+f(a[1])+","+f(a[2])+","+f(a[3])+","+f(a[4])+","+f(a[5])+","+f(a[6])+","+f(a[7])+","+f(a[8])+","+f(a[9])+","+f(a[10])+","+
f(a[11])+","+f(a[12])+","+f(a[13])+","+f(a[14])+","+f(a[15])+")";default:throw"Wrong glsl value dimension";}}function f(a){return a%1?String(a):String(a)+".0"}var l=p("__config"),t=p("__print"),x=p("__debug"),z=p("__assets"),D=p("__util"),A=l.Tb,H={},u={},y=null,q="anchors.glslf anchors.glslv color_id.glslf color_id.glslv depth.glslf depth.glslv grass_map.glslf grass_map.glslv halo.glslf halo.glslv main.glslf main.glslv particles_color.glslf particles_color.glslv particles_texture.glslf particles_texture.glslv procedural_skydome.glslf procedural_skydome.glslv special_lens_flares.glslf special_lens_flares.glslv special_skydome.glslf special_skydome.glslv special_water.glslf special_water.glslv wireframe.glslf wireframe.glslv postprocessing/anaglyph.glslf postprocessing/antialiasing.glslf postprocessing/bloom_combine.glslf postprocessing/compositing.glslf postprocessing/depth_pack.glslf postprocessing/dof.glslf postprocessing/glow.glslf postprocessing/bloom_blur.glslf postprocessing/god_rays.glslf postprocessing/god_rays.glslv postprocessing/god_rays_combine.glslf postprocessing/luminance.glslf postprocessing/luminance_av.glslf postprocessing/luminance_trunced.glslf postprocessing/luminance_trunced.glslv postprocessing/motion_blur.glslf postprocessing/outline.glslf postprocessing/postprocessing.glslf postprocessing/postprocessing.glslv postprocessing/smaa.glslf postprocessing/smaa.glslv postprocessing/ssao.glslf postprocessing/ssao_blur.glslf include/blending.glslf include/caustics.glslf include/depth_fetch.glslf include/dynamic_grass.glslv include/environment.glslf include/fog.glslf include/gamma.glslf include/lighting.glslf include/math.glslv include/mirror.glslf include/nodes.glslf include/nodes.glslv include/pack.glslf include/particles.glslv include/precision_statement.glslf include/procedural.glslf include/refraction.glslf include/scale_texcoord.glslv include/shadow.glslf include/shadow.glslv include/skin.glslv include/std_enums.glsl include/to_world.glslv include/wind_bending.glslv".split(" "),
w=[],m=null,r=!1;a.gd=function(a){m=a};a.D=c;a.ty=d;a.yE=function(a,b){for(var c=a.Oe,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.GA=function(a){a.Oe=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NODES_GLOW NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PERSPECTIVE_SHADOW_CAST PROCEDURAL_FOG PROCEDURAL_SKYDOME REFLECTION REFLECTION_PASS REFLECTION_TYPE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA MTEX_NEGATIVE MTEX_RGBTOINT NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_USAGE POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT WO_SKYBLEND WO_SKYPAPER WO_SKYREAL WO_SKYTEX WOMAP_BLEND WOMAP_HORIZ WOMAP_ZENUP WOMAP_ZENDOWN WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
d=0;d<b.length;d++){var f=b[d],e;switch(f){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "MTEX_NEGATIVE":case "MTEX_RGBTOINT":case "NODES_GLOW":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PERSPECTIVE_SHADOW_CAST":case "PROCEDURAL_FOG":case "PROCEDURAL_SKYDOME":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTION_TYPE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "WO_SKYBLEND":case "WO_SKYPAPER":case "WO_SKYREAL":case "WO_SKYTEX":case "WOMAP_BLEND":case "WOMAP_HORIZ":case "WOMAP_ZENUP":case "WOMAP_ZENDOWN":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":e=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":e=1;break;case "SHADOW_TEX_RES":e=n(2048);break;case "AA_METHOD":e="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":e="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":e="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":e="POST_EFFECT_NONE";break;case "SHADOW_USAGE":e="NO_SHADOWS";break;case "SSAO_QUALITY":e=
"SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":e="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":e="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":e=l.p.precision;break;case "EPSILON":e="highp"==l.p.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":e="u_va_frame_factor";break;default:t.error("Unknown directive ("+a.ij+", "+a.ui+"): "+f)}c(a,f,e)}};a.kE=function(a){return a.ij};a.Gq=function(a){return a.ui};a.rE=function(a,b){for(var f=b.Oe,e=0;e<f.length;e++){var h=f[e][0],g=
f[e][1];d(a,h)&&c(a,h,g)}};a.py=function(a){var c=JSON.stringify(a),d=H[c];if(d)return d;var f=a.ui,d=b(A.shaders_dir,a.ij),f=b(A.shaders_dir,f);if(!d||!f)return null;var h=e("vert",d,a),g=e("frag",f,a),d=m,l=k(d,c,h,d.VERTEX_SHADER),q=k(d,c,g,d.FRAGMENT_SHADER),f=d.createProgram();d.attachShader(f,l);d.attachShader(f,q);d.linkProgram(f);d.validateProgram(f);d.getProgramParameter(f,d.VALIDATE_STATUS)==d.$C&&t.error("shader program is not valid",c);x.iw(f,c,l,q,h,g);a={Bo:l,uq:q,Ui:f,attributes:{},
dj:{},Pi:[],En:{},gt:[],Ab:a};g=d.getProgramParameter(f,d.ACTIVE_ATTRIBUTES);for(h=0;h<g;h++)l=d.getActiveAttrib(f,h).name,a.attributes[l]=d.getAttribLocation(f,l);g=d.getProgramParameter(f,d.ACTIVE_UNIFORMS);for(h=0;h<g;h++)l=d.getActiveUniform(f,h).name.split("[0]").join(""),a.dj[l]=d.getUniformLocation(f,l);return H[c]=d=a};a.rz=function(){r=!1;if(b4w.module_check("shader_texts"))r=!0;else{for(var a=[],b=z.AT_TEXT,c=0;c<q.length;c++){var d=D.uk(A.shaders_dir+q[c]);a.push([q[c],b,d])}b=function(a,
b){y||(y={});y[b]=a};a.length?z.enqueue(a,b,function(){r=!0}):t.error("Shaders have not been found.")}};a.jw=function(){return r};a.HD=function(){return w};a.Dq=function(){return H};a.cleanup=function(){for(var a in H){var b=H[a];m.deleteProgram(b.Ui);m.deleteShader(b.Bo);m.deleteShader(b.uq);delete H[a]}for(var c in u)delete u[c];for(var d in w)delete w[d]};a.ID=function(a){var b=a.Oe;t.log("Shader: "+a.ij+" "+a.ui+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)t.log("  "+b[a][0],
b[a][1])};a.t=n;a.Dp=function(a,b){return b in a.dj?!0:!1};a.Iy=function(a){return(m.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,p){function c(a){return 65536<a.L?E.Fq()?!1:!0:!1}function d(a){return 0<a.ea.length?!0:!1}function b(a,b,c){if(!d(a))return a;c||w.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.L*(b||1)+", will use drawArrays","color: #aa0");b=a.ea;c=a.L;var f=a.J,h=a.A,g;for(g in f){var k=f[g],m=z(k,c);f[g]=e(b,k,m)}for(f=0;f<h.length;f++){var l=h[f];for(g in l)k=l[g],m=z(k,c),l[g]=e(b,k,m)}for(f=0;f<a.X.length;f++){g=a.X[f].Qb;for(var q in g)k=g[q],m=
z(k,c),g[q]=e(b,k,m)}a.L=b.length;a.ea=new Uint16Array(0);return a}function e(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),f=0;f<a.length;f++)for(var e=a[f],h=0;h<c;h++)d[c*f+h]=b[c*e+h];return d}function g(a,b){var c=a.ld,d=a.Ub[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function h(b,c){var d,f;switch(c){case a.Vh:case a.qj:d=O.TRIANGLES;f=O.STATIC_DRAW;break;case a.Ko:d=O.POINTS;f=O.STATIC_DRAW;
break;case a.pj:d=O.TRIANGLES;f=O.DYNAMIC_DRAW;break;case a.Jo:d=O.POINTS;f=O.DYNAMIC_DRAW;break;case a.Ft:d=O.LINES;f=O.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.hj=f}function k(a){a.Ve?(a.ke||(a.ke=O.createBuffer()),O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,a.ke),O.bufferData(O.ELEMENT_ARRAY_BUFFER,a.Ve,a.hj),a.Sj=a.Ve.byteLength):a.Sj=0;a.sf||(a.sf=O.createBuffer());O.bindBuffer(O.ARRAY_BUFFER,a.sf);O.bufferData(O.ARRAY_BUFFER,a.ld,a.hj);a.Zp=a.ld.byteLength}function n(a){for(var b=
r.mb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].ea.length;b.ea=new Uint32Array(c);var f=c=0,e=0;if(0<a[0].X.length)for(var h=0;h<a[0].X.length;h++){for(d=0;d<a.length;d++)c+=a[d].X[h].Qb.a_position.length,f+=a[d].X[h].Qb.a_normal.length,e+=a[d].X[h].Qb.a_tangent.length;d={a_position:new Float32Array(c),a_normal:new Float32Array(f),a_tangent:new Float32Array(e)};b.X.push({hk:a[0].X[h].hk,Qb:d})}for(d=c=0;d<a.length;d++)c+=a[d].L;b.L=c;var f=a[0],g;for(g in f.J){for(d=c=0;d<a.length;d++)c+=
a[d].J[g].length;b.J[g]=new Float32Array(c)}for(g in f.A[0]){for(d=c=0;d<a.length;d++)c+=a[d].A[0][g].length;for(d=0;d<f.A.length;d++)b.A[d]=b.A[d]||{},b.A[d][g]=new Float32Array(c)}for(g=f=c=0;g<a.length;g++){for(var e=a[g],k=e.ea,h=e.L,m=e.J,d=0;d<k.length;d++)b.ea[c+d]=k[d]+f;var c=c+k.length,l;for(l in m){var k=m[l],q=f*z(k,h);b.J[l].set(k,q)}for(d=0;d<e.A.length;d++){var m=e.A[d],w=b.A[d];for(l in m)k=m[l],q=f*z(k,h),w[l].set(k,q)}f+=h}if(0<b.X.length)for(g=0;g<b.X.length;g++)for(l=b.X[g].Qb,
d=e=f=c=0;d<a.length;d++)h=a[d].X[g].Qb,l.a_position.set(h.a_position,c),l.a_normal.set(h.a_normal,f),l.a_tangent.set(h.a_tangent,e),c+=h.a_position.length,f+=h.a_normal.length,e+=h.a_tangent.length;return b}function f(a,c,d,f,e,h){var g=r.mb("SUBMESH_"+a.name+"_"+c),k=a.submeshes[c],m=k.base_length,q=a.materials[c];g.L=m;var n=!1;if(t(d,"a_texcoord")){var y=null,z=a.materials[c];c=a.submeshes[c];if(z.texture_slots.length)switch(z=z.texture_slots[0],z.texture_coords){case "UV":z=a.uv_textures.indexOf(z.uv_layer);
0==z||-1==z?y=new Float32Array(c.texcoord):1==z&&(y=new Float32Array(c.texcoord2));break;case "ORCO":for(var F=a.b4w_bounding_box_source,y=new Float32Array(2*c.base_length),z=(F.max_x+F.min_x)/2,D=(F.max_z+F.min_z)/2,I=F.max_x-F.min_x,F=F.max_z-F.min_z,E=0,A=0;A<c.position.length;A+=3)y[E++]=(c.position[A]-z)/I+.5,y[E++]=(D-c.position[A+2])/F+.5}null===y&&(y=new Float32Array(c.texcoord));c=y}else c=new Float32Array(0);if(t(d,"a_orco_tex_coord")){y=a.b4w_bounding_box_source;z=new Float32Array(3*k.base_length);
D=y.max_x-y.min_x;I=y.max_z-y.min_z;F=y.max_y-y.min_y;for(A=E=0;A<k.position.length;A+=3)0==D?z[E++]=-1:z[E++]=parseFloat(((k.position[A]-y.min_x)/D).toFixed(3)),0==I?z[E++]=-1:z[E++]=parseFloat(((-y.min_z-k.position[A+2])/I).toFixed(3)),0==F?z[E++]=-1:z[E++]=parseFloat(((k.position[A+1]-y.min_y)/F).toFixed(3));y=z}else y=new Float32Array(0);var C,z=k.group;if(t(d,"a_influence")&&f){D=new Float32Array(4*m);I=z.length/m;F=new Float32Array(I);for(E=0;E<I;E++)for(C in F[E]=-1,f)if(A=f[C],A.xt===E){F[E]=
A.mi;break}var W=3<I?I:4;f=new Float32Array(W);C=new Uint32Array(W);for(var E=new Float32Array(4),A=new Float32Array(W),W=new Uint32Array(W),ba=new Float32Array(4),p=0;p<m;p++)f.set(A),C.set(W),E.set(ba),D.set(x(z,I,p,m,F,f,C,E),4*p)}else D=new Float32Array(0);C=D;f=e?r.ka(e):{};f.a_color={Uf:!0};f.a_color.src=t(d,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,Rc:7}]:[];e={a_texcoord:c,a_influence:C,a_orco_tex_coord:y};C=k.vertex_colors;c=k.color;y=a.name;z=[];for(D=0;D<C.length;D++)z.push(C[D].name);
for(var L in f)if(D=f[L].src,D.length){for(F=I=0;F<D.length;F++)I+=r.wg(D[F].Rc);e[L]=new Float32Array(I*m);for(F=E=0;F<D.length;F++){var H=D[F].name,A=D[F].Rc,W=r.vs(A),aa=z.indexOf(H);-1==aa&&r.fa('vertex color "'+H+'" for mesh "'+y+'" not found.');ba=C[aa].mask;p=r.wg(ba);(A&ba)!==A&&w.error("Wrong color extraction from "+H+" to "+L+".");for(var v=H=0;v<aa;v++)H+=r.wg(C[v].mask);aa=H*m;for(H=0;H<m;H++)for(v=0;3>v;v++)W[v]&&(e[L][H*I+(E+r.Zi(A,v))]=c[aa+H*p+r.Zi(ba,v)]);E+=p}}else e[L]=new Float32Array(0);
L=a.uv_textures;f=k.texcoord;C=k.texcoord2;c=a.name;if(h)for(var G in h){y=L.indexOf(G);-1==y&&r.fa('uv map "'+G+'" for mesh "'+c+'" not found');if(0==y)var oa=new Float32Array(f);else 1==y&&(oa=new Float32Array(C));e[h[G]]=oa}g.J=e;g.ea=new Uint32Array(k.indices);h=k.position.length/m/3;oa=(G=t(d,"a_normal")&&k.normal.length?!0:!1)&&t(d,"a_tangent")&&k.tangent.length?!0:!1;L=q.texture_slots[0];L=G&&q.texture_slots.length&&t(d,"a_tangent")&&"ORCO"==L.texture_coords&&L.use_map_normal?!0:!1;0<a.b4w_shape_keys.length&&
(n=!0);for(e=0;e<h;e++){q=l(k,d,m,G,oa,L,e,a.name);if(n)if(f={},f.name=a.b4w_shape_keys[e].name,g.X.push(f),0!=e){f.Qb=q;f.hk=a.b4w_shape_keys[e].value;continue}else f.Qb=l(k,d,m,G,oa,L,e,a.name),f.hk=1;g.A.push(q)}if(1<h&&!n){a=g.A[0];var q={},Ka;for(Ka in a)q[Ka]=new Float32Array(a[Ka]);g.A.push(q)}t(d,"a_polyindex")&&(b(g,1,!0),g.J.a_polyindex=u(g));return g}function l(a,b,c,d,f,e,h,g){var k={},m=new Float32Array(3*c),l=new Float32Array(d?3*c:0),q=new Float32Array(f||e?4*c:0),n=h*c*3;m.set(a.position.subarray(n,
n+3*c),0);d&&(n=h*c*3,l.set(a.normal.subarray(n,n+3*c),0));if(f)n=h*c*4,q.set(a.tangent.subarray(n,n+4*c),0);else if(e)for(a=q,w.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+g+'". Please add a UV-map.'),g=0;g<c;g++)b=F,d=M,b[0]=l[3*g],b[1]=l[3*g+1],b[2]=l[3*g+2],I.cross(b,r.AXIS_Z,d),0==I.length(d)&&I.cross(b,r.AXIS_X,d),I.normalize(d,d),a[4*g]=d[0],a[4*g+1]=d[1],a[4*g+2]=d[2],a[4*g+3]=1;else if(d&&t(b,"a_tangent"))for(q=new Float32Array(4*c),
c=0;c<q.length;c++)q[c]=1;k.a_position=m;k.a_normal=l;k.a_tangent=q;return k}function t(a,b){return-1<a.indexOf(b)?!0:!1}function x(b,c,d,f,e,h,g,k){for(var m=!0,l=0;l<c;l++){var q=b[l*f+d];if(-1!==q){var w=e[l];-1!==w&&(h[l]=q,g[l]=w,m=!1)}}if(m)return k;D(h,g,a.ll,!1);for(l=b=0;4>l;l++)b+=h[l];if(.01>b)return k;for(l=0;4>l;l++)h[l]/=b;if(.01>Math.abs(h[0]-1))k[0]=g[0]+1;else for(l=0;4>l;l++)k[l]=g[l]+h[l];return k}function z(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+
c+", base length="+b;return d}function D(b,c,d,f){for(var e=b.length,h=e,g=!1,k=f?-1:1;1<h||g;){1<h&&(h=Math.floor(h/1.247330950103979));for(var g=!1,m=0;h+m<e;m++)if(d==a.ll?0>k*(b[m]-b[m+h]):b[m]<b[m+h]&&f)g=b[m],b[m]=b[m+h],b[m+h]=g,g=c[m],c[m]=c[m+h],c[m+h]=g,g=!0}}function A(a,b,c){var d=[],f=[];I.subtract(b,a,d);I.subtract(c,a,f);I.normalize(d,d);I.normalize(f,f);return Math.acos(I.dot(d,f))}function H(a,b,c){b||(b=[]);c=c?a.A[0].a_normal:a.A[0].a_position;if(d(a)){a=a.ea;for(var f=a.length/
3,e=0;e<f;e++){var h=new Float32Array(9),g=a[3*e];h[0]=c[3*g];h[1]=c[3*g+1];h[2]=c[3*g+2];g=a[3*e+1];h[3]=c[3*g];h[4]=c[3*g+1];h[5]=c[3*g+2];g=a[3*e+2];h[6]=c[3*g];h[7]=c[3*g+1];h[8]=c[3*g+2];b[e]=h}}else for(e=0;e<c.length;e++)h=new Float32Array(9),h[0]=c[9*e],h[1]=c[9*e+1],h[2]=c[9*e+2],h[3]=c[9*e+3],h[4]=c[9*e+4],h[5]=c[9*e+5],h[6]=c[9*e+6],h[7]=c[9*e+7],h[8]=c[9*e+8],b[e]=h;return b}function u(a){for(var b=new Float32Array(a.L),c=0;c<a.L;c++)b[c]=c%3;return b}function y(a,b,c){var d=I.dist(a,
b);a=I.dist(a,c);b=I.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}function q(a,b,c,d,f){c-=b;for(var e=0;e<c;e+=d)e%d==f&&vec3.normalize(a.subarray(e+b-f,e+b+1),a.subarray(e+b-f,e+b+1))}var w=p("__print"),m=p("__tsr"),r=p("__util"),E=p("__extensions"),I=p("vec3"),F=new Float32Array(3),M=new Float32Array(3),L=new Float32Array(3);a.Pd=10;a.Ro=20;a.eD=30;a.qj=10;a.Ko=20;a.pj=30;a.Jo=40;a.Ft=50;a.ll=0;a.Ru=1;a.Vh=a.qj;var O=null;a.gd=function(a){O=a};a.JD=function(a){var b=_buffers[a];O.deleteBuffer(b.ke);
O.deleteBuffer(b.sf);delete _buffers[a]};a.BB=function(f,e,g,m){c(f)&&b(f);var l=f.ea,q=f.L,w=f.A,n={},r;for(r in f.J)r in m&&!m[r].Uf||(n[r]=f.J[r]);m={Ve:null,ld:null,Um:0,count:0,Ub:{},mode:0,hj:0,Sj:0,Zp:0,sf:null,ke:null,fk:null,X:null};if(0<f.X.length){r=w[0];for(var u=1;u<f.X.length;u++){for(var t=f.X[u].Qb,y=t.a_position,x=t.a_normal,F=r.a_position,D=r.a_normal,I=y.length,E=f.X[u].hk,A=0;A<I;A++)F[A]+=E*y[A],D[A]+=E*x[A];t=t.a_tangent;y=r.a_tangent;x=t.length;for(A=0;A<x;A++)y[A]+=E*t[A]}}if(l.length)if(r=
l.length,65536>=q)var u=new Uint16Array(l),C=O.UNSIGNED_SHORT;else u=new Uint32Array(l),C=O.UNSIGNED_INT;else r=q,u=null;var E=0,A=w.length,W;for(W in w[0])t=w[0][W],E+=t.length*A;for(W in n)t=n[W],E+=t.length;W=new Float32Array(E);var E=0,A={},ba;for(ba in n)if(y=n[ba],t=y.length)W.set(y,E),A[ba]={rD:ba,zd:z(y,q),offset:E,frames:1,length:t},E+=t;n=w.length;for(ba in w[0])if(y=w[0][ba],t=y.length,y=z(y,q),t)for(A[ba]={zd:y,offset:E,frames:n,length:t},1<n&&(A[ba+"_next"]={zd:y,offset:E+t,frames:n,
length:t}),x=0;x<n;x++)y=w[x][ba],W.set(y,E),E+=t;m.count=r;m.Ve=u;m.ld=W;m.Um=C;m.Ub=A;h(m,g);k(m);e!=a.Pd&&d(f)&&(m.fk={Cz:new Float32Array(l.length),Dz:new Float32Array(l.length),ux:new Float32Array(l.length/3),type:e});m.X=f.X;return m};a.fz=c;a.ez=d;a.ho=b;a.XB=function(a,b,c){h(a,b);a.count=c.length;a.Ve=c;a.Um=c instanceof Uint16Array?O.UNSIGNED_SHORT:O.UNSIGNED_INT};a.Zk=function(a,b,c,d){var f=a.ld,e=a.Ub,h=e[b];h?(c&&h.zd!=c&&r.fa('invalid num_comp for "'+b+'"'),f.set(d,h.offset)):(f=f.length,
h=new Float32Array(f+d.length),h.set(a.ld),h.set(d,f),a.ld=h,e[b]={zd:c,offset:f});k(a)};a.Fx=g;a.LE=function(a){a.hj=O.STATIC_DRAW};a.wz=function(a){a.hj=O.DYNAMIC_DRAW};a.mt=k;a.Fp=function(a){a.ke&&O.deleteBuffer(a.ke);a.sf&&O.deleteBuffer(a.sf)};a.Wq=function(a,b){return a.submeshes[b].base_length?!1:!0};a.$s=function(a,b){for(var c=0;c<a.A.length;c++){var d=a.A[c].a_position;m.transform_vectors(d,b,d,0);d=a.A[c].a_normal;0<d.length&&m.transform_dir_vectors(d,b,d,0);d=a.A[c].a_tangent;0<d.length&&
m.transform_tangents(d,b,d,0)}(c=a.J.au_center_pos)&&c.length&&m.transform_vectors(c,b,c,0);return a};a.zB=function(a,b){var c=a.J.au_center_pos;if(c&&c.length){var d=new Float32Array(c);m.transform_vectors(d,b,d,0);for(var f=0;f<a.A.length;f++)for(var e=0;e<d.length;e++)a.A[f].a_position[e]+=d[e]-c[e];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.yB=function(a,b){var c=a.L,d;for(d in b){var f=b[d].length;a.J[d]=new Float32Array(f*c);for(var e=0;e<c;e++)for(var h=
0;h<f;h++)a.J[d][e*f+h]=b[d][h]}};a.AB=n;a.vz=function(a,c,d){if(!a.L)return r.mb("EMPTY");var f=d.length;65536<a.L*f&&!E.Fq()&&b(a,f);var e=a.ea,h=a.L,g=a.J;a=a.A;for(var k in c){var l=c[k].length,q=l*h;g[k]=new Float32Array(q);for(var w=0;w<h;w++)for(q=0;q<l;q++)g[k][w*l+q]=c[k][q]}c=r.mb("CLONE_"+f+"_SUBMESHES");c.L=h*f;c.ea=new Uint32Array(e.length*f);for(w=0;w<f;w++)for(l=e.length*w,k=h*w,q=0;q<e.length;q++)c.ea[l+q]=e[q]+k;for(var n in g)for(e=g[n],q=e.length*f,l=z(e,h),c.J[n]=new Float32Array(q),
w=0;w<f;w++)k=h*l*w,c.J[n].set(e,k);for(n in a[0])for(w=0;w<a.length;w++)for(e=a[w][n],q=e.length*f,l=z(e,h),c.A[w]=c.A[w]||{},c.A[w][n]=new Float32Array(q),q=0;q<f;q++)switch(g=d[q],k=h*l*q,n){case "a_position":m.transform_vectors(e,g,c.A[w][n],k);break;case "a_normal":m.transform_dir_vectors(e,g,c.A[w][n],k);break;case "a_tangent":m.transform_tangents(e,g,c.A[w][n],k);break;default:throw"Wrong attribute name: "+n;}return c};a.lq=f;a.Ix=function(a){var b=a.L,c=a.A[0].a_position,d=new Float32Array(12*
b),f=new Float32Array(8*b);a=new Uint16Array(4*a.ea.length);for(var e=0;e<b;e++)d[12*e]=c[3*e],d[12*e+1]=c[3*e+1],d[12*e+2]=c[3*e+2],d[12*e+3]=c[3*e],d[12*e+4]=c[3*e+1],d[12*e+5]=c[3*e+2],d[12*e+6]=c[3*e],d[12*e+7]=c[3*e+1],d[12*e+8]=c[3*e+2],d[12*e+9]=c[3*e],d[12*e+10]=c[3*e+1],d[12*e+11]=c[3*e+2],f[8*e]=-.5,f[8*e+1]=-.5,f[8*e+2]=-.5,f[8*e+3]=.5,f[8*e+4]=.5,f[8*e+5]=.5,f[8*e+6]=.5,f[8*e+7]=-.5,a[6*e]=4*e+2,a[6*e+1]=4*e+1,a[6*e+2]=4*e,a[6*e+3]=4*e+2,a[6*e+4]=4*e,a[6*e+5]=4*e+3;c=r.mb("HALO");c.A=
[];c.A[0]={};c.L=4*b;c.A[0].a_position=d;c.J.a_halo_bb_vertex=f;c.ea=a;return c};a.Qy=t;a.mq=function(a,b,c){for(var d=[],e=0;e<a.submeshes.length;e++){var h=f(a,e,b,null,c,null);h.L&&d.push(h)}return 0==d.length?r.mb("EMPTY"):1==d.length?d[0]:n(d)};a.WB=function(a,b,c){for(var d=a.Ve,f=g(a,"a_position"),e=a.fk,h=e.Cz,k=e.Dz,e=e.ux,m=d,l=m.length/3,q=0;q<l;q++){var w=m[3*q],n=m[3*q+1],t=m[3*q+2],u=f[3*w+1],y=f[3*w+2],x=f[3*n+1],z=f[3*n+2],C=f[3*t+1],F=f[3*t+2];h[3*q]=(f[3*w]+f[3*n]+f[3*t])/3;h[3*
q+1]=(u+x+C)/3;h[3*q+2]=(y+z+F)/3}r.df(h,b,k);b=k.length/3;for(f=0;f<b;f++)h=k[3*f]-c[0],m=k[3*f+1]-c[1],l=k[3*f+2]-c[2],e[f]=h*h+m*m+l*l;c=d;d=e.length;if(!(2>d))for(k=d,f=!1;1<k||f;)for(1<k&&(k=Math.floor(k/1.247330950103979)),f=!1,b=0;k+b<d;b++)0>e[b]-e[b+k]&&(f=e[b],e[b]=e[b+k],e[b+k]=f,f=c,h=b,m=b+k,l=f[3*h],q=f[3*h+1],w=f[3*h+2],f[3*h]=f[3*m],f[3*h+1]=f[3*m+1],f[3*h+2]=f[3*m+2],f[3*m]=l,f[3*m+1]=q,f[3*m+2]=w,f=!0);d=c;O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,a.ke);O.bufferData(O.ELEMENT_ARRAY_BUFFER,
d,O.DYNAMIC_DRAW)};a.Os=D;a.sp=function(a,b,c){for(var d=b.length/3,f=a.length/3,e=[],h=Array(3),g=Array(3),k=Array(3),m=0;m<f;m++){for(var l=a[3*m],q=a[3*m+1],w=a[3*m+2],n=0;3>n;n++)h[n]=b[3*l+n],g[n]=b[3*q+n],k[n]=b[3*w+n];if(c)var n=A(h,g,k),r=A(g,k,h),t=Math.PI-n-r;else t=r=n=1;var u=e,y;y=h;var C=k,x=[],z=[],F=[];I.subtract(g,y,x);I.subtract(C,y,z);I.cross(x,z,F);I.normalize(F,F);y=F;for(C=0;3>C;C++)x=3*q+C,z=3*w+C,u[3*l+C]=n*y[C],u[x]=r*y[C],u[z]=t*y[C]}if(c)for(var D in c)for(m=c[D],a=0;3>
a;a++){b=3*m[0]+a;for(f=1;f<m.length;f++)h=3*m[f]+a,e[b]+=e[h];for(f=1;f<m.length;f++)h=3*m[f]+a,e[h]=e[b]}for(m=0;m<d;m++){c=m;D=e;a=new Float32Array(3);for(b=0;3>b;b++)f=3*c+b,a[b]=D[f];I.normalize(a,a);for(b=0;3>b;b++)f=3*c+b,D[f]=a[b]}return e};a.up=function(a,b,c){for(var d={},f=b.length/3,e=0;e<f;e++){var h=String(b[3*e])+String(b[3*e+1])+String(b[3*e+2]);d[h]=[]}f=a.length;for(e=0;e<f;e++)b=a[e],h=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),h in d&&d[h].push(b);return d};a.Gm=function(a,
b,c,d){var f=H(a,null,!1);if(c)var e=H(a,null,!0);var h=f.length,g=new Float32Array(h),k=F,m=M;for(a=0;a<h;a++){var l=f[a];k.set(l.subarray(0,3));m.set(l.subarray(3,6));L.set(l.subarray(6));g[a]=Math.sqrt(y(k,m,L))}k=new Float32Array(h);k[0]=g[0];for(a=1;a<h;a++)k[a]=k[a-1]+g[a];h=k[g.length-1];g=[];for(a=0;a<b;a++){var m=h*r.Uc(d),m=r.Fj(k,m,0,k.length-1),l=c?e[m]:f[m],m=a,q=l,w=d,l=void 0,l=new Float32Array(3),n=q[0],t=q[1],u=q[2],x=q[3],z=q[4],C=q[5],D=q[6],I=q[7],E=q[8],q=r.Uc(w),w=r.Uc(w);1<
q+w&&(q=1-q,w=1-w);var A=1-q-w,t=A*t+q*z+w*I,u=A*u+q*C+w*E;l[0]=A*n+q*x+w*D;l[1]=t;l[2]=u;g[m]=l}return g};a.PD=H;a.kq=u;a.hF=y;a.yA=function(a,b,c){a=a.A[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]};a.zv=function(a,b,c){var d=a.o;a=a.e.hf;for(var f=1;f<a.length;f++)a[f].name==b&&(a[f].value=c);for(f=0;f<d.length;f++)if(!d[f].Rf&&d[f].Id&&!d[f].Tg){var e=d[f].T.Ub;b=d[f].T.ld;O.bindBuffer(O.ARRAY_BUFFER,d[f].T.sf);
if(e.a_position){var h=e.a_position.offset,g=e.a_position.length+h,k=d[f].T.X[0].Qb.a_position;for(c=h;c<g;c++)b[c]=k[c-h];for(k=1;k<d[f].T.X.length;k++){var m=d[f].T.X[k].Qb.a_position,l=a[k].value;if(l)for(c=h;c<g;c++)b[c]+=l*m[c-h]}O.bufferSubData(O.ARRAY_BUFFER,4*h,b.subarray(h))}if(e.a_normal){h=e.a_normal.offset;g=e.a_normal.length+h;k=d[f].T.X[0].Qb.a_normal;for(c=h;c<g;c++)b[c]=k[c-h];for(k=1;k<d[f].T.X.length;k++)if(m=d[f].T.X[k].Qb.a_normal,l=a[k].value)for(c=h;c<g;c++)b[c]+=l*m[c-h];q(b,
h,g,3,2);O.bufferSubData(O.ARRAY_BUFFER,4*h,b.subarray(h))}if(e.a_tangent){h=e.a_tangent.offset;e=e.a_tangent.length+h;k=d[f].T.X[0].Qb.a_tangent;for(c=h;c<e;c++)b[c]=k[c-h];for(k=1;k<d[f].T.X.length;k++)if(g=d[f].T.X[k].Qb.a_tangent,l=a[k].value)for(c=h;c<e;c++)b[c]+=l*g[c-h];q(b,h,e,4,3);O.bufferSubData(O.ARRAY_BUFFER,4*h,b.subarray(h))}}};a.check_shape_keys=function(a){return a.e.Id};a.get_shape_keys_names=function(a){var b=[];if(a.e)for(var c=1;c<a.e.hf.length;c++)b.push(a.e.hf[c].name);return b};
a.get_shape_key_value=function(a,b){if(a.e)for(var c=1;c<a.e.hf.length;c++)if(b==a.e.hf[c].name)return a.e.hf[c].value;return 0};a.Yq=function(a,b){var c=a.e.hf;if(c)for(var d=1;d<c.length;d++)if(c[d].name==b)return!0;return!1};a.Ai=function(a){return a&&a.e&&a.e.td?!0:!1}};b4w.module.__objects=function(a,p){function c(a){a={type:a,rc:0,Oy:[0,0],h:new Float32Array(3),quat:new Float32Array(4),Bb:new Float32Array(8),V:new Float32Array(16),dr:new Float32Array(16),Lb:new Float32Array(3),Sb:new Float32Array(3),gh:0,hh:0,Zm:!1,Mj:null,dd:0,ko:!1,qt:!1,wa:x.MS_STATIC,yo:1,xo:1,zo:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,de:null,it:!1,ce:0,Of:0,Ya:!1,Rb:null,Yb:null,yb:null,om:!0,I:null,Ki:null,pc:null,zc:null,ec:null,wi:0,ri:0,Bm:0,Hi:0,gg:0,cs:"",al:!1,Ec:!1,ic:!1,
hc:!1,Vb:!1,Mb:!1,Cc:!1,re:"",Xd:!1,Kc:!1,Tj:!1,td:!1,wb:!1,Vg:!1,fh:!1,ok:!1,xg:!1,xk:!1,Fb:!1,wk:!1,Kr:!1,lk:!1,is_visible:!1,Dm:!1,lj:0,Kd:0,Be:0,ae:0,$d:0,Vd:0,ne:"",Jb:null,Ej:!1,qd:!1,Gl:!1,ci:"",bi:!1,Sf:0,time:0,wo:0,tt:0,pe:0,vi:!1,el:!1,Id:!1,hf:[],ih:!1,Ie:!1,He:1,ul:0,tl:1,Yk:new Int8Array([-1,-1]),Tk:[],zr:[],Gs:[],Bc:null,Ac:null,Jc:null,Ic:null,Oc:null,es:null,yl:null,xl:null,oe:null,ig:null,pk:null,wc:null,hg:null,qk:null,Pb:null,Dl:null,Bl:null,Cl:null,gb:null,Yc:null,vb:null,Ef:null,
Ff:null,scale:1,Ze:1E4};F.identity(a.quat);E.identity(a.Bb);L.identity(a.V);L.identity(a.dr);return a}function d(a){var b=a.parent;if(b&&b.Kg)return!0;switch(a.type){case "MESH":var c=f.ik(a),d=a.b4w_do_not_batch,e=a.b4w_collision,h=a.b4w_vehicle,g=a.b4w_floating,b=a.b4w_character,k=q.Sy(a),m=y.Xq(a),l=0<a.data.b4w_shape_keys.length,w=a.b4w_dynamic_geometry;if(!(c=c||d||e||h||l||g))a:{a=a.data;for(c=0;c<a.materials.length;c++)if("LENS_FLARES"===a.materials[c].name){c=!0;break a}c=!1}return c||k||
b||m||w;case "EMPTY":return b=f.ik(a),k=y.Xq(a),a=a.b4w_do_not_batch,b||k||a;default:return!0}}function b(a,c,d,f,h,g,k,m,l){for(var q=0;q<a.nodes.length;q++){var w=a.nodes[q];if("VALUE"==w.type){var n=c+w.name;f.push(w.outputs[0].default_value);h.push(n,h.length/2)}else"RGB"==w.type?(n=c+w.name,w=w.outputs[0].default_value.slice(0,3),k.push(w[0],w[1],w[2]),m.push(n,m.length/2)):"GROUP"==w.type&&(n=w.node_group.node_tree,b(n,c+w.name+"%join%",n.animation_data,f,h,g,k,m,l))}if(d)for((a=d.action)&&
e(a,c,g,h,l,m),d=d.nla_tracks,f=0;f<d.length;f++)for(k=d[f].strips,q=0;q<d[f].strips.length;q++)a=k[q].action,e(a,c,g,h,l,m)}function e(a,b,c,d,f,e){var h=a.e.Va,k;for(k in h){var m=b+k.match(/"(.*?)"/)[1],h=g(d,m);null!=h?(m=a.name+"%join%"+k,c.push(m,h)):(h=g(e,m),null!=h&&(m=a.name+"%join%"+k,f.push(m,h)))}}function g(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function h(a,b,c){return{name:a,type:b,modifiers:[],particle_systems:[],constraints:[],data:null,parent:null,
b4w_vehicle_settings:null,b4w_floating_settings:null,b4w_character_settings:null,b4w_vehicle:!1,b4w_character:!1,b4w_floating:!1,o:[],So:c,Mc:[],Fe:[],Qd:[],Wc:null,$a:null,Nc:null,l:null,C:[],n:null,k:null,ra:null,uj:null,ya:null,To:[]}}function k(a){return a instanceof Array?a.slice():a}function n(a){if(!(a instanceof Object))return a;var b=null,c=null,d=null;a.M&&(b=a.M,a.M=null);a.Gb&&(c=a.Gb,a.Gb=null);a.X&&(d=a.X,a.X=null);var f;f=a.constructor;switch(f){case Float32Array:case Uint32Array:case Uint16Array:f=
new f(a);break;case Array:f=new f(a.length);for(var e=0;e<a.length;e++)f[e]=n(a[e]);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:f=a;break;case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:f=null;break;case Function:f=a;break;default:for(e in f=new f,a)f[e]=n(a[e])}b&&(f.M=b,a.M=b);c&&(f.Gb=c,a.Gb=c);d&&(f.X=d,a.X=d);return f}var f=p("__animation"),l=p("__batch"),t=p("__boundings"),x=p("__camera"),z=p("__config"),D=p("__constraints"),A=p("__curve"),H=p("__geometry"),u=
p("__lights"),y=p("__nla"),q=p("__particles"),w=p("__print"),m=p("__scenes"),r=p("__transform"),E=p("__tsr"),I=p("__util"),F=p("quat"),M=p("vec3"),L=p("mat4"),O=z.Fb,B=0,J=0,K=[],P=new Float32Array(4);a.Oj=c;a.$k=function(a,e){var g=d(a);a.Kg=g;a.e=c("MESH"===a.type?g?"DYNAMIC":"STATIC":a.type);a.So=!1;a.$a=null;a.Mc=[];a.C=[];a.n=null;a.k=null;a.ra=null;a.uj=a.uj||null;a.ya=a.ya||null;a.To=a.To||[];var g=a.e,k=a.location,q=a.scale[0];I.Jn(a.rotation_quaternion,P);r.set_translation(a,k);r.set_rotation(a,
P);r.set_scale(a,q);switch(a.type){case "ARMATURE":k=a.pose.bones;for(q=0;q<k.length;q++){var n=k[q],y=n.bone,z=new Float32Array(y.matrix_local),p=new Float32Array(16);L.invert(z,p);var H=new Float32Array(n.matrix_basis),ha=new Float32Array(3);M.subtract(y.tail_local,y.head_local,ha);I.BC(ha,p,ha);n.dv=ha;n.Yu=[n].concat(n.parent_recursive);n.Vo=E.from_mat4(z,E.create());n.Uo=E.from_mat4(H,E.create());n.pl=E.create();n.wj=!1}k=f.Uv(a);g.Oc=k;k=f.tp(a,k);a.b4w_animation_mixing?(g.Bc=new Float32Array(k.Ba),
g.Ac=new Float32Array(k.Ba),g.Jc=new Float32Array(k.h),g.Ic=new Float32Array(k.h)):(g.Bc=k.Ba,g.Ac=k.Ba,g.Jc=k.h,g.Ic=k.h);g.es=k;g.Sf=0;g.Ie=a.b4w_animation_mixing;break;case "MESH":g.xg=O.outlining_overview_mode||a.b4w_selectable;g.xk=a.b4w_selectable;g.Fb=O.outlining_overview_mode||a.b4w_outlining;g.wk=a.b4w_outlining;g.Kr=O.outlining_overview_mode||a.b4w_outline_on_select;g.qd=a.b4w_billboard;g.Gl=a.b4w_pres_glob_orientation;g.ci="BASIC";g.bi="SPHERICAL"==a.b4w_billboard_geometry;g.Ki={yk:a.b4w_outline_settings.outline_duration,
zk:a.b4w_outline_settings.outline_period,Ak:a.b4w_outline_settings.outline_relapses};g.xg&&(a.e.Mj=I.vq(B),B++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.e.el=a.data.b4w_vertex_anim.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;q=a.e;if(a.data.b4w_shape_keys.length)for(q.Id=!0,k=0;k<a.data.b4w_shape_keys.length;k++)n={},n.value=a.data.b4w_shape_keys[k].value,n.name=a.data.b4w_shape_keys[k].name,q.hf.push(n);else q.Id=!1;if(q=f.get_first_armature_object(a)){a.uj=q;k=
a.e;y=a.data.vertex_groups;if(y.length){z=q.data.bones;p=q.pose.bones;H=0;n={};for(ha=0;ha<z.length;ha++){var Y=z[ha].name,ea=I.keysearch("name",Y,y);if(ea){var Z=I.Km(p,"name",Y);n[Y]={qp:ha,mi:H++,Fn:Z,xt:ea.index}}}y=H;k.Oc=n;n=f.Hq();k.pe=y;y>2*n?(k.ih=!1,w.error('too many bones for "'+a.name+'" / '+k.pe+" bones (max "+n+" with blending, "+2*n+" without blending). Skinning will be disabled.")):k.ih=!0}k=a.e.Oc;k=f.tp(q,k);q.b4w_animation_mixing?(g.Bc=new Float32Array(k.Ba),g.Ac=new Float32Array(k.Ba),
g.Jc=new Float32Array(k.h),g.Ic=new Float32Array(k.h)):(g.Bc=k.Ba,g.Ac=k.Ba,g.Jc=k.h,g.Ic=k.h);g.yl=new Float32Array(4);g.xl=F.create();g.es=k;g.Sf=0}q=a.e;k=a.data.materials;n=[];y=[];z=[];p=[];H=[];ha=[];for(Y=0;Y<k.length;Y++)ea=k[Y],(Z=ea.node_tree)&&b(Z,ea.name+"%join%",Z.animation_data,n,y,z,p,H,ha);q.oe=n;q.ig=y;q.pk=z;q.wc=p;q.hg=H;q.qk=ha;a.o=[];g.Ec=a.b4w_shadow_cast;g.ic=a.b4w_shadow_receive;g.hc=a.b4w_shadow_cast_only&&g.Ec;g.Vb=a.b4w_reflexible;g.Mb=a.b4w_reflexible_only&&g.Vb;g.Cc=a.b4w_reflective;
g.re=a.b4w_reflection_type;a.ol=null;if(a.b4w_reflective)if(q=a.e,"CUBE"==a.b4w_reflection_type)q.pc=J++;else{a:{k=a.constraints;for(n=0;n<k.length;n++)if(y=k[n],"LOCKED_TRACK"==y.type&&"REFLECTION PLANE"==y.name){k=y.target;break a}k=null}k||(k=h(I.ej("%reflection%"),"EMPTY",!1),n=c("EMPTY"),k.e=n,D.wl(k,a,[0,0,0],null,1));n=null;for(y=0;y<K.length;y++)if(K[y]==k){n=y;break}null==n?(K.push(k),q.zc=K.length-1):q.zc=n;a.ol=k}g.Xd=a.b4w_caustics;g.Kc=a.b4w_wind_bending;g.lj=a.b4w_wind_bending_angle;
q=l.IC(a.b4w_wind_bending_angle,l.Jv(a.data.b4w_bounding_box),a.scale[0]);g.Kd=q;g.Be=a.b4w_wind_bending_freq;g.ae=a.b4w_detail_bending_freq;g.$d=a.b4w_detail_bending_amp;g.Vd=a.b4w_branch_bending_amp;g.fh=!1;g.ne=a.b4w_main_bend_stiffness_col;q=a.b4w_detail_bend_colors;g.Jb={};g.Jb.sr=q.leaves_stiffness_col;g.Jb.rr=q.leaves_phase_col;g.Jb.Mr=q.overall_stiffness_col;g.Vg=a.b4w_do_not_cull;g.Tj=a.b4w_disable_fogging;g.td=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";q=a.data.materials[0];
g.wi=q.physics.friction;g.ri=q.physics.elasticity;g.Hi=0;g.Ze=1E4;g.gg=a.b4w_lod_transition;g.ok=!0;break;case "CAMERA":x.Wv(a);x.Ev(a);break;case "LAMP":u.lz(a);break;case "CURVE":if(q=A.Xw(a))a.cv=q;break;case "EMPTY":g.Pb=t.Ld(),q=t.mj(),g.Yc=q}if(!e&&(a.parent&&"OBJECT"==a.parent_type?(k=g.h,n=g.quat,q=g.scale,D.wl(a,a.parent,k,n,q)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?(k=g.h,n=g.quat,q=g.scale,D.bp(a,a.parent,a.parent_bone,k,n,q)):a.ya&&a.ya.b4w_group_relative?(q=E.create_sep(g.h,
g.scale,g.quat),D.hv(a,a.ya,q)):a.ya&&!a.ya.b4w_group_relative&&(r.v(a),E.multiply(a.ya.e.Bb,a.e.Bb,a.e.Bb),r.set_translation(a,E.get_trans_view(a.e.Bb)),r.set_scale(a,E.get_scale(a.e.Bb)),r.set_rotation(a,E.get_quat_view(a.e.Bb))),q=a.dupli_group))for(k=q.objects,q=0;q<k.length;q++)k[q].ya=a;a.field&&(g.Bm=a.field.strength,m.lt(a));g.al=a.game.use_collision_compound;g.cs=a.game.physics_type;r.v(a)};a.eC=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.e||"DYNAMIC"!=c.e.type&&"CAMERA"!=c.e.type||
r.v(c);c.b4w_use_default_animation&&f.ik(c)&&(f.apply_def(c),c.C.length&&f.play(c,null,f.SLOT_ALL))}};a.bc=function(a){return a.Kg?!0:!1};a.Bi=function(a){return"MESH"==a.type&&a.Kg?!0:!1};a.get_meta_tags=function(a){a=a.b4w_object_tags;return{title:a?a.title:"",description:a?a.description:"",category:a?a.category:""}};a.cleanup=function(){J=B=0;K=[]};a.br=h;a.copy=function(a,b,c){b=h(b,a.type,!1);var d=[];if(c){for(var f=0;f<a.o.length;f++)a.o[f].Rf||(b.o.push(n(a.o[f])),d.push(a.o[f].T));for(f=
0;f<a.o.length;f++)if(a.o[f].Rf){var e=n(a.o[f]);b.o.push(e);for(var g=0;g<d.length;g++)d[g]==a.o[f].T&&(e.T=b.o[g].T)}}else b.o=k(a.o);b.e=n(a.e);a.Kg&&(b.Kg=a.Kg);a.ya&&(b.ya=a.ya);a.Qd&&(b.Qd=k(a.Qd));!a.n||a.b4w_vehicle||a.b4w_character||a.b4w_floating||(b.n=n(a.n));b.game=n(a.game);b.b4w_collision_id=a.b4w_collision_id;b.b4w_correct_bounding_offset=a.b4w_correct_bounding_offset;b.b4w_collision=a.b4w_collision;b.data=a.data;b.particle_systems=c?n(a.particle_systems):k(a.particle_systems);if(c)for(f=
0;f<b.o.length;f++){b.o[f].T&&H.mt(b.o[f].T);if("PARTICLES"==b.o[f].type&&b.o[f].In)for(g=0;g<b.SE.length;g++)if(b.particle_systems[g].name==b.o[f].In){b.o[f].yc=b.particle_systems[g];break}b.o[f].sh=b.uuid;l.TB(b.o[f],I.Qg(b.e,0))}b.uuid=I.xq();b.e.Zm=!0;b.e.Mj=I.vq(B);B++;return b};a.Np=n;a.Hy=function(a,b){for(var c=a.e.ig,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null};a.Cy=function(a,b){for(var c=a.e.hg,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}};b4w.module.__particles=function(a,p){function c(){throw"_rand() undefined";}function d(a,b,c,d,f,e,h){var g=a.S.km,k=a.S.ud,l=a.S.time;a=a.S.fs;for(var E=b?4:1,I=0;I<g.length;I+=E){var F=g[I];if(l>a&&l>=F&&F>a||l<a&&(F>a||l>=F))for(F=0;8>F;F++)k[8*I+F]=f[F];for(F=0;8>F;F++)t[F]=k[8*I+F];F=x;F[0]=c[3*I];F[1]=c[3*I+1];F[2]=c[3*I+2];n.transform_vec3(F,t,F);e[3*I]=F[0];e[3*I+1]=F[1];e[3*I+2]=F[2];var p=x;p[0]=d[3*I];p[1]=d[3*I+1];p[2]=d[3*I+2];n.transform_dir_vec3(p,t,p);h[3*I]=p[0];h[3*I+1]=p[1];h[3*
I+2]=p[2];if(b)for(F=1;4>F;F++)e[3*(I+F)]=e[3*I],e[3*(I+F)+1]=e[3*I+1],e[3*(I+F)+2]=e[3*I+2],h[3*(I+F)]=p[0],h[3*(I+F)+1]=p[1],h[3*(I+F)+2]=p[2]}}function b(a){a?(k.tB(a),c=function(){return k.eA()}):c=function(){return Math.random()}}var e=p("__config"),g=p("__geometry"),h=p("__scenes"),k=p("__util"),n=p("__tsr"),f=p("vec3"),l=e.Sd,t=new Float32Array(8),x=new Float32Array(3);a.eh=function(a){return 0<a.particle_systems.length?!0:!1};a.Rm=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==
a.particle_systems[b].settings.type)return!0;return!1};a.lE=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.Sy=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.Zx=function(a,e,h,n){h.S=h.S||{};var t=g.mq(e,["a_position","a_normal"],null),y=h.settings.count,q=h.settings.frame_start/l.Ha,w=h.settings.frame_end/l.Ha,m=h.settings.lifetime/
l.Ha,r=h.settings.lifetime_random,x=h.settings.emit_from,I=h.settings.factor_random,F=h.settings.angular_velocity_mode,p=h.settings.angular_velocity_factor,L=h.settings.b4w_randomize_emission,O=h.settings.b4w_cyclic;b(h.seed);var B=h.S.yC="WORLD"==h.settings.b4w_coordinate_system?!0:!1;h.S.frame=0;if(e=!a.Xf){var J;J=[];for(var K=0;K<y;K++)J.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);J=new Float32Array(J);for(var K=[],P=0;P<y;P++)K.push(4*P,4*P+2,4*P+1,4*P,4*P+3,4*P+2);K=new Uint16Array(K)}switch(x){case "VERT":for(var P=
t.A[0].a_position,t=t.A[0].a_normal,R=P.length/3,x=[],T=0;T<y;T++){var Q=Math.round((R-1)*c());x.push(Q);e&&(x.push(Q),x.push(Q),x.push(Q))}R=[];for(T=0;T<x.length;T++)R.push(P[3*x[T]]),R.push(P[3*x[T]+1]),R.push(P[3*x[T]+2]);P=new Float32Array(R);R=[];for(T=0;T<x.length;T++)R.push(t[3*x[T]]),R.push(t[3*x[T]+1]),R.push(t[3*x[T]+2]);x=new Float32Array(R);break;case "FACE":P=[];x=[];T=[];k.gk(0,T);R=g.Gm(t,y,!1,T);k.gk(0,T);t=g.Gm(t,y,!0,T);for(T=0;T<R.length;T++)P.push(R[T][0],R[T][1],R[T][2]),e&&
(P.push(R[T][0],R[T][1],R[T][2]),P.push(R[T][0],R[T][1],R[T][2]),P.push(R[T][0],R[T][1],R[T][2])),x.push(t[T][0],t[T][1],t[T][2]),e&&(x.push(t[T][0],t[T][1],t[T][2]),x.push(t[T][0],t[T][1],t[T][2]),x.push(t[T][0],t[T][1],t[T][2]));P=new Float32Array(P);x=new Float32Array(x);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}x=[P,x];t=x[0];x=x[1];h.S.Ti=new Float32Array(t);h.S.Jz=new Float32Array(x);h.S.Xz=new Float32Array(t.length);h.S.Kz=
new Float32Array(x.length);h.S.time=0;h.S.fs=-1;P=[];w=(w-q)/y;for(R=0;R<y;R++)T=L?w*R+10*w*(.5-c()):w*R,O||(T+=q),P.push(T),e&&(P.push(T),P.push(T),P.push(T));q=new Float32Array(P);h.S.km=new Float32Array(q);h.S.aq=new Float32Array(q);h.S.ud=new Float32Array(8*q.length);for(L=0;L<8*q.length;L++)for(O=0;8>O;O++)h.S.ud[8*L+O]=n[O];B&&d(h,e,t,x,n,t,x);h=[];n=m*r;for(r=0;r<y;r++)B=n*c(),h.push(m-B),e&&(h.push(m-B),h.push(m-B),h.push(m-B));m=new Float32Array(h);h=[];for(n=0;n<y;n++){r=[c()-.5,c()-.5,
c()-.5];f.normalize(r,r);h.push(I*r[0]);h.push(I*r[1]);h.push(I*r[2]);switch(F){case "NONE":h.push(0);break;case "SPIN":case "VELOCITY":h.push(p);break;case "RAND":h.push(2*p*(c()-.5));break;default:throw"Undefined velocity factor";}if(e)for(r=h.slice(-4),B=0;12>B;B++)h.push(r[B%4])}y=new Float32Array(h);I=k.mb("EMITTER_PARTICLES");F=k.Zc();F.a_position=t;F.a_normal=x;I.A[0]=F;e?(a.ee=g.pj,I.ea=K):(a.ee=g.Jo,I.ea=new Uint16Array(0));I.L=t.length/3;I.J.a_p_delay=q;I.J.a_p_lifetime=m;I.J.a_p_vels=y;
e&&(I.J.a_p_bb_vertex=J);return I};a.bC=function(a){for(var b=a.o,c=0;c<b.length;c++){var f=b[c],e=b[c].yc;if(e){var h=f.T;if(!e.S.yC)break;var k=e.S.Xz,l=e.S.Kz;d(e,!f.Xf,e.S.Ti,e.S.Jz,a.e.Bb,k,l);g.wz(h);g.Zk(h,"a_position",3,k);g.Zk(h,"a_normal",3,l)}}};a.HA=function(a,b,c){var d=b.settings.lifetime/l.Ha,f=b.settings.normal_factor,e=9.81*b.settings.effector_weights.gravity,g=b.settings.effector_weights.wind,k=b.settings.mass,m=b.settings.b4w_fade_in/l.Ha,n=b.settings.b4w_fade_out/l.Ha,t=b.settings.b4w_cyclic;
a.Vr=b.settings.frame_end/l.Ha-b.settings.frame_start/l.Ha;a.Rr=t?1:0;a.Bn=f;a.Ur=e;f=h.My();a.Bk[0]=f[0]*g;a.Bk[1]=f[1]*g;a.Bk[2]=f[2]*g;a.Xr=d;a.Wr=k;a.Sr=m;a.Tr=n;a.Xf?(d=c.halo.size,g=c.halo.hardness,30>g?(g=.5,k=.9):40>g?(g=.1,k=1):50>g?(g=0,k=.8):(g=0,k=.5)):(d=b.settings.particle_size,k=g=1);a.Cn=d;a.Or=g;a.Nr=k;d=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(d[0]&&d[0].use_map_size&&d[0].texture&&"BLEND"==d[0].texture.type&&d[0].texture.use_color_ramp){d=d[0].texture.color_ramp.elements;
g=Math.min(2*d.length,b.length);for(k=0;k<g;k+=2)m=d[k/2],b[k]=m.position,b[k+1]=(m.color[0]+m.color[1]+m.color[2])/3;a.Zr=d.length}a.Yr.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){d=b[0].texture.color_ramp.elements;g=Math.min(4*d.length,c.length);for(k=0;k<g;k+=4)m=d[k/4],c[k]=m.position,c[k+1]=m.color[0],c[k+2]=m.color[1],c[k+3]=m.color[2];a.Qr=d.length}a.Pr.set(c)};
a.RA=function(a,b){a.S.fs=a.S.time;a.S.time=b};a.$z=function(a){for(var b=a.L,c=a.A[0].a_position,d=a.J.a_texcoord,f=[],e=[],h=0;h<b;h++)e.push(c[3*h]),e.push(c[3*h+1]),f.push(c[3*h+2]);f=new Float32Array(f);e=new Float32Array(e);a.J.a_lf_dist=f;a.J.a_lf_bb_vertex=e;a.J.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.o;for(var d=0;d<a.length;d++){var f=a[d],e=f.yc;e&&e.name==b&&(f.Cn=c)}};a.set_normal_factor=function(a,b,c){a=a.o;for(var d=0;d<a.length;d++){var f=a[d],e=f.yc;e&&e.name==b&&(f.Bn=
c)}};a.set_factor=function(a,b,c){a=a.o;for(var d=0;d<a.length;d++){var f=a[d],e=f.yc;if(e&&e.name==b){var h=e.S.km;if(1==c)e=h;else if(0==c)for(var k=!f.Xf,m=k?4:1,e=e.S.aq,l=0;l<e.length;l+=m)e[l]=1E4,k&&(e[l+1]=e[l],e[l+2]=e[l],e[l+3]=e[l]);else for(var n=1/c,e=e.S.aq,m=(k=!f.Xf)?4:1,t=0,l=0;l<e.length;l+=m)l>=t?(e[l]=h[l],t+=n):e[l]=1E4,k&&(e[l+1]=e[l],e[l+2]=e[l],e[l+3]=e[l]);g.Zk(f.T,"a_p_delay",1,e)}}};a.kC=function(a,b,c){a=a.particle_systems;for(var d=0;d<a.length;d++){var f=a[d];if("EMITTER"==
f.settings.type)for(var e=f.S.km,d=0;d<8*e.length;d++)f.S.ud[8*d]=b[0],f.S.ud[8*d+1]=b[1],f.S.ud[8*d+2]=b[2],f.S.ud[8*d+3]=b[3],f.S.ud[8*d+4]=c[0],f.S.ud[8*d+5]=c[1],f.S.ud[8*d+6]=c[2],f.S.ud[8*d+7]=c[3]}}};b4w.module.__primitives=function(a,p){function c(a,b,c,d){for(var e=[],g=[],k=[],p=[],H=2*c/(a-1),u=2*d/(b-1),y=0;y<a;y++)for(var q=-c+y*H,w=0;w<b;w++)if(g.push(q,0,-d+w*u),k.push(0,1,0),p.push(y/(a-1),w/(b-1)),y&&w){var m=y*b+w,r=m-1,E=(y-1)*b+w,I=E-1;e.push(m,r,E);e.push(r,I,E)}a=h.Zc();a.a_position=new Float32Array(g);a.a_normal=new Float32Array(k);k=h.mb("GRID_PLANE");k.A[0]=a;k.J.a_texcoord=new Float32Array(p);k.ea=new Uint32Array(e);k.L=g.length/3;return k}function d(a){var b=a.length;if(b%
4)throw"Wrong array";for(var c=[],d=[],g=0;g<b;g+=4){var k=a[g+1],D=a[g+2],p=a[g+3];e(a[g],d);e(k,d);e(D,d);e(p,d);c.push(g,g+1,g+2);c.push(g,g+2,g+3)}a=h.Zc();a.a_position=new Float32Array(d);b=h.mb("FROM_QUADS");b.A[0]=a;b.ea=new Uint32Array(c);b.L=d.length/3;return b}function b(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function e(a,b){b.push(a[0],a[1],a[2])}var g=p("__geometry"),h=p("__util"),k=p("__config").p;a.cE=function(a){for(var b=h.mb("LINE"),c=[],d=0;d<2*a;d++)c.push(d);d=h.Zc();d.a_point=
new Float32Array(c);b.A[0]=d;b.ea=new Uint32Array(c);b.L=2*a;return b};a.dE=function(a,b){var d=c(2,2,a,b);d.name="PLANE";return d};a.bE=c;a.dy=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==p-1)||1==b%2&&(0==a||a==D-1)?!0:!1}var e=c/=Math.pow(2,a-1),z=c,D=b+1,p=b+1;b=[];c=[];for(var H=0,u=0,y=-1,q=[],w=0;w<a;w++){for(var m=2*e/(D-1),r=2*z/(p-1),E=[],I=[],F=0,M=0;M<D;M++){for(var L=-e+M*m,O=[],B=0;B<p;B++){var J=-z+B*r;if(L>-H&&L<H&&J>-u&&J<u)O.push(-1),F++;else{for(var K=null,P=0;P<q.length;P+=
3)if(L==q[P]&&J==q[P+1]){K=q[P+2];break}P=null!==K?K:y+1;d(M,B)?(O.push(-2),F++):(null==K&&(0==B||B==p-1||0==M||M==D-1?(K=w==a-1?m:2*m,E.push(L,J,P)):K=m,c.push(L,K,J),y++),O.push(P));if(M&&B)if(1==M)if(d(M-1,B)){if(1<B){var J=P-1,K=I[M-1][B+1],R=K-1;b.push(P,J,R)}else K=I[M-1][B+1],R=K-1;b.push(P,R,K)}else d(M,B)||(J=P-1,K=I[M-1][B],b.push(P,J,K));else if(M==D-1){if(!d(M,B))if(B==p-1)J=P-1,K=I[M-1][B-1],R=I[M-2][B],b.push(P,J,K),b.push(P,K,R);else{var J=P-1,K=I[M-1][B],R=K-1,T=K+1;b.push(P,J,R);
b.push(P,R,K);b.push(P,K,T);2==B&&(T=I[M-2][B-2],b.push(J,T,R))}}else 1==B?d(M,B-1)?(J=I[M-1][B],K=I[M-1][B-1],b.push(P,K,J)):(J=O[B-1],K=I[M-1][B],R=I[M-2][B-1],b.push(P,J,K),b.push(J,R,K)):B==p-1?d(M,B)||(J=O[B-1],K=I[M-1][B-1],R=I[M-2][B],b.push(P,J,K),b.push(P,K,R)):-1!=I[M-1][B]&&-1!=I[M-1][B-1]&&-1!=O[B-1]?(J=O[B-1],K=I[M-1][B],R=I[M-1][B-1],b.push(P,J,K),b.push(J,R,K),B==p-2&&d(M,B+1)&&(T=I[M-1][B+1],b.push(P,K,T))):B==p-2&&d(M,B+1)&&(K=I[M-1][B],T=I[M-1][B+1],b.push(P,K,T))}}I.push(O)}q=E;
H=e;u=z;e*=2;z*=2}2E4>H&&(a=-(2*H)/(D-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-H,a,-u),c.push(-H,a,u),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(H,a,-u),c.push(H,a,u),P=y+1,b.push(P+3,P+2,P+1,P+2,P+0,P+1,P+6,P+4,P+2,P+4,P+0,P+2,P+5,P+7,P+1,P+7,P+3,P+1,P+5,P+4,P+7,P+7,P+4,P+6));a=h.Zc();a.a_position=new Float32Array(c);e=h.mb("multigrid_plane");e.A[0]=a;e.ea=new Uint32Array(b);e.L=c.length/3;k.Ct&&(g.ho(e,1,!0),a.a_polyindex=g.kq(e));return e};a.aE=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var c=[],d=[],g=0;g<b;g+=3){var k=a[g+1],D=a[g+2];e(a[g],d);e(k,d);e(D,d);c.push(g,g+1,g+2)}a=h.Zc();a.a_position=new Float32Array(d);b=h.mb("FROM_TRIANGLES");b.A[0]=a;b.ea=new Uint32Array(c);b.L=d.length/3;return b};a.$D=d;a.$x=function(a){a=h.CC(a);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=d(b);a.name="FRUSTUM";return a};a.nb=function(){var a=h.mb("FULLSCREEN_TRI"),
b=h.Zc();b.a_position=new Float32Array([0,0,1,0,0,1]);a.A[0]=b;a.ea=new Uint32Array([0,1,2]);a.L=3;return a};a.ay=function(){var a=h.mb("FULLSCREEN_QUAD"),b=h.Zc();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.A[0]=b;a.ea=new Uint32Array([0,2,1,1,2,3]);a.L=4;return a};a.Wx=function(){var a=h.mb("BILLBOARD"),b=h.Zc();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.A[0]=b;a.ea=new Uint32Array([0,2,1,0,3,2]);a.L=4;return a};a.Xx=function(){var a=h.mb("CUBEMAP_BOARD"),b=h.Zc();
b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.A[0]=b;a.ea=new Uint32Array([0,2,1,0,3,2]);a.L=4;return a};a.zq=function(a,c){var d=h.mb("UV_SPHERE"),k,x,z=[],D=[],p=[];for(x=0;8>=x;x++)for(k=0;16>=k;k++){var H=k/16,u=x/8;D.push(-a*Math.cos(2*H*Math.PI)*Math.sin(u*Math.PI)+c[0],a*Math.cos(u*Math.PI)+c[1],a*Math.sin(2*H*Math.PI)*Math.sin(u*Math.PI)+c[2])}for(x=H=0;8>x;x++)for(k=0;16>k;k++){var u=b(D,17*x+k+1),y=b(D,17*x+k),q=b(D,17*(x+1)+k),w=b(D,17*(x+1)+k+1);Math.abs(u[1])==a+c[1]?(e(u,z),
e(q,z),e(w,z),p.push(H,H+1,H+2),H+=3):Math.abs(q[1])==a+c[1]?(e(u,z),e(y,z),e(q,z),p.push(H,H+1,H+2),H+=3):(e(u,z),e(y,z),e(q,z),e(w,z),p.push(H,H+1,H+2),p.push(H,H+2,H+3),H+=4)}k={};k.a_position=z;D=g.up(p,D,z);k.a_normal=g.sp(p,z,D);k.a_tangent=[];d.J.a_influence=[];d.J.a_color=[];d.J.a_texcoord=[];d.A[0]=k;d.ea=p;d.L=z.length/3;return d};a.yq=function(a){var b=h.mb("INDEX"),c=h.Zc();c.a_index=new Float32Array(a);for(var d=0;d<a;d++)c.a_index[d]=d;b.A[0]=c;b.ea=new Uint16Array(0);b.L=a;return b}};b4w.module.__prerender=function(a,p){function c(a,c){var d=a.cd,f=c.j;d.is_visible=!1;var e;if(!(e=!d||d.fh)){var g=f.Re,k=d.vb.F;e=d.Ze;g=Math.sqrt((k[0]-g[0])*(k[0]-g[0])+(k[1]-g[1])*(k[1]-g[1])+(k[2]-g[2])*(k[2]-g[2]));k=d.gg*d.vb.Da;e=!(g>=d.Hi&&g<e+k)}if(e)return!1;d.is_visible=!0;(e="OUTLINE_MASK"==c.type&&!Boolean(d.dd))||(f=f.Xj,d.Vg?e=!1:("STATIC"===d.type?(e=d.vb,d=e.F,d=h.oB(d,f,e.Da)):(e=d.Ff,d=e.F,d=h.zx(d,f,e.Bf,e.Cf,e.Df)),e=d));return e?!1:"WIREFRAME"==c.type?a.B.wireframe_mode==b.Qo.WM_DEBUG_SPHERES?
a.B.Tg:!a.B.Tg:!0}var d=p("__config"),b=p("__debug"),e=p("__geometry"),g=p("__renderer"),h=p("__util"),k=p("__vec3"),n=d.p,f="MAIN_OPAQUE MAIN_BLEND MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_GLOW SHADOW_CAST DEPTH OUTLINE_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.Gn=function(a){if(-1<f.indexOf(a.type)){for(var b=!1,d=a.q,h=0;h<d.length;h++){var p=d[h];if("MAIN_CUBE_REFLECT"==a.type)for(var A=0;6>A;A++)a.j.Xj=a.em[A],p.mm[A]=c(p,a),p.mm[A]&&(b=!0);else p.Ra=c(p,a),p.Ra&&
(b=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||b?a.Ra=!0:(a.Ra&&g.clear(a),a.Ra=!1)}}if("MAIN_BLEND"==a.type&&n.alpha_sort&&a.q){b=a.j.Re;d=k.dist(b,a.Et)>n.alpha_sort_threshold;for(h=0;h<a.q.length;h++)if(A=a.q[h],p=A.cd,p.Dm||d){var H=A.B;if(H&&H.Ca&&H.De!=e.Pd){H=H.T;if(!H||!A.Ra)continue;(A=H.fk)&&A.type==e.Ro&&e.WB(H,p.V,b)}p.Dm=!1}d&&k.copy(b,a.Et)}}};b4w.module.__print=function(a){function p(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var d=1;d<a.length;d++)c.push(a[d]);return c}var c=!1,d=0,b=0;a.TA=function(a){c=a};a.nn=function(){console.log.apply(console,arguments)};a.log=function(){if(c){var a=p(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=function(){d++;var a=p(arguments,"B4W ERROR");console.error.apply(console,a)};a.warn=function(){b++;var a=p(arguments,"B4W WARN");console.warn.apply(console,
a)};a.info=function(){var a=p(arguments,"B4W INFO");console.info.apply(console,a)};a.Dx=function(){d++;var a=p(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.Ex=function(){b++;var a=p(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){c&&console.time.apply(console,arguments)};a.timeEnd=function(){c&&console.timeEnd.apply(console,arguments)};a.group=function(){c&&console.group.apply(console,arguments)};a.groupCollapsed=function(){c&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){c&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.Ly=function(){return b};a.uy=function(){return d};a.clear_errors_warnings=function(){d=b=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,p){function c(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"alpha"in a||(a.alpha=1,b("node material",a,"alpha"));"darkness"in a||(a.darkness=1,b("node material",a,"darkness"));"diffuse_toon_size"in a||(a.diffuse_toon_size=.5,b("node material",a,"diffuse_toon_size"));"diffuse_toon_smooth"in a||(a.diffuse_toon_smooth=.1,b("node material",a,"diffuse_toon_smooth"));"diffuse_intensity"in
a||(a.diffuse_intensity=1,b("node material",a,"diffuse_intensity"));"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_ior"in a||(a.specular_ior=4,b("node material",a,"specular_ior"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=.5,b("node material",a,"specular_toon_size"));
"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in a||(a.diffuse_fresnel_factor=.5,b("node material",
a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name="B4W_"+a.node_tree_name}}}
function d(a){if(a=a.nla_tracks)for(var c=0;c<a.length;c++)for(var d=a[c],f=0;f<d.strips.length;f++){var e=d.strips[f];"action"in e||(e.action=null,b("strip",e,"action"));"action_frame_start"in e||(e.action_frame_start=0,b("strip",e,"action_frame_start"));"action_frame_end"in e||(e.action_frame_end=e.frame_end-e.frame_start,b("strip",e,"action_frame_end"));"repeat"in e||(e.repeat=1,b("strip",e,"repeat"));"use_reverse"in e||(e.use_reverse=!1,b("strip",e,"use_reverse"));"scale"in e||(e.scale=1,b("strip",
e,"scale"))}}function b(a,b,c){c=c+">>"+a;c in A||(A[c]={eo:[],ts:"undefined",type:a});A[c].eo.push(b.name)}function e(a,b){param_id in A||(A[param_id]={eo:[],ts:"deprecated",type:a});A[param_id].eo.push(b.name)}function g(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=f.Jf(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var h=f.fi(d[c]);e.submeshes.push(h)}return e}var h=p("__boundings"),
k=p("__curve"),n=p("__print"),f=p("__util"),l=p("vec3"),t=p("vec4"),x=p("quat"),z=p("mat4"),D=[5,4],A={};a.Cp=function(a){return-1!=f.vt(a,D)};a.dw=function(a){A={};var h=a.worlds;if(0==h.length){n.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var g={name:"DEFAULT",horizon_color:new Float32Array([0,0,0]),zenith_color:new Float32Array([0,0,0]),light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},use_sky_paper:!1,use_sky_blend:!1,
use_sky_real:!1,b4w_fog_color:[.5,.5,.5],b4w_fog_density:0,texture_slots:[]};h.push(g)}for(var h=a.worlds,k=0;k<h.length;k++){g=h[k];"use_sky_blend"in g||(b("world",g,"use_sky_blend"),g.use_sky_blend=!1);"use_sky_paper"in g||(b("world",g,"use_sky_paper"),g.use_sky_paper=!1);"use_sky_real"in g||(b("world",g,"use_sky_real"),g.use_sky_real=!1);"b4w_sky_settings"in g&&"rayleigh_brightness"in g.b4w_sky_settings||(b("world",g,"rayleigh_brightness"),g.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,
use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"render_sky"in g.b4w_sky_settings||(b("world",g,"render_sky"),g.b4w_sky_settings.render_sky=!1);"b4w_fog_density"in g||(b("world",g,"b4w_fog_density"),g.b4w_fog_density=0);for(var l=g.texture_slots,g=0;g<l.length;g++){var m=l[g];"blend_type"in m||(m.blend_type=
"MIX",b("world_texture_slot",m,"blend_type"));"use_map_blend"in m||(m.use_map_blend=!1,b("world_texture_slot",m,"use_map_blend"));"use_map_horizon"in m||(m.use_map_horizon=!0,b("world_texture_slot",m,"use_map_horizon"));"use_map_zenith_up"in m||(m.use_map_zenith_up=!1,b("world_texture_slot",m,"use_map_zenith_up"));"use_rgb_to_intensity"in m||(m.use_rgb_to_intensity=!1,b("world_texture_slot",m,"use_rgb_to_intensity"));"invert"in m||(m.invert=!1,b("world_texture_slot",m,"invert"));"color"in m||(m.color=
[1,0,1],b("world_texture_slot",m,"color"));"blend_factor"in m||(m.blend_factor=0,b("world_texture_slot",m,"blend_factor"));"horizon_factor"in m||(m.horizon_factor=1,b("world_texture_slot",m,"horizon_factor"));"zenith_up_factor"in m||(m.zenith_up_factor=0,b("world_texture_slot",m,"zenith_up_factor"));"zenith_down_factor"in m||(m.zenith_down_factor=0,b("world_texture_slot",m,"zenith_down_factor"));"default_value"in m||(m.default_value=1,b("world_texture_slot",m,"default_value"))}}g=a.scenes;for(k=0;k<
g.length;k++)l=g[k],m=l.world,"timeline_markers"in l||(l.timeline_markers=null,b("scene",l,"timeline_markers")),"b4w_reflection_quality"in l||(l.b4w_reflection_quality="MEDIUM",b("scene",l,"b4w_reflection_quality")),"b4w_use_nla"in l||(l.b4w_use_nla=!1,b("scene",l,"b4w_use_nla")),"fps"in l||(l.fps=24,b("scene",l,"fps")),"b4w_nla_cyclic"in l||(l.b4w_nla_cyclic=!1,b("scene",l,"b4w_nla_cyclic")),"b4w_nla_script"in l||(l.b4w_nla_script=[],b("scene",l,"b4w_nla_script")),"b4w_detect_collisions"in l&&(e("scene",
l),delete l.b4w_detect_collisions),"audio_doppler_speed"in l||(l.audio_doppler_speed=343.3),"audio_doppler_factor"in l||(l.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in l||(l.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",l,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in l||(l.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in l||(l.b4w_enable_bloom=!1,b("scene",l,"b4w_enable_bloom")),"b4w_enable_motion_blur"in
l||(l.b4w_enable_motion_blur=!1,b("scene",l,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in l||(l.b4w_enable_color_correction=!1,b("scene",l,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in l||(l.b4w_enable_antialiasing=!0,b("scene",l,"b4w_enable_antialiasing")),"b4w_tags"in l||(l.b4w_tags={title:"",description:""},b("scene",l,"b4w_tags")),"b4w_enable_object_selection"in l||(l.b4w_enable_object_selection="AUTO",b("scene",l,"b4w_enable_object_selection")),"b4w_enable_outlining"in
l||(l.b4w_enable_outlining="AUTO",b("scene",l,"b4w_enable_outlining")),"b4w_enable_glow_materials"in l||(l.b4w_enable_glow_materials="AUTO",b("scene",l,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in l||(l.b4w_enable_anchors_visibility="AUTO",b("scene",l,"b4w_enable_anchors_visibility")),"b4w_outline_color"in l||(l.b4w_outline_color=[1,1,1],b("scene",l,"b4w_outline_color")),"b4w_outline_factor"in l||(l.b4w_outline_factor="b4w_glow_factor"in l?l.b4w_glow_factor:1,b("scene",l,"b4w_outline_factor")),
"b4w_shadow_settings"in l||(b("scene",l,"b4w_shadow_settings"),h=m.b4w_shadow_settings,l.b4w_shadow_settings=h?h:{csm_resolution:2048,self_shadow_polygon_offset:1,b4w_enable_csm:!1,csm_num:1,csm_first_cascade_border:10,first_cascade_blur_radius:3,csm_last_cascade_border:100,last_cascade_blur_radius:1.5,fade_last_cascade:!0,blend_between_cascades:!0}),h=l.b4w_shadow_settings,"csm_resolution"in h||(b("scene",l,"b4w_shadow_settings.csm_resolution"),h.csm_resolution=2048),"self_shadow_polygon_offset"in
h||(b("scene",l,"b4w_shadow_settings.self_shadow_polygon_offset"),h.self_shadow_polygon_offset=1),"self_shadow_normal_offset"in h||(b("scene",l,"b4w_shadow_settings.self_shadow_normal_offset"),h.self_shadow_normal_offset=.01),"b4w_enable_csm"in h||(b("scene",l,"b4w_shadow_settings.b4w_enable_csm"),h.b4w_enable_csm=!1),"csm_num"in h||(b("scene",l,"b4w_shadow_settings.csm_num"),h.csm_num=1),"csm_first_cascade_border"in h||(b("scene",l,"b4w_shadow_settings.csm_first_cascade_border"),h.csm_first_cascade_border=
10),"first_cascade_blur_radius"in h||(b("scene",l,"b4w_shadow_settings.first_cascade_blur_radius"),h.first_cascade_blur_radius=3),"csm_last_cascade_border"in h||(b("scene",l,"b4w_shadow_settings.csm_last_cascade_border"),h.csm_last_cascade_border=100),"last_cascade_blur_radius"in h||(b("scene",l,"b4w_shadow_settings.last_cascade_blur_radius"),h.last_cascade_blur_radius=1.5),"fade_last_cascade"in h||(b("scene",l,"b4w_shadow_settings.fade_last_cascade"),h.fade_last_cascade=!0),"blend_between_cascades"in
h||(b("scene",l,"b4w_shadow_settings.blend_between_cascades"),h.blend_between_cascades=!0),"b4w_ssao_settings"in l||(b("scene",l,"b4w_ssao_settings"),h=m.b4w_ssao_settings,l.b4w_ssao_settings=h?h:{dist_factor:0,samples:16,hemisphere:!1,blur_depth:!1,blur_discard_value:1}),h=l.b4w_ssao_settings,"dist_factor"in h||(b("scene",l,"b4w_ssao_settings.dist_factor"),h.dist_factor=0),"samples"in h||(b("scene",l,"b4w_ssao_settings.samples"),h.samples=16),"hemisphere"in h||(b("scene",l,"b4w_ssao_settings.hemisphere"),
h.hemisphere=!1),"blur_depth"in h||(b("scene",l,"b4w_ssao_settings.blur_depth"),h.blur_depth=!1),"blur_discard_value"in h||(b("scene",l,"b4w_ssao_settings.blur_discard_value"),h.blur_discard_value=1),"b4w_bloom_settings"in l||(b("scene",l,"b4w_bloom_settings"),h=m.b4w_bloom_settings,l.b4w_bloom_settings=h?h:{key:.2,blur:4,edge_lum:1}),"key"in l.b4w_bloom_settings||(b("scene",l,"b4w_bloom_settings.key"),l.b4w_bloom_settings.key=.2),"blur"in l.b4w_bloom_settings||(b("scene",l,"b4w_bloom_settings.blur"),
l.b4w_bloom_settings.blur=4),"edge_lum"in l.b4w_bloom_settings||(b("scene",l,"b4w_bloom_settings.edge_lum"),l.b4w_bloom_settings.edge_lum=1),"b4w_motion_blur_settings"in l||(b("scene",l,"b4w_motion_blur_settings"),h=m.b4w_motion_blur_settings,l.b4w_motion_blur_settings=h?h:{motion_blur_factor:.01,motion_blur_decay_threshold:.01}),"motion_blur_factor"in l.b4w_motion_blur_settings||(b("scene",l,"b4w_motion_blur_settings.motion_blur_factor"),l.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in
l.b4w_motion_blur_settings||(b("scene",l,"b4w_motion_blur_settings.motion_blur_decay_threshold"),l.b4w_motion_blur_settings.motion_blur_decay_threshold=.01),"b4w_color_correction_settings"in l||(b("scene",l,"b4w_color_correction_settings"),h=m.b4w_color_correction_settings,l.b4w_color_correction_settings=h?h:{brightness:0,contrast:0,exposure:1,saturation:1}),"b4w_god_rays_settings"in l||(b("scene",l,"b4w_god_rays_settings"),h=m.b4w_god_rays_settings,l.b4w_god_rays_settings=h?h:{intensity:.7,max_ray_length:1,
steps_per_pass:10}),"steps_per_pass"in l.b4w_god_rays_settings||(b("scene",l,"b4w_god_rays_settings.steps_per_pass"),l.b4w_god_rays_settings.steps_per_pass=10),"b4w_glow_settings"in l||(b("scene",l,"b4w_glow_settings"),l.b4w_glow_settings={render_glow_over_blend:!1,small_glow_mask_coeff:2,large_glow_mask_coeff:2,small_glow_mask_width:2,large_glow_mask_width:6},h=l.b4w_glow_settings,"b4w_render_glow_over_blend"in m&&(h.render_glow_over_blend=m.b4w_render_glow_over_blend),"b4w_small_glow_mask_coeff"in
m&&(h.small_glow_mask_coeff=m.b4w_small_glow_mask_coeff),"b4w_large_glow_mask_coeff"in m&&(h.large_glow_mask_coeff=m.b4w_large_glow_mask_coeff),"b4w_small_glow_mask_width"in m&&(h.small_glow_mask_width=m.b4w_small_glow_mask_width),"b4w_large_glow_mask_width"in m&&(h.large_glow_mask_width=m.b4w_large_glow_mask_width)),m=l.b4w_render_shadows,"AUTO"!=m&&"OFF"!=m&&"ON"!=m&&(l.b4w_render_shadows=m?"ON":"OFF"),m=l.b4w_render_reflections,"OFF"!=m&&"ON"!=m&&(l.b4w_render_reflections=m?"ON":"OFF"),m=l.b4w_render_refractions,
"AUTO"!=m&&"OFF"!=m&&"ON"!=m&&(l.b4w_render_refractions=m?"ON":"OFF");l=a.meshes;for(k=0;k<l.length;k++){m=l[k];m.b4w_bounding_box||(b("mesh",m,"b4w_bounding_box"),m.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});m.b4w_bounding_box_source||(b("mesh",m,"b4w_bounding_box_source"),m.b4w_bounding_box_source=m.b4w_bounding_box);m.uv_textures||(b("mesh",m,"uv_textures"),m.uv_textures=[]);m.b4w_bounding_sphere_center||(m.b4w_bounding_sphere_center=[0,0,0]);m.b4w_bounding_cylinder_center||
(m.b4w_bounding_cylinder_center=[0,0,0]);m.b4w_bounding_ellipsoid_center||(m.b4w_bounding_ellipsoid_center=[0,0,0]);m.b4w_bounding_ellipsoid_axes||(g=m.b4w_bounding_box,m.b4w_bounding_ellipsoid_axes=[(g.max_x-g.min_x)/2,(g.max_y-g.min_y)/2,(g.max_z-g.min_z)/2]);"b4w_shape_keys"in m||(m.b4w_shape_keys=[],b("mesh",m,"b4w_shape_keys"));for(var g=m,h=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],r=null,t=0;t<h.length;t++)g[h[t]]&&(r?
(g[h[t]]=!1,n.warn('WARNING property "'+h[t]+'" of object "'+g.name+'" has been set to "false". Foreground property "'+r+'" already exists.')):r=h[t]);for(g=0;g<m.b4w_vertex_anim.length;g++)h=m.b4w_vertex_anim[g],"allow_nla"in h||(b('mesh["b4w_vertex_anim"]',m,"allow_nla"),h.allow_nla=!0)}g=a.cameras;for(k=0;k<g.length;k++)l=g[k],l.type||(l.type="PERSP",b("camera",l,"type")),"b4w_eye_target_dist"in l&&(delete l.b4w_eye_target_dist,e("camera",l)),"b4w_hover_zero_level"in l||(l.b4w_hover_zero_level=
0,b("camera",l,"b4w_hover_zero_level")),"b4w_trans_velocity"in l||(l.b4w_trans_velocity=1,b("camera",l,"b4w_trans_velocity")),"b4w_rot_velocity"in l||(l.b4w_rot_velocity=1,b("camera",l,"b4w_rot_velocity")),"b4w_zoom_velocity"in l||(l.b4w_zoom_velocity=.1,b("camera",l,"b4w_zoom_velocity")),"b4w_use_distance_limits"in l||(l.b4w_use_distance_limits=!1,b("camera",l,"b4w_use_distance_limits")),"b4w_distance_min"in l||(l.b4w_distance_min=1,b("camera",l,"b4w_distance_min")),"b4w_distance_max"in l||(l.b4w_distance_max=
100,b("camera",l,"b4w_distance_max")),"b4w_horizontal_translation_min"in l||(l.b4w_horizontal_translation_min=-100,b("camera",l,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in l||(l.b4w_horizontal_translation_max=100,b("camera",l,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in l||(l.b4w_vertical_translation_min=-100,b("camera",l,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in l||(l.b4w_vertical_translation_max=100,b("camera",l,"b4w_vertical_translation_max")),
"b4w_use_horizontal_clamping"in l||(l.b4w_use_horizontal_clamping=!1,b("camera",l,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in l||(l.b4w_rotation_left_limit=-Math.PI,b("camera",l,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in l||(l.b4w_rotation_right_limit=Math.PI,b("camera",l,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in l||(l.b4w_horizontal_clamping_type="LOCAL",b("camera",l,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in l||(l.b4w_use_vertical_clamping=
!1,b("camera",l,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in l||(l.b4w_rotation_down_limit=-Math.PI/2,b("camera",l,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in l||(l.b4w_rotation_up_limit=Math.PI/2,b("camera",l,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in l||(l.b4w_vertical_clamping_type="LOCAL",b("camera",l,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in l||(l.b4w_hover_angle_min=Math.PI/6,b("camera",l,"b4w_hover_angle_min")),"b4w_hover_angle_max"in l||(l.b4w_hover_angle_max=
Math.PI/6,b("camera",l,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in l||(l.b4w_enable_hover_hor_rotation=!0,b("camera",l,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in l||(l.b4w_use_panning=!0,b("camera",l,"b4w_use_panning"));g=a.lamps;for(k=0;k<g.length;k++)l=g[k],"b4w_generate_shadows"in l||(l.b4w_generate_shadows=!1,b("lamp",l,"b4w_generate_shadows")),"b4w_dynamic_intensity"in l||(l.b4w_dynamic_intensity=!1,b("lamp",l,"b4w_dynamic_intensity")),"use_diffuse"in l||(l.use_diffuse=
!0,b("lamp",l,"use_diffuse")),"use_specular"in l||(l.use_specular=!0,b("lamp",l,"use_specular"));g=a.speakers;for(k=0;k<g.length;k++)l=g[k],"b4w_behavior"in l||(l.b4w_behavior=l.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in l||(l.b4w_disable_doppler=!1),"b4w_delay"in l||(l.b4w_delay=0),"b4w_delay_random"in l||(l.b4w_delay_random=0),"b4w_volume_random"in l||(l.b4w_volume_random=0),"b4w_pitch_random"in l||(l.b4w_pitch_random=0),"b4w_fade_in"in l||(l.b4w_fade_in=0),"b4w_fade_out"in
l||(l.b4w_fade_out=0),"b4w_loop"in l||(l.b4w_loop=!1),"b4w_loop_count"in l||(l.b4w_loop_count=0),"b4w_loop_count_random"in l||(l.b4w_loop_count_random=0),"b4w_playlist_id"in l||(l.b4w_playlist_id=""),l.animation_data&&d(l.animation_data);g=a.textures;for(k=0;k<g.length;k++)l=g[k],"b4w_anisotropic_filtering"in l||(l.b4w_anisotropic_filtering="OFF",b("texture",l,"b4w_anisotropic_filtering")),"b4w_water_foam"in l||(l.b4w_water_foam=!1,b("texture",l,"b4w_water_foam")),"b4w_foam_uv_freq"in l||(l.b4w_foam_uv_freq=
[1,1],b("texture",l,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in l||(l.b4w_foam_uv_magnitude=[1,1],b("texture",l,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in l||(l.b4w_parallax_steps=5,b("material",l,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in l||(l.b4w_parallax_lod_dist=10,b("material",l,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in l||(l.b4w_shore_dist_map=!1,b("texture",l,"b4w_shore_dist_map")),"b4w_shore_boundings"in l||(l.b4w_shore_boundings=new Float32Array(4),l.b4w_shore_boundings=
[1E3,-1E3,1E3,-1E3],b("texture",l,"b4w_shore_boundings")),"b4w_max_shore_dist"in l||(l.b4w_max_shore_dist=100,b("texture",l,"b4w_max_shore_dist")),"b4w_disable_compression"in l||(l.b4w_disable_compression=!1,b("texture",l,"b4w_disable_compression")),"b4w_source_type"in l||(l.b4w_source_type="",b("texture",l,"b4w_source_type")),"b4w_source_id"in l||(l.b4w_source_id="",b("texture",l,"b4w_source_id")),"b4w_source_size"in l||(l.b4w_source_size=1024,b("texture",l,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in
l||(l.b4w_enable_canvas_mipmapping=!0,b("texture",l,"b4w_enable_canvas_mipmapping"));h=a.materials;for(k=0;k<h.length;k++){r=h[k];"b4w_node_mat_type"in r&&e("material",r);"b4w_skydome"in r&&e("material",r);"b4w_procedural_skydome"in r&&e("material",r);r.b4w_water&&("b4w_water_shore_smoothing"in r||(r.b4w_water_shore_smoothing=!1,b("material",r,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in r||(r.b4w_water_dynamic=!1,b("material",r,"b4w_water_dynamic")),"b4w_waves_height"in r||(r.b4w_waves_height=
1,b("material",r,"b4w_waves_height")),"b4w_waves_length"in r||(r.b4w_waves_length=1,b("material",r,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in r||(r.b4w_water_dst_noise_scale0=.05,b("material",r,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in r||(r.b4w_water_dst_noise_scale1=.03,b("material",r,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in r||(r.b4w_water_dst_noise_freq0=1.3,b("material",r,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in r||(r.b4w_water_dst_noise_freq1=
1,b("material",r,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in r||(r.b4w_water_dir_min_shore_fac=.4,b("material",r,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in r||(r.b4w_water_dir_freq=.5,b("material",r,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in r||(r.b4w_water_dir_noise_scale=.05,b("material",r,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in r||(r.b4w_water_dir_noise_freq=.07,b("material",r,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in
r||(r.b4w_water_dir_min_noise_fac=.5,b("material",r,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in r||(r.b4w_water_dst_min_fac=.2,b("material",r,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in r||(r.b4w_water_waves_hor_fac=5,b("material",r,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in r||(r.b4w_water_absorb_factor=6,b("material",r,"b4w_water_absorb_factor")),"b4w_water_fog_color"in r||(r.b4w_water_fog_color=new Float32Array(3),r.b4w_water_fog_color=[.5,.7,.7],b("material",
r,"b4w_water_fog_color")),"b4w_foam_factor"in r||(r.b4w_foam_factor=5,b("material",r,"b4w_foam_factor")),"b4w_generated_mesh"in r||(r.b4w_generated_mesh=!1,b("material",r,"b4w_generated_mesh")),"b4w_water_num_cascads"in r||(r.b4w_water_num_cascads=5,b("material",r,"b4w_water_num_cascads")),"b4w_water_subdivs"in r||(r.b4w_water_subdivs=64,b("material",r,"b4w_water_subdivs")),"b4w_water_detailed_dist"in r||(r.b4w_water_detailed_dist=1E3,b("material",r,"b4w_water_detailed_dist")),"b4w_water_enable_caust"in
r||(r.b4w_water_enable_caust=!1,b("material",r,"b4w_water_enable_caust")),"b4w_water_caust_scale"in r||(r.b4w_water_caust_scale=.25,b("material",r,"b4w_water_caust_scale")),"b4w_water_caust_brightness"in r||(r.b4w_water_caust_brightness=.5,b("material",r,"b4w_water_caust_brightness")));"b4w_dynamic_grass_size"in r||(r.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in r||(r.b4w_dynamic_grass_color="");"diffuse_intensity"in r||(r.diffuse_intensity=1,b("material",r,"diffuse_intensity"));"b4w_use_ghost"in
r||(r.b4w_use_ghost=!1);"b4w_collision_margin"in r||(r.b4w_collision_margin=.04,b("material",r,"b4w_collision_margin"));"b4w_collision_group"in r||(r.b4w_collision_group=128,b("material",r,"b4w_collision_group"));"b4w_collision_mask"in r||(r.b4w_collision_mask=127,b("material",r,"b4w_collision_mask"));"b4w_do_not_render"in r||(r.b4w_do_not_render=!1,b("material",r,"b4w_do_not_render"));"HALO"!=r.type||"b4w_halo_sky_stars"in r||(r.b4w_halo_sky_stars=!1,b("material",r,"b4w_halo_sky_stars"));"HALO"!=
r.type||"b4w_halo_stars_blend_height"in r||(r.b4w_halo_stars_blend_height=10,b("material",r,"b4w_halo_stars_blend_height"));"HALO"!=r.type||"b4w_halo_stars_min_height"in r||(r.b4w_halo_stars_min_height=0,b("material",r,"b4w_halo_stars_min_height"));"specular_shader"in r||(r.specular_shader="COOKTORR",b("material",r,"specular_shader"));"diffuse_shader"in r||(r.diffuse_shader="LAMBERT",b("material",r,"diffuse_shader"));"roughness"in r||(r.roughness=.5,b("material",r,"roughness"));"diffuse_fresnel"in
r||(r.diffuse_fresnel=.1,b("material",r,"diffuse_fresnel"));"diffuse_fresnel_factor"in r||(r.diffuse_fresnel_factor=.5,b("material",r,"diffuse_fresnel_factor"));"specular_slope"in r||(r.specular_slope=.2,b("material",r,"specular_slope"));"specular_toon_size"in r||(r.specular_toon_size=.5,b("material",r,"specular_toon_size"));"specular_toon_smooth"in r||(r.specular_toon_smooth=.1,b("material",r,"specular_toon_smooth"));"specular_alpha"in r||(r.specular_alpha=1,b("material",r,"specular_alpha"));"b4w_wettable"in
r||(r.b4w_wettable=!1,b("material",r,"b4w_wettable"));"b4w_refractive"in r||(r.b4w_refractive=!1,b("material",r,"b4w_refractive"));"b4w_refr_bump"in r||(r.b4w_refr_bump=0,b("material",r,"b4w_refr_bump"));"b4w_shallow_water_col"in r||(r.b4w_shallow_water_col=[0,.8,.3],b("material",r,"b4w_shallow_water_col"));"b4w_shore_water_col"in r||(r.b4w_shore_water_col=[0,.9,.2],b("material",r,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in r||(r.b4w_shallow_water_col_fac=1,b("material",r,"b4w_shallow_water_col_fac"));
"b4w_shore_water_col_fac"in r||(r.b4w_shore_water_col_fac=.5,b("material",r,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in r||(r.b4w_water_sss_strength=5.9,b("material",r,"b4w_water_sss_strength"));"b4w_water_sss_width"in r||(r.b4w_water_sss_width=.45,b("material",r,"b4w_water_sss_width"));"b4w_render_above_all"in r||(r.b4w_render_above_all=!1,b("material",r,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in r||(r.b4w_water_norm_uv_velocity=.05,b("material",r,"b4w_water_norm_uv_velocity"));
"specular_ior"in r||(r.specular_ior=1,b("material",r,"specular_ior"));"darkness"in r||(r.darkness=0,b("material",r,"darkness"));"diffuse_toon_size"in r||(r.diffuse_toon_size=0,b("material",r,"diffuse_toon_size"));"diffuse_toon_smooth"in r||(r.diffuse_toon_smooth=0,b("material",r,"diffuse_toon_smooth"));l=r.texture_slots;for(g=0;g<l.length;g++)m=l[g],"blend_type"in m||(m.blend_type="MIX",b("texture_slot",m,"blend_type"));if(r.node_tree){l=r.node_tree.nodes;for(g=0;g<l.length;g++)c(l[g]);r.node_tree.animation_data&&
d(r.node_tree.animation_data)}}m=a.node_groups;for(k=0;k<m.length;k++)for(l=m[k].node_tree.nodes,g=0;g<l.length;g++)c(l[g]);l=a.objects;for(k=0;k<l.length;k++){m=l[k];switch(m.type){case "MESH":"b4w_dynamic_geometry"in m||(m.b4w_dynamic_geometry=!1);"b4w_reflexible"in m||(m.b4w_reflexible=!1);"b4w_reflexible_only"in m||(m.b4w_reflexible_only=!1);"b4w_reflective"in m||(m.b4w_reflective=!1);"b4w_reflection_type"in m||(m.b4w_reflection_type="PLANE",b("object",m,"b4w_reflection_type"));"b4w_wind_bending"in
m||(m.b4w_wind_bending=!1,b("object",m,"b4w_wind_bending"));"b4w_wind_bending_angle"in m||(m.b4w_wind_bending_angle=10,m.b4w_wind_bending_freq=.25,b("object",m,"wind bending params"));"b4w_detail_bending_amp"in m||(m.b4w_detail_bending_amp=.1,m.b4w_branch_bending_amp=.3,b("object",m,"detail bending params"));"b4w_detail_bending_freq"in m||(m.b4w_detail_bending_freq=1,b("object",m,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in m||(m.b4w_main_bend_stiffness_col="",b("object",m,"b4w_main_bend_stiffness_col"));
"b4w_detail_bend_colors"in m||(m.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",m,"b4w_detail_bend_colors"));"b4w_caustics"in m||(m.b4w_caustics=!1);"vertex_groups"in m&&m.vertex_groups.length&&m.data&&0==m.data.vertex_groups.length&&(m.data.vertex_groups=m.vertex_groups,delete m.vertex_groups,b("object",m,"vertex_groups"));"b4w_vertex_anim"in m&&m.b4w_vertex_anim.length&&m.data&&0==m.data.b4w_vertex_anim.length&&(m.data.b4w_vertex_anim=m.b4w_vertex_anim,
delete m.b4w_vertex_anim,b("object",m,"b4w_vertex_anim"));"b4w_do_not_render"in m||(m.b4w_do_not_render=!1);"use_ghost"in m.game||(m.game.use_ghost=!1);"use_sleep"in m.game||(m.game.use_sleep=!1);"velocity_min"in m.game||(m.game.velocity_min=0);"velocity_max"in m.game||(m.game.velocity_max=0);"collision_group"in m.game||(m.game.collision_group=1);"collision_mask"in m.game||(m.game.collision_mask=255);"b4w_vehicle_settings"in m?m.b4w_vehicle_settings&&("steering_ratio"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.steering_ratio=
10),"steering_max"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.steering_max=1),"inverse_control"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.inverse_control=!1),"force_max"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.force_max=1500),"brake_max"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.brake_max=100),"speed_ratio"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.max_speed_angle=Math.PI),
"delta_tach_angle"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in m.b4w_vehicle_settings||
(m.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.floating_factor=3),"floating_factor"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.water_rot_damp=.9)):(m.b4w_vehicle_settings=
null,b("object",m,"b4w_vehicle_settings"));"b4w_floating_settings"in m?m.b4w_floating_settings&&("floating_factor"in m.b4w_floating_settings||(m.b4w_floating_settings.floating_factor=3),"water_lin_damp"in m.b4w_floating_settings||(m.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in m.b4w_floating_settings||(m.b4w_floating_settings.water_rot_damp=.8)):(m.b4w_floating_settings=null,b("object",m,"b4w_floating_settings"));"b4w_character_settings"in m?m.b4w_character_settings&&("walk_speed"in
m.b4w_character_settings||(m.b4w_character_settings.walk_speed=4),"run_speed"in m.b4w_character_settings||(m.b4w_character_settings.run_speed=8),"step_height"in m.b4w_character_settings||(m.b4w_character_settings.step_height=.25),"jump_strength"in m.b4w_character_settings||(m.b4w_character_settings.jump_strength=5),"waterline"in m.b4w_character_settings||(m.b4w_character_settings.waterline=0)):(m.b4w_character_settings=null,b("object",m,"b4w_character_settings"));"b4w_selectable"in m||(m.b4w_selectable=
!1,b("object",m,"b4w_selectable"));"b4w_outlining"in m||(m.b4w_outlining=!1,b("object",m,"b4w_outlining"));"b4w_outline_on_select"in m||(m.b4w_outline_on_select=!1,b("object",m,"b4w_outline_on_select"));"b4w_billboard"in m||(m.b4w_billboard=!1,b("object",m,"b4w_billboard"));"b4w_billboard_geometry"in m||(m.b4w_billboard_geometry="SPHERICAL",b("object",m,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in m||(m.b4w_pres_glob_orientation=!1,b("object",m,"b4w_pres_glob_orientation"));"b4w_outline_settings"in
m||("b4w_glow_settings"in m?m.b4w_outline_settings=m.b4w_glow_settings:(m.b4w_outline_settings={},m.b4w_outline_settings.outline_duration=1,m.b4w_outline_settings.outline_period=1,m.b4w_outline_settings.outline_relapses=0),b("object",m,"b4w_outline_settings"));"b4w_lod_transition"in m||(m.b4w_lod_transition=.01,b("object",m,"b4w_lod_transition"));"lod_levels"in m||(m.lod_levels=[],b("object",m,"lod_levels"));"b4w_animation_mixing"in m||(m.b4w_animation_mixing=!1,b("object",m,"b4w_animation_mixing"));
break;case "EMPTY":"b4w_group_relative"in m||(m.b4w_group_relative=!1,b("object",m,"b4w_group_relative")),"b4w_anchor"in m||(m.b4w_anchor=null,b("object",m,"b4w_anchor")),!m.b4w_anchor||"max_width"in m.b4w_anchor||(m.b4w_anchor.max_width=250)}"collision_margin"in m.game||(m.game.collision_margin=.04,b("object",m,"collision_margin"));"b4w_anim_behavior"in m||(m.b4w_anim_behavior=m.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",m,"b4w_anim_behavior"));if(!("rotation_quaternion"in m)){g=[0,0,
0,1];f.euler_to_quat(m.rotation_euler,g);var h=g,r=g[0],t=g[1],x=g[2];h[0]=g[3];h[1]=r;h[2]=t;h[3]=x;m.rotation_quaternion=g;b("object",m,"rotation_quaternion")}"webgl_do_not_batch"in m&&(m.b4w_do_not_batch=m.webgl_do_not_batch)&&e("object",m);"b4w_shadow_cast_only"in m||(m.b4w_shadow_cast_only=!1,b("object",m,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in m||(m.b4w_correct_bounding_offset="AUTO",b("object",m,"b4w_correct_bounding_offset"));h=m.particle_systems;for(g=0;g<h.length;g++)r=
h[g],t=r.settings,"use_rotation_dupli"in t||(t.use_rotation_dupli=!1,b("object",t,"use_rotation_dupli")),"use_whole_group"in t||(t.use_whole_group=!1,b("object",t,"use_whole_group")),r.transforms||(r.transforms=new Float32Array,b("particle_system",r,"transforms")),"b4w_billboard_align"in t||(t.b4w_billboard_align="VIEW",b("particle_settings",t,"b4w_billboard_align")),"b4w_dynamic_grass"in t||(t.b4w_dynamic_grass=!1,b("object",t,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in t||(t.b4w_dynamic_grass_scale_threshold=
.01,b("object",t,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in t||(t.b4w_initial_rand_rotation=!1,b("particle_settings",t,"b4w_initial_rand_rotation")),"b4w_rotation_type"in t||(t.b4w_rotation_type="Z",b("particle_settings",t,"b4w_rotation_type")),"b4w_rand_rotation_strength"in t||(t.b4w_rand_rotation_strength=1,b("particle_settings",t,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in t||(t.b4w_hair_billboard=!1,b("particle_settings",t,"b4w_hair_billboard")),"b4w_hair_billboard_type"in
t||(t.b4w_hair_billboard_type="BASIC",b("particle_settings",t,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in t||(t.b4w_hair_billboard_jitter_amp=0,b("particle_settings",t,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in t||(t.b4w_hair_billboard_jitter_freq=0,b("particle_settings",t,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in t||(t.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",t,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in
t||(t.b4w_wind_bend_inheritance="PARENT",b("particle_settings",t,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in t||(t.b4w_shadow_inheritance="PARENT",b("particle_settings",t,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in t||(t.b4w_reflection_inheritance="PARENT",b("particle_settings",t,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in t||(t.b4w_vcol_from_name="",b("particle_settings",t,"b4w_vcol_from_name")),"b4w_vcol_to_name"in t||(t.b4w_vcol_to_name="",b("particle_settings",
t,"b4w_vcol_to_name")),"b4w_coordinate_system"in t||(t.b4w_coordinate_system="LOCAL",b("particle_settings",t,"b4w_coordinate_system")),"b4w_allow_nla"in t||(t.b4w_allow_nla=!0,b("particle_settings",t,"b4w_allow_nla")),"b4w_enable_soft_particles"in t||(t.b4w_enable_soft_particles=!1,b("particle_settings",t,"b4w_enable_soft_particles")),"b4w_particles_softness"in t||(t.b4w_particles_softness=1,b("particle_settings",t,"b4w_particles_softness"));"constraints"in m||(m.constraints=[],b("object",m,"constraints"));
h=m.modifiers;for(g=0;g<h.length;g++){a:{r=h[g];switch(r.type){case "ARRAY":if(!("fit_type"in r)){n.error("WARNING Incomplete modifier "+String(r.type)+' for "'+m.name+'", reexport "'+a.b4w_filepath_blend+'" scene');r=!1;break a}}r=!0}r||(h.splice(g,1),g--)}"animation_data"in m||(m.animation_data={action:null,nla_tracks:[]},b("object",m,"animation_data"));m.animation_data&&("action"in m.animation_data||(m.animation_data.action=null,n.warn("no action in animation data "+m.name)),"nla_tracks"in m.animation_data||
(m.animation_data.nla_tracks=[],n.warn("no NLA in animation data "+m.name)),d(m.animation_data));"b4w_collision_id"in m||(m.b4w_collision_id="",b("material",m,"b4w_collision_id"));g=m.scale;0==g[0]&&0==g[1]&&0==g[2]?g=!0:(h=Math.abs((g[1]-g[2])/g[1]),g=.005>Math.abs((g[0]-g[1])/g[0])&&.005>h);g||n.warn("non-uniform scale for object "+m.name);if(0>m.scale[0]||0>m.scale[1]||0>m.scale[2])n.warn("negative scale for object "+m.name+", using positive scale instead"),m.scale[0]=Math.abs(m.scale[0]),m.scale[1]=
Math.abs(m.scale[1]),m.scale[2]=Math.abs(m.scale[2])}for(var F in A)k=A[F],g=F.match(/.*?(?=>>|$)/i)[0],n.warn("WARNING "+String(g)+" is "+k.ts+" for "+k.type+", reexport "+a.b4w_filepath_blend)};a.aw=function(a,b){"num_channels"in a||(a.num_channels=1,n.warn('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport scene'))};a.xv=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var d=b[c].type;if("ARRAY"==d||"CURVE"==d){b=!0;break a}}b=!1}if(!b)return null;
b=g(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var e=a[c];switch(e.type){case "ARRAY":for(var d=b,m=e,n=0,p=0,I=0,F=new Float32Array(16),e=[],D=1;D<m.count;D++){m.use_constant_offset&&(n+=m.constant_offset_displace[0],p+=m.constant_offset_displace[1],I+=m.constant_offset_displace[2]);if(m.use_relative_offset)var L=d.b4w_bounding_box,n=n+(L.max_x-L.min_x)*m.relative_offset_displace[0],p=p+(L.max_y-L.min_y)*m.relative_offset_displace[1],I=I+(L.max_z-L.min_z)*m.relative_offset_displace[2];
f.LB(n,p,I,F);for(var A=L=g(d),B=F,J=0;J<A.submeshes.length;J++){var K=A.submeshes[J];f.df(K.position,B,K.position,0);f.DC(K.normal,B,K.normal);f.IB(K.tangent,B,K.tangent)}e.push(L)}for(D=0;D<e.length;D++)for(m=d,n=e[D],p=0;p<m.submeshes.length;p++){I=m.submeshes[p];F=n.submeshes[p];L=I.base_length;A=I.indices.length;I.base_length+=F.base_length;for(var P in I)if("base_length"!=P)if("indices"==P)for(I[P]=f.PB(I[P],F[P]),B=A;B<I.indices.length;B++)I.indices[B]+=L;else"vertex_colors"!=P&&(I[P]=f.Mx(I[P],
F[P]))}break;case "CURVE":for(var d=b,D=e.object.cv,m=new Float32Array(16),p=D.Xe?4:3,n=new Float32Array(p),p=new Float32Array(p),I=new Float32Array(3),F=new Float32Array(4),L=new Float32Array(4),A=new Float32Array(3),B=new Float32Array(3),J=new Float32Array(3),K=new Float32Array(4),R=new Float32Array(4),T=0;T<d.submeshes.length;T++){var Q=d.submeshes[T],X=Q.position,la=Q.normal,Q=Q.tangent,U;a:switch(U=e.deform_axis,U){case "POS_X":case "NEG_X":U=0;break a;case "POS_Y":case "NEG_Y":U=1;break a;case "POS_Z":case "NEG_Z":U=
2;break a;default:throw"Wrong deform axis value "+U;}A[0]=0;A[1]=0;A[2]=0;A[U]=1;for(var pa=k.rB(D),S=0;S<X.length/3;S++){J[0]=X[3*S];J[1]=X[3*S+1];J[2]=X[3*S+2];var qa=J[U],ga=k.qB(D,qa);k.sB(D,ga,n);I[0]=n[0];I[1]=n[1];I[2]=n[2];k.pB(D,ga,p);B[0]=p[0];B[1]=0;B[2]=p[2];l.normalize(B,B);x.rotationTo(A,B,F);0>qa?(n[0]=B[0],n[1]=B[1],n[2]=B[2],l.scale(n,qa,n),l.add(I,n,I)):qa>pa&&(n[0]=B[0],n[1]=B[1],n[2]=B[2],l.scale(n,qa-pa,n),l.add(I,n,I));z.fromRotationTranslation(F,I,m);D.Xe&&(x.setAxisAngle(A,
n[3],L),l.transformQuat(J,L,J));J[U]=0;l.transformMat4(J,m,J);X[3*S]=J[0];X[3*S+1]=J[1];X[3*S+2]=J[2];la.length&&(K[0]=la[3*S],K[1]=la[3*S+1],K[2]=la[3*S+2],K[3]=0,t.transformMat4(K,m,K),la[3*S]=K[0],la[3*S+1]=K[1],la[3*S+2]=K[2]);Q.length&&(R[0]=Q[3*S],R[1]=Q[3*S+1],R[2]=Q[3*S+2],R[3]=0,t.transformMat4(R,m,R),Q[3*S]=R[0],Q[3*S+1]=R[1],Q[3*S+2]=R[2])}}}h.fA(b)}return b};a.DD=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,
raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,
b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,
texture_slots:[]}};a.Fv=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_use_nla)for(var d=d.b4w_nla_script,f=0;f<d.length;f++){var e=d[f];switch(e.type){case "SELECT":case "SELECT_PLAY":for(var h=0;h<a.length;h++){var g=a[h];g.name==e.object&&(g.b4w_selectable=!0)}break;case "SHOW":case "HIDE":for(h=0;h<a.length;h++)g=a[h],g.name==e.object&&(g.b4w_do_not_batch=!0)}}}}};b4w.module.__scenegraph=function(a,p){function c(a){a=ec.Np(a);a.he=null;a.hb=null;a.Pc=null;return a}function d(a,c){var d=[];N.Hd(a,function(b,c,f){-1<d.indexOf(f)?N.pA(a,b,c,f,e(f)):d.push(f)});N.R(a,function(b,f){for(var v=0;v<f.ga.length;v++){var h=f.ga[v];c||"MAIN_PLANE_REFLECT"!=f.type&&"MAIN_CUBE_REFLECT"!=f.type&&"MAIN_XRAY"!=f.type||(h.Eg=!0);-1<d.indexOf(h)?f.ga[v]=e(h):d.push(h)}"ANTIALIASING"==f.type&&N.Ae(a,b,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.ga.length;c++){var d=
b.ga[c];d.ba=ca.s;d.aa=ca.s}});c||N.Ae(a,b,function(a,b,c){"DEPTH"==c.O&&(c.Eg=!0)})});N.R(a,function(c){var d={};b(a,c,d);for(var f in d){c=d[f];for(var v=c[0],e=0;e<c.length;e++)if(c[e].ba==ca.s){v=c[e];break}for(var h=c[0],e=0;e<c.length;e++)if(c[e].aa==ca.s){h=c[e];break}for(var g=c[0],e=0;e<c.length;e++)if(!c[e].Eg){g=c[e];break}for(e=0;e<c.length;e++)c[e].ba=v.ba,c[e].aa=h.aa,c[e].Eg=g.Eg}})}function b(a,c,d){N.Ae(a,c,function(c,f,v){v.Pa&&v.O==v.pa&&(d[v.O]=d[v.O]||[],-1==d[v.O].indexOf(v)&&
d[v.O].push(v),b(a,c,d))});N.qf(a,c,function(a,b,c){c.Pa&&(d[c.O]=d[c.O]||[],-1==d[c.O].indexOf(c)&&d[c.O].push(c))});c=N.Ta(a,c);if("MOTION_BLUR"==c.type)for(var f=0;f<c.ga.length;f++){var v=c.ga[f];d[v.O].push(v)}}function e(a){if(a.ua)throw"Failed to clone slink with attached texture";return Ha.Jf(a)}function g(a){var b=N.po(a),c=[];N.R(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":var v=[];break;default:v=c}for(var e=
0;e<d.ga.length;e++){var h=d.ga[e],g=l(v,h,k(h));h.ua=g;d.Fd[e]=g}for(e=0;e<d.Fd.length;e++)g=d.Fd[e],f(v,g);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":v=[]}N.qf(b,a,function(c,d,f){if(!f.ua){if((c=n(b,a,f.O))&&f.Pa&&!f.ua){d=v;for(var e=c,h=0;h<d.length;h++){var g=d[h];g.lo===e&&g.Wi++}}else c=l(v,f,k(f));f.ua=c}});N.Ae(b,a,function(a,b,c){f(v,c.ua)});N.qf(b,a,function(a,b,c){c.ua&&"NONE"==c.pa&&f(v,c.ua)})})}function h(a){x(a,
function(b,c,d){b.Oh&&(ba(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||ba(a,d,"ANTIALIASING")||"ANCHOR_VISIBILITY"==d.type)&&(b.mf*=ja.render_resolution_factor)})}function k(a){a=Ha.Jf(a);delete a.pa;delete a.Pa;delete a.ua;return JSON.stringify(a)}function n(a,b,c){var d=null;N.Ae(a,b,function(a,b,f){if(f.Pa&&f.O==f.pa&&f.O==c&&f.ua)return d=f.ua,!0});N.qf(a,b,function(a,b,f){if(f.Pa&&f.O==c&&f.ua)return d=f.ua,!0});return d}function f(a,b){for(var c=0;c<a.length;c++){var d=
a[c];d.lo===b&&d.Wi&&d.Wi--}}function l(a,b,c){for(var d=null,f=0;f<a.length;f++){var v=a[f];if(v.id==c&&0===v.Wi){d=v;break}}if(d&&!ja.tz)return d.Wi++,d.lo;b=t(b);a.push({id:c,Wi:1,lo:b});return b}function t(a){var b=a.mf*a.size;switch(a.O){case "COLOR":var c=ca.Pj("COLOR",ca.Jg);ca.resize(c,b,b);ca.$i(c,a.ba,a.aa);return c;case "DEPTH":return a.Eg?(c=ca.Pj("DEPTH_RBUF",ca.Ig),ca.resize(c,b,b)):(c=ca.Pj("DEPTH_TEX",ca.Wh),ca.resize(c,b,b),ca.$i(c,a.ba,a.aa)),c;case "CUBEMAP":return c=ca.Gw(b);case "SCREEN":return null;
default:throw"Wrong slink param: "+a.O;}}function x(a,b){var c=!1;N.Hd(a,function(d,f,v){if(v&&(d=N.Ta(a,d),f=N.Ta(a,f),b(v,!1,d,f)))return c=!0});c||N.R(a,function(a,c){for(var d=0;d<c.ga.length;d++)if(b(c.ga[d],!0,c,null))return!0})}function z(a){N.R(a,function(b,c){if("SINK"!=c.type){var d=c.j;N.qf(a,b,function(a,b,c){c.Pa&&c.ua&&(G.Pk(d,c.O,c.ua),c.O==c.pa&&b.j&&G.Pk(b.j,c.O,c.ua))});for(var f=0;f<c.ga.length;f++){var v=c.ga[f];v.Pa&&v.O==v.pa&&G.Pk(d,v.O,c.Fd[f])}!d.hb&&!d.Pc||d.he||(d.he=ta.oA(d.hb,
d.Pc))}})}function D(a){var b=null,c=0;N.R(a,function(a,d){if(d.type==ub.EB){if(c==ub.DB)return b=d,!0;c++}});return b}function A(a,b){var c=N.kg(a,b),d=m("NONE"),f=N.u(a,d),v=N.Mq(a)[0];N.Hd(a,function(b,c){c==v&&N.gA(a,b,v,b,f)});N.Hd(a,function(f,v,e){if(f==c)return N.m(a,b,d,y(ub.cB,"u_color",e.size,e.mf,e.Oh)),!0});N.Xc(a,f,v,y("SCREEN","NONE",.5,.5,!0))}function H(a,b){var c=u("SHADOW_CAST");c.cm=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.en){case "SPOT":case "POINT":c.j=
G.lb(G.Hb);G.Qk(c.j,180*b.jd/Math.PI,.1,2*b.distance);break;default:c.j=G.lb(G.zf)}return c}function u(a){a={type:a,Ja:"",Ca:!1,$r:!1,zl:!1,sk:!1,li:0,time:0,j:null,ki:null,em:[],q:[],ga:[],Fd:[],kj:new Float32Array(3),Et:new Float32Array(3),ac:new Float32Array(3),uc:new Float32Array(4),oc:new Float32Array(16),Js:0,Qe:0,mg:0,cg:null,Ye:null,bg:null,dg:null,Ue:new Float32Array(3),xf:new Float32Array(3),Ks:new Float32Array(4),at:new Float32Array([0,0,0]),Wk:new Float32Array(3),bt:new Float32Array(4),
Is:new Float32Array(3),Li:0,nm:0,Di:!1,bf:new Float32Array(3),uf:0,fb:null,cl:!1,jf:new Float32Array(2),kf:new Float32Array(2),Ah:0,nh:0,Pl:0,md:null,wf:0,Hg:0,vf:0,Xd:!1,xp:0,yp:new Float32Array(2),wp:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,Bh:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,
Eh:0,Dh:0,Ch:0,Vs:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,mh:0,Kk:0,Hh:0,cm:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,st:null,lp:null,rg:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,Hl:0,tm:0,mb_decay_threshold:0,mb_factor:0,Ar:0,Gk:"",jz:new Float32Array(2),small_glow_mask_width:0,large_glow_mask_width:0,small_glow_mask_coeff:0,large_glow_mask_coeff:0,mo:new Float32Array(2),Ka:new Float32Array(2),Ra:!0,enqueue:!0,da:!0,ja:!0,
Eb:!0,na:!0,ze:1};a.Ka[0]=1;a.Ka[1]=1;return a}function y(a,b,c,d,f){return{O:a,pa:b,size:c,mf:d,Oh:f,Pa:!0,ua:null,Eg:!1,ba:ca.kc,aa:ca.kc}}function q(a,b){for(var c=0,d=fa(a,b),f=0;f<d.length;f++){var v=d[f];"SHADOW_CAST"==v.type&&(v=v.j,b.Qz=v.Sa/(v.Sa-v.Ua),b.st=v.qa,b.lp=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.rg=b.rg||[],b.rg[c]=v.ta,c++)}}function w(){var a=u("GRASS_MAP");a.j=G.lb(G.Ee);return a}function m(a){var b=u("POSTPROCESSING");b.da=!1;b.ja=!1;b.Eb=!1;b.j=G.lb(G.tb);
b.Gk=a;switch(a){case "NONE":b.Ka[0]=1;b.Ka[1]=1;break;case "GRAYSCALE":b.Ka[0]=1;b.Ka[1]=1;break;case "X_BLUR":b.Ka[0]=1;b.Ka[1]=0;break;case "Y_BLUR":b.Ka[0]=0;b.Ka[1]=1;break;case "X_GLOW_BLUR":b.Ka[0]=1;b.Ka[1]=0;break;case "Y_GLOW_BLUR":b.Ka[0]=0;b.Ka[1]=1;break;case "X_EXTEND":b.Ka[0]=1;b.Ka[1]=0;break;case "Y_EXTEND":b.Ka[0]=0;b.Ka[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}return b}function r(a){var b=u("BLOOM_BLUR");b.da=!1;b.ja=!1;b.Eb=!1;b.j=G.lb(G.tb);b.Gk=a;switch(a){case "X_BLUR":b.Ka[0]=
1;b.Ka[1]=0;break;case "Y_BLUR":b.Ka[0]=0;b.Ka[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}return b}function E(a,b){var c=u("GLOW_COMBINE");c.da=!1;c.ja=!1;c.Eb=!1;c.small_glow_mask_coeff=b.Te.small_glow_mask_coeff;c.large_glow_mask_coeff=b.Te.large_glow_mask_coeff;c.small_glow_mask_width=b.Te.small_glow_mask_width;c.large_glow_mask_width=b.Te.large_glow_mask_width;c.j=a;return c}function I(a,b,c,d,f,v,e,h,g){var k=u("MAIN_"+a);if("OPAQUE"===a)k.da=!0,k.ja=c,k.Ca=!1;
else if("BLEND"===a)k.da=!1,k.ja=!1,k.Ca=!0;else if("XRAY"===a)k.da=!1,k.ja=!0,k.Ca=!0;else if("PLANE_REFLECT"===a||"CUBE_REFLECT"===a)k.da=!0,k.ja=!0,k.Ca=!1;else if("GLOW"===a)k.da=!0,k.ja=!1,k.Ca=!1;else throw"wrong main subscene type";k.Ca&&h&&(k.self_shadow_normal_offset=h.self_shadow_normal_offset);k.j=b;if(a=e.Un)k.Ks.set([a.Nv,a.Uy,a.MC,a.LC]),k.Is.set(a.color),k.Js=a.va;k.Ue.set(e.Ue);k.xf.set(e.xf);k.Qe=e.Qe;k.uc=v;d&&(k.fb=d,d.uc&&(k.md=new Float32Array(d.uc)),k.wf=d.waves_height,k.Hg=
d.waves_length,k.vf=d.vf,d.Xd&&g&&(k.Xd=!0,k.xp=d.Yv,k.yp.set(d.Zv),k.wp=d.Xv),d.Sk&&(k.cl=!0,v=d.aB,k.jf[0]=(v[0]+v[1])/2,k.jf[1]=(v[2]+v[3])/2,k.kf[0]=v[0]-v[1],k.kf[1]=v[2]-v[3],k.Ah=d.Ah,k.nh=d.nh));k.cg=new Float32Array(3*f);k.Ye=new Float32Array(3*f);k.bg=new Float32Array(3*f);k.dg=new Float32Array(0==f%2?2*f:2*f+2);return k}function F(a,b){var c=u("COLOR_PICKING");b&&(c.type+="_XRAY",c.da=!1,c.ja=!0);c.enqueue=!1;c.j=a;return c}function M(a){var b=u("WIREFRAME");b.Ra=!1;b.da=!1;b.ja=!1;b.j=
a;return b}function L(a){var b=u("ANCHOR_VISIBILITY");b.da=!0;b.ja=!1;b.j=a;return b}function O(a,b){var c=u("DEPTH");c.j=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function B(a,b,c){var d=u("SSAO");d.da=!1;d.ja=!1;d.Eb=!1;d.j=a;d.uc=b;d.md=new Float32Array(b);d.Eh=c.radius_increase;d.ssao_hemisphere=c.Ty;d.Dh=c.influence;d.Ch=c.dist_factor;d.Vs=c.wA;return d}function J(a,b){var c=u("SSAO_BLUR");c.da=!1;c.ja=!1;c.Eb=!1;c.j=a;c.ssao_blur_depth=b.Qv;c.ssao_blur_discard_value=
b.pp;return c}function K(){var a=u("ANTIALIASING");a.da=!1;a.ja=!1;a.Eb=!1;a.ze=1/ja.render_resolution_factor;a.j=G.lb(G.tb);return a}function P(a){var b=u(a);b.da="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.ja=!1;b.Eb=!1;b.ze=1/ja.render_resolution_factor;b.j=G.lb(G.tb);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.kz=new Float32Array(4));return b}function R(a,b,c,d){var f=u("COMPOSITING");f.da=!1;f.ja=!1;f.Eb=!1;f.j=G.lb(G.tb);f.brightness=a;f.contrast=b;f.exposure=c;f.saturation=
d;return f}function T(a,b){var c=u("MOTION_BLUR");c.da=!1;c.ja=!1;c.Eb=!1;c.j=G.lb(G.tb);c.zl=!0;c.mb_decay_threshold=a;c.mb_factor=b;return c}function Q(a){var b=u("DOF");b.da=!1;b.ja=!1;b.Eb=!1;b.j=a;b.ze=b.j.dof_power;return b}function X(a){var b=u("OUTLINE_MASK");b.Eb=!1;b.j=a;return b}function la(a){var b=u("OUTLINE");b.bf.set(a.bf);b.Li=a.Li;b.tm=5;b.Hl=3;b.Eb=!1;b.j=G.lb(G.tb);return b}function U(){var a=u("REFRACT");a.da=!1;a.ja=!1;a.Eb=!1;a.j=G.lb(G.tb);return a}function pa(a,b,c,d,f,v,e){var h=
u("GOD_RAYS");h.da=!1;h.ja=!1;h.Eb=!1;h.Ue=new Float32Array([1,1,1]);h.xf=new Float32Array([1,1,1]);h.Qe=1;h.$r=d;h.uf=b;h.Kk=f;h.mh=c;h.Hh=e;h.j=a;h.mg=v;h.cg=new Float32Array(3*v);h.Ye=new Float32Array(3*v);h.bg=new Float32Array(3*v);h.dg=new Float32Array(0==v%2?2*v:2*v+2);return h}function S(a,b){var c=u("GOD_RAYS_COMBINE");c.da=!1;c.ja=!1;c.Eb=!1;c.j=G.lb(G.tb);c.god_rays_intensity=a;c.mg=b;c.cg=new Float32Array(3*b);c.Ye=new Float32Array(3*b);c.bg=new Float32Array(3*b);c.dg=new Float32Array(0==
b%2?2*b:2*b+2);return c}function qa(a,b){var c=u("SKY");c.enqueue=!1;c.da=!1;c.ja=!1;c.Eb=!1;var d=G.lb(G.tb);d.width=wa.Rj;d.height=wa.Rj;c.j=d;c.ki=Ha.Yx();c.mg=a;c.cg=new Float32Array(3*a);c.Ye=new Float32Array(3*a);c.bg=new Float32Array(3*a);c.dg=new Float32Array(0==a%2?2*a:2*a+2);c.Ue=new Float32Array([1,1,1]);c.xf=new Float32Array([1,1,1]);c.Qe=1;c.Bh.set(b.Bh);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;
c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function ga(){var a=u("COPY");a.da=!1;a.ja=!1;a.j=G.lb(G.tb);return a}function ha(){var a=u("ANAGLYPH");a.da=!1;a.ja=!1;a.j=G.lb(G.tb);return a}function Y(){var a=u("LUMINANCE");
a.da=!1;a.ja=!1;a.j=G.lb(G.tb);return a}function ea(){var a=u("AVERAGE_LUMINANCE");a.da=!1;a.ja=!1;a.j=G.lb(G.tb);return a}function Z(a,b,c,d){var f=u("LUMINANCE_TRUNCED");f.da=!1;f.ja=!1;f.bloom_key=a;f.bloom_edge_lum=b;f.j=d;f.cg=new Float32Array(3*c);f.Ye=new Float32Array(3*c);f.bg=new Float32Array(3*c);f.dg=new Float32Array(0==c%2?2*c:2*c+2);return f}function C(a){var b=u("BLOOM");b.da=!1;b.ja=!1;b.j=G.lb(G.tb);b.bloom_blur=a;return b}function W(){var a=u("SINK");a.enqueue=!1;return a}function ba(a,
b,c){if(b.type===c)return!0;b=da(a,b);for(var d=0;d<b.length;d++)if(ba(a,b[d],c))return!0;return!1}function ma(a,b,c){if(b.type===c)return!0;b=fa(a,b);for(var d=0;d<b.length;d++)if(ma(a,b[d],c))return!0;return!1}function fa(a,b){var c=N.kg(a,b);if(c==N.Mo)throw"Subscene not in graph";for(var d=[],f=N.ar(a,c),v=0;v<f;v++){var e=N.$j(a,c,v);e!=c&&d.push(N.Ta(a,e))}return d}function da(a,b){var c=N.kg(a,b);if(c==N.Mo)throw"Subscene not in graph";for(var d=[],f=N.qg(a,c),v=0;v<f;v++){var e=N.Wf(a,c,v);
e!=c&&d.push(N.Ta(a,e))}return d}function aa(a){var b=[],c=[];x(a,function(a){a.ua&&-1==b.indexOf(a.ua)&&(b.push(a.ua),c.push(a.ua,b.length-1))});return c}function v(a,b){var c;c=""+(a.O+"\\n");c+="NONE"!=a.pa?a.pa+"\\n":"";c+="(";if(a.Oh){var d=a.mf;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.O){c+=" ";if(a.Eg)c+="RR";else{var d=a.ba,f=a.aa,v="";d==ca.s?v+="L":d==ca.kc&&(v+="N");f==ca.s?v+="L":f==ca.kc&&(v+="N");c+=v}for(d=0;d<b.length;d+=
2)b[d]==a.ua&&(c+=" "+b[d+1])}return c+")\\n"}var G=p("__camera"),oa=p("__config"),Ka=p("__debug"),N=p("__graph"),ta=p("__renderer"),ca=p("__textures"),Ha=p("__util"),ec=p("__objects");p("vec4");var ub=oa.jm,ja=oa.p,wa=oa.wh;a.kw=function(a){switch(a.pa){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "NONE":return!1;default:return!0}};a.OB=x;a.Sw=function(a,b,f){function v(d,f){var h=c(ra[f]);b.I.push(h);h=I(d,h,!1,Tb,da,Oa,$a,Sa,a.Ag);l.push(h);N.u(e,h);N.m(e,k[f],h,
t[f]);"XRAY"==d?h.ga.push(y("DEPTH","DEPTH",1,1,!0)):N.m(e,k[f],h,oa[f]);ob&&(N.m(e,ob,h,Pa),N.m(e,ob,h,rb));if(La){for(var g=0;g<ba.length;g++)N.m(e,ba[g],h,ec[g]);if(Ub.fc&&Aa||Ra||Eb){var g=jc[f],G=c(g.j);b.I.push(G);var m=u("DEPTH_PACK");m.da=!1;m.ja=!1;m.j=G;N.u(e,m);var G=y("DEPTH","u_depth",1,1,!0),q=y("COLOR","u_scene_depth",1,1,!0);q.ba=ca.kc;q.aa=ca.kc;N.m(e,g,m,G);N.m(e,m,h,q)}}if(aa.length)for(m=aa.length/ra.length,g=0;g<m;g++)G=m*f+g,N.m(e,aa[G],h,x[G]);if(ma.length)for(g=0;g<ma.length;g++)N.m(e,
ma[g],h,fa[g]);ta.length&&N.m(e,ta[f],h,p[f]);return h}var e=N.create(),k=[],l=[],n=[],t=[],oa=[],aa=[],x=[],ta=[],p=[],ba=[],ec=[],ma=[],fa=[],da=a.mz,Tb=a.fb,Ra=a.shore_smoothing,Eb=a.eB,zb=a.On,Fa=a.xe,Vb=a.bh,Ub=a.yz,Wb=a.zb,Nc=a.Og,Cc=a.ph,va=a.Sg,Ga=a.antialiasing,$a=a.Go,Oa=a.uc,Sa=a.ue,Xb=a.Bz,lb=a.Pv,Qa=a.$v,Ba=a.Ny,fb=a.Oz,Ma=a.Wg,La=a.qx,Aa=a.fc,ya=Boolean(f.length),ra=[];if(a.anaglyph_use&&!ya){var Gb=b.I[0],Hb=c(Gb);G.xr(Gb,G.ub);G.xr(Hb,G.Cb);ra.push(Gb,Hb);b.I.push(Hb)}else{var xa=
b.I[0];ra.push(xa)}if(zb){G.to(ra[0],Sa);for(var Yb=Sa.csm_num,V=0;V<Yb;V++){var Qb=H(V,Sa);N.u(e,Qb);ba.push(Qb);var Ua=Sa.csm_resolution,xa=Qb.j;xa.width=Ua;xa.height=Ua;Qb.da=!1;ec.push(y("DEPTH","u_shadow_map"+V,Ua,1,!1));(Ka.Ap()||ja.oq)&&Qb.ga.push(y("COLOR","COLOR",Ua,1,!1))}}if(Wb&&Wb.Gr&&!ya)for(V=0;V<Wb.Gr;V++){xa=G.lb(G.Hb);xa.width=a.Nf;xa.height=a.Nf;G.Qk(xa,90,.1,100);G.gf(xa,xa.za);var za=I("CUBE_REFLECT",xa,!1,Tb,da,Oa,$a,null,a.Ag);za.ki=Ha.by();for(var ua=0;6>ua;ua++)za.em.push(G.Jw());
N.u(e,za);var Zb=y("CUBEMAP","u_cube_reflection",a.Nf,1,!1);Zb.ba=ca.s;Zb.aa=ca.s;var qc=y("DEPTH","DEPTH",a.Nf,1,!1);fa.push(Zb);za.ga.push(qc);ma.push(za);Wb.Qj.push(za)}if(Wb&&0<Wb.Mk.length&&!ya)for(V=0;V<ra.length;V++)for(ua=0;ua<Wb.Mk.length;ua++)xa=c(ra[V]),xa.ec=new Float32Array(4),b.I.push(xa),za=I("PLANE_REFLECT",xa,!1,Tb,da,Oa,$a,null,a.Ag),N.u(e,za),Zb=y("COLOR","u_plane_reflection",1,a.Ri,!0),Zb.ba=ca.s,Zb.aa=ca.s,qc=y("DEPTH","DEPTH",1,a.Ri,!0),x.push(Zb),za.ga.push(qc),aa.push(za),
Wb.Si.push(za);k=[];l=[];if(a.wb){var ob=w();N.u(e,ob);Ua=wa.ak;ob.j.width=Ua;ob.j.height=Ua;var Pa=y("DEPTH","u_grass_map_depth",Ua,1,!1);Pa.ba=ca.s;Pa.aa=ca.s;var rb=y("COLOR","u_grass_map_color",Ua,1,!1);rb.ba=ca.s;rb.aa=ca.s}else rb=Pa=ob=null;for(var Ia=[],gb=[],jc=[],Ib=[],V=0;V<ra.length;V++){var xa=ra[V],Xa={};oa.push(y("DEPTH","DEPTH",1,1,!0));if(La){var Jb=c(xa);b.I.push(Jb);Xa=O(Jb,Sa);jc.push(Xa);N.u(e,Xa);if(zb){for(ua=0;ua<ba.length;ua++)Qb=ba[ua],N.m(e,Qb,Xa,ec[ua]);var Dc=y("COLOR",
"u_color",1,1,!0),Kb=y("DEPTH","u_depth",1,1,!0);if(Fa){var Ec=c(xa);b.I.push(Ec);var Ta=a.uB,ab=B(Ec,Oa,Ta);N.u(e,ab);var pb=y("COLOR","u_ssao_mask",1,1,!0);N.m(e,Xa,ab,Dc);N.m(e,Xa,ab,Kb);var Rb=c(xa);b.I.push(Rb);var bb=J(Rb,Ta);N.u(e,bb);var Sb=y("COLOR","u_shadow_mask",1,1,!0);N.m(e,ab,bb,pb);N.m(e,Xa,bb,Kb)}}else Ka.Ap()&&Xa.ga.push(y("COLOR","COLOR",1,1,!0));ob&&(N.m(e,ob,Xa,Pa),N.m(e,ob,Xa,rb))}za=I("OPAQUE",xa,!La,Tb,da,Oa,$a,null,a.Ag);N.u(e,za);l.push(za);gb.push(za);La&&(N.m(e,Xa,za,oa[V]),
pb?N.m(e,bb,za,Sb):zb&&N.m(e,Xa,za,y("COLOR","u_shadow_mask",1,1,!0)));var Fb=y("COLOR","u_color",1,1,!0);t.push(y("COLOR","COLOR",1,1,!0));ob&&(N.m(e,ob,za,Pa),N.m(e,ob,za,rb));if(aa.length)for(var kc=aa.length/ra.length,ua=0;ua<kc;ua++){var sa=kc*V+ua;N.m(e,aa[sa],za,x[sa])}if(ma.length)for(ua=0;ua<ma.length;ua++)N.m(e,ma[ua],za,fa[ua])}k=l;l=[];if(!ya&&a.rw){xa=c(k[0].j);b.I.push(xa);var cb=F(xa,!1);N.u(e,cb);if(a.Ce){xa=c(k[0].j);b.I.push(xa);var qb=F(xa,!0);N.u(e,qb);N.m(e,cb,qb,y("COLOR","COLOR",
1,1,!0));N.m(e,cb,qb,y("DEPTH","DEPTH",1,1,!0))}}else cb=null;if(Ub.fc&&!ya)for(V=0;V<ra.length;V++){var $b=U();N.u(e,$b);N.m(e,k[V],$b,Fb);ta.push($b);p.push(y("COLOR","u_refractmap",1,1,!0))}if(a.Mm){for(V=0;V<ra.length;V++)za=v("BLEND",V),Ia.push(za);k=l;l=[]}if(a.Se){for(V=0;V<ra.length;V++){var Ea=c(ra[V]);b.I.push(Ea);var vc=I("GLOW",Ea,!1,Tb,da,Oa,$a);N.u(e,vc);N.m(e,gb[V],vc,oa[V]);var Lb=m("X_GLOW_BLUR");Lb.Ja="GLOW_MASK_SMALL";Lb.ze=a.Te.small_glow_mask_width;var db=y("COLOR","u_color",
1,1,!0);db.ba=ca.s;db.aa=ca.s;N.u(e,Lb);N.m(e,vc,Lb,db);var hb=m("Y_GLOW_BLUR");hb.Ja="GLOW_MASK_SMALL";hb.ze=a.Te.small_glow_mask_width;var rc=y("COLOR","u_color",1,.5,!0);rc.ba=ca.s;rc.aa=ca.s;N.u(e,hb);N.m(e,Lb,hb,rc);var Ab=m("X_GLOW_BLUR");Ab.Ja="GLOW_MASK_LARGE";Ab.ze=a.Te.large_glow_mask_width;var fc=y("COLOR","u_color",1,.5,!0);fc.ba=ca.s;fc.aa=ca.s;N.u(e,Ab);N.m(e,hb,Ab,fc);var sb=m("Y_GLOW_BLUR");sb.Ja="GLOW_MASK_LARGE";sb.ze=a.Te.large_glow_mask_width;var ib=y("COLOR","u_color",1,.25,!0);
ib.ba=ca.s;ib.aa=ca.s;N.u(e,sb);N.m(e,Ab,sb,ib);var Bb=c(ra[V]);b.I.push(Bb);var lc=E(Bb,a);N.u(e,lc);a.Mm?N.m(e,Ia[V],lc,y("COLOR","u_src_color",1,1,!0)):N.m(e,gb[V],lc,y("COLOR","u_src_color",1,1,!0));var tb=y("COLOR","u_glow_mask_small",1,.5,!0);tb.ba=ca.s;tb.aa=ca.s;N.m(e,hb,lc,tb);var ac=y("COLOR","u_glow_mask_large",1,.25,!0);ac.ba=ca.s;ac.aa=ca.s;N.m(e,sb,lc,ac);n.push(lc)}k=n;l=[]}if(!a.Mm){for(V=0;V<ra.length;V++)za=v("BLEND",V),Ia.push(za);k=l;l=[]}if(a.Ce){for(V=0;V<ra.length;V++){var wb=
v("XRAY",V);Ib.push(wb)}k=l;l=[]}if(ja.wireframe_debug){for(V=0;V<ra.length;V++){xa=c(ra[V]);b.I.push(xa);var bc=M(xa);l.push(bc);N.u(e,bc);N.m(e,k[V],bc,t[V]);N.m(e,k[V],bc,oa[V]);ob&&(N.m(e,ob,bc,Pa),N.m(e,ob,bc,rb))}k=l;l=[]}if(!ya&&a.ev){xa=c(ra[0]);b.I.push(xa);var Cb=L(xa);N.u(e,Cb);N.m(e,k[0],Cb,oa[0])}if(Vb&&La&&!ya){for(V=0;V<ra.length;V++){var Mb=Ba.mh,wc=Ba.Zy,Db=Ba.Hh,Da=k[V],Oc=Tb?1:0,xc=y("DEPTH","u_input",1,1,!0);xc.ba=ca.s;xc.aa=ca.s;var Nb=y("COLOR","u_input",1,.25,!0);Nb.ba=ca.s;
Nb.aa=ca.s;var mc=Mb/Db,Fc=c(ra[V]);b.I.push(Fc);var Ja=pa(Fc,Oc,Mb,!0,mc,da,Db);N.u(e,Ja);N.m(e,Da,Ja,xc);var mc=Mb/Db*.5,Va=c(ra[V]);b.I.push(Va);var yc=pa(Va,Oc,Mb,!1,mc,da,Db);N.u(e,yc);N.m(e,Ja,yc,Nb);var mc=Mb/Db*.25,hd=c(ra[V]);b.I.push(hd);var gc=pa(hd,Oc,Mb,!1,mc,da,Db);N.u(e,gc);N.m(e,yc,gc,Nb);var Tc=S(wc,da);l.push(Tc);N.u(e,Tc);N.m(e,Da,Tc,y("COLOR","u_main",1,1,!0));N.m(e,gc,Tc,y("COLOR","u_god_rays",1,1,!0))}k=l;l=[]}if(Nc&&!ya){for(V=0;V<ra.length;V++){var Da=k[V],Yc=Y();N.u(e,Yc);
N.m(e,Da,Yc,y("COLOR","u_input",1,1,!0));var Ob=ea();N.u(e,Ob);Ob.j.width=1;Ob.j.height=1;var jd=y("COLOR","u_input",1,.25,!0);jd.ba=ca.s;jd.aa=ca.s;var kd=y("COLOR","u_luminance",1,.25,!0);kd.ba=ca.s;kd.aa=ca.s;N.m(e,Yc,Ob,jd);var rd=lb.key,sd=lb.wx,xb=c(ra[V]);b.I.push(xb);var Gc=Z(rd,sd,da,xb);N.u(e,Gc);N.m(e,Da,Gc,y("COLOR","u_main",1,1,!0));N.m(e,Yc,Gc,kd);N.m(e,Ob,Gc,y("COLOR","u_average_lum",1,1,!1));var sc=y("COLOR","u_color",1,.25,!0);sc.ba=ca.s;sc.aa=ca.s;Lb=r("X_BLUR");N.u(e,Lb);N.m(e,
Gc,Lb,sc);hb=r("Y_BLUR");N.u(e,hb);N.m(e,Lb,hb,sc);var Uc=C(lb.blur);N.u(e,Uc);var ld=y("COLOR","u_bloom",1,.25,!0);ld.ba=ca.s;ld.aa=ca.s;N.m(e,hb,Uc,ld);N.m(e,Da,Uc,y("COLOR","u_main",1,1,!0));l.push(Uc)}k=l;l=[]}if(Cc&&!ya){for(V=0;V<k.length;V++){var td=k[V],dd=T(Xb.mb_decay_threshold,Xb.mb_factor);l.push(dd);N.u(e,dd);N.m(e,td,dd,y("COLOR","u_mb_tex_curr",1,1,!0));dd.ga.push(y("COLOR","u_mb_tex_accum",1,1,!0))}k=l;l=[]}if(Ma&&La&&!ya){for(V=0;V<k.length;V++){var Da=k[V],Hc=c(ra[V]);b.I.push(Hc);
sc=y("COLOR","u_color",1,1,!0);sc.ba=ca.s;sc.aa=ca.s;var Ic=m("X_BLUR");N.u(e,Ic);N.m(e,Da,Ic,sc);var Jc=m("Y_BLUR");N.u(e,Jc);N.m(e,Ic,Jc,sc);var Xa=Ia[V],Kc=Q(Hc);Hc.dof_distance=b.dof_distance;Hc.de=b.de;Hc.dof_front=b.dof_front;Hc.dof_rear=b.dof_rear;Hc.dof_power=b.dof_power;Hc.dof_on=1;l.push(Kc);N.u(e,Kc);N.m(e,Da,Kc,y("COLOR","u_sharp",1,1,!0));N.m(e,Jc,Kc,y("COLOR","u_blurred",1,1,!0));N.m(e,Xa,Kc,y("DEPTH","u_depth",1,1,!0))}k=l;l=[]}if(!ya&&a.outline){for(V=0;V<ra.length;V++){var Da=k[V],
md=c(ra[V]);b.I.push(md);var Vc=X(md);N.u(e,Vc);var zc=m("X_EXTEND"),Zc=y("COLOR","u_color",1,1,!0),hc=y("COLOR","u_outline_mask",1,1,!0);zc.Di=!0;N.u(e,zc);N.m(e,Vc,zc,Zc);var Pc=y("COLOR","u_color",1,.5,!0);Pc.ba=ca.s;Pc.aa=ca.s;var $c=m("Y_EXTEND");$c.Di=!0;N.u(e,$c);N.m(e,zc,$c,Pc);Ic=m("X_BLUR");Ic.Di=!0;N.u(e,Ic);N.m(e,$c,Ic,Pc);var nc=y("COLOR","u_color",1,.25,!0);nc.ba=ca.s;nc.aa=ca.s;var nd=y("COLOR","u_outline_mask_blurred",1,.25,!0);nd.ba=ca.s;nd.aa=ca.s;Jc=m("Y_BLUR");Jc.Di=!0;N.u(e,Jc);
N.m(e,Ic,Jc,nc);var Lc=la(fb);N.u(e,Lc);N.m(e,Da,Lc,y("COLOR","u_outline_src",1,1,!0));N.m(e,Vc,Lc,hc);N.m(e,Jc,Lc,nd);l.push(Lc)}k=l;l=[]}if(va&&!ya){for(V=0;V<k.length;V++){var Da=k[V],Ac=R(Qa.brightness,Qa.contrast,Qa.exposure,Qa.saturation);N.u(e,Ac);N.m(e,Da,Ac,y("COLOR","u_color",1,1,!0));l.push(Ac)}k=l;l=[]}if(Ga){for(V=0;V<k.length;V++)if(Da=k[V],ja.smaa){var tc=y("COLOR","u_color",1,1,!0);tc.ba=ca.s;tc.aa=ca.s;var ed=P("SMAA_EDGE_DETECTION");N.u(e,ed);N.m(e,Da,ed,tc);var ia=P("SMAA_BLENDING_WEIGHT_CALCULATION");
N.u(e,ia);N.m(e,ed,ia,tc);var Ya=y("COLOR","u_search_tex",1,1,!1),od=y("COLOR","u_area_tex",1,1,!1);Ya.ba=ca.s;Ya.aa=ca.s;od.ba=ca.s;od.aa=ca.s;ia.ga.push(Ya);ia.ga.push(od);var Bc=P("SMAA_NEIGHBORHOOD_BLENDING");N.u(e,Bc);N.m(e,Da,Bc,tc);var Na=y("COLOR","u_blend",1,1,!0);Na.ba=ca.s;Na.aa=ca.s;N.m(e,ia,Bc,Na);l.push(Bc)}else{var eb=K();N.u(e,eb);var fd=y("COLOR","u_color",1,1,!0);fd.ba=ca.s;fd.aa=ca.s;N.m(e,Da,eb,fd);if(1<ja.render_resolution_factor){var yb=m("NONE");N.u(e,yb);N.m(e,eb,yb,fd);l.push(yb)}else l.push(eb)}k=
l;l=[]}if(a.anaglyph_use&&!ya){var Qc=ha();N.u(e,Qc);N.m(e,k[0],Qc,y("COLOR","u_sampler_left",1,1,!0));N.m(e,k[1],Qc,y("COLOR","u_sampler_right",1,1,!0));l.push(Qc)}else l.push(k[0]);var Wc=N.kg(e,k[0]);if("MOTION_BLUR"==k[0].type)var Xc=!0;else Xc=!1,N.Ae(e,Wc,function(a,b,c){if(c.O==c.pa)return Xc=!0});if(Xc){var ic=ga();N.u(e,ic);N.m(e,k[0],ic,y("COLOR","u_color",1,1,!0));k=l;l=[];l.push(ic)}cb&&(qb?l.push(qb):l.push(cb));Cb&&l.push(Cb);if(!ya&&a.Uk.procedural_skydome){var ad=qa(da,a.Uk);N.u(e,
ad);l.push(ad)}var cc=W();N.u(e,cc);for(V=0;V<l.length;V++){var bd=l[V];switch(bd.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":N.m(e,bd,cc,y("COLOR","NONE",1,1,!0));N.m(e,bd,cc,y("DEPTH","NONE",1,1,!0));break;case "SKY":N.m(e,bd,cc,y("CUBEMAP","u_sky",wa.Rj,1,!1));break;case "ANCHOR_VISIBILITY":N.m(e,bd,cc,y("COLOR","NONE",1,1,!0));break;default:if(ya){var pd=f[0].e,dc=y("COLOR","OFFSCREEN",1,1,!0);dc.ua=pd;N.m(e,l[V],cc,dc);for(ua=1;ua<f.length;ua++){var cd=f[ua].e,ic=ga();N.u(e,ic);N.m(e,
l[V],ic,y("COLOR","u_color",1,1,!0));dc=y("COLOR","OFFSCREEN",1,cd.yg/pd.yg,!0);dc.ua=cd;N.m(e,ic,cc,dc)}}else N.m(e,l[V],cc,y("SCREEN","NONE",1,1,!0))}}if(ub.enabled){var ud=D(e);ud&&A(e,ud)}d(e,La);1<ja.render_resolution_factor&&h(e);g(e);z(e);if(zb){for(V=0;V<jc.length;V++)q(e,jc[V]);for(V=0;V<Ia.length;V++)q(e,Ia[V]);for(V=0;V<Ib.length;V++)q(e,Ib[V])}return e};a.uE=u;a.Dc=function(a,b,c){var d=a.ze;a.mo[0]=b*a.Ka[0]*d;a.mo[1]=c*a.Ka[1]*d};a.Nb=function(a,b){a.ze=b};a.SD=function(a){var b=null;
N.R(a,function(a,c){return c.j&&null===c.j.he?(b=c,!0):!1});return b};a.Fa=function(a,b,c){a=fa(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.mE=ba;a.oE=ma;a.yy=fa;a.hE=da;a.Ga=function(a,b){var c=null;N.R(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.hx=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=aa(a);N.R(a,function(a,d){var f=b+=
"    ",e="",e=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(e+=" ("+d.Gk.replace(/_/g," ")+")");if(d.j){for(var e=e+"\\n",h=0;h<c.length;h+=2)c[h]==d.j.hb&&(e+="C"+c[h+1]+" ");for(h=0;h<c.length;h+=2)c[h]==d.j.Pc&&(e+="D"+c[h+1])}d.ga.length&&(e+="\\n-----\\n");for(h=0;h<d.ga.length;h++)e+=v(d.ga[h],c);h="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=f+(String(a)+' [label="'+e+'" color="black" style="'+(h+",bold")+'"];\n')});N.Hd(a,function(a,d,f){b+="    ";b+=String(a)+" -> "+String(d)+
' [label="'+v(f,c)+'" style="'+(f.Pa?"solid":"dotted")+'"];\n'});return b+="}"};a.Tw=function(a){a=N.KB(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,p){function c(){return{name:"",type:0,source:"",Xn:"",width:0,height:0,Zl:1,yj:!0,yg:1024,gq:!1,Wd:null,Oa:null,xh:null,ys:1,te:0,yh:!1,fl:!1,ag:!1,K:0,ma:0,Zg:0,oC:!1,Cg:!1,vn:0,$b:0,Ob:0,Za:null,tf:null}}function d(d,f,e,h){var g=d.type,k=new Uint8Array([204,204,204,255]),l=c();switch(g){case "DATA_TEX2D":case "IMAGE":var m=r.createTexture(),q=r.TEXTURE_2D;r.bindTexture(q,m);r.texImage2D(q,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,k);d.image&&"MOVIE"==d.image.source&&
(l.ag=!0,l.K=d.frame_start,l.ma=d.frame_offset,l.Zg=d.frame_duration,l.oC=d.use_auto_refresh,l.Cg=d.use_cyclic,l.vn=d.movie_length,0!=l.ma&&z.warn('Frame offset for texture "'+d.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":m=r.createTexture();q=r.TEXTURE_2D;r.bindTexture(q,m);if("NONE"==d.b4w_source_type)return null;if("SCENE"==d.b4w_source_type)if(d.b4w_source_id&&(e=H.keysearch("name",d.b4w_source_id,e)))l.yg=d.b4w_source_size,e.od=e.od||
[],e.od.push(d),r.texImage2D(q,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,k);else return null;break;case "ENVIRONMENT_MAP":m=r.createTexture();q=r.TEXTURE_CUBE_MAP;r.bindTexture(q,m);e="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var n=0;6>n;n++)u.Ym?r.texImage2D(r["TEXTURE_CUBE_MAP_"+e[n]],0,r.RGB,1,1,0,r.RGB,r.UNSIGNED_BYTE,k):r.texImage2D(r["TEXTURE_CUBE_MAP_"+e[n]],0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,k);break;case "BLEND":return null;default:return z.error('texture "'+
d.name+'" has unsupported type "'+g+'"'),null}"NONE"==g&&(!d.b4w_enable_canvas_mipmapping||"CANVAS"!=d.b4w_source_type)||"DATA_TEX2D"==g||"IMAGE"==g&&"MOVIE"==d.image.source?r.texParameteri(q,r.TEXTURE_MIN_FILTER,r.LINEAR):u.Ym&&"ENVIRONMENT_MAP"==g?r.texParameteri(q,r.TEXTURE_MIN_FILTER,r.LINEAR):r.texParameteri(q,r.TEXTURE_MIN_FILTER,E[u.Xk]);r.texParameteri(q,r.TEXTURE_MAG_FILTER,r.LINEAR);k=q;e=d.b4w_anisotropic_filtering;"DEFAULT"===e&&(e=f);"OFF"!==e&&u.zj&&(f=A.ky())&&(e=parseFloat(e.split("x")[0]),
r.texParameterf(k,f.TEXTURE_MAX_ANISOTROPY_EXT,e));"REPEAT"!=d.extension||d.b4w_shore_dist_map?(r.texParameteri(q,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(q,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)):(r.texParameteri(q,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(q,r.TEXTURE_WRAP_T,r.REPEAT));l.type=a.Jg;l.width=1;l.height=1;l.Za=m;l.Ob=q;"CANVAS"==d.b4w_source_type&&"NONE"==g?(g=d.b4w_source_id,m=d.b4w_source_size,l.gq=d.b4w_enable_canvas_mipmapping,l.Xn=g,l.source="CANVAS",q=document.createElement("canvas"),
q.width=m,q.height=m,l.Wd=q.getContext("2d"),h in w||(w[h]={}),w[h][g]=l,b(l)):"SCENE"==d.b4w_source_type&&"NONE"==g?(l.Xn=d.b4w_source_id,l.source="SCENE"):(l.source=g,r.generateMipmap(q),r.bindTexture(q,null));l.name=d.name;return d.e=l}function b(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Ob;r.bindTexture(b,a.Za);var c=k(a),d=n(a),f=a.Wd.canvas;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0);r.texImage2D(b,0,c,c,d,f);r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1);a.gq&&r.generateMipmap(b);r.bindTexture(b,
null);a.width=f.width;a.height=f.height}function e(a){var b=a.Ob;r.bindTexture(b,a.Za);r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0);r.texImage2D(b,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,a.xh[a.te]);r.bindTexture(b,null)}function g(a){r.texParameteri(a,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(a,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);r.texParameteri(a,r.TEXTURE_MAG_FILTER,r.LINEAR);r.texParameteri(a,r.TEXTURE_MIN_FILTER,r.LINEAR)}function h(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];
return-1==c.indexOf(a)||-1==c.indexOf(b)}function k(b){switch(b.type){case a.Jg:b=r.RGBA;break;case a.ml:b=r.RGB;break;case a.sj:b=r.RGBA;break;case a.tj:b=r.RGB;break;case a.Wh:b=r.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function n(b){switch(b.type){case a.Jg:b=r.UNSIGNED_BYTE;break;case a.ml:b=r.UNSIGNED_BYTE;break;case a.sj:b=r.FLOAT;break;case a.tj:b=r.FLOAT;break;case a.Wh:b=r.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function f(a,b){return b in
m&&a in m[b]?(u.Vc?m[b][a].yh=!0:m[b][a].Oa.play(),!0):null}function l(a,b){if(b in m&&a in m[b]){var c=m[b][a];u.Vc?(c.te=c.ma,e(c),c.te++):c.Oa.currentTime=c.ma/c.$b;return!0}return null}function t(a,b){return b in m&&a in m[b]?(u.Vc?m[b][a].yh=!1:m[b][a].Oa.pause(),!0):null}var x=p("__config"),z=p("__print"),D=p("__dds"),A=p("__extensions"),H=p("__util"),u=x.p,y=x.Sd,q=x.hd;a.kc=0;a.s=0;a.Vu=0;a.Tu=0;a.Uu=0;a.Su=0;a.Jg=10;a.ml=20;a.sj=30;a.tj=40;a.Wh=50;a.Ig=60;var w={},m={},r=null,E;a.gd=function(b){E=
[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.kc=b.NEAREST;a.s=b.LINEAR;a.Vu=b.NEAREST_MIPMAP_NEAREST;a.Tu=b.LINEAR_MIPMAP_NEAREST;a.Uu=b.NEAREST_MIPMAP_LINEAR;a.Su=b.LINEAR_MIPMAP_LINEAR;r=b};a.oy=function(a,b){return b in w&&a in w[b]?w[b][a].Wd:null};a.$B=function(a,c){return c in w&&a in w[c]?(b(w[c][a]),!0):!1};a.Pj=function(b,d){var f=c();f.name=b;f.type=d;f.source="NONE";if(d==a.Ig)f.tf=r.createRenderbuffer();else{var e=r.TEXTURE_2D,h=r.createTexture();
r.bindTexture(e,h);r.texParameteri(e,r.TEXTURE_MAG_FILTER,r.LINEAR);r.texParameteri(e,r.TEXTURE_MIN_FILTER,r.LINEAR);r.texParameteri(e,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(e,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);r.bindTexture(e,null);f.Ob=e;f.Za=h}return f};a.Gw=function(b){var d=r.createTexture(),f=r.TEXTURE_CUBE_MAP;r.bindTexture(f,d);r.texParameteri(f,r.TEXTURE_MAG_FILTER,r.LINEAR);r.texParameteri(f,r.TEXTURE_MIN_FILTER,r.LINEAR);r.texParameteri(f,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(f,
r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);for(var e="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),h=0;6>h;h++)r.texImage2D(r[e[h]],0,r.RGBA,b,b,0,r.RGBA,r.UNSIGNED_BYTE,null);r.bindTexture(f,null);f=c();f.name="CUBEMAP";f.type=a.Jg;f.source="NONE";f.width=3*b;f.height=2*b;f.Zl=1;f.Za=d;f.Ob=r.TEXTURE_CUBE_MAP;return f};a.$i=function(b,c,d){if(b.type!=a.Ig){var f=b.Ob;r.bindTexture(f,
b.Za);c&&r.texParameteri(f,r.TEXTURE_MIN_FILTER,c);d&&r.texParameteri(f,r.TEXTURE_MAG_FILTER,d);r.bindTexture(f,null)}};a.gE=function(b){if(b.type==a.Ig)return{min:a.kc,uz:a.kc};var c=b.Ob;r.bindTexture(c,b.Za);b=r.getTexParameter(c,r.TEXTURE_MIN_FILTER);var d=r.getTexParameter(c,r.TEXTURE_MAG_FILTER);r.bindTexture(c,null);return{min:b,uz:d}};a.resize=function(b,c,d){c=Math.max(c,1);d=Math.max(d,1);if(b.width!=c||b.height!=d){if(b.type==a.Ig)r.bindRenderbuffer(r.RENDERBUFFER,b.tf),r.renderbufferStorage(r.RENDERBUFFER,
r.DEPTH_COMPONENT16,c,d),r.bindRenderbuffer(r.RENDERBUFFER,null);else{var f=b.Ob;r.bindTexture(f,b.Za);var e=k(b),h=n(b);r.texImage2D(f,0,e,c,d,0,e,h,null);r.bindTexture(f,null)}c>u.Kb||d>u.Kb?z.error('Slink texture "'+b.name+'" has unsupported size: '+c+"x"+d+". Max available: "+u.Kb+"x"+u.Kb+"."):(b.width=c,b.height=d)}};a.$w=d;a.lC=function(a){var b=a.Ob;r.bindTexture(b,a.Za);r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0);4!=a.Oa.length?r.texImage2D(b,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,a.Oa):r.texImage2D(b,
0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,a.Oa);r.bindTexture(b,null)};a.iC=e;a.fj=function(a,b,c,d,f){var e=a.source,k=a.Ob;r.bindTexture(k,a.Za);if(4==b.length){var l=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==e)if(l)r.texImage2D(k,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){c=D.Nq(b);if(c.width>u.Kb||c.height>u.Kb){z.error('Texture "'+d+'" has unsupported size: '+c.width+"x"+c.height+". Max available: "+u.Kb+"x"+u.Kb+".");return}D.nC(r,A.Kq(),
b,!0);h(c.width,c.height)&&(a.kp||z.warn("using NPOT texture",d),g(k));a.width=c.width;a.height=c.height;a.Zl=D.qy(b)}else{r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0);if(b.width>u.Kb||b.height>u.Kb){z.error('Texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+u.Kb+"x"+u.Kb+".");return}a.ag?u.Vc?b&&(f in m||(m[f]={}),m[f][a.name]=a,a.xh=b,a.$b=a.vn/b.length,a.Zg=Math.round(a.Zg/a.$b),a.ma=Math.round(a.ma/a.$b),a.K=Math.round(a.K/a.$b),a.te=a.ma,r.texImage2D(k,0,r.RGBA,r.RGBA,
r.UNSIGNED_BYTE,a.xh[0])):(a.Oa=b,a.Oa.loop=a.Cg,b&&(f in m||(m[f]={}),m[f][a.name]=a),a.$b=y.Ha,b.duration&&(a.$b=a.vn/b.duration),q.dq||(b.playbackRate=y.Ha/a.$b,q.Ep&&2<b.playbackRate&&(b.playbackRate=2)),r.texImage2D(k,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,a.Oa)):r.texImage2D(k,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,b);a.ag?u.Vc?(a.width=b[0].width,a.height=b[0].height):(a.width=b.videoWidth,a.height=b.videoHeight):(a.width=b.width,a.height=b.height);h(a.width,a.height)?(a.kp||(a.ag?z.warn("using NPOT video texture",
d):z.warn("using NPOT texture",d)),g(k)):a.ag||r.generateMipmap(k)}else if("ENVIRONMENT_MAP"==e)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],l){for(l=0;6>l;l++)f=c[l],r.texImage2D(r["TEXTURE_CUBE_MAP_"+f[0]],0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1);e=b.width/3;if(e>u.jg||e>u.jg){z.warn('Cubemap texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+
3*u.jg+"x"+2*u.jg+". Reduced image size will be used.");var n=b.width/3*(u.jg/e)}else n=e;for(l=0;6>l;l++){f=c[l];var t=document.createElement("canvas");t.width=n;t.height=n;var x=t.getContext("2d");"POSITIVE_Y"==f[0]||"NEGATIVE_Y"==f[0]?(x.translate(0,n),x.scale(1,-1)):(x.translate(n,0),x.scale(-1,1));x.drawImage(b,f[1]*e,f[2]*e,e,e,0,0,n,n);r.texImage2D(r["TEXTURE_CUBE_MAP_"+f[0]],0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}a.width=3*n;a.height=2*n;h(b.width/3,b.height/2)?(z.warn("using NPOT cube map texture",
d),g(k)):r.generateMipmap(k)}else"DATA_TEX2D"==e&&(r.texImage2D(k,0,r.RGBA,b.width,b.height,0,r.RGBA,r.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);r.bindTexture(k,null)};a.px=function(a){r.deleteTexture(a)};a.Fi=function(a){return a&&a.name&&(a.Za||a.tf)?!0:!1};a.jr=function(a){return a&&a.name&&a.tf?!0:!1};a.zE=function(b){return b.type==a.sj||b.type==a.tj?!0:!1};a.Gy=function(b){var c=0;switch(b.type){case a.Jg:case a.ml:c=4;break;case a.sj:case a.tj:c=16;break;case a.Wh:c=3;break;
case a.Ig:c=2}return c};a.gy=function(a){var b=null,b={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};d(b,null,a,0);b.image={filepath:null};return b};a.cleanup=function(){if(!u.Vc)for(var a in m)for(var b in m[a])m[a][b].Oa.pause(),m[a][b].Oa.src="",m[a][b].Oa.load();w={};m={}};a.play_video=f;a.reset_video=l;a.pause_video=t;a.pause=function(){for(var a in m)for(var b in m[a])u.Vc&&!m[a][b].yh||!u.Vc&&m[a][b].Oa.paused||(t(b,a),m[a][b].fl=!0)};a.reset=
function(){for(var a in m)for(var b in m[a])l(b,a),m[a][b].fl=!1};a.play=function(a){for(var b in m)for(var c in m[b])if(!a||m[b][c].fl)f(c,b),m[b][c].fl=!1}};b4w.module.__assets=function(a,p){function c(){return D.az()?p(D.Tb.Ij).data:null}function d(){var a={vj:null,bv:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),f=0;f<c;f++)d[f]=b.charCodeAt(f);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.vj=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=c();b&&a.vj in b&&(a.status=200,b[a.vj]&&(a.response=a.bv(b[a.vj])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function b(b){for(var c=0,d=0;d<b.length;d++){var l=b[d];20===l.state&&c++;if(c>=w.zz)break;if(10===l.state)switch(l.state=20,c++,l.type){case a.AT_ARRAYBUFFER:e(l,"arraybuffer");break;case a.AT_JSON:e(l,"json");break;case a.AT_TEXT:e(l,"text");break;case a.AT_AUDIOBUFFER:g(l);break;case a.AT_IMAGE_ELEMENT:h(l);
break;case a.AT_AUDIO_ELEMENT:k(l);break;case a.oj:n(l);break;case a.nj:f(l);break;default:u.fa("Wrong asset type: "+l.type)}}}function e(a,b){var f=c(),e=f&&a.r in f?new d:new XMLHttpRequest;e.open("GET",a.r,!0);"text"==b?(e.overrideMimeType("text/plain"),e.responseType="text"):"json"==b?(e.overrideMimeType("application/json"),e.responseType="text"):e.responseType=b;e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState){if(200==e.status||0==e.status){var c=e.response;if(c){if("json"==b&&
"string"==typeof c)try{c=JSON.parse(c)}catch(d){a.kb(null,a.uri,a.type,a.r,a.pb);A.error(d+" (parsing JSON "+a.r+")");return}a.kb(c,a.uri,a.type,a.r,a.pb)}else a.kb(null,a.uri,a.type,a.r,a.pb),A.error("empty responce when trying to get "+a.r)}else a.kb(null,a.uri,a.type,a.r,a.pb),A.error(e.status+" when trying to get "+a.r);a.state=30}};e.addEventListener("progress",function(b){b.lengthComputable&&a.js(b.loaded/b.total)},!1);e.send(null)}function g(a){var b=c(),f=b&&a.r in b?new d:new XMLHttpRequest;
f.open("GET",a.r,!0);f.responseType="arraybuffer";f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState)if(200==f.status||0==f.status){var b=f.response;b?H.kx(b,function(b){a.kb(b,a.uri,a.type,a.r,a.pb);a.state=30},function(){a.kb(null,a.uri,a.type,a.r,a.pb);A.error("failed to decode "+a.r);a.state=30}):(a.kb(null,a.uri,a.type,a.r,a.pb),A.error("empty responce when trying to get "+a.r),a.state=30)}else a.kb(null,a.uri,a.type,a.r,a.pb),A.error(f.status+" when trying to get "+a.r),a.state=
30};f.send(null)}function h(a){var b=document.createElement("img");m.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.kb(b,a.uri,a.type,a.r,a.pb),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.kb(null,a.uri,a.type,a.r,a.pb),A.error("could not load image: "+a.r),a.state=30)},!1);var d=c();if(d&&a.r in d)if(d[a.r]){var f=t(a.r);b.src="data:"+f+";base64,"+d[a.r]}else q.$m()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=
new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.r}function k(a){var b=document.createElement("audio");if(m.allow_cors||m.Op)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.kb(b,a.uri,a.type,a.r,a.pb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.kb(null,a.uri,a.type,a.r,a.pb),A.error("could not load sound: "+a.r),a.state=30)},!1);var d=c();if(d&&a.r in d)if(d[a.r]){var f=x(a.r);b.src="data:"+f+";base64,"+d[a.r];40!=a.state&&(a.kb(b,
a.uri,a.type,a.r,a.pb),a.state=30)}else q.$m()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.r,m.$f&&b.load();m.un&&(b.autoplay=!0,b.pause());setTimeout(function(){b.gB=1},5E3)}function n(a){function b(){40!=a.state&&(a.kb(null,a.uri,a.type,a.r),A.error("could not load video: "+a.r,a.pb),a.state=30)}var d=document.createElement("video");d.muted=!0;if(m.allow_cors||m.$f)d.crossOrigin="Anonymous";d.addEventListener("loadeddata",
function(){d.removeEventListener("error",b,!1);40!=a.state&&(a.kb(d,a.uri,a.type,a.r,a.pb),a.state=30)},!1);d.addEventListener("error",b,!1);var f=c();if(f&&a.r in f)if(f[a.r]){var e=z(a.r);d.src="data:"+e+";base64,"+f[a.r];40!=a.state&&d.addEventListener("loadeddata",function(){a.kb(d,a.uri,a.type,a.r,a.pb);a.state=30},!1)}else q.$m()?(f=document.createEvent("CustomEvent"),f.initCustomEvent("error",!1,!1,null)):f=new CustomEvent("error"),d.dispatchEvent(f);else d.src=a.r,m.$f&&d.load();m.un&&(d.autoplay=
!0,d.pause());setTimeout(function(){d.gB=1},1E4)}function f(a){function b(c){a.kb(c,a.uri,a.type,a.r,a.pb)}var f=c(),e=f&&a.r in f?new d:new XMLHttpRequest;e.open("GET",a.r,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState){if(200==e.status||0==e.status){var c=e.response;c?l(c,b):(a.kb(null,a.uri,a.type,a.r,a.pb),A.error("empty responce when trying to get "+a.r))}else a.kb(null,a.uri,a.type,a.r,a.pb),A.error(e.status+" when trying to get "+a.r);a.state=
30}};e.addEventListener("progress",function(b){b.lengthComputable&&a.js(b.loaded/b.total)},!1);e.send(null)}function l(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),f=c[3],e={images:[],op:[],$b:c[4]},h=20,g=0;g<f;g++){var k=c[h/4],l=new Blob([d.subarray(h+4,h+4+k)],{type:"image/jpg"}),m=document.createElement("img");m.src=window.URL.createObjectURL(l);e.images.push(m);e.op.push(l);h+=k+8-k%4}m.onload=function(){for(var a=0;a<e.images.length;a++)window.URL.revokeObjectURL(e.images[a].src);delete e.op;
b(e)}}function t(a){var b="image";switch(u.Im(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function x(a){var b="audio";switch(u.Im(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function z(a){var b="video";switch(u.Im(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var D=p("__config"),A=p("__print"),
H=p("__sfx"),u=p("__util"),y=p("__version"),q=p("__compat"),w=D.Td,m=D.p;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.oj=70;a.nj=80;var r=[],E=0,I={};a.bj=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.jE=function(a){if(I[a])return I[a];var b=w.gs?a+y.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==
c.status){b=c.responseText;if(b.length)return I[a]=b;u.fa("Error XHR: responce is empty, GET "+a)}else u.fa("Error XHR: "+c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<r.length;a++)r[a].state=40;r=[];E=0;I={}};a.enqueue=function(a,d,f,e){for(var h=0;h<a.length;h++){var g=a[h],g={uri:g[0],type:g[1],r:g[2],pb:g[3],state:10,kb:d||function(){},as:f||function(){},js:e||function(){},bs:E};if(w.gs){var k=c();k&&g.r in k||(g.r+=y.timestamp())}r.push(g)}b(r);E++};a.update=function(){b(r);for(var a=
r,c=0,d=!0,f=0;f<a.length;f++){var e=a[f];e.bs===a[c].bs?30!==e.state&&(d=!1):(d&&(a[f-1].as(),d=f-c,a.splice(c,d),f-=d),c=f,d=30===a[f].state?!0:!1);f===a.length-1&&d&&(a[f].as(),a.splice(c))}}};b4w.module.__loader=function(a,p){function c(b,c,f,e){var h=u,g=D.create(),k;for(k in c){var l=d(c[k]);(e&&l.cb||!b&&l.qb)&&t(l);D.u(g,l)}for(k in c)for(l=c[k],l.name=k,b=0;b<l.G.length;b++)D.m(g,c[l.G[b]],l,null);c=d({name:"out",Na:a.Gt,bb:function(a,b,c,d,f){0===b.id&&(h.bo=!0);z(b)||(b.status=2);b.vr(b.id,!0);f(b,c);A.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},eb:5});var n=[];if(f)for(f=D.Mq(g),b=0;b<f.length;b++)n.push(D.Ta(g,f[b]));else D.R(g,function(a,b){b.ab||n.push(b)});D.u(g,
c);for(b=0;b<n.length;b++)c.G.push(n[b].name),D.m(g,n[b],c,null);return g}function d(a){a.ab=a.ab||!1;a.Na||0===a.Na||(a.Na=a.nd);a.G=a.G||[];a.Ci=a.Ci||!1;a.Tn=a.Tn||!1;a.eb=a.eb||0;a.cb=a.cb||!1;a.qb=a.qb||!1;a.status=0;a.JE=0;a.ln=0;a.If=a.If||null;return a}function b(a,b){for(var c=[],d=[],f=0;f<b.length;f++){var e=b[f];D.Ta(a.Dd,e).Ci&&(D.qf(a.Dd,e,function(d){var f=!0;D.Ae(a.Dd,d,function(a,b){if(!b.Ci)return f=!1,1});f&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(f))}for(f=d.length-
1;0<=f;f--)b.splice(d[f],1);return c}function e(a){function c(b,d){var f=D.Ta(a.Dd,b),e=D.Ta(a.Dd,d),h=e.Na-f.Na;0==h&&(h=f.ab-e.ab);return h}var d=[],f=a.ye,e=!1;do{var h=b(a,f);d.push.apply(d,f);0<h.length&&(e=!0);f=h}while(0<h.length);e&&d.sort(c);a.ye=d;return a.ye.length}function g(a,b,c){if(b.Tn)return b.Ci=!0,k(a,b),!1;if(!b.bb&&!b.Ke&&!b.ei)return k(a,b),!1;if(0==b.status&&(b.status++,b.bb))return b.bb(c,a,b,b.If,k,n),!0;if(1==b.status){if(b.Ke)return b.Ke(c,a,b,b.If,k,n),!0;b.status++}return 2==
b.status&&(b.status++,b.ei)?(b.ei(c,a,b,b.If,k,n),!0):!1}function h(a){if(0==a.Vk)return 100;var b=0;D.R(a.Dd,function(c,d){a.do_not_load_resources&&d.cb||(b+=d.ln*d.eb)});return H.trunc(100*b/a.Vk)}function k(a,b){b.Ci=!0;b.status=3;f(a,b,1)}function n(a,b,c){1>c?f(a,b,c):b.status++}function f(a,b,c){var d=u;if(b.bb||b.Ke||b.ei)if(b.ln=c,b=h(a),a.Xp!=b||1==c)a.ao(b,performance.now()-a.et),a.Xp=b,d.on=!0}function l(a,b){var c=null;D.R(a.Dd,function(a,d){if(d.name==b)return c=d,1});return c}function t(a){a.Tn=
!0;a.ln=1}function x(a){a.ao=null;a.Yl=null;a.Dd=null;a.ye=null}function z(a){return a&&(3==a.status||4==a.status)}var D=p("__graph"),A=p("__print"),H=p("__util");a.nd=0;a.Md=1;a.Gt=2;var u=null;a.Lq=function(){return u};a.Uw=function(){var a={Gd:[],hm:0,xj:0,bo:!1,on:!1};return u=a};a.ax=function(a,b,d,f,e,h,g,k){var l=u,n={id:l.Gd.length,status:0,r:b,mp:"",vr:d||function(){},kn:k||!1,lF:h,et:0,Xp:0,Vk:0,Pn:!1,ao:f||function(){},Yl:e||function(){},Dd:null,ye:null,Tm:!1,Sm:!1,Wm:!1};a=c(0===n.id,
a,h,g);n.Dd=a;b=[];d=D.Ey(a);for(f=0;f<d.length;f++)b.push(d[f]);n.ye=b;D.R(a,function(a,b){!(b.bb||b.Ke||b.ei)||n.do_not_load_resources&&b.cb||(n.Vk+=b.eb)});l.Gd.push(n);l.xj++;return n.id};a.hC=function(b){var c=u;if(c&&0!=u.xj)if(c.on)c.on=!1;else{var d=performance.now();do{var f=c.Gd[c.hm],h=b[f.id];if(!z(f))if(0==f.status&&(f.status=1,f.et=performance.now(),f.ao(0,0)),e(f)){var k=f,l=k.ye.length;do{var n=D.Ta(k.Dd,k.ye[0]),t=g(k,n,h);n.Na==a.Md&&(k.Pn=!0);n=k.ye.shift();k.ye.push(n);l--}while(!t&&
0!=l)}else k=c,l=f,l.Yl(h,l),l.status=3,k.xj--,x(l);c.bo&&(c.hm=(c.hm+1)%c.Gd.length);if(f.Pn){f.Pn=!1;break}}while(16>performance.now()-d)}};a.Wo=function(a){var b=u;a.Yl(null,a);a.status=3;b.xj--;x(a);a.status=4;0===a.id&&(b.bo=!0);a.vr(a.id,!1)};a.dF=n;a.Hs=function(a,b){var c=l(a,b);null!==c&&t(c)};a.JB=z;a.is_primary_loaded=function(a){var b=u;if(!b)return!1;a|=0;return b.Gd[a]&&(3==b.Gd[a].status||2==b.Gd[a].status)};a.cleanup=function(){u=null}};b4w.module.__nla=function(a,p){function c(){return{type:"CLIP",K:0,W:0,se:!1,paused:!1,Af:"",ai:"",Ib:0,Zh:0,Yh:0,jq:0,iq:0,Ih:!1,rt:!1,scale:1,repeat:1}}function d(a,b){if(a.animation_data){var c=a.animation_data.nla_tracks;if(c)for(var f=0;f<c.length;f++)b.push(c[f])}c=a.nodes;for(f=0;f<c.length;f++){var e=c[f];e.node_group&&(e=e.node_group.node_tree)&&d(e,b)}}function b(a,b){for(var c=a.b4w_nla_script,d=b.ef,f=0;f<c.length;f++){var e=c[f];switch(e.type){case "PLAY":d.push({type:"PLAY",K:e.frame_range[0],
W:e.frame_range[1],We:!1});break;case "SELECT":case "SELECT_PLAY":var h=y.xd(y.yf,e.object,0),g=y.Dy(a),k=g.indexOf(h);if(-1==k){u.error("NLA script error: non-selectable object");return}for(var e={type:e.type,Ms:"SELECT"==e.type?e.target_slot:f+1,dB:f+1,ff:-1,CA:g.length,BA:k,K:e.frame_range[0],W:e.frame_range[1],We:!1},k=[],l=0;l<g.length;l++)k.push(A.create_selection_sensor(g[l],!0));A.create_sensor_manifold(h,"NLA_SELECT_"+f,A.CT_SHOT,k,A.lx,function(a,c,d,f){if(!(b.Db>=b.ef.length)&&(d=b.ef[b.Db],
"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.We)){for(d=0;d<f.CA;d++)if(A.get_sensor_value(a,c,d)&&d==f.BA){f.ff=1;return}f.ff=0}},e);d.push(e);break;case "JUMP":d.push({type:"JUMP",Vn:e.target_slot});break;case "CONDJUMP":d.push({type:"CONDJUMP",Vn:e.target_slot,uw:e.condition,Xi:e.register1,Yi:e.register2,zn:e.number1,An:e.number2});break;case "REGSTORE":d.push({type:"REGSTORE",hA:e.registerd,Lz:e.number1});break;case "MATH":d.push({type:"MATH",Nz:e.operation,Xi:e.register1,Yi:e.register2,zn:e.number1,
An:e.number2,uh:e.registerd});break;case "SHOW":case "HIDE":h=y.xd(y.yf,e.object,0);d.push({type:e.type,obj:h});break;case "REDIRECT":d.push({type:"REDIRECT",url:e.url});break;case "PAGEPARAM":d.push({type:"PAGEPARAM",Pz:e.param_name,uh:e.registerd});break;case "NOOP":d.push({type:"NOOP"})}}}function e(a,b,c,d){if(a.ef.length){if(a.Db>=a.ef.length)if(a.cyclic)a.Db=0;else{a.ma-=E.Ha*c;return}var f=h(a,b,!1,d),k=a.ef[a.Db];switch(k.type){case "PLAY":k.We?f>=k.W&&(k.We=!1,a.Db++,e(a,b,c,d)):(a.ma+=k.K-
f,k.We=!0,g(a,k));break;case "SELECT":case "SELECT_PLAY":-1<k.ff?"SELECT"==k.type||"SELECT_PLAY"==k.type&&0==k.ff?(a.Db=k.ff?k.Ms:k.dB,k.ff=-1,e(a,b,c,d)):k.We?f>=k.W&&(k.We=!1,a.Db=k.Ms,k.ff=-1,e(a,b,c,d)):(a.ma+=k.K-f,k.We=!0,g(a,k)):a.ma-=E.Ha*c;break;case "JUMP":a.Db=k.Vn;e(a,b,c,d);break;case "CONDJUMP":var f=-1==k.Xi?k.zn:a.Ad[k.Xi],l=-1==k.Yi?k.An:a.Ad[k.Yi],m=!1;switch(k.uw){case "EQUAL":f==l&&(m=!0);break;case "NOTEQUAL":f!=l&&(m=!0);break;case "LESS":f<l&&(m=!0);break;case "GREATER":f>l&&
(m=!0);break;case "LEQUAL":f<=l&&(m=!0);break;case "GEQUAL":f>=l&&(m=!0)}m?a.Db=k.Vn:a.Db++;e(a,b,c,d);break;case "REGSTORE":a.Ad[k.hA]=k.Lz;a.Db++;e(a,b,c,d);break;case "MATH":f=-1==k.Xi?k.zn:a.Ad[k.Xi];l=-1==k.Yi?k.An:a.Ad[k.Yi];switch(k.Nz){case "ADD":a.Ad[k.uh]=f+l;break;case "MUL":a.Ad[k.uh]=f*l;break;case "SUB":a.Ad[k.uh]=f-l;break;case "DIV":0==l&&w.fa("Division by zero in NLA script"),a.Ad[k.uh]=f/l}a.Db++;e(a,b,c,d);break;case "SHOW":y.show_object(k.obj);a.Db++;e(a,b,c,d);break;case "HIDE":y.hide_object(k.obj);
a.Db++;e(a,b,c,d);break;case "REDIRECT":window.location.href=k.url;a.ef.length=0;break;case "PAGEPARAM":a:{f=location.href.toString();if(-1!=f.indexOf("?"))for(f=f.split("?")[1].split("&"),l=0;l<f.length;l++)if(m=f[l].split("="),1<m.length&&m[0]==k.Pz){f=Number(m[1]);break a}f=0}a.Ad[k.uh]=f;a.Db++;e(a,b,c,d);break;case "NOOP":a.Db++,e(a,b,c,d)}}}function g(a,b){for(var c=a.ef,d=0;d<c.length;d++){var f=c[d];f!=b&&(f.ff=-1)}}function h(a,b,c,d){b=(b-d)*E.Ha+a.ma-a.K;a.cyclic&&c&&(b%=a.W-a.K+1);return b+=
a.K}function k(a,b){a=w.clamp(a,b.K,b.W);var c=a-b.K,d=(b.W-b.K)/b.repeat,c=c/d&&0==c%d?b.Yh:b.Zh+c%d/b.scale;b.rt&&(c=b.Yh-c+b.Zh);return c}function n(a,b,c){b?r.pause_video(a.name,c):(r.reset_video(a.name,c),r.play_video(a.name,c))}function f(a,b){for(var d=[],f=0;f<a.length;f++){var e=a[f].strips;if(e)for(var h=0;h<e.length;h++){var g=e[h],k=c();k.type=g.type;k.K=g.frame_start;k.W=g.frame_end;k.Ib=b;k.Zh=g.action_frame_start;k.Yh=g.action_frame_end;k.rt=g.use_reverse;k.scale=g.scale;k.repeat=g.repeat;
g.action&&(k.Af=g.action.name,k.ai=g.action.uuid);d.push(k)}}return d}function l(a){return q.le(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}function t(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c=c.use_nodes&&d)a:{if(d.animation_data&&(c=d.animation_data.nla_tracks)&&c.length){c=!0;break a}d=d.nodes;for(c=0;c<d.length;c++);c=!1}if(c)return!0}return!1}function x(a,b){var c=y.get_active();
c.ha&&(c.ha.ma-=h(c.ha,b,!0,M)-a,c.ha.Cm=!0)}var z=p("__animation"),D=p("__camera"),A=p("__controls"),H=p("__config");p("__loader");var u=p("__print"),y=p("__scenes"),q=p("__sfx"),w=p("__util"),m=p("__lights"),r=p("__textures"),E=H.Sd,I=H.p,F=[],M=-1;a.gC=function(a,e,h){e={K:a.frame_start,W:a.frame_end,ma:0,Gi:-1,Lk:a.frame_end,Ln:a.frame_start,Ph:null,rc:h,cyclic:e,qe:[],M:[],ef:[],Ei:!1,Cm:!1,XE:a.name,Db:0,Ad:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}};a.ha=e;b(a,e);for(var g=y.Ia(a,"ALL",y.DATA_ID_ALL),
k=0;k<g.length;k++){var n=g[k],t=0,r=[];if((h=n.animation_data)&&h.nla_tracks.length){var x=h.nla_tracks;if(w.is_armature(n)||D.is_camera(n)||w.is_mesh(n)||w.jk(n)||m.mk(n)||q.le(n))x=f(x,t),x.length&&(r=r.concat(x),t++)}l(n)&&(x=n.data.animation_data.nla_tracks,x=f(x,t),x.length&&(r=r.concat(x),t++));if(z.Py(n)){var p=n.data.materials;for(h=0;h<p.length;h++){var A=p[h].node_tree;if(A&&(x=[],d(A,x),x=f(x,t),x.length)){for(var A=t,E=x,H=z.Aq(),M=[],qa=0,ga=0;ga<E.length;ga++){var ha=E[ga];""!=ha.ai?
ha=w.keysearch("uuid",ha.ai,H):(ha=ha.Af,ha=w.keysearch("name",ha,H)||w.keysearch("name",ha+"_B4W_BAKED",H));var ha=ha.fcurves,Y=[],ea;for(ea in ha)Y.push(ea);M.push(Y)}for(ga=0;ga<M.length;ga++){H=!1;for(ha=0;ha<ga;ha++)if(w.Cv(M[ga],M[ha])){E[ga].Ib=E[ha].Ib;H=!0;break}H||(E[ga].Ib=t+qa++)}t=A+qa;r=r.concat(x)}}}for(h=0;h<n.particle_systems.length;h++)x=n.particle_systems[h],p=x.settings,"EMITTER"==p.type&&p.b4w_allow_nla&&(p=c(),p.type="CLIP",p.K=e.K,p.W=e.W+1,p.Af=x.name,p.Ib=t,p.Zh=p.K,p.Yh=
p.W,r.push(p),t++);x=t+1;if(w.is_mesh(n)&&n.data)for(h=0;h<n.data.b4w_vertex_anim.length;h++)A=n.data.b4w_vertex_anim[h],A.allow_nla&&(t=x,p=c(),p.type="CLIP",p.K=e.K,p.W=e.W+1,p.Af=A.name,p.Ib=t,p.Zh=p.K,p.Yh=p.W,r.push(p));r.length&&(n.nl=r,e.qe.push(n))}a=a.e.Qh;for(h=0;h<a.length;h++)if(ea=a[h].e,ea.Oa||ea.xh)p=c(),p.type="VIDEO",g=1,I.Vc&&(g=ea.$b),p.K=Math.min(ea.K*g,e.W),p.W=ea.Cg?e.W:Math.min((ea.Zg+ea.K+ea.ma)*g,e.W),p.Af=a[h].name,ea.$u=p,e.M.push(ea);a=e.K;h=e.W;for(ea=0;ea<e.qe.length;ea++)for(g=
e.qe[ea],k=g.nl,n=0;n<k.length;n++)r=k[n],p=g.name+" ["+r.K+":"+r.W+"]",r.K=Math.max(a,r.K),r.W=Math.min(h+1,r.W),r.K>r.W?(u.warn("NLA: out of scene range: "+p),k.splice(n,1),n--):r.Af||"CLIP"!=r.type||(u.warn('NLA: no action in strip for object "'+g.name+'".'),k.splice(n,1),n--);for(a=0;a<e.qe.length;a++)for(h=e.qe[a].nl,ea=0;ea<h.length;ea++){g=h[ea];k=e.K;n=e.W+1;for(r=0;r<h.length;r++)p=h[r],g.Ib==p.Ib&&(p.W<=g.K&&(k=g.K),p.K>=g.W&&(n=Math.min(n,p.K)));g.jq=k;g.iq=n}F.push(e)};a.start=function(){M=
0};a.update=function(a,b){if(!(0>M)){0==M&&(M=a);for(var c=0;c<F.length;c++){var d=F[c];if(d.Ei&&(d.ma-=E.Ha*b,!d.Cm))continue;d.Cm=!1;e(d,a,b,M);var f=h(d,a,!0,M);if(f>=d.Lk)if(d.cyclic)d.Ph&&d.Ph(),x(d.Ln,a),f=h(d,a,!0,M);else{d.Ei=!0;d.ma-=f-d.Lk;d.Ph&&d.Ph();continue}for(var g=0;g<d.qe.length;g++){for(var l=d.qe[g],m=l.nl,t=0;t<m.length;t++){var r=m[t];"SOUND"==r.type&&f<d.Gi-1E-6&&(r.se=!1)}for(t=0;t<m.length;t++)switch(r=m[t],r.type){case "CLIP":if(r.jq<=f&&f<r.iq&&!r.se){var w=l,u=r;""!=u.ai?
z.vv(w,u.ai,u.Ib):z.apply(w,u.Af,u.Ib);z.set_behavior(w,z.AB_FINISH_STOP,u.Ib);var p=k(u.K,u);z.set_frame(w,p,u.Ib);for(w=0;w<m.length;w++)m[w]!=r&&m[w].Ib==r.Ib&&(m[w].se=!1);r.se=!0}r.se&&(w=l,u=k(f,r),p=z.get_current_frame_float(w,r.Ib),1E-6<Math.abs(u-p)&&z.set_frame(w,u,r.Ib));break;case "SOUND":(f<d.Gi-1E-6||d.Gi<r.K)&&r.K<=f&&f<r.W&&!r.se&&(q.play(l,(r.K-f)/E.Ha,(r.W-r.K)/E.Ha),r.se=!0),d.Gi<r.W&&r.W<=f&&r.se&&(r.se=!1)}}for(g=0;g<d.M.length;g++)r=d.M[g].$u,r.K<=Math.round(f)&&Math.round(f)<
r.W&&!r.Ih&&(n(d.M[g],r.Ih,d.rc),r.Ih=!0),r.W<=Math.round(f)&&r.Ih&&(n(d.M[g],r.Ih,d.rc),r.Ih=!1);d.Gi=f}}};a.cleanup=function(){F.length=0;M=-1};a.Xq=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||l(a)||t(a)?!0:!1};a.set_frame=x;a.get_frame=function(a){var b=y.get_active();return b.ha?h(b.ha,a,!0,M):-1};a.vB=function(){var a=y.get_active();a.ha&&(a.ha.Ei=!0)};a.Wz=function(a){var b=y.get_active();b.ha&&(b.ha.Ei=!1,b.ha.Ph=a?a:null)};a.get_frame_start=function(){var a=y.get_active();
return a.ha?a.ha.K:-1};a.get_frame_end=function(){var a=y.get_active();return a.ha?a.ha.W:-1};a.is_play=function(){var a=y.get_active();return a.ha?!a.ha.Ei:!1};a.check_nla=function(){var a=y.get_active();return a.ha?a.b4w_use_nla:!1};a.check_nla_scripts=function(){var a=y.get_active();return a.ha?0<a.b4w_nla_script.length:!1};a.set_range=function(a,b){var c=y.get_active();if(c.ha)c.ha.Ln=a,c.ha.Lk=b;else return!1};a.reset_range=function(){var a=y.get_active();if(a.ha)a=a.ha,a.Ln=a.K,a.Lk=a.W;else return!1};
a.set_cyclic=function(a){var b=y.get_active();if(b.ha)b.ha.cyclic=a;else return!1};a.clear_callback=function(){var a=y.get_active();a.ha&&(a.ha.Ph=null)}};b4w.module.__camera=function(a,p){function c(b){b=b.e;switch(b.wa){case a.MS_TARGET_CONTROLS:b.gh=X.dist(b.h,b.Lb);b.hh=b.I[0].top;break;case a.MS_HOVER_CONTROLS:b.Ya&&(b.gh=X.dist(b.h,b.Sb),b.hh=b.I[0].top)}}function d(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Ua:new Float32Array([0,0,0,0]),Sa:new Float32Array([0,0,0,0])}}function b(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;
case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function e(b){var c={type:b,name:"",mf:1,width:0,height:0,he:null,hb:null,Pc:null,za:0,vc:0,Ua:0,Sa:0,left:0,right:0,top:0,bottom:0,Re:new Float32Array(3),nq:new Float32Array(3),quat:new Float32Array(4),qa:new Float32Array(16),tD:new Float32Array(16),ta:new Float32Array(16),Rh:new Float32Array(16),dA:new Float32Array(16),Bd:new Float32Array(16),Fs:new Float32Array(16),Jd:new Float32Array(16),
dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,de:null,dof_on:0,Xj:d(),cj:0,Ed:0,ec:null,ji:null,dm:null,Up:new Float32Array(4),Fk:new Float32Array(4)};if(b==a.tb)return c;switch(b){case a.Hb:n(c,40,.1,1E3);break;case a.Lc:n(c,2.5,.1,1E3);break;case a.Od:break;case a.Ee:break;case a.zf:break;case a.ub:case a.Cb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function g(b,c,d){if(b.type!=a.ub&&b.type!=a.Cb)throw"set_stereo_params(): wrong camera type";
b.cj=c;b.Ed=d;m(b,b.za);if(T.ia())for(c=T.get_active(),b=c.e.ue,c=T.Yj(c).e.I,d=0;d<c.length;d++)L(c[d],b)}function h(a,b){return k(a.e.quat,b)}function k(a,b){var c=Q.quat_to_dir(a,Q.AXIS_Y,Y),d=Q.quat_to_dir(a,Q.AXIS_Z,ea),f=-Math.asin(c[1]/X.length(c)),c=Math.abs(f)>Math.PI/4?X.scale(d,-Q.sign(f),Z):X.scale(c,-Q.sign(d[1]),Z),e=Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(f=Q.sign(f)*Math.PI-f);d=e;0>c[2]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=f;return b}function n(b,c,d,f,e){switch(b.type){case a.Hb:case a.ub:case a.Cb:b.vc=
c;b.za=1;break;case a.Lc:b.top=c;b.za=1;break;case a.Od:delete b.vc;b.vc=c;b.za=e/c;break;case a.Ee:b.top=c;b.za=e/c;break;default:R.error("set_frustum(): Unsupported camera type: "+b.type)}b.Ua=d;b.Sa=f}function f(b,c){var d=c.e.h,f=c.e.quat,e=da;S.rotateX(c.e.V,-Math.PI/2,e);S.invert(e,b.qa);if(b.ec){var e=b.ec[0],h=b.ec[1],g=b.ec[2],k=b.ec[3],l=da;l[0]=1-2*e*e;l[1]=-2*e*h;l[2]=-2*e*g;l[3]=0;l[4]=-2*e*h;l[5]=1-2*h*h;l[6]=-2*h*g;l[7]=0;l[8]=-2*e*g;l[9]=-2*h*g;l[10]=1-2*g*g;l[11]=0;l[12]=-2*e*k;l[13]=
-2*h*k;l[14]=-2*g*k;l[15]=1;S.multiply(b.qa,l,b.qa);m(b,b.za,!0);e=ba;h=da;S.invert(b.qa,h);S.transpose(h,h);la.transformMat4(b.ec,h,e);h=ma;h[0]=(Q.sign(e[0])+b.ta[8])/b.ta[0];h[1]=(Q.sign(e[1])+b.ta[9])/b.ta[5];h[2]=-1;h[3]=(1+b.ta[10])/b.ta[14];la.scale(e,2/(e[0]*h[0]+e[1]*h[1]+e[2]*h[2]+e[3]*h[3]),e);b.ta[2]=e[0];b.ta[6]=e[1];b.ta[10]=e[2]+1;b.ta[14]=e[3]}b.type==a.ub?b.qa[12]+=b.Ed/2:b.type==a.Cb&&(b.qa[12]-=b.Ed/2);S.multiply(b.ta,b.qa,b.Jd);E(b);r(b);X.copy(b.Re,b.nq);X.copy(d,b.Re);U.copy(f,
b.quat)}function l(b,c,d,f){S.lookAt(c,d,f,b.qa);b.type==a.ub?b.qa[12]+=b.Ed/2:b.type==a.Cb&&(b.qa[12]-=b.Ed/2);S.multiply(b.ta,b.qa,b.Jd);E(b);r(b);X.copy(c,b.Re)}function t(a){var b=a.e.I;if(!b)throw"Wrong object";for(var c=a.e,d=0;d<b.length;d++){var e=b[d];f(e,a);Q.um(e.Jd,e.Xj);if(e.de)if(e.dof_on){var h=X.dist(c.h,e.de.location);e.dof_distance=h}else e.dof_distance=0}}function x(b){b=b.e;if(b.wa==a.MS_TARGET_CONTROLS){var c=Q.quat_to_dir(b.quat,Q.AXIS_Z,Y);b.ko=0<c[1]}}function z(b,c){var d=
b.e,f=d.Rb;!f||d.wa!=a.MS_EYE_CONTROLS&&d.wa!=a.MS_TARGET_CONTROLS||(c&&(d=h(b,ga),f.left+=d[0],f.right+=d[0]),f.left=Q.angle_wrap_0_2pi(f.left),f.right=Q.angle_wrap_0_2pi(f.right))}function D(b,c){var d=b.e,f=d.Yb;!f||d.wa!=a.MS_EYE_CONTROLS&&d.wa!=a.MS_TARGET_CONTROLS||(c&&(d=h(b,ga),f.Xa+=d[1],f.Ma+=d[1]),f.Xa=Q.angle_wrap_periodic(f.Xa,-Math.PI,Math.PI),f.Ma=Q.angle_wrap_periodic(f.Ma,-Math.PI,Math.PI))}function A(b){var c=b.e;if(F(b)&&c.I[0].type===a.Lc){if(c.wa===a.MS_TARGET_CONTROLS)var d=
X.dist(c.h,c.Lb),c=d/c.gh*c.hh;else c.Ya&&c.wa===a.MS_HOVER_CONTROLS?(d=X.distance(c.h,c.Sb),c=d/c.gh*c.hh):c=b.e.I[0].top;for(var f in b.e.I)d=b.e.I[f],d.top=c,m(d,d.za);t(b)}}function H(a,b,c,d,f){var e=a.e,g=b,k=c;if(d||f)a=h(a,ha),d&&(g=b-a[0]),f&&(k=c-a[1]);if(g||k)b=U.identity(C),g&&(g=U.setAxisAngle(Q.AXIS_Y,g,W),U.multiply(b,g,b)),k&&(g=Q.quat_to_dir(e.quat,Q.AXIS_X,Y),k=U.setAxisAngle(g,k,W),U.normalize(k,k),U.multiply(b,k,b)),U.multiply(b,e.quat,e.quat)}function u(a,b,c,d,f){var e=a.e,g=
b,k=c;if(d||f){var l=h(a,ha);d&&(g=b-l[0]);f&&(k=c-l[1])}q(a,a.e.Lb,g,k);a=h(a,ha);a=Q.angle_wrap_periodic(a[1],-Math.PI,Math.PI);e.ko=Math.abs(a)>Math.PI/2}function y(a,b,c,d,f){var e=a.e,g=b,k=c;if(d||f){var l=h(a,ha);d&&(g=b-l[0]);f&&(k=c-l[1])}e.om||(g=0);q(a,e.Sb,g,k);k&&w(a)}function q(a,b,c,d){var f=a.e;if(c||d){var e=U.identity(C);c&&(c=U.setAxisAngle(Q.AXIS_Y,c,W),U.multiply(e,c,e));a=M(a);d&&(!a||a&&f.Ya)&&(a=Q.quat_to_dir(f.quat,Q.AXIS_X,Y),d=U.setAxisAngle(a,d,W),U.normalize(d,d),U.multiply(e,
d,e));Q.tA(f.h,b,e,f.h);U.multiply(e,f.quat,f.quat)}}function w(a){var b=a.e;if(b.Ya){var c=h(a,ga)[1];a=a.e;a.yb.Ma-a.yb.Xa?(c=(a.yb.Ma-c)/(a.yb.Ma-a.yb.Xa),c=Math.max(c,0)):c=0;c=c*(a.Of-a.ce)+a.ce;a=Q.quat_to_dir(b.quat,Q.AXIS_MY,Y);X.normalize(a,a);X.scale(a,c,a);X.subtract(b.Sb,a,b.h)}}function m(b,c,d){switch(b.type){case a.Hb:if(!c)throw"No aspect ratio";b.za=c;case a.Od:S.perspective(Q.Jk(b.vc),b.za,b.Ua,b.Sa,b.ta);break;case a.Lc:if(!c)throw"No aspect ratio";b.za=c;case a.Ee:c=b.top*b.za;
S.ortho(-c,c,-b.top,b.top,b.Ua,b.Sa,b.ta);break;case a.zf:S.ortho(b.left,b.right,b.bottom,b.top,b.Ua,b.Sa,b.ta);break;case a.ub:case a.Cb:if(!c)throw"No aspect ratio";b.za=c;var f=Math.tan(b.vc*Math.PI/360);c=b.Ua*f;var e=b.za*b.cj*f;b.type==a.ub?(f=e-b.Ed/2,e+=b.Ed/2):(f=e+b.Ed/2,e-=b.Ed/2);f=-(b.Ua/b.cj*f);e*=b.Ua/b.cj;S.frustum(f,e,-c,c,b.Ua,b.Sa,b.ta);b.left=f;b.right=e;break;case a.tb:return;default:throw"Wrong camera type: "+b.type;}d||(S.multiply(b.ta,b.qa,b.Jd),E(b),r(b))}function r(a){S.copy(a.qa,
a.Bd);a.Bd[12]=0;a.Bd[13]=0;a.Bd[14]=0;a.Bd[15]=1;S.multiply(a.ta,a.Bd,a.Bd);S.invert(a.Bd,a.Bd)}function E(a){S.copy(a.qa,a.Rh);S.multiply(a.ta,a.Rh,a.Rh);S.invert(a.Rh,a.Rh)}function I(b,c,d,f,e){f||(f=new Float32Array(24));c||(c=b.Ua);d||(d=b.Sa);var h,g,k,l,m,n,q,r;switch(b.type){case a.tb:throw"Extraction from NONE camera is not possible";case a.Hb:case a.Od:h=c*Math.tan(b.vc*Math.PI/360);l=-h;g=h*b.za;k=-g;m=d/c*h;r=-m;n=m*b.za;q=-n;break;case a.Lc:case a.Ee:k=b.top*b.za;h=m=b.top;g=n=k;l=r=
-b.top;k=q=-k;break;case a.zf:h=m=b.top;g=n=b.right;l=r=b.bottom;k=q=b.left;break;case a.ub:case a.Cb:m=c/b.Ua;h=c*Math.tan(b.vc*Math.PI/360);l=-h;g=b.right*m;k=b.left*m;q=d/c;m=h*q;r=-m;n=g*q;q*=k;break;default:throw"Wrong camera type: "+b.type;}f[0]=k;f[1]=l;f[2]=-c;f[3]=g;f[4]=l;f[5]=-c;f[6]=g;f[7]=h;f[8]=-c;f[9]=k;f[10]=h;f[11]=-c;f[12]=q;f[13]=r;f[14]=-d;f[15]=q;f[16]=m;f[17]=-d;f[18]=n;f[19]=m;f[20]=-d;f[21]=n;f[22]=r;f[23]=-d;e&&(c=da,S.invert(b.qa,c),Q.df(f,c,f,0));return f}function F(a){return"CAMERA"===
a.type?!0:!1}function M(b){return F(b)&&b.e&&b.e.wa==a.MS_HOVER_CONTROLS?!0:!1}function L(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.ji){var d=b.csm_num;a.ji=Array(d);for(var f=0;f<d;f++)a.ji[f]=new Float32Array(3);a.dm=new Float32Array(d)}for(d=0;d<c;d++){var f=0==d?a.Ua:O(b,a,d-1),e=O(b,a,d),f=I(a,f,e,aa),f=J.xy(f);a.ji[d].set(f.F);a.dm[d]=f.Da;a.Up[d]=X.length(f.F);a.Fk[d]=B(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.Fk[0]=b.first_cascade_blur_radius}function O(a,b,c){var d=
a.csm_num,f=Q.clamp(a.csm_first_cascade_border,b.Ua,b.Sa);a=Q.clamp(a.csm_last_cascade_border,b.Ua,b.Sa);return Q.clamp(B(f,a,d,c),b.Ua,b.Sa)}function B(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var J=p("__boundings");p("__config");var K=p("__constraints"),P=p("__container"),R=p("__print"),T=p("__scenes"),Q=p("__util"),X=p("vec3"),la=p("vec4"),U=p("quat"),pa=p("mat3"),S=p("mat4");a.tb=10;a.Hb=20;a.Lc=30;a.Od=40;a.Ee=50;a.zf=60;a.ub=70;a.Cb=
80;a.MS_STATIC=0;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var qa=Math.PI/180/2,ga=new Float32Array(2),ha=new Float32Array(2),Y=new Float32Array(3),ea=new Float32Array(3),Z=new Float32Array(3),C=new Float32Array(4),W=new Float32Array(4),ba=new Float32Array(4),ma=new Float32Array(4),fa=new Float32Array(16),da=new Float32Array(16),aa=new Float32Array(24);a.Wv=function(d){var f=d.e,g=d.data;switch(g.type){case "PERSP":var k=e(a.Hb);if(g.angle_y)var l=g.angle_y/Math.PI*180;n(k,
l,g.clip_start,g.clip_end);break;case "ORTHO":k=e(a.Lc),n(k,g.ortho_scale/2,g.clip_start,g.clip_end)}k.name=d.name;f.it=!1;f.wa=b(g.b4w_move_style);f.dof_distance=d.data.dof_distance;f.de=d.data.dof_object;f.dof_front=d.data.b4w_dof_front;f.dof_rear=d.data.b4w_dof_rear;f.dof_power=d.data.b4w_dof_power;f.om=d.data.b4w_enable_hover_hor_rotation;f.I=[k];f.yo=d.data.b4w_trans_velocity;f.xo=d.data.b4w_rot_velocity;f.zo=d.data.b4w_zoom_velocity;f.wa==a.MS_TARGET_CONTROLS&&(f.Lb.set(g.b4w_target),x(d));
g=d.e;l=g.wa;if(l===a.MS_TARGET_CONTROLS||l===a.MS_EYE_CONTROLS||l===a.MS_HOVER_CONTROLS){var m=d.data,q=null,r=null,t=null;l===a.MS_TARGET_CONTROLS||l===a.MS_EYE_CONTROLS?(m.b4w_use_panning&&(g.qt=m.b4w_use_panning),m.b4w_use_horizontal_clamping&&(q={left:m.b4w_rotation_left_limit,right:m.b4w_rotation_right_limit}),m.b4w_use_vertical_clamping&&(r={Ma:m.b4w_rotation_down_limit,Xa:m.b4w_rotation_up_limit}),l===a.MS_TARGET_CONTROLS&&(g.Ya=m.b4w_use_distance_limits&&m.b4w_distance_min<=m.b4w_distance_max,
g.Ya&&(g.ce=m.b4w_distance_min,g.Of=m.b4w_distance_max))):l===a.MS_HOVER_CONTROLS&&(m.b4w_use_horizontal_clamping&&m.b4w_horizontal_translation_min<=m.b4w_horizontal_translation_max&&(q={left:m.b4w_horizontal_translation_min,right:m.b4w_horizontal_translation_max}),m.b4w_use_vertical_clamping&&m.b4w_vertical_translation_min<=m.b4w_vertical_translation_max&&(r={Ma:m.b4w_vertical_translation_min,Xa:m.b4w_vertical_translation_max}),g.Ya=m.b4w_use_distance_limits&&m.b4w_hover_angle_min<=m.b4w_hover_angle_max&&
m.b4w_distance_min<=m.b4w_distance_max,g.Ya&&(t={Ma:m.b4w_hover_angle_min,Xa:m.b4w_hover_angle_max},g.ce=m.b4w_distance_min,g.Of=m.b4w_distance_max));var C=q;C&&l==a.MS_EYE_CONTROLS&&(C.left*=-1,C.right*=-1);if(C=r)switch(l){case a.MS_TARGET_CONTROLS:C.Ma*=-1;C.Xa*=-1;break;case a.MS_HOVER_CONTROLS:var aa=-C.Ma;C.Ma=-C.Xa;C.Xa=aa}(C=t)&&l==a.MS_HOVER_CONTROLS&&(C.Ma*=-1,C.Xa*=-1);g.Rb=q;g.Yb=r;g.yb=t;z(d,"LOCAL"==m.b4w_horizontal_clamping_type);D(d,"LOCAL"==m.b4w_vertical_clamping_type)}if(f.wa===
a.MS_HOVER_CONTROLS)if(f=d.e,f.Ya){g=d.e;l=Q.quat_to_dir(g.quat,Q.AXIS_MY,Y);m=ba;m.set(Q.AXIS_Y);m[3]=0;l=Q.line_plane_intersect(m,-d.data.b4w_hover_zero_level,g.h,l,g.Sb);m=h(d,ga)[1];if(!l||Math.abs(m)<qa)R.warn("Active hover camera view vector and the supporting plane are parallel to each other. Set hover pivot based on the camera position."),g.Sb[0]=g.h[0],g.Sb[1]=0,g.Sb[2]=g.h[2];g=h(d,ga);f=Q.Je(g[1],f.yb.Xa,f.yb.Ma);0<g[1]&&R.warn("Active hover camera has wrong orientation");f?y(d,0,f):w(d)}else f.om=
!1;k.type==a.Lc&&c(d)};a.Wy=c;a.Jw=d;a.lb=e;a.uD=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.hb);case "DEPTH":return Boolean(a.Pc);case "SCREEN":return!Boolean(a.hb)&&!Boolean(a.Pc);default:throw"Wrong attachment type: "+b;}};a.Pk=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.hb=c;break;case "DEPTH":a.Pc=c;break;case "SCREEN":a.hb=null;a.Pc=null;break;default:throw"Wrong attachment type: "+b;}};a.eE=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.hb;
case "DEPTH":return a.Pc;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.xr=function(b,c){if(b.type!=a.Hb||c!=a.ub&&c!=a.Cb)throw"make_stereo(): wrong camera type";b.type=c;g(b,6,.065)};a.QA=g;a.get_camera_angles=h;a.Cq=k;a.get_camera_angles_char=function(a,b){h(a,b);b[0]=Q.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.get_angles=function(a,b){var c=a.e,d=Q.quat_to_dir(c.quat,Q.AXIS_MY,Y),f=Math.asin(d[1]/X.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(f)>Math.PI/4&&(d=0>=
f?Q.quat_to_dir(c.quat,Q.AXIS_MZ,ea):Q.quat_to_dir(c.quat,Q.AXIS_Z,ea)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=f;return b};a.Qk=n;a.IA=function(b,c,d,f,e,h,g){switch(b.type){case a.zf:b.left=c;b.right=d;b.bottom=f;b.top=e;b.Ua=h;b.Sa=g;break;default:R.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.e.wa};a.UA=f;a.YE=l;a.Cs=function(a,b,c){var d=Y;d[0]=0;d[1]=-1;d[2]=0;X.transformQuat(d,
c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var f=ea;f[0]=0;f[1]=0;f[2]=-1;X.transformQuat(f,c,f);l(a,b,d,f)};a.Jx=function(a,b,c,d,f){d[0]=a[0];d[1]=a[1];d[2]=a[2];S.lookAt(a,b,c,da);S.invert(da,da);S.rotateX(da,Math.PI/2,da);pa.fromMat4(da,fa);U.fromMat3(fa,f)};a.ZB=t;a.YB=function(b){var c=b.e,d=b.e;if(d.wa===a.MS_TARGET_CONTROLS||d.wa===a.MS_EYE_CONTROLS){if(d.Rb){var f=d.Rb.left,e=d.Rb.right,g=h(b,ga);(g=d.wa==a.MS_TARGET_CONTROLS?Q.Je(g[0],f,e):Q.Je(g[0],e,f))&&(d.wa==a.MS_TARGET_CONTROLS?u(b,g,0):
H(b,g,0))}d.Yb&&(f=d.Yb.Ma,e=d.Yb.Xa,g=h(b,ga),(g=d.wa==a.MS_TARGET_CONTROLS?Q.Je(g[1],e,f):Q.Je(g[1],f,e))&&(d.wa==a.MS_TARGET_CONTROLS?u(b,0,g):H(b,0,g)));d.wa===a.MS_TARGET_CONTROLS&&d.Ya&&(g=b.e,f=X.subtract(g.h,g.Lb,Y),e=X.length(f),e>g.Of?(X.scale(f,g.Of/e,f),X.add(g.Lb,f,g.h)):e<g.ce&&(e=Q.quat_to_dir(g.quat,Q.AXIS_MY,ea),X.scale(e,100*g.ce,e),X.add(f,e,f),X.scale(f,-g.ce/X.length(f),f),X.add(g.Lb,f,g.h)))}d.wa===a.MS_HOVER_CONTROLS&&(d=b.e,g=d.Ya?d.Sb:d.h,d.Rb&&(f=Q.clamp(g[0],d.Rb.left,d.Rb.right)-
g[0],g[0]+=f,d.Ya&&(d.h[0]+=f)),d.Yb&&(f=Q.clamp(g[2],d.Yb.Ma,d.Yb.Xa)-g[2],g[2]+=f,d.Ya&&(d.h[2]+=f)),d=b.e,d.Ya&&d.yb&&(g=h(b,ga)[1],g=Q.Je(g,d.yb.Xa,d.yb.Ma),Q.quat_to_dir(d.quat,Q.AXIS_MY,Y),g&&y(b,0,g)));A(b);switch(c.wa){case a.MS_TARGET_CONTROLS:K.uA(c.h,c.quat,c.Lb);K.correct_up(b,Q.AXIS_Y);break;case a.MS_EYE_CONTROLS:b.$a||K.correct_up(b,Q.AXIS_Y)}x(b)};a.uo=x;a.Zz=z;a.cA=D;a.fC=A;a.rotate_eye_camera=H;a.rotate_target_camera=u;a.rotate_hover_camera=y;a.Vy=w;a.AE=function(b){switch(b.type){case a.Hb:case a.Lc:case a.ub:case a.Cb:return!0;
default:return!1}};a.iy=function(b){b=b.e.I[0];switch(b.type){case a.Hb:case a.Od:case a.ub:case a.Cb:return Math.PI*b.vc/180;default:return R.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.gf=m;a.Ol=r;a.vp=E;a.Hx=I;a.Ev=function(a){a=a.e;var b=J.Ld();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Pb=b;var c=J.bm(1,[0,0,0]);a.Yc=c;a.Bl=J.Pp(1,b);a.Dl=J.Rp(1,b);a.Cl=J.Qp(1,b)};a.is_camera=F;a.is_target_camera=function(b){return F(b)&&b.e&&b.e.wa==a.MS_TARGET_CONTROLS?
!0:!1};a.is_eye_camera=function(b){return F(b)&&b.e&&b.e.wa==a.MS_EYE_CONTROLS?!0:!1};a.is_hover_camera=M;a.to=L;a.dx=O;a.project_point=function(b,c,d){b=b.e.I[0];switch(b.type){case a.Hb:case a.Od:case a.Lc:case a.Ee:case a.ub:case a.Cb:var f=ba;f.set(c);f[3]=1;la.transformMat4(f,b.Jd,f);c=-f[1]/f[3];d[0]=(f[0]/f[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;P.EC(d[0],d[1],d,b);2<d.length&&(d[2]=(f[2]/Math.abs(f[3])+1)/2);return d;default:return R.error("Non-compatible camera"),d}};a.vy=function(a){return a.e.I[0]};
a.Zj=function(b,c){switch(b.type){case a.Hb:case a.Od:case a.ub:case a.Cb:var d=Math.tan(Q.Jk(b.vc)/2);switch(c){case "LEFT":return-d*b.za;case "RIGHT":return d*b.za;case "TOP":return d;case "BOTTOM":return-d}break;case a.Lc:case a.Ee:switch(c){case "LEFT":return-b.top*b.za;case "RIGHT":return b.top*b.za;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.zf:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;default:Q.fa("Unknown camera type")}};
a.iz=function(b){switch(b.type){case a.Lc:case a.Ee:case a.zf:return!0;default:return!1}};a.get_fov=function(b,c){switch(b.type){case a.Hb:case a.Od:case a.ub:case a.Cb:var d=Q.Jk(b.vc);return c?d*b.za:d;default:return 0}}};b4w.module.__lights=function(a,p){function c(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),Rg:new Float32Array(3),jd:0,zg:0,ey:!1,fq:!1,Dg:!0,rf:!0,Pe:1,distance:25,RD:"INVERSE_SQUARE"}}function d(a){a.Rg[0]=a.color[0]*a.Pe;a.Rg[1]=a.color[1]*a.Pe;a.Rg[2]=a.color[2]*a.Pe}var b=p("__util"),e=p("vec3");a.tE=c;a.lz=function(a){var h=a.data,k=c(h.type);k.name=a.name;k.Dg=h.use_diffuse;k.rf=h.use_specular;var n=b.quat_to_dir(a.e.quat,b.AXIS_Y,[]);e.normalize(n,
n);k.direction[0]=n[0];k.direction[1]=n[1];k.direction[2]=n[2];k.color[0]=h.color[0];k.color[1]=h.color[1];k.color[2]=h.color[2];k.Pe=h.energy;d(k);k.distance=h.distance;if("POINT"===k.type||"SPOT"===k.type)k.distance=h.distance;"SPOT"===k.type?(k.zg=h.spot_blend,k.jd=h.spot_size):"POINT"===k.type&&(k.jd=Math.PI/2);k.ey=h.b4w_generate_shadows;k.fq=h.b4w_dynamic_intensity;a.ra=k};a.KA=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];d(a)};a.MA=function(a,b){a.zg=b};a.LA=function(a,b){a.distance=
b};a.NA=function(a,b){a.jd=b};a.zs=function(a,b){a.Pe=b;d(a)};a.mk=function(a){return"LAMP"===a.type?!0:!1};a.cC=function(a){if("LAMP"!=a.type)throw"Wrong light object";var c=a.ra;c&&(b.quat_to_dir(a.e.quat,b.AXIS_Y,c.direction),e.normalize(c.direction,c.direction))}};b4w.module.__scenes=function(a,p){function c(){lb||(lb=d(Ba));return lb}function d(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c.od||!c.od.length)return c}return null}function b(){if(!Qa)throw"No active scene available";return Qa}function e(a,b,c,d){for(var f=null,e=0;e<b.length;e++){var h=b[e];if((c?h.origin_name:h.name)==a&&h.e.rc==d){f=h;break}}return f}function g(a,b){b||(b="ALL");var c=[];h(a.objects,b,c);return c}function h(a,b,c){for(var d=0;d<a.length;d++){var f=a[d];"ALL"!=b&&b!=f.type||
c.push(f);(f=f.dupli_group)&&h(f.objects,b,c)}}function k(b){if(Fa.aj)switch(b.b4w_render_shadows){case "OFF":return!1;case "ON":return!0}else return!1;var c=!1,d=!1,f=Z(b,"LAMP",a.DATA_ID_ALL),e=Fa.xe&&b.b4w_enable_ssao;if(0==f.length&&!e)return!1;b=Z(b,"MESH",a.DATA_ID_ALL);for(f=0;f<b.length;f++){var h=b[f];h.b4w_shadow_cast&&(c=!0);h.b4w_shadow_receive&&(d=!0);if((e||c)&&d)return!0}return!1}function n(a){if(!a.sa)return!1;a=a.sa.LAMP;for(var b=0;b<a.length;b++)if("SUN"==a[b].ra.type)return!0;
return!1}function f(a){if(!Fa.shore_smoothing)return!1;a=C(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}function l(b){b=Z(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)for(var d=b[c].particle_systems,f=0;f<d.length;f++){var e=d[f].settings;if(e.b4w_enable_soft_particles&&0<e.b4w_particles_softness)return!0}return!1}function t(b){var c=C(b),d=[];b=Z(b,"MESH",a.DATA_ID_ALL);for(var f=0;f<c.length;f++){var e=c[f];if(e.b4w_water){for(var h=
{},g=0;g<b.length;g++)for(var k=b[g],v=k.data.materials,l=0;l<v.length;l++)v[l]==e&&(h.vf=k.location[1]);h.uc=e.b4w_water_fog_color.slice(0);h.uc.push(e.b4w_water_fog_density);e.b4w_water_dynamic?(h.qi=!0,h.waves_height=e.b4w_waves_height,h.waves_length=e.b4w_waves_length,h.dst_noise_scale0=e.b4w_water_dst_noise_scale0,h.dst_noise_scale1=e.b4w_water_dst_noise_scale1,h.dst_noise_freq0=e.b4w_water_dst_noise_freq0,h.dst_noise_freq1=e.b4w_water_dst_noise_freq1,h.dir_min_shore_fac=e.b4w_water_dir_min_shore_fac,
h.dir_freq=e.b4w_water_dir_freq,h.dir_noise_scale=e.b4w_water_dir_noise_scale,h.dir_noise_freq=e.b4w_water_dir_noise_freq,h.dir_min_noise_fac=e.b4w_water_dir_min_noise_fac,h.dst_min_fac=e.b4w_water_dst_min_fac,h.waves_hor_fac=e.b4w_water_waves_hor_fac):(h.qi=!1,h.waves_height=0,h.waves_length=0);h.Xd=e.b4w_water_enable_caust;h.Yv=e.b4w_water_caust_scale;h.Xv=e.b4w_water_caust_brightness;h.Zv=new Float32Array([.3,.7]);h.Sk=null;e=e.texture_slots;for(g=0;g<e.length;g++)k=e[g].texture,!0===k.b4w_shore_dist_map&&
(h.Sk=k.image,h.Ah=k.image.size[0],h.aB=k.b4w_shore_boundings,h.nh=k.b4w_max_shore_dist);d.push(h)}}if(0<d.length){h=d[0];if(!h.qi)for(f=0;f<d.length;f++)d[f].qi&&(h=d[f]);return h}return null}function x(a){function b(a){if(a){a=a.nodes;for(var d=0;d<a.length;d++){var f=a[d];"GROUP"==f.type&&f.node_group&&b(f.node_group.node_tree);"GROUP"==f.type&&"B4W_REFRACTION"==f.node_tree_name&&(c.fc=!0)}}}var c={fc:!1};a=C(a);for(var d=0;d<a.length;d++){var f=a[d];f.b4w_refractive&&(c.fc=!0);f.node_tree&&b(f.node_tree)}return c}
function z(b){if(Fa.Nk)switch(b.b4w_render_reflections){case "OFF":return!1}else return!1;for(var c=[],d=0,f=Z(b,"MESH",a.DATA_ID_ALL),e=0;e<f.length;e++){var h=f[e];if(h.e.Cc)if("CUBE"==h.e.re)d++;else{var g=h.ol;h.ol=null;if(g){-1==b.sa.EMPTY.indexOf(g)&&(b.sa.ALL.push(g),b.sa.EMPTY.push(g));g.e||jb.$k(g,!1);for(var h=null,k=0;k<c.length;k++)if(c[k]==g){h=k;break}null==h&&c.push(g)}}}return{Mk:c,Gr:d,Qj:[],Si:[]}}function D(a,b){var c={},d=a.world.b4w_sky_settings;c.mA=d.render_sky;c.procedural_skydome=
d.procedural_skydome&&b;c.use_as_environment_lighting=d.use_as_environment_lighting;c.Bh=d.color;c.rayleigh_brightness=d.rayleigh_brightness;c.mie_brightness=d.mie_brightness;c.spot_brightness=d.spot_brightness;c.scatter_strength=d.scatter_strength;c.rayleigh_strength=d.rayleigh_strength;c.mie_strength=d.mie_strength;c.rayleigh_collection_power=d.rayleigh_collection_power;c.mie_collection_power=d.mie_collection_power;c.mie_distribution=d.mie_distribution;c.Vb=d.reflexible;c.Mb=d.reflexible_only;!b&&
d.procedural_skydome&&Wa.warn("There is no sun on the scene. Procedural sky won't be rendered");return c}function A(a){var b={};a=a.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.Ty=a.hemisphere;b.Qv=a.blur_depth;b.pp=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;b.wA=a.samples;return b}function H(a){var b={};a=a.b4w_bloom_settings;b.blur=a.blur;b.wx=a.edge_lum;b.key=a.key;return b}function u(a){var b={};a=a.b4w_motion_blur_settings;b.mb_decay_threshold=a.motion_blur_decay_threshold;
b.mb_factor=a.motion_blur_factor;return b}function y(a){var b={};a=a.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}function q(a){var b={};a=a.b4w_god_rays_settings;b.Zy=a.intensity;b.mh=a.max_ray_length;b.Hh=a.steps_per_pass;return b}function w(a){var b={};b.bf=a.b4w_outline_color;b.Li=a.b4w_outline_factor;return b}function m(a){var b={};a=a.b4w_glow_settings;b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=
a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b}function r(a,b){var c=a.world,d=c.light_settings,f={};f.Qe=d.environment_energy;f.vo=d.use_environment_light;f.pm=d.environment_color;f.Ue=c.horizon_color.slice(0);f.xf=c.zenith_color.slice(0);f.wC=c.use_sky_paper;f.vC=c.use_sky_blend;f.xC=c.use_sky_real;f.Ls=null;f.Un=null;f.qm=null;if(f.vo&&"SKY_TEXTURE"==f.pm&&(!b.procedural_skydome||!b.use_as_environment_lighting)){for(var d=
null,e=0;e<c.texture_slots.length;e++)if(c.texture_slots[e].texture.b4w_use_as_environment_lighting){d=c.texture_slots[e];break}d?f.qm=d:(Wa.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),f.vo=!1)}for(e=0;e<c.texture_slots.length;e++)if(c.texture_slots[e].texture.b4w_use_as_skydome){c=c.texture_slots[e];f.Ls=c;f.Un={Nv:c.blend_factor,Uy:c.horizon_factor,MC:c.zenith_up_factor,LC:c.zenith_down_factor,
color:c.color,va:c.default_value,invert:c.invert,uC:c.use_rgb_to_intensity,Ov:c.blend_type,qC:c.use_map_blend,rC:c.use_map_horizon,tC:c.use_map_zenith_up,sC:c.use_map_zenith_down};break}return f}function E(b){if(!Fa.wb)return!1;var c=!1,d=!1;b=Z(b,"MESH",a.DATA_ID_ALL);for(var f=0;f<b.length;f++){for(var e=b[f],h=e.data.materials,g=0;g<h.length;g++)h[g].b4w_terrain&&(c=!0);e=e.particle_systems;for(g=0;g<e.length;g++)h=e[g].settings,"HAIR"==h.type&&h.b4w_dynamic_grass&&(d=!0);if(c&&d)return!0}return!1}
function I(b){if(Vb.outlining_overview_mode)return!0;if(Fa.enable_selectable)switch(b.b4w_enable_object_selection){case "OFF":return!1;case "ON":return!0;case "AUTO":b=Z(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)if(b[c].e.xg)return!0;return!1}else return!1}function F(b){if(Vb.outlining_overview_mode)return!0;if(Fa.enable_outlining)switch(b.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;case "AUTO":b=Z(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)if(b[c].e.Fb)return!0;
return!1}else return!1}function M(b){if(Fa.Se)switch(b.b4w_enable_glow_materials){case "OFF":return!1;case "ON":return!0;case "AUTO":b=Z(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,f=0;f<d.length;f++)if(oc.Bp(d[f]))return!0;return!1}else return!1}function L(a,b){if(Fa.fc)switch(a.b4w_render_refractions){case "OFF":return!1;case "ON":return!0;case "AUTO":return b.fc}else return!1}function O(b){b=Z(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,
f=0;f<d.length;f++){var e=d[f],h=e.game_settings.alpha_blend;if(e.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h)return!0}return!1}function B(b){switch(b.b4w_enable_anchors_visibility){case "OFF":return!1;case "ON":return!0}b=Z(b,"EMPTY",a.DATA_ID_ALL);for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_anchor&&d.b4w_anchor.detect_visibility)return!0}return!1}function J(a,b,c){var d=Ca.kg(a,b);Ca.Ae(a,d,function(a,b,d){if(d.Pa){switch(d.O){case "COLOR":case "CUBEMAP":a=b.j.hb;break;case "DEPTH":a=b.j.Pc;
break;case "SCREEN":a=null;break;case "MAIN_CUBE_REFLECT":return;default:throw"Wrong slink";}switch(d.pa){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "u_cube_reflection":case "u_plane_reflection":break;default:if(!a)throw"Connection of SCREEN is forbidden";if(a.tf)throw"Batch texture can't use renderbuffer";na.Dp(c.Xb,d.pa)&&ja.Ng(c,a,d.pa)}}});for(a=0;a<b.ga.length;a++){var d=b.ga[a],f=b.Fd[a];switch(d.pa){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;
default:if(f.tf)throw"Batch texture can't use renderbuffer";na.Dp(c.Xb,d.pa)&&ja.Ng(c,f,d.pa)}}}function K(a,b){return{Ra:!0,mm:[!0,!0,!0,!0,!0,!0],cd:a,B:b}}function P(a,b,c,d,f){switch(a.type){case "MAIN_OPAQUE":R(a,b,c,"OPAQUE",d,f);break;case "MAIN_BLEND":R(a,b,c,"BLEND",d,f);break;case "MAIN_XRAY":R(a,b,c,"XRAY",d,f);break;case "MAIN_GLOW":R(a,b,c,"GLOW",d,f);break;case "MAIN_PLANE_REFLECT":case "MAIN_CUBE_REFLECT":for(var e=b.e,h=b.o,g=0;g<h.length;g++){var k=h[g];if(("MAIN"==k.type||"PARTICLES"==
k.type)&&"REFLECT"==k.Ja){if("MAIN_PLANE_REFLECT"==a.type){var v;a:{if(d.e.zb){v=d.e.zb.Si;for(var l=0;l<v.length;l++)if(v[l]==a){v=l;break a}}v=null}if(v==e.zc)continue}else{a:{if(d.e.zb)for(v=d.e.zb.Qj,l=0;l<v.length;l++)if(v[l]==a){v=l;break a}v=null}if(v==e.pc)continue}f||(T(k,a,b,c,"REFLECT",d),v=k.Ab,na.D(v,"DISABLE_FOG",0),na.D(v,"WATER_EFFECTS",0),"special_skydome.glslf"==na.Gq(v)&&na.D(v,"REFLECTION_PASS",1),na.D(v,"TEXTURE_NORM",0),X(d,k),ja.jb(k),la(k));a.q.push(K(e,k))}}break;case "DEPTH":e=
b.o;for(h=0;h<e.length;h++)g=e[h],"DEPTH"!=g.type||g.hc||"DEPTH"!=g.Ja&&"NODES"!=g.Ja||(f||(T(g,a,b,c,"DEPTH",d),ja.jb(g),la(g)),a.q.push(K(b.e,g)),J(c,a,g),U(g));break;case "SHADOW_CAST":e=!1;h=b.e;b=b.o;g=ka.Ga(c,"GRASS_MAP");for(k=0;k<b.length;k++)v=b[k],"DEPTH"==v.type&&"SHADOW_CAST"==v.Ja&&(e=!0,f||(na.D(v.Ab,"SHADOW_USAGE","SHADOW_CASTING"),v.wb&&g&&pa(v,g,h),ja.oa(v,"SHADOW_TEX_RES",na.t(d.e.ue.csm_resolution)),ja.jb(v),la(v)),a.q.push(K(h,v)));e&&qa(a,ka.Ga(c,"MAIN_OPAQUE"),a.q,d,!0);break;
case "COLOR_PICKING":ha(a,b,c,d,f);break;case "COLOR_PICKING_XRAY":ha(a,b,c,d,f);break;case "OUTLINE_MASK":c=b.e;d=b.o;for(b=0;b<d.length;b++)e=d[b],"COLOR_ID"==e.type&&"OUTLINE"==e.Ja&&(f||(ja.oa(e,"USE_OUTLINE",1),ja.jb(e),la(e)),a.q.push(K(c,e)));break;case "GRASS_MAP":c=b.e;d=b.o;for(b=0;b<d.length;b++)e=d[b],"GRASS_MAP"==e.type&&(f||(ja.jb(e),la(e)),a.q.push(K(c,e)),e=a.j,v=c.gb,h=a.ac[0],g=a.ac[1],k=a.ac[2],0==h&&0==g?(h=v.min_y,g=v.max_y):(h=Math.min(h,v.min_y),g=Math.max(g,v.max_y)),v=1E-4*
(g-h),a.ac[0]=h-v,a.ac[1]=g+v,mb.Qk(e,k/2,-g,-h,k/2),mb.gf(e));break;case "WIREFRAME":for(d=b.e,b=b.o,e=0;e<b.length;e++)h=b[e],"WIREFRAME"==h.type&&(f||(h.wb&&(g=ka.Ga(c,"GRASS_MAP"))&&pa(h,g,d),ja.jb(h),la(h)),a.q.push(K(d,h)),J(c,a,h),U(h))}}function R(a,b,c,d,f,e){for(var h=b.e,g=b.o,k=0;k<g.length;k++){var v=g[k];v.hc||v.Mb||"MAIN"!=v.type&&"NODES_GLOW"!=v.type&&"PARTICLES"!=v.type||!("OPAQUE"==v.Ja&&"OPAQUE"==d||"BLEND"==v.Ja&&"BLEND"==d||"XRAY"==v.Ja&&"XRAY"==d||"NODES_GLOW"==v.type&&"GLOW"==
d)||(e||(T(v,a,b,c,d,f),X(f,v),ja.jb(v),la(v)),a.q.push(K(h,v)),J(c,a,v),U(v))}a.q.sort(function(a,b){var c;if(a.B&&b.B){c=a.B.Ca;var d=b.B.Ca;(c=c==d?0:c>d?1:-1)||(c=a.B.ng,d=b.B.ng,c=c==d?0:c>d?1:-1)}else c=0;return c})}function T(a,b,c,d,f,e){var h=c.e,g="NO_SHADOWS",v=ka.Ga(d,"SHADOW_CAST");if(v&&a.ic){switch(f){case "OPAQUE":g="SHADOW_MAPPING_OPAQUE";break;case "BLEND":case "XRAY":g="SHADOW_MAPPING_BLEND";break;case "COLOR_ID":case "REFLECT":case "GLOW":g="NO_SHADOWS";break;case "DEPTH":g="SHADOW_MASK_GENERATION";
break;default:throw"Wrong subscene type";}ja.dp(a,e.e.ue,v)}v=a.Ab;na.D(v,"SHADOW_USAGE",g);a.wb&&(g=ka.Ga(d,"GRASS_MAP"))&&pa(a,g,h);if("DEPTH"!=a.type&&"COLOR_ID"!=f||a.dh){f=b.mg;na.D(v,"NUM_LIGHTS",f);na.D(v,"NUM_LFACTORS",0==f%2?f/2:Math.floor(f/2)+1);"special_skydome.glslf"==na.Gq(v)&&na.D(v,"REFLECTION_PASS",0);na.D(v,"SSAO_ONLY",0);b.fb&&b.md?na.D(v,"WATER_EFFECTS",1):na.D(v,"WATER_EFFECTS",0);b.fb&&b.Xd&&h.Xd?(na.D(v,"CAUSTICS",1),na.D(v,"CAUST_SCALE",na.t(b.xp)),na.D(v,"CAUST_SPEED",na.t(b.yp,
2)),na.D(v,"CAUST_BRIGHT",na.t(b.wp))):na.D(v,"CAUSTICS",0);b.fb&&(na.D(v,"WAVES_HEIGHT",na.t(b.wf)),na.D(v,"WAVES_LENGTH",na.t(b.Hg)),na.D(v,"WATER_LEVEL",na.t(b.vf)));-1!==a.Gb.indexOf("u_mirrormap")?na.D(v,"REFLECTION_TYPE","REFL_MIRRORMAP"):a.Cc?null!=h.pc&&ka.Ga(d,"MAIN_CUBE_REFLECT")?(c=e.e.zb?e.e.zb.Qj[c.e.pc]:null)?(c=c.j.hb,ja.Ng(a,c,"u_cube_reflection"),na.D(v,"REFLECTION_TYPE","REFL_CUBE")):na.D(v,"REFLECTION_TYPE","REFL_NONE"):null!=h.zc&&ka.Ga(d,"MAIN_PLANE_REFLECT")?(c=e.e.zb?e.e.zb.Si[c.e.zc]:
null)?(c=c.j.hb,ja.Ng(a,c,"u_plane_reflection"),na.D(v,"REFLECTION_TYPE","REFL_PLANE")):na.D(v,"REFLECTION_TYPE","REFL_NONE"):na.D(v,"REFLECTION_TYPE","REFL_NONE"):na.D(v,"REFLECTION_TYPE","REFL_NONE");(h=ka.Ga(d,"SKY"))?a.hs?(c=h.j.hb,ja.Ng(a,c,"u_sky")):Fa.Hk?(a.oc=h.oc,na.D(v,"PROCEDURAL_FOG",1)):na.D(v,"PROCEDURAL_FOG",0):na.D(v,"PROCEDURAL_FOG",0);c=e.e.Go;c.vo&&(na.D(v,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==c.pm?(c=c.qm?ja.my(c.qm,!1):h.j.hb,na.D(v,"SKY_TEXTURE",1),ja.Ng(a,c,"u_sky_texture")):
"SKY_COLOR"==c.pm&&na.D(v,"SKY_COLOR",1));a.Nn?(Fa.ni&&na.D(v,"USE_REFRACTION_CORRECTION",1),"MAIN"==a.type&&a.dh||"NODES_GLOW"==a.type?(na.D(v,"REFRACTIVE",1),e.e.fc?na.D(v,"USE_REFRACTION",1):na.D(v,"USE_REFRACTION",0)):e.e.fc?na.D(v,"REFRACTIVE",1):na.D(v,"REFRACTIVE",0)):(na.D(v,"REFRACTIVE",0),na.D(v,"USE_REFRACTION",0),na.D(v,"USE_REFRACTION_CORRECTION",0));a.uf&&(Fa.shore_smoothing&&a.gl&&ka.Ga(d,"DEPTH")?na.D(v,"SHORE_SMOOTHING",1):na.D(v,"SHORE_SMOOTHING",0),a.water_dynamic&&b.fb&&b.wf?na.D(v,
"DYNAMIC",1):na.D(v,"DYNAMIC",0));"PARTICLES"==a.type&&(na.D(v,"SIZE_RAMP_LENGTH",a.Zr),na.D(v,"COLOR_RAMP_LENGTH",a.Qr));if(!a.Rf)for(b=a.M,d=0;d<b.length;d++)if(c=b[d],"SCENE"==c.source)for(h=0;h<Ba.length;h++){f=Ba[h];for(var g=Ba[h].od,k=0;k<g.length;k++)g[k].e==c&&Ca.m(fb,f,e,null)}if(a.jh){b=0;for(var l in a.jh)b++;a.dn=new Float32Array(3*b);a.bn=new Float32Array(3*b);a.an=new Float32Array(3*b);a.cn=new Float32Array(4*b);na.D(v,"NUM_LAMP_LIGHTS",b);for(d=0;d<e.sa.LAMP.length;d++)Q(a,e.sa.LAMP[d])}}}
function Q(a,b){var c=b.uuid;if(c in a.jh){c=a.jh[c];a.dn.set(b.e.h,3*c);a.bn.set(b.ra.direction,3*c);a.an.set(b.ra.Rg,3*c);var d=ra,f=b.ra;d[0]=-1;d[1]=-1;d[2]=-1;d[3]=f.rf?1:0;switch(f.type){case "POINT":d[2]=f.distance;break;case "SPOT":d[2]=f.distance;var e=d[0]=Math.cos(f.jd/2);d[1]=f.zg*(1-e)}a.cn.set(d,4*c)}}function X(b,c){var d=Z(b,"LAMP",a.DATA_ID_ALL);c.Ab.hn=[];for(var f=ga(d)||d[0],e=0;e<d.length;e++){var h=d[e].ra;if("AREA"!=h.type){if("SPOT"==h.type||"POINT"==h.type)var g=Math.cos(h.jd/
2);if("SPOT"==h.type)var v=h.zg*(1-g);var k=h.index;c.Ab.hn.push({type:h.type,index:k,pz:Math.floor(k/2),oz:0==k%2?"rg":"ba",jd:g,zg:v,distance:h.distance,hz:h.Dg||h.rf,Ux:k==f.ra.index})}}}function la(a){var b=a.Xb.attributes,c=a.T.Ub,d;for(d in b)c[d]||Ra.fa('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES_GLOW"==a.type)if(b=na.Iy(a.Xb.Bo),10<b&&("MAIN"==a.type&&Wa.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.Sc.join(", ")+'"'),"MAIN"==a.type&&a.dh||"NODES_GLOW"==
a.type))d=c=0,a.Fg&&(c=Ra.wd(a.Fg)),a.sb&&(d=Ra.wd(a.sb)),Wa.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.Sc.join(", ")+'"')}function U(a){8<a.M.length&&Wa.warn(a.type,"too many textures used - "+a.M.length+' (max 8), materials "'+a.Sc.join(", ")+'"')}function pa(a,b,c){a.ac=b.ac;var d=b.ac[0],f=b.ac[1],e=b.ac[2];c=c.Pb;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);e=0==e?c:Math.max(e,c);b.ac[2]=e;b=b.j;mb.Qk(b,e/2,-f,-d,e/2);mb.gf(b);d=a.Nm||0;d=0==d?
c:Math.max(d,c);a.Nm=d}function S(a){var b=ma(a,"MAIN_OPAQUE"),c=!0;Ca.R(a.e.ib,function(d,f){"SHADOW_CAST"===f.type&&(qa(f,b,f.q,a,c),c=!1)})}function qa(b,c,d,f,e){if(0!=d.length){var h=b.j;c=c.j;var g=Z(f,"LAMP",a.DATA_ID_ALL);if(g=ga(g)||g[0]){var v=g.e;mb.Cs(h,v.h,v.quat);Eb.copy(c.Re,h.Re);zb.copy(c.qa,h.Fs);if("SPOT"==g.ra.type||"POINT"==g.ra.type)mb.gf(h,h.za);else{g=V;wa.Ld(g);for(v=0;v<d.length;v++){var k=d[v].cd;0==v?wa.Mp(k.gb,g):wa.hq(g,k.gb)}d=wa.Gx(g,xa);Ra.df(d,h.qa,d);if(f.e.ue.enable_csm){f=
Eb.copy(c.ji[b.cm],ya);g=zb.invert(c.qa,Hb);Ra.df(f,g,f);Ra.df(f,h.qa,f);b=c.dm[b.cm];if(e)for(za=0,ua=-Infinity,e=2;e<d.length;e+=3)za=Math.min(za,d[e]),ua=Math.max(ua,d[e]);e=V;e.max_x=f[0]+b;e.max_y=f[1]+b;e.max_z=ua;e.min_x=f[0]-b;e.min_y=f[1]-b;e.min_z=za}else{b=e=V;c=Yb;c.set(d);f=La/9;d=zb.identity(Hb);zb.rotate(d,f,Ra.AXIS_MZ,d);v=g=-1;for(k=0;10>k;k++){var l=wa.Kv(c,Qb),m=(l.max_x-l.min_x)*(l.max_y-l.min_y);if(-1==g||m<g)g=m,v=k,wa.Mp(l,b);Ra.df(c,d,c)}b=v*f;0<b&&(c=zb.identity(Hb),zb.rotate(c,
b,Ra.AXIS_MZ,c),zb.multiply(c,h.qa,h.qa));b=e.max_x-e.min_x;c=e.max_y-e.min_y;b&&c&&(f=Math.abs(b-c)/2,2<b/c?(e.max_y+=f,e.min_y-=f):2<c/b&&(e.max_x+=f,e.min_x-=f));e.max_x+=.005;e.max_y+=.005;e.max_z+=.005;e.min_x-=.005;e.min_y-=.005;e.min_z-=.005}mb.IA(h,e.min_x,e.max_x,e.min_y,e.max_y,-e.max_z,-e.min_z);mb.gf(h)}Ra.um(h.Jd,h.Xj)}}}function ga(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.data.b4w_generate_shadows)return c}return!1}function ha(a,b,c,d,f){for(var e=b.e,h=b.o,g=0;g<h.length;g++){var v=
h[g];"COLOR_ID"==v.type&&(f||(T(v,a,b,c,"COLOR_ID",d),ja.jb(v),la(v)),"COLOR_PICKING"==a.type&&"COLOR_ID"==v.Ja||"COLOR_PICKING_XRAY"==a.type&&"COLOR_ID_XRAY"==v.Ja)&&(f||(ja.oa(v,"USE_OUTLINE",0),ja.jb(v),la(v)),a.q.push(K(e,v)))}}function Y(a,b){for(var c=ba(b,Ga),d=a.ra,f=a.e,e=d.index,h=0;h<c.length;h++){var g=c[h];g.Ye.set(f.h,3*e);g.cg.set(d.direction,3*e);g.bg.set(d.Rg,3*e);switch(d.type){case "SUN":if(g.bt.set(f.quat),g.at=d.Rg,"SKY"===g.type){var v=ya;v[0]=v[1]=v[2]=1;var k=Math.acos(Eb.dot(g.Wk,
v)),v=Math.acos(Eb.dot(d.direction,v));g.sk=Math.floor(k/.025)!=Math.floor(v/.025)?!0:!1;Eb.copy(d.direction,g.Wk);ea(b,g)}else Eb.copy(d.direction,g.Wk);case "HEMI":case "POINT":case "SPOT":break;default:Wa.error("Unknown light type: "+d.type+'".')}k=Aa;k[0]=d.Dg?1:0;k[1]=d.rf?1:0;g.dg.set(k,2*e);g.na=!0;for(k=0;k<g.q.length;k++)v=g.q[k].B,v.jh&&Q(v,a)}}function ea(a,b){pc.pi(b);if(b.sk)for(var c=ba(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_GLOW"]),d=0;d<c.length;d++)for(var f=c[d].q,e=0;e<
f.length;e++){var h=f[e];h.Ra&&(h=h.B,ja.bw(h)&&pc.VB(h))}}function Z(b,c,d){if(!b.sa)throw"Access to uninitialized scene";b=b.sa[c]||[];if(d==a.DATA_ID_ALL)return b;c=[];for(var f=0;f<b.length;f++){var e=b[f];e.e.rc==d&&c.push(e)}return c}function C(b){var c=[];b=Z(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++)for(var f=b[d].data,e=0;e<f.materials.length;e++){var h=f.materials[e];-1==c.indexOf(h)&&c.push(h)}return c}function W(a,b,c){for(var d=a.e,f=a.camera.e.I,e=0;e<f.length;e++){var h=f[e];
mb.gf(h,b/c);d.On&&mb.to(h,d.ue)}d.On&&(d.tk=!0,ma(a,"DEPTH").na=!0,ma(a,"MAIN_BLEND").na=!0);var g=d.ib;ka.OB(g,function(d,f,e){if(d.Oh){var h=d.mf*b,v=d.mf*c;if(f)for(f=0;f<e.ga.length;f++)e.ga[f]==d&&Tb.resize(d.ua,h,v);else switch(Tb.Fi(d.ua)&&Tb.resize(d.ua,h,v),d=e.j,d.width=h,d.height=v,e.type){case "DOF":fa(a,{dof_power:e.j.dof_power,dof_on:e.j.dof_on});break;case "GLOW_COMBINE":aa(a,{small_glow_mask_width:e.small_glow_mask_width,large_glow_mask_width:e.large_glow_mask_width});break;case "BLOOM":da(a,
{bloom_blur:e.bloom_blur});break;case "OUTLINE":e=ka.Fa(g,e,"POSTPROCESSING");h=ka.Fa(g,e,"POSTPROCESSING");v=ka.Fa(g,h,"POSTPROCESSING");d=ka.Fa(g,v,"POSTPROCESSING");ka.Dc(e,1/b,1/c);ka.Dc(h,1/b,1/c);ka.Dc(v,1/b,1/c);ka.Dc(d,1/b,1/c);break;default:ka.Dc(e,1/b,1/c)}}})}function ba(a,b){for(var c=[],d=0;d<b.length;d++){var f=b[d];Ca.R(a.e.ib,function(a,b){b.type==f&&c.push(b)})}return c}function ma(a,b){return ka.Ga(a.e.ib,b)}function fa(a,b){var c=ma(a,"DOF");if(!c)return Wa.error("DOF is not enabled on the scene. Check camera settings"),
0;var d=a.e.ib;"boolean"==typeof b.dof_on&&(c.j.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.j.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.j.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.j.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.j.dof_power=b.dof_power;var f=ka.Fa(d,c,"POSTPROCESSING"),d=ka.Fa(d,f,"POSTPROCESSING");ka.Nb(f,c.j.dof_power);ka.Dc(f,1/c.j.width,1/c.j.height);ka.Nb(d,c.j.dof_power);ka.Dc(d,1/c.j.width,1/c.j.height)}c.na=!0}
function da(a,b){var c=ma(a,"LUMINANCE_TRUNCED"),d=ma(a,"BLOOM");if(!c||!d)return Wa.error("Bloom is not enabled on the scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.na=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.na=!0);if("number"==typeof b.bloom_blur){var f=a.e.ib,c=ka.Fa(f,d,"BLOOM_BLUR"),f=ka.Fa(f,c,"BLOOM_BLUR");d.bloom_blur=b.bloom_blur;ka.Nb(c,b.bloom_blur);ka.Dc(c,1/d.j.width,1/d.j.height);ka.Nb(f,b.bloom_blur);ka.Dc(f,1/d.j.width,1/d.j.height)}}
function aa(a,b){var c=ma(a,"GLOW_COMBINE");if(!c)return Wa.error("Glow is not enabled on the scene"),null;for(var d=a.e.ib,f=ka.yy(d,c),e=0;e<f.length;++e){var h=f[e];if("POSTPROCESSING"===h.type&&"GLOW_MASK_LARGE"===h.Ja)var g=h;if("POSTPROCESSING"===h.type&&"GLOW_MASK_SMALL"===h.Ja)var v=h}f=ka.Fa(d,g,"POSTPROCESSING");d=ka.Fa(d,v,"POSTPROCESSING");"number"==typeof b.small_glow_mask_coeff&&(c.small_glow_mask_coeff=b.small_glow_mask_coeff,c.na=!0);"number"==typeof b.large_glow_mask_coeff&&(c.large_glow_mask_coeff=
b.large_glow_mask_coeff,c.na=!0);"number"==typeof b.small_glow_mask_width&&(c.small_glow_mask_width=b.small_glow_mask_width,ka.Nb(v,b.small_glow_mask_width),ka.Dc(v,1/c.j.width,1/c.j.height),v.na=!0,ka.Nb(d,b.small_glow_mask_width),ka.Dc(d,1/c.j.width,1/c.j.height),d.na=!0);"number"==typeof b.large_glow_mask_width&&(c.large_glow_mask_width=b.large_glow_mask_width,ka.Nb(g,b.large_glow_mask_width),ka.Dc(g,1/c.j.width,1/c.j.height),g.na=!0,ka.Nb(f,b.large_glow_mask_width),ka.Dc(f,1/c.j.width,1/c.j.height),
f.na=!0)}function v(a,b){var c=ma(Qa,"MAIN_OPAQUE");if(!c||!c.fb)return Wa.error("get_water_surface_level() - no water parameters on the scene"),0;var d=c.wf,f=c.Hg,e=c.vf,h=c.fb;if(!d||!h.qi)return h.vf;var g=Eb.length(c.kj),v=c.time;g&&(v*=g);var k=Aa;k[0]=20/f*(a-.25*v);k[1]=20/f*(b-.25*v);g=Ra.zp(k);k[0]=17/f*(b+.1*v);k[1]=17/f*(a+.1*v);var k=Ra.zp(k),g=g+k-1,l=h.dst_noise_scale0,k=h.dst_noise_scale1,m=h.dst_noise_freq0,G=h.dst_noise_freq1,n=Aa;n[0]=l*(a+m*v);n[1]=l*(b+m*v);l=Ra.Wn(n);n[0]=k*
(b-G*v);n[1]=k*(a-G*v);k=Ra.Wn(n);k*=d*l;if(c.cl)if(G=(a-c.jf[0])/c.kf[0],n=(c.jf[1]+b)/c.kf[1],G+=.5,n+=.5,1<G||0>G||1<n||0>n)d=k;else var G=Ra.Bq(Qa.e.Rn,c.Ah,G,n),l=h.dir_freq,q=h.dir_noise_scale,r=h.dir_noise_freq,m=h.dir_min_noise_fac,n=h.dst_min_fac,c=f/c.nh/Math.PI,q=[q/f*(a+r*v),q/f*(b+r*v)],f=Math.sqrt(G),d=d*Math.max(G,h.dir_min_shore_fac)*Math.sin(f/c+l*v)*Math.max(Ra.Wn(q),m),h=Math.max(f,n),d=d*(1-h)+k*h,g=g*G;else d=k;return e+(d+.05*g)}function G(a,b){a.Di&&"POSTPROCESSING"==a.type&&
b.Ra!=a.Ra&&(a.Ra=b.Ra);b.Ra||"OUTLINE"!=a.type||(a.nm=0)}function oa(a,b,c,d){var f=Ca.Ta(a,b);mb.Pk(f.j,c,d);f.zl=!0;Ca.qf(a,b,function(b,f,e){e.Pa&&e.O==c&&ka.kw(e)&&Ka(a,b,e.pa,d)});Ca.Ae(a,b,function(b,f,e){e.Pa&&e.O==c&&e.O==e.pa&&oa(a,b,c,d)})}function Ka(a,b,c,d){a=Ca.Ta(a,b).q;for(b=0;b<a.length;b++)ja.qA(a[b].B,d,c)}function N(a){var b=ma(a,"GRASS_MAP");if(b){var c=b.j,d=a.camera.e,f=d.h;a=ya;a[0]=0;a[1]=-b.ac[2]/2;a[2]=0;Eb.transformQuat(a,d.quat,a);a[0]+=f[0];a[1]=0;a[2]+=f[2];b=Gb;b[0]=
0;b[1]=0;b[2]=0;b[3]=1;mb.Cs(c,a,b)}}function ta(a,b){Ca.R(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.ga[0]||!d.Fd[0])throw"Wrong MOTION_BLUR subscene";var f=d.ga[0],e=d.Fd[0];d.Fd[0]=d.j.hb;Ca.qf(a,c,function(b,c,d){d.Pa&&Ka(a,b,d.pa,e)});oa(a,c,f.O,e);Ka(a,c,f.pa,d.Fd[0]);d.Ar=Math.exp(-b/d.mb_factor)}})}function ca(b,c){var d=0,f=b.av;0==f.no&&(f.no=c);var e=c-f.no;if(f.rs&&e/f.Tc>=f.rs)a.clear_outline_anim(b);else{e%=f.Tc;if(e<f.Lr)switch(f=e/(f.Lr/5),e=Math.floor(f),e){case 0:d=(f-e)/2;
break;case 1:d=(f-e)/2+.5;break;case 2:d=1;break;case 3:d=1-(f-e)/2;break;case 4:d=.5-(f-e)/2}b.e.dd=d}}function Ha(a){Ca.R(a.e.ib,function(a,b){b.na=!0})}function ec(a){if("WIND"==a.field.type){a=a.e;Ra.quat_to_dir(a.quat,Ra.AXIS_Y,Ua);Eb.normalize(Ua,Ua);Eb.scale(Ua,a.Bm,Ua);a=Ba;for(var b=0;b<a.length;b++)for(var c=ba(a[b],Oa),d=0;d<c.length;d++)c[d].kj.set(Ua)}}function ub(a){var c=b();if(c=ma(c,"OUTLINE"))c.bf.set(a),c.na=!0}var ja=p("__batch"),wa=p("__boundings"),mb=p("__camera"),Pb=p("__config"),
Za=p("__container"),Rc=p("__constraints"),vd=p("__data"),qd=p("__debug"),Sc=p("__geometry"),Ca=p("__graph"),nb=p("__hud"),oc=p("__nodemat"),jb=p("__objects");p("__particles");var uc=p("__physics"),kb=p("__prerender"),vb=p("__primitives"),Wa=p("__print"),pc=p("__renderer"),ka=p("__scenegraph"),Mc=p("__sfx"),na=p("__shaders"),Tb=p("__textures"),Ra=p("__util"),Eb=p("vec3"),zb=p("mat4"),Fa=Pb.p,Vb=Pb.Fb,Ub=Pb.wh,Wb=Pb.Sd,Nc="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),Cc=["ARMATURE","EMPTY","MESH",
"SPEAKER"],va="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH OUTLINE_MASK WIREFRAME".split(" ");a.bD=va;var Ga="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),$a="MAIN_OPAQUE SSAO MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Oa="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS OUTLINE_MASK WIREFRAME".split(" "),
Sa="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Xb=0,lb=null,Qa=null,Ba=[],fb=null,Ma=[],La=Math.PI/2;a.yf=0;a.jl=1;a.kl=2;a.DATA_ID_ALL=-1;var Aa=new Float32Array(2),ya=new Float32Array(3);new Float32Array(4);var ra=new Float32Array(4),Gb=new Float32Array(4),Hb=new Float32Array(16),xa=new Float32Array(24),Yb=new Float32Array(24),V=wa.Ld(),Qb=wa.Ld(),Ua=new Float32Array(3),za=0,ua=-Infinity;a.set_active=function(a){Qa=a;Mc.FA(a)};a.bA=function(a,b){var c=
a.e,d=ka.Tw(c.ib);if(a==b){W(a,Za.Ky(),Za.Jy());for(var f=0;f<d.length;f++)a.e.ug.push(d[f])}else for(f=a.od[0],W(a,f.e.yg,f.e.yg),f=0;f<d.length;f++)b.e.ug.push(d[f]);d=ba(a,Oa);for(f=0;f<d.length;f++)d[f].kj.set(Ua);for(f=0;f<c.ug.length;f++)"SHADOW_CAST"==c.ug[f].type&&pc.pi(c.ug[f])};a.ah=c;a.wm=d;a.get_active=b;a.ia=function(){return Qa?!0:!1};a.Yj=function(a){return a.camera};a.zi=function(){return Ba};a.By=function(){if(1==Ba.length)return Ba;for(var a=0;a<Ba.length;a++){var b=Ba[a].e.ib;Ca.R(b,
function(b,c){for(var d=0;d<c.q.length;d++){for(var f=c.q[d].B.M,e=null,h=0;h<f.length;h++)if("SCENE"==f[h].source&&f[h].Xn==Ba[a].name&&"COPY"!=c.type){Wa.error('Texture-scene loop detected. A scene is rendered to texture "'+f[h].name+'" yet this texture belongs to the same scene.');Ca.kg(fb,Ba[a]);e=c.q[d].B;break}e&&(e.M=[],e.Gb=[],ja.UB(e,null),ja.jb(e))}})}for(var c=[],a=0;a<Ba.length;a++)if(b=Ba[a],!b.od.length){b=Ca.kg(fb,b);Ca.Ax(fb,b);b=Ca.fo(fb,b,Ca.il);b=Ca.po(b);Ca.R(b,function(a,b){c.push(b)});
break}return c};a.xd=function(b,c,d,f){for(var h=Ba,g=null,v=0;v<h.length;v++){var k=Z(h[v],"ALL",a.DATA_ID_ALL);switch(b){case a.yf:g=e(c,k,!1,d);break;case a.jl:g=null;(k=e(c,k,!1,f))&&k.dupli_group&&(g=e(d,k.dupli_group.objects,!0,f));break;case a.kl:for(var g=null,l=0;l<c.length;l++)if((g=e(c[l],k,0!=l,d))&&g.dupli_group)k=g.dupli_group.objects;else break}if(g)break}return g};a.rv=function(a,b,c){for(var d in Cc){var f=Cc[d],e=g(a,f),h=b.e.Qh,v=!1;for(d=0;d<c.length;d++)if(v=!0,c[d].e&&c[d].e.ag){for(var k=
0;k<h.length;k++)h[k]==c[d]&&(v=!1);v&&h.push(c[d])}f in b.sa||(b.sa[f]=[]);for(k=0;k<e.length;k++)Ra.is_armature(e[k])&&e[k].proxy||(b.sa.ALL.push(e[k]),b.sa[f].push(e[k]))}};a.lv=function(b,c){b.sa={ALL:[]};for(var d in Nc){var e=Nc[d],h=g(b,e);b.sa[e]=[];for(var v=0;v<h.length;v++)Ra.is_armature(h[v])&&h[v].proxy||(b.sa.ALL.push(h[v]),b.sa[e].push(h[v]))}b.od=b.od||[];b.e=b.e||{};b.ha=null;e=b.e;h=b.camera.e;d=b.b4w_shadow_settings;v=e.ue={};d.csm_resolution>Fa.Kb?(v.csm_resolution=Fa.Kb,Wa.error("Shadow map texture has unsupported size. Changed to "+
Fa.Kb+".")):v.csm_resolution=d.csm_resolution;v.self_shadow_polygon_offset=d.self_shadow_polygon_offset;v.self_shadow_normal_offset=d.self_shadow_normal_offset;v.enable_csm=d.b4w_enable_csm;var G=Z(b,"LAMP",a.DATA_ID_ALL);if(G=ga(G)||G[0])v.en=G.ra.type,v.jd=G.ra.jd,v.distance=G.ra.distance,"SPOT"!=v.en&&"POINT"!=v.en||!v.enable_csm||(Wa.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),v.enable_csm=!1);v.enable_csm?(v.csm_num=d.csm_num,v.csm_first_cascade_border=
d.csm_first_cascade_border,v.first_cascade_blur_radius=d.first_cascade_blur_radius,v.csm_last_cascade_border=d.csm_last_cascade_border,v.last_cascade_blur_radius=d.last_cascade_blur_radius,v.fade_last_cascade=d.fade_last_cascade,v.blend_between_cascades=d.blend_between_cascades):(v.csm_num=1,v.csm_first_cascade_border=d.csm_first_cascade_border,v.first_cascade_blur_radius=d.first_cascade_blur_radius,v.csm_last_cascade_border=d.csm_last_cascade_border,v.last_cascade_blur_radius=d.last_cascade_blur_radius,
v.fade_last_cascade=!1,v.blend_between_cascades=!1);e.Qh=[];for(d=0;d<c.length;d++)c[d].e&&c[d].e.ag&&e.Qh.push(c[d]);v=b.world.b4w_fog_color;G=b.world.b4w_fog_density;d=x(b);e.uc=new Float32Array([v[0],v[1],v[2],G]);e.Ag=n(b);e.Uk=D(b,e.Ag);e.Go=r(b,e.Uk);e.mz=Z(b,"LAMP",a.DATA_ID_ALL).length;e.fb=t(b);e.yz=d;e.Ce=O(b);e.ev=B(b);e.Hr=0;h.I[0].type!=mb.Hb&&Fa.anaglyph_use?(Wa.warn("Anaglyph stereo is disabled for the non-perspective camera"),v=!1):v=Fa.anaglyph_use;e.anaglyph_use=v;e.On=Fa.ni&&k(b);
e.VD=b.world.b4w_fog_color;e.shore_smoothing=f(b);e.eB=l(b);e.zb=z(b);e.Pv=H(b);e.Bz=u(b);e.$v=y(b);e.Ny=q(b);e.Oz=w(b);e.Te=m(b);e.Wg=Fa.Wg&&(0<h.dof_distance||h.de);e.wb=E(b);e.ph=Fa.ph&&b.b4w_enable_motion_blur;e.Sg=Fa.Sg&&b.b4w_enable_color_correction;e.antialiasing=Fa.antialiasing&&b.b4w_enable_antialiasing;e.Og=Fa.Og&&b.b4w_enable_bloom&&e.Ag;e.xe=Fa.xe&&b.b4w_enable_ssao;e.uB=A(b);e.bh=Fa.bh&&b.b4w_enable_god_rays&&e.Ag;e.fc=L(b,d);e.qx=Fa.ni;e.rw=I(b);e.outline=F(b);e.Se=M(b);e.Mm=b.world.b4w_render_glow_over_blend;
switch(b.b4w_reflection_quality){case "LOW":e.Nf=Ub.Vp;e.Ri=Ub.ds;break;case "MEDIUM":e.Nf=Ub.fx;e.Ri=Ub.Uz;break;case "HIGH":e.Nf=Ub.ex;e.Ri=Ub.Tz;break;default:e.Nf=Ub.Vp,e.Ri=Ub.ds}d=b.od.sort(function(a,b){return b.e.yg-a.e.yg});e.ib=ka.Sw(e,h,d);e.ug=[];e.tk=!1;e.wn=!1;Ba.push(b);fb||(fb=Ca.create());Ca.u(fb,b)};a.Xl=g;a.Jm=function(a){return a.e.ib};a.Vx=function(a){Ca.R(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=ja.Tp(c.Gk);break;case "SSAO":d=ja.Yw(c);break;case "SSAO_BLUR":d=
ja.Zw(c);break;case "DEPTH_PACK":d=ja.Hw();break;case "REFRACT":case "COPY":d=ja.Tp("NONE");break;case "GOD_RAYS":ka.Fa(a,c,"WIREFRAME")||ka.Fa(a,c,"MAIN_BLEND")||ka.Fa(a,c,"GOD_RAYS");d=ja.Lw(c.$r,c.uf,c.Hh);break;case "GOD_RAYS_COMBINE":ka.Fa(a,c,"WIREFRAME")||ka.Fa(a,c,"MAIN_BLEND");ka.Fa(a,c,"GOD_RAYS");d=ja.Mw();break;case "MOTION_BLUR":d=ja.Pw();break;case "DOF":var d=ja.Iw(),f=ka.Fa(a,c,"POSTPROCESSING"),e=ka.Fa(a,f,"POSTPROCESSING");ka.Nb(f,c.j.dof_power);ka.Nb(e,c.j.dof_power);break;case "OUTLINE":var d=
ja.Qw(),f=ka.Fa(a,c,"POSTPROCESSING"),e=ka.Fa(a,f,"POSTPROCESSING"),h=ka.Fa(a,e,"POSTPROCESSING"),g=ka.Fa(a,h,"POSTPROCESSING");ka.Nb(e,c.Hl);ka.Nb(f,c.Hl);ka.Nb(g,c.tm*c.Li);ka.Nb(h,c.tm*c.Li);break;case "GLOW_COMBINE":d=ja.Kw();break;case "COMPOSITING":d=ja.Fw();break;case "ANTIALIASING":d=ja.Bw();break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=ja.Ww(c.type);break;case "ANAGLYPH":d=ja.zw();break;case "SKY":d=ja.Rw();
break;case "LUMINANCE":d=ja.Nw();break;case "AVERAGE_LUMINANCE":d=ja.Cw();break;case "LUMINANCE_TRUNCED":d=ja.Ow();break;case "BLOOM_BLUR":d=ja.Dw();break;case "BLOOM":d=ka.Fa(a,c,"BLOOM_BLUR");f=ka.Fa(a,d,"BLOOM_BLUR");ka.Nb(d,c.bloom_blur);ka.Nb(f,c.bloom_blur);d=ja.Ew();break;case "VELOCITY":d=ja.bx();break;case "ANCHOR_VISIBILITY":d=ja.Aw()}d&&(f=K(jb.Oj("NONE"),d),la(d),c.q.push(f),J(a,c,d),U(d))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":var d=a.e.ib,f=b.e;!ka.Ga(d,"SHADOW_CAST")&&
f.ic&&(f.ic=!1);f=ba(a,va);c&&(uc.has_physics(b)&&uc.append_object(b,a),a.sa.ALL.push(b),a.sa[b.type].push(b),b.ya&&b.ya.dupli_group.objects&&(b.origin_name=b.name,b.ya.dupli_group.objects.push(b)));for(var e=0;e<f.length;e++)P(f[e],b,d,a,c);break;case "LAMP":b.ra.index=a.e.Hr++;c=ba(a,Ga);for(d=0;d<c.length;d++)c[d].mg++;Y(b,a)}};a.remove_object=function(a){if(!a.e.Zm)return!1;var c=b();vd.aA(c,a,!1);var d=c.sa.ALL.indexOf(a);-1!=d&&c.sa.ALL.splice(d,1);d=c.sa[a.type].indexOf(a);-1!=d&&c.sa[a.type].splice(d,
1);a.ya&&a.ya.dupli_group.objects&&(d=a.ya.dupli_group.objects.indexOf(a),-1!=d&&a.ya.dupli_group.objects.splice(d,1));Rc.ew(a)&&Rc.remove(a);return!0};a.gD=P;a.Qn=function(a){a.e.tk=!0};a.ry=function(a,b){for(var c=a.e.ue,d=new Float32Array(c.csm_num),f=0;f<c.csm_num;f++)d[f]=mb.dx(c,b,f);return d};a.hide_object=function(a){a.e.fh=!0};a.show_object=function(a){a.e.fh=!1};a.is_hidden=function(a){return a.e.fh};a.kA=function(a,b,c){b=b.e;a=ba(a,va);for(var d=0;d<a.length;d++)for(var f=a[d].q,e=f.length-
1;0<=e;e--){var h=f[e];h.cd==b&&(h.B&&c&&Sc.Fp(h.B.T),f.splice(e,1))}};a.check_object=function(a,b){return b.sa[a.type]&&-1<b.sa[a.type].indexOf(a)?!0:!1};a.hB=function(a){var b=a.sa.LAMP;if(b.length==a.e.Hr){for(var c=[],d=0;d<b.length;d++)c[b[d].ra.index]=d;for(d=0;d<c.length-1;d++)for(var f=d+1;f<c.length;f++){var e=b[c[d]].ra,h=b[c[f]].ra;if(h.Dg&&h.rf&&(!e.Dg||!e.rf)||!e.Dg&&(h.Dg||!e.rf&&h.rf))e=c[d],c[d]=c[f],c[f]=e}for(d=0;d<c.length;d++)b[c[d]].ra.index=d,Y(b[c[d]],a)}};a.Bg=Y;a.cleanup=
function(){for(var a=0;a<Ba.length;a++){var b=Ba[a];Ca.R(b.e.ib,function(a,b){if("SINK"!=b.type){var c=b.j;pc.nA(c.he,c.hb,c.Pc,c.width,c.height);for(var c=b.q,d=0;d<c.length;d++){var f=c[d].B;f&&ja.qw(f)}}});b.e.ib=[];b.e.ug=[]}Qa=lb=null;Ba.length=0;fb=null;Ma.length=0;Ua[0]=0;Ua[1]=0;Ua[2]=0};a.wr=function(a,b,c){a=mb.Hx(a,a.Ua,a.Sa,null,!0);var d=vb.$x(a);a=jb.Oj("DYNAMIC");a.gb=a.Pb={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.vb=a.Yc=wa.Mv();var f=a.vb.Da;a.Ff=a.Ef=
wa.am([f,0,0],[0,f,0],[0,0,f],a.vb.F);c=ja.Vw(d,c);b.q.push(K(a,c))};a.Ia=Z;a.iE=function(a){return[a.frame_start,a.frame_end]};a.Ds=function(a,b,c){Za.YA(a,b,c);Qa&&W(Qa,a,b)};a.CB=ba;a.Z=ma;a.get_environment_colors=function(a){a=ba(a,Ga)[0];var b=a.Ue,c=a.xf,d=[],f=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];f[0]=c[0];f[1]=c[1];f[2]=c[2];return[a.Qe,d,f]};a.set_environment_colors=function(a,b,c,d){a=ba(a,Ga);for(var f=0;f<a.length;f++){var e=a[f];isNaN(b)||(e.Qe=b);c&&e.Ue.set(c);d&&e.xf.set(d);e.na=!0}};
a.get_sky_params=function(a){if(a=ma(a,"SKY")){var b={};b.color=Array(3);Eb.copy(a.Bh,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;
b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=ma(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.Bh.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),
"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&
(c.mie_distribution=b.mie_distribution),c.na=!0,c.sk=!0,ea(a,c))};a.get_fog_color_density=function(a,b){var c=b||[],d=ba(a,$a)[0].uc;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=ba(a,$a),d=0;d<c.length;d++){var f=c[d];f.uc.set(b);f.na=!0}};a.get_ssao_params=function(a){var b=ma(a,"SSAO");a=ma(a,"SSAO_BLUR");if(!b)return null;var c=b.q[0].B,d={};d.ssao_quality=ja.xb(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;
d.pp=a.ssao_blur_discard_value;d.radius_increase=b.Eh;d.influence=b.Dh;d.dist_factor=b.Ch;d.ssao_only=b.ssao_only;d.ssao_white=ja.xb(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=ma(a,"SSAO"),d=ma(a,"SSAO_BLUR");if(!c)return Wa.error("SSAO is not enabled on the scene"),0;if("string"==typeof b.ssao_quality){var f=c.q[0].B;ja.oa(f,"SSAO_QUALITY",b.ssao_quality);ja.jb(f,!0)}"number"==typeof b.ssao_hemisphere&&(f=c.q[0].B,ja.oa(f,"SSAO_HEMISPHERE",b.ssao_hemisphere),ja.jb(f,!0));
"number"==typeof b.ssao_blur_depth&&(f=d.q[0].B,ja.oa(f,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),ja.jb(f,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.Eh&&(c.Eh=b.Eh);"number"==typeof b.Dh&&(c.Dh=b.Dh);"number"==typeof b.Ch&&(c.Ch=b.Ch);if("number"==typeof b.ssao_only){c=ma(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var e=0;e<c.q.length;e++)f=c.q[e].B,ja.oa(f,"SSAO_ONLY",b.ssao_only),ja.jb(f,!0)}"number"==typeof b.ssao_white&&
(f=c.q[0].B,ja.oa(f,"SSAO_WHITE",b.ssao_white),ja.jb(f,!0));c.na=!0;d.na=!0};a.get_dof_params=function(a){a=ma(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.j.dof_distance;b.dof_front=a.j.dof_front;b.dof_rear=a.j.dof_rear;b.dof_power=a.j.dof_power;b.de=a.j.de;return b};a.set_dof_params=fa;a.get_god_rays_params=function(a){var b=ba(a,["GOD_RAYS"]);a=ma(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].mh;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=
ja.xb(b[0].q[0].B,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=ba(a,["GOD_RAYS"]),d=ma(a,"GOD_RAYS_COMBINE");if(!c||!d)return Wa.error("God Rays are not enabled on the scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var f=b.god_rays_max_ray_length,e=0;e<c.length;e++)c[e].mh=f,c[e].Kk=f/c[e].Hh/(e+1),c[e].na=!0;if("number"==typeof b.god_rays_steps)for(var h=na.t(b.god_rays_steps,
1),f=c[0].mh,e=0;e<c.length;e++){c[e].Hh=h;c[e].Kk=f/h/(e+1);c[e].na=!0;var g=c[e].q[0].B;ja.oa(g,"STEPS_PER_PASS",h);ja.jb(g,!0)}d.na=!0};a.get_bloom_params=function(a){var b=ma(a,"LUMINANCE_TRUNCED");a=ma(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=da;a.get_glow_material_params=function(a){a=ma(a,"GLOW_COMBINE");if(!a)return null;var b={};b.small_glow_mask_coeff=a.small_glow_mask_coeff;
b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b};a.set_glow_material_params=aa;a.get_wind_params=function(){var a=Ua,b=Eb.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.set_wind_params=function(b,c){for(var d=Z(b,"ALL",a.DATA_ID_ALL),f=0;f<d.length;f++){var e=d[f];if("EMPTY"===e.type&&e.field&&"WIND"===e.field.type)var h=e}if(!h)return Wa.error("There is no wind on the scene"),
0;d=h.e;"number"==typeof c.wind_dir&&(ya=[0,c.wind_dir/180*Math.PI,-Math.PI/2],Ra.euler_to_quat(ya,Gb),d.quat.set(Gb),ec(h));"number"==typeof c.wind_strength&&(d.Bm=c.wind_strength,ec(h));Ha(b)};a.AA=function(a){a.e.wn=!0};a.get_water_surface_level=v;a.get_water_mat_params=function(a,b){var c=ma(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.wf,b.waves_length=c.Hg,c.md)){b.water_fog_density=c.md[3];var d=b.water_fog_color=[];d[0]=c.md[0];d[1]=c.md[1];d[2]=c.md[2]}};a.set_water_params=function(a,b){var c=
ma(a,"MAIN_OPAQUE");if(!c||!c.fb)return Wa.error("set_water_params() - no water parameters on the scene"),null;c=c.fb;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==
typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.qi=b.water_dynamic);for(var d=ba(a,Sa),f=0;f<d.length;f++){var e=d[f];
"number"==typeof b.water_fog_density&&c.uc&&(e.md[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.uc&&e.md.set(b.water_fog_color);"number"==typeof b.waves_height&&(e.wf=b.waves_height);"number"==typeof b.waves_length&&(e.Hg=b.waves_length);e.na=!0}};a.get_shore_dist=function(a,b){var c=ma(Qa,"MAIN_OPAQUE");if(!c.cl)return 100;var d=c.nh,f=c.vf,e=(a[0]-c.jf[0])/c.kf[0],h=(c.jf[1]+a[2])/c.kf[1],e=e+.5,h=h+.5;if(1<e||0>e||1<h||0>h)f=1;else return c=d*Ra.Bq(Qa.e.Rn,c.Ah,e,h),f=(f-a[1])*
b,f=Math.sqrt(c*c+f*f)};a.update=function(a,c){for(var d=b().camera.e,f=0;f<Ba.length;f++){var e=Ba[f],h=e.e.ib;if(e.e.fb)var g=d.h[1]-v(d.h[0],d.h[2]);for(var k=e.e.Qh,l=0;l<k.length;l++){var m=k[l].e,n=m.Oa,q=m.Zg+m.ma;if(n){var r=Math.round(n.currentTime*m.$b),t=m.ma/m.$b;if(r<m.ma-(Fa.$f?5:0)||k[l].e.Cg&&r>q)n.currentTime=t;!m.Cg&&r>q&&n.pause();2<=n.readyState&&!n.paused&&Tb.lC(m)}else if(m.xh){n=Math.min(m.xh.length,m.Zg+m.ma);if(m.te<m.ma||m.Cg&&m.te>=n)m.te=m.ma;!m.Cg&&m.te>=n&&(m.yh=!1);
n=Math.round(a*Wb.Ha/m.$b)*m.ys;n!=Xb&&m.yh&&(Tb.iC(m),m.te++);Xb=n}}Ca.R(h,function(b,c){-1<Oa.indexOf(c.type)&&(c.time=a);e.e.fb&&(c.Pl=g)})}for(f=0;f<Ba.length;f++)if(e=Ba[f],l=e.e,d=l.ug,l.tk&&(S(e),l.tk=!1),l.wn&&(N(e),l.wn=!1),d.length){e.b4w_enable_motion_blur&&ta(l.ib,c);if(l.outline){for(var C=0,f=0;f<e.sa.MESH.length;f++)l=e.sa.MESH[f],C+=l.e.dd,-1!=Ma.indexOf(l)&&ca(l,a);Ca.R(e.e.ib,function(a,b){"OUTLINE"===b.type&&(b.nm=C)})}h=null;for(l=0;l<d.length;l++)"OUTLINE_MASK"==d[l].type&&(h=
l);for(l=0;l<d.length;l++)k=d[l],kb.Gn(k),null!==h&&G(k,d[h]),pc.pi(k)}Fa.show_hud_debug_info&&nb.bB(Ba,c)};a.Hm=function(a){var b=[];Ca.R(a.e.ib,function(a,c){b.push(c)});return b};a.apply_outline_anim=function(a,b,c,d){a.av={no:0,Lr:b,Tc:c,rs:d};-1==Ma.indexOf(a)&&Ma.push(a)};a.clear_outline_anim=function(a){a.e.dd=0;a=Ma.indexOf(a);-1!=a&&Ma.splice(a,1)};a.zD=function(){Ma=[]};a.get_cam_water_depth=function(){var a=ma(Qa,"MAIN_BLEND"),b=Qa;return a||b.e.fb?a.Pl:null};a.get_object_data_id=function(a){return a.e.rc};
a.ot=Ha;a.WA=function(a,b){switch(b){case "WM_NONE":a.Ra=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.q.length;c++)a.q[c].B.wireframe_mode=qd.Qo[b];a.Ra=!0}a.Ca="WM_TRANSPARENT_WIREFRAME"==b;a.na=!0};a.VA=function(a,b){for(var c=0;c<a.q.length;c++)a.q[c].B.wireframe_edge_color=b,a.na=!0};a.$o=function(a,b){for(var c=0;c<b.length;c++)a.sa.ALL.push(b[c]),a.sa.MESH.push(b[c])};a.lt=ec;a.pick_object=function(b,d){var f=
c();if(!f)return Wa.error("No active scene"),null;var e=ma(f,"COLOR_PICKING");if(e){var h=Za.Ql(b,d,Aa,e.j);kb.Gn(e);pc.pi(e);var g=ma(f,"COLOR_PICKING_XRAY");g?(kb.Gn(g),pc.pi(g),e=g.j):e=e.j;h[1]=e.height-h[1];g=pc.ps(e.he,h[0],h[1]);h=Z(f,"MESH",a.DATA_ID_ALL);for(e=0;e<h.length;e++){var v=h[e].e,k=v.Mj;if(k&&3>Math.abs(255*k[0]-g[0])&&3>Math.abs(255*k[1]-g[1])&&3>Math.abs(255*k[2]-g[2]))return v.Fb&&v.Kr&&(Vb.outlining_overview_mode?(ub(Vb.bf),v.dd=Vb.dd,a.apply_outline_anim(h[e],Vb.yk,Vb.zk,
Vb.Ak)):(ub(f.b4w_outline_color),v.dd=f.b4w_outline_factor,f=v.Ki,a.apply_outline_anim(h[e],f.yk,f.zk,f.Ak))),h[e]}}else Wa.error("Object Selection is not available on the scene");return null};a.set_outline_color=ub;a.My=function(){return Ua};a.Dy=function(b){var c=[];b=Z(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var f=b[d];f.e.xg&&c.push(f)}return c};a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};
a.RB=function(){for(var b=Qa,c=Z(b,"MESH",a.DATA_ID_ALL),d=0;d<c.length;d++)for(var f=c[d].o,e=0;e<f.length;e++){var h=f[e];"MAIN"==h.type&&(X(b,h),ja.jb(h))}};a.kt=function(a,b){var c=b.e.vb.F,d=a.e.zb?a.e.zb.Qj[b.e.pc]:null;if(d){var f=ya;Eb.negate(c,f);for(c=0;6>c;c++){var e=d.ki[c],h=d.em[c],g=d.j;zb.translate(Ra.Ht[c],f,e);zb.multiply(g.ta,e,g.Jd);Ra.um(g.Jd,h)}}};a.Gv=function(a,b){b.e.zb&&(a.e.ec=b.e.zb.Si[a.e.zc].j.ec)};a.nt=function(a,b){var c=b.e.zb.Mk[a],d=b.e.zb.Si[a].j;Ra.MB(c.e.h,c.e.quat,
Ra.AXIS_Y,d.ec);mb.UA(d,b.camera)};a.marker_frame=function(a,b){return a.timeline_markers[b]}};b4w.module.__physics=function(a,p){function c(a,b){for(var d=a.Mc,f=0;f<d.length;f++)d[f].e.al&&b.push(d[f]),c(d[f],b)}function d(a,b){for(var c=a.n.q,d=0;d<c.length;d++)for(var f=c[d].Wa,e=0;e<f.Zb.length;e++){var h=f.Zb[e];"ANY"!=h.Qa&&b!=h.Qa||u(h)}}function b(a,b){if(ga)switch(a){case B.Qt:ga.n.Dt=!0;B.w(B.xu,Date.now()-performance.now(),U.bd,U.Nl?pa.sq:0);break;case B.Rt:L.nn("URANIUM:",b.slice(1));break;case B.Mt:L.error(b);break;case B.Nt:O.fbmsg.apply(this,b.slice(1));break;case B.Wt:var c=
e(b.H);if(c){var d=b.h,f=b.quat,h=b.yd,k=b.pd,c=c.n;c.fm=b.time;P.set_sep(d,1,f,c.gm);Q.copy(h,c.yd);Q.copy(k,c.pd)}break;case B.Tt:(d=e(b.Rl))&&P.set_sep(b.h,1,b.quat,d.l.Vi[b.Hn]);break;case B.Ot:if(f=e(b[1]))d=b[4],f=f.Nc.Gj[b[2]],K.set_translation(f,b[3]),K.set_rotation(f,d),K.v(f);break;case B.Xt:if(c=e(b[1]))c.l.speed=b[2];break;case B.It:g(ga,b.Gf,b.Hf,b.result,null,null,0);break;case B.Kt:g(ga,b.Gf,b.Hf,b.result,b.Lf,b.coll_norm,b.coll_dist);break;case B.Jt:if(c=e(b[1]))d=c.n,d.Kf&&d.Kf(b[2]);
break;case B.Lo:case B.Ut:if(d=ga.n.th[b.id])if(f=e(b.Pg),a==B.Lo)h=d.callback,h(d.id,b.hit_fract,f,b.hit_time);else{var h=b.hit_fract,k=b.hit_time,c=b.hit_pos,l=d.callback;c?l(d.id,h,f,k,c,b.hit_norm):l(d.id,h,f,k)}break;case B.Vt:w(id);break;case B.St:console.log("Physics Ping: OUT "+(b[2]-b[1]).toFixed(3)+" ms, IN "+(performance.now()-b[2]).toFixed(3)+" ms, ALL "+(performance.now()-b[1]).toFixed(3)+" ms");break;case B.Pt:S=b[1];break;case B.Lt:console.log(b[1]);break;default:L.error("Wrong message: "+
a)}}function e(a){return ha[a]||null}function g(a,b,c,d,f,g,k){a=a.n.q;for(var l=0;l<a.length;l++)for(var m=a[l].Wa,n=0;n<m.Zb.length;n++){for(var q=m.Zb[n],r=q.cf,t=!1,C=0;C<r.length;C++){var x=r[C];if(x[0]===b&&x[1]===c){q.Mi[C]=d;t=!0;break}}t&&(r=h(q),f&&q.Il!=b&&(t=f,C=g,x=k,t[0]+=C[0]*x,t[1]+=C[1]*x,t[2]+=C[2]*x,C[0]*=-1,C[1]*=-1,C[2]*=-1),q.callback(r,r?q.Il==b?e(c):e(b):null,f,g,k))}}function h(a){a=a.Mi;for(var b=!1,c=0;c<a.length;c++)b=b||a[c];return b}function k(){Z.body++;return Z.body}
function n(a){if("ANY"==a)return 0;var b=ea.indexOf(a);return-1==b?(ea.push(a),ea.length-1):b}function f(a){return{H:a,pn:0,kk:!1,lf:!0,CE:!1,is_character:!1,cz:!1,Nj:null,Qa:"",gi:0,BD:{},Zb:[],Kf:null,fm:0,gm:new Float32Array([0,0,0,1,0,0,0,1]),yd:new Float32Array(3),pd:new Float32Array(3),Kj:new Float32Array(3),Jj:new Float32Array(4)}}function l(a,b){switch(a){case "BOX":var c=b.Pb;break;case "CYLINDER":c=b.Dl;break;case "CONE":c=b.Cl;break;case "SPHERE":c=b.Yc;break;case "CAPSULE":c=b.Bl}return c}
function t(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.F&&(b.center=a.F);"number"===typeof a.Da&&(b.radius=a.Da);"number"===typeof a.height&&(b.height=a.height);return b}function x(a,b,c,d){var f=a.e.h,e=b.e.V,h=new Float32Array(16);
la.invert(e,h);e=new Float32Array(3);Q.transformMat4(f,h,e);switch(b.l.type){case 10:b=b.b4w_vehicle_settings;a=a.e.Pb;B.w(B.au,c,e,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:B.w(B.$t,c,e,a.fF)}}function z(a){return a.n&&a.n.Nj?!0:!1}function D(a,b,c,d,f,e,h,g,k,l){var m;Z.Lp++;m=Z.Lp.toString(16);B.w(B.hu,m,a,g,b.n.H,c,d,f.n.H,e,h,k,l);b.n.Nj=m}function A(a){var b=a.n;if(b&&(0===b.pn||!0===b.kk||!1===b.lf||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.e.h[0]!=
a.n.Kj[0]||a.e.h[1]!=a.n.Kj[1]||a.e.h[2]!=a.n.Kj[2]||a.e.quat[0]!=a.n.Jj[0]||a.e.quat[1]!=a.n.Jj[1]||a.e.quat[2]!=a.n.Jj[2])){var b=a.n,c=a.e;Q.copy(c.h,b.Kj);X.copy(c.quat,b.Jj);var d=B.Iq(B.rj);d.H=b.H;d.h=c.h;"DYNAMIC"==b.type?X.identity(d.quat):d.quat=c.quat;B.w(B.rj)}a=a.Mc;for(b=0;b<a.length;b++)A(a[b])}function H(a,b,c,d,f){f=f||new Float32Array(3);a=a.e.quat;f[0]=b;f[1]=c;f[2]=d;Q.transformQuat(f,a,f)}function u(a){var b=a.cf,c=a.Mi,d=a.Il,f=[],e=a.Qa,h=ga;if(!f)throw"At least one destination required";
for(var g=0;g<h.n.q.length;g++){var k=h.n.q[g];if("ANY"==e||k.Wa.Qa==e)k=k.Wa.H,f&&-1==f.indexOf(k)&&f.push(k)}for(e=0;e<f.length;e++)h=f[e],d<h&&!y(b,d,h)?(b.push([d,h]),c.push(!1)):d>h&&!y(b,h,d)&&(b.push([h,d]),c.push(!1));B.w(B.Zt,d);B.w(B.gu,b,a.rd)}function y(a,b,c){for(var d=0;d<a.length;d++)if(a[d][0]==b&&a[d][1]==c)return!0;return!1}function q(a){a.n&&a.n.Kf&&(a=a.n,B.w(B.tu,a.H),a.Kf=null)}function w(a){var b=ga.n;b.th[a]&&(delete b.th[a],b.Mn.splice(b.Mn.indexOf,1),B.w(B.Cu,a))}function m(a,
b){if(b.Gh){var c=a.n.H,d=b.Xg*b.rq,f=b.di*b.rp,e=-b.Fh*b.co*2*Math.PI/b.Ws;b.er&&(e*=-1);switch(b.type){case 10:B.w(B.Pu,c,d,f,e);break;case 20:B.w(B.Ou,c,d,f,e)}}}function r(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function E(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function I(a){return a.b4w_character?!0:!1}function F(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}var M=p("__config");p("__constraints");var L=p("__print"),
O=p("__debug"),B=p("__ipc");p("__renderer");var J=p("__scenes"),K=p("__transform"),P=p("__tsr"),R=p("__util"),T=p("__version"),Q=p("vec3"),X=p("quat"),la=p("mat4"),U=M.Wa,pa=M.p,S=0,qa=null,ga=null,ha={},Y=[],ea=[],Z={body:0,Lp:0,ms:0},C=new Float32Array(3),W=new Float32Array(4),ba=new Float32Array(4),ma=new Float32Array(16),fa=new Float32Array(8),da=new Float32Array(8);a.Xy=function(a){if(ga)L.warn("Multiple physics scenes are currently not supported");else{a.n={Dt:!1,q:[],th:{},Mn:[]};var c=U.gj+
T.timestamp();L.log("%cLOAD PHYSICS","color: #0a0",c,"Max FPS: "+U.bd);qa=new Worker(c);B.init(qa,b);ga=a;U.ping&&setInterval(function(){B.w(B.zu,performance.now())},1E3)}};a.lw=function(a){return a.n?a.n.Dt:!0};a.cleanup=function(){if(ga){qa.terminate();ga=qa=null;ha={};Y.length=0;ea.length=0;for(var a in Z)Z[a]=0}};a.append_object=function(a,b){var e=a.e;if(!e)throw"No object render: "+a.name;if(a.parent&&e.al)return null;var h=[];e.al&&c(a,h);var g=b.n.q;if(r(a)||E(a)||I(a)||F(a)||a.b4w_collision){var q,
C=a,w=e.cs,u=C.e,p=C.game,W=k();if("CAMERA"==C.type)var y=p.use_collision_bounds?p.collision_bounds_type:"BOX",A=l(y,u),K=u.wi,H=u.ri,K=.5,H=0;else"EMPTY"==C.type?(y="EMPTY",A=null,H=K=0):(y=p.use_collision_bounds?p.collision_bounds_type:"BOX",A=l(y,u),K=u.wi,H=u.ri);var P=u.h,fa=u.quat,da=p.use_ghost,M=p.use_sleep,T=p.mass,O=p.velocity_min,S=p.velocity_max,oc=p.damping,U=p.rotation_damping,Z=C.b4w_collision_id,ea=n(Z),pa=p.collision_margin,qa=p.collision_group,pc=p.collision_mask,ka=u.Yc.Da,Mc=t(A),
na=C.b4w_correct_bounding_offset,Tb;var Ra=y;if(h.length){var Eb=[],zb={};zb.quat=new Float32Array([0,0,0,1]);zb.trans=new Float32Array(3);zb.worker_bounding=Mc;zb.bounding_type=Ra;Eb.push(zb);la.invert(u.V,ma);X.invert(u.quat,ba);for(var Fa=0;Fa<h.length;Fa++){var Vb={},Ub=h[Fa],Wb=Ub.game.collision_bounds_type,Nc=new Float32Array(4),Cc=new Float32Array(3);Q.transformMat4(Ub.e.h,ma,Cc);X.multiply(ba,Ub.e.quat,Nc);Vb.trans=Cc;Vb.quat=Nc;Vb.bounding_type=Wb;Vb.worker_bounding=t(l(Wb,Ub.e));Eb.push(Vb)}Tb=
Eb}else Tb=[];B.w(B.du,W,P,fa,w,da,M,T,O,S,oc,U,ea,pa,qa,pc,y,Mc,ka,K,H,Tb,na);ha[W]=C;Y.push(C);var va=f(W);va.type=w;va.pn=T;va.kk=da;va.Qa=Z;va.gi=ea;q=va;a.n=q;var Ga={B:null,Wa:q};g.push(Ga);d(b,q.Qa)}else for(var $a=a.o||[],Oa=0;Oa<$a.length;Oa++){var Sa=$a[Oa],Xb;if(Xb="PHYSICS"==Sa.type){var lb;a:{for(var Qa=b.n.q,Ba=0;Ba<Qa.length;Ba++){var fb=Qa[Ba].B;if(fb&&fb.id==Sa.id){lb=!0;break a}}lb=!1}Xb=!lb}if(Xb)if(Sa.Gc.L)if(Sa.uf&&b.e.fb){var Ma=Sa,La=ga,Aa=J.Z(La,"MAIN_OPAQUE");B.w(B.mu,Aa.vf);
if(Aa.fb&&Ma.HC){var ya={};ya.dst_noise_scale0=Ma.dst_noise_scale0;ya.dst_noise_scale1=Ma.dst_noise_scale1;ya.dst_noise_freq0=Ma.dst_noise_freq0;ya.dst_noise_freq1=Ma.dst_noise_freq1;ya.dir_min_shore_fac=Ma.dir_min_shore_fac;ya.dir_freq=Ma.dir_freq;ya.dir_noise_scale=Ma.dir_noise_scale;ya.dir_noise_freq=Ma.dir_noise_freq;ya.dir_min_noise_fac=Ma.dir_min_noise_fac;ya.dst_min_fac=Ma.dst_min_fac;ya.waves_hor_fac=Ma.waves_hor_fac;var ra=Aa.wf,Gb=Aa.Hg;Aa.cl?B.w(B.No,ya,Aa.kf[0],Aa.kf[1],Aa.jf[0],Aa.jf[1],
Aa.nh,ra,Gb,Aa.Ah,La.e.Rn):B.w(B.No,ya,0,0,0,0,0,ra,Gb,0,null)}}else{var Hb;if(Sa.pC){var xa=a,Yb=Sa,V=k(),Qb=Yb.Gc,Ua=Qb.A[0].a_position,za=Qb.ea||null,ua=Yb.Qa,Zb=n(ua);B.w(B.ju,V,Ua,za,xa.e.h,Zb,Yb.Ip,Yb.Hp,Yb.Jp);var qc=f(V);qc.kk=!0;qc.Qa=ua;qc.gi=Zb;Hb=qc}else{var ob=a,Pa=Sa,rb=k(),Ia=Pa.Gc,gb=Ia.A[0].a_position,jc=Ia.ea||null,Ib=ob.e.h,Xa=Pa.wi,Jb=Pa.ri,Dc=Pa.Qa,Kb=n(Dc);B.w(B.lu,rb,gb,jc,Ib,Xa,Jb,Kb,Pa.Ip,Pa.Hp,Pa.Jp);var Ec=f(rb);Ec.Qa=Dc;Ec.gi=Kb;Hb=Ec}q=Hb;Ga={B:Sa,Wa:q};g.push(Ga);d(b,
q.Qa)}else L.error("Object "+a.name+" has collision material with no assigned vertices")}if(r(a)||E(a)){var Ta=a,ab=Ta.n.H;r(Ta)?(Ta.l.type=10,B.w(B.eu,ab,Ta.l.FB,Ta.l.HB,Ta.l.GB,Ta.l.JC,Ta.l.Az)):E(Ta)&&(Ta.l.type=20,B.w(B.cu,ab,Ta.l.ym,Ta.l.Co,Ta.l.Do));if(Ta.l.tg){var pb=Ta.l.tg;switch(Ta.l.type){case 10:x(pb[1],Ta,ab,!0);x(pb[0],Ta,ab,!0);x(pb[3],Ta,ab,!1);x(pb[2],Ta,ab,!1);break;case 20:for(var Rb=0;Rb<pb.length;Rb++)x(pb[Rb],Ta,ab,!1)}}m(a,a.l)}else if(I(a)){var bb=a.e,Sb=a.n,Fb=bb.Pb.max_y-
bb.Pb.min_y,kc=Sb.H,sa=a.b4w_character_settings,cb=sa.walk_speed,qb=sa.run_speed,$b=sa.step_height,Ea=sa.jump_strength,vc=sa.waterline,Lb=R.tx(a);B.w(B.fu,kc,Lb,Fb,cb,qb,$b,Ea,vc);Sb.is_character=!0}else if(F(a)){var db=a,hb=db.n.H;B.w(B.iu,hb,db.Nc.ym,db.Nc.Co,db.Nc.Do);if(db.Nc.Gj)for(var rc=db.Nc.Gj,Ab=0;Ab<rc.length;Ab++){var fc=rc[Ab],sb=fc.e.h,ib=db.e.V,Bb=new Float32Array(16);la.invert(ib,Bb);var lc=new Float32Array(3);Q.transformMat4(sb,Bb,lc);B.w(B.bu,hb,lc,fc.Rv)}db.n.cz=!0}for(Oa=0;Oa<
Y.length;Oa++)if(a=Y[Oa],a.n){var tb=a;if(!z(tb))for(var ac=0;ac<tb.constraints.length;ac++){var wb=tb.constraints[ac],bc=wb.target,Cb=wb.pivot_type;if("RIGID_BODY_JOINT"==wb.type&&bc.n){var Mb=new Float32Array([wb.pivot_x,wb.pivot_y,wb.pivot_z]),wc,Db=new Float32Array([wb.axis_x,wb.axis_y,wb.axis_z]);wc=R.euler_to_quat(Db,new Float32Array(4));var Da=la.fromRotationTranslation(wc,Mb,new Float32Array(16)),Oc=la.multiply(tb.e.V,Da,new Float32Array(16)),xc=la.invert(bc.e.V,new Float32Array(16)),Nb=la.multiply(xc,
Oc,xc),mc=R.lh(Nb),Fc=R.matrix_to_quat(Nb),Ja=wb,Va={};Va.use_limit_x=Ja.use_limit_x;Va.use_limit_y=Ja.use_limit_y;Va.use_limit_z=Ja.use_limit_z;Va.use_angular_limit_x=Ja.use_angular_limit_x;Va.use_angular_limit_y=Ja.use_angular_limit_y;Va.use_angular_limit_z=Ja.use_angular_limit_z;Va.limit_max_x=Ja.limit_max_x;Va.limit_min_x=Ja.limit_min_x;Va.limit_max_y=Ja.limit_max_y;Va.limit_min_y=Ja.limit_min_y;Va.limit_max_z=Ja.limit_max_z;Va.limit_min_z=Ja.limit_min_z;Va.limit_angle_max_x=Ja.limit_angle_max_x;
Va.limit_angle_min_x=Ja.limit_angle_min_x;Va.limit_angle_max_y=Ja.limit_angle_max_y;Va.limit_angle_min_y=Ja.limit_angle_min_y;Va.limit_angle_max_z=Ja.limit_angle_max_z;Va.limit_angle_min_z=Ja.limit_angle_min_z;D(Cb,tb,Mb,wc,bc,mc,Fc,Va,null,null)}}}};a.Lx=e;a.update=function(){for(var a=0;a<Y.length;a++){var b=Y[a],c=b.n;if(c.lf&&c.fm){var d=performance.now()/1E3-c.fm,d=Math.min(d,10/U.bd),d=d-1/U.bd;pa.Gz&&(d=0);var f=fa;P.Yy(c.gm,d,c.yd,c.pd,fa);K.SA(b,f);K.v(b);A(b);if(b.l)for(var c=b,d=c.l.tg,
f=c.e.Bb,e=fa,h=0;h<d.length;h++){var g=d[h];P.multiply(f,c.l.Vi[h],e);K.set_tsr(g,e);K.v(g)}b.l&&b.l.Gh&&(c=b.l,d=c.Gh)&&(f=b.l.Xs,g=ma,e=b.e.h,h=b.e.quat,R.ro(b.l.Ys,h,e,g),R.lh(g,d.e.h),R.matrix_to_quat(g,d.e.quat),g=W,R.so(f,h,e,g),f=ba,X.setAxisAngle(g,-c.Fh*c.co*2*Math.PI,f),X.multiply(f,d.e.quat,d.e.quat),K.v(d));b.l&&b.l.$n&&(c=b.l,d=c.$n)&&(e=b.l.Ss,f=ma,h=b.e.h,g=b.e.quat,R.ro(b.l.Ts,g,h,f),R.lh(f,d.e.h),R.matrix_to_quat(f,d.e.quat),f=W,R.so(e,g,h,f),e=ba,h=Math.abs(c.speed)*c.Rs,h>c.rn&&
(h=c.rn),X.setAxisAngle(f,-h,e),X.multiply(e,d.e.quat,d.e.quat),K.v(d));b.l&&b.l.jo&&(c=b.l,d=c.jo)&&(f=b.l.ct,g=ma,e=b.e.h,h=b.e.quat,R.ro(b.l.dt,h,e,g),R.lh(g,d.e.h),R.matrix_to_quat(g,d.e.quat),b=W,R.so(f,h,e,b),f=ba,X.setAxisAngle(b,-Math.abs(c.Xg)*c.bq,f),X.multiply(f,d.e.quat,d.e.quat),K.v(d))}}if(a=ga)a=J.Z(a,"MAIN_OPAQUE"),a.fb&&0<a.fb.waves_height&&(b=Q.length(a.kj),B.w(B.Nu,a.time*b));B.Yz()};a.hy=function(){return ga};a.pause=function(){ga&&B.w(B.yu)};a.resume=function(){ga&&B.w(B.Du)};
a.enable_simulation=function(a){a=a.n;if(!a)throw"No object physics";if(!a.lf){var b=a.H;a.lf=!0;B.w(B.wu,b)}};a.disable_simulation=function(a){a=a.n;if(!a)throw"No object physics";if(a.lf){var b=a.H;a.lf=!1;B.w(B.vu,b)}};a.has_physics=function(a){return a.n?!0:!1};a.has_dynamic_physics=function(a){return(a=a.n)&&a.lf&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.pn&&0==a.kk?!0:!1};a.has_simulated_physics=function(a){return(a=a.n)&&a.lf?!0:!1};a.set_gravity=function(a,b){B.w(B.Mu,a.n.H,b)};a.Ry=
z;a.apply_constraint=D;a.clear_constraint=function(a){a=a.n;B.w(B.Bu,a.Nj);a.Nj=null};a.pull_to_constraint_pivot=function(b,c,d,f,e,h){c=P.create_sep(c,1,d,fa);e=P.create_sep(e,1,h,da);P.invert(c,c);P.multiply(e,c,c);K.get_tsr(f,e);P.multiply(e,c,c);K.set_tsr(b,c);K.v(b);a.set_transform(b,b.e.h,b.e.quat)};a.set_transform=function(a,b,c){P.set_sep(a.e.h,1,a.e.quat,a.n.gm);var d=B.Iq(B.rj);d.H=a.n.H;d.h=b;d.quat=c;B.w(B.rj)};a.sync_transform=A;a.apply_velocity=function(a,b,c,d){H(a,b,c,d,C);a=a.n.H;
b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var f=Math.abs(C[0]),e=Math.abs(C[1]),h=Math.abs(C[2]);C[0]=f?C[0]/f*Math.max(f,b):0;C[1]=e?C[1]/e*Math.max(e,c):0;C[2]=h?C[2]/h*Math.max(h,d):0;B.w(B.Po,a,C[0],C[1],C[2])};a.apply_velocity_world=function(a,b,c,d){B.w(B.Po,a.n.H,b,c,d)};a.apply_force=function(a,b,c,d){H(a,b,c,d,C);B.w(B.nu,a.n.H,C[0],C[1],C[2])};a.apply_torque=function(a,b,c,d){H(a,b,c,d,C);B.w(B.pu,a.n.H,C[0],C[1],C[2])};a.set_character_move_dir=function(a,b,c){B.w(B.Gu,a.n.H,b,c)};a.set_character_move_type=
function(a,b){B.w(B.Hu,a.n.H,b)};a.set_character_walk_velocity=function(a,b){B.w(B.Lu,a.n.H,b)};a.set_character_run_velocity=function(a,b){B.w(B.Ju,a.n.H,b)};a.set_character_fly_velocity=function(a,b){B.w(B.Eu,a.n.H,b)};a.character_jump=function(a){B.w(B.ru,a.n.H)};a.character_rotation_inc=function(a,b,c){B.w(B.su,a.n.H,b,c)};a.set_character_rotation=function(a,b,c){B.w(B.Iu,a.n.H,b,c)};a.set_character_rotation_h=function(a,b){B.w(B.Fu,a.n.H,b)};a.set_character_rotation_v=function(a,b){B.w(B.Ku,a.n.H,
b)};a.append_collision_test=function(a,b,c,d){a=a.n;var f=a.H;b=b||"ANY";for(var e=0;e<a.Zb.length;e++){var h=a.Zb[e];if(h.Qa==b&&h.callback==c)return}h={Il:f,rd:d||!1,Qa:b,callback:c,cf:[],Mi:[]};a.Zb.push(h);u(h)};a.remove_collision_test=function(a,b,c){a=a.n;for(var d=0;d<a.Zb.length;d++){var f=a.Zb[d];if(f.Qa==b&&f.callback==c){if(h(f)){var e=Q.set(0,0,0,C);f.callback(!1,null,e,e,0)}a.Zb.splice(d,1);d--;for(var f=f.cf,e=ga.n.q,g=0;g<e.length;g++)for(var k=e[g].Wa,l=0;l<k.Zb.length;l++)for(var m=
k.Zb[l],n=0;n<m.cf.length;n++)for(var q=m.cf[n],r=0;r<f.length;r++){var t=f[r];q[0]==t[0]&&q[1]==t[1]&&(f.splice(r,1),r--)}f.length&&B.w(B.Oo,f)}}};a.apply_collision_impulse_test=function(a,b){a.n&&a.n.Kf&&q(a);var c=a.n;B.w(B.ou,c.H);c.Kf=b};a.clear_collision_impulse_test=q;a.append_ray_test=function(a,b,c,d,f,e,h,g,k){var l;Z.ms++;l=Z.ms;d=d||"ANY";a={id:l,H:a?a.n.H:0,O:new Float32Array(b),pa:new Float32Array(c),Qa:d,gi:n(d),jp:e,Tv:h,rd:g,ek:k,callback:f};b=ga.n;l=a.id;b.th[l]=a;b.Mn.push(a);B.w(B.ku,
a.id,a.H,a.O,a.pa,a.gi,a.jp,a.Tv,a.rd,a.ek);return l};a.remove_ray_test=w;a.change_ray_test_from_to=function(a,b,c){var d=ga.n.th[a];d&&!d.jp&&(d.O.set(b),d.pa.set(c),B.w(B.qu,a,b,c))};a.ir=function(a){return ga.n.th[a]?!0:!1};a.vehicle_throttle=function(a,b){var c=a.l;c.Xg=b;m(a,c)};a.vehicle_steer=function(a,b){var c=a.l;c.Fh=b;m(a,c)};a.vehicle_brake=function(a,b){var c=a.l;c.di=b;m(a,c)};a.is_vehicle_chassis=r;a.is_vehicle_hull=E;a.bz=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;
return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.$y=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.dz=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.lr=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.kr=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.mr=function(a){return a.b4w_vehicle&&"TACHOMETER"==
a.b4w_vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.l.speed};a.KC=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=I;a.BE=F;a.wy=function(){return S};a.jx=function(){B.w(B.uu)};a.jA=function(a){var b=Y.indexOf(a);-1==b&&L.error("Object "+a.name+" doesn't have bounding physics");for(var c=ga,d=a.n.H,f=c.n.q,e=[],g=0;g<f.length;g++)for(var k=f[g].Wa,l=0;l<
k.Zb.length;l++)for(var m=k.Zb[l],n=0;n<m.cf.length;n++){var r=m.cf[n],t=m.Mi[n];if(r[0]==d||r[1]==d)m.cf.splice(n,1),m.Mi.splice(n,1),n--,t&&!h(m)&&(t=Q.set(0,0,0,C),m.callback(!1,null,t,t,0)),e.push(r)}e.length&&B.w(B.Oo,e);a.n&&a.n.Kf&&q(a);delete ha[d];Y.splice(b,1);a=c.n.q;for(b=0;b<a.length;b++)a[b].Wa.H==d&&(a.splice(b,1),b--);B.w(B.Au,d)}};b4w.module.__data=function(a,p){function c(a,b){if(a)for(var c=S(a,b.id),d=0;d<c.length;d++){var f=c[d];"MESH"==f.type&&delete f.data.submeshes}Ca[b.id]=null;nb[b.id]=null}function d(a,b,c){var d;a instanceof ArrayBuffer&&(a=ba.Nq(a));d=a.width;a=a.height;oa.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(oc)&&c&&oa.warn("image",b,"is not from app root.")}function b(a,b,c,d,f,e){d=b.r;if(!d)throw"Nothing requested";da.enqueue([[d,da.AT_JSON,
d]],function(d,e,h,g){if(d){oa.log("%cLOAD METADATA","color: #616",g);e=wa.wB(d.b4w_format_version);switch(wa.vt(e,Za.Ii)){case -1:e[0]<Za.Ii[0]?wa.fa("JSON version is too old relative to B4W engine: "+wa.dl(e)+", required: "+wa.dl(Za.Ii)+". Reexport scene with the latest B4W addon to fix it."):oa.warn("JSON version is a bit old relative to B4W engine: "+ +wa.dl(e)+", required: "+wa.dl(Za.Ii)+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");break;case 1:e[0]>
Za.Ii[0]?wa.fa("B4W engine version is too old relative to JSON. Can't load the scene. Update your engine version to fix it."):oa.warn("B4W engine version is a bit old relative to JSON. Some compatibility issues can occur. Update your engine version to fix it.")}Za.mn=e;for(var k in d)a[k]=d[k];0===b.id&&(jb=a);(d=a.binaries[0].binfile)?b.mp=d:(fa.Hs(b,"load_binaries"),fa.Hs(b,"prepare_bindata"));d=a==jb;if(a.b4w_export_errors)for(k=0;k<a.b4w_export_errors.length;k++)e=a.b4w_export_errors[k],(d&&"PRIMARY"==
e.type||"ALL"==e.type)&&oa.Dx(e.text);d=a==jb;if(a.b4w_export_warnings)for(k=0;k<a.b4w_export_warnings.length;k++)e=a.b4w_export_warnings[k],(d&&"PRIMARY"==e.type||"ALL"==e.type)&&oa.Ex(e.text);f(b,c)}else fa.Wo(b)},null,function(a){e(b,c,a)})}function e(a,b,c,d,f,e){d=U(b.r)+b.mp;if(!d)throw"Binary data is missing";da.enqueue([[d,da.AT_ARRAYBUFFER,d]],function(d,e,h,g){d?(oa.log("%cLOAD BINARY","color: #616",g),a.bin_data=d,f(b,c)):fa.Wo(b)},null,function(a){e(b,c,a)})}function g(a,b,c,d,f){ec.jw()&&
f(b,c)}function h(a,b,c,d,f){d=a.bin_data;var e=a.binaries[0],h=a.objects,g=a.meshes;a=a.actions;for(var l=wa.fw(),v=["indices"],m=["normal","tangent"],n=["color","group"],q=["position","texcoord","texcoord2"],G=0;G<g.length;G++)for(var r=g[G].submeshes,t=0;t<r.length;t++)for(var C in r[t]){var x=r[t][C][1];if(-1!=v.indexOf(C)){var w=4*r[t][C][0]+e["int"],z=r[t],u=C,p=d;if(l)var W=new Uint32Array(p,w,x);else for(var W=new Uint32Array(x),p=new DataView(p),ca=0;ca<x;ca++)W[ca]=p.getUint32(w+4*ca,!0);
z[u]=W}else if(-1!=q.indexOf(C))w=4*r[t][C][0]+e["float"],r[t][C]=k(d,w,x,l);else if(-1!=m.indexOf(C)){w=2*r[t][C][0]+e["short"];z=r[t];u=C;p=d;W=new Float32Array(x);p=new DataView(p);for(ca=0;ca<x;ca++)W[ca]=p.getInt16(w+2*ca,!0)/32767;z[u]=W}else if(-1!=n.indexOf(C)){w=2*r[t][C][0]+e.ushort;z=r[t];u=C;p=d;W=new Float32Array(x);p=new DataView(p);for(ca=0;ca<x;ca++)W[ca]=p.getUint16(w+2*ca,!0)/65535;z[u]=W}}for(C=0;C<h.length;C++)for(g=h[C].particle_systems,v=0;v<g.length;v++)m=g[v],m.transforms=
k(d,4*m.transforms[0]+e["float"],m.transforms[1],l);for(h=0;h<a.length;h++){C=a[h];g=C.fcurves;v=C.frame_range;n=v[0];q=v[1];G=ea.ly(n,q);v=null;0>G&&(G=0);var t=r=!1,y;for(y in g)r|=-1<y.indexOf("rotation_euler"),t|=-1<y.indexOf("rotation_quaternion");m=[];for(y in g)if(r&&t&&-1<y.indexOf("rotation_euler"))delete g[y];else{var x=g[y],ba;for(ba in x)w=x[ba],z=k(d,e["float"]+4*w.bin_data_pos[0],w.bin_data_pos[1],l),u=new Float32Array(G),null===v&&(v=new Int8Array(G)),ea.Av(w,z,u,v,n,q),w.mc=u;-1<y.indexOf("rotation_euler")&&
(ea.Kx(g[y]),m.push(y))}for(n=0;n<m.length;n++)q=m[n],G=q.replace("euler","quaternion"),g[G]=g[q],delete g[q];C.Xu=v}f(b,c)}function k(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var f=0;f<c;f++)d[f]=a.getFloat32(b+4*f,!0)}return d}function n(a,b,c,d,e){var h=a.cameras,g=a.groups,k=a.materials,l=a.meshes,m=a.node_groups,n=a.objects,q=a.particles,r=a.scenes,t=a.speakers,C=a.textures,x=a.worlds;m||(oa.warn('"node_groups" datablock undefined. reexport main scene.'),
m=a.node_groups=[]);for(var w="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),z={},u=0;u<w.length;u++)for(var p=a[w[u]],W=0;W<p.length;W++){var ca=p[W];z[ca.uuid]=ca}for(var y=0;y<r.length;y++){for(var ba=r[y],J=ba.objects,aa=0;aa<J.length;aa++)A(J,aa,z);ba.camera&&A(ba,"camera",z);ba.world&&A(ba,"world",z)}for(y=0;y<g.length;y++)for(var Ha=g[y].objects,aa=0;aa<Ha.length;aa++)A(Ha,aa,z);for(y=0;y<
n.length;y++){var K=n[y];K.dupli_group&&A(K,"dupli_group",z);K.parent&&A(K,"parent",z);if(K.animation_data){var E=K.animation_data;E.action&&A(E,"action",z);if(E.nla_tracks)for(aa=0;aa<E.nla_tracks.length;aa++)for(var N=E.nla_tracks[aa],B=0;B<N.strips.length;B++)N.strips[B].action&&A(N.strips[B],"action",z)}switch(K.type){case "MESH":if(!K.data)throw"mesh not found for object "+K.name;A(K,"data",z);for(var ec=!1,ja=K.modifiers,aa=0;aa<ja.length;aa++){var ma=ja[aa];"ARMATURE"==ma.type?(ec&&oa.warn('Object "'+
K.name+'" has more than one armature modifiers. Only the first one will be used.'),ec=!0,A(ma,"object",z)):"CURVE"==ma.type&&A(ma,"object",z)}var I=K.particle_systems;if(I)for(aa=0;aa<I.length;aa++)A(I[aa],"settings",z);break;case "ARMATURE":A(K,"data",z);for(var H=K.pose.bones,P=K.data.bones,aa=0;aa<H.length;aa++){var R=H[aa];R.bone=P[R.bone];for(var fa=R.parent_recursive,B=0;B<fa.length;B++)fa[B]=H[fa[B]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":A(K,"data",z)}var da=K.constraints;
if(da)for(aa=0;aa<da.length;aa++){var L=da[aa];L.target&&A(L,"target",z)}var Rc=K.lod_levels;if(Rc)for(aa=0;aa<Rc.length;aa++){var Q=Rc[aa];Q.object&&A(Q,"object",z)}}for(y=0;y<l.length;y++)for(var T=l[y].materials,aa=0;aa<T.length;aa++)A(T,aa,z);for(y=0;y<k.length;y++){for(var Za=k[y],O=Za.texture_slots,aa=0;aa<O.length;aa++)A(O[aa],"texture",z);var oc=Za.node_tree;oc&&D(oc,z)}for(y=0;y<m.length;y++)(oc=m[y].node_tree)&&D(oc,z);for(y=0;y<C.length;y++){var Ca=C[y],X=Ca.type;"IMAGE"!=X&&"ENVIRONMENT_MAP"!=
X||A(Ca,"image",z)}for(y=0;y<h.length;y++){var U=h[y];U.dof_object&&A(U,"dof_object",z)}for(y=0;y<t.length;y++){var ka=t[y];ka.sound&&A(ka,"sound",z);if(ka.animation_data&&(E=ka.animation_data,E.action&&A(E,"action",z),E.nla_tracks))for(aa=0;aa<E.nla_tracks.length;aa++)for(N=E.nla_tracks[aa],B=0;B<N.strips.length;B++)N.strips[B].action&&A(N.strips[B],"action",z)}for(y=0;y<q.length;y++){for(var Sc=q[y],O=Sc.texture_slots,aa=0;aa<O.length;aa++)A(O[aa],"texture",z);Sc.dupli_group&&A(Sc,"dupli_group",
z);Sc.dupli_object&&A(Sc,"dupli_object",z)}for(y=0;y<x.length;y++)if(O=x[y].texture_slots)for(aa=0;aa<O.length;aa++)A(O[aa],"texture",z);Ka.dw(a);for(var Y=a.textures,Z=a==jb?a.scenes[0].b4w_anisotropic_filtering:f().b4w_anisotropic_filtering,nb=0;nb<Y.length;nb++)a==jb||"SCENE"!=Y[nb].b4w_source_type||(Y[nb].b4w_source_id=""),ub.$w(Y[nb],Z,a.scenes,b.id);for(var la={},na=a.objects,ga=0;ga<na.length;ga++){var ha=na[ga];if("MESH"===ha.type&&!ha.particle_systems.length)for(var uc=ha.data,pa=uc.name,
kb=uc.submeshes,Wa=uc.materials,vb=0;vb<kb.length;vb++)0!==kb[vb].base_length||la[pa]||(Wa[vb]&&oa.warn('material "'+Wa[vb].name+'" is not assigned to any face (object "'+ha.name+'").'),la[pa]=!0)}for(var hb=a.meshes,Mc=0;Mc<hb.length;Mc++){var Ab=hb[Mc];Ab.materials.length||Ab.uv_textures.length&&oa.warn('mesh "'+Ab.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,
fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,
b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});for(var fc=
a.meshes,sb=wa.keysearch("name","DEFAULT",a.materials),ib=0;ib<fc.length;ib++){var Bb=fc[ib];0==Bb.materials.length&&Bb.materials.push(sb)}for(var lc=a.actions,tb=b.id,ac=0;ac<lc.length;ac++){var wb=lc[ac];wb.Zu=tb;ea.gv(wb)}for(var bc=a.scenes,Cb=0;Cb<bc.length;Cb++){for(var Mb=bc[Cb],wc=ta.Xl(Mb,"ALL"),Db=[],Da=0;Da<wc.length;Da++)for(var Oc=wc[Da].particle_systems,xc=0;xc<Oc.length;xc++){var Nb=Oc[xc].settings;if("HAIR"==Nb.type)if("OBJECT"==Nb.render_type)v.$k(Nb.dupli_object,!0);else if("GROUP"==
Nb.render_type){for(var mc=Nb.dupli_group,Fc=ta.Xl(Mb,"EMPTY"),Ja=0;Ja<Fc.length;Ja++)Fc[Ja].dupli_group==mc&&Db.push(Fc[Ja]);for(Ja=0;Ja<mc.objects.length;Ja++)v.$k(mc.objects[Ja],!0)}else oa.warn("render type",Nb.render_type,"not supported for particle systems ("+Nb.name+").")}for(Da=0;Da<Db.length;Da++)M(Db[Da],[Mb])}qa(a,b.id);for(var Va=a.scenes,yc=0;yc<Va.length;yc++){for(var hd=Va[yc],gc=[],Tc=[],Yc=Va[yc].objects,Ob=0;Ob<Yc.length;Ob++){var jd=Yc[Ob];F(Yc,jd,gc,Tc);var kd=jd.dupli_group;if(kd)for(var rd=
kd.objects,sd=0;sd<rd.length;sd++)F(rd,rd[sd],gc,Tc)}for(Ob=0;Ob<Tc.length;Ob++)M(Tc[Ob],[hd]);for(Ob=0;Ob<gc.length;Ob++)wa.uv(gc[Ob][0],gc[Ob][1])}qa(a,b.id);var xb=S(a,b.id);Ka.Fv(xb,a.scenes);for(nb=0;nb<xb.length;nb++){var Gc=xb[nb];a!=jb&&Gc.parent&&-1<pc.indexOf(Gc.parent.type)&&(Gc.parent="");v.$k(Gc,!1);Gc.e.rc=b.id}for(var sc=0;sc<xb.length;sc++){var Uc=xb[sc];if("MESH"==Uc.type){var ld=ea.get_first_armature_object(Uc);if(ld){var td=ld.e;if(td.Ie){var dd=Uc.e.Oc,Hc=[],Ic;for(Ic in dd){var Jc=
dd[Ic];Hc.push(4*Jc.mi,4*Jc.qp)}td.zr.push(Hc)}td.Tk.push(Uc.e)}}}for(var Kc=-1,md=-1,Vc=ea.Hq(),zc=0;zc<xb.length;zc++){var Zc=xb[zc],hc=Zc.e;if(wa.is_mesh(Zc)&&hc.ih){var Pc=hc.pe;Pc>Kc&&(Kc=Pc);Vc>=Pc&&Pc>md&&(md=Pc)}}for(zc=0;zc<xb.length;zc++)Zc=xb[zc],hc=Zc.e,wa.is_mesh(Zc)&&hc.ih&&(hc.vi=!0,Kc<Vc?hc.pe=Kc:hc.pe<=Vc?hc.pe=md:(oa.warn('too many bones for "'+Zc.name+'" / '+hc.pe+" bones (max "+Vc+" with blending, "+2*Vc+" without blending). Blending between frames will be disabled."),hc.pe=Kc,
hc.vi=!1),hc.vi=hc.vi&&!qd.tq);for(var $c=0;$c<xb.length;$c++){var nc=xb[$c];if(wa.is_mesh(nc)){var nd=nc.lod_levels.length;if(nd)for(var Lc=nc,Ac=0;Ac<nd;Ac++){var tc=nc.lod_levels[Ac].object;if(!tc){Lc.e.ok=!0;Lc.e.Ze=nc.lod_levels[Ac].distance;break}tc.e.gg=nc.e.gg;Lc.e.Ze=nc.lod_levels[Ac].distance;tc.e.Hi=nc.lod_levels[Ac].distance;if(nc.lod_levels[Ac+1])tc.e.Ze=nc.lod_levels[Ac+1].distance;else{tc.e.ok=!0;tc.e.Ze=1E4;break}Lc.e.ok=!1;Lc=tc}}}for(var ed=0;ed<xb.length;ed++){var ia=xb[ed];if(ia.b4w_vehicle){var Ya=
ia.b4w_vehicle_settings;if("CHASSIS"==Ya.part){ia.l={};ia.l.rq=Ya.force_max;ia.l.rp=Ya.brake_max;ia.l.FB=Ya.suspension_compression;ia.l.HB=Ya.suspension_stiffness;ia.l.GB=Ya.suspension_damping;ia.l.JC=Ya.wheel_friction;ia.l.WE=Ya.roll_influence;ia.l.Az=Ya.max_suspension_travel_cm;ia.l.Xg=0;ia.l.di=1;ia.l.Fh=0;ia.l.speed=0;ia.l.tg=[];ia.l.Vi=[];ia.l.Gh=null;for(var od=ia.ya?ia.ya.dupli_group.objects:xb,Bc=0;Bc<od.length;Bc++){var Na=od[Bc];if(Na.b4w_vehicle){var eb=Na.b4w_vehicle_settings;if(G.bz(Na)&&
Ya.name==eb.name){var fd=G.KC(Na.b4w_vehicle_settings.part);ia.l.tg[fd]=Na;ia.l.Vi[fd]=new Float32Array(8)}else if(G.lr(Na)&&Ya.name==eb.name){ia.l.Gh=Na;ia.l.co=eb.steering_max;ia.l.Ws=eb.steering_ratio;ia.l.er=eb.inverse_control;var yb=Pb.invert(ia.e.V,new Float32Array(16)),Qc=Pb.multiply(yb,Na.e.V,yb);ia.l.Ys=Qc;var Wc=new Float32Array([1,0,0,0]);mb.transformMat4(Wc,Qc,Wc);ia.l.Xs=Wc}else if(G.kr(Na)&&Ya.name==eb.name){ia.l.$n=Na;ia.l.Rs=eb.speed_ratio;ia.l.rn=eb.max_speed_angle;var yb=Pb.invert(ia.e.V,
new Float32Array(16)),Xc=Pb.multiply(yb,Na.e.V,yb);ia.l.Ts=Xc;var ic=new Float32Array([1,0,0,0]);mb.transformMat4(ic,Xc,ic);ia.l.Ss=ic}else if(G.mr(Na)&&Ya.name==eb.name){ia.l.jo=Na;ia.l.bq=eb.delta_tach_angle;var yb=Pb.invert(ia.e.V,new Float32Array(16)),ad=Pb.multiply(yb,Na.e.V,yb);ia.l.dt=ad;var cc=new Float32Array([1,0,0,0]);mb.transformMat4(cc,ad,cc);ia.l.ct=cc}}}if(4!=ia.l.tg.length)throw"Not enough wheels for chassis "+ia.name;}else if("HULL"==Ya.part){ia.l={};ia.l.tg=[];ia.l.Vi=[];ia.l.rq=
Ya.force_max;ia.l.rp=Ya.brake_max;ia.l.ym=Ya.floating_factor;ia.l.Co=Ya.water_lin_damp;ia.l.Do=Ya.water_rot_damp;ia.l.Xg=0;ia.l.di=1;ia.l.Fh=0;ia.l.speed=0;ia.l.Gh=null;for(var bd=ia.ya?ia.ya.dupli_group.objects:xb,Bc=0;Bc<bd.length;Bc++)Na=bd[Bc],Na.b4w_vehicle&&(eb=Na.b4w_vehicle_settings,G.$y(Na)&&Ya.name==eb.name?(ia.l.tg.push(Na),ia.l.Vi.push(new Float32Array(8))):G.lr(Na)&&Ya.name==eb.name?(ia.l.Gh=Na,ia.l.co=eb.steering_max,ia.l.Ws=eb.steering_ratio,ia.l.er=eb.inverse_control,yb=Pb.invert(ia.e.V,
new Float32Array(16)),Qc=Pb.multiply(yb,Na.e.V,yb),ia.l.Ys=Qc,Wc=new Float32Array([1,0,0,0]),mb.transformMat4(Wc,Qc,Wc),ia.l.Xs=Wc):G.kr(Na)&&Ya.name==eb.name?(ia.l.$n=Na,ia.l.Rs=eb.speed_ratio,ia.l.rn=eb.max_speed_angle,yb=Pb.invert(ia.e.V,new Float32Array(16)),Xc=Pb.multiply(yb,Na.e.V,yb),ia.l.Ts=Xc,ic=new Float32Array([1,0,0,0]),mb.transformMat4(ic,Xc,ic),ia.l.Ss=ic):G.mr(Na)&&Ya.name==eb.name&&(ia.l.jo=Na,ia.l.bq=eb.delta_tach_angle,yb=Pb.invert(ia.e.V,new Float32Array(16)),ad=Pb.multiply(yb,
Na.e.V,yb),ia.l.dt=ad,cc=new Float32Array([1,0,0,0]),mb.transformMat4(cc,ad,cc),ia.l.ct=cc))}}}for(var pd=0;pd<xb.length;pd++){var dc=xb[pd];if(dc.b4w_floating){var cd=dc.b4w_floating_settings;if("MAIN_BODY"==cd.part){dc.Nc={};dc.Nc.ym=cd.floating_factor;dc.Nc.Co=cd.water_lin_damp;dc.Nc.Do=cd.water_rot_damp;dc.Nc.Gj=[];for(var ud=dc.ya?dc.ya.dupli_group.objects:xb,wd=0;wd<ud.length;wd++){var gd=ud[wd];if(gd.b4w_floating){var yd=gd.b4w_floating_settings;G.dz(gd)&&cd.name==yd.name&&(dc.Nc.Gj.push(gd),
gd.Rv=gd.b4w_floating_settings.synchronize_position)}}}}}for(nb=0;nb<a.scenes.length;nb++){var xd=a.scenes[nb];vd.enabled&&xd.b4w_enable_physics&&(a==jb||!G.has_physics(f())&&xd==ta.wm(a))&&G.Xy(xd)}e(b,c)}function f(){return ta.wm(jb.scenes)}function l(a,b,c,d,e){a!=jb&&1<a.scenes.length&&(a.scenes=[ta.wm(a.scenes)],oa.warn("loading data contains multiple scenes.","Only the first one will be loaded."));d=f();-1==qd.Ha&&(qd.Ha=d.fps);1<a.scenes.length&&(a.scenes.splice(a.scenes.indexOf(d),1),a.scenes.unshift(d));
for(var h=0;h<a.scenes.length;h++){var g=a.scenes[h];if(a==jb&&!g.camera)throw"Scene check failed: No camera";for(var k=ta.Xl(g,"MESH"),l=0;l<k.length;l++){var v=k[l],m=Ka.xv(v);m&&(a.meshes.push(m),v.data=m)}for(var v=S(a,b.id),m=a.meshes,l=m.slice(0),n=0;n<v.length;n++){var q=v[n];"MESH"==q.type&&(q=l.indexOf(q.data),-1<q&&l.splice(q,1))}for(n=0;n<l.length;n++)m.splice(m.indexOf(l[n]),1);a==jb?(ta.lv(g,a.textures),g.e.Qh.length&&(b.Tm=!0),g.b4w_enable_audio&&Ha.fp(g),v=ta.Jm(g),l=g.b4w_batch_grid_size):
(ta.rv(g,d,a.textures),g.b4w_enable_audio&&!d.k&&Ha.fp(d),v=ta.Jm(d),l=d.b4w_batch_grid_size);m=[];Z.cy(v,l,k,m);l=d.e.Uk;if(l.mA||l.procedural_skydome)l=Z.fy(d.e.Go,l),m.push(l);for(l=0;l<k.length;l++)Z.Sp(k[l],v);for(l=0;l<m.length;l++)Z.Sp(m[l],v);a==jb?(ta.$o(g,m),ta.Vx(v)):ta.$o(d,m)}d=a.materials;if(Rc.im&&Za.pt)for(a=0;a<d.length;a++){k=d[a];v=k.texture_slots;for(h=0;h<v.length;h++)if(m=v[h],l=m.texture,"IMAGE"==l.type||"ENVIRONMENT_MAP"==l.type)g=l.image,g.lc||(-1<g.filepath.indexOf(".dds")?
g.lc=!0:(g.lc=!l.b4w_disable_compression&&!m.use_map_normal&&"ENVIRONMENT_MAP"!=l.type&&!l.b4w_shore_dist_map&&"MOVIE"!=g.source,g.lc&&(g.filepath+=".dds")));if(h=k.node_tree)for(k=h.nodes,h=0;h<k.length;h++)g=k[h],"TEXTURE"==g.type&&(v=g.texture)&&(g=v.image)&&!g.lc&&(g.lc=v.e.yj&&!v.b4w_disable_compression&&"MOVIE"!=g.source,g.lc&&(g.filepath+=".dds"))}else for(a=a.images,d=0;d<a.length;d++)h=a[d],h.lc=Boolean("FILE"==h.source&&-1<h.filepath.indexOf(".dds"));e(b,c)}function t(a,b,c,d,f){d=a.groups;
a=a.objects;for(var e={},h={},g={},k={},l=0;l<d.length;l++){var v=d[l];e[v.uuid]=v;g[v.uuid]=v}for(l=0;l<a.length;l++)v=a[l],h[v.uuid]=v,k[v.uuid]=v;x(a,null,k,g);for(var m in g)m in e||d.push(g[m]);for(m in k)m in h||a.push(k[m]);f(b,c)}function x(a,b,c,d){for(var f=[],e=0;e<a.length;e++){var h=a[e],g=c[h.uuid];if(h=g.proxy){b&&-1==f.indexOf(h.uuid)&&f.push(h.uuid);for(var k=c[h.uuid],l=k.constraints,h=0;h<l.length;h++){var v=wa.Jf(l[h]);v.name+="_CLONE";g.constraints.push(v)}"b4w_proxy_inherit_anim"in
g&&!g.b4w_proxy_inherit_anim||(g.animation_data&&(k.animation_data=wa.Jf(g.animation_data)),k.b4w_use_default_animation=g.b4w_use_default_animation,k.b4w_auto_skel_anim=g.b4w_auto_skel_anim,k.b4w_anim_behavior=g.b4w_anim_behavior,k.b4w_cyclic_animation=g.b4w_cyclic_animation)}}for(e=0;e<f.length;e++)g=wa.Km(a,"uuid",f[e]),-1<g&&a.splice(g,1);f={};for(e=0;e<a.length;e++)h=a[e],g=c[h.uuid],b&&(l=wa.Jf(g),g="origin_name"in g?g.origin_name:g.name,l.name=b+"*"+g,l.origin_name=g,z(l),c[l.uuid]=l,f[h.uuid]=
l.uuid,h.uuid=l.uuid),g=c[h.uuid],g.dupli_group&&(h=g.dupli_group,l=d[h.uuid],k=wa.Jf(l),k.name=wa.ej(l.name+"_CLONE"),k.uuid=aa.Zq("Group"+k.name),d[k.uuid]=k,h.uuid=k.uuid,x(k.objects,g.name,c,d));if(b)for(e=0;e<a.length;e++){h=a[e];g=c[h.uuid];g.parent&&g.parent.uuid in f?g.parent.uuid=f[g.parent.uuid]:g.parent&&(oa.warn("Object's \""+g.name+'" parent is not in dupli group. Disabling parenting.'),g.parent=null);l=g.constraints;for(h=0;h<l.length;h++)b=l[h],b.target&&b.target.uuid in f&&(b.target.uuid=
f[b.target.uuid]);b=g.modifiers;for(h=0;h<b.length;h++)d=b[h],d.object&&d.object.uuid in f&&(d.object.uuid=f[d.object.uuid]);if((g=g.lod_levels)&&g.length)for(h=0;h<g.length;h++)b=g[h],b.object&&b.object.uuid in f&&(b.object.uuid=f[b.object.uuid])}for(var m in f)uc[m]=f[m]}function z(a){a.uuid=aa.Zq("Object"+a.name)}function D(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var f=c[d];"TEXTURE"==f.type&&f.texture&&A(f,"texture",b);"LAMP"==f.type&&f.lamp&&(f.lamp.uuid in uc&&(f.lamp.uuid=uc[f.lamp.uuid]),
b[f.lamp.uuid]||(f.lamp=null));"GROUP"==f.type&&f.node_group&&A(f,"node_group",b)}f=a.links;for(d=0;d<f.length;d++){var e=f[d];H(e,"from_node",c);H(e,"to_node",c);u(e,"from_socket",e.from_node.outputs);u(e,"to_socket",e.to_node.inputs)}if(c=a.animation_data)if(c.action&&A(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(f=c.nla_tracks[d],e=0;e<f.strips.length;e++)f.strips[e].action&&A(f.strips[e],"action",b)}function A(a,b,c){(c=c[a[b].uuid])||oa.error("Dangling link found:",b,a);
a[b]=c}function H(a,b,c){c=wa.keysearch("name",a[b].name,c);a[b]=c}function u(a,b,c){c=wa.keysearch("identifier",a[b].identifier,c);a[b]=c}function y(a,b,c,f,e,h){if(!Za.do_not_load_resources){for(var g=U(b.r),k=a.images,l={},v=[],m=0;m<k.length;m++){var n=k[m],G=n.uuid;if("FILE"===n.source||"MOVIE"===n.source){var r=q(n,a.textures);if(!r.length)oa.warn("image ",n.name," has no users.");else if(!r[0].b4w_shore_dist_map){r=wa.uk(g+n.filepath);if("FILE"===n.source){var t=n.lc?da.AT_ARRAYBUFFER:da.AT_IMAGE_ELEMENT;
Rc.sn&&Za.bl&&(r=da.bj(r),"dds"==r[1]?(r=da.bj(r[0]),r=r[0]+".min50."+r[1]+".dds"):r=r[0]+".min50."+r[1])}else"MOVIE"===n.source&&(Za.Vc?(r=da.bj(r),r=r[0]+".altconv.seq",t=da.nj):(r=da.bj(r),t=Ha.detect_video_container(r[1]),r=t!=r[1]?r[0]+".altconv."+t:r[0]+"."+t,t=da.oj));v.push([G,t,r]);l[G]=n}}}v.length?(f.$q=0,da.enqueue(v,function(e,g,k,m){if(e){if(k==da.oj||k==da.nj){if(k==da.oj)var n=e.videoWidth,G=e.videoHeight;else n=e.images[0].width,G=e.images[0].height;oa.log("%cLOAD VIDEO "+n+"x"+G,
"color: #"+(2048<n||2048<G?"a00":1024<n||1024<G?"aa0":"0a0"),m);-1==m.indexOf(oc)&&oa.warn("video",m,"is not from app root.")}else d(e,m,!0);g=l[g];m=q(g,a.textures);for(n=0;n<m.length;n++){var G=m[n],r=G.image.filepath;k==da.nj?(G.e.ys=e.$b,ub.fj(G.e,e.images,g.lc,r,b.id)):ub.fj(G.e,e,g.lc,r,b.id)}}e=++f.$q/v.length;h(b,c,e)},function(){oa.log("%cLOADED ALL IMAGES","color: #0a0");e(b,c)})):e(b,c)}}function q(a,b){for(var c=[],d=0;d<b.length;d++){var f=b[d];f.image===a&&c.push(f)}return c}function w(a,
b,c,d,f,e){if(!Za.do_not_load_resources){a=S(a,b.id);for(var h=U(b.r),g=[],k={},l=0;l<a.length;l++){var v=a[l];if(m(v)){var n=v.data.sound,G=n.uuid;"BACKGROUND_MUSIC"==Ha.Lm(v)?(G=wa.xq(),b.Sm=!0):"NONE"!=Ha.Lm(v)&&Za.cr&&(b.Wm=!0);if(!(G in k)){k[G]=[];n=wa.uk(h+n.filepath);switch(Ha.Ps(v)){case Ha.hl:var q=da.AT_AUDIOBUFFER;break;case Ha.Ho:q=da.AT_AUDIO_ELEMENT}var n=da.bj(n),r=Ha.detect_audio_container(n[1]),n=r!=n[1]?n[0]+".altconv."+r:n[0]+"."+r;g.push([G,q,n])}k[G].push(v)}}g.length?da.enqueue(g,
function(a,f,h,l){if(a)for(oa.log("%cLOAD SOUND","color: #0aa",l),-1==l.indexOf(oc)&&oa.warn("sound",l,"is not from app root."),f=k[f],h=0;h<f.length;h++)Ha.jC(f[h],a);a=++d.iB/g.length;e(b,c,a)},function(){oa.log("%cLOADED ALL SOUNDS","color: #0aa");f(b,c)}):f(b,c)}}function m(a){return Ha.le(a)&&Ha.Ps(a)!=Ha.Io?!0:!1}function r(a,b){for(var c=ta.Ia(a,"SPEAKER",ta.DATA_ID_ALL),d=0;d<c.length;d++){var f=c[d];Ha.le(f)&&(Ha.is_cyclic(f)||b)&&Ha.play_def(f)}}function E(a){a=a.e.Qh;for(var b=0;b<a.length;b++)Za.Vc&&
a[b].use_auto_refresh?a[b].e.yh=!0:a[b].e.Oa&&a[b].use_auto_refresh&&a[b].e.Oa.play()}function I(a,b,c,d,f){ca.start();oa.log("%cSTART NLA","color: #0a0");f(b,c)}function F(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var f=b.lod_levels.length,e=0;e<f;e++){var h=b.lod_levels[e],g=h.object;if(g){var k=wa.fi(g);k.name=b.name+"_LOD_"+String(e+1);z(k);k.lod_levels=[];c.push([a,k]);d.push(g);h.object=k}}}function M(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,f=0;f<d.length;f++){var e=
d[f].dupli_group;e&&(e=e.objects,h=e.indexOf(a),-1<h&&e.splice(h,1))}var h=d.indexOf(a);-1<h&&d.splice(h,1)}}function L(a,b,c,d,f){d=!0;for(var e=0;e<a.scenes.length;e++)if(!G.lw(a.scenes[e])){d=!1;break}d&&(f(b,c),oa.log("%cPHYSICS READY","color: #0a0"))}function O(a,b,c,d,e){d=f();for(var h=0;h<a.scenes.length;h++){var g=a.scenes[h],k=a==jb?G.has_physics(g):G.has_physics(d)||G.has_physics(g);a==jb||(g=d);for(var l=0;l<ka.length;l++)for(var v=ta.Ia(g,ka[l],ta.DATA_ID_ALL),m=0;m<v.length;m++){var n=
v[m];n.e.rc==b.id&&vd.enabled&&k&&(G.append_object(n,g),b.kn&&G.has_physics(n)&&G.disable_simulation(n))}}e(b,c)}function B(a,b,c,f,e){var h={};f=[];for(var g=a.scenes,k=0;k<a.scenes.length;k++){var l=g[k];if(l.e.fb&&(l=l.e.fb.Sk)&&"FILE"===l.source){var v=l.uuid,m=wa.uk(U(b.r)+l.filepath);f.push([v,l.lc?da.AT_ARRAYBUFFER:da.AT_IMAGE_ELEMENT,m]);h[v]=l}}f.length?da.enqueue(f,function(c,f,e,k){if(c){d(c,k,!0);f=h[f];k=q(f,a.textures);for(e=0;e<k.length;e++){var l=k[e];ub.fj(l.e,c,f.lc,l.image.filepath,
b.id)}for(e=0;e<g.length;e++)if(k=g[e],k.e.fb.Sk===f){var v=c,m=document.createElement("canvas"),l=f.size[0],n=f.size[1];m.width=l;m.height=n;m=m.getContext("2d");m.drawImage(v,0,0);v=m.getImageData(0,0,l,n).data;m=new Float32Array(4);m[0]=1/16581375;m[1]=1/65025;m[2]=1/255;m[3]=1;for(var l=l*n,n=new Float32Array(l),G=0;G<l;G++)n[G]=m[1]*v[4*G+2]+m[2]*v[4*G+3];k.e.Rn=n}}},function(){e(b,c)}):e(b,c)}function J(a,b,c,f,e){if(Za.antialiasing&&Za.smaa){f=a.scenes[0];a=[];for(var h=["SMAA_EDGE_DETECTION",
"SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],g=0;g<h.length;g++){var k=ta.Z(f,h[g]);k&&a.push(k)}if(a.length){f=[];g=da.AT_IMAGE_ELEMENT;f.push(["SEARCH_TEXTURE",g,C.Tb.smaa_search_texture_path]);f.push(["AREA_TEXTURE",g,C.Tb.smaa_area_texture_path]);for(g=0;g<a.length;g++)if(h=a[g],"SMAA_BLENDING_WEIGHT_CALCULATION"==h.type){a=h.ga;for(g=0;g<a.length;g++)if(h=a[g],"u_search_tex"==h.pa)var l=h.ua;else if("u_area_tex"==h.pa)var v=h.ua;break}f.length?da.enqueue(f,
function(a,c,f,e){a&&(d(a,e,!1),c="SEARCH_TEXTURE"==c?l:v,c.source="IMAGE",c.kp=!0,ub.fj(c,a,-1!=e.indexOf(".dds")?1:0,e,b.id),ub.$i(c,ub.s,ub.s))},function(){e(b,c)}):e(b,c)}else e(b,c)}else e(b,c)}function K(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];a==jb||(e=f());for(var h=ta.Ia(e,"LAMP",ta.DATA_ID_ALL),g=0;g<h.length;g++){var k=h[g];k.e.rc==b.id&&(b.kn&&wa.is_mesh(k)&&ta.hide_object(k),d.rl.push({xs:e,obj:k}))}h=ta.Ia(e,"ALL",ta.DATA_ID_ALL);for(g=0;g<h.length;g++)k=h[g],"LAMP"!=
k.type&&k.e.rc==b.id&&(b.kn&&wa.is_mesh(k)&&ta.hide_object(k),d.rl.push({xs:e,obj:k}))}}function P(a,b,c,d,f,e){f=d.rl;var h=d.Jr;f.length?(a=f[h].obj,h=f[h].xs,ta.append_object(h,a,!1),-1!=Mc.indexOf(a.type)&&h.b4w_enable_audio&&Ha.append_object(a,h),Y.is_anchor(a)&&Y.append(a),d=++d.Jr/f.length,"LAMP"==a.type&&ta.hB(h),null!=a.e.pc&&ta.kt(h,a),a.e.Cc&&"PLANE"==a.e.re&&h.e.zb&&(ta.Gv(a,h),ta.nt(a.e.zc,h))):d=1;e(b,c,d)}function R(a,b,c,d,e){if(a==jb){d=ta.By();for(var h=ta.ah(),g=0;g<d.length;g++){var k=
d[g];ta.bA(k,h);k.b4w_use_nla&&ca.gC(k,k.b4w_nla_cyclic,b.id)}ta.set_active(h)}else ta.ot(f());a=S(a,b.id);v.eC(a);e(b,c)}function T(a,b,c,d,e){if(a==jb)for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||E(a.scenes[d]),r(a.scenes[d]);else a.scenes[0].b4w_use_nla||E(f()),r(f());e(b,c)}function Q(a,b,c,d,f){Za.$f&&(b.Tm||b.Sm||b.Wm)?kb||X(a,f,b,c):f(b,c)}function X(a,b,c,d){var e=na.parentElement;Wa=e.style.zIndex;e.style.zIndex="999";kb=document.createElement("div");kb.style.position="relative";
kb.style.height="88px";kb.style.width="88px";var h=Math.round(na.offsetWidth/2-44);kb.style.top=Math.round(na.offsetHeight/2-44).toString()+"px";kb.style.left=h.toString()+"px";kb.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC')";
kb.style.backgroundSize="88px";vb=document.createElement("div");vb.style.position="relative";vb.style.height=na.offsetHeight.toString()+"px";vb.style.width=na.offsetWidth.toString()+"px";vb.style.background="rgba(0, 0, 0, 0.5)";vb.style.zIndex="999";e.appendChild(vb);vb.appendChild(kb);kb.addEventListener("click",function(){c.Tm&&(ub.play(),ub.pause(),ub.reset());if(c.Sm){if(a==jb)for(var e=0;e<a.scenes.length;e++)r(a.scenes[e],!0);else r(f(),!0);Ha.pause()}c.Wm&&Ha.Vz();la();b(c,d)},!1)}function la(){if(kb){var a=
na.parentElement;a.style.zIndex=Wa;vb.removeChild(kb);a.removeChild(vb);kb=vb=null;Wa=0}}function U(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function pa(a,b,c){ea.is_animated(b)&&ea.remove(b);ta.clear_outline_anim(b);G.has_physics(b)&&G.jA(b);W.check_sensor_manifold(b)&&W.remove_sensor_manifold(b);ta.kA(a,b,c);Ha.le(b)&&Ha.kB(b);Y.is_anchor(b)&&Y.remove(b)}function S(a,b){nb[b]||qa(a,b);return nb[b]}function qa(a,b){for(var c=a.scenes,d=[],f=0;f<c.length;f++)ga(c[f].objects,0,
a==jb,d);nb[b]=[];for(f=0;f<d.length;f++)for(var c=d[f],e=0;e<c.length;e++)for(var h=c[e],g=0;g<h.length;g++)nb[b].push(h[g])}function ga(a,b,c,d){d[b]=d[b]||[];for(var f=d[b],e=0;e<a.length;e++){var h=a[e],g=ha(h);f[g]=f[g]||[];(c||-1==pc.indexOf(h.type))&&-1==f[g].indexOf(h)&&f[g].push(h);(h=h.dupli_group)&&ga(h.objects,b+1,c,d)}}function ha(a){return(a=a.parent||ea.get_first_armature_object(a))?1+ha(a):0}var Y=p("__anchors"),ea=p("__animation"),Z=p("__batch"),C=p("__config"),W=p("__controls"),
ba=p("__dds"),ma=p("__extensions");p("__lights");var fa=p("__loader"),da=p("__assets"),aa=p("__md5"),v=p("__objects"),G=p("__physics"),oa=p("__print"),Ka=p("__reformer"),N=p("__renderer"),ta=p("__scenes"),ca=p("__nla"),Ha=p("__sfx"),ec=p("__shaders"),ub=p("__textures"),ja=p("__nodemat"),wa=p("__util");p("__transform");var mb=p("vec4"),Pb=p("mat4"),Za=C.p,Rc=C.Td,vd=C.Wa,qd=C.Sd,Sc=C.hd,Ca=null,nb=null,oc="",jb=null,uc={},kb=null,vb=null,Wa=0,pc=["LAMP","CAMERA"],ka=["MESH","CAMERA","EMPTY"],Mc=["SPEAKER"],
na=null;a.is_primary_loaded=function(a){return fa.is_primary_loaded(a)};a.update=function(){fa.hC(Ca)};a.XA=function(a){na=a};a.dC=function(a,b){if(kb){vb.style.height=b.toString()+"px";vb.style.width=a.toString()+"px";var c=Math.round(a/2-44);kb.style.top=Math.round(b/2-44).toString()+"px";kb.style.left=c.toString()+"px"}};a.load=function(a,d,f,k,v){var m={load_main:{Na:fa.Md,ab:!1,G:[],cb:!1,eb:500,qb:!1,bb:b},duplicate_objects:{Na:fa.nd,ab:!1,G:["load_main"],cb:!1,eb:50,qb:!1,bb:t},load_binaries:{Na:fa.Md,
ab:!1,G:["load_main"],cb:!1,eb:500,qb:!1,bb:e},wait_for_shaders:{Na:fa.Md,ab:!0,G:[],cb:!1,eb:50,qb:!0,bb:g,Ke:g},prepare_bindata:{Na:fa.nd,ab:!1,G:["duplicate_objects","load_binaries"],cb:!1,eb:0,qb:!1,bb:h},prepare_root_datablocks:{Na:fa.nd,ab:!1,G:["duplicate_objects","prepare_bindata"],cb:!1,eb:150,qb:!1,bb:n},prepare_root_scenes:{Na:fa.nd,ab:!1,G:["prepare_root_datablocks","wait_for_shaders"],cb:!1,eb:350,qb:!1,bb:l},load_smaa_textures:{Na:fa.Md,ab:!0,G:["prepare_root_scenes"],cb:!1,eb:10,qb:!0,
bb:J},load_shoremap:{Na:fa.Md,ab:!0,G:["prepare_root_scenes"],cb:!1,eb:10,qb:!0,bb:B},load_textures:{Na:fa.Md,ab:!0,G:["prepare_root_scenes"],cb:!0,eb:500,qb:!1,bb:y,If:{$q:0}},wait_physics_workers:{Na:fa.Md,ab:!0,G:["load_shoremap"],cb:!1,eb:20,qb:!1,Ke:L},add_physics_objects:{Na:fa.nd,ab:!1,G:["wait_physics_workers"],cb:!1,eb:20,qb:!1,bb:O},add_objects:{Na:fa.nd,ab:!1,G:["add_physics_objects"],cb:!1,eb:800,qb:!1,bb:K,Ke:P,ei:R,If:{rl:[],Jr:0}},load_speakers:{Na:fa.Md,ab:!0,G:["add_objects"],cb:!0,
eb:30,qb:!1,bb:w,If:{iB:0}},mobile_media_start:{Na:fa.nd,ab:!Za.$f,G:["load_textures","load_speakers"],cb:!0,eb:5,qb:!1,bb:Q,Ke:Q},synchronize_media:{Na:fa.nd,ab:!0,G:["mobile_media_start"],cb:!0,eb:70,qb:!1,bb:T},start_nla:{Na:fa.nd,ab:!0,G:["mobile_media_start"],cb:!1,eb:5,qb:!1,bb:I}},G=fa.Lq();G||(G=fa.Uw(),Ca={},nb={},uc={});Ca[G.Gd.length]={};return fa.ax(m,a,d,f,c,k||Sc.hp,Za.do_not_load_resources,v)};a.unload=function(a){var b=fa.Lq();if(!b||!b.Gd.length||a&&!fa.JB(b.Gd[a]))oa.error("Unable to unload data!");
else{if(0==a)oa.log("%cUNLOAD ALL","color: #00a"),Y.cleanup(),ea.cleanup(),Ha.cleanup(),ca.cleanup(),ta.cleanup(),fa.cleanup(),G.cleanup(),v.cleanup(),wa.cleanup(),N.cleanup(),ja.cleanup(),ec.cleanup(),W.cleanup(),ma.cleanup(),da.cleanup(),ub.cleanup(),nb=null,uc={},Ca=jb=null;else{oa.log("%cUNLOAD DATA "+a,"color: #00a");ea.iA(a);for(var b=ta.zi(),c=0;c<b.length;c++)for(var d=b[c],f=ta.Ia(d,"ALL",ta.DATA_ID_ALL),e=f.length-1;0<=e;e--){var h=f[e];if(h.e.rc==a){pa(d,h,!0);f.splice(e,1);var g=ta.Ia(d,
h.type,ta.DATA_ID_ALL),h=g.indexOf(h);-1!=h&&g.splice(h,1)}}}la()}};a.aA=pa;a.set_debug_resources_root=function(a){oc=a}};b4w.module.__batch=function(a,p){function c(a){a={type:a,Ja:"",id:0,lA:0,sh:"",M:[],Gb:[],Sc:[],hi:[],Fg:null,sb:{},Xb:null,Ab:null,gp:[],yc:null,T:null,Oc:null,Id:!1,Tg:!1,Yp:!1,wireframe_mode:0,num_vertices:0,num_triangles:0,nr:0,or:0,Oq:0,Nm:0,ac:new Float32Array(3),oc:new Float32Array(16),Ca:!1,Kp:!1,Y:!1,Ce:!1,La:!1,kd:!1,td:!1,Ec:!1,hc:!1,ic:!1,Vb:!1,Mb:!1,Cc:!1,wb:!1,hs:!1,ee:Q.Vh,De:Q.Pd,Rf:!1,In:"",$E:"",Pq:!1,Tq:0,Qq:0,Uq:0,Vq:0,Sq:new Float32Array(3),Rq:new Float32Array(3),Xf:!1,Rd:0,fe:0,
Ne:1,reflect_factor:0,Qs:0,Yn:1,parallax_scale:0,Me:0,Ge:1,Fr:0,tn:0,ng:0,qs:0,sc:Array(2),jc:new Float32Array(3),pf:new Float32Array(3),Cd:new Float32Array(3),Qc:new Float32Array(4),ad:new Float32Array(4),jh:null,dn:null,bn:null,an:null,cn:null,dh:!1,uf:!1,water_dynamic:!1,gl:!1,zt:!1,At:0,Bt:0,yt:0,Uh:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,qq:new Float32Array(2),pq:new Float32Array(2),zm:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
lg:null,Nn:!1,Vr:0,Rr:0,Bn:0,Ur:0,Xr:0,Wr:0,Sr:0,Tr:0,Cn:0,Or:0,Nr:0,Zr:0,Qr:0,Bk:new Float32Array(3),Yr:new Float32Array(8),Pr:new Float32Array(16)};a.Qc[3]=1;a.Kp=!0;a.Y=!0;return a}function d(a){switch(a.type){case "MAIN":case "PARTICLES":a.Ja=a.Ca?a.Ce?"XRAY":"BLEND":"OPAQUE";break;case "DEPTH":a.Ja=a.dh?"NODES":"DEPTH";break;case "COLOR_ID":a.Ja=a.Ce?"COLOR_ID_XRAY":"COLOR_ID"}}function b(a){var b=a.T,c=a.yc;a.T=null;a.yc=null;var d=U.Np(a);a.T=b;d.T=b;a.yc=c;d.yc=c;return d}function e(a,b){for(var c=
[],d=0;d<a.length;d++){var f=a[d],e=f.e,g=k(f.data.b4w_bounding_box),l=f.data.b4w_bounding_cylinder_radius,m=f.data.b4w_bounding_sphere_radius,n=f.data.b4w_bounding_sphere_center,q=f.data.b4w_bounding_ellipsoid_axes,r=f.data.b4w_bounding_ellipsoid_center;if(e.qd){var m=Math.max(Math.abs(g.max_x),Math.abs(g.min_x)),l=Math.max(Math.abs(g.max_y),Math.abs(g.min_y)),t=Math.max(Math.abs(g.max_z),Math.abs(g.min_z)),t=Math.sqrt(m*m+l*l+t*t),m=Math.sqrt(m*m+l*l);g.max_x=g.max_y=g.max_z=t;g.min_x=g.min_y=g.min_z=
-t;l=m;m=t;n[0]=n[1]=n[2]=0;q[0]=q[1]=q[2]=t;r[0]=r[1]=r[2]=0}e.Pb=g;t=J.Jl(g,e.V);e.gb=t;var t=e,C=l;t.Dl=J.Rp(C,g);t.Bl=J.Pp(l,g);t.Cl=J.Qp(C,g);n=J.bm(m,n);e.Yc=n;n=J.Ll(n,e.V);e.vb=n;q=J.am([q[0],0,0],[0,q[1],0],[0,0,q[2]],r);e.Ef=q;q=J.Kl(q,e.Bb);e.Ff=q;c=c.concat(h(f,e,b))}return c}function g(a,b,c){for(var d=[],f=[],e={},g=0;g<a.length;g++){var l=a[g],m=l.e,n=k(l.data.b4w_bounding_box),r=J.Jl(n,m.V),t=J.bm(l.data.b4w_bounding_sphere_radius,l.data.b4w_bounding_sphere_center),x=J.Ll(t,m.V),z=
l.data.b4w_bounding_ellipsoid_axes,z=J.am([z[0],0,0],[0,z[1],0],[0,0,z[2]],l.data.b4w_bounding_ellipsoid_center),w=J.Kl(z,m.Bb);m.Pb=n;m.gb=r;m.Yc=t;m.vb=x;m.Ef=z;m.Ff=w;n={};n.Ec=m.Ec;n.hc=m.hc;n.ic=m.ic;n.xg=m.xg;n.xk=m.xk;n.Fb=m.Fb;n.wk=m.wk;n.Ki=m.Ki;n.Vb=m.Vb;n.Mb=m.Mb;n.Cc=m.Cc;n.pc=m.pc;n.zc=m.zc;n.re=m.re;n.Xd=m.Xd;n.Kc=m.Kc;n.ne=m.ne;n.Jb=m.Jb;n.qd=m.qd;n.ci=m.ci;n.bi=m.bi;n.wb=m.wb;n.Vg=m.Vg;n.Tj=m.Tj;n.oe=m.oe;n.ig=m.ig;n.pk=m.pk;n.wc=m.wc;n.hg=m.hg;n.qk=m.qk;n.td=m.td;r=m.vb.F;n.Oy=0==
c?[0,0]:[Math.floor(r[0]/c),Math.floor(r[2]/c)];n.Ze=m.Ze;n.Hi=m.Hi;n.gg=m.gg;m=JSON.stringify(n);e[m]=e[m]||[];e[m].push(l)}for(var u in e){n=JSON.parse(u);c=e[u];var l=U.Oj("STATIC"),p;for(p in n)l[p]=n[p];l.rc=a[0].e.rc;l.Kd=0;l.Be=0;l.ae=0;l.$d=0;l.Vd=0;l.fh=!1;for(g=0;g<c.length;g++)m=c[g],0==g?(l.gb=C.ka(m.e.gb),l.vb=C.ka(m.e.vb),l.Ef=C.ka(m.e.Ef),l.Ff=C.ka(m.e.Ff)):(J.hq(l.gb,m.e.gb),J.Cx(l.vb,m.e.vb));l.Pb=C.ka(l.gb);l.Yc=C.ka(l.vb);f.push({Wb:l,qe:c})}for(a=0;a<f.length;a++)for(e=f[a].Wb,
g=f[a].qe,u=0;u<g.length;u++){p=g[u];c=h(p,e,b);p.e.qd&&!p.e.Gl?(l=Z.create(),Z.set_trans(p.e.h,l)):(l=p.e,l=Z.create_sep(l.h,l.scale,l.quat));m={};if(e.Kc||e.qd)m.au_center_pos=[l[0],l[1],l[2]];e.Kc&&(m.au_wind_bending_amp=[p.e.Kd],m.au_wind_bending_freq=[p.b4w_wind_bending_freq],m.au_detail_bending_amp=[p.b4w_detail_bending_amp],m.au_detail_bending_freq=[p.b4w_detail_bending_freq],m.au_branch_bending_amp=[p.b4w_branch_bending_amp]);for(n=0;n<c.length;n++)x=c[n].Wb,r=c[n].Gc,t=c[n].B,x.lk?x.qd?Q.zB(r,
l):Q.$s(r,l):("COLOR_ID"==t.type&&(x=c[n].Wb=p.e,t.sh=p.uuid,q(t,x),F(t,C.Qg(x,0))),r=Q.$s(r,l),Q.yB(r,m));d=d.concat(c)}return d}function h(a,b,d){var e=[],h=n(d,b),g=C.Qg(b,0),k=a.data,l=k.materials,r=Array(l.length),t=ha.Ga(d,"MAIN_OPAQUE"),x=!1;t&&(x=t.Ye.length?!0:!1);for(var z=0;z<h.length;z++){var w=h[z];if(!a.b4w_do_not_render||"PHYSICS"==w)for(var u=0;u<l.length;u++){var p=l[u];if(("LENS_FLARES"!=p.name||x)&&!Q.Wq(k,u)){var y=c(w);"MAIN"==w&&(r[u]=y);if(I(y,p)){"DEPTH"==w&&r[u]&&(y.kd=r[u].kd);
y.ee=b.Id||b.td?Q.pj:Q.Vh;q(y,b);for(var ba=y,D=a.particle_systems,J=0;J<D.length;J++){var aa=D[J].settings.b4w_vcol_from_name,A=D[J].settings.b4w_vcol_to_name;""!==aa&&""!==A&&(ba.sb[aa]={Uf:!1,src:[{name:aa,Rc:7}]})}"DYNAMIC"==b.type&&(y.sh=a.uuid);F(y,g);var K=Q.lq(k,u,y.hi,y.Oc,y.sb,y.Fg);"LENS_FLARES"==p.name&&(K=pa.$z(K));e.push({B:y,Gc:K,cc:[p.name],Wb:b,ed:[a]})}}}}var B=a.particle_systems;if(0<B.length&&e.length){for(var ma=!1,H=!1,z=0;z<B.length;z++){var P=B[z],da=P.settings;da.use_render_emitter&&
(ma=!0);"HAIR"!=da.type||"OBJECT"!=da.render_type&&"GROUP"!=da.render_type&&P.transforms.length||(H=!0);if(ma&&H)break}var L=e[0].B.sb,M;if(H){var T;if(1<l.length){for(var O={},S=0;S<B.length;S++){var X=B[S].settings;if("HAIR"==X.type&&("OBJECT"==X.render_type||"GROUP"==X.render_type)){var U=X.b4w_vcol_from_name,Z=X.b4w_vcol_to_name;""!==U&&""!==Z&&(O[U]=C.ka(L[U]))}}"a_bending_col_main"in L&&(O.a_bending_col_main=C.ka(L.a_bending_col_main));"a_bending_col_detail"in L&&(O.a_bending_col_detail=C.ka(L.a_bending_col_detail));
T=Q.mq(k,[],O)}else T=e[0].Gc;M=T}else M=null;for(var la,ea=M,ga=[],Wb=a.particle_systems,Nc=a.data,Cc=0;Cc<Wb.length;Cc++){var va=Wb[Cc],Ga=va.settings;if(Ga.count)if("EMITTER"==Ga.type){if("DYNAMIC"==b.type){var $a=c("PARTICLES"),Oa,Sa=Nc.materials,Xb=va.settings.material-1;Xb>=Sa.length&&(R.warn('Wrong material used for rendering particle system "'+va.name+'"'),Xb=0);Oa=Sa[Xb];"HALO"===va.settings.render_type&&($a.Xf=!0);f($a,Oa);q($a,b);var lb=$a,Qa=va.settings;switch(Qa.b4w_billboard_align){case "VIEW":m(lb,
"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":m(lb,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":m(lb,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":m(lb,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}m(lb,"BILLBOARD",0);m(lb,"SOFT_PARTICLES",Qa.b4w_enable_soft_particles&&0<Qa.b4w_particles_softness&&fa.ni?1:0);m(lb,"SOFT_STRENGTH",Y.t(Qa.b4w_particles_softness));Y.D(lb.Ab,"WORLD_SPACE","WORLD"==Qa.b4w_coordinate_system?1:0);
$a.td=!0;$a.sh=a.name+"_"+Ga.uuid;$a.In=va.name;F($a,g);$a.yc=va;var Ba=pa.Zx($a,Nc,va,a.e.Bb);pa.HA($a,va,Oa);ga.push({B:$a,Gc:Ba,cc:[Oa.name],Wb:b,ed:[a]})}}else if("HAIR"==Ga.type){var fb=C.gk(va.seed);Ga.b4w_dynamic_grass&&(b.Vg=!0);var Ma=qa.Cp(fa.mn)&&!Ga.b4w_initial_rand_rotation&&!Ga.b4w_hair_billboard,La=4;Ma&&(La=8);if(va.transforms.length)var Aa=va.transforms;else for(var ya=Q.Gm(ea,Ga.count,!1,fb),Aa=new Float32Array(ya.length*La),ra=0;ra<ya.length;ra++){var Gb=.75+.5*C.Uc(fb);Aa[ra*La]=
ya[ra][0];Aa[ra*La+1]=ya[ra][1];Aa[ra*La+2]=ya[ra][2];Aa[ra*La+3]=Gb;Ma&&(Aa[ra*La+4]=1,Aa[ra*La+5]=0,Aa[ra*La+6]=0,Aa[ra*La+7]=0)}var Hb=ha.Ga(d,"GRASS_MAP")?!0:!1;if("OBJECT"==Ga.render_type)var xa=[n(d,Ga.dupli_object.e,!0)],Yb=E(a,b,L,ea,[Ga.dupli_object],xa,[Aa],Ga,va,Hb,fb,!1),ga=ga.concat(Yb);else if("GROUP"==Ga.render_type){for(var V=Ga.dupli_group.objects,Qb=!1,xa=[],ra=0;ra<V.length;ra++){var Ua=n(d,Ga.dupli_group.objects[ra].e,!0);xa.push(Ua)}if(Ga.use_whole_group){for(var za,ua=Aa,Zb=
V,qc=Ma,ob=La,Pa={},rb=new Float32Array([0,0,0,1]),Ia=0;Ia<ua.length;Ia+=ob)for(var gb=0;gb<Zb.length;gb++){var jc=W.create();W.scale(Zb[gb].e.h,Zb[gb].e.scale,jc);var Ib=W.clone([ua[Ia],ua[Ia+1],ua[Ia+2]]);Pa[gb]||(Pa[gb]=new Float32Array(ua.length));qc&&(Pa[gb][Ia+4]=rb[0]=ua[Ia+4],Pa[gb][Ia+5]=rb[1]=ua[Ia+5],Pa[gb][Ia+6]=rb[2]=ua[Ia+6],Pa[gb][Ia+7]=rb[3]=ua[Ia+7],C.Jn(rb,rb),C.NB(jc,rb,jc));W.add(Ib,jc,Ib);Pa[gb][Ia]=Ib[0];Pa[gb][Ia+1]=Ib[1];Pa[gb][Ia+2]=Ib[2];Pa[gb][Ia+3]=ua[Ia+3]}za=Pa;Qb=!0}else{var Xa;
if(Ga.use_group_count){for(var Jb=Aa,Dc=V,Kb=Ga.dupli_weights,Ec=fb,Ta=Ma,ab=La,pb={},Rb=[],bb=0;bb<Dc.length;bb++)for(var Sb=Dc[bb],Fb=Sb.origin_name||Sb.name,kc=0;kc<Kb.length;kc++){var sa=Kb[kc];Fb==sa.name.split(": ")[0]&&Rb.push(sa)}Kb.length!=Rb.length&&R.error("dupli weights match failed");for(bb=0;bb<Jb.length;bb+=ab){for(var cb,qb=Rb,$b=[0],Ea=0;Ea<qb.length;Ea++)$b[Ea+1]=$b[Ea]+qb[Ea].count;for(var vc=$b[$b.length-1]*C.Uc(Ec),Lb=0,Ea=0;Ea<$b.length;Ea++)if(vc>=$b[Ea]&&vc<$b[Ea+1]){Lb=Ea;
break}cb=Lb;pb[cb]=pb[cb]||[];pb[cb].push(Jb[bb],Jb[bb+1],Jb[bb+2],Jb[bb+3]);Ta&&pb[cb].push(Jb[bb+4],Jb[bb+5],Jb[bb+6],Jb[bb+7])}for(cb in pb)pb[cb]=new Float32Array(pb[cb]);Xa=pb}else{for(var db=Aa,hb=fb,rc=Ma,Ab=La,fc=V.length,sb={},ib=0;ib<db.length;ib+=Ab){var Bb=Math.floor(fc*C.Uc(hb));sb[Bb]=sb[Bb]||[];sb[Bb].push(db[ib],db[ib+1],db[ib+2],db[ib+3]);rc&&sb[Bb].push(db[ib+4],db[ib+5],db[ib+6],db[ib+7])}for(Bb in sb)sb[Bb]=new Float32Array(sb[Bb]);Xa=sb}za=Xa}Yb=E(a,b,L,ea,V,xa,za,Ga,va,Hb,fb,
Qb);ga=ga.concat(Yb)}"INSTANCE"==Ga.b4w_wind_bend_inheritance&&a.e.Kc&&R.warn('Emitter object "'+a.name+"\" has a particle system with wind bending inheritance from the particle instance. Wind bending on the emitter isn't disabled. Expect unforeseen behavior.")}else throw"Unknown particle settings type";}la=ga;e=ma?e.concat(la):la}return e}function k(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function n(a,b,c){var d=["MAIN","NODES_GLOW"];(b.xg&&
ha.Ga(a,"COLOR_PICKING")||b.Fb&&ha.Ga(a,"OUTLINE_MASK"))&&!c&&d.push("COLOR_ID");ha.Ga(a,"WIREFRAME")&&d.push("WIREFRAME");d.push("PHYSICS");(ha.Ga(a,"DEPTH")||ha.Ga(a,"SHADOW_CAST"))&&d.push("DEPTH");ha.Ga(a,"GRASS_MAP")&&d.push("GRASS_MAP");if(b.hc||b.Mb)for(a=null,b.hc&&(a=["MAIN","NODES_GLOW","COLOR_ID","PHYSICS","WIREFRAME"]),b.Mb&&(b=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],a=null!==a?C.Bv(a,b):b),b=a,a=0;a<b.length;a++)c=d.indexOf(b[a]),-1!==c&&d.splice(c,1);return d}function f(a,b){var c;
switch(a.type){case "MAIN":if(b.b4w_do_not_render)c=!1;else{if(b.use_nodes)u(a,b,"MAIN");else{t(a,b);var d=b.game_settings.alpha_blend;a.Ce=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;a.ng=b.offset_z;a.pf.set([1,1,1]);var f=b.texture_slots;ba.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Qc);switch(b.name){case "LENS_FLARES":L(a,"special_lens_flares.glslv","special_lens_flares.glslf");w(a,"a_position");w(a,"a_texcoord");var e=x(f[0],null);O(a,e);break;default:L(a,"main.glslv",
"main.glslf");var h=z("use_map_color_diffuse",f),g=z("use_map_color_spec",f),k=z("use_map_normal",f),n=z("use_map_mirror",f),e=z("use_stencil",f);c=h[0];g=g[0];k=k[0];n=n[0];h=h[1];f=e[0]&&z("use_rgb_to_intensity",f)[0];if(c){switch(c.blend_type){case "MIX":m(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":m(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}e=x(c,null);O(a,e,"u_colormap0");fa.vl&&"CLIP"==d&&ea.$i(e,ea.kc,ea.kc);a.Me=c.diffuse_color_factor;a.Ge=c.use_map_alpha?
c.alpha_factor:0;a.pf.set(c.scale)}d=c&&c==g;g&&(d||(e=x(g,null),O(a,e,"u_specmap0")),a.Qs=g.specular_color_factor);if(k&&(w(a,"a_normal"),w(a,"a_tangent"),e=x(k,null),O(a,e,"u_normalmap0"),a.Fr=k.normal_factor,e=k.texture,e.b4w_use_map_parallax&&fa.Oi)){var q=Y.t(e.b4w_parallax_steps),r=Y.t(e.b4w_parallax_lod_dist);m(a,"PARALLAX",1);m(a,"PARALLAX_STEPS",q);m(a,"PARALLAX_LOD_DIST",r);a.parallax_scale=e.b4w_parallax_scale}n&&(e=x(n,null),O(a,e,"u_mirrormap"),a.tn=n.mirror_factor);if(n=c&&h&&f?1:0)e=
x(h,null),O(a,e,"u_colormap1"),e=x(f,null),O(a,e,"u_stencil0");(e=c||g||k)&&a.pf.set(e.scale);m(a,"TEXTURE_SPEC",void 0==g?0:1);m(a,"ALPHA_AS_SPEC",d?1:0);m(a,"TEXTURE_STENCIL_ALPHA_MASK",n);w(a,"a_position");w(a,"a_normal");(c||g||k)&&w(a,"a_texcoord");if(b.b4w_water){a.uf=!0;a.water_dynamic=b.b4w_water_dynamic;b.b4w_water_shore_smoothing&&!a.Ca?(R.warn('Material: "'+b.name+'" is opaque.',"Disabling shore smoothing."),a.gl=!1):a.gl=b.b4w_water_shore_smoothing;L(a,"special_water.glslv","special_water.glslf");
w(a,"a_position");fa.Ct?(w(a,"a_polyindex"),a.Y=!0,a.wireframe_edge_color=[0,0,0],m(a,"DEBUG_WIREFRAME",1)):m(a,"DEBUG_WIREFRAME",0);d=b.texture_slots;n=z("use_map_normal",d);e=z("use_map_mirror",d)[0];n.length&&(q=x(n[0]),O(a,q,"u_normalmap0"),a.Uh=b.b4w_water_norm_uv_velocity);m(a,"NUM_NORMALMAPS",n.length);a.lg=Array(n.length);for(q=0;q<n.length;q++)a.lg[q]=new Float32Array(2),a.lg[q].set([n[q].scale[0],n[q].scale[1]]);e&&(q=x(e),O(a,q,"u_mirrormap"),a.tn=e.mirror_factor);e=null;if(fa.Yg)for(q=
0;q<d.length;q++){var C=d[q];if(!0===C.texture.b4w_water_foam){e=C;break}}e?(m(a,"FOAM",1),q=x(e),O(a,q,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.qq.set(e.texture.b4w_foam_uv_freq),a.pq.set(e.texture.b4w_foam_uv_magnitude),a.zm[0]=e.scale[0],a.zm[1]=e.scale[1]):m(a,"FOAM",0);for(q=0;q<d.length;q++)if(C=d[q],!0===C.texture.b4w_shore_dist_map){var p=C;break}p&&fa.sl?(p=x(p),O(a,p,"u_shore_dist_map"),m(a,"SHORE_PARAMS",1),p=C.texture.b4w_shore_boundings,m(a,"MAX_SHORE_DIST",Y.t(C.texture.b4w_max_shore_dist)),
m(a,"SHORE_MAP_SIZE_X",Y.t(p[0]-p[1])),m(a,"SHORE_MAP_SIZE_Y",Y.t(p[2]-p[3])),m(a,"SHORE_MAP_CENTER_X",Y.t((p[0]+p[1])/2)),m(a,"SHORE_MAP_CENTER_Y",Y.t((p[2]+p[3])/2))):m(a,"SHORE_PARAMS",0);if(b.b4w_generated_mesh&&fa.ni)m(a,"GENERATED_MESH",1),a.zt=!0,a.At=b.b4w_water_num_cascads,a.Bt=b.b4w_water_subdivs,a.yt=b.b4w_water_detailed_dist;else{w(a,"a_normal");if(e||n.length)w(a,"a_texcoord"),w(a,"a_tangent");m(a,"GENERATED_MESH",0)}if(b.b4w_water_dynamic){var C=Y.t(b.b4w_water_dst_noise_scale0),p=Y.t(b.b4w_water_dst_noise_scale1),
n=Y.t(b.b4w_water_dst_noise_freq0),d=Y.t(b.b4w_water_dst_noise_freq1),e=Y.t(b.b4w_water_dir_min_shore_fac),q=Y.t(b.b4w_water_dir_freq),r=Y.t(b.b4w_water_dir_noise_scale),y=Y.t(b.b4w_water_dir_noise_freq),W=Y.t(b.b4w_water_dir_min_noise_fac),J=Y.t(b.b4w_water_dst_min_fac),aa=Y.t(b.b4w_water_waves_hor_fac);m(a,"DST_NOISE_SCALE_0",C);m(a,"DST_NOISE_SCALE_1",p);m(a,"DST_NOISE_FREQ_0",n);m(a,"DST_NOISE_FREQ_1",d);m(a,"DIR_MIN_SHR_FAC",e);m(a,"DIR_FREQ",q);m(a,"DIR_NOISE_SCALE",r);m(a,"DIR_NOISE_FREQ",
y);m(a,"DIR_MIN_NOISE_FAC",W);m(a,"DST_MIN_FAC",J);m(a,"WAVES_HOR_FAC",aa)}A(a,b);H(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;m(a,"ABSORB",Y.t(b.b4w_water_absorb_factor));m(a,"SSS_STRENGTH",Y.t(b.b4w_water_sss_strength));m(a,"SSS_WIDTH",Y.t(b.b4w_water_sss_width))}"HALO"===b.type&&(C=b.halo,L(a,"halo.glslv","halo.glslf"),m(a,"NUM_RINGS",C.ring_count),
m(a,"NUM_LINES",C.line_count),m(a,"NUM_STARS",C.star_tip_count),m(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.hi=["a_position"],a.Tq=C.size,a.Qq=C.hardness/20,a.Sq.set(C.b4w_halo_rings_color),a.Rq.set(C.b4w_halo_lines_color),a.Uq=1/b.b4w_halo_stars_blend_height,a.Vq=b.b4w_halo_stars_min_height,a.Pq=!0);m(a,"TEXCOORD",0);m(a,"NORMAL_TEXCOORD",0);c&&l(a,c,"TEXTURE_COLOR0_CO");h&&l(a,h,"TEXTURE_COLOR1_CO");f&&l(a,f,"TEXTURE_STENCIL_ALPHA_MASK_CO");g&&l(a,g,"TEXTURE_SPEC_CO");k&&l(a,k,"TEXTURE_NORM_CO");
m(a,"SHADELESS",b.use_shadeless?1:0);a.kd=b.use_shadeless}d=b.game_settings.alpha_blend;m(a,"ALPHA","OPAQUE"===d?0:1);m(a,"ALPHA_CLIP","CLIP"===d?1:0);m(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(m(a,"VERTEX_COLOR",1),w(a,"a_color")):m(a,"VERTEX_COLOR",0);a.Rd=b.ambient;a.Ne=b.diffuse_intensity;a.fe=b.emit;a.Cd.set(b.specular_color);a.Yn=b.specular_alpha;A(a,b);H(a,b);b.b4w_wettable?m(a,"WETTABLE",1):m(a,"WETTABLE",0);D(a,b);a.Nn=b.b4w_refractive;a.qs=b.b4w_refr_bump}c=
!0}break;case "NODES_GLOW":c=u(a,b,"GLOW");break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)c=!1;else if(t(a,b),a.Ca)c=!1;else{g=b.game_settings.alpha_blend;b.use_nodes&&"CLIP"==g?u(a,b,"DEPTH"):L(a,"depth.glslv","depth.glslf");w(a,"a_position");w(a,"a_normal");m(a,"ALPHA","OPAQUE"===g?0:1);a.pf.set([1,1,1]);if((c=z("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===g){a.pf.set(c.scale);m(a,"TEXTURE_COLOR",1);w(a,"a_texcoord");if("IMAGE"==c.texture.e.source||
"ENVIRONMENT_MAP"==c.texture.e.source)g=x(c),O(a,g,"u_colormap0");"NONE"==c.texture.e.source&&(g=x(c),O(a,g,"u_colormap0"))}else m(a,"TEXTURE_COLOR",0);c=!0}break;case "PHYSICS":b.b4w_collision?(a.pC=b.b4w_use_ghost,a.Qa=b.b4w_collision_id,a.Ip=b.b4w_collision_margin,a.Hp=b.b4w_collision_group,a.Jp=b.b4w_collision_mask,a.wi=b.physics.friction,a.ri=b.physics.elasticity,c=!0):b.b4w_water?(a.uf=!0,a.HC=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,
a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,c=!0):c=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_do_not_render||"HALO"===b.type)c=!1;else{t(a,
b);a.De=Q.Pd;a.Y=!0;a.Ca=!1;g=b.game_settings.alpha_blend;a.Ce=b.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g;b.use_nodes&&"CLIP"==g?u(a,b,"COLOR_ID"):L(a,"color_id.glslv","color_id.glslf");w(a,"a_position");m(a,"ALPHA","OPAQUE"===g?0:1);a.pf.set([1,1,1]);if((c=z("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===g){a.pf.set(c.scale);m(a,"TEXTURE_COLOR",1);w(a,"a_texcoord");if("IMAGE"==c.texture.e.source||"ENVIRONMENT_MAP"==c.texture.e.source)g=x(c),O(a,g,"u_colormap0");"NONE"==c.texture.e.source&&
(g=x(c),O(a,g,"u_colormap0"))}else m(a,"TEXTURE_COLOR",0);c=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?c=!1:(t(a,b),a.Ca=!1,a.De=Q.Pd,a.Y=!0,L(a,"grass_map.glslv","grass_map.glslf"),w(a,"a_position"),c=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,g=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.sb.a_grass_size={Uf:!0,src:[]},c?(a.sb.a_grass_size.src.push({name:c,Rc:4}),m(a,"DYNAMIC_GRASS_SIZE",1)):m(a,"DYNAMIC_GRASS_SIZE",0),a.sb.a_grass_color={Uf:!0,src:[]},
g?(a.sb.a_grass_color.src.push({name:g,Rc:7}),m(a,"DYNAMIC_GRASS_COLOR",1)):m(a,"DYNAMIC_GRASS_COLOR",0),c=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?c=!1:(L(a,"wireframe.glslv","wireframe.glslf"),w(a,"a_position"),w(a,"a_normal"),w(a,"a_polyindex"),a.Y=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],c=!0);break;case "PARTICLES":if(b.b4w_do_not_render)c=!1;else{c=b.texture_slots;if(a.Xf)L(a,"particles_color.glslv","particles_color.glslf");
else if(L(a,"particles_texture.glslv","particles_texture.glslf"),c=z("use_map_color_diffuse",c)[0]){m(a,"TEXTURE_COLOR",1);switch(c.blend_type){case "MIX":m(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":m(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Me=c.diffuse_color_factor;a.Ge=c.use_map_alpha?c.alpha_factor:0;c=x(c);O(a,c)}ba.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Qc);a.Rd=b.ambient;a.Ne=b.diffuse_intensity;a.fe=b.emit;a.Cd.set(b.specular_color);
a.Yn=b.specular_alpha;w(a,"a_position");w(a,"a_normal");c=b.game_settings.alpha_blend;m(a,"ALPHA","OPAQUE"===c?0:1);m(a,"ALPHA_CLIP","CLIP"===c?1:0);m(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);A(a,b);H(a,b);t(a,b);c=b.game_settings.alpha_blend;a.Ce=b.b4w_render_above_all&&"OPAQUE"!=c&&"CLIP"!=c;a.ng=b.offset_z;c=!0}break;default:throw"Wrong batch type: "+a.type;}return c}function l(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":m(a,c,"TEXTURE_COORDS_UV_ORCO");m(a,"TEXCOORD",1);break;case "NORMAL":m(a,
c,"TEXTURE_COORDS_NORMAL");m(a,"NORMAL_TEXCOORD",1);break;default:m(a,c,0)}}function t(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.Ca=!0;a.De=Q.Ro;a.Y=!0;break;case "ALPHA":a.Ca=!0;a.De=Q.Pd;a.Y=!0;break;case "CLIP":a.Ca=!1;a.De=Q.Pd;a.Y=!0;break;case "ADD":a.Ca=!0;a.De=Q.Pd;a.Y=!1;break;case "OPAQUE":a.Ca=!1;a.De=Q.Pd;a.Y=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.La=c.use_backface_culling}function x(a,b){var c=a.texture,d=c.e,c=c.image;d&&b&&c&&
ea.fj(d,b,c.lc,c.filepath);return d}function z(a,b){for(var c=[],d=b.length,f=0;f<d;f++){var e=b[f];1==e[a]&&e.texture&&e.texture.e&&c.push(e)}return c}function D(a,b){var c=b.raytrace_transparency;a.ad[0]=c.fresnel;a.ad[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.reflect_factor=c.reflect_factor;a.ad[2]=c.fresnel;a.ad[3]=1-c.fresnel_factor/5}function A(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":m(a,"SPECULAR_SHADER","SPECULAR_PHONG");c=b.specular_hardness;break;case "WARDISO":m(a,
"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;case "TOON":m(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;d=b.specular_toon_smooth;break;case "BLINN":m(a,"SPECULAR_SHADER","SPECULAR_BLINN");c=b.specular_ior;d=b.specular_hardness;break;default:R.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.jc[0]=b.specular_intensity;a.jc[1]=c;a.jc[2]=d}function H(a,b){switch(b.diffuse_shader){case "LAMBERT":m(a,"DIFFUSE_SHADER",
"DIFFUSE_LAMBERT");a.sc[0]=0;a.sc[1]=0;break;case "OREN_NAYAR":m(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.sc[0]=b.roughness;a.sc[1]=0;break;case "FRESNEL":m(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.sc[0]=b.diffuse_fresnel;a.sc[1]=b.diffuse_fresnel_factor;break;case "MINNAERT":m(a,"DIFFUSE_SHADER","DIFFUSE_MINNAERT");a.sc[0]=b.darkness;a.sc[1]=0;break;case "TOON":m(a,"DIFFUSE_SHADER","DIFFUSE_TOON");a.sc[0]=b.diffuse_toon_size;a.sc[1]=b.diffuse_toon_smooth;break;default:R.error("unsupported diffuse shader: "+
b.diffuse_shader+' (material "'+b.name+'")'),a.sc[0]=0,a.sc[1]=0}}function u(a,b,c){if(!b.use_nodes||b.b4w_do_not_render)return!1;var d;switch(c){case "MAIN":L(a,"main.glslv","main.glslf");d=!1;break;case "GLOW":L(a,"main.glslv","main.glslf");d=!0;break;case "DEPTH":L(a,"depth.glslv","depth.glslf");d=!1;break;case "COLOR_ID":L(a,"color_id.glslv","color_id.glslf"),d=!1}c=la.sw(b.node_tree,b.uuid,!1,b.name,c);if(!c)return R.error('Failed to create node graph for material "'+b.name+'", disable nodes'),
y(a,b),!0;a.dh=!0;m(a,"NODES",1);m(a,"NODES_GLOW",d?1:0);var f=b.game_settings.alpha_blend;m(a,"ALPHA","OPAQUE"===f?0:1);m(a,"ALPHA_CLIP","CLIP"===f?1:0);m(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);w(a,"a_position");b.use_orco_tex_coord&&w(a,"a_orco_tex_coord");t(a,b);a.ng=b.offset_z;f=b.game_settings.alpha_blend;a.Ce=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;ba.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Qc);a.fe=b.emit;a.Rd=b.ambient;D(a,b);b.b4w_wettable?
m(a,"WETTABLE",1):m(a,"WETTABLE",0);a.Ab.yn=la.tw(c);var e=!1;X.R(c,function(b,c){switch(c.type){case "UVMAP":case "TEX_COORD_UV":case "GEOMETRY_UV":case "UV_MERGED":var d=c.data.name,h=c.data.value;a.Fg||(a.Fg={});a.Fg[h]=d;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":d=c.data.name;a.sb[d]={Uf:!0,src:[{name:c.data.value}]};h=0;if("GEOMETRY_VC"==c.type)h=7;else for(var g=0;g<c.xa.length;g++){var k="RGB".indexOf(c.xa[g].identifier);-1<k&&(h|=1<<2-k)}a.sb[d].src[0].Rc=
h;break;case "TEX_COORD_NO":case "GEOMETRY_NO":w(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":d=c.data.value;w(a,"a_normal");m(a,"DIFFUSE_SHADER","DIFFUSE_"+d.sx);m(a,"SPECULAR_SHADER","SPECULAR_"+d.nB);m(a,"SHADELESS_MAT",d.kd?1:0);a.kd=d.kd;e=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":d=c.data.name;h=c.data.value;!1!==h.e.yj&&(h.e.yj="TEXTURE_ENVIRONMENT"!=c.type?!0:!1);O(a,h.e,d);fa.vl&&"CLIP"==f&&ea.$i(c.data.value.e,ea.kc,ea.kc);break;case "TEXTURE_NORMAL":case "B4W_PARALLAX":m(a,
"CALC_TBN_SPACE",1);w(a,"a_normal");w(a,"a_tangent");d=c.data.name;h=c.data.value;h.e.yj=!1;O(a,h.e,d);break;case "LAMP":c.data&&(a.jh=c.data);break;case "B4W_REFRACTION":a.Nn=!0}});e||(a.kd=!0);return!0}function y(a,b){switch(a.type){case "DEPTH":L(a,"depth.glslv","depth.glslf");break;case "COLOR_ID":L(a,"color_id.glslv","color_id.glslf");break;default:L(a,"main.glslv","main.glslf")}m(a,"SHADELESS",1);w(a,"a_position");w(a,"a_normal");ba.set(1,0,1,1,a.Qc);if(b){var c=b.game_settings.alpha_blend;
m(a,"ALPHA","OPAQUE"===c?0:1);m(a,"ALPHA_CLIP","CLIP"===c?1:0);m(a,"VERTEX_COLOR",0);a.ng=b.offset_z;t(a,b)}return!0}function q(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.lk?m(a,"AU_QUALIFIER","attribute"):m(a,"AU_QUALIFIER","uniform"),m(a,"STATIC_BATCH",0)):(m(a,"AU_QUALIFIER","attribute"),m(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(T.Fy()?m(a,"WIREFRAME_QUALITY",1):m(a,"WIREFRAME_QUALITY",0),a.Tg?(m(a,"DEBUG_SPHERE",1),a.Yp?m(a,"DEBUG_SPHERE_DYNAMIC",1):m(a,"DEBUG_SPHERE_DYNAMIC",0)):m(a,
"DEBUG_SPHERE",0),m(a,"ALPHA",1));b.Id&&(a.Id=b.Id);b.Kc?(""!==b.ne?(a.sb.a_bending_col_main={Uf:!0,src:[{name:b.ne,Rc:4}]},w(a,"a_bending_col_main"),""!==b.Jb.sr&&""!==b.Jb.rr&&""!==b.Jb.Mr?(a.sb.a_bending_col_detail={Uf:!0,src:[{name:b.Jb.sr,Rc:4},{name:b.Jb.rr,Rc:2},{name:b.Jb.Mr,Rc:1}]},w(a,"a_bending_col_detail"),w(a,"a_normal"),m(a,"DETAIL_BEND",1)):m(a,"DETAIL_BEND",0),m(a,"MAIN_BEND_COL",1)):m(a,"MAIN_BEND_COL",0),m(a,"WIND_BEND",1)):m(a,"WIND_BEND",0);b.Ej?m(a,"BEND_CENTER_ONLY",1):m(a,"BEND_CENTER_ONLY",
0);m(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.Gl|0);b.qd?m(a,"BILLBOARD",1):m(a,"BILLBOARD",0);b.qd&&b.lk?m(a,"HAIR_BILLBOARD",1):m(a,"HAIR_BILLBOARD",0);b.bi?m(a,"BILLBOARD_SPHERICAL",1):m(a,"BILLBOARD_SPHERICAL",0);switch(b.ci){case "RANDOM":m(a,"BILLBOARD_RANDOM",1);m(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":m(a,"BILLBOARD_RANDOM",0);m(a,"BILLBOARD_JITTERED",1);break;default:m(a,"BILLBOARD_RANDOM",0),m(a,"BILLBOARD_JITTERED",0)}b.wb&&fa.sl?m(a,"DYNAMIC_GRASS",1):m(a,"DYNAMIC_GRASS",0);a.wb=
b.wb;a.td=b.td;a.Ec=b.Ec;a.hc=b.hc;a.ic=b.ic&&!a.kd&&!(a.Ca&&fa.cq);a.Vb=b.Vb;a.Mb=b.Mb;a.Cc=b.Cc;b.ih?(w(a,"a_influence"),m(a,"SKINNED",1),b.vi?m(a,"FRAMES_BLENDING",1):m(a,"FRAMES_BLENDING",0),m(a,"MAX_BONES",b.pe)):(m(a,"SKINNED",0),m(a,"FRAMES_BLENDING",0));b.el?(m(a,"VERTEX_ANIM",1),fa.wt?m(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):m(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):m(a,"VERTEX_ANIM",0);if(b.ih&&b.el)throw"Skinning and vertex animation are mutually exlusive";b.Tj?m(a,"DISABLE_FOG",
1):m(a,"DISABLE_FOG",0);b.Oc&&(a.Oc=b.Oc);if(a.dh){for(var c=a.Ab.yn,d=b.ig,f=b.hg,e=0;e<c.length;e++){var h=c[e];switch(h.id){case "VALUE":var g=h.Ck[0];if(g)for(var k=0;k<d.length;k+=2)if(d[k]==g){h.be.push(["VALUE_IND",d[k+1]]);break}break;case "RGB":if(g=h.Ck[0])for(k=0;k<f.length;k+=2)if(f[k]==g){h.be.push(["RGB_IND",f[k+1]]);break}}}m(a,"NUM_VALUES",b.oe.length);m(a,"NUM_RGBS",b.wc.length)}}}function w(a,b){var c=a.hi;-1==c.indexOf(b)&&c.push(b)}function m(a,b,c){Y.D(a.Ab,b,c)}function r(a,
b){if("PHYSICS"==a.type)a.Gc=b;else{var c=a.De,d=a.ee;a.Pq&&(b=Q.Ix(b));a.zt&&(b=S.dy(a.At,a.Bt,a.yt));c=Q.BB(b,c,d,a.sb);a.T=c;a.td||c.fk||a.Id||(c.Ve=null,c.ld=null);c=b.A.length;a.num_vertices=b.L*c;a:switch(a.ee){case Q.Vh:case Q.qj:case Q.pj:d=!0;break a;default:d=!1}d?Q.ez(b)?a.num_triangles=b.ea.length/3*c:a.num_triangles=b.L/3*c:a.num_triangles=0}}function E(a,b,d,f,e,h,g,k,l,m,n,r){var t=[],x=k.b4w_dynamic_grass;if(!m&&x)return t;for(var z="INSTANCE"==k.b4w_wind_bend_inheritance,w="INSTANCE"==
k.b4w_shadow_inheritance,u="INSTANCE"==k.b4w_reflection_inheritance,p=[],y=[],D=0;D<e.length;D++){var J=e[D],A=C.fi(b);A.qd=k.b4w_hair_billboard;A.ci=k.b4w_hair_billboard_type;A.bi="SPHERICAL"==k.b4w_hair_billboard_geometry;A.wb=x;A.lk=!0;A.oe=J.e.oe;A.ig=J.e.ig;A.wc=J.e.wc;A.hg=J.e.hg;z?(A.Kc=J.e.Kc,A.lj=J.e.lj,A.Be=J.e.Be,A.ae=J.e.ae,A.ne=J.e.ne,A.$d=J.e.$d,A.Vd=J.e.Vd,A.Kd=J.e.Kd,A.Jb=J.e.Jb,A.Ej=!1):(A.Kc=a.e.Kc,A.lj=a.e.lj,A.Be=a.e.Be,A.ae=a.e.ae,A.ne=a.e.ne,A.$d=a.e.$d,A.Vd=a.e.Vd,A.Kd=a.e.Kd,
A.Jb=a.e.Jb,A.Ej=!0);w?(A.Ec=J.e.Ec,A.hc=J.e.hc,A.ic=J.e.ic):(A.Ec=a.e.Ec,A.hc=a.e.hc,A.ic=a.e.ic);u?(A.Vb=J.e.Vb,A.Mb=J.e.Mb,A.Cc=J.e.Cc,A.pc=J.e.pc,A.zc=J.e.zc,A.re=J.e.re):(A.Vb=a.e.Vb,A.Mb=a.e.Mb,A.Cc=a.e.Cc,A.pc=a.e.pc,A.zc=a.e.zc,A.re=a.e.re);p.push(A);var K=g[D];K||(K=new Float32Array);r&&C.gk(l.seed,n);var E=new Float32Array(3),B=new Float32Array([0,0,0,1]),H=[],P=qa.Cp(fa.mn)&&!k.b4w_initial_rand_rotation&&!k.b4w_hair_billboard,da=4;P&&(da=8);for(var L=0;L<K.length;L+=da){E[0]=K[L];E[1]=
K[L+1];E[2]=K[L+2];var M=K[L+3]*J.e.scale;if(k.b4w_initial_rand_rotation){switch(k.b4w_rotation_type){case "XYZ":var T=new Float32Array([C.Uc(n),C.Uc(n),C.Uc(n)]);W.normalize(T,T);break;case "Z":T=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+k.b4w_rotation_type;}ma.setAxisAngle(T,k.b4w_rand_rotation_strength*(2*Math.PI*C.Uc(n)-Math.PI),B)}else P&&(B.set(K.subarray(L+4,L+8)),C.Jn(B,B),k.use_whole_group||(k.use_rotation_dupli?ma.multiply(B,J.e.quat,B):ma.multiply(B,
aa,B)));var O=Z.create_sep(E,M,B);H.push(O)}y.push(H)}for(var S={},D=0;D<e.length;D++){var X=h[D],A=p[D],U={};A.Kc&&(U.au_wind_bending_amp=[A.Kd],U.au_wind_bending_freq=[A.Be],U.au_detail_bending_freq=[A.ae],U.au_detail_bending_amp=[A.$d],U.au_branch_bending_amp=[A.Vd],A.Kd=0,A.Be=0,A.ae=0,A.$d=0,A.Vd=0);var Y=C.Qg(A,0),H=y[D];if(H.length)for(var la=e[D].data,ea=la.materials,ga=Array(ea.length),L=0;L<ea.length;L++)if(!Q.Wq(la,L))for(var ha=0;ha<X.length;ha++){var pa=X[ha],va=c(pa),Ga=ea[L];"MAIN"==
pa&&(ga[L]=va);if(I(va,Ga)){"DEPTH"==pa&&ga[L]&&(va.kd=ga[L].kd);va.ee=Q.Vh;q(va,A);va.sh=k.uuid;"JITTERED"==k.b4w_hair_billboard_type&&(va.nr=k.b4w_hair_billboard_jitter_amp,va.or=k.b4w_hair_billboard_jitter_freq);x&&(va.Oq=k.b4w_dynamic_grass_scale_threshold);z||(delete va.sb.a_bending_col_main,delete va.sb.a_bending_col_detail);F(va,Y);var $a=Q.lq(la,L,va.hi,va.Oc,va.sb,va.Fg),Oa=Q.vz($a,U,H),Sa=Oa,Xb=H;Sa.J.au_center_pos=new Float32Array(3*Sa.L);for(var lb=Xb.length,Qa=Sa.L/lb,Ba=0;Ba<lb;Ba++)for(var fb=
Xb[Ba],Ma=3*Qa*Ba,La=0;La<Qa;La++)Sa.J.au_center_pos[Ma+3*La]=fb[0],Sa.J.au_center_pos[Ma+3*La+1]=fb[1],Sa.J.au_center_pos[Ma+3*La+2]=fb[2];Oa=Sa;if(A.Kc&&A.Ej){var Aa=Oa,ya=a.e.V;Aa.J.a_emitter_center=new Float32Array(3*Aa.L);var ra=ba.fromValues(0,0,0,1);ba.transformMat4(ra,ya,ra);for(var Gb=0;Gb<Aa.L;Gb++)Aa.J.a_emitter_center[3*Gb]=ra[0],Aa.J.a_emitter_center[3*Gb+1]=ra[1],Aa.J.a_emitter_center[3*Gb+2]=ra[2];Oa=Aa}var Hb=k.b4w_vcol_from_name,xa=k.b4w_vcol_to_name,Yb=va,V=d,Qb=!z,Ua=la,za=[];if(""!==
Hb&&""!==xa){var ua,Zb=xa,qc=Yb.sb,ob=[],Pa=void 0;for(Pa in qc)for(var rb=qc[Pa].src,Ia=0,gb=0;gb<rb.length;gb++){var jc=rb[gb].Rc;Zb==rb[gb].name&&ob.push(Pa,jc,Ia);Ia+=C.wg(jc)}ua=ob;if(0<ua.length)for(var Ib=0;Ib<ua.length;Ib+=3)za.push({si:Hb,Wj:7,Dk:ua[Ib],Ek:ua[Ib+1],Uj:ua[Ib+2]});else Q.Qy(Yb.hi,"a_color")&&xa==Ua.active_vcol_name&&za.push({si:Hb,Wj:7,Dk:"a_color",Ek:7,Uj:0})}Qb&&("a_bending_col_main"in V&&za.push({si:"a_bending_col_main",Wj:4,Dk:"a_bending_col_main",Ek:4,Uj:0}),"a_bending_col_detail"in
V&&za.push({si:"a_bending_col_detail",Wj:7,Dk:"a_bending_col_detail",Ek:7,Uj:0}));for(var Xa=Oa,Jb=H,Dc=f,Kb=za,Ec=va.sb,Ta=!1,ab=0;ab<Kb.length;ab++){var pb=Kb[ab].si,Rb=Dc.J[pb];if(Rb&&0<Rb.length){Ta=!0;break}}if(Ta){var bb,Sb=a.e.Pb,Fb=Dc.A[0].a_position,kc=Jb,sa=S,cb=new Float32Array(3),qb=new Float32Array(3),$b=new Uint32Array(kc.length);if(!("verts_indices"in sa)){sa.Yd=new Float32Array(3);sa.Ud=new Float32Array(3);sa.Ao=new Uint32Array(Fb.length/3);sa.Ji=new Uint32Array(Fb.length/3);sa.Yd[0]=
(Sb.max_x-Sb.min_x)/20;sa.Yd[1]=(Sb.max_y-Sb.min_y)/20;sa.Yd[2]=(Sb.max_z-Sb.min_z)/20;sa.Ud[0]=Sb.min_x;sa.Ud[1]=Sb.min_y;sa.Ud[2]=Sb.min_z;for(var Ea=0;Ea<Fb.length/3;Ea++){var vc=C.trunc((Fb[3*Ea]-sa.Ud[0])/sa.Yd[0]),Lb=C.trunc((Fb[3*Ea+1]-sa.Ud[1])/sa.Yd[1]),db=C.trunc((Fb[3*Ea+2]-sa.Ud[2])/sa.Yd[2]),vc=C.clamp(vc,0,19),Lb=C.clamp(Lb,0,19),db=C.clamp(db,0,19);sa.Ao[Ea]=Ea;sa.Ji[Ea]=db*Math.pow(20,2)+20*Lb+vc}Q.Os(sa.Ji,sa.Ao,Q.ll,!0);sa.Gg=new Uint32Array(Math.pow(20,3));for(Ea=0;Ea<sa.Ji.length;Ea++)sa.Gg[sa.Ji[Ea]]++;
delete sa.Ji;for(Ea=1;Ea<sa.Gg.length;Ea++)sa.Gg[Ea]+=sa.Gg[Ea-1]}for(var hb=0;hb<kc.length;hb++){cb[0]=kc[hb][0];cb[1]=kc[hb][1];cb[2]=kc[hb][2];for(var rc=1E10,Ab=-1,fc=C.trunc((cb[0]-sa.Ud[0])/sa.Yd[0]),sb=C.trunc((cb[1]-sa.Ud[1])/sa.Yd[1]),ib=C.trunc((cb[2]-sa.Ud[2])/sa.Yd[2]),fc=C.clamp(fc,0,19),sb=C.clamp(sb,0,19),ib=C.clamp(ib,0,19),Bb=ib*Math.pow(20,2)+20*sb+fc,lc=sa.Gg[Bb],tb=0==Bb?0:sa.Gg[Bb-1];tb<lc;tb++){var ac=sa.Ao[tb];qb[0]=Fb[3*ac];qb[1]=Fb[3*ac+1];qb[2]=Fb[3*ac+2];W.sub(qb,cb,qb);
var wb=W.sqrLen(qb);wb<=rc&&(rc=wb,Ab=ac)}if(-1==Ab)for(tb=0;tb<Fb.length/3;tb++)qb[0]=Fb[3*tb],qb[1]=Fb[3*tb+1],qb[2]=Fb[3*tb+2],W.sub(qb,cb,qb),wb=W.sqrLen(qb),wb<=rc&&(rc=wb,Ab=tb);$b[hb]=Ab}bb=$b;for(var bc=Xa.L/Jb.length,ab=0;ab<Kb.length;ab++){var Cb=Kb[ab].Dk,Mb=Kb[ab].Ek,pb=Kb[ab].si,wc=Kb[ab].Wj,Rb=Dc.J[pb];switch(Cb){case "a_bending_col_main":var Db=1;break;case "a_bending_col_detail":Db=3;break;case "a_color":Db=3;break;default:for(var Da=Db=0;Da<Ec[Cb].src.length;Da++)Db+=C.wg(Ec[Cb].src[Da].Rc)}if(Rb&&
0<Rb.length){var Oc=C.wg(wc),xc=C.wg(Mb),Nb=wc&Mb,mc=C.vs(Nb);Nb!=Mb&&R.error("Wrong color extraction from "+pb+" to "+Cb+".");if("a_bending_col_main"==Cb||"a_bending_col_detail"==Cb)Xa.J[Cb]=new Float32Array(Xa.L*xc);for(Da=0;Da<Jb.length;Da++){var Fc=bb[Da],Ja=Fc*Oc,Va=Da*bc*Db;if(-1!=Fc)for(var yc=0;yc<bc;yc++)for(var hd=yc*Db,gc=0;gc<mc.length;gc++)mc[gc]&&(Xa.J[Cb][Va+hd+(Kb[ab].Uj+C.Zi(Mb,gc))]=Rb[Ja+C.Zi(wc,gc)])}}else Xa.J[Cb]=new Float32Array(0)}}Oa=Xa;t.push({B:va,Gc:Oa,cc:[Ga.name],Wb:A,
ed:[a]})}}}return t}function I(a,b){var c=!0;"NODES_GLOW"==a.type&&(c=la.Bp(b));return c=c&&f(a,b)}function F(a,b){for(var c=null,d=null,f=0;f<a.M.length;f++){var e=a.M[f].Wd;e&&(c||(c={}),c[f]=e,a.M[f].Wd=null);if(e=a.M[f].Oa)d||(d={}),d[f]=e,a.M[f].Oa=null}a.id=0;a.lA=b;a.id=C.Qg(a,b);if(c)for(var h in c)a.M[h].Wd=c[h];if(d)for(h in d)a.M[h].Oa=d[h]}function M(a,b,d,f,e){var h=c("WIREFRAME");L(h,"wireframe.glslv","wireframe.glslf");h.wireframe_mode=0;h.Tg=!0;h.Y=!0;h.sh=d;e&&(h.Yp=!0);q(h,b);F(h,
C.Qg(b,0));f?(b=S.zq(1,a.F),Q.yA(b,[a.Bf[0],a.Cf[1],a.Df[2]],a.F)):b=S.zq(a.Da,a.F);Q.ho(b,1,!0);b.J.a_polyindex=Q.kq(b);r(h,b);return h}function L(a,b,c){a.Ab={ij:b,ui:c,Oe:[],hn:[],yn:[]};Y.GA(a.Ab)}function O(a,b,c){1==a.M.length&&0==a.Gb.length&&a.Gb.push("default0");c=c||"default"+String(a.M.length);-1==a.Gb.indexOf(c)&&(a.M.push(b),a.Gb.push(c));a.Xb&&ga.ep(a)}function B(a){if(!a.Ab)throw"No shaders info for batch "+a.name;a.Xb=Y.py(a.Ab);ga.Hv(a.Xb);ga.cp(a);ga.ep(a)}var J=p("__boundings"),
K=p("__camera"),P=p("__config"),R=p("__print"),T=p("__extensions"),Q=p("__geometry"),X=p("__graph"),la=p("__nodemat"),U=p("__objects"),pa=p("__particles"),S=p("__primitives"),qa=p("__reformer"),ga=p("__renderer"),ha=p("__scenegraph"),Y=p("__shaders"),ea=p("__textures"),Z=p("__tsr"),C=p("__util"),W=p("vec3"),ba=p("vec4"),ma=p("quat"),fa=P.p,da=["MAIN"],aa=new Float32Array([0,-Math.sqrt(.5),0,Math.sqrt(.5)]);a.sE=c;a.cy=function(a,b,c,f){for(var h=[],k=[],l=[],m=0;m<c.length;m++){var n=c[m];U.bc(n)?
k.push(n):l.push(n)}m=[];m=m.concat(e(k,a));k=m=m.concat(g(l,a,b));m=[];n=[];l={};for(a=0;a<k.length;a++){var q=k[a].B,t=k[a].Wb,x=null;if(q.id in l){var z=l[q.id],w=n[z].B,u=n[z].Wb,p=null,y=null;for(b=0;b<q.M.length;b++){var W=q.M[b].Wd;W&&(p||(p={}),p[b]=W,q.M[b].Wd=null);if(W=q.M[b].Oa)y||(y={}),y[b]=W,q.M[b].Oa=null}C.Zs(q,w)&&C.Zs(t,u)&&(x=n[z]);if(p)for(b in p)q.M[b].Wd=p[b];if(y)for(b in y)q.M[b].Oa=y[b];if(!x){do q.id++;while(l[q.id])}}x||(x={B:q,Wb:k[a].Wb,ed:[],io:[],cc:[]},l[q.id]=n.length,
n.push(x));x.ed=x.ed.concat(k[a].ed);k[a].Gc&&k[a].Gc.L&&x.io.push(k[a].Gc);if(x.cc.length)for(b=0;b<k[a].cc.length;b++)q=k[a].cc[b],-1==x.cc.indexOf(q)&&x.cc.push(q);else x.cc=k[a].cc;Q.Os(x.cc,x.io,Q.Ru,!1)}for(a=0;a<n.length;a++){k=n[a].io;if(0==k.length)b=C.mb(C.ej("%empty"));else if(1==k.length)b=k[0];else{l=[];for(b=0;b<k.length;b++)Q.fz(k[b])||l.push(b);if(l.length<k.length)for(b=0;b<l.length;b++)Q.ho(k[l[b]]);b=Q.AB(k)}m.push({B:n[a].B,Wb:n[a].Wb,Gc:b,cc:n[a].cc,ed:n[a].ed})}h.push.apply(h,
m);for(m=0;m<h.length;m++)h[m].B.Sc=h[m].cc,r(h[m].B,h[m].Gc);for(m=0;m<h.length;m++)if(b=h[m].B,"STATIC"==h[m].Wb.type&&"COLOR_ID"!=b.type)n=U.br(C.ej("%meta%"),"MESH",!0),n.e=h[m].Wb,n.o=[b],f.push(n);else for(k=[],a=0;a<h[m].ed.length;a++)if(n=h[m].ed[a],-1==k.indexOf(n.name)){for(l=0;l<n.o.length;l++)if(n.o[l]==b)throw"Batch already exist in object";n.o.push(b);k.push(n.name)}if(fa.wireframe_debug){for(m=0;m<h.length;m++)if(b=h[m].Wb,"DYNAMIC"==b.type&&(n=h[m].ed[0],-1<da.indexOf(h[m].B.type))){k=
!1;for(a=0;a<n.o.length;a++)n.o[a].Tg&&(k=!0);k||(a=M(b.Ef,b,n.name,!0,!0),n.o.push(a))}for(m=0;m<f.length;m++)n=f[m],b=n.e,-1<da.indexOf(n.o[0].type)&&(a=M(b.Yc,b,n.name,!1),n.o.push(a))}for(m=0;m<c.length;m++)for(a=0;a<c[m].o.length;a++)d(c[m].o[a]);for(m=0;m<f.length;m++)for(a=0;a<f[m].o.length;a++)d(f[m].o[a])};a.fy=function(a,b){var f=c("MAIN");L(f,"special_skydome.glslv","special_skydome.glslf");if(b.procedural_skydome)m(f,"PROCEDURAL_SKYDOME",1),f.hs=!0;else{var e=a.Un;if(e){m(f,"WO_SKYTEX",
1);var h=x(a.Ls,null);O(f,h,"u_sky");e.invert&&m(f,"MTEX_NEGATIVE",1);e.uC&&m(f,"MTEX_RGBTOINT",1);m(f,"BLENDTYPE",e.Ov);e.qC&&m(f,"WOMAP_BLEND",1);e.rC&&m(f,"WOMAP_HORIZ",1);e.tC&&m(f,"WOMAP_ZENUP",1);e.sC&&m(f,"WOMAP_ZENDOWN",1)}a.vC&&m(f,"WO_SKYBLEND",1);a.wC&&m(f,"WO_SKYPAPER",1);a.xC&&m(f,"WO_SKYREAL",1)}b.Vb&&(f.Vb=!0,b.Mb&&(f.Mb=!0));f.ng=99999;w(f,"a_position");e=S.ay();r(f,e);d(f);e=U.br(C.ej("%meta_sky%"),"MESH",!0);e.e=U.Oj("DYNAMIC");e.e.Vg=!0;e.e.Pb=J.Ld();e.e.Yc=J.mj();e.e.gb=J.Ld();
e.e.vb=J.mj();e.o=[f];return e};a.Sp=function(a,c){for(var d=[],f=ha.Ga(c,"SHADOW_CAST"),e=ha.Ga(c,"MAIN_PLANE_REFLECT"),h=ha.Ga(c,"MAIN_CUBE_REFLECT"),g=ha.Ga(c,"OUTLINE_MASK"),k=ha.Ga(c,"COLOR_PICKING"),l=0;l<a.o.length;l++){var m=a.o[l],n=null;"DEPTH"==m.type&&f&&m.Ec&&(n=b(m),n.Ja="SHADOW_CAST");"MAIN"!=m.type&&"PARTICLES"!=m.type||!e&&!h||m.Ca||!m.Vb||(n=b(m),n.Ja="REFLECT");"COLOR_ID"==m.type&&(g&&k?(n=b(m),n.Ja="OUTLINE"):g&&!k&&(m.Ja="OUTLINE"));n&&(n.Rf=!0,F(n,a.e.id),d.push(n))}a.o.push.apply(a.o,
d)};a.IC=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.Jv=k;a.my=x;a.UB=y;a.dp=function(a,b,c){c&&c.j.type==K.Hb&&m(a,"PERSPECTIVE_SHADOW_CAST",1);m(a,"CSM_SECTION0",0);m(a,"CSM_SECTION1",0);m(a,"CSM_SECTION2",0);m(a,"CSM_SECTION3",0);for(c=0;c<b.csm_num;c++)m(a,"CSM_SECTION"+String(c),1);m(a,"SHADOW_TEX_RES",Y.t(b.csm_resolution));m(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:
0);m(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.oa=m;a.xb=function(a,b){return Y.ty(a.Ab,b)};a.TB=F;a.Ng=O;a.qA=function(a,b,c){c=a.Gb.indexOf(c);-1<c&&(a.M[c]=b)};a.Vw=function(a,b){var d=c("MAIN");d.Ca=!0;ba.set(b[0],b[1],b[2],.5,d.Qc);d.ee=Q.qj;r(d,a);L(d,"main.glslv","main.glslf");m(d,"SHADELESS",1);B(d);return d};a.jb=B;a.bw=function(a){return a.Xb.Pi.length?a.Xb.En.u_cube_fog?!0:!1:!1};a.Hw=function(){var a=c("DEPTH_PACK");a.La=!0;a.Y=!1;var b=S.nb();r(a,b);L(a,"postprocessing/postprocessing.glslv",
"postprocessing/depth_pack.glslf");B(a);return a};a.Tp=function(a){var b=c("POSTPROCESSING");L(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":m(b,"POST_EFFECT","POST_EFFECT_NONE");break;case "GRAYSCALE":m(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");break;case "X_BLUR":m(b,"POST_EFFECT","POST_EFFECT_X_BLUR");break;case "Y_BLUR":m(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");break;case "X_GLOW_BLUR":m(b,"POST_EFFECT","POST_EFFECT_X_GLOW_BLUR");break;case "Y_GLOW_BLUR":m(b,
"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR");break;case "X_EXTEND":m(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");break;case "Y_EXTEND":m(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");break;default:throw"Wrong postprocessing effect: "+a;}b.La=!0;b.Y=!1;a=S.nb();r(b,a);B(b);return b};a.Yw=function(a){var b=c("SSAO");b.Y=!1;b.La=!0;var d=S.nb();r(b,d);L(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");m(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.Vs);m(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:ea.gy(a)};
d={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=x(a,d);O(b,a,"u_ssao_special_tex");B(b);return b};a.Zw=function(a){var b=c("SSAO_BLUR");b.Y=!1;b.La=!0;var d=S.nb();r(b,d);L(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");m(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);B(b);return b};
a.Iw=function(){var a=c("DOF");a.Y=!1;a.La=!0;var b=S.nb();r(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");m(a,"DEPTH_RGBA",1);B(a);return a};a.Qw=function(){var a=c("OUTLINE");a.Y=!1;a.La=!0;var b=S.nb();r(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/outline.glslf");B(a);return a};a.Kw=function(){var a=c("GLOW_COMBINE");a.Y=!1;a.La=!0;var b=S.nb();r(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");B(a);return a};a.Lw=function(a,
b,d){var f=c("GOD_RAYS");f.Y=!1;f.La=!0;var e=S.Wx();r(f,e);L(f,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");m(f,"DEPTH_RGBA",a?1:0);m(f,"WATER_EFFECTS",b?1:0);m(f,"STEPS_PER_PASS",Y.t(d,1));B(f);return f};a.Mw=function(){var a=c("GOD_RAYS_COM");a.Y=!1;a.La=!0;var b=S.nb();r(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");B(a);return a};a.Rw=function(){var a=c("SKY");a.Y=!1;a.La=!0;var b=S.Xx();r(a,b);L(a,"procedural_skydome.glslv","procedural_skydome.glslf");
m(a,"WATER_EFFECTS",1);B(a);return a};a.Bw=function(){var a=c("ANTIALIASING");a.Y=!1;a.La=!0;var b=S.nb();r(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");m(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");B(a);return a};a.Ww=function(a){var b=c("SMAA"),d=S.nb();r(b,d);L(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");m(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");m(b,"SMAA_PASS",a);m(b,"SMAA_PREDICATION",0);m(b,"SMAA_REPROJECTION",0);B(b);b.Y=!1;b.La=!0;return b};a.Fw=
function(){var a=c("COMPOSITING");a.Y=!1;a.La=!0;var b=S.nb();r(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");B(a);return a};a.Pw=function(){var a=c("MOTION_BLUR");a.La=!0;a.Y=!1;var b=S.nb();r(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");B(a);return a};a.zw=function(){var a=c("ANAGLYPH");a.La=!0;a.Y=!1;var b=S.nb();r(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");B(a);return a};a.Nw=function(){var a=
c("LUMINANCE");a.Y=!1;a.La=!0;var b=S.nb();r(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");B(a);return a};a.Cw=function(){var a=c("LUMINANCE");a.Y=!1;a.La=!0;var b=S.nb();r(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");B(a);return a};a.Ow=function(){var a=c("LUMINANCE_X_BLUR");a.Y=!1;a.La=!0;var b=S.nb();r(a,b);L(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");B(a);return a};a.Dw=function(){var a=
c("POSTPROCESSING");a.La=!0;a.Y=!1;var b=S.nb();r(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");B(a);return a};a.Ew=function(){var a=c("BLOOM");a.Y=!1;a.La=!0;var b=S.nb();r(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");B(a);return a};a.bx=function(){var a=c("VELOCITY");a.Y=!1;a.La=!0;var b=S.nb();r(a,b);L(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");B(a);return a};a.Aw=function(){var a=c("ANCHOR_VISIBILITY");
a.Y=!0;a.La=!0;a.ee=Q.Ko;L(a,"anchors.glslv","anchors.glslf");var b=S.yq(1);r(a,b);m(a,"ANCHOR_NUM",1);B(a);a.Ti=new Float32Array([0,0,0]);return a};a.SB=function(a,b){var c=b.length/3;if(c!=a.Ti.length/3){var d=S.yq(c);r(a,d);m(a,"ANCHOR_NUM",c);B(a)}a.Ti=b};a.la=function(a,b,c){for(var d=0;d<a.o.length;d++)if(a.o[d].type==c&&!a.o[d].Rf&&-1!=a.o[d].Sc.indexOf(b))return a.o[d];return null};a.tc=function(a,b,c){for(var d=0;d<a.o.length;d++)if(a.o[d].type==c&&a.o[d].Rf&&-1!=a.o[d].Sc.indexOf(b))return a.o[d];
return null};a.As=function(a,b){a.Qc.set(b.Qc);a.Ne=b.Ne;a.Cd.set(b.Cd);a.jc.set(b.jc);a.fe=b.fe;a.Rd=b.Rd;a.Me=b.Me;a.Ge=b.Ge;a.reflect_factor=b.reflect_factor;a.ad.set(b.ad);a.parallax_scale=b.parallax_scale;a.shallow_water_col.set(b.shallow_water_col);a.shallow_water_col_fac=b.shallow_water_col_fac;a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.Uh=b.Uh};a.vD=function(a,b){for(var c=a.o,d=0;d<c.length;d++)if(c[d].type==b)return!0;
return!1};a.qw=function(a){for(var b=a.M,c=0;c<b.length;c++)ea.px(b[c].Za);Q.Fp(a.T)}};b4w.module.__nodemat=function(a,p){function c(a,g,l,r,v){var x;a:switch(v){case "GLOW":x=g+"11";break a;case "COLOR_ID":case "DEPTH":x=g+"00";break a;default:x=g+"10"}if(x in G)return G[x];if("DEPTH"!=v&&"COLOR_ID"!=v){var z=C.create(),w=a.nodes,p=a.links;g=a.animation_data;for(var u=0;u<w.length;u++)if(!m(z,w[u],0,g,r,v))return G[x]=null;if(l&&-1==q(a,z,"GROUP_OUTPUT","group"))return null;u=pa(z);if(!S(z,p,u))return null;if(l)return z;for(u=0;u<p.length;u++){l=p[u];for(var w=n(l.from_node,z),W=n(l.to_node,
z),D=0;D<w.length;D++)for(var J=0;J<W.length;J++){var A=w[D],aa=W[J],K=C.Ta(z,A),E=C.Ta(z,aa);if(!la(z,A,aa,K,E,l))return G[x]=null}}k(z);a="GLOW"==v?q(a,z,"B4W_GLOW_OUTPUT","material",!0):q(a,z,"OUTPUT","material",!1,!0);-1==a&&(z=b(),a=0);f(z);a=C.fo(z,a,C.il);e(a);t(a);y(a);h(a,g,r,v)}else r=c(a,g,l,r,"MAIN"),r=C.clone(r,function(a){var b=ba.fi(a);b.G=ba.ka(a.G);b.xa=ba.ka(a.xa);return b}),a=q(a,r,"OUTPUT","material",!1,!0),d(r,a),a=C.fo(r,a,C.il),e(a);return G[x]=a}function d(a,b){C.Hd(a,function(c,
d,f){var e=C.Ta(a,d);d==b&&"Color"==e.G[f[1]].identifier&&C.ss(a,c,d,f)})}function b(){var a=C.create(),b={data:null,be:[],Va:[],G:[{va:new Float32Array([0,0,0]),identifier:"Color",ob:!1,name:"Color"},{va:1,identifier:"Alpha",ob:!1,name:"Alpha"}],xa:[],type:"OUTPUT",Th:[]};C.Aj(a,0,b);return a}function e(a){C.R(a,function(b,c){for(var d=c.G,f=c.xa,e=0;e<d.length;e++)g(a,d[e],b,e,1);for(e=0;e<f.length;e++)g(a,f[e],b,e,0)})}function g(a,b,c,d,f){if(b.ob){var e=!0;C.Hd(a,function(a,b,h){if(!f&&a==c&&
h[0]==d||f&&b==c&&h[1]==d)e=!1});e&&(b.ob=!1)}}function h(a,b,c,d){var f=[];C.Hd(a,function(e,h,g){var k=C.Ta(a,e),l=C.Ta(a,h),k=ba.is_vector(k.xa[g[0]].va),l=ba.is_vector(l.G[g[1]].va);if(k!=l){var n,q={default_value:[0,0,0],identifier:"Vector",is_linked:!0,name:"Vector"},r={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};k&&!l?n=w("vector_to_scalar","B4W_VECTOSCAL",[q],[r]):!k&&l&&(n=w("scalar_to_vector","B4W_SCALTOVEC",[r],[q]));m(a,n,0,b,c,d);f.push([e,h,a.N[a.N.length-2],g])}});
for(var e=0;e<f.length;++e)C.ss(a,f[e][0],f[e][1],f[e][3]),C.Xc(a,f[e][0],f[e][2],[f[e][3][0],0]),C.Xc(a,f[e][2],f[e][1],[0,f[e][3][1]])}function k(a){var b=[];C.R(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":C.Hd(a,function(a,f,e){a==c&&"Translucency"==d.xa[e[0]].name&&b.push(a,f,[e[0]+1,e[1]+1])})}});for(var c=0;c<b.length;c+=3)C.Xc(a,b[c],b[c+1],b[c+2])}function n(a,b){var c=[];C.R(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function f(a){var b=
[];C.R(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],f=b[c+1];if("B4W_PARALLAX"==f.type){var e=l(a,d);if(-1!=e){var h=C.$j(a,e,0);C.vg(a,e,d,-1);-1!=h&&C.vg(a,h,e,-1);d=C.Ta(a,e);f.data=d.data;f.Va[0]=d.Va[0];C.vh(a,e)}f.G.splice(1,1)}else if("REROUTE"==f.type){for(var f=C.$j(a,d,0),g=C.qg(a,d),e=[],h=[],k=[],m=0;m<g;m++){var n=C.Wf(a,d,m),q=h.indexOf(n);-1!=q?k[q]+=1:(h.push(n),k.push(1),e.push(d,n))}if(-1!=f)for(g=C.Vf(a,f,d,0)[0],
m=0;m<h.length;m++)for(n=0;n<k[m];n++)q=C.Vf(a,d,h[m],n)[1],C.Xc(a,f,h[m],[g,q]);for(m=0;m<e.length;m+=2)C.vg(a,e[m],e[m+1],-1)}}}function l(a,b){for(var c=a.U,d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function t(a){z(a);A(a);x(a)}function x(a){var b=[],c="",d="",f={};C.R(a,function(a,e){if("GEOMETRY_UV"==e.type||"UVMAP"==e.type||"TEX_COORD_UV"==e.type){b.push(a,e);var h=e.data.value;c?c==h||d||(d=h,f[d]=0):(c=h,f[c]=0);f[h]++}});for(var e in f)if(2>f[e]){for(var h=0;h<b.length;h+=
2)b[h+1].data.value==e&&b.splice(h,2);delete f[e];c==e&&(c=d,d="");d==e&&(d="")}if(!(3>b.length)){var h={default_value:[0,0,0],identifier:"UV_geom",is_linked:!1,name:"UV_geom"},g={default_value:[0,0,0],identifier:"UV_cycles",is_linked:!1,name:"UV_cycles"};e=w("merged_uv","UV_MERGED",[],[h,g]);e.uv_layer=c;m(a,e,0,null,"",void 0);var k=a.N[a.N.length-2];e=a.N[a.N.length-1];if(d){g=w("merged_uv","UV_MERGED",[],[h,g]);g.uv_layer=d;m(a,g,0,null,"",void 0);var l=a.N[a.N.length-2],g=a.N[a.N.length-1]}else g=
null;for(var n=-1,q=null,h=0;h<b.length;h+=2){var r=b[h],t=b[h+1];u(t,b[1])?(n=k,q=e):g&&(n=l,q=g);for(var v=[],x=C.qg(a,r),z={},p=0;p<x;p++){var y=C.Wf(a,r,p);y in z||(z[y]=0);var G=C.Vf(a,r,y,z[y]++);v.push(r,y,G);G=G.splice(0,G.length);switch(t.type){case "GEOMETRY_UV":G[0]=0;q.xa[0].ob=!0;break;case "UVMAP":case "TEX_COORD_UV":G[0]=1,q.xa[1].ob=!0}C.Xc(a,n,y,G)}for(var p=0;p<v.length;p+=3)C.vg(a,v[p],v[p+1],0);C.vh(a,r)}}}function z(a){var b=[];C.R(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_NO"!=
c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type&&"GEOMETRY_LO"!=c.type&&"GEOMETRY_OR"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var f=b[d],e=b[d+1],h=!0,g=0;g<c.length;g++){var k=c[g];if(H(e,k.nc)){h=[];g=C.qg(a,f);for(n=0;n<g;n++){var l=C.Wf(a,f,n),m=C.Vf(a,f,l,0);h.push(f,l,m);C.Xc(a,k.id,l,m)}for(var n=0;n<h.length;n+=3)C.vg(a,h[n],h[n+1],0);C.vh(a,f);h=!1;break}}h&&(k={id:f,nc:e},c.push(k))}}function D(a){for(var b={},c=0;c<a.N.length;c+=2)b[a.N[c]]=
[];for(c=0;c<a.U.length;c+=3){var d=a.U[c],f=a.U[c+1];b[f].push(d);b[f].push.apply(b[f],b[d])}return b}function A(a){var b=[];C.R(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=D(a),d=[],f=0;f<b.length;f+=2){for(var e=b[f],h=b[f+1],g=!0,k=0;k<d.length;k++){var l=d[k];if(!(3<=l.oh.length||!H(h,l.nc)||-1<c[e].indexOf(l.id)||-1<c[l.id].indexOf(e))){for(var m=!1,n=0;n<l.oh.length;n++){var q=l.oh[n].id;if(-1<c[e].indexOf(q)||-1<c[q].indexOf(e)){m=
!0;break}}if(!m){for(var k=[],q=C.ar(a,e),r={},n=0;n<q;n++)m=C.$j(a,e,n),m in r||(r[m]=0),g=C.Vf(a,m,e,r[m]++),k.push(m,e,g);for(var q=[],r=C.qg(a,e),t={},n=0;n<r;n++)m=C.Wf(a,e,n),m in t||(t[m]=0),g=C.Vf(a,e,m,t[m]++),q.push(e,m,g);g=k.concat(q);for(n=0;n<g.length;n+=3)C.vg(a,g[n],g[n+1],0);C.vh(a,e);n={id:e,nc:h,xx:k,yx:q};l.oh.push(n);g=!1;break}}}g&&(l={id:e,nc:h,oh:[]},d.push(l))}for(f=0;f<d.length;f++){l=d[f];c=l.oh.length;for(k=0;k<c;k++){h=l.oh[k];n=h.nc;e=h.xx;h=h.yx;l.nc.G[k+1].ob=n.G[0].ob;
l.nc.G[k+1].va=n.G[0].va;l.nc.xa[2*(k+1)].ob=n.xa[0].ob;l.nc.xa[2*(k+1)].va=n.xa[0].va;l.nc.xa[2*(k+1)+1].ob=n.xa[1].ob;l.nc.xa[2*(k+1)+1].va=n.xa[1].va;for(n=0;n<e.length;n+=3)m=e[n],g=e[n+2],g[1]+=k+1,C.Xc(a,m,l.id,g);for(n=0;n<h.length;n+=3)m=h[n+1],g=h[n+2],g[0]+=2*(k+1),C.Xc(a,l.id,m,g);l.nc.be.push(["USE_uv"+(k+2),1])}C.vh(a,l.id);C.Aj(a,l.id,l.nc)}}}function H(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":case "GEOMETRY_LO":case "GEOMETRY_OR":return!0;
case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function u(a,b){var c=["GEOMETRY_UV","TEX_COORD_UV","UVMAP"];return-1!=c.indexOf(a.type)&&-1!=c.indexOf(b.type)?a.data.value==b.data.value:!1}function y(a){var b=[];C.R(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],f=b[c+1],e=!1,h=[],g=[],k=[[],[],[]],l=C.qg(a,d),m=0;m<l;m++){var n=C.Wf(a,d,m);if("SEPRGB"!=C.Ta(a,n).type){e=!1;break}h.push(d,n);for(var q=
{},r=C.qg(a,n),e=0;e<r;e++){var t=C.Wf(a,n,e);t in q||(q[t]=0);var v=C.Vf(a,n,t,q[t]++);h.push(n,t);k[v[0]].push(d,t,v)}g.push(n);e=!0}if(e){for(m=d=l=0;m<k.length;m++)k[m].length&&(l++,d|=1<<2-m);if(l){f.type+=l;f.xa=[];for(m=0;m<k.length;m++)if(k[m].length)for(f.xa.push({va:0,identifier:"RGB"[m],ob:!0,name:"RGB"[m]}),e=0;e<k[m].length;e+=3)k[m][e+2][0]=ba.Zi(d,m);for(m=0;m<h.length;m+=2)C.vg(a,h[m],h[m+1],0);for(m=0;m<g.length;m++)C.vh(a,g[m]);for(m=0;m<k.length;m++)for(e=0;e<k[m].length;e+=3)C.Xc(a,
k[m][e],k[m][e+1],k[m][e+2])}}}}function q(a,b,c,d,f,e){a=a.nodes;for(var h=null,g=0;g<a.length;g++){var k=a[g];f?"GROUP"==k.type&&k.node_tree_name==c&&(h=k):k.type==c&&(h=k)}return h?n(h,b)[0]:(e||Z.error('No "'+c+'" node in node '+d),-1)}function w(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function m(a,b,c,d,f,e){var h=b.name,g=b.type,k=[],l=[],n=[],q=[],t=null,v=[];switch(g){case "BSDF_ANISOTROPIC":case "BSDF_DIFFUSE":case "BSDF_GLOSSY":case "BSDF_GLASS":case "BSDF_HAIR":case "BSDF_TRANSPARENT":case "BSDF_TRANSLUCENT":case "BSDF_REFRACTION":case "BSDF_TOON":case "BSDF_VELVET":case "SUBSURFACE_SCATTERING":case "EMISSION":case "AMBIENT_OCCLUSION":case "VOLUME_ABSORPTION":case "VOLUME_SCATTER":case "BUMP":case "NORMAL_MAP":case "VECT_TRANSFORM":case "BLACKBODY":case "WAVELENGTH":case "SEPXYZ":case "COMBXYZ":case "LIGHT_FALLOFF":case "TEX_IMAGE":case "TEX_ENVIRONMENT":case "TEX_SKY":case "TEX_NOISE":case "TEX_WAVE":case "TEX_MUSGRAVE":case "TEX_GRADIENT":case "TEX_MAGIC":case "TEX_CHECKER":case "TEX_BRICK":case "WIREFRAME":case "LAYER_WEIGHT":case "TANGENT":case "LIGHT_PATH":case "ATTRIBUTE":case "HOLDOUT":case "PARTICLE_INFO":case "HAIR_INFO":case "OBJECT_INFO":case "SCRIPT":case "NEW_GEOMETRY":l=
T(b);n=Q(b);Z.warn(g+" node is not fully supported.");break;case "BRIGHTCONTRAST":case "ADD_SHADER":case "MIX_SHADER":l=T(b);n=Q(b);break;case "UVMAP":var t=F("param_"+g+"_a"),x=F("param_"+g+"_v");k.push(X(t));k.push(X(x));n=Q(b);q.push(X(x));t={name:t,value:b.uv_layer};break;case "UV_MERGED":t=F("param_UV_MERGED_a");x=F("param_UV_MERGED_v");k.push(X(t));k.push(X(x));n.push(K(b,"UV_geom"));n.push(K(b,"UV_cycles"));q.push(X(x));t={name:t,value:b.uv_layer};break;case "CAMERA":l=[];n=Q(b);break;case "COMBRGB":case "COMBHSV":l=
T(b);n=Q(b);break;case "CURVE_RGB":l=T(b);n=Q(b);Z.warn("CURVE_RGB node is not fully supported.");break;case "CURVE_VEC":l=T(b);n=Q(b);Z.warn("CURVE_VEC node is not fully supported.");break;case "GEOMETRY":if(!M(b))return!0;g=L(b,c);if(!g)return Z.error("Geometry output is not supported"),!1;switch(g){case "GEOMETRY_UV":if(!b.uv_layer)return Z.error('Missing uv layer in node "',b.name,'"'),!1;t=F("param_GEOMETRY_UV_a");x=F("param_GEOMETRY_UV_v");k.push(X(t));k.push(X(x));n.push(K(b,"UV"));q.push(X(x));
t={name:t,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return Z.error("Missing vertex color layer in node ",b.name),!1;t=F("param_GEOMETRY_VC_a");x=F("param_GEOMETRY_VC_v");k.push(X(t));k.push(X(x));n.push(K(b,"Vertex Color"));q.push(X(x));t={name:t,value:b.color_layer};break;case "GEOMETRY_NO":n.push(K(b,"Normal"));break;case "GEOMETRY_FB":n.push(K(b,"Front/Back"));break;case "GEOMETRY_VW":n.push(K(b,"View"));break;case "GEOMETRY_GL":n.push(K(b,"Global"));break;case "GEOMETRY_LO":n.push(K(b,
"Local"));break;case "GEOMETRY_OR":x=F("param_GEOMETRY_OR_v"),k.push(X(x)),n.push(K(b,"Orco")),q.push(X(x))}break;case "TEX_COORD":if(!M(b))return!0;g=O(b,c);if(!g)return Z.error("Texture coordinate output is not supported"),!1;switch(g){case "TEX_COORD_UV":t=F("param_TEX_COORD_UV_a");x=F("param_TEX_COORD_UV_v");k.push(X(t));k.push(X(x));n.push(K(b,"UV"));q.push(X(x));t={name:t,value:b.uv_layer};break;case "TEX_COORD_NO":n.push(K(b,"Normal"));break;case "TEX_COORD_GE":x=F("param_TEX_COORD_GE_v");
k.push(X(x));n.push(K(b,"Generated"));q.push(X(x));break;case "TEX_COORD_OB":n.push(K(b,"Object"));Z.warn('Output "Object" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_CA":n.push(K(b,"Camera"));break;case "TEX_COORD_WI":n.push(K(b,"Window"));Z.warn('Output "Window" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_RE":n.push(K(b,"Reflection")),Z.warn('Output "Reflection" of node "Texture Coordinate" doesn\'t supported fully.')}break;case "GROUP":x=
b.node_tree_name;switch(x){case "B4W_LINEAR_TO_SRGB":if(!r(b,[1],[1])){t=E(b,f,e);break}g="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!r(b,[1],[1])){t=E(b,f,e);break}g="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!r(b,[1],[1])){t=E(b,f,e);break}g="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!r(b,[1,1],[1])){t=E(b,f,e);break}g="B4W_REFLECT";break;case "B4W_REFRACTION":if(!r(b,[1,0],[1])){t=E(b,f,e);break}g="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!r(b,
[1,1,0,0,0],[1])){t=E(b,f,e);break}var g="B4W_PARALLAX",z=F("temp_texture");q.push(X(z));break;case "B4W_CLAMP":if(!r(b,[1],[1])){t=E(b,f,e);break}g="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!r(b,[0,0,0,0,0],[0])){t=E(b,f,e);break}g="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!r(b,[],[0])){t=E(b,f,e);break}g="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!r(b,[0,0,0],[0])){t=E(b,f,e);break}g="B4W_SMOOTHSTEP";break;case "B4W_GLOW_OUTPUT":g="B4W_GLOW_OUTPUT";break;default:t=E(b,f,e)}l=T(b);n=Q(b);"B4W_TRANSLUCENCY"==
x&&(x=R("TranslucencyParams","TranslucencyParams",[0,0,0,0]),x.ob=n[0].ob,n.push(x));break;case "LAMP":t=b.lamp;if(!t)return Z.error("There is no lamp in node: "+b.name),!1;n.push(K(b,"Color"));n.push(K(b,"Light Vector"));n.push(K(b,"Distance"));n.push(K(b,"Visibility Factor"));t.uuid in oa?v.push(["LAMP_INDEX",String(oa[t.uuid])]):(oa[t.uuid]=Ka,v.push(["LAMP_INDEX",String(Ka++)]));t=oa;break;case "NORMAL":l=T(b);n=Q(b);x=K(b,"Normal");q.push(X(F("param_NORMAL_Normal"),x.va,3));break;case "MAPPING":x=
b.vector_type;g="MAPPING";l.push(J(b,"Vector"));n.push(K(b,"Vector"));var z=b.rotation,w=b.scale,p=b.translation,u=da.create(),y=ba.Bx(z);"TEXTURE"==x&&(w[0]=w[0]||1,w[1]=w[1]||1,w[2]=w[2]||1);var G=new Float32Array([w[0],0,0,0,w[1],0,0,0,w[2]]);da.multiply(y,G,u);u=ba.xz(u,aa.create());switch(x){case "POINT":u[12]=p[0];u[13]=p[1];u[14]=p[2];break;case "TEXTURE":u[12]=p[0];u[13]=p[1];u[14]=p[2];u=aa.invert(u,u);break;case "NORMAL":aa.invert(u,u),aa.transpose(u,u)}switch(x){case "NORMAL":v.push(["MAPPING_IS_NORMAL",
1]);case "TEXTURE":v.push(["MAPPING_TRS_MATRIX",W.t(u,16)]);break;case "POINT":0!==fa.length(z)?v.push(["MAPPING_TRS_MATRIX",W.t(u,16)]):(0!==fa.length(w)&&v.push(["MAPPING_SCALE",W.t(w,3)]),0!==fa.length(p)&&v.push(["MAPPING_TRANSLATION",W.t(p,3)]));break;case "VECTOR":0!==fa.length(z)?v.push(["MAPPING_TRS_MATRIX",W.t(u,16)]):0!==fa.length(w)&&v.push(["MAPPING_SCALE",W.t(w,3)])}b.use_min&&v.push(["MAPPING_MIN_CLIP",W.t(b.min,3)]);b.use_max&&v.push(["MAPPING_MAX_CLIP",W.t(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":t=
J(b,"Color");t.va.splice(3);l.push(t);t=J(b,"Spec");t.va.splice(3);l.push(t);l.push(R("DiffuseIntensity","DiffuseIntensity",b.diffuse_intensity));x=J(b,"Normal");x.va.splice(3);l.push(x);n.push(K(b,"Color"));n.push(K(b,"Alpha"));n.push(K(b,"Normal"));"MATERIAL_EXT"==g?((t=J(b,"Emit"))?l.push(t):l.push(R("Emit","Emit",0)),t=J(b,"Translucency"),t.va=0,t.name="Translucency",t.identifier="Translucency",t?l.push(t):l.push(R(t.name,t.identifier,t.va)),t=J(b,"Translucency"),t.va=[0,0,0,0],t.name="TranslucencyParams",
t.identifier="TranslucencyParams",t?l.push(t):l.push(R(t.name,t.identifier,t.va)),t=J(b,"Reflectivity"),z=J(b,"Ray Mirror"),t?z="Reflectivity":z?(t=z,z="Ray Mirror"):z="Reflectivity",t?l.push(t):l.push(R(z,z,0)),(t=J(b,"SpecTra"))?l.push(t):l.push(R("SpecTra","SpecTra",0)),(t=J(b,"Alpha"))?l.push(t):l.push(R("Alpha","Alpha",b.alpha)),n.push(K(b,"Diffuse")),n.push(K(b,"Spec"))):(q.push(X(F("param_MATERIAL_alpha"),b.alpha)),q.push(X(F("param_MATERIAL_spec_alpha"),b.specular_alpha)));z=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":t=
b.specular_hardness;break;case "WARDISO":t=b.specular_slope;break;case "TOON":t=b.specular_toon_size;z=b.specular_toon_smooth;break;case "BLINN":t=b.specular_ior;z=b.specular_hardness;break;default:Z.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.material_name+'")'),t=b.specular_hardness}switch(b.diffuse_shader){case "LAMBERT":p=w=0;break;case "OREN_NAYAR":w=b.roughness;p=0;break;case "FRESNEL":w=b.diffuse_fresnel;p=b.diffuse_fresnel_factor;break;case "MINNAERT":w=b.darkness;
p=0;break;case "TOON":w=b.diffuse_toon_size;p=b.diffuse_toon_smooth;break;default:Z.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),p=w=0}q.push(X(F("param_MATERIAL_diffuse"),[w,p],2));q.push(X(F("param_MATERIAL_spec"),[b.specular_intensity,t,z],3));t={name:b.name,value:{nB:b.specular_shader,sx:b.diffuse_shader,kd:b.use_shadeless}};x.ob&&v.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&v.push(["USE_MATERIAL_DIFFUSE",1]);b.use_specular&&v.push(["USE_MATERIAL_SPECULAR",
1]);break;case "MATH":switch(b.operation){case "ADD":g="MATH_ADD";break;case "SUBTRACT":g="MATH_SUBTRACT";break;case "MULTIPLY":g="MATH_MULTIPLY";break;case "DIVIDE":g="MATH_DIVIDE";break;case "SINE":g="MATH_SINE";break;case "COSINE":g="MATH_COSINE";break;case "TANGENT":g="MATH_TANGENT";break;case "ARCSINE":g="MATH_ARCSINE";break;case "ARCCOSINE":g="MATH_ARCCOSINE";break;case "ARCTANGENT":g="MATH_ARCTANGENT";break;case "POWER":g="MATH_POWER";break;case "LOGARITHM":g="MATH_LOGARITHM";break;case "MINIMUM":g=
"MATH_MINIMUM";break;case "MAXIMUM":g="MATH_MAXIMUM";break;case "ROUND":g="MATH_ROUND";break;case "LESS_THAN":g="MATH_LESS_THAN";break;case "GREATER_THAN":g="MATH_GREATER_THAN";break;case "MODULO":g="MATH_MODULO";break;case "ABSOLUTE":g="MATH_ABSOLUTE";break;default:return Z.error("Unsupported MATH operation: "+b.operation),!1}v.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);l=T(b);n=Q(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":g="MIX_RGB_MIX";break;case "ADD":g="MIX_RGB_ADD";break;case "MULTIPLY":g=
"MIX_RGB_MULTIPLY";break;case "SUBTRACT":g="MIX_RGB_SUBTRACT";break;case "SCREEN":g="MIX_RGB_SCREEN";break;case "DIVIDE":g="MIX_RGB_DIVIDE";break;case "DIFFERENCE":g="MIX_RGB_DIFFERENCE";break;case "DARKEN":g="MIX_RGB_DARKEN";break;case "LIGHTEN":g="MIX_RGB_LIGHTEN";break;case "OVERLAY":g="MIX_RGB_OVERLAY";break;case "DODGE":g="MIX_RGB_DODGE";break;case "BURN":g="MIX_RGB_BURN";break;case "HUE":g="MIX_RGB_HUE";break;case "SATURATION":g="MIX_RGB_SATURATION";break;case "VALUE":g="MIX_RGB_VALUE";break;
case "COLOR":g="MIX_RGB_COLOR";break;case "SOFT_LIGHT":g="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":g="MIX_RGB_LINEAR_LIGHT";break;default:return Z.error("Unsupported MIX_RGB blend type: "+b.blend_type),!1}v.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);l=T(b);n=Q(b);break;case "OUTPUT":l=T(b);n=[];break;case "RGB":x=f+"%join%"+b.name;x={name:"-1",value:x};q.push(x);n.push(K(b,"Color"));break;case "SEPRGB":case "SEPHSV":l=T(b);n=Q(b);break;case "TEXTURE":g=B(b);if("TEXTURE_EMPTY"==g)n.push(K(b,
"Color")),n.push(K(b,"Normal")),n.push(K(b,"Value"));else if("TEXTURE_ENVIRONMENT"==g)l.push(J(b,"Vector")),n.push(K(b,"Color")),n.push(K(b,"Value"));else{if("TEXTURE_NORMAL"==g&&"ENVIRONMENT_MAP"==b.texture.type)return Z.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),!1;for(w=0;4>w;++w)w?(t=R("Vector"+w,"Vector"+w,[0,0,0]),"TEXTURE_COLOR"==g&&(x=R("Color"+w,"Color"+w,[0,0,0]),z=R("Value"+w,"Value"+w,0)),"TEXTURE_NORMAL"==g&&(x=R("Normal"+w,"Normal"+w,[0,0,0]),z=R("Value"+w,"Value"+w,
0))):(t=J(b,"Vector"),"TEXTURE_COLOR"==g&&(x=K(b,"Color"),z=K(b,"Value")),"TEXTURE_NORMAL"==g&&(x=K(b,"Normal"),z=K(b,"Value"))),l.push(t),n.push(x),n.push(z)}z=F("param_TEXTURE_texture");q.push(X(z));t={name:z,value:b.texture};break;case "VALTORGB":l=T(b);n=Q(b);Z.warn("VALTORGB node is not fully supported.");break;case "VALUE":g="VALUE";x=f+"%join%"+b.name;x={name:"-1",value:x};q.push(x);n.push(K(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":g="VECT_MATH_ADD";break;case "SUBTRACT":g=
"VECT_MATH_SUBTRACT";break;case "AVERAGE":g="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":g="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":g="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":g="VECT_MATH_NORMALIZE";break;default:return Z.error("Unsupported VECT_MATH operation: "+b.operation),!1}l=T(b);n=Q(b);break;default:l=T(b),n=Q(b)}h={name:h,type:g,Th:k,G:l,xa:n,Va:q,data:t,be:v};C.Aj(a,C.wq(a),h);if(!(h="GEOMETRY"!=b.type&&"TEX_COORD"!=b.type)){a:{h=b.outputs;for(k=g=0;k<h.length;k++)if(h[k].is_linked&&
g++>c){h=!0;break a}h=!1}h=!h}return h||m(a,b,++c,d,f,e)?!0:!1}function r(a,b,c){for(var d=a.inputs,f=a.outputs,e=a.node_tree_name,h=0;h<b.length;h++){var g=d[h],k=b[h];if(!g||g.default_value instanceof Array!=k)return Z.warn('Wrong inputs for custom node group "'+a.name+'" of type: "',e,'".Processing as general node group.'),!1}for(h=0;h<c.length;h++)if(b=f[h],d=c[h],!b||b.default_value instanceof Array!=d)return Z.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',e,'".Processing as general node group.'),
!1;return!0}function E(a,b,d){var f=a.node_group.node_tree,e={},h;for(h in f)if("links"==h||"nodes"==h){e[h]=[];for(var g=0;g<f[h].length;g++){e[h][g]={};for(var k in f[h][g])if("links"==h){e[h][g][k]={};for(var l in f[h][g][k])e[h][g][k][l]=I(f[h][g][k][l])}else e[h][g][k]=I(f[h][g][k])}}else e[h]=I(f[h]);f=a.node_tree_name;if("B4W_REPLACE"==f||"B4W_LEVELS_OF_QUALITY"==f)h=w("Group input","GROUP_INPUT",[],a.inputs),g=w("Group output","GROUP_OUTPUT",a.outputs,[]),k=null,k="B4W_REPLACE"==f||"B4W_LEVELS_OF_QUALITY"==
f&&(N.quality==ma.P_LOW||N.Am)?{from_node:h,from_socket:h.outputs[1],to_node:g,to_socket:g.inputs[0]}:{from_node:h,from_socket:h.outputs[0],to_node:g,to_socket:g.inputs[0]},e.nodes=[h,g],e.links=[k];f=a.name;h=e.nodes;g=e.links;for(k=0;k<h.length;k++)h[k].name=U(h[k].type,f,h[k].name);for(k=0;k<g.length;k++)g[k].from_node.name=U(g[k].from_node.type,f,g[k].from_node.name),g[k].to_node.name=U(g[k].to_node.type,f,g[k].to_node.name);return{Hz:c(e,a.node_group.uuid,!0,b,d),Iz:e.links}}function I(a){var b=
typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?ba.fi(a):a}function F(a){v[a]||(v[a]=0);var b=a+v[a],b=b.replace(/ /g,"_").replace(/\//g,"_");v[a]++;return b}function M(a){a=a.outputs;for(var b=0;b<a.length;b++)if(a[b].is_linked)return!0;return!1}function L(a,b){for(var c=a.outputs,d=0,f=0;f<c.length;f++){var e=c[f];if(e.is_linked&&!(d++<b))switch(e.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";
case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";case "Local":return"GEOMETRY_LO";case "Orco":return"GEOMETRY_OR";default:return null}}}function O(a,b){for(var c=a.outputs,d=0,f=0;f<c.length;f++){var e=c[f];if(e.is_linked&&!(d++<b))switch(e.identifier){case "Camera":return"TEX_COORD_CA";case "Generated":return"TEX_COORD_GE";case "Normal":return"TEX_COORD_NO";case "Object":return"TEX_COORD_OB";case "Reflection":return"TEX_COORD_RE";case "UV":return"TEX_COORD_UV";case "Window":return"TEX_COORD_WI";
default:return null}}}function B(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,f=!1,e=0;e<b.length;e++){var h=b[e];if(h.is_linked)switch(h.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":f=!0;break;default:throw"Unknown texture output";}}if(c)return d&&Z.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(f)return"ENVIRONMENT_MAP"==
a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function J(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var f=c[d];if(f.identifier==b)return P(f)}return null}function K(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var f=c[d];if(f.identifier==b)return P(f)}return null}function P(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=ba.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,ob:d,va:a}}function R(a,b,c){return{name:a,identifier:b,ob:!1,va:c}}function T(a){for(var b=[],c=
0;c<a.inputs.length;c++){var d=P(a.inputs[c]);d.va.length&&d.va.splice(3);b.push(d)}return b}function Q(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=P(a.outputs[c]);b.push(d)}return b}function X(a,b,c){b=null===b||void 0===b?null:W.t(b,c);return{name:a,value:b}}function la(a,b,c,d,f,e){var h=[],g=e.from_socket.identifier;e=e.to_socket.identifier;var k=d.xa;for(d=0;d<k.length;d++)if(k[d].identifier==g){h.push(d);break}f=f.G;for(d=0;d<f.length;d++)if(f[d].identifier==e){h.push(d);break}2==h.length&&
C.Xc(a,b,c,h);return!0}function U(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function pa(a){var b=[];C.R(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function S(a,b,c){for(var d=0;d<c.length;d++){var f=c[d].data.Hz,e=c[d].data.Iz;if(!f)return!1;C.R(f,function(b,c){C.Aj(a,C.wq(a),c)});for(f=0;f<e.length;f++)b.push(e[f]);ea(c[d],b,a)}return!0}function qa(a,b,c,d,f,e){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+
"*GI*")||f.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||e.push(c)}}function ga(a,b,c){for(var d=[],f=0;f<c.length;f++){for(var e=c[f],h=null,g=0;g<b.length;g++)if(e.from_socket.identifier==b[g].to_socket.identifier){h=b[g];break}h?(e.from_node=h.from_node,e.from_socket=h.from_socket):d.push(e)}for(f=0;f<b.length;f++)a.splice(a.indexOf(b[f]),1);return d}function ha(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function Y(a,b,c,
d){for(var f=0;f<d.length;f++){for(var e=d[f],h,g=0;g<c.G.length;g++)if(e.from_socket.identifier==c.G[g].identifier){h=c.G[g].va;break}for(var g=e,k=b,l=h,m=n(g.to_node,k),q=0;q<m.length;q++)for(var t=C.Ta(k,m[q]),r=0;r<t.G.length;r++)if(t.G[r].identifier==g.to_socket.identifier){t.G[r].va=l;break}e=a.indexOf(e);-1!=e&&a.splice(e,1)}}function ea(a,b,c){for(var d=a.name,f=[],e=[],h=[],g=[],k=0;k<b.length;k++){var l=b[k];qa(l.from_node,d,l,f,h,g);qa(l.to_node,d,l,e,h,g)}e=ga(b,e,h);f=ga(b,g,f);ha(b,
e);Y(b,c,a,e);if(f.length){var m;C.R(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(m=b)});Y(b,c,m,f)}}var Z=p("__print"),C=p("__graph"),W=p("__shaders"),ba=p("__util"),ma=p("__config"),fa=p("vec3");p("vec4");var da=p("mat3"),aa=p("mat4"),v={},G={},oa={},Ka=0;new Float32Array(4);var N=ma.p;a.sw=c;a.tw=function(a){var b=[],c={};v={};var d=C.po(a);C.R(d,function(a,d){var f;f=[];for(var e=[],h=[],g=[],k=[],l=[],m=0;m<d.G.length;m++){var n=d.G[m];if(n.ob)f.push(null),e.push(null);
else{f.push(F("in_"+d.type+"_"+n.identifier));var q=W.t(n.va,0);N.Es&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==n.identifier||"Color2"==n.identifier||"Fac"==n.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==n.identifier||"Value_001"==n.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==n.identifier)&&(n=q,n=n.replace(/(,)/g,"$1 "),n=n.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),n=n.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),q=n=n.replace(/\s+/g,
""));e.push(q)}}for(m=0;m<d.xa.length;m++)n=d.xa[m],n.ob?h.push(null):h.push(F("out_"+d.type+"_"+n.identifier));for(m=0;m<d.Va.length;m++)n=d.Va[m],g.push(n.name),k.push(n.value);for(m=0;m<d.Th.length;m++)l.push(d.Th[m].name);f={id:d.type,G:f,Xm:e,xa:h,Va:g,Ck:k,Th:l,be:JSON.parse(JSON.stringify(d.be))};b.push(f);c[a]=f});C.Hd(d,function(a,b,f){var e=C.Ta(d,a);C.Ta(d,b);var h=e.xa[f[0]];a=c[a].xa;b=c[b].G;e=a[f[0]]||F("out_"+e.type+"_"+h.identifier);a[f[0]]=e;b[f[1]]=e});return b};a.Bp=function(a){if(a.node_tree)for(var b=
0;b<a.node_tree.nodes.length;b++){var c=a.node_tree.nodes[b];if("GROUP"==c.type&&"B4W_GLOW_OUTPUT"==c.node_tree_name)return!0}return!1};a.cleanup=function(){for(var a in G)delete G[a];for(var b in oa)delete oa[b];Ka=0}};b4w.module.__animation=function(a,p){function c(a,b){var c=a.C[b];c&&c.xm&&c.ti&&(c.ti=!1,c.xm(a,b))}function d(a,b,c){c=a.C[c];c.type=30;var d=b.frame_start,f=b.frame_end-d+1;c.start=d;c.length=f;c.qc=d;c.Lg=b.name;for(f=d=0;f<a.data.b4w_vertex_anim.length;f++){var e=a.data.b4w_vertex_anim[f];if(e==b)break;else d+=e.frame_end-e.frame_start+1}c.ut=d}function b(a,b,c){a=a.C[c];a.type=50;a.Lg=b.name;c=b.settings;a.start=c.frame_start;a.length=c.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=c.lifetime);
a.yc=b}function e(a){return a.replace(/_B4W_BAKED$/,"")}function g(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:S.fa("Wrong animation behavior")}}function h(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&k(d,b)}return b}function k(a,b){if(a.animation_data){var c=a.animation_data.action;c&&S.wd(c.fcurves)&&b.push(c)}for(var c=a.nodes,d=0;d<c.length;d++){var f=c[d];f.node_group&&(f=f.node_group.node_tree)&&
k(f,b)}}function n(a){return S.is_mesh(a)&&a.e.el?!0:!1}function f(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function l(a,b,d,f){q(a,b,d,f);c(a,d);a.e.Ie&&(r(a,b),m(a,b))}function t(a){if(!S.is_mesh(a))return null;a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}function x(a,b,c){var d=b.frame_range;if(d[0]>d[1])return X.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;var f=b.e,e=
a.C[c];e.Lg=b.name;e.ql=d;e.Yo=f.Sz;e.Xo=f.Lv;e.Lj=f.Lj;e.start=d[0];e.length=d[1]-d[0];e.qc=d[0];d=S.wd(f.Hj);if(S.is_armature(a)&&d){e.type=10;var h=z(a,b);h||(h=E(a,b,H(a)),a.Qd.push(b,h));e.h=h.h;e.Ba=h.Ba;var e=a.e,h=e.Tk,g=a.C[c],f=g.Sn,k;a:{k=e.Gs;for(var l=0;l<k.length;l+=2)if(b==k[l]){k=k[l+1];break a}k=null}if(k)g.Sn=k;else{for(g=0;g<h.length;g++)k=E(a,b,h[g].Oc),f.push(k);e.Gs.push(b,f)}e.Ie&&(b=e.Yk,c>b[1]?(e=b[1],b[1]=c,b[0]=e):c>b[0]&&c<b[1]&&(b[0]=c),D(a))}else if(la.le(a)&&(f.Va.volume||
f.Va.pitch))e.volume=f.Va.volume||null,e.pitch=f.Va.pitch||null,e.type=40;else if("MESH"==a.type&&y(b)){e.type=60;f=z(a,b);if(!f){f=[];g=[];k=[];var l=[],m=b.e,n=a.e.pk,q=a.e.qk;for(h in m.Va){var t=b.name+"%join%"+h;u(h,t,m,g,f,n);u(h,t,m,l,k,q)}f={zC:f,values:g,rA:k,sA:l};a.Qd.push(b,f)}e.Cr=f.zC;e.Er=f.values;e.Br=f.rA;e.Dr=f.sA}else if(h=f.Va.tsr){e.type=20;f=z(a,b);if(!f){f=b.e.Ir;g=[];k=[];for(l=0;l<f;l++)g.push(h.subarray(8*l,8*l+4)),k.push(h.subarray(8*l+4,8*l+8));f={h:g,Ba:k};a.Qd.push(b,
f)}e.h=f.h;e.Ba=f.Ba;T.eh(a)&&T.kC(a,e.h[0],e.Ba[0])}else return X.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;S.is_armature(a)&&!d&&A(a,c);return!0}function z(a,b){for(var c=a.Qd,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function D(a){var b=a.e.Yk;if(-1!=b[0]&&-1!=b[1]){var c=a.C;a=c[b[1]].qc;var d=Math.floor(a),f=a-d,b=c[b[0]];a=b.qc;d=Math.floor(a);b.qc=d+f}}function A(a,b){var c=a.e.Yk,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var f=a.C;0<=d;d--){var e=
f[d];if(e&&10==e.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function H(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var f=b[d].name;c[f]={qp:d,mi:d,Fn:S.Km(a,"name",f),xt:-1}}return c}function u(a,b,c,d,f,e){for(var h=0;h<e.length;h+=2)b==e[h]&&(f.push(e[h+1]),d.push(new Float32Array(c.Va[a])))}function y(a){a=a.e;for(var b in a.Va)if(-1!=b.indexOf("nodes"))return!0;return!1}function q(a,b,c,d){if((c=a.C[c])&&null!=c.type&&(c.play||d)){var f=a.e,e=c.qc,h=c.start,
g=c.length,e=e+c.speed*b*Y.Ha,k=c.type,l=c.speed;if(0<=l&&e>=h+g||0>l&&e<h)switch(d||(c.ti=!0),c.behavior){case 10:e=0<=l?(e-h)%g+h:h+g-1E-6;break;case 20:e=0<=l?h:h+g-1E-6;c.play=!1;break;case 30:e=0<=l?h+g-1E-6:h,c.play=!1}c.qc=e;switch(k){case 10:if(!f.Ie){d=w(c,e,ea);b=d[0];e=d[1];d=d[2];f.Bc=c.Ba[b];f.Ac=c.Ba[e];f.Jc=c.h[b];f.Ic=c.h[e];f.Sf=d;f=f.Tk;c=c.Sn;for(h=0;h<f.length;h++)g=f[h],k=c[h],g.Bc=k.Ba[b],g.Ac=k.Ba[e],g.Jc=k.h[b],g.Ic=k.h[e],g.Sf=d;U.v(a)}break;case 20:g=d=w(c,e,ea);(f=Z)||(f=
new Float32Array(4));var e=g[0],h=g[1],g=g[2],k=c.h,l=k[e][1],m=k[e][2],n=k[h][1],q=k[h][2];f[0]=(1-g)*k[e][0]+g*k[h][0];f[1]=(1-g)*l+g*n;f[2]=(1-g)*m+g*q;e=d;(h=W)||(h=new Float32Array(4));g=c.Ba;ga.slerp(g[e[0]].subarray(0,4),g[e[1]].subarray(0,4),e[2],h);e=h;h=d[2];g=c.h;d=(1-h)*g[d[0]][3]+h*g[d[1]][3];c.qo&&(h=C,U.get_translation(a,h),S.smooth_v(f,h,b,c.qo,f));c.Kn&&(h=ba,U.get_rotation(a,h),S.Ns(e,h,b,c.Kn,e));c=c.Lj;c[0]&&U.set_translation(a,f);c[1]&&U.set_rotation(a,e);c[2]&&U.set_scale(a,
d);U.v(a);Q.sync_transform(a);break;case 30:(a=ea)||(a=Array(3));e-=c.start;0>e&&(e=0);e>=c.length&&(e=c.length);b=Math.floor(e);d=b+1;e-=b;10!=c.behavior&&d==c.length&&(d=--b,e=1);c=c.ut;a[0]=b+c;a[1]=d+c;a[2]=e;d=ea;f.wo=d[0];f.tt=d[2];break;case 40:d=w(c,e,ea);b=d[0];f=d[1];d=d[2];c.volume&&la.set_volume(a,(1-d)*c.volume[b]+d*c.volume[f]);c.pitch&&la.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[f]);break;case 50:T.RA(c.yc,e/Y.Ha);break;case 60:d=w(c,e,ea);b=d[0];f=d[1];d=d[2];k=c.Er;l=c.Cr;e=c.Dr;c=c.Br;
for(h=0;h<l.length;h++)m=k[h],g=l[h],a.e.oe[g]=(1-d)*m[b]+d*m[f];for(h=0;h<c.length;h++)k=e[h],g=c[h],k=ha.lerp(k.subarray(3*b,3*b+3),k.subarray(3*f,3*f+3),d,Z),a.e.wc[g]=k[0],a.e.wc[g+1]=k[1],a.e.wc[g+2]=k[2];break;default:S.fa("Unknown animation type:"+k)}}}function w(a,b,c){c||(c=Array(3));var d=a.ql[0],f=a.ql[1]-d;b-=d;0>b&&(b=0);b>=f&&(b=f);b/=a.Yo;f=Math.floor(b);a=a.Xo[f]?b-f:0;b=Math.ceil(f+a);c[0]=f;c[1]=b;c[2]=a;return c}function m(a,b){var c=a.e,d=c.He,f=c.Yk,e=f[0],f=f[1];if(-1!=f){if(-1!=
e){var h=a.C[e];if(h.play||0==b)var g=w(h,h.qc,ea),k=g[0],l=g[1],g=g[2],m=h.Ba[k],n=h.Ba[l],k=h.h[k],l=h.h[l];else d=1}else d=1;f=a.C[f];if(f.play||0==b)var g=w(f,f.qc,ea),q=g[0],t=g[1],g=g[2];else if(-1!=e&&h.play)d=0;else return;e=f.Ba[q];h=f.Ba[t];q=f.h[q];f=f.h[t];if(1==d)c.Bc.set(e),c.Ac.set(h),c.Jc.set(q),c.Ic.set(f);else if(0==d)c.Bc.set(m),c.Ac.set(n),c.Jc.set(k),c.Ic.set(l);else{for(t=0;t<m.length;t+=4){for(var r=W,C=ba,x=0;4>x;x++)r[x]=m[t+x],C[x]=e[t+x];ga.slerp(r,C,d,r);for(x=0;4>x;x++)c.Bc[t+
x]=r[x];for(x=0;4>x;x++)r[x]=n[t+x],C[x]=h[t+x];ga.slerp(r,C,d,r);for(x=0;4>x;x++)c.Ac[t+x]=r[x]}S.np(k,q,d,c.Jc);S.np(l,f,d,c.Ic)}U.v(a);d=c.Tk;m=c.zr;for(t=0;t<d.length;t++){n=d[t];k=m[t];for(l=0;l<k.length;l+=2)for(q=k[l],e=k[l+1],h=0;4>h;h++)n.Bc[q+h]=c.Bc[e+h],n.Ac[q+h]=c.Ac[e+h],n.Jc[q+h]=c.Jc[e+h],n.Ic[q+h]=c.Ic[e+h];n.Sf=g}}}function r(a,b){var c=a.e,d=c.He,f=c.ul;if(0!=f){var d=c.tl-d,e=f*b;S.sign(d)==S.sign(f)&&Math.abs(e)<Math.abs(d)?c.He+=e:(c.He=c.tl,c.ul=0)}}function E(a,b,c){for(var d=
a.pose.bones,f=[],e=[],h=b.e.Ir,g=0;g<h;g++){for(var k=0;k<d.length;k++){var l=d[k],m=pa.create(),n=b.e.Hj[l.name];n&&pa.copy(n.subarray(8*g,8*g+8),m);l.Uo=m;l.wj=!1}k=I(a,c);f.push(k.h);e.push(k.Ba)}return{h:f,Ba:e}}function I(a,b){var c=[],d=[],f=a.pose.bones,e=new Float32Array(4),h=new Float32Array(4),g;for(g in b){var k=b[g],l=k.mi,m=f[k.Fn],k=e,n=h,q=m.Yu,t=q[q.length-1],r=t.pl;t.wj||pa.identity(r);for(t=q.length-1;0<=t;t--){var m=q[t],C=m.pl;if(m.wj)r=C;else{var x=m.Vo,z=m.Uo;pa.invert(x,ma);
pa.multiply(z,ma,ma);pa.multiply(x,ma,ma);pa.multiply(r,ma,C);r=C;m.wj=!0}}m=m.pl;k[0]=m[0];k[1]=m[1];k[2]=m[2];k[3]=m[3];n[0]=m[4];n[1]=m[5];n[2]=m[6];n[3]=m[7];ga.normalize(n,n);for(k=0;4>k;k++)n=4*l+k,c[n]=e[k],d[n]=h[k]}c=new Float32Array(c);d=new Float32Array(d);return{h:c,Ba:d}}function F(a){var b=[0,0,0],c;for(c in a)"location"==c?b[0]=1:"rotation_quaternion"==c?b[1]=1:"scale"==c&&(b[2]=1);return b}function M(a,b,c,d,f,e,h){var g=a+(b-a)/2,k=L(g,d,f,e,h)-c;return.02>Math.abs(k)?g:0<k?M(a,g,
c,d,f,e,h):M(g,b,c,d,f,e,h)}function L(a,b,c,d,f){var e=1-a;return b*e*e*e+3*c*e*e*a+3*d*e*a*a+f*a*a*a}function O(a,b){if(!a.C.length)for(var c=0;8>c;c++)a.C.push(null);a.C[b]={type:null,Lg:null,ql:null,Yo:0,Xo:null,Lj:null,Ba:null,h:null,Sn:[],play:!1,behavior:20,qc:0,start:0,length:0,qo:0,Kn:0,ti:!1,ut:null,speed:1,volume:null,pitch:null,Er:[],Cr:[],Dr:[],Br:[]};a.Qd=a.Qd||[];-1==fa.indexOf(a)&&fa.push(a)}function B(a,b){U.v(a);Q.sync_transform(a);l(a,0,b,!0)}function J(a,c,f){f=f||0;if(S.is_mesh(a)){var e=
S.keysearch("name",c,a.data.b4w_vertex_anim);if(e)return O(a,f),d(a,e,f),B(a,f),!0;if((e=S.keysearch("name",c,a.particle_systems))&&"EMITTER"==e.settings.type)return O(a,f),b(a,e,f),B(a,f),!0}if(e=S.keysearch("name",c,da)||S.keysearch("name",c+"_B4W_BAKED",da)){O(a,f);if(x(a,e,f))return B(a,f),!0;a.C[f]=null}X.error('Unsupported object: "'+a.name+'" or animation name: "'+c+'"');return!1}function K(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=
a[b],d=c.node_tree;if(c.use_nodes&&d&&P(d))return!0}return!1}function P(a){if(a.animation_data)return!0;a=a.nodes;for(var b=0;b<a.length;b++){var c=a[b];if(c.node_group&&(c=c.node_group.node_tree)&&P(c))return!0}return!1}var R=p("__config"),T=p("__particles"),Q=p("__physics"),X=p("__print");p("__scenes");var la=p("__sfx"),U=p("__transform"),pa=p("__tsr"),S=p("__util"),qa=p("__reformer");p("mat4");var ga=p("quat");p("vec4");var ha=p("vec3"),Y=R.Sd;a.Yt=1E-6;a.OBJ_ANIM_TYPE_NONE=0;a.OBJ_ANIM_TYPE_ARMATURE=
10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var ea=Array(3),Z=new Float32Array(3),C=new Float32Array(3),W=new Float32Array(4),ba=new Float32Array(4),ma=new Float32Array(8);new Float32Array(16);var fa=[],da=[];a.Hq=function(){return S.trunc((R.p.yr-50)/
4)};a.frame_to_sec=function(a){return a/Y.Ha};a.update=function(a){for(var b=0;b<fa.length;b++){for(var d=fa[b],f=0;8>f;f++)q(d,a,f);d.e.Ie&&(r(d,a),m(d,a))}for(b=0;b<fa.length;b++)for(d=fa[b],f=0;8>f&&d.C.length;f++)c(d,f)};a.Aq=function(){return da};a.get_anim_names=function(a){var b=[];if(n(a))for(var c=0;c<a.data.b4w_vertex_anim.length;c++)b.push(a.data.b4w_vertex_anim[c].name);var d,c=[];for(d=0;d<da.length;d++){var f=da[d],g=f.e;S.wd(f.e.Hj)?"ARMATURE"==a.type&&c.push(f):g.Va.volume||g.Va.pitch?
la.le(a)&&c.push(f):!y(f)&&S.wd(f.fcurves)&&c.push(f)}"MESH"==a.type&&(c=c.concat(h(a)));d=c;for(c=0;c<d.length;c++)b.push(e(d[c].name));if(T.eh(a)&&T.Rm(a))for(c=0;c<a.particle_systems.length;c++)b.push(a.particle_systems[c].name);return b};a.xB=e;a.get_anim_type=function(a,b){var c=a.C[b];return c?c.type:0};a.apply_def=function(a){var c=0,f;f=[];var e=a.animation_data;if(e&&e.action&&(e=e.action,S.wd(e.fcurves))){var k=S.wd(e.e.Hj);"ARMATURE"!=a.type&&k||f.push(e)}la.le(a)&&a.data.animation_data&&
a.data.animation_data.action&&f.push(a.data.animation_data.action);"MESH"==a.type&&(f=f.concat(h(a)));if(!a.b4w_do_not_render)for(k=a.particle_systems,e=0;e<k.length;e++){var l=k[e],m=l.settings;"EMITTER"==m.type&&(O(a,c),b(a,l,c),B(a,c),a.C[c].behavior=g(a.b4w_anim_behavior),m.b4w_cyclic&&(a.C[c].behavior=10),c++)}for(e=0;e<f.length;e++)k=f[e],O(a,c),x(a,k,c)?(B(a,c),a.C[c].behavior=g(a.b4w_anim_behavior),c++):a.C[c]=null;n(a)&&(O(a,c),d(a,a.data.b4w_vertex_anim[0],c),B(a,c),a.C[c].behavior=g(a.b4w_anim_behavior))};
a.play=function(a,b,c){f(a.C,c,function(a){a.play=!0;a.xm=b?b:null;a.ti=!1});a.e.Ie&&D(a)};a.stop=function(a,b){f(a.C,b,function(a){a.play=!1;a.xm=null;a.ti=!1})};a.is_play=function(a,b){var c=a.C[b];return c?c.play:!1};a.set_frame=function(a,b,c){var d=a.C;if(-1==c)for(c=0;8>c;c++){var f=d[c];f&&(f.qc=b,l(a,0,c,!0))}else if(f=d[c])f.qc=b,l(a,0,c,!0)};a.get_current_frame_float=function(a,b){var c=a.C[b];return c&&c.qc?c.qc:0};a.is_cyclic=function(a,b){var c=a.C[b];return c&&10==c.behavior};a.set_behavior=
function(a,b,c){f(a.C,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.C[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){f(a.C,d,function(a){a.qo=b||0;a.Kn=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.C[c]=null;else a.C[b]=null;a.e.Ie&&A(a,b)};a.update_object_animation=l;a.ik=function(a){if("ARMATURE"==a.type||t(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||
T.eh(a)&&T.Rm(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||K(a)?!0:!1};a.get_first_armature_object=t;a.is_animated=function(a){return Boolean(a.C.length)};a.Uv=H;a.tp=I;a.gv=function(a){function b(a,c){for(var d=0;d<c;d++){var f=a.subarray(8*d+4,8*d+8);ga.normalize(f,f)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,f=b;else-1<a.indexOf("rotation_quaternion")?(d=4,f=0==b?3:b-1):-1<a.indexOf("scale")?(d=3,f=0):(d=0,f=b);return d+f}function d(a,b,c,f,g){if(-1<c.search(e)){a=b;c=c.split('"')[1];
var k=h}else 8==g?(c="tsr",k=h):k=1<g?new Float32Array(g):0;if(!a[c]){g=a;b=c;if("object"==typeof k&&k.length)for(var l=k.length,m=new Float32Array(f*l),n=0;n<f;n++)for(var q=0;q<l;q++)m[n*l+q]=k[q];else if("number"==typeof k)for(m=new Float32Array(f),n=0;n<f;n++)m[n]=k;else S.fa("Wrong storage default value");g[b]=m}return a[c]}a.e={};var f=a.e;f.Sz=1/Y.Tf;var e=new RegExp(/pose.bones\[\".+\"\]/g),h=pa.create(),g=a.fcurves,k={},l={},m=0,n;for(n in g){var q=g[n],t;for(t in q){var r=q[t],C=r.mc;qa.aw(r,
a);r=r.num_channels;m||(m=C.length);for(var r=d(k,l,n,m,r),x=r.length/m,z=c(n,t|0),w=0;w<m;w++)r[w*x+z]=C[w]}}for(var p in k)"tsr"==p&&b(k[p],m);for(var u in l)b(l[u],m);f.Va=k;f.Hj=l;f.Lv=a.Xu;f.Ir=m;f.Lj="tsr"in k?F(g):null;da.push(a)};a.ly=function(a,b){return(b-a)*Y.Tf+1};a.Av=function(a,b,c,d,f,e){var h,g,k=new Float32Array(2),l=new Float32Array(2),m=new Float32Array(2),n=new Float32Array(2),q=b[1],t=b[2],r=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var C=0,x=0,z=null;f<=e;f++)if(f<
q)for(var w=0;w<Y.Tf;w++)c[C++]=t;else if(f>r)for(w=0;w<Y.Tf;w++)c[C++]=a;else{var p=b[x],u=3;0===p&&(u+=2);0===z&&(u+=2);var y=2===p?0:1;if(b[x+1]==b[x+u+1])z=p,x+=u;else{w=0;f==b[x+1]&&(y&&(d[C]=1),c[C]=b[x+2],C++,w++);if(f==r)for(;w<Y.Tf;w++)c[C++]=a;else for(k[0]=b[x+1],k[1]=b[x+2],0!==p?(l[0]=0,l[1]=0):0===z?(l[0]=b[x+5],l[1]=b[x+6]):(l[0]=b[x+3],l[1]=b[x+4]),0!==p?(m[0]=0,m[1]=0):(m[0]=b[x+u+3],m[1]=b[x+u+4]),n[0]=b[x+u+1],n[1]=b[x+u+2];w<Y.Tf;w++){var W=f+w/Y.Tf;switch(p){case 0:h=k;g=l;var ba=
m,D=n,J=[],A=[],K=void 0,E=void 0,B=void 0,K=void 0;J[0]=h[0]-g[0];J[1]=h[1]-g[1];A[0]=D[0]-ba[0];A[1]=D[1]-ba[1];B=D[0]-h[0];K=Math.abs(J[0]);E=Math.abs(A[0]);0!=K+E&&K+E>B&&(K=B/(K+E),g[0]=h[0]-K*J[0],g[1]=h[1]-K*J[1],ba[0]=D[0]-K*A[0],ba[1]=D[1]-K*A[1]);y&&(d[C]=1);c[C]=L(M(0,1,W,k[0],l[0],m[0],n[0]),k[1],l[1],m[1],n[1]);C++;break;case 1:g=k[0];ba=k[1];h=D=(n[1]-ba)/(n[0]-g);g=ba-D*g;y&&(d[C]=1);c[C]=h*W+g;C++;break;case 2:y&&(d[C]=1);c[C]=b[x+2];C++;break;default:S.fa("Unknown keyframe intepolation mode: "+
p)}}f+1==b[x+u+1]&&(z=p,x+=u)}}};a.TD=function(a){for(var b=0;b<a.length;b++)if(a[b].fD)return a[b];return!1};a.apply=J;a.vv=function(a,b,c){c=c||0;var d=S.keysearch("uuid",b,da);if(d){O(a,c);if(x(a,d,c)){B(a,c);return}a.C[c]=null}X.error('Unsupported object: "'+a.name+'" or animation uuid: "'+b+'"')};a.AC=function(a,b){var c=S.keysearch("name",b,da)||S.keysearch("name",b+"_B4W_BAKED",da);if(c){if(!S.wd(c.fcurves))return!1}else if(!(S.keysearch("name",b,a.particle_systems)||S.is_mesh(a)&&S.keysearch("name",
b,a.data.b4w_vertex_anim)))return!1;return!0};a.get_slot_num_by_anim=function(a,b){for(var c=a.C,d=0;d<c.length;d++){var f=c[d];if(f&&e(f.Lg)==e(b))return d}return-1};a.jy=function(a,b){var c=a.C[b];return c&&c.Lg?e(c.Lg):null};a.remove=function(a){a.C.length=0;a=fa.indexOf(a);-1!=a&&fa.splice(a,1)};a.iA=function(a){for(var b=da.length-1;0<=b;b--)da[b].Zu==a&&da.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.C.length)return J(a,b,0)?0:-1;for(var c=0;c<a.C.length;c++)if(!a.C[c])return J(a,
b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.e.ul=(b-a.e.He)/c;a.e.tl=b};a.set_speed=function(a,b,c){f(a.C,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.C[b].speed};a.get_anim_start_frame=function(a,b){return a.C[b].start};a.get_anim_length=function(a,b){return a.C[b].length};a.Py=K;a.cleanup=function(){fa.length=0;da.length=0};a.Kx=function(a){var b=(a[0]||a[1]||a[2]).mc.length,c=W,d=Z,f=Boolean(a[0]);f||(a[0]={mc:new Float32Array(b),num_channels:8});var e=Boolean(a[1]);e||
(a[1]={mc:new Float32Array(b),num_channels:8});var h=Boolean(a[2]);h||(a[2]={mc:new Float32Array(b),num_channels:8});a[3]={mc:new Float32Array(b),num_channels:8};for(var g=0;g<b;g++)d[0]=f?a[0].mc[g]:0,d[1]=e?a[1].mc[g]:0,d[2]=h?a[2].mc[g]:0,S.euler_to_quat(d,c),a[0].mc[g]=c[3],a[1].mc[g]=c[0],a[2].mc[g]=c[1],a[3].mc[g]=c[2]}};b4w.module.__time=function(a,p){p("__util");var c=0,d=0,b=[],e=0,g=0,h=[];a.Bs=function(a){c=a;d=performance.now();for(a=0;a<b.length;a++){var e=b[a];c>e.rm&&(b.splice(a,1),a--,e.callback())}for(a=0;a<h.length;a++){var e=h[a],f=1-(e.rm-c)/e.duration,f=Math.min(f,1);e.callback(e.O+f*(e.pa-e.O));1==f&&(h.splice(a,1),a--)}};a.get_timeline=function(){return c};a.set_timeout=function(a,h){var f;e++;f=e;b.push({id:f,callback:a,rm:c+(performance.now()-d+h)/1E3});return f};a.clear_timeout=function(a){for(var c=
0;c<b.length;c++)if(b[c].id==a){b.splice(c,1);break}};a.clear_animation=function(a){for(var b=h.length;b--;)if(h[b].id==a){h.splice(b,1);break}};a.animate=function(a,b,d,e){d/=1E3;var t;g++;t=g;h.push({id:t,callback:e,O:a,pa:b,rm:c+d,duration:d});e(a);return t};a.reset=function(){d=c=0;b.length=0;g=e=h.length=0}};b4w.module.__transform=function(a,p){function c(a,b){var c=a.e;c.h[0]=b[0];c.h[1]=b[1];c.h[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}function d(a){var c=a.e,k=t.ah(),q=a.type;"CAMERA"==q&&e.uo(a);g.aC(a,m);"CAMERA"==q&&e.YB(a);var u=c.h,p=c.scale,y=c.quat;z.set_sep(u,p,y,c.Bb);var A=c.V;n.fromQuat(y,A);"CAMERA"!=q&&D.xA(A,p,A);A[12]=u[0];A[13]=u[1];A[14]=u[2];n.invert(A,c.dr);a.C.length&&f.Rm(a)&&f.bC(a);c.Pb&&c.gb&&(b.Jl(c.Pb,A,c.gb),b.Ll(c.Yc,A,c.vb),b.Kl(c.Ef,
c.Bb,c.Ff),c.Ec&&t.Qn(k),null!=c.pc&&k&&t.kt(k,a));if(k&&k.e.zb)for(A=k.e.zb.Mk,p=0;p<A.length;p++)if(A[p]==a){t.nt(p,k);break}switch(q){case "SPEAKER":x.mB(a,m);break;case "CAMERA":e.ZB(a);k&&t.Yj(k)==a&&x.qz(k,u,y,m);break;case "LAMP":h.cC(a);k&&t.Bg(a,k);break;case "EMPTY":a.field&&t.lt(a);break;case "MESH":if(u=a.uj)z.invert(u.e.Bb,w),z.multiply(w,c.Bb,w),H.set(w[0],w[1],w[2],w[3],c.yl),l.set(w[4],w[5],w[6],w[7],c.xl)}"LAMP"!=q&&"CAMERA"!=q||!k||(t.Qn(k),t.AA(k));a=a.Mc;for(p=0;p<a.length;p++)d(a[p]);
c.Dm=!0}var b=p("__boundings"),e=p("__camera"),g=p("__constraints"),h=p("__lights"),k=p("__mat3"),n=p("__mat4"),f=p("__particles"),l=p("__quat"),t=p("__scenes"),x=p("__sfx"),z=p("__tsr"),D=p("__util"),A=p("__vec3"),H=p("__vec4"),u=new Float32Array(3),y=new Float32Array(4),q=new Float32Array(9),w=new Float32Array(8),m=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){m=a};a.set_translation=function(a,b){g.je(a)==g.Nd?z.set_trans(b,g.ie(a)):A.copy(b,a.e.h)};a.get_translation=function(a,b){g.je(a)==
g.Nd?A.copy(z.get_trans_view(g.ie(a)),b):A.copy(a.e.h,b)};a.set_rotation=function(a,b){g.je(a)==g.Nd?z.set_quat(b,g.ie(a)):l.copy(b,a.e.quat)};a.get_rotation=function(a,b){g.je(a)==g.Nd?l.copy(z.get_quat_view(g.ie(a)),b):l.copy(a.e.quat,b)};a.set_rotation_euler=function(a,b){if(g.je(a)==g.Nd){var c=D.euler_to_quat(b,y);z.set_quat(c,g.ie(a))}else D.euler_to_quat(b,a.e.quat)};a.set_scale=function(a,b){g.je(a)==g.Nd?z.set_scale(b,g.ie(a)):a.e.scale=b};a.get_scale=function(a){return g.je(a)==g.Nd?z.get_scale(g.ie(a)):
a.e.scale};a.get_tsr=function(a,b){if(g.je(a)==g.Nd)z.copy(g.ie(a),b);else{var c=a.e;z.set_sep(c.h,c.scale,c.quat,b)}};a.set_tsr=function(a,b){g.je(a)==g.Nd?z.copy(b,g.ie(a)):c(a,b)};a.SA=c;a.get_object_size=function(a){var b=a.e,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(b=a.e,A.copy(b.vb.F,c)):(b=a.e,a=a.data.b4w_bounding_box,c[0]=
(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,A.transformMat4(c,b.V,c));return c};a.move_local=function(a,b,c,d){a=a.e;u[0]=b;u[1]=c;u[2]=d;b=k.fromMat4(a.V,q);A.transformMat3(u,b,u);A.add(a.h,u,a.h)};a.v=d;a.distance=function(a,b){return A.dist(a.e.h,b.e.h)};a.Mz=function(a,b){return A.dist(a.e.h,b)};a.get_object_bounding_box=function(a){return{max_x:a.e.gb.max_x,min_x:a.e.gb.min_x,max_y:a.e.gb.max_y,min_y:a.e.gb.min_y,max_z:a.e.gb.max_z,min_z:a.e.gb.min_z}}};b4w.module.__tsr=function(a,p){function c(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3]}function d(a,b,c){var d=b[0],e=b[1],h=b[2],g=b[3],k=b[4],n=b[5],p=b[6];b=b[7];var q=a[0]*g,w=a[1]*g,m=a[2]*g;a=b*q+n*m-p*w;var g=b*w+p*q-k*m,r=b*m+k*w-n*q,q=-k*q-n*w-p*m;c[0]=a*b+q*-k+g*-p-r*-n;c[1]=g*b+q*-n+r*-k-a*-p;c[2]=r*b+q*-p+a*-n-g*-k;c[0]+=d;c[1]+=e;c[2]+=h;return c}var b=p("__mat4"),e=p("__quat"),g=p("__util"),h=p("__vec3"),k=new Float32Array(3),n=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.from_values=function(a,b,c,d,e,h,g,k){var n=new Float32Array(8);n[0]=a;n[1]=b;n[2]=c;n[3]=d;n[4]=e;n[5]=h;n[6]=g;n[7]=k;return n};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];return b};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.create_sep=function(a,b,d,e){e||(e=new Float32Array(8));c(a,b,d,e);return e};
a.set_sep=c;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.set_scale=function(a,b){b[3]=a};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.set_quat=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.get_trans_view=function(a){return a.subarray(0,3)};a.get_scale=function(a){return a[3]};a.get_quat_view=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],h=a[1],g=a[2];n[0]=a[4];n[1]=a[5];n[2]=a[6];n[3]=a[7];e.invert(n,
n);var k=n[0],p=n[1],u=n[2],y=n[3],d=d*c,h=h*c,q=g*c,g=y*d+p*q-u*h,w=y*h+u*d-k*q,m=y*q+k*h-p*d,d=-k*d-p*h-u*q;b[0]=-(g*y+d*-k+w*-u-m*-p);b[1]=-(w*y+d*-p+m*-k-g*-u);b[2]=-(m*y+d*-u+g*-p-w*-k);b[3]=c;b[4]=k;b[5]=p;b[6]=u;b[7]=y;return b};a.to_mat4=function(a,c){var d=a[3];b.fromRotationTranslation(a.subarray(4),a.subarray(0,3),c);for(var e=0;12>e;e++)c[e]*=d;return c};a.from_mat4=function(a,b){var d=g.lh(a,k),e=g.qn(a),h=g.matrix_to_quat(a,n);c(d,e,h,b);return b};a.multiply=function(a,b,c){d(b,a,c);
c[3]=a[3]*b[3];var e=a[4],h=a[5],g=a[6];a=a[7];var k=b[4],n=b[5],p=b[6];b=b[7];c[4]=e*b+a*k+h*p-g*n;c[5]=h*b+a*n+g*k-e*p;c[6]=g*b+a*p+e*n-h*k;c[7]=a*b-e*k-h*n-g*p;return c};a.transform_vec3=d;a.transform_vec3_inv=function(a,b,c){var d=b[3],e=a[0]-b[0],h=a[1]-b[1],g=a[2]-b[2];a=b[4];var k=b[5],n=b[6];b=b[7];var p=a*a+k*k+n*n+b*b,p=p?1/p:0;a=-a*p;k=-k*p;n=-n*p;b*=p;var p=b*e+k*g-n*h,q=b*h+n*e-a*g,w=b*g+a*h-k*e,e=-a*e-k*h-n*g;c[0]=p*b+e*-a+q*-n-w*-k;c[1]=q*b+e*-k+w*-a-p*-n;c[2]=w*b+e*-n+p*-k-q*-a;c[0]/=
d;c[1]/=d;c[2]/=d;return c};a.transform_vectors=function(a,b,c,d){d||(d=0);var e=a.length,h=b[0],g=b[1],k=b[2],n=b[3],p=b[4],q=b[5],w=b[6];b=b[7];for(var m=0;m<e;m+=3){var r=a[m]*n,E=a[m+1]*n,I=a[m+2]*n,F=b*r+q*I-w*E,M=b*E+w*r-p*I,L=b*I+p*E-q*r,r=-p*r-q*E-w*I;c[d+m]=F*b+r*-p+M*-w-L*-q;c[d+m+1]=M*b+r*-q+L*-p-F*-w;c[d+m+2]=L*b+r*-w+F*-q-M*-p;c[d+m]+=h;c[d+m+1]+=g;c[d+m+2]+=k}return c};a.transform_dir_vectors=function(a,b,c,d){d||(d=0);var e=a.length,h=b[3],g=b[4],k=b[5],n=b[6];b=b[7];for(var p=0;p<
e;p+=3){var q=a[p]*h,w=a[p+1]*h,m=a[p+2]*h,r=b*q+k*m-n*w,E=b*w+n*q-g*m,I=b*m+g*w-k*q,q=-g*q-k*w-n*m;c[d+p]=r*b+q*-g+E*-n-I*-k;c[d+p+1]=E*b+q*-k+I*-g-r*-n;c[d+p+2]=I*b+q*-n+r*-k-E*-g}return c};a.transform_dir_vec3=function(a,b,c){var d=b[3],e=b[4],h=b[5],g=b[6];b=b[7];var k=a[0]*d,n=a[1]*d,p=a[2]*d;a=b*k+h*p-g*n;var d=b*n+g*k-e*p,q=b*p+e*n-h*k,k=-e*k-h*n-g*p;c[0]=a*b+k*-e+d*-g-q*-h;c[1]=d*b+k*-h+q*-e-a*-g;c[2]=q*b+k*-g+a*-h-d*-e;return c};a.transform_tangents=function(a,b,c,d){d||(d=0);var e=a.length,
h=b[3],g=b[4],k=b[5],n=b[6];b=b[7];for(var p=0;p<e;p+=4){var q=a[p]*h,w=a[p+1]*h,m=a[p+2]*h,r=b*q+k*m-n*w,E=b*w+n*q-g*m,I=b*m+g*w-k*q,q=-g*q-k*w-n*m;c[d+p]=r*b+q*-g+E*-n-I*-k;c[d+p+1]=E*b+q*-k+I*-g-r*-n;c[d+p+2]=I*b+q*-n+r*-k-E*-g;c[d+p+3]=a[p+3]}return c};a.translate=function(a,b,c){var d=a[3],e=a[4],h=a[5],g=a[6],k=a[7],n=b[0]*d,p=b[1]*d,q=b[2]*d;b=k*n+h*q-g*p;var d=k*p+g*n-e*q,w=k*q+e*p-h*n,n=-e*n-h*p-g*q;c[0]=a[0]+b*k+n*-e+d*-g-w*-h;c[1]=a[1]+d*k+n*-h+w*-e-b*-g;c[2]=a[2]+w*k+n*-g+b*-h-d*-e;c[3]=
a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,d){d||(d=new Float32Array(8));h.lerp(a.subarray(0,3),b.subarray(0,3),c,d.subarray(0,3));var g=a[3];d[3]=g+c*(b[3]-g);e.slerp(a.subarray(4),b.subarray(4),c,d.subarray(4));return d};a.QD=function(a,b,c,d){d||(d=new Float32Array(8));var h=a.subarray(0,3),g=b.subarray(0,3),k=d.subarray(0,3);k[0]=g[0]*(c+1)-h[0]*c;k[1]=g[1]*(c+1)-h[1]*c;k[2]=g[2]*(c+1)-h[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);h=d.subarray(4);
h[0]=b[0]*(c+1)-a[0]*c;h[1]=b[1]*(c+1)-a[1]*c;h[2]=b[2]*(c+1)-a[2]*c;h[3]=b[3]*(c+1)-a[3]*c;e.normalize(h,h);return d};a.Yy=function(a,b,c,d,e){e[0]=a[0]+b*c[0];e[1]=a[1]+b*c[1];e[2]=a[2]+b*c[2];e[3]=a[3];c=d[0];var h=d[1];d=d[2];var g=a[4],k=a[5],n=a[6],p=a[7];e[4]=.5*(c*p+h*n-d*k);e[5]=.5*(h*p+d*g-c*n);e[6]=.5*(d*p+c*k-h*g);e[7]=.5*(-c*g-h*k-d*n);e[4]=a[4]+e[4]*b;e[5]=a[5]+e[5]*b;e[6]=a[6]+e[6]*b;e[7]=a[7]+e[7]*b;a=e[4];b=e[5];c=e[6];h=e[7];a=a*a+b*b+c*c+h*h;0<a&&(a=1/Math.sqrt(a),e[4]*=a,e[5]*=
a,e[6]*=a,e[7]*=a)}};b4w.module.__util=function(a,p){function c(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var h=c[f];h[a]==b&&d.push(h)}return d}function d(a){return 0<a?1:0>a?-1:0}function b(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function e(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function g(a,b){var c=b;switch(typeof a){case "number":return h(a,c);case "string":return k(a,c);case "boolean":return h(a|0,c);case "function":case "undefined":return h(0,
c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(d=0;d<a.length;d++)c=h(a[d],c);else if(d)for(d=0;d<a.length;d++)c=g(a[d],c);else for(var e in a)c=g(a[e],c)}else c=h(0,c)}return c}function h(a,b){var c=b;R[0]=a;c=(c<<5)-c+T[0];c&=c;c=(c<<5)-c+T[1];return c&c}function k(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),c&=c;return c}function n(a){return(34*a+1)*a%289}function f(a){return a-Math.floor(a)}function l(a){return t((34*
a+5)*a)}function t(a){return a-289*Math.floor(a/289)}function x(a){return a-7*Math.floor(a/7)}function z(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function D(a){return z(a,0,2*Math.PI)}function A(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!H(a[c],b[c]))return!1}else if(d){if(a.length!=
b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!H(a[f],b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function H(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return A(a,b);default:return!0}}function u(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=
e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}var y=p("__print"),q=p("vec3"),w=p("vec4"),m=p("quat"),r=p("mat3"),E=p("mat4"),I=0,F={},M=new Float32Array(3),L=new Float32Array(3),O=new Float32Array(4),B=new Float32Array(4),J=new Float32Array(9),K=new Float32Array(16),P=new Float32Array(16),R=new Float64Array(1),T=new Uint32Array(R.buffer),Q=new Float32Array([0,0,0]),X=new Float32Array([0,0,0,1]),la=
new Float32Array([0,0,0,1,0,0,0,1]),U=new Float32Array([1,0,0]),pa=new Float32Array([0,1,0]),S=new Float32Array([0,0,1]),qa=new Float32Array([-1,0,0]),ga=new Float32Array([0,-1,0]),ha=new Float32Array([0,0,-1]),Y=Math.floor(44488.07041494893),ea=[new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,-1,
0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])];a.Wu=Q;a.Qu=X;a.cD=la;a.AXIS_X=U;a.AXIS_Y=pa;a.AXIS_Z=S;a.AXIS_MX=qa;a.AXIS_MY=ga;a.AXIS_MZ=ha;a.Ht=ea;a.keyfind=c;a.Mx=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.PB=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.fw=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.Bv=function(a,b){var c=[],d={},
e=b.length,f,h;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)h=a[f],h in d&&c.push(h);return c};a.sign=d;a.EE=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.DE=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var h=e[f];if(h[a]==b&&h[c]==d)return h}return null};a.Km=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.uv=function(a,
b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.yD=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.QE=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.OE=function(a,b){var d=c("name",b,a);1<d.length&&y.error("obj_by_name(): name resolution ambiguity");return d};a.PE=function(a,b){var d=c("name",b,a),e=d.length;1<e&&y.error("obj_by_name(): name resolution ambiguity");if(0>=e)return[];
for(var f=[],h=0;h<e;h++){var g=d[h];if("EMPTY"==g.type&&g.dupli_group)for(var g=g.dupli_group.objects,k=0;k<g.length;k++)f.push(g[k])}return d=d.concat(f)};a.LB=function(a,b,c,d){d||(d=new Float32Array(16));E.identity(d);d[12]=a;d[13]=b;d[14]=c};var Z=1;a.eA=function(){Z=(69069*Z+5)%Math.pow(2,32);return Math.round(Z/65536)%32768/32767};a.tB=function(a){Z=a};a.Uc=function(a){var b=a[0]%Y*48271-3399*Math.floor(a[0]/Y);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.gk=function(a,b){b||(b=[]);
b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),h=Math.sin(a[2]/2),g=Math.sin(a[0]/2);b[0]=f*h*e+c*d*g;b[1]=f*d*e+c*h*g;b[2]=c*h*e-f*d*g;b[3]=c*d*e-f*h*g;return b};a.Bx=function(a){var b=r.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),h=Math.sin(a[1]);a=Math.sin(a[2]);var g=c*e,k=c*a,l=f*e,m=f*a;b[0]=d*e;b[1]=d*a;b[2]=-h;b[3]=h*l-k;b[4]=h*m+g;b[5]=
d*f;b[6]=h*g+m;b[7]=h*k-l;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],h=e*e,g=c*d+e*f;.499999<g?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=Math.PI/2):-.499999>g?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*h),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*h),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));q.transformQuat(b,a,c);return c};a.LD=function(a,b,c){c||(c=new Float32Array(4));a=
q.normalize(a,M);var d=q.dot(b,a);a=q.cross(b,a,L);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.MB=function(a,b,c,d){d||(d=new Float32Array(4));q.transformQuat(c,b,d);d[3]=-q.dot(a,d)};a.tx=function(a){var b=a.e.quat;switch(a.type){case "CAMERA":M[0]=0;M[1]=-1;M[2]=0;q.transformQuat(M,b,M);L[0]=0;L[1]=0;L[2]=-1;break;case "MESH":M[0]=0;M[1]=0;M[2]=1;q.transformQuat(M,b,M);L[0]=0;L[1]=0;L[2]=1;break;case "EMPTY":M[0]=0,M[1]=1,
M[2]=0,q.transformQuat(M,b,M),L[0]=0,L[1]=1,L[2]=0}M[1]=0;q.normalize(M,M);a=q.dot(M,L);return Math.acos(a)*(0<-M[0]*L[2]?-1:1)};a.np=function(a,b,c,d){if(0!=c){d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.iF=function(){I++;return I.toString(16)};a.ej=function(a){F[a]||(F[a]=0);var b=a+F[a];F[a]++;return b};a.Zc=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.mb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),
a_texcoord:new Float32Array(0)};return{name:a,L:0,ea:null,A:[],J:b,X:[]}};a.Jf=function(a){return JSON.parse(JSON.stringify(a))};a.ka=function(b){if(!(b instanceof Object))return b;var c;c=b.constructor;switch(c){case Float32Array:case Uint32Array:case Uint16Array:c=new c(b);break;case Array:c=new c(b.length);for(var d=0;d<b.length;d++)c[d]=a.ka(b[d]);break;default:for(d in c=new c,b)c[d]=a.ka(b[d])}return c};a.fi=function(a){var b=a instanceof Array?[]:{},c;for(c in a)if(a[c]instanceof Object){var d=
a[c].constructor;switch(d){case Float32Array:case Uint32Array:case Uint16Array:b[c]=new d(a[c]);break;case Array:b[c]=a[c].slice(0);break;default:b[c]=a[c]}}else b[c]=a[c];return b};a.is_mesh=function(a){return"MESH"===a.type?!0:!1};a.jk=function(a){return"EMPTY"===a.type?!0:!1};a.is_armature=function(a){return"ARMATURE"===a.type?!0:!1};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));r.fromMat4(a,J);var c=J[0],d=J[3],e=J[6],f=J[1],h=J[4],g=J[7],k=J[2],l=J[5],n=J[8],c=Math.sqrt(c*c+d*d+e*
e)||1,f=Math.sqrt(f*f+h*h+g*g)||1,k=Math.sqrt(k*k+l*l+n*n)||1;J[0]/=c;J[3]/=c;J[6]/=c;J[1]/=f;J[4]/=f;J[7]/=f;J[2]/=k;J[5]/=k;J[8]/=k;m.fromMat3(J,b);return b};a.lh=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.qn=function(a){O[0]=.577350269189626;O[1]=.577350269189626;O[2]=.577350269189626;O[3]=0;w.transformMat4(O,a,O);return w.length(O)};a.um=function(a,c){var d=c.left,e=c.right,f=c.top,h=c.bottom,g=c.Ua,k=c.Sa;d[0]=a[3]+a[0];d[1]=a[7]+a[4];d[2]=a[11]+a[8];
d[3]=a[15]+a[12];e[0]=a[3]-a[0];e[1]=a[7]-a[4];e[2]=a[11]-a[8];e[3]=a[15]-a[12];f[0]=a[3]-a[1];f[1]=a[7]-a[5];f[2]=a[11]-a[9];f[3]=a[15]-a[13];h[0]=a[3]+a[1];h[1]=a[7]+a[5];h[2]=a[11]+a[9];h[3]=a[15]+a[13];g[0]=a[3]+a[2];g[1]=a[7]+a[6];g[2]=a[11]+a[10];g[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];b(d);b(e);b(f);b(h);b(g);b(k)};a.oB=function(a,b,c){return c<-e(a,b.left)||c<-e(a,b.right)||c<-e(a,b.top)||c<-e(a,b.bottom)||c<-e(a,b.Ua)||c<-e(a,b.Sa)?!0:!1};a.zx=function(a,
b,c,d,f){h=q.dot(c,b.Sa);g=q.dot(d,b.Sa);k=q.dot(f,b.Sa);h=Math.sqrt(h*h+g*g+k*k);if(h<-e(a,b.Ua)||h<-e(a,b.Sa))return!0;var h=q.dot(c,b.left),g=q.dot(d,b.left),k=q.dot(f,b.left);if(Math.sqrt(h*h+g*g+k*k)<-e(a,b.left))return!0;h=q.dot(c,b.right);g=q.dot(d,b.right);k=q.dot(f,b.right);if(Math.sqrt(h*h+g*g+k*k)<-e(a,b.right))return!0;h=q.dot(c,b.top);g=q.dot(d,b.top);k=q.dot(f,b.top);if(Math.sqrt(h*h+g*g+k*k)<-e(a,b.top))return!0;h=q.dot(c,b.bottom);g=q.dot(d,b.bottom);k=q.dot(f,b.bottom);return Math.sqrt(h*
h+g*g+k*k)<-e(a,b.bottom)?!0:!1};a.df=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var h=a[f],g=a[f+1],k=a[f+2];c[d+f]=b[0]*h+b[4]*g+b[8]*k+b[12];c[d+f+1]=b[1]*h+b[5]*g+b[9]*k+b[13];c[d+f+2]=b[2]*h+b[6]*g+b[10]*k+b[14]}};a.DC=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var h=a[f],g=a[f+1],k=a[f+2];c[d+f]=b[0]*h+b[4]*g+b[8]*k;c[d+f+1]=b[1]*h+b[5]*g+b[9]*k;c[d+f+2]=b[2]*h+b[6]*g+b[10]*k}};a.IB=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=4){var h=a[f],g=a[f+1],k=
a[f+2];c[d+f]=b[0]*h+b[4]*g+b[8]*k;c[d+f+1]=b[1]*h+b[5]*g+b[9]*k;c[d+f+2]=b[2]*h+b[6]*g+b[10]*k;c[d+f+3]=a[f+3]}};a.BC=function(a,b,c){c||(c=new Float32Array(3));O[0]=a[0];O[1]=a[1];O[2]=a[2];O[3]=0;w.transformMat4(O,b,O);c[0]=O[0];c[1]=O[1];c[2]=O[2]};a.UD=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.CC=function(a){for(var b=
[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.Fj=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.Fj(b,c,d,f-1):b[f]<c?a.Fj(b,c,f+1,e):f};a.Le=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.AD=function(a,b,c){for(var d=0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;return!0};a.xA=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=
a[15]};a.ro=function(a,b,c,d){d||(d=new Float32Array(16));b=E.fromRotationTranslation(b,c,K);E.multiply(b,a,d)};a.transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));c=E.fromRotationTranslation(c,d,K);1!==b&&(d=E.identity(P),b=q.set(b,b,b,M),E.scale(d,b,d),E.multiply(c,d,c));q.transformMat4(a,c,e);return e};a.so=function(a,b,c,d){d||(d=new Float32Array(4));b=E.fromRotationTranslation(b,c,K);w.transformMat4(a,b,d)};a.vE=function(a,b,c,d,e){e||(e=new Float32Array(3));b=E.fromRotationTranslation(c,
d,K);E.invert(b,b);q.transformMat4(a,b,e);return e};a.gF=function(a,b,c){c||(c=new Float32Array(16));E.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.NE=function(b,c,d){a.lh(b,c);c[3]=a.qn(b);a.matrix_to_quat(b,d)};a.iD=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.tA=function(a,b,c,d){d||(d=new Float32Array(3));q.subtract(b,a,M);q.transformQuat(M,c,M);q.subtract(b,M,d)};a.Yx=function(){M[0]=0;M[1]=0;M[2]=0;var a=new Float32Array(16),
b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16);E.lookAt(M,[-1,0,0],[0,-1,0],a);E.scale(a,[-1,1,1],a);E.scale(a,[-1,1,-1],b);E.lookAt(M,[0,-1,0],[0,0,-1],c);E.scale(c,[1,1,-1],c);E.scale(c,[1,-1,-1],d);E.lookAt(M,[0,0,-1],[0,-1,0],e);E.scale(e,[-1,1,1],e);E.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.by=function(){M[0]=0;M[1]=0;M[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=
new Float32Array(16),f=new Float32Array(16);E.lookAt(M,[1,0,0],[0,-1,0],a);E.scale(a,[-1,1,-1],b);E.lookAt(M,[0,1,0],[0,0,1],c);E.scale(c,[1,-1,-1],d);E.lookAt(M,[0,0,1],[0,-1,0],e);E.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.Qg=function(a,b){return g(a,b)};a.hash_code=g;a.pE=k;a.ME=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,h,g,k,l,m,n,q,t,r,x,p;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*
b+a[15],a;f=a[0];h=a[1];g=a[2];k=a[3];l=a[4];m=a[5];n=a[6];q=a[7];t=a[8];r=a[9];x=a[10];p=a[11];c[0]=f;c[1]=h;c[2]=g;c[3]=k;c[4]=l;c[5]=m;c[6]=n;c[7]=q;c[8]=t;c[9]=r;c[10]=x;c[11]=p;c[12]=f*d+l*e+t*b+a[12];c[13]=h*d+m*e+r*b+a[13];c[14]=g*d+n*e+x*b+a[14];c[15]=k*d+q*e+p*b+a[15];return c};a.xz=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=
a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.Jk=function(a){return a*Math.PI/180};a.nx=function(a){return 180*a/Math.PI};a.Wn=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var h=b>a?1:0,g=1-h,e=b+
.211324865405187-h,k=a+.211324865405187-g,l=b+-.577350269189626,m=a+-.577350269189626,c=c%289,d=d%289,q=n(n(d)+c),g=n(n(d+g)+c+h),t=n(n(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+k*k),0),h=Math.max(.5-(l*l+m*m),0),r=2*f(.024390243902439*q)-1,x=2*f(.024390243902439*g)-1,p=2*f(.024390243902439*t)-1,q=Math.abs(r)-.5,g=Math.abs(x)-.5,t=Math.abs(p)-.5,r=r-Math.floor(r+.5),x=x-Math.floor(x+.5),p=p-Math.floor(p+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(r*r+q*q)),d=d*d*d*d*(1.79284291400159-
.85373472095314*(x*x+g*g)),h=h*h*h*h*(1.79284291400159-.85373472095314*(p*p+t*t));return 130*(c*(r*b+q*a)+d*(x*e+g*k)+h*(p*l+t*m))};a.zp=function(a){var b=1/7,c=b/2,d=t(Math.floor(a[0])),e=t(Math.floor(a[1])),h=f(a[0]);a=f(a[1]);var g=h-.5,k=h-1.5,h=a-.5;a-=1.5;var m=l(d),n=l(d+1),q=m,d=n,m=l(m+e),n=l(n+e),q=l(q+e+1),d=l(d+e+1),e=g+.7*(x(m)*b+c),r=k+.7*(x(n)*b+c),g=g+.7*(x(q)*b+c),k=k+.7*(x(d)*b+c),m=h+.7*(x(Math.floor(m*b))*b+c),h=h+.7*(x(Math.floor(n*b))*b+c),q=a+.7*(x(Math.floor(q*b))*b+c),b=a+
.7*(x(Math.floor(d*b))*b+c);return Math.min(e*e+m*m,r*r+h*h,g*g+q*q,k*k+b*b)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=q.transformQuat(b,a,M);b=c[0];var f=c[1];c=c[2];J[0]=f*f+c*c;J[1]=-f*b;J[2]=-c*b;J[3]=-b*f;J[4]=b*b+c*c;J[5]=-c*f;J[6]=-b*c;J[7]=-f*c;J[8]=b*b+f*f;q.transformMat3(a,J,a);q.normalize(a,a);m.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=O,d=B,c=m.setAxisAngle([0,1,0],Math.PI,m.create()),d=m.setAxisAngle([1,
0,0],Math.PI/2,m.create());m.multiply(c,d,c);m.multiply(a,c,b);return b};a.cleanup=function(){I=0;F={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.Ns=function(a,b,c,d,e){e||(e=new Float32Array(a.length));m.slerp(a,b,Math.exp(-c/d),e)};a.wE=function(a){return"object"===typeof a&&a.buffer&&
a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=r.fromQuat(a,J);L[0]=0;L[1]=1;L[2]=0;M[0]=c[3];M[1]=c[4];M[2]=c[5];var d=q.cross(L,M,M);q.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);L[0]=c[0];L[1]=c[1];L[2]=c[2];q.normalize(L,L);m.rotationTo(L,d,B);m.multiply(B,a,a)};a.Bq=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-
Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),h=b-1,g=a[e*b+c],k=a[e*b+Math.min(c+1,h)],l=a[Math.min(e+1,h)*b+c];a=a[Math.min(e+1,h)*b+Math.min(c+1,h)];return(g*(1-d)+k*d)*(1-f)+(l*(1-d)+a*d)*f};a.wg=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.vs=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.Zi=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.xq=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.wd=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];q.normalize(c,c)};a.NB=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],h=b[1],g=b[2];b=b[3];var k=h*a-g*e,l=g*d-f*a,m=f*e-h*d,n=h*m-g*l,g=g*k-
f*m,f=f*l-h*k;c[0]=d+2*k*b+2*n;c[1]=e+2*l*b+2*g;c[2]=a+2*m*b+2*f};a.assert=function(a){if(!a)throw Error("Assertion failed");};a.fa=function(a){a&&y.error.apply(y,arguments);throw"panic: see above for possible error messages";};a.angle_wrap_periodic=z;a.angle_wrap_0_2pi=D;a.Im=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.Zs=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=A(e,f)}if(!d)return!1}return!0};
a.Jn=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.vq=function(a){a+=1;132651<a&&y.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d,e){O.set(a);O[3]=b;B.set(d);B[3]=0;a=w.dot(O,B);if(0==a)return null;B.set(c);B[3]=1;a=-w.dot(O,B)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.Ay=function(a,b,c,d){var e=b[0]-a[0],f=c[0]-a[0],h=b[1]-
a[1],g=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=h*a-b*g;d[1]=f*b-e*a;d[2]=e*g-h*f;return d};a.CD=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.vA=function(a,b,c){var d=q.dot(a,b);-.9999999>d?(q.cross(U,a,M),1E-6>q.length(M)&&q.cross(pa,a,M),q.normalize(M,M),m.setAxisAngle(M,Math.PI,c)):(q.cross(a,b,M),c.set(M),c[3]=1+d,m.normalize(c,c));return c};a.Je=function(a,b,c){if(b==c)return c-a;a=D(a);b=D(b);c=D(c);var d=Math.abs(b-c);if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-
b;c=D(c+b);a=D(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a,b,c){isFinite(b)&&isFinite(c)&&(a=clamp(a,b,c));return a*a*(3-2*a)};a.lerp=function(a,b,c){return b+a*(c-b)};a.Cv=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(b[d]==a[c])return!0;return!1};a.FD=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=0;return b};a.vt=function(a,b){for(var c=Math.max(a.length,b.length),e=0;e<c;e++){var f=d((e>=a.length?0:a[e])-(e>=b.length?0:b[e]));if(f)return f}return 0};
a.dl=function(a){return a.join(".")};a.wB=function(a){return a.split(".").map(function(a){return a|0})};a.Us=function(a,b){b[0]=Math.pow(a[0],2.2);b[1]=Math.pow(a[1],2.2);b[2]=Math.pow(a[2],2.2)};a.jn=function(a,b){b[0]=Math.pow(a[0],1/2.2);b[1]=Math.pow(a[1],1/2.2);b[2]=Math.pow(a[2],1/2.2);return b};a.uk=function(a){var b=a.split("://",2);return 1<b.length?(b[1]=u(b[1]),b.join("://")):u(a)}};b4w.module.__sfx=function(a,p){function c(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;A.warn("deprecated WebAudio implementation");return null}A.warn("WebAudio is not supported");return null}function d(a,c,d){var e=a.k;if("NONE"!=e.behavior){d||(d=0);var f=e.loop,l=e.pitch;if(e.src&&(f||0<=d)){e.Al=Math.floor(5E4*Math.random());var m=F.currentTime+c;e.Fc=m;e.state=20;b(a);"POSITIONAL"==e.behavior||"BACKGROUND_SOUND"==e.behavior?(c=F.createBufferSource(),
c.buffer=e.src,c.playbackRate.value=l,f?(e.rb&&e.rb.disconnect(),c.loop=!0,c.start(m),e.duration=0):(f=c.buffer?c.buffer.duration:0,d>f?(f=m+d+e.ge,c.loop=!0,c.start(m),c.stop(f),e.duration=d):(c.loop=!1,c.start(m),e.duration=f)),c.connect(e.dc),e.rb=c,g(e),h(e)):"BACKGROUND_MUSIC"==e.behavior&&(H.clear_timeout(e.El),H.clear_timeout(e.Fl),d=function(){var b=a.k,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.rb=b.rb||F.createMediaElementSource(c),b.rb.connect(b.dc),20==b.state&&(c.currentTime&&(c.currentTime=
0),c.play()))},0==c?d():e.El=H.set_timeout(d,1E3*c),e.duration=f?0:z(a));k(e,m)}}}function b(a){var b=a.k;if(!b.dc){var c=a.e.h;a=a.e.quat;if(q.rk){var d=F.createBiquadFilter();d.type="peaking"}else d=null;var e=F.createGain();switch(b.behavior){case "POSITIONAL":var f=F.createPanner();"string"!=typeof f.panningModel?(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],c[1],c[2]);y.copy(c,b.fn);c=w;u.quat_to_dir(a,
u.AXIS_MY,c);f.setOrientation(c[0],c[1],c[2]);y.copy(c,b.direction);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.vw;f.coneOuterAngle=b.ww;f.coneOuterGain=b.xw;var h=F.createGain();h.gain.value=x(b);d?(f.connect(d),d.connect(h)):f.connect(h);h.connect(e);b.dc=f;if(b.Sh){var g=F.createGain();e.connect(g);g.connect(F?M.k.dc:null)}else g=null,e.connect(F?M.k.dc:null);break;case "BACKGROUND_SOUND":f=null;h=F.createGain();h.gain.value=x(b);d?(b.dc=d,
d.connect(h)):b.dc=h;h.connect(e);b.Sh?(g=F.createGain(),e.connect(g),g.connect(F?M.k.dc:null)):(g=null,e.connect(F?M.k.dc:null));break;case "BACKGROUND_MUSIC":g=f=null,h=F.createGain(),h.gain.value=x(b),d?(b.dc=d,d.connect(h)):b.dc=h,h.connect(e),e.connect(F?M.k.dc:null)}b.Ni=f;b.vd=d;b.$g=h;b.Qf=e;b.ls=g}}function e(a){var b=a.k,c=b.duration,b=b.delay+b.ox*Math.random();d(a,b,c)}function g(a){a.Sh&&a.ls.gain.cancelScheduledValues(a.Fc);a.Qi&&a.rb.playbackRate.cancelScheduledValues(a.Fc);a.jj=a.Fc}
function h(a){if(a.Sh||a.Qi){var b=a.ls,c=a.rb,d=c.buffer?c.buffer.duration:0;if(d){var e=a.Fc;O[0]=a.Al;for(var f=0;5>f;){var h=a.pitch+a.Qi*u.Uc(O);if(e>=a.jj){if(a.Sh){var g=1-u.clamp(a.Sh,0,1)*Math.random();b.gain.setValueAtTime(g,e)}a.Qi&&c.playbackRate.setValueAtTime(h,e);f++}e+=d/h}a.jj=e-.001}}}function k(a,b){if(a.vm||a.ge){var c=a.Qf;c.gain.cancelScheduledValues(b);a.vm?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.vm)):c.gain.setValueAtTime(1,b);a.ge&&!a.loop&&(c.gain.setValueAtTime(1,
b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.ge))}}function n(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.k;if(20==b.state||40==b.state){var c=b.Qf,d=F.currentTime;b.ge&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.ge));"BACKGROUND_MUSIC"==b.behavior?b.src&&(H.clear_timeout(b.El),H.clear_timeout(b.Fl),b.Fl=H.set_timeout(function(){var b=a.k.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.ge)):(c=b.rb,b.duration<c.buffer.duration?
b.ge&&20==b.state?c.stop(d+b.ge):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),b.Fc=0,b.Dn=0,b.Ml=0);b.state=30}}function f(a){a=a.k;if(20==a.state){var b=F.currentTime;a.Dn=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.Fc){O[0]=a.Al;for(var d=a.rb.buffer.duration,e=a.Fc;e<b;)c=a.pitch+a.Qi*u.Uc(O),e+=d/c;c*=d/c-(e-b)}else c=0;a.Ml=c;a.rb.stop(0);a.rb.disconnect();g(a)}a.state=40}}function l(a){var b=a.k;if(40==b.state){var c=F.currentTime;b.Fc+=c-b.Dn;if("BACKGROUND_MUSIC"==
b.behavior)b.src.play();else{a=a.k;var d=F.createBufferSource();d.loop=a.rb.loop;d.buffer=a.rb.buffer;d.playbackRate.value=a.rb.playbackRate.value;a.Ni?d.connect(a.Ni):d.connect(a.$g);a.rb=d;b.jj=c;b.rb.start(b.Fc,b.Ml);h(b)}k(b,b.Fc);b.state=20}}function t(a){return!a.k||20!=a.k.state&&40!=a.k.state&&30!=a.k.state?!1:!0}function x(a){return a.muted?0:a.volume}function z(a){a=a.k;return(a=a.src)?a.duration:0}var D=p("__config"),A=p("__print"),H=p("__time"),u=p("__util"),y=p("__vec3"),q=D.hd;a.Io=
10;a.hl=20;a.Ho=30;var w=new Float32Array(3),m=new Float32Array(3),r=new Float32Array(3),E=[],I=[],F=null,M=null,L=[],O=[1],B=null;a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(E.push("ogg"),E.push("ogv")),""!=a.canPlayType("audio/mpeg")&&E.push("mp3"),""!=a.canPlayType("audio/mp4")&&(E.push("mp4"),E.push("m4v")),""!=a.canPlayType("audio/webm")&&E.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&
I.push("ogv"),""!=b.canPlayType("video/mp4")&&I.push("m4v"),""!=b.canPlayType("video/webm")&&I.push("webm"));(F=q.Eo?c():null)&&A.log("%cINIT WEBAUDIO: "+F.sampleRate+"Hz","color: #00a")};a.fp=function(a){var b={eg:new Float32Array(3),ur:new Float32Array(3),kh:new Float32Array(3)};a.k=b;if(F){var c=F.createGain(),d=F.createGain();b.$g=c;b.Qf=d;c.connect(d);d.connect(F.destination);if(a.b4w_enable_dynamic_compressor){var d=F.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=
e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.ii=d;b.dc=d}else b.ii=null,b.dc=c;c=F.listener;b.Ug=D.p.Sl;b.Ug||(c.dopplerFactor=a.audio_doppler_factor,c.speedOfSound=a.audio_doppler_speed);b.muted=!1;b.volume=1;b.Pf=0}};a.FA=function(a){M=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<E.indexOf(a)?a:"ogg"==a&&-1<E.indexOf("mp4")?"mp4":"mp3"==a&&-1<E.indexOf("ogg")?"ogg":"mp4"==a&&-1<E.indexOf("ogg")?"ogg":"ogv"==
a&&-1<E.indexOf("m4v")?"m4v":"webm"==a&&-1<E.indexOf("m4v")?"m4v":"m4v"==a&&-1<E.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<I.indexOf(a)?a:"ogv"==a&&-1<I.indexOf("m4v")?"m4v":"webm"==a&&-1<I.indexOf("m4v")?"m4v":"m4v"==a&&-1<I.indexOf("webm")?"webm":""};a.append_object=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.k={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.k.behavior=F?b.b4w_behavior:"NONE";break;
case "BACKGROUND_MUSIC":var c=a.k,d;F?(window.MediaElementAudioSourceNode?d=!0:(A.warn("MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.k.behavior="NONE");a.k.Ug=b.b4w_disable_doppler&&D.p.Sl;a.k.muted=b.muted;a.k.volume=b.volume;a.k.pitch=b.pitch;a.k.attenuation=b.attenuation;a.k.dist_ref=b.distance_reference;a.k.dist_max=b.distance_max||1E4;a.k.vw=b.cone_angle_inner;a.k.ww=b.cone_angle_outer;
a.k.xw=b.cone_volume_outer;a.k.cyclic=b.b4w_cyclic_play;a.k.loop=b.b4w_loop;a.k.delay=b.b4w_delay;a.k.ox=b.b4w_delay_random;a.k.Sh=b.b4w_volume_random;a.k.Qi=b.b4w_pitch_random;a.k.vm=b.b4w_fade_in;a.k.ge=b.b4w_fade_out;a.k.Fc=0;a.k.Dn=0;a.k.Ml=0;a.k.duration=0;a.k.jj=0;a.k.Al=1;a.k.src=null;a.k.state=10;a.k.fn=new Float32Array(3);a.k.direction=new Float32Array(3);a.k.Zn=new Float32Array(3);a.k.El=-1;a.k.Fl=-1;a.k.Pf=0;L.push(a)};a.Ps=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.k.behavior){case "POSITIONAL":return a.hl;
case "BACKGROUND_SOUND":return a.hl;case "BACKGROUND_MUSIC":return a.Ho;case "NONE":return a.Io;default:throw"Wrong speaker behavior";}};a.jC=function(a,b){var c=a.k;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.Vz=function(){var a=F.createBufferSource();a.buffer=F.createBuffer(1,22050,22050);a.connect(F.destination);a.start(0)};a.kx=function(a,b,c){F?F.decodeAudioData(a,b,c):c()};a.kB=
function(a){n(a);delete a.k;L.splice(L.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<L.length;a++){var b=L[a].k;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.rb&&b.rb.disconnect()}M&&M.k&&(a=M.k,a.eg[0]=0,a.eg[1]=0,a.eg[2]=0,a.kh[0]=0,a.kh[1]=0,a.kh[2]=0);M=null;L.splice(0);B=null};a.update=function(a){if(F&&0!=L.length){for(var b=0;b<L.length;b++){var c=L[b],d=c.k,f=F.currentTime;F&&!d.loop&&d.cyclic&&20==d.state&&d.duration&&d.Fc+d.duration<f&&e(c);20==d.state&&3>d.jj-f&&h(d)}B&&B.we.length&&
(-1==B.Pa||a>B.Zo+B.eq[B.Pa])&&(b=B,-1<b.Pa&&n(b.we[b.Pa]),-1==b.Pa&&b.random?c=Math.round(Math.random()*(b.we.length-1)):b.random?(c=1+Math.round(Math.random()*(b.we.length-2)),c=(b.Pa+c)%b.we.length):c=(b.Pa+1)%b.we.length,e(b.we[c]),b.Pa=c,b.Zo=a)}};a.play=d;a.play_def=e;a.stop=n;a.is_play=function(a){return 20==a.k.state};a.jB=f;a.lB=l;a.playrate=function(a,b){var c=a.k;c.pitch=b;!t(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.rb.playbackRate.value=b,g(c),h(c))};a.get_playrate=
function(a){return a.k.pitch};a.cyclic=function(a,b){a.k.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.k.cyclic};a.qz=function(a,b,c,d){if(F&&a.k){var e=w;e[0]=0;e[1]=-1;e[2]=0;y.transformQuat(e,c,e);m[0]=0;m[1]=0;m[2]=-1;y.transformQuat(m,c,m);c=F.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],m[0],m[1],m[2]);y.copy(e,a.k.ur);!a.k.Ug&&d&&(r[0]=(b[0]-a.k.eg[0])/d,r[1]=(b[1]-a.k.eg[1])/d,r[2]=(b[2]-a.k.eg[2])/d,u.smooth_v(r,a.k.kh,d,.3,r),c.setVelocity(r[0],r[1],r[2]),
y.copy(r,a.k.kh));y.copy(b,a.k.eg)}};a.listener_reset_speed=function(a,b){if(F&&M.k&&!M.k.Ug){var c=w;b?y.copy(b,c):y.copy(M.k.ur,c);y.scale(c,a,c);F.listener.setVelocity(c[0],c[1],c[2]);y.copy(c,M.k.kh)}};a.mB=function(a,b){var c=a.k;if(t(a)&&"POSITIONAL"==c.behavior){var d=a.e.h,e=c.Ni;e.setPosition(d[0],d[1],d[2]);var f=w;u.quat_to_dir(a.e.quat,u.AXIS_MY,f);e.setOrientation(f[0],f[1],f[2]);f=c.fn;!c.Ug&&b&&(m[0]=(d[0]-f[0])/b,m[1]=(d[1]-f[1])/b,m[2]=(d[2]-f[2])/b,u.smooth_v(m,c.Zn,b,.3,m),e.setVelocity(m[0],
m[1],m[2]),y.copy(m,c.Zn));y.copy(d,f)}};a.speaker_reset_speed=function(a,b,c){var d=a.k;if(t(a)&&"POSITIONAL"==d.behavior&&!d.Ug){var e=w;c?y.copy(c,e):y.copy(d.direction,e);y.scale(e,b,e);d.Ni.setVelocity(e[0],e[1],e[2]);y.copy(e,d.Zn);y.copy(a.e.h,d.fn)}};a.le=function(a){return a.k?!0:!1};a.Lm=function(a){return a.k.behavior};a.check_active_speakers=function(){for(var a=0;a<L.length;a++)if(t(L[a]))return!0;return!1};a.OA=function(a){var b=M.k;b&&(b.volume=a,F&&(b.$g.gain.value=x(b)))};a.zy=function(){var a=
M.k;return a?a.volume:0};a.set_volume=function(a,b){var c=a.k;c.volume=b;t(a)&&(c.$g.gain.value=x(c))};a.get_volume=function(a){return a.k.volume};a.mute=function(a,b){a.k.muted=Boolean(b);t(a)&&(a.k.$g.gain.value=x(a.k))};a.is_muted=function(a){return a.k.muted};a.Fz=function(a){var b=M.k;b&&(b.muted=Boolean(a),F&&(b.$g.gain.value=x(b)))};a.gz=function(){var a=M.k;return a?a.muted:!1};a.get_speaker_objects=function(){return L};a.pause=function(){for(var a=0;a<L.length;a++)f(L[a])};a.resume=function(){for(var a=
0;a<L.length;a++)l(L[a])};a.set_compressor_params=function(a,b){if(a.k&&a.k.ii){var c=a.k.ii;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.k||!a.k.ii)return null;a=a.k.ii;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(t(a)){a=a.k;var d=a.Qf,e=F.currentTime;d.gain.setValueAtTime(d.gain.value,
e);d.gain.linearRampToValueAtTime(b,e+c);a.Pf=c}};a.unduck=function(a){if(t(a)){a=a.k;var b=a.Qf,c=F.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Pf);a.Pf=0}};a.vx=function(a,b){if(F){var c=M.k,d=c.Qf,e=F.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.Pf=b}};a.QB=function(){if(F){var a=M.k,b=a.Qf,c=F.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Pf);a.Pf=0}};a.apply_playlist=
function(a,b,c){B={Pa:-1,Zo:0,random:c,we:[],eq:[]};for(c=0;c<a.length;c++){var d=a[c],e=z(d);0==e?A.warn("Ignoring speaker with zero duration: "+d.name):(n(d),d.k.cyclic=!1,B.we.push(d),B.eq.push(e+b))}};a.get_duration=z;a.clear_playlist=function(){if(B)for(var a=B.we,b=0;b<a.length;b++)n(a[b]);B=null};a.get_positional_params=function(a){return(a=a.k)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.k;
if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.Ni;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.k;c&&c.vd&&(c.vd.frequency.value=b.freq,c.vd.Q.value=b.Q,c.vd.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.k)&&a.vd?{freq:a.vd.frequency.value,Q:a.vd.Q.value,gain:a.vd.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.k;if(!a||
!a.vd)return null;a.vd.getFrequencyResponse(b,c,d)}};b4w.module.__vec3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new p(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var b=new p(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.fromValues=function(a,b,c){var g=new p(3);g[0]=a;g[1]=b;g[2]=c;return g};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set=function(a,b,c,g){g[0]=a;g[1]=b;g[2]=c;return g};a.add=function(a,b,c){c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];
return c};a.subtract=function(a,b,c){c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c};a.sub=a.subtract;a.multiply=function(a,b,c){c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c};a.mul=a.multiply;a.divide=function(a,b,c){c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];return c};a.div=a.divide;a.min=function(a,b,c){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);c[2]=Math.min(a[2],b[2]);return c};a.max=function(a,b,c){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);c[2]=Math.max(a[2],
b[2]);return c};a.scale=function(a,b,c){c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c};a.scaleAndAdd=function(a,b,c,g){g[0]=a[0]+b[0]*c;g[1]=a[1]+b[1]*c;g[2]=a[2]+b[2]*c;return g};a.distance=function(a,b){var c=b[0]-a[0],g=b[1]-a[1],h=b[2]-a[2];return Math.sqrt(c*c+g*g+h*h)};a.dist=a.distance;a.squaredDistance=function(a,b){var c=b[0]-a[0],g=b[1]-a[1],h=b[2]-a[2];return c*c+g*g+h*h};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)};a.len=a.length;
a.squaredLength=function(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];return b};a.normalize=function(a,b){var c=a[0],g=a[1],h=a[2],c=c*c+g*g+h*h;0<c&&(c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};a.cross=function(a,b,c){var g=a[0],h=a[1];a=a[2];var k=b[0],n=b[1];b=b[2];
c[0]=h*b-a*n;c[1]=a*k-g*b;c[2]=g*n-h*k;return c};a.lerp=function(a,b,c,g){var h=a[0],k=a[1];a=a[2];g[0]=h+c*(b[0]-h);g[1]=k+c*(b[1]-k);g[2]=a+c*(b[2]-a);return g};a.random=function(a,b){a=a||1;var e=2*c()*Math.PI,g=2*c()-1,h=Math.sqrt(1-g*g)*a;b[0]=Math.cos(e)*h;b[1]=Math.sin(e)*h;b[2]=g*a;return b};a.transformMat4=function(a,b,c){var g=a[0],h=a[1];a=a[2];var k=b[3]*g+b[7]*h+b[11]*a+b[15],k=k||1;c[0]=(b[0]*g+b[4]*h+b[8]*a+b[12])/k;c[1]=(b[1]*g+b[5]*h+b[9]*a+b[13])/k;c[2]=(b[2]*g+b[6]*h+b[10]*a+b[14])/
k;return c};a.transformMat3=function(a,b,c){var g=a[0],h=a[1];a=a[2];c[0]=g*b[0]+h*b[3]+a*b[6];c[1]=g*b[1]+h*b[4]+a*b[7];c[2]=g*b[2]+h*b[5]+a*b[8];return c};a.transformQuat=function(a,b,c){var g=a[0],h=a[1],k=a[2];a=b[0];var n=b[1],f=b[2];b=b[3];var l=b*g+n*k-f*h,t=b*h+f*g-a*k,x=b*k+a*h-n*g,g=-a*g-n*h-f*k;c[0]=l*b+g*-a+t*-f-x*-n;c[1]=t*b+g*-n+x*-a-l*-f;c[2]=x*b+g*-f+l*-n-t*-a;return c};a.rotateX=function(a,b,c,g){var h=[],k=[];h[0]=a[0]-b[0];h[1]=a[1]-b[1];h[2]=a[2]-b[2];k[0]=h[0];k[1]=h[1]*Math.cos(c)-
h[2]*Math.sin(c);k[2]=h[1]*Math.sin(c)+h[2]*Math.cos(c);g[0]=k[0]+b[0];g[1]=k[1]+b[1];g[2]=k[2]+b[2];return g};a.rotateY=function(a,b,c,g){var h=[],k=[];h[0]=a[0]-b[0];h[1]=a[1]-b[1];h[2]=a[2]-b[2];k[0]=h[2]*Math.sin(c)+h[0]*Math.cos(c);k[1]=h[1];k[2]=h[2]*Math.cos(c)-h[0]*Math.sin(c);g[0]=k[0]+b[0];g[1]=k[1]+b[1];g[2]=k[2]+b[2];return g};a.rotateZ=function(a,b,c,g){var h=[],k=[];h[0]=a[0]-b[0];h[1]=a[1]-b[1];h[2]=a[2]-b[2];k[0]=h[0]*Math.cos(c)-h[1]*Math.sin(c);k[1]=h[0]*Math.sin(c)+h[1]*Math.cos(c);
k[2]=h[2];g[0]=k[0]+b[0];g[1]=k[1]+b[1];g[2]=k[2]+b[2];return g};a.forEach=function(){var c=a.create();return function(a,e,g,h,k,n){e||(e=3);g||(g=0);for(h=h?Math.min(h*e+g,a.length):a.length;g<h;g+=e)c[0]=a[g],c[1]=a[g+1],c[2]=a[g+2],k(c,n,c),a[g]=c[0],a[g+1]=c[1],a[g+2]=c[2];return a}}();a.hD=function(c,b){var e=a.fromValues(c[0],c[1],c[2]),g=a.fromValues(b[0],b[1],b[2]);a.normalize(e,e);a.normalize(g,g);e=a.dot(e,g);return 1<e?0:Math.acos(e)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+
a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};b4w.module.vec3=b4w.module.__vec3;
b4w.module.__vec4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new p(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var b=new p(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=function(a,b,c,g){var h=new p(4);h[0]=a;h[1]=b;h[2]=c;h[3]=g;return h};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set=function(a,b,c,g,h){h[0]=a;h[1]=b;h[2]=c;h[3]=g;return h};a.add=function(a,b,c){c[0]=
a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c};a.subtract=function(a,b,c){c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];return c};a.sub=a.subtract;a.multiply=function(a,b,c){c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];c[3]=a[3]*b[3];return c};a.mul=a.multiply;a.divide=function(a,b,c){c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];c[3]=a[3]/b[3];return c};a.div=a.divide;a.min=function(a,b,c){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);c[2]=Math.min(a[2],b[2]);c[3]=
Math.min(a[3],b[3]);return c};a.max=function(a,b,c){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);c[2]=Math.max(a[2],b[2]);c[3]=Math.max(a[3],b[3]);return c};a.scale=function(a,b,c){c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c};a.scaleAndAdd=function(a,b,c,g){g[0]=a[0]+b[0]*c;g[1]=a[1]+b[1]*c;g[2]=a[2]+b[2]*c;g[3]=a[3]+b[3]*c;return g};a.distance=function(a,b){var c=b[0]-a[0],g=b[1]-a[1],h=b[2]-a[2],k=b[3]-a[3];return Math.sqrt(c*c+g*g+h*h+k*k)};a.dist=a.distance;a.squaredDistance=
function(a,b){var c=b[0]-a[0],g=b[1]-a[1],h=b[2]-a[2],k=b[3]-a[3];return c*c+g*g+h*h+k*k};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],c=a[1],g=a[2];a=a[3];return Math.sqrt(b*b+c*c+g*g+a*a)};a.len=a.length;a.squaredLength=function(a){var b=a[0],c=a[1],g=a[2];a=a[3];return b*b+c*c+g*g+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];b[3]=1/a[3];return b};a.normalize=
function(a,b){var c=a[0],g=a[1],h=a[2],k=a[3],c=c*c+g*g+h*h+k*k;0<c&&(c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c,b[3]=a[3]*c);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};a.lerp=function(a,b,c,g){var h=a[0],k=a[1],n=a[2];a=a[3];g[0]=h+c*(b[0]-h);g[1]=k+c*(b[1]-k);g[2]=n+c*(b[2]-n);g[3]=a+c*(b[3]-a);return g};a.random=function(d,b){d=d||1;b[0]=c();b[1]=c();b[2]=c();b[3]=c();a.normalize(b,b);a.scale(b,d,b);return b};a.transformMat4=function(a,b,c){var g=a[0],
h=a[1],k=a[2];a=a[3];c[0]=b[0]*g+b[4]*h+b[8]*k+b[12]*a;c[1]=b[1]*g+b[5]*h+b[9]*k+b[13]*a;c[2]=b[2]*g+b[6]*h+b[10]*k+b[14]*a;c[3]=b[3]*g+b[7]*h+b[11]*k+b[15]*a;return c};a.transformQuat=function(a,b,c){var g=a[0],h=a[1],k=a[2],n=b[0],f=b[1],l=b[2];b=b[3];var t=b*g+f*k-l*h,x=b*h+l*g-n*k,p=b*k+n*h-f*g,g=-n*g-f*h-l*k;c[0]=t*b+g*-n+x*-l-p*-f;c[1]=x*b+g*-f+p*-n-t*-l;c[2]=p*b+g*-l+t*-f-x*-n;c[3]=a[3];return c};a.forEach=function(){var c=a.create();return function(a,e,g,h,k,n){e||(e=4);g||(g=0);for(h=h?Math.min(h*
e+g,a.length):a.length;g<h;g+=e)c[0]=a[g],c[1]=a[g+1],c[2]=a[g+2],c[3]=a[g+3],k(c,n,c),a[g]=c[0],a[g+1]=c[1],a[g+2]=c[2],a[g+3]=c[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};b4w.module.vec4=b4w.module.__vec4;
b4w.module.__quat=function(a,p){var c=p("__vec3"),d=p("__vec4"),b=p("__mat3"),e="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new e(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=c.create(),d=c.fromValues(1,0,0),e=c.fromValues(0,1,0);return function(n,f,l){var t=c.dot(n,f);if(-.9999999>t)return c.cross(d,n,b),1E-6>c.length(b)&&c.cross(e,n,b),c.normalize(b,b),a.setAxisAngle(b,Math.PI,l),l;if(.9999999<t)return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l;c.cross(n,
f,b);l[0]=b[0];l[1]=b[1];l[2]=b[2];l[3]=1+t;return a.normalize(l,l)}}();a.setAxes=function(){var c=b.create();return function(b,d,e,f){c[0]=d[0];c[3]=d[1];c[6]=d[2];c[1]=e[0];c[4]=e[1];c[7]=e[2];c[2]=-b[0];c[5]=-b[1];c[8]=-b[2];return a.normalize(a.fromMat3(c,f),f)}}();a.clone=d.clone;a.fromValues=d.fromValues;a.copy=d.copy;a.set=d.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=d.add;a.multiply=function(a,b,c){var d=a[0],f=a[1],e=a[2];a=a[3];var t=b[0],x=b[1],p=b[2];b=b[3];c[0]=d*b+a*t+f*p-e*x;c[1]=f*b+a*x+e*t-d*p;c[2]=e*b+a*p+d*x-f*t;c[3]=a*b-d*t-f*x-e*p;return c};a.mul=a.multiply;a.scale=d.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],f=a[1],e=a[2];a=a[3];var t=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*t;c[1]=f*b+e*t;c[2]=e*b-f*t;c[3]=a*b-d*t;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],f=a[1],e=a[2];a=a[3];var t=Math.sin(b);b=Math.cos(b);c[0]=d*
b-e*t;c[1]=f*b+a*t;c[2]=e*b+d*t;c[3]=a*b-f*t;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],f=a[1],e=a[2];a=a[3];var t=Math.sin(b);b=Math.cos(b);c[0]=d*b+f*t;c[1]=f*b-d*t;c[2]=e*b+a*t;c[3]=a*b-e*t;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];b[0]=c;b[1]=d;b[2]=e;b[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};a.dot=d.dot;a.lerp=d.lerp;a.slerp=function(a,b,c,d){var e=a[0],l=a[1],t=a[2];a=a[3];var p=b[0],z=b[1],D=b[2];b=b[3];var A,H,u;H=e*p+l*z+t*D+a*b;0>H&&(H=-H,p=-p,z=-z,
D=-D,b=-b);1E-6<1-H?(A=Math.acos(H),u=Math.sin(A),H=Math.sin((1-c)*A)/u,c=Math.sin(c*A)/u):H=1-c;d[0]=H*e+c*p;d[1]=H*l+c*z;d[2]=H*t+c*D;d[3]=H*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],e=a[2],l=a[3],t=c*c+d*d+e*e+l*l,t=t?1/t:0;b[0]=-c*t;b[1]=-d*t;b[2]=-e*t;b[3]=l*t;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=d.length;a.len=a.length;a.squaredLength=d.squaredLength;a.sqrLen=a.squaredLength;a.normalize=d.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var e=(d+1)%3,l=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*e+e]-a[3*l+l]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*e+l]-a[3*l+e])*c;b[e]=(a[3*e+d]+a[3*d+e])*c;b[l]=(a[3*l+d]+a[3*d+l])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};b4w.module.quat=b4w.module.__quat;
b4w.module.__mat3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[4];d[4]=a[5];d[5]=a[6];d[6]=a[8];d[7]=a[9];d[8]=a[10];return d};a.clone=function(a){var d=new p(9);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];return d};a.copy=function(a,d){d[0]=a[0];d[1]=a[1];d[2]=
a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];return d};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,d){if(d===a){var b=a[1],e=a[2],g=a[5];d[1]=a[3];d[2]=a[6];d[3]=b;d[5]=a[7];d[6]=e;d[7]=g}else d[0]=a[0],d[1]=a[3],d[2]=a[6],d[3]=a[1],d[4]=a[4],d[5]=a[7],d[6]=a[2],d[7]=a[5],d[8]=a[8];return d};a.invert=function(a,d){var b=a[0],e=a[1],g=a[2],h=a[3],k=a[4],n=a[5],f=a[6],l=a[7],t=a[8],p=t*k-n*l,z=-t*h+n*f,D=
l*h-k*f,A=b*p+e*z+g*D;if(!A)return null;A=1/A;d[0]=p*A;d[1]=(-t*e+g*l)*A;d[2]=(n*e-g*k)*A;d[3]=z*A;d[4]=(t*b-g*f)*A;d[5]=(-n*b+g*h)*A;d[6]=D*A;d[7]=(-l*b+e*f)*A;d[8]=(k*b-e*h)*A;return d};a.adjoint=function(a,d){var b=a[0],e=a[1],g=a[2],h=a[3],k=a[4],n=a[5],f=a[6],l=a[7],t=a[8];d[0]=k*t-n*l;d[1]=g*l-e*t;d[2]=e*n-g*k;d[3]=n*f-h*t;d[4]=b*t-g*f;d[5]=g*h-b*n;d[6]=h*l-k*f;d[7]=e*f-b*l;d[8]=b*k-e*h;return d};a.determinant=function(a){var d=a[3],b=a[4],e=a[5],g=a[6],h=a[7],k=a[8];return a[0]*(k*b-e*h)+a[1]*
(-k*d+e*g)+a[2]*(h*d-b*g)};a.multiply=function(a,d,b){var e=a[0],g=a[1],h=a[2],k=a[3],n=a[4],f=a[5],l=a[6],t=a[7];a=a[8];var p=d[0],z=d[1],D=d[2],A=d[3],H=d[4],u=d[5],y=d[6],q=d[7];d=d[8];b[0]=p*e+z*k+D*l;b[1]=p*g+z*n+D*t;b[2]=p*h+z*f+D*a;b[3]=A*e+H*k+u*l;b[4]=A*g+H*n+u*t;b[5]=A*h+H*f+u*a;b[6]=y*e+q*k+d*l;b[7]=y*g+q*n+d*t;b[8]=y*h+q*f+d*a;return b};a.mul=a.multiply;a.translate=function(a,d,b){var e=a[0],g=a[1],h=a[2],k=a[3],n=a[4],f=a[5],l=a[6],t=a[7];a=a[8];var p=d[0];d=d[1];b[0]=e;b[1]=g;b[2]=h;
b[3]=k;b[4]=n;b[5]=f;b[6]=p*e+d*k+l;b[7]=p*g+d*n+t;b[8]=p*h+d*f+a;return b};a.rotate=function(a,d,b){var e=a[0],g=a[1],h=a[2],k=a[3],n=a[4],f=a[5],l=a[6],t=a[7];a=a[8];var p=Math.sin(d);d=Math.cos(d);b[0]=d*e+p*k;b[1]=d*g+p*n;b[2]=d*h+p*f;b[3]=d*k-p*e;b[4]=d*n-p*g;b[5]=d*f-p*h;b[6]=l;b[7]=t;b[8]=a;return b};a.scale=function(a,d,b){var e=d[0];d=d[1];b[0]=e*a[0];b[1]=e*a[1];b[2]=e*a[2];b[3]=d*a[3];b[4]=d*a[4];b[5]=d*a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.Sx=function(a,d){d[0]=1;d[1]=0;d[2]=
0;d[3]=0;d[4]=1;d[5]=0;d[6]=a[0];d[7]=a[1];d[8]=1;return d};a.Qx=function(a,d){var b=Math.sin(a),e=Math.cos(a);d[0]=e;d[1]=b;d[2]=0;d[3]=-b;d[4]=e;d[5]=0;d[6]=0;d[7]=0;d[8]=1;return d};a.Rx=function(a,d){d[0]=a[0];d[1]=0;d[2]=0;d[3]=0;d[4]=a[1];d[5]=0;d[6]=0;d[7]=0;d[8]=1;return d};a.fromMat2d=function(a,d){d[0]=a[0];d[1]=a[1];d[2]=0;d[3]=a[2];d[4]=a[3];d[5]=0;d[6]=a[4];d[7]=a[5];d[8]=1;return d};a.fromQuat=function(a,d){var b=a[0],e=a[1],g=a[2],h=a[3],k=b+b,n=e+e,f=g+g,b=b*k,l=e*k,e=e*n,t=g*k,p=
g*n,g=g*f,k=h*k,n=h*n,h=h*f;d[0]=1-e-g;d[3]=l-h;d[6]=t+n;d[1]=l+h;d[4]=1-b-g;d[7]=p-k;d[2]=t-n;d[5]=p+k;d[8]=1-b-e;return d};a.normalFromMat4=function(a,d){var b=a[0],e=a[1],g=a[2],h=a[3],k=a[4],n=a[5],f=a[6],l=a[7],t=a[8],p=a[9],z=a[10],D=a[11],A=a[12],H=a[13],u=a[14],y=a[15],q=b*n-e*k,w=b*f-g*k,m=b*l-h*k,r=e*f-g*n,E=e*l-h*n,I=g*l-h*f,F=t*H-p*A,M=t*u-z*A,t=t*y-D*A,L=p*u-z*H,p=p*y-D*H,z=z*y-D*u,D=q*z-w*p+m*L+r*t-E*M+I*F;if(!D)return null;D=1/D;d[0]=(n*z-f*p+l*L)*D;d[1]=(f*t-k*z-l*M)*D;d[2]=(k*p-n*
t+l*F)*D;d[3]=(g*p-e*z-h*L)*D;d[4]=(b*z-g*t+h*M)*D;d[5]=(e*t-b*p-h*F)*D;d[6]=(H*I-u*E+y*r)*D;d[7]=(u*m-A*I-y*w)*D;d[8]=(A*E-H*m+y*q)*D;return d};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.Px=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat3=b4w.module.__mat3;
b4w.module.__mat4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var d=new p(16);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];d[9]=a[9];d[10]=a[10];d[11]=a[11];d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};a.copy=function(a,d){d[0]=a[0];
d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];d[9]=a[9];d[10]=a[10];d[11]=a[11];d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,d){if(d===a){var b=a[1],e=a[2],g=a[3],h=a[6],k=a[7],n=a[11];d[1]=a[4];d[2]=a[8];d[3]=a[12];d[4]=b;d[6]=a[9];d[7]=a[13];d[8]=e;d[9]=h;d[11]=a[14];d[12]=g;d[13]=
k;d[14]=n}else d[0]=a[0],d[1]=a[4],d[2]=a[8],d[3]=a[12],d[4]=a[1],d[5]=a[5],d[6]=a[9],d[7]=a[13],d[8]=a[2],d[9]=a[6],d[10]=a[10],d[11]=a[14],d[12]=a[3],d[13]=a[7],d[14]=a[11],d[15]=a[15];return d};a.invert=function(a,d){var b=a[0],e=a[1],g=a[2],h=a[3],k=a[4],n=a[5],f=a[6],l=a[7],t=a[8],p=a[9],z=a[10],D=a[11],A=a[12],H=a[13],u=a[14],y=a[15],q=b*n-e*k,w=b*f-g*k,m=b*l-h*k,r=e*f-g*n,E=e*l-h*n,I=g*l-h*f,F=t*H-p*A,M=t*u-z*A,L=t*y-D*A,O=p*u-z*H,B=p*y-D*H,J=z*y-D*u,K=q*J-w*B+m*O+r*L-E*M+I*F;if(!K)return null;
K=1/K;d[0]=(n*J-f*B+l*O)*K;d[1]=(g*B-e*J-h*O)*K;d[2]=(H*I-u*E+y*r)*K;d[3]=(z*E-p*I-D*r)*K;d[4]=(f*L-k*J-l*M)*K;d[5]=(b*J-g*L+h*M)*K;d[6]=(u*m-A*I-y*w)*K;d[7]=(t*I-z*m+D*w)*K;d[8]=(k*B-n*L+l*F)*K;d[9]=(e*L-b*B-h*F)*K;d[10]=(A*E-H*m+y*q)*K;d[11]=(p*m-t*E-D*q)*K;d[12]=(n*M-k*O-f*F)*K;d[13]=(b*O-e*M+g*F)*K;d[14]=(H*w-A*r-u*q)*K;d[15]=(t*r-p*w+z*q)*K;return d};a.adjoint=function(a,d){var b=a[0],e=a[1],g=a[2],h=a[3],k=a[4],n=a[5],f=a[6],l=a[7],t=a[8],p=a[9],z=a[10],D=a[11],A=a[12],H=a[13],u=a[14],y=a[15];
d[0]=n*(z*y-D*u)-p*(f*y-l*u)+H*(f*D-l*z);d[1]=-(e*(z*y-D*u)-p*(g*y-h*u)+H*(g*D-h*z));d[2]=e*(f*y-l*u)-n*(g*y-h*u)+H*(g*l-h*f);d[3]=-(e*(f*D-l*z)-n*(g*D-h*z)+p*(g*l-h*f));d[4]=-(k*(z*y-D*u)-t*(f*y-l*u)+A*(f*D-l*z));d[5]=b*(z*y-D*u)-t*(g*y-h*u)+A*(g*D-h*z);d[6]=-(b*(f*y-l*u)-k*(g*y-h*u)+A*(g*l-h*f));d[7]=b*(f*D-l*z)-k*(g*D-h*z)+t*(g*l-h*f);d[8]=k*(p*y-D*H)-t*(n*y-l*H)+A*(n*D-l*p);d[9]=-(b*(p*y-D*H)-t*(e*y-h*H)+A*(e*D-h*p));d[10]=b*(n*y-l*H)-k*(e*y-h*H)+A*(e*l-h*n);d[11]=-(b*(n*D-l*p)-k*(e*D-h*p)+t*
(e*l-h*n));d[12]=-(k*(p*u-z*H)-t*(n*u-f*H)+A*(n*z-f*p));d[13]=b*(p*u-z*H)-t*(e*u-g*H)+A*(e*z-g*p);d[14]=-(b*(n*u-f*H)-k*(e*u-g*H)+A*(e*f-g*n));d[15]=b*(n*z-f*p)-k*(e*z-g*p)+t*(e*f-g*n);return d};a.determinant=function(a){var d=a[0],b=a[1],e=a[2],g=a[3],h=a[4],k=a[5],n=a[6],f=a[7],l=a[8],t=a[9],p=a[10],z=a[11],D=a[12],A=a[13],H=a[14];a=a[15];return(d*k-b*h)*(p*a-z*H)-(d*n-e*h)*(t*a-z*A)+(d*f-g*h)*(t*H-p*A)+(b*n-e*k)*(l*a-z*D)-(b*f-g*k)*(l*H-p*D)+(e*f-g*n)*(l*A-t*D)};a.multiply=function(a,d,b){var e=
a[0],g=a[1],h=a[2],k=a[3],n=a[4],f=a[5],l=a[6],t=a[7],p=a[8],z=a[9],D=a[10],A=a[11],H=a[12],u=a[13],y=a[14];a=a[15];var q=d[0],w=d[1],m=d[2],r=d[3];b[0]=q*e+w*n+m*p+r*H;b[1]=q*g+w*f+m*z+r*u;b[2]=q*h+w*l+m*D+r*y;b[3]=q*k+w*t+m*A+r*a;q=d[4];w=d[5];m=d[6];r=d[7];b[4]=q*e+w*n+m*p+r*H;b[5]=q*g+w*f+m*z+r*u;b[6]=q*h+w*l+m*D+r*y;b[7]=q*k+w*t+m*A+r*a;q=d[8];w=d[9];m=d[10];r=d[11];b[8]=q*e+w*n+m*p+r*H;b[9]=q*g+w*f+m*z+r*u;b[10]=q*h+w*l+m*D+r*y;b[11]=q*k+w*t+m*A+r*a;q=d[12];w=d[13];m=d[14];r=d[15];b[12]=q*e+
w*n+m*p+r*H;b[13]=q*g+w*f+m*z+r*u;b[14]=q*h+w*l+m*D+r*y;b[15]=q*k+w*t+m*A+r*a;return b};a.mul=a.multiply;a.translate=function(a,d,b){var e=d[0],g=d[1];d=d[2];var h,k,n,f,l,t,p,z,D,A,H,u;a===b?(b[12]=a[0]*e+a[4]*g+a[8]*d+a[12],b[13]=a[1]*e+a[5]*g+a[9]*d+a[13],b[14]=a[2]*e+a[6]*g+a[10]*d+a[14],b[15]=a[3]*e+a[7]*g+a[11]*d+a[15]):(h=a[0],k=a[1],n=a[2],f=a[3],l=a[4],t=a[5],p=a[6],z=a[7],D=a[8],A=a[9],H=a[10],u=a[11],b[0]=h,b[1]=k,b[2]=n,b[3]=f,b[4]=l,b[5]=t,b[6]=p,b[7]=z,b[8]=D,b[9]=A,b[10]=H,b[11]=u,
b[12]=h*e+l*g+D*d+a[12],b[13]=k*e+t*g+A*d+a[13],b[14]=n*e+p*g+H*d+a[14],b[15]=f*e+z*g+u*d+a[15]);return b};a.scale=function(a,d,b){var e=d[0],g=d[1];d=d[2];b[0]=a[0]*e;b[1]=a[1]*e;b[2]=a[2]*e;b[3]=a[3]*e;b[4]=a[4]*g;b[5]=a[5]*g;b[6]=a[6]*g;b[7]=a[7]*g;b[8]=a[8]*d;b[9]=a[9]*d;b[10]=a[10]*d;b[11]=a[11]*d;b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.rotate=function(a,d,b,e){var g=b[0],h=b[1];b=b[2];var k=Math.sqrt(g*g+h*h+b*b),n,f,l,t,p,z,D,A,H,u,y,q,w,m,r,E,I,F,M,L;if(1E-7>Math.abs(k))return null;
k=1/k;g*=k;h*=k;b*=k;n=Math.sin(d);f=Math.cos(d);l=1-f;d=a[0];k=a[1];t=a[2];p=a[3];z=a[4];D=a[5];A=a[6];H=a[7];u=a[8];y=a[9];q=a[10];w=a[11];m=g*g*l+f;r=h*g*l+b*n;E=b*g*l-h*n;I=g*h*l-b*n;F=h*h*l+f;M=b*h*l+g*n;L=g*b*l+h*n;g=h*b*l-g*n;h=b*b*l+f;e[0]=d*m+z*r+u*E;e[1]=k*m+D*r+y*E;e[2]=t*m+A*r+q*E;e[3]=p*m+H*r+w*E;e[4]=d*I+z*F+u*M;e[5]=k*I+D*F+y*M;e[6]=t*I+A*F+q*M;e[7]=p*I+H*F+w*M;e[8]=d*L+z*g+u*h;e[9]=k*L+D*g+y*h;e[10]=t*L+A*g+q*h;e[11]=p*L+H*g+w*h;a!==e&&(e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);
return e};a.rotateX=function(a,d,b){var e=Math.sin(d);d=Math.cos(d);var g=a[4],h=a[5],k=a[6],n=a[7],f=a[8],l=a[9],t=a[10],p=a[11];a!==b&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[4]=g*d+f*e;b[5]=h*d+l*e;b[6]=k*d+t*e;b[7]=n*d+p*e;b[8]=f*d-g*e;b[9]=l*d-h*e;b[10]=t*d-k*e;b[11]=p*d-n*e;return b};a.rotateY=function(a,d,b){var e=Math.sin(d);d=Math.cos(d);var g=a[0],h=a[1],k=a[2],n=a[3],f=a[8],l=a[9],t=a[10],p=a[11];a!==b&&(b[4]=a[4],b[5]=a[5],b[6]=a[6],
b[7]=a[7],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[0]=g*d-f*e;b[1]=h*d-l*e;b[2]=k*d-t*e;b[3]=n*d-p*e;b[8]=g*e+f*d;b[9]=h*e+l*d;b[10]=k*e+t*d;b[11]=n*e+p*d;return b};a.rotateZ=function(a,d,b){var e=Math.sin(d);d=Math.cos(d);var g=a[0],h=a[1],k=a[2],n=a[3],f=a[4],l=a[5],t=a[6],p=a[7];a!==b&&(b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[0]=g*d+f*e;b[1]=h*d+l*e;b[2]=k*d+t*e;b[3]=n*d+p*e;b[4]=f*d-g*e;b[5]=l*d-h*e;b[6]=t*d-k*e;b[7]=p*d-n*e;return b};
a.Sx=function(a,d){d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=a[0];d[13]=a[1];d[14]=a[2];d[15]=1;return d};a.Rx=function(a,d){d[0]=a[0];d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=a[1];d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=a[2];d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.Qx=function(a,d,b){var e=d[0],g=d[1];d=d[2];var h=Math.sqrt(e*e+g*g+d*d),k;if(1E-7>Math.abs(h))return null;h=1/h;e*=h;g*=h;d*=h;h=Math.sin(a);a=Math.cos(a);k=1-a;b[0]=e*e*k+a;b[1]=g*e*k+d*
h;b[2]=d*e*k-g*h;b[3]=0;b[4]=e*g*k-d*h;b[5]=g*g*k+a;b[6]=d*g*k+e*h;b[7]=0;b[8]=e*d*k+g*h;b[9]=g*d*k-e*h;b[10]=d*d*k+a;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.XD=function(a,d){var b=Math.sin(a),e=Math.cos(a);d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=e;d[6]=b;d[7]=0;d[8]=0;d[9]=-b;d[10]=e;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.YD=function(a,d){var b=Math.sin(a),e=Math.cos(a);d[0]=e;d[1]=0;d[2]=-b;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=b;d[9]=0;d[10]=e;d[11]=0;d[12]=0;d[13]=0;
d[14]=0;d[15]=1;return d};a.ZD=function(a,d){var b=Math.sin(a),e=Math.cos(a);d[0]=e;d[1]=b;d[2]=0;d[3]=0;d[4]=-b;d[5]=e;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.fromRotationTranslation=function(a,d,b){var e=a[0],g=a[1],h=a[2],k=a[3],n=e+e,f=g+g,l=h+h;a=e*n;var t=e*f,e=e*l,p=g*f,g=g*l,h=h*l,n=k*n,f=k*f,k=k*l;b[0]=1-(p+h);b[1]=t+k;b[2]=e-f;b[3]=0;b[4]=t-k;b[5]=1-(a+h);b[6]=g+n;b[7]=0;b[8]=e+f;b[9]=g-n;b[10]=1-(a+p);b[11]=0;b[12]=d[0];b[13]=d[1];b[14]=d[2];
b[15]=1;return b};a.fromQuat=function(a,d){var b=a[0],e=a[1],g=a[2],h=a[3],k=b+b,n=e+e,f=g+g,b=b*k,l=e*k,e=e*n,t=g*k,p=g*n,g=g*f,k=h*k,n=h*n,h=h*f;d[0]=1-e-g;d[1]=l+h;d[2]=t-n;d[3]=0;d[4]=l-h;d[5]=1-b-g;d[6]=p+k;d[7]=0;d[8]=t+n;d[9]=p-k;d[10]=1-b-e;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.frustum=function(a,d,b,e,g,h,k){var n=1/(d-a),f=1/(e-b),l=1/(g-h);k[0]=2*g*n;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=2*g*f;k[6]=0;k[7]=0;k[8]=(d+a)*n;k[9]=(e+b)*f;k[10]=(h+g)*l;k[11]=-1;k[12]=0;k[13]=0;k[14]=
h*g*2*l;k[15]=0;return k};a.perspective=function(a,d,b,e,g){a=1/Math.tan(a/2);var h=1/(b-e);g[0]=a/d;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=a;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=(e+b)*h;g[11]=-1;g[12]=0;g[13]=0;g[14]=2*e*b*h;g[15]=0;return g};a.TE=function(a,d,b,e){var g=Math.tan(a.jF*Math.PI/180),h=Math.tan(a.MD*Math.PI/180),k=Math.tan(a.FE*Math.PI/180);a=Math.tan(a.VE*Math.PI/180);var n=2/(k+a),f=2/(g+h);e[0]=n;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=f;e[6]=0;e[7]=0;e[8]=-((k-a)*n*.5);e[9]=(g-h)*f*.5;e[10]=b/
(d-b);e[11]=-1;e[12]=0;e[13]=0;e[14]=b*d/(d-b);e[15]=0;return e};a.ortho=function(a,d,b,e,g,h,k){var n=1/(a-d),f=1/(b-e),l=1/(g-h);k[0]=-2*n;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=-2*f;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=2*l;k[11]=0;k[12]=(a+d)*n;k[13]=(e+b)*f;k[14]=(h+g)*l;k[15]=1;return k};a.lookAt=function(c,d,b,e){var g,h,k,n,f,l,t,p,z=c[0],D=c[1];c=c[2];k=b[0];n=b[1];h=b[2];t=d[0];b=d[1];g=d[2];if(1E-7>Math.abs(z-t)&&1E-7>Math.abs(D-b)&&1E-7>Math.abs(c-g))return a.identity(e);d=z-t;b=D-b;t=c-g;p=1/Math.sqrt(d*
d+b*b+t*t);d*=p;b*=p;t*=p;g=n*t-h*b;h=h*d-k*t;k=k*b-n*d;(p=Math.sqrt(g*g+h*h+k*k))?(p=1/p,g*=p,h*=p,k*=p):k=h=g=0;n=b*k-t*h;f=t*g-d*k;l=d*h-b*g;(p=Math.sqrt(n*n+f*f+l*l))?(p=1/p,n*=p,f*=p,l*=p):l=f=n=0;e[0]=g;e[1]=n;e[2]=d;e[3]=0;e[4]=h;e[5]=f;e[6]=b;e[7]=0;e[8]=k;e[9]=l;e[10]=t;e[11]=0;e[12]=-(g*z+h*D+k*c);e[13]=-(n*z+f*D+l*c);e[14]=-(d*z+b*D+t*c);e[15]=1;return e};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+
a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.Px=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.mat4=b4w.module.__mat4;b4w.module.__md5=function(a){function p(a,g){var n=a[0],f=a[1],l=a[2],t=a[3],n=d(n,f,l,t,g[0],7,-680876936),t=d(t,n,f,l,g[1],12,-389564586),l=d(l,t,n,f,g[2],17,606105819),f=d(f,l,t,n,g[3],22,-1044525330),n=d(n,f,l,t,g[4],7,-176418897),t=d(t,n,f,l,g[5],12,1200080426),l=d(l,t,n,f,g[6],17,-1473231341),f=d(f,l,t,n,g[7],22,-45705983),n=d(n,f,l,t,g[8],7,1770035416),t=d(t,n,f,l,g[9],12,-1958414417),l=d(l,t,n,f,g[10],17,-42063),f=d(f,l,t,n,g[11],22,-1990404162),n=d(n,f,l,t,g[12],7,1804603682),t=d(t,n,f,l,
g[13],12,-40341101),l=d(l,t,n,f,g[14],17,-1502002290),f=d(f,l,t,n,g[15],22,1236535329),n=b(n,f,l,t,g[1],5,-165796510),t=b(t,n,f,l,g[6],9,-1069501632),l=b(l,t,n,f,g[11],14,643717713),f=b(f,l,t,n,g[0],20,-373897302),n=b(n,f,l,t,g[5],5,-701558691),t=b(t,n,f,l,g[10],9,38016083),l=b(l,t,n,f,g[15],14,-660478335),f=b(f,l,t,n,g[4],20,-405537848),n=b(n,f,l,t,g[9],5,568446438),t=b(t,n,f,l,g[14],9,-1019803690),l=b(l,t,n,f,g[3],14,-187363961),f=b(f,l,t,n,g[8],20,1163531501),n=b(n,f,l,t,g[13],5,-1444681467),t=
b(t,n,f,l,g[2],9,-51403784),l=b(l,t,n,f,g[7],14,1735328473),f=b(f,l,t,n,g[12],20,-1926607734),n=c(f^l^t,n,f,g[5],4,-378558),t=c(n^f^l,t,n,g[8],11,-2022574463),l=c(t^n^f,l,t,g[11],16,1839030562),f=c(l^t^n,f,l,g[14],23,-35309556),n=c(f^l^t,n,f,g[1],4,-1530992060),t=c(n^f^l,t,n,g[4],11,1272893353),l=c(t^n^f,l,t,g[7],16,-155497632),f=c(l^t^n,f,l,g[10],23,-1094730640),n=c(f^l^t,n,f,g[13],4,681279174),t=c(n^f^l,t,n,g[0],11,-358537222),l=c(t^n^f,l,t,g[3],16,-722521979),f=c(l^t^n,f,l,g[6],23,76029189),n=
c(f^l^t,n,f,g[9],4,-640364487),t=c(n^f^l,t,n,g[12],11,-421815835),l=c(t^n^f,l,t,g[15],16,530742520),f=c(l^t^n,f,l,g[2],23,-995338651),n=e(n,f,l,t,g[0],6,-198630844),t=e(t,n,f,l,g[7],10,1126891415),l=e(l,t,n,f,g[14],15,-1416354905),f=e(f,l,t,n,g[5],21,-57434055),n=e(n,f,l,t,g[12],6,1700485571),t=e(t,n,f,l,g[3],10,-1894986606),l=e(l,t,n,f,g[10],15,-1051523),f=e(f,l,t,n,g[1],21,-2054922799),n=e(n,f,l,t,g[8],6,1873313359),t=e(t,n,f,l,g[15],10,-30611744),l=e(l,t,n,f,g[6],15,-1560198380),f=e(f,l,t,n,g[13],
21,1309151649),n=e(n,f,l,t,g[4],6,-145523070),t=e(t,n,f,l,g[11],10,-1120210379),l=e(l,t,n,f,g[2],15,718787259),f=e(f,l,t,n,g[9],21,-343485551);a[0]=n+a[0]&4294967295;a[1]=f+a[1]&4294967295;a[2]=l+a[2]&4294967295;a[3]=t+a[3]&4294967295}function c(a,b,c,d,e,g){b=(b+a&4294967295)+(d+g&4294967295)&4294967295;return(b<<e|b>>>32-e)+c&4294967295}function d(a,b,d,e,g,t,p){return c(b&d|~b&e,a,b,g,t,p)}function b(a,b,d,e,g,t,p){return c(b&e|d&~e,a,b,g,t,p)}function e(a,b,d,e,g,t,p){return c(d^(b|~e),a,b,g,
t,p)}var g="0123456789abcdef".split("");a.Zq=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var e=b.substring(d-64,d),t=[],x=void 0,x=0;64>x;x+=4)t[x>>2]=e.charCodeAt(x)+(e.charCodeAt(x+1)<<8)+(e.charCodeAt(x+2)<<16)+(e.charCodeAt(x+3)<<24);p(a,t)}b=b.substring(d-64);e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)e[d>>2]|=b.charCodeAt(d)<<(d%4<<3);e[d>>2]|=128<<(d%4<<3);if(55<d)for(p(a,e),d=0;16>d;d++)e[d]=0;e[14]=8*
c;p(a,e);for(b=0;b<a.length;b++){c=a[b];d="";for(e=0;4>e;e++)d+=g[c>>8*e+4&15]+g[c>>8*e&15];a[b]=d}return a.join("")}};b4w.module.shader_texts=function(a){a["anchors.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",a:[{type:"var",name:"ANCHOR_NUM",b:["0"]},{type:"textline",b:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec4 a ; a = u_view_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_Position = u_proj_matrix * a ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",
name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},
{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform",
"vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]}]}}]},{type:"textline",b:["uniform","vec3","u_color_id",";"]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",
";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",
a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"varying vec3 eU ; varying vec4 eV ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",
d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_perspective_cast_far_bound ; varying vec4 e_ ; varying vec4 fa ; varying vec4 fb ; varying vec4 fc ; uniform float u_perspective_cast_far_bound ; uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ; uniform sampler2D u_shadow_map1 ; uniform sampler2D u_shadow_map2 ; uniform sampler2D u_shadow_map3 ; uniform sampler2D u_shadow_mask ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { float te , tf ; vec3 tg , th , ti , tj ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"tg = u_camera_eye_frag - eU ; tg = normalize ( tg ) ; td ( tg , th , ti , tj , te , tf ) ; tf = tf ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"tf = ( texture2D ( u_sampler , fd ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tf = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( tf < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",
";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 eU ; varying vec4 eV ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL",
"USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 vN ; float vO , vP , vQ ; mat4 vR ; vec3 vS , vT , vU , vV , vW , vX ; vS = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE","USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",
d:3},{type:"logical_or_expr",d:6},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["vT","=","a_normal",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vU = vec3 ( a_tangent ) ; vV = a_tangent [ 3 ] * cross ( vT , vU ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vU = vec3 ( 0.0 ) ; vV = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vT = vec3 ( 0.0 ) ; vU = vec3 ( 0.0 ) ; vV = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"vS = mix ( vS , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"vT = mix ( vT , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vW = vec3 ( a_tangent ) ; vX = a_tangent_next [ 3 ] * cross ( a_normal_next , vW ) ; vU = mix ( vU , vW , u_va_frame_factor ) ; vV = mix ( vV , vX , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uT ( vS , vU , vV , vT ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["vV","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vV = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vU = ( u_model_matrix * vec4 ( vV , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"vR = tM ( u_camera_eye , vU , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vR = tG ( u_camera_eye , vU , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vX = ( u_model_matrix * vec4 ( vV , 1.0 ) ) . xyz ; vR = vR * ty ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vX ) ;".split(" ")}]}}]},
{type:"textline",b:"el vY = tT ( vS - vV , vV , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vR ) ; vY . b = vU ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"el vY = tT ( vS , vV , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vH ( vY . a , vY . b , vT ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["vT","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vT = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vH ( vY . a , vY . b , vT ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"fd = tW ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"eU = vY . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",
d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"eW = vY . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vO = ( dot ( cross ( vY . e , vY . c ) , vY . d ) < 0.0 ) ? - 1.0 : 1.0 ; eX = vec4 ( vY . c , vO ) ;".split(" ")}]}}]},{type:"textline",b:"eV = u_view_matrix * vec4 ( vY . a , 1.0 ) ; vN = u_proj_matrix * eV ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",
b:"vN . xy += u_subpixel_jitter * vN . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vO = vN . x ; vP = vN . y ; vQ = vN . w ; eY . x = ( vO + vQ ) / 2.0 ; eY . y = ( vP + vQ ) / 2.0 ; eY . z = vQ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"eZ = - eV . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["vM","(",")",";"]}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( vY . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",
b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},
{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1},"NODES","ALPHA",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},
{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eU",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eX",";"]}]}}]}]}},{type:"else",
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","e_",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fa",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fb",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fc",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",
{type:"logic_negative_expr",d:1},"NODES","ALPHA",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { float vN , vO ; vec3 vP , vQ , vR , vS ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"vP = u_camera_eye_frag - eU ; vP = normalize ( vP ) ; td ( vP , vQ , vR , vS , vN , vO ) ; vO = vO ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"vO = ( texture2D ( u_colormap0 , fd ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vO = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( vO < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","NO_SHADOWS",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",
d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( gT ( eV . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",
a:[{type:"textline",b:"gl_FragColor . a += 0.00001 * eX . r ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS",
"CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1},"TEXTURE_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute",
"vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD","SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",
b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",
c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1},"TEXTURE_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eU",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS",
"CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eX",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","e_",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec4","fa",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fb",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fc",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec2 wC ; vec4 wD , wE ; float wF ; mat4 wG , wH ; vec3 wI , wJ , wK , wL , wM , wN ; wI = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"CALC_TBN_SPACE","USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",
d:3},{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["wJ","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wJ = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"wK = vec3 ( a_tangent ) ; wL = a_tangent [ 3 ] * cross ( wJ , wK ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wK = vec3 ( 0.0 ) ; wL = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"wI = mix ( wI , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"wJ = mix ( wJ , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"wM = vec3 ( a_tangent ) ; wN = a_tangent_next [ 3 ] * cross ( a_normal_next , wM ) ; wK = mix ( wK , wM , u_va_frame_factor ) ; wL = mix ( wL , wN , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uT ( wI , wK , wL , wJ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",
{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["wL","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wL = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"el wO = wr ( wI , vec3 ( 0.0 ) , vec3 ( 0.0 ) , wJ , wL , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"wK = ( u_model_matrix * vec4 ( wL , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD",{type:"logic_negative_expr",d:1},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["wG","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["wG","=","u_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wH = tM ( u_camera_eye , wK , wG , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wH = tG ( u_camera_eye , wK , wG ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"wN = ( u_model_matrix * vec4 ( wL , 1.0 ) ) . xyz ; wH = wH * ty ( u_wind , u_time , u_jitter_amp , u_jitter_freq , wN ) ;".split(" ")}]}}]},{type:"textline",b:"el wO = tT ( wI - wL , wL , vec3 ( 0.0 ) , vec3 ( 0.0 ) , wJ , wH ) ; wO . b = wK ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"el wO = tT ( wI , wL , vec3 ( 0.0 ) , vec3 ( 0.0 ) , wJ , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["wJ","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wJ = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vH ( wO . a , wO . b , wJ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"eU = wO . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"eW = wO . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"wF = ( dot ( cross ( wO . e , wO . c ) , wO . d ) < 0.0 ) ? - 1.0 : 1.0 ; eX = vec4 ( wO . c , wF ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"wD = u_view_matrix * vec4 ( wO . a , 1.0 ) ; wE = u_proj_matrix * wD ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"wE . xy += u_subpixel_jitter * wE . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"eY = eT ( wE ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"eZ = - eV . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["vM","(",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"fd = tW ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wB ( wO . a , wO . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["eV","=","wD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"wC = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; wF = SHADOW_TEX_RES / 2.0 ; wC = floor ( wC * wF + 0.5 ) / wF - wC ; wE . xy += wC ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","wE",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","wC",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","wC",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","wC",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","wC",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( wC , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , wC ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",
b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","wC",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","wC",";"]}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","wC",";"]}]}}]}]}}]},{type:"textline",b:"void main ( ) { vec4 wD ; mat4 wE ; vec3 wF ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"wF = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; wE = tG ( u_camera_eye , wF , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND",
"BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wE = wE * ty ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"el wG = tT ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , wE ) ; wG . b = wF ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"el wG = tT ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},
{type:"textline",b:"wD = u_proj_matrix * u_view_matrix * vec4 ( wG . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"wC = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["wC","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["wC","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","wD",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 wD ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 fd ; varying float wE ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","NUM_LINES",{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const int wF = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int wF = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float wH ( float wG ) { return wG - floor ( wG * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void wQ ( inout float wI , in float wJ [ wF ] , in float wK ) { float wL , wM , wN , wO ; for ( int wP = 0 ; wP < NUM_RINGS ; wP ++ ) { wL = 40.0 * wJ [ wP ] ; wM = 300.0 * ( wH ( wL ) - 0.005 ) ; wN = wL ; wO = abs ( wN * ( u_halo_size * wM - wK ) ) ; wI += 1.0 - min ( wO , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void wZ ( inout float wR , in float wS [ wF ] , in float wT ) { float wU , wV , wW , wX ; for ( int wY = 0 ; wY < NUM_LINES ; wY ++ ) { wU = wS [ wY ] ; wV = wU ; wW = 1000.0 * ( wH ( wU ) - 0.005 ) ; wX = 20.0 * abs ( wV * fd . x + wW * fd . y ) ; wR += 1.0 - min ( wX , 1.0 ) ; } wR *= wT ; }".split(" ")}]}}]},{type:"textline",b:"void xf ( inout float w_ , in vec2 xa ) { float xb , xc , xd , xe ; xc = atan ( xa . y , xa . x ) ; xc *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; xd = cos ( xc ) ; xe = sin ( xc ) ; xc = ( xd * xa . x + xe * xa . y ) * ( xd * xa . y - xe * xa . x ) ; xb = abs ( xc ) ; if ( xb < 1.0 ) { xb = ( 0.01 * u_halo_size ) / ( xb ) ; w_ *= sqrt ( min ( xb , 1.0 ) ) ; } } void main ( ) { vec3 xg ; float xh , xi , xj , xk ; xh = ( fd . x * fd . x + fd . y * fd . y ) ; xi = sqrt ( xh ) ; xh = max ( 1.0 - xh , 0.0 ) ; xh = pow ( xh , u_halo_hardness ) ; xj = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","NUM_LINES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float xl [ wF ] ; for ( int xm = 0 ; xm < wF ; xm ++ ) { xl [ xm ] = fract ( wE / ( float ( xm ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"xk = 0.0 ; wQ ( xk , xl , xi ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"xi = 0.0 ; wZ ( xi , xl , xh ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"xf ( xh , fd ) ;".split(" ")}]}}]},{type:"textline",b:"xh *= xj ; xg = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"xk *= xh ; xg += u_halo_rings_color * xk ; xh += xk ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"xi *= xj ; xg += u_halo_lines_color * xi ; xh += xi ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"xh *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xi = u_halo_stars_blend * ( wD . y - u_halo_stars_height ) ; xh *= clamp ( xi , 0.0 , 1.0 ) ; xh *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"ef ( xg ) ; ei ( xg , xh ) ; gl_FragColor = vec4 ( xg , xh ) ; }".split(" ")}]};a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 fd ; varying float wE ;".split(" ")},{type:"condition",a:[{type:"if",
c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","wD",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 wF , wG ; mat4 wH , wI ; vec3 wJ ; wJ = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; fd = a_halo_bb_vertex * 2.0 ; wE = fract ( wJ . x + wJ . y + wJ . z ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"wH = tk ( wJ , u_view_matrix ) ; wI = u_view_matrix ; wI [ 3 ] [ 0 ] = 0.0 ; wI [ 3 ] [ 1 ] = 0.0 ; wI [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wH = tk ( wJ , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"wF = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; wF = wH * wF ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",
a:[{type:"textline",b:"wG = u_proj_matrix * wI * wF ; wG . z = 0.99999 * wG . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["wD","=","wF",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wG = u_proj_matrix * u_view_matrix * wF ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","wG",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",
file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 wF ; wF = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( wF , 1.0 ) ; }".split(" ")}]};
a["main.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},
{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",
a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_VECTOR_VIEW",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"PROCEDURAL_FOG",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","ALPHA_AS_SPEC",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",
b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["uniform",
"float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION","USE_REFRACTION","NODES",{type:"logical_and_expr",
d:3},{type:"logical_or_expr",d:2},"REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},
{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],
group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]}]}}]},{type:"textline",b:["varying","vec3","eU",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",
{type:"logical_or_expr",d:8}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","wF",";"]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying",
"vec3","wG",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","e_",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fa",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fb",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","fc",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",
d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2},"USE_NODE_B4W_REFRACTION","USE_REFRACTION","NODES",{type:"logical_and_expr",d:3},{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { vec4 wH , wI , wJ , wK ; mat3 wL ; vec2 wM , wN , wO , wP ; vec3 wQ , wR , wS , wT , wU , wV , wW , wX , wY ; float wZ , w_ , xa , xb , xc , xd , xe ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",
d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"wZ = length ( eV ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"w_ = eU . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",
d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["wQ","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"wR = normalize ( u_camera_eye_frag - eU ) ; td ( wR , wS , wT , wU , xa , xb ) ; wS = wS ; xb = xb ; wU = wU ; xa = xa ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["wM","=","fd",";"]}]}}]},{type:"textline",
b:["wT","=","eW",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) wT = wT ; else wT = - wT ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"wV = cross ( wT , eX . xyz ) * eX . w ; wL = mat3 ( eX . xyz , wV , wT ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"wN = normalize ( u_view_matrix_frag * vec4 ( eW , 0.0 ) ) . st ; wN = wN * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( wZ < PARALLAX_LOD_DIST ) { xc = clamp ( 0.5 * ( PARALLAX_LOD_DIST - wZ ) , 0.0 , 1.0 ) ; xc = u_parallax_scale * xc ; wV = normalize ( wF * wL ) ; xd = 1.0 / PARALLAX_STEPS ; wO = wV . xy * xc / ( PARALLAX_STEPS * wV . z ) ; xc = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["wP","=","wN",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["wP","=","wM",";"]}]}}]},{type:"textline",b:"xe = texture2D ( u_normalmap0 , wP ) . a ; for ( float xf = 1.0 ; xf <= PARALLAX_STEPS ; xf ++ ) { if ( xe < xc ) { xc -= xd ; wP -= wO ; xe = texture2D ( u_normalmap0 , wP ) . a ; } } wO = wP + wO ; xd = texture2D ( u_normalmap0 , wO ) . a - ( xc + xd ) ; xc = xe - xc ; xd = xc / ( xc - xd ) ; wP = xd * wO + ( 1.0 - xd ) * wP ;".split(" ")},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"wM += wP - wN ;".split(" ")}]}}]},{type:"textline",b:["wN","=","wP",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"wN += wP - wM ;".split(" ")}]}}]},{type:"textline",b:["wM","=","wP",";"]}]}}]},{type:"textline",
b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wH = texture2D ( u_normalmap0 , wN ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wH = texture2D ( u_normalmap0 , wM ) ;".split(" ")}]}}]},{type:"textline",b:"wV = wH . rgb - 0.5 ; wV = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , wV , u_normal_factor ) ; wU = wL * wV ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["wU","=","wT",";"]}]}}]},{type:"textline",b:"wU = normalize ( wU ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"wN = normalize ( u_view_matrix_frag * vec4 ( wU , 0.0 ) ) . st ; wN = wN * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"wR = normalize ( wF ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"wT = wG ; ed ( wT ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wH = vec4 ( wT , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["wH","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["xd","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"wI = texture2D ( u_colormap0 , wN ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wI = texture2D ( u_colormap0 , wM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"ed ( wI . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wJ = texture2D ( u_colormap1 , wN ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wJ = texture2D ( u_colormap1 , wM ) ;".split(" ")}]}}]},{type:"textline",b:"ed ( wJ . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"wK = texture2D ( u_stencil0 , wN ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wK = texture2D ( u_stencil0 , wM ) ;".split(" ")}]}}]},{type:"textline",b:"wI = mix ( wI , wJ , wK . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wH . rgb = mix ( wH . rgb , wI . rgb , u_diffuse_color_factor ) ; xc = u_alpha_factor * wI . a ; xc += ( 1.0 - step ( 0.0 , xc ) ) ; wH . a = mix ( xc , 1.0 , u_diffuse_color . a ) ; xd = wI . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wH . rgb *= mix ( vec3 ( 1.0 ) , wI . rgb , u_diffuse_color_factor ) ; wH . a = wI . a ; xd = wI . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"wT = u_diffuse_intensity * wH . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["wS","=","wT",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wV = u_environment_energy * hu ( wU ) ; wV = u_ambient * wV ; xa = gY ( wT ) ; wW = u_emit * wH . rgb ; wX = u_specular_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"wY = vec3 ( xd ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wY = texture2D ( u_specmap0 , wN ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wY = texture2D ( u_specmap0 , wM ) . rgb ;".split(" ")}]}}]},
{type:"textline",b:"ed ( wY . rgb ) ; wX = mix ( wX , wY , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"xd = u_specular_params [ 0 ] ; wM = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; wX = xd * wX ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"af xg = cS ( wW , wV , wT ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"af xg = cN ( wW , wV , wT , wX , eU , wU , wR , wM , u_diffuse_params , xa , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"wS = xg . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"hr ( wS , wR , wU , u_reflect_factor ) ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"hr ( wS , wR , wU , 0.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"wS += xg . b ;".split(" ")}]}}]},{type:"textline",b:"xb = wH . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"wS = max ( wS - sqrt ( 0.01 * - min ( w_ , 0.0 ) ) , 0.5 * wS ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"eb ( wS , w_ , u_time , xa , wU , u_sun_direction , wQ , u_sun_quaternion , eU , wZ ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( xb <= 0.5 ) discard ; xb = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADELESS",
{type:"logic_negative_expr",d:1},"NODES",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xa = max ( max ( xg . b . r , xg . b . g ) , xg . b . b ) * u_specular_alpha ; xb = wH . a * ( 1.0 - xa ) + xa ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES_GLOW",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["xb","=","1.0",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"wS = mix ( hI ( eY , wU . xz * u_refr_bump ) , wS , xb ) ; xb = 1.0 ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"PROCEDURAL_FOG",{type:"logic_negative_expr",d:1},"WATER_EFFECTS",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"xa = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"wU = D ( u_cube_fog , wR ) ; wH = vec4 ( wU , u_fog_color_density . a ) ; ed ( wH . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wH = u_fog_color_density ; wH . rgb *= xa ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"U ( wS , wZ , wR , u_cam_water_depth , u_underwater_fog_color_density , wH , w_ , xa ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"x ( wS , wZ , wH ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"wM = texture2DProj ( u_shadow_mask , eY ) . rg ; wZ = wM . g ; wS = vec3 ( wZ ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"SHADELESS",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"wS = vec3 ( fe . a ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["ef","(","wS",")",
";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2},"NODES_GLOW",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ei ( wS , xb ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( wS , xb ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",
b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",
{type:"logical_or_expr",d:8}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",
{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},
{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",
a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",
a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",
{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:["varying","vec3","eU",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:8}],group:{type:"group",a:[{type:"textline",
b:["varying","vec3","eW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying",
"vec4","eX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","wF",";"]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","wG",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","e_",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fa",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fb",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4",
"fc",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 wH , wI ; float wJ ; mat4 wK ; vec3 wL , wM , wN , wO , wP , wQ , wR ; wL = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE",
"USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"NODES",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["wM","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wM = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",
{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wN = vec3 ( a_tangent ) ; wO = a_tangent [ 3 ] * cross ( wM , wN ) ;".split(" ")}]}},{type:"elif",c:["NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wP = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; wQ = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; wP = wP - u_camera_eye ; wO = cross ( wP , wQ ) ; wN = cross ( wQ , wO ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"wN = vec3 ( 0.0 ) ; wO = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"wL = mix ( wL , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",
b:"wM = mix ( wM , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"wQ = vec3 ( a_tangent ) ; wP = a_tangent_next [ 3 ] * cross ( a_normal_next , wQ ) ; wN = mix ( wN , wQ , u_va_frame_factor ) ; wO = mix ( wO , wP , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uT ( wL , wN , wO , wM ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["wP","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wP = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"el wS = wr ( wL , wN , wO , wM , wP , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"wQ = ( u_model_matrix * vec4 ( wP , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wK = tM ( u_camera_eye , wQ , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"wK = tG ( u_camera_eye , wQ , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wR = ( u_model_matrix * vec4 ( wP , 1.0 ) ) . xyz ; wK = wK * ty ( u_wind , u_time , u_jitter_amp , u_jitter_freq , wR ) ;".split(" ")}]}}]},{type:"textline",b:"el wS = tT ( wL - wP , wP , wN , wO , wM , wK ) ; wS . b = wQ ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"el wS = tT ( wL , wP , wN , wO , wM , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wJ = ( dot ( cross ( wS . e , wS . c ) , wS . d ) < 0.0 ) ? - 1.0 : 1.0 ; eX = vec4 ( wS . c , wJ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"vH ( wS . a , wS . b , wM ) ;".split(" ")}]}}]},{type:"textline",
b:"eU = wS . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:"eW = wS . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"wF = u_camera_eye - wS . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"fd = tW ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"wG = wS . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["wG","=","a_color",";"]}]}}]}]}}]},{type:"textline",b:"wH = u_view_matrix * vec4 ( wS . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",
"DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["eV","=","wH",";"]}]}}]},{type:"textline",b:"wI = u_proj_matrix * wH ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"wI . xy += u_subpixel_jitter * wI . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"eY = eT ( wI ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wB ( wS . a , wS . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",
{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"eZ = - wH . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:["vM","(",")",";"]}]}}]},{type:"textline",b:["gl_Position","=","wI",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},
{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"SOFT_STRENGTH",b:["1.0"]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec2 u_texel_size ; uniform vec4 u_fog_color_density ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},
{type:"textline",b:"varying float wH ; varying vec3 wG ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"textline",b:"varying float wI ; void main ( ) { vec4 wJ ; vec3 wK ; float wL , wM , wN ; vec2 wO , wP ; wO = gl_PointCoord - 0.5 ; wL = 2.0 * length ( wO ) ; wL = smoothstep ( u_p_alpha_start , u_p_alpha_end , wL ) ; wL = u_diffuse_color . a * wH * ( 1.0 - wL ) ; wK = wG * u_diffuse_color . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"x ( wK , length ( eV ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"wP = eY . xy / eY . z ; wO = vec2 ( wO . x , - wO . y ) * wI * u_texel_size ; wO = vec2 ( wP + wO ) ; wJ = texture2D ( u_scene_depth , wO ) ; wM = k ( wJ ) ; wN = - eV . z / u_view_max_depth ; wN = wM - wN ; wN = u_view_max_depth / SOFT_STRENGTH * wN ; wL = wL * min ( wN , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["ef","(","wK",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ei ( wK , wL ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( wK , wL ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float wH ; varying vec3 wG ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"textline",b:["varying","float","wI",";"]},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { float xv , xw , xx , xy ; vec4 xz , xA ; wJ xB ; xB = xu ( ) ; xz = u_view_matrix * vec4 ( xB . b , 1.0 ) ; xA = u_proj_matrix * xz ; gl_Position = xA ; wH = xB . c ; wG = xB . d ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:["eV","=","xz",";"]}]}}]},{type:"textline",b:"xv = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; xv = xB . a * xv ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"xw = xA . x ; xx = xA . y ; xy = xA . w ; eY . x = ( xw + xy ) / 2.0 ; eY . y = ( xx + xy ) / 2.0 ; eY . z = xy ; wI = xv ;".split(" ")}]}}]},{type:"textline",b:["gl_PointSize","=","xv",";","}"]}]};a["particles_texture.glslf"]=
{type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"var",name:"SOFT_STRENGTH",b:["1.0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float wH ; varying vec3 wG ; varying vec2 fd ; varying vec3 wF ; varying vec3 eU ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"textline",b:"void main ( ) { vec2 xv ; float xw , xx , xy ; vec3 xz , xA , xB , xC , xD , xE ; vec4 xF , xG ; xF = u_diffuse_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"xG = texture2D ( u_sampler , fd ) ; ed ( xG . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xF . rgb = mix ( xF . rgb , xG . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"xF . rgb *= mix ( vec3 ( 1.0 ) , xG . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"xF . a = xG . a ;".split(" ")}]}}]},{type:"textline",b:"xF . rgb *= wG ; xz = u_diffuse_intensity * xF . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"xA = u_emit * xF . rgb ; xB = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT",
"SKY_TEXTURE",{type:"logic_negative_expr",d:1},"SKY_COLOR",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"xC = u_environment_energy * hu ( vec3 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xC = u_environment_energy * hu ( xB ) ;".split(" ")}]}}]},{type:"textline",b:"xC = u_ambient * xC ; xw = u_specular_params [ 0 ] ; xv = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; xD = xw * u_specular_color ; xE = normalize ( wF ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"af xH = cN ( xA , xC , xz , xD , eU , xB , xE , xv , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"af xH = cS ( xA , xC , xz ) ;".split(" ")}]}}]},{type:"textline",b:"xC = xH . a . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["xC","=","xz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"x ( xC , length ( eV ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"xw = xF . a * wH ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"xx = - eV . z / u_view_max_depth ; xF = texture2DProj ( u_scene_depth , eY ) ; xy = k ( xF ) ; xx = xy - xx ; xx = u_view_max_depth / SOFT_STRENGTH * xx ; xw = xw * min ( xx , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["ef","(","xC",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ei ( xC , xw ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( xC , xw ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",
file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float wH ; varying vec3 wG ; varying vec2 fd ; varying vec3 wF ; varying vec3 eU ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float xx ( vec2 xv , vec2 xw ) { return ( atan ( xw . y , xw . x ) - atan ( xv . y , xv . x ) ) ; } void main ( ) { vec4 xy , xz , xA ; mat4 xB ; float xC , xD , xE ; wJ xF ; xF = xu ( ) ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { xC = xF . e ; xB = tk ( xF . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { xC = xF . e ; xB = eF ( ) ; xB [ 3 ] = vec4 ( xF . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { xC = xF . e ; xB = eJ ( radians ( 90.0 ) ) ; xB [ 3 ] = vec4 ( xF . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { xC = xx ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + xF . e ; xB = eH ( radians ( - 90.0 ) ) ; xB [ 3 ] = vec4 ( xF . b , 1.0 ) ; } xy = vec4 ( a_p_bb_vertex * 2.0 * xF . a * u_p_size , 0.0 , 1.0 ) ; xy = xB * eL ( xC ) * xy ; xz = u_view_matrix * xy ; xA = u_proj_matrix * xz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"xC = xA . x ; xD = xA . y ; xE = xA . w ; eY . x = ( xC + xE ) / 2.0 ; eY . y = ( xD + xE ) / 2.0 ; eY . z = xE ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = xA ; wH = xF . c ; wG = xF . d ; fd = a_p_bb_vertex + 0.5 ; eU = xy . xyz ; wF = u_camera_eye - xy . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["eV","=","xz",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 xv ; const float xw = 0.99 ; const float xx = 1.8 ; const int xy = 8 ; float xE ( vec3 xz , vec3 xA ) { float xB , xC , xD ; xB = dot ( xA , xA ) ; xC = 2.0 * dot ( xA , xz ) ; xD = dot ( xz , xz ) - 1.0 ; xB = xC * xC - 4.0 * xB * xD ; xB = sqrt ( xB ) ; xB = ( - xC - xB ) / 2.0 ; xB = xD / xB ; return xB ; } float xL ( float xF , float xG ) { float xH , xI , xJ , xK ; xH = 3.0 * ( 1.0 - xG * xG ) ; xI = 2.0 * ( 2.0 + xG * xG ) ; xJ = 1.0 + xF * xF ; xK = pow ( 1.0 + xG * xG - 2.0 * xG * xF , 1.5 ) ; xK = max ( xK , 0.00001 ) ; return ( xH / xI ) * ( xJ / xK ) ; } float xR ( vec3 xM , vec3 xN , float xO ) { vec3 xP ; float xQ ; xQ = dot ( xN , - xM ) ; if ( xQ < 0.0 ) { return 1.0 ; } xP = xM + xQ * xN ; if ( length ( xP ) < xO ) { return 0.0 ; } else if ( length ( xP ) >= xO ) { xP = normalize ( xP ) * xO - xM ; xQ = acos ( dot ( normalize ( xP ) , xN ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( xQ * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 xV ( float xS , vec3 xT , float xU ) { return xT - xT * pow ( u_sky_color , vec3 ( xU / xS ) ) ; } void main ( ) { float xW , xX , xY , xZ , x_ , ya , yb , yc , yd ; vec3 ye , yf , yg , yh , yi , yj , yk ; ye = normalize ( xv ) ; yf = u_sun_direction ; xW = dot ( ye , yf ) ; xX = xL ( xW , - 0.01 ) * u_rayleigh_brightness * yf . y ; xY = xL ( xW - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - yf . y ) ; xW = smoothstep ( 0.0 , 100.0 , xL ( xW , 0.9995 ) ) * u_spot_brightness ; yg = vec3 ( 0.0 , xw , 0.0 ) ; xZ = xE ( yg , ye ) ; x_ = xZ / float ( xy ) ; ya = xR ( yg , ye , xw - 0.3 ) ; yh = vec3 ( 0.0 , 0.0 , 0.0 ) ; yi = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int yl = 0 ; yl < xy ; yl ++ ) { yb = x_ * float ( yl ) ; yj = yg + ye * yb ; yc = xR ( yj , yf , xw - 0.2 ) ; yd = xE ( yj , yf ) ; yk = xV ( yd , vec3 ( xx ) , u_scatter_strength ) * yc ; yh += xV ( sqrt ( yb ) , u_sky_color * yk , u_rayleigh_strength ) ; yi += xV ( yb , yk , u_mie_strength ) ; } yh = yh * ya * pow ( xZ , u_rayleigh_collection_power ) / float ( xy ) ; yi = ( yi * ya * pow ( xZ , u_mie_collection_power ) ) / float ( xy ) ; yh = vec3 ( xW * yi + xY * yi + xX * yh ) ; ef ( yh ) ; gl_FragColor = vec4 ( yh , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 xv ; void main ( ) { vec4 xw , xx ; xw = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; xx = u_cube_view_matrix * xw ; xv = xx . xyz ; gl_Position = xw ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 fd ; void main ( ) { vec4 xw ; xw = texture2D ( u_sampler , fd ) ; ef ( xw . rgb ) ; ei ( xw . rgb , xw . a ) ; gl_FragColor = xw ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 fd ; void main ( ) { vec2 xw ; float xx ; vec4 xy ; vec3 xz ; fd = a_texcoord ; xz = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; xy = u_proj_matrix * u_view_matrix * vec4 ( xz , 0.0 ) ; xy . x /= xy . w ; xy . y /= xy . w ; xy += 99999.0 * step ( xy . z , 0.0 ) ; xy += 100.0 * ( step ( 1.0 , abs ( xy . x ) ) + step ( 1.0 , abs ( xy . y ) ) ) ; xy . x = - a_lf_dist * xy . x ; xy . y = - a_lf_dist * xy . y ; xx = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; xw = vec2 ( a_lf_bb_vertex . x / xx , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float xA = 1.9 ; xw *= ( 1.0 + xA * length ( xy . xy ) ) ; } gl_Position = vec4 ( xy . xy + xw , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"define",name:"INV_PI",b:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["WO_SKYTEX","PROCEDURAL_SKYDOME",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky",";"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"blending.glslf"},{type:"textline",b:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ; vec3 zC ( vec3 zx , vec3 zy , float zz , float zA ) { float zB ; zB = zz * zA ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return xM ( zy , zx , zB ) ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","ADD",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return xQ ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SUBTRACT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return xU ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return xZ ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SCREEN",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"return yd ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","OVERLAY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yi ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ym ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIVIDE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"return yq ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DARKEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yu ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LIGHTEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yy ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","HUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yE ( zy , zx , zB ) ;".split(" ")}]}},{type:"elif",
c:["BLENDTYPE","SATURATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yK ( zy , zx , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","VALUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yQ ( zy , zx , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","COLOR",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yW ( zy , zx , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"return za ( zy , zx , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ze ( zy , zx , zB ) ;".split(" ")}]}}]},{type:"textline",b:"return vec3 ( 1.0 , 0.0 , 1.0 ) ; } float zK ( float zD , float zE , float zF , float zG ) { float zH ; vec3 zI , zJ ; zI = vec3 ( zD ) , zJ = vec3 ( zE ) ; zH = zF * zG ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","MIX",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return xM ( zJ , zI , zH ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","ADD",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return xQ ( zI , zJ , zH ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SUBTRACT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return xU ( zI , zJ , zH ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"return zk ( zD , zE , zH , zG ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SCREEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zq ( zD , zE , zH , zG ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","OVERLAY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zw ( zD , zE , zH , zG ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ym ( zI , zJ , zH ) . x ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","DIVIDE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yq ( zI , zJ , zH ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DARKEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yu ( zI , zJ , zH ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LIGHTEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yy ( zI , zJ , zH ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SOFT_LIGHT",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return za ( zJ , zI , zH ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ze ( zJ , zI , zH ) . x ;".split(" ")}]}}]},{type:"textline",b:["return","0.0",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","xv",";"]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",
d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 zL ; float zM , zN , zO ; vec3 zP , zQ , zR , zS , zT ; zQ = normalize ( xv ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME"],group:{type:"group",a:[{type:"textline",b:"zP = textureCube ( u_sky , zQ ) . rgb ;".split(" ")}]}},{type:"elif",c:["WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:"zP = u_horizon_color ; ef ( zP ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"textline",b:"zR = vec3 ( fd , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zR = vec3 ( xv . xy , 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:["zM","=","0.0",";"]},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"zM = abs ( fd . y ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zM = ( fd . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zN = acos ( zQ . y ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"zM = abs ( zN * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"zM = 1.0 - zN * INV_PI ;".split(" ")}]}}]}]}}]}]}}]},{type:"textline",b:"zS = u_horizon_color ; zT = u_zenith_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYTEX"],group:{type:"group",a:[{type:"textline",b:"zN = 1.0 ; zL = textureCube ( u_sky , zQ ) ; ed ( zL . rgb ) ; zN = zL . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"zN = dot ( zL . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["MTEX_NEGATIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"zL = vec4 ( vec3 ( 1.0 ) - zL . rgb , zL . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zN = 1.0 - zN ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ","WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"zL = vec4 ( u_sky_tex_color , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zN = zL . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ"],group:{type:"group",a:[{type:"textline",b:"zS = zC ( zL . rgb , zS , zN , u_sky_tex_fac [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:["zO","=","0.0",";"]},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( zR , vec3 ( 0.0 , 1.0 , 0.0 ) ) >= 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"zO = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",
b:"else zO = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"zO = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"elif",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",b:"zO = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( zO != 0.0 ) zT = zC ( zL . rgb , zT , zN , zO ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_BLEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"zN = dot ( zL . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},{type:"textline",b:"zM = zK ( u_sky_tex_dvar , zM , zN , u_sky_tex_fac [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"zP = mix ( zS , zT , zM ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["zP","=","zS",";"]}]}}]},{type:"textline",b:["ef","(","zP",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ef ( zS ) ; ef ( zT ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"zP = mix ( zS , zT , zM ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["zP","=","zS",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"REFLECTION_PASS",
{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"ed ( zP ) ; zM = u_camera_eye_frag . y - WATER_LEVEL ; zM = min ( - zM * 0.03 , 0.8 ) ; zN = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; zS = vec3 ( 0.0 ) ; zL = u_underwater_fog_color_density ; zL . rgb = mix ( zL . rgb , zS , min ( - zQ . y + zM , 1.0 ) ) * zN ; zM = clamp ( sign ( zQ . y - 0.05 * zM ) , 0.0 , 1.0 ) ; zP = mix ( zL . rgb , zP , zM ) ; ef ( zP ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( zP , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 xv ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 zx , zy ; zx = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; zy = u_sky_vp_inverse * zx ; xv = zy . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"fd = a_position . xy ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","zx",";","}"]}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",
b:["0.0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:["uniform","float","u_time",";"]},
{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","WATER_EFFECTS",{type:"logical_or_expr",
d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",
d:1},"PROCEDURAL_FOG",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",3,{type:"g_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float zx = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 wF ; varying vec3 eU ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH",{type:"logic_negative_expr",
d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 eX ; varying vec3 zy ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eW",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","zz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","zA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","zB",";"]}]}}]},{type:"include",file:"environment.glslf"},
{type:"condition",a:[{type:"if",c:["REFRACTIVE","SHORE_SMOOTHING","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 zN ( in vec2 zC , in vec3 zD , in vec3 zE , in vec3 zF , out float zG ) { float zH , zI , zJ ; vec2 zK ; vec3 zL , zM ; zG = 0.0 ; zL = reflect ( - zE , zD ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"zK = zC . xy + zD . xz * REFL_BUMP / eZ ; zG = u_reflect_factor ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zM = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zM = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"zH = dot ( zE , zD ) ; zG *= max ( 1.0 - 1.0 / zH , 1.0 ) ; } else { zM = texture2D ( u_plane_reflection , zK ) . rgb ; ed ( zM ) ; }".split(" ")}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zG = u_mirror_factor ; zM = zF * textureCube ( u_mirrormap , zL ) . rgb ; ed ( zM ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zG = u_reflect_factor ; zM = zF * vec3 ( 0.3 , 0.5 , 1.0 ) ; ed ( zM ) ;".split(" ")}]}}]},{type:"textline",b:"zL = normalize ( zL + zE ) ; zH = 1.0 - dot ( zE , zL ) ; zI = u_fresnel_params [ 3 ] ; zJ = u_fresnel_params [ 2 ] ; zJ = zI + ( 1.0 - zI ) * pow ( zH , zJ ) ; zG = min ( zG * zJ , 1.0 ) ; return zM ; } void main ( ) { vec4 zO ; vec2 zP , zQ , zR ; float zS , zT , zU , zV , zW , zX ; vec3 zY , zZ , z_ , Aa , Ab , Ac , Ad ; mat3 Ae ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ae = mat3 ( eX , zy , eW ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"zY = normalize ( eW ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zY = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","FOAM",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"zS = eU . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"zP = vec2 ( zz . x , - zz . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zP = vec2 ( eU . x , - eU . z ) + 0.5 ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["zP","=","fd",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zZ = vec3 ( 0.0 ) ; z_ = texture2D ( u_normalmap0 , zP * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; zZ += z_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"Aa = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["Aa","+=","z_",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"z_ = texture2D ( u_normalmap0 , zP * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; zZ += z_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",
a:[{type:"textline",b:["Aa","+=","z_",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"z_ = texture2D ( u_normalmap0 , zP * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; zZ += z_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["Aa","+=","z_",
";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"z_ = texture2D ( u_normalmap0 , zP * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; zZ += z_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["Aa","+=","z_",";"]}]}}]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"Aa = Ae * Aa ; if ( ! eo ( Aa , vec3 ( 0.0 ) ) ) Aa = normalize ( Aa ) ; Aa = mix ( zY , Aa , 0.2 ) ; Aa = normalize ( Aa ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"zY = mix ( zY , normalize ( Ae * zZ ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"zY = mix ( zY , normalize ( Ae * zZ ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"zY = normalize ( zY ) ;".split(" ")}]}}]},{type:"textline",b:"zZ = normalize ( wF ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zQ = eY . xy / eY . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",
d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zT = eZ * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"zU = u_diffuse_color . a ; zO = texture2DProj ( u_scene_depth , eY ) ; zV = k ( zO ) ; zW = max ( zV - eZ , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"zR = zQ + zY . xz * u_refr_bump / eZ ; zV = hA ( zV , zR , zQ ) ; zV = max ( zV - eZ , 0.0 ) ; zV = u_view_max_depth / ABSORB * zV ; if ( u_cam_water_depth < 0.0 ) zX = 0.0 ; else zX = min ( zU * zV , 1.0 ) ; zV = u_view_max_depth / ABSORB * zW ; zU = min ( 15.0 * zU * u_view_max_depth * zW , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"zV = u_view_max_depth / ABSORB * zW ; if ( u_cam_water_depth > 0.0 ) zU = min ( zU * zV , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"zU *= min ( 5.0 * zT , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zU = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"zX = 1.0 - zU ; zR = zQ + zY . xz * u_refr_bump / eZ ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"z_ = texture2D ( u_refractmap , zR ) . rgb ; ed ( z_ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"zV = pow ( min ( zA . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; Ab = mix ( u_shallow_water_col , u_diffuse_color . rgb , zV ) ; zV = pow ( min ( zA . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; Ab = mix ( u_shore_water_col , Ab , zV ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"Ab = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"zW = max ( 1.0 - u_view_max_depth * zW , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zW = 1.0 - zU ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",
b:"zS = max ( zS / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"Ac = normalize ( vec3 ( zA . r , 0.0 , zA . g ) ) ; Ac = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , Ac , 0.8 ) ) ; zV = 1.25 * max ( dot ( Aa , Ac ) - 0.2 , 0.0 ) ; zV += max ( dot ( Aa , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; zW += zV * ( 1.0 - zA . b ) ; zS *= ( 1.0 - 0.95 * pow ( zA . b , 0.1 ) ) ;".split(" ")}]}}]},{type:"textline",b:"zW += zS ; zW = min ( u_foam_factor * zW , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"zO = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + zP * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"zS = u_specular_params [ 0 ] ; zP = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; Aa = zS * u_specular_color ; Ac = u_environment_energy * hu ( zY ) ; Ac = u_ambient * Ac ; Ac = Ac + u_sun_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"Ad = zN ( zQ , zY , zZ , Ac , zS ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ad = zN ( vec2 ( 0.0 ) , zY , zZ , Ac , zS ) ;".split(" ")}]}}]},{type:"textline",b:"Ab = u_diffuse_intensity * Ab ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"af Af = cN ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ab , Aa , eU , zY , zZ , zP , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"af Af = cS ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ab ) ;".split(" ")}]}}]},{type:"textline",b:"Ab = Af . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"zV = max ( dot ( u_sun_direction , - eW ) + SSS_WIDTH , 0.0 ) * max ( dot ( - zZ , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; zV = clamp ( SSS_STRENGTH * zV , 0.0 , 1.0 ) ; Ab = mix ( Ab , u_shallow_water_col , zV ) ; Ab = mix ( Ab , u_shore_water_col , zV ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"Ab = mix ( z_ , Ab , zX ) ;".split(" ")}]}}]},{type:"textline",b:"Ab = mix ( Ab , Ad , zS ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"zS = mix ( zO . g , zO . r , max ( 4.0 * ( zW - 0.75 ) , 0.0 ) ) ; zS = mix ( zO . b , zS , max ( 2.0 * zW - 1.0 , 0.0 ) ) ; zS = mix ( 0.0 , zS , zW ) ; Ab = mix ( Ab , Ac , zS ) ;".split(" ")}]}}]},{type:"textline",
b:"Ab += Af . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"zZ = D ( u_cube_fog , zZ ) ; zO = vec4 ( zZ , u_fog_color_density . a ) ; ed ( zO . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["zO","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",
a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { ab ( Ab , zT , u_cam_water_depth , u_underwater_fog_color_density , clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ) ; } else { x ( Ab , zT , zO ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"x ( Ab , zT , zO ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["ef","(","Ab",")",";"]},{type:"condition",a:[{type:"if",c:["REFRACTIVE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",
b:"zU = max ( zU , Af . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["zU","+=","zS",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"ei ( Ab , zU ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"zZ = fwidth ( zB ) ; zZ = smoothstep ( vec3 ( 0.0 ) , zZ * zx , zB ) ; zS = min ( min ( zZ . x , zZ . y ) , zZ . z ) ; zS = clamp ( zS , 0.0 , 1.0 ) ; Ab = mix ( u_wireframe_edge_color , Ab , zS ) ; zU = mix ( 1.0 , zU , zS ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( Ab , zU ) ; }".split(" ")}]};a["special_water.glslv"]={type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",
b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},
{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"DYNAMIC",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_normal ; attribute vec3 a_tangent ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["GENERATED_MESH",{type:"logic_negative_expr",d:1},"NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",
"DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 wF ; varying vec3 eU ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},
"GENERATED_MESH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 eX ; varying vec3 zy ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3",
"eW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","zz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","zA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",
{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","zB",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 zG ( in vec2 zx ) { float zC ; vec4 zD ; vec2 zE ; zE = 0.5 + vec2 ( ( zx . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( zx . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; zD = texture2D ( u_shore_dist_map , zE ) ; const vec2 zF = vec2 ( 1.0 / 255.0 , 1.0 ) ; zC = dot ( zD . ba , zF ) ; zE = normalize ( zD . rg * 2.0 - 1.0 ) ; return vec3 ( zE , zC ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void zS ( inout vec3 zH , in float zI , in vec3 zJ ) { vec2 zK , zL , zM ; float zN , zO , zP , zQ , zR ; zN = dG ( DST_NOISE_SCALE_0 * ( zH . xz + DST_NOISE_FREQ_0 * zI ) ) * dG ( DST_NOISE_SCALE_1 * ( zH . zx - DST_NOISE_FREQ_1 * zI ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"zO = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; zP = zJ . b ; zQ = sqrt ( zP ) ; zO = max ( zP , DIR_MIN_SHR_FAC ) * sin ( zQ / zO + DIR_FREQ * zI ) ; zR = max ( dG ( DIR_NOISE_SCALE * ( zH . xz + DIR_NOISE_FREQ * zI ) ) , DIR_MIN_NOISE_FAC ) ; zO *= zR ; zQ = WAVES_HEIGHT * mix ( zO , zN , max ( zQ , DST_MIN_FAC ) ) ; zK = zJ . rg ; zO = WAVES_HOR_FAC * zO * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - zP ) , 0.0 ) ; zK = zO * zK ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"zQ = WAVES_HEIGHT * zN ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"zL = 2.0 * ( zH . xz - 0.1 * zI ) ; zM = 1.3 * ( zH . zx + 0.03 * zI ) ; zN = dj ( 0.5 * zL ) . x + dj ( 0.5 * zM ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"zH . xz += zK ; zN *= zP ;".split(" ")}]}}]},{type:"textline",b:"zQ += SMALL_WAVES_FAC * zN ;".split(" ")}]}}]},
{type:"textline",b:"zH . y += zQ ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec4 zT , zU ; vec2 zV ; float zW , zX , zY ; vec3 zZ , z_ , Aa , Ab ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) zB = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) zB = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) zB = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["zZ","=",
"a_position",";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"zW = abs ( zZ . y ) ; zV = u_camera_eye . xz - mod ( u_camera_eye . xz , zW ) ; zZ . y = WATER_LEVEL ; zZ . xz += zV ;".split(" ")}]}},{type:"elif",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["fd","=","a_texcoord",";"]}]}}]},{type:"textline",b:"el Ac = tT ( zZ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"zA = zG ( Ac . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"zX = length ( u_wind ) ; zY = u_time ; zY *= zX ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"zW = zW ; zZ = Ac . a + vec3 ( zW , 0.0 , 0.0 ) ; z_ = Ac . a + vec3 ( 0.0 , 0.0 , zW ) ; if ( a_position . y < 0.0 ) { Ac . a . y = WATER_LEVEL - 1.0 ; zZ . y = Ac . a . y ; z_ . y = Ac . a . y ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zz = Ac . a ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zZ = Ac . a + vec3 ( 0.05 , 0.0 , 0.0 ) ; z_ = Ac . a + vec3 ( 0.0 , 0.0 , 0.05 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"Aa = zG ( zZ . xz ) ; Ab = zG ( z_ . xz ) ; zS ( zZ , zY , Aa ) ; zS ( z_ , zY , Ab ) ; zS ( Ac . a , zY , zA ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"zS ( zZ , zY , vec3 ( 0.0 ) ) ; zS ( z_ , zY , vec3 ( 0.0 ) ) ; zS ( Ac . a , zY , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"zZ = normalize ( zZ - Ac . a ) ; z_ = normalize ( z_ - Ac . a ) ; eW = normalize ( cross ( z_ , zZ ) ) ; zY = dot ( eW , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; zY = clamp ( 0.8 - zY , 0.0 , 1.0 ) ; eW = mix ( eW , vec3 ( 0.0 , 1.0 , 0.0 ) , zY ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"z_ = a_tangent ; eW = a_normal ;".split(" ")}]}}]},{type:"textline",b:"eX = z_ ; zy = cross ( eW , eX ) ;".split(" ")}]}}]},{type:"textline",b:"eU = Ac . a ; wF = u_camera_eye - Ac . a ; zT = u_view_matrix * vec4 ( Ac . a , 1.0 ) ; zU = u_proj_matrix * zT ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"zY = zU . x ; zW = zU . y ; zX = zU . w ; eY . x = ( zY + zX ) / 2.0 ; eY . y = ( zW + zX ) / 2.0 ; eY . z = zX ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"eZ = - zT . z / u_view_max_depth ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","zU",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 zB ; const float zx = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 zC = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 zC = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 zD = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 zE = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 zF = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float zG , zH ; vec3 zI , zJ ; zI = vec3 ( 0.0 ) ; zG = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"zJ = sign ( zB - vec3 ( 0.02 * zx ) ) ; if ( zJ . x < 0.0 || zJ . y < 0.0 || zJ . z < 0.0 ) { zI = zC ; zG = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY",0,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zJ = sign ( zB - vec3 ( 0.02 * zx ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( zJ . x < 0.0 || zJ . y < 0.0 || zJ . z < 0.0 ) zI = u_wireframe_edge_color ; else zI = zF ; zG = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( zJ . x < 0.0 || zJ . y < 0.0 || zJ . z < 0.0 ) zG = 1.0 ; else zG = 0.0 ; zI = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( zJ . x < 0.0 || zJ . y < 0.0 || zJ . z < 0.0 ) zI = u_wireframe_edge_color ; else if ( gl_FrontFacing ) zI = zD ; else zI = zE ; zG = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY",1,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"zJ = fwidth ( zB ) ; zJ = smoothstep ( vec3 ( 0.0 ) , zJ * zx , zB ) ; zH = min ( min ( zJ . x , zJ . y ) , zJ . z ) ; zH = clamp ( zH , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { zI = vec3 ( mix ( u_wireframe_edge_color , zF , zH ) ) ; zG = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { zI = u_wireframe_edge_color ; zG = mix ( 1.0 , 0.0 , zH ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) zI = mix ( u_wireframe_edge_color , zD , zH ) ; else zI = mix ( u_wireframe_edge_color , zE , zH ) ; zG = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["ef","(","zI",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"ei ( zI , zG ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( zI , zG ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},
{type:"textline",b:["varying","vec3","zB",";"]},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 zx ; mat4 zC ; vec3 zD , zE , zF , zG , zH ; if ( a_polyindex == 0.0 ) zB = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) zB = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) zB = vec3 ( 0.0 , 0.0 , 1.0 ) ; zD = a_position ; zE = a_normal ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"el zI = tT ( zD , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"zD = mix ( zD , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"zF = vec3 ( 0.0 ) ; zG = vec3 ( 0.0 ) ; uT ( zD , zF , zG , zE ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["zG","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zG = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"el zI = wr ( zD , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , zG , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"zF = ( u_model_matrix * vec4 ( zG , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zC = tM ( u_camera_eye , zF , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"zC = tG ( u_camera_eye , zF , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zH = ( u_model_matrix * vec4 ( zG , 1.0 ) ) . xyz ; zC = zC * ty ( u_wind , u_time , u_jitter_amp , u_jitter_freq , zH ) ;".split(" ")}]}}]},{type:"textline",b:"el zI = tT ( zD - zG , zG , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , zC ) ; zI . b = zF ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"el zI = tT ( zD , zG , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"vH ( zI . a , zI . b , zE ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"zx = u_view_matrix * vec4 ( zI . a , 1.0 ) ; gl_Position = u_proj_matrix * zx ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",
b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 fd ; void main ( ) { vec4 zx , zC ; zx = texture2D ( u_sampler_left , fd ) ; zC = texture2D ( u_sampler_right , fd ) ; gl_FragColor = vec4 ( zx [ 0 ] , zC [ 1 ] , zC [ 2 ] , zx [ 3 ] + zC [ 3 ] ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},
{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 fd ; vec4 zE ( float zx , float zC ) { vec2 zD ; zD = fd + vec2 ( zx , zC ) * u_texel_size ; return texture2D ( u_color , zD ) ; } float zI ( vec4 zF ) { float zG ; vec3 zH ; zH = vec3 ( 0.299 , 0.587 , 0.114 ) ; zG = dot ( zF . rgb , zH ) ; return zG ; } vec4 zV ( ) { vec2 zJ ; float zK , zL , zM , zN , zO , zP ; vec4 zQ , zR , zS , zT , zU ; zQ = zE ( - 1.0 , - 1.0 ) ; zR = zE ( 1.0 , - 1.0 ) ; zS = zE ( - 1.0 , 1.0 ) ; zT = zE ( 1.0 , 1.0 ) ; zU = zE ( 0.0 , 0.0 ) ; zK = zI ( zQ ) ; zL = zI ( zR ) ; zM = zI ( zS ) ; zN = zI ( zT ) ; zO = zI ( zU ) ; zP = min ( zO , min ( min ( zK , zL ) , min ( zM , zN ) ) ) ; zO = max ( zO , max ( max ( zK , zL ) , max ( zM , zN ) ) ) ; zJ . x = - ( ( zK + zL ) - ( zM + zN ) ) ; zJ . y = ( ( zK + zM ) - ( zL + zN ) ) ; zN = max ( ( zK + zL + zM + zN ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; zN = 1.0 / ( min ( abs ( zJ . x ) , abs ( zJ . y ) ) + zN ) ; zJ = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , zJ * zN ) ) * u_texel_size ; zU = 0.5 * ( texture2D ( u_color , fd + zJ * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , fd + zJ * ( 2.0 / 3.0 - 0.5 ) ) ) ; zT = zU * 0.5 + 0.25 * ( texture2D ( u_color , fd + zJ * - 0.5 ) + texture2D ( u_color , fd + zJ * 0.5 ) ) ; zN = zI ( zT ) ; if ( ( zN < zP ) || ( zN > zO ) ) return zU ; else return zT ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 Az ( ) { bool zW , zX , zY , zZ , z_ ; float Aa , Ab , Ac , Ad , Ae , Af , Ag , Ah , Ai , Aj , Ak , Al , Am , An , Ao ; vec4 Ap , Aq , Ar , As , At ; vec2 Au , Av , Aw , Ax , Ay ; Au . x = fd . x ; Au . y = fd . y ; Ap = texture2D ( u_color , Au ) ; Aq = zE ( 0.0 , 1.0 ) ; Ar = zE ( 1.0 , 0.0 ) ; As = zE ( 0.0 , - 1.0 ) ; At = zE ( - 1.0 , 0.0 ) ; Aa = zI ( Aq ) ; Ab = zI ( Ar ) ; Ac = zI ( As ) ; Ad = zI ( At ) ; Ae = zI ( Ap ) ; Af = max ( Aa , Ae ) ; Ag = min ( Aa , Ae ) ; Af = max ( Ab , Af ) ; Ag = min ( Ab , Ag ) ; Ah = max ( Ac , Ad ) ; Ai = min ( Ac , Ad ) ; Af = max ( Ah , Af ) ; Ag = min ( Ai , Ag ) ; Ai = Af * FXAA_QUALITY_EDGE_THRESHOLD ; Ag = Af - Ag ; Ai = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , Ai ) ; zW = Ag < Ai ; if ( zW ) return Ap ; Ap = zE ( - 1.0 , - 1.0 ) ; At = zE ( 1.0 , 1.0 ) ; As = zE ( 1.0 , - 1.0 ) ; Ar = zE ( - 1.0 , 1.0 ) ; Ai = zI ( Ap ) ; Af = zI ( At ) ; Ah = zI ( As ) ; Aj = zI ( Ar ) ; Ak = Ac + Aa ; Al = Ad + Ab ; Ag = 1.0 / Ag ; Am = Ak + Al ; Ak = ( - 2.0 * Ae ) + Ak ; Al = ( - 2.0 * Ae ) + Al ; An = Ah + Af ; Ah = Ai + Ah ; Ao = ( - 2.0 * Ab ) + An ; Ah = ( - 2.0 * Ac ) + Ah ; Ai = Ai + Aj ; Af = Aj + Af ; Ao = ( abs ( Ak ) * 2.0 ) + abs ( Ao ) ; Ah = ( abs ( Al ) * 2.0 ) + abs ( Ah ) ; Al = ( - 2.0 * Ad ) + Ai ; Af = ( - 2.0 * Aa ) + Af ; Ao = abs ( Al ) + Ao ; Ah = abs ( Af ) + Ah ; An = Ai + An ; Ai = u_texel_size . x ; zW = Ao >= Ah ; An = Am * 2.0 + An ; if ( ! zW ) Ac = Ad ; if ( ! zW ) Aa = Ab ; if ( zW ) Ai = u_texel_size . y ; An = ( An * ( 1.0 / 12.0 ) ) - Ae ; Ab = Ac - Ae ; Ad = Aa - Ae ; Ac = Ac + Ae ; Aa = Aa + Ae ; zX = abs ( Ab ) >= abs ( Ad ) ; Ad = max ( abs ( Ab ) , abs ( Ad ) ) ; if ( zX ) Ai = - Ai ; Ag = clamp ( abs ( An ) * Ag , 0.0 , 1.0 ) ; Av . x = Au . x ; Av . y = Au . y ; Aw . x = ( ! zW ) ? 0.0 : u_texel_size . x ; Aw . y = ( zW ) ? 0.0 : u_texel_size . y ; if ( ! zW ) Av . x += Ai * 0.5 ; if ( zW ) Av . y += Ai * 0.5 ; Ax . x = Av . x - Aw . x ; Ax . y = Av . y - Aw . y ; Ay . x = Av . x + Aw . x ; Ay . y = Av . y + Aw . y ; An = ( ( - 2.0 ) * Ag ) + 3.0 ; Ab = zI ( texture2D ( u_color , Ax ) ) ; Ag = Ag * Ag ; Am = zI ( texture2D ( u_color , Ay ) ) ; if ( ! zX ) Ac = Aa ; Ad = Ad * 1.0 / 4.0 ; Ae = Ae - Ac * 0.5 ; Ag = An * Ag ; zX = Ae < 0.0 ; Ab -= Ac * 0.5 ; Am -= Ac * 0.5 ; zY = abs ( Ab ) >= Ad ; zZ = abs ( Am ) >= Ad ; if ( ! zY ) Ax . x -= Aw . x * 1.5 ; if ( ! zY ) Ax . y -= Aw . y * 1.5 ; z_ = ( ! zY ) || ( ! zZ ) ; if ( ! zZ ) Ay . x += Aw . x * 1.5 ; if ( ! zZ ) Ay . y += Aw . y * 1.5 ; if ( z_ ) { if ( ! zY ) Ab = zI ( texture2D ( u_color , Ax . xy ) ) ; if ( ! zZ ) Am = zI ( texture2D ( u_color , Ay . xy ) ) ; if ( ! zY ) Ab = Ab - Ac * 0.5 ; if ( ! zZ ) Am = Am - Ac * 0.5 ; zY = abs ( Ab ) >= Ad ; zZ = abs ( Am ) >= Ad ; if ( ! zY ) Ax . x -= Aw . x * 2.0 ; if ( ! zY ) Ax . y -= Aw . y * 2.0 ; z_ = ( ! zY ) || ( ! zZ ) ; if ( ! zZ ) Ay . x += Aw . x * 2.0 ; if ( ! zZ ) Ay . y += Aw . y * 2.0 ; if ( z_ ) { if ( ! zY ) Ab = zI ( texture2D ( u_color , Ax . xy ) ) ; if ( ! zZ ) Am = zI ( texture2D ( u_color , Ay . xy ) ) ; if ( ! zY ) Ab = Ab - Ac * 0.5 ; if ( ! zZ ) Am = Am - Ac * 0.5 ; zY = abs ( Ab ) >= Ad ; zZ = abs ( Am ) >= Ad ; if ( ! zY ) Ax . x -= Aw . x * 2.0 ; if ( ! zY ) Ax . y -= Aw . y * 2.0 ; z_ = ( ! zY ) || ( ! zZ ) ; if ( ! zZ ) Ay . x += Aw . x * 2.0 ; if ( ! zZ ) Ay . y += Aw . y * 2.0 ; if ( z_ ) { if ( ! zY ) Ab = zI ( texture2D ( u_color , Ax . xy ) ) ; if ( ! zZ ) Am = zI ( texture2D ( u_color , Ay . xy ) ) ; if ( ! zY ) Ab = Ab - Ac * 0.5 ; if ( ! zZ ) Am = Am - Ac * 0.5 ; zY = abs ( Ab ) >= Ad ; zZ = abs ( Am ) >= Ad ; if ( ! zY ) Ax . x -= Aw . x * 4.0 ; if ( ! zY ) Ax . y -= Aw . y * 4.0 ; z_ = ( ! zY ) || ( ! zZ ) ; if ( ! zZ ) Ay . x += Aw . x * 4.0 ; if ( ! zZ ) Ay . y += Aw . y * 4.0 ; if ( z_ ) { if ( ! zY ) Ab = zI ( texture2D ( u_color , Ax . xy ) ) ; if ( ! zZ ) Am = zI ( texture2D ( u_color , Ay . xy ) ) ; if ( ! zY ) Ab = Ab - Ac * 0.5 ; if ( ! zZ ) Am = Am - Ac * 0.5 ; zY = abs ( Ab ) >= Ad ; zZ = abs ( Am ) >= Ad ; if ( ! zY ) Ax . x -= Aw . x * 2.0 ; if ( ! zY ) Ax . y -= Aw . y * 2.0 ; if ( ! zZ ) Ay . x += Aw . x * 2.0 ; if ( ! zZ ) Ay . y += Aw . y * 2.0 ; } } } } Ad = Au . x - Ax . x ; Ac = Ay . x - Au . x ; if ( ! zW ) Ad = Au . y - Ax . y ; if ( ! zW ) Ac = Ay . y - Au . y ; zZ = ( Ab < 0.0 ) != zX ; Ab = ( Ac + Ad ) ; zX = ( Am < 0.0 ) != zX ; Ab = 1.0 / Ab ; zY = Ad < Ac ; Ac = min ( Ad , Ac ) ; zX = zY ? zZ : zX ; Ag = Ag * Ag ; Ab = ( Ac * ( - Ab ) ) + 0.5 ; Ag = Ag * FXAA_QUALITY_SUBPIX ; Ab = zX ? Ab : 0.0 ; Ag = max ( Ab , Ag ) ; if ( ! zW ) Au . x += Ag * Ai ; if ( zW ) Au . y += Ag * Ai ; return texture2D ( u_color , Au ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_PASS",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , fd ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{type:"equal_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"gl_FragColor = zV ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = Az ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , fd ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 fd ; void main ( ) { vec4 zx ; vec2 zC , zD ; zC = vec2 ( 0.0 , 0.0 ) ; zD = u_texel_size ; zx = texture2D ( u_color , fd ) ; gl_FragColor = zx * 0.0875447373698 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0858112354248 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0808139781061 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0731235112908 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0635705267419 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0530985673112 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0426125984122 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0328565115809 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * zx , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 fd ; void main ( ) { vec4 zx , zC ; zx = texture2D ( u_main , fd ) ; zC = texture2D ( u_bloom , fd ) ; zx = zx ; zx += zC ; gl_FragColor = vec4 ( zx . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 fd ; void main ( ) { float zx ; vec3 zC , zD ; vec4 zE ; zE = texture2D ( u_color , fd ) ; zC = zE . rgb ; if ( u_brightness < 0.0 ) zC = zC * ( 1.0 + u_brightness ) ; else zC = zC + ( ( 1.0 - zC ) * u_brightness ) ; zC = ( zC - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; zC *= u_exposure ; zD = vec3 ( 0.299 , 0.587 , 0.114 ) ; zx = dot ( zC , zD ) ; zC = mix ( vec3 ( zx ) , zC , u_saturation ) ; gl_FragColor = vec4 ( zC , zE . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 fd ; void main ( ) { gl_FragColor = g ( clamp ( zI ( u_depth , fd , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]=
{type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 fd ; void main ( ) { float zx , zJ ; vec4 zK , zL ; zK = texture2D ( u_sharp , fd ) ; if ( u_dof_dist > 0.0 ) { zx = zI ( u_depth , fd , u_camera_range ) ; zx *= u_view_max_depth ; if ( zx < u_dof_dist ) zJ = ( u_dof_dist - zx ) / u_dof_front ; else zJ = ( zx - u_dof_dist ) / u_dof_rear ; zJ = clamp ( zJ , 0.0 , 1.0 ) ; zL = texture2D ( u_blurred , fd ) ; gl_FragColor = mix ( zK , zL , zJ ) ; } else gl_FragColor = zK ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_src_color ; uniform sampler2D u_glow_mask_small ; uniform sampler2D u_glow_mask_large ; uniform float u_glow_mask_small_coeff ; uniform float u_glow_mask_large_coeff ; varying vec2 fd ; void main ( ) { float zx ; vec4 zJ , zK , zL ; zJ = texture2D ( u_src_color , fd ) ; zK = texture2D ( u_glow_mask_small , fd ) ; zL = texture2D ( u_glow_mask_large , fd ) ; gl_FragColor = zJ ; if ( zL . a != 0.0 ) { zx = u_glow_mask_large_coeff * zL . a ; zx = clamp ( zx , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , zL . rgb / zL . a , zx ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , zx ) ; } if ( zK . a != 0.0 ) { zx = u_glow_mask_small_coeff * zK . a ; zx = clamp ( zx , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , zK . rgb / zK . a , zx ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , zx ) ; } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float zJ ; varying vec2 zK ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 fd ; varying vec4 zL ; void main ( ) { vec4 zM ; float zN , zO , zP , zQ , zR ; vec2 zS , zT , zU ; zS = ( zL . xy - fd ) ; zN = length ( zS ) ; zS = u_radial_blur_step * zS / zN ; zO = zN / u_radial_blur_step ; zS *= min ( zO , STEPS_PER_PASS ) / STEPS_PER_PASS ; zO = max ( zO , STEPS_PER_PASS ) ; zT = fd ; zP = 0.0 ; for ( float zV = 0.0 ; zV < STEPS_PER_PASS ; zV += 1.0 ) { if ( zV <= zO ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"zQ = zI ( u_input , zT , u_camera_range ) ; zP += max ( ( 1.0 - pow ( zN , 0.3 ) ) * step ( 0.9 , zQ ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zM = texture2D ( u_input , zT ) ; zP += k ( zM ) ;".split(" ")}]}}]},{type:"textline",b:"} zT += zS ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"zU = fd + zK ; zR = dj ( vec2 ( 2.5 * ( zU . x ) , 2.5 * ( zU . y ) + 1.0 * u_time ) ) . x + 0.75 * dj ( vec2 ( 5.0 * ( zU . x ) - 0.66 * u_time , 5.0 * ( zU . y ) + 0.66 * u_time ) ) . x + 0.5 * dG ( vec2 ( 7.5 * ( zU . x ) + 0.33 * u_time , 7.5 * ( zU . y ) - 0.33 * u_time ) ) ; zR *= clamp ( 1.2 - sqrt ( 0.2 * zN ) , 0.0 , 1.0 ) * zJ ; zP = max ( zR , zP ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = g ( zP / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"include",file:"math.glslv"},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float zJ ; varying vec2 zK ;".split(" ")}]}}]}]}}]},{type:"textline",
b:"varying vec2 fd ; varying vec4 zL ; void main ( ) { float zx , zM ; vec3 zN ; fd = a_bb_vertex + 0.5 ; zN = normalize ( u_sun_direction ) ; zL = u_proj_matrix * u_view_matrix * vec4 ( zN , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { zJ = 1.0 ; zN = vec3 ( 0.0 , 1.0 , 0.0 ) ; zN = er ( u_camera_quat , zN ) ; zN = normalize ( zN ) ; zx = dot ( zN , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; zM = atan ( zN . x , zN . z ) ; zK = vec2 ( - zM , acos ( zx ) ) ; } else { zJ = 0.0 ; }".split(" ")}]}}]},
{type:"textline",b:"zL . xy = 0.5 * ( zL . xy / zL . w + 1.0 ) ; zL += 99999.0 * step ( zL . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 fd ; void main ( ) { float zx ; vec3 zM ; vec4 zN ; zN = texture2D ( u_main , fd ) ; zM = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; ed ( zN . rgb ) ; zx = k ( texture2D ( u_god_rays , fd ) ) ; zM = zN . rgb + u_god_rays_intensity * vec3 ( zx ) * zM ; ef ( zM ) ; gl_FragColor . rgb = zM ; gl_FragColor . a = zN . a ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 fd ; void main ( ) { float zx ; vec4 zM ; zM = texture2D ( u_input , fd ) ; zx = dot ( zM . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( zx ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float zx , zM ; zM = 0.0 ; for ( float zN = 0.025 ; zN < 1.0 ; zN += 0.05 ) for ( float zO = 0.025 ; zO < 1.0 ; zO += 0.05 ) { zx = max ( texture2D ( u_input , vec2 ( zN , zO ) ) . r , 0.01 ) ; zM += log ( zx ) ; } zM = exp ( zM / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( zM ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 fd ; varying float zM ; void main ( ) { vec4 zN ; float zO , zP ; zO = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; zP = texture2D ( u_luminance , fd ) . r ; zN = texture2D ( u_main , fd ) ; zO = zP / zO ; zP = u_bloom_edge_lum ; gl_FragColor = zN * max ( zO - zP , 0.0 ) * zM ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 fd ; varying float zM ; const vec3 zx = vec3 ( 0.0 , 1.0 , 0.0 ) ; void zU ( in vec4 zN , in vec3 zO , out vec3 zP ) { float zQ , zR , zS , zT ; zQ = zN . w * zO . x + zN . y * zO . z - zN . z * zO . y ; zR = zN . w * zO . y + zN . z * zO . x - zN . x * zO . z ; zS = zN . w * zO . z + zN . x * zO . y - zN . y * zO . x ; zT = - zN . x * zO . x - zN . y * zO . y - zN . z * zO . z ; zP . x = zQ * zN . w - zT * zN . x - zR * zN . z + zS * zN . y ; zP . y = zR * zN . w - zT * zN . y - zS * zN . x + zQ * zN . z ; zP . z = zS * zN . w - zT * zN . z - zQ * zN . y + zR * zN . x ; } void main ( ) { vec3 zV ; fd = 2.0 * a_position ; zU ( u_camera_quat , zx , zV ) ; zM = dot ( - zV , u_sun_direction ) * u_bloom_key ; zM *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; uniform float u_motion_blur_decay_threshold ; varying vec2 fd ; float zx = 0.0042 ; void main ( ) { vec4 zN , zO , zP , zQ ; zN = texture2D ( u_mb_tex_curr , fd ) ; zO = texture2D ( u_mb_tex_accum , fd ) ; if ( length ( zN - zO ) > u_motion_blur_decay_threshold ) { zP = ( 1.0 - u_motion_blur_exp ) * zN + u_motion_blur_exp * zO ; zP = zP - zO ; zQ = zN - zO ; zP = min ( max ( abs ( zP ) , vec4 ( zx ) ) , abs ( zQ ) ) * sign ( zP ) ; gl_FragColor = zO + zP ; } else { gl_FragColor = zN ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 fd ; void main ( ) { vec3 zx ; float zN ; vec4 zO , zP , zQ ; zO = texture2D ( u_outline_src , fd ) ; gl_FragColor = zO ; if ( u_draw_outline != 0.0 ) { zP = texture2D ( u_outline_mask , fd ) ; zQ = texture2D ( u_outline_mask_blurred , fd ) ; zN = zQ . a - zP . a ; if ( zN != 0.0 ) { zN = smoothstep ( 0.0 , 1.0 , zQ . a ) ; if ( zP . a == 0.0 ) { zx = u_outline_color ; ef ( zx ) ; zP = vec4 ( clamp ( zx , 0.0 , 1.0 ) , 1.0 ) ; gl_FragColor = mix ( zO , zP , zN ) ; } } } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 fd ; void main ( ) { vec2 zx , zN ; vec4 zO ;".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","POST_EFFECT_NONE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , fd ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","POST_EFFECT_GRAYSCALE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zO = texture2D ( u_color , fd ) ; gl_FragColor . rgb = vec3 ( ( zO . r + zO . g + zO . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_BLUR",
{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_BLUR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zx = vec2 ( 0.0 , 0.0 ) ; zN = u_texel_size ; zO = texture2D ( u_color , fd ) ; gl_FragColor = zO * 0.2270270270 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * 0.1945945946 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * 0.1945945946 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * 0.1216216216 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * 0.1216216216 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * 0.0540540541 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * 0.0540540541 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * 0.0162162162 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_GLOW_BLUR",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zx = vec2 ( 0.0 , 0.0 ) ; zN = u_texel_size ; zO = texture2D ( u_color , fd ) ; gl_FragColor = zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.152507 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.141763 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.141763 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.113861 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.113861 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.079019 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.079019 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.047383 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.047383 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.024549 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.024549 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.01099 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.01099 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.00425 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.00425 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.00142 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.00142 ; gl_FragColor = clamp ( gl_FragColor , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_EXTEND",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_EXTEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zN = u_texel_size ; zO = texture2D ( u_color , fd ) ; gl_FragColor = zO ; if ( zO . a == 0.0 ) { zO = texture2D ( u_color , fd + zN ) ; if ( zO . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , zO . a ) ; else { zO = texture2D ( u_color , fd - zN ) ; if ( zO . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , zO . a ) ; } }".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; varying vec2 fd ; void main ( ) { fd = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",
name:"SMAA_EDGE_DETECTION",b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",d:2},"SMAA_PREDICATION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 fd ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","zN",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 zO ; varying vec4 zP ; varying vec4 zQ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","zR",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",
b:["1"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",
name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},
{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},
{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 zX ( vec2 zS , sampler2D zT ) { float zU , zV , zW ; zU = texture2D ( zT , zS ) . r ; zV = texture2D ( zT , zO . xy ) . r ; zW = texture2D ( zT , zO . zw ) . r ; return vec3 ( zU , zV , zW ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 Ab ( vec2 zY , sampler2D zZ ) { vec2 z_ ; vec3 Aa ; Aa = zX ( zY , zZ ) ; z_ = abs ( Aa . xx - Aa . yz ) ; z_ = step ( SMAA_PREDICATION_THRESHOLD , z_ ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * z_ ) ; }".split(" ")}]}}]},
{type:"textline",b:"void Af ( bvec2 Ac , inout vec2 Ad , vec2 Ae ) { if ( Ac . x ) Ad . x = Ae . x ; if ( Ac . y ) Ad . y = Ae . y ; } void Af ( bvec4 Ag , inout vec4 Ah , vec4 Ai ) { Af ( Ag . xy , Ah . xy , Ai . xy ) ; Af ( Ag . zw , Ah . zw , Ai . zw ) ; } vec2 Ak ( vec2 Aj ) { return sign ( Aj ) * floor ( abs ( Aj ) + .5 ) ; } vec4 Ak ( vec4 Al ) { return sign ( Al ) * floor ( abs ( Al ) + .5 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 Ay ( vec2 Am , sampler2D An".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","Ao"]}]}}]},{type:"textline",b:") { vec4 Ap ; float Aq , Ar , As , At , Au ; vec3 Av ; vec2 Aw , Ax ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"Aw = Ab ( Am , Ao ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"Aw = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"Av = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; Aq = dot ( texture2D ( An , Am ) . rgb , Av ) ; Ar = dot ( texture2D ( An , zO . xy ) . rgb , Av ) ; As = dot ( texture2D ( An , zO . zw ) . rgb , Av ) ; Ap . xy = abs ( Aq - vec2 ( Ar , As ) ) ; Aw = step ( Aw , Ap . xy ) ; if ( dot ( Aw , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; At = dot ( texture2D ( An , zP . xy ) . rgb , Av ) ; Au = dot ( texture2D ( An , zP . zw ) . rgb , Av ) ; Ap . zw = abs ( Aq - vec2 ( At , Au ) ) ; Ax = max ( Ap . xy , Ap . zw ) ; Au = dot ( texture2D ( An , zQ . xy ) . rgb , Av ) ; At = dot ( texture2D ( An , zQ . zw ) . rgb , Av ) ; Ap . zw = abs ( vec2 ( Ar , As ) - vec2 ( Au , At ) ) ; Ax = max ( Ax . xy , Ap . zw ) ; At = max ( Ax . x , Ax . y ) ; Aw . xy *= step ( At , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * Ap . xy ) ; return Aw ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vec2 AA ( vec2 Az ) { Az . r = Az . r * abs ( 5.0 * Az . r - 5.0 * 0.75 ) ; return Ak ( Az ) ; } vec4 AA ( vec4 AB ) { AB . rb = AB . rb * abs ( 5.0 * AB . rb - 5.0 * 0.75 ) ; return Ak ( AB ) ; } vec2 AJ ( sampler2D AC , vec2 AD , vec2 AE , out vec2 AF ) { vec3 AG ; vec4 AH ; AH = vec4 ( AD , - 1.0 , 1.0 ) ; AG = vec3 ( u_texel_size , 1.0 ) ; for ( int AI = 0 ; AI < SMAA_MAX_SEARCH_STEPS_DIAG ; AI ++ ) { if ( AH . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && AH . w > 0.9 ) { AH . xyz += AG * vec3 ( AE , 1.0 ) ; AF = texture2D ( AC , AH . xy , 0.0 ) . rg ; AH . w = dot ( AF , vec2 ( 0.5 , 0.5 ) ) ; } } return AH . zw ; } vec2 AR ( sampler2D AK , vec2 AL , vec2 AM , out vec2 AN ) { vec3 AO ; vec4 AP ; AP = vec4 ( AL , - 1.0 , 1.0 ) ; AP . x += 0.25 * u_texel_size . x ; AO = vec3 ( u_texel_size , 1.0 ) ; for ( int AQ = 0 ; AQ < SMAA_MAX_SEARCH_STEPS_DIAG ; AQ ++ ) { if ( AP . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && AP . w > 0.9 ) { AP . xyz = AO * vec3 ( AM , 1.0 ) + AP . xyz ; AN = texture2D ( AK , AP . xy , 0.0 ) . rg ; AN = AA ( AN ) ; AP . w = dot ( AN , vec2 ( 0.5 , 0.5 ) ) ; } } return AP . zw ; } vec2 AX ( sampler2D AS , vec2 AT , vec2 AU , float AV ) { vec2 AW ; AW = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * AU + AT ; AW = SMAA_AREATEX_PIXEL_SIZE * AW + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; AW . x += 0.5 ; AW . y += SMAA_AREATEX_SUBTEX_SIZE * AV ; return texture2D ( AS , AW , 0.0 ) . rg ; } vec2 Bi ( sampler2D AY , sampler2D AZ , vec2 A_ , vec2 Ba , vec4 Bb ) { vec4 Bc , Bd , Be ; vec2 Bf , Bg , Bh ; Bf = vec2 ( 0.0 , 0.0 ) ; if ( Ba . r > 0.0 ) { Bc . xz = AJ ( AY , A_ , vec2 ( - 1.0 , 1.0 ) , Bg ) ; Bc . x += float ( Bg . y > 0.9 ) ; } else Bc . xz = vec2 ( 0.0 , 0.0 ) ; Bc . yw = AJ ( AY , A_ , vec2 ( 1.0 , - 1.0 ) , Bg ) ; if ( Bc . x + Bc . y > 2.0 ) { Bd = vec4 ( - Bc . x + 0.25 , Bc . x , Bc . y , - Bc . y - 0.25 ) * u_texel_size . xyxy + A_ . xyxy ; Be . xy = texture2D ( AY , Bd . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; Be . zw = texture2D ( AY , Bd . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; Be . yxwz = AA ( Be . xyzw ) ; Bh = vec2 ( 2.0 , 2.0 ) * Be . xz + Be . yw ; Af ( bvec2 ( step ( 0.9 , Bc . zw ) ) , Bh , vec2 ( 0.0 , 0.0 ) ) ; Bf += AX ( AZ , Bc . xy , Bh , Bb . z ) ; } Bc . xz = AR ( AY , A_ , vec2 ( - 1 , - 1 ) , Bg ) ; if ( texture2D ( AY , A_ + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { Bc . yw = AR ( AY , A_ , vec2 ( 1 , 1 ) , Bg ) ; Bc . y += float ( Bg . y > 0.9 ) ; } else Bc . yw = vec2 ( 0.0 , 0.0 ) ; if ( Bc . x + Bc . y > 2.0 ) { Be = vec4 ( - Bc . x , - Bc . x , Bc . y , Bc . y ) * u_texel_size . xyxy + A_ . xyxy ; Bd . x = texture2D ( AY , Be . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; Bd . y = texture2D ( AY , Be . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; Bd . zw = texture2D ( AY , Be . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; Bg = vec2 ( 2.0 , 2.0 ) * Bd . xz + Bd . yw ; Af ( bvec2 ( step ( 0.9 , Bc . zw ) ) , Bg , vec2 ( 0 , 0 ) ) ; Bf += AX ( AZ , Bc . xy , Bg , Bb . w ) . gr ; } return Bf ; }".split(" ")}]}}]},
{type:"textline",b:"float Bo ( sampler2D Bj , vec2 Bk , float Bl ) { vec2 Bm , Bn ; Bm = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; Bn = SMAA_SEARCHTEX_SIZE * vec2 ( Bl , 1.0 ) ; Bm += vec2 ( - 1.0 , 1.0 ) ; Bn += vec2 ( 0.5 , - 0.5 ) ; Bm *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; Bn *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( Bj , Bm * Bk + Bn , 0.0 ) . r ; } float Bw ( sampler2D Bp , sampler2D Bq , vec2 Br , float Bs ) { float Bt ; vec2 Bu ; Bu = vec2 ( 0.0 , 1.0 ) ; for ( int Bv = 0 ; Bv < SMAA_MAX_SEARCH_STEPS ; Bv ++ ) { if ( Br . x > Bs && Bu . g > 0.8281 && Bu . r == 0.0 ) { Bu = texture2D ( Bp , Br , 0.0 ) . rg ; Br = - vec2 ( 2.0 , 0.0 ) * u_texel_size + Br ; } } Bt = - ( 255.0 / 127.0 ) * Bo ( Bq , Bu , 0.0 ) + 3.25 ; return u_texel_size . x * Bt + Br . x ; } float BE ( sampler2D Bx , sampler2D By , vec2 Bz , float BA ) { float BB ; vec2 BC ; BC = vec2 ( 0.0 , 1.0 ) ; for ( int BD = 0 ; BD < SMAA_MAX_SEARCH_STEPS ; BD ++ ) { if ( Bz . x < BA && BC . g > 0.8281 && BC . r == 0.0 ) { BC = texture2D ( Bx , Bz , 0.0 ) . rg ; Bz = vec2 ( 2.0 , 0.0 ) * u_texel_size + Bz ; } } BB = - ( 255.0 / 127.0 ) * Bo ( By , BC , 0.5 ) + 3.25 ; return - u_texel_size . x * BB + Bz . x ; } float BM ( sampler2D BF , sampler2D BG , vec2 BH , float BI ) { float BJ ; vec2 BK ; BK = vec2 ( 1.0 , 0.0 ) ; for ( int BL = 0 ; BL < SMAA_MAX_SEARCH_STEPS ; BL ++ ) { if ( BH . y > BI && BK . r > 0.8281 && BK . g == 0.0 ) { BK = texture2D ( BF , BH , 0.0 ) . rg ; BH = - vec2 ( 0.0 , 2.0 ) * u_texel_size + BH ; } } BJ = - ( 255.0 / 127.0 ) * Bo ( BG , BK . gr , 0.0 ) + 3.25 ; return u_texel_size . y * BJ + BH . y ; } float BU ( sampler2D BN , sampler2D BO , vec2 BP , float BQ ) { float BR ; vec2 BS ; BS = vec2 ( 1.0 , 0.0 ) ; for ( int BT = 0 ; BT < SMAA_MAX_SEARCH_STEPS ; BT ++ ) { if ( BP . y < BQ && BS . r > 0.8281 && BS . g == 0.0 ) { BS = texture2D ( BN , BP , 0.0 ) . rg ; BP = vec2 ( 0.0 , 2.0 ) * u_texel_size + BP ; } } BR = - ( 255.0 / 127.0 ) * Bo ( BO , BS . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * BR + BP . y ; } vec2 Ca ( sampler2D BV , vec2 BW , float BX , float BY , float BZ ) { vec2 B_ ; B_ = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * Ak ( 4.0 * vec2 ( BX , BY ) ) + BW ; B_ = SMAA_AREATEX_PIXEL_SIZE * B_ + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; B_ . y = SMAA_AREATEX_SUBTEX_SIZE * BZ + B_ . y ; return texture2D ( BV , B_ , 0.0 ) . rg ; } void Ch ( sampler2D Cb , inout vec2 Cc , vec4 Cd , vec2 Ce ) { vec2 Cf , Cg ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"Cf = step ( Ce . xy , Ce . yx ) ; Cg = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * Cf ; Cg /= Cf . x + Cf . y ; Cf = vec2 ( 1.0 , 1.0 ) ; Cf . x -= Cg . x * texture2D ( Cb , Cd . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; Cf . x -= Cg . y * texture2D ( Cb , Cd . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; Cf . y -= Cg . x * texture2D ( Cb , Cd . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; Cf . y -= Cg . y * texture2D ( Cb , Cd . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; Cc *= clamp ( Cf , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void Co ( sampler2D Ci , inout vec2 Cj , vec4 Ck , vec2 Cl ) { vec2 Cm , Cn ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"Cm = step ( Cl . xy , Cl . yx ) ; Cn = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * Cm ; Cn /= Cm . x + Cm . y ; Cm = vec2 ( 1.0 , 1.0 ) ; Cm . x -= Cn . x * texture2D ( Ci , Ck . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; Cm . x -= Cn . y * texture2D ( Ci , Ck . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; Cm . y -= Cn . x * texture2D ( Ci , Ck . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; Cm . y -= Cn . y * texture2D ( Ci , Ck . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; Cj *= clamp ( Cm , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 CC ( vec2 Cp , vec2 Cq , sampler2D Cr , sampler2D Cs , sampler2D Ct , vec4 Cu ) { float Cv , Cw ; vec3 Cx ; vec2 Cy , Cz , CA ; vec4 CB ; CB = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; Cy = texture2D ( Cr , Cp ) . rg ; if ( Cy . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:"CB . rg = Bi ( Cr , Cs , Cp , Cy , Cu ) ; if ( CB . r == - CB . g ) {".split(" ")}]}}]},{type:"textline",b:"; Cx . x = Bw ( Cr , Ct , zO . xy , zQ . x ) ; Cx . y = zP . y ; Cz . x = Cx . x ; Cv = texture2D ( Cr , Cx . xy , 0.0 ) . r ; Cx . z = BE ( Cr , Ct , zO . zw , zQ . y ) ; Cz . y = Cx . z ; Cz = abs ( Ak ( Cz / u_texel_size . xx - Cq . xx ) ) ; CA = sqrt ( Cz ) ; Cw = texture2D ( Cr , Cx . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; CB . rg = Ca ( Cs , CA , Cv , Cw , Cu . y ) ; Cx . y = Cp . y ; Ch ( Cr , CB . rg , Cx . xyzy , Cz ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"} else Cy . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( Cy . r > 0.0 ) { ; Cx . y = BM ( Cr , Ct , zP . xy , zQ . z ) ; Cx . x = zO . x ; Cy . x = Cx . y ; Cw = texture2D ( Cr , Cx . xy , 0.0 ) . g ; Cx . z = BU ( Cr , Ct , zP . zw , zQ . w ) ; Cy . y = Cx . z ; Cy = abs ( Ak ( Cy / u_texel_size . yy - Cq . yy ) ) ; Cz = sqrt ( Cy ) ; Cv = texture2D ( Cr , Cx . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; CB . ba = Ca ( Cs , Cz , Cw , Cv , Cu . x ) ; Cx . x = Cp . x ; Co ( Cr , CB . ba , Cx . xyxz , Cy ) ; } return CB ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 CO ( vec2 CD , sampler2D CE , sampler2D CF".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","CG"]}]}}]},{type:"textline",b:") { bool CH ; vec2 CI , CJ , CK ; vec4 CL , CM , CN ; CL . x = texture2D ( CF , zN . xy ) . a ; CL . y = texture2D ( CF , zN . zw ) . g ; CL . wz = texture2D ( CF , CD ) . xz ; if ( dot ( CL , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { CM = texture2D ( CE , CD , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"CN = texture2D ( CG , fd ) ; CI = 2.0 * s ( CN ) - 1.0 ; CM . a = sqrt ( 2.0 * length ( CI ) ) ;".split(" ")}]}}]},{type:"textline",b:"return CM ; } else { CH = max ( CL . x , CL . z ) > max ( CL . y , CL . w ) ; CM = vec4 ( 0.0 , CL . y , 0.0 , CL . w ) ; CI = CL . yw ; Af ( bvec4 ( CH , CH , CH , CH ) , CM , vec4 ( CL . x , 0.0 , CL . z , 0.0 ) ) ; Af ( bvec2 ( CH , CH ) , CI , CL . xz ) ; CI /= dot ( CI , vec2 ( 1.0 , 1.0 ) ) ; CM = CM * vec4 ( u_texel_size , - u_texel_size ) + CD . xyxy ; CL = CI . x * texture2D ( CE , CM . xy , 0.0 ) ; CL += CI . y * texture2D ( CE , CM . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"CN = texture2D ( CG , CM . xy ) ; CJ = 2.0 * s ( CN ) - 1.0 ; CK = CI . x * CJ ; CN = texture2D ( CG , CM . zw ) ; CJ = 2.0 * s ( CN ) - 1.0 ; CK += CI . y * CJ ; CL . a = sqrt ( 2.0 * length ( CK ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","CL",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 CY ( vec2 CP , sampler2D CQ , sampler2D CR".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","CS"]}]}}]},{type:"textline",b:") { float CT ; vec2 CU ; vec4 CV , CW , CX ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"CV = texture2D ( CS , fd ) ; CU = 2.0 * s ( CV ) - 1.0 ; CV = texture2D ( CQ , CP ) ; CW = texture2D ( CR , CP - CU ) ; CT = abs ( CV . a * CV . a - CW . a * CW . a ) / 2.0 ; CT = 0.5 * clamp ( 1.0 - sqrt ( CT ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; CX = mix ( CV , CW , CT ) ; CX . a = 1.0 ; return CX ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"CV = texture2D ( CQ , CP ) ; CW = texture2D ( CR , CP ) ; return mix ( CV , CW , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:"void main ( ) { vec4 CZ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"CZ = vec4 ( Ay ( fd , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",
a:[{type:"textline",b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"CZ = CC ( fd , zR , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"CZ = CO ( fd , u_color , u_blend".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"CZ = vec4 ( CY ( fd , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"CZ = texture2D ( u_color , fd ) ;".split(" ")}]}}]},{type:"textline",b:["gl_FragColor","=","CZ",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",
b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 fd ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","zN",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 zO ; varying vec4 zP ; varying vec4 zQ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","zR",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD",
"AA_METHOD_SMAA_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void zS ( vec2 zx ) { zO = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + zx . xyxy ; zP = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + zx . xyxy ; zQ = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + zx . xyxy ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void zV ( vec2 zT , out vec2 zU ) { zU = zT / u_texel_size ; zO = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + zT . xyxy ; zP = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + zT . xyxy ; zQ = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( zO . xz , zP . yw ) ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void zX ( vec2 zW ) { zN = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + zW . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { fd = 2.0 * a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["zS","(","fd",")",";"]}]}},{type:"elif",c:["SMAA_PASS",
"SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zV ( fd , zR ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["zX","(","fd",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",
b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},{type:"define",name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 fd ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float zS ( in vec2 zx ) { return zI ( u_depth , zx , u_camera_range ) ; } void main ( ) { vec3 zT , zU , zV ; float zW , zX , zY , zZ , z_ , Aa , Ab ; zW = texture2D ( u_color , fd ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( zW , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"zT = normalize ( 2.0 * texture2D ( u_ssao_special_tex , fd * 0.25 / u_texel_size ) . rgb - 1.0 ) ; zX = zS ( fd ) ; zY = zX * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","SSAO_QUALITY_8",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"const float Ac = 8.0 ; const int Ad = 1 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_16",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float Ac = 16.0 ; const int Ad = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_24",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float Ac = 24.0 ; const int Ad = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_32",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"const float Ac = 32.0 ; const int Ad = 4 ;".split(" ")}]}}]},{type:"textline",b:"zZ = u_ssao_radius_increase * 0.001 ; const float Ae = 1.0 + 2.4 / Ac ; z_ = 0.0 ; for ( int Af = 0 ; Af < Ad ; Af ++ ) for ( int Ag = - 1 ; Ag <= 1 ; Ag += 2 ) for ( int Ah = - 1 ; Ah <= 1 ; Ah += 2 ) for ( int Ai = - 1 ; Ai <= 1 ; Ai += 2 ) { zU = reflect ( normalize ( vec3 ( Ag , Ah , Ai ) ) , zT ) * ( zZ *= Ae ) ; zV = vec3 ( fd , zY ) ; zV += vec3 ( zU . xy , zU . z * zY * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"zV . z -= 1.4 * ( zV . z - zY ) * step ( zY , zV . z ) ;".split(" ")}]}}]},{type:"textline",b:"Aa = zS ( zV . xy ) * ( u_camera_range . y - u_camera_range . x ) ; Ab = clamp ( ( zY - Aa ) / Aa , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"z_ += mix ( 1.0 , Ab , step ( Aa , zV . z ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"z_ += mix ( step ( zV . z , Aa ) , 0.5 , Ab ) ;".split(" ")}]}}]},{type:"textline",b:"} z_ = z_ / Ac ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"z_ = clamp ( z_ * z_ + 0.6 * z_ , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"z_ = clamp ( z_ * z_ + z_ , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"zX = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * zX ) ; z_ = mix ( 1.0 , z_ , zX ) ; gl_FragColor = vec4 ( zW , z_ , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 fd ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float zS ( in vec2 zx ) { return zI ( u_depth , zx , u_camera_range ) ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec2 zT , zU ; float zV , zW , zX , zY , zZ , z_ , Aa ; zV = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"zW = zS ( fd ) ; zX = 0.0 ; zY = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},
{type:"textline",b:"zT = vec2 ( - 2.0 ) ; for ( int Ab = 0 ; Ab < 4 ; ++ Ab ) { for ( int Ac = 0 ; Ac < 4 ; ++ Ac ) { zU = ( zT + vec2 ( float ( Ab ) , float ( Ac ) ) ) * u_texel_size ; zZ = texture2D ( u_ssao_mask , fd + zU ) . g ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"z_ = zS ( fd + zU ) ; Aa = 1.0 - clamp ( abs ( z_ - zW ) * zY , 0.0 , 1.0 ) ; zV += zZ * Aa ; zX += Aa ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["zV","+=","zZ",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , fd ) . r , zV / zX , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , fd ) . r , zV / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",
file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 fd ; void main ( ) { vec2 zx ; vec4 zS , zT ; float zU ; zU = texture2D ( u_depth , fd ) . x ; zS = vec4 ( fd * 2.0 - 1.0 , 2.0 * zU - 1.0 , 1.0 ) ; zT = u_view_proj_inverse * zS ; zT = zT / zT . w ; zT = u_view_proj_prev * zT ; zT /= zT . w ; zx = ( zS . xy - zT . xy ) / 4.0 + 0.5 ; zx = clamp ( zx , 0.0 , 1.0 ) ; gl_FragColor = g ( zx ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",
b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"NO_SHADOWS",b:["1"]},{type:"define",name:"SHADOW_CASTING",b:["2"]},{type:"define",name:"SHADOW_MASK_GENERATION",b:["3"]},{type:"define",name:"SHADOW_MAPPING_OPAQUE",b:["4"]},{type:"define",name:"SHADOW_MAPPING_BLEND",b:["5"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",
name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"SPECULAR_BLINN",b:["4"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"DIFFUSE_MINNAERT",b:["4"]},{type:"define",name:"DIFFUSE_TOON",b:["5"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",
b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]},{type:"define",name:"MIX",b:["0"]},{type:"define",name:"ADD",b:["1"]},{type:"define",name:"SUBTRACT",b:["2"]},{type:"define",name:"MULTIPLY",b:["3"]},{type:"define",name:"SCREEN",b:["4"]},{type:"define",name:"OVERLAY",b:["5"]},{type:"define",name:"DIFFERENCE",b:["6"]},{type:"define",name:"DIVIDE",b:["7"]},{type:"define",name:"DARKEN",b:["8"]},{type:"define",name:"LIGHTEN",b:["9"]},{type:"define",name:"HUE",b:["10"]},{type:"define",name:"SATURATION",
b:["11"]},{type:"define",name:"VALUE",b:["12"]},{type:"define",name:"COLOR",b:["13"]},{type:"define",name:"SOFT_LIGHT",b:["14"]},{type:"define",name:"LINEAR_LIGHT",b:["15"]},{type:"define",name:"REFL_NONE",b:["0"]},{type:"define",name:"REFL_MIRRORMAP",b:["1"]},{type:"define",name:"REFL_PLANE",b:["2"]},{type:"define",name:"REFL_CUBE",b:["3"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float a = 255.0 ; float b = 0.0 ; float c = 1.0 ; vec4 g ( const in float d ) { vec4 e , f ; e = vec4 ( a * a * a , a * a , a , c ) ; f = vec4 ( b , c / a , c / a , c / a ) ; e = fract ( d * e ) ; e -= e . xxyz * f ; return e ; } float k ( const in vec4 h ) { vec4 i ; float j ; i = vec4 ( c / ( a * a * a ) , c / ( a * a ) , c / a , c ) ; j = dot ( h , i ) ; return j ; } vec4 g ( const in vec2 l ) { vec4 m ; vec2 n , o ; n = vec2 ( a , c ) ; o = vec2 ( b , c / a ) ; m = fract ( l . xxyy * n . xyxy ) ; m -= m . xxzz * o . xyxy ; if ( l . r == c ) m . rg = vec2 ( b , c ) ; if ( l . g == c ) m . ba = vec2 ( b , c ) ; return m ; } vec2 s ( const in vec4 p ) { vec2 q , r ; r = vec2 ( c / a , c ) ; q . r = dot ( p . rg , r ) ; q . g = dot ( p . ba , r ) ; return q ; }".split(" ")}]};
a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void x ( inout vec3 t , in float u , in vec4 v ) { float w ; w = v . w * u ; w = exp ( - w * w ) ; w = clamp ( w , 0.0 , 1.0 ) ; t = mix ( v . rgb , t , w ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 D ( in mat4 y , in vec3 z ) { vec3 A , B , C ; A = mix ( y [ 0 ] . rgb , y [ 1 ] . rgb , max ( sign ( z . x ) , 0.0 ) ) ; B = mix ( y [ 2 ] . rgb , y [ 3 ] . rgb , max ( sign ( z . z ) , 0.0 ) ) ; C = vec3 ( y [ 0 ] . a , y [ 1 ] . a , y [ 2 ] . a ) ; B = mix ( A , B , abs ( z . z ) ) ; B = mix ( B , C , abs ( z . y ) ) ; return B ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void F ( inout float E ) { E -= 0.5 ; E = 4.0 * ( E * E * E ) + 0.5 ; } void U ( inout vec3 G , in float H , in vec3 I , in float J , in vec4 L , in vec4 M , in float N , in float O ) { vec3 P , Q ; float R , S , T ; R = M . w * H ; R = exp ( - R * R ) ; R = clamp ( R , 0.0 , 1.0 ) ; S = max ( I . y , 0.0 ) ; H = max ( H - max ( J / S , 0.0 ) , 0.0 ) ; T = L . w * H ; T = 1.0 - T ; T = max ( T , 0.0 ) ; F ( T ) ; T += max ( N - 0.5 , 0.0 ) ; if ( T < R ) { P = vec3 ( 0.0 , 0.02 , 0.05 ) ; Q = L . rgb ; J = clamp ( - J * 0.03 , 0.0 , 0.8 ) ; P = mix ( Q , P , min ( S , 1.0 ) ) ; P = mix ( P , vec3 ( 0.0 ) , J ) * O ; G = mix ( P , G , T ) ; } if ( T >= R ) { G = mix ( M . rgb , G , R ) ; } } void ab ( inout vec3 V , in float W , in float X , in vec4 Y , in float Z ) { vec3 _ ; float aa ; aa = Y . w * W ; aa = 1.0 - aa ; aa = clamp ( aa , 0.0 , 1.0 ) ; F ( aa ) ; X = clamp ( - X * 0.03 , 0.0 , 0.8 ) ; _ = mix ( Y . rgb , vec3 ( 0.0 ) , X ) * Z ; V = mix ( _ , V , aa ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",
b:"float ac = 0.0 ; float ad = 1.0 ; float ae = 0.5 ; struct af { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","SPECULAR_PHONG",{type:"equal_expr",d:2},"SPECULAR_SHADER","SPECULAR_COOKTORR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float an ( vec3 ag , vec3 ah , vec3 ai , float aj , float ak ) { float al ; vec3 am ; am = normalize ( ag + ah ) ; al = ( ad - aj ) * max ( dot ( ai , am ) , ac ) + aj ; return pow ( al , ak ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","SPECULAR_WARDISO",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float ax ( vec3 ao , vec3 ap , vec3 aq , float ar ) { float as , at , au , av ; vec3 aw ; aw = normalize ( ao + ap ) ; as = max ( dot ( aq , aw ) , 0.001 ) ; at = max ( dot ( aq , ap ) , 0.01 ) ; au = max ( dot ( aq , ao ) , 0.01 ) ; as = tan ( acos ( as ) ) ; av = max ( ar , 0.001 ) ; return au * ( ad / ( 4.0 * M_PI * av * av ) ) * ( exp ( - ( as * as ) / ( av * av ) ) / ( sqrt ( at * au ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","SPECULAR_TOON",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float aF ( vec3 ay , vec3 az , vec3 aA , float aB , float aC ) { float aD ; vec3 aE ; aE = normalize ( ay + az ) ; aD = acos ( dot ( aE , aA ) ) ; if ( aD < aB ) return ad ; else if ( aD >= aB + aC || aC == ac ) return ac ; else return ad - ( aD - aB ) / aC ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","SPECULAR_BLINN",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"float aS ( vec3 aG , vec3 aH , vec3 aI , float aJ , float aK , float aL ) { float aM , aN , aO , aP , aQ ; vec3 aR ; if ( aJ < 1.0 || aK == ac ) return ac ; else { if ( aK < 100.0 ) aK = sqrt ( 1.0 / aK ) ; else aK = 10.0 / aK ; aR = normalize ( aH + aG ) ; aM = ( ad - aL ) * max ( dot ( aI , aR ) , ac ) + aL ; if ( aM < ac ) return ac ; else { aN = max ( dot ( aI , aH ) , 0.01 ) ; aO = dot ( aI , aG ) ; if ( aO <= 0.01 ) return ac ; else { aP = max ( dot ( aH , aR ) , 0.01 ) ; aQ = ad ; aN = ( 2.0 * aM * aN ) / aP ; aO = ( 2.0 * aM * aO ) / aP ; aO = min ( min ( aQ , aN ) , aO ) ; aN = sqrt ( pow ( aJ , 2.0 ) + pow ( aP , 2.0 ) - ad ) ; aP = pow ( aN - aP , 2.0 ) / pow ( aN + aP , 2.0 ) * ( ad + pow ( aP * ( aN + aP ) - ad , 2.0 ) / pow ( aP * ( aN - aP ) + ad , 2.0 ) ) ; aM = acos ( aM ) ; return max ( aP * aO * exp ( - pow ( aM , 2.0 ) / ( 2.0 * pow ( aK , 2.0 ) ) ) , ac ) ; } } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float bf ( float aT , vec3 aU , vec3 aV , vec3 aW , float aX ) { vec3 aY , aZ ; float a_ , ba , bb , bc , bd , be ; if ( aX > ac ) { a_ = max ( dot ( aU , aW ) , ac ) ; ba = aX * aX ; bb = ad - ae * ( ba / ( ba + 0.33 ) ) ; aY = aV - aT * aU ; aZ = aW - a_ * aU ; if ( length ( aY ) == ac || length ( aZ ) == ac || abs ( aT ) > ad || abs ( a_ ) > ad ) return aT * bb ; else { bc = acos ( aT ) ; a_ = acos ( a_ ) ; aY = normalize ( aY ) ; aZ = normalize ( aZ ) ; bd = max ( bc , a_ ) ; be = min ( bc , a_ ) ; be *= 0.95 ; a_ = max ( dot ( aY , aZ ) , ac ) ; ba = 0.45 * ( ba / ( ba + 0.09 ) ) ; return aT * ( bb + ( ba * a_ * sin ( bd ) * tan ( be ) ) ) ; } } else return aT ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_MINNAERT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float bl ( float bg , vec3 bh , vec3 bi , float bj ) { float bk ; bk = max ( dot ( bh , bi ) , ac ) ; if ( bj <= ad ) return bg * pow ( max ( bk * bg , 0.1 ) , bj - ad ) ; else return bg * pow ( 1.0001 - bk , bj - ad ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_TOON",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"float bq ( float bm , float bn , float bo ) { float bp ; bp = acos ( bm ) ; if ( bp < bn ) return ad ; else if ( bp > ( bn + bo ) || bo == ac ) return ac ; else return ad - ( ( bp - bn ) / bo ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_FRESNEL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float bv ( float br , float bs , float bt ) { float bu ; if ( bs == ac ) { return ad ; } else { bu = ad + abs ( br ) ; bu = bt + ( ad - bt ) * pow ( bu , bs ) ; return clamp ( bu , ac , ad ) ; } }".split(" ")}]}}]},
{type:"textline",b:"void bD ( vec3 bw , vec3 bx , vec3 by , vec2 bz , const float bA , out float bB ) { float bC ; bC = ( ad - bA ) * dot ( bw , bx ) + bA ; bB = bC ; if ( bA == ae ) return ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_FRESNEL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bB = bv ( bC , bz [ 0 ] , bz [ 1 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bB = bf ( bC , bw , bx , by , bz [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_MINNAERT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bB = bl ( bC , bw , by , bz [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_TOON",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bB = bq ( bC , bz [ 0 ] , bz [ 1 ] ) ;".split(" ")}]}}]},
{type:"textline",b:"bB = max ( bB , ac ) ;".split(" ")}]}}]},{type:"textline",b:"} void bK ( vec3 bE , vec3 bF , vec3 bG , float bH , vec2 bI , out float bJ ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","SPECULAR_PHONG",{type:"equal_expr",d:2},"SPECULAR_SHADER","SPECULAR_COOKTORR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bJ = an ( bE , bF , bG , bH , bI [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","SPECULAR_WARDISO",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bJ = ax ( bE , bF , bG , bI [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","SPECULAR_TOON",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bJ = aF ( bE , bF , bG , bI [ 0 ] , bI [ 1 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","SPECULAR_BLINN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bJ = aS ( bE , bF , bG , bI [ 0 ] , bI [ 1 ] , bH ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["bJ","=","ac",";"]}]}}]},{type:"textline",b:"} void cf ( vec3 bL , vec3 bM , vec3 bN , vec2 bO , vec4 bP , vec3 bQ , vec3 bR , vec3 bS , inout af bT , float bU , vec2 bV , vec2 bW , float bX ) { float bY , bZ , b_ , ca , cb , cc , cd , ce ; bY = ac ; if ( bO . r != ac ) bD ( bN , bM , bL , bV , bX , bY ) ; bZ = ac ; if ( bO . g != ac ) bK ( bM , bL , bN , bX , bW , bZ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_TRANSLUCENCY"],group:{type:"group",
a:[{type:"textline",b:"if ( dot ( bM , bN ) * dot ( bL , bN ) < ac ) { b_ = bP . x ; ca = bP . y ; cb = bP . z ; cc = bP . w ; cd = clamp ( abs ( dot ( bM , bN ) ) , ac , ad ) ; ce = clamp ( dot ( bL , - bM ) , ac , ad ) ; ca = pow ( ce , ca ) ; bT . a += bU * vec4 ( bS * cd * pow ( bQ , vec3 ( b_ ) ) , ad ) ; bT . a += cb * mix ( vec4 ( bQ , ad ) , vec4 ( ad ) , cc ) * bU * vec4 ( bS * cd * vec3 ( ca ) , ad ) ; } else { bT . b += bS * bR * bZ ; bT . a += vec4 ( bS * bQ * bY , bZ ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"bT . b += bS * bR * bZ ; bT . a += vec4 ( bS * bQ * bY , bZ ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"lamp",name:"POINT",g:[{type:"textline",b:"cI = ct [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; cA = cq [ LAMP_IND ] ; cB = cs [ LAMP_IND ] ; cw = ac ;".split(" ")},{type:"textline",b:"cB = cB ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) cB *= cp ; cA = cA - ck ;".split(" ")},{type:"textline",b:"cx = length ( cA ) ; cB *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + cx * cx ) ; cA = normalize ( cA ) ; cf ( cm , cA , cl , cI , cv , ci , cj , cB , cM , cu , co , cn , cw ) ;".split(" ")}]},
{type:"lamp",name:"SPOT",g:[{type:"textline",b:"cJ = ct [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; cC = cq [ LAMP_IND ] ; cD = cs [ LAMP_IND ] ; cE = cr [ LAMP_IND ] ; cx = ac ;".split(" ")},{type:"textline",b:"cD = cD ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) cD *= cp ; cC = cC - ck ;".split(" ")},{type:"textline",b:"cy = length ( cC ) ; cD *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + cy * cy ) ; cC = normalize ( cC ) ;".split(" ")},{type:"textline",b:"cy = dot ( cC , cE ) ; cy *= smoothstep ( ac , ad , ( cy - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; cD *= cy ; cf ( cm , cC , cl , cJ , cv , ci , cj , cD , cM , cu , co , cn , cx ) ;".split(" ")}]},
{type:"lamp",name:"SUN",g:[{type:"textline",b:"cK = ct [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; cE = cs [ LAMP_IND ] ; cF = cr [ LAMP_IND ] ; cy = ac ;".split(" ")},{type:"textline",b:"cE = cE ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) cE *= cp ; cf ( cm , cF , cl , cK , cv , ci , cj , cE , cM , cu , co , cn , cy ) ;".split(" ")}]},{type:"lamp",name:"HEMI",g:[{type:"textline",b:"cL = ct [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; cG = cs [ LAMP_IND ] ; cH = cr [ LAMP_IND ] ; cz = ae ;".split(" ")},
{type:"textline",b:"cG = cG ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) cG *= cp ; cf ( cm , cH , cl , cL , cv , ci , cj , cG , cM , cu , co , cn , cz ) ;".split(" ")}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"af cN ( vec3 cg , vec3 ch , vec3 ci , vec3 cj , vec3 ck , vec3 cl , vec3 cm , vec2 cn , vec2 co , float cp , vec3 cq [ NUM_LIGHTS ] , vec3 cr [ NUM_LIGHTS ] , vec3 cs [ NUM_LIGHTS ] , vec4 ct [ NUM_LFACTORS ] , float cu , vec4 cv ) { float cw , cx , cy , cz ; vec3 cA , cB , cC , cD , cE , cF , cG , cH ; vec2 cI , cJ , cK , cL ; af cM ; cM . a = vec4 ( cg + ci * ch , ac ) ; cM . b = vec3 ( ac ) ;".split(" ")},
{type:"lamps_main"},{type:"textline",b:["return","cM",";","}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"af cS ( vec3 cO , vec3 cP , vec3 cQ ) { af cR ; cR . a = vec4 ( cO + cQ * cP , ac ) ; cR . b = vec3 ( ac ) ; return cR ; }".split(" ")}]}}]}]};a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float cT = 0.0 ; float cU = 1.0 ; vec4 cW ( vec4 cV ) { return cV - floor ( cV * ( cU / 289.0 ) ) * 289.0 ; } vec3 cW ( vec3 cX ) { return cX - floor ( cX * ( cU / 289.0 ) ) * 289.0 ; } vec2 cW ( vec2 cY ) { return cY - floor ( cY * ( cU / 289.0 ) ) * 289.0 ; } vec4 c_ ( vec4 cZ ) { return cZ - floor ( cZ * ( cU / 7.0 ) ) * 7.0 ; } vec4 db ( vec4 da ) { return cW ( ( 34.0 * da + 5.0 ) * da ) ; }".split(" ")},
{type:"define",name:"K",b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 dj ( vec2 dc ) { vec4 dd , de , df , dg ; vec2 dh , di ; dh = cW ( floor ( dc ) ) ; di = fract ( dc ) ; dd = di . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; de = di . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; df = db ( dh . x + vec4 ( cT , cU , cT , cU ) ) ; df = db ( df + dh . y + vec4 ( cT , cT , cU , cU ) ) ; dg = c_ ( df ) * K + K2 ; df = c_ ( floor ( df * K ) ) * K + K2 ; dg = dd + JITTER * dg ; df = de + JITTER * df ; df = dg * dg + df * df ;".split(" ")},
{type:"condition",a:[{type:"if",c:[1],group:{type:"group",a:[{type:"textline",b:"df . xy = min ( df . xy , df . zw ) ; df . x = min ( df . x , df . y ) ; return df . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"df . xy = ( df . x < df . y ) ? df . xy : df . yx ; df . xz = ( df . x < df . z ) ? df . xz : df . zx ; df . xw = ( df . x < df . w ) ? df . xw : df . wx ; df . y = min ( df . y , df . z ) ; df . y = min ( df . y , df . w ) ; return sqrt ( df . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 dt ( vec2 dk , float dl ) { vec4 dm , dn , dp , dq ; vec2 dr , ds ; dr = cW ( floor ( dk ) ) ; ds = fract ( dk ) ; dm = ds . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; dn = ds . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; dp = db ( dr . x + vec4 ( cT , cU , cT , cU ) ) ; dp = db ( dp + dr . y + vec4 ( cT , cT , cU , cU ) ) ; dq = c_ ( dp ) * K + K2 ; dp = c_ ( floor ( dp * K ) ) * K + K2 ; dq = dm + JITTER * dq ; dp = dn + JITTER * dp ; dn = dq * dq + dp * dp ; dq += dl ; dp += dl ; dm = dq * dq + dp * dp ; dq += dl ; dp += dl ; dp = dq * dq + dp * dp ; dn . xy = min ( dn . xy , dn . zw ) ; dn . x = min ( dn . x , dn . y ) ; dm . xy = min ( dm . xy , dm . zw ) ; dm . x = min ( dm . x , dm . y ) ; dp . xy = min ( dp . xy , dp . zw ) ; dp . x = min ( dp . x , dp . y ) ; return vec3 ( dn . x , dm . x , dp . x ) ; } vec3 dv ( vec3 du ) { return cW ( ( ( du * 34.0 ) + cU ) * du ) ; } float dG ( vec2 dw ) { vec3 dx , dy , dz , dA ; vec4 dB ; vec2 dC , dD , dE ; const vec4 dF = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; dC = floor ( dw + dot ( dw , dF . yy ) ) ; dD = dw - dC + dot ( dC , dF . xx ) ; dE = ( dD . x > dD . y ) ? vec2 ( cU , cT ) : vec2 ( cT , cU ) ; dB = dD . xyxy + dF . xxzz ; dB . xy -= dE ; dC = cW ( dC ) ; dx = dv ( dv ( dC . y + vec3 ( cT , dE . y , cU ) ) + dC . x + vec3 ( cT , dE . x , cU ) ) ; dy = max ( 0.5 - vec3 ( dot ( dD , dD ) , dot ( dB . xy , dB . xy ) , dot ( dB . zw , dB . zw ) ) , cT ) ; dy = dy * dy ; dy = dy * dy ; dx = 2.0 * fract ( dx * dF . www ) - cU ; dz = abs ( dx ) - 0.5 ; dA = floor ( dx + 0.5 ) ; dA = dx - dA ; dy *= 1.79284291400159 - 0.85373472095314 * ( dA * dA + dz * dz ) ; dx . x = dA . x * dD . x + dz . x * dD . y ; dx . yz = dA . yz * dB . xz + dz . yz * dB . yw ; return 130.0 * dot ( dy , dx ) ; } vec2 dK ( vec2 dH ) { float dI , dJ ; dI = dot ( dH , vec2 ( 12.9898 , 78.233 ) ) ; dJ = dot ( dH , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; dI = fract ( sin ( dI ) * 43758.5453 ) * 2.0 - cU ; dJ = fract ( sin ( dJ ) * 43758.5453 ) * 2.0 - cU ; return vec2 ( dI , dJ ) ; }".split(" ")}]};
a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void eb ( inout vec3 dL , float dM , float dN , float dO , vec3 dP , vec3 dQ , vec3 dR , vec4 dS , vec3 dT , float dU ) { float dV , dW , dX ; vec2 dY , dZ ; vec3 d_ ; vec4 ea ; if ( dU > CAUSTICS_VIEW_DISTANCE ) return ; ea = dS ; d_ = dT + dP ; d_ . xz = 10.0 * sin ( 0.1 * d_ . xz ) ; d_ = d_ + 2.0 * cross ( - ea . xyz , cross ( - ea . xyz , d_ ) + ea . w * d_ ) ; dY = d_ . xz ; d_ = dQ ; dV = max ( dot ( dP , d_ ) , 0.0 ) ; dW = 0.025 ; dZ = CAUST_SPEED * dN ; dY . s += 0.25 * sin ( dot ( dT + dN , vec3 ( 1.0 ) ) ) ; dY . t += 0.35 * ( - sin ( dot ( dT - dN , vec3 ( - 0.7 ) ) ) ) ; dY . st += 0.15 * cos ( 4.0 * dM - dZ . x ) + 1.5 * sin ( dM - 0.3 * dZ . y ) ; dX = CAUST_SCALE * ( 1.0 + max ( 0.1 * dM , 0.0 ) ) ; d_ = dt ( ( dY / dX ) , dW ) ; d_ *= CAUST_BRIGHT ; d_ *= d_ ; dW = min ( 0.25 * dM , - dM ) + 1.0 ; dW = max ( dW , 0.0 ) ; dV = dO * dV ; dX = max ( sign ( dM ) , 0.0 ) ; dV = dV + max ( 0.5 * sign ( - dP . y ) * dX , 0.0 ) ; dV = min ( dV , 1.0 ) ; dL += dR * d_ * dW * dV ; }".split(" ")}]};
a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void ed ( inout vec3 ec ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"ec = max ( vec3 ( 0.0 ) , ec ) ; ec = pow ( ec , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void ef ( inout vec3 ee ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"ee = max ( vec3 ( 0.0 ) , ee ) ; ee = pow ( ee , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void ei ( inout vec3 eg , in float eh ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"eg = eg * eh ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float ej = 0.0 ; float ek = 1.0 ; struct el { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool eo ( vec3 em , vec3 en ) { return any ( lessThan ( abs ( em - en ) , vec3 ( EPSILON ) ) ) ; } vec3 er ( in vec4 ep , in vec3 eq ) { return eq + 2.0 * cross ( ep . xyz , cross ( ep . xyz , eq ) + ep . w * eq ) ; } vec4 et ( in vec4 es ) { return vec4 ( - es . xyz , es . w ) / dot ( es , es ) ; } vec3 ey ( vec4 eu , vec4 ev , vec4 ew ) { vec3 ex ; ex = ew . xyz * eu . w ; ex = er ( ev , ex ) ; ex += eu . xyz * ew . w ; return ex ; } vec3 eE ( vec4 ez , vec4 eA , vec4 eB ) { vec4 eC ; vec3 eD ; eD = eB . xyz - ez . xyz * eB . w ; eC = et ( eA ) ; eD = er ( eC , eD ) ; eD /= ez . w ; return eD ; } mat4 eF ( ) { return mat4 ( ek , ej , ej , ej , ej , ek , ej , ej , ej , ej , ek , ej , ej , ej , ej , ek ) ; } mat4 eH ( float eG ) { return mat4 ( ek , ej , ej , ej , ej , cos ( eG ) , sin ( eG ) , ej , ej , - sin ( eG ) , cos ( eG ) , ej , ej , ej , ej , ek ) ; } mat4 eJ ( float eI ) { return mat4 ( cos ( eI ) , ej , - sin ( eI ) , ej , ej , ek , ej , ej , sin ( eI ) , ej , cos ( eI ) , ej , ej , ej , ej , ek ) ; } mat4 eL ( float eK ) { return mat4 ( cos ( eK ) , sin ( eK ) , ej , ej , - sin ( eK ) , cos ( eK ) , ej , ej , ej , ej , ek , ej , ej , ej , ej , ek ) ; } el eN ( in el eM ) { return el ( eM . a , eM . b , normalize ( eM . c ) , normalize ( eM . d ) , normalize ( eM . e ) , eM . f ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"vec3 eT ( vec4 eO ) { vec3 eP ; float eQ , eR , eS ; eQ = eO . x ; eR = eO . y ; eS = eO . w ; eP . x = ( eQ + eS ) / 2.0 ; eP . y = ( eR + eS ) / 2.0 ; eP . z = eS ; return eP ; }".split(" ")}]}}]}]};a["include/shadow.glslf"]={type:"group",
a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["vec4","fe",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",
d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float ff = 0.1 ; const float fg = 0.1 ; const float fh = - 0.01 ; const float fi = 0.05 ; vec4 fj = vec4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 ) ; vec4 fk = vec4 ( 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 ) ; vec4 fl = vec4 ( - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 ) ; vec4 fm = vec4 ( - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; vec4 fn = vec4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 ) ; vec4 fo = vec4 ( - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 ) ; vec4 fp = vec4 ( - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 ) ; vec4 fq = vec4 ( - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ; bool ft ( vec2 fr , float fs ) { return all ( lessThanEqual ( fr , vec2 ( 1.0 + fs ) ) ) && all ( greaterThanEqual ( fr , vec2 ( 0.0 - fs ) ) ) ; } float fC ( float fu , float fv , mat2 fw , vec3 fx , float fy , PRECISION sampler2D fz ) { vec2 fA , fB ; fB . x = fu ; fB . y = fv ; fB = fw * fB ; fA = fx . xy + fB * fy / SHADOW_TEX_RES ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"if ( ! ft ( fA , fh ) ) return 1.0 ; else".split(" ")}]}}]},{type:"textline",b:"return step ( fx . z , texture2D ( fz , fA ) . r ) ; } void fQ ( inout float fD , inout float fE , float fF , float fG , mat2 fH , vec3 fI , vec3 fJ , float fK , float fL , PRECISION sampler2D fM , PRECISION sampler2D fN ) { vec2 fO , fP ; fP . x = fF ; fP . y = fG ; fP = fH * fP ; fO = fI . xy + fP * fK / SHADOW_TEX_RES ; fD += step ( fI . z , texture2D ( fM , fO ) . r ) ; fO = fJ . xy + fP * fL / SHADOW_TEX_RES ; fE += step ( fJ . z , texture2D ( fN , fO ) . r ) ; } float fZ ( vec3 fR , PRECISION sampler2D fS , float fT ) { mat2 fU ; float fV , fW , fX ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:"if ( fR . z > u_perspective_cast_far_bound ) return 1.0 ; else {".split(" ")}]}}]},{type:"textline",b:"fR . z = clamp ( fR . z , 0.0 , 1.0 ) ; fV = 0.0 ; fW = dK ( fR . xy ) . x * M_PI ; fX = cos ( fW ) ; fW = sin ( fW ) ; fU = mat2 ( fX , fW , - fW , fX ) ; for ( int fY = 0 ; fY < 4 ; fY ++ ) { fV += fC ( fj [ fY ] , fn [ fY ] , fU , fR , fT , fS ) ; fV += fC ( fk [ fY ] , fo [ fY ] , fU , fR , fT , fS ) ; fV += fC ( fl [ fY ] , fp [ fY ] , fU , fR , fT , fS ) ; fV += fC ( fm [ fY ] , fq [ fY ] , fU , fR , fT , fS ) ; } fV /= 16.0 ; return clamp ( fV , 0.0 , 1.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["}"]}]}}]},{type:"textline",b:"return 1.0 ; } float gm ( vec3 f_ , PRECISION sampler2D ga , vec3 gb , PRECISION sampler2D gc , float gd , float ge , float gf ) { mat2 gg ; float gh , gi , gj , gk ; f_ . z = clamp ( f_ . z , 0.0 , 1.0 ) ; gb . z = clamp ( gb . z , 0.0 , 1.0 ) ; gh = 0.0 ; gi = 0.0 ; gj = dK ( f_ . xy ) . x * M_PI ; gk = cos ( gj ) ; gj = sin ( gj ) ; gg = mat2 ( gk , gj , - gj , gk ) ; for ( int gl = 0 ; gl < 4 ; gl ++ ) { fQ ( gh , gi , fj [ gl ] , fn [ gl ] , gg , f_ , gb , gd , ge , ga , gc ) ; fQ ( gh , gi , fk [ gl ] , fo [ gl ] , gg , f_ , gb , gd , ge , ga , gc ) ; fQ ( gh , gi , fl [ gl ] , fp [ gl ] , gg , f_ , gb , gd , ge , ga , gc ) ; fQ ( gh , gi , fm [ gl ] , fq [ gl ] , gg , f_ , gb , gd , ge , ga , gc ) ; } gh = mix ( gh , gi , gf ) ; gh /= 16.0 ; return clamp ( gh , 0.0 , 1.0 ) ; } float gq ( vec2 gn ) { float go , gp ; go = min ( gn . x , gn . y ) ; gp = min ( 1.0 - gn . x , 1.0 - gn . y ) ; return min ( go , gp ) ; } float gt ( float gr , float gs ) { if ( gs >= 0.0 && gs <= fg ) gr = ( gr - 1.0 ) / fg * gs + 1.0 ; return gr ; } float gE ( vec3 gu , vec3 gv , PRECISION sampler2D gw , PRECISION sampler2D gx , float gy , float gz , float gA , float gB ) { float gC , gD ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"gD = gq ( gu . xy ) ; if ( - gB > gA && gD >= 0.0 && gD <= ff && ft ( gv . xy , 0.0 ) ) { gD = 1.0 - gD / ff ; gC = gm ( gu , gw , gv , gx , gy , gz , gD ) ; } else".split(" ")}]}}]},{type:"textline",b:"gC = fZ ( gu , gw , gy ) ; return gC ; } float gM ( vec3 gF , PRECISION sampler2D gG , float gH , float gI , float gJ ) { float gK , gL ; gK = fZ ( gF , gG , gH ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - gJ > gI ) { gL = gq ( gF . xy ) ; gK = gt ( gK , gL ) ; }".split(" ")}]}}]},{type:"textline",b:"return gK ; } float gT ( float gN ) { vec3 gO , gP , gQ , gR ; float gS ; gS = 1.0 ; gO = e_ . xyz / e_ . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"gP = fa . xyz / fa . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:"gQ = fb . xyz / fb . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"gR = fc . xyz / fc . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ft ( gO . xy , 0.0 ) ) { gS = gE ( gO , gP , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , gN ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( ft ( gO . xy , fi ) ) { gS = gM ( gO , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , gN ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( ft ( gP . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"gS = gE ( gP , gQ , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , gN ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gS = gM ( gP , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , gN ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( ft ( gQ . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"gS = gE ( gQ , gR , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , gN ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gS = gM ( gQ , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , gN ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( ft ( gR . xy , 0.0 ) ) gS = gM ( gR , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , gN ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","gS",";","}"]}]}}]},{type:"textline",b:"float gY ( inout vec3 gU ) { float gV ; vec3 gW ; vec2 gX ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gX = texture2DProj ( u_shadow_mask , eY ) . rg ; gW = vec3 ( gX . r ) ; gV = gX . g ; fe = vec4 ( gW , gV ) ; gU *= fe . a ; return fe . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},
"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return gT ( eV . z ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_MIRRORMAP",
{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float he ( in vec3 gZ , vec3 g_ , float ha , float hb ) { float hc ; vec3 hd ; hd = normalize ( g_ + gZ ) ; hc = 1.0 - dot ( gZ , hd ) ; hc = hb + ( 1.0 - hb ) * pow ( hc , ha ) ; return hc ; } void hr ( inout vec3 hf , vec3 hg , vec3 hh , float hi ) { vec2 hj , hk ; float hl , hm , hn ; vec3 ho , hp , hq ; ho = reflect ( - hg , hh ) ; hl = u_fresnel_params [ 2 ] ; hm = u_fresnel_params [ 3 ] ; hn = 1.0 ; if ( hl != 0.0 ) hn = he ( hg , ho , hl , hm ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"hp = textureCube ( u_cube_reflection , ho ) . xyz ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"hq = u_refl_plane . xyz * dot ( hh , u_refl_plane . xyz ) ; hq = hh - hq ; hj = ( u_view_matrix_frag * vec4 ( hq , 0.0 ) ) . xy ; hk = eY . xy / eY . z ; hk += hj * REFL_BUMP ; hp = texture2D ( u_plane_reflection , hk ) . rgb ;".split(" ")}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"hp = textureCube ( u_mirrormap , ho ) . xyz ; hi = u_mirror_factor ;".split(" ")}]}}]},{type:"textline",b:"ed ( hp . rgb ) ; hf = mix ( hf , hp , hi * hn ) ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",a:[{type:"textline",b:"vec3 hu ( vec3 hs ) { float ht ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , hs ) . rgb ;".split(" ")}]}},{type:"elif",c:["SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"ht = 0.5 * hs . y + 0.5 ; return mix ( u_horizon_color , u_zenith_color , ht ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"float hA ( in float hv , inout vec2 hw , in vec2 hx ) { float hy ; vec4 hz ; hz = texture2D ( u_scene_depth , hw ) ; hy = k ( hz ) ; if ( hy < eZ ) { hw = hx ; return hv ; } else { return hy ; } return hv ; }".split(" ")}]}}]},{type:"textline",b:"vec3 hI ( in vec3 hB , in vec2 hC ) { vec3 hD ; float hE ; vec4 hF ; vec2 hG , hH ; hG = hB . xy / hB . z ; hH = hG + hC ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"hF = texture2DProj ( u_scene_depth , hB ) ; hE = k ( hF ) ; hA ( hE , hH , hG ) ;".split(" ")}]}}]},{type:"textline",b:"hD = texture2D ( u_refractmap , hH ) . rgb ; ed ( hD ) ; return hD ; }".split(" ")}]}}]}]};a["include/nodes.glslf"]={type:"group",a:[{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",
b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","hJ",";"]}]}}]},{type:"textline",
b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 hK = vec3 ( ZERO_VALUE_NODES ) ; vec3 hL = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"vec3 hP ( in vec3 hM , in float hN ) { vec3 hO ; hO = hK ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"hO = hI ( eY , hM . xz * hN ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"hO = texture2D ( u_refractmap , eY . xy / eY . z ) . rgb ; ed ( hO ) ;".split(" ")}]}}]},{type:"textline",b:["return","hO",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"vec3 hU ( vec3 hQ ) { float hR , hS ; vec4 hT ; hT = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; hT = mix ( vec4 ( hQ . bg , hT . wz ) , vec4 ( hQ . gb , hT . xy ) , step ( hQ . b , hQ . g ) ) ; hT = mix ( vec4 ( hT . xyw , hQ . r ) , vec4 ( hQ . r , hT . yzx ) , step ( hT . x , hQ . r ) ) ; hR = hT . x - min ( hT . w , hT . y ) ; hS = 1.0e-10 ; return vec3 ( abs ( hT . z + ( hT . w - hT . y ) / ( 6.0 * hR + hS ) ) , hR / ( hT . x + hS ) , hT . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"vec3 hY ( vec3 hV ) { vec3 hW ; vec4 hX ; hX = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; hW = abs ( fract ( vec3 ( hV . r , hV . r , hV . r ) + hX . xyz ) * 6.0 - hX . www ) ; return hV . b * mix ( hX . xxx , clamp ( hW - hX . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , hV . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"vec3 h_ ( vec2 hZ ) { return vec3 ( hZ * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"vec2 ib ( vec3 ia ) { return vec2 ( ia . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},
{type:"node",name:"CAMERA",i:[{type:"node_out",name:"je",qualifier:["vec3"],f:!0},{type:"node_out",name:"jf",qualifier:["float"],f:!0},{type:"node_out",name:"jg",qualifier:["float"],f:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_je"],g:[{type:"textline",b:"je = normalize ( iL . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jf"],g:[{type:"textline",b:"jf = abs ( iL . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jg"],
g:[{type:"textline",b:"jg = length ( iL . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",i:[{type:"node_in",name:"jh",qualifier:["float"],f:!1},{type:"node_in",name:"ji",qualifier:["float"],f:!1},{type:"node_in",name:"jj",qualifier:["float"],f:!1},{type:"node_out",name:"jk",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"jk = vec3 ( jh , ji , jj ) ;".split(" ")}]},{type:"node",name:"COMBHSV",i:[{type:"node_in",name:"jl",qualifier:["float"],f:!1},{type:"node_in",name:"jm",qualifier:["float"],
f:!1},{type:"node_in",name:"jn",qualifier:["float"],f:!1},{type:"node_out",name:"jo",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"jo = hY ( vec3 ( jl , jm , jn ) ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",i:[{type:"node_out",name:"jp",qualifier:["vec3"],f:!1},{type:"node_param",name:"ic",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"jp = h_ ( ic ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_OR",i:[{type:"node_out",name:"jq",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"jq = 2.0 * clamp ( hJ , 0.0 , 1.0 ) - hL ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC",i:[{type:"node_out",name:"jr",qualifier:["vec3"],f:!1},{type:"node_param",name:"id",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["jr","=","id",";"]}]},{type:"node",name:"GEOMETRY_VC1",i:[{type:"node_out",name:"js",qualifier:["float"],f:!1},{type:"node_param",name:"ie",qualifier:["varying","float"]}],g:[{type:"textline",b:["js","=","ie",";"]}]},{type:"node",name:"GEOMETRY_VC2",i:[{type:"node_out",name:"jt",qualifier:["float"],f:!1},{type:"node_out",name:"ju",
qualifier:["float"],f:!1},{type:"node_param",name:"ig",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"jt = ig [ 0 ] ; ju = ig [ 1 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",i:[{type:"node_out",name:"jv",qualifier:["float"],f:!1},{type:"node_out",name:"jw",qualifier:["float"],f:!1},{type:"node_out",name:"jx",qualifier:["float"],f:!1},{type:"node_param",name:"ih",qualifier:["varying","vec3"]}],g:[{type:"textline",b:"jv = ih [ 0 ] ; jw = ih [ 1 ] ; jx = ih [ 2 ] ;".split(" ")}]},{type:"node",
name:"GEOMETRY_NO",i:[{type:"node_out",name:"jy",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["jy","=","iP",";"]}]},{type:"node",name:"GEOMETRY_FB",i:[{type:"node_out",name:"jz",qualifier:["float"],f:!1}],g:[{type:"textline",b:"jz = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VW",i:[{type:"node_out",name:"jA",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["jA","=","it",";"]}]},{type:"node",name:"GEOMETRY_LO",i:[{type:"node_out",name:"jB",
qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"jB [ 0 ] = iL [ 0 ] ; jB [ 1 ] = iL [ 1 ] ; jB [ 2 ] = iL [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_GL",i:[{type:"node_out",name:"jC",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"jC = vec3 ( iO . r , - iO . b , iO . g ) ;".split(" ")}]},{type:"node",name:"NEW_GEOMETRY",i:[{type:"node_out",name:"jD",qualifier:["vec3"],f:!1},{type:"node_out",name:"jE",qualifier:["vec3"],f:!1},{type:"node_out",name:"jF",qualifier:["vec3"],f:!1},{type:"node_out",
name:"jG",qualifier:["vec3"],f:!1},{type:"node_out",name:"jH",qualifier:["vec3"],f:!1},{type:"node_out",name:"jI",qualifier:["vec3"],f:!1},{type:"node_out",name:"jJ",qualifier:["float"],f:!1},{type:"node_out",name:"jK",qualifier:["float"],f:!1}],g:[{type:"textline",b:"jD = hK ; jE = hK ; jF = hK ; jG = hK ; jH = hK ; jI = hK ; jJ = ZERO_VALUE_NODES ; jK = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"HUE_SAT",i:[{type:"node_in",name:"jL",qualifier:["float"],f:!1},{type:"node_in",name:"jM",
qualifier:["float"],f:!1},{type:"node_in",name:"jN",qualifier:["float"],f:!1},{type:"node_in",name:"jO",qualifier:["float"],f:!1},{type:"node_in",name:"jP",qualifier:["vec3"],f:!1},{type:"node_out",name:"jQ",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iQ = hU ( jP ) ; iQ [ 0 ] += ( jL - 0.5 ) ; if ( iQ [ 0 ] > UNITY_VALUE_NODES ) iQ [ 0 ] -= UNITY_VALUE_NODES ; else if ( iQ [ 0 ] < ZERO_VALUE_NODES ) iQ [ 0 ] += UNITY_VALUE_NODES ; iQ *= vec3 ( UNITY_VALUE_NODES , jM , jN ) ; iQ = mix ( hL , mix ( hK , iQ , step ( hK , iQ ) ) , step ( iQ , hL ) ) ; jQ = mix ( jP , hY ( iQ ) , jO ) ;".split(" ")}]},
{type:"node",name:"INVERT",i:[{type:"node_in",name:"jR",qualifier:["float"],f:!1},{type:"node_in",name:"jS",qualifier:["vec3"],f:!1},{type:"node_out",name:"jT",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"jT = mix ( jS , hL - jS , jR ) ;".split(" ")}]},{type:"node",name:"LAMP",i:[{type:"node_out",name:"jU",qualifier:["vec3"],f:!0},{type:"node_out",name:"jV",qualifier:["vec3"],f:!1},{type:"node_out",name:"jW",qualifier:["float"],f:!1},{type:"node_out",name:"jX",qualifier:["float"],f:!0}],g:[{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_jU"],g:[{type:"textline",b:"jU = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",b:"iM = u_lamp_light_factors [ LAMP_INDEX ] ; iR = u_lamp_light_directions [ LAMP_INDEX ] ; iS = u_lamp_light_positions [ LAMP_INDEX ] ; iD = iM . z ; if ( iD != - UNITY_VALUE_NODES ) {".split(" ")},{type:"textline",b:"jV = iS - eU ; jW = length ( jV ) ; jV = normalize ( jV ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jX"],g:[{type:"textline",
b:"jX = iD / ( iD + jW * jW ) ; iD = iM . x ; iE = iM . y ; if ( iD > - UNITY_VALUE_NODES ) { iF = dot ( jV , iR ) ; iF *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( iF - iD ) / iE ) ; jX *= iF ; }".split(" ")}]}]},{type:"textline",b:["}","else","{"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jV"],g:[{type:"textline",b:["jV","=","iR",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jW"],g:[{type:"textline",b:"jW = length ( iS - eU ) ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_jX"],g:[{type:"textline",b:["jX","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"NORMAL",i:[{type:"node_in",name:"jY",qualifier:["vec3"],f:!1},{type:"node_out",name:"jZ",qualifier:["vec3"],f:!0},{type:"node_out",name:"j_",qualifier:["float"],f:!0},{type:"node_param",name:"ii",qualifier:["vec3"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jZ"],g:[{type:"textline",b:["jZ","=","ii",";"]}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_j_"],g:[{type:"textline",b:"j_ = - dot ( jY , ii ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",i:[{type:"node_in",name:"ka",qualifier:["vec3"],f:!1},{type:"node_out",name:"kb",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"kb = - ( u_view_matrix_frag * vec4 ( ka , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"BSDF_ANISOTROPIC",i:[{type:"node_in",name:"kc",qualifier:["vec3"],f:!1},{type:"node_in",name:"kd",qualifier:["float"],f:!1},{type:"node_in",name:"ke",
qualifier:["float"],f:!1},{type:"node_in",name:"kf",qualifier:["float"],f:!1},{type:"node_in",name:"kg",qualifier:["vec3"],f:!1},{type:"node_in",name:"kh",qualifier:["vec3"],f:!1},{type:"node_out",name:"ki",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["ki","=","kc",";"]},{type:"textline",b:"kd ; ke ; kf ; kg ; kh ;".split(" ")}]},{type:"node",name:"BSDF_DIFFUSE",i:[{type:"node_in",name:"kj",qualifier:["vec3"],f:!1},{type:"node_in",name:"kk",qualifier:["float"],f:!1},{type:"node_in",name:"kl",
qualifier:["vec3"],f:!1},{type:"node_out",name:"km",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["km","=","kj",";"]},{type:"textline",b:["kk",";","kl",";"]}]},{type:"node",name:"BSDF_GLASS",i:[{type:"node_in",name:"kn",qualifier:["vec3"],f:!1},{type:"node_in",name:"ko",qualifier:["float"],f:!1},{type:"node_in",name:"kp",qualifier:["float"],f:!1},{type:"node_in",name:"kq",qualifier:["vec3"],f:!1},{type:"node_out",name:"kr",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["kr","=","kn",";"]},{type:"textline",
b:"ko ; kp ; kq ;".split(" ")}]},{type:"node",name:"BSDF_GLOSSY",i:[{type:"node_in",name:"ks",qualifier:["vec3"],f:!1},{type:"node_in",name:"kt",qualifier:["float"],f:!1},{type:"node_in",name:"ku",qualifier:["vec3"],f:!1},{type:"node_out",name:"kv",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["kv","=","ks",";"]},{type:"textline",b:["kt",";","ku",";"]}]},{type:"node",name:"BSDF_HAIR",i:[{type:"node_in",name:"kw",qualifier:["vec3"],f:!1},{type:"node_in",name:"kx",qualifier:["float"],f:!1},{type:"node_in",
name:"ky",qualifier:["float"],f:!1},{type:"node_in",name:"kz",qualifier:["float"],f:!1},{type:"node_out",name:"kA",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["kA","=","kw",";"]},{type:"textline",b:"kx ; ky ; kz ;".split(" ")}]},{type:"node",name:"BSDF_TRANSPARENT",i:[{type:"node_in",name:"kB",qualifier:["vec3"],f:!1},{type:"node_out",name:"kC",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["kC","=","kB",";"]}]},{type:"node",name:"BSDF_TRANSLUCENT",i:[{type:"node_in",name:"kD",qualifier:["vec3"],
f:!1},{type:"node_in",name:"kE",qualifier:["vec3"],f:!1},{type:"node_out",name:"kF",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["kF","=","kD",";"]},{type:"textline",b:["kE",";"]}]},{type:"node",name:"BSDF_REFRACTION",i:[{type:"node_in",name:"kG",qualifier:["vec3"],f:!1},{type:"node_in",name:"kH",qualifier:["float"],f:!1},{type:"node_in",name:"kI",qualifier:["float"],f:!1},{type:"node_in",name:"kJ",qualifier:["vec3"],f:!1},{type:"node_out",name:"kK",qualifier:["vec3"],f:!1}],g:[{type:"textline",
b:"kK [ 0 ] = kK [ 1 ] = kK [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"kG ; kH ; kI ; kJ ;".split(" ")}]},{type:"node",name:"BSDF_TOON",i:[{type:"node_in",name:"kL",qualifier:["vec3"],f:!1},{type:"node_in",name:"kM",qualifier:["float"],f:!1},{type:"node_in",name:"kN",qualifier:["float"],f:!1},{type:"node_in",name:"kO",qualifier:["vec3"],f:!1},{type:"node_out",name:"kP",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["kP","=","kL",";"]},{type:"textline",b:"kM ; kN ; kO ;".split(" ")}]},
{type:"node",name:"BSDF_VELVET",i:[{type:"node_in",name:"kQ",qualifier:["vec3"],f:!1},{type:"node_in",name:"kR",qualifier:["float"],f:!1},{type:"node_in",name:"kS",qualifier:["vec3"],f:!1},{type:"node_out",name:"kT",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["kT","=","kQ",";"]},{type:"textline",b:["kR",";","kS",";"]}]},{type:"node",name:"SUBSURFACE_SCATTERING",i:[{type:"node_in",name:"kU",qualifier:["vec3"],f:!1},{type:"node_in",name:"kV",qualifier:["float"],f:!1},{type:"node_in",name:"kW",
qualifier:["vec3"],f:!1},{type:"node_in",name:"kX",qualifier:["float"],f:!1},{type:"node_in",name:"kY",qualifier:["float"],f:!1},{type:"node_in",name:"kZ",qualifier:["vec3"],f:!1},{type:"node_out",name:"k_",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"k_ [ 0 ] = k_ [ 1 ] = k_ [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"kU ; kW ; kX ; kY ; kZ ; kV ;".split(" ")}]},{type:"node",name:"EMISSION",i:[{type:"node_in",name:"la",qualifier:["vec3"],f:!1},{type:"node_in",name:"lb",qualifier:["float"],
f:!1},{type:"node_out",name:"lc",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["lc","=","la",";"]},{type:"textline",b:["lb",";"]}]},{type:"node",name:"AMBIENT_OCCLUSION",i:[{type:"node_in",name:"ld",qualifier:["vec3"],f:!1},{type:"node_out",name:"le",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"le [ 0 ] = le [ 1 ] = le [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["ld",";"]}]},{type:"node",name:"HOLDOUT",i:[{type:"node_out",name:"lf",qualifier:["vec3"],f:!1}],g:[{type:"textline",
b:"lf [ 0 ] = lf [ 1 ] = lf [ 2 ] = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"VOLUME_ABSORPTION",i:[{type:"node_in",name:"lg",qualifier:["vec3"],f:!1},{type:"node_in",name:"lh",qualifier:["float"],f:!1},{type:"node_out",name:"li",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"li [ 0 ] = li [ 1 ] = li [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["lg",";","lh",";"]}]},{type:"node",name:"VOLUME_SCATTER",i:[{type:"node_in",name:"lj",qualifier:["vec3"],f:!1},{type:"node_in",
name:"lk",qualifier:["float"],f:!1},{type:"node_in",name:"ll",qualifier:["float"],f:!1},{type:"node_out",name:"lm",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"lm [ 0 ] = lm [ 1 ] = lm [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"lj ; lk ; ll ;".split(" ")}]},{type:"node",name:"BUMP",i:[{type:"node_in",name:"ln",qualifier:["float"],f:!1},{type:"node_in",name:"lo",qualifier:["float"],f:!1},{type:"node_in",name:"lp",qualifier:["float"],f:!1},{type:"node_in",name:"lq",qualifier:["vec3"],
f:!1},{type:"node_out",name:"lr",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["lr","=","lq",";"]},{type:"textline",b:"ln ; lo ; lp ;".split(" ")}]},{type:"node",name:"NORMAL_MAP",i:[{type:"node_in",name:"ls",qualifier:["float"],f:!1},{type:"node_in",name:"lt",qualifier:["vec3"],f:!1},{type:"node_out",name:"lu",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["lu","=","lt",";"]},{type:"textline",b:["ls",";"]}]},{type:"node",name:"VECT_TRANSFORM",i:[{type:"node_in",name:"lv",qualifier:["vec3"],
f:!1},{type:"node_out",name:"lw",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"lw [ 0 ] = lw [ 1 ] = lw [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["lv",";"]}]},{type:"node",name:"BLACKBODY",i:[{type:"node_in",name:"lx",qualifier:["float"],f:!1},{type:"node_out",name:"ly",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"ly [ 0 ] = ly [ 1 ] = ly [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["lx",";"]}]},{type:"node",name:"WAVELENGTH",i:[{type:"node_in",name:"lz",qualifier:["float"],
f:!1},{type:"node_out",name:"lA",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"lA [ 0 ] = lA [ 1 ] = lA [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["lz",";"]}]},{type:"node",name:"SEPXYZ",i:[{type:"node_in",name:"lB",qualifier:["vec3"],f:!1},{type:"node_out",name:"lC",qualifier:["float"],f:!1},{type:"node_out",name:"lD",qualifier:["float"],f:!1},{type:"node_out",name:"lE",qualifier:["float"],f:!1}],g:[{type:"textline",b:"lC = lB [ 0 ] ; lD = lB [ 1 ] ; lE = lB [ 2 ] ;".split(" ")}]},
{type:"node",name:"COMBXYZ",i:[{type:"node_in",name:"lF",qualifier:["float"],f:!1},{type:"node_in",name:"lG",qualifier:["float"],f:!1},{type:"node_in",name:"lH",qualifier:["float"],f:!1},{type:"node_out",name:"lI",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"lI [ 0 ] = lF ; lI [ 1 ] = lG ; lI [ 2 ] = lH ;".split(" ")}]},{type:"node",name:"BRIGHTCONTRAST",i:[{type:"node_in",name:"lJ",qualifier:["vec3"],f:!1},{type:"node_in",name:"lK",qualifier:["float"],f:!1},{type:"node_in",name:"lL",qualifier:["float"],
f:!1},{type:"node_out",name:"lM",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iF = lK - lL * 0.5 ; lM = max ( ( UNITY_VALUE_NODES + lL ) * lJ + iF , hK ) ;".split(" ")}]},{type:"node",name:"LIGHT_FALLOFF",i:[{type:"node_in",name:"lN",qualifier:["float"],f:!1},{type:"node_in",name:"lO",qualifier:["float"],f:!1},{type:"node_out",name:"lP",qualifier:["float"],f:!1},{type:"node_out",name:"lQ",qualifier:["float"],f:!1},{type:"node_out",name:"lR",qualifier:["float"],f:!1}],g:[{type:"textline",b:"lP = lQ = lR = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",b:["lN",";","lO",";"]}]},{type:"node",name:"TEX_IMAGE",i:[{type:"node_in",name:"lS",qualifier:["vec3"],f:!1},{type:"node_out",name:"lT",qualifier:["vec3"],f:!1},{type:"node_out",name:"lU",qualifier:["float"],f:!1}],g:[{type:"textline",b:"lT [ 0 ] = lT [ 1 ] = lT [ 2 ] = ZERO_VALUE_NODES ; lU = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["lS",";"]}]},{type:"node",name:"TEX_ENVIRONMENT",i:[{type:"node_in",name:"lV",qualifier:["vec3"],f:!1},{type:"node_out",name:"lW",qualifier:["vec3"],
f:!1}],g:[{type:"textline",b:"lW [ 0 ] = lW [ 1 ] = lW [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["lV",";"]}]},{type:"node",name:"TEX_SKY",i:[{type:"node_in",name:"lX",qualifier:["vec3"],f:!1},{type:"node_out",name:"lY",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"lY [ 0 ] = lY [ 1 ] = lY [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["lX",";"]}]},{type:"node",name:"TEX_NOISE",i:[{type:"node_in",name:"lZ",qualifier:["vec3"],f:!1},{type:"node_in",name:"l_",qualifier:["float"],
f:!1},{type:"node_in",name:"ma",qualifier:["float"],f:!1},{type:"node_in",name:"mb",qualifier:["float"],f:!1},{type:"node_out",name:"mc",qualifier:["vec3"],f:!1},{type:"node_out",name:"md",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mc [ 0 ] = mc [ 1 ] = mc [ 2 ] = ZERO_VALUE_NODES ; md = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"lZ ; l_ ; ma ; mb ;".split(" ")}]},{type:"node",name:"TEX_WAVE",i:[{type:"node_in",name:"me",qualifier:["vec3"],f:!1},{type:"node_in",name:"mf",qualifier:["float"],
f:!1},{type:"node_in",name:"mg",qualifier:["float"],f:!1},{type:"node_in",name:"mh",qualifier:["float"],f:!1},{type:"node_in",name:"mi",qualifier:["float"],f:!1},{type:"node_out",name:"mj",qualifier:["vec3"],f:!1},{type:"node_out",name:"mk",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mj [ 0 ] = mj [ 1 ] = mj [ 2 ] = ZERO_VALUE_NODES ; mk = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"me ; mf ; mg ; mh ; mi ;".split(" ")}]},{type:"node",name:"TEX_VORONOI",i:[{type:"node_in",name:"ml",
qualifier:["vec3"],f:!1},{type:"node_in",name:"mm",qualifier:["float"],f:!1},{type:"node_out",name:"mn",qualifier:["vec3"],f:!1},{type:"node_out",name:"mo",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mn [ 0 ] = mn [ 1 ] = mn [ 2 ] = ZERO_VALUE_NODES ; mo = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["ml",";","mm",";"]}]},{type:"node",name:"TEX_MUSGRAVE",i:[{type:"node_in",name:"mp",qualifier:["vec3"],f:!1},{type:"node_in",name:"mq",qualifier:["float"],f:!1},{type:"node_in",name:"mr",
qualifier:["float"],f:!1},{type:"node_in",name:"ms",qualifier:["float"],f:!1},{type:"node_in",name:"mt",qualifier:["float"],f:!1},{type:"node_in",name:"mu",qualifier:["float"],f:!1},{type:"node_in",name:"mv",qualifier:["float"],f:!1},{type:"node_out",name:"mw",qualifier:["vec3"],f:!1},{type:"node_out",name:"mx",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mw [ 0 ] = mw [ 1 ] = mw [ 2 ] = ZERO_VALUE_NODES ; mx = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"mp ; mq ; mr ; ms ; mt ; mu ; mv ;".split(" ")}]},
{type:"node",name:"TEX_GRADIENT",i:[{type:"node_in",name:"my",qualifier:["vec3"],f:!1},{type:"node_out",name:"mz",qualifier:["vec3"],f:!1},{type:"node_out",name:"mA",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mz [ 0 ] = mz [ 1 ] = mz [ 2 ] = ZERO_VALUE_NODES ; mA = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["my",";"]}]},{type:"node",name:"TEX_MAGIC",i:[{type:"node_in",name:"mB",qualifier:["vec3"],f:!1},{type:"node_in",name:"mC",qualifier:["float"],f:!1},{type:"node_in",name:"mD",
qualifier:["float"],f:!1},{type:"node_out",name:"mE",qualifier:["vec3"],f:!1},{type:"node_out",name:"mF",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mE [ 0 ] = mE [ 1 ] = mE [ 2 ] = ZERO_VALUE_NODES ; mF = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"mB ; mC ; mD ;".split(" ")}]},{type:"node",name:"TEX_CHECKER",i:[{type:"node_in",name:"mG",qualifier:["vec3"],f:!1},{type:"node_in",name:"mH",qualifier:["vec3"],f:!1},{type:"node_in",name:"mI",qualifier:["vec3"],f:!1},{type:"node_in",name:"mJ",
qualifier:["float"],f:!1},{type:"node_out",name:"mK",qualifier:["vec3"],f:!1},{type:"node_out",name:"mL",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mK [ 0 ] = mK [ 1 ] = mK [ 2 ] = ZERO_VALUE_NODES ; mL = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"mG ; mH ; mI ; mJ ;".split(" ")}]},{type:"node",name:"TEX_BRICK",i:[{type:"node_in",name:"mM",qualifier:["vec3"],f:!1},{type:"node_in",name:"mN",qualifier:["vec3"],f:!1},{type:"node_in",name:"mO",qualifier:["vec3"],f:!1},{type:"node_in",
name:"mP",qualifier:["vec3"],f:!1},{type:"node_in",name:"mQ",qualifier:["float"],f:!1},{type:"node_in",name:"mR",qualifier:["float"],f:!1},{type:"node_in",name:"mS",qualifier:["float"],f:!1},{type:"node_in",name:"mT",qualifier:["float"],f:!1},{type:"node_in",name:"mU",qualifier:["float"],f:!1},{type:"node_out",name:"mV",qualifier:["vec3"],f:!1},{type:"node_out",name:"mW",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mV [ 0 ] = mV [ 1 ] = mV [ 2 ] = ZERO_VALUE_NODES ; mW = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",b:"mM ; mN ; mO ; mP ; mQ ; mR ; mS ; mT ; mU ;".split(" ")}]},{type:"node",name:"ADD_SHADER",i:[{type:"node_in",name:"mX",qualifier:["vec3"],f:!1},{type:"node_in",name:"mY",qualifier:["vec3"],f:!1},{type:"node_out",name:"mZ",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"mZ = clamp ( mX + mY , hK , hL ) ;".split(" ")}]},{type:"node",name:"MIX_SHADER",i:[{type:"node_in",name:"m_",qualifier:["float"],f:!1},{type:"node_in",name:"na",qualifier:["vec3"],f:!1},{type:"node_in",name:"nb",
qualifier:["vec3"],f:!1},{type:"node_out",name:"nc",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( m_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nc = iE * na + ( UNITY_VALUE_NODES - iE ) * nb ;".split(" ")}]},{type:"node",name:"UV_MERGED",i:[{type:"node_out",name:"nd",qualifier:["vec3"],f:!1},{type:"node_out",name:"ne",qualifier:["vec3"],f:!1},{type:"node_param",name:"ij",qualifier:["varying","vec2"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nd"],g:[{type:"textline",
b:"nd = h_ ( ij ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ne"],g:[{type:"textline",b:"ne = vec3 ( ij , ZERO_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"TEX_COORD_UV",i:[{type:"node_out",name:"nf",qualifier:["vec3"],f:!1},{type:"node_param",name:"ik",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"nf = vec3 ( ik , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_NO",i:[{type:"node_out",name:"ng",qualifier:["vec3"],f:!1}],g:[{type:"textline",
b:["ng","=","iP",";"]}]},{type:"node",name:"TEX_COORD_GE",i:[{type:"node_out",name:"nh",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"nh = abs ( hJ ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_OB",i:[{type:"node_out",name:"ni",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"ni [ 0 ] = ni [ 1 ] = ni [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_CA",i:[{type:"node_out",name:"nj",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"nj [ 0 ] = iL [ 0 ] ; nj [ 1 ] = iL [ 1 ] ; nj [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"TEX_COORD_WI",i:[{type:"node_out",name:"nk",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"nk [ 0 ] = nk [ 1 ] = nk [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_RE",i:[{type:"node_out",name:"nl",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"nl [ 0 ] = nl [ 1 ] = nl [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"UVMAP",i:[{type:"node_out",name:"nm",qualifier:["vec3"],f:!1},{type:"node_param",name:"il",qualifier:["varying","vec2"]}],
g:[{type:"textline",b:"nm = vec3 ( il , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"PARTICLE_INFO",i:[{type:"node_out",name:"nn",qualifier:["float"],f:!1},{type:"node_out",name:"no",qualifier:["float"],f:!1},{type:"node_out",name:"np",qualifier:["float"],f:!1},{type:"node_out",name:"nq",qualifier:["vec3"],f:!1},{type:"node_out",name:"nr",qualifier:["float"],f:!1},{type:"node_out",name:"ns",qualifier:["vec3"],f:!1},{type:"node_out",name:"nt",qualifier:["vec3"],f:!1}],g:[{type:"textline",
b:"nn = ZERO_VALUE_NODES ; no = ZERO_VALUE_NODES ; np = ZERO_VALUE_NODES ; nq = vec3 ( ZERO_VALUE_NODES ) ; nr = ZERO_VALUE_NODES ; ns = nq ; nt = nq ;".split(" ")}]},{type:"node",name:"HAIR_INFO",i:[{type:"node_out",name:"nu",qualifier:["float"],f:!1},{type:"node_out",name:"nv",qualifier:["float"],f:!1},{type:"node_out",name:"nw",qualifier:["float"],f:!1},{type:"node_out",name:"nx",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"nu = ZERO_VALUE_NODES ; nv = ZERO_VALUE_NODES ; nw = ZERO_VALUE_NODES ; nx = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"OBJECT_INFO",i:[{type:"node_out",name:"ny",qualifier:["vec3"],f:!1},{type:"node_out",name:"nz",qualifier:["float"],f:!1},{type:"node_out",name:"nA",qualifier:["float"],f:!1},{type:"node_out",name:"nB",qualifier:["float"],f:!1}],g:[{type:"textline",b:"nz = ZERO_VALUE_NODES ; nA = ZERO_VALUE_NODES ; nB = ZERO_VALUE_NODES ; ny = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"WIREFRAME",i:[{type:"node_in",name:"nC",qualifier:["float"],f:!1},{type:"node_out",name:"nD",
qualifier:["float"],f:!1}],g:[{type:"textline",b:["nD","=","nC",";"]}]},{type:"node",name:"TANGENT",i:[{type:"node_out",name:"nE",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"nE = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LAYER_WEIGHT",i:[{type:"node_in",name:"nF",qualifier:["float"],f:!1},{type:"node_in",name:"nG",qualifier:["vec3"],f:!1},{type:"node_out",name:"nH",qualifier:["float"],f:!1},{type:"node_out",name:"nI",qualifier:["float"],f:!1}],g:[{type:"textline",b:"nH = nI = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",b:["nG",";","nF",";"]}]},{type:"node",name:"LIGHT_PATH",i:[{type:"node_out",name:"nJ",qualifier:["float"],f:!1},{type:"node_out",name:"nK",qualifier:["float"],f:!1},{type:"node_out",name:"nL",qualifier:["float"],f:!1},{type:"node_out",name:"nM",qualifier:["float"],f:!1},{type:"node_out",name:"nN",qualifier:["float"],f:!1},{type:"node_out",name:"nO",qualifier:["float"],f:!1},{type:"node_out",name:"nP",qualifier:["float"],f:!1},{type:"node_out",name:"nQ",qualifier:["float"],f:!1},{type:"node_out",
name:"nR",qualifier:["float"],f:!1},{type:"node_out",name:"nS",qualifier:["float"],f:!1}],g:[{type:"textline",b:"nJ = nK = nL = ZERO_VALUE_NODES ; nM = nN = nO = ZERO_VALUE_NODES ; nP = nP = nR = nS = ZERO_VALUE_NODES ; nQ = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"ATTRIBUTE",i:[{type:"node_out",name:"nT",qualifier:["vec3"],f:!1},{type:"node_out",name:"nU",qualifier:["vec3"],f:!1},{type:"node_out",name:"nV",qualifier:["float"],f:!1}],g:[{type:"textline",b:"nT = nU = vec3 ( ZERO_VALUE_NODES ) ; nV = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"SCRIPT",i:[],g:[]},{type:"node",name:"CURVE_VEC",i:[{type:"node_in",name:"nW",qualifier:["float"],f:!1},{type:"node_in",name:"nX",qualifier:["vec3"],f:!1},{type:"node_out",name:"nY",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["nY","=","nX",";"]},{type:"textline",b:["nW",";"]}]},{type:"node",name:"CURVE_RGB",i:[{type:"node_in",name:"nZ",qualifier:["float"],f:!1},{type:"node_in",name:"n_",qualifier:["vec3"],f:!1},{type:"node_out",name:"oa",qualifier:["vec3"],f:!1}],g:[{type:"textline",
b:["oa","=","n_",";"]},{type:"textline",b:["nZ",";"]}]},{type:"node",name:"VALTORGB",i:[{type:"node_in",name:"ob",qualifier:["float"],f:!1},{type:"node_out",name:"oc",qualifier:["vec3"],f:!1},{type:"node_out",name:"od",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oc [ 0 ] = oc [ 1 ] = oc [ 2 ] = clamp ( ob , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; od = oc [ 0 ] ;".split(" ")}]},{type:"node",name:"MAPPING",i:[{type:"node_in",name:"oe",qualifier:["vec3"],f:!1},{type:"node_out",name:"of",qualifier:["vec3"],
f:!1}],g:[{type:"textline",b:["of","=","oe",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",g:[{type:"textline",b:"of = ( MAPPING_TRS_MATRIX * vec4 ( of , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_SCALE",g:[{type:"textline",b:"of = of * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",g:[{type:"textline",b:"of = of + MAPPING_TRANSLATION ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",g:[{type:"textline",b:"of = max ( of , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",g:[{type:"textline",b:"of = min ( of , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],g:[{type:"textline",b:"of = normalize ( of ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",i:[{type:"node_in",name:"og",qualifier:["float"],
f:!1},{type:"node_in",name:"oh",qualifier:["float"],f:!1},{type:"node_out",name:"oi",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oi = og + oh ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oi = clamp ( oi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",i:[{type:"node_in",name:"oj",qualifier:["float"],f:!1},{type:"node_in",name:"ok",qualifier:["float"],f:!1},{type:"node_out",name:"ol",qualifier:["float"],
f:!1}],g:[{type:"textline",b:"ol = oj - ok ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ol = clamp ( ol , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MULTIPLY",i:[{type:"node_in",name:"om",qualifier:["float"],f:!1},{type:"node_in",name:"on",qualifier:["float"],f:!1},{type:"node_out",name:"oo",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oo = om * on ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oo = clamp ( oo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",i:[{type:"node_in",name:"op",qualifier:["float"],f:!1},{type:"node_in",name:"oq",qualifier:["float"],f:!1},{type:"node_out",name:"or",qualifier:["float"],f:!1}],g:[{type:"textline",b:"or = ( oq != ZERO_VALUE_NODES ) ? op / oq : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"or = clamp ( or , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_SINE",i:[{type:"node_in",name:"os",qualifier:["float"],f:!1},{type:"node_in",name:"ot",qualifier:["float"],f:!1},{type:"node_out",name:"ou",qualifier:["float"],f:!1}],g:[{type:"textline",b:"ou = sin ( os ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ou = clamp ( ou , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["ot",";"]}]},{type:"node",name:"MATH_COSINE",i:[{type:"node_in",name:"ov",
qualifier:["float"],f:!1},{type:"node_in",name:"ow",qualifier:["float"],f:!1},{type:"node_out",name:"ox",qualifier:["float"],f:!1}],g:[{type:"textline",b:"ox = cos ( ov ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ox = clamp ( ox , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["ow",";"]}]},{type:"node",name:"MATH_TANGENT",i:[{type:"node_in",name:"oy",qualifier:["float"],f:!1},{type:"node_in",name:"oz",qualifier:["float"],
f:!1},{type:"node_out",name:"oA",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oA = tan ( oy ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oA = clamp ( oA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["oz",";"]}]},{type:"node",name:"MATH_ARCSINE",i:[{type:"node_in",name:"oB",qualifier:["float"],f:!1},{type:"node_in",name:"oC",qualifier:["float"],f:!1},{type:"node_out",name:"oD",qualifier:["float"],f:!1}],
g:[{type:"textline",b:"oD = ( oB <= UNITY_VALUE_NODES && oB >= - UNITY_VALUE_NODES ) ? asin ( oB ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oD = clamp ( oD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["oC",";"]}]},{type:"node",name:"MATH_ARCCOSINE",i:[{type:"node_in",name:"oE",qualifier:["float"],f:!1},{type:"node_in",name:"oF",qualifier:["float"],f:!1},{type:"node_out",name:"oG",qualifier:["float"],
f:!1}],g:[{type:"textline",b:"oG = ( oE <= UNITY_VALUE_NODES && oE >= - UNITY_VALUE_NODES ) ? acos ( oE ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oG = clamp ( oG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["oF",";"]}]},{type:"node",name:"MATH_ARCTANGENT",i:[{type:"node_in",name:"oH",qualifier:["float"],f:!1},{type:"node_in",name:"oI",qualifier:["float"],f:!1},{type:"node_out",name:"oJ",
qualifier:["float"],f:!1}],g:[{type:"textline",b:"oJ = atan ( oH ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oJ = clamp ( oJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["oI",";"]}]},{type:"node",name:"MATH_POWER",i:[{type:"node_in",name:"oK",qualifier:["float"],f:!1},{type:"node_in",name:"oL",qualifier:["float"],f:!1},{type:"node_out",name:"oM",qualifier:["float"],f:!1}],g:[{type:"textline",b:"if ( oK < ZERO_VALUE_NODES || oK == ZERO_VALUE_NODES && oL == ZERO_VALUE_NODES ) oM = ZERO_VALUE_NODES ; else oM = pow ( oK , oL ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oM = clamp ( oM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",i:[{type:"node_in",name:"oN",qualifier:["float"],f:!1},{type:"node_in",name:"oO",qualifier:["float"],f:!1},{type:"node_out",name:"oP",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oP = ( oN > ZERO_VALUE_NODES && oO > ZERO_VALUE_NODES ) ? log2 ( oN ) / log2 ( oO ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oP = clamp ( oP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MINIMUM",i:[{type:"node_in",name:"oQ",qualifier:["float"],f:!1},{type:"node_in",name:"oR",qualifier:["float"],f:!1},{type:"node_out",name:"oS",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oS = min ( oQ , oR ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oS = clamp ( oS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MAXIMUM",i:[{type:"node_in",name:"oT",qualifier:["float"],f:!1},{type:"node_in",name:"oU",qualifier:["float"],f:!1},{type:"node_out",name:"oV",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oV = max ( oT , oU ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oV = clamp ( oV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",i:[{type:"node_in",name:"oW",qualifier:["float"],f:!1},
{type:"node_in",name:"oX",qualifier:["float"],f:!1},{type:"node_out",name:"oY",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oY = floor ( oW + 0.5 ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oY = clamp ( oY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["oX",";"]}]},{type:"node",name:"MATH_LESS_THAN",i:[{type:"node_in",name:"oZ",qualifier:["float"],f:!1},{type:"node_in",name:"o_",qualifier:["float"],f:!1},
{type:"node_out",name:"pa",qualifier:["float"],f:!1}],g:[{type:"textline",b:"pa = ( oZ < o_ ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"pa = clamp ( pa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",i:[{type:"node_in",name:"pb",qualifier:["float"],f:!1},{type:"node_in",name:"pc",qualifier:["float"],f:!1},{type:"node_out",name:"pd",qualifier:["float"],
f:!1}],g:[{type:"textline",b:"pd = ( pb > pc ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"pd = clamp ( pd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",i:[{type:"node_in",name:"pe",qualifier:["float"],f:!1},{type:"node_in",name:"pf",qualifier:["float"],f:!1},{type:"node_out",name:"pg",qualifier:["float"],f:!1}],g:[{type:"textline",b:"pg = abs ( pf ) > 0.000001 ? mod ( pe , pf ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"pg = clamp ( pg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ABSOLUTE",i:[{type:"node_in",name:"ph",qualifier:["float"],f:!1},{type:"node_in",name:"pi",qualifier:["float"],f:!1},{type:"node_out",name:"pj",qualifier:["float"],f:!1}],g:[{type:"textline",b:"pj = abs ( ph ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"pj = clamp ( pj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["pi",";"]}]},{type:"node",name:"MIX_RGB_MIX",i:[{type:"node_in",name:"pk",qualifier:["float"],f:!1},{type:"node_in",name:"pl",qualifier:["vec3"],f:!1},{type:"node_in",name:"pm",qualifier:["vec3"],f:!1},{type:"node_out",name:"pn",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pn = mix ( pl , pm , iE ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pn = clamp ( pn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_ADD",i:[{type:"node_in",name:"po",qualifier:["float"],f:!1},{type:"node_in",name:"pp",qualifier:["vec3"],f:!1},{type:"node_in",name:"pq",qualifier:["vec3"],f:!1},{type:"node_out",name:"pr",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( po , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pr = mix ( pp , pp + pq , iE ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pr = clamp ( pr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_MULTIPLY",i:[{type:"node_in",name:"ps",qualifier:["float"],f:!1},{type:"node_in",name:"pt",qualifier:["vec3"],f:!1},{type:"node_in",name:"pu",qualifier:["vec3"],f:!1},{type:"node_out",name:"pv",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( ps , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pv = mix ( pt , pt * pu , iE ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pv = clamp ( pv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SUBTRACT",i:[{type:"node_in",name:"pw",qualifier:["float"],f:!1},{type:"node_in",name:"px",qualifier:["vec3"],f:!1},{type:"node_in",name:"py",qualifier:["vec3"],f:!1},{type:"node_out",name:"pz",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pz = mix ( px , px - py , iE ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pz = clamp ( pz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SCREEN",i:[{type:"node_in",name:"pA",qualifier:["float"],f:!1},{type:"node_in",name:"pB",qualifier:["vec3"],f:!1},{type:"node_in",name:"pC",qualifier:["vec3"],f:!1},{type:"node_out",name:"pD",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iD = UNITY_VALUE_NODES - iE ; pD = hL - ( vec3 ( iD ) + iE * ( hL - pC ) ) * ( hL - pB ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",
b:"pD = clamp ( pD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",i:[{type:"node_in",name:"pE",qualifier:["float"],f:!1},{type:"node_in",name:"pF",qualifier:["vec3"],f:!1},{type:"node_in",name:"pG",qualifier:["vec3"],f:!1},{type:"node_out",name:"pH",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iD = UNITY_VALUE_NODES - iE ; pG += step ( pG , hK ) ; pH = iD * pF + iE * pF / pG ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pH = clamp ( pH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",i:[{type:"node_in",name:"pI",qualifier:["float"],f:!1},{type:"node_in",name:"pJ",qualifier:["vec3"],f:!1},{type:"node_in",name:"pK",qualifier:["vec3"],f:!1},{type:"node_out",name:"pL",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pL = mix ( pJ , abs ( pJ - pK ) , iE ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pL = clamp ( pL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",i:[{type:"node_in",name:"pM",qualifier:["float"],f:!1},{type:"node_in",name:"pN",qualifier:["vec3"],f:!1},{type:"node_in",name:"pO",qualifier:["vec3"],f:!1},{type:"node_out",name:"pP",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pP = min ( pN . rgb , pO . rgb * iE ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pP = clamp ( pP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",i:[{type:"node_in",name:"pQ",qualifier:["float"],f:!1},{type:"node_in",name:"pR",qualifier:["vec3"],f:!1},{type:"node_in",name:"pS",qualifier:["vec3"],f:!1},{type:"node_out",name:"pT",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pT = max ( pR . rgb , pS . rgb * iE ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pT = clamp ( pT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_OVERLAY",i:[{type:"node_in",name:"pU",qualifier:["float"],f:!1},{type:"node_in",name:"pV",qualifier:["vec3"],f:!1},{type:"node_in",name:"pW",qualifier:["vec3"],f:!1},{type:"node_out",name:"pX",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iS = vec3 ( UNITY_VALUE_NODES - iE ) ; pX = mix ( pV * ( iS + 2.0 * iE * pW ) , hL - ( iS + 2.0 * iE * ( hL - pW ) ) * ( hL - pV ) , step ( 0.5 , pV ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pX = clamp ( pX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",i:[{type:"node_in",name:"pY",qualifier:["float"],f:!1},{type:"node_in",name:"pZ",qualifier:["vec3"],f:!1},{type:"node_in",name:"p_",qualifier:["vec3"],f:!1},{type:"node_out",name:"qa",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iS = hL - iE * p_ ; iR = clamp ( pZ / iS , 0.0 , 1.0 ) ; qa = mix ( mix ( iR , hL , step ( iS , hK ) ) , pZ , step ( pZ , hK ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qa = clamp ( qa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_BURN",i:[{type:"node_in",name:"qb",qualifier:["float"],f:!1},{type:"node_in",name:"qc",qualifier:["vec3"],f:!1},{type:"node_in",name:"qd",qualifier:["vec3"],f:!1},{type:"node_out",name:"qe",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( qb , 0.0 , 1.0 ) ; iS = vec3 ( 1.0 - iE ) ; iS = iS + iE * qd ; iR = clamp ( hL - ( hL - qc ) / iS , 0.0 , 1.0 ) ; qe = mix ( iR , hK , step ( iS , hK ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qe = clamp ( qe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",i:[{type:"node_in",name:"qf",qualifier:["float"],f:!1},{type:"node_in",name:"qg",qualifier:["vec3"],f:!1},{type:"node_in",name:"qh",qualifier:["vec3"],f:!1},{type:"node_out",name:"qi",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( qf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qi = qg ; iR = hU ( qh ) ; if ( iR . y != ZERO_VALUE_NODES ) { iS = hU ( qi ) ; iS . x = iR . x ; iT = hY ( iS ) ; qi = mix ( qi , iT , iE ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qi = clamp ( qi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",i:[{type:"node_in",name:"qj",qualifier:["float"],f:!1},{type:"node_in",name:"qk",qualifier:["vec3"],f:!1},{type:"node_in",name:"ql",qualifier:["vec3"],f:!1},{type:"node_out",name:"qm",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( qj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iD = UNITY_VALUE_NODES - iE ; qm = qk ; iT = hU ( qm ) ; if ( iT . y != ZERO_VALUE_NODES ) { iR = hU ( ql ) ; iT . y = iD * iT . y + iE * iR . y ; qm = hY ( iT ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qm = clamp ( qm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",i:[{type:"node_in",name:"qn",qualifier:["float"],f:!1},{type:"node_in",name:"qo",qualifier:["vec3"],f:!1},{type:"node_in",name:"qp",qualifier:["vec3"],f:!1},{type:"node_out",name:"qq",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( qn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iD = UNITY_VALUE_NODES - iE ; iR = hU ( qo ) ; iU = hU ( qp ) ; iR . z = iD * iR . z + iE * iU . z ; qq = hY ( iR ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qq = clamp ( qq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",i:[{type:"node_in",name:"qr",qualifier:["float"],f:!1},{type:"node_in",name:"qs",qualifier:["vec3"],f:!1},{type:"node_in",name:"qt",qualifier:["vec3"],f:!1},{type:"node_out",name:"qu",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( qr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qu = qs ; iV = hU ( qt ) ; if ( iV . y != ZERO_VALUE_NODES ) { iU = hU ( qu ) ; iU . x = iV . x ; iU . y = iV . y ; iW = hY ( iU ) ; qu = mix ( qu , iW , iE ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qu = clamp ( qu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",i:[{type:"node_in",name:"qv",qualifier:["float"],f:!1},{type:"node_in",name:"qw",qualifier:["vec3"],f:!1},{type:"node_in",name:"qx",qualifier:["vec3"],f:!1},{type:"node_out",name:"qy",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( qv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iD = UNITY_VALUE_NODES - iE ; iW = qx + qw - qx * qw ; qy = qw * ( vec3 ( iD ) + vec3 ( iE ) * ( ( hL - qw ) * qx + iW ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qy = clamp ( qy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",i:[{type:"node_in",name:"qz",qualifier:["float"],f:!1},{type:"node_in",name:"qA",qualifier:["vec3"],f:!1},{type:"node_in",name:"qB",qualifier:["vec3"],f:!1},{type:"node_out",name:"qC",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( qz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qC = qA + iE * ( 2.0 * qB - hL ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qC = clamp ( qC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",i:[{type:"node_in",name:"qD",qualifier:["vec3"],f:!1},{type:"node_in",name:"qE",qualifier:["float"],f:!1}],g:[{type:"textline",b:"iu = qD ; iy = qE ;".split(" ")}]},{type:"node",name:"MATERIAL",i:[{type:"node_in",name:"qF",qualifier:["vec3"],f:!1},{type:"node_in",name:"qG",qualifier:["vec3"],f:!1},{type:"node_in",
name:"qH",qualifier:["float"],f:!1},{type:"node_in",name:"qI",qualifier:["vec3"],f:!0},{type:"node_out",name:"qJ",qualifier:["vec3"],f:!0},{type:"node_out",name:"qK",qualifier:["float"],f:!0},{type:"node_out",name:"qL",qualifier:["vec3"],f:!0},{type:"node_param",name:"im",qualifier:["float"]},{type:"node_param",name:"io",qualifier:["float"]},{type:"node_param",name:"ip",qualifier:["const","vec2"]},{type:"node_param",name:"iq",qualifier:["const","vec3"]}],g:[{type:"textline",b:"iW = clamp ( qF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},
{type:"textline",b:"iV = iq [ 0 ] * clamp ( qG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],g:[{type:"textline",b:"iX = normalize ( qI ) ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["iX","=","iP",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["SHADELESS_MAT",{type:"logic_negative_expr",d:1},"NODES_GLOW",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],g:[{type:"textline",b:"iY = iB * iW ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:["iW","*=","qH",";"]}]}]},{type:"textline",b:"iZ = iC * u_environment_energy * hu ( iX ) ; iE = gY ( iW ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],g:[{type:"textline",b:"iz = vec2 ( ip [ 0 ] , ip [ 1 ] ) ;".split(" ")},{type:"textline",b:"iA = vec2 ( iq [ 1 ] , iq [ 2 ] ) ; jd = cN ( iY , iZ , iW , iV , iO , iX , it , iA , iz , iE , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},
{type:"node_else",g:[{type:"textline",b:"jd = cS ( iY , iZ , iW ) ;".split(" ")}]}]},{type:"textline",b:["ix","=","iE",";"]}]},{type:"node_else",g:[{type:"textline",b:"jd . a = vec4 ( iW , ZERO_VALUE_NODES ) ; jd . b = hK ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qJ"],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:"qJ = jd . a . rgb ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["qJ","=","hK",";"]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"qJ += jd . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qK"],g:[{type:"textline",b:"qK = clamp ( im , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"iD = max ( max ( jd . b . r , jd . b . g ) , jd . b . b ) * io ; qK = im * ( UNITY_VALUE_NODES - iD ) + iD ;".split(" ")}]}]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_qL"],g:[{type:"textline",b:["qL","=","iX",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"iv = jd . b ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["iv","=","hK",";"]}]}]},{type:"textline",b:["iw","=","iX",";"]}]},{type:"node",name:"MATERIAL_EXT",i:[{type:"node_in",name:"qM",qualifier:["vec3"],f:!1},{type:"node_in",name:"qN",qualifier:["vec3"],f:!1},{type:"node_in",name:"qO",qualifier:["float"],f:!1},
{type:"node_in",name:"qP",qualifier:["vec3"],f:!0},{type:"node_in",name:"qQ",qualifier:["float"],f:!1},{type:"node_in",name:"qR",qualifier:["float"],f:!1},{type:"node_in",name:"qS",qualifier:["vec4"],f:!1},{type:"node_in",name:"qT",qualifier:["float"],f:!1},{type:"node_in",name:"qU",qualifier:["float"],f:!1},{type:"node_in",name:"qV",qualifier:["float"],f:!1},{type:"node_out",name:"qW",qualifier:["vec3"],f:!0},{type:"node_out",name:"qX",qualifier:["float"],f:!0},{type:"node_out",name:"qY",qualifier:["vec3"],
f:!0},{type:"node_out",name:"qZ",qualifier:["vec3"],f:!0},{type:"node_out",name:"q_",qualifier:["vec3"],f:!0},{type:"node_param",name:"ir",qualifier:["const","vec2"]},{type:"node_param",name:"is",qualifier:["const","vec3"]}],g:[{type:"textline",b:"iV = clamp ( qM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",b:"i_ = is [ 0 ] * clamp ( qN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],g:[{type:"textline",
b:"ja = normalize ( qP ) ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["ja","=","iP",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["SHADELESS_MAT",{type:"logic_negative_expr",d:1},"NODES_GLOW",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],g:[{type:"textline",b:"jb = qQ * iV ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:["iV","*=","qO",";"]}]}]},{type:"textline",b:"iD = gY ( iV ) ;".split(" ")},{type:"textline",
b:"jc = iC * u_environment_energy * hu ( ja ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],g:[{type:"textline",b:"iz = vec2 ( ir [ 0 ] , ir [ 1 ] ) ; iA = vec2 ( is [ 1 ] , is [ 2 ] ) ; jd = cN ( jb , jc , iV , i_ , iO , ja , it , iA , iz , iD , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , qR , qS ) ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"jd = cS ( jb , jc , iV ) ;".split(" ")}]}]},{type:"textline",
b:["ix","=","iD",";"]}]},{type:"node_else",g:[{type:"textline",b:"jd . a = vec4 ( iV , ZERO_VALUE_NODES ) ; jd . b = hK ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qW"],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:"qW = jd . a . rgb ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["qW","=","hK",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["REFLECTION_TYPE","REFL_NONE",{type:"non_equal_expr",d:2}],g:[{type:"textline",
b:"hr ( qW , it , ja , qT ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"qW += jd . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qX"],g:[{type:"textline",b:"qX = clamp ( qV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"iG = max ( max ( jd . b . r , jd . b . g ) , jd . b . b ) * qU ; qX = clamp ( qV * ( UNITY_VALUE_NODES - iG ) + iG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qY"],g:[{type:"textline",b:["qY","=","ja",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qZ"],g:[{type:"textline",b:"qZ = jd . a . rgb ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_q_"],g:[{type:"textline",b:"q_ = jd . b ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"iv = jd . b ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["iv",
"=","hK",";"]}]}]},{type:"textline",b:["iw","=","ja",";"]}]},{type:"node",name:"RGB",i:[{type:"node_out",name:"ra",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"ra = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",i:[{type:"node_in",name:"rb",qualifier:["vec3"],f:!1},{type:"node_out",name:"rc",qualifier:["float"],f:!1}],g:[{type:"textline",b:"rc = dot ( rb , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{type:"node",name:"SEPRGB",i:[{type:"node_in",name:"rd",qualifier:["vec3"],
f:!1},{type:"node_out",name:"re",qualifier:["float"],f:!0},{type:"node_out",name:"rf",qualifier:["float"],f:!0},{type:"node_out",name:"rg",qualifier:["float"],f:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_re"],g:[{type:"textline",b:"re = rd . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rf"],g:[{type:"textline",b:"rf = rd . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rg"],g:[{type:"textline",b:"rg = rd . b ;".split(" ")}]}]}]},
{type:"node",name:"SEPHSV",i:[{type:"node_in",name:"rh",qualifier:["vec3"],f:!1},{type:"node_out",name:"ri",qualifier:["float"],f:!0},{type:"node_out",name:"rj",qualifier:["float"],f:!0},{type:"node_out",name:"rk",qualifier:["float"],f:!0}],g:[{type:"textline",b:"i_ = hU ( rh ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ri"],g:[{type:"textline",b:"ri = i_ . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rj"],g:[{type:"textline",b:"rj = i_ . g ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rk"],g:[{type:"textline",b:"rk = i_ . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",i:[{type:"node_in",name:"rl",qualifier:["float"],f:!1},{type:"node_in",name:"rm",qualifier:["float"],f:!1},{type:"node_in",name:"rn",qualifier:["float"],f:!1},{type:"node_out",name:"ro",qualifier:["float"],f:!1}],g:[{type:"textline",b:"ro = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( rl - rn ) * rm ) ) ) ;".split(" ")}]},{type:"node",
name:"GAMMA",i:[{type:"node_in",name:"rp",qualifier:["vec3"],f:!1},{type:"node_in",name:"rq",qualifier:["float"],f:!1},{type:"node_out",name:"rr",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"rr = max ( hK , rp ) ; rr = pow ( rr , vec3 ( rq ) ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",i:[{type:"node_in",name:"rs",qualifier:["vec3"],f:!1},{type:"node_out",name:"rt",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"rt = max ( hK , rs ) ; rt = pow ( rt , vec3 ( 2.2 ) ) ;".split(" ")}]},
{type:"node",name:"B4W_LINEAR_TO_SRGB",i:[{type:"node_in",name:"ru",qualifier:["vec3"],f:!1},{type:"node_out",name:"rv",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"rv = max ( hK , ru ) ; rv = pow ( rv , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_EMPTY",i:[{type:"node_out",name:"rw",qualifier:["vec3"],f:!1},{type:"node_out",name:"rx",qualifier:["vec3"],f:!1},{type:"node_out",name:"ry",qualifier:["float"],f:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ry"],
g:[{type:"textline",b:"rw [ 2 ] = rw [ 1 ] = rw [ 0 ] = 0.0 ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ry"],g:[{type:"textline",b:"rx [ 2 ] = rx [ 1 ] = rx [ 0 ] = 0.0 ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ry"],g:[{type:"textline",b:["ry","=","0.0",";"]}]}]}]},{type:"node",name:"TEXTURE_ENVIRONMENT",i:[{type:"node_in",name:"rz",qualifier:["vec3"],f:!1},{type:"node_out",name:"rA",qualifier:["vec3"],f:!0},{type:"node_out",name:"rB",qualifier:["float"],
f:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]}],g:[{type:"textline",b:"iM = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , rz ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rA"],g:[{type:"textline",b:"rA = iM . xyz ; ed ( rA ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rB"],g:[{type:"textline",b:"rB = iM . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",i:[{type:"node_in",
name:"rC",qualifier:["vec3"],f:!0},{type:"node_in",name:"rD",qualifier:["vec3"],f:!0},{type:"node_in",name:"rE",qualifier:["vec3"],f:!0},{type:"node_in",name:"rF",qualifier:["vec3"],f:!0},{type:"node_out",name:"rG",qualifier:["vec3"],f:!0},{type:"node_out",name:"rH",qualifier:["float"],f:!0},{type:"node_out",name:"rI",qualifier:["vec3"],f:!0},{type:"node_out",name:"rJ",qualifier:["float"],f:!0},{type:"node_out",name:"rK",qualifier:["vec3"],f:!0},{type:"node_out",name:"rL",qualifier:["float"],f:!0},
{type:"node_out",name:"rM",qualifier:["vec3"],f:!0},{type:"node_out",name:"rN",qualifier:["float"],f:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"iM = texture2D ( node_TEXTURE_COLOR_var_texture , ib ( rC ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rG"],g:[{type:"textline",b:"rG = iM . xyz ; ed ( rG ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rH"],g:[{type:"textline",
b:"rH = iM . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv2"],g:[{type:"textline",b:"iM = texture2D ( node_TEXTURE_COLOR_var_texture , ib ( rD ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rI"],g:[{type:"textline",b:"rI = iM . xyz ; ed ( rI ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rJ"],g:[{type:"textline",b:"rJ = iM . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],g:[{type:"textline",
b:"iM = texture2D ( node_TEXTURE_COLOR_var_texture , ib ( rE ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rK"],g:[{type:"textline",b:"rK = iM . xyz ; ed ( rK ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rL"],g:[{type:"textline",b:"rL = iM . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],g:[{type:"textline",b:"iM = texture2D ( node_TEXTURE_COLOR_var_texture , ib ( rF ) ) ;".split(" ")},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_rM"],g:[{type:"textline",b:"rM = iM . xyz ; ed ( rM ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rN"],g:[{type:"textline",b:"rN = iM . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",i:[{type:"node_in",name:"rO",qualifier:["vec3"],f:!0},{type:"node_in",name:"rP",qualifier:["vec3"],f:!0},{type:"node_in",name:"rQ",qualifier:["vec3"],f:!0},{type:"node_in",name:"rR",qualifier:["vec3"],f:!0},{type:"node_out",name:"rS",qualifier:["vec3"],
f:!0},{type:"node_out",name:"rT",qualifier:["float"],f:!0},{type:"node_out",name:"rU",qualifier:["vec3"],f:!0},{type:"node_out",name:"rV",qualifier:["float"],f:!0},{type:"node_out",name:"rW",qualifier:["vec3"],f:!0},{type:"node_out",name:"rX",qualifier:["float"],f:!0},{type:"node_out",name:"rY",qualifier:["vec3"],f:!0},{type:"node_out",name:"rZ",qualifier:["float"],f:!0},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"iM = texture2D ( node_TEXTURE_NORMAL_var_texture , ib ( rO ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rS"],g:[{type:"textline",b:"rS = normalize ( iN * ( iM . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rT"],g:[{type:"textline",b:"rT = iM . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv2"],g:[{type:"textline",b:"iM = texture2D ( node_TEXTURE_NORMAL_var_texture , ib ( rP ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rU"],g:[{type:"textline",b:"rU = normalize ( iN * ( iM . xyz - 0.5 ) ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rV"],g:[{type:"textline",b:"rV = iM . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],g:[{type:"textline",b:"iM = texture2D ( node_TEXTURE_NORMAL_var_texture , ib ( rQ ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rW"],g:[{type:"textline",b:"rW = normalize ( iN * ( iM . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rX"],g:[{type:"textline",b:"rX = iM . w ;".split(" ")}]}]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],g:[{type:"textline",b:"iM = texture2D ( node_TEXTURE_NORMAL_var_texture , ib ( rR ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rY"],g:[{type:"textline",b:"rY = normalize ( iN * ( iM . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rZ"],g:[{type:"textline",b:"rZ = iM . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",i:[{type:"node_out",name:"r_",qualifier:["float"],f:!1}],
g:[{type:"textline",b:"r_ = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",i:[{type:"node_in",name:"sa",qualifier:["vec3"],f:!1},{type:"node_in",name:"sb",qualifier:["vec3"],f:!1},{type:"node_out",name:"sc",qualifier:["vec3"],f:!1},{type:"node_out",name:"sd",qualifier:["float"],f:!0}],g:[{type:"textline",b:"sc = sa + sb ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sd"],g:[{type:"textline",b:"sd = ( abs ( sc [ 0 ] ) + abs ( sc [ 1 ] ) + abs ( sc [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_SUBTRACT",i:[{type:"node_in",name:"se",qualifier:["vec3"],f:!1},{type:"node_in",name:"sf",qualifier:["vec3"],f:!1},{type:"node_out",name:"sg",qualifier:["vec3"],f:!1},{type:"node_out",name:"sh",qualifier:["float"],f:!0}],g:[{type:"textline",b:"sg = se - sf ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sh"],g:[{type:"textline",b:"sh = ( abs ( sg [ 0 ] ) + abs ( sg [ 1 ] ) + abs ( sg [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",
i:[{type:"node_in",name:"si",qualifier:["vec3"],f:!1},{type:"node_in",name:"sj",qualifier:["vec3"],f:!1},{type:"node_out",name:"sk",qualifier:["vec3"],f:!1},{type:"node_out",name:"sl",qualifier:["float"],f:!0}],g:[{type:"textline",b:"sk = si + sj ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sl"],g:[{type:"textline",b:"sl = length ( sk ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sk"],g:[{type:"textline",b:"sk = normalize ( sk ) ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_DOT_PRODUCT",i:[{type:"node_in",name:"sm",qualifier:["vec3"],f:!1},{type:"node_in",name:"sn",qualifier:["vec3"],f:!1},{type:"node_out",name:"so",qualifier:["vec3"],f:!1},{type:"node_out",name:"sp",qualifier:["float"],f:!0}],g:[{type:"textline",b:["so","=","hK",";"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sp"],g:[{type:"textline",b:"sp = dot ( sm , sn ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",i:[{type:"node_in",name:"sq",qualifier:["vec3"],
f:!1},{type:"node_in",name:"sr",qualifier:["vec3"],f:!1},{type:"node_out",name:"ss",qualifier:["vec3"],f:!1},{type:"node_out",name:"st",qualifier:["float"],f:!0}],g:[{type:"textline",b:"ss = cross ( sq , sr ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_st"],g:[{type:"textline",b:"st = length ( ss ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",i:[{type:"node_in",name:"su",qualifier:["vec3"],f:!1},{type:"node_in",name:"sv",qualifier:["vec3"],f:!1},{type:"node_out",
name:"sw",qualifier:["vec3"],f:!1},{type:"node_out",name:"sx",qualifier:["float"],f:!0}],g:[{type:"textline",b:"sw = normalize ( su ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sx"],g:[{type:"textline",b:"sx = length ( su ) ;".split(" ")}]}]},{type:"textline",b:["sv",";"]}]},{type:"node",name:"B4W_REFLECT",i:[{type:"node_in",name:"sy",qualifier:["vec3"],f:!1},{type:"node_in",name:"sz",qualifier:["vec3"],f:!1},{type:"node_out",name:"sA",qualifier:["vec3"],f:!1}],g:[{type:"textline",
b:"sA = reflect ( - sy , sz ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",i:[{type:"node_in",name:"sB",qualifier:["vec3"],f:!1},{type:"node_in",name:"sC",qualifier:["float"],f:!1},{type:"node_in",name:"sD",qualifier:["const","float"],f:!1},{type:"node_in",name:"sE",qualifier:["const","float"],f:!1},{type:"node_out",name:"sF",qualifier:["vec3"],f:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"iG = length ( iL ) ; if ( iG < sE ) { iz = ib ( sB ) ; iH = clamp ( 0.5 * ( sE - iG ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iH = sC * iH ;".split(" ")},
{type:"textline",b:"i_ = normalize ( it * iN ) ;".split(" ")},{type:"textline",b:"iI = UNITY_VALUE_NODES / sD ;".split(" ")},{type:"textline",b:"iA = i_ . xy * iH / ( sD * i_ . z ) ; iJ = UNITY_VALUE_NODES ; iK = texture2D ( node_B4W_PARALLAX_var_texture , iz ) . a ;".split(" ")},{type:"textline",b:"for ( float sG = 1.0 ; sG <= sD ; sG ++ ) { if ( iK < iJ ) { iJ -= iI ; iz -= iA ; iK = texture2D ( node_B4W_PARALLAX_var_texture , iz ) . a ; } }".split(" ")},{type:"textline",b:"iA = iz + iA ; iI = texture2D ( node_B4W_PARALLAX_var_texture , iA ) . a - ( iJ + iI ) ; iJ = iK - iJ ; iI = iJ / ( iJ - iI ) ;".split(" ")},
{type:"textline",b:"iz = iI * iA + ( UNITY_VALUE_NODES - iI ) * iz ; sF = h_ ( iz ) ; } else sF = sB ;".split(" ")}]},{type:"node",name:"B4W_CLAMP",i:[{type:"node_in",name:"sH",qualifier:["vec3"],f:!1},{type:"node_out",name:"sI",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"sI = clamp ( sH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",i:[{type:"node_in",name:"sJ",qualifier:["vec3"],f:!1},{type:"node_in",name:"sK",qualifier:["float"],f:!1},{type:"node_out",
name:"sL",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"sL = hP ( sJ , sK ) ;".split(" ")}]},{type:"node",name:"B4W_TRANSLUCENCY",i:[{type:"node_in",name:"sM",qualifier:["float"],f:!1},{type:"node_in",name:"sN",qualifier:["float"],f:!1},{type:"node_in",name:"sO",qualifier:["float"],f:!1},{type:"node_in",name:"sP",qualifier:["float"],f:!1},{type:"node_in",name:"sQ",qualifier:["float"],f:!1},{type:"node_out",name:"sR",qualifier:["float"],f:!0},{type:"node_out",name:"sS",qualifier:["vec4"],f:!0}],
g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sR"],g:[{type:"textline",b:["sR","=","sM",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sS"],g:[{type:"textline",b:"sS = vec4 ( sN , sO , sP , sQ ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",i:[{type:"node_out",name:"sT",qualifier:["float"],f:!1}],g:[{type:"textline",b:["sT","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",i:[{type:"node_in",name:"sU",qualifier:["float"],f:!1},{type:"node_in",name:"sV",qualifier:["float"],
f:!1},{type:"node_in",name:"sW",qualifier:["float"],f:!1},{type:"node_out",name:"sX",qualifier:["float"],f:!1}],g:[{type:"textline",b:"sX = smoothstep ( sV , sW , sU ) ;".split(" ")}]},{type:"node",name:"B4W_GLOW_OUTPUT",i:[{type:"node_in",name:"sY",qualifier:["vec3"],f:!1},{type:"node_in",name:"sZ",qualifier:["float"],f:!1}],g:[{type:"textline",b:"iu = sY ; iy = sZ ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",i:[{type:"node_in",name:"s_",qualifier:["vec3"],f:!1},{type:"node_out",name:"ta",
qualifier:["float"],f:!1}],g:[{type:"textline",b:"ta = ( s_ . r + s_ . g + s_ . b ) / 3.0 ;".split(" ")}]},{type:"node",name:"B4W_SCALTOVEC",i:[{type:"node_in",name:"tb",qualifier:["float"],f:!1},{type:"node_out",name:"tc",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"tc [ 0 ] = tb ; tc [ 1 ] = tb ; tc [ 2 ] = tb ;".split(" ")}]},{type:"nodes_global"},{type:"textline",b:"void td ( in vec3 it , out vec3 iu , out vec3 iv , out vec3 iw , out float ix , out float iy ) { vec2 iz , iA ; float iB , iC , iD , iE , iF , iG , iH , iI , iJ , iK ; vec4 iL , iM ; mat3 iN ; vec3 iO , iP , iQ , iR , iS , iT , iU , iV , iW , iX , iY , iZ , i_ , ja , jb , jc ; iu = hK ; iv = hK ; iw = hK ; ix = ZERO_VALUE_NODES ; iy = ZERO_VALUE_NODES ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["iO","=","eW",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) iO = iO ; else iO = - iO ;".split(" ")}]}}]},{type:"textline",b:"iP = normalize ( iO ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"iQ = cross ( iO , eX . xyz ) * eX . w ; iN = mat3 ( eX . xyz , iQ , iO ) ; iN = iN ;".split(" ")}]}}]},{type:"textline",b:"iO = eU ; iL = eV ; iB = u_emit ; iC = u_ambient ; af jd ;".split(" ")},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 te = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",d:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 tk ( vec3 tf , mat4 tg ) { vec3 th , ti , tj ; th = vec3 ( tg [ 0 ] [ 0 ] , tg [ 1 ] [ 0 ] , tg [ 2 ] [ 0 ] ) ; ti = vec3 ( tg [ 0 ] [ 1 ] , tg [ 1 ] [ 1 ] , tg [ 2 ] [ 1 ] ) ; tj = vec3 ( tg [ 0 ] [ 2 ] , tg [ 1 ] [ 2 ] , tg [ 2 ] [ 2 ] ) ; ti = cross ( tj , th ) ; th = normalize ( th ) ; ti = normalize ( ti ) ; tj = normalize ( tj ) ; return mat4 ( vec4 ( th , 0.0 ) , vec4 ( ti , 0.0 ) , vec4 ( tj , 0.0 ) , vec4 ( tf , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 tq ( vec3 tl , vec3 tm ) { vec3 tn , to , tp ; tn = tl - tm ; tn . y = 0.0 ; to = cross ( te , tn ) ; tp = cross ( tn , to ) ; to = normalize ( to ) ; tp = normalize ( tp ) ; tn = normalize ( tn ) ; return mat4 ( vec4 ( to , 0.0 ) , vec4 ( tp , 0.0 ) , vec4 ( tn , 0.0 ) , vec4 ( tm , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 ty ( in vec3 tr , float ts , float tt , float tu , vec3 tv ) { float tw , tx ; tw = fract ( length ( tv ) / 0.17 ) ; tx = tu + tw / 10.0 ; tw = tw ; if ( tu != 0.0 ) tw /= tu ; tr *= 1.0 + 0.5 * sin ( ts ) ; tw = length ( tr ) * tt * sin ( 2.0 * 3.14 * ts * tx + tw ) ; return eL ( tw ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 tG ( in vec3 tz , in vec3 tA , in mat4 tB ) { vec3 tC ; float tD , tE ; mat4 tF ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",d:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tF = tk ( tA , tB ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",
b:"tD = fract ( ( tA . x * 1.43 + tA . y * 0.123 + tA . z * 6.1 ) ) ; tD = 2.0 * M_PI * tD ; tC = normalize ( vec3 ( tB [ 0 ] [ 2 ] , 0.0 , tB [ 2 ] [ 2 ] ) ) ; tE = acos ( tC [ 2 ] ) ; if ( tC [ 0 ] < 0.0 ) tE = 2.0 * M_PI - tE ; tE = tE - tD ; if ( tE < 0.0 ) tE = 2.0 * M_PI + tE ; tD = tD ; if ( tE <= MAX_BILLBOARD_ANGLE ) tD += tE ; else if ( tE <= M_PI - MAX_BILLBOARD_ANGLE ) tD += MAX_BILLBOARD_ANGLE * ( 2.0 * tE - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( tE <= M_PI + MAX_BILLBOARD_ANGLE ) tD += tE - M_PI ; else if ( tE <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) tD += MAX_BILLBOARD_ANGLE * ( 2.0 * tE - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else tD += tE - 2.0 * M_PI ; tF = eJ ( tD ) ; tF [ 3 ] = vec4 ( tA , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"tF = tq ( tz , tA ) ;".split(" ")}]}}]},{type:"textline",b:["return","tF",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 tM ( in vec3 tH , in vec3 tI , in mat4 tJ , mat4 tK ) { mat4 tL ; tL = tG ( tH , tI , tJ ) ; tK [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; tL = tL * tK ; return tL ; }".split(" ")}]}}]},
{type:"textline",b:"el tT ( in vec3 tN , in vec3 tO , in vec3 tP , in vec3 tQ , in vec3 tR , in mat4 tS ) { tN = ( tS * vec4 ( tN , 1.0 ) ) . xyz ; tO = ( tS * vec4 ( tO , 1.0 ) ) . xyz ; tP = ( tS * vec4 ( tP , 0.0 ) ) . xyz ; tQ = ( tS * vec4 ( tQ , 0.0 ) ) . xyz ; tR = ( tS * vec4 ( tR , 0.0 ) ) . xyz ; return eN ( el ( tN , tO , tP , tQ , tR , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 tW ( vec2 tU , vec3 tV ) { return ( tU + 0.5 ) * tV . xy - 0.5 ; }".split(" ")}]};
a["include/skin.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 uc ( in vec4 tX , in vec4 tY , in float tZ ) { float t_ , ua , ub ; t_ = tX [ 0 ] * tY [ 0 ] + tX [ 1 ] * tY [ 1 ] + tX [ 2 ] * tY [ 2 ] + tX [ 3 ] * tY [ 3 ] ; if ( t_ < 0.0 ) { tY *= - 1.0 ; t_ = - t_ ; } if ( abs ( t_ ) >= 1.0 ) return tX ; ua = acos ( t_ ) ; t_ = sqrt ( 1.0 - t_ * t_ ) ; if ( abs ( t_ ) < 0.001 ) return vec4 ( tX * 0.5 + tY * 0.5 ) ; ub = sin ( ( 1.0 - tZ ) * ua ) / t_ ; t_ = sin ( tZ * ua ) / t_ ; return tX * ub + tY * t_ ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 uo ( in vec3 ud , in vec4 ue , in vec4 uf , in vec4 ug , in vec4 uh , in float ui ) { vec4 uj , uk ; vec3 ul , um , un ; ul = ey ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( ud , 1.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"uj = uc ( ue , uf , ui ) ; uk = mix ( ug , uh , ui ) ; um = er ( uj , ul ) ; um = um * uk . w + uk . xyz ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"un = er ( ue , ul ) ; ul = er ( uf , ul ) ; un = un * ug . w + ug . xyz ; ul = ul * uh . w + uh . xyz ; um = mix ( un , ul , ui ) ;".split(" ")}]}}]},{type:"textline",b:"return eE ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( um , 1.0 ) ) ; } vec3 ux ( in vec3 up , in vec4 uq , in vec4 ur , in float us ) { vec4 ut ; vec3 uu , uv , uw ; uu = ey ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( up , 0.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"ut = uc ( uq , ur , us ) ; uv = er ( ut , uu ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uw = er ( uq , uu ) ; uu = er ( ur , uu ) ; uv = mix ( uw , uu , us ) ;".split(" ")}]}}]},{type:"textline",b:"return eE ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uv , 0.0 ) ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 uo ( in vec3 uy , in vec4 uz , in vec4 uA ) { vec3 uB ; uB = ey ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uy , 1.0 ) ) ; uB = er ( uz , uB ) ; uB = uB * uA . w + uA . xyz ; return eE ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uB , 1.0 ) ) ; } vec3 ux ( in vec3 uC , in vec4 uD ) { vec3 uE ; uE = ey ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uC , 0.0 ) ) ; uE = er ( uD , uE ) ; return eE ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uE , 0.0 ) ) ; }".split(" ")}]}}]},
{type:"textline",b:"void uT ( inout vec3 uF , inout vec3 uG , inout vec3 uH , inout vec3 uI ) { int uJ , uK ; vec4 uL ; vec3 uM , uN , uO , uP ; float uQ , uR ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uQ","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { uM = vec3 ( 0.0 , 0.0 , 0.0 ) ; uN = vec3 ( 0.0 , 0.0 , 0.0 ) ; uO = vec3 ( 0.0 , 0.0 , 0.0 ) ; uP = vec3 ( 0.0 , 0.0 , 0.0 ) ; uL = a_influence ; for ( int uS = 0 ; uS < 4 ; uS ++ ) { uJ = int ( uL [ uS ] ) ; uR = fract ( uL [ uS ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uM += uR * uo ( uF , u_quatsb [ uJ ] , u_quatsa [ uJ ] , u_transb [ uJ ] , u_transa [ uJ ] , uQ ) ; uN += uR * ux ( uG , u_quatsb [ uJ ] , u_quatsa [ uJ ] , uQ ) ; uO += uR * ux ( uH , u_quatsb [ uJ ] , u_quatsa [ uJ ] , uQ ) ; uP += uR * ux ( uI , u_quatsb [ uJ ] , u_quatsa [ uJ ] , uQ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uM += uR * uo ( uF , u_quatsb [ uJ ] , u_transb [ uJ ] ) ; uN += uR * ux ( uG , u_quatsb [ uJ ] ) ; uO += uR * ux ( uH , u_quatsb [ uJ ] ) ; uP += uR * ux ( uI , u_quatsb [ uJ ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} uF = uM ; uG = uN ; uH = uO ; uI = uP ; } if ( ! ( a_influence . y > 0.0 ) ) { uK = int ( a_influence [ 0 ] - 1.0 ) ; if ( uK > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uF = uo ( uF , u_quatsb [ uK ] , u_quatsa [ uK ] , u_transb [ uK ] , u_transa [ uK ] , uQ ) ; uG = ux ( uG , u_quatsb [ uK ] , u_quatsa [ uK ] , uQ ) ; uH = ux ( uH , u_quatsb [ uK ] , u_quatsa [ uK ] , uQ ) ; uI = ux ( uI , u_quatsb [ uK ] , u_quatsa [ uK ] , uQ ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"uF = uo ( uF , u_quatsb [ uK ] , u_transb [ uK ] ) ; uG = ux ( uG , u_quatsb [ uK ] ) ; uH = ux ( uH , u_quatsb [ uK ] ) ; uI = ux ( uI , u_quatsb [ uK ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void vd ( inout vec3 uU , in vec3 uV , in float uW , in float uX , in float uY , in vec3 uZ , in float u_ ) { vec3 va ; float vb , vc ; vb = length ( uV ) ; vc = uX * ( 1.0 + 0.1 * fract ( vb ) ) ; vb = uW * u_ * ( 1.0 + sin ( 2.0 * 3.14 * uY * vc + vb ) ) ; vc = ( uU . y - uV . y ) * abs ( vb ) ; vc += 1.0 ; vc *= vc ; vc = vc * vc - vc ; va = uU ; va . xz += uZ . xz * vc * sign ( vb ) ; va = va - uV ; if ( all ( equal ( va , vec3 ( 0.0 ) ) ) ) uU = uV ; else { vb = length ( uU - uV ) ; uU = uV + normalize ( va ) * vb ; } }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 vf ( vec4 ve ) { return ve * ve * ( 3.0 - 2.0 * ve ) ; } vec4 vh ( vec4 vg ) { return abs ( fract ( vg + 0.5 ) * 2.0 - 1.0 ) ; } vec4 vj ( vec4 vi ) { return vf ( vh ( vi ) ) ; } void vA ( inout vec3 vk , in float vl , in vec3 vm , in vec3 vn , in vec3 vo , in float vp , in float vq , in float vr , in vec3 vs ) { vec3 vt ; vec4 vu ; vec2 vv , vw ; float vx , vy , vz ; vx = dot ( vo , vec3 ( 1.0 ) ) ; vy = vx + vs . g ; vz = dot ( vk , vec3 ( vs . g ) ) ; vv = ( vl + vec2 ( vz , vy ) ) ; vu = ( ( fract ( ( vv . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( vn ) * vp ; vu = vj ( vu ) ; vw = vu . xz + vu . yw ; vw . y = 0.5 - vw . y ; vt = vw . xyx * vs . rbr * vec3 ( vq * vm . x , vr , vq * vm . z ) ; vk += vt ; }".split(" ")}]}}]},
{type:"textline",b:"void vH ( inout vec3 vB , inout vec3 vC , in vec3 vD ) { vec3 vE , vF , vG ; vE = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vF = vC ; vG = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vF = vB ; vG = vC ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vA ( vF , u_time , vD , vE , vG , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"vd ( vF , vG , au_wind_bending_amp , au_wind_bending_freq , u_time , vE , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vd ( vF , vG , au_wind_bending_amp , au_wind_bending_freq , u_time , vE , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vB += vF - vC ; vC = vF ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vB = vF ; vC = vG ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/nodes.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_orco_tex_coord ; varying vec3 hJ ;".split(" ")}]}}]},
{type:"node",name:"TEX_COORD_UV",i:[{type:"node_param",name:"node_TEX_COORD_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"ik",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["ik","=","node_TEX_COORD_UV_var_a_uv",";"]}]},{type:"node",name:"UV_MERGED",i:[{type:"node_param",name:"node_UV_MERGED_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"ij",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["ij","=","node_UV_MERGED_var_a_uv",";"]}]},{type:"node",
name:"UVMAP",i:[{type:"node_param",name:"node_UVMAP_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"il",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["il","=","node_UVMAP_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_UV",i:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"ic",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["ic","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",i:[{type:"node_param",
name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"vI",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["vI","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",i:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"vJ",qualifier:["varying","float"]}],g:[{type:"textline",b:["vJ","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",
i:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"vK",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["vK","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",i:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"vL",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["vL","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},
{type:"nodes_global"},{type:"textline",b:["void","vM","(",")","{"]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["hJ","=","a_orco_tex_coord",";"]}]}}]},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 vR ( vec3 vN , float vO , vec2 vP ) { vec2 vQ ; vQ = vec2 ( ( vN . x - vP . x ) / vO , - ( vN . z - vP . y ) / vO ) ; return fract ( vQ ) ; } vec2 vV ( vec2 vS , float vT , vec2 vU ) { return vec2 ( vS . x * vT , - vS . y * vT ) + vU ; } el vW ( ) { return el ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } el wr ( vec3 vX , vec3 vY , vec3 vZ , vec3 v_ , vec3 wa , PRECISION sampler2D wb , sampler2D wc , vec3 wd , float we , vec3 wf , vec4 wg , mat4 wh ) { mat4 wi ; vec4 wj ; vec2 wk , wl , wm ; float wn , wo ; vec3 wp ; wp = er ( wg , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; wn = - wp . x ; wo = - wp . z ; wk = vec2 ( wf . x + we * ( - 1.0 - wn ) / 2.0 , wf . z + we * ( 1.0 - wo ) / 2.0 ) ; wl = vR ( wa , we , wk ) ; wo = we / 2.0 ; wm = abs ( vV ( wl - vec2 ( 0.5 ) , we , vec2 ( 0.0 ) ) ) ; wo = wo * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( wm ) > wo ) return vW ( ) ; wo = we / wd . z ; wm = ( wl - vec2 ( 0.5 ) ) * wo + vec2 ( 0.5 ) ; wp = wp * ( we / wd . z - 1.0 ) / 2.0 ; wm . x += wp . x ; wm . y -= wp . z ; wj = texture2D ( wc , wm ) ; wo = wj . r ; if ( wo < u_scale_threshold ) return vW ( ) ; wn = wd . y - wd . x ; wn = wd . y - texture2D ( wb , wm ) . r * wn ; wm = vX . xz - wa . xz ; wa . xz = vV ( wl , we , wk ) ; wa . y = wn ; vX . xz = wa . xz + wm ; vX . y *= wo ; vX . y += wn ; wp = wj . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vX -= wa ; wi = tG ( wf , wa , wh ) ; el wq = tT ( vX , wa , vY , vZ , v_ , wi ) ; wq . b = wa ; wq . f = wp ; return eN ( wq ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return eN ( el ( vX , wa , vY , vZ , v_ , wp ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",
a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 wx ( mat4 ws , vec4 wt ) { vec4 wu ; float wv ; vec2 ww ; ww = ( ws * u_v_light_matrix [ 3 ] ) . xy ; wv = SHADOW_TEX_RES / 2.0 ; ww = floor ( ww * wv + 0.5 ) / wv - ww ; wu = ws * wt ; wu . xy += ww ; wu = u_b_light_matrix * wu ; return wu ; } void wB ( vec3 wy , vec3 wz ) { vec4 wA ; wA = u_v_light_matrix * vec4 ( wy + u_normal_offset * wz , 1.0 ) ; e_ = wx ( u_p_light_matrix0 , wA ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"fa = wx ( u_p_light_matrix1 , wA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"fb = wx ( u_p_light_matrix2 , wA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"fc = wx ( u_p_light_matrix3 , wA ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/particles.glslv"]=
{type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct wJ { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void wP ( inout float wK , float wL , vec2 wM , vec2 wN ) { float wO ; wO = wN . x - wM . x ; wO = ( wL - wM . x ) / wO ; wK = mix ( wK , wN . y , clamp ( wO , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void wV ( inout vec3 wQ , float wR , vec4 wS , vec4 wT ) { float wU ; wU = wT . x - wS . x ; wU = ( wR - wS . x ) / wU ; wQ = mix ( wQ , wT . yzw , clamp ( wU , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float xa ( float wW , float wX , vec2 wY [ SIZE_RAMP_LENGTH ] ) { float wZ , w_ ; wZ = wW / wX ; w_ = wY [ 0 ] . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wP ( w_ , wZ , wY [ 0 ] , wY [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wP ( w_ , wZ , wY [ 1 ] , wY [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wP ( w_ , wZ , wY [ 2 ] , wY [ 3 ] ) ;".split(" ")}]}}]},
{type:"textline",b:["return","w_",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 xg ( float xb , float xc , vec4 xd [ COLOR_RAMP_LENGTH ] ) { vec3 xe ; float xf ; xf = xb / xc ; xe = xd [ 0 ] . yzw ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wV ( xe , xf , xd [ 0 ] , xd [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["COLOR_RAMP_LENGTH",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wV ( xe , xf , xd [ 1 ] , xd [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wV ( xe , xf , xd [ 2 ] , xd [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","xe",";","}"]}]}}]},{type:"textline",b:"float xo ( float xh , float xi , float xj , float xk ) { float xl , xm , xn ; xl = max ( 0.01 , min ( xi , xj ) ) ; xm = max ( 0.01 , min ( xi , xk ) ) ; xn = xi - xm ; xm = clamp ( xh / xl , 0.0 , 1.0 ) - step ( xn , xh ) * ( xh - xn ) / xm ; return xm ; } wJ xu ( ) { vec3 xp , xq ; float xr , xs ; wJ xt ; if ( u_p_cyclic == 1 ) { xr = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( xr < 0.0 ) xr += u_p_length ; } if ( u_p_cyclic != 1 ) { xr = u_p_time - a_p_delay ; } if ( xr < 0.0 || xr >= a_p_lifetime ) { xt . a = 0.0001 ; xt . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( xr < 0.0 || xr >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"xp = a_position ; xq = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xp = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; xq = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"xp += u_p_nfactor * xr * xq ; xp += a_p_vels . xyz * xr ; xp . y -= u_p_gravity * xr * xr / 2.0 ; xs = max ( u_p_mass , EPSILON ) ; xp += ( u_p_wind / xs ) * xr * xr / 2.0 ; xt . b = xp ; xt . e = a_p_vels . w * xr ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xt . a = xa ( xr , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xt . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xt . d = xg ( xr , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"xt . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"xt . c = xo ( xr , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return xt ; }".split(" ")}]};a["include/blending.glslf"]={type:"group",a:[{type:"textline",b:"float xw = 0.0 ; float xx = 1.0 ; vec3 xy = vec3 ( xw ) ; vec3 xz = vec3 ( xx ) ; vec3 xE ( vec3 xA ) { float xB , xC ; vec4 xD ; xD = vec4 ( xw , - xx / 3.0 , 2.0 / 3.0 , - xx ) ; xD = mix ( vec4 ( xA . bg , xD . wz ) , vec4 ( xA . gb , xD . xy ) , step ( xA . b , xA . g ) ) ; xD = mix ( vec4 ( xD . xyw , xA . r ) , vec4 ( xA . r , xD . yzx ) , step ( xD . x , xA . r ) ) ; xB = xD . x - min ( xD . w , xD . y ) ; xC = 1.0e-10 ; return vec3 ( abs ( xD . z + ( xD . w - xD . y ) / ( 6.0 * xB + xC ) ) , xB / ( xD . x + xC ) , xD . x ) ; } vec3 xI ( vec3 xF ) { vec3 xG ; vec4 xH ; xH = vec4 ( xx , 2.0 / 3.0 , xx / 3.0 , 3.0 ) ; xG = abs ( fract ( vec3 ( xF . r , xF . r , xF . r ) + xH . xyz ) * 6.0 - xH . www ) ; return xF . b * mix ( xH . xxx , clamp ( xG - xH . xxx , xw , xx ) , xF . g ) ; } vec3 xM ( vec3 xJ , vec3 xK , float xL ) { return mix ( xJ , xK , xL ) ; } vec3 xQ ( vec3 xN , vec3 xO , float xP ) { return xP * xN + xO ; } vec3 xU ( vec3 xR , vec3 xS , float xT ) { return xS - xT * xR ; } vec3 xZ ( vec3 xV , vec3 xW , float xX ) { float xY ; xY = xx - xX ; return ( vec3 ( xY ) + xX * xV ) * xW ; } vec3 yd ( vec3 x_ , vec3 ya , float yb ) { vec3 yc ; yc = vec3 ( xx - yb ) ; return xz - ( yc + yb * ( xz - x_ ) ) * ( xz - ya ) ; } vec3 yi ( vec3 ye , vec3 yf , float yg ) { vec3 yh ; yh = vec3 ( xx - yg ) ; return mix ( yf * ( yh + 2.0 * yg * ye ) , xz - ( yh + 2.0 * yg * ( xz - ye ) ) * ( xz - yf ) , step ( 0.5 , yf ) ) ; } vec3 ym ( vec3 yj , vec3 yk , float yl ) { return mix ( yk , abs ( yj - yk ) , yl ) ; } vec3 yq ( vec3 yn , vec3 yo , float yp ) { return mix ( yo , yo / ( yn + step ( yn , xy ) ) , yp ) ; } vec3 yu ( vec3 yr , vec3 ys , float yt ) { return mix ( ys , min ( yr , ys ) , yt ) ; } vec3 yy ( vec3 yv , vec3 yw , float yx ) { return max ( yx * yv , yw ) ; } vec3 yE ( vec3 yz , vec3 yA , float yB ) { vec3 yC , yD ; yC = xE ( yA ) ; if ( yC . y != xw ) { yD = xE ( yz ) ; yD = xI ( vec3 ( yC . x , yD . yz ) ) ; return mix ( yz , yD , yB ) ; } return yz ; } vec3 yK ( vec3 yF , vec3 yG , float yH ) { vec3 yI , yJ ; yI = xE ( yF ) ; if ( yI . y != xw ) { yJ = xE ( yG ) ; return xI ( vec3 ( yI . x , mix ( yI . y , yJ . y , yH ) , yI . z ) ) ; } return yF ; } vec3 yQ ( vec3 yL , vec3 yM , float yN ) { vec3 yO , yP ; yO = xE ( yL ) ; yP = xE ( yM ) ; return xI ( vec3 ( yO . xy , mix ( yO . z , yP . z , yN ) ) ) ; } vec3 yW ( vec3 yR , vec3 yS , float yT ) { vec3 yU , yV ; yU = xE ( yS ) ; if ( yU . y != xw ) { yV = xE ( yR ) ; yV = xI ( vec3 ( yU . xy , yV . z ) ) ; return mix ( yR , yV , yT ) ; } return yR ; } vec3 za ( vec3 yX , vec3 yY , float yZ ) { vec3 y_ ; y_ = xz - ( xz - yY ) * ( xz - yX ) ; return mix ( yX , ( ( xz - yX ) * yY * yX ) + yX * y_ , yZ ) ; } vec3 ze ( vec3 zb , vec3 zc , float zd ) { return zb + zd * ( 2.0 * zc - xx ) ; } float zk ( float zf , float zg , float zh , float zi ) { float zj ; zj = xx - zi ; return ( zj + zh * zf ) * zg ; } float zq ( float zl , float zm , float zn , float zo ) { float zp ; zp = xx - zo ; return xx - ( zp + zn * ( xx - zl ) ) * ( xx - zm ) ; } float zw ( float zr , float zs , float zt , float zu ) { float zv ; zv = xx - zu ; return mix ( zs * ( zv + 2.0 * zt * zr ) , xx - ( zv + 2.0 * zt * ( xx - zr ) ) * ( xx - zs ) , step ( 0.5 , zs ) ) ; }".split(" ")}]};
a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float zI ( in sampler2D zC , in vec2 zD , in vec2 zE ) { float zF , zG , zH ; zF = texture2D ( zC , zD ) . r ; zG = zE . x ; zH = zE . y ; zG = 2.0 * zG / ( zG + zH - ( 2.0 * zF - 1.0 ) * ( zH - zG ) ) ; return zG ; }".split(" ")}]}};b4w.module.animation=function(a,p){var c=p("__animation"),d=p("__constraints");p("__physics");var b=p("__print"),e=p("__util");a.SLOT_0=c.SLOT_0;a.SLOT_1=c.SLOT_1;a.SLOT_2=c.SLOT_2;a.SLOT_3=c.SLOT_3;a.SLOT_4=c.SLOT_4;a.SLOT_5=c.SLOT_5;a.SLOT_6=c.SLOT_6;a.SLOT_7=c.SLOT_7;a.SLOT_ALL=c.SLOT_ALL;a.OBJ_ANIM_TYPE_NONE=c.OBJ_ANIM_TYPE_NONE;a.OBJ_ANIM_TYPE_ARMATURE=c.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=c.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=c.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=c.OBJ_ANIM_TYPE_SOUND;
a.OBJ_ANIM_TYPE_PARTICLES=c.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=c.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=c.AB_CYCLIC;a.AB_FINISH_RESET=c.AB_FINISH_RESET;a.AB_FINISH_STOP=c.AB_FINISH_STOP;var g=new Float32Array(4);a.is_animated=function(a){return c.is_animated(a)};a.get_actions=function(){b.error("get_actions() deprecated, use get_anim_names() instead");for(var a=[],d=c.Aq(),e=0;e<d.length;e++)a.push(c.xB(d[e].name));return a};a.get_current_action=function(c,d){b.error("get_current_action() deprecated, use get_current_anim_name() instead");
return a.get_current_anim_name(c,d)};a.get_anim_names=function(a){return c.ik(a)?c.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.jy(a,b)};a.apply=function(a,d,e){if(e>c.SLOT_7)b.error("Can't apply animation to slot "+e+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{e=e||c.SLOT_0;if(c.is_animated(a)){var f=c.get_slot_num_by_anim(a,d);if(-1!=f&&f!=e){b.error('Animation "'+d+'" is already applied to object "'+
a.name+'" (slot "'+f+'").');return}}c.AC(a,d)?c.apply(a,d,e):b.error('No fcurves in action "'+d+'"')}};a.remove=function(a){c.remove(a)};a.remove_slot_animation=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.remove_slot_animation(a,b))};a.apply_def=function(a){c.apply_def(a)};a.play=function(a,d,e){c.is_animated(a)?(e=e||c.SLOT_0,c.play(a,d,e),c.update_object_animation(a,0,e,!0)):b.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.stop(a,
b))};a.is_play=function(a,b){if(!c.is_animated(a))return!1;b=b||c.SLOT_0;return c.is_play(a,b)};a.set_current_frame_float=function(c,d,e){b.error("set_current_frame_float() deprecated, use set_frame() instead");a.set_frame(c,d,e)};a.get_current_frame_float=function(c,d){b.error("get_current_frame_float() deprecated, use get_frame() instead");return a.get_frame(c,d)};a.set_frame=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_frame(a,b,d))};a.set_first_frame=function(a,b){if(c.is_animated(a)){b=
b||c.SLOT_0;var d=c.get_anim_start_frame(a,b);c.set_frame(a,d,b)}};a.set_last_frame=function(a,b){if(c.is_animated(a)){b=b||c.SLOT_0;var d=c.get_anim_start_frame(a,b),e=c.get_anim_length(a,b);c.set_frame(a,d+e-c.Yt,b)}};a.get_frame=function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return c.get_current_frame_float(a,b)};a.set_speed=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_speed(a,b||1,d))};a.get_speed=function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return a.C[b]?c.get_speed(a,
b):0};a.get_frame_range=function(a,d){b.error("get_frame_range() deprecated, use get_anim_start_frame() and get_anim_length() instead");if(c.is_animated(a)){d=d||c.SLOT_0;var e=a.C[d];if(e)return[e.start,e.start+e.length]}return null};a.get_anim_start_frame=function(a,b){return c.is_animated(a)&&(b=b||c.SLOT_0,a.C[b])?c.get_anim_start_frame(a,b):-1};a.get_anim_length=function(a,b){return c.is_animated(a)&&(b=b||c.SLOT_0,a.C[b])?c.get_anim_length(a,b):-1};a.cyclic=function(d,e,g){b.error("cyclic() deprecated, use set_behavior() instead");
a.set_behavior(d,e?c.AB_CYCLIC:c.AB_FINISH_RESET,g)};a.is_cyclic=function(a,d){b.error("is_cyclic() deprecated, use get_behavior() instead");if(!c.is_animated(a))return!1;d=d||c.SLOT_0;return c.is_cyclic(a,d)};a.set_behavior=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_behavior(a,b,d))};a.get_behavior=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.get_behavior(a,b)};a.apply_smoothing=function(a,b,d,e){e=e||c.SLOT_0;c.is_animated(a)&&c.apply_smoothing(a,b,d,e)};a.update_object_animation=
function(a,b,d,e){c.is_animated(a)&&(d=d||c.SLOT_0,c.update_object_animation(a,b||0,d,e||!1))};a.frame_to_sec=function(a){return c.frame_to_sec(a)};a.get_bone_translation=function(a,b,c){if(!e.is_armature(a))return null;c||(c=new Float32Array(3));d.ny(a,b,!1,g,null);c[0]=g[0];c[1]=g[1];c[2]=g[2];return c};a.get_first_armature_object=function(a){return e.is_mesh(a)?c.get_first_armature_object(a):null};a.get_slot_num_by_anim=function(a,b){return c.is_animated(a)&&b?c.get_slot_num_by_anim(a,b):null};
a.get_anim_type=function(a,b){return c.is_animated(a)?c.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return c.apply_to_first_empty_slot(a,b)};a.get_skel_mix_factor=function(a){return a.e.He};a.set_skel_mix_factor=function(a,d,g){e.is_armature(a)?(d=Math.min(Math.max(d,0),1),a.e.He!=d&&c.set_skel_mix_factor(a,d,g||0)):b.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,p){var c=p("__anchors");p("__print");a.attach_move_cb=c.attach_move_cb;a.detach_move_cb=c.detach_move_cb;a.is_anchor=c.is_anchor;a.get_element_id=c.get_element_id};b4w.module.assets=function(a,p){var c=p("__assets");a.AT_ARRAYBUFFER=c.AT_ARRAYBUFFER;a.AT_JSON=c.AT_JSON;a.AT_TEXT=c.AT_TEXT;a.AT_AUDIOBUFFER=c.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=c.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=c.AT_AUDIO_ELEMENT;a.enqueue=function(a,b,e){c.enqueue(a,b,e)}};b4w.module.camera=function(a,p){function c(a,c){if(b.is_camera(a))return c||(c=new Float32Array(3)),l.copy(a.e.h,c),c;h.error("get_eye(): Wrong object")}function d(a,c){b.is_target_camera(a)?(l.copy(c,a.e.Lb),n.v(a),g.sync_transform(a)):h.error("set_pivot(): Wrong object or camera move style")}var b=p("__camera");p("__config");var e=p("__container"),g=p("__physics"),h=p("__print"),k=p("__constraints"),n=p("__transform"),f=p("__util"),l=p("vec3"),t=p("vec4");p("quat");var x=p("mat3"),z=p("mat4"),D=
new Float32Array(2),A=new Float32Array(3),H=new Float32Array(3),u=new Float32Array(4),y=new Float32Array(9);a.MS_STATIC=b.MS_STATIC;a.MS_ANIMATION=b.MS_STATIC;a.MS_TARGET_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=b.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=b.MS_HOVER_CONTROLS;a.is_camera=b.is_camera;a.is_target_camera=b.is_target_camera;a.is_eye_camera=b.is_eye_camera;a.is_hover_camera=b.is_hover_camera;a.set_move_style=function(a,d){if(!b.is_camera(a))return h.error("set_move_style(): Wrong object"),
!1;if(d!=b.MS_STATIC&&d!=b.MS_EYE_CONTROLS&&d!=b.MS_HOVER_CONTROLS&&d!=b.MS_TARGET_CONTROLS)return h.error("set_move_style(): Wrong camera move style"),!1;a.e.wa=d;a.e.Rb=null;a.e.Yb=null;a.e.yb=null;a.e.Ya=!1;b.Wy(a);switch(d){case b.MS_TARGET_CONTROLS:var e=c(a,A),k=f.quat_to_dir(a.e.quat,f.AXIS_MY,H),e=l.scaleAndAdd(e,k,10,k);l.copy(e,a.e.Lb)}n.v(a);g.sync_transform(a);return!0};a.get_move_style=function(a){return b.is_camera(a)?b.get_move_style(a):(h.error("get_move_style(): Wrong object"),null)};
a.set_velocity_params=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return h.error("set_velocity_params(): Wrong object or camera move style"),null;var d=a.e;d.yo=f.clamp(c[0],0,Infinity);d.xo=f.clamp(c[1],0,Infinity);d.zo=f.clamp(c[2],0,1)};a.get_velocity_params=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return h.error("get_velocity_params(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));var d=a.e;
c[0]=d.yo;c[1]=d.xo;c[2]=d.zo;return c};a.set_look_at=function(a,c,d,e){var f=a.e;b.Jx(c,d,e,f.h,f.quat);n.v(a);g.sync_transform(a)};a.get_eye=c;a.set_pivot=d;a.set_trans_pivot=function(a,c,d){b.is_target_camera(a)?(l.copy(c,a.e.h),l.copy(d,a.e.Lb),n.v(a),g.sync_transform(a)):h.error("set_trans_pivot(): Wrong object or camera move style")};a.get_pivot=function(a,c){if(b.is_target_camera(a))return c||(c=new Float32Array(3)),l.copy(a.e.Lb,c),c;h.error("get_pivot(): Wrong object or camera move style")};
a.rotate_pivot=function(b,c,d){h.error("rotate_pivot() deprecated, use rotate_camera() or rotate_target_camera() instead");a.rotate_target_camera(b,c,d)};a.move_pivot=function(a,c,d){if(b.is_target_camera(a)){var e=a.e;if(e.qt){var f=x.fromMat4(e.V,y),k=l.subtract(e.h,e.Lb,H);A[0]=c;A[1]=0;A[2]=d;l.scale(A,l.len(k),A);l.transformMat3(A,f,A);l.add(e.Lb,A,e.Lb);l.add(e.h,A,e.h);n.v(a);g.sync_transform(a)}}else h.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(b,c){h.error("rotate_hover_cam() deprecated, use rotate_camera() or rotate_hover_camera() instead");
a.rotate_hover_camera(b,c,0)};a.get_hover_cam_angle=function(a){h.error("get_hover_cam_angle() deprecated, use get_camera_angles() instead");return b.is_hover_camera(a)?-b.get_camera_angles(a,D)[1]:(h.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.set_hover_cam_angle=function(a,c){h.error("set_hover_cam_angle() deprecated, use rotate_camera() or rotate_hover_camera() instead");if(b.is_hover_camera(a))if(a.e.Ya){var d=b.get_camera_angles(a,D);(d=-c-d[1])&&b.rotate_hover_camera(a,
0,d);n.v(a);g.sync_transform(a)}else h.error("set_hover_cam_angle(): distance/hover_angle limits are not defined or disabled");else h.error("set_hover_cam_angle(): wrong object or camera move style")};a.get_hover_angle_limits=function(a,c){if(b.is_hover_camera(a))return a.e.yb?(c||(c=new Float32Array(2)),c[0]=a.e.yb.Ma,c[1]=a.e.yb.Xa):h.error("get_hover_angle_limits(): camera hasn't angle limits"),c;h.error("get_hover_angle_limits(): wrong object")};a.get_cam_dist_limits=function(a,c){if(b.is_hover_camera(a)||
b.is_target_camera(a))return a.e.Ya?(c||(c=new Float32Array(2)),c[0]=a.e.Of,c[1]=a.e.ce):h.error("get_cam_dist_limits(): camera hasn't distance limits"),c;h.error("get_cam_dist_limits(): wrong object")};a.translate_hover_cam_v=function(b,c){h.error("translate_hover_cam_v() deprecated, use hover_cam_set_translation() instead");a.hover_cam_set_translation(b,c)};a.hover_cam_set_translation=function(a,c){if(b.is_hover_camera(a)){var d=a.e;if(d.Ya){var e=l.subtract(c,d.h,A);l.add(e,d.Sb,d.Sb)}n.set_translation(a,
c);n.v(a);g.sync_transform(a)}else h.error("hover_cam_set_translation(): wrong object")};a.set_hover_pivot=function(a,c){if(b.is_hover_camera(a)){var d=a.e;if(d.Ya&&d.yb){var e=l.subtract(c,d.Sb,A),e=l.add(e,d.h,e);n.set_translation(a,e)}l.copy(c,d.Sb);n.v(a);g.sync_transform(a)}else h.error("set_hover_pivot(): Wrong object or camera move style")};a.get_hover_cam_pivot=function(a,c){if(!b.is_hover_camera(a))return h.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));l.copy(a.e.Sb,
c);return c};a.has_distance_limits=function(a){return b.is_target_camera(a)||b.is_hover_camera(a)?a.e.Ya:(h.error("has_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,c,d,e){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:e|=n.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>d){h.error("apply_vertical_limits(): wrong vertical limits");return}break;default:h.error("apply_vertical_limits(): wrong object");return}a.e.Yb={Ma:c,Xa:d};b.cA(a,e==n.SPACE_LOCAL);
n.v(a);g.sync_transform(a)};a.clear_vertical_limits=function(a){a.e.Yb=null};a.get_vertical_limits=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return h.error("get_vertical_limits(): wrong object"),null;var d=a.e;c=c||new Float32Array(2);return d.Yb?(c[0]=d.Yb.Ma,c[1]=d.Yb.Xa,c):null};a.has_vertical_limits=function(a){if(b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a))return Boolean(a.e.Yb);h.error("has_vertical_limits(): wrong object")};a.apply_horizontal_limits=
function(a,c,d,e){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:e|=n.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>d){h.error("apply_horizontal_limits(): wrong horizontal limits");return}break;default:h.error("apply_horizontal_limits(): wrong object");return}a.e.Rb={left:c,right:d};b.Zz(a,e==n.SPACE_LOCAL);n.v(a);g.sync_transform(a)};a.clear_horizontal_limits=function(a){a.e.Rb=null};a.get_horizontal_limits=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&
!b.is_hover_camera(a))return h.error("get_horizontal_limits(): wrong object"),null;var d=a.e;c=c||new Float32Array(2);return d.Rb?(c[0]=d.Rb.left,c[1]=d.Rb.right,c):null};a.has_horizontal_limits=function(a){if(b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a))return Boolean(a.e.Rb);h.error("has_horizontal_limits(): wrong object")};a.apply_hover_angle_limits=function(a,c,d){b.is_hover_camera(a)?c<d?h.error("apply_hover_angle_limits(): wrong hover angle limits"):(c=f.angle_wrap_periodic(c,
-Math.PI,Math.PI),d=f.angle_wrap_periodic(d,-Math.PI,Math.PI),c=f.clamp(c,-Math.PI/2,0),d=f.clamp(d,-Math.PI/2,0),a.e.yb={Ma:c,Xa:d},b.Vy(a),n.v(a),g.sync_transform(a)):h.error("apply_hover_angle_limits(): wrong object")};a.clear_hover_angle_limits=function(a){b.is_hover_camera(a)?a.e.yb=null:h.error("clear_hover_angle_limits(): wrong object")};a.apply_distance_limits=function(a,c,d){if(b.is_target_camera(a)||b.is_hover_camera(a))if(c>d)h.error("apply_distance_limits(): wrong distance limits");else{var e=
a.e;e.Ya=!0;e.ce=c;e.Of=d;n.v(a);g.sync_transform(a)}else h.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){b.is_target_camera(a)||b.is_hover_camera(a)?a.e.Ya=!1:h.error("clear_distance_limits(): wrong object")};a.set_eye_params=function(b,c,d){h.error("set_eye_params() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,Math.PI/2-d)};a.is_look_up=function(a){f.quat_to_dir(a.e.quat,f.AXIS_MY,A);return 0<=A[1]?!0:!1};a.rotate_camera=
function(c,d,e,f,k){switch(a.get_move_style(c)){case b.MS_STATIC:break;case b.MS_TARGET_CONTROLS:b.rotate_target_camera(c,d,e,f,k);break;case b.MS_EYE_CONTROLS:b.rotate_eye_camera(c,d,e,f,k);break;case b.MS_HOVER_CONTROLS:b.rotate_hover_camera(c,d,e,f,k);break;default:h.error("rotate_camera(): Wrong object")}n.v(c);g.sync_transform(c)};a.rotate_target_camera=function(a,c,d,e,f){b.is_target_camera(a)?(b.rotate_target_camera(a,c,d,e,f),n.v(a),g.sync_transform(a)):h.error("rotate_target_camera(): wrong object")};
a.rotate_eye_camera=function(a,c,d,e,f){b.is_eye_camera(a)?(b.rotate_eye_camera(a,c,d,e,f),n.v(a),g.sync_transform(a)):h.error("rotate_eye_camera(): wrong object")};a.rotate_hover_camera=function(a,c,d,e,f){b.is_hover_camera(a)?(b.rotate_hover_camera(a,c,d,e,f),n.v(a),g.sync_transform(a)):h.error("rotate_hover_camera(): wrong object")};a.rotate=function(b,c,d){h.error("rotate() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,-d)};a.get_camera_angles=function(a,
c){c||(c=new Float32Array(2));b.get_camera_angles(a,c);return c};a.get_camera_angles_char=function(a,c){c||(c=new Float32Array(2));b.get_camera_angles_char(a,c);return c};a.get_angles=function(a,c){h.error("get_angles() deprecated, use get_camera_angles() instead");c||(c=new Float32Array(2));b.get_angles(a,c);return c};a.set_stereo_distance=function(a,c){for(var d=a.e.I,e=0;e<d.length;e++){var f=d[e];f.type!=b.ub&&f.type!=b.Cb||b.QA(f,c,f.Ed)}};a.get_stereo_distance=function(a){a=a.e.I;for(var c=
0;c<a.length;c++){var d=a[c];if(d.type==b.ub||d.type==b.Cb)return d.cj}return 0};a.is_underwater=function(a){h.error("is_underwater() deprecated, always returns false");return a.e.it};a.translate_view=function(a,c,d,e){a=a.e.I;for(var f=0;f<a.length;f++){var g=a[f];g.ec||b.gf(g,g.za);var h=A;h[0]=-c;h[1]=-d;h[2]=0;z.translate(g.ta,h,g.ta);z.rotateZ(g.ta,e,g.ta);z.multiply(g.ta,g.qa,g.Jd);b.vp(g);b.Ol(g)}};a.get_fov=function(a){return f.Jk(a.e.I[0].vc)};a.set_fov=function(a,c){for(var d=a.e.I,e=0;e<
d.length;e++){var g=d[e];g.vc=f.nx(c);g.ec||b.gf(g,g.za);z.multiply(g.ta,g.qa,g.Jd);b.vp(g);b.Ol(g)}};a.correct_up=function(a,b){b||(b=f.AXIS_Y);k.correct_up(a,b)};a.zoom_object=function(a,c){if(b.is_target_camera(a)){n.get_object_center(c,!1,A);d(a,A);n.v(a);var e=n.get_object_size(c),f=b.iy(a)/2,e=e/Math.sin(f),f=n.Mz(a,A);n.move_local(a,0,e-f,0);n.v(a);g.sync_transform(a)}else h.error("zoom_object(): wrong object")};a.set_ortho_scale=function(c,d){if(b.is_camera(c)&&a.is_ortho_camera(c)){var e=
c.e;if(b.is_target_camera(c)){var f=l.dist(e.h,e.Lb);e.hh=d/2*e.gh/f}else b.is_hover_camera(c)&&a.has_distance_limits(c)?(f=l.distance(e.h,e.Sb),e.hh=d/2*e.gh/f):c.e.I[0].top=d/2;b.fC(c)}else h.error("set_ortho_scale(): wrong object")};a.get_ortho_scale=function(c){if(b.is_camera(c)&&a.is_ortho_camera(c))return 2*c.e.I[0].top;h.error("get_ortho_scale(): wrong object")};a.is_ortho_camera=function(a){if(b.is_camera(a))return a.e.I[0].type==b.Lc;h.error("is_ortho_camera(): wrong object")};a.calc_ray=
function(a,c,d,f){f||(f=new Float32Array(3));var g=a.e.I[0];switch(g.type){case b.Hb:case b.Od:case b.ub:case b.Cb:var k=Math.tan(g.vc*Math.PI/360),n=k*g.za;c=e.Ql(c,d,D,g);u[0]=(2*c[0]/g.width-1)*n;u[1]=-1;u[2]=(2*c[1]/g.height-1)*k;u[3]=0;t.transformMat4(u,a.e.V,u);f[0]=u[0];f[1]=u[1];f[2]=u[2];l.normalize(f,f);return f;default:return h.error("Non-compatible camera"),f}};a.project_point=function(a,c,d){d||(d=new Float32Array(2));return b.project_point(a,c,d)}};b4w.module.config=function(a,p){var c=p("__config");a.P_LOW=c.P_LOW;a.P_HIGH=c.P_HIGH;a.P_ULTRA=c.P_ULTRA;a.P_CUSTOM=c.P_CUSTOM;a.set=c.set;a.get=c.get;a.reset=c.reset;a.get_std_assets_path=c.get_std_assets_path};b4w.module.controls=function(a,p){var c=p("__controls"),d=p("__print");a.CT_CONTINUOUS=c.CT_CONTINUOUS;a.CT_TRIGGER=c.CT_TRIGGER;a.CT_SHOT=c.CT_SHOT;a.CT_LEVEL=c.CT_LEVEL;a.CT_CHANGE=c.CT_CHANGE;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_A=
65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;
a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=c.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=c.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=c.PL_MULTITOUCH_MOVE_PAN;a.create_custom_sensor=c.create_custom_sensor;a.create_keyboard_sensor=c.create_keyboard_sensor;a.create_collision_sensor=function(a,d,g){return c.create_collision_sensor(a,d||"ANY",
g||!1)};a.create_collision_impulse_sensor=c.create_collision_impulse_sensor;a.create_ray_sensor=function(a,d,g,h,k,n,f){return c.create_ray_sensor(a,d,g,h||"ANY",k||!1,n||!1,f||!1)};a.create_mouse_click_sensor=c.create_mouse_click_sensor;a.create_mouse_wheel_sensor=c.create_mouse_wheel_sensor;a.create_mouse_move_sensor=c.create_mouse_move_sensor;a.create_touch_move_sensor=c.create_touch_move_sensor;a.create_touch_zoom_sensor=c.create_touch_zoom_sensor;a.create_motion_sensor=c.create_motion_sensor;
a.create_vertical_velocity_sensor=c.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=c.create_gyro_angles_sensor;a.create_gyro_delta_sensor=c.create_gyro_delta_sensor;a.create_timer_sensor=function(a,d){return c.create_timer_sensor(a,d||!1)};a.reset_timer_sensor=c.reset_timer_sensor;a.create_elapsed_sensor=c.create_elapsed_sensor;a.create_timeline_sensor=c.create_timeline_sensor;a.create_selection_sensor=function(a,d){return c.create_selection_sensor(a,d||!1)};a.set_custom_sensor=function(a,
d){c.DA(a,d)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=c.get_sensor_value;a.get_sensor_payload=c.get_sensor_payload;a.create_sensor_manifold=function(a,d,g,h,k,n,f){k=k||c.$p;c.create_sensor_manifold(a,d,g,h,k,n,void 0===f?null:f)};a.create_kb_sensor_manifold=function(a,d,g,h,k,n){h=c.create_keyboard_sensor(h);c.create_sensor_manifold(a,d,g,[h],c.$p,k,void 0===n?null:n)};a.check_sensor_manifolds=function(a){return c.check_sensor_manifold(a,null)};a.check_sensor_manifold=
c.check_sensor_manifold;a.remove_sensor_manifolds=function(a){d.error("remove_sensor_manifolds() deprecated, use remove_sensor_manifold() instead");c.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=c.remove_sensor_manifold;a.reset=c.reset;a.register_keyboard_events=c.register_keyboard_events;a.register_mouse_events=function(a,d,g){c.register_mouse_events(a,d,!!g)};a.register_wheel_events=c.register_wheel_events;a.register_touch_events=c.register_touch_events;a.register_device_orientation=
c.register_device_orientation;a.unregister_keyboard_events=c.unregister_keyboard_events;a.unregister_mouse_events=c.unregister_mouse_events;a.unregister_wheel_events=c.unregister_wheel_events;a.unregister_touch_events=c.unregister_touch_events;a.unregister_device_orientation=c.unregister_device_orientation};b4w.module.constraints=function(a,p){var c=p("__camera"),d=p("__constraints"),b=p("__physics"),e=p("__print"),g=p("__transform");a.append_stiff=function(a,c,e,f,l){l=l||1;c instanceof Array&&2==c.length?d.bp(a,c[0],c[1],e,f,l):d.wl(a,c,e,f,l);g.v(a);b.sync_transform(a)};a.append_semi_stiff=function(a,c,e,f){d.ov(a,c,e,f);g.v(a);b.sync_transform(a)};a.append_semi_stiff_cam=function(a,k,n,f,l,t,p,z){if(!c.is_eye_camera(a))return e.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented."),
null;d.nv(a,k,n,f,l,t,p,z);g.v(a);b.sync_transform(a)};a.append_semi_soft_cam=function(a,k,n,f){if(!c.is_eye_camera(a))return e.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented."),null;if(!f||0>f)f=.25;d.mv(a,k,n,f);g.v(a);b.sync_transform(a)};a.append_stiff_trans=function(a,c,e){d.pv(a,c,e);g.v(a);b.sync_transform(a)};a.append_copy_trans=function(a,c,e){d.iv(a,c,e);g.v(a);b.sync_transform(a)};a.append_stiff_trans_rot=function(a,c,e,f){d.qv(a,c,e,f);g.v(a);
b.sync_transform(a)};a.append_track=function(a,c){3==c.length?d.tv(a,c):d.sv(a,c);g.v(a);b.sync_transform(a)};a.append_follow=function(a,c,e,f){3==c.length?d.kv(a,c,e,f):d.jv(a,c,e,f);g.v(a);b.sync_transform(a)};a.append_stiff_viewport=function(a,c,e){d.append_stiff_viewport(a,c,e);g.v(a);b.sync_transform(a)};a.remove=function(a){a.$a&&d.remove(a)};a.get_parent=d.get_parent};b4w.module.container=function(a,p){var c=p("__container"),d=p("__print");a.get_canvas=c.get_canvas;a.get_container=c.get_container;a.insert_to_container=function(a,e){2!=arguments.length?d.error("insert_to_container(): two arguments required"):a&&e&&c.insert_to_container(a,e)};a.set_canvas_offsets=c.set_canvas_offsets;a.update_canvas_offsets=c.update_canvas_offsets;a.client_to_canvas_coords=c.client_to_canvas_coords;a.force_offsets_updating=c.force_offsets_updating};b4w.module.data=function(a,p){var c=p("__data");p("__print");p("__util");a.load=c.load;a.unload=function(a){c.unload(a|0)};a.set_debug_resources_root=c.set_debug_resources_root;a.is_primary_loaded=c.is_primary_loaded;a.load_and_add_new=c.load;a.cleanup=a.unload};b4w.module.debug=function(a,p){function c(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function d(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);c.send(b);
if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function b(a){a.sort(function(a,b){return b.Em.ALU_OPS-a.Em.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.Em,g=c.GC,h=e(c.cx),h=h?"\t\t("+h.join(", ")+")":"\t\t(NA)";f.groupCollapsed("FRAG --\x3e","ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",g.ALU_OPS,"TEX",g.TEX_OPS,h);f.groupCollapsed("directives");for(var h=c.Ab.Oe,k=0;k<h.length;k++){var l=h[k];f.log(l[0],l[1])}f.groupEnd();f.groupCollapsed("vert src");
f.log(c.FC);f.groupEnd();f.groupCollapsed("vert stats");for(var n in g)"ALU_OPS"!=n&&"TEX_OPS"!=n&&f.log(n,g[n]);f.groupEnd();f.groupCollapsed("frag src");f.log(c.Tx);f.groupEnd();f.groupCollapsed("frag stats");for(n in d)"ALU_OPS"!=n&&"TEX_OPS"!=n&&f.log(n,d[n]);f.groupEnd();f.groupEnd()}}function e(a){for(var b=l.zi(),c=0;c<b.length;c++)for(var d=l.Ia(b[c],"MESH",l.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if(f.o)for(var g=0;g<f.o.length;g++){var h=f.o[g];if(h.Xb==a&&h.Sc.length)return h.Sc}}return null}
p("__batch");p("__config");var g=p("__controls"),h=p("__debug"),k=p("__extensions"),n=p("__physics"),f=p("__print"),l=p("__scenes"),t=p("__scenegraph"),x=p("__shaders"),z=p("__sfx"),D=p("__textures"),A=p("__util"),H=p("vec3");a.physics_stats=function(){n.jx()};a.physics_id=function(a){f.log("O",n.Lx(a));for(var b=n.hy().n.q,c=0;c<b.length;c++){var d=b[c];d.Wa.H==a&&f.log("B",d)}};a.visible_objects=function(){for(var a=l.get_active(),b=l.Ia(a,"MESH",l.DATA_ID_ALL),a=[l.Z(a,"MAIN_OPAQUE"),l.Z(a,"MAIN_BLEND")],
c=0;c<a.length;c++){var d=a[c],e=d.q;if(e.length){f.group(d.type,"DYNAMIC");for(var g=0;g<b.length;g++){var h=b[g],k=h.e;if("DYNAMIC"==k.type)for(var n=0;n<e.length;n++){var t=e[n];if(t.Ra&&t.cd==k){f.nn(h.name,h);break}}}f.groupEnd();f.groupCollapsed(d.type,"STATIC");for(g=0;g<b.length;g++)if(h=b[g],k=h.e,"DYNAMIC"!=k.type)for(n=0;n<e.length;n++)if(t=e[n],t.Ra&&t.cd==k){f.nn(h.name,h);break}f.groupEnd()}}};a.object_info=function(a){for(var b=l.get_active(),c=l.Ia(b,"MESH",l.DATA_ID_ALL),d=0;d<c.length;d++){var e=
c[d];if(e.name==a){f.log("Object",e);for(var g=l.Hm(b),h=0;h<g.length;h++){for(var k=g[h],n=k.q,t=[],p=0;p<n.length;p++)n[p].cd==e.e&&t.push(n[p]);f.log("Subscene "+k.type,t)}}}};a.objects_stat=function(){var a=l.get_active();console.log("Armatures: "+l.Ia(a,"ARMATURE",l.DATA_ID_ALL).length);console.log("Cameras: "+l.Ia(a,"CAMERA",l.DATA_ID_ALL).length);console.log("Curves: "+l.Ia(a,"CURVE",l.DATA_ID_ALL).length);console.log("Empties: "+l.Ia(a,"EMPTY",l.DATA_ID_ALL).length);console.log("Lamps: "+
l.Ia(a,"LAMP",l.DATA_ID_ALL).length);console.log("Meshes: "+l.Ia(a,"MESH",l.DATA_ID_ALL).length);console.log("Speakers: "+l.Ia(a,"SPEAKER",l.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=l.get_active(),b=[l.Z(b,"MAIN_OPAQUE"),l.Z(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.q,e=0;e<d.length;e++){var f=d[e].B;f&&(a+=f.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=l.get_active(),b=[l.Z(b,"MAIN_OPAQUE"),l.Z(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=
b[c];if(d)for(var d=d.q,e=0;e<d.length;e++){var f=d[e].B;f&&(a+=f.num_triangles)}}return a};a.num_draw_calls=function(){var a=l.get_active(),a=[l.Z(a,"MAIN_OPAQUE"),l.Z(a,"MAIN_BLEND")];return a[0].q.length+a[1].q.length};a.num_shaders=function(){return A.wd(x.Dq())};a.geometry_stats=function(){for(var a=l.get_active(),b=l.Hm(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.q,f=0;f<e.length;f++){var g=e[f].B,h=e[f].cd;g&&("COLOR_PICKING"!=d.type&&"OUTLINE_MASK"!=
d.type||h.xk||h.wk)&&(a[g.id]=g)}}var e=d=c=b=0,k;for(k in a)g=a[k],g=g.T,g.Sj&&(d++,e+=g.Sj/1048576),b++,c+=g.Zp/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=l.get_active(),c=[l.Z(c,"MAIN_OPAQUE"),l.Z(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=e.q,f=0;f<e.length;f++){var g=e[f].B;if(g)for(var g=g.M,h=0;h<g.length;h++){var k=g[h];if("IMAGE"===k.source||"ENVIRONMENT_MAP"===k.source){var n=k.Za;-1===a.indexOf(n)&&
(a.push(n),k=k.width*k.height*4/1048576/k.Zl,k*=1.3333,b+=k)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=l.get_active(),c=l.Hm(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var f=e.j,g=[f.hb,f.Pc];g.push.apply(g,e.Fd);for(e=0;e<g.length;e++){var h=g[e];D.Fi(h)&&-1==a.indexOf(h)&&(a.push(h),b+=f.width*f.height*D.Gy(h))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=l.get_active();(a=l.Z(a,"MAIN_OPAQUE"))&&
l.wr(a.j,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=l.get_active(),b=l.Z(a,"MAIN_OPAQUE"),a=l.CB(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}l.wr(d.j,b,e)}};a.scenegraph_to_dot=function(){for(var a=l.zi(),b=0;b<a.length;b++)f.log("\n"+t.hx(l.Jm(a[b])))};a.scenes_to_dot=function(){};a.controls_info=g.debug;a.object_distance=function(a,b){return H.dist(a.e.h,b.e.h)};a.msg=
h.msg;a.fbmsg=h.fbmsg;a.print_telemetry=h.print_telemetry;a.plot_telemetry=h.plot_telemetry;a.fbres=function(a,b){function c(){h.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),f=new Float32Array([-1,0,0]),g=new Float32Array([0,-1,0]),h=new Float32Array([0,0,-1]);if(!A.Le(a,A.Wu))throw"Wrong VEC3_IDENT";if(!A.Le(b,A.Qu))throw"Wrong QUAT4_IDENT";
if(!A.Le(c,A.AXIS_X))throw"Wrong AXIS_X";if(!A.Le(d,A.AXIS_Y))throw"Wrong AXIS_Y";if(!A.Le(e,A.AXIS_Z))throw"Wrong AXIS_Z";if(!A.Le(f,A.AXIS_MX))throw"Wrong AXIS_MX";if(!A.Le(g,A.AXIS_MY))throw"Wrong AXIS_MY";if(!A.Le(h,A.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=z.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==z.Lm(c)&&z.mute(c,!0)}};a.check_finite=function(a){h.check_finite(a)};a.set_debug_params=function(a){var b=l.get_active();if(b=l.Z(b,"WIREFRAME"))"string"==
typeof a.wireframe_mode&&l.WA(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&l.VA(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return f.uy()};a.get_warning_quantity=function(){return f.Ly()};a.clear_errors_warnings=function(){return f.clear_errors_warnings()};a.analyze_shaders=function(a){var e=x.Dq(),g=0,h;for(h in e)a&&-1===h.indexOf(a)||g++;var g="of "+g+" analyzing...",l={};for(h in e)if(!a||-1!==h.indexOf(a)){var n=e[h],t;
var p=n.Bo;t=n.uq;var z=k.Eq();if(z){p=z.getTranslatedShaderSource(p);t=z.getTranslatedShaderSource(t);var z=d("/nvidia_vert",p),D=c(z),A=d("/nvidia_frag",t),H=c(A);t={FC:p,kF:z,GC:D,Tx:t,WD:A,Em:H}}else f.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),t=void 0;z=n.Ab;p=z.ij+" + "+z.ui;t.cx=n;t.Ab=z;n=l[p]=l[p]||[];n.push(t);f.log(g)}for(p in l)f.group("%c"+p,"color: #800"),n=l[p],b(n),f.groupEnd()}};b4w.module.geometry=function(a,p){var c=p("__batch"),d=p("__geometry"),b=p("__print"),e=p("__renderer");a.extract_vertex_array=function(a,e,k){if(!d.Ai(a))return b.error("Wrong object:",a.name),null;if(a=c.la(a,e,"MAIN")){if((e=a.T)&&e.Ub&&e.Ub[k])return d.Fx(e,k);b.error("Attribute not found:"+k);return null}b.error("Wrong material:",e);return null};a.extract_index_array=function(a,e){if(!d.Ai(a))return b.error("Wrong object:",a.name),null;var k=c.la(a,e,"MAIN");if(k){if((k=k.T)&&k.Ub)return k.Ve;
b.error("Buffer data not found");return null}b.error("Wrong material:",e);return null};a.update_vertex_array=function(a,e,k,n){var f=["MAIN","DEPTH","COLOR_ID"];if(d.Ai(a))for(var l=0;l<f.length;l++){var t=c.la(a,e,f[l]);t&&(t=t.T)&&t.Ub&&t.Ub[k]&&d.Zk(t,k,0,n)}else b.error("Wrong object:",a.name)};a.override_geometry=function(a,h,k,n,f){var l=["MAIN","DEPTH","COLOR_ID"];if(d.Ai(a))if(k instanceof Uint16Array||k instanceof Uint32Array)if(n instanceof Float32Array)for(var t=0;t<l.length;t++){var p=
c.la(a,h,l[t]);if(p){var z=p.T;if(z){d.XB(z,p.ee,k);var D=0,A;for(A in z.Ub)var H=z.Ub[A],D=D+n.length/3*H.zd;z.ld=new Float32Array(D);var D=z.ld,u=0;for(A in z.Ub)switch(H=z.Ub[A],A){case "a_position":D.set(n,u);H.offset=u;H.length=n.length;u+=H.length;break;case "a_normal":var y;f&&(y=d.up(k,n,n));var q=d.sp(k,n,y);D.set(q,u);H.offset=u;H.length=n.length;u+=H.length;break;case "a_tangent":H.offset=u;H.length=n.length/3*H.zd;for(var q=new Float32Array(H.length),w=0;w<q.length;w+=4)q[w]=1,q[w+3]=
1;D.set(q,u);u+=H.length;break;default:H.offset=u,H.length=n.length/3*H.zd,q=new Float32Array(H.length),D.set(q,u),u+=H.length}d.mt(z);e.cp(p);(p=c.tc(a,p))&&p.T&&(p.T=z)}}}else b.error("Wrong positions_array type");else b.error("Wrong ibo_array type");else b.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,c,e){if(!d.check_shape_keys(a))return b.error("Wrong object:",a.name),null;if(!d.Yq(a,c))return b.error("Wrong key name:",c),null;d.zv(a,c,parseFloat(e))};a.check_shape_keys=function(a){return d.check_shape_keys(a)};
a.get_shape_keys_names=function(a){return d.check_shape_keys(a)?d.get_shape_keys_names(a):(b.error("Wrong object:",a.name),null)};a.get_shape_key_value=function(a,c){return d.check_shape_keys(a)?d.Yq(a,c)?d.get_shape_key_value(a,c):(b.error("Wrong key name:",c),null):(b.error("Wrong object:",a.name),null)}};b4w.module.hud=function(a,p){var c=p("__hud");p("__print");a.draw_mixer_strip=c.draw_mixer_strip;a.plot_array=c.plot_array};b4w.module.lights=function(a,p){function c(a){for(var c=g.get_active(),d=g.Ia(c,"LAMP",g.DATA_ID_ALL),l=0;l<d.length;l++){var t=d[l];if("SUN"==t.ra.type){var p=t;break}}if(!p)return b.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(d=(90-a.vert_position)/180*Math.PI,l=p.e,h.set_rotation_euler(p,[d,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),k.quat_to_dir(l.quat,k.AXIS_Y,a),l=n.length(l.h),n.copy(a,f),n.scale(f,l,f),h.set_translation(p,
f),h.v(p),a=p.ra,a.fq&&(t=p.data.energy,l=c.world.light_settings.environment_energy,d=Math.cos(Math.abs(d)),t*=Math.max(Math.min(3*d,1),0),d=Math.max(d,.1)*l,e.zs(a,t),g.set_environment_colors(c,d,null,null)),g.Bg(p,c))}function d(a){if(e.mk(a))return a.ra.type;b.error("get_light_type(): Wrong object");return!1}var b=p("__print"),e=p("__lights"),g=p("__scenes");p("__batch");var h=p("__transform"),k=p("__util"),n=p("vec3"),f=new Float32Array(3),l,t=60;a.get_lamps=function(a){var b=g.get_active(),b=
g.Ia(b,"LAMP",g.DATA_ID_ALL);if(!a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.ra.type===a&&c.push(e)}return c};a.get_sun_params=function(){for(var a=g.get_active(),a=g.Ia(a,"LAMP",g.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.ra.type){b=d;break}}return b?(b=b.ra.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=c;a.set_day_time=
function(a){for(var d=g.get_active(),d=g.Ia(d,"LAMP",g.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if("SUN"==f.ra.type){var h=f;break}}if(!h)return b.error("There is no sun on the scene"),null;h=-Math.cos(a/12*Math.PI)*t;d={};d.hor_position=12>a?15*a:15*(a-24);d.vert_position=h;c(d)};a.set_date=function(a){(l=a.getDate())?1582==l&&10==a.KE&&4<a.gx&&15>a.gx&&b.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):b.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=
function(a){t=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(e.mk(a))var c=a.ra;else return b.error("get_light_params(): Wrong object"),!1;if(a=d(a))switch(a){case "SPOT":var f={light_type:a,light_color:c.color,light_energy:c.Pe,light_spot_blend:c.zg,light_spot_size:c.jd,light_distance:c.distance};break;case "POINT":f={light_type:a,light_color:c.color,light_energy:c.Pe,light_distance:c.distance};break;default:f={light_type:a,light_color:c.color,light_energy:c.Pe}}return f?f:!1};a.get_light_type=
d;a.set_light_params=function(a,c){if(e.mk(a))var d=a.ra;else return b.error("set_light_params(): Wrong object"),!1;var f=g.get_active();"number"==typeof c.light_energy&&(e.zs(d,c.light_energy),g.Bg(a,f));"object"==typeof c.light_color&&(e.KA(d,c.light_color),g.Bg(a,f));"number"==typeof c.light_spot_blend&&(e.MA(d,c.light_spot_blend),g.Bg(a,f));"number"==typeof c.light_spot_size&&(e.NA(d,c.light_spot_size),g.Bg(a,f));"number"==typeof c.light_distance&&(e.LA(d,c.light_distance),g.Bg(a,f));g.RB()}};b4w.module.material=function(a,p){function c(a,b){for(var c=a.o,d=0;d<c.length;d++){var e=c[d];if(-1<e.Sc.indexOf(b))return"MAIN"==e.type}return!1}function d(a,b){var c=e.la(a,b,"MAIN");return Boolean(c&&c.jc[0])}function b(a,b){var c=e.la(a,b,"MAIN");return Boolean(c&&c.jc[1])}var e=p("__batch"),g=p("__config"),h=p("__print"),k=p("__objects"),n=p("__shaders");p("__util");p("vec4");var f=g.p,l="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.inherit_material=function(a,
b,c,d){if(k.Bi(c)&&k.Bi(a)){for(var f=["MAIN","DEPTH","COLOR_ID"],g=!1,n=0;n<f.length;n++){var p=f[n],q=e.la(a,b,p),w=e.la(c,d,p);if(q&&w){var g=!0,m=e.tc(c,d,p);"MAIN"==p&&(e.As(w,q),m&&e.As(m,q));for(p=0;p<w.Gb.length;p++){var r=w.Gb[p];if(-1!==l.indexOf(r)){var E=q.Gb.indexOf(r);-1!==E&&(w.M[p]=q.M[E],m&&(r=m.Gb.indexOf(r),-1!==r&&(m.M[r]=q.M[E])))}}}}g||h.error("Wrong objects for inheriting material!")}else h.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.o;
for(var c=0;c<a.length;c++)for(var d=0;d<a[c].Sc.length;d++)-1==b.indexOf(a[c].Sc[d])&&b.push(a[c].Sc[d]);return b};a.set_diffuse_color=function(a,b,c){var d=e.la(a,b,"MAIN");d?(d.Qc.set(c),(a=e.tc(a,b,"MAIN"))&&a.Qc.set(c)):h.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=e.la(a,b,"MAIN");if(c){var d=new Float32Array(4);d.set(c.Qc);return d}h.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,c){var d=e.la(a,b,"MAIN");
if(d){if(d.Ne=c,a=e.tc(a,b,"MAIN"))a.Ne=c}else h.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=e.la(a,b,"MAIN");if(c)return c.Ne;h.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var d=e.la(a,b,"MAIN");d?(d.Cd.set(c),(a=e.tc(a,b,"MAIN"))&&a.Cd.set(c)):h.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=e.la(a,b,"MAIN");if(c){var d=Array(3);d[0]=c.Cd[0];d[1]=c.Cd[1];
d[2]=c.Cd[2];return d}h.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,b,c){d(a,b)||h.error('Property "specular_intensity" is missing!');e.la(a,b,"MAIN").jc[0]=c;(a=e.tc(a,b,"MAIN"))&&(a.jc[0]=c)};a.get_specular_intensity=function(a,b){d(a,b)||h.error('Property "specular_intensity" is missing!');return e.la(a,b,"MAIN").jc[0]};a.check_specular_intensity=d;a.set_specular_hardness=function(a,c,d){b(a,c)||h.error('Property "specular_hardness" is missing!');e.la(a,
c,"MAIN").jc[1]=d;(a=e.tc(a,c,"MAIN"))&&(a.jc[1]=d)};a.get_specular_hardness=function(a,c){b(a,c)||h.error('Property "specular_hardness" is missing!');return e.la(a,c,"MAIN").jc[1]};a.check_specular_hardness=b;a.set_emit_factor=function(a,b,c){var d=e.la(a,b,"MAIN");if(d){if(d.fe=c,a=e.tc(a,b,"MAIN"))a.fe=c}else h.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=e.la(a,b,"MAIN");if(c)return c.fe;h.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=
function(a,b,c){var d=e.la(a,b,"MAIN");if(d){if(d.Rd=c,a=e.tc(a,b,"MAIN"))a.Rd=c}else h.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=e.la(a,b,"MAIN");if(c)return c.Rd;h.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){var d=e.la(a,b,"MAIN");if(d){if(d.Me=c,a=e.tc(a,b,"MAIN"))a.Me=c}else h.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=e.la(a,b,"MAIN");
if(c)return c.Me;h.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var d=e.la(a,b,"MAIN");if(d){if(d.Ge=c,a=e.tc(a,b,"MAIN"))a.Ge=c}else h.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=e.la(a,b,"MAIN");if(c)return c.Ge;h.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return h.error("missing arguments in get_material_params"),null;if(!c(a,b))return null;var d=
e.la(a,b,"MAIN");if(!d)return null;var f={};"MAIN"==d.type&&(f.reflect_factor=d.reflect_factor,f.fresnel=d.ad[2],f.fresnel_factor=5*(1-d.ad[3]),f.parallax_scale=d.parallax_scale,f.parallax_steps=e.xb(d,"PARALLAX_STEPS")[1]);return f};a.get_water_material_params=function(a,b){if(!a||!b)return h.error("missing arguments in get_water_material_params"),null;if(!c(a,b))return null;var d=e.la(a,b,"MAIN");if(!d||!d.uf)return null;if(!d)return h.error("material not found"),null;var g={};if("MAIN"==d.type){if(f.zh){var k=
g.shallow_water_col=Array(3);k[0]=d.shallow_water_col[0];k[1]=d.shallow_water_col[1];k[2]=d.shallow_water_col[2];k=g.shore_water_col=Array(3);k[0]=d.shore_water_col[0];k[1]=d.shore_water_col[1];k[2]=d.shore_water_col[2];g.shallow_water_col_fac=d.shallow_water_col_fac;g.shore_water_col_fac=d.shore_water_col_fac}g.foam_factor=d.foam_factor;g.norm_uv_velocity=d.Uh;g.absorb_factor=e.xb(d,"ABSORB")[1];g.sss_strength=e.xb(d,"SSS_STRENGTH")[1];g.sss_width=e.xb(d,"SSS_WIDTH")[1];g.dst_noise_scale0=e.xb(d,
"DST_NOISE_SCALE_0")[1];g.dst_noise_scale1=e.xb(d,"DST_NOISE_SCALE_1")[1];g.dst_noise_freq0=e.xb(d,"DST_NOISE_FREQ_0")[1];g.dst_noise_freq1=e.xb(d,"DST_NOISE_FREQ_1")[1];g.dir_min_shore_fac=e.xb(d,"DIR_MIN_SHR_FAC")[1];g.dir_freq=e.xb(d,"DIR_FREQ")[1];g.dir_noise_scale=e.xb(d,"DIR_NOISE_SCALE")[1];g.dir_noise_freq=e.xb(d,"DIR_NOISE_FREQ")[1];g.dir_min_noise_fac=e.xb(d,"DIR_MIN_NOISE_FAC")[1];g.dst_min_fac=e.xb(d,"DST_MIN_FAC")[1];g.waves_hor_fac=e.xb(d,"WAVES_HOR_FAC")[1]}return g};a.set_material_extended_params=
function(a,b,d){if(a&&b&&d){if(!c(a,b))return h.error("setting material params is not possible"),null;var f=e.la(a,b,"MAIN");if(f){var g=[f];(f=e.tc(a,b,"MAIN"))&&g.push(f);for(a=0;a<g.length;a++)f=g[a],"number"==typeof d.material_reflectivity&&(f.reflect_factor=d.material_reflectivity),"number"==typeof d.material_fresnel&&(f.ad[2]=d.material_fresnel),"number"==typeof d.material_fresnel_factor&&(f.ad[3]=1-d.material_fresnel_factor/5),"number"==typeof d.material_parallax_scale&&(f.parallax_scale=d.material_parallax_scale),
"number"==typeof d.material_parallax_steps&&(b=n.t(parseFloat(d.material_parallax_steps)),e.oa(f,"PARALLAX_STEPS",b),e.jb(f,!0))}else h.error("material not found")}else h.error("missing arguments in set_material_params")};a.set_water_material_params=function(a,b,d){if(!a||!b||!d)return h.error("missing arguments in set_water_material_params"),null;if(!c(a,b))return h.error("setting water material params is not possible"),null;var g=e.la(a,b,"MAIN");if(!g)return h.error("material not found"),null;
var k=[g];(g=e.tc(a,b,"MAIN"))&&k.push(g);for(a=0;a<k.length;a++)g=k[a],f.zh&&("object"==typeof d.shallow_water_col&&g.shallow_water_col.set(d.shallow_water_col),"number"==typeof d.shallow_water_col_fac&&(g.shallow_water_col_fac=d.shallow_water_col_fac),"object"==typeof d.shore_water_col&&g.shore_water_col.set(d.shore_water_col),"number"==typeof d.shore_water_col_fac&&(g.shore_water_col_fac=d.shore_water_col_fac)),f.shore_smoothing&&g.gl&&("boolean"==typeof d.shore_smoothing&&(d.shore_smoothing?e.oa(g,
"SHORE_SMOOTHING",1):e.oa(g,"SHORE_SMOOTHING",0)),"number"==typeof d.absorb_factor&&(b=n.t(parseFloat(d.absorb_factor)),e.oa(g,"ABSORB",b))),"number"==typeof d.foam_factor&&f.Yg&&(g.foam_factor=d.foam_factor),"number"==typeof d.norm_uv_velocity&&(g.Uh=d.norm_uv_velocity),f.water_dynamic&&g.water_dynamic&&("boolean"==typeof d.water_dynamic&&(d.water_dynamic?e.oa(g,"DYNAMIC",1):e.oa(g,"DYNAMIC",0)),"number"==typeof d.waves_height&&(b=n.t(parseFloat(d.waves_height)),e.oa(g,"WAVES_HEIGHT",b)),"number"==
typeof d.waves_length&&(b=n.t(parseFloat(d.waves_length)),e.oa(g,"WAVES_LENGTH",b)),"number"==typeof d.sss_strength&&(b=n.t(parseFloat(d.sss_strength)),e.oa(g,"SSS_STRENGTH",b)),"number"==typeof d.sss_width&&(b=n.t(parseFloat(d.sss_width)),e.oa(g,"SSS_WIDTH",b)),"number"==typeof d.dst_noise_scale0&&(b=n.t(parseFloat(d.dst_noise_scale0)),e.oa(g,"DST_NOISE_SCALE_0",b)),"number"==typeof d.dst_noise_scale1&&(b=n.t(parseFloat(d.dst_noise_scale1)),e.oa(g,"DST_NOISE_SCALE_1",b)),"number"==typeof d.dst_noise_freq0&&
(b=n.t(parseFloat(d.dst_noise_freq0)),e.oa(g,"DST_NOISE_FREQ_0",b)),"number"==typeof d.dst_noise_freq1&&(b=n.t(parseFloat(d.dst_noise_freq1)),e.oa(g,"DST_NOISE_FREQ_1",b)),"number"==typeof d.dir_min_shore_fac&&(b=n.t(parseFloat(d.dir_min_shore_fac)),e.oa(g,"DIR_MIN_SHR_FAC",b)),"number"==typeof d.dir_freq&&(b=n.t(parseFloat(d.dir_freq)),e.oa(g,"DIR_FREQ",b)),"number"==typeof d.dir_noise_scale&&(b=n.t(parseFloat(d.dir_noise_scale)),e.oa(g,"DIR_NOISE_SCALE",b)),"number"==typeof d.dir_noise_freq&&(b=
n.t(parseFloat(d.dir_noise_freq)),e.oa(g,"DIR_NOISE_FREQ",b)),"number"==typeof d.dir_min_noise_fac&&(b=n.t(parseFloat(d.dir_min_noise_fac)),e.oa(g,"DIR_MIN_NOISE_FAC",b)),"number"==typeof d.dst_min_fac&&(b=n.t(parseFloat(d.dst_min_fac)),e.oa(g,"DST_MIN_FAC",b)),"number"==typeof d.waves_hor_fac&&(b=n.t(parseFloat(d.waves_hor_fac)),e.oa(g,"WAVES_HOR_FAC",b))),e.jb(g,!0);return!0}};b4w.module.particles=function(a,p){var c=p("__particles"),d=p("__print");a.set_size=function(a,e,g){c.eh(a)?c.set_size(a,e,g):d.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,e,g){c.eh(a)?c.set_normal_factor(a,e,g):d.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,e,g){c.eh(a)?(g=Math.min(g,1),g=Math.max(g,0),c.set_factor(a,e,g)):d.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,p){var c=p("__physics"),d=p("__print"),b=p("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){c.has_physics(a)?c.enable_simulation(a):d.error("No physics for object "+a.name)};a.disable_simulation=function(a){c.has_physics(a)?c.disable_simulation(a):d.error("No physics for object "+a.name)};a.has_physics=function(a){return c.has_physics(a)};a.has_simulated_physics=function(a){return c.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return c.has_dynamic_physics(a)};a.set_gravity=function(a,b){c.has_physics(a)?c.set_gravity(a,b):d.error("No physics for object "+a.name)};a.set_damping=function(a,b,h){c.has_physics(a)?c.w("set_damping",a.n.H,b,h):d.error("No physics for object "+a.name)};a.reset_damping=function(a){if(c.has_physics(a)){var b=a.game;c.w("set_damping",a.n.H,b.damping,b.rotation_damping)}else d.error("No physics for object "+a.name)};a.set_transform=function(a,b,h){c.has_physics(a)?c.set_transform.apply(this,
arguments):d.error("No physics for object "+a.name)};a.sync_transform=function(a){c.has_physics(a)?c.sync_transform(a):d.error("No physics for object "+a.name)};a.apply_velocity=function(a){c.has_physics(a)?c.apply_velocity.apply(this,arguments):d.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){c.has_physics(a)?c.apply_velocity_world.apply(this,arguments):d.error("No physics for object "+a.name)};a.apply_force=function(a,b,h,k){c.has_physics(a)?c.apply_force.apply(this,
arguments):d.error("No physics for object "+a.name)};a.apply_torque=function(a,b,h,k){c.has_physics(a)?c.apply_torque.apply(this,arguments):d.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,g){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||d.error("Wrong object"),c.vehicle_throttle(a,b.clamp(g,-1,1))):d.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,g,h){if(c.has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||d.error("Wrong object");
g=b.clamp(g,0,1);var k=a.l.Xg;-1==h||1==h?k=Math.max(-1,Math.min(k+h*g,1)):0==h&&0<=k?(k-=g,k=Math.max(0,k)):0==h&&0>k?(k+=g,k=Math.min(0,k)):d.error("Wrong steering direction");c.vehicle_throttle(a,b.clamp(k,-1,1))}else d.error("No physics for object "+a.name)};a.vehicle_steer=function(a,g){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||d.error("Wrong object"),c.vehicle_steer(a,b.clamp(g,-1,1))):d.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,g,h){if(c.has_physics(a)){c.is_vehicle_chassis(a)||
c.is_vehicle_hull(a)||d.error("Wrong object");g=b.clamp(g,0,1);var k=a.l.Fh;-1==h||1==h?k=Math.max(-1,Math.min(k+h*g,1)):0==h&&0<=k?(k-=g,k=Math.max(0,k)):0==h&&0>k?(k+=g,k=Math.min(0,k)):d.error("Wrong steering direction");c.vehicle_steer(a,b.clamp(k,-1,1))}else d.error("No physics for object "+a.name)};a.vehicle_brake=function(a,g){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||d.error("Wrong object"),c.vehicle_brake(a,b.clamp(g,0,1))):d.error("No physics for object "+a.name)};
a.vehicle_brake_inc=function(a,g){if(c.has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||d.error("Wrong object");g=b.clamp(g,-1,1);var h=a.l.di;c.vehicle_brake(a,b.clamp(h+h*g,0,1))}else d.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return c.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return c.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!c.has_physics(a))return d.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.b4w_vehicle_settings.name;
d.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!c.has_physics(a))return d.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.l.Xg;d.error("Wrong object")};a.get_vehicle_steering=function(a){if(!c.has_physics(a))return d.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.l.Fh;d.error("Wrong object")};a.get_vehicle_brake=function(a){if(!c.has_physics(a))return d.error("No physics for object "+
a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.l.di;d.error("Wrong object")};a.get_vehicle_speed=function(a){if(!c.has_physics(a))return d.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return c.get_vehicle_speed(a);d.error("Wrong object")};a.is_character=function(a){return c.is_character(a)};a.set_character_move_dir=function(a,b,h){c.has_physics(a)?c.set_character_move_dir(a,b,h):d.error("No physics for object "+a.name)};a.set_character_move_type=
function(a,b){c.has_physics(a)?c.set_character_move_type(a,b):d.error("No physics for object "+a.name)};a.set_character_walk_velocity=function(a,b){c.has_physics(a)?c.set_character_walk_velocity(a,b):d.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,b){c.has_physics(a)?c.set_character_run_velocity(a,b):d.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,b){c.has_physics(a)?c.set_character_fly_velocity(a,b):d.error("No physics for object "+
a.name)};a.character_jump=function(a){c.has_physics(a)?c.character_jump(a):d.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,b,h){c.has_physics(a)?c.character_rotation_inc(a,b,h):d.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,b){c.has_physics(a)?c.set_character_rotation_quat(a,b):d.error("No physics for object "+a.name)};a.set_character_rotation=function(a,b,h){c.has_physics(a)?c.set_character_rotation(a,b,h):d.error("No physics for object "+
a.name)};a.set_character_rotation_v=function(a,b){c.has_physics(a)?c.set_character_rotation_v(a,b):d.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,b){c.has_physics(a)?c.set_character_rotation_h(a,b):d.error("No physics for object "+a.name)};a.append_collision_test=function(a,b,h,k){c.has_physics(a)?c.append_collision_test(a,b,h,k||!1):d.error("No physics for object "+a.name)};a.remove_collision_test=function(a,b,h){c.has_physics(a)?c.remove_collision_test(a,b||"ANY",
h):d.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,b){c.has_physics(a)?c.apply_collision_impulse_test(a,b):d.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){c.has_physics(a)?c.clear_collision_impulse_test(a):d.error("No physics for object "+a.name)};a.append_ray_test=function(a,b,d,k,n,f){return c.append_ray_test(a,b,d,k,n,f||!1,!1,!1,!1)};a.append_ray_test_ext=function(a,b,d,k,n,f,l,p,x){return c.append_ray_test(a,b,d,k,n,f||
!1,l||!1,p||!1,x||!1)};a.remove_ray_test=function(a){c.ir(a)?c.remove_ray_test(a):d.error("Wrong ray test ID")};a.change_ray_test_from_to=function(a,b,h){c.ir(a)?c.change_ray_test_from_to(a,b,h):d.error("Wrong ray test ID")};a.apply_constraint=function(a,b,h,k,n,f,l,p,x,z){c.has_physics(b)&&c.has_physics(n)?c.apply_constraint(a,b,h,k,n,f,l,p,x,z):d.error("Wrong objects")};a.clear_constraint=function(a){c.has_physics(a)&&c.Ry(a)?c.clear_constraint(a):d.error("Wrong object")};a.pull_to_constraint_pivot=
function(a,b,h,k,n,f){c.has_physics(a)&&c.has_physics(k)?c.pull_to_constraint_pivot(a,b,h,k,n,f):d.error("Wrong objects")}};b4w.module.rgb=function(a,p){p("__print");var c=p("__util"),d=new Float32Array(3);a.create=function(){return new Float32Array(3)};a.from_values=function(a,c,d){var h=new Float32Array(3);h[0]=a;h[1]=c;h[2]=d;return h};a.set=function(a,c,d,h){h[0]=a;h[1]=c;h[2]=d;return h};a.css_to_rgb=function(a,d,g,h){h=h||new Float32Array(3);h[0]=a/255;h[1]=d/255;h[2]=g/255;c.Us(h,h);return h};a.rgb_to_css=function(a){a=c.jn(a,d);return[Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])]};a.rgb_to_css_hex=
function(a){function e(a){a=Math.round(255*a).toString(16);return 1==a.length?"0"+a:a}a=c.jn(a,d);return"#"+e(a[0])+e(a[1])+e(a[2])}};
b4w.module.rgba=function(a,p){p("__print");var c=p("__util"),d=new Float32Array(3);a.create=function(){var a=new Float32Array(4);a[3]=1;return a};a.from_values=function(a,c,d,h){var k=new Float32Array(4);k[0]=a;k[1]=c;k[2]=d;k[3]=h;return k};a.set=function(a,c,d,h,k){k[0]=a;k[1]=c;k[2]=d;k[3]=h;return k};a.css_to_rgba=function(a,d,g,h,k){k=k||new Float32Array(4);k[0]=a/255;k[1]=d/255;k[2]=g/255;k[3]=h;c.Us(k,k);return k};a.rgba_to_css=function(a){var e=c.jn(a,d);return[Math.round(255*e[0]),Math.round(255*
e[1]),Math.round(255*e[2]),a[3]]}};b4w.module.scenes=function(a,p){var c=p("__batch"),d=p("__camera"),b=p("__graph"),e=p("__objects"),g=p("__print"),h=p("__physics"),k=p("__scenes"),n=p("__util");a.DATA_ID_ALL=k.DATA_ID_ALL;a.set_active=function(a){var b=k.zi();k.set_active(n.keysearch("name",a,b))};a.get_active=function(){return k.ia()?k.get_active().name:""};a.get_scenes=function(){for(var a=k.zi(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(k.ia())return k.Yj(k.get_active());g.error("No active scene");
return!1};a.get_object_by_name=function(a,b){var c=k.xd(k.yf,a,b|0);if(c)return c;g.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,c){if(a=k.xd(k.jl,a,b,c|0))return a;g.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var c=k.xd(k.kl,a,b|0);if(c)return c;g.error("get object "+a+": not found")};a.get_object_data_id=function(a){return k.get_object_data_id(a)};a.pick_object=k.pick_object;a.outlining_is_enabled=function(a){return a&&a.e&&
a.e.Fb};a.set_outline_intensity=function(a,b){a&&a.e&&a.e.Fb?a.e.dd=b:g.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=function(a){if(a&&a.e&&a.e.Fb)return a.e.dd;g.error("get_outline_intensity(): wrong object")};a.apply_outline_anim=function(a,b,c,d){a&&a.e&&a.e.Fb?k.apply_outline_anim(a,b,c,d):g.error("apply_outline_anim(): wrong object")};a.apply_outline_anim_def=function(a){if(a&&a.e&&a.e.Fb){var b=a.e.Ki;k.apply_outline_anim(a,b.yk,b.zk,b.Ak)}else g.error("apply_outline_anim_def(): wrong object")};
a.clear_outline_anim=function(a){a&&a.e&&a.e.Fb?k.clear_outline_anim(a):g.error("clear_outline_anim(): wrong object")};a.set_outline_color=k.set_outline_color;a.get_outline_color=function(a){var b=k.get_active();if(b=k.Z(b,"OUTLINE"))return a=a||new Float32Array(3),a.set(b.bf),a};a.set_glow_intensity=function(b,c){g.error("set_glow_intensity() deprecated, use set_outline_intensity() instead");a.set_outline_intensity(b,c)};a.get_glow_intensity=function(b){g.error("get_glow_intensity() deprecated, use get_outline_intensity() instead");
a.get_outline_intensity(b)};a.apply_glow_anim=function(b,c,d,e){g.error("apply_glow_anim() deprecated, use apply_outline_anim() instead");a.apply_outline_anim(b,c,d,e)};a.apply_glow_anim_def=function(b){g.error("apply_glow_anim_def() deprecated, use apply_outline_anim_def() instead");a.apply_outline_anim_def(b)};a.clear_glow_anim=function(b){g.error("clear_glow_anim() deprecated, use clear_outline_anim() instead");a.clear_outline_anim(b)};a.set_glow_color=function(b){g.error("set_glow_color() deprecated, use set_outline_color() instead");
a.set_outline_color(b)};a.get_glow_color=function(b){g.error("get_glow_color() deprecated, use get_outline_color() instead");a.get_outline_color(b)};a.get_shadow_params=function(){if(!k.ia())return g.error("No active scene"),!1;var a=k.get_active(),b=k.Z(a,"SHADOW_CAST");if(!b)return null;var c=a.e.ue,d=k.Z(a,"MAIN_OPAQUE"),e=k.Z(a,"DEPTH"),h={};h.csm_resolution=c.csm_resolution;h.self_shadow_polygon_offset=b.self_shadow_polygon_offset;e&&(h.self_shadow_normal_offset=e.self_shadow_normal_offset);
h.enable_csm=c.enable_csm;h.csm_num=c.csm_num;h.csm_first_cascade_border=c.csm_first_cascade_border;h.first_cascade_blur_radius=c.first_cascade_blur_radius;h.csm_last_cascade_border=c.csm_last_cascade_border;h.last_cascade_blur_radius=c.last_cascade_blur_radius;h.fade_last_cascade=c.fade_last_cascade;h.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(h.csm_borders=k.ry(a,d.j),h.blur_radii=new Float32Array(c.csm_num),h.blur_radii.set(d.j.Fk.subarray(0,c.csm_num))):(h.csm_borders=null,
h.blur_radii=null);return h};a.set_shadow_params=function(a){if(!k.ia())return g.error("No active scene"),!1;var e=k.get_active();"number"==typeof a.self_shadow_polygon_offset&&b.R(e.e.ib,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var h=k.Z(e,"DEPTH");h&&("number"==typeof a.self_shadow_normal_offset&&(h.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(h.pcf_blur_radius=a.pcf_blur_radius));var n=k.Z(e,
"MAIN_BLEND");n&&("number"==typeof a.self_shadow_normal_offset&&(n.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(n.pcf_blur_radius=a.pcf_blur_radius),n.na=!0);n=e.e.ue;"number"==typeof a.csm_first_cascade_border&&(n.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(n.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(n.csm_last_cascade_border=a.csm_last_cascade_border);
"number"==typeof a.last_cascade_blur_radius&&(n.last_cascade_blur_radius=a.last_cascade_blur_radius);if(h){for(var p=h.q,D=0;D<p.length;D++){var A=p[D];A.cd.ic&&(A=A.B,c.dp(A,n),c.jb(A))}h.na=!0}h=e.camera.e.I;for(D=0;D<h.length;D++)d.to(h[D],n);k.Qn(e)};a.get_environment_colors=function(){if(!k.ia())return g.error("No active scene"),!1;var a=k.get_active();return k.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(!k.ia())return g.error("No active scene"),!1;var d=k.get_active();
k.set_environment_colors(d,parseFloat(a),b,c)};a.get_fog_color_density=function(a){if(!k.ia())return g.error("No active scene"),!1;var b=k.get_active();return k.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(!k.ia())return g.error("No active scene"),!1;var b=k.get_active();k.set_fog_color_density(b,a)};a.get_ssao_params=function(){if(!k.ia())return g.error("No active scene"),!1;var a=k.get_active();return k.get_ssao_params(a)};a.set_ssao_params=function(a){if(!k.ia())return g.error("No active scene"),
!1;var b=k.get_active();k.set_ssao_params(b,a)};a.get_color_correction_params=function(){if(!k.ia())return g.error("No active scene"),null;var a=k.get_active(),a=k.Z(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(!k.ia())return g.error("No active scene"),null;var b=k.get_active(),b=k.Z(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&
(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.na=!0};a.get_sky_params=function(){if(!k.ia())return g.error("No active scene"),!1;var a=k.get_active();return k.get_sky_params(a)};a.set_sky_params=function(a){if(!k.ia())return g.error("No active scene"),!1;var b=k.get_active();k.set_sky_params(b,a)};a.get_dof_params=function(){if(!k.ia())return g.error("No active scene"),
!1;var a=k.get_active();return k.Z(a,"DOF")?k.get_dof_params(a):null};a.set_dof_params=function(a){if(!k.ia())return g.error("No active scene"),!1;var b=k.get_active();k.set_dof_params(b,a)};a.get_god_rays_params=function(){if(!k.ia())return g.error("No active scene"),!1;var a=k.get_active();return k.Z(a,"GOD_RAYS")?k.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!k.ia())return g.error("No active scene"),!1;var b=k.get_active();k.set_god_rays_params(b,a)};a.get_bloom_params=function(){if(!k.ia())return g.error("No active scene"),
!1;var a=k.get_active();return k.Z(a,"BLOOM")?k.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!k.ia())return g.error("No active scene"),!1;var b=k.get_active();k.set_bloom_params(b,a)};a.get_glow_material_params=function(){if(!k.ia())return g.error("No active scene"),!1;var a=k.get_active();return k.Z(a,"GLOW_COMBINE")?k.get_glow_material_params(a):null};a.set_glow_material_params=function(a){if(!k.ia())return g.error("No active scene"),!1;var b=k.get_active();k.set_glow_material_params(b,
a)};a.get_wind_params=function(){return k.get_wind_params()};a.set_wind_params=function(a){if(!k.ia())return g.error("No active scene"),!1;var b=k.get_active();k.set_wind_params(b,a)};a.get_water_surface_level=k.get_water_surface_level;a.set_water_params=function(a){if(!k.ia())return g.error("No active scene"),!1;var b=k.get_active();k.set_water_params(b,a)};a.get_water_mat_params=function(a){if(!k.ia())return g.error("No active scene"),!1;var b=k.get_active();k.get_water_mat_params(b,a)};a.update_scene_materials_params=
function(){if(!k.ia())return g.error("No active scene"),!1;var a=k.get_active();k.ot(a)};a.hide_object=function(a){e.Bi(a)||n.jk(a)?k.hide_object(a):g.error("show/hide is only supported for dynamic meshes/empties")};a.show_object=function(a){e.Bi(a)||n.jk(a)?k.show_object(a):g.error("show/hide is only supported for dynamic meshes/empties")};a.is_hidden=function(a){if(e.Bi(a)||n.jk(a))return k.is_hidden(a);g.error("show/hide is only supported for dynamic meshes/empties");return!1};a.is_visible=function(a){return a.e.is_visible};
a.check_object=function(a){return k.ia()?k.check_object(a,k.get_active()):(g.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return k.xd(k.yf,a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,c){return k.xd(k.jl,a,b,c|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return k.xd(k.kl,a,b|0)?!0:!1};a.get_all_objects=function(a,b){var c=k.get_active();a||(a="ALL");b||0===b||(b=k.DATA_ID_ALL);return k.Ia(c,a,b)};a.get_object_name=function(a){return a?a.name:(g.error("Wrong object name"),
"")};a.get_object_type=function(a){return a&&a.type?a.type:(g.error("Wrong object"),"UNDEFINED")};a.get_object_dg_parent=function(a){return a.ya};a.get_object_children=function(a){return a.Mc.slice(0)};a.get_first_character=function(){for(var a=k.Ia(k.get_active(),"MESH",k.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(h.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return k.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return k.get_cam_water_depth()};
a.get_type_mesh_object=function(a){return"MESH"==a.type?a.e.type:null};a.get_meta_tags=function(){if(!k.ia())return g.error("No active scene"),!1;var a=k.get_active();return k.get_meta_tags(a)};a.append_object=function(a){if(!a.e.Zm)return g.error('object "'+a.name+'" has been created not by coping.'),!1;var b=a.name;if(k.xd(k.yf,a.name,0))for(var c=1;;){b=a.name+(3>String(c).length?"."+("000"+String(c)).slice(-3):"."+String(c));if(!k.xd(k.yf,b,0)){a.name=b;g.error('object "'+a.name+'" already exists. Name was replaced by "'+
b+'".');break}c++}k.append_object(k.get_active(),a,!0)};a.remove_object=function(a){k.remove_object(a)||g.error('object "'+a.name+'" was not copied.')};a.marker_frame=function(a){var b=k.get_active();if(b.timeline_markers&&a in b.timeline_markers)return k.marker_frame(b,a);g.error('"'+a+'" marker not found.');return 0};a.get_mb_params=function(){var a=k.get_active();return(a=k.Z(a,"MOTION_BLUR"))?{mb_factor:a.mb_factor,mb_decay_threshold:a.mb_decay_threshold}:null};a.set_mb_params=function(a){var b=
k.get_active();(b=k.Z(b,"MOTION_BLUR"))?("number"==typeof a.mb_decay_threshold&&(b.mb_decay_threshold=a.mb_decay_threshold),"number"==typeof a.mb_factor&&(b.mb_factor=a.mb_factor)):g.error("The motion blur subscene doesn't exist.")}};b4w.module.sfx=function(a,p){var c=p("__scenes"),d=p("__sfx"),b=p("__print");a.play=function(a,b,c){d.play(a,b,c)};a.play_def=function(a){d.play_def(a)};a.is_play=function(a){return d.is_play(a)};a.speaker_play=function(a,c,h,k){b.error("speaker_play() deprecated, use play() or play_def() instead");d.cyclic(a,c);k&&d.playrate(a,k);d.play(a,0,h)};a.speaker_stop=function(a){b.error("speaker_stop() deprecated, use stop() instead");d.stop(a)};a.stop=function(a){d.stop(a)};a.pause=function(a){d.jB(a)};
a.resume=function(a){d.lB(a)};a.speaker_playback_rate=function(a,c){b.error("speaker_playback_rate() deprecated, use playrate() instead");d.playrate(a,c)};a.playrate=function(a,b){d.playrate(a,b)};a.get_playrate=function(a){return d.get_playrate(a)};a.cyclic=function(a,b){d.cyclic(a,b)};a.is_cyclic=function(a){return d.is_cyclic(a)};a.listener_reset_speed=function(a,b){d.listener_reset_speed(a,b)};a.speaker_reset_speed=function(a,b,c){d.speaker_reset_speed(a,b,c)};a.get_volume=function(a){return a&&
"object"===typeof a?d.get_volume(a):d.zy()};a.set_volume=function(a,b){a&&"object"===typeof a?d.set_volume(a,b):d.OA(b)};a.mute=function(a,b){a&&"object"===typeof a?d.mute(a,b):d.Fz(b)};a.is_muted=function(a){return a&&"object"===typeof a?d.is_muted(a):d.gz()};a.get_speaker_objects=function(){return d.get_speaker_objects().slice(0)};a.get_speakers=function(){b.error("get_speakers() deprecated, use get_speaker_objects() instead");return a.get_speaker_objects()};a.check_active_speakers=d.check_active_speakers;
a.set_compressor_params=function(a){d.set_compressor_params(c.get_active(),a)};a.get_compressor_params=function(){return d.get_compressor_params(c.get_active())};a.duck=function(a,b,c){a&&"object"===typeof a?d.duck(a,b,c):d.vx(b,c)};a.unduck=function(a){a&&"object"===typeof a?d.unduck(a):d.QB()};a.apply_playlist=d.apply_playlist;a.clear_playlist=d.clear_playlist;a.detect_audio_container=d.detect_audio_container;a.detect_video_container=d.detect_video_container;a.set_positional_params=d.set_positional_params;
a.get_positional_params=d.get_positional_params;a.set_filter_params=d.set_filter_params;a.get_filter_params=d.get_filter_params;a.get_filter_freq_response=d.get_filter_freq_response;a.get_duration=function(a){if(a&&d.le(a))return d.get_duration(a);b.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.textures=function(a,p){var c=p("__textures"),d=p("__print");a.get_canvas_texture_context=function(a,e){e||(e=0);var g=c.oy(a,e);if(g)return g;d.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a,e){e||(e=0);c.$B(a,e)||d.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a,e){e||(e=0);c.play_video(a,e)||d.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a,e){e||(e=0);c.pause_video(a,e)||d.error('Texture with name "'+
a+'" not found!')};a.reset_video=function(a,e){e||(e=0);c.reset_video(a,e)||d.error('Texture with name "'+a+'" not found!')}};b4w.module.time=function(a,p){var c=p("__time");a.set_timeout=c.set_timeout;a.clear_timeout=c.clear_timeout;a.get_timeline=c.get_timeline;a.animate=c.animate;a.clear_animation=c.clear_animation};b4w.module.transform=function(a,p){var c=p("__print"),d=p("__physics"),b=p("__transform"),e=p("__util"),g=p("__objects"),h=new Float32Array(3),k=new Float32Array(4);a.SPACE_LOCAL=b.SPACE_LOCAL;a.SPACE_WORLD=b.SPACE_WORLD;a.set_translation=function(a,e,k,p){g.bc(a)?(h[0]=e,h[1]=k,h[2]=p,b.set_translation(a,h),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,e){g.bc(a)?(b.set_translation(a,e),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.set_translation_rel=function(a,f,k,p,x){g.bc(a)?(h[0]=f,h[1]=k,h[2]=p,e.transform_vec3(h,1,x.e.quat,x.e.h,h),b.set_translation(a,h),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,c){c||(c=new Float32Array(3));b.get_translation(a,c);return c};a.set_rotation=function(a,e,h,p,x){g.bc(a)?(k[0]=e,k[1]=h,k[2]=p,k[3]=x,b.set_rotation(a,k),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.set_rotation_quat=function(){c.error("set_rotation_quat() deprecated, use set_rotation() instead");return a.set_rotation};a.set_rotation_v=function(a,e){g.bc(a)?(b.set_rotation(a,e),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat_v=function(){c.error("set_rotation_quat_v() deprecated, use set_rotation_v() instead");return a.set_rotation_v};a.get_rotation=function(a,c){c||(c=new Float32Array(4));b.get_rotation(a,c);return c};a.get_rotation_quat=
function(){c.error("get_rotation_quat() deprecated, use get_rotation() instead");return a.get_rotation};a.set_rotation_euler=function(a,e,k,p){g.bc(a)?(h[0]=e,h[1]=k,h[2]=p,b.set_rotation_euler(a,h),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,e){g.bc(a)?(b.set_rotation_euler(a,e),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,d){g.bc(a)?(b.set_scale(a,d),b.v(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.get_scale=function(a){return b.get_scale(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return c.error("Wrong object: "+a.name),!1;for(var e=0;e<a.Mc.length;e++)if(!g.bc(a.Mc[e])){c.error('Wrong object: "'+a.Mc[e].name+'" is not dynamic.');return}b.set_translation(a,[0,0,0]);b.set_rotation(a,[0,0,0,1]);b.set_scale(a,1);b.v(a);d.sync_transform(a)};a.get_object_size=function(a){return e.is_mesh(a)?b.get_object_size(a):(c.error("Wrong object: "+a.name),0)};
a.get_object_center=function(a,d,g){return e.is_mesh(a)?b.get_object_center(a,d,g):(c.error("Wrong object: "+a.name),null)};a.move_local=function(a,e,h,k){g.bc(a)?(b.move_local(a,e,h,k),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return b.get_object_bounding_box(a)};a.get_tsr=function(a,d){d||(d=new Float32Array(8));if(g.bc(a))return b.get_tsr(a,d),d;c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr=function(a,
e){g.bc(a)?(b.set_tsr(a,e),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.distance=function(a,c){return b.distance(a,c)}};b4w.module.tsr=function(a,p){p("__print");var c=p("__tsr");a.create=c.create;a.from_values=c.from_values;a.copy=c.copy;a.identity=c.identity;a.create_sep=c.create_sep;a.set_sep=c.set_sep;a.set_trans=c.set_trans;a.set_scale=c.set_scale;a.set_transcale=c.set_transcale;a.set_quat=c.set_quat;a.get_trans_view=c.get_trans_view;a.get_scale=c.get_scale;a.get_quat_view=c.get_quat_view;a.invert=c.invert;a.to_mat4=function(a,b){b||(b=new Float32Array(16));c.to_mat4(a,b);return b};a.from_mat4=c.from_mat4;a.multiply=
c.multiply;a.transform_vec3=c.transform_vec3;a.transform_vec3_inv=c.transform_vec3_inv;a.transform_vectors=c.transform_vectors;a.transform_dir_vectors=c.transform_dir_vectors;a.transform_dir_vec3=c.transform_dir_vec3;a.transform_tangents=c.transform_tangents;a.translate=c.translate;a.interpolate=c.interpolate};b4w.module.util=function(a,p){var c=p("__print"),d=p("__util"),b=p("vec3");p("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.f32=function(a){return new Float32Array(a||0)};a.assert=d.assert;a.keyfind=d.keyfind;a.keysearch=d.keysearch;a.matrix_to_quat=function(a){return d.matrix_to_quat(a)};a.euler_to_quat=function(a,b){b||
(b=new Float32Array(4));return d.euler_to_quat(a,b)};a.quat_to_euler=function(a,b){b||(b=new Float32Array(3));return d.quat_to_euler(a,b)};a.sign=d.sign;a.clamp=d.clamp;a.quat_to_dir=d.quat_to_dir;a.ground_project_quat=function(a,b){return d.quat_project(a,d.AXIS_MY,d.AXIS_Y,d.AXIS_MZ,b)};a.cam_quat_to_mesh_quat=function(a,b){return d.cam_quat_to_mesh_quat(a,b)};a.quat_project=function(a,g,h,k,n){return 0!=b.dot(h,k)?(c.error("Wrong in-plane direction"),null):d.quat_project(a,g,h,k,n)};a.hash_code=
d.hash_code;a.smooth=d.smooth;a.smooth_v=d.smooth_v;a.is_vector=d.is_vector;a.correct_cam_quat_up=d.correct_cam_quat_up;a.quat_to_angle_axis=d.quat_to_angle_axis;a.random_from_array=d.random_from_array;a.xz_direction=d.xz_direction;a.line_plane_intersect=d.line_plane_intersect;a.is_mesh=d.is_mesh;a.is_armature=d.is_armature;a.angle_wrap_0_2pi=d.angle_wrap_0_2pi;a.angle_wrap_periodic=d.angle_wrap_periodic;a.smooth_step=d.smooth_step;a.lerp=d.lerp};"object"==typeof module&&module.sm&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,p){var c=p("__version");a.version=c.version;a.version_str=c.version_str;a.type=c.type;a.date=c.date;a.date_str=c.date_str};"object"==typeof module&&module.sm&&b4w.module.version(exports);b4w.module.objects=function(a,p){var c=p("__objects"),d=p("__print"),b=p("__util"),e=p("__scenes"),g=p("__geometry");a.get_meta_tags=function(a){if(a&&a.b4w_object_tags)return c.get_meta_tags(a)};a.copy=function(a,k,n){return b.is_mesh(a)?a.So?(d.error('object "'+a.name+'" is meta-object.'),!1):c.bc(a)?g.Ai(a)||g.check_shape_keys(a)||!n?-1==e.Ia(e.get_active(),"MESH",e.DATA_ID_ALL).indexOf(a)?(d.error('object "'+a.name+'" does not belong to the active scene.'),!1):c.copy(a,k||"",n):(d.error('object "'+
a.name+'" has not dynamic geometry for deep copying.'),!1):(d.error('object "'+a.name+'" is not dynamic.'),!1):(d.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,e,g){if(!b.is_mesh(a))return d.error('The type of the object "'+a.name+'" is not "MESH".'),null;e=e.join("%join%");var f=c.Hy(a,e);null!=f?a.e.oe[f]=g:d.error('The Value node "'+e+'" was not found in the object "'+a.name+'".')};a.set_nodemat_rgb=function(a,e,g,f,l){if(!b.is_mesh(a))return d.error('The type of the object "'+
a.name+'" is not "MESH".'),null;e=e.join("%join%");var p=c.Cy(a,e);null!=p?(a.e.wc[3*p]=g,a.e.wc[3*p+1]=f,a.e.wc[3*p+2]=l):d.error('The RGB node "'+e+'" was not found in the object "'+a.name+'".')}};b4w.module.main=function(a,p){function c(){}function d(){}function b(){}function e(){window.performance||(H.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(H.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});P.Bs(0)}function g(a,b){a.addEventListener("webglcontextlost",function(a){a.preventDefault();H.error("WebGL context lost");k()},!1);m.gd(b);var c=m.Jq();c&&H.log("%cRENDERER INFO:","color: #00a",
b.getParameter(c.UNMASKED_VENDOR_WEBGL)+", "+b.getParameter(c.UNMASKED_RENDERER_WEBGL));L.gd(b);r.gd(b);K.gd(b);J.gd(b);w.gd(b);q.XA(a);u.init(a);O.Ds(a.width,a.height,1);B.init();d=t();f()}function h(){c=function(){}}function k(){n()||(qa=performance.now()/1E3,B.pause(),M.pause(),K.pause(),x.pause())}function n(){return ga<qa}function f(){C(f);var a=performance.now()/1E3;S||(S=a);var b=a-S;if(!(b<1/la.bd)){for(var c=P.get_timeline(),e=0;e<ha.length;e++)ha[e](c,b);n()||(ga>S&&(b-=ga-Math.max(qa,S)),
c+=b,P.Bs(c),w.update(),F.update(),q.update(),l(c,b),d(b));S=a}}function l(a,b){q.is_primary_loaded()&&(E.reset(),R.update(b),I.update(a,b),B.update(a,b),b&&z.update(b),q.is_primary_loaded()&&(M.update(a,b),q.is_primary_loaded()&&(c(b,a),q.is_primary_loaded()&&(y.update(a,b),q.is_primary_loaded()&&(x.update(),O.update(a,b),x.mC(),Y&&(Y(U.toDataURL()),Y=null))))))}function t(){var a=60,c=0,d=la.sq,e=la.Nx;return function(f){f<1/la.bd||(a=T.smooth(1/f,a,f,d),f=M.wy(),c=(c+1)%e,0==c&&b(Math.round(a),
f))}}var x=p("__anchors"),z=p("__animation"),D=p("__compat"),A=p("__config"),H=p("__print"),u=p("__container"),y=p("__controls"),q=p("__data"),w=p("__debug"),m=p("__extensions"),r=p("__geometry"),E=p("__hud"),I=p("__nla"),F=p("__assets"),M=p("__physics"),L=p("__renderer"),O=p("__scenes"),B=p("__sfx"),J=p("__shaders"),K=p("__textures"),P=p("__time"),R=p("__transform"),T=p("__util"),Q=p("__version"),X=A.context,la=A.p,U=null,pa=null,S=0,qa=0,ga=0,ha=[],Y=null,ea=["webgl","experimental-webgl"],Z=null,
C=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/la.bd)}}();a.init=function(a,b){A.PA();H.TA(la.console_verbose);var c=Q.version_str()+" "+Q.type()+" ("+Q.date_str()+")";H.log("%cINIT ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;e();U=a;D.wv();for(var c=null,d=0;d<ea.length;d++){var f=ea[d];try{c=a.getContext(f,
X)}catch(h){}if(c)break}c&&D.rx(c);if(!c)return null;Z=c;g(U,c);A.yv();D.JA(c);J.rz();la.Vm&&(a.style["touch-action"]="none");H.log("%cSET PRECISION:","color: #00a",la.precision);b?(E.init(b),pa=b):(A.p.show_hud_debug_info=!1,A.hd.rk=!1);return c};a.set_check_gl_errors=function(a){w.set_check_gl_errors(a)};a.resize=function(a,b,c){!1!==c&&(U.style.width=a+"px",U.style.height=b+"px",pa&&(pa.style.width=a+"px",pa.style.height=b+"px"));pa&&(pa.width=a,pa.height=b,E.Oh());if(navigator.userAgent.match(/iPhone/i)||
navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))la.canvas_resolution_factor=1;c=Math.floor(a*la.canvas_resolution_factor);b=Math.floor(b*la.canvas_resolution_factor);la.allow_hidpi&&1<window.devicePixelRatio&&(c*=window.devicePixelRatio,b*=window.devicePixelRatio);U.width=c;U.height=b;if(c>Z.drawingBufferWidth||b>Z.drawingBufferHeight){H.warn("Canvas size exceeds platform limits, downscaling");var d=Math.min(Z.drawingBufferWidth/c,Z.drawingBufferHeight/b);c*=d;b*=d;U.width=
c;U.height=b}O.Ds(c,b,c/a);O.ia()&&R.v(O.get_active().camera);l(P.get_timeline(),0);q.dC(U.width,U.height)};a.set_fps_callback=function(a){b=a};a.clear_fps_callback=function(){b=function(){}};a.set_render_callback=function(a){c=a};a.clear_render_callback=function(){h()};a.global_timeline=function(){return P.get_timeline()};a.redraw=function(){H.error("redraw() deprecated");l(P.get_timeline(),0)};a.pause=k;a.resume=function(){n()&&(ga=performance.now()/1E3,B.resume(),M.resume(),K.play(!0),x.resume())};
a.is_paused=n;a.reset=function(){q.unload(0);pa=U=null;ga=qa=S=0;b=function(){};d=function(){};c=function(){};ha.length=0;Z=null;P.reset()};a.canvas_data_url=function(a){Y=a};a.get_canvas_elem=function(){return U};a.detect_mobile=function(){return D.detect_mobile()};a.append_loop_cb=function(a){for(var b=0;b<ha.length;b++)if(ha[b]==a)return;ha.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<ha.length;b++)if(ha[b]==a){ha.splice(b,1);break}}};b4w.module.nla=function(a,p){var c=p("__nla"),d=p("__time"),b=p("__print"),e=p("__util");a.set_frame=function(a){a=e.clamp(a,c.get_frame_start(),c.get_frame_end());c.check_nla_scripts()?b.error("The active scene is using NLA script."):c.set_frame(a,d.get_timeline())};a.get_frame=function(){return c.get_frame(d.get_timeline())};a.stop=function(){c.check_nla_scripts()?b.error("The active scene is using NLA script."):c.vB()};a.play=function(a){c.check_nla_scripts()?b.error("The active scene is using NLA script."):
c.Wz(a)};a.is_play=function(){return c.is_play()};a.get_frame_start=function(){return c.get_frame_start()};a.get_frame_end=function(){return c.get_frame_end()};a.check_nla=function(){return c.check_nla()};a.check_nla_scripts=function(){return c.check_nla_scripts()};a.set_range=function(a,d){c.check_nla_scripts()?b.error("The active scene is using NLA script."):(d=parseFloat(d)||c.get_frame_end(),a=parseFloat(a)||c.get_frame_end(),d=e.clamp(d,c.get_frame_start(),c.get_frame_end()),a=e.clamp(a,c.get_frame_start(),
d),c.set_range(a,d))};a.reset_range=function(){c.check_nla_scripts()?b.error("The active scene is using NLA script."):c.reset_range()};a.set_cyclic=function(a){c.check_nla_scripts()?b.error("The active scene is using NLA script."):c.set_cyclic(a)};a.clear_callback=function(){c.check_nla_scripts()?b.error("The active scene is using NLA script."):c.clear_callback()}};
