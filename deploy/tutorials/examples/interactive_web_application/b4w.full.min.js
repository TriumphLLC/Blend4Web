var b4w=function(a){var p={};a.module=p;var c={};a.register=function(a,b){if(p[a])throw Error('Module "'+a+'" already registered');p[a]=b};a.require=function(a,b){if(!p[a])throw Error('Module "'+a+'" not found');b=b||"__B4W_DEF_NS";c[b]||(c[b]=function(a){return function(b){var d=p[b];if(!d)throw Error('Module "'+b+'" not found');d.ei||(d.ei={});d.ei[a]||(d.ei[a]={},d(d.ei[a],c[a]));return d.ei[a]}}(b));return c[b](a)};a.module_check=function(a){return p[a]?!0:!1};return a}({});"object"==typeof module&&module.Cm&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a){function p(){var a=c,d=a.getDate(),d=10>d?"0"+String(d):String(d),h=a.getMonth()+1,h=10>h?"0"+String(h):String(h),g=String(a.getFullYear()),l=a.getHours(),l=10>l?"0"+String(l):String(l),n=a.getMinutes(),n=10>n?"0"+String(n):String(n),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return d+"."+h+"."+g+" "+l+":"+n+":"+a}var c=new Date(2015,6,29,10,16,9),d=[15,7];a.version=function(){return d};a.version_str=function(){for(var a="",c=0;c<d.length;c++)a=1==c?a+(10>d[c]?
"0"+d[c]:d[c]):a+d[c],c!=d.length-1&&(a+=".");return a};a.type=function(){return"RELEASE"};a.date=function(){return c};a.date_str=p;a.timestamp=function(){var a=p(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.Cm&&b4w.module.__version(exports);b4w.module.__config=function(a,p){function c(){return b4w.module_check(a.Ub.Rj)}function d(){for(var c=a.Ub,d=null,e=document.getElementsByTagName("script"),n=0;n<e.length;n++){for(var f=e[n].src,m=0;m<c.Ar.length;m++)if(0<=f.indexOf(c.Ar[m])){d=f;break}if(null!==d)break}d||(b.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),d=document.location.href);c=d.indexOf("?");0<=c&&(d=d.substring(0,c));return d.substring(0,d.lastIndexOf("/")+1)}var b=p("__print"),
e=p("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.Kw=e.la(a.context);a.p={alpha_sort:!0,alpha_sort_threshold:.1,Fl:!1,Ri:[5,4],dd:1E4,console_verbose:!1,do_not_load_resources:!1,ll:!1,Dq:1.5,Zx:10,background_color:[0,0,0,0],ng:.01,render_resolution_factor:1,canvas_resolution_factor:1,gl:3,allow_cors:!1,Km:!1,Ij:!0,show_hud_debug_info:!1,YD:!0,jj:!0,anaglyph_use:!1,Xk:!0,gc:!0,Ae:!0,dh:!0,jh:!0,Vg:!0,wh:!0,Zg:!0,antialiasing:!0,smaa:!1,
wireframe_debug:!1,Ot:!1,fh:!0,Xi:!0,xb:!0,Rk:!0,water_dynamic:!0,shore_smoothing:!0,Gh:!0,Lb:1024,qg:512,Bt:!0,precision:"highp",quality:a.P_HIGH,Cl:!0,Uz:!1,Qs:!1,nq:!1,It:!1,gg:!1,bm:!1,Zp:!1,nr:!1,cm:!1,pF:!1,Wc:!1,allow_hidpi:!1,gyro_use:!1,zq:!1,En:!1,hn:!1,enable_selectable:!0,enable_outlining:!0,We:!0,Jr:128,en:!1,qr:!1,Fz:!1,wn:[0,0]};a.yx=e.la(a.p);a.Ud={Ja:-1,Eq:!1,$f:1};a.controls={Sz:1/120};a.Vd={dir:"ASSETS=../../assets/",Mz:15,ts:!0,Cn:!1,sm:!1};a.Pv=e.la(a.Vd);a.Ub={shaders_dir:"",
nB:"include/",mF:"postprocessing/",Rj:"built_in_data",Ar:["b4w.min.js","b4w.full.min.js","src/b4w.js","USER_DEFINED_MODULE"],Gs:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.Xa={enabled:!0,dd:60,pj:"",Xl:!1,ping:!1};a.eA=e.la(a.Xa);a.Dh={kk:1024,$j:384,fq:32,rx:128,qx:256,ps:.25,hA:.5,gA:1};a.NA=e.la(a.Dh);a.kd={Po:!0,Bk:!1,sp:!1,Pp:!1,oq:!1};a.mB=e.la(a.kd);a.Gb={outlining_overview_mode:!1,gf:[1,.4,.05],fd:1,Ik:.2,Jk:3.8,Kk:1};a.tm={enabled:!1,SB:"MAIN_OPAQUE",RB:0,qB:"COLOR"};a.ux=
e.la(a.tm);a.Kv=function(){var b=a.p,c=a.Xa,d=a.Dh;switch(b.quality){case a.P_ULTRA:b.jj=!0;b.shore_smoothing=!0;b.Ae=!0;b.dh=!0;b.jh=!0;b.Vg=!0;b.Xk=!0;b.gc=!0;b.fh=!0;b.Xi=!0;b.xb=!0;b.Rk=!0;b.render_resolution_factor=1.75;d.kk=2048;b.gl=3;b.Ij=!0;b.ll=!1;b.precision="highp";b.water_dynamic=!0;b.Gh=!0;b.antialiasing=!0;b.smaa=!0;b.Zg=!0;b.wh=!0;b.allow_hidpi=!0;b.enable_outlining=!0;b.We=!0;c.dd=120;break;case a.P_HIGH:b.jj=!0;b.shore_smoothing=!0;b.Ae=!0;b.dh=!0;b.jh=!0;b.Vg=!0;b.Xk=!0;b.gc=!0;
b.fh=!0;b.Xi=!0;b.xb=!0;b.Rk=!0;b.render_resolution_factor=1;d.kk=1024;b.gl=3;b.Ij=!0;b.ll=!1;b.precision="highp";b.water_dynamic=!0;b.Gh=!0;b.antialiasing=!0;b.smaa=!1;b.Zg=!0;b.wh=!0;b.allow_hidpi=!1;b.enable_outlining=!0;b.We=!0;c.dd=60;break;case a.P_LOW:b.jj=!1,b.shore_smoothing=!1,b.Ae=!1,b.dh=!1,b.jh=!1,b.Vg=!1,b.Xk=!1,b.gc=!1,b.fh=!1,b.Xi=!1,b.xb=!1,b.Rk=!1,b.render_resolution_factor=1,d.kk=512,b.gl=2,b.Ij=!1,b.ll=!0,b.precision="mediump",b.water_dynamic=!1,b.Gh=!1,b.antialiasing=!1,b.smaa=
!1,b.Zg=!1,b.wh=!1,b.allow_hidpi=!1,b.enable_outlining=!1,b.We=!1,c.dd=60}};a.set=function(c,d){switch(c){case "allow_cors":a.p.allow_cors=d;break;case "allow_hidpi":a.p.allow_hidpi=d;break;case "alpha":a.context.alpha=d;break;case "alpha_sort":a.p.alpha_sort=d;break;case "alpha_sort_threshold":a.p.alpha_sort_threshold=d;break;case "anaglyph_use":a.p.anaglyph_use=d;break;case "animation_framerate":a.Ud.Ja=d;break;case "antialiasing":a.p.antialiasing=d;break;case "assets_dds_available":a.Vd.sm=d;break;
case "assets_min50_available":a.Vd.Cn=d;break;case "audio":a.kd.Po=d;break;case "background_color":a.p.background_color=d;break;case "built_in_module_name":a.Ub.Rj=d;break;case "canvas_resolution_factor":a.p.canvas_resolution_factor=d;break;case "console_verbose":a.p.console_verbose=d;break;case "do_not_load_resources":a.p.do_not_load_resources=d;break;case "gyro_use":a.p.gyro_use=d;break;case "physics_enabled":a.Xa.enabled=d;break;case "physics_uranium_path":a.Xa.pj=d;break;case "physics_calc_fps":a.Xa.Xl=
d;break;case "precision":a.p.precision=d;break;case "quality":a.p.quality=d;break;case "render_resolution_factor":a.p.render_resolution_factor=d;break;case "sfx_mix_mode":a.kd.Bk=d;break;case "shaders_dir":a.Ub.shaders_dir=d;break;case "show_hud_debug_info":a.p.show_hud_debug_info=d;break;case "smaa":a.p.smaa=d;break;case "smaa_search_texture_path":a.Ub.smaa_search_texture_path=d;break;case "smaa_area_texture_path":a.Ub.smaa_area_texture_path=d;break;case "wireframe_debug":a.p.wireframe_debug=d;break;
case "enable_selectable":a.p.enable_selectable=d;break;case "enable_outlining":a.p.enable_outlining=d;break;case "outlining_overview_mode":a.Gb.outlining_overview_mode=d;break;case "glow_materials":a.p.We=d;break;default:b.error("Unknown config property: "+c)}};a.get=function(c){switch(c){case "allow_cors":return a.p.allow_cors;case "allow_hidpi":return a.p.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.p.alpha_sort;case "alpha_sort_threshold":return a.p.alpha_sort_threshold;
case "anaglyph_use":return a.p.anaglyph_use;case "animation_framerate":return a.Ud.Ja;case "antialiasing":return a.p.antialiasing;case "assets_dds_available":return a.Vd.sm;case "assets_min50_available":return a.Vd.Cn;case "audio":return a.kd.Po;case "background_color":return a.p.background_color;case "built_in_module_name":return a.Ub.Rj;case "canvas_resolution_factor":return a.p.canvas_resolution_factor;case "console_verbose":return a.p.console_verbose;case "do_not_load_resources":return a.p.do_not_load_resources;
case "gyro_use":return a.p.gyro_use;case "physics_enabled":return a.Xa.enabled;case "physics_uranium_path":return a.Xa.pj;case "physics_calc_fps":return a.Xa.Xl;case "precision":return a.p.precision;case "quality":return a.p.quality;case "render_resolution_factor":return a.p.render_resolution_factor;case "sfx_mix_mode":return a.kd.Bk;case "shaders_dir":return a.Ub.shaders_dir;case "show_hud_debug_info":return a.p.show_hud_debug_info;case "smaa":return a.p.smaa;case "smaa_search_texture_path":return a.Ub.smaa_search_texture_path;
case "smaa_area_texture_path":return a.Ub.smaa_area_texture_path;case "wireframe_debug":return a.p.wireframe_debug;case "enable_selectable":return a.p.enable_selectable;case "enable_outlining":return a.p.enable_outlining;case "outlining_overview_mode":return a.Gb.outlining_overview_mode;case "glow_materials":return a.p.We;default:b.error("Unknown config property: "+c)}};a.reset=function(){a.context=e.la(a.Kw);a.p=e.la(a.yx);a.Vd=e.la(a.Pv);a.Xa=e.la(a.eA);a.Dh=e.la(a.NA);a.kd=e.la(a.mB);a.tm=e.la(a.ux)};
a.mz=c;a.cB=function(){var b=a.Ub,g=a.Xa;c()||""!=b.shaders_dir||(b.shaders_dir=d()+"../shaders/");if(c())b.smaa_search_texture_path="smaa_search_texture.png",b.smaa_area_texture_path="smaa_area_texture.png";else if(""==b.smaa_search_texture_path||""==b.smaa_area_texture_path){var e=d()+b.Gs;b.smaa_search_texture_path=b.smaa_search_texture_path||e+"smaa_search_texture.png";b.smaa_area_texture_path=b.smaa_area_texture_path||e+"smaa_area_texture.png"}g.enabled&&""==g.pj&&(e=d()+b.Gs,g.pj=e+"uranium.js")};
a.get_std_assets_path=function(){return a.Vd.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,p){function c(a,k){var c=document.createElement("div"),g=c.style;g.position="absolute";g.backgroundColor="black";g.borderRadius="20px 20px 20px 0px";g.boxShadow="0px 0px 10px rgb(180, 180, 200)";g.opacity=1;g.padding="8px 12px";g.lineHeight="15px";g.visibility="hidden";g.fontSize="12px";var m=n.get_container();m.appendChild(c);var h=f.get_meta_tags(a),l=document.createElement("span"),t=l.style;l.innerHTML=h.title||a.name;t.fontWeight="bold";t.fontSize="12px";t.lineHeight=
"15px";t.color="#fff";t.fontFamily="Arial";e(l);c.appendChild(l);var r=h.description;if(r){var h=document.createElement("div"),A=h.style;A.position="absolute";A.bottom="0px";A.left="0px";A.backgroundColor="#000";A.borderRadius="20px 20px 20px 0px";A.boxShadow="0px 0px 10px rgb(180, 180, 200)";A.visibility="hidden";A.padding="8px 12px";A.overflow="hidden";A.lineHeight="15px";A.fontSize="12px";A.zIndex="2";c.appendChild(h);var I=document.createElement("span"),C=I.style;I.innerHTML=r;C.fontSize="12px";
C.fontFamily="Arial";C.fontWeight="bold";C.lineHeight="15px";C.color="#fff";C.visibility="hidden";h.appendChild(I);var Q=!1,M=!1;m.addEventListener("click",function(a){if(!(Q||M||E))if(a.target!=l&&a.target!=c||"hidden"!=A.visibility||1!=g.opacity)"visible"==A.visibility&&(g.visibility="visible",t.visibility="visible",A.visibility="hidden",C.visibility="hidden");else{g.visibility="hidden";t.visibility="hidden";A.visibility="visible";Q=M=!0;a=c.offsetWidth-24;var I=c.offsetHeight-16,f=Math.min(k,d(r)),
u=b(r,f);u==I&&(A.height=u+"px");f!=a?w.animate(a,f,200,function(a){a==f&&("visible"==A.visibility&&(C.visibility="visible"),Q=!1);A.width=a+"px"}):Q=!1;u!=I?w.animate(I,u,200,function(a){a==u&&("visible"==A.visibility&&(C.visibility="visible"),M=!1);A.height=a+"px"}):M=!1;M||Q||(C.visibility="visible")}},!1)}return c}function d(a){var b=document.createElement("div"),c=document.createElement("span"),d=b.style;c.innerHTML=a;c.style.fontSize="12px";c.style.fontFamily="Arial";c.style.fontWeight="bold";
c.style.color="#fff";c.style.visibility="hidden";d.lineHeight="15px";b.appendChild(c);d.position="absolute";d.visibility="hidden";d.fontSize="12px";d.display="inline-block";d.lineHeight="15px";document.body.appendChild(b);a=b.offsetWidth+1;document.body.removeChild(b);return a}function b(a,b){var c=document.createElement("div"),d=document.createElement("span"),f=c.style;d.innerHTML=a;d.style.fontSize="12px";d.style.fontFamily="Arial";d.style.fontWeight="bold";d.style.color="#fff";d.style.visibility=
"hidden";f.lineHeight="15px";c.appendChild(d);f.position="absolute";f.visibility="hidden";f.fontSize="12px";f.display="inline-block";f.width=b+"px";f.lineHeight="15px";document.body.appendChild(c);d=c.offsetHeight;document.body.removeChild(c);return d}function e(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]="none";a.style.cursor="default"}
function h(){for(var a=0,b=0;b<y.length;b++)y[b].vm&&a++;H=new Float32Array(3*a)}var g=p("__batch"),l=p("__camera"),n=p("__container"),f=p("__objects"),m=p("__print"),r=p("__renderer"),z=p("__scenes"),w=p("__time");p("__util");p("__config");var E=!1,y=[],H=new Float32Array(0),v=new Uint8Array(16),B=new Float32Array(2),t=new Float32Array(3);a.append=function(a){var b;a:{for(b=0;b<y.length;b++)if(y[b].obj==a){b=!0;break a}b=!1}if(!b){b=a.b4w_anchor.detect_visibility&&Boolean(z.aa(z.ih(),"ANCHOR_VISIBILITY"));
b={type:a.b4w_anchor.type,obj:a,x:0,y:0,depth:0,Tg:"out",vm:b,element:null,xh:null,rv:a.b4w_anchor.max_width,lp:0};switch(b.type){case "ANNOTATION":b.element=c(a,b.rv);b.lp=b.element.offsetHeight;break;case "ELEMENT":b.element=document.getElementById(a.b4w_anchor.element_id),b.element||(m.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}y.push(b);h()}};a.remove=function(a){for(var b=0;b<y.length;b++){var c=y[b];if(c.obj==a){"ANNOTATION"==c.type&&(a=c,n.get_container().removeChild(a.element));
y.splice(b,1);h();break}}};a.update=function(){for(var a=0,b=y.length;b--;){var c=y[b];c.vm&&(H.set(c.obj.e.h,3*a),a++);var d,f=c,e=t;d=z.hk(z.ih());d=e=l.project_point(d,f.obj.e.h,e);f=d[0];e=d[1];d=d[2];if(f!=c.x||e!=c.y||d!=c.depth){switch(c.type){case "ANNOTATION":var m=c.element;m.style.left=Math.floor(f)+"px";m.style.top=Math.floor(e-c.lp)+"px";break;case "ELEMENT":var m=c.element,h=m.getBoundingClientRect();m.style.cssText+="left:"+Math.floor(f-h.width/2)+"px;top:"+Math.floor(e-h.height/2)+
"px;"}c.x=f;c.y=e;c.depth=d;c.xh&&c.xh(f,e,c.Tg,c.obj,m)}}0<a&&(a=z.aa(z.ih(),"ANCHOR_VISIBILITY").q[0].B,g.fC(a,H))};a.AC=function(){for(var a=n.get_container(),b=y.length;b--;){var c=y[b],d=c.obj,f=c.x,g=c.y,e=c.depth,e=0>f||0>g||0>e||1<e||z.is_hidden(d)||f>=a.clientWidth||g>=a.clientHeight?"out":"visible";if(c.vm&&"out"!=e){var e=c,m=z.aa(z.ih(),"ANCHOR_VISIBILITY").j,h=n.$l(e.x,e.y,B,m);r.Bs(m.je,h[0],m.height-h[1],2,2,v);e=1020==v[0]+v[4]+v[8]+v[12]?"visible":"out"==e.Tg||0==v[0]+v[4]+v[8]+v[12]?
"covered":e.Tg}if(e!=c.Tg){switch(c.type){case "ANNOTATION":case "ELEMENT":var A=c.element;if(!A)break;"out"==e?(A.style.visibility="hidden",A.children.length&&(A.children[0].style.visibility="hidden"),"ANNOTATION"==c.type&&1<A.children.length&&(m=A.children[1],m.style.visibility="hidden",m.children.length&&(m.children[0].style.visibility="hidden"))):"visible"==e?(A.style.visibility="visible",A.children.length&&(A.children[0].style.visibility="visible"),A.style.opacity=1):(A.style.visibility="visible",
A.style.opacity=.1,A.children.length&&(A.children[0].style.visibility="visible"),"ANNOTATION"==c.type&&1<A.children.length&&(m=A.children[1],m.style.visibility="hidden",m.children.length&&(m.children[0].style.visibility="hidden")))}c.Tg=e;c.xh&&c.xh(f,g,c.Tg,d,A)}}};a.attach_move_cb=function(a,b){for(var c=0;c<y.length;c++)y[c].obj==a&&(y[c].xh=b)};a.detach_move_cb=function(a){for(var b=0;b<y.length;b++)y[b].obj==a&&(y[b].xh=null)};a.cleanup=function(){for(var a=0;a<y.length;a++){var b=y[a];"ANNOTATION"==
b.type&&n.get_container().removeChild(b.element)}y.length=0};a.is_anchor=function(a){return a.b4w_anchor?!0:!1};a.get_element_id=function(a){return a.b4w_anchor&&a.b4w_anchor.element_id?a.b4w_anchor.element_id:!1};a.pause=function(){E=!0};a.resume=function(){E=!1}};b4w.module.__boundings=function(a,p){function c(a,b){for(var c=a[0],d=a[1],f=a[2],g=a[0],e=a[1],m=a[2],h=3;h<a.length;h+=3)var u=a[h],k=a[h+1],l=a[h+2],c=Math.max(c,u),d=Math.max(d,k),f=Math.max(f,l),g=Math.min(g,u),e=Math.min(e,k),m=Math.min(m,l);b.max_x=c;b.max_y=d;b.max_z=f;b.min_x=g;b.min_y=e;b.min_z=m;return b}function d(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,f=a.max_z,g=a.min_x,e=a.min_y,m=a.min_z;b[0]=g;b[1]=e;b[2]=m;b[3]=c;b[4]=e;b[5]=m;b[6]=c;b[7]=d;b[8]=m;b[9]=g;b[10]=
d;b[11]=m;b[12]=g;b[13]=e;b[14]=f;b[15]=c;b[16]=e;b[17]=f;b[18]=c;b[19]=d;b[20]=f;b[21]=g;b[22]=d;b[23]=f;return b}function b(a,b,c){g.add(b,c,a.F);g.scale(a.F,.5,a.F);a.Fa=g.distance(a.F,b);return a}var e=p("__util"),h=p("__tsr"),g=p("vec3"),l=new Float32Array(24),n=new Float32Array(3),f=new Float32Array(3),m=new Float32Array(3);a.Xp=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.GD=function(){return{max_x:1E12,min_x:-1E12,max_y:1E12,
min_y:-1E12,max_z:1E12,min_z:-1E12}};a.Nd=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.sq=function(a,b){var c=a.max_y,d=a.max_z,f=a.min_x,g=a.min_y,e=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,f);a.min_y=Math.min(b.min_y,g);a.min_z=Math.min(b.min_z,e)};a.Wv=c;a.Tl=function(b,f,g){g||(g=a.Nd());b=d(b,l);e.jf(b,f,b);return c(b,g)};a.Sx=d;a.oF=function(b,c,d){d||(d=a.Nd());
var f=c.min_x,g=c.max_x,e=c.min_y,m=c.max_y,h=c.min_z;c=c.max_z;if(f>=b.max_x||g<=b.min_x||e>=b.max_y||m<=b.min_y||h>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,f);d.max_x=Math.min(b.max_x,g);d.min_y=Math.max(b.min_y,e);d.max_y=Math.min(b.max_y,m);d.min_z=Math.max(b.min_z,h);d.max_z=Math.min(b.max_z,c);return d};a.sF=function(b,c,d){d||(d=a.Nd());var f=b.max_x-b.min_x,g=b.max_y-b.min_y,e=b.max_z-b.min_z;d.min_x=b.min_x-
.5*(c-1)*f;d.max_x=b.max_x+.5*(c-1)*f;d.min_y=b.min_y-.5*(c-1)*g;d.max_y=b.max_y+.5*(c-1)*g;d.min_z=b.min_z-.5*(c-1)*e;d.max_z=b.max_z+.5*(c-1)*e;return d};a.Vl=function(b,c,d){d||(d=a.vj());g.transformMat4(b.F,c,d.F);d.Fa=b.Fa*e.An(c);return d};a.Ul=function(a,b,c){c||(c={If:new Float32Array(3),Jf:new Float32Array(3),Kf:new Float32Array(3),F:new Float32Array([0,0,0])});h.transform_vec3(a.F,b,c.F);g.copy(a.If,c.If);g.copy(a.Jf,c.Jf);g.copy(a.Kf,c.Kf);h.transform_dir_vec3(c.If,b,c.If);h.transform_dir_vec3(c.Jf,
b,c.Jf);h.transform_dir_vec3(c.Kf,b,c.Kf);return c};a.lm=function(a,b){return{Fa:a,F:new Float32Array(b)}};a.vj=function(){return{F:new Float32Array([0,0,0]),Fa:0}};a.km=function(a,b,c,d){return{If:new Float32Array(a),Jf:new Float32Array(b),Kf:new Float32Array(c),F:new Float32Array([d[0],d[1],d[2]])}};a.Yv=function(){return{F:new Float32Array([0,0,0]),Fa:1E12}};a.Ox=function(a,b){var c=g.subtract(b.F,a.F,g.create());0==g.length(c)&&g.set(1,0,0,c);var d=g.normalize(c,g.create()),c=g.scale(d,a.Fa,g.create());
g.add(c,a.F,c);var f=g.scale(d,-a.Fa,g.create());g.add(f,a.F,f);var e=g.scale(d,b.Fa,g.create());g.add(e,b.F,e);var m=g.scale(d,-b.Fa,g.create());g.add(m,b.F,m);c=[c,f,e,m];d=g.normalize(d,g.create());f=c[0];e=c[0];for(m=1;m<c.length;m++){var h=g.dot(c[m],d);h<g.dot(f,d)&&(f=c[m]);h>g.dot(e,d)&&(e=c[m])}d=[f,e];c=d[0];d=d[1];a.F=g.scale(g.add(c,d,g.create()),.5,g.create());a.Fa=g.length(g.subtract(d,c,g.create()))/2};a.$p=function(a,b){var c=b.max_y,d=b.min_y,f=Math.max(0,c-d-2*a);return{Fa:a,height:f,
F:new Float32Array([0,(c+d)/2,0])}};a.bq=function(a,b){var c=b.max_y,d=b.min_y,f=Math.max(0,c-d);return{Fa:a,height:f,F:new Float32Array([0,(c+d)/2,0])}};a.aq=function(a,b){var c=b.max_y,d=b.min_y,f=Math.max(0,c-d);return{Fa:a,height:f,F:new Float32Array([0,(c+d)/2,0])}};a.KD=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.tA=function(a){for(var b=0,c=0,d=0,f=0,g=0,e=0,m=0,h=0,u=0;u<a.submeshes.length;u++){var k=
a.submeshes[u];if(k.position.length){b=f=k.position[0];c=g=k.position[1];d=e=k.position[2];break}}for(u=0;u<a.submeshes.length;u++)for(var k=a.submeshes[u],k=k.position,l=0;l<k.length/3;l++)var n=k[3*l],G=k[3*l+1],D=k[3*l+2],b=Math.max(n,b),c=Math.max(G,c),d=Math.max(D,d),f=Math.min(n,f),g=Math.min(G,g),e=Math.min(D,e),m=Math.max(Math.sqrt(n*n+G*G+D*D),m),h=Math.max(Math.sqrt(n*n+D*D),h);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=f;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=g;a.b4w_bounding_box.max_z=
d;a.b4w_bounding_box.min_z=e;a.b4w_bounding_box_source.max_x=b;a.b4w_bounding_box_source.min_x=f;a.b4w_bounding_box_source.max_y=c;a.b4w_bounding_box_source.min_y=g;a.b4w_bounding_box_source.max_z=d;a.b4w_bounding_box_source.min_z=e;a.b4w_bounding_sphere_radius=m;a.b4w_bounding_cylinder_radius=h};a.Jy=function(c){var d=c.subarray(0,3),h=c.subarray(6,9),l=c.subarray(12,15),y=c.subarray(18,21);c=g.subtract(h,d,n);g.normalize(c,c);var H=e.My(d,h,l,f),H=g.cross(H,c,H);g.normalize(H,H);var v=g.create(),
B=g.create();g.subtract(h,d,m);B[0]=g.dot(m,c);B[1]=g.dot(m,H);h=g.create();g.subtract(l,d,m);h[0]=g.dot(m,c);h[1]=g.dot(m,H);l=g.create();g.subtract(y,d,m);l[0]=g.dot(m,c);l[1]=g.dot(m,H);y=a.vj();l=[v,B,h,l];v=b(y,l[0],l[1]);for(y=2;y<l.length;y++)if(g.distance(v.F,l[y])>v.Fa){for(var t=v,v=l,B=l[y],h=y-1,t=b(t,B,v[0]),u=1;u<=h;u++)if(g.distance(t.F,v[u])>t.Fa){for(var k=t,t=v,q=B,J=v[u],G=u-1,k=b(k,q,J),D=0;D<=G;D++)if(g.distance(k.F,t[D])>k.Fa){var L=q,K=J,O=t[D],A=g.subtract(K,O,m),A=g.squaredLength(A),
I=g.subtract(L,O,m),C=g.squaredLength(I),I=g.subtract(L,K,m),Q=g.squaredLength(I),I=A*(C+Q-A),M=C*(Q+A-C),A=Q*(A+C-Q),C=I+M+A;g.copy(L,k.F);g.scale(k.F,I/C,k.F);g.scaleAndAdd(k.F,K,M/C,k.F);g.scaleAndAdd(k.F,O,A/C,k.F);k.Fa=g.distance(k.F,L)}t=k}v=t}y=v;c=g.scale(c,y.F[0],m);g.scaleAndAdd(c,H,y.F[1],c);g.add(c,d,y.F);return y}};b4w.module.__compat=function(a,p){function c(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function d(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function b(){return!window.ActiveXObject&&"ActiveXObject"in window}var e=p("__config"),h=p("__extensions"),g=p("__print");
p("__util");a.Dx=function(a){a.getError()==a.INVALID_ENUM&&g.warn("Possible Tegra invalid enum issue detected, ignoring")};a.XA=function(a){var n=e.Ud,f=e.p,m=e.context,r=e.Dh,z=e.kd;f.Jr=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);f.Lb=a.getParameter(a.MAX_TEXTURE_SIZE);f.qg=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var w=Boolean(h.Ey());c("Firefox/28.0")&&(c("Linux")||c("Macintosh"))&&(g.warn("Firefox 28 detected, applying depth hack"),w=!1);c("iPad")||c("iPhone")?(g.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack, applying ios depth hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
m.alpha||(f.background_color[3]=1),f.It=!0,f.smaa=!1,f.Ae=!1,f.precision="highp",f.nr=!0,f.qr=!0):c("Mac OS X")&&c("Safari")&&!c("Chrome")&&(g.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),z.sp=!0,z.Pp=!0);c("Windows")&&(c("Chrome/40")||c("Firefox/33")||c("Firefox/34")||c("Firefox/35")||c("Firefox/36"))&&(g.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),f.cm=!0);d()&&(g.warn("Mobile detected, applying various hacks for video textures."),
f.gg=!0,c("iPad")||c("iPhone")||(g.warn("Mobile (not iOS) detected, disable playback rate for video textures."),z.oq=!0));(c("Firefox/35.0")||c("Firefox/36.0"))&&c("Windows")&&(g.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),f.zq=!0);if(c("iPhone")||b())g.warn("iPhone or IE11 detected. Enable sequential video fallback for video textures."),f.Wc=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(g.warn("Not enough varyings, disable shadows on blend objects"),f.nq=!0);if(m=h.Uq())c("Macintosh")&&
-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(g.warn("OS X / Intel HD 3000 detected, applying depth hack"),w=!1),c("Windows")&&c("Chrome")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Intel")&&(g.warn("Chrome / Windows / Intel GPU detected, applying cubemap mipmap/rgb hack"),f.hn=!0),-1<a.getParameter(m.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(g.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),
w=!1,n.Eq=!0),-1<a.getParameter(m.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(g.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),f.precision="highp",f.jj=!1),-1<a.getParameter(m.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T760")&&(g.warn('ARM Mali-T760 detected, set "highp" precision and disable SSAO.'),f.precision="highp",f.Ae=!1),-1<a.getParameter(m.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&
-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(g.warn("Qualcomm Adreno detected, applying shader constants hack."),f.Qs=!0,-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(g.warn('Qualcomm Adreno305 detected, set "highp" precision.'),f.precision="highp"),-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(g.warn('Qualcomm Adreno330 detected, set "highp" precision.'),f.precision="highp")),-1<a.getParameter(m.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&
(g.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),f.Km=!0),c("Windows")&&c("Chrome")&&a.getParameter(m.UNMASKED_RENDERER_WEBGL).match(/NVIDIA GeForce 8..0/)&&(g.warn("Chrome / Windows / NVIDIA GeForce 8000 series detected, setting max cubemap size to 256."),f.qg=256);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(g.warn("Vertex textures are not allowed. Disabling vertex textures"),f.Cl=!1);f.allow_hidpi&&1<window.devicePixelRatio&&(g.log("%cENABLE HIDPI MODE",
"color: #00a"),f.render_resolution_factor=1,f.smaa=!1);w||(f.fh=!1,f.Xi=!1,f.xb=!1,f.water_dynamic=!1,f.shore_smoothing=!1,f.Gh=!1,f.smaa=!1);f.Bt=Boolean(h.Vq());f.vi=w;0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(f.precision="mediump");b()&&(g.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),r.$j=512);b()&&c("Touch")&&(g.warn("IE11 and touchscreen detected. Behaviour of the mouse move sensor will be changed."),f.en=!0);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&
(g.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),f.Km=!0);c("Chrome")&&(g.log("Chrome detected. Some of deprecated functions related to the Doppler effect won't be called."),f.bm=!0,f.Zp=!0);if(b()||c("iPad"))g.warn("iPad or Internet Explorer detected. Applying alpha clip hack."),f.Fl=!0;d()&&c("Firefox")&&(g.log("Mobile firefox detected. Applying autoplay media hack."),f.En=!0)};a.detect_mobile=d;a.Iv=function(){c("Firefox/35.0")&&c("Windows")&&(g.warn("Windows/Firefox 35 detected, forcing context's alpha"),
e.context.alpha=!0)};a.kn=b};b4w.module.__constraints=function(a,p){function c(a){var b={};b.type=a;return b}function d(a,A){a.ab&&a.ab.R&&e(a.ab.R,a);A.R&&b(A.R,a);a.ab=A}function b(a,b){if(-1==a.Nc.indexOf(b))a.Nc.push(b);else throw"Descendant object override is forbidden";}function e(a,b){var c=a.Nc.indexOf(b);if(-1!=c)a.Nc.splice(c,1);else throw"No descendant object";}function h(a,b,c){switch(b.type){case 1:var d=a.e.quat,e=b.R.e.W;c=b.R.e.quat;b.hc?(w.copy(b.hc,d),w.multiply(c,d,d)):w.copy(c,d);z.transformMat4(b.offset,
e,a.e.h);a.e.scale=b.Yk*b.R.e.scale;break;case 9:var M=a.e.h,d=a.e.quat,e=b.R.e.W;c=b.R.e.quat;w.multiply(w.invert(b.zg,b.zg),d,d);w.multiply(c,d,d);z.transformMat4(b.offset,e,M);w.copy(c,b.zg);break;case 10:M=a.e.h;d=a.e.quat;e=b.R.e.W;c=b.R.e.quat;w.multiply(w.invert(b.zg,b.zg),d,d);w.multiply(c,d,d);z.transformMat4(b.offset,e,M);w.copy(c,b.zg);M=a.e.quat;d=w.multiply(b.R.e.quat,b.hc,k);d=r.Nq(d,y);M=r.Nq(M,H);r.rotate_eye_camera(a,m.Ne(M[0],d[0]+b.Aw,d[0]+b.zw),m.Ne(M[1],d[1]+b.yw,d[1]+b.Bw));
break;case 12:var M=a.e.h,d=a.e.quat,e=b.R.e.W,h=b.R.e.h,t=b.tB,q=v,B=k;z.transformMat4(b.offset,e,q);m.smooth_v(q,M,c,t,M);e=v;z.sub(h,M,e);z.normalize(e,e);var G=d,M=D,h=M.subarray(0,3),q=M.subarray(3,6),p=M.subarray(6,9);z.copy(e,q);z.negate(q,q);z.normalize(q,q);Boolean(.999999<Math.abs(z.dot(e,m.AXIS_Y)))?(e=E.fromQuat(w.normalize(G,B),L),z.copy(e.subarray(0,3),h)):z.cross(m.AXIS_Y,q,h);z.normalize(h,h);z.cross(h,q,p);z.normalize(p,p);w.fromMat3(M,B);w.normalize(B,B);m.Zs(B,d,c,.16*t,d);break;
case 2:d=a.e.quat;M=u;c=k;n(b.R,b.dw,!0,M,c);b.hc?(w.copy(b.hc,d),w.multiply(c,d,d)):w.copy(c,d);a.e.scale=b.Yk*M[3];m.transform_vec3(b.offset,M[3],c,M,a.e.h);break;case 3:M=a.e.h;d=a.e.quat;c=b.R.e.h;g(M,d,c);break;case 4:M=a.e.h;d=a.e.quat;c=b.target;g(M,d,c);break;case 5:M=a.e.h;d=a.e.quat;c=b.R.e.h;g(M,d,c);d=z.dist(M,c);if(d=d>b.dist_max?d-b.dist_max:d<b.wi?d-b.wi:0)z.sub(c,M,v),z.normalize(v,v),z.scale(v,d,v),z.add(M,v,M);break;case 6:M=a.e.h;d=a.e.quat;c=b.target;g(M,d,c);d=z.dist(M,c);if(d=
d>b.dist_max?d-b.dist_max:d<b.wi?d-b.wi:0)z.sub(c,M,v),z.normalize(v,v),z.scale(v,d,v),z.add(M,v,M);break;case 7:e=b.R.e.W;z.transformMat4(b.offset,e,a.e.h);break;case 8:h=b.R.e.h;M=a.e.h;z.add(h,b.offset,M);break;case 13:d=a.e.quat;e=b.R.e.W;c=b.R.e.quat;b.hc?(w.copy(b.hc,d),w.multiply(c,d,d)):w.copy(c,d);z.transformMat4(b.offset,e,a.e.h);break;case 11:M=b.R.e;c=f.create_sep(M.h,M.scale,M.quat,J);f.multiply(c,b.tt,c);M=a.e.h;M[0]=c[0];M[1]=c[1];M[2]=c[2];a.e.scale=c[3];d=a.e.quat;d[0]=c[4];d[1]=
c[5];d[2]=c[6];d[3]=c[7];break;case 14:c=b.R,d=r.Hy(c),M=a.e.h,t=r.ik(d,"TOP"),B=r.ik(d,"BOTTOM"),e=t-B,b.Er?(h=r.ik(d,"LEFT"),M[0]=h+e*b.rn):(h=r.ik(d,"RIGHT"),M[0]=h-e*b.rn),M[2]=b.rt?-(t-e*b.zo):-(B+e*b.zo),r.uz(d)?M[1]=-b.distance:(M[1]=-1,z.normalize(M,M),z.scale(M,b.distance/Math.abs(M[1]),M)),f.transform_dir_vec3(M,c.e.Cb,M),z.add(c.e.h,M,M),d=a.e.quat,b.hc?(w.copy(b.hc,d),w.multiply(c.e.quat,d,d)):w.copy(c.e.quat,d)}"CAMERA"==a.e.type&&(M=m.AXIS_Y,10==b.type&&(c=b.R.e.quat,M=z.transformQuat(M,
c,K)),r.Fo(a),l(a,M))}function g(a,b,c){var d=v;m.quat_to_dir(b,m.AXIS_MY,d);z.normalize(d,d);var k=B;z.subtract(c,a,k);z.normalize(k,k);a=m.JA(d,k,u);w.multiply(a,b,b);w.normalize(b,b)}function l(a,b){var c=a.e,d=c.quat,f=m.quat_to_dir(c.quat,m.AXIS_Y,v);z.normalize(f,f);if(.999999<Math.abs(z.dot(b,f)))f=w.identity(k);else{var e=z.cross(b,f,B);z.normalize(e,e);if(c.xa==r.MS_TARGET_CONTROLS)c.vo&&z.negate(e,e);else{var g=m.quat_to_dir(c.quat,m.AXIS_Z,t);0<z.dot(g,b)&&z.negate(e,e)}c=m.quat_to_dir(c.quat,
m.AXIS_X,t);z.normalize(c,c);var g=m.clamp(z.dot(c,e),-1,1),h=Math.acos(g),f=-.999999>=g?w.setAxisAngle(f,h,k):w.rotationTo(c,e,k);w.normalize(f,f)}w.multiply(f,d,d);r.Fo(a)}function n(a,b,c,d,e){var g=a.e,m=g.Zf,h=g.Pc[b];b=h.ui;a=a.pose.bones[h.Pn];var h=a.fp,t=u,l=g.Kc,K=g.Jc,v=g.Cc,n=g.Bc,D=l[4*b+1],r=l[4*b+2],z=l[4*b+3],L=K[4*b+1],B=K[4*b+2],H=K[4*b+3];t[0]=(1-m)*l[4*b]+m*K[4*b];t[1]=(1-m)*D+m*L;t[2]=(1-m)*r+m*B;t[3]=(1-m)*z+m*H;l=k;K=q;l[0]=v[4*b];l[1]=v[4*b+1];l[2]=v[4*b+2];l[3]=v[4*b+3];K[0]=
n[4*b];K[1]=n[4*b+1];K[2]=n[4*b+2];K[3]=n[4*b+3];w.slerp(l,K,m,l);m=J;f.set_transcale(t,m);f.set_quat(l,m);c?(c=G,f.translate(h,a.pv,c),f.multiply(m,c,m)):f.multiply(m,h,m);f.multiply(g.Cb,m,m);d[0]=m[0];d[1]=m[1];d[2]=m[2];d[3]=m[3];e&&(e[0]=m[4],e[1]=m[5],e[2]=m[6],e[3]=m[7])}var f=p("__tsr"),m=p("__util"),r=p("__camera"),z=p("vec3");p("vec4");var w=p("quat"),E=p("mat3");p("mat4");a.hD=1;a.gD=2;a.lD=3;a.mD=4;a.bD=5;a.cD=6;a.iD=7;a.aD=8;a.fD=9;a.eD=10;a.Pd=11;a.dD=12;a.jD=13;a.kD=14;var y=new Float32Array(2),
H=new Float32Array(2),v=new Float32Array(3),B=new Float32Array(3),t=new Float32Array(3),u=new Float32Array(4),k=new Float32Array(4),q=new Float32Array(4),J=new Float32Array(16),G=new Float32Array(16),D=new Float32Array(9),L=new Float32Array(9),J=new Float32Array(8),K=new Float32Array(3);a.Gl=function(a,b,k,C,f){var e=c(1);e.R=b;e.offset=new Float32Array(k);e.hc=C?new Float32Array(C):null;e.Yk=f;d(a,e);h(a,e,0)};a.mp=function(a,b,k,C,f,e){var g=c(2);g.R=b;g.dw=k;g.offset=new Float32Array(C);g.hc=f?
new Float32Array(f):null;g.Yk=e;d(a,g);h(a,g,0)};a.Av=function(a,b,k,C){var f=c(9),e=a.e.quat,g=b.e.quat;f.R=b;f.offset=new Float32Array(k);f.zg=new Float32Array(g);C&&(w.copy(C,e),w.multiply(g,e,e));d(a,f);h(a,f,0)};a.zv=function(a,b,k,C,f,e,g,u){var l=c(10),t=a.e.quat,q=b.e.quat;l.R=b;l.offset=new Float32Array(k);l.zg=new Float32Array(q);l.zw=m.angle_wrap_0_2pi(f);l.Aw=m.angle_wrap_0_2pi(e);l.Bw=m.angle_wrap_periodic(g,-Math.PI,Math.PI);l.yw=m.angle_wrap_periodic(u,-Math.PI,Math.PI);C?(l.hc=new Float32Array(C),
w.copy(C,t),w.multiply(q,t,t)):l.hc=w.create();d(a,l);h(a,l,0)};a.yv=function(a,b,k,C){var f=c(12);f.R=b;f.offset=new Float32Array(k);f.tB=C;d(a,f);h(a,f,0)};a.Cv=function(a,b,k,C){var f=c(13);f.R=b;f.offset=new Float32Array(k);f.Yk=1;f.hc=C?new Float32Array(C):null;d(a,f);h(a,f,0)};a.CD=b;a.hF=e;a.Ev=function(a,b){var k=c(3);k.R=b;d(a,k);h(a,k,0)};a.Fv=function(a,b){var k=c(4);k.target=new Float32Array(b);d(a,k);h(a,k,0)};a.vv=function(a,b,k,C){var f=c(5);f.R=b;f.wi=k;f.dist_max=C;d(a,f);h(a,f,0)};
a.wv=function(a,b,k,C){var f=c(6);f.target=new Float32Array(b);f.wi=k;f.dist_max=C;d(a,f);h(a,f,0)};a.Bv=function(a,b,k){var C=c(7);C.R=b;C.offset=new Float32Array(k);d(a,C);h(a,C,0)};a.uv=function(a,b,k){var C=c(8);C.R=b;C.offset=new Float32Array(k);d(a,C);h(a,C,0)};a.tv=function(a,b,k){var C=c(11);C.R=b;C.tt=new Float32Array(k);d(a,C);h(a,C,0)};a.append_stiff_viewport=function(a,b,k){var C=c(14);C.R=b;if("left"in k)C.Er=!0,C.rn=k.left;else if("right"in k)C.Er=!1,C.rn=k.right;else{m_print.error("append_stiff_viewport: Wrong positioning params");
return}if("top"in k)C.rt=!0,C.zo=k.top;else if("bottom"in k)C.rt=!1,C.zo=k.bottom;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}"distance"in k?(C.distance=k.distance,C.hc="rotation"in k?new Float32Array(k.rotation):null,d(a,C),h(a,C,0)):m_print.error("append_stiff_viewport: Wrong positioning params")};a.oC=function(a,b){a.ab&&h(a,a.ab,b)};a.IA=g;a.correct_up=l;a.qw=function(a){return a.ab?!0:!1};a.remove=function(a){a.ab.R&&e(a.ab.R,a);a.ab=null};a.le=function(a){return a.ab?
a.ab.type:null};a.get_parent=function(a){return a.ab&&a.ab.R?a.ab.R:null};a.ke=function(a){return a.ab&&11==a.ab.type?a.ab.tt:null};a.zy=n};b4w.module.__container=function(a,p){var c,d,b,e,h;function g(a,b){c=a;d=b}function l(){var a=m.getBoundingClientRect();g(a.left,a.top)}var n=p("__print"),f=p("__util"),m=null,r=null,z=!1;e=b=0;h=1;c=d=0;a.get_canvas=function(){return m};a.get_container=function(){return r};a.init=function(a){a&&a.parentNode?(m=a,r=a.parentNode):f.ga("canvas container is not available")};a.insert_to_container=function(a,b){b=b||"LAST";switch(b){case "FIRST":r.insertBefore(a,r.firstElementChild);break;case "JUST_BEFORE_CANVAS":r.insertBefore(a,
m);break;case "JUST_AFTER_CANVAS":m.nextElementSibling?r.insertBefore(a,m.nextElementSibling):r.appendChild(a,m);break;case "LAST":r.appendChild(a,m);break;default:n.error(b+" invalid stack order")}};a.Wy=function(){return b};a.Vy=function(){return e};a.set_canvas_offsets=g;a.update_canvas_offsets=l;a.lB=function(a,c,d){b=a;e=c;h=d;l()};a.force_offsets_updating=function(){z=!0};a.client_to_canvas_coords=function(a,b,f){f||(f=new Float32Array(2));var e=f;z&&(l(),z=!1);e[0]=a-c;a=f;z&&(l(),z=!1);a[1]=
b-d;return f};a.$l=function(a,c,d,f){d||(d=new Float32Array(2));d[0]=a*h;d[1]=c*h;f&&(a=f.width/b,d[0]*=a,d[1]*=a);return d};a.SC=function(a,c,d,f){d||(d=new Float32Array(2));d[0]=a/h;d[1]=c/h;f&&(a=f.width/b,d[0]/=a,d[1]/=a)};a.sr=function(b){return b&&b.parentNode?b.parentNode==r?!0:a.sr(b.parentNode):!1}};b4w.module.__controls=function(a,p){function c(a){return{type:a,value:0,da:null,bd:!1,key:0,Sa:"",td:!1,fm:null,em:function(){},dm:null,Rp:function(){},ye:null,P:new Float32Array(3),qa:new Float32Array(3),rr:!1,ok:!1,As:0,zs:function(){},axis:"",Ic:0,Uh:new Float32Array(3),Sk:new Float32Array(4),threshold:0,ws:new Float32Array(4),Lj:0,Kj:0,Is:0,Mj:0,Uc:0,repeat:!1,tp:!1,nk:0,mk:0,lk:0,$m:0,Zm:0,Ym:0}}function d(a,x){a.value=Number(x)}function b(a){for(var x=a.hd,b=a.SA,c=0;c<x.length;c++)b[c]=x[c].value;
return a.Ez(b)}function e(a){a=A.indexOf(a);-1<a?A.splice(a,1):u.error("Wrong object")}function h(a,x){for(var b=0,c=0;c<x.length;c++)for(var d=x[c].Je,A=0;A<d.length;A++)for(var k=d[A].hd,C=0;C<k.length;C++)k[C]===a&&b++;return b}function g(a,x){switch(a.type){case 80:k.remove_collision_test(a.fm,a.Sa,a.em);a.bd=!0;break;case 90:k.clear_collision_impulse_test(a.dm);a.bd=!0;break;case 100:k.remove_ray_test(a.As);a.bd=!0;break;case 130:a.bd=!0}var b=x.indexOf(a);-1<b&&x.splice(b,1)}function l(a){for(var x=
0;x<I.length;x++){var b=I[x];20==b.type&&a.keyCode==b.key&&d(b,1)}U&&a.preventDefault();qa&&qa(a)}function n(a){for(var x=0;x<I.length;x++){var b=I[x];20==b.type&&0==a.keyCode&&16==b.key&&d(b,0);20==b.type&&a.keyCode==b.key&&d(b,0)}U&&a.preventDefault();qa&&qa(a)}function f(a){var b=!1,c=null;fa=!0;R=a.clientX;Z=a.clientY;M=a.clientX;V=a.clientY;for(var A=0;A<I.length;A++){var k=I[A];50==k.type&&(d(k,1),k.da=a.which);160==k.type&&(b||(b=t.client_to_canvas_coords(a.clientX,a.clientY,da),c=q.pick_object(b[0],
b[1]),b=!0),k.value=c==k.ye?1:0)}Y&&a.preventDefault();x&&x(a)}function m(a){for(var b=0;b<I.length;b++){var c=I[b];50==c.type&&d(c,0);160==c.type&&c.tp&&(c.value=0)}fa=!1;Y&&!ca&&a.preventDefault();x&&x(a)}function r(a){var b=a.clientX,c=a.clientY;M=b;V=c;if(!O.en||fa)for(var A=b-R,k=c-Z,C=Math.sqrt(A*A+k*k),f=0;f<I.length;f++){var N=I[f];if(40===N.type)switch(N.axis){case "X":d(N,A);N.da=b;break;case "Y":d(N,k);N.da=c;break;case "XY":d(N,C),N.da[0]=b,N.da[1]=c}}Y&&!ca&&a.preventDefault();x&&x(a)}
function z(a){t.sr(a.relatedTarget)||m(a)}function w(a){var x=a.wheelDelta||-40*a.detail,x=x*K.Sz;Q+=x;for(x=0;x<I.length;x++){var b=I[x];30===b.type&&d(b,Q)}na&&a.preventDefault();N&&N(a)}function E(a){var x=a.targetTouches;if(1==x.length){for(var b=x[0],x=b.clientX,b=b.clientY,c=!1,d=null,A=0;A<I.length;A++){var k=I[A];160==k.type&&(c||(c=t.client_to_canvas_coords(x,b,da),d=q.pick_object(c[0],c[1]),c=!0),k.value=d==k.ye)}S[0]=x;S[1]=-1;oa[0]=b;oa[1]=-1}else 1<x.length&&(aa=ea=v(x),S[0]=x[0].clientX,
S[1]=x[1].clientX,oa[0]=x[0].clientY,oa[1]=x[1].clientY);W.set(S);ha.set(oa);pa&&pa(a)}function y(x){var b=x.targetTouches;if(0!==b.length){if(1===b.length){W[0]=b[0].clientX;W[1]=-1;ha[0]=b[0].clientY;ha[1]=-1;var b=W[0]-S[0],c=ha[0]-oa[0],A=Math.sqrt(b*b+c*c);if(-1!=S[1]&&-1!=oa[1]){var k=W[0]-S[1],C=ha[0]-oa[1],f=Math.sqrt(k*k+C*C);f<A&&(b=k,c=C,A=f)}for(f=0;f<I.length;f++){var N=I[f];if(60===N.type)switch(N.da=a.PL_SINGLE_TOUCH_MOVE,N.axis){case "X":d(N,b);break;case "Y":d(N,c);break;case "XY":d(N,
A)}}}else if(1<b.length){W[0]=b[0].clientX;W[1]=b[1].clientX;ha[0]=b[0].clientY;ha[1]=b[1].clientY;aa=v(b);A=aa-ea;k=da;k[0]=(W[0]+W[1])/2;k[1]=(ha[0]+ha[1])/2;C=ga;C[0]=(S[0]+S[1])/2;C[1]=(oa[0]+oa[1])/2;var e,b=k[0],c=k[1],f=C[0],N=C[1];e=Math.sqrt((b-f)*(b-f)+(c-N)*(c-N));for(f=0;f<I.length;f++)if(N=I[f],70===N.type&&Math.abs(e)<Math.abs(A)&&(N.da=a.PL_MULTITOUCH_MOVE_ZOOM,d(N,A)),60===N.type&&Math.abs(e)>Math.abs(A))switch(N.da=a.PL_MULTITOUCH_MOVE_PAN,N.axis){case "X":b=k[0]-C[0];d(N,b);break;
case "Y":c=k[1]-C[1];d(N,c);break;case "XY":d(N,e)}}ia&&x.preventDefault();pa&&pa(x)}}function H(a){for(var x=0;x<I.length;x++){var b=I[x];if(170==b.type||180==b.type)b.mk=a.beta,b.nk=a.gamma,b.lk=a.alpha,b.value||(b.$m=a.gamma,b.Zm=a.beta,b.Ym=a.alpha,d(b,1))}}function v(a){var x=a[0],b=a[1];a=x.clientX;var x=x.clientY,c=b.clientX,b=b.clientY;return Math.sqrt((a-c)*(a-c)+(x-b)*(x-b))}var B=p("__config"),t=p("__container"),u=p("__print"),k=p("__physics"),q=p("__scenes"),J=p("__time"),G=p("__util"),
D=p("vec3"),L=p("quat"),K=B.controls,O=B.p,A=[],I=[],C={},Q=0,M=0,V=0,R=0,Z=0,fa=!1,W=new Float32Array(2),ha=new Float32Array(2),S=new Float32Array(2),oa=new Float32Array(2),da=new Float32Array(2),ga=new Float32Array(2),aa=0,ea=0,ba=!1,F=0,U=!1,Y=!1,na=!1,ia=!1,ca=!1,qa=null,x=null,N=null,pa=null;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.CT_CHANGE=50;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.update=function(x,c){for(var k=0;k<I.length;k++){var f=
I[k],N=x,e=c;if(e)switch(f.type){case 110:var g=f.ye,m=g.e.h,g=g.e.quat,h=D.dist(f.Uh,m),u=f.ws;L.invert(f.Sk,u);L.multiply(g,u,u);L.normalize(u,u);u=Math.abs(2*Math.acos(u[3]));h/=e;f.Lj=G.smooth(h,f.Lj,e,.3);f.da[0]=h;h=u/e;f.Kj=G.smooth(h,f.Kj,e,.3);f.da[1]=h;f.Lj>=f.threshold||f.Kj>=f.Is?d(f,1):d(f,0);D.copy(m,f.Uh);L.copy(g,f.Sk);f.Ic=N;break;case 120:g=f.ye;m=g.e.h;g=Math.abs(m[1]-f.Uh[1])/e;f.Mj=G.smooth(g,f.Mj,e,.3);f.da=g;f.Mj>=f.threshold?d(f,1):d(f,0);D.copy(m,f.Uh);f.Ic=N;break;case 130:!f.bd&&
0<=f.Uc&&N-f.Ic>=f.Uc&&(d(f,1),f.repeat?f.Ic=N:f.Uc=-f.Uc);break;case 140:f.Ic||(f.Ic=N);d(f,N-f.Ic);f.Ic=N;break;case 150:d(f,N);break;case 170:f.da[0]=Math.PI*(f.nk-f.$m)/180;f.da[1]=Math.PI*(f.mk-f.Zm)/180;f.da[2]=Math.PI*(f.lk-f.Ym)/180;f.$m=f.nk;f.Zm=f.mk;f.Ym=f.lk;break;case 180:f.da[0]=Math.PI*f.nk/180,f.da[1]=Math.PI*f.mk/180,f.da[2]=Math.PI*f.lk/180}}for(k=0;k<A.length;k++)for(e=A[k],f=e.Je,N=0;N<f.length;N++)if(m=f[N],m.vt!=F){m.vt=F;u=m;g=0;switch(u.type){case a.CT_CONTINUOUS:g=u.oe;(h=
b(u))?(g=1,u.oe=1):1==g?(g=-1,u.oe=-1):g=0;break;case a.CT_TRIGGER:g=u.oe;(h=b(u))&&-1==g?(g=1,u.oe=1):h||1!=g?g=0:(g=-1,u.oe=-1);break;case a.CT_SHOT:g=u.oe;(h=b(u))&&-1==g?(g=1,u.oe=1):h||1!=g?g=0:(g=0,u.oe=-1);break;case a.CT_LEVEL:h=b(u);u.Br!=h?(g=1,u.Br=h):g=0;break;case a.CT_CHANGE:for(var h=u.hd,u=u.zz,l=0;l<h.length;l++){var t=h[l].value;g||t==u[l]||(g=1);u[l]=t}break;default:G.ga("Wrong sensor manifold type: "+u.type)}if(g&&(h=e==C?null:e,ba=!1,m.callback(h,m.id,g,m.gw),ba)){k=-1;break}}for(k=
0;k<A.length;k++)for(e=A[k],f=e.Je,N=0;N<f.length;N++)for(m=f[N],e=m.hd,m=0;m<e.length;m++)switch(g=e[m],g.type){case 30:d(g,0);break;case 40:d(g,0);break;case 60:d(g,0);break;case 70:d(g,0);break;case 130:d(g,0)}Q=0;R=M;Z=V;S.set(W);oa.set(ha);ea=aa;F++};a.create_custom_sensor=function(a){var x=c(10);d(x,a);return x};a.create_keyboard_sensor=function(a){var x=c(20);x.key=a;return x};a.create_collision_sensor=function(a,x,b){if(!a||!k.has_physics(a))return u.error("Wrong collision object"),null;var A=
c(80);A.fm=a;A.Sa=x;A.td=b;A.da={coll_obj:null,coll_pos:b?new Float32Array(3):null,coll_norm:b?new Float32Array(3):null,coll_dist:0};A.em=function(a,x,b,c,k){d(A,a);a=A.da;a.coll_obj=x;A.td&&(a.coll_pos.set(b),a.coll_norm.set(c),a.coll_dist=k)};A.bd=!0;return A};a.create_collision_impulse_sensor=function(a){if(!a||!a.n)return u.error("Wrong collision impulse object"),null;var x=c(90);x.dm=a;x.Rp=function(a){d(x,a)};x.bd=!0;return x};a.create_ray_sensor=function(a,x,b,A,k,f,C){var N=c(100);N.ye=a;
N.P=x;N.qa=b;N.Sa=A;N.rr=k;N.td=f;N.ok=C;N.da={hit_fract:0,obj_hit:null,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3)};N.zs=function(a,x,b,c,A,k){N.rr?d(N,-1==x?0:1):d(N,x);N.da.hit_fract=x;N.da.obj_hit=b;N.da.hit_time=c;N.td&&(N.da.hit_pos.set(A),N.da.hit_norm.set(k))};N.bd=!0;return N};a.create_mouse_click_sensor=function(){return c(50)};a.create_mouse_wheel_sensor=function(){return c(30)};a.create_mouse_move_sensor=function(a){var x=c(40);x.axis=a||"XY";x.da="XY"==x.axis?
new Float32Array(2):0;return x};a.create_touch_move_sensor=function(a){var x=c(60);x.axis=a||"XY";x.da=0;return x};a.create_touch_zoom_sensor=function(){var a=c(70);a.da=0;return a};a.create_motion_sensor=function(a,x,b){if(!a)return u.error("Wrong collision object"),null;var d=c(110);d.ye=a;var A=a.e.h;a=a.e.quat;d.ws=new Float32Array(4);d.Uh=new Float32Array(A);d.Sk=new Float32Array(a);d.Lj=0;d.Kj=0;d.threshold=x||.1;d.Is=b||.1;d.Ic=0;d.da=new Float32Array([0,0]);return d};a.create_vertical_velocity_sensor=
function(a,x){if(!a)return u.error("Wrong collision object"),null;var b=c(120);b.ye=a;var d=a.e.quat;b.Uh=new Float32Array(a.e.h);b.Sk=new Float32Array(d);b.Mj=0;b.threshold=x||1;b.Ic=0;b.da=0;return b};a.create_timer_sensor=function(a,x){var b=c(130);b.Uc=a;b.repeat=x;b.bd=!0;return b};a.reset_timer_sensor=function(a,x,b,c){a=a||C;a=a.Yc;if(!a||!a[x])return u.error("reset_timer_sensor(): wrong object"),null;x=a[x].hd[b];if(!x)return u.error("reset_timer_sensor(): sensor not found"),null;x.Ic=J.get_timeline();
x.Uc=c};a.create_elapsed_sensor=function(){var a=c(140);a.Ic=0;return a};a.create_gyro_delta_sensor=function(){var a=c(170);a.da=new Float32Array(3);return a};a.create_gyro_angles_sensor=function(){var a=c(180);a.da=new Float32Array(3);return a};a.create_timeline_sensor=function(){return c(150)};a.create_selection_sensor=function(a,x){var b=c(160);b.ye=a;b.tp=x;return b};a.RA=d;a.get_sensor_value=function(a,x,b){a=a||C;a=a.Yc;if(!a||!a[x])return u.error("get_sensor_value(): wrong object"),null;x=
a[x].hd[b];return x?x.value:(u.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=function(a,x,b){a=a||C;a=a.Yc;if(!a||!a[x])return u.error("get_sensor_payload(): wrong object"),null;x=a[x].hd[b];return x?x.da:(u.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){A=[];I=[];C={}};a.check_sensor_manifold=function(a,x){a=a||C;if(!a.Yc)return!1;if(x&&a.Yc[x])return!0;if(!x)for(var b in a.Yc)return!0;return!1};a.remove_sensor_manifold=function(a,x){a=a||
C;var b=a.Yc;if(b){var c=a.Je;if(x){var d=b[x];if(d){for(var k=d.hd,f=0;f<k.length;f++)1===h(k[f],A)&&g(k[f],I);delete b[x];d=c.indexOf(d);-1<d?c.splice(d,1):G.ga("Incorrect manifolds array");Object.getOwnPropertyNames(b).length||e(a)}}else{for(x in b){d=b[x];k=d.hd;for(f=0;f<k.length;f++)1===h(k[f],A)&&g(k[f],I);delete b[x];d=c.indexOf(d);-1<d?c.splice(d,1):G.ga("Incorrect manifolds array")}e(a);ba=!0}}};a.create_sensor_manifold=function(a,x,b,c,d,f,N){a=a||C;a.Yc=a.Yc||{};a.Je=a.Je||[];var e=a.Yc,
m=a.Je,u=e[x];if(u){c=u.hd;for(var M=0;M<c.length;M++)1===h(c[M],A)&&g(c[M],I);u=m.indexOf(u);-1<u?m.splice(u,1):G.ga("Incorrect manifolds array")}b={id:x,type:b,hd:c.slice(0),Ez:d,SA:Array(c.length),callback:f,gw:N,oe:-1,Br:0,zz:Array(c.length),vt:-1};e[x]=b;m.push(b);-1==A.indexOf(a)&&A.push(a);a=b.hd;for(x=0;x<a.length;x++){e=a[x];if(e.bd){switch(e.type){case 80:k.append_collision_test(e.fm,e.Sa,e.em,e.td);break;case 90:k.apply_collision_impulse_test(e.dm,e.Rp);break;case 100:e.As=k.append_ray_test(e.ye,
e.P,e.qa,e.Sa,e.zs,!1,!1,e.td,e.ok);break;case 130:e.Ic=J.get_timeline(),0>e.Uc&&(e.Uc=-e.Uc)}e.bd=!1}-1==I.indexOf(e)&&I.push(e)}ba=!0};a.kq=function(a){for(var x=0;x<a.length;x++)if(!a[x])return a[x];return a[a.length-1]};a.xx=function(a){for(var x=0;x<a.length;x++)if(a[x])return a[x];return a[a.length-1]};a.reset=function(){for(var a=0;a<A.length;a++){var x=A[a],b=x.Yc,x=x.Je,c;for(c in b)delete b[c];x.splice(0,x.length)}for(a=0;a<I.length;a++)g(I[a],I),a--;A.splice(0,A.length)};a.debug=function(){u.log(String(A.length)+
" objects with manifolds",A);u.log(String(I.length)+" sensors",I);for(var a=[],x=[],b=0;b<I.length;b++){var c=I[b];80==c.type&&a.push(c);100==c.type&&x.push(c)}u.log(String(a.length)+" collision sensors",a);u.log(String(x.length)+" ray sensors",x)};a.register_keyboard_events=function(a,x){a.addEventListener("keydown",l,!1);a.addEventListener("keyup",n,!1);U=x};a.register_mouse_events=function(a,x,b){if(b)var c=window;else c=a,c.addEventListener("mouseout",z,!1);a.addEventListener("mousedown",f,!1);
c.addEventListener("mousemove",r,!1);c.addEventListener("mouseup",m,!1);Y=x;ca=b};a.register_wheel_events=function(a,x){a.addEventListener("mousewheel",w,!1);a.addEventListener("DOMMouseScroll",w,!1);na=x};a.register_touch_events=function(a,x){a.addEventListener("touchstart",E,!1);a.addEventListener("touchmove",y,!1);document.addEventListener("touchstart",function(){});ia=x};a.register_device_orientation=function(){window.DeviceOrientationEvent&&O.gyro_use&&window.addEventListener("deviceorientation",
H,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",l,!1);a.removeEventListener("keyup",n,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",f,!1);a.removeEventListener("mousemove",r,!1);a.removeEventListener("mouseout",z,!1);a.removeEventListener("mouseup",m,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",w,!1);a.removeEventListener("DOMMouseScroll",w,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",
E,!1);a.removeEventListener("touchmove",y,!1);document.removeEventListener("touchstart",function(){})};a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&O.gyro_use&&window.removeEventListener("deviceorientation",H,!1)};a.AD=function(a){qa=a};a.BD=function(a){x=a};a.ED=function(a){N=a};a.DD=function(a){pa=a}};b4w.module.__curve=function(a,p){function c(a,b,c,d,f){var e=d.length;f||(f=new Float32Array(e));for(var r=e+a,z=new Float32Array(r),w=1;w<=r-1;w++)z[w-1]=b>=c[w-1]&&b<c[w+1-1]?1:0;for(var E=2;E<=a;E++)for(w=1;w<=r-E;w++)z[w-1]=(0!=z[w-1]?(b-c[w-1])*z[w-1]/(c[w+E-1-1]-c[w-1]):0)+(0!=z[w+1-1]?(c[w+E-1]-b)*z[w+1-1]/(c[w+E-1]-c[w+1-1]):0);b==c[r-1]&&(z[e-1]=1);a=0;for(w=1;w<=e;w++)a+=z[w-1]*d[w-1];for(w=1;w<=e;w++)f[w-1]=0!=a?z[w-1]*d[w-1]/a:0;return f}function d(a){a=a.xk;return a[a.length-1]}function b(a){a=
a.gq;return a[a.length-1]}var e=p("__util");a.ix=function(a){var b={},d=a.data;a=d.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var e=a.order_u;b.ff=e;a=a.points;var f=a.length/5,m=[],r=f+e,f=f+2;m[0]=0;for(var z=2;z<=r;z++)m[z-1]=z>e&&z<f?m[z-2]+1:m[z-2];b.xk=m;if("2D"==d.dimensions)b.af=!1;else if("3D"==d.dimensions)b.af=!0;else throw"Wrong curve dimensions";e=[];m=[];for(d=0;d<a.length;d+=5)e.push(a[d]),e.push(a[d+1]),e.push(a[d+2]),b.af&&e.push(a[d+3]),m.push(a[d+4]);b.jm=
e;b.Qo=m;a=[];for(var d=b.jm,e=b.af?4:3,m=b.Qo,r=b.xk,f=b.ff,z=d.length/e,w=z+f,E=0,y=r[w-1]/999,H=0;1E3>H;H++){5E-6>r[w-1]-E&&(E=r[w-1]);for(var v=c(f,E,r,m),B=0;B<e;B++)for(var t=a[e*H+B]=0;t<z;t++)a[e*H+B]+=v[t]*d[e*t+B];E+=y}e=b.af?4:3;m=new Float32Array(1E3);m[0]=0;for(d=1;1E3>d;d+=1)r=a[(d-1)*e],f=a[(d-1)*e+1],z=a[(d-1)*e+2],w=a[d*e],E=a[d*e+1],y=a[d*e+2],m[d]=m[d-1]+Math.sqrt((w-r)*(w-r)+(E-f)*(E-f)+(y-z)*(y-z));b.gq=m;return b};a.GB=function(a,b,e){e||(e=[]);var n=b,f=Math.max(n,0);b=f=Math.min(n,
d(a));var n=a.jm,f=a.af?4:3,m=a.Qo,r=a.xk,z=a.ff;a=n.length/f;var w=a+z;5E-6>r[w-1]-b&&(b=r[w-1]);w=new Float32Array(a);c(z,b,r,m,w);for(b=0;b<f;b++)for(m=e[b]=0;m<a;m++)e[b]+=w[m]*n[f*m+b]};a.DB=function(a,b,c){c||(c=[]);var d=a.jm,f=a.af?4:3,e=a.Qo,r=a.xk,z=a.ff;a=d.length/f;var w=a+z;5E-6>r[w-1]-b&&(b=r[w-1]);var w=new Float32Array(a),E=b;b=w;var y=e.length;b||(b=new Float32Array(y));var H=new Float32Array(y),v=new Float32Array(y),B=H,t=v;B||(B=new Float32Array(y));t||(t=new Float32Array(y));for(var u=
y+z,k=new Float32Array(u),q=new Float32Array(u),J=1;J<=u-1;J++)k[J-1]=E>=r[J-1]&&E<r[J+1-1]?1:0;E==r[u-1]&&(k[y-1]=1);for(var G=2;G<=z;G++)for(J=1;J<=u-G;J++){var D=0!=k[J-1]?k[J-1]/(r[J+G-1-1]-r[J-1]):0,L=0!=k[J+1-1]?-k[J+1-1]/(r[J+G-1]-r[J+1-1]):0,K=0!=q[J-1]?(E-r[J-1])*q[J-1]/(r[J+G-1-1]-r[J-1]):0,O=0!=q[J+1-1]?(r[J+G-1]-E)*q[J+1-1]/(r[J+G-1]-r[J+1-1]):0;k[J-1]=(0!=k[J-1]?(E-r[J-1])*k[J-1]/(r[J+G-1-1]-r[J-1]):0)+(0!=k[J+1-1]?(r[J+G-1]-E)*k[J+1-1]/(r[J+G-1]-r[J+1-1]):0);q[J-1]=D+L+K+O}for(J=1;J<=
y;J++)B[J-1]=k[J-1],t[J-1]=q[J-1];r=0;for(z=1;z<=y;z++)r+=H[z-1]*e[z-1];E=0;for(z=1;z<=y;z++)E+=v[z-1]*e[z-1];for(z=1;z<=y;z++)b[z-1]=0!=r?v[z-1]*e[z-1]/r+H[z-1]*e[z-1]*E/(r*r):0;for(e=0;e<f;e++)for(r=c[e]=0;r<a;r++)c[e]+=w[r]*d[f*r+e]};a.qF=d;a.FB=b;a.EB=function(a,c){if(0>=c)return 0;var l=d(a);if(c>=b(a))return l;var n=a.gq,f=e.Oj(n,c,0,n.length-1);return l*(f+(c-n[f])/(n[f+1]-n[f]))/1E3}};b4w.module.__dds=function(a,p){function c(a,b,c,d){var f=new Uint16Array(4),e=new Uint16Array(c*d),g=0,h=0,l=0,t=h=g=0,u=0,k=0,q=0,n=c/4;d/=4;for(var G=0;G<d;G++)for(var D=0;D<n;D++)l=b+4*(G*n+D),f[0]=a[l],f[1]=a[l+1],g=f[0]&31,h=f[0]&2016,t=f[0]&63488,u=f[1]&31,k=f[1]&2016,q=f[1]&63488,f[2]=5*g+3*u>>3|5*h+3*k>>3&2016|5*t+3*q>>3&63488,f[3]=5*u+3*g>>3|5*k+3*h>>3&2016|5*q+3*t>>3&63488,g=a[l+2],h=4*G*c+4*D,e[h]=f[g&3],e[h+1]=f[g>>2&3],e[h+2]=f[g>>4&3],e[h+3]=f[g>>6&3],h+=c,e[h]=f[g>>8&3],e[h+1]=f[g>>
10&3],e[h+2]=f[g>>12&3],e[h+3]=f[g>>14],g=a[l+3],h+=c,e[h]=f[g&3],e[h+1]=f[g>>2&3],e[h+2]=f[g>>4&3],e[h+3]=f[g>>6&3],h+=c,e[h]=f[g>>8&3],e[h+1]=f[g>>10&3],e[h+2]=f[g>>12&3],e[h+3]=f[g>>14];return e}function d(a,b,d,e){var E=new Int32Array(d,0,31),y,H,v,B,t,u;if(542327876!=E[0])return g.error("Invalid magic number in DDS header"),0;if(!E[20]&4)return g.error("Unsupported format, must contain a FourCC code"),0;y=E[21];switch(y){case l:H=8;v=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case n:H=16;v=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case f:H=16;v=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return g.error("Unsupported FourCC code:",h(y)),null}u=1;E[2]&131072&&!1!==e&&(u=Math.max(1,E[7]));B=E[4];t=E[3];E=E[1]+4;if(b)for(y=0;y<u;++y)e=Math.max(4,B)/4*Math.max(4,t)/4*H,b=new Uint8Array(d,E,e),a.compressedTexImage2D(a.TEXTURE_2D,y,v,B,t,0,b),E+=e,B=Math.max(.5*B,1),t=Math.max(.5*t,1);else if(y==l)Math.max(4,B),Math.max(4,t),b=new Uint16Array(d),d=c(b,E/2,B,t),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,B,t,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,d),e&&a.generateMipmap(a.TEXTURE_2D);else return g.error("No manual decoder for",h(y),"and no native support"),0;return u}function b(a,b,c,f,e,g){var h=new XMLHttpRequest;h.open("GET",c,!0);h.responseType="arraybuffer";h.onload=function(){if(200==h.status){a.bindTexture(a.TEXTURE_2D,f);var c=d(a,b,h.response,e);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<c?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}g&&
g(f)};h.send(null);return f}function e(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function h(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var g=p("__print"),l=e("DXT1"),n=e("DXT3"),f=e("DXT5");a.aE=c;a.BC=d;a.Yq=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.Cy=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case l:b=6;break;case n:case f:b=4;break;default:g.error("Unsupported FourCC code:",h(a))}return b};
a.WE=b;a.VE=function(a,c,d,f){var e=a.createTexture();b(a,c,d,e,!0,f);return e}};b4w.module.__debug=function(a,p){function c(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function d(a,b){typeof a!=typeof b&&g.ga("Structure assertion failed: incompatible types");for(var c in a)c in b||g.ga("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||g.ga("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&g.ga("Structure assertion failed: incompatible types for key "+c)}var b=
p("__extensions"),e=p("__print"),h=p("__textures"),g=p("__util"),l=null,n={},f=!1,m={},r=[],z=-1,w=null,E=!1;a.ap={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.jd=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(n[a[d]]=d)}l=a};a.sw=function(a){if(f){var b=l.getError();b!=l.NO_ERROR&&(b in n?g.ga("GL Error: "+b+", gl."+n[b]+" ("+
a+")"):g.ga("Unknown GL error: "+b+" ("+a+")"))}};a.ow=function(){if(f)switch(l.checkFramebufferStatus(l.FRAMEBUFFER)){case l.FRAMEBUFFER_COMPLETE:break;case l.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case l.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case l.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case l.FRAMEBUFFER_UNSUPPORTED:e.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:e.error("FRAMEBUFFER CHECK FAILED")}};a.Lp=function(){if(-1!=z)return z;l.bindFramebuffer(l.FRAMEBUFFER,l.createFramebuffer());var a=h.Yj("DEBUG",h.di);h.resize(a,1,1);l.framebufferTexture2D(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,a.Pb,a.$a,0);l.checkFramebufferStatus(l.FRAMEBUFFER)!=l.FRAMEBUFFER_COMPLETE?(z=!0,e.warn("depth-only issue was found")):z=!1;l.bindFramebuffer(l.FRAMEBUFFER,null);return z};
a.tw=function(a,b,d){if(f&&!l.getShaderParameter(a,l.COMPILE_STATUS))throw d=c(d),e.error("shader compilation failed:\n"+d+"\n"+l.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.uw=function(a,d,g,m,u,k){if(f&&!l.getProgramParameter(a,l.LINK_STATUS)){var h=b.Pq();h&&(u=h.getTranslatedShaderSource(g),k=h.getTranslatedShaderSource(m));u=c(u);k=c(k);e.error("shader linking failed:\n"+u+"\n\n\n"+k+"\n"+l.getProgramInfoLog(a)+" ("+d+")");throw"Engine failed: see above for error messages";
}};a.set_check_gl_errors=function(a){f=a};a.bE=function(a){m[a]=a in m?m[a]+1:1};a.update=function(){for(var a in m)e.log(a,m[a]),m[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(g.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}r.push(a)};a.msg=function(){for(var a=1,b=0;b<r.length;b++){var c=r[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],g.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);
else c.push(arguments[b]);r.push(c)};var y=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},d=Math.max(0,performance.now()-1E3*a),f=0;f<r.length;f++){var k=r[f];a=k[0];if(!(a<d)){var g=String(k[1]);c[g]||(c[g]=y[b++%y.length]);a=["%c"+(a/1E3).toFixed(6),c[g],g];for(g=2;g<k.length;g++)a.push(k[g]);e.log.apply(this,a)}}r.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-
1E3*a),d=0;d<r.length;d++){var f=r[d];a=f[0];if(!(a<c))for(var k=2;k<f.length;k++){var g=String(f[1]);3<f.length&&(g+="_"+String(k-2));b[g]||(b[g]=g+"\n");b[g]+=String(a)+" "+f[k]+"\n"}}a="";for(g in b)a+=b[g]+"\n\n";e.log(a);r.splice(0)};a.LD=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&b("firefox");case "msie":return b("mozilla")&&
b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(g.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.xD=function(a,b){a.constructor!=b&&g.ga("Type assertion failed: value <"+a+"> has type <"+a.constructor+">, required <"+b+">")};a.yD=d;a.zD=function(a){E?d(a,w):E=!0;w=a}};b4w.module.__extensions=function(a,p){function c(a){if(a in e)return e[a];var c=b.getExtension(a)||null;e[a]=c;d.log("%cGET EXTENSION","color: #"+(c?"0a0":"a00"),a);return c}var d=p("__print"),b=null,e={};a.jd=function(a){b=a};a.Vq=function(){return c("WEBGL_compressed_texture_s3tc")||c("WEBKIT_WEBGL_compressed_texture_s3tc")||c("MOZ_WEBGL_compressed_texture_s3tc")};a.Ey=function(){return c("WEBGL_depth_texture")||c("WEBKIT_WEBGL_depth_texture")||c("MOZ_WEBGL_depth_texture")};a.wy=function(){return c("EXT_texture_filter_anisotropic")||
c("WEBKIT_EXT_texture_filter_anisotropic")||c("MOZ_EXT_texture_filter_anisotropic")};a.Pq=function(){return c("WEBGL_debug_shaders")};a.Uq=function(){return c("WEBGL_debug_renderer_info")};a.Qq=function(){return c("OES_element_index_uint")};a.Ry=function(){return c("OES_standard_derivatives")};a.cleanup=function(){e={}}};b4w.module.__graph=function(a,p){function c(a,b,c){c||(c=null);if(d(a,b))throw"Graph already has node with given ID";a.O.push(b,c)}function d(a,b){for(var c=a.O,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function b(a,b,c,k){k||(k=null);if(d(a,b)&&d(a,c))a.V.push(b,c,k);else throw"Wrong node IDs";}function e(a,b){if(!d(a,b))throw"Node not found";for(var c=a.O,k=0;k<c.length;k+=2)c[k]==b&&(c.splice(k,2),k-=2)}function h(a,b,c,d){if(!J(a,b,c))throw"Edge not found";a=a.V;for(var k=0,f=0;f<a.length;f+=
3)if(a[f]==b&&a[f+1]==c){if(-1==d)a.splice(f,3);else{if(d==k){a.splice(f,3);break}k++}f-=3}}function g(a){a=a.O;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}function l(a,b){for(var c=a.O,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function n(a){var b=[],c={};f(a,c);for(var d=a.O,k=0;k<d.length;k+=2)0==u(a,d[k])&&m(a,d[k],c,b);return{O:b,V:a.V.slice(0)}}function f(a,b){for(var c=a.O,d=0;d<c.length;d+=2)b[c[d]]=!1}function m(a,b,c,d){if(!c[b]){c[b]=!0;for(var f=0;f<t(a,b);f++)m(a,
k(a,b,f),c,d);d.unshift(b,B(a,b))}}function r(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var f=0;f<t(a,b);f++){var e=k(a,b,f);r(a,e,c,d)}if(20==d||30==d)for(f=0;f<u(a,b);f++)e=q(a,b,f),r(a,e,c,d)}}function z(a){for(var b=[],c=a.O,d=0;d<c.length;d+=2){var k=c[d];t(a,k)||b.push(k)}return b}function w(a){var b=a.O;a=a.V;for(var c=[],d=[],k=[],f=0;f<b.length;f++)k[b[2*f]]=f,c.push(f,b[2*f+1]);for(f=0;f<a.length;f+=3)d.push(k[a[f]],k[a[f+1]],a[f+2]);return{O:c,V:d}}function E(a,b,c){if(c.ud==c.ef){for(var d=
0,f=0;d<c.ef;d++)-1!=c.ae[d]&&(a[f]=d,b[f]=c.ae[d],f++);return!0}if(c.ef>c.yh||c.tf>c.uf||c.Rh>c.Th||c.Qh>c.Sh)return!1;for(var f=d=-1,e=!1;!e&&y(c,O,d,f);)if(d=O[0],f=O[1],H(c,d,f)){var g;g=c;e={};e.Fi=g.Fi;e.Gi=g.Gi;e.Hn=g.Hn;e.dk=g.dk;e.ef=g.ef;e.yh=g.yh;e.ff=g.ff;e.ud=e.Fk=g.ud;e.Qh=g.Qh;e.Rh=g.Rh;e.tf=g.tf;e.Sh=g.Sh;e.Th=g.Th;e.uf=g.uf;e.hi=-1;e.ae=g.ae;e.Tf=g.Tf;e.eg=g.eg;e.fg=g.fg;e.vg=g.vg;e.wg=g.wg;e.al=g.al;g.al[0]+=1;var e=g=e,m=d,h=f,l=e.Fi,K=e.Gi,D=e.ef,n=e.yh,r=e.ae,z=e.Tf,L=e.eg,w=
e.fg,B=e.vg,F=e.wg;v(m<D);v(h<n);v(e.ud<D);v(e.ud<n);D=++e.ud;e.hi=m;L[m]||(L[m]=D,e.Qh++,B[m]&&e.tf++);B[m]||(B[m]=D,e.Rh++,L[m]&&e.tf++);w[h]||(w[h]=D,e.Sh++,F[h]&&e.uf++);F[h]||(F[h]=D,e.Th++,w[h]&&e.uf++);r[m]=h;z[h]=m;for(r=0;r<u(l,m);r++)z=q(l,m,r),L[z]||(L[z]=D,e.Qh++,B[z]&&e.tf++);for(r=0;r<t(l,m);r++)z=k(l,m,r),B[z]||(B[z]=D,e.Rh++,L[z]&&e.tf++);for(r=0;r<u(K,h);r++)z=q(K,h,r),w[z]||(w[z]=D,e.Sh++,F[z]&&e.uf++);for(r=0;r<t(K,h);r++)z=k(K,h,r),F[z]||(F[z]=D,e.Th++,w[z]&&e.uf++);e=E(a,b,g);
v(1>=g.ud-g.Fk);v(-1!=g.hi);z=g.Fi;m=g.Gi;h=g.ud;l=g.hi;K=g.ae;L=g.Tf;D=g.eg;w=g.fg;n=g.vg;B=g.wg;if(g.Fk<h){D[l]==h&&(D[l]=0);for(F=0;F<u(z,l);F++)r=q(z,l,F),D[r]==h&&(D[r]=0);n[l]==h&&(n[l]=0);for(F=0;F<t(z,l);F++)r=k(z,l,F),n[r]==h&&(n[r]=0);z=K[l];w[z]==h&&(w[z]=0);for(F=0;F<u(m,z);F++)r=q(m,z,F),w[r]==h&&(w[r]=0);B[z]==h&&(B[z]=0);for(F=0;F<t(m,z);F++)r=k(m,z,F),B[r]==h&&(B[r]=0);K[l]=-1;L[z]=-1;g.ud=g.Fk;g.hi=-1}}return e}function y(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var k=a.tf,f=a.uf,e=a.Rh,
g=a.Th,m=a.Qh,h=a.Sh,u=a.ud,l=a.ef,t=a.yh,q=a.ae,K=a.Tf,D=a.eg,r=a.fg,n=a.vg,F=a.wg;if(k>u&&f>u)for(;c<l&&(-1!=q[c]||0==n[c]||0==D[c]);)c++,d=0;else if(e>u&&g>u)for(;c<l&&(-1!=q[c]||0==n[c]);)c++,d=0;else if(m>u&&h>u)for(;c<l&&(-1!=q[c]||0==D[c]);)c++,d=0;else if(0==c&&0!=a.ff){for(D=0;D<l&&-1!=q[c=a.ff[D]];)D++;D==l&&(c=l)}else for(;c<l&&-1!=q[c];)c++,d=0;if(k>u&&f>u)for(;d<t&&(-1!=K[d]||0==F[d]||0==r[d]);)d++;else if(e>u&&g>u)for(;d<t&&(-1!=K[d]||0==F[d]);)d++;else if(m>u&&h>u)for(;d<t&&(-1!=K[d]||
0==r[d]);)d++;else for(;d<t&&-1!=K[d];)d++;return c<l&&d<t?(b[0]=c,b[1]=d,!0):!1}function H(a,b,c){var d=a.Fi,f=a.Gi,e=a.yh,g=a.ae,m=a.Tf,h=a.eg,l=a.fg,K=a.vg,D=a.wg;v(b<a.ef);v(c<e);v(-1==g[b]);v(-1==m[c]);if(!(0,a.Hn)(B(d,b),B(f,c)))return!1;for(var r=e=0,n=0,z=0,O=0,L=0,w=0;w<t(d,b);w++){var F=k(d,b,w);if(-1!=g[F]){var U=g[F];if(!J(f,c,U)||!G(a.dk,d,b,F,f,c,U))return!1}else h[F]&&n++,K[F]&&e++,h[F]||K[F]||O++}for(w=0;w<u(d,b);w++)if(F=q(d,b,w),-1!=g[F]){if(U=g[F],!J(f,U,c)||!G(a.dk,d,F,b,f,U,c))return!1}else h[F]&&
n++,K[F]&&e++,h[F]||K[F]||O++;for(w=0;w<t(f,c);w++)if(U=k(f,c,w),-1!=m[U]){if(F=m[U],!J(d,b,F))return!1}else l[U]&&z++,D[U]&&r++,l[U]||D[U]||L++;for(w=0;w<u(f,c);w++)if(U=q(f,c,w),-1!=m[U]){if(F=m[U],!J(d,F,b))return!1}else l[U]&&z++,D[U]&&r++,l[U]||D[U]||L++;return n<=z&&e<=r&&O<=L}function v(a){if(!a)throw"Assertion failed";}function B(a,b){for(var c=a.O,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function t(a,b){for(var c=a.V,d=0,f=0;f<c.length;f+=3)c[f]==b&&d++;return d}function u(a,
b){for(var c=a.V,d=0,f=0;f<c.length;f+=3)c[f+1]==b&&d++;return d}function k(a,b,c){a=a.V;for(var d=0,f=0;f<a.length;f+=3)if(a[f]==b){if(d==c)return a[f+1];d++}return-1}function q(a,b,c){a=a.V;for(var d=0,f=0;f<a.length;f+=3)if(a[f+1]==b){if(d==c)return a[f];d++}return-1}function J(a,b,c){a=a.V;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function G(a,b,c,d,f,k,e){for(var g=D(b,c,d),m=D(f,k,e),u=0;u<g;u++){for(var h=!1,l=0;l<m;l++)if(a(L(b,c,d,u),L(f,k,e,l))){h=!0;break}if(!h)return!1}return!0}
function D(a,b,c){var d=0;a=a.V;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&d++;return d}function L(a,b,c,d){a=a.V;for(var f=0,k=0;k<a.length;k+=3)if(a[k]==b&&a[k+1]==c){if(f==d)return a[k+2];f++}return null}var K=p("__util"),O=[-1,-1];a.Xo=-1;a.oD=10;a.sl=20;a.rD=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var f=a[d];switch(f.length){case 2:b.push(f[0],f[1]);break;case 3:c.push(f[0],f[1],f[2]);break;default:throw"Wrong graph constructor params";}}return{O:b,V:c}};
a.clone=function(a,b,c){if(b)for(var d=Array(a.O.length),f=0;f<a.O.length;f+=2)d[f]=a.O[f],d[f+1]=b(a.O[f+1]);else d=K.la(a.O);if(c)for(b=Array(a.V.length),f=0;f<a.V.length;f+=3)b[f]=a.V[f],b[f+1]=a.V[f+1],b[f+2]=c(a.V[f+2]);else b=K.la(a.V);return a={O:d,V:b}};a.SD=function(a,b){for(var c=[],d=[],f=0;f<a.length;f++)c.push(a[f][0],a[f][1]);for(f=0;f<b.length;f++)d.push(b[f][0],b[f][1],b[f][2]);return{O:c,V:d}};a.Jj=c;a.BE=d;a.Zc=b;a.Ch=e;a.Cg=h;a.Es=function(a,b,c,d){if(!J(a,b,c))throw"Edge not found";
a=a.V;for(var f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c&&a[f+2][0]==d[0]&&a[f+2][1]==d[1]){a.splice(f,3);break}};a.u=function(a,b){if(-1==l(a,b)){var d=g(a);c(a,d,b);return d}throw"Non-unique attribute";};a.DA=function(a,b,c,d,f){a=a.V;for(var k=0;k<a.length;k+=3)a[k]==b&&a[k+1]==c&&a[k+2]==d&&(a[k+2]=f)};a.Hq=g;a.rg=l;a.m=function(a,c,d,f){c=l(a,c);d=l(a,d);if(-1!=c&&-1!=d)b(a,c,d,f);else throw"Attributes not found";};a.S=function(a,b){for(var c=a.O,d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};a.Jd=function(a,
b){for(var c=a.V,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.De=function(a,b,c){for(var d=a.V,f=0;f<d.length;f+=3)if(d[f+1]==b){var k=d[f];if(c(k,B(a,k),d[f+2]))break}};a.wf=function(a,b,c){for(var d=a.V,f=0;f<d.length;f+=3)if(d[f]==b){var k=d[f+1];if(c(k,B(a,k),d[f+2]))break}};a.Ao=n;a.YB=function(a){a=n(a).O;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.LE=function(){};a.ro=function(a,b,c){if(!d(a,b))throw"No such node";var k={};f(a,k);r(a,b,k,c);b=[];for(var e in k)k[e]&&(e=
Number(e),b.push(e,B(a,e)));a={O:b,V:a.V.slice(0)};k=a.V;for(e=0;e<k.length;e+=3)b=k[e+1],d(a,k[e])&&d(a,b)||(k.splice(e,3),e-=3);return a};a.Qy=function(a){for(var b=[],c=a.O,d=0;d<c.length;d+=2){var f=c[d];u(a,f)||b.push(f)}return b};a.Xq=z;a.match=function(a,b,c,d){var f={};f.Fi=w(a);f.Gi=w(b);f.Hn=c||function(a,b){return a==b};f.dk=d||function(a,b){return a==b};d=a.O.length/2;var k=b.O.length/2;f.ef=d;f.yh=k;f.ff=0;f.ud=f.Fk=0;f.tf=f.Qh=f.Rh=0;f.uf=f.Sh=f.Th=0;f.hi=-1;f.ae=Array(d);f.Tf=Array(k);
f.eg=Array(d);f.fg=Array(k);f.vg=Array(d);f.wg=Array(k);f.al=[1];for(c=0;c<d;c++)f.ae[c]=-1,f.eg[c]=0,f.vg[c]=0;for(c=0;c<k;c++)f.Tf[c]=-1,f.fg[c]=0,f.wg[c]=0;k=Array(d);d=Array(d);if(E(k,d,f)){for(c=0;c<k.length;c++)k[c]=a.O[2*k[c]],d[c]=b.O[2*d[c]];return[k,d]}return null};a.Va=B;a.xg=t;a.lr=u;a.cg=k;a.jk=q;a.tE=D;a.bg=L;a.replace=function(a,b,d){for(var f=a.V,k=g(a),m=0;m<b.length;m++){var u=b[m];e(a,u);for(var h=0;h<f.length;h+=3)f[h]==u&&(f[h]=k),f[h+1]==u&&(f[h+1]=k),f[h]==f[h+1]&&(f.splice(h,
3),h-=3)}c(a,k,d)};a.uA=function(a,b,c,d,f){if(!J(a,b,c))throw"Edge not found";a=a.V;for(var k=0;k<a.length;k+=3)a[k]==b&&a[k+1]==c&&(a[k]=d,a[k+1]=f)};a.Mx=function(a,b){function c(a,b){if(-1!=g.indexOf(a)){var d=g.slice(g.indexOf(a));if(-1!=f[d[d.length-1]].indexOf(d[0])){m.push([a,d[d.length-1]]);return}}g.push(a);for(d=0;d<b.length;d++)b[d]in f&&c(b[d],f[b[d]])}b||(b=z(a)[0]);var d=a.V;if(d.length){for(var f={},k=0,e=0;e<d.length;e+=3)d[e+1]in f?f[d[e+1]].push(d[e]):f[d[e+1]]=[d[e]],k++;var g=
[],m=[];c(b,f[b]);for(e=0;e<m.length;e++)for(var u=k=0;u<d.length;u+=3)m[e][1]==d[u+1]&&m[e][0]==d[u]&&h(a,d[u],d[u+1],k),k++}};a.UD=function(a,b){var c=a.O,d=a.V,f;f="digraph debug {\n    node [shape=box];\n";for(var k=0;k<c.length;k+=2){var e=c[k],g=c[k+1],g=b?b(e,g):String(e);f+="    ";f+=String(e)+' [label="'+g.replace(/\"/g,'\\"')+'"];\n'}for(k=0;k<d.length;k+=3)c=d[k],e=d[k+1],f+="    ",f+=String(c)+" -> "+String(e)+";\n";return f+="}"}};b4w.module.__ipc=function(a){function p(a){for(var b=0;b<a.length;b++){var c=a[b],d=0,f;for(f in c){var e=c[f];switch(e.constructor){case Float32Array:d+=e.length;break;case Number:d+=1}}--d;c.len=d}}a.bu=0;var c=a.Ut=1,d=a.Wt=2;a.Vt=3;a.Yt=4;a.Zt=5;a.$t=6;a.cu=7;var b=a.eu=8,e=a.Wo=9,h=a.fu=10;a.gu=11;var g=a.hu=12;a.iu=13;a.du=14;a.au=15;a.Xt=16;a.Ju=100;a.ku=101;a.lu=102;a.mu=103;a.nu=104;a.pu=105;a.ou=106;a.qu=107;a.ru=108;a.su=109;a.tu=110;a.uu=111;a.vu=112;a.xu=113;a.yu=114;a.Mu=115;a.zu=116;
a.Au=117;a.Bu=118;a.Du=119;a.Eu=120;a.Fu=121;a.Hu=122;a.Iu=123;a.Ku=124;a.wu=125;a.Ou=126;a.Cu=127;a.Zo=128;a.Nu=129;a.Pu=130;a.Qu=131;a.Ru=132;a.Su=133;a.Tu=134;a.Uu=135;a.Vu=136;a.Wu=137;a.Xu=138;a.Yu=139;a.$o=140;var l=a.Aj=141;a.Zu=142;a.Yo=143;a.$u=144;a.av=145;a.Lu=146;a.Gu=147;var n=null,f=[],m={yc:g,H:0,time:0,h:new Float32Array(3),quat:new Float32Array(4),Ad:new Float32Array(3),rd:new Float32Array(3),len:0},r={yc:b,am:0,Rn:0,h:new Float32Array(3),quat:new Float32Array(4),len:0},z={yc:e,id:0,
Wg:0,hit_fract:0,hit_time:0,len:0},w={yc:h,id:0,Wg:0,hit_fract:0,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),len:0},E={yc:c,Nf:0,Of:0,result:0,len:0},y={yc:d,Nf:0,Of:0,result:0,Sf:new Float32Array(3),coll_norm:new Float32Array(3),coll_dist:0,len:0},H={yc:l,H:0,h:new Float32Array(3),quat:new Float32Array(4),len:0},v=[m,r,z,w,E,y,H];a.init=function(a,f){function u(a){if(a.constructor==ArrayBuffer)a=new Float32Array(a);else if(a[0].constructor==ArrayBuffer){for(var q=0;q<a.length;q++)u(a[q]);
return}q=a[0]|0;switch(q){case g:var n=m;n.H=a[1]|0;n.time=a[2];n.h[0]=a[3];n.h[1]=a[4];n.h[2]=a[5];n.quat[0]=a[6];n.quat[1]=a[7];n.quat[2]=a[8];n.quat[3]=a[9];n.Ad[0]=a[10];n.Ad[1]=a[11];n.Ad[2]=a[12];n.rd[0]=a[13];n.rd[1]=a[14];n.rd[2]=a[15];break;case b:n=r;n.am=a[1]|0;n.Rn=a[2]|0;n.h[0]=a[3];n.h[1]=a[4];n.h[2]=a[5];n.quat[0]=a[6];n.quat[1]=a[7];n.quat[2]=a[8];n.quat[3]=a[9];break;case e:n=z;n.id=a[1]|0;n.Wg=a[2]|0;n.hit_fract=a[3];n.hit_time=a[4];break;case h:n=w;n.id=a[1]|0;n.Wg=a[2]|0;n.hit_fract=
a[3];n.hit_time=a[4];n.hit_pos[0]=a[5];n.hit_pos[1]=a[6];n.hit_pos[2]=a[7];n.hit_norm[0]=a[8];n.hit_norm[1]=a[9];n.hit_norm[2]=a[10];break;case c:n=E;n.Nf=a[1]|0;n.Of=a[2]|0;n.result=!!a[3];break;case d:n=y;n.Nf=a[1]|0;n.Of=a[2]|0;n.result=!!a[3];n.Sf[0]=a[4];n.Sf[1]=a[5];n.Sf[2]=a[6];n.coll_norm[0]=a[7];n.coll_norm[1]=a[8];n.coll_norm[2]=a[9];n.coll_dist=a[10];break;case l:n=H;n.H=a[1]|0;n.h[0]=a[2];n.h[1]=a[3];n.h[2]=a[4];n.quat[0]=a[5];n.quat[1]=a[6];n.quat[2]=a[7];n.quat[3]=a[8];break;default:n=
a}f(q,n)}p(v);a.addEventListener("message",function(a){u(a.data)},!1);n=a};a.cleanup=function(){n=null;f.length=0};a.w=function(a){if(n)switch(a){case g:var t=m,u=new Float32Array(t.len);u[0]=t.yc;u[1]=t.H;u[2]=t.time;u[3]=t.h[0];u[4]=t.h[1];u[5]=t.h[2];u[6]=t.quat[0];u[7]=t.quat[1];u[8]=t.quat[2];u[9]=t.quat[3];u[10]=t.Ad[0];u[11]=t.Ad[1];u[12]=t.Ad[2];u[13]=t.rd[0];u[14]=t.rd[1];u[15]=t.rd[2];f.push(u.buffer);break;case b:t=r;u=new Float32Array(t.len);u[0]=t.yc;u[1]=t.am;u[2]=t.Rn;u[3]=t.h[0];u[4]=
t.h[1];u[5]=t.h[2];u[6]=t.quat[0];u[7]=t.quat[1];u[8]=t.quat[2];u[9]=t.quat[3];f.push(u.buffer);break;case e:t=z;u=new Float32Array(t.len);u[0]=t.yc;u[1]=t.id;u[2]=t.Wg;u[3]=t.hit_fract;u[4]=t.hit_time;f.push(u.buffer);break;case h:t=w;u=new Float32Array(t.len);u[0]=t.yc;u[1]=t.id;u[2]=t.Wg;u[3]=t.hit_fract;u[4]=t.hit_time;u[5]=t.hit_pos[0];u[6]=t.hit_pos[1];u[7]=t.hit_pos[2];u[8]=t.hit_norm[0];u[9]=t.hit_norm[1];u[10]=t.hit_norm[2];f.push(u.buffer);break;case c:t=E;u=new Float32Array(t.len);u[0]=
t.yc;u[1]=t.Nf;u[2]=t.Of;u[3]=t.result;f.push(u.buffer);break;case d:t=y;u=new Float32Array(t.len);u[0]=t.yc;u[1]=t.Nf;u[2]=t.Of;u[3]=t.result;u[4]=t.Sf[0];u[5]=t.Sf[1];u[6]=t.Sf[2];u[7]=t.coll_norm[0];u[8]=t.coll_norm[1];u[9]=t.coll_norm[2];u[10]=t.coll_dist;f.push(u.buffer);break;case l:t=H;u=new Float32Array(t.len);u[0]=t.yc;u[1]=t.H;u[2]=t.h[0];u[3]=t.h[1];u[4]=t.h[2];u[5]=t.quat[0];u[6]=t.quat[1];u[7]=t.quat[2];u[8]=t.quat[3];f.push(u.buffer);break;default:u=[];for(t=0;t<arguments.length;t++)u.push(arguments[t]);
n.postMessage(u)}};a.lA=function(){f.length&&(n.postMessage(f),f.length=0)};a.Tq=function(a){switch(a){case g:return m;case b:return r;case e:return z;case h:return w;case c:return E;case d:return y;case l:return H;default:return null}}};b4w.module.__hud=function(a,p){function c(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function d(a){b(' SCENE "'+a.name+'"');if(a.e){var c=0,d=0;l.S(a.e.jb,function(a,f){if("SINK"==f.type)b(" (F)",f.type);else{var e=f.type,g=Math.round(f.j.width)+"x"+Math.round(f.j.height),m=f.q.length,h=f.ti,l=f.enqueue&&f.Ta;l?b(" (A)",e,f.tg,g,h,"of",m):b(" (P)",e,f.tg,g,h,"of",m);f.ti=0;l&&(c+=m,d+=h)}});return[c,d]}b("No INFO")}function b(){for(var a=80+20*f[0],b=[5,
18,3,10,4,3,5],c=arguments[0],d=1;d<arguments.length;d++){for(var e="",g=0;g<b[d]-String(arguments[d]).length;g++)e+=" ";c+=e+arguments[d]}f[0]++;n.fillText(c,30,a)}function e(a,b,c){b*=a.Ga;c.x=a.x+b;c.y=a.y;c.Ga=a.Ga-2*b;c.Ca=a.Ca}function h(a){return a.x+a.Ga/2}function g(a){var b=n,c={x:0,y:0,Ga:0,Ca:0},d=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.Ga=d;c.Ca=b;e(c,.01,c);d=.02*c.Ca;c.x=c.x;c.y+=d;c.Ga=c.Ga;c.Ca-=2*d;d=c.Ga/8;c.x+=d*a;c.y=c.y;c.Ga=d;c.Ca=c.Ca;e(c,.02,c);return c}var l=p("__graph"),
n=null,f=[0,0];a.init=function(a){a=a.getContext("2d");c(a);return n=a};a.Vh=function(){n&&c(n)};a.reset=function(){var a=n;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),f[0]=0,f[1]=0)};a.pB=function(a,c){var e=n;if(e){e.textAlign="left";e.fillStyle="rgba(0,255,0,255)";b(" FPS",(1/c).toFixed(2));f[0]++;for(var g=e=0,h=0;h<a.length;h++){var l=d(a[h]),e=e+l[0],g=g+l[1];f[0]++}b(" ---------------------------------------------");
b("    ","TOTAL ACTIVE","","",g,"of",e)}};a.print=function(){var a=n;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",b.apply(Math,arguments))};a.plot_array=function(a,b,c,d,f,e,l){var v=n;if(v){b=g(b);var B=b.Ca/5;b.x=b.x;b.y+=4*B;b.Ga=b.Ga;b.Ca=B;v.textAlign="center";v.fillStyle="#00FF00";n.fillText(a,h(b),b.y-10);v.strokeStyle="#00FF00";v.lineWidth=.5;v.beginPath();v.moveTo(b.x,b.y);v.lineTo(b.x+b.Ga,b.y);v.lineTo(b.x+b.Ga,b.y+b.Ca);v.lineTo(b.x,b.y+b.Ca);v.closePath();v.stroke();if(!e&&
!l)for(e=1E6,l=-1E6,a=0;a<c.length;a++)e=Math.min(e,c[a]),l=Math.max(l,c[a]);v.textAlign="right";n.fillText(String(e),b.x-10,b.y+b.Ca);n.fillText(String(l),b.x-10,b.y);v.textAlign="center";n.fillText(String(d),b.x,b.y+b.Ca+15);n.fillText(String(f),b.x+b.Ga,b.y+b.Ca+15);v.strokeStyle="#FF0000";v.lineWidth=1.5;v.beginPath();d=b.Ga/(c.length-1);l=b.Ca/(l-e);for(a=0;a<c.length;a++)f=b.x+d*a,B=b.y+b.Ca-(c[a]-e)*l,0==a?v.moveTo(f,B):v.lineTo(f,B);v.stroke()}};a.draw_mixer_strip=function(a,b,c,d,f,e,l){var v=
n;if(v)for(v.textAlign="center",v.fillStyle="#00FF00",v.font="bold 12px Courier",c=g(c),n.fillText(b?"["+a+"]":a,h(c),c.y),0<=e&&n.fillText(e?"[M]":"[ ]",h(c)-15,c.y+30),0<=l&&n.fillText(l?"[S]":"[ ]",h(c)+15,c.y+30),a={x:0,y:0,Ga:0,Ca:0},b=0;b<d.length;b++){e=d[b];var B="VOLUME"==e[0];if(B){l=c.y+350;var t=c.Ga,u=a;u.x=c.x;u.y=l;u.Ga=t;u.Ca=250}else{l=c.y+10+50*b;var t=c.Ga,u=c.Ca,k=a;k.x=c.x;k.y=l;k.Ga=t;k.Ca=u}l=v;var t=a,k=b==f,q=e[0],u=e[1],J=e[2],G=e[3],D=(G-J)/e[4],D=1>D?Math.floor(1/D-1E-5).toFixed(0).length:
0;e=e[5]?Math.log(u/J)/Math.log(G/J):(u-J)/(G-J);l.textAlign="center";k?l.fillText("["+q+"]",h(t),t.y):l.fillText(q,h(t),t.y);l.strokeStyle="#00FF00";l.lineWidth=B?3:1;B?(l.textAlign="right",l.fillText(G.toFixed(D),h(t)-10,t.y+15),l.textAlign="right",l.fillText(J.toFixed(D),h(t)-10,t.y+t.Ca-15)):(l.textAlign="right",l.fillText(J.toFixed(D),t.x+28,t.y+15),l.textAlign="left",l.fillText(G.toFixed(D),t.x+t.Ga-28,t.y+15));l.beginPath();if(B){var L=t.y+15+(t.Ca-30)*(1-e);l.moveTo(h(t),t.y+15);l.lineTo(h(t),
t.y+t.Ca-15);l.moveTo(h(t)-5,t.y+15);l.lineTo(h(t)+5,t.y+15);l.moveTo(h(t)-5,t.y+t.Ca-15);l.lineTo(h(t)+5,t.y+t.Ca-15);l.moveTo(h(t)-5,L);l.lineTo(h(t)+5,L)}else{var K=t.x+30+(t.Ga-60)*e;l.moveTo(t.x+30,t.y+15);l.lineTo(t.x+t.Ga-30,t.y+15);l.moveTo(t.x+30,t.y+15-5);l.lineTo(t.x+30,t.y+15+5);l.moveTo(t.x+t.Ga-30,t.y+15-5);l.lineTo(t.x+t.Ga-30,t.y+15+5);l.moveTo(K,t.y+15-5);l.lineTo(K,t.y+15+5)}l.stroke();"EQ_Q"==q?(e=Math.log(1+1/(2*u*u)+Math.sqrt((2+1/(u*u))*(2+1/(u*u))/4-1))/Math.log(2),B?(l.textAlign=
"left",l.fillText(u.toFixed(D),h(t)+10,L),l.textAlign="left",l.fillText("("+e.toFixed(D+1)+")",h(t)+10,L+10)):(l.textAlign="right",l.fillText(u.toFixed(D),K,t.y+30),l.textAlign="left",l.fillText("("+e.toFixed(D+1)+")",K,t.y+30))):B?(l.textAlign="left",l.fillText(u.toFixed(D),h(t)+10,L)):(l.textAlign="center",l.fillText(u.toFixed(D),K,t.y+30))}}};b4w.module.__renderer=function(a,p){function c(a){for(var c=a.j,d=a.q,f=0;f<d.length;f++){var g=d[f];if(g.Ta){var h=a,l=c,m=g.ed,K=g.B,n=K.Yb;v.useProgram(n.cj);for(var g=K.U,A=K.rp,I=n.st,C=I.length;C--;){var Q=I[C];Q.Pm(v,Q.mg,h,m,K,l)}l=K.Vp;v.colorMask(l,l,l,l);v.depthMask(K.Z);K.Na?v.enable(v.CULL_FACE):v.disable(v.CULL_FACE);l=K.M;for(K=0;K<l.length;K++)I=l[K],v.activeTexture(v.TEXTURE0+K),v.bindTexture(I.Pb,I.$a);if("SKY"==h.type){l=h;n=n.mj;K=l.j.ib.$a;I=l.si;for(C=0;6>C;C++)if(Q=e(C),r.cm?
(v.bindTexture(v.TEXTURE_CUBE_MAP,K),v.texImage2D(Q,0,v.RGBA,1,1,0,v.RGBA,v.UNSIGNED_BYTE,H)):(v.uniformMatrix4fv(n.u_cube_view_matrix,!1,I[C]),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,Q,K,0),b(g,A,m.Ho)),l.Ck&&3!=C){var Q=l,M=C,z=B;r.cm?z.set(H):(v.readPixels(191,191,1,1,v.RGBA,v.UNSIGNED_BYTE,z),255!=z[0]&&255!=z[1]&&255!=z[2]||v.readPixels(191,220,1,1,v.RGBA,v.UNSIGNED_BYTE,z));var w=z[0],E=z[1],z=z[2],w=w/255,E=E/255,z=z/255;2===M?(Q.pc[3]=w,Q.pc[7]=E,Q.pc[11]=z):2>M?(Q.pc[4*M]=
w,Q.pc[4*M+1]=E,Q.pc[4*M+2]=z):(Q.pc[4*(M-2)]=w,Q.pc[4*(M-2)+1]=E,Q.pc[4*(M-2)+2]=z)}h.ti+=6}else b(g,A,m.Ho),h.ti++}}}function d(a){if(a){var b=(a.ea?v.COLOR_BUFFER_BIT:0)|(a.ka?v.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "MAIN_GLOW":a=y;break;case "SHADOW_CAST":a=z;break;case "DEPTH":a=w;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=E;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=y;break;default:a=r.background_color}}else b=
v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT,a=r.background_color;v.colorMask(!0,!0,!0,!0);v.depthMask(!0);v.clearColor(a[0],a[1],a[2],a[3]);v.clear(b)}function b(a,b,c){v.bindBuffer(v.ARRAY_BUFFER,a.yf);for(var d=0;d<b.length;d++){var f=b[d];v.enableVertexAttribArray(f.mg);v.vertexAttribPointer(f.mg,f.Bd,v.FLOAT,!1,0,f.Uv+f.$x*c)}a.me?(v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,a.me),v.drawElements(a.mode,a.count,a.dn,0)):v.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)f=b[d],v.disableVertexAttribArray(f.mg)}
function e(a){switch(a){case 0:return v.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return v.TEXTURE_CUBE_MAP_NEGATIVE_X;case 2:return v.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return v.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return v.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return v.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function h(a){var b=a.mj,c=[],d=[],f={},e;for(e in b){var g=!1;switch(e){case "u_proj_matrix":var h=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.ua)},g=!0;break;case "u_view_matrix":case "u_view_matrix_frag":h=
function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.ra)};g=!0;break;case "u_shadow_cast_billboard_view_matrix":h=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.Rs)};g=!0;break;case "u_view_proj_prev":h=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.rA)};g=!0;break;case "u_view_proj_inverse":h=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.Yh)};g=!0;break;case "u_sky_vp_inverse":h=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.Dd)};g=!0;break;case "u_camera_eye":case "u_camera_eye_frag":h=function(a,
b,c,d,f,e){a.uniform3fv(b,e.Ve)};g=!0;break;case "u_camera_eye_last":h=function(a,b,c,d,f,e){a.uniform3fv(b,e.yq)};g=!0;break;case "u_camera_quat":h=function(a,b,c,d,f,e){a.uniform4fv(b,e.quat)};g=!0;break;case "u_view_max_depth":h=function(a,b,c,d,f,e){a.uniform1f(b,e.Ua)};g=!0;break;case "u_camera_range":h=function(a,b,c,d,f,e){a.uniform2f(b,e.Wa,e.Ua)};break;case "u_csm_center_dists":h=function(a,b,c,d,f,e){a.uniform4fv(b,e.eq)};break;case "u_cam_water_depth":h=function(a,b,c){a.uniform1f(b,c.Zl)};
g=!0;break;case "u_waves_height":h=function(a,b,c){a.uniform1f(b,c.Cf)};break;case "u_waves_length":h=function(a,b,c){a.uniform1f(b,c.Og)};break;case "u_fog_color_density":h=function(a,b,c){a.uniform4fv(b,c.vc)};break;case "u_underwater_fog_color_density":h=function(a,b,c){a.uniform4fv(b,c.od)};break;case "u_bloom_key":h=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":h=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":h=function(a,b,c){a.uniform1f(b,c.time)};
g=!0;break;case "u_wind":h=function(a,b,c){a.uniform3fv(b,c.tj)};break;case "u_sky_tex_dvar":h=function(a,b,c){a.uniform1f(b,c.Vs)};break;case "u_sky_tex_fac":h=function(a,b,c){a.uniform4fv(b,c.Ws)};break;case "u_sky_tex_color":h=function(a,b,c){a.uniform3fv(b,c.Us)};break;case "u_horizon_color":h=function(a,b,c){a.uniform3fv(b,c.Ye)};break;case "u_zenith_color":h=function(a,b,c){a.uniform3fv(b,c.Df)};break;case "u_environment_energy":h=function(a,b,c){a.uniform1f(b,c.Ue)};break;case "u_sky_color":h=
function(a,b,c){a.uniform3fv(b,c.Ih)};break;case "u_rayleigh_brightness":h=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":h=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":h=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":h=function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":h=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":h=function(a,
b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":h=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":h=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":h=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;case "u_light_positions":h=function(a,b,c){a.uniform3fv(b,c.bf)};break;case "u_light_directions":h=function(a,b,c){a.uniform3fv(b,c.jg)};break;case "u_light_color_intensities":h=
function(a,b,c){a.uniform3fv(b,c.ig)};break;case "u_light_factors":h=function(a,b,c){a.uniform4fv(b,c.kg)};break;case "u_sun_quaternion":h=function(a,b,c){a.uniform4fv(b,c.nt)};break;case "u_sun_intensity":h=function(a,b,c){a.uniform3fv(b,c.mt)};break;case "u_sun_direction":h=function(a,b,c){a.uniform3fv(b,c.fl)};break;case "u_height":h=function(a,b,c,d,f,e){a.uniform1f(b,e.height)};g=!0;break;case "u_model_matrix":h=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.W)};g=!0;break;case "u_transb":h=function(a,
b,c,d){a.uniform4fv(b,d.Kc)};g=!0;break;case "u_transa":h=function(a,b,c,d){a.uniform4fv(b,d.Jc)};g=!0;break;case "u_arm_rel_trans":h=function(a,b,c,d){a.uniform4fv(b,d.Il)};g=!0;break;case "u_arm_rel_quat":h=function(a,b,c,d){a.uniform4fv(b,d.Hl)};g=!0;break;case "u_quat":h=function(a,b,c,d){a.uniform4fv(b,d.quat)};g=!0;break;case "u_quatsb":h=function(a,b,c,d){a.uniform4fv(b,d.Cc)};g=!0;break;case "u_quatsa":h=function(a,b,c,d){a.uniform4fv(b,d.Bc)};g=!0;break;case "u_frame_factor":h=function(a,
b,c,d){a.uniform1f(b,d.Zf)};g=!0;break;case "au_center_pos":h=function(){};g=!0;break;case "au_wind_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.Md)};g=!0;break;case "au_wind_bending_freq":h=function(a,b,c,d){a.uniform1f(b,d.Ee)};g=!0;break;case "au_detail_bending_freq":h=function(a,b,c,d){a.uniform1f(b,d.ce)};g=!0;break;case "au_detail_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.be)};g=!0;break;case "au_branch_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.Xd)};g=!0;break;case "u_node_values":h=
function(a,b,c,d){a.uniform1fv(b,d.qe)};g=!0;break;case "u_node_rgbs":h=function(a,b,c,d){a.uniform3fv(b,d.xc)};g=!0;break;case "u_diffuse_color":h=function(a,b,c,d,f){a.uniform4fv(b,f.Rc)};g=!0;break;case "u_diffuse_intensity":h=function(a,b,c,d,f){a.uniform1f(b,f.Re)};g=!0;break;case "u_diffuse_params":h=function(a,b,c,d,f){a.uniform2fv(b,f.tc)};g=!0;break;case "u_emit":h=function(a,b,c,d,f){a.uniform1f(b,f.he)};g=!0;break;case "u_ambient":h=function(a,b,c,d,f){a.uniform1f(b,f.Td)};g=!0;break;case "u_specular_color":h=
function(a,b,c,d,f){a.uniform3fv(b,f.Ed)};g=!0;break;case "u_specular_alpha":h=function(a,b,c,d,f){a.uniform1f(b,f.ko)};g=!0;break;case "u_specular_params":h=function(a,b,c,d,f){a.uniform3fv(b,f.kc)};g=!0;break;case "u_reflect_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.reflect_factor)};g=!0;break;case "u_mirror_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.Dn)};g=!0;break;case "u_grass_map_dim":h=function(a,b,c,d,f){a.uniform3fv(b,f.bc)};g=!0;break;case "u_grass_size":h=function(a,b,c,d,f){a.uniform1f(b,
f.Xm)};g=!0;break;case "u_scale_threshold":h=function(a,b,c,d,f){a.uniform1f(b,f.Zq)};g=!0;break;case "u_cube_fog":h=function(a,b,c,d,f){a.uniformMatrix4fv(b,!1,f.pc)};break;case "u_jitter_amp":h=function(a,b,c,d,f){a.uniform1f(b,f.yr)};g=!0;break;case "u_jitter_freq":h=function(a,b,c,d,f){a.uniform1f(b,f.zr)};g=!0;break;case "u_wireframe_mode":h=function(a,b,c,d,f){a.uniform1i(b,f.wireframe_mode)};break;case "u_wireframe_edge_color":h=function(a,b,c,d,f){a.uniform3fv(b,f.wireframe_edge_color)};break;
case "u_subpixel_jitter":h=function(a,b,c){a.uniform2fv(b,c.vz)};g=!0;break;case "u_subsample_indices":h=function(a,b,c){a.uniform4fv(b,c.wz)};g=!0;break;case "u_refr_bump":h=function(a,b,c,d,f){a.uniform1f(b,f.Cs)};g=!0;break;case "u_lamp_light_positions":h=function(a,b,c,d,f){a.uniform3fv(b,f.on)};break;case "u_lamp_light_directions":h=function(a,b,c,d,f){a.uniform3fv(b,f.mn)};break;case "u_lamp_light_color_intensities":h=function(a,b,c,d,f){a.uniform3fv(b,f.ln)};break;case "u_lamp_light_factors":h=
function(a,b,c,d,f){a.uniform4fv(b,f.nn)};break;case "u_halo_size":h=function(a,b,c,d,f){a.uniform1f(b,f.dr)};g=!0;break;case "u_halo_hardness":h=function(a,b,c,d,f){a.uniform1f(b,f.ar)};g=!0;break;case "u_halo_rings_color":h=function(a,b,c,d,f){a.uniform3fv(b,f.cr)};g=!0;break;case "u_halo_lines_color":h=function(a,b,c,d,f){a.uniform3fv(b,f.br)};g=!0;break;case "u_halo_stars_blend":h=function(a,b,c,d,f){a.uniform1f(b,f.er)};g=!0;break;case "u_halo_stars_height":h=function(a,b,c,d,f){a.uniform1f(b,
f.fr)};g=!0;break;case "u_fresnel_params":h=function(a,b,c,d,f){a.uniform4fv(b,f.cd)};g=!0;break;case "u_texture_scale":h=function(a,b,c,d,f){a.uniform3fv(b,f.vf)};g=!0;break;case "u_parallax_scale":h=function(a,b,c,d,f){a.uniform1f(b,f.parallax_scale)};g=!0;break;case "u_color_id":h=function(a,b,c,d){a.uniform3fv(b,d.Vj)};g=!0;break;case "u_line_points":h=function(a,b,c,d,f){a.uniform3fv(b,f.UE)};g=!0;break;case "u_diffuse_color_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.Qe)};g=!0;break;case "u_alpha_factor":h=
function(a,b,c,d,f){a.uniform1f(b,f.Ke)};g=!0;break;case "u_specular_color_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.bt)};g=!0;break;case "u_normal_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.Qr)};g=!0;break;case "u_normalmap0_scale":h=function(a,b,c,d,f){a.uniform2fv(b,f.sg[0])};g=!0;break;case "u_normalmap1_scale":h=function(a,b,c,d,f){a.uniform2fv(b,f.sg[1])};g=!0;break;case "u_normalmap2_scale":h=function(a,b,c,d,f){a.uniform2fv(b,f.sg[2])};g=!0;break;case "u_normalmap3_scale":h=function(a,
b,c,d,f){a.uniform2fv(b,f.sg[3])};g=!0;break;case "u_foam_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.foam_factor)};g=!0;break;case "u_foam_uv_freq":h=function(a,b,c,d,f){a.uniform2fv(b,f.Bq)};g=!0;break;case "u_foam_mag":h=function(a,b,c,d,f){a.uniform2fv(b,f.Aq)};g=!0;break;case "u_foam_scale":h=function(a,b,c,d,f){a.uniform2fv(b,f.Jm)};g=!0;break;case "u_water_norm_uv_velocity":h=function(a,b,c,d,f){a.uniform1f(b,f.ai)};g=!0;break;case "u_shallow_water_col":h=function(a,b,c,d,f){a.uniform3fv(b,
f.shallow_water_col)};g=!0;break;case "u_shore_water_col":h=function(a,b,c,d,f){a.uniform3fv(b,f.shore_water_col)};g=!0;break;case "u_water_shallow_col_fac":h=function(a,b,c,d,f){a.uniform1f(b,f.shallow_water_col_fac)};g=!0;break;case "u_water_shore_col_fac":h=function(a,b,c,d,f){a.uniform1f(b,f.shore_water_col_fac)};g=!0;break;case "u_p_length":h=function(a,b,c,d,f){a.uniform1f(b,f.fs)};g=!0;break;case "u_p_cyclic":h=function(a,b,c,d,f){a.uniform1i(b,f.bs)};g=!0;break;case "u_p_max_lifetime":h=function(a,
b,c,d,f){a.uniform1f(b,f.hs)};g=!0;break;case "u_p_fade_in":h=function(a,b,c,d,f){a.uniform1f(b,f.cs)};g=!0;break;case "u_p_fade_out":h=function(a,b,c,d,f){a.uniform1f(b,f.ds)};g=!0;break;case "u_p_size":h=function(a,b,c,d,f){a.uniform1f(b,f.Mn)};g=!0;break;case "u_p_alpha_start":h=function(a,b,c,d,f){a.uniform1f(b,f.Zr)};g=!0;break;case "u_p_alpha_end":h=function(a,b,c,d,f){a.uniform1f(b,f.Yr)};g=!0;break;case "u_p_nfactor":h=function(a,b,c,d,f){a.uniform1f(b,f.Ln)};g=!0;break;case "u_p_gravity":h=
function(a,b,c,d,f){a.uniform1f(b,f.es)};g=!0;break;case "u_p_mass":h=function(a,b,c,d,f){a.uniform1f(b,f.gs)};g=!0;break;case "u_p_size_ramp":h=function(a,b,c,d,f){a.uniform2fv(b,f.js)};g=!0;break;case "u_p_color_ramp":h=function(a,b,c,d,f){a.uniform4fv(b,f.$r)};g=!0;break;case "u_p_wind":h=function(a,b,c,d,f){a.uniform3fv(b,f.Lk)};g=!0;break;case "u_texel_size":h=function(a,b,c){a.uniform2fv(b,c.xo)};g=!0;break;case "u_p_time":h=function(a,b,c,d,f){a.uniform1f(b,f.zc.T.time)};g=!0;break;case "u_position":h=
function(a,b,c,d,f){a.uniform3fv(b,f.bj)};g=!0;break;case "u_va_frame_factor":h=function(a,b,c,d){a.uniform1f(b,d.Ft)};g=!0;break;case "u_perspective_cast_far_bound":h=function(a,b,c){a.uniform1f(b,c.dA)};break;case "u_normal_offset":h=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":h=function(a,b,c,d,f,e){a.uniform4fv(b,e.Pk)};break;case "u_v_light_matrix":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Et)};g=!0;break;case "u_b_light_matrix":h=function(a,b,
c){a.uniformMatrix4fv(b,!1,c.wp)};break;case "u_p_light_matrix0":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.yg[0])};g=!0;break;case "u_p_light_matrix1":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.yg[1])};g=!0;break;case "u_p_light_matrix2":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.yg[2])};g=!0;break;case "u_p_light_matrix3":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.yg[3])};g=!0;break;case "u_motion_blur_exp":h=function(a,b,c){a.uniform1f(b,c.Lr)};g=!0;break;case "u_motion_blur_decay_threshold":h=
function(a,b,c){a.uniform1f(b,c.mb_decay_threshold)};g=!0;break;case "u_refl_plane":h=function(a,b,c,d){a.uniform4fv(b,d.fc)};break;case "u_radial_blur_step":h=function(a,b,c){a.uniform1f(b,c.Uk)};break;case "u_god_rays_intensity":h=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":h=function(a,b,c){a.uniform1f(b,c.Lh)};break;case "u_ssao_blur_discard_value":h=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};g=!0;break;case "u_ssao_influence":h=function(a,
b,c){a.uniform1f(b,c.Kh)};break;case "u_ssao_dist_factor":h=function(a,b,c){a.uniform1f(b,c.Jh)};break;case "u_dof_dist":h=function(a,b,c,d,f,e){a.uniform1f(b,e.dof_distance)};g=!0;break;case "u_dof_front":h=function(a,b,c,d,f,e){a.uniform1f(b,e.dof_front)};g=!0;break;case "u_dof_rear":h=function(a,b,c,d,f,e){a.uniform1f(b,e.dof_rear)};g=!0;break;case "u_outline_intensity":h=function(a,b,c,d){a.uniform1f(b,d.fd)};g=!0;break;case "u_outline_color":h=function(a,b,c){a.uniform3fv(b,c.gf)};break;case "u_draw_outline":h=
function(a,b,c){a.uniform1f(b,c.xm)};g=!0;break;case "u_glow_mask_small_coeff":h=function(a,b,c){a.uniform1f(b,c.small_glow_mask_coeff)};g=!0;break;case "u_glow_mask_large_coeff":h=function(a,b,c){a.uniform1f(b,c.large_glow_mask_coeff)};g=!0;break;case "u_brightness":h=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":h=function(a,b,c){a.uniform1f(b,c.contrast)};break;case "u_exposure":h=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":h=function(a,b,c){a.uniform1f(b,
c.saturation)};break;default:h=null}h&&(h={name:e,Pm:h,mg:b[e]},g?c.push(h):(d.push(h),f[e]=h))}a.st=c;a.Yi=d;a.On=f}var g=p("__config"),l=p("__debug"),n=p("__textures"),f=p("__util"),m=p("__camera");p("mat4");var r=g.p,z=[1,1,1,1],w=[1,1,1,1],E=[0,0,0,1],y=[0,0,0,0],H=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var v=null,B=new Uint8Array(4);a.jd=function(a){var b=r.background_color;a.clearColor(b[0],
b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);v=a};a.xi=function(a){if(a.Ta){var b=a.j;v.bindFramebuffer(v.FRAMEBUFFER,b.je);if(a.Jl){var f=b.ib;v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,f.Pb,f.$a,0)}v.viewport(0,0,b.width,b.height);"MAIN_CUBE_REFLECT"!=a.type&&d(a);a.Ea?v.enable(v.BLEND):v.disable(v.BLEND);a.Fb?v.enable(v.DEPTH_TEST):
v.disable(v.DEPTH_TEST);if(a.oa){for(var b=a.j,f=a.q,g=0;g<f.length;g++){var n=f[g],z=n.B,D=z.Yb;v.useProgram(D.cj);n=n.ed;D.Yi.length||h(D);for(var D=D.Yi,w=D.length;w--;){var B=D[w];B.Pm(v,B.mg,a,n,z,b)}}a.oa=!1}switch(a.type){case "DEPTH":r.qr?(v.enable(v.POLYGON_OFFSET_FILL),v.polygonOffset(5,5)):v.disable(v.POLYGON_OFFSET_FILL);v.cullFace(v.BACK);break;case "SHADOW_CAST":v.enable(v.POLYGON_OFFSET_FILL);v.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);v.cullFace(v.BACK);
break;case "MAIN_PLANE_REFLECT":v.disable(v.POLYGON_OFFSET_FILL);v.cullFace(v.FRONT);break;default:v.disable(v.POLYGON_OFFSET_FILL),v.cullFace(v.BACK)}if("MAIN_CUBE_REFLECT"==a.type)for(b=a.j,f=b.ib.$a,g=0;6>g;g++){z=e(g);b.ra=a.si[g];m.Yl(b);v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,z,f,0);d(a);z=a.q;for(n=0;n<z.length;n++)z[n].Ta=z[n].wm[g];c(a)}else c(a);l.sw("draw subscene: "+a.type);v.bindFramebuffer(v.FRAMEBUFFER,null)}};a.clear=function(a){v.bindFramebuffer(v.FRAMEBUFFER,a.j.je);
d(a)};a.np=function(a){var b=a.rp;b.length=0;var c=a.U;a=a.Yb;c&&a||f.ga("Incomplete batch");c=c.Vb;a=a.attributes;for(var d in a){var e=c[d];b.push({mg:a[d],Uv:4*e.offset,$x:1<e.frames?4*e.length:0,Bd:e.Bd})}};a.Tv=h;a.pp=function(a){var b=a.Yb,c=a.M;a=a.Hb;v.useProgram(b.cj);for(var d=0;d<c.length;d++)v.uniform1i(b.mj[a[d]],d)};a.Bs=function(a,b,c,d,e,g){d||(d=1);e||(e=1);g||(g=new Uint8Array(4*d*e));g.length!=4*d*e&&f.ga("read_pixels(): Wrong storage");v.bindFramebuffer(v.FRAMEBUFFER,a);v.readPixels(b,
c,d,e,v.RGBA,v.UNSIGNED_BYTE,g);v.bindFramebuffer(v.FRAMEBUFFER,null);return g};a.iC=function(a){var b=a.Yb;v.useProgram(b.cj);b.Yi.length||h(b);b=b.On.u_cube_fog;b.Pm(v,b.mg,null,null,a,null)};a.CA=function(a,b){var c=v.createFramebuffer();v.bindFramebuffer(v.FRAMEBUFFER,c);if(a){var d=a,f=d.$a,d=d.Pb==v.TEXTURE_CUBE_MAP?v.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.Pb;v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,d,f,0)}n.ur(b)?v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,v.RENDERBUFFER,
b.zf):n.Oi(b)&&(d=b,f=d.$a,d=d.Pb,v.framebufferTexture2D(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,d,f,0));l.ow();v.bindFramebuffer(v.FRAMEBUFFER,null);return c};a.BA=function(a,b,c,d,f){null==a?(v.bindFramebuffer(v.FRAMEBUFFER,a),v.viewport(0,0,d,f),v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT)):(n.Oi(b)&&v.deleteTexture(b.$a),n.ur(c)?v.deleteRenderbuffer(c.zf):n.Oi(c)&&v.deleteTexture(c.$a),v.deleteFramebuffer(a))};a.EE=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,p){function c(a,b,c){var f=a.Se;"string"==typeof c&&(a=d(a,c))&&(c=a[1]);for(a=0;a<f.length;a++)if(f[a][0]==b){f[a][1]=c;return}f.push([b,c])}function d(a,b){for(var c=a.Se,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function b(a,b){var c=a+b;if(v[c])return v[c];if(B){var d=B[b];if(!d)return null;d=p("__gpp_parser").eF.parse(d)}else if(d=p("shader_texts")[b],!d)return null;return v[c]=d}function e(a,c,d){function f(c){c=c.a;for(var d=0;d<c.length;d++){var q=
c[d];switch(q.type){case "condition":a:for(var q=q.a,M=0;M<q.length;M++){var D=q[M];switch(D.type){case "if":case "elif":if(e(D.c)){f(D.group);break a}break;case "else":f(D.group);break a;case "ifdef":D.name in u&&f(D.group);break;case "ifndef":D.name in u||f(D.group)}}break;case "include":q=b(y.shaders_dir,y.nB+q.file);f(q);break;case "var":case "export":case "import":break;case "define":M=q.name;u[M]=q.b;q.N&&(t[M]=q.N);break;case "error":throw"Shader error: #error "+q.b.join(" ");case "line":break;
case "pragma":m.push("#pragma "+q.name+" "+q.b.join(" "));break;case "undef":q=q.name;delete u[q];delete t[q];break;case "warning":r.warn("Shader warning: #warning "+q.b.join(" "));break;case "extension":q=h(q.b,u,t,!1);m.push("#extension "+q.join(" "));break;case "#":break;case "node":v[q.name]=q;break;case "nodes_global":q=g;for(M=0;M<q.length;M++){var D=q[M],F=v[D.id];if(F)for(var B=0,Y=0;Y<F.i.length;Y++){var G=F.i[Y];"node_param"==G.type&&(G=G.qualifier.join(" ")+" ","vert"==a?G+=D.$h[B]:"frag"==
a&&(G+=D.N[B],null!==D.Mk[B]&&(G+=" = "+D.Mk[B])),G+=";",m.push(G),B++)}}break;case "nodes_main":q=g;for(M=0;M<q.length;M++)if(D=q[M],F=v[D.id]){B={};Y={};for(G=0;G<D.de.length;G++)Y[D.de[G][0]]=[D.de[G][1]];oa=H=p=0;for(var G=D,E=F.i,ca=B,qa=Y,x=0;x<E.length;x++){var N=E[x];switch(N.type){case "node_in":var pa=G.G[p];if(null!==G.gn[p]){if(("MATERIAL"==G.id&&3===p||"MATERIAL_EXT"==G.id&&3===p||"TEXTURE_COLOR"==G.id||"TEXTURE_NORMAL"==G.id)&&N.f){ca[N.name]=G.gn[p];p++;continue}var La=N.qualifier.join(" ")+
" ",La=La+pa,La=La+(" = "+G.gn[p]),La=La+";";m.push(La)}ca[N.name]=pa;p++;break;case "node_out":pa=G.ya[H];if(!N.f||-1<w.indexOf(pa))La=N.qualifier.join(" ")+" ",La+=pa,La+=";",m.push(La),ca[N.name]=pa;-1<w.indexOf(pa)&&(qa["USE_OUT_"+N.name]=[1]);H++;break;case "node_param":"vert"==a?pa=G.$h[oa]:"frag"==a&&(pa=G.N[oa]),ca[N.name]=pa,oa++}}m.push("{");k(D,F.g,B,Y);m.push("}")}break;case "lamp":z[q.name]=q;break;case "lamps_main":q=l;for(M=0;M<q.length;M++)if(D=q[M],D.tz){m.push("{");F=z[D.type].g;
for(B=0;B<F.length;B++){Y=F[B];G=[];for(E=0;E<Y.b.length;E++){ca=Y.b[E];switch(ca){case "LAMP_IND":ca=D.index;break;case "LAMP_LIGHT_FACT_IND":ca=D.Bz;break;case "LAMP_FAC_CHANNELS":ca=D.Az;break;case "LAMP_SPOT_SIZE":ca=n(D.ld);break;case "LAMP_SPOT_BLEND":ca=n(D.Gg||.01);break;case "LAMP_LIGHT_DIST":ca=n(D.distance);break;case "LAMP_SHADOW_MAP_IND":ca=D.fy?1:0}G.push(ca)}m.push(G.join(" "))}m.push("}")}break;case "textline":q=h(q.b,u,t,!1);m.push(q.join(" "));break;default:throw"Unknown element type: "+
q.type;}}}function e(a,b){var c;c=h(a,u,t,!0,b);for(var d=[],f=0;f<c.length;f++)if(c[f]instanceof Object)switch(c[f].type){case "conditional_expr":var k=d.pop(),g=d.pop();d.pop()?d.push(g):d.push(k);break;case "logical_or_expr":k=d.pop();for(g=0;g<c[f].d-1;g++)l=d.pop(),k=k||l;d.push(k);break;case "logical_and_expr":k=d.pop();for(g=0;g<c[f].d-1;g++)l=d.pop(),k=k&&l;d.push(k);break;case "logical_bitor_expr":k=d.pop();for(g=0;g<c[f].d-1;g++)k|=d.pop();d.push(k);break;case "logical_bitxor_expr":k=d.pop();
for(g=0;g<c[f].d-1;g++)k^=d.pop();d.push(k);break;case "logical_bitand_expr":k=d.pop();for(g=0;g<c[f].d-1;g++)k&=d.pop();d.push(k);break;case "equal_expr":k=d.pop();g=d.pop();d.push(g==k);break;case "non_equal_expr":k=d.pop();g=d.pop();d.push(g!=k);break;case "le_expr":k=d.pop();g=d.pop();d.push(g<=k);break;case "ge_expr":k=d.pop();g=d.pop();d.push(g>=k);break;case "l_expr":k=d.pop();g=d.pop();d.push(g<k);break;case "g_expr":k=d.pop();g=d.pop();d.push(g>k);break;case "left_shift_expr":g=d.pop();k=
d.pop();d.push(g<<k);break;case "right_shift_expr":g=d.pop();k=d.pop();d.push(g>>k);break;case "add_expr":g=d.pop();k=d.pop();d.push(g+k);break;case "sub_expr":g=d.pop();k=d.pop();d.push(g-k);break;case "mul_expr":g=d.pop();k=d.pop();d.push(g*k);break;case "div_expr":g=d.pop();k=d.pop();d.push(g/k);break;case "mod_expr":g=d.pop();k=d.pop();d.push(g%k);break;case "pre_inc_expr":case "post_inc_expr":l=d.pop();d.push(++l);break;case "pre_dec_expr":case "post_dec_expr":l=d.pop();d.push(--l);break;case "positive_expr":l=
d.pop();d.push(+l);break;case "negative_expr":l=d.pop();d.push(-l);break;case "one_compl_expr":l=d.pop();d.push(~l);break;case "logic_negative_expr":l=d.pop();d.push(!l);break;default:E.ga("Unknown operation type: "+c[f].type)}else{var l=c[f];/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(l)?d.push(0):d.push(parseFloat(c[f]))}1==d.length?c=d[0]:(E.ga("Incorrect expression: "+c.join(" ")),c=void 0);return c}function k(a,b,c,d){for(var f=0;f<b.length;f++){var g=b[f];switch(g.type){case "node_condition":a:for(var l=
a,g=g.a,A=c,I=d,q=0;q<g.length;q++){var n=g[q];switch(n.type){case "node_if":case "node_elif":if(e(n.c,I)){k(l,n.g,A,I);break a}break;case "node_else":k(l,n.g,A,I);break a;case "node_ifdef":(n.name in u||n.name in I)&&k(l,n.g,A,I);break;case "node_ifndef":n.name in u||n.name in I||k(l,n.g,A,I)}}break;case "textline":l=[];for(A=0;A<g.b.length;A++)I=g.b[A],I in c?l.push(c[I]):l.push(I);l=h(l,u,t,!0,d);m.push(l.join(" "))}}}var g=d.In,l=d.sn;d=d.Se||[];for(var m=[],u={},q=0;q<d.length;q++)u[d[q][0]]=
[d[q][1]];for(q=0;q<g.length;q++)u["USE_NODE_"+g[q].id]=[1];var t={},v={},z={},w=[];for(q in g)for(var B in g[q].G)w.push(g[q].G[B]);f(c);var p=0,H=0,oa=0;return m.join("\n")}function h(a,b,c,d,f){var e=[];g(a,b,c,d,e,f);return e}function g(a,b,c,d,f,e){for(var k=0;k<a.length;k++){var h=a[k];h in b||e&&h in e?(h=e&&e[h]||b[h],0==h.length&&d?f.push(0):g(h,b,c,d,f,e)):f.push(h)}}function l(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);z.tw(d,b,c);return d}function n(a,b){!b&&a.length?
b=a.length:b||(b=1);switch(b){case 1:return f(a);case 2:return"vec2("+f(a[0])+","+f(a[1])+")";case 3:return"vec3("+f(a[0])+","+f(a[1])+","+f(a[2])+")";case 4:return"vec4("+f(a[0])+","+f(a[1])+","+f(a[2])+","+f(a[3])+")";case 9:return"mat3("+f(a[0])+","+f(a[1])+","+f(a[2])+","+f(a[3])+","+f(a[4])+","+f(a[5])+","+f(a[6])+","+f(a[7])+","+f(a[8])+")";case 16:return"mat4("+f(a[0])+","+f(a[1])+","+f(a[2])+","+f(a[3])+","+f(a[4])+","+f(a[5])+","+f(a[6])+","+f(a[7])+","+f(a[8])+","+f(a[9])+","+f(a[10])+","+
f(a[11])+","+f(a[12])+","+f(a[13])+","+f(a[14])+","+f(a[15])+")";default:throw"Wrong glsl value dimension";}}function f(a){return a%1?String(a):String(a)+".0"}var m=p("__config"),r=p("__print"),z=p("__debug"),w=p("__assets"),E=p("__util"),y=m.Ub,H={},v={},B=null,t="anchors.glslf anchors.glslv color_id.glslf color_id.glslv depth.glslf depth.glslv grass_map.glslf grass_map.glslv halo.glslf halo.glslv main.glslf main.glslv particles_color.glslf particles_color.glslv particles_texture.glslf particles_texture.glslv procedural_skydome.glslf procedural_skydome.glslv special_lens_flares.glslf special_lens_flares.glslv special_skydome.glslf special_skydome.glslv special_water.glslf special_water.glslv wireframe.glslf wireframe.glslv postprocessing/anaglyph.glslf postprocessing/antialiasing.glslf postprocessing/bloom_combine.glslf postprocessing/compositing.glslf postprocessing/depth_pack.glslf postprocessing/dof.glslf postprocessing/glow.glslf postprocessing/bloom_blur.glslf postprocessing/god_rays.glslf postprocessing/god_rays.glslv postprocessing/god_rays_combine.glslf postprocessing/luminance.glslf postprocessing/luminance_av.glslf postprocessing/luminance_trunced.glslf postprocessing/luminance_trunced.glslv postprocessing/motion_blur.glslf postprocessing/outline.glslf postprocessing/postprocessing.glslf postprocessing/postprocessing.glslv postprocessing/smaa.glslf postprocessing/smaa.glslv postprocessing/ssao.glslf postprocessing/ssao_blur.glslf include/blending.glslf include/caustics.glslf include/depth_fetch.glslf include/dynamic_grass.glslv include/environment.glslf include/fog.glslf include/gamma.glslf include/lighting.glslf include/math.glslv include/mirror.glslf include/nodes.glslf include/nodes.glslv include/pack.glslf include/particles.glslv include/precision_statement.glslf include/procedural.glslf include/refraction.glslf include/scale_texcoord.glslv include/shadow.glslf include/shadow.glslv include/skin.glslv include/std_enums.glsl include/to_world.glslv include/wind_bending.glslv".split(" "),
u=[],k=null,q=!1;a.jd=function(a){k=a};a.D=c;a.Fy=d;a.ME=function(a,b){for(var c=a.Se,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.UA=function(a){a.Se=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NODES_GLOW NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PERSPECTIVE_SHADOW_CAST PROCEDURAL_FOG PROCEDURAL_SKYDOME REFLECTION REFLECTION_PASS REFLECTION_TYPE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA MTEX_NEGATIVE MTEX_RGBTOINT NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_USAGE POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT WO_SKYBLEND WO_SKYPAPER WO_SKYREAL WO_SKYTEX WOMAP_BLEND WOMAP_HORIZ WOMAP_ZENUP WOMAP_ZENDOWN WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
d=0;d<b.length;d++){var f=b[d],e;switch(f){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "MTEX_NEGATIVE":case "MTEX_RGBTOINT":case "NODES_GLOW":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PERSPECTIVE_SHADOW_CAST":case "PROCEDURAL_FOG":case "PROCEDURAL_SKYDOME":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTION_TYPE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "WO_SKYBLEND":case "WO_SKYPAPER":case "WO_SKYREAL":case "WO_SKYTEX":case "WOMAP_BLEND":case "WOMAP_HORIZ":case "WOMAP_ZENUP":case "WOMAP_ZENDOWN":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":e=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":e=1;break;case "SHADOW_TEX_RES":e=n(2048);break;case "AA_METHOD":e="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":e="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":e="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":e="POST_EFFECT_NONE";break;case "SHADOW_USAGE":e="NO_SHADOWS";break;case "SSAO_QUALITY":e=
"SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":e="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":e="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":e=m.p.precision;break;case "EPSILON":e="highp"==m.p.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":e="u_va_frame_factor";break;default:r.error("Unknown directive ("+a.rj+", "+a.Ci+"): "+f)}c(a,f,e)}};a.yE=function(a){return a.rj};a.Rq=function(a){return a.Ci};a.FE=function(a,b){for(var f=b.Se,e=0;e<f.length;e++){var k=f[e][0],g=
f[e][1];d(a,k)&&c(a,k,g)}};a.By=function(a){var c=JSON.stringify(a),d=H[c];if(d)return d;var f=a.Ci,d=b(y.shaders_dir,a.rj),f=b(y.shaders_dir,f);if(!d||!f)return null;var g=e("vert",d,a),h=e("frag",f,a),d=k,m=l(d,c,g,d.VERTEX_SHADER),u=l(d,c,h,d.FRAGMENT_SHADER),f=d.createProgram();d.attachShader(f,m);d.attachShader(f,u);d.linkProgram(f);d.validateProgram(f);d.getProgramParameter(f,d.VALIDATE_STATUS)==d.nD&&r.error("shader program is not valid",c);z.uw(f,c,m,u,g,h);a={Mo:m,Fq:u,cj:f,attributes:{},
mj:{},Yi:[],On:{},st:[],Bb:a};h=d.getProgramParameter(f,d.ACTIVE_ATTRIBUTES);for(g=0;g<h;g++)m=d.getActiveAttrib(f,g).name,a.attributes[m]=d.getAttribLocation(f,m);h=d.getProgramParameter(f,d.ACTIVE_UNIFORMS);for(g=0;g<h;g++)m=d.getActiveUniform(f,g).name.split("[0]").join(""),a.mj[m]=d.getUniformLocation(f,m);return H[c]=d=a};a.Dz=function(){q=!1;if(b4w.module_check("shader_texts"))q=!0;else{for(var a=[],b=w.AT_TEXT,c=0;c<t.length;c++){var d=E.Ek(y.shaders_dir+t[c]);a.push([t[c],b,d])}b=function(a,
b){B||(B={});B[b]=a};a.length?w.enqueue(a,b,function(){q=!0}):r.error("Shaders have not been found.")}};a.vw=function(){return q};a.VD=function(){return u};a.Oq=function(){return H};a.cleanup=function(){for(var a in H){var b=H[a];k.deleteProgram(b.cj);k.deleteShader(b.Mo);k.deleteShader(b.Fq);delete H[a]}for(var c in v)delete v[c];for(var d in u)delete u[d]};a.WD=function(a){var b=a.Se;r.log("Shader: "+a.rj+" "+a.Ci+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)r.log("  "+b[a][0],
b[a][1])};a.t=n;a.Op=function(a,b){return b in a.mj?!0:!1};a.Uy=function(a){return(k.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,p){function c(a){return 65536<a.L?J.Qq()?!1:!0:!1}function d(a){return 0<a.fa.length?!0:!1}function b(a,b,c){if(!d(a))return a;c||u.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.L*(b||1)+", will use drawArrays","color: #aa0");b=a.fa;c=a.L;var f=a.J,k=a.A,g;for(g in f){var h=f[g],l=w(h,c);f[g]=e(b,h,l)}for(f=0;f<k.length;f++){var m=k[f];for(g in m)h=m[g],l=w(h,c),m[g]=e(b,h,l)}for(f=0;f<a.Y.length;f++){g=a.Y[f].Rb;for(var q in g)h=g[q],l=
w(h,c),g[q]=e(b,h,l)}a.L=b.length;a.fa=new Uint16Array(0);return a}function e(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),f=0;f<a.length;f++)for(var e=a[f],k=0;k<c;k++)d[c*f+k]=b[c*e+k];return d}function h(a,b){var c=a.nd,d=a.Vb[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function g(b,c){var d,f;switch(c){case a.ci:case a.zj:d=O.TRIANGLES;f=O.STATIC_DRAW;break;case a.Vo:d=O.POINTS;f=O.STATIC_DRAW;
break;case a.yj:d=O.TRIANGLES;f=O.DYNAMIC_DRAW;break;case a.Uo:d=O.POINTS;f=O.DYNAMIC_DRAW;break;case a.Rt:d=O.LINES;f=O.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.qj=f}function l(a){a.Ze?(a.me||(a.me=O.createBuffer()),O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,a.me),O.bufferData(O.ELEMENT_ARRAY_BUFFER,a.Ze,a.qj),a.ak=a.Ze.byteLength):a.ak=0;a.yf||(a.yf=O.createBuffer());O.bindBuffer(O.ARRAY_BUFFER,a.yf);O.bufferData(O.ARRAY_BUFFER,a.nd,a.qj);a.jq=a.nd.byteLength}function n(a){for(var b=
q.nb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].fa.length;b.fa=new Uint32Array(c);var f=c=0,e=0;if(0<a[0].Y.length)for(var k=0;k<a[0].Y.length;k++){for(d=0;d<a.length;d++)c+=a[d].Y[k].Rb.a_position.length,f+=a[d].Y[k].Rb.a_normal.length,e+=a[d].Y[k].Rb.a_tangent.length;d={a_position:new Float32Array(c),a_normal:new Float32Array(f),a_tangent:new Float32Array(e)};b.Y.push({rk:a[0].Y[k].rk,Rb:d})}for(d=c=0;d<a.length;d++)c+=a[d].L;b.L=c;var f=a[0],g;for(g in f.J){for(d=c=0;d<a.length;d++)c+=
a[d].J[g].length;b.J[g]=new Float32Array(c)}for(g in f.A[0]){for(d=c=0;d<a.length;d++)c+=a[d].A[0][g].length;for(d=0;d<f.A.length;d++)b.A[d]=b.A[d]||{},b.A[d][g]=new Float32Array(c)}for(g=f=c=0;g<a.length;g++){for(var e=a[g],h=e.fa,k=e.L,l=e.J,d=0;d<h.length;d++)b.fa[c+d]=h[d]+f;var c=c+h.length,m;for(m in l){var h=l[m],u=f*w(h,k);b.J[m].set(h,u)}for(d=0;d<e.A.length;d++){var l=e.A[d],n=b.A[d];for(m in l)h=l[m],u=f*w(h,k),n[m].set(h,u)}f+=k}if(0<b.Y.length)for(g=0;g<b.Y.length;g++)for(m=b.Y[g].Rb,
d=e=f=c=0;d<a.length;d++)k=a[d].Y[g].Rb,m.a_position.set(k.a_position,c),m.a_normal.set(k.a_normal,f),m.a_tangent.set(k.a_tangent,e),c+=k.a_position.length,f+=k.a_normal.length,e+=k.a_tangent.length;return b}function f(a,c,d,f,e,k){var g=q.nb("SUBMESH_"+a.name+"_"+c),h=a.submeshes[c],l=h.base_length,n=a.materials[c];g.L=l;var t=!1;if(r(d,"a_texcoord")){var w=null,B=a.materials[c];c=a.submeshes[c];if(B.texture_slots.length)switch(B=B.texture_slots[0],B.texture_coords){case "UV":B=a.uv_textures.indexOf(B.uv_layer);
0==B||-1==B?w=new Float32Array(c.texcoord):1==B&&(w=new Float32Array(c.texcoord2));break;case "ORCO":for(var D=a.b4w_bounding_box_source,w=new Float32Array(2*c.base_length),B=(D.max_x+D.min_x)/2,K=(D.max_z+D.min_z)/2,G=D.max_x-D.min_x,D=D.max_z-D.min_z,E=0,y=0;y<c.position.length;y+=3)w[E++]=(c.position[y]-B)/G+.5,w[E++]=(K-c.position[y+2])/D+.5}null===w&&(w=new Float32Array(c.texcoord));c=w}else c=new Float32Array(0);if(r(d,"a_orco_tex_coord")){w=a.b4w_bounding_box_source;B=new Float32Array(3*h.base_length);
K=w.max_x-w.min_x;G=w.max_z-w.min_z;D=w.max_y-w.min_y;for(y=E=0;y<h.position.length;y+=3)0==K?B[E++]=-1:B[E++]=parseFloat(((h.position[y]-w.min_x)/K).toFixed(3)),0==G?B[E++]=-1:B[E++]=parseFloat(((-w.min_z-h.position[y+2])/G).toFixed(3)),0==D?B[E++]=-1:B[E++]=parseFloat(((h.position[y+1]-w.min_y)/D).toFixed(3));w=B}else w=new Float32Array(0);var F,B=h.group;if(r(d,"a_influence")&&f){K=new Float32Array(4*l);G=B.length/l;D=new Float32Array(G);for(E=0;E<G;E++)for(F in D[E]=-1,f)if(y=f[F],y.Jt===E){D[E]=
y.ui;break}var U=3<G?G:4;f=new Float32Array(U);F=new Uint32Array(U);for(var E=new Float32Array(4),y=new Float32Array(U),U=new Uint32Array(U),Y=new Float32Array(4),L=0;L<l;L++)f.set(y),F.set(U),E.set(Y),K.set(z(B,G,L,l,D,f,F,E),4*L)}else K=new Float32Array(0);F=K;f=e?q.la(e):{};f.a_color={ag:!0};f.a_color.src=r(d,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,Sc:7}]:[];e={a_texcoord:c,a_influence:F,a_orco_tex_coord:w};F=h.vertex_colors;c=h.color;w=a.name;B=[];for(K=0;K<F.length;K++)B.push(F[K].name);
for(var p in f)if(K=f[p].src,K.length){for(D=G=0;D<K.length;D++)G+=q.Dg(K[D].Sc);e[p]=new Float32Array(G*l);for(D=E=0;D<K.length;D++){var J=K[D].name,y=K[D].Sc,U=q.Hs(y),qa=B.indexOf(J);-1==qa&&q.ga('vertex color "'+J+'" for mesh "'+w+'" not found.');Y=F[qa].mask;L=q.Dg(Y);(y&Y)!==y&&u.error("Wrong color extraction from "+J+" to "+p+".");for(var x=J=0;x<qa;x++)J+=q.Dg(F[x].mask);qa=J*l;for(J=0;J<l;J++)for(x=0;3>x;x++)U[x]&&(e[p][J*G+(E+q.hj(y,x))]=c[qa+J*L+q.hj(Y,x)]);E+=L}}else e[p]=new Float32Array(0);
p=a.uv_textures;f=h.texcoord;F=h.texcoord2;c=a.name;if(k)for(var N in k){w=p.indexOf(N);-1==w&&q.ga('uv map "'+N+'" for mesh "'+c+'" not found');if(0==w)var pa=new Float32Array(f);else 1==w&&(pa=new Float32Array(F));e[k[N]]=pa}g.J=e;g.fa=new Uint32Array(h.indices);k=h.position.length/l/3;pa=(N=r(d,"a_normal")&&h.normal.length?!0:!1)&&r(d,"a_tangent")&&h.tangent.length?!0:!1;p=n.texture_slots[0];p=N&&n.texture_slots.length&&r(d,"a_tangent")&&"ORCO"==p.texture_coords&&p.use_map_normal?!0:!1;0<a.b4w_shape_keys.length&&
(t=!0);for(e=0;e<k;e++){n=m(h,d,l,N,pa,p,e,a.name);if(t)if(f={},f.name=a.b4w_shape_keys[e].name,g.Y.push(f),0!=e){f.Rb=n;f.rk=a.b4w_shape_keys[e].value;continue}else f.Rb=m(h,d,l,N,pa,p,e,a.name),f.rk=1;g.A.push(n)}if(1<k&&!t){a=g.A[0];var n={},La;for(La in a)n[La]=new Float32Array(a[La]);g.A.push(n)}r(d,"a_polyindex")&&(b(g,1,!0),g.J.a_polyindex=v(g));return g}function m(a,b,c,d,f,e,k,g){var h={},l=new Float32Array(3*c),m=new Float32Array(d?3*c:0),n=new Float32Array(f||e?4*c:0),t=k*c*3;l.set(a.position.subarray(t,
t+3*c),0);d&&(t=k*c*3,m.set(a.normal.subarray(t,t+3*c),0));if(f)t=k*c*4,n.set(a.tangent.subarray(t,t+4*c),0);else if(e)for(a=n,u.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+g+'". Please add a UV-map.'),g=0;g<c;g++)b=D,d=L,b[0]=m[3*g],b[1]=m[3*g+1],b[2]=m[3*g+2],G.cross(b,q.AXIS_Z,d),0==G.length(d)&&G.cross(b,q.AXIS_X,d),G.normalize(d,d),a[4*g]=d[0],a[4*g+1]=d[1],a[4*g+2]=d[2],a[4*g+3]=1;else if(d&&r(b,"a_tangent"))for(n=new Float32Array(4*c),
c=0;c<n.length;c++)n[c]=1;h.a_position=l;h.a_normal=m;h.a_tangent=n;return h}function r(a,b){return-1<a.indexOf(b)?!0:!1}function z(b,c,d,f,e,k,g,h){for(var l=!0,m=0;m<c;m++){var u=b[m*f+d];if(-1!==u){var q=e[m];-1!==q&&(k[m]=u,g[m]=q,l=!1)}}if(l)return h;E(k,g,a.vl,!1);for(m=b=0;4>m;m++)b+=k[m];if(.01>b)return h;for(m=0;4>m;m++)k[m]/=b;if(.01>Math.abs(k[0]-1))h[0]=g[0]+1;else for(m=0;4>m;m++)h[m]=g[m]+k[m];return h}function w(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+
c+", base length="+b;return d}function E(b,c,d,f){for(var e=b.length,k=e,g=!1,h=f?-1:1;1<k||g;){1<k&&(k=Math.floor(k/1.247330950103979));for(var g=!1,l=0;k+l<e;l++)if(d==a.vl?0>h*(b[l]-b[l+k]):b[l]<b[l+k]&&f)g=b[l],b[l]=b[l+k],b[l+k]=g,g=c[l],c[l]=c[l+k],c[l+k]=g,g=!0}}function y(a,b,c){var d=[],f=[];G.subtract(b,a,d);G.subtract(c,a,f);G.normalize(d,d);G.normalize(f,f);return Math.acos(G.dot(d,f))}function H(a,b,c){b||(b=[]);c=c?a.A[0].a_normal:a.A[0].a_position;if(d(a)){a=a.fa;for(var f=a.length/
3,e=0;e<f;e++){var k=new Float32Array(9),g=a[3*e];k[0]=c[3*g];k[1]=c[3*g+1];k[2]=c[3*g+2];g=a[3*e+1];k[3]=c[3*g];k[4]=c[3*g+1];k[5]=c[3*g+2];g=a[3*e+2];k[6]=c[3*g];k[7]=c[3*g+1];k[8]=c[3*g+2];b[e]=k}}else for(e=0;e<c.length;e++)k=new Float32Array(9),k[0]=c[9*e],k[1]=c[9*e+1],k[2]=c[9*e+2],k[3]=c[9*e+3],k[4]=c[9*e+4],k[5]=c[9*e+5],k[6]=c[9*e+6],k[7]=c[9*e+7],k[8]=c[9*e+8],b[e]=k;return b}function v(a){for(var b=new Float32Array(a.L),c=0;c<a.L;c++)b[c]=c%3;return b}function B(a,b,c){var d=G.dist(a,
b);a=G.dist(a,c);b=G.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}function t(a,b,c,d,f){c-=b;for(var e=0;e<c;e+=d)e%d==f&&vec3.normalize(a.subarray(e+b-f,e+b+1),a.subarray(e+b-f,e+b+1))}var u=p("__print"),k=p("__tsr"),q=p("__util"),J=p("__extensions"),G=p("vec3"),D=new Float32Array(3),L=new Float32Array(3),K=new Float32Array(3);a.Rd=10;a.bp=20;a.sD=30;a.zj=10;a.Vo=20;a.yj=30;a.Uo=40;a.Rt=50;a.vl=0;a.cv=1;a.ci=a.zj;var O=null;a.jd=function(a){O=a};a.XD=function(a){var b=_buffers[a];O.deleteBuffer(b.me);
O.deleteBuffer(b.yf);delete _buffers[a]};a.PB=function(f,e,k,h){c(f)&&b(f);var m=f.fa,u=f.L,q=f.A,n={},t;for(t in f.J)t in h&&!h[t].ag||(n[t]=f.J[t]);h={Ze:null,nd:null,dn:0,count:0,Vb:{},mode:0,qj:0,ak:0,jq:0,yf:null,me:null,pk:null,Y:null};if(0<f.Y.length){t=q[0];for(var v=1;v<f.Y.length;v++){for(var z=f.Y[v].Rb,r=z.a_position,B=z.a_normal,D=t.a_position,K=t.a_normal,G=r.length,E=f.Y[v].rk,y=0;y<G;y++)D[y]+=E*r[y],K[y]+=E*B[y];z=z.a_tangent;r=t.a_tangent;B=z.length;for(y=0;y<B;y++)r[y]+=E*z[y]}}if(m.length)if(t=
m.length,65536>=u)var v=new Uint16Array(m),F=O.UNSIGNED_SHORT;else v=new Uint32Array(m),F=O.UNSIGNED_INT;else t=u,v=null;var E=0,y=q.length,U;for(U in q[0])z=q[0][U],E+=z.length*y;for(U in n)z=n[U],E+=z.length;U=new Float32Array(E);var E=0,y={},Y;for(Y in n)if(r=n[Y],z=r.length)U.set(r,E),y[Y]={FD:Y,Bd:w(r,u),offset:E,frames:1,length:z},E+=z;n=q.length;for(Y in q[0])if(r=q[0][Y],z=r.length,r=w(r,u),z)for(y[Y]={Bd:r,offset:E,frames:n,length:z},1<n&&(y[Y+"_next"]={Bd:r,offset:E+z,frames:n,length:z}),
B=0;B<n;B++)r=q[B][Y],U.set(r,E),E+=z;h.count=t;h.Ze=v;h.nd=U;h.dn=F;h.Vb=y;g(h,k);l(h);e!=a.Rd&&d(f)&&(h.pk={Pz:new Float32Array(m.length),Qz:new Float32Array(m.length),Gx:new Float32Array(m.length/3),type:e});h.Y=f.Y;return h};a.rz=c;a.qz=d;a.so=b;a.kC=function(a,b,c){g(a,b);a.count=c.length;a.Ze=c;a.dn=c instanceof Uint16Array?O.UNSIGNED_SHORT:O.UNSIGNED_INT};a.il=function(a,b,c,d){var f=a.nd,e=a.Vb,k=e[b];k?(c&&k.Bd!=c&&q.ga('invalid num_comp for "'+b+'"'),f.set(d,k.offset)):(f=f.length,k=new Float32Array(f+
d.length),k.set(a.nd),k.set(d,f),a.nd=k,e[b]={Bd:c,offset:f});l(a)};a.Rx=h;a.ZE=function(a){a.qj=O.STATIC_DRAW};a.Iz=function(a){a.qj=O.DYNAMIC_DRAW};a.yt=l;a.Qp=function(a){a.me&&O.deleteBuffer(a.me);a.yf&&O.deleteBuffer(a.yf)};a.gr=function(a,b){return a.submeshes[b].base_length?!1:!0};a.lt=function(a,b){for(var c=0;c<a.A.length;c++){var d=a.A[c].a_position;k.transform_vectors(d,b,d,0);d=a.A[c].a_normal;0<d.length&&k.transform_dir_vectors(d,b,d,0);d=a.A[c].a_tangent;0<d.length&&k.transform_tangents(d,
b,d,0)}(c=a.J.au_center_pos)&&c.length&&k.transform_vectors(c,b,c,0);return a};a.NB=function(a,b){var c=a.J.au_center_pos;if(c&&c.length){var d=new Float32Array(c);k.transform_vectors(d,b,d,0);for(var f=0;f<a.A.length;f++)for(var e=0;e<d.length;e++)a.A[f].a_position[e]+=d[e]-c[e];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.MB=function(a,b){var c=a.L,d;for(d in b){var f=b[d].length;a.J[d]=new Float32Array(f*c);for(var e=0;e<c;e++)for(var k=0;k<f;k++)a.J[d][e*f+
k]=b[d][k]}};a.OB=n;a.Hz=function(a,c,d){if(!a.L)return q.nb("EMPTY");var f=d.length;65536<a.L*f&&!J.Qq()&&b(a,f);var e=a.fa,g=a.L,h=a.J;a=a.A;for(var l in c){var m=c[l].length,u=m*g;h[l]=new Float32Array(u);for(var n=0;n<g;n++)for(u=0;u<m;u++)h[l][n*m+u]=c[l][u]}c=q.nb("CLONE_"+f+"_SUBMESHES");c.L=g*f;c.fa=new Uint32Array(e.length*f);for(n=0;n<f;n++)for(m=e.length*n,l=g*n,u=0;u<e.length;u++)c.fa[m+u]=e[u]+l;for(var t in h)for(e=h[t],u=e.length*f,m=w(e,g),c.J[t]=new Float32Array(u),n=0;n<f;n++)l=
g*m*n,c.J[t].set(e,l);for(t in a[0])for(n=0;n<a.length;n++)for(e=a[n][t],u=e.length*f,m=w(e,g),c.A[n]=c.A[n]||{},c.A[n][t]=new Float32Array(u),u=0;u<f;u++)switch(h=d[u],l=g*m*u,t){case "a_position":k.transform_vectors(e,h,c.A[n][t],l);break;case "a_normal":k.transform_dir_vectors(e,h,c.A[n][t],l);break;case "a_tangent":k.transform_tangents(e,h,c.A[n][t],l);break;default:throw"Wrong attribute name: "+t;}return c};a.wq=f;a.Ux=function(a){var b=a.L,c=a.A[0].a_position,d=new Float32Array(12*b),f=new Float32Array(8*
b);a=new Uint16Array(4*a.fa.length);for(var e=0;e<b;e++)d[12*e]=c[3*e],d[12*e+1]=c[3*e+1],d[12*e+2]=c[3*e+2],d[12*e+3]=c[3*e],d[12*e+4]=c[3*e+1],d[12*e+5]=c[3*e+2],d[12*e+6]=c[3*e],d[12*e+7]=c[3*e+1],d[12*e+8]=c[3*e+2],d[12*e+9]=c[3*e],d[12*e+10]=c[3*e+1],d[12*e+11]=c[3*e+2],f[8*e]=-.5,f[8*e+1]=-.5,f[8*e+2]=-.5,f[8*e+3]=.5,f[8*e+4]=.5,f[8*e+5]=.5,f[8*e+6]=.5,f[8*e+7]=-.5,a[6*e]=4*e+2,a[6*e+1]=4*e+1,a[6*e+2]=4*e,a[6*e+3]=4*e+2,a[6*e+4]=4*e,a[6*e+5]=4*e+3;c=q.nb("HALO");c.A=[];c.A[0]={};c.L=4*b;c.A[0].a_position=
d;c.J.a_halo_bb_vertex=f;c.fa=a;return c};a.bz=r;a.xq=function(a,b,c){for(var d=[],e=0;e<a.submeshes.length;e++){var k=f(a,e,b,null,c,null);k.L&&d.push(k)}return 0==d.length?q.nb("EMPTY"):1==d.length?d[0]:n(d)};a.jC=function(a,b,c){for(var d=a.Ze,f=h(a,"a_position"),e=a.pk,k=e.Pz,g=e.Qz,e=e.Gx,l=d,m=l.length/3,u=0;u<m;u++){var n=l[3*u],t=l[3*u+1],v=l[3*u+2],z=f[3*n+1],r=f[3*n+2],w=f[3*t+1],B=f[3*t+2],F=f[3*v+1],D=f[3*v+2];k[3*u]=(f[3*n]+f[3*t]+f[3*v])/3;k[3*u+1]=(z+w+F)/3;k[3*u+2]=(r+B+D)/3}q.jf(k,
b,g);b=g.length/3;for(f=0;f<b;f++)k=g[3*f]-c[0],l=g[3*f+1]-c[1],m=g[3*f+2]-c[2],e[f]=k*k+l*l+m*m;c=d;d=e.length;if(!(2>d))for(g=d,f=!1;1<g||f;)for(1<g&&(g=Math.floor(g/1.247330950103979)),f=!1,b=0;g+b<d;b++)0>e[b]-e[b+g]&&(f=e[b],e[b]=e[b+g],e[b+g]=f,f=c,k=b,l=b+g,m=f[3*k],u=f[3*k+1],n=f[3*k+2],f[3*k]=f[3*l],f[3*k+1]=f[3*l+1],f[3*k+2]=f[3*l+2],f[3*l]=m,f[3*l+1]=u,f[3*l+2]=n,f=!0);d=c;O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,a.me);O.bufferData(O.ELEMENT_ARRAY_BUFFER,d,O.DYNAMIC_DRAW)};a.$s=E;a.Dp=function(a,
b,c){for(var d=b.length/3,f=a.length/3,e=[],k=Array(3),g=Array(3),h=Array(3),l=0;l<f;l++){for(var m=a[3*l],u=a[3*l+1],n=a[3*l+2],q=0;3>q;q++)k[q]=b[3*m+q],g[q]=b[3*u+q],h[q]=b[3*n+q];if(c)var q=y(k,g,h),t=y(g,h,k),v=Math.PI-q-t;else v=t=q=1;var z=e,r;r=k;var F=h,w=[],B=[],D=[];G.subtract(g,r,w);G.subtract(F,r,B);G.cross(w,B,D);G.normalize(D,D);r=D;for(F=0;3>F;F++)w=3*u+F,B=3*n+F,z[3*m+F]=q*r[F],z[w]=t*r[F],z[B]=v*r[F]}if(c)for(var K in c)for(l=c[K],a=0;3>a;a++){b=3*l[0]+a;for(f=1;f<l.length;f++)k=
3*l[f]+a,e[b]+=e[k];for(f=1;f<l.length;f++)k=3*l[f]+a,e[k]=e[b]}for(l=0;l<d;l++){c=l;K=e;a=new Float32Array(3);for(b=0;3>b;b++)f=3*c+b,a[b]=K[f];G.normalize(a,a);for(b=0;3>b;b++)f=3*c+b,K[f]=a[b]}return e};a.Fp=function(a,b,c){for(var d={},f=b.length/3,e=0;e<f;e++){var k=String(b[3*e])+String(b[3*e+1])+String(b[3*e+2]);d[k]=[]}f=a.length;for(e=0;e<f;e++)b=a[e],k=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),k in d&&d[k].push(b);return d};a.Qm=function(a,b,c,d){var f=H(a,null,!1);if(c)var e=H(a,
null,!0);var k=f.length,g=new Float32Array(k),h=D,l=L;for(a=0;a<k;a++){var m=f[a];h.set(m.subarray(0,3));l.set(m.subarray(3,6));K.set(m.subarray(6));g[a]=Math.sqrt(B(h,l,K))}h=new Float32Array(k);h[0]=g[0];for(a=1;a<k;a++)h[a]=h[a-1]+g[a];k=h[g.length-1];g=[];for(a=0;a<b;a++){var l=k*q.Vc(d),l=q.Oj(h,l,0,h.length-1),m=c?e[l]:f[l],l=a,u=m,n=d,m=void 0,m=new Float32Array(3),t=u[0],v=u[1],z=u[2],r=u[3],w=u[4],F=u[5],E=u[6],G=u[7],y=u[8],u=q.Vc(n),n=q.Vc(n);1<u+n&&(u=1-u,n=1-n);var p=1-u-n,v=p*v+u*w+
n*G,z=p*z+u*F+n*y;m[0]=p*t+u*r+n*E;m[1]=v;m[2]=z;g[l]=m}return g};a.cE=H;a.vq=v;a.vF=B;a.MA=function(a,b,c){a=a.A[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]};a.Lv=function(a,b,c){var d=a.o;a=a.e.of;for(var f=1;f<a.length;f++)a[f].name==b&&(a[f].value=c);for(f=0;f<d.length;f++)if(!d[f].Yf&&d[f].Kd&&!d[f].$g){var e=d[f].U.Vb;b=d[f].U.nd;O.bindBuffer(O.ARRAY_BUFFER,d[f].U.yf);if(e.a_position){var k=e.a_position.offset,
g=e.a_position.length+k,h=d[f].U.Y[0].Rb.a_position;for(c=k;c<g;c++)b[c]=h[c-k];for(h=1;h<d[f].U.Y.length;h++){var l=d[f].U.Y[h].Rb.a_position,m=a[h].value;if(m)for(c=k;c<g;c++)b[c]+=m*l[c-k]}O.bufferSubData(O.ARRAY_BUFFER,4*k,b.subarray(k))}if(e.a_normal){k=e.a_normal.offset;g=e.a_normal.length+k;h=d[f].U.Y[0].Rb.a_normal;for(c=k;c<g;c++)b[c]=h[c-k];for(h=1;h<d[f].U.Y.length;h++)if(l=d[f].U.Y[h].Rb.a_normal,m=a[h].value)for(c=k;c<g;c++)b[c]+=m*l[c-k];t(b,k,g,3,2);O.bufferSubData(O.ARRAY_BUFFER,4*
k,b.subarray(k))}if(e.a_tangent){k=e.a_tangent.offset;e=e.a_tangent.length+k;h=d[f].U.Y[0].Rb.a_tangent;for(c=k;c<e;c++)b[c]=h[c-k];for(h=1;h<d[f].U.Y.length;h++)if(g=d[f].U.Y[h].Rb.a_tangent,m=a[h].value)for(c=k;c<e;c++)b[c]+=m*g[c-k];t(b,k,e,4,3);O.bufferSubData(O.ARRAY_BUFFER,4*k,b.subarray(k))}}};a.check_shape_keys=function(a){return a.e.Kd};a.get_shape_keys_names=function(a){var b=[];if(a.e)for(var c=1;c<a.e.of.length;c++)b.push(a.e.of[c].name);return b};a.get_shape_key_value=function(a,b){if(a.e)for(var c=
1;c<a.e.of.length;c++)if(b==a.e.of[c].name)return a.e.of[c].value;return 0};a.ir=function(a,b){var c=a.e.of;if(c)for(var d=1;d<c.length;d++)if(c[d].name==b)return!0;return!1};a.Ii=function(a){return a&&a.e&&a.e.vd?!0:!1}};b4w.module.__objects=function(a,p){function c(a){a={type:a,sc:0,$y:[0,0],h:new Float32Array(3),quat:new Float32Array(4),Cb:new Float32Array(8),W:new Float32Array(16),or:new Float32Array(16),Mb:new Float32Array(3),Tb:new Float32Array(3),nh:0,oh:0,jn:!1,Vj:null,fd:0,vo:!1,Ct:!1,xa:z.MS_STATIC,Jo:1,Io:1,Ko:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,fe:null,ut:!1,ee:0,Vf:0,Za:!1,Sb:null,Zb:null,zb:null,ym:!0,I:null,Ti:null,qc:null,Ac:null,fc:null,Ei:0,zi:0,Lm:0,Qi:0,ng:0,os:"",kl:!1,Fc:!1,jc:!1,
ic:!1,Wb:!1,Nb:!1,Dc:!1,ue:"",Zd:!1,Lc:!1,bk:!1,vd:!1,xb:!1,bh:!1,mh:!1,yk:!1,Eg:!1,Hk:!1,Gb:!1,Gk:!1,Vr:!1,vk:!1,is_visible:!1,Nm:!1,uj:0,Md:0,Ee:0,ce:0,be:0,Xd:0,pe:"",Kb:null,Nj:!1,sd:!1,Ql:!1,ki:"",ji:!1,Zf:0,time:0,Ho:0,Ft:0,re:0,Di:!1,ol:!1,Kd:!1,of:[],ph:!1,Me:!1,Le:1,El:0,Dl:1,hl:new Int8Array([-1,-1]),cl:[],Kr:[],Ss:[],Cc:null,Bc:null,Kc:null,Jc:null,Pc:null,qs:null,Il:null,Hl:null,qe:null,pg:null,zk:null,xc:null,og:null,Ak:null,Qb:null,Nl:null,Ll:null,Ml:null,hb:null,$c:null,wb:null,Lf:null,
Mf:null,scale:1,cf:1E4};D.identity(a.quat);J.identity(a.Cb);K.identity(a.W);K.identity(a.or);return a}function d(a){var b=a.parent;if(b&&b.Rg)return!0;switch(a.type){case "MESH":var c=f.sk(a),d=a.b4w_do_not_batch,e=a.b4w_collision,k=a.b4w_vehicle,g=a.b4w_floating,b=a.b4w_character,h=t.dz(a),l=B.hr(a),m=0<a.data.b4w_shape_keys.length,u=a.b4w_dynamic_geometry;if(!(c=c||d||e||k||m||g))a:{a=a.data;for(c=0;c<a.materials.length;c++)if("LENS_FLARES"===a.materials[c].name){c=!0;break a}c=!1}return c||h||
b||l||u;case "EMPTY":return b=f.sk(a),h=B.hr(a),a=a.b4w_do_not_batch,b||h||a;default:return!0}}function b(a,c,d,f,k,g,h,l,m){for(var u=0;u<a.nodes.length;u++){var n=a.nodes[u];if("VALUE"==n.type){var q=c+n.name;f.push(n.outputs[0].default_value);k.push(q,k.length/2)}else"RGB"==n.type?(q=c+n.name,n=n.outputs[0].default_value.slice(0,3),h.push(n[0],n[1],n[2]),l.push(q,l.length/2)):"GROUP"==n.type&&(q=n.node_group.node_tree,b(q,c+n.name+"%join%",q.animation_data,f,k,g,h,l,m))}if(d)for((a=d.action)&&
e(a,c,g,k,m,l),d=d.nla_tracks,f=0;f<d.length;f++)for(h=d[f].strips,u=0;u<d[f].strips.length;u++)a=h[u].action,e(a,c,g,k,m,l)}function e(a,b,c,d,f,e){var k=a.e.N,g;for(g in k){var l=b+g.match(/"(.*?)"/)[1],k=h(d,l);null!=k?(l=a.name+"%join%"+g,c.push(l,k)):(k=h(e,l),null!=k&&(l=a.name+"%join%"+g,f.push(l,k)))}}function h(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function g(a,b,c){return{name:a,type:b,modifiers:[],particle_systems:[],constraints:[],data:null,parent:null,
b4w_vehicle_settings:null,b4w_floating_settings:null,b4w_character_settings:null,b4w_vehicle:!1,b4w_character:!1,b4w_floating:!1,o:[],cp:c,Nc:[],Je:[],Sd:[],Yc:null,ab:null,Oc:null,l:null,C:[],n:null,k:null,sa:null,Dj:null,Aa:null,dp:[]}}function l(a){return a instanceof Array?a.slice():a}function n(a){if(!(a instanceof Object))return a;var b=null,c=null,d=null;a.M&&(b=a.M,a.M=null);a.Hb&&(c=a.Hb,a.Hb=null);a.Y&&(d=a.Y,a.Y=null);var f;f=a.constructor;switch(f){case Float32Array:case Uint32Array:case Uint16Array:f=
new f(a);break;case Array:f=new f(a.length);for(var e=0;e<a.length;e++)f[e]=n(a[e]);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:f=a;break;case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:f=null;break;case Function:f=a;break;default:for(e in f=new f,a)f[e]=n(a[e])}b&&(f.M=b,a.M=b);c&&(f.Hb=c,a.Hb=c);d&&(f.Y=d,a.Y=d);return f}var f=p("__animation"),m=p("__batch"),r=p("__boundings"),z=p("__camera"),w=p("__config"),E=p("__constraints"),y=p("__curve"),H=p("__geometry"),v=
p("__lights"),B=p("__nla"),t=p("__particles"),u=p("__print"),k=p("__scenes"),q=p("__transform"),J=p("__tsr"),G=p("__util"),D=p("quat"),L=p("vec3"),K=p("mat4"),O=w.Gb,A=0,I=0,C=[],Q=new Float32Array(4);a.Xj=c;a.jl=function(a,e){var h=d(a);a.Rg=h;a.e=c("MESH"===a.type?h?"DYNAMIC":"STATIC":a.type);a.cp=!1;a.ab=null;a.Nc=[];a.C=[];a.n=null;a.k=null;a.sa=null;a.Dj=a.Dj||null;a.Aa=a.Aa||null;a.dp=a.dp||[];var h=a.e,l=a.location,n=a.scale[0];G.Tn(a.rotation_quaternion,Q);q.set_translation(a,l);q.set_rotation(a,
Q);q.set_scale(a,n);switch(a.type){case "ARMATURE":l=a.pose.bones;for(n=0;n<l.length;n++){var t=l[n],w=t.bone,B=new Float32Array(w.matrix_local),p=new Float32Array(16);K.invert(B,p);var H=new Float32Array(t.matrix_basis),ga=new Float32Array(3);L.subtract(w.tail_local,w.head_local,ga);G.PC(ga,p,ga);t.pv=ga;t.jv=[t].concat(t.parent_recursive);t.fp=J.from_mat4(B,J.create());t.ep=J.from_mat4(H,J.create());t.zl=J.create();t.Fj=!1}l=f.fw(a);h.Pc=l;l=f.Ep(a,l);a.b4w_animation_mixing?(h.Cc=new Float32Array(l.Da),
h.Bc=new Float32Array(l.Da),h.Kc=new Float32Array(l.h),h.Jc=new Float32Array(l.h)):(h.Cc=l.Da,h.Bc=l.Da,h.Kc=l.h,h.Jc=l.h);h.qs=l;h.Zf=0;h.Me=a.b4w_animation_mixing;break;case "MESH":h.Eg=O.outlining_overview_mode||a.b4w_selectable;h.Hk=a.b4w_selectable;h.Gb=O.outlining_overview_mode||a.b4w_outlining;h.Gk=a.b4w_outlining;h.Vr=O.outlining_overview_mode||a.b4w_outline_on_select;h.sd=a.b4w_billboard;h.Ql=a.b4w_pres_glob_orientation;h.ki="BASIC";h.ji="SPHERICAL"==a.b4w_billboard_geometry;h.Ti={Ik:a.b4w_outline_settings.outline_duration,
Jk:a.b4w_outline_settings.outline_period,Kk:a.b4w_outline_settings.outline_relapses};h.Eg&&(a.e.Vj=G.Gq(A),A++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.e.ol=a.data.b4w_vertex_anim.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;n=a.e;if(a.data.b4w_shape_keys.length)for(n.Kd=!0,l=0;l<a.data.b4w_shape_keys.length;l++)t={},t.value=a.data.b4w_shape_keys[l].value,t.name=a.data.b4w_shape_keys[l].name,n.of.push(t);else n.Kd=!1;if(n=f.get_first_armature_object(a)){a.Dj=n;l=
a.e;w=a.data.vertex_groups;if(w.length){B=n.data.bones;p=n.pose.bones;H=0;t={};for(ga=0;ga<B.length;ga++){var aa=B[ga].name,ea=G.keysearch("name",aa,w);if(ea){var ba=G.Um(p,"name",aa);t[aa]={Bp:ga,ui:H++,Pn:ba,Jt:ea.index}}}w=H;l.Pc=t;t=f.Sq();l.re=w;w>2*t?(l.ph=!1,u.error('too many bones for "'+a.name+'" / '+l.re+" bones (max "+t+" with blending, "+2*t+" without blending). Skinning will be disabled.")):l.ph=!0}l=a.e.Pc;l=f.Ep(n,l);n.b4w_animation_mixing?(h.Cc=new Float32Array(l.Da),h.Bc=new Float32Array(l.Da),
h.Kc=new Float32Array(l.h),h.Jc=new Float32Array(l.h)):(h.Cc=l.Da,h.Bc=l.Da,h.Kc=l.h,h.Jc=l.h);h.Il=new Float32Array(4);h.Hl=D.create();h.qs=l;h.Zf=0}n=a.e;l=a.data.materials;t=[];w=[];B=[];p=[];H=[];ga=[];for(aa=0;aa<l.length;aa++)ea=l[aa],(ba=ea.node_tree)&&b(ba,ea.name+"%join%",ba.animation_data,t,w,B,p,H,ga);n.qe=t;n.pg=w;n.zk=B;n.xc=p;n.og=H;n.Ak=ga;a.o=[];h.Fc=a.b4w_shadow_cast;h.jc=a.b4w_shadow_receive;h.ic=a.b4w_shadow_cast_only&&h.Fc;h.Wb=a.b4w_reflexible;h.Nb=a.b4w_reflexible_only&&h.Wb;
h.Dc=a.b4w_reflective;h.ue=a.b4w_reflection_type;a.yl=null;if(a.b4w_reflective)if(n=a.e,"CUBE"==a.b4w_reflection_type)n.qc=I++;else{a:{l=a.constraints;for(t=0;t<l.length;t++)if(w=l[t],"LOCKED_TRACK"==w.type&&"REFLECTION PLANE"==w.name){l=w.target;break a}l=null}l||(l=g(G.nj("%reflection%"),"EMPTY",!1),t=c("EMPTY"),l.e=t,E.Gl(l,a,[0,0,0],null,1));t=null;for(w=0;w<C.length;w++)if(C[w]==l){t=w;break}null==t?(C.push(l),n.Ac=C.length-1):n.Ac=t;a.yl=l}h.Zd=a.b4w_caustics;h.Lc=a.b4w_wind_bending;h.uj=a.b4w_wind_bending_angle;
n=m.WC(a.b4w_wind_bending_angle,m.Vv(a.data.b4w_bounding_box),a.scale[0]);h.Md=n;h.Ee=a.b4w_wind_bending_freq;h.ce=a.b4w_detail_bending_freq;h.be=a.b4w_detail_bending_amp;h.Xd=a.b4w_branch_bending_amp;h.mh=!1;h.pe=a.b4w_main_bend_stiffness_col;n=a.b4w_detail_bend_colors;h.Kb={};h.Kb.Dr=n.leaves_stiffness_col;h.Kb.Cr=n.leaves_phase_col;h.Kb.Xr=n.overall_stiffness_col;h.bh=a.b4w_do_not_cull;h.bk=a.b4w_disable_fogging;h.vd=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";n=a.data.materials[0];
h.Ei=n.physics.friction;h.zi=n.physics.elasticity;h.Qi=0;h.cf=1E4;h.ng=a.b4w_lod_transition;h.yk=!0;break;case "CAMERA":z.hw(a);z.Qv(a);break;case "LAMP":v.xz(a);break;case "CURVE":if(n=y.ix(a))a.ov=n;break;case "EMPTY":h.Qb=r.Nd(),n=r.vj(),h.$c=n}if(!e&&(a.parent&&"OBJECT"==a.parent_type?(l=h.h,t=h.quat,n=h.scale,E.Gl(a,a.parent,l,t,n)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?(l=h.h,t=h.quat,n=h.scale,E.mp(a,a.parent,a.parent_bone,l,t,n)):a.Aa&&a.Aa.b4w_group_relative?(n=J.create_sep(h.h,
h.scale,h.quat),E.tv(a,a.Aa,n)):a.Aa&&!a.Aa.b4w_group_relative&&(q.v(a),J.multiply(a.Aa.e.Cb,a.e.Cb,a.e.Cb),q.set_translation(a,J.get_trans_view(a.e.Cb)),q.set_scale(a,J.get_scale(a.e.Cb)),q.set_rotation(a,J.get_quat_view(a.e.Cb))),n=a.dupli_group))for(l=n.objects,n=0;n<l.length;n++)l[n].Aa=a;a.field&&(h.Lm=a.field.strength,k.xt(a));h.kl=a.game.use_collision_compound;h.os=a.game.physics_type;q.v(a)};a.sC=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.e||"DYNAMIC"!=c.e.type&&"CAMERA"!=c.e.type||
q.v(c);c.b4w_use_default_animation&&f.sk(c)&&(f.apply_def(c),c.C.length&&f.play(c,null,f.SLOT_ALL))}};a.cc=function(a){return a.Rg?!0:!1};a.Ki=function(a){return"MESH"==a.type&&a.Rg?!0:!1};a.get_meta_tags=function(a){a=a.b4w_object_tags;return{title:a?a.title:"",description:a?a.description:"",category:a?a.category:""}};a.cleanup=function(){I=A=0;C=[]};a.mr=g;a.copy=function(a,b,c){b=g(b,a.type,!1);var d=[];if(c){for(var f=0;f<a.o.length;f++)a.o[f].Yf||(b.o.push(n(a.o[f])),d.push(a.o[f].U));for(f=
0;f<a.o.length;f++)if(a.o[f].Yf){var e=n(a.o[f]);b.o.push(e);for(var k=0;k<d.length;k++)d[k]==a.o[f].U&&(e.U=b.o[k].U)}}else b.o=l(a.o);b.e=n(a.e);a.Rg&&(b.Rg=a.Rg);a.Aa&&(b.Aa=a.Aa);a.Sd&&(b.Sd=l(a.Sd));!a.n||a.b4w_vehicle||a.b4w_character||a.b4w_floating||(b.n=n(a.n));b.game=n(a.game);b.b4w_collision_id=a.b4w_collision_id;b.b4w_correct_bounding_offset=a.b4w_correct_bounding_offset;b.b4w_collision=a.b4w_collision;b.data=a.data;b.particle_systems=c?n(a.particle_systems):l(a.particle_systems);if(c)for(f=
0;f<b.o.length;f++){b.o[f].U&&H.yt(b.o[f].U);if("PARTICLES"==b.o[f].type&&b.o[f].Sn)for(k=0;k<b.fF.length;k++)if(b.particle_systems[k].name==b.o[f].Sn){b.o[f].zc=b.particle_systems[k];break}b.o[f].zh=b.uuid;m.gC(b.o[f],G.Xg(b.e,0))}b.uuid=G.Iq();b.e.jn=!0;b.e.Vj=G.Gq(A);A++;return b};a.Yp=n;a.Ty=function(a,b){for(var c=a.e.pg,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null};a.Oy=function(a,b){for(var c=a.e.og,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}};b4w.module.__particles=function(a,p){function c(){throw"_rand() undefined";}function d(a,b,c,d,f,e,g){var h=a.T.um,k=a.T.wd,l=a.T.time;a=a.T.ss;for(var m=b?4:1,G=0;G<h.length;G+=m){var D=h[G];if(l>a&&l>=D&&D>a||l<a&&(D>a||l>=D))for(D=0;8>D;D++)k[8*G+D]=f[D];for(D=0;8>D;D++)r[D]=k[8*G+D];D=z;D[0]=c[3*G];D[1]=c[3*G+1];D[2]=c[3*G+2];n.transform_vec3(D,r,D);e[3*G]=D[0];e[3*G+1]=D[1];e[3*G+2]=D[2];var p=z;p[0]=d[3*G];p[1]=d[3*G+1];p[2]=d[3*G+2];n.transform_dir_vec3(p,r,p);g[3*G]=p[0];g[3*G+1]=p[1];g[3*
G+2]=p[2];if(b)for(D=1;4>D;D++)e[3*(G+D)]=e[3*G],e[3*(G+D)+1]=e[3*G+1],e[3*(G+D)+2]=e[3*G+2],g[3*(G+D)]=p[0],g[3*(G+D)+1]=p[1],g[3*(G+D)+2]=p[2]}}function b(a){a?(l.HB(a),c=function(){return l.sA()}):c=function(){return Math.random()}}var e=p("__config"),h=p("__geometry"),g=p("__scenes"),l=p("__util"),n=p("__tsr"),f=p("vec3"),m=e.Ud,r=new Float32Array(8),z=new Float32Array(3);a.lh=function(a){return 0<a.particle_systems.length?!0:!1};a.an=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==
a.particle_systems[b].settings.type)return!0;return!1};a.zE=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.dz=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.ky=function(a,e,g,n){g.T=g.T||{};var v=h.xq(e,["a_position","a_normal"],null),z=g.settings.count,t=g.settings.frame_start/m.Ja,u=g.settings.frame_end/m.Ja,k=g.settings.lifetime/
m.Ja,q=g.settings.lifetime_random,r=g.settings.emit_from,G=g.settings.factor_random,D=g.settings.angular_velocity_mode,p=g.settings.angular_velocity_factor,K=g.settings.b4w_randomize_emission,O=g.settings.b4w_cyclic;b(g.seed);var A=g.T.MC="WORLD"==g.settings.b4w_coordinate_system?!0:!1;g.T.frame=0;if(e=!a.dg){var I;I=[];for(var C=0;C<z;C++)I.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);I=new Float32Array(I);for(var C=[],Q=0;Q<z;Q++)C.push(4*Q,4*Q+2,4*Q+1,4*Q,4*Q+3,4*Q+2);C=new Uint16Array(C)}switch(r){case "VERT":for(var Q=
v.A[0].a_position,v=v.A[0].a_normal,M=Q.length/3,r=[],V=0;V<z;V++){var R=Math.round((M-1)*c());r.push(R);e&&(r.push(R),r.push(R),r.push(R))}M=[];for(V=0;V<r.length;V++)M.push(Q[3*r[V]]),M.push(Q[3*r[V]+1]),M.push(Q[3*r[V]+2]);Q=new Float32Array(M);M=[];for(V=0;V<r.length;V++)M.push(v[3*r[V]]),M.push(v[3*r[V]+1]),M.push(v[3*r[V]+2]);r=new Float32Array(M);break;case "FACE":Q=[];r=[];V=[];l.qk(0,V);M=h.Qm(v,z,!1,V);l.qk(0,V);v=h.Qm(v,z,!0,V);for(V=0;V<M.length;V++)Q.push(M[V][0],M[V][1],M[V][2]),e&&
(Q.push(M[V][0],M[V][1],M[V][2]),Q.push(M[V][0],M[V][1],M[V][2]),Q.push(M[V][0],M[V][1],M[V][2])),r.push(v[V][0],v[V][1],v[V][2]),e&&(r.push(v[V][0],v[V][1],v[V][2]),r.push(v[V][0],v[V][1],v[V][2]),r.push(v[V][0],v[V][1],v[V][2]));Q=new Float32Array(Q);r=new Float32Array(r);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}r=[Q,r];v=r[0];r=r[1];g.T.bj=new Float32Array(v);g.T.Xz=new Float32Array(r);g.T.kA=new Float32Array(v.length);g.T.Yz=
new Float32Array(r.length);g.T.time=0;g.T.ss=-1;Q=[];u=(u-t)/z;for(M=0;M<z;M++)V=K?u*M+10*u*(.5-c()):u*M,O||(V+=t),Q.push(V),e&&(Q.push(V),Q.push(V),Q.push(V));t=new Float32Array(Q);g.T.um=new Float32Array(t);g.T.lq=new Float32Array(t);g.T.wd=new Float32Array(8*t.length);for(K=0;K<8*t.length;K++)for(O=0;8>O;O++)g.T.wd[8*K+O]=n[O];A&&d(g,e,v,r,n,v,r);g=[];n=k*q;for(q=0;q<z;q++)A=n*c(),g.push(k-A),e&&(g.push(k-A),g.push(k-A),g.push(k-A));k=new Float32Array(g);g=[];for(n=0;n<z;n++){q=[c()-.5,c()-.5,
c()-.5];f.normalize(q,q);g.push(G*q[0]);g.push(G*q[1]);g.push(G*q[2]);switch(D){case "NONE":g.push(0);break;case "SPIN":case "VELOCITY":g.push(p);break;case "RAND":g.push(2*p*(c()-.5));break;default:throw"Undefined velocity factor";}if(e)for(q=g.slice(-4),A=0;12>A;A++)g.push(q[A%4])}z=new Float32Array(g);G=l.nb("EMITTER_PARTICLES");D=l.ad();D.a_position=v;D.a_normal=r;G.A[0]=D;e?(a.ge=h.yj,G.fa=C):(a.ge=h.Uo,G.fa=new Uint16Array(0));G.L=v.length/3;G.J.a_p_delay=t;G.J.a_p_lifetime=k;G.J.a_p_vels=z;
e&&(G.J.a_p_bb_vertex=I);return G};a.pC=function(a){for(var b=a.o,c=0;c<b.length;c++){var f=b[c],e=b[c].zc;if(e){var g=f.U;if(!e.T.MC)break;var l=e.T.kA,m=e.T.Yz;d(e,!f.dg,e.T.bj,e.T.Xz,a.e.Cb,l,m);h.Iz(g);h.il(g,"a_position",3,l);h.il(g,"a_normal",3,m)}}};a.VA=function(a,b,c){var d=b.settings.lifetime/m.Ja,f=b.settings.normal_factor,e=9.81*b.settings.effector_weights.gravity,h=b.settings.effector_weights.wind,l=b.settings.mass,k=b.settings.b4w_fade_in/m.Ja,n=b.settings.b4w_fade_out/m.Ja,r=b.settings.b4w_cyclic;
a.fs=b.settings.frame_end/m.Ja-b.settings.frame_start/m.Ja;a.bs=r?1:0;a.Ln=f;a.es=e;f=g.Yy();a.Lk[0]=f[0]*h;a.Lk[1]=f[1]*h;a.Lk[2]=f[2]*h;a.hs=d;a.gs=l;a.cs=k;a.ds=n;a.dg?(d=c.halo.size,h=c.halo.hardness,30>h?(h=.5,l=.9):40>h?(h=.1,l=1):50>h?(h=0,l=.8):(h=0,l=.5)):(d=b.settings.particle_size,l=h=1);a.Mn=d;a.Zr=h;a.Yr=l;d=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(d[0]&&d[0].use_map_size&&d[0].texture&&"BLEND"==d[0].texture.type&&d[0].texture.use_color_ramp){d=d[0].texture.color_ramp.elements;
h=Math.min(2*d.length,b.length);for(l=0;l<h;l+=2)k=d[l/2],b[l]=k.position,b[l+1]=(k.color[0]+k.color[1]+k.color[2])/3;a.ks=d.length}a.js.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){d=b[0].texture.color_ramp.elements;h=Math.min(4*d.length,c.length);for(l=0;l<h;l+=4)k=d[l/4],c[l]=k.position,c[l+1]=k.color[0],c[l+2]=k.color[1],c[l+3]=k.color[2];a.as=d.length}a.$r.set(c)};
a.eB=function(a,b){a.T.ss=a.T.time;a.T.time=b};a.nA=function(a){for(var b=a.L,c=a.A[0].a_position,d=a.J.a_texcoord,f=[],e=[],g=0;g<b;g++)e.push(c[3*g]),e.push(c[3*g+1]),f.push(c[3*g+2]);f=new Float32Array(f);e=new Float32Array(e);a.J.a_lf_dist=f;a.J.a_lf_bb_vertex=e;a.J.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.o;for(var d=0;d<a.length;d++){var f=a[d],e=f.zc;e&&e.name==b&&(f.Mn=c)}};a.set_normal_factor=function(a,b,c){a=a.o;for(var d=0;d<a.length;d++){var f=a[d],e=f.zc;e&&e.name==b&&(f.Ln=
c)}};a.set_factor=function(a,b,c){a=a.o;for(var d=0;d<a.length;d++){var f=a[d],e=f.zc;if(e&&e.name==b){var g=e.T.um;if(1==c)e=g;else if(0==c)for(var l=!f.dg,k=l?4:1,e=e.T.lq,m=0;m<e.length;m+=k)e[m]=1E4,l&&(e[m+1]=e[m],e[m+2]=e[m],e[m+3]=e[m]);else for(var n=1/c,e=e.T.lq,k=(l=!f.dg)?4:1,r=0,m=0;m<e.length;m+=k)m>=r?(e[m]=g[m],r+=n):e[m]=1E4,l&&(e[m+1]=e[m],e[m+2]=e[m],e[m+3]=e[m]);h.il(f.U,"a_p_delay",1,e)}}};a.yC=function(a,b,c){a=a.particle_systems;for(var d=0;d<a.length;d++){var f=a[d];if("EMITTER"==
f.settings.type)for(var e=f.T.um,d=0;d<8*e.length;d++)f.T.wd[8*d]=b[0],f.T.wd[8*d+1]=b[1],f.T.wd[8*d+2]=b[2],f.T.wd[8*d+3]=b[3],f.T.wd[8*d+4]=c[0],f.T.wd[8*d+5]=c[1],f.T.wd[8*d+6]=c[2],f.T.wd[8*d+7]=c[3]}}};b4w.module.__primitives=function(a,p){function c(a,b,c,d){for(var e=[],h=[],l=[],p=[],H=2*c/(a-1),v=2*d/(b-1),B=0;B<a;B++)for(var t=-c+B*H,u=0;u<b;u++)if(h.push(t,0,-d+u*v),l.push(0,1,0),p.push(B/(a-1),u/(b-1)),B&&u){var k=B*b+u,q=k-1,J=(B-1)*b+u,G=J-1;e.push(k,q,J);e.push(q,G,J)}a=g.ad();a.a_position=new Float32Array(h);a.a_normal=new Float32Array(l);l=g.nb("GRID_PLANE");l.A[0]=a;l.J.a_texcoord=new Float32Array(p);l.fa=new Uint32Array(e);l.L=h.length/3;return l}function d(a){var b=a.length;if(b%
4)throw"Wrong array";for(var c=[],d=[],h=0;h<b;h+=4){var l=a[h+1],p=a[h+2],y=a[h+3];e(a[h],d);e(l,d);e(p,d);e(y,d);c.push(h,h+1,h+2);c.push(h,h+2,h+3)}a=g.ad();a.a_position=new Float32Array(d);b=g.nb("FROM_QUADS");b.A[0]=a;b.fa=new Uint32Array(c);b.L=d.length/3;return b}function b(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function e(a,b){b.push(a[0],a[1],a[2])}var h=p("__geometry"),g=p("__util"),l=p("__config").p;a.qE=function(a){for(var b=g.nb("LINE"),c=[],d=0;d<2*a;d++)c.push(d);d=g.ad();d.a_point=
new Float32Array(c);b.A[0]=d;b.fa=new Uint32Array(c);b.L=2*a;return b};a.rE=function(a,b){var d=c(2,2,a,b);d.name="PLANE";return d};a.pE=c;a.py=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==y-1)||1==b%2&&(0==a||a==p-1)?!0:!1}var e=c/=Math.pow(2,a-1),w=c,p=b+1,y=b+1;b=[];c=[];for(var H=0,v=0,B=-1,t=[],u=0;u<a;u++){for(var k=2*e/(p-1),q=2*w/(y-1),J=[],G=[],D=0,L=0;L<p;L++){for(var K=-e+L*k,O=[],A=0;A<y;A++){var I=-w+A*q;if(K>-H&&K<H&&I>-v&&I<v)O.push(-1),D++;else{for(var C=null,Q=0;Q<t.length;Q+=
3)if(K==t[Q]&&I==t[Q+1]){C=t[Q+2];break}Q=null!==C?C:B+1;d(L,A)?(O.push(-2),D++):(null==C&&(0==A||A==y-1||0==L||L==p-1?(C=u==a-1?k:2*k,J.push(K,I,Q)):C=k,c.push(K,C,I),B++),O.push(Q));if(L&&A)if(1==L)if(d(L-1,A)){if(1<A){var I=Q-1,C=G[L-1][A+1],M=C-1;b.push(Q,I,M)}else C=G[L-1][A+1],M=C-1;b.push(Q,M,C)}else d(L,A)||(I=Q-1,C=G[L-1][A],b.push(Q,I,C));else if(L==p-1){if(!d(L,A))if(A==y-1)I=Q-1,C=G[L-1][A-1],M=G[L-2][A],b.push(Q,I,C),b.push(Q,C,M);else{var I=Q-1,C=G[L-1][A],M=C-1,V=C+1;b.push(Q,I,M);
b.push(Q,M,C);b.push(Q,C,V);2==A&&(V=G[L-2][A-2],b.push(I,V,M))}}else 1==A?d(L,A-1)?(I=G[L-1][A],C=G[L-1][A-1],b.push(Q,C,I)):(I=O[A-1],C=G[L-1][A],M=G[L-2][A-1],b.push(Q,I,C),b.push(I,M,C)):A==y-1?d(L,A)||(I=O[A-1],C=G[L-1][A-1],M=G[L-2][A],b.push(Q,I,C),b.push(Q,C,M)):-1!=G[L-1][A]&&-1!=G[L-1][A-1]&&-1!=O[A-1]?(I=O[A-1],C=G[L-1][A],M=G[L-1][A-1],b.push(Q,I,C),b.push(I,M,C),A==y-2&&d(L,A+1)&&(V=G[L-1][A+1],b.push(Q,C,V))):A==y-2&&d(L,A+1)&&(C=G[L-1][A],V=G[L-1][A+1],b.push(Q,C,V))}}G.push(O)}t=J;
H=e;v=w;e*=2;w*=2}2E4>H&&(a=-(2*H)/(p-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-H,a,-v),c.push(-H,a,v),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(H,a,-v),c.push(H,a,v),Q=B+1,b.push(Q+3,Q+2,Q+1,Q+2,Q+0,Q+1,Q+6,Q+4,Q+2,Q+4,Q+0,Q+2,Q+5,Q+7,Q+1,Q+7,Q+3,Q+1,Q+5,Q+4,Q+7,Q+7,Q+4,Q+6));a=g.ad();a.a_position=new Float32Array(c);e=g.nb("multigrid_plane");e.A[0]=a;e.fa=new Uint32Array(b);e.L=c.length/3;l.Ot&&(h.so(e,1,!0),a.a_polyindex=h.vq(e));return e};a.oE=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var c=[],d=[],h=0;h<b;h+=3){var l=a[h+1],p=a[h+2];e(a[h],d);e(l,d);e(p,d);c.push(h,h+1,h+2)}a=g.ad();a.a_position=new Float32Array(d);b=g.nb("FROM_TRIANGLES");b.A[0]=a;b.fa=new Uint32Array(c);b.L=d.length/3;return b};a.nE=d;a.ly=function(a){a=g.QC(a);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=d(b);a.name="FRUSTUM";return a};a.ob=function(){var a=g.nb("FULLSCREEN_TRI"),
b=g.ad();b.a_position=new Float32Array([0,0,1,0,0,1]);a.A[0]=b;a.fa=new Uint32Array([0,1,2]);a.L=3;return a};a.my=function(){var a=g.nb("FULLSCREEN_QUAD"),b=g.ad();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.A[0]=b;a.fa=new Uint32Array([0,2,1,1,2,3]);a.L=4;return a};a.hy=function(){var a=g.nb("BILLBOARD"),b=g.ad();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.A[0]=b;a.fa=new Uint32Array([0,2,1,0,3,2]);a.L=4;return a};a.iy=function(){var a=g.nb("CUBEMAP_BOARD"),b=g.ad();
b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.A[0]=b;a.fa=new Uint32Array([0,2,1,0,3,2]);a.L=4;return a};a.Kq=function(a,c){var d=g.nb("UV_SPHERE"),l,z,w=[],p=[],y=[];for(z=0;8>=z;z++)for(l=0;16>=l;l++){var H=l/16,v=z/8;p.push(-a*Math.cos(2*H*Math.PI)*Math.sin(v*Math.PI)+c[0],a*Math.cos(v*Math.PI)+c[1],a*Math.sin(2*H*Math.PI)*Math.sin(v*Math.PI)+c[2])}for(z=H=0;8>z;z++)for(l=0;16>l;l++){var v=b(p,17*z+l+1),B=b(p,17*z+l),t=b(p,17*(z+1)+l),u=b(p,17*(z+1)+l+1);Math.abs(v[1])==a+c[1]?(e(v,w),
e(t,w),e(u,w),y.push(H,H+1,H+2),H+=3):Math.abs(t[1])==a+c[1]?(e(v,w),e(B,w),e(t,w),y.push(H,H+1,H+2),H+=3):(e(v,w),e(B,w),e(t,w),e(u,w),y.push(H,H+1,H+2),y.push(H,H+2,H+3),H+=4)}l={};l.a_position=w;p=h.Fp(y,p,w);l.a_normal=h.Dp(y,w,p);l.a_tangent=[];d.J.a_influence=[];d.J.a_color=[];d.J.a_texcoord=[];d.A[0]=l;d.fa=y;d.L=w.length/3;return d};a.Jq=function(a){var b=g.nb("INDEX"),c=g.ad();c.a_index=new Float32Array(a);for(var d=0;d<a;d++)c.a_index[d]=d;b.A[0]=c;b.fa=new Uint16Array(0);b.L=a;return b}};b4w.module.__prerender=function(a,p){function c(a,c){var d=a.ed,f=c.j;d.is_visible=!1;var e;if(!(e=!d||d.mh)){var h=f.Ve,l=d.wb.F;e=d.cf;h=Math.sqrt((l[0]-h[0])*(l[0]-h[0])+(l[1]-h[1])*(l[1]-h[1])+(l[2]-h[2])*(l[2]-h[2]));l=d.ng*d.wb.Fa;e=!(h>=d.Qi&&h<e+l)}if(e)return!1;d.is_visible=!0;(e="OUTLINE_MASK"==c.type&&!Boolean(d.fd))||(f=f.gk,d.bh?e=!1:("STATIC"===d.type?(e=d.wb,d=e.F,d=g.CB(d,f,e.Fa)):(e=d.Mf,d=e.F,d=g.Lx(d,f,e.If,e.Jf,e.Kf)),e=d));return e?!1:"WIREFRAME"==c.type?a.B.wireframe_mode==b.ap.WM_DEBUG_SPHERES?
a.B.$g:!a.B.$g:!0}var d=p("__config"),b=p("__debug"),e=p("__geometry"),h=p("__renderer"),g=p("__util"),l=p("__vec3"),n=d.p,f="MAIN_OPAQUE MAIN_BLEND MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_GLOW SHADOW_CAST DEPTH OUTLINE_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.Qn=function(a){if(-1<f.indexOf(a.type)){for(var b=!1,d=a.q,g=0;g<d.length;g++){var p=d[g];if("MAIN_CUBE_REFLECT"==a.type)for(var y=0;6>y;y++)a.j.gk=a.om[y],p.wm[y]=c(p,a),p.wm[y]&&(b=!0);else p.Ta=c(p,a),p.Ta&&
(b=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||b?a.Ta=!0:(a.Ta&&h.clear(a),a.Ta=!1)}}if("MAIN_BLEND"==a.type&&n.alpha_sort&&a.q){b=a.j.Ve;d=l.dist(b,a.Qt)>n.alpha_sort_threshold;for(g=0;g<a.q.length;g++)if(y=a.q[g],p=y.ed,p.Nm||d){var H=y.B;if(H&&H.Ea&&H.He!=e.Rd){H=H.U;if(!H||!y.Ta)continue;(y=H.pk)&&y.type==e.bp&&e.jC(H,p.W,b)}p.Nm=!1}d&&l.copy(b,a.Qt)}}};b4w.module.__print=function(a){function p(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var d=1;d<a.length;d++)c.push(a[d]);return c}var c=!1,d=0,b=0;a.gB=function(a){c=a};a.xn=function(){console.log.apply(console,arguments)};a.log=function(){if(c){var a=p(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=function(){d++;var a=p(arguments,"B4W ERROR");console.error.apply(console,a)};a.warn=function(){b++;var a=p(arguments,"B4W WARN");console.warn.apply(console,
a)};a.info=function(){var a=p(arguments,"B4W INFO");console.info.apply(console,a)};a.Px=function(){d++;var a=p(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.Qx=function(){b++;var a=p(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){c&&console.time.apply(console,arguments)};a.timeEnd=function(){c&&console.timeEnd.apply(console,arguments)};a.group=function(){c&&console.group.apply(console,arguments)};a.groupCollapsed=function(){c&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){c&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.Xy=function(){return b};a.Gy=function(){return d};a.clear_errors_warnings=function(){d=b=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,p){function c(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"alpha"in a||(a.alpha=1,b("node material",a,"alpha"));"darkness"in a||(a.darkness=1,b("node material",a,"darkness"));"diffuse_toon_size"in a||(a.diffuse_toon_size=.5,b("node material",a,"diffuse_toon_size"));"diffuse_toon_smooth"in a||(a.diffuse_toon_smooth=.1,b("node material",a,"diffuse_toon_smooth"));"diffuse_intensity"in
a||(a.diffuse_intensity=1,b("node material",a,"diffuse_intensity"));"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_ior"in a||(a.specular_ior=4,b("node material",a,"specular_ior"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=.5,b("node material",a,"specular_toon_size"));
"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in a||(a.diffuse_fresnel_factor=.5,b("node material",
a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name="B4W_"+a.node_tree_name}}}
function d(a){if(a=a.nla_tracks)for(var c=0;c<a.length;c++)for(var d=a[c],f=0;f<d.strips.length;f++){var e=d.strips[f];"action"in e||(e.action=null,b("strip",e,"action"));"action_frame_start"in e||(e.action_frame_start=0,b("strip",e,"action_frame_start"));"action_frame_end"in e||(e.action_frame_end=e.frame_end-e.frame_start,b("strip",e,"action_frame_end"));"repeat"in e||(e.repeat=1,b("strip",e,"repeat"));"use_reverse"in e||(e.use_reverse=!1,b("strip",e,"use_reverse"));"scale"in e||(e.scale=1,b("strip",
e,"scale"))}}function b(a,b,c){c=c+">>"+a;c in y||(y[c]={qo:[],Fs:"undefined",type:a});y[c].qo.push(b.name)}function e(a,b){param_id in y||(y[param_id]={qo:[],Fs:"deprecated",type:a});y[param_id].qo.push(b.name)}function h(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=f.Qf(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var k=f.ni(d[c]);e.submeshes.push(k)}return e}var g=p("__boundings"),
l=p("__curve"),n=p("__print"),f=p("__util"),m=p("vec3"),r=p("vec4"),z=p("quat"),w=p("mat4"),E=[5,4],y={};a.Np=function(a){return-1!=f.Ht(a,E)};a.pw=function(a){y={};var g=a.worlds;if(0==g.length){n.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var h={name:"DEFAULT",horizon_color:new Float32Array([0,0,0]),zenith_color:new Float32Array([0,0,0]),light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},use_sky_paper:!1,use_sky_blend:!1,
use_sky_real:!1,b4w_fog_color:[.5,.5,.5],b4w_fog_density:0,texture_slots:[]};g.push(h)}for(var g=a.worlds,l=0;l<g.length;l++){h=g[l];"use_sky_blend"in h||(b("world",h,"use_sky_blend"),h.use_sky_blend=!1);"use_sky_paper"in h||(b("world",h,"use_sky_paper"),h.use_sky_paper=!1);"use_sky_real"in h||(b("world",h,"use_sky_real"),h.use_sky_real=!1);"b4w_sky_settings"in h&&"rayleigh_brightness"in h.b4w_sky_settings||(b("world",h,"rayleigh_brightness"),h.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,
use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"render_sky"in h.b4w_sky_settings||(b("world",h,"render_sky"),h.b4w_sky_settings.render_sky=!1);"b4w_fog_density"in h||(b("world",h,"b4w_fog_density"),h.b4w_fog_density=0);for(var m=h.texture_slots,h=0;h<m.length;h++){var k=m[h];"blend_type"in k||(k.blend_type=
"MIX",b("world_texture_slot",k,"blend_type"));"use_map_blend"in k||(k.use_map_blend=!1,b("world_texture_slot",k,"use_map_blend"));"use_map_horizon"in k||(k.use_map_horizon=!0,b("world_texture_slot",k,"use_map_horizon"));"use_map_zenith_up"in k||(k.use_map_zenith_up=!1,b("world_texture_slot",k,"use_map_zenith_up"));"use_rgb_to_intensity"in k||(k.use_rgb_to_intensity=!1,b("world_texture_slot",k,"use_rgb_to_intensity"));"invert"in k||(k.invert=!1,b("world_texture_slot",k,"invert"));"color"in k||(k.color=
[1,0,1],b("world_texture_slot",k,"color"));"blend_factor"in k||(k.blend_factor=0,b("world_texture_slot",k,"blend_factor"));"horizon_factor"in k||(k.horizon_factor=1,b("world_texture_slot",k,"horizon_factor"));"zenith_up_factor"in k||(k.zenith_up_factor=0,b("world_texture_slot",k,"zenith_up_factor"));"zenith_down_factor"in k||(k.zenith_down_factor=0,b("world_texture_slot",k,"zenith_down_factor"));"default_value"in k||(k.default_value=1,b("world_texture_slot",k,"default_value"))}}h=a.scenes;for(l=0;l<
h.length;l++)m=h[l],k=m.world,"timeline_markers"in m||(m.timeline_markers=null,b("scene",m,"timeline_markers")),"b4w_reflection_quality"in m||(m.b4w_reflection_quality="MEDIUM",b("scene",m,"b4w_reflection_quality")),"b4w_use_nla"in m||(m.b4w_use_nla=!1,b("scene",m,"b4w_use_nla")),"fps"in m||(m.fps=24,b("scene",m,"fps")),"b4w_nla_cyclic"in m||(m.b4w_nla_cyclic=!1,b("scene",m,"b4w_nla_cyclic")),"b4w_nla_script"in m||(m.b4w_nla_script=[],b("scene",m,"b4w_nla_script")),"b4w_detect_collisions"in m&&(e("scene",
m),delete m.b4w_detect_collisions),"audio_doppler_speed"in m||(m.audio_doppler_speed=343.3),"audio_doppler_factor"in m||(m.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in m||(m.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",m,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in m||(m.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in m||(m.b4w_enable_bloom=!1,b("scene",m,"b4w_enable_bloom")),"b4w_enable_motion_blur"in
m||(m.b4w_enable_motion_blur=!1,b("scene",m,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in m||(m.b4w_enable_color_correction=!1,b("scene",m,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in m||(m.b4w_enable_antialiasing=!0,b("scene",m,"b4w_enable_antialiasing")),"b4w_tags"in m||(m.b4w_tags={title:"",description:""},b("scene",m,"b4w_tags")),"b4w_enable_object_selection"in m||(m.b4w_enable_object_selection="AUTO",b("scene",m,"b4w_enable_object_selection")),"b4w_enable_outlining"in
m||(m.b4w_enable_outlining="AUTO",b("scene",m,"b4w_enable_outlining")),"b4w_enable_glow_materials"in m||(m.b4w_enable_glow_materials="AUTO",b("scene",m,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in m||(m.b4w_enable_anchors_visibility="AUTO",b("scene",m,"b4w_enable_anchors_visibility")),"b4w_outline_color"in m||(m.b4w_outline_color=[1,1,1],b("scene",m,"b4w_outline_color")),"b4w_outline_factor"in m||(m.b4w_outline_factor="b4w_glow_factor"in m?m.b4w_glow_factor:1,b("scene",m,"b4w_outline_factor")),
"b4w_shadow_settings"in m||(b("scene",m,"b4w_shadow_settings"),g=k.b4w_shadow_settings,m.b4w_shadow_settings=g?g:{csm_resolution:2048,self_shadow_polygon_offset:1,b4w_enable_csm:!1,csm_num:1,csm_first_cascade_border:10,first_cascade_blur_radius:3,csm_last_cascade_border:100,last_cascade_blur_radius:1.5,fade_last_cascade:!0,blend_between_cascades:!0}),g=m.b4w_shadow_settings,"csm_resolution"in g||(b("scene",m,"b4w_shadow_settings.csm_resolution"),g.csm_resolution=2048),"self_shadow_polygon_offset"in
g||(b("scene",m,"b4w_shadow_settings.self_shadow_polygon_offset"),g.self_shadow_polygon_offset=1),"self_shadow_normal_offset"in g||(b("scene",m,"b4w_shadow_settings.self_shadow_normal_offset"),g.self_shadow_normal_offset=.01),"b4w_enable_csm"in g||(b("scene",m,"b4w_shadow_settings.b4w_enable_csm"),g.b4w_enable_csm=!1),"csm_num"in g||(b("scene",m,"b4w_shadow_settings.csm_num"),g.csm_num=1),"csm_first_cascade_border"in g||(b("scene",m,"b4w_shadow_settings.csm_first_cascade_border"),g.csm_first_cascade_border=
10),"first_cascade_blur_radius"in g||(b("scene",m,"b4w_shadow_settings.first_cascade_blur_radius"),g.first_cascade_blur_radius=3),"csm_last_cascade_border"in g||(b("scene",m,"b4w_shadow_settings.csm_last_cascade_border"),g.csm_last_cascade_border=100),"last_cascade_blur_radius"in g||(b("scene",m,"b4w_shadow_settings.last_cascade_blur_radius"),g.last_cascade_blur_radius=1.5),"fade_last_cascade"in g||(b("scene",m,"b4w_shadow_settings.fade_last_cascade"),g.fade_last_cascade=!0),"blend_between_cascades"in
g||(b("scene",m,"b4w_shadow_settings.blend_between_cascades"),g.blend_between_cascades=!0),"b4w_ssao_settings"in m||(b("scene",m,"b4w_ssao_settings"),g=k.b4w_ssao_settings,m.b4w_ssao_settings=g?g:{dist_factor:0,samples:16,hemisphere:!1,blur_depth:!1,blur_discard_value:1}),g=m.b4w_ssao_settings,"dist_factor"in g||(b("scene",m,"b4w_ssao_settings.dist_factor"),g.dist_factor=0),"samples"in g||(b("scene",m,"b4w_ssao_settings.samples"),g.samples=16),"hemisphere"in g||(b("scene",m,"b4w_ssao_settings.hemisphere"),
g.hemisphere=!1),"blur_depth"in g||(b("scene",m,"b4w_ssao_settings.blur_depth"),g.blur_depth=!1),"blur_discard_value"in g||(b("scene",m,"b4w_ssao_settings.blur_discard_value"),g.blur_discard_value=1),"b4w_bloom_settings"in m||(b("scene",m,"b4w_bloom_settings"),g=k.b4w_bloom_settings,m.b4w_bloom_settings=g?g:{key:.2,blur:4,edge_lum:1}),"key"in m.b4w_bloom_settings||(b("scene",m,"b4w_bloom_settings.key"),m.b4w_bloom_settings.key=.2),"blur"in m.b4w_bloom_settings||(b("scene",m,"b4w_bloom_settings.blur"),
m.b4w_bloom_settings.blur=4),"edge_lum"in m.b4w_bloom_settings||(b("scene",m,"b4w_bloom_settings.edge_lum"),m.b4w_bloom_settings.edge_lum=1),"b4w_motion_blur_settings"in m||(b("scene",m,"b4w_motion_blur_settings"),g=k.b4w_motion_blur_settings,m.b4w_motion_blur_settings=g?g:{motion_blur_factor:.01,motion_blur_decay_threshold:.01}),"motion_blur_factor"in m.b4w_motion_blur_settings||(b("scene",m,"b4w_motion_blur_settings.motion_blur_factor"),m.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in
m.b4w_motion_blur_settings||(b("scene",m,"b4w_motion_blur_settings.motion_blur_decay_threshold"),m.b4w_motion_blur_settings.motion_blur_decay_threshold=.01),"b4w_color_correction_settings"in m||(b("scene",m,"b4w_color_correction_settings"),g=k.b4w_color_correction_settings,m.b4w_color_correction_settings=g?g:{brightness:0,contrast:0,exposure:1,saturation:1}),"b4w_god_rays_settings"in m||(b("scene",m,"b4w_god_rays_settings"),g=k.b4w_god_rays_settings,m.b4w_god_rays_settings=g?g:{intensity:.7,max_ray_length:1,
steps_per_pass:10}),"steps_per_pass"in m.b4w_god_rays_settings||(b("scene",m,"b4w_god_rays_settings.steps_per_pass"),m.b4w_god_rays_settings.steps_per_pass=10),"b4w_glow_settings"in m||(b("scene",m,"b4w_glow_settings"),m.b4w_glow_settings={render_glow_over_blend:!1,small_glow_mask_coeff:2,large_glow_mask_coeff:2,small_glow_mask_width:2,large_glow_mask_width:6},g=m.b4w_glow_settings,"b4w_render_glow_over_blend"in k&&(g.render_glow_over_blend=k.b4w_render_glow_over_blend),"b4w_small_glow_mask_coeff"in
k&&(g.small_glow_mask_coeff=k.b4w_small_glow_mask_coeff),"b4w_large_glow_mask_coeff"in k&&(g.large_glow_mask_coeff=k.b4w_large_glow_mask_coeff),"b4w_small_glow_mask_width"in k&&(g.small_glow_mask_width=k.b4w_small_glow_mask_width),"b4w_large_glow_mask_width"in k&&(g.large_glow_mask_width=k.b4w_large_glow_mask_width)),k=m.b4w_render_shadows,"AUTO"!=k&&"OFF"!=k&&"ON"!=k&&(m.b4w_render_shadows=k?"ON":"OFF"),k=m.b4w_render_reflections,"OFF"!=k&&"ON"!=k&&(m.b4w_render_reflections=k?"ON":"OFF"),k=m.b4w_render_refractions,
"AUTO"!=k&&"OFF"!=k&&"ON"!=k&&(m.b4w_render_refractions=k?"ON":"OFF");m=a.meshes;for(l=0;l<m.length;l++){k=m[l];k.b4w_bounding_box||(b("mesh",k,"b4w_bounding_box"),k.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});k.b4w_bounding_box_source||(b("mesh",k,"b4w_bounding_box_source"),k.b4w_bounding_box_source=k.b4w_bounding_box);k.uv_textures||(b("mesh",k,"uv_textures"),k.uv_textures=[]);k.b4w_bounding_sphere_center||(k.b4w_bounding_sphere_center=[0,0,0]);k.b4w_bounding_cylinder_center||
(k.b4w_bounding_cylinder_center=[0,0,0]);k.b4w_bounding_ellipsoid_center||(k.b4w_bounding_ellipsoid_center=[0,0,0]);k.b4w_bounding_ellipsoid_axes||(h=k.b4w_bounding_box,k.b4w_bounding_ellipsoid_axes=[(h.max_x-h.min_x)/2,(h.max_y-h.min_y)/2,(h.max_z-h.min_z)/2]);"b4w_shape_keys"in k||(k.b4w_shape_keys=[],b("mesh",k,"b4w_shape_keys"));for(var h=k,g=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],q=null,r=0;r<g.length;r++)h[g[r]]&&(q?
(h[g[r]]=!1,n.warn('WARNING property "'+g[r]+'" of object "'+h.name+'" has been set to "false". Foreground property "'+q+'" already exists.')):q=g[r]);for(h=0;h<k.b4w_vertex_anim.length;h++)g=k.b4w_vertex_anim[h],"allow_nla"in g||(b('mesh["b4w_vertex_anim"]',k,"allow_nla"),g.allow_nla=!0)}h=a.cameras;for(l=0;l<h.length;l++)m=h[l],m.type||(m.type="PERSP",b("camera",m,"type")),"b4w_eye_target_dist"in m&&(delete m.b4w_eye_target_dist,e("camera",m)),"b4w_hover_zero_level"in m||(m.b4w_hover_zero_level=
0,b("camera",m,"b4w_hover_zero_level")),"b4w_trans_velocity"in m||(m.b4w_trans_velocity=1,b("camera",m,"b4w_trans_velocity")),"b4w_rot_velocity"in m||(m.b4w_rot_velocity=1,b("camera",m,"b4w_rot_velocity")),"b4w_zoom_velocity"in m||(m.b4w_zoom_velocity=.1,b("camera",m,"b4w_zoom_velocity")),"b4w_use_distance_limits"in m||(m.b4w_use_distance_limits=!1,b("camera",m,"b4w_use_distance_limits")),"b4w_distance_min"in m||(m.b4w_distance_min=1,b("camera",m,"b4w_distance_min")),"b4w_distance_max"in m||(m.b4w_distance_max=
100,b("camera",m,"b4w_distance_max")),"b4w_horizontal_translation_min"in m||(m.b4w_horizontal_translation_min=-100,b("camera",m,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in m||(m.b4w_horizontal_translation_max=100,b("camera",m,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in m||(m.b4w_vertical_translation_min=-100,b("camera",m,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in m||(m.b4w_vertical_translation_max=100,b("camera",m,"b4w_vertical_translation_max")),
"b4w_use_horizontal_clamping"in m||(m.b4w_use_horizontal_clamping=!1,b("camera",m,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in m||(m.b4w_rotation_left_limit=-Math.PI,b("camera",m,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in m||(m.b4w_rotation_right_limit=Math.PI,b("camera",m,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in m||(m.b4w_horizontal_clamping_type="LOCAL",b("camera",m,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in m||(m.b4w_use_vertical_clamping=
!1,b("camera",m,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in m||(m.b4w_rotation_down_limit=-Math.PI/2,b("camera",m,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in m||(m.b4w_rotation_up_limit=Math.PI/2,b("camera",m,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in m||(m.b4w_vertical_clamping_type="LOCAL",b("camera",m,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in m||(m.b4w_hover_angle_min=Math.PI/6,b("camera",m,"b4w_hover_angle_min")),"b4w_hover_angle_max"in m||(m.b4w_hover_angle_max=
Math.PI/6,b("camera",m,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in m||(m.b4w_enable_hover_hor_rotation=!0,b("camera",m,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in m||(m.b4w_use_panning=!0,b("camera",m,"b4w_use_panning"));h=a.lamps;for(l=0;l<h.length;l++)m=h[l],"b4w_generate_shadows"in m||(m.b4w_generate_shadows=!1,b("lamp",m,"b4w_generate_shadows")),"b4w_dynamic_intensity"in m||(m.b4w_dynamic_intensity=!1,b("lamp",m,"b4w_dynamic_intensity")),"use_diffuse"in m||(m.use_diffuse=
!0,b("lamp",m,"use_diffuse")),"use_specular"in m||(m.use_specular=!0,b("lamp",m,"use_specular"));h=a.speakers;for(l=0;l<h.length;l++)m=h[l],"b4w_behavior"in m||(m.b4w_behavior=m.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in m||(m.b4w_disable_doppler=!1),"b4w_delay"in m||(m.b4w_delay=0),"b4w_delay_random"in m||(m.b4w_delay_random=0),"b4w_volume_random"in m||(m.b4w_volume_random=0),"b4w_pitch_random"in m||(m.b4w_pitch_random=0),"b4w_fade_in"in m||(m.b4w_fade_in=0),"b4w_fade_out"in
m||(m.b4w_fade_out=0),"b4w_loop"in m||(m.b4w_loop=!1),"b4w_loop_count"in m||(m.b4w_loop_count=0),"b4w_loop_count_random"in m||(m.b4w_loop_count_random=0),"b4w_playlist_id"in m||(m.b4w_playlist_id=""),m.animation_data&&d(m.animation_data);h=a.textures;for(l=0;l<h.length;l++)m=h[l],"b4w_anisotropic_filtering"in m||(m.b4w_anisotropic_filtering="OFF",b("texture",m,"b4w_anisotropic_filtering")),"b4w_water_foam"in m||(m.b4w_water_foam=!1,b("texture",m,"b4w_water_foam")),"b4w_foam_uv_freq"in m||(m.b4w_foam_uv_freq=
[1,1],b("texture",m,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in m||(m.b4w_foam_uv_magnitude=[1,1],b("texture",m,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in m||(m.b4w_parallax_steps=5,b("material",m,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in m||(m.b4w_parallax_lod_dist=10,b("material",m,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in m||(m.b4w_shore_dist_map=!1,b("texture",m,"b4w_shore_dist_map")),"b4w_shore_boundings"in m||(m.b4w_shore_boundings=new Float32Array(4),m.b4w_shore_boundings=
[1E3,-1E3,1E3,-1E3],b("texture",m,"b4w_shore_boundings")),"b4w_max_shore_dist"in m||(m.b4w_max_shore_dist=100,b("texture",m,"b4w_max_shore_dist")),"b4w_disable_compression"in m||(m.b4w_disable_compression=!1,b("texture",m,"b4w_disable_compression")),"b4w_source_type"in m||(m.b4w_source_type="",b("texture",m,"b4w_source_type")),"b4w_source_id"in m||(m.b4w_source_id="",b("texture",m,"b4w_source_id")),"b4w_source_size"in m||(m.b4w_source_size=1024,b("texture",m,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in
m||(m.b4w_enable_canvas_mipmapping=!0,b("texture",m,"b4w_enable_canvas_mipmapping"));g=a.materials;for(l=0;l<g.length;l++){q=g[l];"b4w_node_mat_type"in q&&e("material",q);"b4w_skydome"in q&&e("material",q);"b4w_procedural_skydome"in q&&e("material",q);q.b4w_water&&("b4w_water_shore_smoothing"in q||(q.b4w_water_shore_smoothing=!1,b("material",q,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in q||(q.b4w_water_dynamic=!1,b("material",q,"b4w_water_dynamic")),"b4w_waves_height"in q||(q.b4w_waves_height=
1,b("material",q,"b4w_waves_height")),"b4w_waves_length"in q||(q.b4w_waves_length=1,b("material",q,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in q||(q.b4w_water_dst_noise_scale0=.05,b("material",q,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in q||(q.b4w_water_dst_noise_scale1=.03,b("material",q,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in q||(q.b4w_water_dst_noise_freq0=1.3,b("material",q,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in q||(q.b4w_water_dst_noise_freq1=
1,b("material",q,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in q||(q.b4w_water_dir_min_shore_fac=.4,b("material",q,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in q||(q.b4w_water_dir_freq=.5,b("material",q,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in q||(q.b4w_water_dir_noise_scale=.05,b("material",q,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in q||(q.b4w_water_dir_noise_freq=.07,b("material",q,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in
q||(q.b4w_water_dir_min_noise_fac=.5,b("material",q,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in q||(q.b4w_water_dst_min_fac=.2,b("material",q,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in q||(q.b4w_water_waves_hor_fac=5,b("material",q,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in q||(q.b4w_water_absorb_factor=6,b("material",q,"b4w_water_absorb_factor")),"b4w_water_fog_color"in q||(q.b4w_water_fog_color=new Float32Array(3),q.b4w_water_fog_color=[.5,.7,.7],b("material",
q,"b4w_water_fog_color")),"b4w_foam_factor"in q||(q.b4w_foam_factor=5,b("material",q,"b4w_foam_factor")),"b4w_generated_mesh"in q||(q.b4w_generated_mesh=!1,b("material",q,"b4w_generated_mesh")),"b4w_water_num_cascads"in q||(q.b4w_water_num_cascads=5,b("material",q,"b4w_water_num_cascads")),"b4w_water_subdivs"in q||(q.b4w_water_subdivs=64,b("material",q,"b4w_water_subdivs")),"b4w_water_detailed_dist"in q||(q.b4w_water_detailed_dist=1E3,b("material",q,"b4w_water_detailed_dist")),"b4w_water_enable_caust"in
q||(q.b4w_water_enable_caust=!1,b("material",q,"b4w_water_enable_caust")),"b4w_water_caust_scale"in q||(q.b4w_water_caust_scale=.25,b("material",q,"b4w_water_caust_scale")),"b4w_water_caust_brightness"in q||(q.b4w_water_caust_brightness=.5,b("material",q,"b4w_water_caust_brightness")));"b4w_dynamic_grass_size"in q||(q.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in q||(q.b4w_dynamic_grass_color="");"diffuse_intensity"in q||(q.diffuse_intensity=1,b("material",q,"diffuse_intensity"));"b4w_use_ghost"in
q||(q.b4w_use_ghost=!1);"b4w_collision_margin"in q||(q.b4w_collision_margin=.04,b("material",q,"b4w_collision_margin"));"b4w_collision_group"in q||(q.b4w_collision_group=128,b("material",q,"b4w_collision_group"));"b4w_collision_mask"in q||(q.b4w_collision_mask=127,b("material",q,"b4w_collision_mask"));"b4w_do_not_render"in q||(q.b4w_do_not_render=!1,b("material",q,"b4w_do_not_render"));"HALO"!=q.type||"b4w_halo_sky_stars"in q||(q.b4w_halo_sky_stars=!1,b("material",q,"b4w_halo_sky_stars"));"HALO"!=
q.type||"b4w_halo_stars_blend_height"in q||(q.b4w_halo_stars_blend_height=10,b("material",q,"b4w_halo_stars_blend_height"));"HALO"!=q.type||"b4w_halo_stars_min_height"in q||(q.b4w_halo_stars_min_height=0,b("material",q,"b4w_halo_stars_min_height"));"specular_shader"in q||(q.specular_shader="COOKTORR",b("material",q,"specular_shader"));"diffuse_shader"in q||(q.diffuse_shader="LAMBERT",b("material",q,"diffuse_shader"));"roughness"in q||(q.roughness=.5,b("material",q,"roughness"));"diffuse_fresnel"in
q||(q.diffuse_fresnel=.1,b("material",q,"diffuse_fresnel"));"diffuse_fresnel_factor"in q||(q.diffuse_fresnel_factor=.5,b("material",q,"diffuse_fresnel_factor"));"specular_slope"in q||(q.specular_slope=.2,b("material",q,"specular_slope"));"specular_toon_size"in q||(q.specular_toon_size=.5,b("material",q,"specular_toon_size"));"specular_toon_smooth"in q||(q.specular_toon_smooth=.1,b("material",q,"specular_toon_smooth"));"specular_alpha"in q||(q.specular_alpha=1,b("material",q,"specular_alpha"));"b4w_wettable"in
q||(q.b4w_wettable=!1,b("material",q,"b4w_wettable"));"b4w_refractive"in q||(q.b4w_refractive=!1,b("material",q,"b4w_refractive"));"b4w_refr_bump"in q||(q.b4w_refr_bump=0,b("material",q,"b4w_refr_bump"));"b4w_shallow_water_col"in q||(q.b4w_shallow_water_col=[0,.8,.3],b("material",q,"b4w_shallow_water_col"));"b4w_shore_water_col"in q||(q.b4w_shore_water_col=[0,.9,.2],b("material",q,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in q||(q.b4w_shallow_water_col_fac=1,b("material",q,"b4w_shallow_water_col_fac"));
"b4w_shore_water_col_fac"in q||(q.b4w_shore_water_col_fac=.5,b("material",q,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in q||(q.b4w_water_sss_strength=5.9,b("material",q,"b4w_water_sss_strength"));"b4w_water_sss_width"in q||(q.b4w_water_sss_width=.45,b("material",q,"b4w_water_sss_width"));"b4w_render_above_all"in q||(q.b4w_render_above_all=!1,b("material",q,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in q||(q.b4w_water_norm_uv_velocity=.05,b("material",q,"b4w_water_norm_uv_velocity"));
"specular_ior"in q||(q.specular_ior=1,b("material",q,"specular_ior"));"darkness"in q||(q.darkness=0,b("material",q,"darkness"));"diffuse_toon_size"in q||(q.diffuse_toon_size=0,b("material",q,"diffuse_toon_size"));"diffuse_toon_smooth"in q||(q.diffuse_toon_smooth=0,b("material",q,"diffuse_toon_smooth"));m=q.texture_slots;for(h=0;h<m.length;h++)k=m[h],"blend_type"in k||(k.blend_type="MIX",b("texture_slot",k,"blend_type"));if(q.node_tree){m=q.node_tree.nodes;for(h=0;h<m.length;h++)c(m[h]);q.node_tree.animation_data&&
d(q.node_tree.animation_data)}}k=a.node_groups;for(l=0;l<k.length;l++)for(m=k[l].node_tree.nodes,h=0;h<m.length;h++)c(m[h]);m=a.objects;for(l=0;l<m.length;l++){k=m[l];switch(k.type){case "MESH":"b4w_dynamic_geometry"in k||(k.b4w_dynamic_geometry=!1);"b4w_reflexible"in k||(k.b4w_reflexible=!1);"b4w_reflexible_only"in k||(k.b4w_reflexible_only=!1);"b4w_reflective"in k||(k.b4w_reflective=!1);"b4w_reflection_type"in k||(k.b4w_reflection_type="PLANE",b("object",k,"b4w_reflection_type"));"b4w_wind_bending"in
k||(k.b4w_wind_bending=!1,b("object",k,"b4w_wind_bending"));"b4w_wind_bending_angle"in k||(k.b4w_wind_bending_angle=10,k.b4w_wind_bending_freq=.25,b("object",k,"wind bending params"));"b4w_detail_bending_amp"in k||(k.b4w_detail_bending_amp=.1,k.b4w_branch_bending_amp=.3,b("object",k,"detail bending params"));"b4w_detail_bending_freq"in k||(k.b4w_detail_bending_freq=1,b("object",k,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in k||(k.b4w_main_bend_stiffness_col="",b("object",k,"b4w_main_bend_stiffness_col"));
"b4w_detail_bend_colors"in k||(k.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",k,"b4w_detail_bend_colors"));"b4w_caustics"in k||(k.b4w_caustics=!1);"vertex_groups"in k&&k.vertex_groups.length&&k.data&&0==k.data.vertex_groups.length&&(k.data.vertex_groups=k.vertex_groups,delete k.vertex_groups,b("object",k,"vertex_groups"));"b4w_vertex_anim"in k&&k.b4w_vertex_anim.length&&k.data&&0==k.data.b4w_vertex_anim.length&&(k.data.b4w_vertex_anim=k.b4w_vertex_anim,
delete k.b4w_vertex_anim,b("object",k,"b4w_vertex_anim"));"b4w_do_not_render"in k||(k.b4w_do_not_render=!1);"use_ghost"in k.game||(k.game.use_ghost=!1);"use_sleep"in k.game||(k.game.use_sleep=!1);"velocity_min"in k.game||(k.game.velocity_min=0);"velocity_max"in k.game||(k.game.velocity_max=0);"collision_group"in k.game||(k.game.collision_group=1);"collision_mask"in k.game||(k.game.collision_mask=255);"b4w_vehicle_settings"in k?k.b4w_vehicle_settings&&("steering_ratio"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.steering_ratio=
10),"steering_max"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.steering_max=1),"inverse_control"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.inverse_control=!1),"force_max"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.force_max=1500),"brake_max"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.brake_max=100),"speed_ratio"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.max_speed_angle=Math.PI),
"delta_tach_angle"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in k.b4w_vehicle_settings||
(k.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.floating_factor=3),"floating_factor"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.water_rot_damp=.9)):(k.b4w_vehicle_settings=
null,b("object",k,"b4w_vehicle_settings"));"b4w_floating_settings"in k?k.b4w_floating_settings&&("floating_factor"in k.b4w_floating_settings||(k.b4w_floating_settings.floating_factor=3),"water_lin_damp"in k.b4w_floating_settings||(k.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in k.b4w_floating_settings||(k.b4w_floating_settings.water_rot_damp=.8)):(k.b4w_floating_settings=null,b("object",k,"b4w_floating_settings"));"b4w_character_settings"in k?k.b4w_character_settings&&("walk_speed"in
k.b4w_character_settings||(k.b4w_character_settings.walk_speed=4),"run_speed"in k.b4w_character_settings||(k.b4w_character_settings.run_speed=8),"step_height"in k.b4w_character_settings||(k.b4w_character_settings.step_height=.25),"jump_strength"in k.b4w_character_settings||(k.b4w_character_settings.jump_strength=5),"waterline"in k.b4w_character_settings||(k.b4w_character_settings.waterline=0)):(k.b4w_character_settings=null,b("object",k,"b4w_character_settings"));"b4w_selectable"in k||(k.b4w_selectable=
!1,b("object",k,"b4w_selectable"));"b4w_outlining"in k||(k.b4w_outlining=!1,b("object",k,"b4w_outlining"));"b4w_outline_on_select"in k||(k.b4w_outline_on_select=!1,b("object",k,"b4w_outline_on_select"));"b4w_billboard"in k||(k.b4w_billboard=!1,b("object",k,"b4w_billboard"));"b4w_billboard_geometry"in k||(k.b4w_billboard_geometry="SPHERICAL",b("object",k,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in k||(k.b4w_pres_glob_orientation=!1,b("object",k,"b4w_pres_glob_orientation"));"b4w_outline_settings"in
k||("b4w_glow_settings"in k?k.b4w_outline_settings=k.b4w_glow_settings:(k.b4w_outline_settings={},k.b4w_outline_settings.outline_duration=1,k.b4w_outline_settings.outline_period=1,k.b4w_outline_settings.outline_relapses=0),b("object",k,"b4w_outline_settings"));"b4w_lod_transition"in k||(k.b4w_lod_transition=.01,b("object",k,"b4w_lod_transition"));"lod_levels"in k||(k.lod_levels=[],b("object",k,"lod_levels"));"b4w_animation_mixing"in k||(k.b4w_animation_mixing=!1,b("object",k,"b4w_animation_mixing"));
break;case "EMPTY":"b4w_group_relative"in k||(k.b4w_group_relative=!1,b("object",k,"b4w_group_relative")),"b4w_anchor"in k||(k.b4w_anchor=null,b("object",k,"b4w_anchor")),!k.b4w_anchor||"max_width"in k.b4w_anchor||(k.b4w_anchor.max_width=250)}"collision_margin"in k.game||(k.game.collision_margin=.04,b("object",k,"collision_margin"));"b4w_anim_behavior"in k||(k.b4w_anim_behavior=k.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",k,"b4w_anim_behavior"));if(!("rotation_quaternion"in k)){h=[0,0,
0,1];f.euler_to_quat(k.rotation_euler,h);var g=h,q=h[0],r=h[1],z=h[2];g[0]=h[3];g[1]=q;g[2]=r;g[3]=z;k.rotation_quaternion=h;b("object",k,"rotation_quaternion")}"webgl_do_not_batch"in k&&(k.b4w_do_not_batch=k.webgl_do_not_batch)&&e("object",k);"b4w_shadow_cast_only"in k||(k.b4w_shadow_cast_only=!1,b("object",k,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in k||(k.b4w_correct_bounding_offset="AUTO",b("object",k,"b4w_correct_bounding_offset"));g=k.particle_systems;for(h=0;h<g.length;h++)q=
g[h],r=q.settings,"use_rotation_dupli"in r||(r.use_rotation_dupli=!1,b("object",r,"use_rotation_dupli")),"use_whole_group"in r||(r.use_whole_group=!1,b("object",r,"use_whole_group")),q.transforms||(q.transforms=new Float32Array,b("particle_system",q,"transforms")),"b4w_billboard_align"in r||(r.b4w_billboard_align="VIEW",b("particle_settings",r,"b4w_billboard_align")),"b4w_dynamic_grass"in r||(r.b4w_dynamic_grass=!1,b("object",r,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in r||(r.b4w_dynamic_grass_scale_threshold=
.01,b("object",r,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in r||(r.b4w_initial_rand_rotation=!1,b("particle_settings",r,"b4w_initial_rand_rotation")),"b4w_rotation_type"in r||(r.b4w_rotation_type="Z",b("particle_settings",r,"b4w_rotation_type")),"b4w_rand_rotation_strength"in r||(r.b4w_rand_rotation_strength=1,b("particle_settings",r,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in r||(r.b4w_hair_billboard=!1,b("particle_settings",r,"b4w_hair_billboard")),"b4w_hair_billboard_type"in
r||(r.b4w_hair_billboard_type="BASIC",b("particle_settings",r,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in r||(r.b4w_hair_billboard_jitter_amp=0,b("particle_settings",r,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in r||(r.b4w_hair_billboard_jitter_freq=0,b("particle_settings",r,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in r||(r.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",r,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in
r||(r.b4w_wind_bend_inheritance="PARENT",b("particle_settings",r,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in r||(r.b4w_shadow_inheritance="PARENT",b("particle_settings",r,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in r||(r.b4w_reflection_inheritance="PARENT",b("particle_settings",r,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in r||(r.b4w_vcol_from_name="",b("particle_settings",r,"b4w_vcol_from_name")),"b4w_vcol_to_name"in r||(r.b4w_vcol_to_name="",b("particle_settings",
r,"b4w_vcol_to_name")),"b4w_coordinate_system"in r||(r.b4w_coordinate_system="LOCAL",b("particle_settings",r,"b4w_coordinate_system")),"b4w_allow_nla"in r||(r.b4w_allow_nla=!0,b("particle_settings",r,"b4w_allow_nla")),"b4w_enable_soft_particles"in r||(r.b4w_enable_soft_particles=!1,b("particle_settings",r,"b4w_enable_soft_particles")),"b4w_particles_softness"in r||(r.b4w_particles_softness=1,b("particle_settings",r,"b4w_particles_softness"));"constraints"in k||(k.constraints=[],b("object",k,"constraints"));
g=k.modifiers;for(h=0;h<g.length;h++){a:{q=g[h];switch(q.type){case "ARRAY":if(!("fit_type"in q)){n.error("WARNING Incomplete modifier "+String(q.type)+' for "'+k.name+'", reexport "'+a.b4w_filepath_blend+'" scene');q=!1;break a}}q=!0}q||(g.splice(h,1),h--)}"animation_data"in k||(k.animation_data={action:null,nla_tracks:[]},b("object",k,"animation_data"));k.animation_data&&("action"in k.animation_data||(k.animation_data.action=null,n.warn("no action in animation data "+k.name)),"nla_tracks"in k.animation_data||
(k.animation_data.nla_tracks=[],n.warn("no NLA in animation data "+k.name)),d(k.animation_data));"b4w_collision_id"in k||(k.b4w_collision_id="",b("material",k,"b4w_collision_id"));h=k.scale;0==h[0]&&0==h[1]&&0==h[2]?h=!0:(g=Math.abs((h[1]-h[2])/h[1]),h=.005>Math.abs((h[0]-h[1])/h[0])&&.005>g);h||n.warn("non-uniform scale for object "+k.name);if(0>k.scale[0]||0>k.scale[1]||0>k.scale[2])n.warn("negative scale for object "+k.name+", using positive scale instead"),k.scale[0]=Math.abs(k.scale[0]),k.scale[1]=
Math.abs(k.scale[1]),k.scale[2]=Math.abs(k.scale[2])}for(var D in y)l=y[D],h=D.match(/.*?(?=>>|$)/i)[0],n.warn("WARNING "+String(h)+" is "+l.Fs+" for "+l.type+", reexport "+a.b4w_filepath_blend)};a.mw=function(a,b){"num_channels"in a||(a.num_channels=1,n.warn('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport scene'))};a.Jv=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var d=b[c].type;if("ARRAY"==d||"CURVE"==d){b=!0;break a}}b=!1}if(!b)return null;
b=h(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var e=a[c];switch(e.type){case "ARRAY":for(var d=b,k=e,n=0,p=0,G=0,D=new Float32Array(16),e=[],L=1;L<k.count;L++){k.use_constant_offset&&(n+=k.constant_offset_displace[0],p+=k.constant_offset_displace[1],G+=k.constant_offset_displace[2]);if(k.use_relative_offset)var K=d.b4w_bounding_box,n=n+(K.max_x-K.min_x)*k.relative_offset_displace[0],p=p+(K.max_y-K.min_y)*k.relative_offset_displace[1],G=G+(K.max_z-K.min_z)*k.relative_offset_displace[2];
f.ZB(n,p,G,D);for(var y=K=h(d),A=D,I=0;I<y.submeshes.length;I++){var C=y.submeshes[I];f.jf(C.position,A,C.position,0);f.RC(C.normal,A,C.normal);f.WB(C.tangent,A,C.tangent)}e.push(K)}for(L=0;L<e.length;L++)for(k=d,n=e[L],p=0;p<k.submeshes.length;p++){G=k.submeshes[p];D=n.submeshes[p];K=G.base_length;y=G.indices.length;G.base_length+=D.base_length;for(var Q in G)if("base_length"!=Q)if("indices"==Q)for(G[Q]=f.cC(G[Q],D[Q]),A=y;A<G.indices.length;A++)G.indices[A]+=K;else"vertex_colors"!=Q&&(G[Q]=f.Yx(G[Q],
D[Q]))}break;case "CURVE":for(var d=b,L=e.object.ov,k=new Float32Array(16),p=L.af?4:3,n=new Float32Array(p),p=new Float32Array(p),G=new Float32Array(3),D=new Float32Array(4),K=new Float32Array(4),y=new Float32Array(3),A=new Float32Array(3),I=new Float32Array(3),C=new Float32Array(4),E=new Float32Array(4),V=0;V<d.submeshes.length;V++){var R=d.submeshes[V],Z=R.position,fa=R.normal,R=R.tangent,W;a:switch(W=e.deform_axis,W){case "POS_X":case "NEG_X":W=0;break a;case "POS_Y":case "NEG_Y":W=1;break a;case "POS_Z":case "NEG_Z":W=
2;break a;default:throw"Wrong deform axis value "+W;}y[0]=0;y[1]=0;y[2]=0;y[W]=1;for(var ha=l.FB(L),S=0;S<Z.length/3;S++){I[0]=Z[3*S];I[1]=Z[3*S+1];I[2]=Z[3*S+2];var oa=I[W],da=l.EB(L,oa);l.GB(L,da,n);G[0]=n[0];G[1]=n[1];G[2]=n[2];l.DB(L,da,p);A[0]=p[0];A[1]=0;A[2]=p[2];m.normalize(A,A);z.rotationTo(y,A,D);0>oa?(n[0]=A[0],n[1]=A[1],n[2]=A[2],m.scale(n,oa,n),m.add(G,n,G)):oa>ha&&(n[0]=A[0],n[1]=A[1],n[2]=A[2],m.scale(n,oa-ha,n),m.add(G,n,G));w.fromRotationTranslation(D,G,k);L.af&&(z.setAxisAngle(y,
n[3],K),m.transformQuat(I,K,I));I[W]=0;m.transformMat4(I,k,I);Z[3*S]=I[0];Z[3*S+1]=I[1];Z[3*S+2]=I[2];fa.length&&(C[0]=fa[3*S],C[1]=fa[3*S+1],C[2]=fa[3*S+2],C[3]=0,r.transformMat4(C,k,C),fa[3*S]=C[0],fa[3*S+1]=C[1],fa[3*S+2]=C[2]);R.length&&(E[0]=R[3*S],E[1]=R[3*S+1],E[2]=R[3*S+2],E[3]=0,r.transformMat4(E,k,E),R[3*S]=E[0],R[3*S+1]=E[1],R[3*S+2]=E[2])}}}g.tA(b)}return b};a.RD=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,
raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,
b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,
texture_slots:[]}};a.Rv=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_use_nla)for(var d=d.b4w_nla_script,f=0;f<d.length;f++){var e=d[f];switch(e.type){case "SELECT":case "SELECT_PLAY":for(var g=0;g<a.length;g++){var h=a[g];h.name==e.object&&(h.b4w_selectable=!0)}break;case "SHOW":case "HIDE":for(g=0;g<a.length;g++)h=a[g],h.name==e.object&&(h.b4w_do_not_batch=!0)}}}}};b4w.module.__scenegraph=function(a,p){function c(a){a=lc.Yp(a);a.je=null;a.ib=null;a.Qc=null;return a}function d(a,c){var d=[];P.Jd(a,function(b,c,f){-1<d.indexOf(f)?P.DA(a,b,c,f,e(f)):d.push(f)});P.S(a,function(b,f){for(var x=0;x<f.ha.length;x++){var g=f.ha[x];c||"MAIN_PLANE_REFLECT"!=f.type&&"MAIN_CUBE_REFLECT"!=f.type&&"MAIN_XRAY"!=f.type||(g.Lg=!0);-1<d.indexOf(g)?f.ha[x]=e(g):d.push(g)}"ANTIALIASING"==f.type&&P.De(a,b,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.ha.length;c++){var d=
b.ha[c];d.ca=T.s;d.ba=T.s}});c||P.De(a,b,function(a,b,c){"DEPTH"==c.P&&(c.Lg=!0)})});P.S(a,function(c){var d={};b(a,c,d);for(var f in d){c=d[f];for(var x=c[0],e=0;e<c.length;e++)if(c[e].ca==T.s){x=c[e];break}for(var g=c[0],e=0;e<c.length;e++)if(c[e].ba==T.s){g=c[e];break}for(var h=c[0],e=0;e<c.length;e++)if(!c[e].Lg){h=c[e];break}for(e=0;e<c.length;e++)c[e].ca=x.ca,c[e].ba=g.ba,c[e].Lg=h.Lg}})}function b(a,c,d){P.De(a,c,function(c,f,x){x.Ra&&x.P==x.qa&&(d[x.P]=d[x.P]||[],-1==d[x.P].indexOf(x)&&d[x.P].push(x),
b(a,c,d))});P.wf(a,c,function(a,b,c){c.Ra&&(d[c.P]=d[c.P]||[],-1==d[c.P].indexOf(c)&&d[c.P].push(c))});c=P.Va(a,c);if("MOTION_BLUR"==c.type)for(var f=0;f<c.ha.length;f++){var x=c.ha[f];d[x.P].push(x)}}function e(a){if(a.va)throw"Failed to clone slink with attached texture";return Ba.Qf(a)}function h(a){var b=P.Ao(a),c=[];P.S(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":var x=[];break;default:x=c}for(var e=0;e<d.ha.length;e++){var g=
d.ha[e],h=m(x,g,l(g));g.va=h;d.Hd[e]=h}for(e=0;e<d.Hd.length;e++)h=d.Hd[e],f(x,h);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":x=[]}P.wf(b,a,function(c,d,f){if(!f.va){if((c=n(b,a,f.P))&&f.Ra&&!f.va){d=x;for(var e=c,g=0;g<d.length;g++){var h=d[g];h.wo===e&&h.ej++}}else c=m(x,f,l(f));f.va=c}});P.De(b,a,function(a,b,c){f(x,c.va)});P.wf(b,a,function(a,b,c){c.va&&"NONE"==c.qa&&f(x,c.va)})})}function g(a){z(a,function(b,c,d){b.Vh&&(Y(a,
d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||Y(a,d,"ANTIALIASING")||"ANCHOR_VISIBILITY"==d.type)&&(b.sf*=ka.render_resolution_factor)})}function l(a){a=Ba.Qf(a);delete a.qa;delete a.Ra;delete a.va;return JSON.stringify(a)}function n(a,b,c){var d=null;P.De(a,b,function(a,b,f){if(f.Ra&&f.P==f.qa&&f.P==c&&f.va)return d=f.va,!0});P.wf(a,b,function(a,b,f){if(f.Ra&&f.P==c&&f.va)return d=f.va,!0});return d}function f(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.wo===b&&d.ej&&d.ej--}}
function m(a,b,c){for(var d=null,f=0;f<a.length;f++){var x=a[f];if(x.id==c&&0===x.ej){d=x;break}}if(d&&!ka.Fz)return d.ej++,d.wo;b=r(b);a.push({id:c,ej:1,wo:b});return b}function r(a){var b=a.sf*a.size;switch(a.P){case "COLOR":var c=T.Yj("COLOR",T.Qg);T.resize(c,b,b);T.ij(c,a.ca,a.ba);return c;case "DEPTH":return a.Lg?(c=T.Yj("DEPTH_RBUF",T.Pg),T.resize(c,b,b)):(c=T.Yj("DEPTH_TEX",T.di),T.resize(c,b,b),T.ij(c,a.ca,a.ba)),c;case "CUBEMAP":return c=T.Sw(b);case "SCREEN":return null;default:throw"Wrong slink param: "+
a.P;}}function z(a,b){var c=!1;P.Jd(a,function(d,f,x){if(x&&(d=P.Va(a,d),f=P.Va(a,f),b(x,!1,d,f)))return c=!0});c||P.S(a,function(a,c){for(var d=0;d<c.ha.length;d++)if(b(c.ha[d],!0,c,null))return!0})}function w(a){P.S(a,function(b,c){if("SINK"!=c.type){var d=c.j;P.wf(a,b,function(a,b,c){c.Ra&&c.va&&(N.Zk(d,c.P,c.va),c.P==c.qa&&b.j&&N.Zk(b.j,c.P,c.va))});for(var f=0;f<c.ha.length;f++){var x=c.ha[f];x.Ra&&x.P==x.qa&&N.Zk(d,x.P,c.Hd[f])}!d.ib&&!d.Qc||d.je||(d.je=ta.CA(d.ib,d.Qc))}})}function E(a){var b=
null,c=0;P.S(a,function(a,d){if(d.type==vb.SB){if(c==vb.RB)return b=d,!0;c++}});return b}function y(a,b){var c=P.rg(a,b),d=k("NONE"),f=P.u(a,d),x=P.Xq(a)[0];P.Jd(a,function(b,c){c==x&&P.uA(a,b,x,b,f)});P.Jd(a,function(f,x,e){if(f==c)return P.m(a,b,d,B(vb.qB,"u_color",e.size,e.sf,e.Vh)),!0});P.Zc(a,f,x,B("SCREEN","NONE",.5,.5,!0))}function H(a,b){var c=v("SHADOW_CAST");c.mm=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.pn){case "SPOT":case "POINT":c.j=N.mb(N.Ib);N.$k(c.j,180*
b.ld/Math.PI,.1,2*b.distance);break;default:c.j=N.mb(N.Ff)}return c}function v(a){a={type:a,La:"",Ea:!1,ls:!1,Jl:!1,Ck:!1,ti:0,time:0,j:null,si:null,om:[],q:[],ha:[],Hd:[],tj:new Float32Array(3),Qt:new Float32Array(3),bc:new Float32Array(3),vc:new Float32Array(4),pc:new Float32Array(16),Vs:0,Ue:0,tg:0,jg:null,bf:null,ig:null,kg:null,Ye:new Float32Array(3),Df:new Float32Array(3),Ws:new Float32Array(4),mt:new Float32Array([0,0,0]),fl:new Float32Array(3),nt:new Float32Array(4),Us:new Float32Array(3),
Ui:0,xm:0,Mi:!1,gf:new Float32Array(3),Af:0,gb:null,ml:!1,pf:new Float32Array(2),qf:new Float32Array(2),Hh:0,uh:0,Zl:0,od:null,Cf:0,Og:0,Bf:0,Zd:!1,Ip:0,Jp:new Float32Array(2),Hp:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,Ih:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,Lh:0,
Kh:0,Jh:0,gt:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,th:0,Uk:0,Oh:0,mm:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,Et:null,wp:null,yg:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,Rl:0,Dm:0,mb_decay_threshold:0,mb_factor:0,Lr:0,Qk:"",vz:new Float32Array(2),small_glow_mask_width:0,large_glow_mask_width:0,small_glow_mask_coeff:0,large_glow_mask_coeff:0,xo:new Float32Array(2),Ma:new Float32Array(2),Ta:!0,enqueue:!0,ea:!0,ka:!0,Fb:!0,
oa:!0,Ce:1};a.Ma[0]=1;a.Ma[1]=1;return a}function B(a,b,c,d,f){return{P:a,qa:b,size:c,sf:d,Vh:f,Ra:!0,va:null,Lg:!1,ca:T.lc,ba:T.lc}}function t(a,b){for(var c=0,d=ia(a,b),f=0;f<d.length;f++){var x=d[f];"SHADOW_CAST"==x.type&&(x=x.j,b.dA=x.Ua/(x.Ua-x.Wa),b.Et=x.ra,b.wp=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.yg=b.yg||[],b.yg[c]=x.ua,c++)}}function u(){var a=v("GRASS_MAP");a.j=N.mb(N.Ie);return a}function k(a){var b=v("POSTPROCESSING");b.ea=!1;b.ka=!1;b.Fb=!1;b.j=N.mb(N.ub);b.Qk=
a;switch(a){case "NONE":b.Ma[0]=1;b.Ma[1]=1;break;case "GRAYSCALE":b.Ma[0]=1;b.Ma[1]=1;break;case "X_BLUR":b.Ma[0]=1;b.Ma[1]=0;break;case "Y_BLUR":b.Ma[0]=0;b.Ma[1]=1;break;case "X_GLOW_BLUR":b.Ma[0]=1;b.Ma[1]=0;break;case "Y_GLOW_BLUR":b.Ma[0]=0;b.Ma[1]=1;break;case "X_EXTEND":b.Ma[0]=1;b.Ma[1]=0;break;case "Y_EXTEND":b.Ma[0]=0;b.Ma[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}return b}function q(a){var b=v("BLOOM_BLUR");b.ea=!1;b.ka=!1;b.Fb=!1;b.j=N.mb(N.ub);b.Qk=a;switch(a){case "X_BLUR":b.Ma[0]=
1;b.Ma[1]=0;break;case "Y_BLUR":b.Ma[0]=0;b.Ma[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}return b}function J(a,b){var c=v("GLOW_COMBINE");c.ea=!1;c.ka=!1;c.Fb=!1;c.small_glow_mask_coeff=b.Xe.small_glow_mask_coeff;c.large_glow_mask_coeff=b.Xe.large_glow_mask_coeff;c.small_glow_mask_width=b.Xe.small_glow_mask_width;c.large_glow_mask_width=b.Xe.large_glow_mask_width;c.j=a;return c}function G(a,b,c,d,f,x,e,g,h){var k=v("MAIN_"+a);if("OPAQUE"===a)k.ea=!0,k.ka=c,k.Ea=!1;
else if("BLEND"===a)k.ea=!1,k.ka=!1,k.Ea=!0;else if("XRAY"===a)k.ea=!1,k.ka=!0,k.Ea=!0;else if("PLANE_REFLECT"===a||"CUBE_REFLECT"===a)k.ea=!0,k.ka=!0,k.Ea=!1;else if("GLOW"===a)k.ea=!0,k.ka=!1,k.Ea=!1;else throw"wrong main subscene type";k.Ea&&g&&(k.self_shadow_normal_offset=g.self_shadow_normal_offset);k.j=b;if(a=e.fo)k.Ws.set([a.Zv,a.fz,a.$C,a.ZC]),k.Us.set(a.color),k.Vs=a.wa;k.Ye.set(e.Ye);k.Df.set(e.Df);k.Ue=e.Ue;k.vc=x;d&&(k.gb=d,d.vc&&(k.od=new Float32Array(d.vc)),k.Cf=d.waves_height,k.Og=
d.waves_length,k.Bf=d.Bf,d.Zd&&h&&(k.Zd=!0,k.Ip=d.jw,k.Jp.set(d.kw),k.Hp=d.iw),d.bl&&(k.ml=!0,x=d.oB,k.pf[0]=(x[0]+x[1])/2,k.pf[1]=(x[2]+x[3])/2,k.qf[0]=x[0]-x[1],k.qf[1]=x[2]-x[3],k.Hh=d.Hh,k.uh=d.uh));k.jg=new Float32Array(3*f);k.bf=new Float32Array(3*f);k.ig=new Float32Array(3*f);k.kg=new Float32Array(0==f%2?2*f:2*f+2);return k}function D(a,b){var c=v("COLOR_PICKING");b&&(c.type+="_XRAY",c.ea=!1,c.ka=!0);c.enqueue=!1;c.j=a;return c}function L(a){var b=v("WIREFRAME");b.Ta=!1;b.ea=!1;b.ka=!1;b.j=
a;return b}function K(a){var b=v("ANCHOR_VISIBILITY");b.ea=!0;b.ka=!1;b.j=a;return b}function O(a,b){var c=v("DEPTH");c.j=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function A(a,b,c){var d=v("SSAO");d.ea=!1;d.ka=!1;d.Fb=!1;d.j=a;d.vc=b;d.od=new Float32Array(b);d.Lh=c.radius_increase;d.ssao_hemisphere=c.ez;d.Kh=c.influence;d.Jh=c.dist_factor;d.gt=c.KA;return d}function I(a,b){var c=v("SSAO_BLUR");c.ea=!1;c.ka=!1;c.Fb=!1;c.j=a;c.ssao_blur_depth=b.bw;c.ssao_blur_discard_value=
b.Ap;return c}function C(){var a=v("ANTIALIASING");a.ea=!1;a.ka=!1;a.Fb=!1;a.Ce=1/ka.render_resolution_factor;a.j=N.mb(N.ub);return a}function Q(a){var b=v(a);b.ea="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.ka=!1;b.Fb=!1;b.Ce=1/ka.render_resolution_factor;b.j=N.mb(N.ub);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.wz=new Float32Array(4));return b}function M(a,b,c,d){var f=v("COMPOSITING");f.ea=!1;f.ka=!1;f.Fb=!1;f.j=N.mb(N.ub);f.brightness=a;f.contrast=b;f.exposure=c;f.saturation=
d;return f}function V(a,b){var c=v("MOTION_BLUR");c.ea=!1;c.ka=!1;c.Fb=!1;c.j=N.mb(N.ub);c.Jl=!0;c.mb_decay_threshold=a;c.mb_factor=b;return c}function R(a){var b=v("DOF");b.ea=!1;b.ka=!1;b.Fb=!1;b.j=a;b.Ce=b.j.dof_power;return b}function Z(a){var b=v("OUTLINE_MASK");b.Fb=!1;b.j=a;return b}function fa(a){var b=v("OUTLINE");b.gf.set(a.gf);b.Ui=a.Ui;b.Dm=5;b.Rl=3;b.Fb=!1;b.j=N.mb(N.ub);return b}function W(){var a=v("REFRACT");a.ea=!1;a.ka=!1;a.Fb=!1;a.j=N.mb(N.ub);return a}function ha(a,b,c,d,f,x,e){var g=
v("GOD_RAYS");g.ea=!1;g.ka=!1;g.Fb=!1;g.Ye=new Float32Array([1,1,1]);g.Df=new Float32Array([1,1,1]);g.Ue=1;g.ls=d;g.Af=b;g.Uk=f;g.th=c;g.Oh=e;g.j=a;g.tg=x;g.jg=new Float32Array(3*x);g.bf=new Float32Array(3*x);g.ig=new Float32Array(3*x);g.kg=new Float32Array(0==x%2?2*x:2*x+2);return g}function S(a,b){var c=v("GOD_RAYS_COMBINE");c.ea=!1;c.ka=!1;c.Fb=!1;c.j=N.mb(N.ub);c.god_rays_intensity=a;c.tg=b;c.jg=new Float32Array(3*b);c.bf=new Float32Array(3*b);c.ig=new Float32Array(3*b);c.kg=new Float32Array(0==
b%2?2*b:2*b+2);return c}function oa(a,b){var c=v("SKY");c.enqueue=!1;c.ea=!1;c.ka=!1;c.Fb=!1;var d=N.mb(N.ub);d.width=ua.$j;d.height=ua.$j;c.j=d;c.si=Ba.jy();c.tg=a;c.jg=new Float32Array(3*a);c.bf=new Float32Array(3*a);c.ig=new Float32Array(3*a);c.kg=new Float32Array(0==a%2?2*a:2*a+2);c.Ye=new Float32Array([1,1,1]);c.Df=new Float32Array([1,1,1]);c.Ue=1;c.Ih.set(b.Ih);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;
c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function da(){var a=v("COPY");a.ea=!1;a.ka=!1;a.j=N.mb(N.ub);return a}function ga(){var a=v("ANAGLYPH");a.ea=!1;a.ka=!1;a.j=N.mb(N.ub);return a}function aa(){var a=v("LUMINANCE");
a.ea=!1;a.ka=!1;a.j=N.mb(N.ub);return a}function ea(){var a=v("AVERAGE_LUMINANCE");a.ea=!1;a.ka=!1;a.j=N.mb(N.ub);return a}function ba(a,b,c,d){var f=v("LUMINANCE_TRUNCED");f.ea=!1;f.ka=!1;f.bloom_key=a;f.bloom_edge_lum=b;f.j=d;f.jg=new Float32Array(3*c);f.bf=new Float32Array(3*c);f.ig=new Float32Array(3*c);f.kg=new Float32Array(0==c%2?2*c:2*c+2);return f}function F(a){var b=v("BLOOM");b.ea=!1;b.ka=!1;b.j=N.mb(N.ub);b.bloom_blur=a;return b}function U(){var a=v("SINK");a.enqueue=!1;return a}function Y(a,
b,c){if(b.type===c)return!0;b=ca(a,b);for(var d=0;d<b.length;d++)if(Y(a,b[d],c))return!0;return!1}function na(a,b,c){if(b.type===c)return!0;b=ia(a,b);for(var d=0;d<b.length;d++)if(na(a,b[d],c))return!0;return!1}function ia(a,b){var c=P.rg(a,b);if(c==P.Xo)throw"Subscene not in graph";for(var d=[],f=P.lr(a,c),x=0;x<f;x++){var e=P.jk(a,c,x);e!=c&&d.push(P.Va(a,e))}return d}function ca(a,b){var c=P.rg(a,b);if(c==P.Xo)throw"Subscene not in graph";for(var d=[],f=P.xg(a,c),x=0;x<f;x++){var e=P.cg(a,c,x);
e!=c&&d.push(P.Va(a,e))}return d}function qa(a){var b=[],c=[];z(a,function(a){a.va&&-1==b.indexOf(a.va)&&(b.push(a.va),c.push(a.va,b.length-1))});return c}function x(a,b){var c;c=""+(a.P+"\\n");c+="NONE"!=a.qa?a.qa+"\\n":"";c+="(";if(a.Vh){var d=a.sf;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.P){c+=" ";if(a.Lg)c+="RR";else{var d=a.ca,f=a.ba,x="";d==T.s?x+="L":d==T.lc&&(x+="N");f==T.s?x+="L":f==T.lc&&(x+="N");c+=x}for(d=0;d<b.length;d+=
2)b[d]==a.va&&(c+=" "+b[d+1])}return c+")\\n"}var N=p("__camera"),pa=p("__config"),La=p("__debug"),P=p("__graph"),ta=p("__renderer"),T=p("__textures"),Ba=p("__util"),lc=p("__objects");p("vec4");var vb=pa.tm,ka=pa.p,ua=pa.Dh;a.ww=function(a){switch(a.qa){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "NONE":return!1;default:return!0}};a.bC=z;a.dx=function(a,b,f){function x(d,f){var g=c(ra[f]);b.I.push(g);g=G(d,g,!1,Ub,ca,Ra,db,Va,a.Hg);l.push(g);P.u(e,g);P.m(e,m[f],g,
r[f]);"XRAY"==d?g.ha.push(B("DEPTH","DEPTH",1,1,!0)):P.m(e,m[f],g,pa[f]);pb&&(P.m(e,pb,g,Sa),P.m(e,pb,g,sb));if(Ma){for(var k=0;k<Y.length;k++)P.m(e,Y[k],g,lc[k]);if(Vb.gc&&Ca||Ua||Gb){var k=nc[f],h=c(k.j);b.I.push(h);var N=v("DEPTH_PACK");N.ea=!1;N.ka=!1;N.j=h;P.u(e,N);var h=B("DEPTH","u_depth",1,1,!0),n=B("COLOR","u_scene_depth",1,1,!0);n.ca=T.lc;n.ba=T.lc;P.m(e,k,N,h);P.m(e,N,g,n)}}if(qa.length)for(N=qa.length/ra.length,k=0;k<N;k++)h=N*f+k,P.m(e,qa[h],g,z[h]);if(na.length)for(k=0;k<na.length;k++)P.m(e,
na[k],g,ia[k]);ta.length&&P.m(e,ta[f],g,p[f]);return g}var e=P.create(),m=[],l=[],n=[],r=[],pa=[],qa=[],z=[],ta=[],p=[],Y=[],lc=[],na=[],ia=[],ca=a.yz,Ub=a.gb,Ua=a.shore_smoothing,Gb=a.sB,zb=a.Yn,Ha=a.Ae,Wb=a.jh,Vb=a.Kz,Xb=a.Ab,Rc=a.Vg,Gc=a.wh,wa=a.Zg,Ia=a.antialiasing,db=a.Ro,Ra=a.vc,Va=a.xe,Yb=a.Oz,ob=a.aw,Ta=a.lw,Da=a.Zy,jb=a.bA,Na=a.dh,Ma=a.Cx,Ca=a.gc,za=Boolean(f.length),ra=[];if(a.anaglyph_use&&!za){var Ib=b.I[0],Jb=c(Ib);N.Ir(Ib,N.vb);N.Ir(Jb,N.Db);ra.push(Ib,Jb);b.I.push(Jb)}else{var ya=b.I[0];
ra.push(ya)}if(zb){N.Eo(ra[0],Va);for(var Zb=Va.csm_num,X=0;X<Zb;X++){var Rb=H(X,Va);P.u(e,Rb);Y.push(Rb);var Xa=Va.csm_resolution,ya=Rb.j;ya.width=Xa;ya.height=Xa;Rb.ea=!1;lc.push(B("DEPTH","u_shadow_map"+X,Xa,1,!1));(La.Lp()||ka.zq)&&Rb.ha.push(B("COLOR","COLOR",Xa,1,!1))}}if(Xb&&Xb.Rr&&!za)for(X=0;X<Xb.Rr;X++){ya=N.mb(N.Ib);ya.width=a.Uf;ya.height=a.Uf;N.$k(ya,90,.1,100);N.nf(ya,ya.Ba);var Aa=G("CUBE_REFLECT",ya,!1,Ub,ca,Ra,db,null,a.Hg);Aa.si=Ba.ny();for(var va=0;6>va;va++)Aa.om.push(N.Vw());
P.u(e,Aa);var $b=B("CUBEMAP","u_cube_reflection",a.Uf,1,!1);$b.ca=T.s;$b.ba=T.s;var sc=B("DEPTH","DEPTH",a.Uf,1,!1);ia.push($b);Aa.ha.push(sc);na.push(Aa);Xb.Zj.push(Aa)}if(Xb&&0<Xb.Wk.length&&!za)for(X=0;X<ra.length;X++)for(va=0;va<Xb.Wk.length;va++)ya=c(ra[X]),ya.fc=new Float32Array(4),b.I.push(ya),Aa=G("PLANE_REFLECT",ya,!1,Ub,ca,Ra,db,null,a.Hg),P.u(e,Aa),$b=B("COLOR","u_plane_reflection",1,a.$i,!0),$b.ca=T.s,$b.ba=T.s,sc=B("DEPTH","DEPTH",1,a.$i,!0),z.push($b),Aa.ha.push(sc),qa.push(Aa),Xb.aj.push(Aa);
m=[];l=[];if(a.xb){var pb=u();P.u(e,pb);Xa=ua.kk;pb.j.width=Xa;pb.j.height=Xa;var Sa=B("DEPTH","u_grass_map_depth",Xa,1,!1);Sa.ca=T.s;Sa.ba=T.s;var sb=B("COLOR","u_grass_map_color",Xa,1,!1);sb.ca=T.s;sb.ba=T.s}else sb=Sa=pb=null;for(var Ja=[],kb=[],nc=[],Kb=[],X=0;X<ra.length;X++){var ya=ra[X],ab={};pa.push(B("DEPTH","DEPTH",1,1,!0));if(Ma){var Lb=c(ya);b.I.push(Lb);ab=O(Lb,Va);nc.push(ab);P.u(e,ab);if(zb){for(va=0;va<Y.length;va++)Rb=Y[va],P.m(e,Rb,ab,lc[va]);var Hc=B("COLOR","u_color",1,1,!0),Mb=
B("DEPTH","u_depth",1,1,!0);if(Ha){var Ic=c(ya);b.I.push(Ic);var Wa=a.IB,eb=A(Ic,Ra,Wa);P.u(e,eb);var qb=B("COLOR","u_ssao_mask",1,1,!0);P.m(e,ab,eb,Hc);P.m(e,ab,eb,Mb);var Sb=c(ya);b.I.push(Sb);var fb=I(Sb,Wa);P.u(e,fb);var Tb=B("COLOR","u_shadow_mask",1,1,!0);P.m(e,eb,fb,qb);P.m(e,ab,fb,Mb)}}else La.Lp()&&ab.ha.push(B("COLOR","COLOR",1,1,!0));pb&&(P.m(e,pb,ab,Sa),P.m(e,pb,ab,sb))}Aa=G("OPAQUE",ya,!Ma,Ub,ca,Ra,db,null,a.Hg);P.u(e,Aa);l.push(Aa);kb.push(Aa);Ma&&(P.m(e,ab,Aa,pa[X]),qb?P.m(e,fb,Aa,
Tb):zb&&P.m(e,ab,Aa,B("COLOR","u_shadow_mask",1,1,!0)));var Hb=B("COLOR","u_color",1,1,!0);r.push(B("COLOR","COLOR",1,1,!0));pb&&(P.m(e,pb,Aa,Sa),P.m(e,pb,Aa,sb));if(qa.length)for(var oc=qa.length/ra.length,va=0;va<oc;va++){var sa=oc*X+va;P.m(e,qa[sa],Aa,z[sa])}if(na.length)for(va=0;va<na.length;va++)P.m(e,na[va],Aa,ia[va])}m=l;l=[];if(!za&&a.Dw){ya=c(m[0].j);b.I.push(ya);var gb=D(ya,!1);P.u(e,gb);if(a.Fe){ya=c(m[0].j);b.I.push(ya);var rb=D(ya,!0);P.u(e,rb);P.m(e,gb,rb,B("COLOR","COLOR",1,1,!0));
P.m(e,gb,rb,B("DEPTH","DEPTH",1,1,!0))}}else gb=null;if(Vb.gc&&!za)for(X=0;X<ra.length;X++){var ac=W();P.u(e,ac);P.m(e,m[X],ac,Hb);ta.push(ac);p.push(B("COLOR","u_refractmap",1,1,!0))}if(a.Wm){for(X=0;X<ra.length;X++)Aa=x("BLEND",X),Ja.push(Aa);m=l;l=[]}if(a.We){for(X=0;X<ra.length;X++){var Ga=c(ra[X]);b.I.push(Ga);var xc=G("GLOW",Ga,!1,Ub,ca,Ra,db);P.u(e,xc);P.m(e,kb[X],xc,pa[X]);var Nb=k("X_GLOW_BLUR");Nb.La="GLOW_MASK_SMALL";Nb.Ce=a.Xe.small_glow_mask_width;var hb=B("COLOR","u_color",1,1,!0);hb.ca=
T.s;hb.ba=T.s;P.u(e,Nb);P.m(e,xc,Nb,hb);var lb=k("Y_GLOW_BLUR");lb.La="GLOW_MASK_SMALL";lb.Ce=a.Xe.small_glow_mask_width;var tc=B("COLOR","u_color",1,.5,!0);tc.ca=T.s;tc.ba=T.s;P.u(e,lb);P.m(e,Nb,lb,tc);var Ab=k("X_GLOW_BLUR");Ab.La="GLOW_MASK_LARGE";Ab.Ce=a.Xe.large_glow_mask_width;var hc=B("COLOR","u_color",1,.5,!0);hc.ca=T.s;hc.ba=T.s;P.u(e,Ab);P.m(e,lb,Ab,hc);var tb=k("Y_GLOW_BLUR");tb.La="GLOW_MASK_LARGE";tb.Ce=a.Xe.large_glow_mask_width;var mb=B("COLOR","u_color",1,.25,!0);mb.ca=T.s;mb.ba=T.s;
P.u(e,tb);P.m(e,Ab,tb,mb);var Bb=c(ra[X]);b.I.push(Bb);var pc=J(Bb,a);P.u(e,pc);a.Wm?P.m(e,Ja[X],pc,B("COLOR","u_src_color",1,1,!0)):P.m(e,kb[X],pc,B("COLOR","u_src_color",1,1,!0));var ub=B("COLOR","u_glow_mask_small",1,.5,!0);ub.ca=T.s;ub.ba=T.s;P.m(e,lb,pc,ub);var bc=B("COLOR","u_glow_mask_large",1,.25,!0);bc.ca=T.s;bc.ba=T.s;P.m(e,tb,pc,bc);n.push(pc)}m=n;l=[]}if(!a.Wm){for(X=0;X<ra.length;X++)Aa=x("BLEND",X),Ja.push(Aa);m=l;l=[]}if(a.Fe){for(X=0;X<ra.length;X++){var wb=x("XRAY",X);Kb.push(wb)}m=
l;l=[]}if(ka.wireframe_debug){for(X=0;X<ra.length;X++){ya=c(ra[X]);b.I.push(ya);var cc=L(ya);l.push(cc);P.u(e,cc);P.m(e,m[X],cc,r[X]);P.m(e,m[X],cc,pa[X]);pb&&(P.m(e,pb,cc,Sa),P.m(e,pb,cc,sb))}m=l;l=[]}if(!za&&a.qv){ya=c(ra[0]);b.I.push(ya);var Cb=K(ya);P.u(e,Cb);P.m(e,m[0],Cb,pa[0])}if(Wb&&Ma&&!za){for(X=0;X<ra.length;X++){var Ob=Da.th,yc=Da.kz,Db=Da.Oh,Ea=m[X],Sc=Ub?1:0,zc=B("DEPTH","u_input",1,1,!0);zc.ca=T.s;zc.ba=T.s;var Pb=B("COLOR","u_input",1,.25,!0);Pb.ca=T.s;Pb.ba=T.s;var qc=Ob/Db,Jc=c(ra[X]);
b.I.push(Jc);var Ka=ha(Jc,Sc,Ob,!0,qc,ca,Db);P.u(e,Ka);P.m(e,Ea,Ka,zc);var qc=Ob/Db*.5,Ya=c(ra[X]);b.I.push(Ya);var Ac=ha(Ya,Sc,Ob,!1,qc,ca,Db);P.u(e,Ac);P.m(e,Ka,Ac,Pb);var qc=Ob/Db*.25,kd=c(ra[X]);b.I.push(kd);var ic=ha(kd,Sc,Ob,!1,qc,ca,Db);P.u(e,ic);P.m(e,Ac,ic,Pb);var Vc=S(yc,ca);l.push(Vc);P.u(e,Vc);P.m(e,Ea,Vc,B("COLOR","u_main",1,1,!0));P.m(e,ic,Vc,B("COLOR","u_god_rays",1,1,!0))}m=l;l=[]}if(Rc&&!za){for(X=0;X<ra.length;X++){var Ea=m[X],$c=aa();P.u(e,$c);P.m(e,Ea,$c,B("COLOR","u_input",1,
1,!0));var Qb=ea();P.u(e,Qb);Qb.j.width=1;Qb.j.height=1;var ld=B("COLOR","u_input",1,.25,!0);ld.ca=T.s;ld.ba=T.s;var md=B("COLOR","u_luminance",1,.25,!0);md.ca=T.s;md.ba=T.s;P.m(e,$c,Qb,ld);var sd=ob.key,td=ob.Ix,xb=c(ra[X]);b.I.push(xb);var Kc=ba(sd,td,ca,xb);P.u(e,Kc);P.m(e,Ea,Kc,B("COLOR","u_main",1,1,!0));P.m(e,$c,Kc,md);P.m(e,Qb,Kc,B("COLOR","u_average_lum",1,1,!1));var uc=B("COLOR","u_color",1,.25,!0);uc.ca=T.s;uc.ba=T.s;Nb=q("X_BLUR");P.u(e,Nb);P.m(e,Kc,Nb,uc);lb=q("Y_BLUR");P.u(e,lb);P.m(e,
Nb,lb,uc);var Wc=F(ob.blur);P.u(e,Wc);var nd=B("COLOR","u_bloom",1,.25,!0);nd.ca=T.s;nd.ba=T.s;P.m(e,lb,Wc,nd);P.m(e,Ea,Wc,B("COLOR","u_main",1,1,!0));l.push(Wc)}m=l;l=[]}if(Gc&&!za){for(X=0;X<m.length;X++){var ud=m[X],fd=V(Yb.mb_decay_threshold,Yb.mb_factor);l.push(fd);P.u(e,fd);P.m(e,ud,fd,B("COLOR","u_mb_tex_curr",1,1,!0));fd.ha.push(B("COLOR","u_mb_tex_accum",1,1,!0))}m=l;l=[]}if(Na&&Ma&&!za){for(X=0;X<m.length;X++){var Ea=m[X],Lc=c(ra[X]);b.I.push(Lc);uc=B("COLOR","u_color",1,1,!0);uc.ca=T.s;
uc.ba=T.s;var Mc=k("X_BLUR");P.u(e,Mc);P.m(e,Ea,Mc,uc);var Nc=k("Y_BLUR");P.u(e,Nc);P.m(e,Mc,Nc,uc);var ab=Ja[X],Oc=R(Lc);Lc.dof_distance=b.dof_distance;Lc.fe=b.fe;Lc.dof_front=b.dof_front;Lc.dof_rear=b.dof_rear;Lc.dof_power=b.dof_power;Lc.dof_on=1;l.push(Oc);P.u(e,Oc);P.m(e,Ea,Oc,B("COLOR","u_sharp",1,1,!0));P.m(e,Nc,Oc,B("COLOR","u_blurred",1,1,!0));P.m(e,ab,Oc,B("DEPTH","u_depth",1,1,!0))}m=l;l=[]}if(!za&&a.outline){for(X=0;X<ra.length;X++){var Ea=m[X],od=c(ra[X]);b.I.push(od);var Xc=Z(od);P.u(e,
Xc);var Bc=k("X_EXTEND"),ad=B("COLOR","u_color",1,1,!0),jc=B("COLOR","u_outline_mask",1,1,!0);Bc.Mi=!0;P.u(e,Bc);P.m(e,Xc,Bc,ad);var Tc=B("COLOR","u_color",1,.5,!0);Tc.ca=T.s;Tc.ba=T.s;var bd=k("Y_EXTEND");bd.Mi=!0;P.u(e,bd);P.m(e,Bc,bd,Tc);Mc=k("X_BLUR");Mc.Mi=!0;P.u(e,Mc);P.m(e,bd,Mc,Tc);var rc=B("COLOR","u_color",1,.25,!0);rc.ca=T.s;rc.ba=T.s;var pd=B("COLOR","u_outline_mask_blurred",1,.25,!0);pd.ca=T.s;pd.ba=T.s;Nc=k("Y_BLUR");Nc.Mi=!0;P.u(e,Nc);P.m(e,Mc,Nc,rc);var Pc=fa(jb);P.u(e,Pc);P.m(e,Ea,
Pc,B("COLOR","u_outline_src",1,1,!0));P.m(e,Xc,Pc,jc);P.m(e,Nc,Pc,pd);l.push(Pc)}m=l;l=[]}if(wa&&!za){for(X=0;X<m.length;X++){var Ea=m[X],Cc=M(Ta.brightness,Ta.contrast,Ta.exposure,Ta.saturation);P.u(e,Cc);P.m(e,Ea,Cc,B("COLOR","u_color",1,1,!0));l.push(Cc)}m=l;l=[]}if(Ia){for(X=0;X<m.length;X++)if(Ea=m[X],ka.smaa){var vc=B("COLOR","u_color",1,1,!0);vc.ca=T.s;vc.ba=T.s;var gd=Q("SMAA_EDGE_DETECTION");P.u(e,gd);P.m(e,Ea,gd,vc);var ja=Q("SMAA_BLENDING_WEIGHT_CALCULATION");P.u(e,ja);P.m(e,gd,ja,vc);
var bb=B("COLOR","u_search_tex",1,1,!1),qd=B("COLOR","u_area_tex",1,1,!1);bb.ca=T.s;bb.ba=T.s;qd.ca=T.s;qd.ba=T.s;ja.ha.push(bb);ja.ha.push(qd);var Dc=Q("SMAA_NEIGHBORHOOD_BLENDING");P.u(e,Dc);P.m(e,Ea,Dc,vc);var Oa=B("COLOR","u_blend",1,1,!0);Oa.ca=T.s;Oa.ba=T.s;P.m(e,ja,Dc,Oa);l.push(Dc)}else{var ib=C();P.u(e,ib);var hd=B("COLOR","u_color",1,1,!0);hd.ca=T.s;hd.ba=T.s;P.m(e,Ea,ib,hd);if(1<ka.render_resolution_factor){var yb=k("NONE");P.u(e,yb);P.m(e,ib,yb,hd);l.push(yb)}else l.push(ib)}m=l;l=[]}if(a.anaglyph_use&&
!za){var Uc=ga();P.u(e,Uc);P.m(e,m[0],Uc,B("COLOR","u_sampler_left",1,1,!0));P.m(e,m[1],Uc,B("COLOR","u_sampler_right",1,1,!0));l.push(Uc)}else l.push(m[0]);var Yc=P.rg(e,m[0]);if("MOTION_BLUR"==m[0].type)var Zc=!0;else Zc=!1,P.De(e,Yc,function(a,b,c){if(c.P==c.qa)return Zc=!0});if(Zc){var kc=da();P.u(e,kc);P.m(e,m[0],kc,B("COLOR","u_color",1,1,!0));m=l;l=[];l.push(kc)}gb&&(rb?l.push(rb):l.push(gb));Cb&&l.push(Cb);if(!za&&a.dl.procedural_skydome){var cd=oa(ca,a.dl);P.u(e,cd);l.push(cd)}var dc=U();
P.u(e,dc);for(X=0;X<l.length;X++){var dd=l[X];switch(dd.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":P.m(e,dd,dc,B("COLOR","NONE",1,1,!0));P.m(e,dd,dc,B("DEPTH","NONE",1,1,!0));break;case "SKY":P.m(e,dd,dc,B("CUBEMAP","u_sky",ua.$j,1,!1));break;case "ANCHOR_VISIBILITY":P.m(e,dd,dc,B("COLOR","NONE",1,1,!0));break;default:if(za){var rd=f[0].e,ec=B("COLOR","OFFSCREEN",1,1,!0);ec.va=rd;P.m(e,l[X],dc,ec);for(va=1;va<f.length;va++){var ed=f[va].e,kc=da();P.u(e,kc);P.m(e,l[X],kc,B("COLOR","u_color",
1,1,!0));ec=B("COLOR","OFFSCREEN",1,ed.Fg/rd.Fg,!0);ec.va=ed;P.m(e,kc,dc,ec)}}else P.m(e,l[X],dc,B("SCREEN","NONE",1,1,!0))}}if(vb.enabled){var vd=E(e);vd&&y(e,vd)}d(e,Ma);1<ka.render_resolution_factor&&g(e);h(e);w(e);if(zb){for(X=0;X<nc.length;X++)t(e,nc[X]);for(X=0;X<Ja.length;X++)t(e,Ja[X]);for(X=0;X<Kb.length;X++)t(e,Kb[X])}return e};a.IE=v;a.Ec=function(a,b,c){var d=a.Ce;a.xo[0]=b*a.Ma[0]*d;a.xo[1]=c*a.Ma[1]*d};a.Ob=function(a,b){a.Ce=b};a.fE=function(a){var b=null;P.S(a,function(a,c){return c.j&&
null===c.j.je?(b=c,!0):!1});return b};a.Ha=function(a,b,c){a=ia(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.AE=Y;a.CE=na;a.Ky=ia;a.vE=ca;a.Ia=function(a,b){var c=null;P.S(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.tx=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=qa(a);P.S(a,function(a,d){var f=b+="    ",e="",e=d.type.replace(/_/g,
" ");"POSTPROCESSING"==d.type&&(e+=" ("+d.Qk.replace(/_/g," ")+")");if(d.j){for(var e=e+"\\n",g=0;g<c.length;g+=2)c[g]==d.j.ib&&(e+="C"+c[g+1]+" ");for(g=0;g<c.length;g+=2)c[g]==d.j.Qc&&(e+="D"+c[g+1])}d.ha.length&&(e+="\\n-----\\n");for(g=0;g<d.ha.length;g++)e+=x(d.ha[g],c);g="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=f+(String(a)+' [label="'+e+'" color="black" style="'+(g+",bold")+'"];\n')});P.Jd(a,function(a,d,f){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+x(f,c)+'" style="'+
(f.Ra?"solid":"dotted")+'"];\n'});return b+="}"};a.ex=function(a){a=P.YB(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,p){function c(){return{name:"",type:0,source:"",jo:"",width:0,height:0,im:1,Hj:!0,Fg:1024,rq:!1,Yd:null,Qa:null,Eh:null,Ks:1,we:0,Fh:!1,pl:!1,hg:!1,K:0,na:0,gh:0,CC:!1,Jg:!1,Fn:0,ac:0,Pb:0,$a:null,zf:null}}function d(d,f,e,g){var k=d.type,h=new Uint8Array([204,204,204,255]),m=c();switch(k){case "DATA_TEX2D":case "IMAGE":var l=q.createTexture(),n=q.TEXTURE_2D;q.bindTexture(n,l);q.texImage2D(n,0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,h);d.image&&"MOVIE"==d.image.source&&
(m.hg=!0,m.K=d.frame_start,m.na=d.frame_offset,m.gh=d.frame_duration,m.CC=d.use_auto_refresh,m.Jg=d.use_cyclic,m.Fn=d.movie_length,0!=m.na&&w.warn('Frame offset for texture "'+d.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":l=q.createTexture();n=q.TEXTURE_2D;q.bindTexture(n,l);if("NONE"==d.b4w_source_type)return null;if("SCENE"==d.b4w_source_type)if(d.b4w_source_id&&(e=H.keysearch("name",d.b4w_source_id,e)))m.Fg=d.b4w_source_size,e.qd=e.qd||
[],e.qd.push(d),q.texImage2D(n,0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,h);else return null;break;case "ENVIRONMENT_MAP":l=q.createTexture();n=q.TEXTURE_CUBE_MAP;q.bindTexture(n,l);e="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var t=0;6>t;t++)v.hn?q.texImage2D(q["TEXTURE_CUBE_MAP_"+e[t]],0,q.RGB,1,1,0,q.RGB,q.UNSIGNED_BYTE,h):q.texImage2D(q["TEXTURE_CUBE_MAP_"+e[t]],0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,h);break;case "BLEND":return null;default:return w.error('texture "'+
d.name+'" has unsupported type "'+k+'"'),null}"NONE"==k&&(!d.b4w_enable_canvas_mipmapping||"CANVAS"!=d.b4w_source_type)||"DATA_TEX2D"==k||"IMAGE"==k&&"MOVIE"==d.image.source?q.texParameteri(n,q.TEXTURE_MIN_FILTER,q.LINEAR):v.hn&&"ENVIRONMENT_MAP"==k?q.texParameteri(n,q.TEXTURE_MIN_FILTER,q.LINEAR):q.texParameteri(n,q.TEXTURE_MIN_FILTER,J[v.gl]);q.texParameteri(n,q.TEXTURE_MAG_FILTER,q.LINEAR);h=n;e=d.b4w_anisotropic_filtering;"DEFAULT"===e&&(e=f);"OFF"!==e&&v.Ij&&(f=y.wy())&&(e=parseFloat(e.split("x")[0]),
q.texParameterf(h,f.TEXTURE_MAX_ANISOTROPY_EXT,e));"REPEAT"!=d.extension||d.b4w_shore_dist_map?(q.texParameteri(n,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(n,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE)):(q.texParameteri(n,q.TEXTURE_WRAP_S,q.REPEAT),q.texParameteri(n,q.TEXTURE_WRAP_T,q.REPEAT));m.type=a.Qg;m.width=1;m.height=1;m.$a=l;m.Pb=n;"CANVAS"==d.b4w_source_type&&"NONE"==k?(k=d.b4w_source_id,l=d.b4w_source_size,m.rq=d.b4w_enable_canvas_mipmapping,m.jo=k,m.source="CANVAS",n=document.createElement("canvas"),
n.width=l,n.height=l,m.Yd=n.getContext("2d"),g in u||(u[g]={}),u[g][k]=m,b(m)):"SCENE"==d.b4w_source_type&&"NONE"==k?(m.jo=d.b4w_source_id,m.source="SCENE"):(m.source=k,q.generateMipmap(n),q.bindTexture(n,null));m.name=d.name;return d.e=m}function b(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Pb;q.bindTexture(b,a.$a);var c=l(a),d=n(a),f=a.Yd.canvas;q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!0);q.texImage2D(b,0,c,c,d,f);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!1);a.rq&&q.generateMipmap(b);q.bindTexture(b,
null);a.width=f.width;a.height=f.height}function e(a){var b=a.Pb;q.bindTexture(b,a.$a);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!0);q.texImage2D(b,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,a.Eh[a.we]);q.bindTexture(b,null)}function h(a){q.texParameteri(a,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(a,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);q.texParameteri(a,q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(a,q.TEXTURE_MIN_FILTER,q.LINEAR)}function g(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];
return-1==c.indexOf(a)||-1==c.indexOf(b)}function l(b){switch(b.type){case a.Qg:b=q.RGBA;break;case a.wl:b=q.RGB;break;case a.Bj:b=q.RGBA;break;case a.Cj:b=q.RGB;break;case a.di:b=q.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function n(b){switch(b.type){case a.Qg:b=q.UNSIGNED_BYTE;break;case a.wl:b=q.UNSIGNED_BYTE;break;case a.Bj:b=q.FLOAT;break;case a.Cj:b=q.FLOAT;break;case a.di:b=q.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function f(a,b){return b in
k&&a in k[b]?(v.Wc?k[b][a].Fh=!0:k[b][a].Qa.play(),!0):null}function m(a,b){if(b in k&&a in k[b]){var c=k[b][a];v.Wc?(c.we=c.na,e(c),c.we++):c.Qa.currentTime=c.na/c.ac;return!0}return null}function r(a,b){return b in k&&a in k[b]?(v.Wc?k[b][a].Fh=!1:k[b][a].Qa.pause(),!0):null}var z=p("__config"),w=p("__print"),E=p("__dds"),y=p("__extensions"),H=p("__util"),v=z.p,B=z.Ud,t=z.kd;a.lc=0;a.s=0;a.gv=0;a.ev=0;a.fv=0;a.dv=0;a.Qg=10;a.wl=20;a.Bj=30;a.Cj=40;a.di=50;a.Pg=60;var u={},k={},q=null,J;a.jd=function(b){J=
[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.lc=b.NEAREST;a.s=b.LINEAR;a.gv=b.NEAREST_MIPMAP_NEAREST;a.ev=b.LINEAR_MIPMAP_NEAREST;a.fv=b.NEAREST_MIPMAP_LINEAR;a.dv=b.LINEAR_MIPMAP_LINEAR;q=b};a.Ay=function(a,b){return b in u&&a in u[b]?u[b][a].Yd:null};a.nC=function(a,c){return c in u&&a in u[c]?(b(u[c][a]),!0):!1};a.Yj=function(b,d){var f=c();f.name=b;f.type=d;f.source="NONE";if(d==a.Pg)f.zf=q.createRenderbuffer();else{var e=q.TEXTURE_2D,g=q.createTexture();
q.bindTexture(e,g);q.texParameteri(e,q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(e,q.TEXTURE_MIN_FILTER,q.LINEAR);q.texParameteri(e,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(e,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);q.bindTexture(e,null);f.Pb=e;f.$a=g}return f};a.Sw=function(b){var d=q.createTexture(),f=q.TEXTURE_CUBE_MAP;q.bindTexture(f,d);q.texParameteri(f,q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(f,q.TEXTURE_MIN_FILTER,q.LINEAR);q.texParameteri(f,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(f,
q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);for(var e="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),g=0;6>g;g++)q.texImage2D(q[e[g]],0,q.RGBA,b,b,0,q.RGBA,q.UNSIGNED_BYTE,null);q.bindTexture(f,null);f=c();f.name="CUBEMAP";f.type=a.Qg;f.source="NONE";f.width=3*b;f.height=2*b;f.im=1;f.$a=d;f.Pb=q.TEXTURE_CUBE_MAP;return f};a.ij=function(b,c,d){if(b.type!=a.Pg){var f=b.Pb;q.bindTexture(f,
b.$a);c&&q.texParameteri(f,q.TEXTURE_MIN_FILTER,c);d&&q.texParameteri(f,q.TEXTURE_MAG_FILTER,d);q.bindTexture(f,null)}};a.uE=function(b){if(b.type==a.Pg)return{min:a.lc,Gz:a.lc};var c=b.Pb;q.bindTexture(c,b.$a);b=q.getTexParameter(c,q.TEXTURE_MIN_FILTER);var d=q.getTexParameter(c,q.TEXTURE_MAG_FILTER);q.bindTexture(c,null);return{min:b,Gz:d}};a.resize=function(b,c,d){c=Math.max(c,1);d=Math.max(d,1);if(b.width!=c||b.height!=d){if(b.type==a.Pg)q.bindRenderbuffer(q.RENDERBUFFER,b.zf),q.renderbufferStorage(q.RENDERBUFFER,
q.DEPTH_COMPONENT16,c,d),q.bindRenderbuffer(q.RENDERBUFFER,null);else{var f=b.Pb;q.bindTexture(f,b.$a);var e=l(b),g=n(b);q.texImage2D(f,0,e,c,d,0,e,g,null);q.bindTexture(f,null)}c>v.Lb||d>v.Lb?w.error('Slink texture "'+b.name+'" has unsupported size: '+c+"x"+d+". Max available: "+v.Lb+"x"+v.Lb+"."):(b.width=c,b.height=d)}};a.lx=d;a.zC=function(a){var b=a.Pb;q.bindTexture(b,a.$a);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!0);4!=a.Qa.length?q.texImage2D(b,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,a.Qa):q.texImage2D(b,
0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,a.Qa);q.bindTexture(b,null)};a.wC=e;a.oj=function(a,b,c,d,f){var e=a.source,m=a.Pb;q.bindTexture(m,a.$a);if(4==b.length){var l=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==e)if(l)q.texImage2D(m,0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){c=E.Yq(b);if(c.width>v.Lb||c.height>v.Lb){w.error('Texture "'+d+'" has unsupported size: '+c.width+"x"+c.height+". Max available: "+v.Lb+"x"+v.Lb+".");return}E.BC(q,y.Vq(),
b,!0);g(c.width,c.height)&&(a.vp||w.warn("using NPOT texture",d),h(m));a.width=c.width;a.height=c.height;a.im=E.Cy(b)}else{q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!0);if(b.width>v.Lb||b.height>v.Lb){w.error('Texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+v.Lb+"x"+v.Lb+".");return}a.hg?v.Wc?b&&(f in k||(k[f]={}),k[f][a.name]=a,a.Eh=b,a.ac=a.Fn/b.length,a.gh=Math.round(a.gh/a.ac),a.na=Math.round(a.na/a.ac),a.K=Math.round(a.K/a.ac),a.we=a.na,q.texImage2D(m,0,q.RGBA,q.RGBA,
q.UNSIGNED_BYTE,a.Eh[0])):(a.Qa=b,a.Qa.loop=a.Jg,b&&(f in k||(k[f]={}),k[f][a.name]=a),a.ac=B.Ja,b.duration&&(a.ac=a.Fn/b.duration),t.oq||(b.playbackRate=B.Ja/a.ac,t.Pp&&2<b.playbackRate&&(b.playbackRate=2)),q.texImage2D(m,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,a.Qa)):q.texImage2D(m,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,b);a.hg?v.Wc?(a.width=b[0].width,a.height=b[0].height):(a.width=b.videoWidth,a.height=b.videoHeight):(a.width=b.width,a.height=b.height);g(a.width,a.height)?(a.vp||(a.hg?w.warn("using NPOT video texture",
d):w.warn("using NPOT texture",d)),h(m)):a.hg||q.generateMipmap(m)}else if("ENVIRONMENT_MAP"==e)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],l){for(l=0;6>l;l++)f=c[l],q.texImage2D(q["TEXTURE_CUBE_MAP_"+f[0]],0,q.RGBA,1,1,0,q.RGBA,q.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!1);e=b.width/3;if(e>v.qg||e>v.qg){w.warn('Cubemap texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+
3*v.qg+"x"+2*v.qg+". Reduced image size will be used.");var n=b.width/3*(v.qg/e)}else n=e;for(l=0;6>l;l++){f=c[l];var r=document.createElement("canvas");r.width=n;r.height=n;var u=r.getContext("2d");"POSITIVE_Y"==f[0]||"NEGATIVE_Y"==f[0]?(u.translate(0,n),u.scale(1,-1)):(u.translate(n,0),u.scale(-1,1));u.drawImage(b,f[1]*e,f[2]*e,e,e,0,0,n,n);q.texImage2D(q["TEXTURE_CUBE_MAP_"+f[0]],0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,r)}a.width=3*n;a.height=2*n;g(b.width/3,b.height/2)?(w.warn("using NPOT cube map texture",
d),h(m)):q.generateMipmap(m)}else"DATA_TEX2D"==e&&(q.texImage2D(m,0,q.RGBA,b.width,b.height,0,q.RGBA,q.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);q.bindTexture(m,null)};a.Bx=function(a){q.deleteTexture(a)};a.Oi=function(a){return a&&a.name&&(a.$a||a.zf)?!0:!1};a.ur=function(a){return a&&a.name&&a.zf?!0:!1};a.NE=function(b){return b.type==a.Bj||b.type==a.Cj?!0:!1};a.Sy=function(b){var c=0;switch(b.type){case a.Qg:case a.wl:c=4;break;case a.Bj:case a.Cj:c=16;break;case a.di:c=3;break;
case a.Pg:c=2}return c};a.sy=function(a){var b=null,b={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};d(b,null,a,0);b.image={filepath:null};return b};a.cleanup=function(){if(!v.Wc)for(var a in k)for(var b in k[a])k[a][b].Qa.pause(),k[a][b].Qa.src="",k[a][b].Qa.load();u={};k={}};a.play_video=f;a.reset_video=m;a.pause_video=r;a.pause=function(){for(var a in k)for(var b in k[a])v.Wc&&!k[a][b].Fh||!v.Wc&&k[a][b].Qa.paused||(r(b,a),k[a][b].pl=!0)};a.reset=
function(){for(var a in k)for(var b in k[a])m(b,a),k[a][b].pl=!1};a.play=function(a){for(var b in k)for(var c in k[b])if(!a||k[b][c].pl)f(c,b),k[b][c].pl=!1}};b4w.module.__assets=function(a,p){function c(){return E.mz()?p(E.Ub.Rj).data:null}function d(){var a={Ej:null,nv:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),f=0;f<c;f++)d[f]=b.charCodeAt(f);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.Ej=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=c();b&&a.Ej in b&&(a.status=200,b[a.Ej]&&(a.response=a.nv(b[a.Ej])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function b(b){for(var c=0,d=0;d<b.length;d++){var k=b[d];20===k.state&&c++;if(c>=u.Mz)break;if(10===k.state)switch(k.state=20,c++,k.type){case a.AT_ARRAYBUFFER:e(k,"arraybuffer");break;case a.AT_JSON:e(k,"json");break;case a.AT_TEXT:e(k,"text");break;case a.AT_AUDIOBUFFER:h(k);break;case a.AT_IMAGE_ELEMENT:g(k);
break;case a.AT_AUDIO_ELEMENT:l(k);break;case a.xj:n(k);break;case a.wj:f(k);break;default:v.ga("Wrong asset type: "+k.type)}}}function e(a,b){var f=c(),e=f&&a.r in f?new d:new XMLHttpRequest;e.open("GET",a.r,!0);"text"==b?(e.overrideMimeType("text/plain"),e.responseType="text"):"json"==b?(e.overrideMimeType("application/json"),e.responseType="text"):e.responseType=b;e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState){if(200==e.status||0==e.status){var c=e.response;if(c){if("json"==b&&
"string"==typeof c)try{c=JSON.parse(c)}catch(d){a.lb(null,a.uri,a.type,a.r,a.qb);y.error(d+" (parsing JSON "+a.r+")");return}a.lb(c,a.uri,a.type,a.r,a.qb)}else a.lb(null,a.uri,a.type,a.r,a.qb),y.error("empty responce when trying to get "+a.r)}else a.lb(null,a.uri,a.type,a.r,a.qb),y.error(e.status+" when trying to get "+a.r);a.state=30}};e.addEventListener("progress",function(b){b.lengthComputable&&a.vs(b.loaded/b.total)},!1);e.send(null)}function h(a){var b=c(),f=b&&a.r in b?new d:new XMLHttpRequest;
f.open("GET",a.r,!0);f.responseType="arraybuffer";f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState)if(200==f.status||0==f.status){var b=f.response;b?H.wx(b,function(b){a.lb(b,a.uri,a.type,a.r,a.qb);a.state=30},function(){a.lb(null,a.uri,a.type,a.r,a.qb);y.error("failed to decode "+a.r);a.state=30}):(a.lb(null,a.uri,a.type,a.r,a.qb),y.error("empty responce when trying to get "+a.r),a.state=30)}else a.lb(null,a.uri,a.type,a.r,a.qb),y.error(f.status+" when trying to get "+a.r),a.state=
30};f.send(null)}function g(a){var b=document.createElement("img");k.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.lb(b,a.uri,a.type,a.r,a.qb),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.lb(null,a.uri,a.type,a.r,a.qb),y.error("could not load image: "+a.r),a.state=30)},!1);var d=c();if(d&&a.r in d)if(d[a.r]){var f=r(a.r);b.src="data:"+f+";base64,"+d[a.r]}else t.kn()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=
new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.r}function l(a){var b=document.createElement("audio");if(k.allow_cors||k.Zp)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.lb(b,a.uri,a.type,a.r,a.qb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.lb(null,a.uri,a.type,a.r,a.qb),y.error("could not load sound: "+a.r),a.state=30)},!1);var d=c();if(d&&a.r in d)if(d[a.r]){var f=z(a.r);b.src="data:"+f+";base64,"+d[a.r];40!=a.state&&(a.lb(b,
a.uri,a.type,a.r,a.qb),a.state=30)}else t.kn()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.r,k.gg&&b.load();k.En&&(b.autoplay=!0,b.pause());setTimeout(function(){b.uB=1},5E3)}function n(a){function b(){40!=a.state&&(a.lb(null,a.uri,a.type,a.r),y.error("could not load video: "+a.r,a.qb),a.state=30)}var d=document.createElement("video");d.muted=!0;if(k.allow_cors||k.gg)d.crossOrigin="Anonymous";d.addEventListener("loadeddata",
function(){d.removeEventListener("error",b,!1);40!=a.state&&(a.lb(d,a.uri,a.type,a.r,a.qb),a.state=30)},!1);d.addEventListener("error",b,!1);var f=c();if(f&&a.r in f)if(f[a.r]){var e=w(a.r);d.src="data:"+e+";base64,"+f[a.r];40!=a.state&&d.addEventListener("loadeddata",function(){a.lb(d,a.uri,a.type,a.r,a.qb);a.state=30},!1)}else t.kn()?(f=document.createEvent("CustomEvent"),f.initCustomEvent("error",!1,!1,null)):f=new CustomEvent("error"),d.dispatchEvent(f);else d.src=a.r,k.gg&&d.load();k.En&&(d.autoplay=
!0,d.pause());setTimeout(function(){d.uB=1},1E4)}function f(a){function b(c){a.lb(c,a.uri,a.type,a.r,a.qb)}var f=c(),e=f&&a.r in f?new d:new XMLHttpRequest;e.open("GET",a.r,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState){if(200==e.status||0==e.status){var c=e.response;c?m(c,b):(a.lb(null,a.uri,a.type,a.r,a.qb),y.error("empty responce when trying to get "+a.r))}else a.lb(null,a.uri,a.type,a.r,a.qb),y.error(e.status+" when trying to get "+a.r);a.state=
30}};e.addEventListener("progress",function(b){b.lengthComputable&&a.vs(b.loaded/b.total)},!1);e.send(null)}function m(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),f=c[3],e={images:[],zp:[],ac:c[4]},g=20,k=0;k<f;k++){var h=c[g/4],m=new Blob([d.subarray(g+4,g+4+h)],{type:"image/jpg"}),l=document.createElement("img");l.src=window.URL.createObjectURL(m);e.images.push(l);e.zp.push(m);g+=h+8-h%4}l.onload=function(){for(var a=0;a<e.images.length;a++)window.URL.revokeObjectURL(e.images[a].src);delete e.zp;
b(e)}}function r(a){var b="image";switch(v.Sm(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function z(a){var b="audio";switch(v.Sm(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function w(a){var b="video";switch(v.Sm(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var E=p("__config"),y=p("__print"),
H=p("__sfx"),v=p("__util"),B=p("__version"),t=p("__compat"),u=E.Vd,k=E.p;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.xj=70;a.wj=80;var q=[],J=0,G={};a.kj=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.xE=function(a){if(G[a])return G[a];var b=u.ts?a+B.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==
c.status){b=c.responseText;if(b.length)return G[a]=b;v.ga("Error XHR: responce is empty, GET "+a)}else v.ga("Error XHR: "+c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<q.length;a++)q[a].state=40;q=[];J=0;G={}};a.enqueue=function(a,d,f,e){for(var g=0;g<a.length;g++){var k=a[g],k={uri:k[0],type:k[1],r:k[2],qb:k[3],state:10,lb:d||function(){},ms:f||function(){},vs:e||function(){},ns:J};if(u.ts){var h=c();h&&k.r in h||(k.r+=B.timestamp())}q.push(k)}b(q);J++};a.update=function(){b(q);for(var a=
q,c=0,d=!0,f=0;f<a.length;f++){var e=a[f];e.ns===a[c].ns?30!==e.state&&(d=!1):(d&&(a[f-1].ms(),d=f-c,a.splice(c,d),f-=d),c=f,d=30===a[f].state?!0:!1);f===a.length-1&&d&&(a[f].ms(),a.splice(c))}}};b4w.module.__loader=function(a,p){function c(b,c,f,e){var g=v,h=E.create(),m;for(m in c){var l=d(c[m]);(e&&l.eb||!b&&l.rb)&&r(l);E.u(h,l)}for(m in c)for(l=c[m],l.name=m,b=0;b<l.G.length;b++)E.m(h,c[l.G[b]],l,null);c=d({name:"out",Pa:a.St,cb:function(a,b,c,d,f){0===b.id&&(g.oo=!0);w(b)||(b.status=2);b.Gr(b.id,!0);f(b,c);y.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},fb:5});var n=[];if(f)for(f=E.Xq(h),b=0;b<f.length;b++)n.push(E.Va(h,f[b]));else E.S(h,function(a,b){b.bb||n.push(b)});E.u(h,
c);for(b=0;b<n.length;b++)c.G.push(n[b].name),E.m(h,n[b],c,null);return h}function d(a){a.bb=a.bb||!1;a.Pa||0===a.Pa||(a.Pa=a.pd);a.G=a.G||[];a.Li=a.Li||!1;a.eo=a.eo||!1;a.fb=a.fb||0;a.eb=a.eb||!1;a.rb=a.rb||!1;a.status=0;a.XE=0;a.vn=0;a.Pf=a.Pf||null;return a}function b(a,b){for(var c=[],d=[],f=0;f<b.length;f++){var e=b[f];E.Va(a.Fd,e).Li&&(E.wf(a.Fd,e,function(d){var f=!0;E.De(a.Fd,d,function(a,b){if(!b.Li)return f=!1,1});f&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(f))}for(f=d.length-
1;0<=f;f--)b.splice(d[f],1);return c}function e(a){function c(b,d){var f=E.Va(a.Fd,b),e=E.Va(a.Fd,d),g=e.Pa-f.Pa;0==g&&(g=f.bb-e.bb);return g}var d=[],f=a.Be,e=!1;do{var g=b(a,f);d.push.apply(d,f);0<g.length&&(e=!0);f=g}while(0<g.length);e&&d.sort(c);a.Be=d;return a.Be.length}function h(a,b,c){if(b.eo)return b.Li=!0,l(a,b),!1;if(!b.cb&&!b.Oe&&!b.mi)return l(a,b),!1;if(0==b.status&&(b.status++,b.cb))return b.cb(c,a,b,b.Pf,l,n),!0;if(1==b.status){if(b.Oe)return b.Oe(c,a,b,b.Pf,l,n),!0;b.status++}return 2==
b.status&&(b.status++,b.mi)?(b.mi(c,a,b,b.Pf,l,n),!0):!1}function g(a){if(0==a.el)return 100;var b=0;E.S(a.Fd,function(c,d){a.do_not_load_resources&&d.eb||(b+=d.vn*d.fb)});return H.trunc(100*b/a.el)}function l(a,b){b.Li=!0;b.status=3;f(a,b,1)}function n(a,b,c){1>c?f(a,b,c):b.status++}function f(a,b,c){var d=v;if(b.cb||b.Oe||b.mi)if(b.vn=c,b=g(a),a.hq!=b||1==c)a.no(b,performance.now()-a.qt),a.hq=b,d.yn=!0}function m(a,b){var c=null;E.S(a.Fd,function(a,d){if(d.name==b)return c=d,1});return c}function r(a){a.eo=
!0;a.vn=1}function z(a){a.no=null;a.hm=null;a.Fd=null;a.Be=null}function w(a){return a&&(3==a.status||4==a.status)}var E=p("__graph"),y=p("__print"),H=p("__util");a.pd=0;a.Od=1;a.St=2;var v=null;a.Wq=function(){return v};a.fx=function(){var a={Id:[],rm:0,Gj:0,oo:!1,yn:!1};return v=a};a.mx=function(a,b,d,f,e,g,h,m){var l=v,n={id:l.Id.length,status:0,r:b,xp:"",Gr:d||function(){},un:m||!1,zF:g,qt:0,hq:0,el:0,Zn:!1,no:f||function(){},hm:e||function(){},Fd:null,Be:null,cn:!1,bn:!1,fn:!1};a=c(0===n.id,
a,g,h);n.Fd=a;b=[];d=E.Qy(a);for(f=0;f<d.length;f++)b.push(d[f]);n.Be=b;E.S(a,function(a,b){!(b.cb||b.Oe||b.mi)||n.do_not_load_resources&&b.eb||(n.el+=b.fb)});l.Id.push(n);l.Gj++;return n.id};a.vC=function(b){var c=v;if(c&&0!=v.Gj)if(c.yn)c.yn=!1;else{var d=performance.now();do{var f=c.Id[c.rm],g=b[f.id];if(!w(f))if(0==f.status&&(f.status=1,f.qt=performance.now(),f.no(0,0)),e(f)){var m=f,l=m.Be.length;do{var n=E.Va(m.Fd,m.Be[0]),r=h(m,n,g);n.Pa==a.Od&&(m.Zn=!0);n=m.Be.shift();m.Be.push(n);l--}while(!r&&
0!=l)}else m=c,l=f,l.hm(g,l),l.status=3,m.Gj--,z(l);c.oo&&(c.rm=(c.rm+1)%c.Id.length);if(f.Zn){f.Zn=!1;break}}while(16>performance.now()-d)}};a.gp=function(a){var b=v;a.hm(null,a);a.status=3;b.Gj--;z(a);a.status=4;0===a.id&&(b.oo=!0);a.Gr(a.id,!1)};a.rF=n;a.Ts=function(a,b){var c=m(a,b);null!==c&&r(c)};a.XB=w;a.is_primary_loaded=function(a){var b=v;if(!b)return!1;a|=0;return b.Id[a]&&(3==b.Id[a].status||2==b.Id[a].status)};a.cleanup=function(){v=null}};b4w.module.__nla=function(a,p){function c(){return{type:"CLIP",K:0,X:0,ve:!1,paused:!1,Hf:"",ii:"",Jb:0,gi:0,fi:0,uq:0,tq:0,Ph:!1,Dt:!1,scale:1,repeat:1}}function d(a,b){if(a.animation_data){var c=a.animation_data.nla_tracks;if(c)for(var f=0;f<c.length;f++)b.push(c[f])}c=a.nodes;for(f=0;f<c.length;f++){var e=c[f];e.node_group&&(e=e.node_group.node_tree)&&d(e,b)}}function b(a,b){for(var c=a.b4w_nla_script,d=b.lf,f=0;f<c.length;f++){var e=c[f];switch(e.type){case "PLAY":d.push({type:"PLAY",K:e.frame_range[0],
X:e.frame_range[1],$e:!1});break;case "SELECT":case "SELECT_PLAY":var g=B.zd(B.Ef,e.object,0),k=B.Py(a),h=k.indexOf(g);if(-1==h){v.error("NLA script error: non-selectable object");return}for(var e={type:e.type,Ys:"SELECT"==e.type?e.target_slot:f+1,rB:f+1,mf:-1,QA:k.length,PA:h,K:e.frame_range[0],X:e.frame_range[1],$e:!1},h=[],m=0;m<k.length;m++)h.push(y.create_selection_sensor(k[m],!0));y.create_sensor_manifold(g,"NLA_SELECT_"+f,y.CT_SHOT,h,y.xx,function(a,c,d,f){if(!(b.Eb>=b.lf.length)&&(d=b.lf[b.Eb],
"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.$e)){for(d=0;d<f.QA;d++)if(y.get_sensor_value(a,c,d)&&d==f.PA){f.mf=1;return}f.mf=0}},e);d.push(e);break;case "JUMP":d.push({type:"JUMP",ho:e.target_slot});break;case "CONDJUMP":d.push({type:"CONDJUMP",ho:e.target_slot,Gw:e.condition,fj:e.register1,gj:e.register2,Jn:e.number1,Kn:e.number2});break;case "REGSTORE":d.push({type:"REGSTORE",vA:e.registerd,Zz:e.number1});break;case "MATH":d.push({type:"MATH",aA:e.operation,fj:e.register1,gj:e.register2,Jn:e.number1,
Kn:e.number2,Bh:e.registerd});break;case "SHOW":case "HIDE":g=B.zd(B.Ef,e.object,0);d.push({type:e.type,obj:g});break;case "REDIRECT":d.push({type:"REDIRECT",url:e.url});break;case "PAGEPARAM":d.push({type:"PAGEPARAM",cA:e.param_name,Bh:e.registerd});break;case "NOOP":d.push({type:"NOOP"})}}}function e(a,b,c,d){if(a.lf.length){if(a.Eb>=a.lf.length)if(a.cyclic)a.Eb=0;else{a.na-=J.Ja*c;return}var f=g(a,b,!1,d),k=a.lf[a.Eb];switch(k.type){case "PLAY":k.$e?f>=k.X&&(k.$e=!1,a.Eb++,e(a,b,c,d)):(a.na+=k.K-
f,k.$e=!0,h(a,k));break;case "SELECT":case "SELECT_PLAY":-1<k.mf?"SELECT"==k.type||"SELECT_PLAY"==k.type&&0==k.mf?(a.Eb=k.mf?k.Ys:k.rB,k.mf=-1,e(a,b,c,d)):k.$e?f>=k.X&&(k.$e=!1,a.Eb=k.Ys,k.mf=-1,e(a,b,c,d)):(a.na+=k.K-f,k.$e=!0,h(a,k)):a.na-=J.Ja*c;break;case "JUMP":a.Eb=k.ho;e(a,b,c,d);break;case "CONDJUMP":var f=-1==k.fj?k.Jn:a.Cd[k.fj],m=-1==k.gj?k.Kn:a.Cd[k.gj],l=!1;switch(k.Gw){case "EQUAL":f==m&&(l=!0);break;case "NOTEQUAL":f!=m&&(l=!0);break;case "LESS":f<m&&(l=!0);break;case "GREATER":f>m&&
(l=!0);break;case "LEQUAL":f<=m&&(l=!0);break;case "GEQUAL":f>=m&&(l=!0)}l?a.Eb=k.ho:a.Eb++;e(a,b,c,d);break;case "REGSTORE":a.Cd[k.vA]=k.Zz;a.Eb++;e(a,b,c,d);break;case "MATH":f=-1==k.fj?k.Jn:a.Cd[k.fj];m=-1==k.gj?k.Kn:a.Cd[k.gj];switch(k.aA){case "ADD":a.Cd[k.Bh]=f+m;break;case "MUL":a.Cd[k.Bh]=f*m;break;case "SUB":a.Cd[k.Bh]=f-m;break;case "DIV":0==m&&u.ga("Division by zero in NLA script"),a.Cd[k.Bh]=f/m}a.Eb++;e(a,b,c,d);break;case "SHOW":B.show_object(k.obj);a.Eb++;e(a,b,c,d);break;case "HIDE":B.hide_object(k.obj);
a.Eb++;e(a,b,c,d);break;case "REDIRECT":window.location.href=k.url;a.lf.length=0;break;case "PAGEPARAM":a:{f=location.href.toString();if(-1!=f.indexOf("?"))for(f=f.split("?")[1].split("&"),m=0;m<f.length;m++)if(l=f[m].split("="),1<l.length&&l[0]==k.cA){f=Number(l[1]);break a}f=0}a.Cd[k.Bh]=f;a.Eb++;e(a,b,c,d);break;case "NOOP":a.Eb++,e(a,b,c,d)}}}function h(a,b){for(var c=a.lf,d=0;d<c.length;d++){var f=c[d];f!=b&&(f.mf=-1)}}function g(a,b,c,d){b=(b-d)*J.Ja+a.na-a.K;a.cyclic&&c&&(b%=a.X-a.K+1);return b+=
a.K}function l(a,b){a=u.clamp(a,b.K,b.X);var c=a-b.K,d=(b.X-b.K)/b.repeat,c=c/d&&0==c%d?b.fi:b.gi+c%d/b.scale;b.Dt&&(c=b.fi-c+b.gi);return c}function n(a,b,c){b?q.pause_video(a.name,c):(q.reset_video(a.name,c),q.play_video(a.name,c))}function f(a,b){for(var d=[],f=0;f<a.length;f++){var e=a[f].strips;if(e)for(var g=0;g<e.length;g++){var k=e[g],h=c();h.type=k.type;h.K=k.frame_start;h.X=k.frame_end;h.Jb=b;h.gi=k.action_frame_start;h.fi=k.action_frame_end;h.Dt=k.use_reverse;h.scale=k.scale;h.repeat=k.repeat;
k.action&&(h.Hf=k.action.name,h.ii=k.action.uuid);d.push(h)}}return d}function m(a){return t.ne(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}function r(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c=c.use_nodes&&d)a:{if(d.animation_data&&(c=d.animation_data.nla_tracks)&&c.length){c=!0;break a}d=d.nodes;for(c=0;c<d.length;c++);c=!1}if(c)return!0}return!1}function z(a,b){var c=B.get_active();
c.ia&&(c.ia.na-=g(c.ia,b,!0,L)-a,c.ia.Mm=!0)}var w=p("__animation"),E=p("__camera"),y=p("__controls"),H=p("__config");p("__loader");var v=p("__print"),B=p("__scenes"),t=p("__sfx"),u=p("__util"),k=p("__lights"),q=p("__textures"),J=H.Ud,G=H.p,D=[],L=-1;a.uC=function(a,e,g){e={K:a.frame_start,X:a.frame_end,na:0,Pi:-1,Vk:a.frame_end,Vn:a.frame_start,Wh:null,sc:g,cyclic:e,te:[],M:[],lf:[],Ni:!1,Mm:!1,kF:a.name,Eb:0,Cd:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}};a.ia=e;b(a,e);for(var h=B.Ka(a,"ALL",B.DATA_ID_ALL),
l=0;l<h.length;l++){var n=h[l],q=0,r=[];if((g=n.animation_data)&&g.nla_tracks.length){var z=g.nla_tracks;if(u.is_armature(n)||E.is_camera(n)||u.is_mesh(n)||u.tk(n)||k.wk(n)||t.ne(n))z=f(z,q),z.length&&(r=r.concat(z),q++)}m(n)&&(z=n.data.animation_data.nla_tracks,z=f(z,q),z.length&&(r=r.concat(z),q++));if(w.az(n)){var p=n.data.materials;for(g=0;g<p.length;g++){var y=p[g].node_tree;if(y&&(z=[],d(y,z),z=f(z,q),z.length)){for(var y=q,J=z,L=w.Lq(),H=[],oa=0,da=0;da<J.length;da++){var ga=J[da];""!=ga.ii?
ga=u.keysearch("uuid",ga.ii,L):(ga=ga.Hf,ga=u.keysearch("name",ga,L)||u.keysearch("name",ga+"_B4W_BAKED",L));var ga=ga.fcurves,aa=[],ea;for(ea in ga)aa.push(ea);H.push(aa)}for(da=0;da<H.length;da++){L=!1;for(ga=0;ga<da;ga++)if(u.Ov(H[da],H[ga])){J[da].Jb=J[ga].Jb;L=!0;break}L||(J[da].Jb=q+oa++)}q=y+oa;r=r.concat(z)}}}for(g=0;g<n.particle_systems.length;g++)z=n.particle_systems[g],p=z.settings,"EMITTER"==p.type&&p.b4w_allow_nla&&(p=c(),p.type="CLIP",p.K=e.K,p.X=e.X+1,p.Hf=z.name,p.Jb=q,p.gi=p.K,p.fi=
p.X,r.push(p),q++);z=q+1;if(u.is_mesh(n)&&n.data)for(g=0;g<n.data.b4w_vertex_anim.length;g++)y=n.data.b4w_vertex_anim[g],y.allow_nla&&(q=z,p=c(),p.type="CLIP",p.K=e.K,p.X=e.X+1,p.Hf=y.name,p.Jb=q,p.gi=p.K,p.fi=p.X,r.push(p));r.length&&(n.xl=r,e.te.push(n))}a=a.e.Xh;for(g=0;g<a.length;g++)if(ea=a[g].e,ea.Qa||ea.Eh)p=c(),p.type="VIDEO",h=1,G.Wc&&(h=ea.ac),p.K=Math.min(ea.K*h,e.X),p.X=ea.Jg?e.X:Math.min((ea.gh+ea.K+ea.na)*h,e.X),p.Hf=a[g].name,ea.lv=p,e.M.push(ea);a=e.K;g=e.X;for(ea=0;ea<e.te.length;ea++)for(h=
e.te[ea],l=h.xl,n=0;n<l.length;n++)r=l[n],p=h.name+" ["+r.K+":"+r.X+"]",r.K=Math.max(a,r.K),r.X=Math.min(g+1,r.X),r.K>r.X?(v.warn("NLA: out of scene range: "+p),l.splice(n,1),n--):r.Hf||"CLIP"!=r.type||(v.warn('NLA: no action in strip for object "'+h.name+'".'),l.splice(n,1),n--);for(a=0;a<e.te.length;a++)for(g=e.te[a].xl,ea=0;ea<g.length;ea++){h=g[ea];l=e.K;n=e.X+1;for(r=0;r<g.length;r++)p=g[r],h.Jb==p.Jb&&(p.X<=h.K&&(l=h.K),p.K>=h.X&&(n=Math.min(n,p.K)));h.uq=l;h.tq=n}D.push(e)};a.start=function(){L=
0};a.update=function(a,b){if(!(0>L)){0==L&&(L=a);for(var c=0;c<D.length;c++){var d=D[c];if(d.Ni&&(d.na-=J.Ja*b,!d.Mm))continue;d.Mm=!1;e(d,a,b,L);var f=g(d,a,!0,L);if(f>=d.Vk)if(d.cyclic)d.Wh&&d.Wh(),z(d.Vn,a),f=g(d,a,!0,L);else{d.Ni=!0;d.na-=f-d.Vk;d.Wh&&d.Wh();continue}for(var k=0;k<d.te.length;k++){for(var h=d.te[k],m=h.xl,q=0;q<m.length;q++){var r=m[q];"SOUND"==r.type&&f<d.Pi-1E-6&&(r.ve=!1)}for(q=0;q<m.length;q++)switch(r=m[q],r.type){case "CLIP":if(r.uq<=f&&f<r.tq&&!r.ve){var u=h,v=r;""!=v.ii?
w.Hv(u,v.ii,v.Jb):w.apply(u,v.Hf,v.Jb);w.set_behavior(u,w.AB_FINISH_STOP,v.Jb);var p=l(v.K,v);w.set_frame(u,p,v.Jb);for(u=0;u<m.length;u++)m[u]!=r&&m[u].Jb==r.Jb&&(m[u].ve=!1);r.ve=!0}r.ve&&(u=h,v=l(f,r),p=w.get_current_frame_float(u,r.Jb),1E-6<Math.abs(v-p)&&w.set_frame(u,v,r.Jb));break;case "SOUND":(f<d.Pi-1E-6||d.Pi<r.K)&&r.K<=f&&f<r.X&&!r.ve&&(t.play(h,(r.K-f)/J.Ja,(r.X-r.K)/J.Ja),r.ve=!0),d.Pi<r.X&&r.X<=f&&r.ve&&(r.ve=!1)}}for(k=0;k<d.M.length;k++)r=d.M[k].lv,r.K<=Math.round(f)&&Math.round(f)<
r.X&&!r.Ph&&(n(d.M[k],r.Ph,d.sc),r.Ph=!0),r.X<=Math.round(f)&&r.Ph&&(n(d.M[k],r.Ph,d.sc),r.Ph=!1);d.Pi=f}}};a.cleanup=function(){D.length=0;L=-1};a.hr=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||m(a)||r(a)?!0:!1};a.set_frame=z;a.get_frame=function(a){var b=B.get_active();return b.ia?g(b.ia,a,!0,L):-1};a.JB=function(){var a=B.get_active();a.ia&&(a.ia.Ni=!0)};a.jA=function(a){var b=B.get_active();b.ia&&(b.ia.Ni=!1,b.ia.Wh=a?a:null)};a.get_frame_start=function(){var a=B.get_active();
return a.ia?a.ia.K:-1};a.get_frame_end=function(){var a=B.get_active();return a.ia?a.ia.X:-1};a.is_play=function(){var a=B.get_active();return a.ia?!a.ia.Ni:!1};a.check_nla=function(){var a=B.get_active();return a.ia?a.b4w_use_nla:!1};a.check_nla_scripts=function(){var a=B.get_active();return a.ia?0<a.b4w_nla_script.length:!1};a.set_range=function(a,b){var c=B.get_active();if(c.ia)c.ia.Vn=a,c.ia.Vk=b;else return!1};a.reset_range=function(){var a=B.get_active();if(a.ia)a=a.ia,a.Vn=a.K,a.Vk=a.X;else return!1};
a.set_cyclic=function(a){var b=B.get_active();if(b.ia)b.ia.cyclic=a;else return!1};a.clear_callback=function(){var a=B.get_active();a.ia&&(a.ia.Wh=null)}};b4w.module.__camera=function(a,p){function c(b){b=b.e;switch(b.xa){case a.MS_TARGET_CONTROLS:b.nh=Z.dist(b.h,b.Mb);b.oh=b.I[0].top;break;case a.MS_HOVER_CONTROLS:b.Za&&(b.nh=Z.dist(b.h,b.Tb),b.oh=b.I[0].top)}}function d(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Wa:new Float32Array([0,0,0,0]),Ua:new Float32Array([0,0,0,0])}}function b(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;
case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function e(b){var c={type:b,name:"",sf:1,width:0,height:0,je:null,ib:null,Qc:null,Ba:0,wc:0,Wa:0,Ua:0,left:0,right:0,top:0,bottom:0,Ve:new Float32Array(3),yq:new Float32Array(3),quat:new Float32Array(4),ra:new Float32Array(16),HD:new Float32Array(16),ua:new Float32Array(16),Yh:new Float32Array(16),rA:new Float32Array(16),Dd:new Float32Array(16),Rs:new Float32Array(16),Ld:new Float32Array(16),
dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,fe:null,dof_on:0,gk:d(),lj:0,Gd:0,fc:null,ri:null,nm:null,eq:new Float32Array(4),Pk:new Float32Array(4)};if(b==a.ub)return c;switch(b){case a.Ib:n(c,40,.1,1E3);break;case a.Mc:n(c,2.5,.1,1E3);break;case a.Qd:break;case a.Ie:break;case a.Ff:break;case a.vb:case a.Db:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function h(b,c,d){if(b.type!=a.vb&&b.type!=a.Db)throw"set_stereo_params(): wrong camera type";
b.lj=c;b.Gd=d;k(b,b.Ba);if(V.ja())for(c=V.get_active(),b=c.e.xe,c=V.hk(c).e.I,d=0;d<c.length;d++)K(c[d],b)}function g(a,b){return l(a.e.quat,b)}function l(a,b){var c=R.quat_to_dir(a,R.AXIS_Y,aa),d=R.quat_to_dir(a,R.AXIS_Z,ea),f=-Math.asin(c[1]/Z.length(c)),c=Math.abs(f)>Math.PI/4?Z.scale(d,-R.sign(f),ba):Z.scale(c,-R.sign(d[1]),ba),e=Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(f=R.sign(f)*Math.PI-f);d=e;0>c[2]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=f;return b}function n(b,c,d,f,e){switch(b.type){case a.Ib:case a.vb:case a.Db:b.wc=
c;b.Ba=1;break;case a.Mc:b.top=c;b.Ba=1;break;case a.Qd:delete b.wc;b.wc=c;b.Ba=e/c;break;case a.Ie:b.top=c;b.Ba=e/c;break;default:M.error("set_frustum(): Unsupported camera type: "+b.type)}b.Wa=d;b.Ua=f}function f(b,c){var d=c.e.h,f=c.e.quat,e=ca;S.rotateX(c.e.W,-Math.PI/2,e);S.invert(e,b.ra);if(b.fc){var e=b.fc[0],g=b.fc[1],h=b.fc[2],m=b.fc[3],l=ca;l[0]=1-2*e*e;l[1]=-2*e*g;l[2]=-2*e*h;l[3]=0;l[4]=-2*e*g;l[5]=1-2*g*g;l[6]=-2*g*h;l[7]=0;l[8]=-2*e*h;l[9]=-2*g*h;l[10]=1-2*h*h;l[11]=0;l[12]=-2*e*m;l[13]=
-2*g*m;l[14]=-2*h*m;l[15]=1;S.multiply(b.ra,l,b.ra);k(b,b.Ba,!0);e=Y;g=ca;S.invert(b.ra,g);S.transpose(g,g);fa.transformMat4(b.fc,g,e);g=na;g[0]=(R.sign(e[0])+b.ua[8])/b.ua[0];g[1]=(R.sign(e[1])+b.ua[9])/b.ua[5];g[2]=-1;g[3]=(1+b.ua[10])/b.ua[14];fa.scale(e,2/(e[0]*g[0]+e[1]*g[1]+e[2]*g[2]+e[3]*g[3]),e);b.ua[2]=e[0];b.ua[6]=e[1];b.ua[10]=e[2]+1;b.ua[14]=e[3]}b.type==a.vb?b.ra[12]+=b.Gd/2:b.type==a.Db&&(b.ra[12]-=b.Gd/2);S.multiply(b.ua,b.ra,b.Ld);J(b);q(b);Z.copy(b.Ve,b.yq);Z.copy(d,b.Ve);W.copy(f,
b.quat)}function m(b,c,d,f){S.lookAt(c,d,f,b.ra);b.type==a.vb?b.ra[12]+=b.Gd/2:b.type==a.Db&&(b.ra[12]-=b.Gd/2);S.multiply(b.ua,b.ra,b.Ld);J(b);q(b);Z.copy(c,b.Ve)}function r(a){var b=a.e.I;if(!b)throw"Wrong object";for(var c=a.e,d=0;d<b.length;d++){var e=b[d];f(e,a);R.Em(e.Ld,e.gk);if(e.fe)if(e.dof_on){var g=Z.dist(c.h,e.fe.location);e.dof_distance=g}else e.dof_distance=0}}function z(b){b=b.e;if(b.xa==a.MS_TARGET_CONTROLS){var c=R.quat_to_dir(b.quat,R.AXIS_Z,aa);b.vo=0<c[1]}}function w(b,c){var d=
b.e,f=d.Sb;!f||d.xa!=a.MS_EYE_CONTROLS&&d.xa!=a.MS_TARGET_CONTROLS||(c&&(d=g(b,da),f.left+=d[0],f.right+=d[0]),f.left=R.angle_wrap_0_2pi(f.left),f.right=R.angle_wrap_0_2pi(f.right))}function E(b,c){var d=b.e,f=d.Zb;!f||d.xa!=a.MS_EYE_CONTROLS&&d.xa!=a.MS_TARGET_CONTROLS||(c&&(d=g(b,da),f.Ya+=d[1],f.Oa+=d[1]),f.Ya=R.angle_wrap_periodic(f.Ya,-Math.PI,Math.PI),f.Oa=R.angle_wrap_periodic(f.Oa,-Math.PI,Math.PI))}function y(b){var c=b.e;if(D(b)&&c.I[0].type===a.Mc){if(c.xa===a.MS_TARGET_CONTROLS)var d=
Z.dist(c.h,c.Mb),c=d/c.nh*c.oh;else c.Za&&c.xa===a.MS_HOVER_CONTROLS?(d=Z.distance(c.h,c.Tb),c=d/c.nh*c.oh):c=b.e.I[0].top;for(var f in b.e.I)d=b.e.I[f],d.top=c,k(d,d.Ba);r(b)}}function H(a,b,c,d,f){var e=a.e,k=b,h=c;if(d||f)a=g(a,ga),d&&(k=b-a[0]),f&&(h=c-a[1]);if(k||h)b=W.identity(F),k&&(k=W.setAxisAngle(R.AXIS_Y,k,U),W.multiply(b,k,b)),h&&(k=R.quat_to_dir(e.quat,R.AXIS_X,aa),h=W.setAxisAngle(k,h,U),W.normalize(h,h),W.multiply(b,h,b)),W.multiply(b,e.quat,e.quat)}function v(a,b,c,d,f){var e=a.e,
k=b,h=c;if(d||f){var m=g(a,ga);d&&(k=b-m[0]);f&&(h=c-m[1])}t(a,a.e.Mb,k,h);a=g(a,ga);a=R.angle_wrap_periodic(a[1],-Math.PI,Math.PI);e.vo=Math.abs(a)>Math.PI/2}function B(a,b,c,d,f){var e=a.e,k=b,h=c;if(d||f){var m=g(a,ga);d&&(k=b-m[0]);f&&(h=c-m[1])}e.ym||(k=0);t(a,e.Tb,k,h);h&&u(a)}function t(a,b,c,d){var f=a.e;if(c||d){var e=W.identity(F);c&&(c=W.setAxisAngle(R.AXIS_Y,c,U),W.multiply(e,c,e));a=L(a);d&&(!a||a&&f.Za)&&(a=R.quat_to_dir(f.quat,R.AXIS_X,aa),d=W.setAxisAngle(a,d,U),W.normalize(d,d),W.multiply(e,
d,e));R.HA(f.h,b,e,f.h);W.multiply(e,f.quat,f.quat)}}function u(a){var b=a.e;if(b.Za){var c=g(a,da)[1];a=a.e;a.zb.Oa-a.zb.Ya?(c=(a.zb.Oa-c)/(a.zb.Oa-a.zb.Ya),c=Math.max(c,0)):c=0;c=c*(a.Vf-a.ee)+a.ee;a=R.quat_to_dir(b.quat,R.AXIS_MY,aa);Z.normalize(a,a);Z.scale(a,c,a);Z.subtract(b.Tb,a,b.h)}}function k(b,c,d){switch(b.type){case a.Ib:if(!c)throw"No aspect ratio";b.Ba=c;case a.Qd:S.perspective(R.Tk(b.wc),b.Ba,b.Wa,b.Ua,b.ua);break;case a.Mc:if(!c)throw"No aspect ratio";b.Ba=c;case a.Ie:c=b.top*b.Ba;
S.ortho(-c,c,-b.top,b.top,b.Wa,b.Ua,b.ua);break;case a.Ff:S.ortho(b.left,b.right,b.bottom,b.top,b.Wa,b.Ua,b.ua);break;case a.vb:case a.Db:if(!c)throw"No aspect ratio";b.Ba=c;var f=Math.tan(b.wc*Math.PI/360);c=b.Wa*f;var e=b.Ba*b.lj*f;b.type==a.vb?(f=e-b.Gd/2,e+=b.Gd/2):(f=e+b.Gd/2,e-=b.Gd/2);f=-(b.Wa/b.lj*f);e*=b.Wa/b.lj;S.frustum(f,e,-c,c,b.Wa,b.Ua,b.ua);b.left=f;b.right=e;break;case a.ub:return;default:throw"Wrong camera type: "+b.type;}d||(S.multiply(b.ua,b.ra,b.Ld),J(b),q(b))}function q(a){S.copy(a.ra,
a.Dd);a.Dd[12]=0;a.Dd[13]=0;a.Dd[14]=0;a.Dd[15]=1;S.multiply(a.ua,a.Dd,a.Dd);S.invert(a.Dd,a.Dd)}function J(a){S.copy(a.ra,a.Yh);S.multiply(a.ua,a.Yh,a.Yh);S.invert(a.Yh,a.Yh)}function G(b,c,d,f,e){f||(f=new Float32Array(24));c||(c=b.Wa);d||(d=b.Ua);var g,k,h,m,l,n,q,r;switch(b.type){case a.ub:throw"Extraction from NONE camera is not possible";case a.Ib:case a.Qd:g=c*Math.tan(b.wc*Math.PI/360);m=-g;k=g*b.Ba;h=-k;l=d/c*g;r=-l;n=l*b.Ba;q=-n;break;case a.Mc:case a.Ie:h=b.top*b.Ba;g=l=b.top;k=n=h;m=r=
-b.top;h=q=-h;break;case a.Ff:g=l=b.top;k=n=b.right;m=r=b.bottom;h=q=b.left;break;case a.vb:case a.Db:l=c/b.Wa;g=c*Math.tan(b.wc*Math.PI/360);m=-g;k=b.right*l;h=b.left*l;q=d/c;l=g*q;r=-l;n=k*q;q*=h;break;default:throw"Wrong camera type: "+b.type;}f[0]=h;f[1]=m;f[2]=-c;f[3]=k;f[4]=m;f[5]=-c;f[6]=k;f[7]=g;f[8]=-c;f[9]=h;f[10]=g;f[11]=-c;f[12]=q;f[13]=r;f[14]=-d;f[15]=q;f[16]=l;f[17]=-d;f[18]=n;f[19]=l;f[20]=-d;f[21]=n;f[22]=r;f[23]=-d;e&&(c=ca,S.invert(b.ra,c),R.jf(f,c,f,0));return f}function D(a){return"CAMERA"===
a.type?!0:!1}function L(b){return D(b)&&b.e&&b.e.xa==a.MS_HOVER_CONTROLS?!0:!1}function K(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.ri){var d=b.csm_num;a.ri=Array(d);for(var f=0;f<d;f++)a.ri[f]=new Float32Array(3);a.nm=new Float32Array(d)}for(d=0;d<c;d++){var f=0==d?a.Wa:O(b,a,d-1),e=O(b,a,d),f=G(a,f,e,qa),f=I.Jy(f);a.ri[d].set(f.F);a.nm[d]=f.Fa;a.eq[d]=Z.length(f.F);a.Pk[d]=A(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.Pk[0]=b.first_cascade_blur_radius}function O(a,b,c){var d=
a.csm_num,f=R.clamp(a.csm_first_cascade_border,b.Wa,b.Ua);a=R.clamp(a.csm_last_cascade_border,b.Wa,b.Ua);return R.clamp(A(f,a,d,c),b.Wa,b.Ua)}function A(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var I=p("__boundings");p("__config");var C=p("__constraints"),Q=p("__container"),M=p("__print"),V=p("__scenes"),R=p("__util"),Z=p("vec3"),fa=p("vec4"),W=p("quat"),ha=p("mat3"),S=p("mat4");a.ub=10;a.Ib=20;a.Mc=30;a.Qd=40;a.Ie=50;a.Ff=60;a.vb=70;a.Db=
80;a.MS_STATIC=0;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var oa=Math.PI/180/2,da=new Float32Array(2),ga=new Float32Array(2),aa=new Float32Array(3),ea=new Float32Array(3),ba=new Float32Array(3),F=new Float32Array(4),U=new Float32Array(4),Y=new Float32Array(4),na=new Float32Array(4),ia=new Float32Array(16),ca=new Float32Array(16),qa=new Float32Array(24);a.hw=function(d){var f=d.e,k=d.data;switch(k.type){case "PERSP":var h=e(a.Ib);if(k.angle_y)var m=k.angle_y/Math.PI*180;n(h,
m,k.clip_start,k.clip_end);break;case "ORTHO":h=e(a.Mc),n(h,k.ortho_scale/2,k.clip_start,k.clip_end)}h.name=d.name;f.ut=!1;f.xa=b(k.b4w_move_style);f.dof_distance=d.data.dof_distance;f.fe=d.data.dof_object;f.dof_front=d.data.b4w_dof_front;f.dof_rear=d.data.b4w_dof_rear;f.dof_power=d.data.b4w_dof_power;f.ym=d.data.b4w_enable_hover_hor_rotation;f.I=[h];f.Jo=d.data.b4w_trans_velocity;f.Io=d.data.b4w_rot_velocity;f.Ko=d.data.b4w_zoom_velocity;f.xa==a.MS_TARGET_CONTROLS&&(f.Mb.set(k.b4w_target),z(d));
k=d.e;m=k.xa;if(m===a.MS_TARGET_CONTROLS||m===a.MS_EYE_CONTROLS||m===a.MS_HOVER_CONTROLS){var l=d.data,q=null,r=null,F=null;m===a.MS_TARGET_CONTROLS||m===a.MS_EYE_CONTROLS?(l.b4w_use_panning&&(k.Ct=l.b4w_use_panning),l.b4w_use_horizontal_clamping&&(q={left:l.b4w_rotation_left_limit,right:l.b4w_rotation_right_limit}),l.b4w_use_vertical_clamping&&(r={Oa:l.b4w_rotation_down_limit,Ya:l.b4w_rotation_up_limit}),m===a.MS_TARGET_CONTROLS&&(k.Za=l.b4w_use_distance_limits&&l.b4w_distance_min<=l.b4w_distance_max,
k.Za&&(k.ee=l.b4w_distance_min,k.Vf=l.b4w_distance_max))):m===a.MS_HOVER_CONTROLS&&(l.b4w_use_horizontal_clamping&&l.b4w_horizontal_translation_min<=l.b4w_horizontal_translation_max&&(q={left:l.b4w_horizontal_translation_min,right:l.b4w_horizontal_translation_max}),l.b4w_use_vertical_clamping&&l.b4w_vertical_translation_min<=l.b4w_vertical_translation_max&&(r={Oa:l.b4w_vertical_translation_min,Ya:l.b4w_vertical_translation_max}),k.Za=l.b4w_use_distance_limits&&l.b4w_hover_angle_min<=l.b4w_hover_angle_max&&
l.b4w_distance_min<=l.b4w_distance_max,k.Za&&(F={Oa:l.b4w_hover_angle_min,Ya:l.b4w_hover_angle_max},k.ee=l.b4w_distance_min,k.Vf=l.b4w_distance_max));var t=q;t&&m==a.MS_EYE_CONTROLS&&(t.left*=-1,t.right*=-1);if(t=r)switch(m){case a.MS_TARGET_CONTROLS:t.Oa*=-1;t.Ya*=-1;break;case a.MS_HOVER_CONTROLS:var qa=-t.Oa;t.Oa=-t.Ya;t.Ya=qa}(t=F)&&m==a.MS_HOVER_CONTROLS&&(t.Oa*=-1,t.Ya*=-1);k.Sb=q;k.Zb=r;k.zb=F;w(d,"LOCAL"==l.b4w_horizontal_clamping_type);E(d,"LOCAL"==l.b4w_vertical_clamping_type)}if(f.xa===
a.MS_HOVER_CONTROLS)if(f=d.e,f.Za){k=d.e;m=R.quat_to_dir(k.quat,R.AXIS_MY,aa);l=Y;l.set(R.AXIS_Y);l[3]=0;m=R.line_plane_intersect(l,-d.data.b4w_hover_zero_level,k.h,m,k.Tb);l=g(d,da)[1];if(!m||Math.abs(l)<oa)M.warn("Active hover camera view vector and the supporting plane are parallel to each other. Set hover pivot based on the camera position."),k.Tb[0]=k.h[0],k.Tb[1]=0,k.Tb[2]=k.h[2];k=g(d,da);f=R.Ne(k[1],f.zb.Ya,f.zb.Oa);0<k[1]&&M.warn("Active hover camera has wrong orientation");f?B(d,0,f):u(d)}else f.ym=
!1;h.type==a.Mc&&c(d)};a.hz=c;a.Vw=d;a.mb=e;a.ID=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.ib);case "DEPTH":return Boolean(a.Qc);case "SCREEN":return!Boolean(a.ib)&&!Boolean(a.Qc);default:throw"Wrong attachment type: "+b;}};a.Zk=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.ib=c;break;case "DEPTH":a.Qc=c;break;case "SCREEN":a.ib=null;a.Qc=null;break;default:throw"Wrong attachment type: "+b;}};a.sE=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.ib;
case "DEPTH":return a.Qc;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.Ir=function(b,c){if(b.type!=a.Ib||c!=a.vb&&c!=a.Db)throw"make_stereo(): wrong camera type";b.type=c;h(b,6,.065)};a.dB=h;a.get_camera_angles=g;a.Nq=l;a.get_camera_angles_char=function(a,b){g(a,b);b[0]=R.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.get_angles=function(a,b){var c=a.e,d=R.quat_to_dir(c.quat,R.AXIS_MY,aa),f=Math.asin(d[1]/Z.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(f)>Math.PI/4&&(d=
0>=f?R.quat_to_dir(c.quat,R.AXIS_MZ,ea):R.quat_to_dir(c.quat,R.AXIS_Z,ea)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=f;return b};a.$k=n;a.WA=function(b,c,d,f,e,g,k){switch(b.type){case a.Ff:b.left=c;b.right=d;b.bottom=f;b.top=e;b.Wa=g;b.Ua=k;break;default:M.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.e.xa};a.hB=f;a.lF=m;a.Os=function(a,b,c){var d=aa;d[0]=0;d[1]=-1;d[2]=0;Z.transformQuat(d,
c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var f=ea;f[0]=0;f[1]=0;f[2]=-1;Z.transformQuat(f,c,f);m(a,b,d,f)};a.Vx=function(a,b,c,d,f){d[0]=a[0];d[1]=a[1];d[2]=a[2];S.lookAt(a,b,c,ca);S.invert(ca,ca);S.rotateX(ca,Math.PI/2,ca);ha.fromMat4(ca,ia);W.fromMat3(ia,f)};a.mC=r;a.lC=function(b){var c=b.e,d=b.e;if(d.xa===a.MS_TARGET_CONTROLS||d.xa===a.MS_EYE_CONTROLS){if(d.Sb){var f=d.Sb.left,e=d.Sb.right,k=g(b,da);(k=d.xa==a.MS_TARGET_CONTROLS?R.Ne(k[0],f,e):R.Ne(k[0],e,f))&&(d.xa==a.MS_TARGET_CONTROLS?v(b,k,0):
H(b,k,0))}d.Zb&&(f=d.Zb.Oa,e=d.Zb.Ya,k=g(b,da),(k=d.xa==a.MS_TARGET_CONTROLS?R.Ne(k[1],e,f):R.Ne(k[1],f,e))&&(d.xa==a.MS_TARGET_CONTROLS?v(b,0,k):H(b,0,k)));d.xa===a.MS_TARGET_CONTROLS&&d.Za&&(k=b.e,f=Z.subtract(k.h,k.Mb,aa),e=Z.length(f),e>k.Vf?(Z.scale(f,k.Vf/e,f),Z.add(k.Mb,f,k.h)):e<k.ee&&(e=R.quat_to_dir(k.quat,R.AXIS_MY,ea),Z.scale(e,100*k.ee,e),Z.add(f,e,f),Z.scale(f,-k.ee/Z.length(f),f),Z.add(k.Mb,f,k.h)))}d.xa===a.MS_HOVER_CONTROLS&&(d=b.e,k=d.Za?d.Tb:d.h,d.Sb&&(f=R.clamp(k[0],d.Sb.left,
d.Sb.right)-k[0],k[0]+=f,d.Za&&(d.h[0]+=f)),d.Zb&&(f=R.clamp(k[2],d.Zb.Oa,d.Zb.Ya)-k[2],k[2]+=f,d.Za&&(d.h[2]+=f)),d=b.e,d.Za&&d.zb&&(k=g(b,da)[1],k=R.Ne(k,d.zb.Ya,d.zb.Oa),R.quat_to_dir(d.quat,R.AXIS_MY,aa),k&&B(b,0,k)));y(b);switch(c.xa){case a.MS_TARGET_CONTROLS:C.IA(c.h,c.quat,c.Mb);C.correct_up(b,R.AXIS_Y);break;case a.MS_EYE_CONTROLS:b.ab||C.correct_up(b,R.AXIS_Y)}z(b)};a.Fo=z;a.mA=w;a.qA=E;a.tC=y;a.rotate_eye_camera=H;a.rotate_target_camera=v;a.rotate_hover_camera=B;a.gz=u;a.OE=function(b){switch(b.type){case a.Ib:case a.Mc:case a.vb:case a.Db:return!0;
default:return!1}};a.uy=function(b){b=b.e.I[0];switch(b.type){case a.Ib:case a.Qd:case a.vb:case a.Db:return Math.PI*b.wc/180;default:return M.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.nf=k;a.Yl=q;a.Gp=J;a.Tx=G;a.Qv=function(a){a=a.e;var b=I.Nd();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Qb=b;var c=I.lm(1,[0,0,0]);a.$c=c;a.Ll=I.$p(1,b);a.Nl=I.bq(1,b);a.Ml=I.aq(1,b)};a.is_camera=D;a.is_target_camera=function(b){return D(b)&&b.e&&b.e.xa==a.MS_TARGET_CONTROLS?
!0:!1};a.is_eye_camera=function(b){return D(b)&&b.e&&b.e.xa==a.MS_EYE_CONTROLS?!0:!1};a.is_hover_camera=L;a.Eo=K;a.px=O;a.project_point=function(b,c,d){b=b.e.I[0];switch(b.type){case a.Ib:case a.Qd:case a.Mc:case a.Ie:case a.vb:case a.Db:var f=Y;f.set(c);f[3]=1;fa.transformMat4(f,b.Ld,f);c=-f[1]/f[3];d[0]=(f[0]/f[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;Q.SC(d[0],d[1],d,b);2<d.length&&(d[2]=(f[2]/Math.abs(f[3])+1)/2);return d;default:return M.error("Non-compatible camera"),d}};a.Hy=function(a){return a.e.I[0]};
a.ik=function(b,c){switch(b.type){case a.Ib:case a.Qd:case a.vb:case a.Db:var d=Math.tan(R.Tk(b.wc)/2);switch(c){case "LEFT":return-d*b.Ba;case "RIGHT":return d*b.Ba;case "TOP":return d;case "BOTTOM":return-d}break;case a.Mc:case a.Ie:switch(c){case "LEFT":return-b.top*b.Ba;case "RIGHT":return b.top*b.Ba;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.Ff:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;default:R.ga("Unknown camera type")}};
a.uz=function(b){switch(b.type){case a.Mc:case a.Ie:case a.Ff:return!0;default:return!1}};a.get_fov=function(b,c){switch(b.type){case a.Ib:case a.Qd:case a.vb:case a.Db:var d=R.Tk(b.wc);return c?d*b.Ba:d;default:return 0}}};b4w.module.__lights=function(a,p){function c(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),Yg:new Float32Array(3),ld:0,Gg:0,qy:!1,qq:!1,Kg:!0,xf:!0,Te:1,distance:25,eE:"INVERSE_SQUARE"}}function d(a){a.Yg[0]=a.color[0]*a.Te;a.Yg[1]=a.color[1]*a.Te;a.Yg[2]=a.color[2]*a.Te}var b=p("__util"),e=p("vec3");a.HE=c;a.xz=function(a){var g=a.data,l=c(g.type);l.name=a.name;l.Kg=g.use_diffuse;l.xf=g.use_specular;var n=b.quat_to_dir(a.e.quat,b.AXIS_Y,[]);e.normalize(n,
n);l.direction[0]=n[0];l.direction[1]=n[1];l.direction[2]=n[2];l.color[0]=g.color[0];l.color[1]=g.color[1];l.color[2]=g.color[2];l.Te=g.energy;d(l);l.distance=g.distance;if("POINT"===l.type||"SPOT"===l.type)l.distance=g.distance;"SPOT"===l.type?(l.Gg=g.spot_blend,l.ld=g.spot_size):"POINT"===l.type&&(l.ld=Math.PI/2);l.qy=g.b4w_generate_shadows;l.qq=g.b4w_dynamic_intensity;a.sa=l};a.YA=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];d(a)};a.$A=function(a,b){a.Gg=b};a.ZA=function(a,b){a.distance=
b};a.aB=function(a,b){a.ld=b};a.Ls=function(a,b){a.Te=b;d(a)};a.wk=function(a){return"LAMP"===a.type?!0:!1};a.qC=function(a){if("LAMP"!=a.type)throw"Wrong light object";var c=a.sa;c&&(b.quat_to_dir(a.e.quat,b.AXIS_Y,c.direction),e.normalize(c.direction,c.direction))}};b4w.module.__scenes=function(a,p){function c(){ob||(ob=d(Da));return ob}function d(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c.qd||!c.qd.length)return c}return null}function b(){if(!Ta)throw"No active scene available";return Ta}function e(a,b,c,d){for(var f=null,e=0;e<b.length;e++){var g=b[e];if((c?g.origin_name:g.name)==a&&g.e.sc==d){f=g;break}}return f}function h(a,b){b||(b="ALL");var c=[];g(a.objects,b,c);return c}function g(a,b,c){for(var d=0;d<a.length;d++){var f=a[d];"ALL"!=b&&b!=f.type||
c.push(f);(f=f.dupli_group)&&g(f.objects,b,c)}}function l(b){if(Ha.jj)switch(b.b4w_render_shadows){case "OFF":return!1;case "ON":return!0}else return!1;var c=!1,d=!1,f=ba(b,"LAMP",a.DATA_ID_ALL),e=Ha.Ae&&b.b4w_enable_ssao;if(0==f.length&&!e)return!1;b=ba(b,"MESH",a.DATA_ID_ALL);for(f=0;f<b.length;f++){var g=b[f];g.b4w_shadow_cast&&(c=!0);g.b4w_shadow_receive&&(d=!0);if((e||c)&&d)return!0}return!1}function n(a){if(!a.ta)return!1;a=a.ta.LAMP;for(var b=0;b<a.length;b++)if("SUN"==a[b].sa.type)return!0;
return!1}function f(a){if(!Ha.shore_smoothing)return!1;a=F(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}function m(b){b=ba(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)for(var d=b[c].particle_systems,f=0;f<d.length;f++){var e=d[f].settings;if(e.b4w_enable_soft_particles&&0<e.b4w_particles_softness)return!0}return!1}function r(b){var c=F(b),d=[];b=ba(b,"MESH",a.DATA_ID_ALL);for(var f=0;f<c.length;f++){var e=c[f];if(e.b4w_water){for(var g=
{},k=0;k<b.length;k++)for(var h=b[k],x=h.data.materials,l=0;l<x.length;l++)x[l]==e&&(g.Bf=h.location[1]);g.vc=e.b4w_water_fog_color.slice(0);g.vc.push(e.b4w_water_fog_density);e.b4w_water_dynamic?(g.yi=!0,g.waves_height=e.b4w_waves_height,g.waves_length=e.b4w_waves_length,g.dst_noise_scale0=e.b4w_water_dst_noise_scale0,g.dst_noise_scale1=e.b4w_water_dst_noise_scale1,g.dst_noise_freq0=e.b4w_water_dst_noise_freq0,g.dst_noise_freq1=e.b4w_water_dst_noise_freq1,g.dir_min_shore_fac=e.b4w_water_dir_min_shore_fac,
g.dir_freq=e.b4w_water_dir_freq,g.dir_noise_scale=e.b4w_water_dir_noise_scale,g.dir_noise_freq=e.b4w_water_dir_noise_freq,g.dir_min_noise_fac=e.b4w_water_dir_min_noise_fac,g.dst_min_fac=e.b4w_water_dst_min_fac,g.waves_hor_fac=e.b4w_water_waves_hor_fac):(g.yi=!1,g.waves_height=0,g.waves_length=0);g.Zd=e.b4w_water_enable_caust;g.jw=e.b4w_water_caust_scale;g.iw=e.b4w_water_caust_brightness;g.kw=new Float32Array([.3,.7]);g.bl=null;e=e.texture_slots;for(k=0;k<e.length;k++)h=e[k].texture,!0===h.b4w_shore_dist_map&&
(g.bl=h.image,g.Hh=h.image.size[0],g.oB=h.b4w_shore_boundings,g.uh=h.b4w_max_shore_dist);d.push(g)}}if(0<d.length){g=d[0];if(!g.yi)for(f=0;f<d.length;f++)d[f].yi&&(g=d[f]);return g}return null}function z(a){function b(a){if(a){a=a.nodes;for(var d=0;d<a.length;d++){var f=a[d];"GROUP"==f.type&&f.node_group&&b(f.node_group.node_tree);"GROUP"==f.type&&"B4W_REFRACTION"==f.node_tree_name&&(c.gc=!0)}}}var c={gc:!1};a=F(a);for(var d=0;d<a.length;d++){var f=a[d];f.b4w_refractive&&(c.gc=!0);f.node_tree&&b(f.node_tree)}return c}
function w(b){if(Ha.Xk)switch(b.b4w_render_reflections){case "OFF":return!1}else return!1;for(var c=[],d=0,f=ba(b,"MESH",a.DATA_ID_ALL),e=0;e<f.length;e++){var g=f[e];if(g.e.Dc)if("CUBE"==g.e.ue)d++;else{var k=g.yl;g.yl=null;if(k){-1==b.ta.EMPTY.indexOf(k)&&(b.ta.ALL.push(k),b.ta.EMPTY.push(k));k.e||Pa.jl(k,!1);for(var g=null,h=0;h<c.length;h++)if(c[h]==k){g=h;break}null==g&&c.push(k)}}}return{Wk:c,Rr:d,Zj:[],aj:[]}}function E(a,b){var c={},d=a.world.b4w_sky_settings;c.AA=d.render_sky;c.procedural_skydome=
d.procedural_skydome&&b;c.use_as_environment_lighting=d.use_as_environment_lighting;c.Ih=d.color;c.rayleigh_brightness=d.rayleigh_brightness;c.mie_brightness=d.mie_brightness;c.spot_brightness=d.spot_brightness;c.scatter_strength=d.scatter_strength;c.rayleigh_strength=d.rayleigh_strength;c.mie_strength=d.mie_strength;c.rayleigh_collection_power=d.rayleigh_collection_power;c.mie_collection_power=d.mie_collection_power;c.mie_distribution=d.mie_distribution;c.Wb=d.reflexible;c.Nb=d.reflexible_only;!b&&
d.procedural_skydome&&$a.warn("There is no sun on the scene. Procedural sky won't be rendered");return c}function y(a){var b={};a=a.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.ez=a.hemisphere;b.bw=a.blur_depth;b.Ap=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;b.KA=a.samples;return b}function H(a){var b={};a=a.b4w_bloom_settings;b.blur=a.blur;b.Ix=a.edge_lum;b.key=a.key;return b}function v(a){var b={};a=a.b4w_motion_blur_settings;b.mb_decay_threshold=a.motion_blur_decay_threshold;
b.mb_factor=a.motion_blur_factor;return b}function B(a){var b={};a=a.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}function t(a){var b={};a=a.b4w_god_rays_settings;b.kz=a.intensity;b.th=a.max_ray_length;b.Oh=a.steps_per_pass;return b}function u(a){var b={};b.gf=a.b4w_outline_color;b.Ui=a.b4w_outline_factor;return b}function k(a){var b={};a=a.b4w_glow_settings;b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=
a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b}function q(a,b){var c=a.world,d=c.light_settings,f={};f.Ue=d.environment_energy;f.Go=d.use_environment_light;f.zm=d.environment_color;f.Ye=c.horizon_color.slice(0);f.Df=c.zenith_color.slice(0);f.KC=c.use_sky_paper;f.JC=c.use_sky_blend;f.LC=c.use_sky_real;f.Xs=null;f.fo=null;f.Am=null;if(f.Go&&"SKY_TEXTURE"==f.zm&&(!b.procedural_skydome||!b.use_as_environment_lighting)){for(var d=
null,e=0;e<c.texture_slots.length;e++)if(c.texture_slots[e].texture.b4w_use_as_environment_lighting){d=c.texture_slots[e];break}d?f.Am=d:($a.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),f.Go=!1)}for(e=0;e<c.texture_slots.length;e++)if(c.texture_slots[e].texture.b4w_use_as_skydome){c=c.texture_slots[e];f.Xs=c;f.fo={Zv:c.blend_factor,fz:c.horizon_factor,$C:c.zenith_up_factor,ZC:c.zenith_down_factor,
color:c.color,wa:c.default_value,invert:c.invert,IC:c.use_rgb_to_intensity,$v:c.blend_type,EC:c.use_map_blend,FC:c.use_map_horizon,HC:c.use_map_zenith_up,GC:c.use_map_zenith_down};break}return f}function J(b){if(!Ha.xb)return!1;var c=!1,d=!1;b=ba(b,"MESH",a.DATA_ID_ALL);for(var f=0;f<b.length;f++){for(var e=b[f],g=e.data.materials,k=0;k<g.length;k++)g[k].b4w_terrain&&(c=!0);e=e.particle_systems;for(k=0;k<e.length;k++)g=e[k].settings,"HAIR"==g.type&&g.b4w_dynamic_grass&&(d=!0);if(c&&d)return!0}return!1}
function G(b){if(Wb.outlining_overview_mode)return!0;if(Ha.enable_selectable)switch(b.b4w_enable_object_selection){case "OFF":return!1;case "ON":return!0;case "AUTO":b=ba(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)if(b[c].e.Eg)return!0;return!1}else return!1}function D(b){if(Wb.outlining_overview_mode)return!0;if(Ha.enable_outlining)switch(b.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;case "AUTO":b=ba(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)if(b[c].e.Gb)return!0;
return!1}else return!1}function L(b){if(Ha.We)switch(b.b4w_enable_glow_materials){case "OFF":return!1;case "ON":return!0;case "AUTO":b=ba(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,f=0;f<d.length;f++)if(Fb.Mp(d[f]))return!0;return!1}else return!1}function K(a,b){if(Ha.gc)switch(a.b4w_render_refractions){case "OFF":return!1;case "ON":return!0;case "AUTO":return b.gc}else return!1}function O(b){b=ba(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,
f=0;f<d.length;f++){var e=d[f],g=e.game_settings.alpha_blend;if(e.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g)return!0}return!1}function A(b){switch(b.b4w_enable_anchors_visibility){case "OFF":return!1;case "ON":return!0}b=ba(b,"EMPTY",a.DATA_ID_ALL);for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_anchor&&d.b4w_anchor.detect_visibility)return!0}return!1}function I(a,b,c){var d=xa.rg(a,b);xa.De(a,d,function(a,b,d){if(d.Ra){switch(d.P){case "COLOR":case "CUBEMAP":a=b.j.ib;break;case "DEPTH":a=b.j.Qc;
break;case "SCREEN":a=null;break;case "MAIN_CUBE_REFLECT":return;default:throw"Wrong slink";}switch(d.qa){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "u_cube_reflection":case "u_plane_reflection":break;default:if(!a)throw"Connection of SCREEN is forbidden";if(a.zf)throw"Batch texture can't use renderbuffer";la.Op(c.Yb,d.qa)&&ka.Ug(c,a,d.qa)}}});for(a=0;a<b.ha.length;a++){var d=b.ha[a],f=b.Hd[a];switch(d.qa){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;
default:if(f.zf)throw"Batch texture can't use renderbuffer";la.Op(c.Yb,d.qa)&&ka.Ug(c,f,d.qa)}}}function C(a,b){return{Ta:!0,wm:[!0,!0,!0,!0,!0,!0],ed:a,B:b}}function Q(a,b,c,d,f){switch(a.type){case "MAIN_OPAQUE":M(a,b,c,"OPAQUE",d,f);break;case "MAIN_BLEND":M(a,b,c,"BLEND",d,f);break;case "MAIN_XRAY":M(a,b,c,"XRAY",d,f);break;case "MAIN_GLOW":M(a,b,c,"GLOW",d,f);break;case "MAIN_PLANE_REFLECT":case "MAIN_CUBE_REFLECT":for(var e=b.e,g=b.o,k=0;k<g.length;k++){var h=g[k];if(("MAIN"==h.type||"PARTICLES"==
h.type)&&"REFLECT"==h.La){if("MAIN_PLANE_REFLECT"==a.type){var x;a:{if(d.e.Ab){x=d.e.Ab.aj;for(var l=0;l<x.length;l++)if(x[l]==a){x=l;break a}}x=null}if(x==e.Ac)continue}else{a:{if(d.e.Ab)for(x=d.e.Ab.Zj,l=0;l<x.length;l++)if(x[l]==a){x=l;break a}x=null}if(x==e.qc)continue}f||(V(h,a,b,c,"REFLECT",d),x=h.Bb,la.D(x,"DISABLE_FOG",0),la.D(x,"WATER_EFFECTS",0),"special_skydome.glslf"==la.Rq(x)&&la.D(x,"REFLECTION_PASS",1),la.D(x,"TEXTURE_NORM",0),Z(d,h),ka.kb(h),fa(h));a.q.push(C(e,h))}}break;case "DEPTH":e=
b.o;for(g=0;g<e.length;g++)k=e[g],"DEPTH"!=k.type||k.ic||"DEPTH"!=k.La&&"NODES"!=k.La||(f||(V(k,a,b,c,"DEPTH",d),ka.kb(k),fa(k)),a.q.push(C(b.e,k)),I(c,a,k),W(k));break;case "SHADOW_CAST":e=!1;g=b.e;b=b.o;k=ma.Ia(c,"GRASS_MAP");for(h=0;h<b.length;h++)x=b[h],"DEPTH"==x.type&&"SHADOW_CAST"==x.La&&(e=!0,f||(la.D(x.Bb,"SHADOW_USAGE","SHADOW_CASTING"),x.xb&&k&&ha(x,k,g),ka.pa(x,"SHADOW_TEX_RES",la.t(d.e.xe.csm_resolution)),ka.kb(x),fa(x)),a.q.push(C(g,x)));e&&oa(a,ma.Ia(c,"MAIN_OPAQUE"),a.q,d,!0);break;
case "COLOR_PICKING":ga(a,b,c,d,f);break;case "COLOR_PICKING_XRAY":ga(a,b,c,d,f);break;case "OUTLINE_MASK":c=b.e;d=b.o;for(b=0;b<d.length;b++)e=d[b],"COLOR_ID"==e.type&&"OUTLINE"==e.La&&(f||(ka.pa(e,"USE_OUTLINE",1),ka.kb(e),fa(e)),a.q.push(C(c,e)));break;case "GRASS_MAP":c=b.e;d=b.o;for(b=0;b<d.length;b++)e=d[b],"GRASS_MAP"==e.type&&(f||(ka.kb(e),fa(e)),a.q.push(C(c,e)),e=a.j,x=c.hb,g=a.bc[0],k=a.bc[1],h=a.bc[2],0==g&&0==k?(g=x.min_y,k=x.max_y):(g=Math.min(g,x.min_y),k=Math.max(k,x.max_y)),x=1E-4*
(k-g),a.bc[0]=g-x,a.bc[1]=k+x,Za.$k(e,h/2,-k,-g,h/2),Za.nf(e));break;case "WIREFRAME":for(d=b.e,b=b.o,e=0;e<b.length;e++)g=b[e],"WIREFRAME"==g.type&&(f||(g.xb&&(k=ma.Ia(c,"GRASS_MAP"))&&ha(g,k,d),ka.kb(g),fa(g)),a.q.push(C(d,g)),I(c,a,g),W(g))}}function M(a,b,c,d,f,e){for(var g=b.e,k=b.o,h=0;h<k.length;h++){var x=k[h];x.ic||x.Nb||"MAIN"!=x.type&&"NODES_GLOW"!=x.type&&"PARTICLES"!=x.type||!("OPAQUE"==x.La&&"OPAQUE"==d||"BLEND"==x.La&&"BLEND"==d||"XRAY"==x.La&&"XRAY"==d||"NODES_GLOW"==x.type&&"GLOW"==
d)||(e||(V(x,a,b,c,d,f),Z(f,x),ka.kb(x),fa(x)),a.q.push(C(g,x)),I(c,a,x),W(x))}a.q.sort(function(a,b){var c;if(a.B&&b.B){c=a.B.Ea;var d=b.B.Ea;(c=c==d?0:c>d?1:-1)||(c=a.B.ug,d=b.B.ug,c=c==d?0:c>d?1:-1)}else c=0;return c})}function V(a,b,c,d,f,e){var g=c.e,k="NO_SHADOWS",h=ma.Ia(d,"SHADOW_CAST");if(h&&a.jc){switch(f){case "OPAQUE":k="SHADOW_MAPPING_OPAQUE";break;case "BLEND":case "XRAY":k="SHADOW_MAPPING_BLEND";break;case "COLOR_ID":case "REFLECT":case "GLOW":k="NO_SHADOWS";break;case "DEPTH":k="SHADOW_MASK_GENERATION";
break;default:throw"Wrong subscene type";}ka.op(a,e.e.xe,h)}h=a.Bb;la.D(h,"SHADOW_USAGE",k);a.xb&&(k=ma.Ia(d,"GRASS_MAP"))&&ha(a,k,g);if("DEPTH"!=a.type&&"COLOR_ID"!=f||a.kh){f=b.tg;la.D(h,"NUM_LIGHTS",f);la.D(h,"NUM_LFACTORS",0==f%2?f/2:Math.floor(f/2)+1);"special_skydome.glslf"==la.Rq(h)&&la.D(h,"REFLECTION_PASS",0);la.D(h,"SSAO_ONLY",0);b.gb&&b.od?la.D(h,"WATER_EFFECTS",1):la.D(h,"WATER_EFFECTS",0);b.gb&&b.Zd&&g.Zd?(la.D(h,"CAUSTICS",1),la.D(h,"CAUST_SCALE",la.t(b.Ip)),la.D(h,"CAUST_SPEED",la.t(b.Jp,
2)),la.D(h,"CAUST_BRIGHT",la.t(b.Hp))):la.D(h,"CAUSTICS",0);b.gb&&(la.D(h,"WAVES_HEIGHT",la.t(b.Cf)),la.D(h,"WAVES_LENGTH",la.t(b.Og)),la.D(h,"WATER_LEVEL",la.t(b.Bf)));-1!==a.Hb.indexOf("u_mirrormap")?la.D(h,"REFLECTION_TYPE","REFL_MIRRORMAP"):a.Dc?null!=g.qc&&ma.Ia(d,"MAIN_CUBE_REFLECT")?(c=e.e.Ab?e.e.Ab.Zj[c.e.qc]:null)?(c=c.j.ib,ka.Ug(a,c,"u_cube_reflection"),la.D(h,"REFLECTION_TYPE","REFL_CUBE")):la.D(h,"REFLECTION_TYPE","REFL_NONE"):null!=g.Ac&&ma.Ia(d,"MAIN_PLANE_REFLECT")?(c=e.e.Ab?e.e.Ab.aj[c.e.Ac]:
null)?(c=c.j.ib,ka.Ug(a,c,"u_plane_reflection"),la.D(h,"REFLECTION_TYPE","REFL_PLANE")):la.D(h,"REFLECTION_TYPE","REFL_NONE"):la.D(h,"REFLECTION_TYPE","REFL_NONE"):la.D(h,"REFLECTION_TYPE","REFL_NONE");(g=ma.Ia(d,"SKY"))?a.us?(c=g.j.ib,ka.Ug(a,c,"u_sky")):Ha.Rk?(a.pc=g.pc,la.D(h,"PROCEDURAL_FOG",1)):la.D(h,"PROCEDURAL_FOG",0):la.D(h,"PROCEDURAL_FOG",0);c=e.e.Ro;c.Go&&(la.D(h,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==c.zm?(c=c.Am?ka.yy(c.Am,!1):g.j.ib,la.D(h,"SKY_TEXTURE",1),ka.Ug(a,c,"u_sky_texture")):
"SKY_COLOR"==c.zm&&la.D(h,"SKY_COLOR",1));a.Xn?(Ha.vi&&la.D(h,"USE_REFRACTION_CORRECTION",1),"MAIN"==a.type&&a.kh||"NODES_GLOW"==a.type?(la.D(h,"REFRACTIVE",1),e.e.gc?la.D(h,"USE_REFRACTION",1):la.D(h,"USE_REFRACTION",0)):e.e.gc?la.D(h,"REFRACTIVE",1):la.D(h,"REFRACTIVE",0)):(la.D(h,"REFRACTIVE",0),la.D(h,"USE_REFRACTION",0),la.D(h,"USE_REFRACTION_CORRECTION",0));a.Af&&(Ha.shore_smoothing&&a.ql&&ma.Ia(d,"DEPTH")?la.D(h,"SHORE_SMOOTHING",1):la.D(h,"SHORE_SMOOTHING",0),a.water_dynamic&&b.gb&&b.Cf?la.D(h,
"DYNAMIC",1):la.D(h,"DYNAMIC",0));"PARTICLES"==a.type&&(la.D(h,"SIZE_RAMP_LENGTH",a.ks),la.D(h,"COLOR_RAMP_LENGTH",a.as));if(!a.Yf)for(b=a.M,d=0;d<b.length;d++)if(c=b[d],"SCENE"==c.source)for(g=0;g<Da.length;g++){f=Da[g];for(var k=Da[g].qd,x=0;x<k.length;x++)k[x].e==c&&xa.m(jb,f,e,null)}if(a.qh){b=0;for(var l in a.qh)b++;a.on=new Float32Array(3*b);a.mn=new Float32Array(3*b);a.ln=new Float32Array(3*b);a.nn=new Float32Array(4*b);la.D(h,"NUM_LAMP_LIGHTS",b);for(d=0;d<e.ta.LAMP.length;d++)R(a,e.ta.LAMP[d])}}}
function R(a,b){var c=b.uuid;if(c in a.qh){c=a.qh[c];a.on.set(b.e.h,3*c);a.mn.set(b.sa.direction,3*c);a.ln.set(b.sa.Yg,3*c);var d=ra,f=b.sa;d[0]=-1;d[1]=-1;d[2]=-1;d[3]=f.xf?1:0;switch(f.type){case "POINT":d[2]=f.distance;break;case "SPOT":d[2]=f.distance;var e=d[0]=Math.cos(f.ld/2);d[1]=f.Gg*(1-e)}a.nn.set(d,4*c)}}function Z(b,c){var d=ba(b,"LAMP",a.DATA_ID_ALL);c.Bb.sn=[];for(var f=da(d)||d[0],e=0;e<d.length;e++){var g=d[e].sa;if("AREA"!=g.type){if("SPOT"==g.type||"POINT"==g.type)var k=Math.cos(g.ld/
2);if("SPOT"==g.type)var h=g.Gg*(1-k);var x=g.index;c.Bb.sn.push({type:g.type,index:x,Bz:Math.floor(x/2),Az:0==x%2?"rg":"ba",ld:k,Gg:h,distance:g.distance,tz:g.Kg||g.xf,fy:x==f.sa.index})}}}function fa(a){var b=a.Yb.attributes,c=a.U.Vb,d;for(d in b)c[d]||Ua.ga('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES_GLOW"==a.type)if(b=la.Uy(a.Yb.Mo),10<b&&("MAIN"==a.type&&$a.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.Tc.join(", ")+'"'),"MAIN"==a.type&&a.kh||"NODES_GLOW"==
a.type))d=c=0,a.Mg&&(c=Ua.yd(a.Mg)),a.tb&&(d=Ua.yd(a.tb)),$a.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.Tc.join(", ")+'"')}function W(a){8<a.M.length&&$a.warn(a.type,"too many textures used - "+a.M.length+' (max 8), materials "'+a.Tc.join(", ")+'"')}function ha(a,b,c){a.bc=b.bc;var d=b.bc[0],f=b.bc[1],e=b.bc[2];c=c.Qb;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);e=0==e?c:Math.max(e,c);b.bc[2]=e;b=b.j;Za.$k(b,e/2,-f,-d,e/2);Za.nf(b);d=a.Xm||0;d=0==d?
c:Math.max(d,c);a.Xm=d}function S(a){var b=na(a,"MAIN_OPAQUE"),c=!0;xa.S(a.e.jb,function(d,f){"SHADOW_CAST"===f.type&&(oa(f,b,f.q,a,c),c=!1)})}function oa(b,c,d,f,e){if(0!=d.length){var g=b.j;c=c.j;var k=ba(f,"LAMP",a.DATA_ID_ALL);if(k=da(k)||k[0]){var h=k.e;Za.Os(g,h.h,h.quat);Gb.copy(c.Ve,g.Ve);zb.copy(c.ra,g.Rs);if("SPOT"==k.sa.type||"POINT"==k.sa.type)Za.nf(g,g.Ba);else{k=X;ua.Nd(k);for(h=0;h<d.length;h++){var x=d[h].ed;0==h?ua.Xp(x.hb,k):ua.sq(k,x.hb)}d=ua.Sx(k,ya);Ua.jf(d,g.ra,d);if(f.e.xe.enable_csm){f=
Gb.copy(c.ri[b.mm],za);k=zb.invert(c.ra,Jb);Ua.jf(f,k,f);Ua.jf(f,g.ra,f);b=c.nm[b.mm];if(e)for(Aa=0,va=-Infinity,e=2;e<d.length;e+=3)Aa=Math.min(Aa,d[e]),va=Math.max(va,d[e]);e=X;e.max_x=f[0]+b;e.max_y=f[1]+b;e.max_z=va;e.min_x=f[0]-b;e.min_y=f[1]-b;e.min_z=Aa}else{b=e=X;c=Zb;c.set(d);f=Ma/9;d=zb.identity(Jb);zb.rotate(d,f,Ua.AXIS_MZ,d);h=k=-1;for(x=0;10>x;x++){var l=ua.Wv(c,Rb),m=(l.max_x-l.min_x)*(l.max_y-l.min_y);if(-1==k||m<k)k=m,h=x,ua.Xp(l,b);Ua.jf(c,d,c)}b=h*f;0<b&&(c=zb.identity(Jb),zb.rotate(c,
b,Ua.AXIS_MZ,c),zb.multiply(c,g.ra,g.ra));b=e.max_x-e.min_x;c=e.max_y-e.min_y;b&&c&&(f=Math.abs(b-c)/2,2<b/c?(e.max_y+=f,e.min_y-=f):2<c/b&&(e.max_x+=f,e.min_x-=f));e.max_x+=.005;e.max_y+=.005;e.max_z+=.005;e.min_x-=.005;e.min_y-=.005;e.min_z-=.005}Za.WA(g,e.min_x,e.max_x,e.min_y,e.max_y,-e.max_z,-e.min_z);Za.nf(g)}Ua.Em(g.Ld,g.gk)}}}function da(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.data.b4w_generate_shadows)return c}return!1}function ga(a,b,c,d,f){for(var e=b.e,g=b.o,k=0;k<g.length;k++){var h=
g[k];"COLOR_ID"==h.type&&(f||(V(h,a,b,c,"COLOR_ID",d),ka.kb(h),fa(h)),"COLOR_PICKING"==a.type&&"COLOR_ID"==h.La||"COLOR_PICKING_XRAY"==a.type&&"COLOR_ID_XRAY"==h.La)&&(f||(ka.pa(h,"USE_OUTLINE",0),ka.kb(h),fa(h)),a.q.push(C(e,h)))}}function aa(a,b){for(var c=Y(b,Ia),d=a.sa,f=a.e,e=d.index,g=0;g<c.length;g++){var k=c[g];k.bf.set(f.h,3*e);k.jg.set(d.direction,3*e);k.ig.set(d.Yg,3*e);switch(d.type){case "SUN":if(k.nt.set(f.quat),k.mt=d.Yg,"SKY"===k.type){var h=za;h[0]=h[1]=h[2]=1;var x=Math.acos(Gb.dot(k.fl,
h)),h=Math.acos(Gb.dot(d.direction,h));k.Ck=Math.floor(x/.025)!=Math.floor(h/.025)?!0:!1;Gb.copy(d.direction,k.fl);ea(b,k)}else Gb.copy(d.direction,k.fl);case "HEMI":case "POINT":case "SPOT":break;default:$a.error("Unknown light type: "+d.type+'".')}x=Ca;x[0]=d.Kg?1:0;x[1]=d.xf?1:0;k.kg.set(x,2*e);k.oa=!0;for(x=0;x<k.q.length;x++)h=k.q[x].B,h.qh&&R(h,a)}}function ea(a,b){Fc.xi(b);if(b.Ck)for(var c=Y(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_GLOW"]),d=0;d<c.length;d++)for(var f=c[d].q,e=0;e<
f.length;e++){var g=f[e];g.Ta&&(g=g.B,ka.nw(g)&&Fc.iC(g))}}function ba(b,c,d){if(!b.ta)throw"Access to uninitialized scene";b=b.ta[c]||[];if(d==a.DATA_ID_ALL)return b;c=[];for(var f=0;f<b.length;f++){var e=b[f];e.e.sc==d&&c.push(e)}return c}function F(b){var c=[];b=ba(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++)for(var f=b[d].data,e=0;e<f.materials.length;e++){var g=f.materials[e];-1==c.indexOf(g)&&c.push(g)}return c}function U(a,b,c){for(var d=a.e,f=a.camera.e.I,e=0;e<f.length;e++){var g=
f[e];Za.nf(g,b/c);d.Yn&&Za.Eo(g,d.xe)}d.Yn&&(d.Dk=!0,na(a,"DEPTH").oa=!0,na(a,"MAIN_BLEND").oa=!0);var k=d.jb;ma.bC(k,function(d,f,e){if(d.Vh){var g=d.sf*b,h=d.sf*c;if(f)for(f=0;f<e.ha.length;f++)e.ha[f]==d&&Ub.resize(d.va,g,h);else switch(Ub.Oi(d.va)&&Ub.resize(d.va,g,h),d=e.j,d.width=g,d.height=h,e.type){case "DOF":ia(a,{dof_power:e.j.dof_power,dof_on:e.j.dof_on});break;case "GLOW_COMBINE":qa(a,{small_glow_mask_width:e.small_glow_mask_width,large_glow_mask_width:e.large_glow_mask_width});break;
case "BLOOM":ca(a,{bloom_blur:e.bloom_blur});break;case "OUTLINE":e=ma.Ha(k,e,"POSTPROCESSING");g=ma.Ha(k,e,"POSTPROCESSING");h=ma.Ha(k,g,"POSTPROCESSING");d=ma.Ha(k,h,"POSTPROCESSING");ma.Ec(e,1/b,1/c);ma.Ec(g,1/b,1/c);ma.Ec(h,1/b,1/c);ma.Ec(d,1/b,1/c);break;default:ma.Ec(e,1/b,1/c)}}})}function Y(a,b){for(var c=[],d=0;d<b.length;d++){var f=b[d];xa.S(a.e.jb,function(a,b){b.type==f&&c.push(b)})}return c}function na(a,b){return ma.Ia(a.e.jb,b)}function ia(a,b){var c=na(a,"DOF");if(!c)return $a.error("DOF is not enabled on the scene. Check camera settings"),
0;var d=a.e.jb;"boolean"==typeof b.dof_on&&(c.j.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.j.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.j.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.j.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.j.dof_power=b.dof_power;var f=ma.Ha(d,c,"POSTPROCESSING"),d=ma.Ha(d,f,"POSTPROCESSING");ma.Ob(f,c.j.dof_power);ma.Ec(f,1/c.j.width,1/c.j.height);ma.Ob(d,c.j.dof_power);ma.Ec(d,1/c.j.width,1/c.j.height)}c.oa=!0}
function ca(a,b){var c=na(a,"LUMINANCE_TRUNCED"),d=na(a,"BLOOM");if(!c||!d)return $a.error("Bloom is not enabled on the scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.oa=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.oa=!0);if("number"==typeof b.bloom_blur){var f=a.e.jb,c=ma.Ha(f,d,"BLOOM_BLUR"),f=ma.Ha(f,c,"BLOOM_BLUR");d.bloom_blur=b.bloom_blur;ma.Ob(c,b.bloom_blur);ma.Ec(c,1/d.j.width,1/d.j.height);ma.Ob(f,b.bloom_blur);ma.Ec(f,1/d.j.width,1/d.j.height)}}
function qa(a,b){var c=na(a,"GLOW_COMBINE");if(!c)return $a.error("Glow is not enabled on the scene"),null;for(var d=a.e.jb,f=ma.Ky(d,c),e=0;e<f.length;++e){var g=f[e];if("POSTPROCESSING"===g.type&&"GLOW_MASK_LARGE"===g.La)var k=g;if("POSTPROCESSING"===g.type&&"GLOW_MASK_SMALL"===g.La)var h=g}f=ma.Ha(d,k,"POSTPROCESSING");d=ma.Ha(d,h,"POSTPROCESSING");"number"==typeof b.small_glow_mask_coeff&&(c.small_glow_mask_coeff=b.small_glow_mask_coeff,c.oa=!0);"number"==typeof b.large_glow_mask_coeff&&(c.large_glow_mask_coeff=
b.large_glow_mask_coeff,c.oa=!0);"number"==typeof b.small_glow_mask_width&&(c.small_glow_mask_width=b.small_glow_mask_width,ma.Ob(h,b.small_glow_mask_width),ma.Ec(h,1/c.j.width,1/c.j.height),h.oa=!0,ma.Ob(d,b.small_glow_mask_width),ma.Ec(d,1/c.j.width,1/c.j.height),d.oa=!0);"number"==typeof b.large_glow_mask_width&&(c.large_glow_mask_width=b.large_glow_mask_width,ma.Ob(k,b.large_glow_mask_width),ma.Ec(k,1/c.j.width,1/c.j.height),k.oa=!0,ma.Ob(f,b.large_glow_mask_width),ma.Ec(f,1/c.j.width,1/c.j.height),
f.oa=!0)}function x(a,b){var c=na(Ta,"MAIN_OPAQUE");if(!c||!c.gb)return $a.error("get_water_surface_level() - no water parameters on the scene"),0;var d=c.Cf,f=c.Og,e=c.Bf,g=c.gb;if(!d||!g.yi)return g.Bf;var k=Gb.length(c.tj),h=c.time;k&&(h*=k);var x=Ca;x[0]=20/f*(a-.25*h);x[1]=20/f*(b-.25*h);k=Ua.Kp(x);x[0]=17/f*(b+.1*h);x[1]=17/f*(a+.1*h);var x=Ua.Kp(x),k=k+x-1,l=g.dst_noise_scale0,x=g.dst_noise_scale1,m=g.dst_noise_freq0,n=g.dst_noise_freq1,N=Ca;N[0]=l*(a+m*h);N[1]=l*(b+m*h);l=Ua.io(N);N[0]=x*
(b-n*h);N[1]=x*(a-n*h);x=Ua.io(N);x*=d*l;if(c.ml)if(n=(a-c.pf[0])/c.qf[0],N=(c.pf[1]+b)/c.qf[1],n+=.5,N+=.5,1<n||0>n||1<N||0>N)d=x;else var n=Ua.Mq(Ta.e.bo,c.Hh,n,N),l=g.dir_freq,q=g.dir_noise_scale,r=g.dir_noise_freq,m=g.dir_min_noise_fac,N=g.dst_min_fac,c=f/c.uh/Math.PI,q=[q/f*(a+r*h),q/f*(b+r*h)],f=Math.sqrt(n),d=d*Math.max(n,g.dir_min_shore_fac)*Math.sin(f/c+l*h)*Math.max(Ua.io(q),m),g=Math.max(f,N),d=d*(1-g)+x*g,k=k*n;else d=x;return e+(d+.05*k)}function N(a,b){a.Mi&&"POSTPROCESSING"==a.type&&
b.Ta!=a.Ta&&(a.Ta=b.Ta);b.Ta||"OUTLINE"!=a.type||(a.xm=0)}function pa(a,b,c,d){var f=xa.Va(a,b);Za.Zk(f.j,c,d);f.Jl=!0;xa.wf(a,b,function(b,f,e){e.Ra&&e.P==c&&ma.ww(e)&&La(a,b,e.qa,d)});xa.De(a,b,function(b,f,e){e.Ra&&e.P==c&&e.P==e.qa&&pa(a,b,c,d)})}function La(a,b,c,d){a=xa.Va(a,b).q;for(b=0;b<a.length;b++)ka.EA(a[b].B,d,c)}function P(a){var b=na(a,"GRASS_MAP");if(b){var c=b.j,d=a.camera.e,f=d.h;a=za;a[0]=0;a[1]=-b.bc[2]/2;a[2]=0;Gb.transformQuat(a,d.quat,a);a[0]+=f[0];a[1]=0;a[2]+=f[2];b=Ib;b[0]=
0;b[1]=0;b[2]=0;b[3]=1;Za.Os(c,a,b)}}function ta(a,b){xa.S(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.ha[0]||!d.Hd[0])throw"Wrong MOTION_BLUR subscene";var f=d.ha[0],e=d.Hd[0];d.Hd[0]=d.j.ib;xa.wf(a,c,function(b,c,d){d.Ra&&La(a,b,d.qa,e)});pa(a,c,f.P,e);La(a,c,f.qa,d.Hd[0]);d.Lr=Math.exp(-b/d.mb_factor)}})}function T(b,c){var d=0,f=b.mv;0==f.yo&&(f.yo=c);var e=c-f.yo;if(f.Ds&&e/f.Uc>=f.Ds)a.clear_outline_anim(b);else{e%=f.Uc;if(e<f.Wr)switch(f=e/(f.Wr/5),e=Math.floor(f),e){case 0:d=(f-e)/2;break;
case 1:d=(f-e)/2+.5;break;case 2:d=1;break;case 3:d=1-(f-e)/2;break;case 4:d=.5-(f-e)/2}b.e.fd=d}}function Ba(a){xa.S(a.e.jb,function(a,b){b.oa=!0})}function lc(a){if("WIND"==a.field.type){a=a.e;Ua.quat_to_dir(a.quat,Ua.AXIS_Y,Xa);Gb.normalize(Xa,Xa);Gb.scale(Xa,a.Lm,Xa);a=Da;for(var b=0;b<a.length;b++)for(var c=Y(a[b],Ra),d=0;d<c.length;d++)c[d].tj.set(Xa)}}function vb(a){var c=b();if(c=na(c,"OUTLINE"))c.gf.set(a),c.oa=!0}var ka=p("__batch"),ua=p("__boundings"),Za=p("__camera"),cb=p("__config"),
Fa=p("__container"),fc=p("__constraints"),Ec=p("__data"),wc=p("__debug"),gc=p("__geometry"),xa=p("__graph"),Eb=p("__hud"),Fb=p("__nodemat"),Pa=p("__objects");p("__particles");var mc=p("__physics"),nb=p("__prerender"),Qa=p("__primitives"),$a=p("__print"),Fc=p("__renderer"),ma=p("__scenegraph"),Qc=p("__sfx"),la=p("__shaders"),Ub=p("__textures"),Ua=p("__util"),Gb=p("vec3"),zb=p("mat4"),Ha=cb.p,Wb=cb.Gb,Vb=cb.Dh,Xb=cb.Ud,Rc="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),Gc=["ARMATURE","EMPTY","MESH",
"SPEAKER"],wa="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH OUTLINE_MASK WIREFRAME".split(" ");a.pD=wa;var Ia="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),db="MAIN_OPAQUE SSAO MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Ra="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS OUTLINE_MASK WIREFRAME".split(" "),
Va="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Yb=0,ob=null,Ta=null,Da=[],jb=null,Na=[],Ma=Math.PI/2;a.Ef=0;a.tl=1;a.ul=2;a.DATA_ID_ALL=-1;var Ca=new Float32Array(2),za=new Float32Array(3);new Float32Array(4);var ra=new Float32Array(4),Ib=new Float32Array(4),Jb=new Float32Array(16),ya=new Float32Array(24),Zb=new Float32Array(24),X=ua.Nd(),Rb=ua.Nd(),Xa=new Float32Array(3),Aa=0,va=-Infinity;a.set_active=function(a){Ta=a;Qc.TA(a)};a.pA=function(a,b){var c=
a.e,d=ma.ex(c.jb);if(a==b){U(a,Fa.Wy(),Fa.Vy());for(var f=0;f<d.length;f++)a.e.Bg.push(d[f])}else for(f=a.qd[0],U(a,f.e.Fg,f.e.Fg),f=0;f<d.length;f++)b.e.Bg.push(d[f]);d=Y(a,Ra);for(f=0;f<d.length;f++)d[f].tj.set(Xa);for(f=0;f<c.Bg.length;f++)"SHADOW_CAST"==c.Bg[f].type&&Fc.xi(c.Bg[f])};a.ih=c;a.Gm=d;a.get_active=b;a.ja=function(){return Ta?!0:!1};a.hk=function(a){return a.camera};a.Hi=function(){return Da};a.Ny=function(){if(1==Da.length)return Da;for(var a=0;a<Da.length;a++){var b=Da[a].e.jb;xa.S(b,
function(b,c){for(var d=0;d<c.q.length;d++){for(var f=c.q[d].B.M,e=null,g=0;g<f.length;g++)if("SCENE"==f[g].source&&f[g].jo==Da[a].name&&"COPY"!=c.type){$a.error('Texture-scene loop detected. A scene is rendered to texture "'+f[g].name+'" yet this texture belongs to the same scene.');xa.rg(jb,Da[a]);e=c.q[d].B;break}e&&(e.M=[],e.Hb=[],ka.hC(e,null),ka.kb(e))}})}for(var c=[],a=0;a<Da.length;a++)if(b=Da[a],!b.qd.length){b=xa.rg(jb,b);xa.Mx(jb,b);b=xa.ro(jb,b,xa.sl);b=xa.Ao(b);xa.S(b,function(a,b){c.push(b)});
break}return c};a.zd=function(b,c,d,f){for(var g=Da,k=null,h=0;h<g.length;h++){var x=ba(g[h],"ALL",a.DATA_ID_ALL);switch(b){case a.Ef:k=e(c,x,!1,d);break;case a.tl:k=null;(x=e(c,x,!1,f))&&x.dupli_group&&(k=e(d,x.dupli_group.objects,!0,f));break;case a.ul:for(var k=null,l=0;l<c.length;l++)if((k=e(c[l],x,0!=l,d))&&k.dupli_group)x=k.dupli_group.objects;else break}if(k)break}return k};a.Dv=function(a,b,c){for(var d in Gc){var f=Gc[d],e=h(a,f),g=b.e.Xh,k=!1;for(d=0;d<c.length;d++)if(k=!0,c[d].e&&c[d].e.hg){for(var x=
0;x<g.length;x++)g[x]==c[d]&&(k=!1);k&&g.push(c[d])}f in b.ta||(b.ta[f]=[]);for(x=0;x<e.length;x++)Ua.is_armature(e[x])&&e[x].proxy||(b.ta.ALL.push(e[x]),b.ta[f].push(e[x]))}};a.xv=function(b,c){b.ta={ALL:[]};for(var d in Rc){var e=Rc[d],g=h(b,e);b.ta[e]=[];for(var x=0;x<g.length;x++)Ua.is_armature(g[x])&&g[x].proxy||(b.ta.ALL.push(g[x]),b.ta[e].push(g[x]))}b.qd=b.qd||[];b.e=b.e||{};b.ia=null;e=b.e;g=b.camera.e;d=b.b4w_shadow_settings;x=e.xe={};d.csm_resolution>Ha.Lb?(x.csm_resolution=Ha.Lb,$a.error("Shadow map texture has unsupported size. Changed to "+
Ha.Lb+".")):x.csm_resolution=d.csm_resolution;x.self_shadow_polygon_offset=d.self_shadow_polygon_offset;x.self_shadow_normal_offset=d.self_shadow_normal_offset;x.enable_csm=d.b4w_enable_csm;var N=ba(b,"LAMP",a.DATA_ID_ALL);if(N=da(N)||N[0])x.pn=N.sa.type,x.ld=N.sa.ld,x.distance=N.sa.distance,"SPOT"!=x.pn&&"POINT"!=x.pn||!x.enable_csm||($a.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),x.enable_csm=!1);x.enable_csm?(x.csm_num=d.csm_num,x.csm_first_cascade_border=
d.csm_first_cascade_border,x.first_cascade_blur_radius=d.first_cascade_blur_radius,x.csm_last_cascade_border=d.csm_last_cascade_border,x.last_cascade_blur_radius=d.last_cascade_blur_radius,x.fade_last_cascade=d.fade_last_cascade,x.blend_between_cascades=d.blend_between_cascades):(x.csm_num=1,x.csm_first_cascade_border=d.csm_first_cascade_border,x.first_cascade_blur_radius=d.first_cascade_blur_radius,x.csm_last_cascade_border=d.csm_last_cascade_border,x.last_cascade_blur_radius=d.last_cascade_blur_radius,
x.fade_last_cascade=!1,x.blend_between_cascades=!1);e.Xh=[];for(d=0;d<c.length;d++)c[d].e&&c[d].e.hg&&e.Xh.push(c[d]);x=b.world.b4w_fog_color;N=b.world.b4w_fog_density;d=z(b);e.vc=new Float32Array([x[0],x[1],x[2],N]);e.Hg=n(b);e.dl=E(b,e.Hg);e.Ro=q(b,e.dl);e.yz=ba(b,"LAMP",a.DATA_ID_ALL).length;e.gb=r(b);e.Kz=d;e.Fe=O(b);e.qv=A(b);e.Sr=0;g.I[0].type!=Za.Ib&&Ha.anaglyph_use?($a.warn("Anaglyph stereo is disabled for the non-perspective camera"),x=!1):x=Ha.anaglyph_use;e.anaglyph_use=x;e.Yn=Ha.vi&&l(b);
e.iE=b.world.b4w_fog_color;e.shore_smoothing=f(b);e.sB=m(b);e.Ab=w(b);e.aw=H(b);e.Oz=v(b);e.lw=B(b);e.Zy=t(b);e.bA=u(b);e.Xe=k(b);e.dh=Ha.dh&&(0<g.dof_distance||g.fe);e.xb=J(b);e.wh=Ha.wh&&b.b4w_enable_motion_blur;e.Zg=Ha.Zg&&b.b4w_enable_color_correction;e.antialiasing=Ha.antialiasing&&b.b4w_enable_antialiasing;e.Vg=Ha.Vg&&b.b4w_enable_bloom&&e.Hg;e.Ae=Ha.Ae&&b.b4w_enable_ssao;e.IB=y(b);e.jh=Ha.jh&&b.b4w_enable_god_rays&&e.Hg;e.gc=K(b,d);e.Cx=Ha.vi;e.Dw=G(b);e.outline=D(b);e.We=L(b);e.Wm=b.world.b4w_render_glow_over_blend;
switch(b.b4w_reflection_quality){case "LOW":e.Uf=Vb.fq;e.$i=Vb.ps;break;case "MEDIUM":e.Uf=Vb.rx;e.$i=Vb.hA;break;case "HIGH":e.Uf=Vb.qx;e.$i=Vb.gA;break;default:e.Uf=Vb.fq,e.$i=Vb.ps}d=b.qd.sort(function(a,b){return b.e.Fg-a.e.Fg});e.jb=ma.dx(e,g,d);e.Bg=[];e.Dk=!1;e.Gn=!1;Da.push(b);jb||(jb=xa.create());xa.u(jb,b)};a.gm=h;a.Tm=function(a){return a.e.jb};a.gy=function(a){xa.S(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=ka.dq(c.Qk);break;case "SSAO":d=ka.jx(c);break;case "SSAO_BLUR":d=
ka.kx(c);break;case "DEPTH_PACK":d=ka.Tw();break;case "REFRACT":case "COPY":d=ka.dq("NONE");break;case "GOD_RAYS":ma.Ha(a,c,"WIREFRAME")||ma.Ha(a,c,"MAIN_BLEND")||ma.Ha(a,c,"GOD_RAYS");d=ka.Xw(c.ls,c.Af,c.Oh);break;case "GOD_RAYS_COMBINE":ma.Ha(a,c,"WIREFRAME")||ma.Ha(a,c,"MAIN_BLEND");ma.Ha(a,c,"GOD_RAYS");d=ka.Yw();break;case "MOTION_BLUR":d=ka.ax();break;case "DOF":var d=ka.Uw(),f=ma.Ha(a,c,"POSTPROCESSING"),e=ma.Ha(a,f,"POSTPROCESSING");ma.Ob(f,c.j.dof_power);ma.Ob(e,c.j.dof_power);break;case "OUTLINE":var d=
ka.bx(),f=ma.Ha(a,c,"POSTPROCESSING"),e=ma.Ha(a,f,"POSTPROCESSING"),g=ma.Ha(a,e,"POSTPROCESSING"),k=ma.Ha(a,g,"POSTPROCESSING");ma.Ob(e,c.Rl);ma.Ob(f,c.Rl);ma.Ob(k,c.Dm*c.Ui);ma.Ob(g,c.Dm*c.Ui);break;case "GLOW_COMBINE":d=ka.Ww();break;case "COMPOSITING":d=ka.Rw();break;case "ANTIALIASING":d=ka.Nw();break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=ka.hx(c.type);break;case "ANAGLYPH":d=ka.Lw();break;case "SKY":d=ka.cx();
break;case "LUMINANCE":d=ka.Zw();break;case "AVERAGE_LUMINANCE":d=ka.Ow();break;case "LUMINANCE_TRUNCED":d=ka.$w();break;case "BLOOM_BLUR":d=ka.Pw();break;case "BLOOM":d=ma.Ha(a,c,"BLOOM_BLUR");f=ma.Ha(a,d,"BLOOM_BLUR");ma.Ob(d,c.bloom_blur);ma.Ob(f,c.bloom_blur);d=ka.Qw();break;case "VELOCITY":d=ka.nx();break;case "ANCHOR_VISIBILITY":d=ka.Mw()}d&&(f=C(Pa.Xj("NONE"),d),fa(d),c.q.push(f),I(a,c,d),W(d))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":var d=a.e.jb,f=b.e;!ma.Ia(d,"SHADOW_CAST")&&
f.jc&&(f.jc=!1);f=Y(a,wa);c&&(mc.has_physics(b)&&mc.append_object(b,a),a.ta.ALL.push(b),a.ta[b.type].push(b),b.Aa&&b.Aa.dupli_group.objects&&(b.origin_name=b.name,b.Aa.dupli_group.objects.push(b)));for(var e=0;e<f.length;e++)Q(f[e],b,d,a,c);break;case "LAMP":b.sa.index=a.e.Sr++;c=Y(a,Ia);for(d=0;d<c.length;d++)c[d].tg++;aa(b,a)}};a.remove_object=function(a){if(!a.e.jn)return!1;var c=b();Ec.oA(c,a,!1);var d=c.ta.ALL.indexOf(a);-1!=d&&c.ta.ALL.splice(d,1);d=c.ta[a.type].indexOf(a);-1!=d&&c.ta[a.type].splice(d,
1);a.Aa&&a.Aa.dupli_group.objects&&(d=a.Aa.dupli_group.objects.indexOf(a),-1!=d&&a.Aa.dupli_group.objects.splice(d,1));fc.qw(a)&&fc.remove(a);return!0};a.uD=Q;a.ao=function(a){a.e.Dk=!0};a.Dy=function(a,b){for(var c=a.e.xe,d=new Float32Array(c.csm_num),f=0;f<c.csm_num;f++)d[f]=Za.px(c,b,f);return d};a.hide_object=function(a){a.e.mh=!0};a.show_object=function(a){a.e.mh=!1};a.is_hidden=function(a){return a.e.mh};a.yA=function(a,b,c){b=b.e;a=Y(a,wa);for(var d=0;d<a.length;d++)for(var f=a[d].q,e=f.length-
1;0<=e;e--){var g=f[e];g.ed==b&&(g.B&&c&&gc.Qp(g.B.U),f.splice(e,1))}};a.check_object=function(a,b){return b.ta[a.type]&&-1<b.ta[a.type].indexOf(a)?!0:!1};a.vB=function(a){var b=a.ta.LAMP;if(b.length==a.e.Sr){for(var c=[],d=0;d<b.length;d++)c[b[d].sa.index]=d;for(d=0;d<c.length-1;d++)for(var f=d+1;f<c.length;f++){var e=b[c[d]].sa,g=b[c[f]].sa;if(g.Kg&&g.xf&&(!e.Kg||!e.xf)||!e.Kg&&(g.Kg||!e.xf&&g.xf))e=c[d],c[d]=c[f],c[f]=e}for(d=0;d<c.length;d++)b[c[d]].sa.index=d,aa(b[c[d]],a)}};a.Ig=aa;a.cleanup=
function(){for(var a=0;a<Da.length;a++){var b=Da[a];xa.S(b.e.jb,function(a,b){if("SINK"!=b.type){var c=b.j;Fc.BA(c.je,c.ib,c.Qc,c.width,c.height);for(var c=b.q,d=0;d<c.length;d++){var f=c[d].B;f&&ka.Cw(f)}}});b.e.jb=[];b.e.Bg=[]}Ta=ob=null;Da.length=0;jb=null;Na.length=0;Xa[0]=0;Xa[1]=0;Xa[2]=0};a.Hr=function(a,b,c){a=Za.Tx(a,a.Wa,a.Ua,null,!0);var d=Qa.ly(a);a=Pa.Xj("DYNAMIC");a.hb=a.Qb={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.wb=a.$c=ua.Yv();var f=a.wb.Fa;a.Mf=a.Lf=
ua.km([f,0,0],[0,f,0],[0,0,f],a.wb.F);c=ka.gx(d,c);b.q.push(C(a,c))};a.Ka=ba;a.wE=function(a){return[a.frame_start,a.frame_end]};a.Ps=function(a,b,c){Fa.lB(a,b,c);Ta&&U(Ta,a,b)};a.QB=Y;a.aa=na;a.get_environment_colors=function(a){a=Y(a,Ia)[0];var b=a.Ye,c=a.Df,d=[],f=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];f[0]=c[0];f[1]=c[1];f[2]=c[2];return[a.Ue,d,f]};a.set_environment_colors=function(a,b,c,d){a=Y(a,Ia);for(var f=0;f<a.length;f++){var e=a[f];isNaN(b)||(e.Ue=b);c&&e.Ye.set(c);d&&e.Df.set(d);e.oa=!0}};a.get_sky_params=
function(a){if(a=na(a,"SKY")){var b={};b.color=Array(3);Gb.copy(a.Ih,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;
b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=na(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.Ih.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),
"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&
(c.mie_distribution=b.mie_distribution),c.oa=!0,c.Ck=!0,ea(a,c))};a.get_fog_color_density=function(a,b){var c=b||[],d=Y(a,db)[0].vc;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=Y(a,db),d=0;d<c.length;d++){var f=c[d];f.vc.set(b);f.oa=!0}};a.get_ssao_params=function(a){var b=na(a,"SSAO");a=na(a,"SSAO_BLUR");if(!b)return null;var c=b.q[0].B,d={};d.ssao_quality=ka.yb(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;
d.Ap=a.ssao_blur_discard_value;d.radius_increase=b.Lh;d.influence=b.Kh;d.dist_factor=b.Jh;d.ssao_only=b.ssao_only;d.ssao_white=ka.yb(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=na(a,"SSAO"),d=na(a,"SSAO_BLUR");if(!c)return $a.error("SSAO is not enabled on the scene"),0;if("string"==typeof b.ssao_quality){var f=c.q[0].B;ka.pa(f,"SSAO_QUALITY",b.ssao_quality);ka.kb(f,!0)}"number"==typeof b.ssao_hemisphere&&(f=c.q[0].B,ka.pa(f,"SSAO_HEMISPHERE",b.ssao_hemisphere),ka.kb(f,!0));
"number"==typeof b.ssao_blur_depth&&(f=d.q[0].B,ka.pa(f,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),ka.kb(f,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.Lh&&(c.Lh=b.Lh);"number"==typeof b.Kh&&(c.Kh=b.Kh);"number"==typeof b.Jh&&(c.Jh=b.Jh);if("number"==typeof b.ssao_only){c=na(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var e=0;e<c.q.length;e++)f=c.q[e].B,ka.pa(f,"SSAO_ONLY",b.ssao_only),ka.kb(f,!0)}"number"==typeof b.ssao_white&&
(f=c.q[0].B,ka.pa(f,"SSAO_WHITE",b.ssao_white),ka.kb(f,!0));c.oa=!0;d.oa=!0};a.get_dof_params=function(a){a=na(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.j.dof_distance;b.dof_front=a.j.dof_front;b.dof_rear=a.j.dof_rear;b.dof_power=a.j.dof_power;b.fe=a.j.fe;return b};a.set_dof_params=ia;a.get_god_rays_params=function(a){var b=Y(a,["GOD_RAYS"]);a=na(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].th;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=
ka.yb(b[0].q[0].B,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=Y(a,["GOD_RAYS"]),d=na(a,"GOD_RAYS_COMBINE");if(!c||!d)return $a.error("God Rays are not enabled on the scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var f=b.god_rays_max_ray_length,e=0;e<c.length;e++)c[e].th=f,c[e].Uk=f/c[e].Oh/(e+1),c[e].oa=!0;if("number"==typeof b.god_rays_steps)for(var g=la.t(b.god_rays_steps,
1),f=c[0].th,e=0;e<c.length;e++){c[e].Oh=g;c[e].Uk=f/g/(e+1);c[e].oa=!0;var k=c[e].q[0].B;ka.pa(k,"STEPS_PER_PASS",g);ka.kb(k,!0)}d.oa=!0};a.get_bloom_params=function(a){var b=na(a,"LUMINANCE_TRUNCED");a=na(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=ca;a.get_glow_material_params=function(a){a=na(a,"GLOW_COMBINE");if(!a)return null;var b={};b.small_glow_mask_coeff=a.small_glow_mask_coeff;
b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b};a.set_glow_material_params=qa;a.get_wind_params=function(){var a=Xa,b=Gb.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.set_wind_params=function(b,c){for(var d=ba(b,"ALL",a.DATA_ID_ALL),f=0;f<d.length;f++){var e=d[f];if("EMPTY"===e.type&&e.field&&"WIND"===e.field.type)var g=e}if(!g)return $a.error("There is no wind on the scene"),
0;d=g.e;"number"==typeof c.wind_dir&&(za=[0,c.wind_dir/180*Math.PI,-Math.PI/2],Ua.euler_to_quat(za,Ib),d.quat.set(Ib),lc(g));"number"==typeof c.wind_strength&&(d.Lm=c.wind_strength,lc(g));Ba(b)};a.OA=function(a){a.e.Gn=!0};a.get_water_surface_level=x;a.get_water_mat_params=function(a,b){var c=na(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.Cf,b.waves_length=c.Og,c.od)){b.water_fog_density=c.od[3];var d=b.water_fog_color=[];d[0]=c.od[0];d[1]=c.od[1];d[2]=c.od[2]}};a.set_water_params=function(a,b){var c=
na(a,"MAIN_OPAQUE");if(!c||!c.gb)return $a.error("set_water_params() - no water parameters on the scene"),null;c=c.gb;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==
typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.yi=b.water_dynamic);for(var d=Y(a,Va),f=0;f<d.length;f++){var e=d[f];
"number"==typeof b.water_fog_density&&c.vc&&(e.od[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.vc&&e.od.set(b.water_fog_color);"number"==typeof b.waves_height&&(e.Cf=b.waves_height);"number"==typeof b.waves_length&&(e.Og=b.waves_length);e.oa=!0}};a.get_shore_dist=function(a,b){var c=na(Ta,"MAIN_OPAQUE");if(!c.ml)return 100;var d=c.uh,f=c.Bf,e=(a[0]-c.pf[0])/c.qf[0],g=(c.pf[1]+a[2])/c.qf[1],e=e+.5,g=g+.5;if(1<e||0>e||1<g||0>g)f=1;else return c=d*Ua.Mq(Ta.e.bo,c.Hh,e,g),f=(f-a[1])*
b,f=Math.sqrt(c*c+f*f)};a.update=function(a,c){for(var d=b().camera.e,f=0;f<Da.length;f++){var e=Da[f],g=e.e.jb;if(e.e.gb)var k=d.h[1]-x(d.h[0],d.h[2]);for(var h=e.e.Xh,l=0;l<h.length;l++){var m=h[l].e,n=m.Qa,q=m.gh+m.na;if(n){var r=Math.round(n.currentTime*m.ac),F=m.na/m.ac;if(r<m.na-(Ha.gg?5:0)||h[l].e.Jg&&r>q)n.currentTime=F;!m.Jg&&r>q&&n.pause();2<=n.readyState&&!n.paused&&Ub.zC(m)}else if(m.Eh){n=Math.min(m.Eh.length,m.gh+m.na);if(m.we<m.na||m.Jg&&m.we>=n)m.we=m.na;!m.Jg&&m.we>=n&&(m.Fh=!1);
n=Math.round(a*Xb.Ja/m.ac)*m.Ks;n!=Yb&&m.Fh&&(Ub.wC(m),m.we++);Yb=n}}xa.S(g,function(b,c){-1<Ra.indexOf(c.type)&&(c.time=a);e.e.gb&&(c.Zl=k)})}for(f=0;f<Da.length;f++)if(e=Da[f],l=e.e,d=l.Bg,l.Dk&&(S(e),l.Dk=!1),l.Gn&&(P(e),l.Gn=!1),d.length){e.b4w_enable_motion_blur&&ta(l.jb,c);if(l.outline){for(var t=0,f=0;f<e.ta.MESH.length;f++)l=e.ta.MESH[f],t+=l.e.fd,-1!=Na.indexOf(l)&&T(l,a);xa.S(e.e.jb,function(a,b){"OUTLINE"===b.type&&(b.xm=t)})}g=null;for(l=0;l<d.length;l++)"OUTLINE_MASK"==d[l].type&&(g=
l);for(l=0;l<d.length;l++)h=d[l],nb.Qn(h),null!==g&&N(h,d[g]),Fc.xi(h)}Ha.show_hud_debug_info&&Eb.pB(Da,c)};a.Rm=function(a){var b=[];xa.S(a.e.jb,function(a,c){b.push(c)});return b};a.apply_outline_anim=function(a,b,c,d){a.mv={yo:0,Wr:b,Uc:c,Ds:d};-1==Na.indexOf(a)&&Na.push(a)};a.clear_outline_anim=function(a){a.e.fd=0;a=Na.indexOf(a);-1!=a&&Na.splice(a,1)};a.ND=function(){Na=[]};a.get_cam_water_depth=function(){var a=na(Ta,"MAIN_BLEND"),b=Ta;return a||b.e.gb?a.Zl:null};a.get_object_data_id=function(a){return a.e.sc};
a.At=Ba;a.jB=function(a,b){switch(b){case "WM_NONE":a.Ta=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.q.length;c++)a.q[c].B.wireframe_mode=wc.ap[b];a.Ta=!0}a.Ea="WM_TRANSPARENT_WIREFRAME"==b;a.oa=!0};a.iB=function(a,b){for(var c=0;c<a.q.length;c++)a.q[c].B.wireframe_edge_color=b,a.oa=!0};a.kp=function(a,b){for(var c=0;c<b.length;c++)a.ta.ALL.push(b[c]),a.ta.MESH.push(b[c])};a.xt=lc;a.pick_object=function(b,d){var f=
c();if(!f)return $a.error("No active scene"),null;var e=na(f,"COLOR_PICKING");if(e){var g=Fa.$l(b,d,Ca,e.j);nb.Qn(e);Fc.xi(e);var k=na(f,"COLOR_PICKING_XRAY");k?(nb.Qn(k),Fc.xi(k),e=k.j):e=e.j;g[1]=e.height-g[1];k=Fc.Bs(e.je,g[0],g[1]);g=ba(f,"MESH",a.DATA_ID_ALL);for(e=0;e<g.length;e++){var h=g[e].e,x=h.Vj;if(x&&3>Math.abs(255*x[0]-k[0])&&3>Math.abs(255*x[1]-k[1])&&3>Math.abs(255*x[2]-k[2]))return h.Gb&&h.Vr&&(Wb.outlining_overview_mode?(vb(Wb.gf),h.fd=Wb.fd,a.apply_outline_anim(g[e],Wb.Ik,Wb.Jk,
Wb.Kk)):(vb(f.b4w_outline_color),h.fd=f.b4w_outline_factor,f=h.Ti,a.apply_outline_anim(g[e],f.Ik,f.Jk,f.Kk))),g[e]}}else $a.error("Object Selection is not available on the scene");return null};a.set_outline_color=vb;a.Yy=function(){return Xa};a.Py=function(b){var c=[];b=ba(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var f=b[d];f.e.Eg&&c.push(f)}return c};a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);
return b};a.eC=function(){for(var b=Ta,c=ba(b,"MESH",a.DATA_ID_ALL),d=0;d<c.length;d++)for(var f=c[d].o,e=0;e<f.length;e++){var g=f[e];"MAIN"==g.type&&(Z(b,g),ka.kb(g))}};a.wt=function(a,b){var c=b.e.wb.F,d=a.e.Ab?a.e.Ab.Zj[b.e.qc]:null;if(d){var f=za;Gb.negate(c,f);for(c=0;6>c;c++){var e=d.si[c],g=d.om[c],k=d.j;zb.translate(Ua.Tt[c],f,e);zb.multiply(k.ua,e,k.Ld);Ua.Em(k.Ld,g)}}};a.Sv=function(a,b){b.e.Ab&&(a.e.fc=b.e.Ab.aj[a.e.Ac].j.fc)};a.zt=function(a,b){var c=b.e.Ab.Wk[a],d=b.e.Ab.aj[a].j;Ua.$B(c.e.h,
c.e.quat,Ua.AXIS_Y,d.fc);Za.hB(d,b.camera)};a.marker_frame=function(a,b){return a.timeline_markers[b]}};b4w.module.__physics=function(a,p){function c(a,b){for(var d=a.Nc,f=0;f<d.length;f++)d[f].e.kl&&b.push(d[f]),c(d[f],b)}function d(a,b){for(var c=a.n.q,d=0;d<c.length;d++)for(var f=c[d].Xa,e=0;e<f.$b.length;e++){var g=f.$b[e];"ANY"!=g.Sa&&b!=g.Sa||v(g)}}function b(a,b){if(da)switch(a){case A.bu:da.n.Pt=!0;A.w(A.Ju,Date.now()-performance.now(),W.dd,W.Xl?ha.Dq:0);break;case A.cu:K.xn("URANIUM:",b.slice(1));break;case A.Yt:K.error(b);break;case A.Zt:O.fbmsg.apply(this,b.slice(1));break;case A.hu:var c=
e(b.H);if(c){var d=b.h,f=b.quat,g=b.Ad,k=b.rd,c=c.n;c.pm=b.time;Q.set_sep(d,1,f,c.qm);R.copy(g,c.Ad);R.copy(k,c.rd)}break;case A.eu:(d=e(b.am))&&Q.set_sep(b.h,1,b.quat,d.l.dj[b.Rn]);break;case A.$t:if(f=e(b[1]))d=b[4],f=f.Oc.Pj[b[2]],C.set_translation(f,b[3]),C.set_rotation(f,d),C.v(f);break;case A.iu:if(c=e(b[1]))c.l.speed=b[2];break;case A.Ut:h(da,b.Nf,b.Of,b.result,null,null,0);break;case A.Wt:h(da,b.Nf,b.Of,b.result,b.Sf,b.coll_norm,b.coll_dist);break;case A.Vt:if(c=e(b[1]))d=c.n,d.Rf&&d.Rf(b[2]);
break;case A.Wo:case A.fu:if(d=da.n.Ah[b.id])if(f=e(b.Wg),a==A.Wo)g=d.callback,g(d.id,b.hit_fract,f,b.hit_time);else{var g=b.hit_fract,k=b.hit_time,c=b.hit_pos,l=d.callback;c?l(d.id,g,f,k,c,b.hit_norm):l(d.id,g,f,k)}break;case A.gu:u(id);break;case A.du:console.log("Physics Ping: OUT "+(b[2]-b[1]).toFixed(3)+" ms, IN "+(performance.now()-b[2]).toFixed(3)+" ms, ALL "+(performance.now()-b[1]).toFixed(3)+" ms");break;case A.au:S=b[1];break;case A.Xt:console.log(b[1]);break;default:K.error("Wrong message: "+
a)}}function e(a){return ga[a]||null}function h(a,b,c,d,f,k,h){a=a.n.q;for(var l=0;l<a.length;l++)for(var m=a[l].Xa,n=0;n<m.$b.length;n++){for(var q=m.$b[n],r=q.hf,F=!1,t=0;t<r.length;t++){var z=r[t];if(z[0]===b&&z[1]===c){q.Vi[t]=d;F=!0;break}}F&&(r=g(q),f&&q.Sl!=b&&(F=f,t=k,z=h,F[0]+=t[0]*z,F[1]+=t[1]*z,F[2]+=t[2]*z,t[0]*=-1,t[1]*=-1,t[2]*=-1),q.callback(r,r?q.Sl==b?e(c):e(b):null,f,k,h))}}function g(a){a=a.Vi;for(var b=!1,c=0;c<a.length;c++)b=b||a[c];return b}function l(){ba.body++;return ba.body}
function n(a){if("ANY"==a)return 0;var b=ea.indexOf(a);return-1==b?(ea.push(a),ea.length-1):b}function f(a){return{H:a,zn:0,uk:!1,rf:!0,QE:!1,is_character:!1,oz:!1,Wj:null,Sa:"",oi:0,PD:{},$b:[],Rf:null,pm:0,qm:new Float32Array([0,0,0,1,0,0,0,1]),Ad:new Float32Array(3),rd:new Float32Array(3),Tj:new Float32Array(3),Sj:new Float32Array(4)}}function m(a,b){switch(a){case "BOX":var c=b.Qb;break;case "CYLINDER":c=b.Nl;break;case "CONE":c=b.Ml;break;case "SPHERE":c=b.$c;break;case "CAPSULE":c=b.Ll}return c}
function r(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.F&&(b.center=a.F);"number"===typeof a.Fa&&(b.radius=a.Fa);"number"===typeof a.height&&(b.height=a.height);return b}function z(a,b,c,d){var f=a.e.h,e=b.e.W,g=new Float32Array(16);
fa.invert(e,g);e=new Float32Array(3);R.transformMat4(f,g,e);switch(b.l.type){case 10:b=b.b4w_vehicle_settings;a=a.e.Qb;A.w(A.mu,c,e,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:A.w(A.lu,c,e,a.tF)}}function w(a){return a.n&&a.n.Wj?!0:!1}function E(a,b,c,d,f,e,g,k,h,l){var m;ba.Wp++;m=ba.Wp.toString(16);A.w(A.tu,m,a,k,b.n.H,c,d,f.n.H,e,g,h,l);b.n.Wj=m}function y(a){var b=a.n;if(b&&(0===b.zn||!0===b.uk||!1===b.rf||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.e.h[0]!=
a.n.Tj[0]||a.e.h[1]!=a.n.Tj[1]||a.e.h[2]!=a.n.Tj[2]||a.e.quat[0]!=a.n.Sj[0]||a.e.quat[1]!=a.n.Sj[1]||a.e.quat[2]!=a.n.Sj[2])){var b=a.n,c=a.e;R.copy(c.h,b.Tj);Z.copy(c.quat,b.Sj);var d=A.Tq(A.Aj);d.H=b.H;d.h=c.h;"DYNAMIC"==b.type?Z.identity(d.quat):d.quat=c.quat;A.w(A.Aj)}a=a.Nc;for(b=0;b<a.length;b++)y(a[b])}function H(a,b,c,d,f){f=f||new Float32Array(3);a=a.e.quat;f[0]=b;f[1]=c;f[2]=d;R.transformQuat(f,a,f)}function v(a){var b=a.hf,c=a.Vi,d=a.Sl,f=[],e=a.Sa,g=da;if(!f)throw"At least one destination required";
for(var k=0;k<g.n.q.length;k++){var h=g.n.q[k];if("ANY"==e||h.Xa.Sa==e)h=h.Xa.H,f&&-1==f.indexOf(h)&&f.push(h)}for(e=0;e<f.length;e++)g=f[e],d<g&&!B(b,d,g)?(b.push([d,g]),c.push(!1)):d>g&&!B(b,g,d)&&(b.push([g,d]),c.push(!1));A.w(A.ku,d);A.w(A.su,b,a.td)}function B(a,b,c){for(var d=0;d<a.length;d++)if(a[d][0]==b&&a[d][1]==c)return!0;return!1}function t(a){a.n&&a.n.Rf&&(a=a.n,A.w(A.Fu,a.H),a.Rf=null)}function u(a){var b=da.n;b.Ah[a]&&(delete b.Ah[a],b.Wn.splice(b.Wn.indexOf,1),A.w(A.Ou,a))}function k(a,
b){if(b.Nh){var c=a.n.H,d=b.eh*b.Cq,f=b.li*b.Cp,e=-b.Mh*b.po*2*Math.PI/b.ht;b.pr&&(e*=-1);switch(b.type){case 10:A.w(A.av,c,d,f,e);break;case 20:A.w(A.$u,c,d,f,e)}}}function q(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function J(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function G(a){return a.b4w_character?!0:!1}function D(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}var L=p("__config");p("__constraints");var K=p("__print"),
O=p("__debug"),A=p("__ipc");p("__renderer");var I=p("__scenes"),C=p("__transform"),Q=p("__tsr"),M=p("__util"),V=p("__version"),R=p("vec3"),Z=p("quat"),fa=p("mat4"),W=L.Xa,ha=L.p,S=0,oa=null,da=null,ga={},aa=[],ea=[],ba={body:0,Wp:0,ys:0},F=new Float32Array(3),U=new Float32Array(4),Y=new Float32Array(4),na=new Float32Array(16),ia=new Float32Array(8),ca=new Float32Array(8);a.iz=function(a){if(da)K.warn("Multiple physics scenes are currently not supported");else{a.n={Pt:!1,q:[],Ah:{},Wn:[]};var c=W.pj+
V.timestamp();K.log("%cLOAD PHYSICS","color: #0a0",c,"Max FPS: "+W.dd);oa=new Worker(c);A.init(oa,b);da=a;W.ping&&setInterval(function(){A.w(A.Lu,performance.now())},1E3)}};a.xw=function(a){return a.n?a.n.Pt:!0};a.cleanup=function(){if(da){oa.terminate();da=oa=null;ga={};aa.length=0;ea.length=0;for(var a in ba)ba[a]=0}};a.append_object=function(a,b){var e=a.e;if(!e)throw"No object render: "+a.name;if(a.parent&&e.kl)return null;var g=[];e.kl&&c(a,g);var h=b.n.q;if(q(a)||J(a)||G(a)||D(a)||a.b4w_collision){var F,
t=a,u=e.os,v=t.e,p=t.game,C=l();if("CAMERA"==t.type)var U=p.use_collision_bounds?p.collision_bounds_type:"BOX",y=m(U,v),B=v.Ei,L=v.zi,B=.5,L=0;else"EMPTY"==t.type?(U="EMPTY",y=null,L=B=0):(U=p.use_collision_bounds?p.collision_bounds_type:"BOX",y=m(U,v),B=v.Ei,L=v.zi);var Q=v.h,H=v.quat,ca=p.use_ghost,ia=p.use_sleep,O=p.mass,V=p.velocity_min,ba=p.velocity_max,ea=p.damping,S=p.rotation_damping,mc=t.b4w_collision_id,W=n(mc),Qa=p.collision_margin,ha=p.collision_group,oa=p.collision_mask,ma=v.$c.Fa,Qc=
r(y),la=t.b4w_correct_bounding_offset,Ub;var Ua=U;if(g.length){var Gb=[],zb={};zb.quat=new Float32Array([0,0,0,1]);zb.trans=new Float32Array(3);zb.worker_bounding=Qc;zb.bounding_type=Ua;Gb.push(zb);fa.invert(v.W,na);Z.invert(v.quat,Y);for(var Ha=0;Ha<g.length;Ha++){var Wb={},Vb=g[Ha],Xb=Vb.game.collision_bounds_type,Rc=new Float32Array(4),Gc=new Float32Array(3);R.transformMat4(Vb.e.h,na,Gc);Z.multiply(Y,Vb.e.quat,Rc);Wb.trans=Gc;Wb.quat=Rc;Wb.bounding_type=Xb;Wb.worker_bounding=r(m(Xb,Vb.e));Gb.push(Wb)}Ub=
Gb}else Ub=[];A.w(A.pu,C,Q,H,u,ca,ia,O,V,ba,ea,S,W,Qa,ha,oa,U,Qc,ma,B,L,Ub,la);ga[C]=t;aa.push(t);var wa=f(C);wa.type=u;wa.zn=O;wa.uk=ca;wa.Sa=mc;wa.oi=W;F=wa;a.n=F;var Ia={B:null,Xa:F};h.push(Ia);d(b,F.Sa)}else for(var db=a.o||[],Ra=0;Ra<db.length;Ra++){var Va=db[Ra],Yb;if(Yb="PHYSICS"==Va.type){var ob;a:{for(var Ta=b.n.q,Da=0;Da<Ta.length;Da++){var jb=Ta[Da].B;if(jb&&jb.id==Va.id){ob=!0;break a}}ob=!1}Yb=!ob}if(Yb)if(Va.Hc.L)if(Va.Af&&b.e.gb){var Na=Va,Ma=da,Ca=I.aa(Ma,"MAIN_OPAQUE");A.w(A.yu,Ca.Bf);
if(Ca.gb&&Na.VC){var za={};za.dst_noise_scale0=Na.dst_noise_scale0;za.dst_noise_scale1=Na.dst_noise_scale1;za.dst_noise_freq0=Na.dst_noise_freq0;za.dst_noise_freq1=Na.dst_noise_freq1;za.dir_min_shore_fac=Na.dir_min_shore_fac;za.dir_freq=Na.dir_freq;za.dir_noise_scale=Na.dir_noise_scale;za.dir_noise_freq=Na.dir_noise_freq;za.dir_min_noise_fac=Na.dir_min_noise_fac;za.dst_min_fac=Na.dst_min_fac;za.waves_hor_fac=Na.waves_hor_fac;var ra=Ca.Cf,Ib=Ca.Og;Ca.ml?A.w(A.Yo,za,Ca.qf[0],Ca.qf[1],Ca.pf[0],Ca.pf[1],
Ca.uh,ra,Ib,Ca.Hh,Ma.e.bo):A.w(A.Yo,za,0,0,0,0,0,ra,Ib,0,null)}}else{var Jb;if(Va.DC){var ya=a,Zb=Va,X=l(),Rb=Zb.Hc,Xa=Rb.A[0].a_position,Aa=Rb.fa||null,va=Zb.Sa,$b=n(va);A.w(A.vu,X,Xa,Aa,ya.e.h,$b,Zb.Tp,Zb.Sp,Zb.Up);var sc=f(X);sc.uk=!0;sc.Sa=va;sc.oi=$b;Jb=sc}else{var pb=a,Sa=Va,sb=l(),Ja=Sa.Hc,kb=Ja.A[0].a_position,nc=Ja.fa||null,Kb=pb.e.h,ab=Sa.Ei,Lb=Sa.zi,Hc=Sa.Sa,Mb=n(Hc);A.w(A.xu,sb,kb,nc,Kb,ab,Lb,Mb,Sa.Tp,Sa.Sp,Sa.Up);var Ic=f(sb);Ic.Sa=Hc;Ic.oi=Mb;Jb=Ic}F=Jb;Ia={B:Va,Xa:F};h.push(Ia);d(b,
F.Sa)}else K.error("Object "+a.name+" has collision material with no assigned vertices")}if(q(a)||J(a)){var Wa=a,eb=Wa.n.H;q(Wa)?(Wa.l.type=10,A.w(A.qu,eb,Wa.l.TB,Wa.l.VB,Wa.l.UB,Wa.l.XC,Wa.l.Nz)):J(Wa)&&(Wa.l.type=20,A.w(A.ou,eb,Wa.l.Im,Wa.l.No,Wa.l.Oo));if(Wa.l.Ag){var qb=Wa.l.Ag;switch(Wa.l.type){case 10:z(qb[1],Wa,eb,!0);z(qb[0],Wa,eb,!0);z(qb[3],Wa,eb,!1);z(qb[2],Wa,eb,!1);break;case 20:for(var Sb=0;Sb<qb.length;Sb++)z(qb[Sb],Wa,eb,!1)}}k(a,a.l)}else if(G(a)){var fb=a.e,Tb=a.n,Hb=fb.Qb.max_y-
fb.Qb.min_y,oc=Tb.H,sa=a.b4w_character_settings,gb=sa.walk_speed,rb=sa.run_speed,ac=sa.step_height,Ga=sa.jump_strength,xc=sa.waterline,Nb=M.Fx(a);A.w(A.ru,oc,Nb,Hb,gb,rb,ac,Ga,xc);Tb.is_character=!0}else if(D(a)){var hb=a,lb=hb.n.H;A.w(A.uu,lb,hb.Oc.Im,hb.Oc.No,hb.Oc.Oo);if(hb.Oc.Pj)for(var tc=hb.Oc.Pj,Ab=0;Ab<tc.length;Ab++){var hc=tc[Ab],tb=hc.e.h,mb=hb.e.W,Bb=new Float32Array(16);fa.invert(mb,Bb);var pc=new Float32Array(3);R.transformMat4(tb,Bb,pc);A.w(A.nu,lb,pc,hc.cw)}hb.n.oz=!0}for(Ra=0;Ra<
aa.length;Ra++)if(a=aa[Ra],a.n){var ub=a;if(!w(ub))for(var bc=0;bc<ub.constraints.length;bc++){var wb=ub.constraints[bc],cc=wb.target,Cb=wb.pivot_type;if("RIGID_BODY_JOINT"==wb.type&&cc.n){var Ob=new Float32Array([wb.pivot_x,wb.pivot_y,wb.pivot_z]),yc,Db=new Float32Array([wb.axis_x,wb.axis_y,wb.axis_z]);yc=M.euler_to_quat(Db,new Float32Array(4));var Ea=fa.fromRotationTranslation(yc,Ob,new Float32Array(16)),Sc=fa.multiply(ub.e.W,Ea,new Float32Array(16)),zc=fa.invert(cc.e.W,new Float32Array(16)),Pb=
fa.multiply(zc,Sc,zc),qc=M.sh(Pb),Jc=M.matrix_to_quat(Pb),Ka=wb,Ya={};Ya.use_limit_x=Ka.use_limit_x;Ya.use_limit_y=Ka.use_limit_y;Ya.use_limit_z=Ka.use_limit_z;Ya.use_angular_limit_x=Ka.use_angular_limit_x;Ya.use_angular_limit_y=Ka.use_angular_limit_y;Ya.use_angular_limit_z=Ka.use_angular_limit_z;Ya.limit_max_x=Ka.limit_max_x;Ya.limit_min_x=Ka.limit_min_x;Ya.limit_max_y=Ka.limit_max_y;Ya.limit_min_y=Ka.limit_min_y;Ya.limit_max_z=Ka.limit_max_z;Ya.limit_min_z=Ka.limit_min_z;Ya.limit_angle_max_x=Ka.limit_angle_max_x;
Ya.limit_angle_min_x=Ka.limit_angle_min_x;Ya.limit_angle_max_y=Ka.limit_angle_max_y;Ya.limit_angle_min_y=Ka.limit_angle_min_y;Ya.limit_angle_max_z=Ka.limit_angle_max_z;Ya.limit_angle_min_z=Ka.limit_angle_min_z;E(Cb,ub,Ob,yc,cc,qc,Jc,Ya,null,null)}}}};a.Xx=e;a.update=function(){for(var a=0;a<aa.length;a++){var b=aa[a],c=b.n;if(c.rf&&c.pm){var d=performance.now()/1E3-c.pm,d=Math.min(d,10/W.dd),d=d-1/W.dd;ha.Uz&&(d=0);var f=ia;Q.jz(c.qm,d,c.Ad,c.rd,ia);C.fB(b,f);C.v(b);y(b);if(b.l)for(var c=b,d=c.l.Ag,
f=c.e.Cb,e=ia,g=0;g<d.length;g++){var k=d[g];Q.multiply(f,c.l.dj[g],e);C.set_tsr(k,e);C.v(k)}b.l&&b.l.Nh&&(c=b.l,d=c.Nh)&&(f=b.l.it,k=na,e=b.e.h,g=b.e.quat,M.Co(b.l.jt,g,e,k),M.sh(k,d.e.h),M.matrix_to_quat(k,d.e.quat),k=U,M.Do(f,g,e,k),f=Y,Z.setAxisAngle(k,-c.Mh*c.po*2*Math.PI,f),Z.multiply(f,d.e.quat,d.e.quat),C.v(d));b.l&&b.l.mo&&(c=b.l,d=c.mo)&&(e=b.l.dt,f=na,g=b.e.h,k=b.e.quat,M.Co(b.l.et,k,g,f),M.sh(f,d.e.h),M.matrix_to_quat(f,d.e.quat),f=U,M.Do(e,k,g,f),e=Y,g=Math.abs(c.speed)*c.ct,g>c.Bn&&
(g=c.Bn),Z.setAxisAngle(f,-g,e),Z.multiply(e,d.e.quat,d.e.quat),C.v(d));b.l&&b.l.uo&&(c=b.l,d=c.uo)&&(f=b.l.ot,k=na,e=b.e.h,g=b.e.quat,M.Co(b.l.pt,g,e,k),M.sh(k,d.e.h),M.matrix_to_quat(k,d.e.quat),b=U,M.Do(f,g,e,b),f=Y,Z.setAxisAngle(b,-Math.abs(c.eh)*c.mq,f),Z.multiply(f,d.e.quat,d.e.quat),C.v(d))}}if(a=da)a=I.aa(a,"MAIN_OPAQUE"),a.gb&&0<a.gb.waves_height&&(b=R.length(a.tj),A.w(A.Zu,a.time*b));A.lA()};a.ty=function(){return da};a.pause=function(){da&&A.w(A.Ku)};a.resume=function(){da&&A.w(A.Pu)};
a.enable_simulation=function(a){a=a.n;if(!a)throw"No object physics";if(!a.rf){var b=a.H;a.rf=!0;A.w(A.Iu,b)}};a.disable_simulation=function(a){a=a.n;if(!a)throw"No object physics";if(a.rf){var b=a.H;a.rf=!1;A.w(A.Hu,b)}};a.has_physics=function(a){return a.n?!0:!1};a.has_dynamic_physics=function(a){return(a=a.n)&&a.rf&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.zn&&0==a.uk?!0:!1};a.has_simulated_physics=function(a){return(a=a.n)&&a.rf?!0:!1};a.set_gravity=function(a,b){A.w(A.Yu,a.n.H,b)};a.cz=
w;a.apply_constraint=E;a.clear_constraint=function(a){a=a.n;A.w(A.Nu,a.Wj);a.Wj=null};a.pull_to_constraint_pivot=function(b,c,d,f,e,g){c=Q.create_sep(c,1,d,ia);e=Q.create_sep(e,1,g,ca);Q.invert(c,c);Q.multiply(e,c,c);C.get_tsr(f,e);Q.multiply(e,c,c);C.set_tsr(b,c);C.v(b);a.set_transform(b,b.e.h,b.e.quat)};a.set_transform=function(a,b,c){Q.set_sep(a.e.h,1,a.e.quat,a.n.qm);var d=A.Tq(A.Aj);d.H=a.n.H;d.h=b;d.quat=c;A.w(A.Aj)};a.sync_transform=y;a.apply_velocity=function(a,b,c,d){H(a,b,c,d,F);a=a.n.H;
b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var f=Math.abs(F[0]),e=Math.abs(F[1]),g=Math.abs(F[2]);F[0]=f?F[0]/f*Math.max(f,b):0;F[1]=e?F[1]/e*Math.max(e,c):0;F[2]=g?F[2]/g*Math.max(g,d):0;A.w(A.$o,a,F[0],F[1],F[2])};a.apply_velocity_world=function(a,b,c,d){A.w(A.$o,a.n.H,b,c,d)};a.apply_force=function(a,b,c,d){H(a,b,c,d,F);A.w(A.zu,a.n.H,F[0],F[1],F[2])};a.apply_torque=function(a,b,c,d){H(a,b,c,d,F);A.w(A.Bu,a.n.H,F[0],F[1],F[2])};a.set_character_move_dir=function(a,b,c){A.w(A.Su,a.n.H,b,c)};a.set_character_move_type=
function(a,b){A.w(A.Tu,a.n.H,b)};a.set_character_walk_velocity=function(a,b){A.w(A.Xu,a.n.H,b)};a.set_character_run_velocity=function(a,b){A.w(A.Vu,a.n.H,b)};a.set_character_fly_velocity=function(a,b){A.w(A.Qu,a.n.H,b)};a.character_jump=function(a){A.w(A.Du,a.n.H)};a.character_rotation_inc=function(a,b,c){A.w(A.Eu,a.n.H,b,c)};a.set_character_rotation=function(a,b,c){A.w(A.Uu,a.n.H,b,c)};a.set_character_rotation_h=function(a,b){A.w(A.Ru,a.n.H,b)};a.set_character_rotation_v=function(a,b){A.w(A.Wu,a.n.H,
b)};a.append_collision_test=function(a,b,c,d){a=a.n;var f=a.H;b=b||"ANY";for(var e=0;e<a.$b.length;e++){var g=a.$b[e];if(g.Sa==b&&g.callback==c)return}g={Sl:f,td:d||!1,Sa:b,callback:c,hf:[],Vi:[]};a.$b.push(g);v(g)};a.remove_collision_test=function(a,b,c){a=a.n;for(var d=0;d<a.$b.length;d++){var f=a.$b[d];if(f.Sa==b&&f.callback==c){if(g(f)){var e=R.set(0,0,0,F);f.callback(!1,null,e,e,0)}a.$b.splice(d,1);d--;for(var f=f.hf,e=da.n.q,k=0;k<e.length;k++)for(var h=e[k].Xa,l=0;l<h.$b.length;l++)for(var m=
h.$b[l],n=0;n<m.hf.length;n++)for(var q=m.hf[n],r=0;r<f.length;r++){var t=f[r];q[0]==t[0]&&q[1]==t[1]&&(f.splice(r,1),r--)}f.length&&A.w(A.Zo,f)}}};a.apply_collision_impulse_test=function(a,b){a.n&&a.n.Rf&&t(a);var c=a.n;A.w(A.Au,c.H);c.Rf=b};a.clear_collision_impulse_test=t;a.append_ray_test=function(a,b,c,d,f,e,g,k,h){var l;ba.ys++;l=ba.ys;d=d||"ANY";a={id:l,H:a?a.n.H:0,P:new Float32Array(b),qa:new Float32Array(c),Sa:d,oi:n(d),up:e,ew:g,td:k,ok:h,callback:f};b=da.n;l=a.id;b.Ah[l]=a;b.Wn.push(a);
A.w(A.wu,a.id,a.H,a.P,a.qa,a.oi,a.up,a.ew,a.td,a.ok);return l};a.remove_ray_test=u;a.change_ray_test_from_to=function(a,b,c){var d=da.n.Ah[a];d&&!d.up&&(d.P.set(b),d.qa.set(c),A.w(A.Cu,a,b,c))};a.tr=function(a){return da.n.Ah[a]?!0:!1};a.vehicle_throttle=function(a,b){var c=a.l;c.eh=b;k(a,c)};a.vehicle_steer=function(a,b){var c=a.l;c.Mh=b;k(a,c)};a.vehicle_brake=function(a,b){var c=a.l;c.li=b;k(a,c)};a.is_vehicle_chassis=q;a.is_vehicle_hull=J;a.nz=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;
return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.lz=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.pz=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.wr=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.vr=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.xr=function(a){return a.b4w_vehicle&&"TACHOMETER"==
a.b4w_vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.l.speed};a.YC=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=G;a.PE=D;a.Iy=function(){return S};a.vx=function(){A.w(A.Gu)};a.xA=function(a){var b=aa.indexOf(a);-1==b&&K.error("Object "+a.name+" doesn't have bounding physics");for(var c=da,d=a.n.H,f=c.n.q,e=[],k=0;k<f.length;k++)for(var h=f[k].Xa,l=0;l<
h.$b.length;l++)for(var m=h.$b[l],n=0;n<m.hf.length;n++){var q=m.hf[n],r=m.Vi[n];if(q[0]==d||q[1]==d)m.hf.splice(n,1),m.Vi.splice(n,1),n--,r&&!g(m)&&(r=R.set(0,0,0,F),m.callback(!1,null,r,r,0)),e.push(q)}e.length&&A.w(A.Zo,e);a.n&&a.n.Rf&&t(a);delete ga[d];aa.splice(b,1);a=c.n.q;for(b=0;b<a.length;b++)a[b].Xa.H==d&&(a.splice(b,1),b--);A.w(A.Mu,d)}};b4w.module.__data=function(a,p){function c(a,b){if(a)for(var c=S(a,b.id),d=0;d<c.length;d++){var f=c[d];"MESH"==f.type&&delete f.data.submeshes}xa[b.id]=null;Eb[b.id]=null}function d(a,b,c){var d;a instanceof ArrayBuffer&&(a=Y.Yq(a));d=a.width;a=a.height;pa.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(Fb)&&c&&pa.warn("image",b,"is not from app root.")}function b(a,b,c,d,f,e){d=b.r;if(!d)throw"Nothing requested";ca.enqueue([[d,ca.AT_JSON,
d]],function(d,e,g,k){if(d){pa.log("%cLOAD METADATA","color: #616",k);e=ua.KB(d.b4w_format_version);switch(ua.Ht(e,Fa.Ri)){case -1:e[0]<Fa.Ri[0]?ua.ga("JSON version is too old relative to B4W engine: "+ua.nl(e)+", required: "+ua.nl(Fa.Ri)+". Reexport scene with the latest B4W addon to fix it."):pa.warn("JSON version is a bit old relative to B4W engine: "+ +ua.nl(e)+", required: "+ua.nl(Fa.Ri)+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");break;case 1:e[0]>
Fa.Ri[0]?ua.ga("B4W engine version is too old relative to JSON. Can't load the scene. Update your engine version to fix it."):pa.warn("B4W engine version is a bit old relative to JSON. Some compatibility issues can occur. Update your engine version to fix it.")}Fa.wn=e;for(var h in d)a[h]=d[h];0===b.id&&(Pa=a);(d=a.binaries[0].binfile)?b.xp=d:(ia.Ts(b,"load_binaries"),ia.Ts(b,"prepare_bindata"));d=a==Pa;if(a.b4w_export_errors)for(h=0;h<a.b4w_export_errors.length;h++)e=a.b4w_export_errors[h],(d&&"PRIMARY"==
e.type||"ALL"==e.type)&&pa.Px(e.text);d=a==Pa;if(a.b4w_export_warnings)for(h=0;h<a.b4w_export_warnings.length;h++)e=a.b4w_export_warnings[h],(d&&"PRIMARY"==e.type||"ALL"==e.type)&&pa.Qx(e.text);f(b,c)}else ia.gp(b)},null,function(a){e(b,c,a)})}function e(a,b,c,d,f,e){d=W(b.r)+b.xp;if(!d)throw"Binary data is missing";ca.enqueue([[d,ca.AT_ARRAYBUFFER,d]],function(d,e,g,k){d?(pa.log("%cLOAD BINARY","color: #616",k),a.bin_data=d,f(b,c)):ia.gp(b)},null,function(a){e(b,c,a)})}function h(a,b,c,d,f){lc.vw()&&
f(b,c)}function g(a,b,c,d,f){d=a.bin_data;var e=a.binaries[0],g=a.objects,k=a.meshes;a=a.actions;for(var h=ua.rw(),m=["indices"],x=["normal","tangent"],n=["color","group"],N=["position","texcoord","texcoord2"],q=0;q<k.length;q++)for(var r=k[q].submeshes,F=0;F<r.length;F++)for(var t in r[F]){var z=r[F][t][1];if(-1!=m.indexOf(t)){var u=4*r[F][t][0]+e["int"],w=r[F],v=t,p=d;if(h)var I=new Uint32Array(p,u,z);else for(var I=new Uint32Array(z),p=new DataView(p),U=0;U<z;U++)I[U]=p.getUint32(u+4*U,!0);w[v]=
I}else if(-1!=N.indexOf(t))u=4*r[F][t][0]+e["float"],r[F][t]=l(d,u,z,h);else if(-1!=x.indexOf(t)){u=2*r[F][t][0]+e["short"];w=r[F];v=t;p=d;I=new Float32Array(z);p=new DataView(p);for(U=0;U<z;U++)I[U]=p.getInt16(u+2*U,!0)/32767;w[v]=I}else if(-1!=n.indexOf(t)){u=2*r[F][t][0]+e.ushort;w=r[F];v=t;p=d;I=new Float32Array(z);p=new DataView(p);for(U=0;U<z;U++)I[U]=p.getUint16(u+2*U,!0)/65535;w[v]=I}}for(t=0;t<g.length;t++)for(k=g[t].particle_systems,m=0;m<k.length;m++)x=k[m],x.transforms=l(d,4*x.transforms[0]+
e["float"],x.transforms[1],h);for(g=0;g<a.length;g++){t=a[g];k=t.fcurves;m=t.frame_range;n=m[0];N=m[1];q=ea.xy(n,N);m=null;0>q&&(q=0);var F=r=!1,C;for(C in k)r|=-1<C.indexOf("rotation_euler"),F|=-1<C.indexOf("rotation_quaternion");x=[];for(C in k)if(r&&F&&-1<C.indexOf("rotation_euler"))delete k[C];else{var z=k[C],Y;for(Y in z)u=z[Y],w=l(d,e["float"]+4*u.bin_data_pos[0],u.bin_data_pos[1],h),v=new Float32Array(q),null===m&&(m=new Int8Array(q)),ea.Mv(u,w,v,m,n,N),u.nc=v;-1<C.indexOf("rotation_euler")&&
(ea.Wx(k[C]),x.push(C))}for(n=0;n<x.length;n++)N=x[n],q=N.replace("euler","quaternion"),k[q]=k[N],delete k[N];t.iv=m}f(b,c)}function l(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var f=0;f<c;f++)d[f]=a.getFloat32(b+4*f,!0)}return d}function n(a,b,c,d,e){var g=a.cameras,k=a.groups,h=a.materials,l=a.meshes,m=a.node_groups,n=a.objects,q=a.particles,r=a.scenes,F=a.speakers,t=a.textures,z=a.worlds;m||(pa.warn('"node_groups" datablock undefined. reexport main scene.'),
m=a.node_groups=[]);for(var u="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),w={},v=0;v<u.length;v++)for(var p=a[u[v]],I=0;I<p.length;I++){var U=p[I];w[U.uuid]=U}for(var C=0;C<r.length;C++){for(var Y=r[C],A=Y.objects,T=0;T<A.length;T++)y(A,T,w);Y.camera&&y(Y,"camera",w);Y.world&&y(Y,"world",w)}for(C=0;C<k.length;C++)for(var B=k[C].objects,T=0;T<B.length;T++)y(B,T,w);for(C=0;C<n.length;C++){var qa=
n[C];qa.dupli_group&&y(qa,"dupli_group",w);qa.parent&&y(qa,"parent",w);if(qa.animation_data){var Ba=qa.animation_data;Ba.action&&y(Ba,"action",w);if(Ba.nla_tracks)for(T=0;T<Ba.nla_tracks.length;T++)for(var M=Ba.nla_tracks[T],G=0;G<M.strips.length;G++)M.strips[G].action&&y(M.strips[G],"action",w)}switch(qa.type){case "MESH":if(!qa.data)throw"mesh not found for object "+qa.name;y(qa,"data",w);for(var P=!1,na=qa.modifiers,T=0;T<na.length;T++){var J=na[T];"ARMATURE"==J.type?(P&&pa.warn('Object "'+qa.name+
'" has more than one armature modifiers. Only the first one will be used.'),P=!0,y(J,"object",w)):"CURVE"==J.type&&y(J,"object",w)}var K=qa.particle_systems;if(K)for(T=0;T<K.length;T++)y(K[T],"settings",w);break;case "ARMATURE":y(qa,"data",w);for(var Q=qa.pose.bones,lc=qa.data.bones,T=0;T<Q.length;T++){var ka=Q[T];ka.bone=lc[ka.bone];for(var H=ka.parent_recursive,G=0;G<H.length;G++)H[G]=Q[H[G]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":y(qa,"data",w)}var ca=qa.constraints;if(ca)for(T=
0;T<ca.length;T++){var ia=ca[T];ia.target&&y(ia,"target",w)}var O=qa.lod_levels;if(O)for(T=0;T<O.length;T++){var fc=O[T];fc.object&&y(fc,"object",w)}}for(C=0;C<l.length;C++)for(var V=l[C].materials,T=0;T<V.length;T++)y(V,T,w);for(C=0;C<h.length;C++){for(var R=h[C],ga=R.texture_slots,T=0;T<ga.length;T++)y(ga[T],"texture",w);var aa=R.node_tree;aa&&E(aa,w)}for(C=0;C<m.length;C++)(aa=m[C].node_tree)&&E(aa,w);for(C=0;C<t.length;C++){var ba=t[C],Fa=ba.type;"IMAGE"!=Fa&&"ENVIRONMENT_MAP"!=Fa||y(ba,"image",
w)}for(C=0;C<g.length;C++){var mc=g[C];mc.dof_object&&y(mc,"dof_object",w)}for(C=0;C<F.length;C++){var xa=F[C];xa.sound&&y(xa,"sound",w);if(xa.animation_data&&(Ba=xa.animation_data,Ba.action&&y(Ba,"action",w),Ba.nla_tracks))for(T=0;T<Ba.nla_tracks.length;T++)for(M=Ba.nla_tracks[T],G=0;G<M.strips.length;G++)M.strips[G].action&&y(M.strips[G],"action",w)}for(C=0;C<q.length;C++){for(var Fb=q[C],ga=Fb.texture_slots,T=0;T<ga.length;T++)y(ga[T],"texture",w);Fb.dupli_group&&y(Fb,"dupli_group",w);Fb.dupli_object&&
y(Fb,"dupli_object",w)}for(C=0;C<z.length;C++)if(ga=z[C].texture_slots)for(T=0;T<ga.length;T++)y(ga[T],"texture",w);La.pw(a);for(var Z=a.textures,W=a==Pa?a.scenes[0].b4w_anisotropic_filtering:f().b4w_anisotropic_filtering,Qa=0;Qa<Z.length;Qa++)a==Pa||"SCENE"!=Z[Qa].b4w_source_type||(Z[Qa].b4w_source_id=""),vb.lx(Z[Qa],W,a.scenes,b.id);for(var ma={},nb=a.objects,fa=0;fa<nb.length;fa++){var gc=nb[fa];if("MESH"===gc.type&&!gc.particle_systems.length)for(var ha=gc.data,Eb=ha.name,da=ha.submeshes,$a=ha.materials,
la=0;la<da.length;la++)0!==da[la].base_length||ma[Eb]||($a[la]&&pa.warn('material "'+$a[la].name+'" is not assigned to any face (object "'+gc.name+'").'),ma[Eb]=!0)}for(var lb=a.meshes,Qc=0;Qc<lb.length;Qc++){var Ab=lb[Qc];Ab.materials.length||Ab.uv_textures.length&&pa.warn('mesh "'+Ab.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},
raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",
b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});for(var hc=a.meshes,tb=ua.keysearch("name",
"DEFAULT",a.materials),mb=0;mb<hc.length;mb++){var Bb=hc[mb];0==Bb.materials.length&&Bb.materials.push(tb)}for(var pc=a.actions,ub=b.id,bc=0;bc<pc.length;bc++){var wb=pc[bc];wb.kv=ub;ea.sv(wb)}for(var cc=a.scenes,Cb=0;Cb<cc.length;Cb++){for(var Ob=cc[Cb],yc=ta.gm(Ob,"ALL"),Db=[],Ea=0;Ea<yc.length;Ea++)for(var Sc=yc[Ea].particle_systems,zc=0;zc<Sc.length;zc++){var Pb=Sc[zc].settings;if("HAIR"==Pb.type)if("OBJECT"==Pb.render_type)x.jl(Pb.dupli_object,!0);else if("GROUP"==Pb.render_type){for(var qc=
Pb.dupli_group,Jc=ta.gm(Ob,"EMPTY"),Ka=0;Ka<Jc.length;Ka++)Jc[Ka].dupli_group==qc&&Db.push(Jc[Ka]);for(Ka=0;Ka<qc.objects.length;Ka++)x.jl(qc.objects[Ka],!0)}else pa.warn("render type",Pb.render_type,"not supported for particle systems ("+Pb.name+").")}for(Ea=0;Ea<Db.length;Ea++)L(Db[Ea],[Ob])}oa(a,b.id);for(var Ya=a.scenes,Ac=0;Ac<Ya.length;Ac++){for(var kd=Ya[Ac],ic=[],Vc=[],$c=Ya[Ac].objects,Qb=0;Qb<$c.length;Qb++){var ld=$c[Qb];D($c,ld,ic,Vc);var md=ld.dupli_group;if(md)for(var sd=md.objects,
td=0;td<sd.length;td++)D(sd,sd[td],ic,Vc)}for(Qb=0;Qb<Vc.length;Qb++)L(Vc[Qb],[kd]);for(Qb=0;Qb<ic.length;Qb++)ua.Gv(ic[Qb][0],ic[Qb][1])}oa(a,b.id);var xb=S(a,b.id);La.Rv(xb,a.scenes);for(Qa=0;Qa<xb.length;Qa++){var Kc=xb[Qa];a!=Pa&&Kc.parent&&-1<Fc.indexOf(Kc.parent.type)&&(Kc.parent="");x.jl(Kc,!1);Kc.e.sc=b.id}for(var uc=0;uc<xb.length;uc++){var Wc=xb[uc];if("MESH"==Wc.type){var nd=ea.get_first_armature_object(Wc);if(nd){var ud=nd.e;if(ud.Me){var fd=Wc.e.Pc,Lc=[],Mc;for(Mc in fd){var Nc=fd[Mc];
Lc.push(4*Nc.ui,4*Nc.Bp)}ud.Kr.push(Lc)}ud.cl.push(Wc.e)}}}for(var Oc=-1,od=-1,Xc=ea.Sq(),Bc=0;Bc<xb.length;Bc++){var ad=xb[Bc],jc=ad.e;if(ua.is_mesh(ad)&&jc.ph){var Tc=jc.re;Tc>Oc&&(Oc=Tc);Xc>=Tc&&Tc>od&&(od=Tc)}}for(Bc=0;Bc<xb.length;Bc++)ad=xb[Bc],jc=ad.e,ua.is_mesh(ad)&&jc.ph&&(jc.Di=!0,Oc<Xc?jc.re=Oc:jc.re<=Xc?jc.re=od:(pa.warn('too many bones for "'+ad.name+'" / '+jc.re+" bones (max "+Xc+" with blending, "+2*Xc+" without blending). Blending between frames will be disabled."),jc.re=Oc,jc.Di=
!1),jc.Di=jc.Di&&!wc.Eq);for(var bd=0;bd<xb.length;bd++){var rc=xb[bd];if(ua.is_mesh(rc)){var pd=rc.lod_levels.length;if(pd)for(var Pc=rc,Cc=0;Cc<pd;Cc++){var vc=rc.lod_levels[Cc].object;if(!vc){Pc.e.yk=!0;Pc.e.cf=rc.lod_levels[Cc].distance;break}vc.e.ng=rc.e.ng;Pc.e.cf=rc.lod_levels[Cc].distance;vc.e.Qi=rc.lod_levels[Cc].distance;if(rc.lod_levels[Cc+1])vc.e.cf=rc.lod_levels[Cc+1].distance;else{vc.e.yk=!0;vc.e.cf=1E4;break}Pc.e.yk=!1;Pc=vc}}}for(var gd=0;gd<xb.length;gd++){var ja=xb[gd];if(ja.b4w_vehicle){var bb=
ja.b4w_vehicle_settings;if("CHASSIS"==bb.part){ja.l={};ja.l.Cq=bb.force_max;ja.l.Cp=bb.brake_max;ja.l.TB=bb.suspension_compression;ja.l.VB=bb.suspension_stiffness;ja.l.UB=bb.suspension_damping;ja.l.XC=bb.wheel_friction;ja.l.jF=bb.roll_influence;ja.l.Nz=bb.max_suspension_travel_cm;ja.l.eh=0;ja.l.li=1;ja.l.Mh=0;ja.l.speed=0;ja.l.Ag=[];ja.l.dj=[];ja.l.Nh=null;for(var qd=ja.Aa?ja.Aa.dupli_group.objects:xb,Dc=0;Dc<qd.length;Dc++){var Oa=qd[Dc];if(Oa.b4w_vehicle){var ib=Oa.b4w_vehicle_settings;if(N.nz(Oa)&&
bb.name==ib.name){var hd=N.YC(Oa.b4w_vehicle_settings.part);ja.l.Ag[hd]=Oa;ja.l.dj[hd]=new Float32Array(8)}else if(N.wr(Oa)&&bb.name==ib.name){ja.l.Nh=Oa;ja.l.po=ib.steering_max;ja.l.ht=ib.steering_ratio;ja.l.pr=ib.inverse_control;var yb=cb.invert(ja.e.W,new Float32Array(16)),Uc=cb.multiply(yb,Oa.e.W,yb);ja.l.jt=Uc;var Yc=new Float32Array([1,0,0,0]);Za.transformMat4(Yc,Uc,Yc);ja.l.it=Yc}else if(N.vr(Oa)&&bb.name==ib.name){ja.l.mo=Oa;ja.l.ct=ib.speed_ratio;ja.l.Bn=ib.max_speed_angle;var yb=cb.invert(ja.e.W,
new Float32Array(16)),Zc=cb.multiply(yb,Oa.e.W,yb);ja.l.et=Zc;var kc=new Float32Array([1,0,0,0]);Za.transformMat4(kc,Zc,kc);ja.l.dt=kc}else if(N.xr(Oa)&&bb.name==ib.name){ja.l.uo=Oa;ja.l.mq=ib.delta_tach_angle;var yb=cb.invert(ja.e.W,new Float32Array(16)),cd=cb.multiply(yb,Oa.e.W,yb);ja.l.pt=cd;var dc=new Float32Array([1,0,0,0]);Za.transformMat4(dc,cd,dc);ja.l.ot=dc}}}if(4!=ja.l.Ag.length)throw"Not enough wheels for chassis "+ja.name;}else if("HULL"==bb.part){ja.l={};ja.l.Ag=[];ja.l.dj=[];ja.l.Cq=
bb.force_max;ja.l.Cp=bb.brake_max;ja.l.Im=bb.floating_factor;ja.l.No=bb.water_lin_damp;ja.l.Oo=bb.water_rot_damp;ja.l.eh=0;ja.l.li=1;ja.l.Mh=0;ja.l.speed=0;ja.l.Nh=null;for(var dd=ja.Aa?ja.Aa.dupli_group.objects:xb,Dc=0;Dc<dd.length;Dc++)Oa=dd[Dc],Oa.b4w_vehicle&&(ib=Oa.b4w_vehicle_settings,N.lz(Oa)&&bb.name==ib.name?(ja.l.Ag.push(Oa),ja.l.dj.push(new Float32Array(8))):N.wr(Oa)&&bb.name==ib.name?(ja.l.Nh=Oa,ja.l.po=ib.steering_max,ja.l.ht=ib.steering_ratio,ja.l.pr=ib.inverse_control,yb=cb.invert(ja.e.W,
new Float32Array(16)),Uc=cb.multiply(yb,Oa.e.W,yb),ja.l.jt=Uc,Yc=new Float32Array([1,0,0,0]),Za.transformMat4(Yc,Uc,Yc),ja.l.it=Yc):N.vr(Oa)&&bb.name==ib.name?(ja.l.mo=Oa,ja.l.ct=ib.speed_ratio,ja.l.Bn=ib.max_speed_angle,yb=cb.invert(ja.e.W,new Float32Array(16)),Zc=cb.multiply(yb,Oa.e.W,yb),ja.l.et=Zc,kc=new Float32Array([1,0,0,0]),Za.transformMat4(kc,Zc,kc),ja.l.dt=kc):N.xr(Oa)&&bb.name==ib.name&&(ja.l.uo=Oa,ja.l.mq=ib.delta_tach_angle,yb=cb.invert(ja.e.W,new Float32Array(16)),cd=cb.multiply(yb,
Oa.e.W,yb),ja.l.pt=cd,dc=new Float32Array([1,0,0,0]),Za.transformMat4(dc,cd,dc),ja.l.ot=dc))}}}for(var rd=0;rd<xb.length;rd++){var ec=xb[rd];if(ec.b4w_floating){var ed=ec.b4w_floating_settings;if("MAIN_BODY"==ed.part){ec.Oc={};ec.Oc.Im=ed.floating_factor;ec.Oc.No=ed.water_lin_damp;ec.Oc.Oo=ed.water_rot_damp;ec.Oc.Pj=[];for(var vd=ec.Aa?ec.Aa.dupli_group.objects:xb,wd=0;wd<vd.length;wd++){var jd=vd[wd];if(jd.b4w_floating){var yd=jd.b4w_floating_settings;N.pz(jd)&&ed.name==yd.name&&(ec.Oc.Pj.push(jd),
jd.cw=jd.b4w_floating_settings.synchronize_position)}}}}}for(Qa=0;Qa<a.scenes.length;Qa++){var xd=a.scenes[Qa];Ec.enabled&&xd.b4w_enable_physics&&(a==Pa||!N.has_physics(f())&&xd==ta.Gm(a))&&N.iz(xd)}e(b,c)}function f(){return ta.Gm(Pa.scenes)}function m(a,b,c,d,e){a!=Pa&&1<a.scenes.length&&(a.scenes=[ta.Gm(a.scenes)],pa.warn("loading data contains multiple scenes.","Only the first one will be loaded."));d=f();-1==wc.Ja&&(wc.Ja=d.fps);1<a.scenes.length&&(a.scenes.splice(a.scenes.indexOf(d),1),a.scenes.unshift(d));
for(var g=0;g<a.scenes.length;g++){var k=a.scenes[g];if(a==Pa&&!k.camera)throw"Scene check failed: No camera";for(var h=ta.gm(k,"MESH"),l=0;l<h.length;l++){var m=h[l],x=La.Jv(m);x&&(a.meshes.push(x),m.data=x)}for(var m=S(a,b.id),x=a.meshes,l=x.slice(0),n=0;n<m.length;n++){var N=m[n];"MESH"==N.type&&(N=l.indexOf(N.data),-1<N&&l.splice(N,1))}for(n=0;n<l.length;n++)x.splice(x.indexOf(l[n]),1);a==Pa?(ta.xv(k,a.textures),k.e.Xh.length&&(b.cn=!0),k.b4w_enable_audio&&Ba.qp(k),m=ta.Tm(k),l=k.b4w_batch_grid_size):
(ta.Dv(k,d,a.textures),k.b4w_enable_audio&&!d.k&&Ba.qp(d),m=ta.Tm(d),l=d.b4w_batch_grid_size);x=[];ba.oy(m,l,h,x);l=d.e.dl;if(l.AA||l.procedural_skydome)l=ba.ry(d.e.Ro,l),x.push(l);for(l=0;l<h.length;l++)ba.cq(h[l],m);for(l=0;l<x.length;l++)ba.cq(x[l],m);a==Pa?(ta.kp(k,x),ta.gy(m)):ta.kp(d,x)}d=a.materials;if(fc.sm&&Fa.Bt)for(a=0;a<d.length;a++){h=d[a];m=h.texture_slots;for(g=0;g<m.length;g++)if(x=m[g],l=x.texture,"IMAGE"==l.type||"ENVIRONMENT_MAP"==l.type)k=l.image,k.mc||(-1<k.filepath.indexOf(".dds")?
k.mc=!0:(k.mc=!l.b4w_disable_compression&&!x.use_map_normal&&"ENVIRONMENT_MAP"!=l.type&&!l.b4w_shore_dist_map&&"MOVIE"!=k.source,k.mc&&(k.filepath+=".dds")));if(g=h.node_tree)for(h=g.nodes,g=0;g<h.length;g++)k=h[g],"TEXTURE"==k.type&&(m=k.texture)&&(k=m.image)&&!k.mc&&(k.mc=m.e.Hj&&!m.b4w_disable_compression&&"MOVIE"!=k.source,k.mc&&(k.filepath+=".dds"))}else for(a=a.images,d=0;d<a.length;d++)g=a[d],g.mc=Boolean("FILE"==g.source&&-1<g.filepath.indexOf(".dds"));e(b,c)}function r(a,b,c,d,f){d=a.groups;
a=a.objects;for(var e={},g={},k={},h={},l=0;l<d.length;l++){var m=d[l];e[m.uuid]=m;k[m.uuid]=m}for(l=0;l<a.length;l++)m=a[l],g[m.uuid]=m,h[m.uuid]=m;z(a,null,h,k);for(var x in k)x in e||d.push(k[x]);for(x in h)x in g||a.push(h[x]);f(b,c)}function z(a,b,c,d){for(var f=[],e=0;e<a.length;e++){var g=a[e],k=c[g.uuid];if(g=k.proxy){b&&-1==f.indexOf(g.uuid)&&f.push(g.uuid);for(var h=c[g.uuid],l=h.constraints,g=0;g<l.length;g++){var m=ua.Qf(l[g]);m.name+="_CLONE";k.constraints.push(m)}"b4w_proxy_inherit_anim"in
k&&!k.b4w_proxy_inherit_anim||(k.animation_data&&(h.animation_data=ua.Qf(k.animation_data)),h.b4w_use_default_animation=k.b4w_use_default_animation,h.b4w_auto_skel_anim=k.b4w_auto_skel_anim,h.b4w_anim_behavior=k.b4w_anim_behavior,h.b4w_cyclic_animation=k.b4w_cyclic_animation)}}for(e=0;e<f.length;e++)k=ua.Um(a,"uuid",f[e]),-1<k&&a.splice(k,1);f={};for(e=0;e<a.length;e++)g=a[e],k=c[g.uuid],b&&(l=ua.Qf(k),k="origin_name"in k?k.origin_name:k.name,l.name=b+"*"+k,l.origin_name=k,w(l),c[l.uuid]=l,f[g.uuid]=
l.uuid,g.uuid=l.uuid),k=c[g.uuid],k.dupli_group&&(g=k.dupli_group,l=d[g.uuid],h=ua.Qf(l),h.name=ua.nj(l.name+"_CLONE"),h.uuid=qa.jr("Group"+h.name),d[h.uuid]=h,g.uuid=h.uuid,z(h.objects,k.name,c,d));if(b)for(e=0;e<a.length;e++){g=a[e];k=c[g.uuid];k.parent&&k.parent.uuid in f?k.parent.uuid=f[k.parent.uuid]:k.parent&&(pa.warn("Object's \""+k.name+'" parent is not in dupli group. Disabling parenting.'),k.parent=null);l=k.constraints;for(g=0;g<l.length;g++)b=l[g],b.target&&b.target.uuid in f&&(b.target.uuid=
f[b.target.uuid]);b=k.modifiers;for(g=0;g<b.length;g++)d=b[g],d.object&&d.object.uuid in f&&(d.object.uuid=f[d.object.uuid]);if((k=k.lod_levels)&&k.length)for(g=0;g<k.length;g++)b=k[g],b.object&&b.object.uuid in f&&(b.object.uuid=f[b.object.uuid])}for(var x in f)mc[x]=f[x]}function w(a){a.uuid=qa.jr("Object"+a.name)}function E(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var f=c[d];"TEXTURE"==f.type&&f.texture&&y(f,"texture",b);"LAMP"==f.type&&f.lamp&&(f.lamp.uuid in mc&&(f.lamp.uuid=mc[f.lamp.uuid]),
b[f.lamp.uuid]||(f.lamp=null));"GROUP"==f.type&&f.node_group&&y(f,"node_group",b)}f=a.links;for(d=0;d<f.length;d++){var e=f[d];H(e,"from_node",c);H(e,"to_node",c);v(e,"from_socket",e.from_node.outputs);v(e,"to_socket",e.to_node.inputs)}if(c=a.animation_data)if(c.action&&y(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(f=c.nla_tracks[d],e=0;e<f.strips.length;e++)f.strips[e].action&&y(f.strips[e],"action",b)}function y(a,b,c){(c=c[a[b].uuid])||pa.error("Dangling link found:",b,a);
a[b]=c}function H(a,b,c){c=ua.keysearch("name",a[b].name,c);a[b]=c}function v(a,b,c){c=ua.keysearch("identifier",a[b].identifier,c);a[b]=c}function B(a,b,c,f,e,g){if(!Fa.do_not_load_resources){for(var k=W(b.r),h=a.images,l={},m=[],x=0;x<h.length;x++){var n=h[x],N=n.uuid;if("FILE"===n.source||"MOVIE"===n.source){var q=t(n,a.textures);if(!q.length)pa.warn("image ",n.name," has no users.");else if(!q[0].b4w_shore_dist_map){q=ua.Ek(k+n.filepath);if("FILE"===n.source){var r=n.mc?ca.AT_ARRAYBUFFER:ca.AT_IMAGE_ELEMENT;
fc.Cn&&Fa.ll&&(q=ca.kj(q),"dds"==q[1]?(q=ca.kj(q[0]),q=q[0]+".min50."+q[1]+".dds"):q=q[0]+".min50."+q[1])}else"MOVIE"===n.source&&(Fa.Wc?(q=ca.kj(q),q=q[0]+".altconv.seq",r=ca.wj):(q=ca.kj(q),r=Ba.detect_video_container(q[1]),q=r!=q[1]?q[0]+".altconv."+r:q[0]+"."+r,r=ca.xj));m.push([N,r,q]);l[N]=n}}}m.length?(f.kr=0,ca.enqueue(m,function(e,k,h,x){if(e){if(h==ca.xj||h==ca.wj){if(h==ca.xj)var n=e.videoWidth,q=e.videoHeight;else n=e.images[0].width,q=e.images[0].height;pa.log("%cLOAD VIDEO "+n+"x"+q,
"color: #"+(2048<n||2048<q?"a00":1024<n||1024<q?"aa0":"0a0"),x);-1==x.indexOf(Fb)&&pa.warn("video",x,"is not from app root.")}else d(e,x,!0);k=l[k];x=t(k,a.textures);for(n=0;n<x.length;n++){var q=x[n],N=q.image.filepath;h==ca.wj?(q.e.Ks=e.ac,vb.oj(q.e,e.images,k.mc,N,b.id)):vb.oj(q.e,e,k.mc,N,b.id)}}e=++f.kr/m.length;g(b,c,e)},function(){pa.log("%cLOADED ALL IMAGES","color: #0a0");e(b,c)})):e(b,c)}}function t(a,b){for(var c=[],d=0;d<b.length;d++){var f=b[d];f.image===a&&c.push(f)}return c}function u(a,
b,c,d,f,e){if(!Fa.do_not_load_resources){a=S(a,b.id);for(var g=W(b.r),h=[],l={},m=0;m<a.length;m++){var x=a[m];if(k(x)){var n=x.data.sound,q=n.uuid;"BACKGROUND_MUSIC"==Ba.Vm(x)?(q=ua.Iq(),b.bn=!0):"NONE"!=Ba.Vm(x)&&Fa.nr&&(b.fn=!0);if(!(q in l)){l[q]=[];n=ua.Ek(g+n.filepath);switch(Ba.at(x)){case Ba.rl:var N=ca.AT_AUDIOBUFFER;break;case Ba.So:N=ca.AT_AUDIO_ELEMENT}var n=ca.kj(n),r=Ba.detect_audio_container(n[1]),n=r!=n[1]?n[0]+".altconv."+r:n[0]+"."+r;h.push([q,N,n])}l[q].push(x)}}h.length?ca.enqueue(h,
function(a,f,g,k){if(a)for(pa.log("%cLOAD SOUND","color: #0aa",k),-1==k.indexOf(Fb)&&pa.warn("sound",k,"is not from app root."),f=l[f],g=0;g<f.length;g++)Ba.xC(f[g],a);a=++d.wB/h.length;e(b,c,a)},function(){pa.log("%cLOADED ALL SOUNDS","color: #0aa");f(b,c)}):f(b,c)}}function k(a){return Ba.ne(a)&&Ba.at(a)!=Ba.To?!0:!1}function q(a,b){for(var c=ta.Ka(a,"SPEAKER",ta.DATA_ID_ALL),d=0;d<c.length;d++){var f=c[d];Ba.ne(f)&&(Ba.is_cyclic(f)||b)&&Ba.play_def(f)}}function J(a){a=a.e.Xh;for(var b=0;b<a.length;b++)Fa.Wc&&
a[b].use_auto_refresh?a[b].e.Fh=!0:a[b].e.Qa&&a[b].use_auto_refresh&&a[b].e.Qa.play()}function G(a,b,c,d,f){T.start();pa.log("%cSTART NLA","color: #0a0");f(b,c)}function D(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var f=b.lod_levels.length,e=0;e<f;e++){var g=b.lod_levels[e],k=g.object;if(k){var h=ua.ni(k);h.name=b.name+"_LOD_"+String(e+1);w(h);h.lod_levels=[];c.push([a,h]);d.push(k);g.object=h}}}function L(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,f=0;f<d.length;f++){var e=d[f].dupli_group;
e&&(e=e.objects,g=e.indexOf(a),-1<g&&e.splice(g,1))}var g=d.indexOf(a);-1<g&&d.splice(g,1)}}function K(a,b,c,d,f){d=!0;for(var e=0;e<a.scenes.length;e++)if(!N.xw(a.scenes[e])){d=!1;break}d&&(f(b,c),pa.log("%cPHYSICS READY","color: #0a0"))}function O(a,b,c,d,e){d=f();for(var g=0;g<a.scenes.length;g++){var k=a.scenes[g],h=a==Pa?N.has_physics(k):N.has_physics(d)||N.has_physics(k);a==Pa||(k=d);for(var l=0;l<ma.length;l++)for(var m=ta.Ka(k,ma[l],ta.DATA_ID_ALL),x=0;x<m.length;x++){var n=m[x];n.e.sc==b.id&&
Ec.enabled&&h&&(N.append_object(n,k),b.un&&N.has_physics(n)&&N.disable_simulation(n))}}e(b,c)}function A(a,b,c,f,e){var g={};f=[];for(var k=a.scenes,h=0;h<a.scenes.length;h++){var l=k[h];if(l.e.gb&&(l=l.e.gb.bl)&&"FILE"===l.source){var m=l.uuid,x=ua.Ek(W(b.r)+l.filepath);f.push([m,l.mc?ca.AT_ARRAYBUFFER:ca.AT_IMAGE_ELEMENT,x]);g[m]=l}}f.length?ca.enqueue(f,function(c,f,e,h){if(c){d(c,h,!0);f=g[f];h=t(f,a.textures);for(e=0;e<h.length;e++){var l=h[e];vb.oj(l.e,c,f.mc,l.image.filepath,b.id)}for(e=0;e<
k.length;e++)if(h=k[e],h.e.gb.bl===f){var m=c,x=document.createElement("canvas"),l=f.size[0],n=f.size[1];x.width=l;x.height=n;x=x.getContext("2d");x.drawImage(m,0,0);m=x.getImageData(0,0,l,n).data;x=new Float32Array(4);x[0]=1/16581375;x[1]=1/65025;x[2]=1/255;x[3]=1;for(var l=l*n,n=new Float32Array(l),q=0;q<l;q++)n[q]=x[1]*m[4*q+2]+x[2]*m[4*q+3];h.e.bo=n}}},function(){e(b,c)}):e(b,c)}function I(a,b,c,f,e){if(Fa.antialiasing&&Fa.smaa){f=a.scenes[0];a=[];for(var g=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION",
"SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],k=0;k<g.length;k++){var h=ta.aa(f,g[k]);h&&a.push(h)}if(a.length){f=[];k=ca.AT_IMAGE_ELEMENT;f.push(["SEARCH_TEXTURE",k,F.Ub.smaa_search_texture_path]);f.push(["AREA_TEXTURE",k,F.Ub.smaa_area_texture_path]);for(k=0;k<a.length;k++)if(g=a[k],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.ha;for(k=0;k<a.length;k++)if(g=a[k],"u_search_tex"==g.qa)var l=g.va;else if("u_area_tex"==g.qa)var m=g.va;break}f.length?ca.enqueue(f,function(a,c,f,e){a&&(d(a,e,!1),c=
"SEARCH_TEXTURE"==c?l:m,c.source="IMAGE",c.vp=!0,vb.oj(c,a,-1!=e.indexOf(".dds")?1:0,e,b.id),vb.ij(c,vb.s,vb.s))},function(){e(b,c)}):e(b,c)}else e(b,c)}else e(b,c)}function C(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];a==Pa||(e=f());for(var g=ta.Ka(e,"LAMP",ta.DATA_ID_ALL),k=0;k<g.length;k++){var h=g[k];h.e.sc==b.id&&(b.un&&ua.is_mesh(h)&&ta.hide_object(h),d.Bl.push({Js:e,obj:h}))}g=ta.Ka(e,"ALL",ta.DATA_ID_ALL);for(k=0;k<g.length;k++)h=g[k],"LAMP"!=h.type&&h.e.sc==b.id&&(b.un&&ua.is_mesh(h)&&
ta.hide_object(h),d.Bl.push({Js:e,obj:h}))}}function Q(a,b,c,d,f,e){f=d.Bl;var g=d.Ur;f.length?(a=f[g].obj,g=f[g].Js,ta.append_object(g,a,!1),-1!=Qc.indexOf(a.type)&&g.b4w_enable_audio&&Ba.append_object(a,g),aa.is_anchor(a)&&aa.append(a),d=++d.Ur/f.length,"LAMP"==a.type&&ta.vB(g),null!=a.e.qc&&ta.wt(g,a),a.e.Dc&&"PLANE"==a.e.ue&&g.e.Ab&&(ta.Sv(a,g),ta.zt(a.e.Ac,g))):d=1;e(b,c,d)}function M(a,b,c,d,e){if(a==Pa){d=ta.Ny();for(var g=ta.ih(),k=0;k<d.length;k++){var h=d[k];ta.pA(h,g);h.b4w_use_nla&&T.uC(h,
h.b4w_nla_cyclic,b.id)}ta.set_active(g)}else ta.At(f());a=S(a,b.id);x.sC(a);e(b,c)}function V(a,b,c,d,e){if(a==Pa)for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||J(a.scenes[d]),q(a.scenes[d]);else a.scenes[0].b4w_use_nla||J(f()),q(f());e(b,c)}function R(a,b,c,d,f){Fa.gg&&(b.cn||b.bn||b.fn)?nb||Z(a,f,b,c):f(b,c)}function Z(a,b,c,d){var e=la.parentElement;$a=e.style.zIndex;e.style.zIndex="999";nb=document.createElement("div");nb.style.position="relative";nb.style.height="88px";nb.style.width=
"88px";var g=Math.round(la.offsetWidth/2-44);nb.style.top=Math.round(la.offsetHeight/2-44).toString()+"px";nb.style.left=g.toString()+"px";nb.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC')";
nb.style.backgroundSize="88px";Qa=document.createElement("div");Qa.style.position="relative";Qa.style.height=la.offsetHeight.toString()+"px";Qa.style.width=la.offsetWidth.toString()+"px";Qa.style.background="rgba(0, 0, 0, 0.5)";Qa.style.zIndex="999";e.appendChild(Qa);Qa.appendChild(nb);nb.addEventListener("click",function(){c.cn&&(vb.play(),vb.pause(),vb.reset());if(c.bn){if(a==Pa)for(var e=0;e<a.scenes.length;e++)q(a.scenes[e],!0);else q(f(),!0);Ba.pause()}c.fn&&Ba.iA();fa();b(c,d)},!1)}function fa(){if(nb){var a=
la.parentElement;a.style.zIndex=$a;Qa.removeChild(nb);a.removeChild(Qa);nb=Qa=null;$a=0}}function W(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function ha(a,b,c){ea.is_animated(b)&&ea.remove(b);ta.clear_outline_anim(b);N.has_physics(b)&&N.xA(b);U.check_sensor_manifold(b)&&U.remove_sensor_manifold(b);ta.yA(a,b,c);Ba.ne(b)&&Ba.yB(b);aa.is_anchor(b)&&aa.remove(b)}function S(a,b){Eb[b]||oa(a,b);return Eb[b]}function oa(a,b){for(var c=a.scenes,d=[],f=0;f<c.length;f++)da(c[f].objects,
0,a==Pa,d);Eb[b]=[];for(f=0;f<d.length;f++)for(var c=d[f],e=0;e<c.length;e++)for(var g=c[e],k=0;k<g.length;k++)Eb[b].push(g[k])}function da(a,b,c,d){d[b]=d[b]||[];for(var f=d[b],e=0;e<a.length;e++){var g=a[e],k=ga(g);f[k]=f[k]||[];(c||-1==Fc.indexOf(g.type))&&-1==f[k].indexOf(g)&&f[k].push(g);(g=g.dupli_group)&&da(g.objects,b+1,c,d)}}function ga(a){return(a=a.parent||ea.get_first_armature_object(a))?1+ga(a):0}var aa=p("__anchors"),ea=p("__animation"),ba=p("__batch"),F=p("__config"),U=p("__controls"),
Y=p("__dds"),na=p("__extensions");p("__lights");var ia=p("__loader"),ca=p("__assets"),qa=p("__md5"),x=p("__objects"),N=p("__physics"),pa=p("__print"),La=p("__reformer"),P=p("__renderer"),ta=p("__scenes"),T=p("__nla"),Ba=p("__sfx"),lc=p("__shaders"),vb=p("__textures"),ka=p("__nodemat"),ua=p("__util");p("__transform");var Za=p("vec4"),cb=p("mat4"),Fa=F.p,fc=F.Vd,Ec=F.Xa,wc=F.Ud,gc=F.kd,xa=null,Eb=null,Fb="",Pa=null,mc={},nb=null,Qa=null,$a=0,Fc=["LAMP","CAMERA"],ma=["MESH","CAMERA","EMPTY"],Qc=["SPEAKER"],
la=null;a.is_primary_loaded=function(a){return ia.is_primary_loaded(a)};a.update=function(){ia.vC(xa)};a.kB=function(a){la=a};a.rC=function(a,b){if(nb){Qa.style.height=b.toString()+"px";Qa.style.width=a.toString()+"px";var c=Math.round(a/2-44);nb.style.top=Math.round(b/2-44).toString()+"px";nb.style.left=c.toString()+"px"}};a.load=function(a,d,f,k,l){var x={load_main:{Pa:ia.Od,bb:!1,G:[],eb:!1,fb:500,rb:!1,cb:b},duplicate_objects:{Pa:ia.pd,bb:!1,G:["load_main"],eb:!1,fb:50,rb:!1,cb:r},load_binaries:{Pa:ia.Od,
bb:!1,G:["load_main"],eb:!1,fb:500,rb:!1,cb:e},wait_for_shaders:{Pa:ia.Od,bb:!0,G:[],eb:!1,fb:50,rb:!0,cb:h,Oe:h},prepare_bindata:{Pa:ia.pd,bb:!1,G:["duplicate_objects","load_binaries"],eb:!1,fb:0,rb:!1,cb:g},prepare_root_datablocks:{Pa:ia.pd,bb:!1,G:["duplicate_objects","prepare_bindata"],eb:!1,fb:150,rb:!1,cb:n},prepare_root_scenes:{Pa:ia.pd,bb:!1,G:["prepare_root_datablocks","wait_for_shaders"],eb:!1,fb:350,rb:!1,cb:m},load_smaa_textures:{Pa:ia.Od,bb:!0,G:["prepare_root_scenes"],eb:!1,fb:10,rb:!0,
cb:I},load_shoremap:{Pa:ia.Od,bb:!0,G:["prepare_root_scenes"],eb:!1,fb:10,rb:!0,cb:A},load_textures:{Pa:ia.Od,bb:!0,G:["prepare_root_scenes"],eb:!0,fb:500,rb:!1,cb:B,Pf:{kr:0}},wait_physics_workers:{Pa:ia.Od,bb:!0,G:["load_shoremap"],eb:!1,fb:20,rb:!1,Oe:K},add_physics_objects:{Pa:ia.pd,bb:!1,G:["wait_physics_workers"],eb:!1,fb:20,rb:!1,cb:O},add_objects:{Pa:ia.pd,bb:!1,G:["add_physics_objects"],eb:!1,fb:800,rb:!1,cb:C,Oe:Q,mi:M,Pf:{Bl:[],Ur:0}},load_speakers:{Pa:ia.Od,bb:!0,G:["add_objects"],eb:!0,
fb:30,rb:!1,cb:u,Pf:{wB:0}},mobile_media_start:{Pa:ia.pd,bb:!Fa.gg,G:["load_textures","load_speakers"],eb:!0,fb:5,rb:!1,cb:R,Oe:R},synchronize_media:{Pa:ia.pd,bb:!0,G:["mobile_media_start"],eb:!0,fb:70,rb:!1,cb:V},start_nla:{Pa:ia.pd,bb:!0,G:["mobile_media_start"],eb:!1,fb:5,rb:!1,cb:G}},q=ia.Wq();q||(q=ia.fx(),xa={},Eb={},mc={});xa[q.Id.length]={};return ia.mx(x,a,d,f,c,k||gc.sp,Fa.do_not_load_resources,l)};a.unload=function(a){var b=ia.Wq();if(!b||!b.Id.length||a&&!ia.XB(b.Id[a]))pa.error("Unable to unload data!");
else{if(0==a)pa.log("%cUNLOAD ALL","color: #00a"),aa.cleanup(),ea.cleanup(),Ba.cleanup(),T.cleanup(),ta.cleanup(),ia.cleanup(),N.cleanup(),x.cleanup(),ua.cleanup(),P.cleanup(),ka.cleanup(),lc.cleanup(),U.cleanup(),na.cleanup(),ca.cleanup(),vb.cleanup(),Eb=null,mc={},xa=Pa=null;else{pa.log("%cUNLOAD DATA "+a,"color: #00a");ea.wA(a);for(var b=ta.Hi(),c=0;c<b.length;c++)for(var d=b[c],f=ta.Ka(d,"ALL",ta.DATA_ID_ALL),e=f.length-1;0<=e;e--){var g=f[e];if(g.e.sc==a){ha(d,g,!0);f.splice(e,1);var k=ta.Ka(d,
g.type,ta.DATA_ID_ALL),g=k.indexOf(g);-1!=g&&k.splice(g,1)}}}fa()}};a.oA=ha;a.set_debug_resources_root=function(a){Fb=a}};b4w.module.__batch=function(a,p){function c(a){a={type:a,La:"",id:0,zA:0,zh:"",M:[],Hb:[],Tc:[],pi:[],Mg:null,tb:{},Yb:null,Bb:null,rp:[],zc:null,U:null,Pc:null,Kd:!1,$g:!1,iq:!1,wireframe_mode:0,num_vertices:0,num_triangles:0,yr:0,zr:0,Zq:0,Xm:0,bc:new Float32Array(3),pc:new Float32Array(16),Ea:!1,Vp:!1,Z:!1,Fe:!1,Na:!1,md:!1,vd:!1,Fc:!1,ic:!1,jc:!1,Wb:!1,Nb:!1,Dc:!1,xb:!1,us:!1,ge:R.ci,He:R.Rd,Yf:!1,Sn:"",nF:"",$q:!1,dr:0,ar:0,er:0,fr:0,cr:new Float32Array(3),br:new Float32Array(3),dg:!1,Td:0,he:0,
Re:1,reflect_factor:0,bt:0,ko:1,parallax_scale:0,Qe:0,Ke:1,Qr:0,Dn:0,ug:0,Cs:0,tc:Array(2),kc:new Float32Array(3),vf:new Float32Array(3),Ed:new Float32Array(3),Rc:new Float32Array(4),cd:new Float32Array(4),qh:null,on:null,mn:null,ln:null,nn:null,kh:!1,Af:!1,water_dynamic:!1,ql:!1,Lt:!1,Mt:0,Nt:0,Kt:0,ai:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,Bq:new Float32Array(2),Aq:new Float32Array(2),Jm:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
sg:null,Xn:!1,fs:0,bs:0,Ln:0,es:0,hs:0,gs:0,cs:0,ds:0,Mn:0,Zr:0,Yr:0,ks:0,as:0,Lk:new Float32Array(3),js:new Float32Array(8),$r:new Float32Array(16)};a.Rc[3]=1;a.Vp=!0;a.Z=!0;return a}function d(a){switch(a.type){case "MAIN":case "PARTICLES":a.La=a.Ea?a.Fe?"XRAY":"BLEND":"OPAQUE";break;case "DEPTH":a.La=a.kh?"NODES":"DEPTH";break;case "COLOR_ID":a.La=a.Fe?"COLOR_ID_XRAY":"COLOR_ID"}}function b(a){var b=a.U,c=a.zc;a.U=null;a.zc=null;var d=W.Yp(a);a.U=b;d.U=b;a.zc=c;d.zc=c;return d}function e(a,b){for(var c=
[],d=0;d<a.length;d++){var f=a[d],e=f.e,k=l(f.data.b4w_bounding_box),h=f.data.b4w_bounding_cylinder_radius,m=f.data.b4w_bounding_sphere_radius,n=f.data.b4w_bounding_sphere_center,q=f.data.b4w_bounding_ellipsoid_axes,r=f.data.b4w_bounding_ellipsoid_center;if(e.sd){var m=Math.max(Math.abs(k.max_x),Math.abs(k.min_x)),h=Math.max(Math.abs(k.max_y),Math.abs(k.min_y)),F=Math.max(Math.abs(k.max_z),Math.abs(k.min_z)),F=Math.sqrt(m*m+h*h+F*F),m=Math.sqrt(m*m+h*h);k.max_x=k.max_y=k.max_z=F;k.min_x=k.min_y=k.min_z=
-F;h=m;m=F;n[0]=n[1]=n[2]=0;q[0]=q[1]=q[2]=F;r[0]=r[1]=r[2]=0}e.Qb=k;F=I.Tl(k,e.W);e.hb=F;var F=e,t=h;F.Nl=I.bq(t,k);F.Ll=I.$p(h,k);F.Ml=I.aq(t,k);n=I.lm(m,n);e.$c=n;n=I.Vl(n,e.W);e.wb=n;q=I.km([q[0],0,0],[0,q[1],0],[0,0,q[2]],r);e.Lf=q;q=I.Ul(q,e.Cb);e.Mf=q;c=c.concat(g(f,e,b))}return c}function h(a,b,c){for(var d=[],f=[],e={},k=0;k<a.length;k++){var h=a[k],m=h.e,n=l(h.data.b4w_bounding_box),q=I.Tl(n,m.W),r=I.lm(h.data.b4w_bounding_sphere_radius,h.data.b4w_bounding_sphere_center),z=I.Vl(r,m.W),u=
h.data.b4w_bounding_ellipsoid_axes,u=I.km([u[0],0,0],[0,u[1],0],[0,0,u[2]],h.data.b4w_bounding_ellipsoid_center),w=I.Ul(u,m.Cb);m.Qb=n;m.hb=q;m.$c=r;m.wb=z;m.Lf=u;m.Mf=w;n={};n.Fc=m.Fc;n.ic=m.ic;n.jc=m.jc;n.Eg=m.Eg;n.Hk=m.Hk;n.Gb=m.Gb;n.Gk=m.Gk;n.Ti=m.Ti;n.Wb=m.Wb;n.Nb=m.Nb;n.Dc=m.Dc;n.qc=m.qc;n.Ac=m.Ac;n.ue=m.ue;n.Zd=m.Zd;n.Lc=m.Lc;n.pe=m.pe;n.Kb=m.Kb;n.sd=m.sd;n.ki=m.ki;n.ji=m.ji;n.xb=m.xb;n.bh=m.bh;n.bk=m.bk;n.qe=m.qe;n.pg=m.pg;n.zk=m.zk;n.xc=m.xc;n.og=m.og;n.Ak=m.Ak;n.vd=m.vd;q=m.wb.F;n.$y=0==
c?[0,0]:[Math.floor(q[0]/c),Math.floor(q[2]/c)];n.cf=m.cf;n.Qi=m.Qi;n.ng=m.ng;m=JSON.stringify(n);e[m]=e[m]||[];e[m].push(h)}for(var v in e){n=JSON.parse(v);c=e[v];var h=W.Xj("STATIC"),p;for(p in n)h[p]=n[p];h.sc=a[0].e.sc;h.Md=0;h.Ee=0;h.ce=0;h.be=0;h.Xd=0;h.mh=!1;for(k=0;k<c.length;k++)m=c[k],0==k?(h.hb=F.la(m.e.hb),h.wb=F.la(m.e.wb),h.Lf=F.la(m.e.Lf),h.Mf=F.la(m.e.Mf)):(I.sq(h.hb,m.e.hb),I.Ox(h.wb,m.e.wb));h.Qb=F.la(h.hb);h.$c=F.la(h.wb);f.push({Xb:h,te:c})}for(a=0;a<f.length;a++)for(e=f[a].Xb,
k=f[a].te,v=0;v<k.length;v++){p=k[v];c=g(p,e,b);p.e.sd&&!p.e.Ql?(h=ba.create(),ba.set_trans(p.e.h,h)):(h=p.e,h=ba.create_sep(h.h,h.scale,h.quat));m={};if(e.Lc||e.sd)m.au_center_pos=[h[0],h[1],h[2]];e.Lc&&(m.au_wind_bending_amp=[p.e.Md],m.au_wind_bending_freq=[p.b4w_wind_bending_freq],m.au_detail_bending_amp=[p.b4w_detail_bending_amp],m.au_detail_bending_freq=[p.b4w_detail_bending_freq],m.au_branch_bending_amp=[p.b4w_branch_bending_amp]);for(n=0;n<c.length;n++)z=c[n].Xb,q=c[n].Hc,r=c[n].B,z.vk?z.sd?
R.NB(q,h):R.lt(q,h):("COLOR_ID"==r.type&&(z=c[n].Xb=p.e,r.zh=p.uuid,t(r,z),D(r,F.Xg(z,0))),q=R.lt(q,h),R.MB(q,m));d=d.concat(c)}return d}function g(a,b,d){var e=[],g=n(d,b),h=F.Xg(b,0),m=a.data,l=m.materials,q=Array(l.length),r=ga.Ia(d,"MAIN_OPAQUE"),z=!1;r&&(z=r.bf.length?!0:!1);for(var u=0;u<g.length;u++){var w=g[u];if(!a.b4w_do_not_render||"PHYSICS"==w)for(var v=0;v<l.length;v++){var p=l[v];if(("LENS_FLARES"!=p.name||z)&&!R.gr(m,v)){var C=c(w);"MAIN"==w&&(q[v]=C);if(G(C,p)){"DEPTH"==w&&q[v]&&(C.md=
q[v].md);C.ge=b.Kd||b.vd?R.yj:R.ci;t(C,b);for(var I=C,Y=a.particle_systems,A=0;A<Y.length;A++){var y=Y[A].settings.b4w_vcol_from_name,E=Y[A].settings.b4w_vcol_to_name;""!==y&&""!==E&&(I.tb[y]={ag:!1,src:[{name:y,Sc:7}]})}"DYNAMIC"==b.type&&(C.zh=a.uuid);D(C,h);var B=R.wq(m,v,C.pi,C.Pc,C.tb,C.Mg);"LENS_FLARES"==p.name&&(B=ha.nA(B));e.push({B:C,Hc:B,dc:[p.name],Xb:b,gd:[a]})}}}}var qa=a.particle_systems;if(0<qa.length&&e.length){for(var na=!1,L=!1,u=0;u<qa.length;u++){var K=qa[u],Q=K.settings;Q.use_render_emitter&&
(na=!0);"HAIR"!=Q.type||"OBJECT"!=Q.render_type&&"GROUP"!=Q.render_type&&K.transforms.length||(L=!0);if(na&&L)break}var H=e[0].B.tb,ca;if(L){var O;if(1<l.length){for(var V={},ba=0;ba<qa.length;ba++){var ea=qa[ba].settings;if("HAIR"==ea.type&&("OBJECT"==ea.render_type||"GROUP"==ea.render_type)){var S=ea.b4w_vcol_from_name,Z=ea.b4w_vcol_to_name;""!==S&&""!==Z&&(V[S]=F.la(H[S]))}}"a_bending_col_main"in H&&(V.a_bending_col_main=F.la(H.a_bending_col_main));"a_bending_col_detail"in H&&(V.a_bending_col_detail=
F.la(H.a_bending_col_detail));O=R.xq(m,[],V)}else O=e[0].Hc;ca=O}else ca=null;for(var W,fa=ca,da=[],Xb=a.particle_systems,Rc=a.data,Gc=0;Gc<Xb.length;Gc++){var wa=Xb[Gc],Ia=wa.settings;if(Ia.count)if("EMITTER"==Ia.type){if("DYNAMIC"==b.type){var db=c("PARTICLES"),Ra,Va=Rc.materials,Yb=wa.settings.material-1;Yb>=Va.length&&(M.warn('Wrong material used for rendering particle system "'+wa.name+'"'),Yb=0);Ra=Va[Yb];"HALO"===wa.settings.render_type&&(db.dg=!0);f(db,Ra);t(db,b);var ob=db,Ta=wa.settings;
switch(Ta.b4w_billboard_align){case "VIEW":k(ob,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":k(ob,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":k(ob,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":k(ob,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}k(ob,"BILLBOARD",0);k(ob,"SOFT_PARTICLES",Ta.b4w_enable_soft_particles&&0<Ta.b4w_particles_softness&&ia.vi?1:0);k(ob,"SOFT_STRENGTH",aa.t(Ta.b4w_particles_softness));aa.D(ob.Bb,"WORLD_SPACE",
"WORLD"==Ta.b4w_coordinate_system?1:0);db.vd=!0;db.zh=a.name+"_"+Ia.uuid;db.Sn=wa.name;D(db,h);db.zc=wa;var Da=ha.ky(db,Rc,wa,a.e.Cb);ha.VA(db,wa,Ra);da.push({B:db,Hc:Da,dc:[Ra.name],Xb:b,gd:[a]})}}else if("HAIR"==Ia.type){var jb=F.qk(wa.seed);Ia.b4w_dynamic_grass&&(b.bh=!0);var Na=oa.Np(ia.wn)&&!Ia.b4w_initial_rand_rotation&&!Ia.b4w_hair_billboard,Ma=4;Na&&(Ma=8);if(wa.transforms.length)var Ca=wa.transforms;else for(var za=R.Qm(fa,Ia.count,!1,jb),Ca=new Float32Array(za.length*Ma),ra=0;ra<za.length;ra++){var Ib=
.75+.5*F.Vc(jb);Ca[ra*Ma]=za[ra][0];Ca[ra*Ma+1]=za[ra][1];Ca[ra*Ma+2]=za[ra][2];Ca[ra*Ma+3]=Ib;Na&&(Ca[ra*Ma+4]=1,Ca[ra*Ma+5]=0,Ca[ra*Ma+6]=0,Ca[ra*Ma+7]=0)}var Jb=ga.Ia(d,"GRASS_MAP")?!0:!1;if("OBJECT"==Ia.render_type)var ya=[n(d,Ia.dupli_object.e,!0)],Zb=J(a,b,H,fa,[Ia.dupli_object],ya,[Ca],Ia,wa,Jb,jb,!1),da=da.concat(Zb);else if("GROUP"==Ia.render_type){for(var X=Ia.dupli_group.objects,Rb=!1,ya=[],ra=0;ra<X.length;ra++){var Xa=n(d,Ia.dupli_group.objects[ra].e,!0);ya.push(Xa)}if(Ia.use_whole_group){for(var Aa,
va=Ca,$b=X,sc=Na,pb=Ma,Sa={},sb=new Float32Array([0,0,0,1]),Ja=0;Ja<va.length;Ja+=pb)for(var kb=0;kb<$b.length;kb++){var nc=U.create();U.scale($b[kb].e.h,$b[kb].e.scale,nc);var Kb=U.clone([va[Ja],va[Ja+1],va[Ja+2]]);Sa[kb]||(Sa[kb]=new Float32Array(va.length));sc&&(Sa[kb][Ja+4]=sb[0]=va[Ja+4],Sa[kb][Ja+5]=sb[1]=va[Ja+5],Sa[kb][Ja+6]=sb[2]=va[Ja+6],Sa[kb][Ja+7]=sb[3]=va[Ja+7],F.Tn(sb,sb),F.aC(nc,sb,nc));U.add(Kb,nc,Kb);Sa[kb][Ja]=Kb[0];Sa[kb][Ja+1]=Kb[1];Sa[kb][Ja+2]=Kb[2];Sa[kb][Ja+3]=va[Ja+3]}Aa=
Sa;Rb=!0}else{var ab;if(Ia.use_group_count){for(var Lb=Ca,Hc=X,Mb=Ia.dupli_weights,Ic=jb,Wa=Na,eb=Ma,qb={},Sb=[],fb=0;fb<Hc.length;fb++)for(var Tb=Hc[fb],Hb=Tb.origin_name||Tb.name,oc=0;oc<Mb.length;oc++){var sa=Mb[oc];Hb==sa.name.split(": ")[0]&&Sb.push(sa)}Mb.length!=Sb.length&&M.error("dupli weights match failed");for(fb=0;fb<Lb.length;fb+=eb){for(var gb,rb=Sb,ac=[0],Ga=0;Ga<rb.length;Ga++)ac[Ga+1]=ac[Ga]+rb[Ga].count;for(var xc=ac[ac.length-1]*F.Vc(Ic),Nb=0,Ga=0;Ga<ac.length;Ga++)if(xc>=ac[Ga]&&
xc<ac[Ga+1]){Nb=Ga;break}gb=Nb;qb[gb]=qb[gb]||[];qb[gb].push(Lb[fb],Lb[fb+1],Lb[fb+2],Lb[fb+3]);Wa&&qb[gb].push(Lb[fb+4],Lb[fb+5],Lb[fb+6],Lb[fb+7])}for(gb in qb)qb[gb]=new Float32Array(qb[gb]);ab=qb}else{for(var hb=Ca,lb=jb,tc=Na,Ab=Ma,hc=X.length,tb={},mb=0;mb<hb.length;mb+=Ab){var Bb=Math.floor(hc*F.Vc(lb));tb[Bb]=tb[Bb]||[];tb[Bb].push(hb[mb],hb[mb+1],hb[mb+2],hb[mb+3]);tc&&tb[Bb].push(hb[mb+4],hb[mb+5],hb[mb+6],hb[mb+7])}for(Bb in tb)tb[Bb]=new Float32Array(tb[Bb]);ab=tb}Aa=ab}Zb=J(a,b,H,fa,
X,ya,Aa,Ia,wa,Jb,jb,Rb);da=da.concat(Zb)}"INSTANCE"==Ia.b4w_wind_bend_inheritance&&a.e.Lc&&M.warn('Emitter object "'+a.name+"\" has a particle system with wind bending inheritance from the particle instance. Wind bending on the emitter isn't disabled. Expect unforeseen behavior.")}else throw"Unknown particle settings type";}W=da;e=na?e.concat(W):W}return e}function l(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function n(a,b,c){var d=["MAIN","NODES_GLOW"];
(b.Eg&&ga.Ia(a,"COLOR_PICKING")||b.Gb&&ga.Ia(a,"OUTLINE_MASK"))&&!c&&d.push("COLOR_ID");ga.Ia(a,"WIREFRAME")&&d.push("WIREFRAME");d.push("PHYSICS");(ga.Ia(a,"DEPTH")||ga.Ia(a,"SHADOW_CAST"))&&d.push("DEPTH");ga.Ia(a,"GRASS_MAP")&&d.push("GRASS_MAP");if(b.ic||b.Nb)for(a=null,b.ic&&(a=["MAIN","NODES_GLOW","COLOR_ID","PHYSICS","WIREFRAME"]),b.Nb&&(b=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],a=null!==a?F.Nv(a,b):b),b=a,a=0;a<b.length;a++)c=d.indexOf(b[a]),-1!==c&&d.splice(c,1);return d}function f(a,
b){var c;switch(a.type){case "MAIN":if(b.b4w_do_not_render)c=!1;else{if(b.use_nodes)v(a,b,"MAIN");else{r(a,b);var d=b.game_settings.alpha_blend;a.Fe=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;a.ug=b.offset_z;a.vf.set([1,1,1]);var f=b.texture_slots;Y.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Rc);switch(b.name){case "LENS_FLARES":K(a,"special_lens_flares.glslv","special_lens_flares.glslf");u(a,"a_position");u(a,"a_texcoord");var e=z(f[0],null);O(a,e);break;default:K(a,
"main.glslv","main.glslf");var g=w("use_map_color_diffuse",f),h=w("use_map_color_spec",f),l=w("use_map_normal",f),n=w("use_map_mirror",f),e=w("use_stencil",f);c=g[0];h=h[0];l=l[0];n=n[0];g=g[1];f=e[0]&&w("use_rgb_to_intensity",f)[0];if(c){switch(c.blend_type){case "MIX":k(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":k(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}e=z(c,null);O(a,e,"u_colormap0");ia.Fl&&"CLIP"==d&&ea.ij(e,ea.lc,ea.lc);a.Qe=c.diffuse_color_factor;a.Ke=
c.use_map_alpha?c.alpha_factor:0;a.vf.set(c.scale)}d=c&&c==h;h&&(d||(e=z(h,null),O(a,e,"u_specmap0")),a.bt=h.specular_color_factor);if(l&&(u(a,"a_normal"),u(a,"a_tangent"),e=z(l,null),O(a,e,"u_normalmap0"),a.Qr=l.normal_factor,e=l.texture,e.b4w_use_map_parallax&&ia.Xi)){var q=aa.t(e.b4w_parallax_steps),F=aa.t(e.b4w_parallax_lod_dist);k(a,"PARALLAX",1);k(a,"PARALLAX_STEPS",q);k(a,"PARALLAX_LOD_DIST",F);a.parallax_scale=e.b4w_parallax_scale}n&&(e=z(n,null),O(a,e,"u_mirrormap"),a.Dn=n.mirror_factor);
if(n=c&&g&&f?1:0)e=z(g,null),O(a,e,"u_colormap1"),e=z(f,null),O(a,e,"u_stencil0");(e=c||h||l)&&a.vf.set(e.scale);k(a,"TEXTURE_SPEC",void 0==h?0:1);k(a,"ALPHA_AS_SPEC",d?1:0);k(a,"TEXTURE_STENCIL_ALPHA_MASK",n);u(a,"a_position");u(a,"a_normal");(c||h||l)&&u(a,"a_texcoord");if(b.b4w_water){a.Af=!0;a.water_dynamic=b.b4w_water_dynamic;b.b4w_water_shore_smoothing&&!a.Ea?(M.warn('Material: "'+b.name+'" is opaque.',"Disabling shore smoothing."),a.ql=!1):a.ql=b.b4w_water_shore_smoothing;K(a,"special_water.glslv",
"special_water.glslf");u(a,"a_position");ia.Ot?(u(a,"a_polyindex"),a.Z=!0,a.wireframe_edge_color=[0,0,0],k(a,"DEBUG_WIREFRAME",1)):k(a,"DEBUG_WIREFRAME",0);d=b.texture_slots;n=w("use_map_normal",d);e=w("use_map_mirror",d)[0];n.length&&(q=z(n[0]),O(a,q,"u_normalmap0"),a.ai=b.b4w_water_norm_uv_velocity);k(a,"NUM_NORMALMAPS",n.length);a.sg=Array(n.length);for(q=0;q<n.length;q++)a.sg[q]=new Float32Array(2),a.sg[q].set([n[q].scale[0],n[q].scale[1]]);e&&(q=z(e),O(a,q,"u_mirrormap"),a.Dn=e.mirror_factor);
e=null;if(ia.fh)for(q=0;q<d.length;q++){var t=d[q];if(!0===t.texture.b4w_water_foam){e=t;break}}e?(k(a,"FOAM",1),q=z(e),O(a,q,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.Bq.set(e.texture.b4w_foam_uv_freq),a.Aq.set(e.texture.b4w_foam_uv_magnitude),a.Jm[0]=e.scale[0],a.Jm[1]=e.scale[1]):k(a,"FOAM",0);for(q=0;q<d.length;q++)if(t=d[q],!0===t.texture.b4w_shore_dist_map){var p=t;break}p&&ia.Cl?(p=z(p),O(a,p,"u_shore_dist_map"),k(a,"SHORE_PARAMS",1),p=t.texture.b4w_shore_boundings,k(a,"MAX_SHORE_DIST",aa.t(t.texture.b4w_max_shore_dist)),
k(a,"SHORE_MAP_SIZE_X",aa.t(p[0]-p[1])),k(a,"SHORE_MAP_SIZE_Y",aa.t(p[2]-p[3])),k(a,"SHORE_MAP_CENTER_X",aa.t((p[0]+p[1])/2)),k(a,"SHORE_MAP_CENTER_Y",aa.t((p[2]+p[3])/2))):k(a,"SHORE_PARAMS",0);if(b.b4w_generated_mesh&&ia.vi)k(a,"GENERATED_MESH",1),a.Lt=!0,a.Mt=b.b4w_water_num_cascads,a.Nt=b.b4w_water_subdivs,a.Kt=b.b4w_water_detailed_dist;else{u(a,"a_normal");if(e||n.length)u(a,"a_texcoord"),u(a,"a_tangent");k(a,"GENERATED_MESH",0)}if(b.b4w_water_dynamic){var t=aa.t(b.b4w_water_dst_noise_scale0),
p=aa.t(b.b4w_water_dst_noise_scale1),n=aa.t(b.b4w_water_dst_noise_freq0),d=aa.t(b.b4w_water_dst_noise_freq1),e=aa.t(b.b4w_water_dir_min_shore_fac),q=aa.t(b.b4w_water_dir_freq),F=aa.t(b.b4w_water_dir_noise_scale),C=aa.t(b.b4w_water_dir_noise_freq),I=aa.t(b.b4w_water_dir_min_noise_fac),U=aa.t(b.b4w_water_dst_min_fac),A=aa.t(b.b4w_water_waves_hor_fac);k(a,"DST_NOISE_SCALE_0",t);k(a,"DST_NOISE_SCALE_1",p);k(a,"DST_NOISE_FREQ_0",n);k(a,"DST_NOISE_FREQ_1",d);k(a,"DIR_MIN_SHR_FAC",e);k(a,"DIR_FREQ",q);k(a,
"DIR_NOISE_SCALE",F);k(a,"DIR_NOISE_FREQ",C);k(a,"DIR_MIN_NOISE_FAC",I);k(a,"DST_MIN_FAC",U);k(a,"WAVES_HOR_FAC",A)}y(a,b);H(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;k(a,"ABSORB",aa.t(b.b4w_water_absorb_factor));k(a,"SSS_STRENGTH",aa.t(b.b4w_water_sss_strength));k(a,"SSS_WIDTH",aa.t(b.b4w_water_sss_width))}"HALO"===b.type&&(t=b.halo,K(a,"halo.glslv",
"halo.glslf"),k(a,"NUM_RINGS",t.ring_count),k(a,"NUM_LINES",t.line_count),k(a,"NUM_STARS",t.star_tip_count),k(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.pi=["a_position"],a.dr=t.size,a.ar=t.hardness/20,a.cr.set(t.b4w_halo_rings_color),a.br.set(t.b4w_halo_lines_color),a.er=1/b.b4w_halo_stars_blend_height,a.fr=b.b4w_halo_stars_min_height,a.$q=!0);k(a,"TEXCOORD",0);k(a,"NORMAL_TEXCOORD",0);c&&m(a,c,"TEXTURE_COLOR0_CO");g&&m(a,g,"TEXTURE_COLOR1_CO");f&&m(a,f,"TEXTURE_STENCIL_ALPHA_MASK_CO");h&&m(a,h,"TEXTURE_SPEC_CO");
l&&m(a,l,"TEXTURE_NORM_CO");k(a,"SHADELESS",b.use_shadeless?1:0);a.md=b.use_shadeless}d=b.game_settings.alpha_blend;k(a,"ALPHA","OPAQUE"===d?0:1);k(a,"ALPHA_CLIP","CLIP"===d?1:0);k(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(k(a,"VERTEX_COLOR",1),u(a,"a_color")):k(a,"VERTEX_COLOR",0);a.Td=b.ambient;a.Re=b.diffuse_intensity;a.he=b.emit;a.Ed.set(b.specular_color);a.ko=b.specular_alpha;y(a,b);H(a,b);b.b4w_wettable?k(a,"WETTABLE",1):k(a,"WETTABLE",0);E(a,b);a.Xn=
b.b4w_refractive;a.Cs=b.b4w_refr_bump}c=!0}break;case "NODES_GLOW":c=v(a,b,"GLOW");break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)c=!1;else if(r(a,b),a.Ea)c=!1;else{h=b.game_settings.alpha_blend;b.use_nodes&&"CLIP"==h?v(a,b,"DEPTH"):K(a,"depth.glslv","depth.glslf");u(a,"a_position");u(a,"a_normal");k(a,"ALPHA","OPAQUE"===h?0:1);a.vf.set([1,1,1]);if((c=w("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===h){a.vf.set(c.scale);k(a,"TEXTURE_COLOR",
1);u(a,"a_texcoord");if("IMAGE"==c.texture.e.source||"ENVIRONMENT_MAP"==c.texture.e.source)h=z(c),O(a,h,"u_colormap0");"NONE"==c.texture.e.source&&(h=z(c),O(a,h,"u_colormap0"))}else k(a,"TEXTURE_COLOR",0);c=!0}break;case "PHYSICS":b.b4w_collision?(a.DC=b.b4w_use_ghost,a.Sa=b.b4w_collision_id,a.Tp=b.b4w_collision_margin,a.Sp=b.b4w_collision_group,a.Up=b.b4w_collision_mask,a.Ei=b.physics.friction,a.zi=b.physics.elasticity,c=!0):b.b4w_water?(a.Af=!0,a.VC=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,
a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,c=!0):c=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||
b.b4w_do_not_render||"HALO"===b.type)c=!1;else{r(a,b);a.He=R.Rd;a.Z=!0;a.Ea=!1;h=b.game_settings.alpha_blend;a.Fe=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;b.use_nodes&&"CLIP"==h?v(a,b,"COLOR_ID"):K(a,"color_id.glslv","color_id.glslf");u(a,"a_position");k(a,"ALPHA","OPAQUE"===h?0:1);a.vf.set([1,1,1]);if((c=w("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===h){a.vf.set(c.scale);k(a,"TEXTURE_COLOR",1);u(a,"a_texcoord");if("IMAGE"==c.texture.e.source||"ENVIRONMENT_MAP"==c.texture.e.source)h=
z(c),O(a,h,"u_colormap0");"NONE"==c.texture.e.source&&(h=z(c),O(a,h,"u_colormap0"))}else k(a,"TEXTURE_COLOR",0);c=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?c=!1:(r(a,b),a.Ea=!1,a.He=R.Rd,a.Z=!0,K(a,"grass_map.glslv","grass_map.glslf"),u(a,"a_position"),c=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,h=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.tb.a_grass_size={ag:!0,src:[]},c?(a.tb.a_grass_size.src.push({name:c,Sc:4}),k(a,"DYNAMIC_GRASS_SIZE",1)):k(a,"DYNAMIC_GRASS_SIZE",
0),a.tb.a_grass_color={ag:!0,src:[]},h?(a.tb.a_grass_color.src.push({name:h,Sc:7}),k(a,"DYNAMIC_GRASS_COLOR",1)):k(a,"DYNAMIC_GRASS_COLOR",0),c=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?c=!1:(K(a,"wireframe.glslv","wireframe.glslf"),u(a,"a_position"),u(a,"a_normal"),u(a,"a_polyindex"),a.Z=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],c=!0);break;case "PARTICLES":if(b.b4w_do_not_render)c=!1;else{c=b.texture_slots;if(a.dg)K(a,"particles_color.glslv",
"particles_color.glslf");else if(K(a,"particles_texture.glslv","particles_texture.glslf"),c=w("use_map_color_diffuse",c)[0]){k(a,"TEXTURE_COLOR",1);switch(c.blend_type){case "MIX":k(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":k(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Qe=c.diffuse_color_factor;a.Ke=c.use_map_alpha?c.alpha_factor:0;c=z(c);O(a,c)}Y.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Rc);a.Td=b.ambient;a.Re=b.diffuse_intensity;
a.he=b.emit;a.Ed.set(b.specular_color);a.ko=b.specular_alpha;u(a,"a_position");u(a,"a_normal");c=b.game_settings.alpha_blend;k(a,"ALPHA","OPAQUE"===c?0:1);k(a,"ALPHA_CLIP","CLIP"===c?1:0);k(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);y(a,b);H(a,b);r(a,b);c=b.game_settings.alpha_blend;a.Fe=b.b4w_render_above_all&&"OPAQUE"!=c&&"CLIP"!=c;a.ug=b.offset_z;c=!0}break;default:throw"Wrong batch type: "+a.type;}return c}function m(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":k(a,c,"TEXTURE_COORDS_UV_ORCO");
k(a,"TEXCOORD",1);break;case "NORMAL":k(a,c,"TEXTURE_COORDS_NORMAL");k(a,"NORMAL_TEXCOORD",1);break;default:k(a,c,0)}}function r(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.Ea=!0;a.He=R.bp;a.Z=!0;break;case "ALPHA":a.Ea=!0;a.He=R.Rd;a.Z=!0;break;case "CLIP":a.Ea=!1;a.He=R.Rd;a.Z=!0;break;case "ADD":a.Ea=!0;a.He=R.Rd;a.Z=!1;break;case "OPAQUE":a.Ea=!1;a.He=R.Rd;a.Z=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.Na=c.use_backface_culling}function z(a,b){var c=
a.texture,d=c.e,c=c.image;d&&b&&c&&ea.oj(d,b,c.mc,c.filepath);return d}function w(a,b){for(var c=[],d=b.length,f=0;f<d;f++){var e=b[f];1==e[a]&&e.texture&&e.texture.e&&c.push(e)}return c}function E(a,b){var c=b.raytrace_transparency;a.cd[0]=c.fresnel;a.cd[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.reflect_factor=c.reflect_factor;a.cd[2]=c.fresnel;a.cd[3]=1-c.fresnel_factor/5}function y(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":k(a,"SPECULAR_SHADER","SPECULAR_PHONG");
c=b.specular_hardness;break;case "WARDISO":k(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;case "TOON":k(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;d=b.specular_toon_smooth;break;case "BLINN":k(a,"SPECULAR_SHADER","SPECULAR_BLINN");c=b.specular_ior;d=b.specular_hardness;break;default:M.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.kc[0]=b.specular_intensity;a.kc[1]=c;a.kc[2]=d}function H(a,b){switch(b.diffuse_shader){case "LAMBERT":k(a,
"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.tc[0]=0;a.tc[1]=0;break;case "OREN_NAYAR":k(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.tc[0]=b.roughness;a.tc[1]=0;break;case "FRESNEL":k(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.tc[0]=b.diffuse_fresnel;a.tc[1]=b.diffuse_fresnel_factor;break;case "MINNAERT":k(a,"DIFFUSE_SHADER","DIFFUSE_MINNAERT");a.tc[0]=b.darkness;a.tc[1]=0;break;case "TOON":k(a,"DIFFUSE_SHADER","DIFFUSE_TOON");a.tc[0]=b.diffuse_toon_size;a.tc[1]=b.diffuse_toon_smooth;break;default:M.error("unsupported diffuse shader: "+
b.diffuse_shader+' (material "'+b.name+'")'),a.tc[0]=0,a.tc[1]=0}}function v(a,b,c){if(!b.use_nodes||b.b4w_do_not_render)return!1;var d;switch(c){case "MAIN":K(a,"main.glslv","main.glslf");d=!1;break;case "GLOW":K(a,"main.glslv","main.glslf");d=!0;break;case "DEPTH":K(a,"depth.glslv","depth.glslf");d=!1;break;case "COLOR_ID":K(a,"color_id.glslv","color_id.glslf"),d=!1}c=fa.Ew(b.node_tree,b.uuid,!1,b.name,c);if(!c)return M.error('Failed to create node graph for material "'+b.name+'", disable nodes'),
B(a,b),!0;a.kh=!0;k(a,"NODES",1);k(a,"NODES_GLOW",d?1:0);var f=b.game_settings.alpha_blend;k(a,"ALPHA","OPAQUE"===f?0:1);k(a,"ALPHA_CLIP","CLIP"===f?1:0);k(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);u(a,"a_position");b.use_orco_tex_coord&&u(a,"a_orco_tex_coord");r(a,b);a.ug=b.offset_z;f=b.game_settings.alpha_blend;a.Fe=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;Y.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Rc);a.he=b.emit;a.Td=b.ambient;E(a,b);b.b4w_wettable?
k(a,"WETTABLE",1):k(a,"WETTABLE",0);a.Bb.In=fa.Fw(c);var e=!1;Z.S(c,function(b,c){switch(c.type){case "UVMAP":case "TEX_COORD_UV":case "GEOMETRY_UV":case "UV_MERGED":var d=c.data.name,g=c.data.value;a.Mg||(a.Mg={});a.Mg[g]=d;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":d=c.data.name;a.tb[d]={ag:!0,src:[{name:c.data.value}]};g=0;if("GEOMETRY_VC"==c.type)g=7;else for(var h=0;h<c.ya.length;h++){var m="RGB".indexOf(c.ya[h].identifier);-1<m&&(g|=1<<2-m)}a.tb[d].src[0].Sc=
g;break;case "TEX_COORD_NO":case "GEOMETRY_NO":u(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":d=c.data.value;u(a,"a_normal");k(a,"DIFFUSE_SHADER","DIFFUSE_"+d.Ex);k(a,"SPECULAR_SHADER","SPECULAR_"+d.BB);k(a,"SHADELESS_MAT",d.md?1:0);a.md=d.md;e=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":d=c.data.name;g=c.data.value;!1!==g.e.Hj&&(g.e.Hj="TEXTURE_ENVIRONMENT"!=c.type?!0:!1);O(a,g.e,d);ia.Fl&&"CLIP"==f&&ea.ij(c.data.value.e,ea.lc,ea.lc);break;case "TEXTURE_NORMAL":case "B4W_PARALLAX":k(a,
"CALC_TBN_SPACE",1);u(a,"a_normal");u(a,"a_tangent");d=c.data.name;g=c.data.value;g.e.Hj=!1;O(a,g.e,d);break;case "LAMP":c.data&&(a.qh=c.data);break;case "B4W_REFRACTION":a.Xn=!0}});e||(a.md=!0);return!0}function B(a,b){switch(a.type){case "DEPTH":K(a,"depth.glslv","depth.glslf");break;case "COLOR_ID":K(a,"color_id.glslv","color_id.glslf");break;default:K(a,"main.glslv","main.glslf")}k(a,"SHADELESS",1);u(a,"a_position");u(a,"a_normal");Y.set(1,0,1,1,a.Rc);if(b){var c=b.game_settings.alpha_blend;k(a,
"ALPHA","OPAQUE"===c?0:1);k(a,"ALPHA_CLIP","CLIP"===c?1:0);k(a,"VERTEX_COLOR",0);a.ug=b.offset_z;r(a,b)}return!0}function t(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.vk?k(a,"AU_QUALIFIER","attribute"):k(a,"AU_QUALIFIER","uniform"),k(a,"STATIC_BATCH",0)):(k(a,"AU_QUALIFIER","attribute"),k(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(V.Ry()?k(a,"WIREFRAME_QUALITY",1):k(a,"WIREFRAME_QUALITY",0),a.$g?(k(a,"DEBUG_SPHERE",1),a.iq?k(a,"DEBUG_SPHERE_DYNAMIC",1):k(a,"DEBUG_SPHERE_DYNAMIC",0)):k(a,"DEBUG_SPHERE",
0),k(a,"ALPHA",1));b.Kd&&(a.Kd=b.Kd);b.Lc?(""!==b.pe?(a.tb.a_bending_col_main={ag:!0,src:[{name:b.pe,Sc:4}]},u(a,"a_bending_col_main"),""!==b.Kb.Dr&&""!==b.Kb.Cr&&""!==b.Kb.Xr?(a.tb.a_bending_col_detail={ag:!0,src:[{name:b.Kb.Dr,Sc:4},{name:b.Kb.Cr,Sc:2},{name:b.Kb.Xr,Sc:1}]},u(a,"a_bending_col_detail"),u(a,"a_normal"),k(a,"DETAIL_BEND",1)):k(a,"DETAIL_BEND",0),k(a,"MAIN_BEND_COL",1)):k(a,"MAIN_BEND_COL",0),k(a,"WIND_BEND",1)):k(a,"WIND_BEND",0);b.Nj?k(a,"BEND_CENTER_ONLY",1):k(a,"BEND_CENTER_ONLY",
0);k(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.Ql|0);b.sd?k(a,"BILLBOARD",1):k(a,"BILLBOARD",0);b.sd&&b.vk?k(a,"HAIR_BILLBOARD",1):k(a,"HAIR_BILLBOARD",0);b.ji?k(a,"BILLBOARD_SPHERICAL",1):k(a,"BILLBOARD_SPHERICAL",0);switch(b.ki){case "RANDOM":k(a,"BILLBOARD_RANDOM",1);k(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":k(a,"BILLBOARD_RANDOM",0);k(a,"BILLBOARD_JITTERED",1);break;default:k(a,"BILLBOARD_RANDOM",0),k(a,"BILLBOARD_JITTERED",0)}b.xb&&ia.Cl?k(a,"DYNAMIC_GRASS",1):k(a,"DYNAMIC_GRASS",0);a.xb=
b.xb;a.vd=b.vd;a.Fc=b.Fc;a.ic=b.ic;a.jc=b.jc&&!a.md&&!(a.Ea&&ia.nq);a.Wb=b.Wb;a.Nb=b.Nb;a.Dc=b.Dc;b.ph?(u(a,"a_influence"),k(a,"SKINNED",1),b.Di?k(a,"FRAMES_BLENDING",1):k(a,"FRAMES_BLENDING",0),k(a,"MAX_BONES",b.re)):(k(a,"SKINNED",0),k(a,"FRAMES_BLENDING",0));b.ol?(k(a,"VERTEX_ANIM",1),ia.It?k(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):k(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):k(a,"VERTEX_ANIM",0);if(b.ph&&b.ol)throw"Skinning and vertex animation are mutually exlusive";b.bk?k(a,"DISABLE_FOG",
1):k(a,"DISABLE_FOG",0);b.Pc&&(a.Pc=b.Pc);if(a.kh){for(var c=a.Bb.In,d=b.pg,f=b.og,e=0;e<c.length;e++){var g=c[e];switch(g.id){case "VALUE":var h=g.Mk[0];if(h)for(var m=0;m<d.length;m+=2)if(d[m]==h){g.de.push(["VALUE_IND",d[m+1]]);break}break;case "RGB":if(h=g.Mk[0])for(m=0;m<f.length;m+=2)if(f[m]==h){g.de.push(["RGB_IND",f[m+1]]);break}}}k(a,"NUM_VALUES",b.qe.length);k(a,"NUM_RGBS",b.xc.length)}}}function u(a,b){var c=a.pi;-1==c.indexOf(b)&&c.push(b)}function k(a,b,c){aa.D(a.Bb,b,c)}function q(a,
b){if("PHYSICS"==a.type)a.Hc=b;else{var c=a.He,d=a.ge;a.$q&&(b=R.Ux(b));a.Lt&&(b=S.py(a.Mt,a.Nt,a.Kt));c=R.PB(b,c,d,a.tb);a.U=c;a.vd||c.pk||a.Kd||(c.Ze=null,c.nd=null);c=b.A.length;a.num_vertices=b.L*c;a:switch(a.ge){case R.ci:case R.zj:case R.yj:d=!0;break a;default:d=!1}d?R.qz(b)?a.num_triangles=b.fa.length/3*c:a.num_triangles=b.L/3*c:a.num_triangles=0}}function J(a,b,d,f,e,g,k,h,m,l,n,q){var r=[],z=h.b4w_dynamic_grass;if(!l&&z)return r;for(var u="INSTANCE"==h.b4w_wind_bend_inheritance,w="INSTANCE"==
h.b4w_shadow_inheritance,v="INSTANCE"==h.b4w_reflection_inheritance,p=[],C=[],I=0;I<e.length;I++){var A=e[I],y=F.ni(b);y.sd=h.b4w_hair_billboard;y.ki=h.b4w_hair_billboard_type;y.ji="SPHERICAL"==h.b4w_hair_billboard_geometry;y.xb=z;y.vk=!0;y.qe=A.e.qe;y.pg=A.e.pg;y.xc=A.e.xc;y.og=A.e.og;u?(y.Lc=A.e.Lc,y.uj=A.e.uj,y.Ee=A.e.Ee,y.ce=A.e.ce,y.pe=A.e.pe,y.be=A.e.be,y.Xd=A.e.Xd,y.Md=A.e.Md,y.Kb=A.e.Kb,y.Nj=!1):(y.Lc=a.e.Lc,y.uj=a.e.uj,y.Ee=a.e.Ee,y.ce=a.e.ce,y.pe=a.e.pe,y.be=a.e.be,y.Xd=a.e.Xd,y.Md=a.e.Md,
y.Kb=a.e.Kb,y.Nj=!0);w?(y.Fc=A.e.Fc,y.ic=A.e.ic,y.jc=A.e.jc):(y.Fc=a.e.Fc,y.ic=a.e.ic,y.jc=a.e.jc);v?(y.Wb=A.e.Wb,y.Nb=A.e.Nb,y.Dc=A.e.Dc,y.qc=A.e.qc,y.Ac=A.e.Ac,y.ue=A.e.ue):(y.Wb=a.e.Wb,y.Nb=a.e.Nb,y.Dc=a.e.Dc,y.qc=a.e.qc,y.Ac=a.e.Ac,y.ue=a.e.ue);p.push(y);var E=k[I];E||(E=new Float32Array);q&&F.qk(m.seed,n);var B=new Float32Array(3),L=new Float32Array([0,0,0,1]),J=[],K=oa.Np(ia.wn)&&!h.b4w_initial_rand_rotation&&!h.b4w_hair_billboard,Q=4;K&&(Q=8);for(var H=0;H<E.length;H+=Q){B[0]=E[H];B[1]=E[H+
1];B[2]=E[H+2];var ca=E[H+3]*A.e.scale;if(h.b4w_initial_rand_rotation){switch(h.b4w_rotation_type){case "XYZ":var O=new Float32Array([F.Vc(n),F.Vc(n),F.Vc(n)]);U.normalize(O,O);break;case "Z":O=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+h.b4w_rotation_type;}na.setAxisAngle(O,h.b4w_rand_rotation_strength*(2*Math.PI*F.Vc(n)-Math.PI),L)}else K&&(L.set(E.subarray(H+4,H+8)),F.Tn(L,L),h.use_whole_group||(h.use_rotation_dupli?na.multiply(L,A.e.quat,L):na.multiply(L,
qa,L)));var V=ba.create_sep(B,ca,L);J.push(V)}C.push(J)}for(var ga={},I=0;I<e.length;I++){var aa=g[I],y=p[I],ea={};y.Lc&&(ea.au_wind_bending_amp=[y.Md],ea.au_wind_bending_freq=[y.Ee],ea.au_detail_bending_freq=[y.ce],ea.au_detail_bending_amp=[y.be],ea.au_branch_bending_amp=[y.Xd],y.Md=0,y.Ee=0,y.ce=0,y.be=0,y.Xd=0);var S=F.Xg(y,0),J=C[I];if(J.length)for(var Z=e[I].data,W=Z.materials,fa=Array(W.length),H=0;H<W.length;H++)if(!R.gr(Z,H))for(var ha=0;ha<aa.length;ha++){var da=aa[ha],wa=c(da),Ia=W[H];"MAIN"==
da&&(fa[H]=wa);if(G(wa,Ia)){"DEPTH"==da&&fa[H]&&(wa.md=fa[H].md);wa.ge=R.ci;t(wa,y);wa.zh=h.uuid;"JITTERED"==h.b4w_hair_billboard_type&&(wa.yr=h.b4w_hair_billboard_jitter_amp,wa.zr=h.b4w_hair_billboard_jitter_freq);z&&(wa.Zq=h.b4w_dynamic_grass_scale_threshold);u||(delete wa.tb.a_bending_col_main,delete wa.tb.a_bending_col_detail);D(wa,S);var db=R.wq(Z,H,wa.pi,wa.Pc,wa.tb,wa.Mg),Ra=R.Hz(db,ea,J),Va=Ra,Yb=J;Va.J.au_center_pos=new Float32Array(3*Va.L);for(var ob=Yb.length,Ta=Va.L/ob,Da=0;Da<ob;Da++)for(var jb=
Yb[Da],Na=3*Ta*Da,Ma=0;Ma<Ta;Ma++)Va.J.au_center_pos[Na+3*Ma]=jb[0],Va.J.au_center_pos[Na+3*Ma+1]=jb[1],Va.J.au_center_pos[Na+3*Ma+2]=jb[2];Ra=Va;if(y.Lc&&y.Nj){var Ca=Ra,za=a.e.W;Ca.J.a_emitter_center=new Float32Array(3*Ca.L);var ra=Y.fromValues(0,0,0,1);Y.transformMat4(ra,za,ra);for(var Ib=0;Ib<Ca.L;Ib++)Ca.J.a_emitter_center[3*Ib]=ra[0],Ca.J.a_emitter_center[3*Ib+1]=ra[1],Ca.J.a_emitter_center[3*Ib+2]=ra[2];Ra=Ca}var Jb=h.b4w_vcol_from_name,ya=h.b4w_vcol_to_name,Zb=wa,X=d,Rb=!u,Xa=Z,Aa=[];if(""!==
Jb&&""!==ya){var va,$b=ya,sc=Zb.tb,pb=[],Sa=void 0;for(Sa in sc)for(var sb=sc[Sa].src,Ja=0,kb=0;kb<sb.length;kb++){var nc=sb[kb].Sc;$b==sb[kb].name&&pb.push(Sa,nc,Ja);Ja+=F.Dg(nc)}va=pb;if(0<va.length)for(var Kb=0;Kb<va.length;Kb+=3)Aa.push({Ai:Jb,ek:7,Nk:va[Kb],Ok:va[Kb+1],ck:va[Kb+2]});else R.bz(Zb.pi,"a_color")&&ya==Xa.active_vcol_name&&Aa.push({Ai:Jb,ek:7,Nk:"a_color",Ok:7,ck:0})}Rb&&("a_bending_col_main"in X&&Aa.push({Ai:"a_bending_col_main",ek:4,Nk:"a_bending_col_main",Ok:4,ck:0}),"a_bending_col_detail"in
X&&Aa.push({Ai:"a_bending_col_detail",ek:7,Nk:"a_bending_col_detail",Ok:7,ck:0}));for(var ab=Ra,Lb=J,Hc=f,Mb=Aa,Ic=wa.tb,Wa=!1,eb=0;eb<Mb.length;eb++){var qb=Mb[eb].Ai,Sb=Hc.J[qb];if(Sb&&0<Sb.length){Wa=!0;break}}if(Wa){var fb,Tb=a.e.Qb,Hb=Hc.A[0].a_position,oc=Lb,sa=ga,gb=new Float32Array(3),rb=new Float32Array(3),ac=new Uint32Array(oc.length);if(!("verts_indices"in sa)){sa.$d=new Float32Array(3);sa.Wd=new Float32Array(3);sa.Lo=new Uint32Array(Hb.length/3);sa.Si=new Uint32Array(Hb.length/3);sa.$d[0]=
(Tb.max_x-Tb.min_x)/20;sa.$d[1]=(Tb.max_y-Tb.min_y)/20;sa.$d[2]=(Tb.max_z-Tb.min_z)/20;sa.Wd[0]=Tb.min_x;sa.Wd[1]=Tb.min_y;sa.Wd[2]=Tb.min_z;for(var Ga=0;Ga<Hb.length/3;Ga++){var xc=F.trunc((Hb[3*Ga]-sa.Wd[0])/sa.$d[0]),Nb=F.trunc((Hb[3*Ga+1]-sa.Wd[1])/sa.$d[1]),hb=F.trunc((Hb[3*Ga+2]-sa.Wd[2])/sa.$d[2]),xc=F.clamp(xc,0,19),Nb=F.clamp(Nb,0,19),hb=F.clamp(hb,0,19);sa.Lo[Ga]=Ga;sa.Si[Ga]=hb*Math.pow(20,2)+20*Nb+xc}R.$s(sa.Si,sa.Lo,R.vl,!0);sa.Ng=new Uint32Array(Math.pow(20,3));for(Ga=0;Ga<sa.Si.length;Ga++)sa.Ng[sa.Si[Ga]]++;
delete sa.Si;for(Ga=1;Ga<sa.Ng.length;Ga++)sa.Ng[Ga]+=sa.Ng[Ga-1]}for(var lb=0;lb<oc.length;lb++){gb[0]=oc[lb][0];gb[1]=oc[lb][1];gb[2]=oc[lb][2];for(var tc=1E10,Ab=-1,hc=F.trunc((gb[0]-sa.Wd[0])/sa.$d[0]),tb=F.trunc((gb[1]-sa.Wd[1])/sa.$d[1]),mb=F.trunc((gb[2]-sa.Wd[2])/sa.$d[2]),hc=F.clamp(hc,0,19),tb=F.clamp(tb,0,19),mb=F.clamp(mb,0,19),Bb=mb*Math.pow(20,2)+20*tb+hc,pc=sa.Ng[Bb],ub=0==Bb?0:sa.Ng[Bb-1];ub<pc;ub++){var bc=sa.Lo[ub];rb[0]=Hb[3*bc];rb[1]=Hb[3*bc+1];rb[2]=Hb[3*bc+2];U.sub(rb,gb,rb);
var wb=U.sqrLen(rb);wb<=tc&&(tc=wb,Ab=bc)}if(-1==Ab)for(ub=0;ub<Hb.length/3;ub++)rb[0]=Hb[3*ub],rb[1]=Hb[3*ub+1],rb[2]=Hb[3*ub+2],U.sub(rb,gb,rb),wb=U.sqrLen(rb),wb<=tc&&(tc=wb,Ab=ub);ac[lb]=Ab}fb=ac;for(var cc=ab.L/Lb.length,eb=0;eb<Mb.length;eb++){var Cb=Mb[eb].Nk,Ob=Mb[eb].Ok,qb=Mb[eb].Ai,yc=Mb[eb].ek,Sb=Hc.J[qb];switch(Cb){case "a_bending_col_main":var Db=1;break;case "a_bending_col_detail":Db=3;break;case "a_color":Db=3;break;default:for(var Ea=Db=0;Ea<Ic[Cb].src.length;Ea++)Db+=F.Dg(Ic[Cb].src[Ea].Sc)}if(Sb&&
0<Sb.length){var Sc=F.Dg(yc),zc=F.Dg(Ob),Pb=yc&Ob,qc=F.Hs(Pb);Pb!=Ob&&M.error("Wrong color extraction from "+qb+" to "+Cb+".");if("a_bending_col_main"==Cb||"a_bending_col_detail"==Cb)ab.J[Cb]=new Float32Array(ab.L*zc);for(Ea=0;Ea<Lb.length;Ea++){var Jc=fb[Ea],Ka=Jc*Sc,Ya=Ea*cc*Db;if(-1!=Jc)for(var Ac=0;Ac<cc;Ac++)for(var kd=Ac*Db,ic=0;ic<qc.length;ic++)qc[ic]&&(ab.J[Cb][Ya+kd+(Mb[eb].ck+F.hj(Ob,ic))]=Sb[Ka+F.hj(yc,ic)])}}else ab.J[Cb]=new Float32Array(0)}}Ra=ab;r.push({B:wa,Hc:Ra,dc:[Ia.name],Xb:y,
gd:[a]})}}}return r}function G(a,b){var c=!0;"NODES_GLOW"==a.type&&(c=fa.Mp(b));return c=c&&f(a,b)}function D(a,b){for(var c=null,d=null,f=0;f<a.M.length;f++){var e=a.M[f].Yd;e&&(c||(c={}),c[f]=e,a.M[f].Yd=null);if(e=a.M[f].Qa)d||(d={}),d[f]=e,a.M[f].Qa=null}a.id=0;a.zA=b;a.id=F.Xg(a,b);if(c)for(var g in c)a.M[g].Yd=c[g];if(d)for(g in d)a.M[g].Qa=d[g]}function L(a,b,d,f,e){var g=c("WIREFRAME");K(g,"wireframe.glslv","wireframe.glslf");g.wireframe_mode=0;g.$g=!0;g.Z=!0;g.zh=d;e&&(g.iq=!0);t(g,b);D(g,
F.Xg(b,0));f?(b=S.Kq(1,a.F),R.MA(b,[a.If[0],a.Jf[1],a.Kf[2]],a.F)):b=S.Kq(a.Fa,a.F);R.so(b,1,!0);b.J.a_polyindex=R.vq(b);q(g,b);return g}function K(a,b,c){a.Bb={rj:b,Ci:c,Se:[],sn:[],In:[]};aa.UA(a.Bb)}function O(a,b,c){1==a.M.length&&0==a.Hb.length&&a.Hb.push("default0");c=c||"default"+String(a.M.length);-1==a.Hb.indexOf(c)&&(a.M.push(b),a.Hb.push(c));a.Yb&&da.pp(a)}function A(a){if(!a.Bb)throw"No shaders info for batch "+a.name;a.Yb=aa.By(a.Bb);da.Tv(a.Yb);da.np(a);da.pp(a)}var I=p("__boundings"),
C=p("__camera"),Q=p("__config"),M=p("__print"),V=p("__extensions"),R=p("__geometry"),Z=p("__graph"),fa=p("__nodemat"),W=p("__objects"),ha=p("__particles"),S=p("__primitives"),oa=p("__reformer"),da=p("__renderer"),ga=p("__scenegraph"),aa=p("__shaders"),ea=p("__textures"),ba=p("__tsr"),F=p("__util"),U=p("vec3"),Y=p("vec4"),na=p("quat"),ia=Q.p,ca=["MAIN"],qa=new Float32Array([0,-Math.sqrt(.5),0,Math.sqrt(.5)]);a.GE=c;a.oy=function(a,b,c,f){for(var g=[],k=[],m=[],l=0;l<c.length;l++){var n=c[l];W.cc(n)?
k.push(n):m.push(n)}l=[];l=l.concat(e(k,a));k=l=l.concat(h(m,a,b));l=[];n=[];m={};for(a=0;a<k.length;a++){var r=k[a].B,t=k[a].Xb,z=null;if(r.id in m){var u=m[r.id],w=n[u].B,v=n[u].Xb,p=null,C=null;for(b=0;b<r.M.length;b++){var I=r.M[b].Yd;I&&(p||(p={}),p[b]=I,r.M[b].Yd=null);if(I=r.M[b].Qa)C||(C={}),C[b]=I,r.M[b].Qa=null}F.kt(r,w)&&F.kt(t,v)&&(z=n[u]);if(p)for(b in p)r.M[b].Yd=p[b];if(C)for(b in C)r.M[b].Qa=C[b];if(!z){do r.id++;while(m[r.id])}}z||(z={B:r,Xb:k[a].Xb,gd:[],to:[],dc:[]},m[r.id]=n.length,
n.push(z));z.gd=z.gd.concat(k[a].gd);k[a].Hc&&k[a].Hc.L&&z.to.push(k[a].Hc);if(z.dc.length)for(b=0;b<k[a].dc.length;b++)r=k[a].dc[b],-1==z.dc.indexOf(r)&&z.dc.push(r);else z.dc=k[a].dc;R.$s(z.dc,z.to,R.cv,!1)}for(a=0;a<n.length;a++){k=n[a].to;if(0==k.length)b=F.nb(F.nj("%empty"));else if(1==k.length)b=k[0];else{m=[];for(b=0;b<k.length;b++)R.rz(k[b])||m.push(b);if(m.length<k.length)for(b=0;b<m.length;b++)R.so(k[m[b]]);b=R.OB(k)}l.push({B:n[a].B,Xb:n[a].Xb,Hc:b,dc:n[a].dc,gd:n[a].gd})}g.push.apply(g,
l);for(l=0;l<g.length;l++)g[l].B.Tc=g[l].dc,q(g[l].B,g[l].Hc);for(l=0;l<g.length;l++)if(b=g[l].B,"STATIC"==g[l].Xb.type&&"COLOR_ID"!=b.type)n=W.mr(F.nj("%meta%"),"MESH",!0),n.e=g[l].Xb,n.o=[b],f.push(n);else for(k=[],a=0;a<g[l].gd.length;a++)if(n=g[l].gd[a],-1==k.indexOf(n.name)){for(m=0;m<n.o.length;m++)if(n.o[m]==b)throw"Batch already exist in object";n.o.push(b);k.push(n.name)}if(ia.wireframe_debug){for(l=0;l<g.length;l++)if(b=g[l].Xb,"DYNAMIC"==b.type&&(n=g[l].gd[0],-1<ca.indexOf(g[l].B.type))){k=
!1;for(a=0;a<n.o.length;a++)n.o[a].$g&&(k=!0);k||(a=L(b.Lf,b,n.name,!0,!0),n.o.push(a))}for(l=0;l<f.length;l++)n=f[l],b=n.e,-1<ca.indexOf(n.o[0].type)&&(a=L(b.$c,b,n.name,!1),n.o.push(a))}for(l=0;l<c.length;l++)for(a=0;a<c[l].o.length;a++)d(c[l].o[a]);for(l=0;l<f.length;l++)for(a=0;a<f[l].o.length;a++)d(f[l].o[a])};a.ry=function(a,b){var f=c("MAIN");K(f,"special_skydome.glslv","special_skydome.glslf");if(b.procedural_skydome)k(f,"PROCEDURAL_SKYDOME",1),f.us=!0;else{var e=a.fo;if(e){k(f,"WO_SKYTEX",
1);var g=z(a.Xs,null);O(f,g,"u_sky");e.invert&&k(f,"MTEX_NEGATIVE",1);e.IC&&k(f,"MTEX_RGBTOINT",1);k(f,"BLENDTYPE",e.$v);e.EC&&k(f,"WOMAP_BLEND",1);e.FC&&k(f,"WOMAP_HORIZ",1);e.HC&&k(f,"WOMAP_ZENUP",1);e.GC&&k(f,"WOMAP_ZENDOWN",1)}a.JC&&k(f,"WO_SKYBLEND",1);a.KC&&k(f,"WO_SKYPAPER",1);a.LC&&k(f,"WO_SKYREAL",1)}b.Wb&&(f.Wb=!0,b.Nb&&(f.Nb=!0));f.ug=99999;u(f,"a_position");e=S.my();q(f,e);d(f);e=W.mr(F.nj("%meta_sky%"),"MESH",!0);e.e=W.Xj("DYNAMIC");e.e.bh=!0;e.e.Qb=I.Nd();e.e.$c=I.vj();e.e.hb=I.Nd();
e.e.wb=I.vj();e.o=[f];return e};a.cq=function(a,c){for(var d=[],f=ga.Ia(c,"SHADOW_CAST"),e=ga.Ia(c,"MAIN_PLANE_REFLECT"),g=ga.Ia(c,"MAIN_CUBE_REFLECT"),k=ga.Ia(c,"OUTLINE_MASK"),h=ga.Ia(c,"COLOR_PICKING"),l=0;l<a.o.length;l++){var m=a.o[l],n=null;"DEPTH"==m.type&&f&&m.Fc&&(n=b(m),n.La="SHADOW_CAST");"MAIN"!=m.type&&"PARTICLES"!=m.type||!e&&!g||m.Ea||!m.Wb||(n=b(m),n.La="REFLECT");"COLOR_ID"==m.type&&(k&&h?(n=b(m),n.La="OUTLINE"):k&&!h&&(m.La="OUTLINE"));n&&(n.Yf=!0,D(n,a.e.id),d.push(n))}a.o.push.apply(a.o,
d)};a.WC=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.Vv=l;a.yy=z;a.hC=B;a.op=function(a,b,c){c&&c.j.type==C.Ib&&k(a,"PERSPECTIVE_SHADOW_CAST",1);k(a,"CSM_SECTION0",0);k(a,"CSM_SECTION1",0);k(a,"CSM_SECTION2",0);k(a,"CSM_SECTION3",0);for(c=0;c<b.csm_num;c++)k(a,"CSM_SECTION"+String(c),1);k(a,"SHADOW_TEX_RES",aa.t(b.csm_resolution));k(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?
1:0);k(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.pa=k;a.yb=function(a,b){return aa.Fy(a.Bb,b)};a.gC=D;a.Ug=O;a.EA=function(a,b,c){c=a.Hb.indexOf(c);-1<c&&(a.M[c]=b)};a.gx=function(a,b){var d=c("MAIN");d.Ea=!0;Y.set(b[0],b[1],b[2],.5,d.Rc);d.ge=R.zj;q(d,a);K(d,"main.glslv","main.glslf");k(d,"SHADELESS",1);A(d);return d};a.kb=A;a.nw=function(a){return a.Yb.Yi.length?a.Yb.On.u_cube_fog?!0:!1:!1};a.Tw=function(){var a=c("DEPTH_PACK");a.Na=!0;a.Z=!1;var b=S.ob();q(a,b);K(a,"postprocessing/postprocessing.glslv",
"postprocessing/depth_pack.glslf");A(a);return a};a.dq=function(a){var b=c("POSTPROCESSING");K(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":k(b,"POST_EFFECT","POST_EFFECT_NONE");break;case "GRAYSCALE":k(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");break;case "X_BLUR":k(b,"POST_EFFECT","POST_EFFECT_X_BLUR");break;case "Y_BLUR":k(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");break;case "X_GLOW_BLUR":k(b,"POST_EFFECT","POST_EFFECT_X_GLOW_BLUR");break;case "Y_GLOW_BLUR":k(b,
"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR");break;case "X_EXTEND":k(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");break;case "Y_EXTEND":k(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");break;default:throw"Wrong postprocessing effect: "+a;}b.Na=!0;b.Z=!1;a=S.ob();q(b,a);A(b);return b};a.jx=function(a){var b=c("SSAO");b.Z=!1;b.Na=!0;var d=S.ob();q(b,d);K(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");k(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.gt);k(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:ea.sy(a)};
d={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=z(a,d);O(b,a,"u_ssao_special_tex");A(b);return b};a.kx=function(a){var b=c("SSAO_BLUR");b.Z=!1;b.Na=!0;var d=S.ob();q(b,d);K(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");k(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);A(b);return b};
a.Uw=function(){var a=c("DOF");a.Z=!1;a.Na=!0;var b=S.ob();q(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");k(a,"DEPTH_RGBA",1);A(a);return a};a.bx=function(){var a=c("OUTLINE");a.Z=!1;a.Na=!0;var b=S.ob();q(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/outline.glslf");A(a);return a};a.Ww=function(){var a=c("GLOW_COMBINE");a.Z=!1;a.Na=!0;var b=S.ob();q(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");A(a);return a};a.Xw=function(a,
b,d){var f=c("GOD_RAYS");f.Z=!1;f.Na=!0;var e=S.hy();q(f,e);K(f,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");k(f,"DEPTH_RGBA",a?1:0);k(f,"WATER_EFFECTS",b?1:0);k(f,"STEPS_PER_PASS",aa.t(d,1));A(f);return f};a.Yw=function(){var a=c("GOD_RAYS_COM");a.Z=!1;a.Na=!0;var b=S.ob();q(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");A(a);return a};a.cx=function(){var a=c("SKY");a.Z=!1;a.Na=!0;var b=S.iy();q(a,b);K(a,"procedural_skydome.glslv","procedural_skydome.glslf");
k(a,"WATER_EFFECTS",1);A(a);return a};a.Nw=function(){var a=c("ANTIALIASING");a.Z=!1;a.Na=!0;var b=S.ob();q(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");k(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");A(a);return a};a.hx=function(a){var b=c("SMAA"),d=S.ob();q(b,d);K(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");k(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");k(b,"SMAA_PASS",a);k(b,"SMAA_PREDICATION",0);k(b,"SMAA_REPROJECTION",0);A(b);b.Z=!1;b.Na=!0;return b};a.Rw=
function(){var a=c("COMPOSITING");a.Z=!1;a.Na=!0;var b=S.ob();q(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");A(a);return a};a.ax=function(){var a=c("MOTION_BLUR");a.Na=!0;a.Z=!1;var b=S.ob();q(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");A(a);return a};a.Lw=function(){var a=c("ANAGLYPH");a.Na=!0;a.Z=!1;var b=S.ob();q(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");A(a);return a};a.Zw=function(){var a=
c("LUMINANCE");a.Z=!1;a.Na=!0;var b=S.ob();q(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");A(a);return a};a.Ow=function(){var a=c("LUMINANCE");a.Z=!1;a.Na=!0;var b=S.ob();q(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");A(a);return a};a.$w=function(){var a=c("LUMINANCE_X_BLUR");a.Z=!1;a.Na=!0;var b=S.ob();q(a,b);K(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");A(a);return a};a.Pw=function(){var a=
c("POSTPROCESSING");a.Na=!0;a.Z=!1;var b=S.ob();q(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");A(a);return a};a.Qw=function(){var a=c("BLOOM");a.Z=!1;a.Na=!0;var b=S.ob();q(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");A(a);return a};a.nx=function(){var a=c("VELOCITY");a.Z=!1;a.Na=!0;var b=S.ob();q(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");A(a);return a};a.Mw=function(){var a=c("ANCHOR_VISIBILITY");
a.Z=!0;a.Na=!0;a.ge=R.Vo;K(a,"anchors.glslv","anchors.glslf");var b=S.Jq(1);q(a,b);k(a,"ANCHOR_NUM",1);A(a);a.bj=new Float32Array([0,0,0]);return a};a.fC=function(a,b){var c=b.length/3;if(c!=a.bj.length/3){var d=S.Jq(c);q(a,d);k(a,"ANCHOR_NUM",c);A(a)}a.bj=b};a.ma=function(a,b,c){for(var d=0;d<a.o.length;d++)if(a.o[d].type==c&&!a.o[d].Yf&&-1!=a.o[d].Tc.indexOf(b))return a.o[d];return null};a.uc=function(a,b,c){for(var d=0;d<a.o.length;d++)if(a.o[d].type==c&&a.o[d].Yf&&-1!=a.o[d].Tc.indexOf(b))return a.o[d];
return null};a.Ms=function(a,b){a.Rc.set(b.Rc);a.Re=b.Re;a.Ed.set(b.Ed);a.kc.set(b.kc);a.he=b.he;a.Td=b.Td;a.Qe=b.Qe;a.Ke=b.Ke;a.reflect_factor=b.reflect_factor;a.cd.set(b.cd);a.parallax_scale=b.parallax_scale;a.shallow_water_col.set(b.shallow_water_col);a.shallow_water_col_fac=b.shallow_water_col_fac;a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.ai=b.ai};a.JD=function(a,b){for(var c=a.o,d=0;d<c.length;d++)if(c[d].type==b)return!0;
return!1};a.Cw=function(a){for(var b=a.M,c=0;c<b.length;c++)ea.Bx(b[c].$a);R.Qp(a.U)}};b4w.module.__nodemat=function(a,p){function c(a,h,m,q,z){var x;a:switch(z){case "GLOW":x=h+"11";break a;case "COLOR_ID":case "DEPTH":x=h+"00";break a;default:x=h+"10"}if(x in N)return N[x];if("DEPTH"!=z&&"COLOR_ID"!=z){var u=F.create(),w=a.nodes,v=a.links;h=a.animation_data;for(var p=0;p<w.length;p++)if(!k(u,w[p],0,h,q,z))return N[x]=null;if(m&&-1==t(a,u,"GROUP_OUTPUT","group"))return null;p=ha(u);if(!S(u,v,p))return null;if(m)return u;for(p=0;p<v.length;p++){m=v[p];for(var w=n(m.from_node,u),C=n(m.to_node,
u),I=0;I<w.length;I++)for(var U=0;U<C.length;U++){var y=w[I],A=C[U],E=F.Va(u,y),qa=F.Va(u,A);if(!fa(u,y,A,E,qa,m))return N[x]=null}}l(u);a="GLOW"==z?t(a,u,"B4W_GLOW_OUTPUT","material",!0):t(a,u,"OUTPUT","material",!1,!0);-1==a&&(u=b(),a=0);f(u);a=F.ro(u,a,F.sl);e(a);r(a);B(a);g(a,h,q,z)}else q=c(a,h,m,q,"MAIN"),q=F.clone(q,function(a){var b=Y.ni(a);b.G=Y.la(a.G);b.ya=Y.la(a.ya);return b}),a=t(a,q,"OUTPUT","material",!1,!0),d(q,a),a=F.ro(q,a,F.sl),e(a);return N[x]=a}function d(a,b){F.Jd(a,function(c,
d,f){var e=F.Va(a,d);d==b&&"Color"==e.G[f[1]].identifier&&F.Es(a,c,d,f)})}function b(){var a=F.create(),b={data:null,de:[],N:[],G:[{wa:new Float32Array([0,0,0]),identifier:"Color",pb:!1,name:"Color"},{wa:1,identifier:"Alpha",pb:!1,name:"Alpha"}],ya:[],type:"OUTPUT",$h:[]};F.Jj(a,0,b);return a}function e(a){F.S(a,function(b,c){for(var d=c.G,f=c.ya,e=0;e<d.length;e++)h(a,d[e],b,e,1);for(e=0;e<f.length;e++)h(a,f[e],b,e,0)})}function h(a,b,c,d,f){if(b.pb){var e=!0;F.Jd(a,function(a,b,g){if(!f&&a==c&&
g[0]==d||f&&b==c&&g[1]==d)e=!1});e&&(b.pb=!1)}}function g(a,b,c,d){var f=[];F.Jd(a,function(e,g,h){var m=F.Va(a,e),l=F.Va(a,g),m=Y.is_vector(m.ya[h[0]].wa),l=Y.is_vector(l.G[h[1]].wa);if(m!=l){var n,q={default_value:[0,0,0],identifier:"Vector",is_linked:!0,name:"Vector"},r={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};m&&!l?n=u("vector_to_scalar","B4W_VECTOSCAL",[q],[r]):!m&&l&&(n=u("scalar_to_vector","B4W_SCALTOVEC",[r],[q]));k(a,n,0,b,c,d);f.push([e,g,a.O[a.O.length-2],h])}});for(var e=
0;e<f.length;++e)F.Es(a,f[e][0],f[e][1],f[e][3]),F.Zc(a,f[e][0],f[e][2],[f[e][3][0],0]),F.Zc(a,f[e][2],f[e][1],[0,f[e][3][1]])}function l(a){var b=[];F.S(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":F.Jd(a,function(a,f,e){a==c&&"Translucency"==d.ya[e[0]].name&&b.push(a,f,[e[0]+1,e[1]+1])})}});for(var c=0;c<b.length;c+=3)F.Zc(a,b[c],b[c+1],b[c+2])}function n(a,b){var c=[];F.S(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function f(a){var b=[];F.S(a,
function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],f=b[c+1];if("B4W_PARALLAX"==f.type){var e=m(a,d);if(-1!=e){var g=F.jk(a,e,0);F.Cg(a,e,d,-1);-1!=g&&F.Cg(a,g,e,-1);d=F.Va(a,e);f.data=d.data;f.N[0]=d.N[0];F.Ch(a,e)}f.G.splice(1,1)}else if("REROUTE"==f.type){for(var f=F.jk(a,d,0),k=F.xg(a,d),e=[],g=[],h=[],l=0;l<k;l++){var n=F.cg(a,d,l),q=g.indexOf(n);-1!=q?h[q]+=1:(g.push(n),h.push(1),e.push(d,n))}if(-1!=f)for(k=F.bg(a,f,d,0)[0],l=0;l<g.length;l++)for(n=
0;n<h[l];n++)q=F.bg(a,d,g[l],n)[1],F.Zc(a,f,g[l],[k,q]);for(l=0;l<e.length;l+=2)F.Cg(a,e[l],e[l+1],-1)}}}function m(a,b){for(var c=a.V,d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function r(a){w(a);y(a);z(a)}function z(a){var b=[],c="",d="",f={};F.S(a,function(a,e){if("GEOMETRY_UV"==e.type||"UVMAP"==e.type||"TEX_COORD_UV"==e.type){b.push(a,e);var g=e.data.value;c?c==g||d||(d=g,f[d]=0):(c=g,f[c]=0);f[g]++}});for(var e in f)if(2>f[e]){for(var g=0;g<b.length;g+=2)b[g+1].data.value==
e&&b.splice(g,2);delete f[e];c==e&&(c=d,d="");d==e&&(d="")}if(!(3>b.length)){var g={default_value:[0,0,0],identifier:"UV_geom",is_linked:!1,name:"UV_geom"},h={default_value:[0,0,0],identifier:"UV_cycles",is_linked:!1,name:"UV_cycles"};e=u("merged_uv","UV_MERGED",[],[g,h]);e.uv_layer=c;k(a,e,0,null,"",void 0);var l=a.O[a.O.length-2];e=a.O[a.O.length-1];if(d){h=u("merged_uv","UV_MERGED",[],[g,h]);h.uv_layer=d;k(a,h,0,null,"",void 0);var m=a.O[a.O.length-2],h=a.O[a.O.length-1]}else h=null;for(var n=
-1,q=null,g=0;g<b.length;g+=2){var r=b[g],t=b[g+1];v(t,b[1])?(n=l,q=e):h&&(n=m,q=h);for(var z=[],x=F.xg(a,r),w={},p=0;p<x;p++){var C=F.cg(a,r,p);C in w||(w[C]=0);var I=F.bg(a,r,C,w[C]++);z.push(r,C,I);I=I.splice(0,I.length);switch(t.type){case "GEOMETRY_UV":I[0]=0;q.ya[0].pb=!0;break;case "UVMAP":case "TEX_COORD_UV":I[0]=1,q.ya[1].pb=!0}F.Zc(a,n,C,I)}for(var p=0;p<z.length;p+=3)F.Cg(a,z[p],z[p+1],0);F.Ch(a,r)}}}function w(a){var b=[];F.S(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_NO"!=c.type&&
"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type&&"GEOMETRY_LO"!=c.type&&"GEOMETRY_OR"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var f=b[d],e=b[d+1],g=!0,k=0;k<c.length;k++){var h=c[k];if(H(e,h.oc)){g=[];k=F.xg(a,f);for(n=0;n<k;n++){var l=F.cg(a,f,n),m=F.bg(a,f,l,0);g.push(f,l,m);F.Zc(a,h.id,l,m)}for(var n=0;n<g.length;n+=3)F.Cg(a,g[n],g[n+1],0);F.Ch(a,f);g=!1;break}}g&&(h={id:f,oc:e},c.push(h))}}function E(a){for(var b={},c=0;c<a.O.length;c+=2)b[a.O[c]]=[];for(c=
0;c<a.V.length;c+=3){var d=a.V[c],f=a.V[c+1];b[f].push(d);b[f].push.apply(b[f],b[d])}return b}function y(a){var b=[];F.S(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=E(a),d=[],f=0;f<b.length;f+=2){for(var e=b[f],g=b[f+1],k=!0,h=0;h<d.length;h++){var l=d[h];if(!(3<=l.vh.length||!H(g,l.oc)||-1<c[e].indexOf(l.id)||-1<c[l.id].indexOf(e))){for(var m=!1,n=0;n<l.vh.length;n++){var q=l.vh[n].id;if(-1<c[e].indexOf(q)||-1<c[q].indexOf(e)){m=!0;break}}if(!m){for(var h=
[],q=F.lr(a,e),r={},n=0;n<q;n++)m=F.jk(a,e,n),m in r||(r[m]=0),k=F.bg(a,m,e,r[m]++),h.push(m,e,k);for(var q=[],r=F.xg(a,e),t={},n=0;n<r;n++)m=F.cg(a,e,n),m in t||(t[m]=0),k=F.bg(a,e,m,t[m]++),q.push(e,m,k);k=h.concat(q);for(n=0;n<k.length;n+=3)F.Cg(a,k[n],k[n+1],0);F.Ch(a,e);n={id:e,oc:g,Jx:h,Kx:q};l.vh.push(n);k=!1;break}}}k&&(l={id:e,oc:g,vh:[]},d.push(l))}for(f=0;f<d.length;f++){l=d[f];c=l.vh.length;for(h=0;h<c;h++){g=l.vh[h];n=g.oc;e=g.Jx;g=g.Kx;l.oc.G[h+1].pb=n.G[0].pb;l.oc.G[h+1].wa=n.G[0].wa;
l.oc.ya[2*(h+1)].pb=n.ya[0].pb;l.oc.ya[2*(h+1)].wa=n.ya[0].wa;l.oc.ya[2*(h+1)+1].pb=n.ya[1].pb;l.oc.ya[2*(h+1)+1].wa=n.ya[1].wa;for(n=0;n<e.length;n+=3)m=e[n],k=e[n+2],k[1]+=h+1,F.Zc(a,m,l.id,k);for(n=0;n<g.length;n+=3)m=g[n+1],k=g[n+2],k[0]+=2*(h+1),F.Zc(a,l.id,m,k);l.oc.de.push(["USE_uv"+(h+2),1])}F.Ch(a,l.id);F.Jj(a,l.id,l.oc)}}}function H(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":case "GEOMETRY_LO":case "GEOMETRY_OR":return!0;
case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function v(a,b){var c=["GEOMETRY_UV","TEX_COORD_UV","UVMAP"];return-1!=c.indexOf(a.type)&&-1!=c.indexOf(b.type)?a.data.value==b.data.value:!1}function B(a){var b=[];F.S(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],f=b[c+1],e=!1,g=[],k=[],h=[[],[],[]],l=F.xg(a,d),m=0;m<l;m++){var n=F.cg(a,d,m);if("SEPRGB"!=F.Va(a,n).type){e=!1;break}g.push(d,n);for(var q=
{},r=F.xg(a,n),e=0;e<r;e++){var t=F.cg(a,n,e);t in q||(q[t]=0);var z=F.bg(a,n,t,q[t]++);g.push(n,t);h[z[0]].push(d,t,z)}k.push(n);e=!0}if(e){for(m=d=l=0;m<h.length;m++)h[m].length&&(l++,d|=1<<2-m);if(l){f.type+=l;f.ya=[];for(m=0;m<h.length;m++)if(h[m].length)for(f.ya.push({wa:0,identifier:"RGB"[m],pb:!0,name:"RGB"[m]}),e=0;e<h[m].length;e+=3)h[m][e+2][0]=Y.hj(d,m);for(m=0;m<g.length;m+=2)F.Cg(a,g[m],g[m+1],0);for(m=0;m<k.length;m++)F.Ch(a,k[m]);for(m=0;m<h.length;m++)for(e=0;e<h[m].length;e+=3)F.Zc(a,
h[m][e],h[m][e+1],h[m][e+2])}}}}function t(a,b,c,d,f,e){a=a.nodes;for(var g=null,k=0;k<a.length;k++){var h=a[k];f?"GROUP"==h.type&&h.node_tree_name==c&&(g=h):h.type==c&&(g=h)}return g?n(g,b)[0]:(e||ba.error('No "'+c+'" node in node '+d),-1)}function u(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function k(a,b,c,d,f,e){var g=b.name,h=b.type,m=[],l=[],n=[],r=[],t=null,z=[];switch(h){case "BSDF_ANISOTROPIC":case "BSDF_DIFFUSE":case "BSDF_GLOSSY":case "BSDF_GLASS":case "BSDF_HAIR":case "BSDF_TRANSPARENT":case "BSDF_TRANSLUCENT":case "BSDF_REFRACTION":case "BSDF_TOON":case "BSDF_VELVET":case "SUBSURFACE_SCATTERING":case "EMISSION":case "AMBIENT_OCCLUSION":case "VOLUME_ABSORPTION":case "VOLUME_SCATTER":case "BUMP":case "NORMAL_MAP":case "VECT_TRANSFORM":case "BLACKBODY":case "WAVELENGTH":case "SEPXYZ":case "COMBXYZ":case "LIGHT_FALLOFF":case "TEX_IMAGE":case "TEX_ENVIRONMENT":case "TEX_SKY":case "TEX_NOISE":case "TEX_WAVE":case "TEX_MUSGRAVE":case "TEX_GRADIENT":case "TEX_MAGIC":case "TEX_CHECKER":case "TEX_BRICK":case "WIREFRAME":case "LAYER_WEIGHT":case "TANGENT":case "LIGHT_PATH":case "ATTRIBUTE":case "HOLDOUT":case "PARTICLE_INFO":case "HAIR_INFO":case "OBJECT_INFO":case "SCRIPT":case "NEW_GEOMETRY":l=
V(b);n=R(b);ba.warn(h+" node is not fully supported.");break;case "BRIGHTCONTRAST":case "ADD_SHADER":case "MIX_SHADER":l=V(b);n=R(b);break;case "UVMAP":var t=D("param_"+h+"_a"),x=D("param_"+h+"_v");m.push(Z(t));m.push(Z(x));n=R(b);r.push(Z(x));t={name:t,value:b.uv_layer};break;case "UV_MERGED":t=D("param_UV_MERGED_a");x=D("param_UV_MERGED_v");m.push(Z(t));m.push(Z(x));n.push(C(b,"UV_geom"));n.push(C(b,"UV_cycles"));r.push(Z(x));t={name:t,value:b.uv_layer};break;case "CAMERA":l=[];n=R(b);break;case "COMBRGB":case "COMBHSV":l=
V(b);n=R(b);break;case "CURVE_RGB":l=V(b);n=R(b);ba.warn("CURVE_RGB node is not fully supported.");break;case "CURVE_VEC":l=V(b);n=R(b);ba.warn("CURVE_VEC node is not fully supported.");break;case "GEOMETRY":if(!L(b))return!0;h=K(b,c);if(!h)return ba.error("Geometry output is not supported"),!1;switch(h){case "GEOMETRY_UV":if(!b.uv_layer)return ba.error('Missing uv layer in node "',b.name,'"'),!1;t=D("param_GEOMETRY_UV_a");x=D("param_GEOMETRY_UV_v");m.push(Z(t));m.push(Z(x));n.push(C(b,"UV"));r.push(Z(x));
t={name:t,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return ba.error("Missing vertex color layer in node ",b.name),!1;t=D("param_GEOMETRY_VC_a");x=D("param_GEOMETRY_VC_v");m.push(Z(t));m.push(Z(x));n.push(C(b,"Vertex Color"));r.push(Z(x));t={name:t,value:b.color_layer};break;case "GEOMETRY_NO":n.push(C(b,"Normal"));break;case "GEOMETRY_FB":n.push(C(b,"Front/Back"));break;case "GEOMETRY_VW":n.push(C(b,"View"));break;case "GEOMETRY_GL":n.push(C(b,"Global"));break;case "GEOMETRY_LO":n.push(C(b,
"Local"));break;case "GEOMETRY_OR":x=D("param_GEOMETRY_OR_v"),m.push(Z(x)),n.push(C(b,"Orco")),r.push(Z(x))}break;case "TEX_COORD":if(!L(b))return!0;h=O(b,c);if(!h)return ba.error("Texture coordinate output is not supported"),!1;switch(h){case "TEX_COORD_UV":t=D("param_TEX_COORD_UV_a");x=D("param_TEX_COORD_UV_v");m.push(Z(t));m.push(Z(x));n.push(C(b,"UV"));r.push(Z(x));t={name:t,value:b.uv_layer};break;case "TEX_COORD_NO":n.push(C(b,"Normal"));break;case "TEX_COORD_GE":x=D("param_TEX_COORD_GE_v");
m.push(Z(x));n.push(C(b,"Generated"));r.push(Z(x));break;case "TEX_COORD_OB":n.push(C(b,"Object"));ba.warn('Output "Object" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_CA":n.push(C(b,"Camera"));break;case "TEX_COORD_WI":n.push(C(b,"Window"));ba.warn('Output "Window" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_RE":n.push(C(b,"Reflection")),ba.warn('Output "Reflection" of node "Texture Coordinate" doesn\'t supported fully.')}break;
case "GROUP":x=b.node_tree_name;switch(x){case "B4W_LINEAR_TO_SRGB":if(!q(b,[1],[1])){t=J(b,f,e);break}h="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!q(b,[1],[1])){t=J(b,f,e);break}h="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!q(b,[1],[1])){t=J(b,f,e);break}h="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!q(b,[1,1],[1])){t=J(b,f,e);break}h="B4W_REFLECT";break;case "B4W_REFRACTION":if(!q(b,[1,0],[1])){t=J(b,f,e);break}h="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!q(b,
[1,1,0,0,0],[1])){t=J(b,f,e);break}var h="B4W_PARALLAX",u=D("temp_texture");r.push(Z(u));break;case "B4W_CLAMP":if(!q(b,[1],[1])){t=J(b,f,e);break}h="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!q(b,[0,0,0,0,0],[0])){t=J(b,f,e);break}h="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!q(b,[],[0])){t=J(b,f,e);break}h="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!q(b,[0,0,0],[0])){t=J(b,f,e);break}h="B4W_SMOOTHSTEP";break;case "B4W_GLOW_OUTPUT":h="B4W_GLOW_OUTPUT";break;default:t=J(b,f,e)}l=V(b);n=R(b);"B4W_TRANSLUCENCY"==
x&&(x=M("TranslucencyParams","TranslucencyParams",[0,0,0,0]),x.pb=n[0].pb,n.push(x));break;case "LAMP":t=b.lamp;if(!t)return ba.error("There is no lamp in node: "+b.name),!1;n.push(C(b,"Color"));n.push(C(b,"Light Vector"));n.push(C(b,"Distance"));n.push(C(b,"Visibility Factor"));t.uuid in pa?z.push(["LAMP_INDEX",String(pa[t.uuid])]):(pa[t.uuid]=La,z.push(["LAMP_INDEX",String(La++)]));t=pa;break;case "NORMAL":l=V(b);n=R(b);x=C(b,"Normal");r.push(Z(D("param_NORMAL_Normal"),x.wa,3));break;case "MAPPING":x=
b.vector_type;h="MAPPING";l.push(I(b,"Vector"));n.push(C(b,"Vector"));var u=b.rotation,w=b.scale,v=b.translation,p=ca.create(),y=Y.Nx(u);"TEXTURE"==x&&(w[0]=w[0]||1,w[1]=w[1]||1,w[2]=w[2]||1);var N=new Float32Array([w[0],0,0,0,w[1],0,0,0,w[2]]);ca.multiply(y,N,p);p=Y.Jz(p,qa.create());switch(x){case "POINT":p[12]=v[0];p[13]=v[1];p[14]=v[2];break;case "TEXTURE":p[12]=v[0];p[13]=v[1];p[14]=v[2];p=qa.invert(p,p);break;case "NORMAL":qa.invert(p,p),qa.transpose(p,p)}switch(x){case "NORMAL":z.push(["MAPPING_IS_NORMAL",
1]);case "TEXTURE":z.push(["MAPPING_TRS_MATRIX",U.t(p,16)]);break;case "POINT":0!==ia.length(u)?z.push(["MAPPING_TRS_MATRIX",U.t(p,16)]):(0!==ia.length(w)&&z.push(["MAPPING_SCALE",U.t(w,3)]),0!==ia.length(v)&&z.push(["MAPPING_TRANSLATION",U.t(v,3)]));break;case "VECTOR":0!==ia.length(u)?z.push(["MAPPING_TRS_MATRIX",U.t(p,16)]):0!==ia.length(w)&&z.push(["MAPPING_SCALE",U.t(w,3)])}b.use_min&&z.push(["MAPPING_MIN_CLIP",U.t(b.min,3)]);b.use_max&&z.push(["MAPPING_MAX_CLIP",U.t(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":t=
I(b,"Color");t.wa.splice(3);l.push(t);t=I(b,"Spec");t.wa.splice(3);l.push(t);l.push(M("DiffuseIntensity","DiffuseIntensity",b.diffuse_intensity));x=I(b,"Normal");x.wa.splice(3);l.push(x);n.push(C(b,"Color"));n.push(C(b,"Alpha"));n.push(C(b,"Normal"));"MATERIAL_EXT"==h?((t=I(b,"Emit"))?l.push(t):l.push(M("Emit","Emit",0)),t=I(b,"Translucency"),t.wa=0,t.name="Translucency",t.identifier="Translucency",t?l.push(t):l.push(M(t.name,t.identifier,t.wa)),t=I(b,"Translucency"),t.wa=[0,0,0,0],t.name="TranslucencyParams",
t.identifier="TranslucencyParams",t?l.push(t):l.push(M(t.name,t.identifier,t.wa)),t=I(b,"Reflectivity"),u=I(b,"Ray Mirror"),t?u="Reflectivity":u?(t=u,u="Ray Mirror"):u="Reflectivity",t?l.push(t):l.push(M(u,u,0)),(t=I(b,"SpecTra"))?l.push(t):l.push(M("SpecTra","SpecTra",0)),(t=I(b,"Alpha"))?l.push(t):l.push(M("Alpha","Alpha",b.alpha)),n.push(C(b,"Diffuse")),n.push(C(b,"Spec"))):(r.push(Z(D("param_MATERIAL_alpha"),b.alpha)),r.push(Z(D("param_MATERIAL_spec_alpha"),b.specular_alpha)));u=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":t=
b.specular_hardness;break;case "WARDISO":t=b.specular_slope;break;case "TOON":t=b.specular_toon_size;u=b.specular_toon_smooth;break;case "BLINN":t=b.specular_ior;u=b.specular_hardness;break;default:ba.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.material_name+'")'),t=b.specular_hardness}switch(b.diffuse_shader){case "LAMBERT":v=w=0;break;case "OREN_NAYAR":w=b.roughness;v=0;break;case "FRESNEL":w=b.diffuse_fresnel;v=b.diffuse_fresnel_factor;break;case "MINNAERT":w=b.darkness;
v=0;break;case "TOON":w=b.diffuse_toon_size;v=b.diffuse_toon_smooth;break;default:ba.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),v=w=0}r.push(Z(D("param_MATERIAL_diffuse"),[w,v],2));r.push(Z(D("param_MATERIAL_spec"),[b.specular_intensity,t,u],3));t={name:b.name,value:{BB:b.specular_shader,Ex:b.diffuse_shader,md:b.use_shadeless}};x.pb&&z.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&z.push(["USE_MATERIAL_DIFFUSE",1]);b.use_specular&&z.push(["USE_MATERIAL_SPECULAR",
1]);break;case "MATH":switch(b.operation){case "ADD":h="MATH_ADD";break;case "SUBTRACT":h="MATH_SUBTRACT";break;case "MULTIPLY":h="MATH_MULTIPLY";break;case "DIVIDE":h="MATH_DIVIDE";break;case "SINE":h="MATH_SINE";break;case "COSINE":h="MATH_COSINE";break;case "TANGENT":h="MATH_TANGENT";break;case "ARCSINE":h="MATH_ARCSINE";break;case "ARCCOSINE":h="MATH_ARCCOSINE";break;case "ARCTANGENT":h="MATH_ARCTANGENT";break;case "POWER":h="MATH_POWER";break;case "LOGARITHM":h="MATH_LOGARITHM";break;case "MINIMUM":h=
"MATH_MINIMUM";break;case "MAXIMUM":h="MATH_MAXIMUM";break;case "ROUND":h="MATH_ROUND";break;case "LESS_THAN":h="MATH_LESS_THAN";break;case "GREATER_THAN":h="MATH_GREATER_THAN";break;case "MODULO":h="MATH_MODULO";break;case "ABSOLUTE":h="MATH_ABSOLUTE";break;default:return ba.error("Unsupported MATH operation: "+b.operation),!1}z.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);l=V(b);n=R(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":h="MIX_RGB_MIX";break;case "ADD":h="MIX_RGB_ADD";break;case "MULTIPLY":h=
"MIX_RGB_MULTIPLY";break;case "SUBTRACT":h="MIX_RGB_SUBTRACT";break;case "SCREEN":h="MIX_RGB_SCREEN";break;case "DIVIDE":h="MIX_RGB_DIVIDE";break;case "DIFFERENCE":h="MIX_RGB_DIFFERENCE";break;case "DARKEN":h="MIX_RGB_DARKEN";break;case "LIGHTEN":h="MIX_RGB_LIGHTEN";break;case "OVERLAY":h="MIX_RGB_OVERLAY";break;case "DODGE":h="MIX_RGB_DODGE";break;case "BURN":h="MIX_RGB_BURN";break;case "HUE":h="MIX_RGB_HUE";break;case "SATURATION":h="MIX_RGB_SATURATION";break;case "VALUE":h="MIX_RGB_VALUE";break;
case "COLOR":h="MIX_RGB_COLOR";break;case "SOFT_LIGHT":h="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":h="MIX_RGB_LINEAR_LIGHT";break;default:return ba.error("Unsupported MIX_RGB blend type: "+b.blend_type),!1}z.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);l=V(b);n=R(b);break;case "OUTPUT":l=V(b);n=[];break;case "RGB":x=f+"%join%"+b.name;x={name:"-1",value:x};r.push(x);n.push(C(b,"Color"));break;case "SEPRGB":case "SEPHSV":l=V(b);n=R(b);break;case "TEXTURE":h=A(b);if("TEXTURE_EMPTY"==h)n.push(C(b,
"Color")),n.push(C(b,"Normal")),n.push(C(b,"Value"));else if("TEXTURE_ENVIRONMENT"==h)l.push(I(b,"Vector")),n.push(C(b,"Color")),n.push(C(b,"Value"));else{if("TEXTURE_NORMAL"==h&&"ENVIRONMENT_MAP"==b.texture.type)return ba.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),!1;for(w=0;4>w;++w)w?(t=M("Vector"+w,"Vector"+w,[0,0,0]),"TEXTURE_COLOR"==h&&(x=M("Color"+w,"Color"+w,[0,0,0]),u=M("Value"+w,"Value"+w,0)),"TEXTURE_NORMAL"==h&&(x=M("Normal"+w,"Normal"+w,[0,0,0]),u=M("Value"+w,"Value"+w,
0))):(t=I(b,"Vector"),"TEXTURE_COLOR"==h&&(x=C(b,"Color"),u=C(b,"Value")),"TEXTURE_NORMAL"==h&&(x=C(b,"Normal"),u=C(b,"Value"))),l.push(t),n.push(x),n.push(u)}u=D("param_TEXTURE_texture");r.push(Z(u));t={name:u,value:b.texture};break;case "VALTORGB":l=V(b);n=R(b);ba.warn("VALTORGB node is not fully supported.");break;case "VALUE":h="VALUE";x=f+"%join%"+b.name;x={name:"-1",value:x};r.push(x);n.push(C(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":h="VECT_MATH_ADD";break;case "SUBTRACT":h=
"VECT_MATH_SUBTRACT";break;case "AVERAGE":h="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":h="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":h="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":h="VECT_MATH_NORMALIZE";break;default:return ba.error("Unsupported VECT_MATH operation: "+b.operation),!1}l=V(b);n=R(b);break;default:l=V(b),n=R(b)}g={name:g,type:h,$h:m,G:l,ya:n,N:r,data:t,de:z};F.Jj(a,F.Hq(a),g);if(!(g="GEOMETRY"!=b.type&&"TEX_COORD"!=b.type)){a:{g=b.outputs;for(m=h=0;m<g.length;m++)if(g[m].is_linked&&
h++>c){g=!0;break a}g=!1}g=!g}return g||k(a,b,++c,d,f,e)?!0:!1}function q(a,b,c){for(var d=a.inputs,f=a.outputs,e=a.node_tree_name,g=0;g<b.length;g++){var k=d[g],h=b[g];if(!k||k.default_value instanceof Array!=h)return ba.warn('Wrong inputs for custom node group "'+a.name+'" of type: "',e,'".Processing as general node group.'),!1}for(g=0;g<c.length;g++)if(b=f[g],d=c[g],!b||b.default_value instanceof Array!=d)return ba.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',e,'".Processing as general node group.'),
!1;return!0}function J(a,b,d){var f=a.node_group.node_tree,e={},g;for(g in f)if("links"==g||"nodes"==g){e[g]=[];for(var k=0;k<f[g].length;k++){e[g][k]={};for(var h in f[g][k])if("links"==g){e[g][k][h]={};for(var l in f[g][k][h])e[g][k][h][l]=G(f[g][k][h][l])}else e[g][k][h]=G(f[g][k][h])}}else e[g]=G(f[g]);f=a.node_tree_name;if("B4W_REPLACE"==f||"B4W_LEVELS_OF_QUALITY"==f)g=u("Group input","GROUP_INPUT",[],a.inputs),k=u("Group output","GROUP_OUTPUT",a.outputs,[]),h=null,h="B4W_REPLACE"==f||"B4W_LEVELS_OF_QUALITY"==
f&&(P.quality==na.P_LOW||P.Km)?{from_node:g,from_socket:g.outputs[1],to_node:k,to_socket:k.inputs[0]}:{from_node:g,from_socket:g.outputs[0],to_node:k,to_socket:k.inputs[0]},e.nodes=[g,k],e.links=[h];f=a.name;g=e.nodes;k=e.links;for(h=0;h<g.length;h++)g[h].name=W(g[h].type,f,g[h].name);for(h=0;h<k.length;h++)k[h].from_node.name=W(k[h].from_node.type,f,k[h].from_node.name),k[h].to_node.name=W(k[h].to_node.type,f,k[h].to_node.name);return{Vz:c(e,a.node_group.uuid,!0,b,d),Wz:e.links}}function G(a){var b=
typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?Y.ni(a):a}function D(a){x[a]||(x[a]=0);var b=a+x[a],b=b.replace(/ /g,"_").replace(/\//g,"_");x[a]++;return b}function L(a){a=a.outputs;for(var b=0;b<a.length;b++)if(a[b].is_linked)return!0;return!1}function K(a,b){for(var c=a.outputs,d=0,f=0;f<c.length;f++){var e=c[f];if(e.is_linked&&!(d++<b))switch(e.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";
case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";case "Local":return"GEOMETRY_LO";case "Orco":return"GEOMETRY_OR";default:return null}}}function O(a,b){for(var c=a.outputs,d=0,f=0;f<c.length;f++){var e=c[f];if(e.is_linked&&!(d++<b))switch(e.identifier){case "Camera":return"TEX_COORD_CA";case "Generated":return"TEX_COORD_GE";case "Normal":return"TEX_COORD_NO";case "Object":return"TEX_COORD_OB";case "Reflection":return"TEX_COORD_RE";case "UV":return"TEX_COORD_UV";case "Window":return"TEX_COORD_WI";
default:return null}}}function A(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,f=!1,e=0;e<b.length;e++){var g=b[e];if(g.is_linked)switch(g.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":f=!0;break;default:throw"Unknown texture output";}}if(c)return d&&ba.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(f)return"ENVIRONMENT_MAP"==
a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function I(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var f=c[d];if(f.identifier==b)return Q(f)}return null}function C(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var f=c[d];if(f.identifier==b)return Q(f)}return null}function Q(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=Y.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,pb:d,wa:a}}function M(a,b,c){return{name:a,identifier:b,pb:!1,wa:c}}function V(a){for(var b=[],c=0;c<
a.inputs.length;c++){var d=Q(a.inputs[c]);d.wa.length&&d.wa.splice(3);b.push(d)}return b}function R(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=Q(a.outputs[c]);b.push(d)}return b}function Z(a,b,c){b=null===b||void 0===b?null:U.t(b,c);return{name:a,value:b}}function fa(a,b,c,d,f,e){var g=[],k=e.from_socket.identifier;e=e.to_socket.identifier;var h=d.ya;for(d=0;d<h.length;d++)if(h[d].identifier==k){g.push(d);break}f=f.G;for(d=0;d<f.length;d++)if(f[d].identifier==e){g.push(d);break}2==g.length&&
F.Zc(a,b,c,g);return!0}function W(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function ha(a){var b=[];F.S(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function S(a,b,c){for(var d=0;d<c.length;d++){var f=c[d].data.Vz,e=c[d].data.Wz;if(!f)return!1;F.S(f,function(b,c){F.Jj(a,F.Hq(a),c)});for(f=0;f<e.length;f++)b.push(e[f]);ea(c[d],b,a)}return!0}function oa(a,b,c,d,f,e){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+
"*GI*")||f.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||e.push(c)}}function da(a,b,c){for(var d=[],f=0;f<c.length;f++){for(var e=c[f],g=null,k=0;k<b.length;k++)if(e.from_socket.identifier==b[k].to_socket.identifier){g=b[k];break}g?(e.from_node=g.from_node,e.from_socket=g.from_socket):d.push(e)}for(f=0;f<b.length;f++)a.splice(a.indexOf(b[f]),1);return d}function ga(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function aa(a,b,
c,d){for(var f=0;f<d.length;f++){for(var e=d[f],g,k=0;k<c.G.length;k++)if(e.from_socket.identifier==c.G[k].identifier){g=c.G[k].wa;break}for(var k=e,h=b,l=g,m=n(k.to_node,h),q=0;q<m.length;q++)for(var r=F.Va(h,m[q]),t=0;t<r.G.length;t++)if(r.G[t].identifier==k.to_socket.identifier){r.G[t].wa=l;break}e=a.indexOf(e);-1!=e&&a.splice(e,1)}}function ea(a,b,c){for(var d=a.name,f=[],e=[],g=[],k=[],h=0;h<b.length;h++){var l=b[h];oa(l.from_node,d,l,f,g,k);oa(l.to_node,d,l,e,g,k)}e=da(b,e,g);f=da(b,k,f);ga(b,
e);aa(b,c,a,e);if(f.length){var m;F.S(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(m=b)});aa(b,c,m,f)}}var ba=p("__print"),F=p("__graph"),U=p("__shaders"),Y=p("__util"),na=p("__config"),ia=p("vec3");p("vec4");var ca=p("mat3"),qa=p("mat4"),x={},N={},pa={},La=0;new Float32Array(4);var P=na.p;a.Ew=c;a.Fw=function(a){var b=[],c={};x={};var d=F.Ao(a);F.S(d,function(a,d){var f;f=[];for(var e=[],g=[],k=[],h=[],l=[],m=0;m<d.G.length;m++){var n=d.G[m];if(n.pb)f.push(null),e.push(null);
else{f.push(D("in_"+d.type+"_"+n.identifier));var q=U.t(n.wa,0);P.Qs&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==n.identifier||"Color2"==n.identifier||"Fac"==n.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==n.identifier||"Value_001"==n.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==n.identifier)&&(n=q,n=n.replace(/(,)/g,"$1 "),n=n.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),n=n.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),q=n=n.replace(/\s+/g,
""));e.push(q)}}for(m=0;m<d.ya.length;m++)n=d.ya[m],n.pb?g.push(null):g.push(D("out_"+d.type+"_"+n.identifier));for(m=0;m<d.N.length;m++)n=d.N[m],k.push(n.name),h.push(n.value);for(m=0;m<d.$h.length;m++)l.push(d.$h[m].name);f={id:d.type,G:f,gn:e,ya:g,N:k,Mk:h,$h:l,de:JSON.parse(JSON.stringify(d.de))};b.push(f);c[a]=f});F.Jd(d,function(a,b,f){var e=F.Va(d,a);F.Va(d,b);var g=e.ya[f[0]];a=c[a].ya;b=c[b].G;e=a[f[0]]||D("out_"+e.type+"_"+g.identifier);a[f[0]]=e;b[f[1]]=e});return b};a.Mp=function(a){if(a.node_tree)for(var b=
0;b<a.node_tree.nodes.length;b++){var c=a.node_tree.nodes[b];if("GROUP"==c.type&&"B4W_GLOW_OUTPUT"==c.node_tree_name)return!0}return!1};a.cleanup=function(){for(var a in N)delete N[a];for(var b in pa)delete pa[b];La=0}};b4w.module.__animation=function(a,p){function c(a,b){var c=a.C[b];c&&c.Hm&&c.Bi&&(c.Bi=!1,c.Hm(a,b))}function d(a,b,c){c=a.C[c];c.type=30;var d=b.frame_start,f=b.frame_end-d+1;c.start=d;c.length=f;c.rc=d;c.Sg=b.name;for(f=d=0;f<a.data.b4w_vertex_anim.length;f++){var e=a.data.b4w_vertex_anim[f];if(e==b)break;else d+=e.frame_end-e.frame_start+1}c.Gt=d}function b(a,b,c){a=a.C[c];a.type=50;a.Sg=b.name;c=b.settings;a.start=c.frame_start;a.length=c.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=c.lifetime);
a.zc=b}function e(a){return a.replace(/_B4W_BAKED$/,"")}function h(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:S.ga("Wrong animation behavior")}}function g(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&l(d,b)}return b}function l(a,b){if(a.animation_data){var c=a.animation_data.action;c&&S.yd(c.fcurves)&&b.push(c)}for(var c=a.nodes,d=0;d<c.length;d++){var f=c[d];f.node_group&&(f=f.node_group.node_tree)&&
l(f,b)}}function n(a){return S.is_mesh(a)&&a.e.ol?!0:!1}function f(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function m(a,b,d,f){t(a,b,d,f);c(a,d);a.e.Me&&(q(a,b),k(a,b))}function r(a){if(!S.is_mesh(a))return null;a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}function z(a,b,c){var d=b.frame_range;if(d[0]>d[1])return Z.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;var f=b.e,e=
a.C[c];e.Sg=b.name;e.Al=d;e.ip=f.fA;e.hp=f.Xv;e.Uj=f.Uj;e.start=d[0];e.length=d[1]-d[0];e.rc=d[0];d=S.yd(f.Qj);if(S.is_armature(a)&&d){e.type=10;var g=w(a,b);g||(g=J(a,b,H(a)),a.Sd.push(b,g));e.h=g.h;e.Da=g.Da;var e=a.e,g=e.cl,k=a.C[c],f=k.co,h;a:{h=e.Ss;for(var m=0;m<h.length;m+=2)if(b==h[m]){h=h[m+1];break a}h=null}if(h)k.co=h;else{for(k=0;k<g.length;k++)h=J(a,b,g[k].Pc),f.push(h);e.Ss.push(b,f)}e.Me&&(b=e.hl,c>b[1]?(e=b[1],b[1]=c,b[0]=e):c>b[0]&&c<b[1]&&(b[0]=c),E(a))}else if(fa.ne(a)&&(f.N.volume||
f.N.pitch))e.volume=f.N.volume||null,e.pitch=f.N.pitch||null,e.type=40;else if("MESH"==a.type&&B(b)){e.type=60;f=w(a,b);if(!f){f=[];k=[];h=[];var m=[],l=b.e,n=a.e.zk,q=a.e.Ak;for(g in l.N){var r=b.name+"%join%"+g;v(g,r,l,k,f,n);v(g,r,l,m,h,q)}f={NC:f,values:k,FA:h,GA:m};a.Sd.push(b,f)}e.Nr=f.NC;e.Pr=f.values;e.Mr=f.FA;e.Or=f.GA}else if(g=f.N.tsr){e.type=20;f=w(a,b);if(!f){f=b.e.Tr;k=[];h=[];for(m=0;m<f;m++)k.push(g.subarray(8*m,8*m+4)),h.push(g.subarray(8*m+4,8*m+8));f={h:k,Da:h};a.Sd.push(b,f)}e.h=
f.h;e.Da=f.Da;V.lh(a)&&V.yC(a,e.h[0],e.Da[0])}else return Z.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;S.is_armature(a)&&!d&&y(a,c);return!0}function w(a,b){for(var c=a.Sd,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function E(a){var b=a.e.hl;if(-1!=b[0]&&-1!=b[1]){var c=a.C;a=c[b[1]].rc;var d=Math.floor(a),f=a-d,b=c[b[0]];a=b.rc;d=Math.floor(a);b.rc=d+f}}function y(a,b){var c=a.e.hl,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var f=a.C;0<=d;d--){var e=
f[d];if(e&&10==e.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function H(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var f=b[d].name;c[f]={Bp:d,ui:d,Pn:S.Um(a,"name",f),Jt:-1}}return c}function v(a,b,c,d,f,e){for(var g=0;g<e.length;g+=2)b==e[g]&&(f.push(e[g+1]),d.push(new Float32Array(c.N[a])))}function B(a){a=a.e;for(var b in a.N)if(-1!=b.indexOf("nodes"))return!0;return!1}function t(a,b,c,d){if((c=a.C[c])&&null!=c.type&&(c.play||d)){var f=a.e,e=c.rc,g=c.start,k=
c.length,e=e+c.speed*b*aa.Ja,h=c.type,m=c.speed;if(0<=m&&e>=g+k||0>m&&e<g)switch(d||(c.Bi=!0),c.behavior){case 10:e=0<=m?(e-g)%k+g:g+k-1E-6;break;case 20:e=0<=m?g:g+k-1E-6;c.play=!1;break;case 30:e=0<=m?g+k-1E-6:g,c.play=!1}c.rc=e;switch(h){case 10:if(!f.Me){d=u(c,e,ea);b=d[0];e=d[1];d=d[2];f.Cc=c.Da[b];f.Bc=c.Da[e];f.Kc=c.h[b];f.Jc=c.h[e];f.Zf=d;f=f.cl;c=c.co;for(g=0;g<f.length;g++)k=f[g],h=c[g],k.Cc=h.Da[b],k.Bc=h.Da[e],k.Kc=h.h[b],k.Jc=h.h[e],k.Zf=d;W.v(a)}break;case 20:k=d=u(c,e,ea);(f=ba)||(f=
new Float32Array(4));var e=k[0],g=k[1],k=k[2],h=c.h,m=h[e][1],l=h[e][2],n=h[g][1],q=h[g][2];f[0]=(1-k)*h[e][0]+k*h[g][0];f[1]=(1-k)*m+k*n;f[2]=(1-k)*l+k*q;e=d;(g=U)||(g=new Float32Array(4));k=c.Da;da.slerp(k[e[0]].subarray(0,4),k[e[1]].subarray(0,4),e[2],g);e=g;g=d[2];k=c.h;d=(1-g)*k[d[0]][3]+g*k[d[1]][3];c.Bo&&(g=F,W.get_translation(a,g),S.smooth_v(f,g,b,c.Bo,f));c.Un&&(g=Y,W.get_rotation(a,g),S.Zs(e,g,b,c.Un,e));c=c.Uj;c[0]&&W.set_translation(a,f);c[1]&&W.set_rotation(a,e);c[2]&&W.set_scale(a,d);
W.v(a);R.sync_transform(a);break;case 30:(a=ea)||(a=Array(3));e-=c.start;0>e&&(e=0);e>=c.length&&(e=c.length);b=Math.floor(e);d=b+1;e-=b;10!=c.behavior&&d==c.length&&(d=--b,e=1);c=c.Gt;a[0]=b+c;a[1]=d+c;a[2]=e;d=ea;f.Ho=d[0];f.Ft=d[2];break;case 40:d=u(c,e,ea);b=d[0];f=d[1];d=d[2];c.volume&&fa.set_volume(a,(1-d)*c.volume[b]+d*c.volume[f]);c.pitch&&fa.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[f]);break;case 50:V.eB(c.zc,e/aa.Ja);break;case 60:d=u(c,e,ea);b=d[0];f=d[1];d=d[2];h=c.Pr;m=c.Nr;e=c.Or;c=c.Mr;
for(g=0;g<m.length;g++)l=h[g],k=m[g],a.e.qe[k]=(1-d)*l[b]+d*l[f];for(g=0;g<c.length;g++)h=e[g],k=c[g],h=ga.lerp(h.subarray(3*b,3*b+3),h.subarray(3*f,3*f+3),d,ba),a.e.xc[k]=h[0],a.e.xc[k+1]=h[1],a.e.xc[k+2]=h[2];break;default:S.ga("Unknown animation type:"+h)}}}function u(a,b,c){c||(c=Array(3));var d=a.Al[0],f=a.Al[1]-d;b-=d;0>b&&(b=0);b>=f&&(b=f);b/=a.ip;f=Math.floor(b);a=a.hp[f]?b-f:0;b=Math.ceil(f+a);c[0]=f;c[1]=b;c[2]=a;return c}function k(a,b){var c=a.e,d=c.Le,f=c.hl,e=f[0],f=f[1];if(-1!=f){if(-1!=
e){var g=a.C[e];if(g.play||0==b)var k=u(g,g.rc,ea),h=k[0],m=k[1],k=k[2],l=g.Da[h],n=g.Da[m],h=g.h[h],m=g.h[m];else d=1}else d=1;f=a.C[f];if(f.play||0==b)var k=u(f,f.rc,ea),q=k[0],r=k[1],k=k[2];else if(-1!=e&&g.play)d=0;else return;e=f.Da[q];g=f.Da[r];q=f.h[q];f=f.h[r];if(1==d)c.Cc.set(e),c.Bc.set(g),c.Kc.set(q),c.Jc.set(f);else if(0==d)c.Cc.set(l),c.Bc.set(n),c.Kc.set(h),c.Jc.set(m);else{for(r=0;r<l.length;r+=4){for(var t=U,F=Y,z=0;4>z;z++)t[z]=l[r+z],F[z]=e[r+z];da.slerp(t,F,d,t);for(z=0;4>z;z++)c.Cc[r+
z]=t[z];for(z=0;4>z;z++)t[z]=n[r+z],F[z]=g[r+z];da.slerp(t,F,d,t);for(z=0;4>z;z++)c.Bc[r+z]=t[z]}S.yp(h,q,d,c.Kc);S.yp(m,f,d,c.Jc)}W.v(a);d=c.cl;l=c.Kr;for(r=0;r<d.length;r++){n=d[r];h=l[r];for(m=0;m<h.length;m+=2)for(q=h[m],e=h[m+1],g=0;4>g;g++)n.Cc[q+g]=c.Cc[e+g],n.Bc[q+g]=c.Bc[e+g],n.Kc[q+g]=c.Kc[e+g],n.Jc[q+g]=c.Jc[e+g];n.Zf=k}}}function q(a,b){var c=a.e,d=c.Le,f=c.El;if(0!=f){var d=c.Dl-d,e=f*b;S.sign(d)==S.sign(f)&&Math.abs(e)<Math.abs(d)?c.Le+=e:(c.Le=c.Dl,c.El=0)}}function J(a,b,c){for(var d=
a.pose.bones,f=[],e=[],g=b.e.Tr,k=0;k<g;k++){for(var h=0;h<d.length;h++){var m=d[h],l=ha.create(),n=b.e.Qj[m.name];n&&ha.copy(n.subarray(8*k,8*k+8),l);m.ep=l;m.Fj=!1}h=G(a,c);f.push(h.h);e.push(h.Da)}return{h:f,Da:e}}function G(a,b){var c=[],d=[],f=a.pose.bones,e=new Float32Array(4),g=new Float32Array(4),k;for(k in b){var h=b[k],m=h.ui,l=f[h.Pn],h=e,n=g,q=l.jv,r=q[q.length-1],t=r.zl;r.Fj||ha.identity(t);for(r=q.length-1;0<=r;r--){var l=q[r],F=l.zl;if(l.Fj)t=F;else{var z=l.fp,u=l.ep;ha.invert(z,na);
ha.multiply(u,na,na);ha.multiply(z,na,na);ha.multiply(t,na,F);t=F;l.Fj=!0}}l=l.zl;h[0]=l[0];h[1]=l[1];h[2]=l[2];h[3]=l[3];n[0]=l[4];n[1]=l[5];n[2]=l[6];n[3]=l[7];da.normalize(n,n);for(h=0;4>h;h++)n=4*m+h,c[n]=e[h],d[n]=g[h]}c=new Float32Array(c);d=new Float32Array(d);return{h:c,Da:d}}function D(a){var b=[0,0,0],c;for(c in a)"location"==c?b[0]=1:"rotation_quaternion"==c?b[1]=1:"scale"==c&&(b[2]=1);return b}function L(a,b,c,d,f,e,g){var k=a+(b-a)/2,h=K(k,d,f,e,g)-c;return.02>Math.abs(h)?k:0<h?L(a,k,
c,d,f,e,g):L(k,b,c,d,f,e,g)}function K(a,b,c,d,f){var e=1-a;return b*e*e*e+3*c*e*e*a+3*d*e*a*a+f*a*a*a}function O(a,b){if(!a.C.length)for(var c=0;8>c;c++)a.C.push(null);a.C[b]={type:null,Sg:null,Al:null,ip:0,hp:null,Uj:null,Da:null,h:null,co:[],play:!1,behavior:20,rc:0,start:0,length:0,Bo:0,Un:0,Bi:!1,Gt:null,speed:1,volume:null,pitch:null,Pr:[],Nr:[],Or:[],Mr:[]};a.Sd=a.Sd||[];-1==ia.indexOf(a)&&ia.push(a)}function A(a,b){W.v(a);R.sync_transform(a);m(a,0,b,!0)}function I(a,c,f){f=f||0;if(S.is_mesh(a)){var e=
S.keysearch("name",c,a.data.b4w_vertex_anim);if(e)return O(a,f),d(a,e,f),A(a,f),!0;if((e=S.keysearch("name",c,a.particle_systems))&&"EMITTER"==e.settings.type)return O(a,f),b(a,e,f),A(a,f),!0}if(e=S.keysearch("name",c,ca)||S.keysearch("name",c+"_B4W_BAKED",ca)){O(a,f);if(z(a,e,f))return A(a,f),!0;a.C[f]=null}Z.error('Unsupported object: "'+a.name+'" or animation name: "'+c+'"');return!1}function C(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=
a[b],d=c.node_tree;if(c.use_nodes&&d&&Q(d))return!0}return!1}function Q(a){if(a.animation_data)return!0;a=a.nodes;for(var b=0;b<a.length;b++){var c=a[b];if(c.node_group&&(c=c.node_group.node_tree)&&Q(c))return!0}return!1}var M=p("__config"),V=p("__particles"),R=p("__physics"),Z=p("__print");p("__scenes");var fa=p("__sfx"),W=p("__transform"),ha=p("__tsr"),S=p("__util"),oa=p("__reformer");p("mat4");var da=p("quat");p("vec4");var ga=p("vec3"),aa=M.Ud;a.ju=1E-6;a.OBJ_ANIM_TYPE_NONE=0;a.OBJ_ANIM_TYPE_ARMATURE=
10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var ea=Array(3),ba=new Float32Array(3),F=new Float32Array(3),U=new Float32Array(4),Y=new Float32Array(4),na=new Float32Array(8);new Float32Array(16);var ia=[],ca=[];a.Sq=function(){return S.trunc((M.p.Jr-50)/
4)};a.frame_to_sec=function(a){return a/aa.Ja};a.update=function(a){for(var b=0;b<ia.length;b++){for(var d=ia[b],f=0;8>f;f++)t(d,a,f);d.e.Me&&(q(d,a),k(d,a))}for(b=0;b<ia.length;b++)for(d=ia[b],f=0;8>f&&d.C.length;f++)c(d,f)};a.Lq=function(){return ca};a.get_anim_names=function(a){var b=[];if(n(a))for(var c=0;c<a.data.b4w_vertex_anim.length;c++)b.push(a.data.b4w_vertex_anim[c].name);var d,c=[];for(d=0;d<ca.length;d++){var f=ca[d],k=f.e;S.yd(f.e.Qj)?"ARMATURE"==a.type&&c.push(f):k.N.volume||k.N.pitch?
fa.ne(a)&&c.push(f):!B(f)&&S.yd(f.fcurves)&&c.push(f)}"MESH"==a.type&&(c=c.concat(g(a)));d=c;for(c=0;c<d.length;c++)b.push(e(d[c].name));if(V.lh(a)&&V.an(a))for(c=0;c<a.particle_systems.length;c++)b.push(a.particle_systems[c].name);return b};a.LB=e;a.get_anim_type=function(a,b){var c=a.C[b];return c?c.type:0};a.apply_def=function(a){var c=0,f;f=[];var e=a.animation_data;if(e&&e.action&&(e=e.action,S.yd(e.fcurves))){var k=S.yd(e.e.Qj);"ARMATURE"!=a.type&&k||f.push(e)}fa.ne(a)&&a.data.animation_data&&
a.data.animation_data.action&&f.push(a.data.animation_data.action);"MESH"==a.type&&(f=f.concat(g(a)));if(!a.b4w_do_not_render)for(k=a.particle_systems,e=0;e<k.length;e++){var m=k[e],l=m.settings;"EMITTER"==l.type&&(O(a,c),b(a,m,c),A(a,c),a.C[c].behavior=h(a.b4w_anim_behavior),l.b4w_cyclic&&(a.C[c].behavior=10),c++)}for(e=0;e<f.length;e++)k=f[e],O(a,c),z(a,k,c)?(A(a,c),a.C[c].behavior=h(a.b4w_anim_behavior),c++):a.C[c]=null;n(a)&&(O(a,c),d(a,a.data.b4w_vertex_anim[0],c),A(a,c),a.C[c].behavior=h(a.b4w_anim_behavior))};
a.play=function(a,b,c){f(a.C,c,function(a){a.play=!0;a.Hm=b?b:null;a.Bi=!1});a.e.Me&&E(a)};a.stop=function(a,b){f(a.C,b,function(a){a.play=!1;a.Hm=null;a.Bi=!1})};a.is_play=function(a,b){var c=a.C[b];return c?c.play:!1};a.set_frame=function(a,b,c){var d=a.C;if(-1==c)for(c=0;8>c;c++){var f=d[c];f&&(f.rc=b,m(a,0,c,!0))}else if(f=d[c])f.rc=b,m(a,0,c,!0)};a.get_current_frame_float=function(a,b){var c=a.C[b];return c&&c.rc?c.rc:0};a.is_cyclic=function(a,b){var c=a.C[b];return c&&10==c.behavior};a.set_behavior=
function(a,b,c){f(a.C,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.C[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){f(a.C,d,function(a){a.Bo=b||0;a.Un=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.C[c]=null;else a.C[b]=null;a.e.Me&&y(a,b)};a.update_object_animation=m;a.sk=function(a){if("ARMATURE"==a.type||r(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||
V.lh(a)&&V.an(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||C(a)?!0:!1};a.get_first_armature_object=r;a.is_animated=function(a){return Boolean(a.C.length)};a.fw=H;a.Ep=G;a.sv=function(a){function b(a,c){for(var d=0;d<c;d++){var f=a.subarray(8*d+4,8*d+8);da.normalize(f,f)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,f=b;else-1<a.indexOf("rotation_quaternion")?(d=4,f=0==b?3:b-1):-1<a.indexOf("scale")?(d=3,f=0):(d=0,f=b);return d+f}function d(a,b,c,f,k){if(-1<c.search(e)){a=b;c=c.split('"')[1];
var h=g}else 8==k?(c="tsr",h=g):h=1<k?new Float32Array(k):0;if(!a[c]){k=a;b=c;if("object"==typeof h&&h.length)for(var m=h.length,l=new Float32Array(f*m),n=0;n<f;n++)for(var q=0;q<m;q++)l[n*m+q]=h[q];else if("number"==typeof h)for(l=new Float32Array(f),n=0;n<f;n++)l[n]=h;else S.ga("Wrong storage default value");k[b]=l}return a[c]}a.e={};var f=a.e;f.fA=1/aa.$f;var e=new RegExp(/pose.bones\[\".+\"\]/g),g=ha.create(),k=a.fcurves,h={},m={},l=0,n;for(n in k){var q=k[n],r;for(r in q){var t=q[r],F=t.nc;oa.mw(t,
a);t=t.num_channels;l||(l=F.length);for(var t=d(h,m,n,l,t),z=t.length/l,u=c(n,r|0),w=0;w<l;w++)t[w*z+u]=F[w]}}for(var p in h)"tsr"==p&&b(h[p],l);for(var v in m)b(m[v],l);f.N=h;f.Qj=m;f.Xv=a.iv;f.Tr=l;f.Uj="tsr"in h?D(k):null;ca.push(a)};a.xy=function(a,b){return(b-a)*aa.$f+1};a.Mv=function(a,b,c,d,f,e){var g,k,h=new Float32Array(2),m=new Float32Array(2),l=new Float32Array(2),n=new Float32Array(2),q=b[1],r=b[2],t=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var F=0,z=0,u=null;f<=e;f++)if(f<
q)for(var w=0;w<aa.$f;w++)c[F++]=r;else if(f>t)for(w=0;w<aa.$f;w++)c[F++]=a;else{var p=b[z],v=3;0===p&&(v+=2);0===u&&(v+=2);var C=2===p?0:1;if(b[z+1]==b[z+v+1])u=p,z+=v;else{w=0;f==b[z+1]&&(C&&(d[F]=1),c[F]=b[z+2],F++,w++);if(f==t)for(;w<aa.$f;w++)c[F++]=a;else for(h[0]=b[z+1],h[1]=b[z+2],0!==p?(m[0]=0,m[1]=0):0===u?(m[0]=b[z+5],m[1]=b[z+6]):(m[0]=b[z+3],m[1]=b[z+4]),0!==p?(l[0]=0,l[1]=0):(l[0]=b[z+v+3],l[1]=b[z+v+4]),n[0]=b[z+v+1],n[1]=b[z+v+2];w<aa.$f;w++){var I=f+w/aa.$f;switch(p){case 0:g=h;k=
m;var U=l,y=n,Y=[],A=[],E=void 0,B=void 0,D=void 0,E=void 0;Y[0]=g[0]-k[0];Y[1]=g[1]-k[1];A[0]=y[0]-U[0];A[1]=y[1]-U[1];D=y[0]-g[0];E=Math.abs(Y[0]);B=Math.abs(A[0]);0!=E+B&&E+B>D&&(E=D/(E+B),k[0]=g[0]-E*Y[0],k[1]=g[1]-E*Y[1],U[0]=y[0]-E*A[0],U[1]=y[1]-E*A[1]);C&&(d[F]=1);c[F]=K(L(0,1,I,h[0],m[0],l[0],n[0]),h[1],m[1],l[1],n[1]);F++;break;case 1:k=h[0];U=h[1];g=y=(n[1]-U)/(n[0]-k);k=U-y*k;C&&(d[F]=1);c[F]=g*I+k;F++;break;case 2:C&&(d[F]=1);c[F]=b[z+2];F++;break;default:S.ga("Unknown keyframe intepolation mode: "+
p)}}f+1==b[z+v+1]&&(u=p,z+=v)}}};a.gE=function(a){for(var b=0;b<a.length;b++)if(a[b].tD)return a[b];return!1};a.apply=I;a.Hv=function(a,b,c){c=c||0;var d=S.keysearch("uuid",b,ca);if(d){O(a,c);if(z(a,d,c)){A(a,c);return}a.C[c]=null}Z.error('Unsupported object: "'+a.name+'" or animation uuid: "'+b+'"')};a.OC=function(a,b){var c=S.keysearch("name",b,ca)||S.keysearch("name",b+"_B4W_BAKED",ca);if(c){if(!S.yd(c.fcurves))return!1}else if(!(S.keysearch("name",b,a.particle_systems)||S.is_mesh(a)&&S.keysearch("name",
b,a.data.b4w_vertex_anim)))return!1;return!0};a.get_slot_num_by_anim=function(a,b){for(var c=a.C,d=0;d<c.length;d++){var f=c[d];if(f&&e(f.Sg)==e(b))return d}return-1};a.vy=function(a,b){var c=a.C[b];return c&&c.Sg?e(c.Sg):null};a.remove=function(a){a.C.length=0;a=ia.indexOf(a);-1!=a&&ia.splice(a,1)};a.wA=function(a){for(var b=ca.length-1;0<=b;b--)ca[b].kv==a&&ca.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.C.length)return I(a,b,0)?0:-1;for(var c=0;c<a.C.length;c++)if(!a.C[c])return I(a,
b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.e.El=(b-a.e.Le)/c;a.e.Dl=b};a.set_speed=function(a,b,c){f(a.C,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.C[b].speed};a.get_anim_start_frame=function(a,b){return a.C[b].start};a.get_anim_length=function(a,b){return a.C[b].length};a.az=C;a.cleanup=function(){ia.length=0;ca.length=0};a.Wx=function(a){var b=(a[0]||a[1]||a[2]).nc.length,c=U,d=ba,f=Boolean(a[0]);f||(a[0]={nc:new Float32Array(b),num_channels:8});var e=Boolean(a[1]);e||
(a[1]={nc:new Float32Array(b),num_channels:8});var g=Boolean(a[2]);g||(a[2]={nc:new Float32Array(b),num_channels:8});a[3]={nc:new Float32Array(b),num_channels:8};for(var k=0;k<b;k++)d[0]=f?a[0].nc[k]:0,d[1]=e?a[1].nc[k]:0,d[2]=g?a[2].nc[k]:0,S.euler_to_quat(d,c),a[0].nc[k]=c[3],a[1].nc[k]=c[0],a[2].nc[k]=c[1],a[3].nc[k]=c[2]}};b4w.module.__time=function(a,p){p("__util");var c=0,d=0,b=[],e=0,h=0,g=[];a.Ns=function(a){c=a;d=performance.now();for(a=0;a<b.length;a++){var e=b[a];c>e.Bm&&(b.splice(a,1),a--,e.callback())}for(a=0;a<g.length;a++){var e=g[a],f=1-(e.Bm-c)/e.duration,f=Math.min(f,1);e.callback(e.P+f*(e.qa-e.P));1==f&&(g.splice(a,1),a--)}};a.get_timeline=function(){return c};a.set_timeout=function(a,g){var f;e++;f=e;b.push({id:f,callback:a,Bm:c+(performance.now()-d+g)/1E3});return f};a.clear_timeout=function(a){for(var c=
0;c<b.length;c++)if(b[c].id==a){b.splice(c,1);break}};a.clear_animation=function(a){for(var b=g.length;b--;)if(g[b].id==a){g.splice(b,1);break}};a.animate=function(a,b,d,e){d/=1E3;var r;h++;r=h;g.push({id:r,callback:e,P:a,qa:b,Bm:c+d,duration:d});e(a);return r};a.reset=function(){d=c=0;b.length=0;h=e=g.length=0}};b4w.module.__transform=function(a,p){function c(a,b){var c=a.e;c.h[0]=b[0];c.h[1]=b[1];c.h[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}function d(a){var c=a.e,l=r.ih(),t=a.type;"CAMERA"==t&&e.Fo(a);h.oC(a,k);"CAMERA"==t&&e.lC(a);var v=c.h,p=c.scale,y=c.quat;w.set_sep(v,p,y,c.Cb);var A=c.W;n.fromQuat(y,A);"CAMERA"!=t&&E.LA(A,p,A);A[12]=v[0];A[13]=v[1];A[14]=v[2];n.invert(A,c.or);a.C.length&&f.an(a)&&f.pC(a);c.Qb&&c.hb&&(b.Tl(c.Qb,A,c.hb),b.Vl(c.$c,A,c.wb),b.Ul(c.Lf,
c.Cb,c.Mf),c.Fc&&r.ao(l),null!=c.qc&&l&&r.wt(l,a));if(l&&l.e.Ab)for(A=l.e.Ab.Wk,p=0;p<A.length;p++)if(A[p]==a){r.zt(p,l);break}switch(t){case "SPEAKER":z.AB(a,k);break;case "CAMERA":e.mC(a);l&&r.hk(l)==a&&z.Cz(l,v,y,k);break;case "LAMP":g.qC(a);l&&r.Ig(a,l);break;case "EMPTY":a.field&&r.xt(a);break;case "MESH":if(v=a.Dj)w.invert(v.e.Cb,u),w.multiply(u,c.Cb,u),H.set(u[0],u[1],u[2],u[3],c.Il),m.set(u[4],u[5],u[6],u[7],c.Hl)}"LAMP"!=t&&"CAMERA"!=t||!l||(r.ao(l),r.OA(l));a=a.Nc;for(p=0;p<a.length;p++)d(a[p]);
c.Nm=!0}var b=p("__boundings"),e=p("__camera"),h=p("__constraints"),g=p("__lights"),l=p("__mat3"),n=p("__mat4"),f=p("__particles"),m=p("__quat"),r=p("__scenes"),z=p("__sfx"),w=p("__tsr"),E=p("__util"),y=p("__vec3"),H=p("__vec4"),v=new Float32Array(3),B=new Float32Array(4),t=new Float32Array(9),u=new Float32Array(8),k=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){k=a};a.set_translation=function(a,b){h.le(a)==h.Pd?w.set_trans(b,h.ke(a)):y.copy(b,a.e.h)};a.get_translation=function(a,b){h.le(a)==
h.Pd?y.copy(w.get_trans_view(h.ke(a)),b):y.copy(a.e.h,b)};a.set_rotation=function(a,b){h.le(a)==h.Pd?w.set_quat(b,h.ke(a)):m.copy(b,a.e.quat)};a.get_rotation=function(a,b){h.le(a)==h.Pd?m.copy(w.get_quat_view(h.ke(a)),b):m.copy(a.e.quat,b)};a.set_rotation_euler=function(a,b){if(h.le(a)==h.Pd){var c=E.euler_to_quat(b,B);w.set_quat(c,h.ke(a))}else E.euler_to_quat(b,a.e.quat)};a.set_scale=function(a,b){h.le(a)==h.Pd?w.set_scale(b,h.ke(a)):a.e.scale=b};a.get_scale=function(a){return h.le(a)==h.Pd?w.get_scale(h.ke(a)):
a.e.scale};a.get_tsr=function(a,b){if(h.le(a)==h.Pd)w.copy(h.ke(a),b);else{var c=a.e;w.set_sep(c.h,c.scale,c.quat,b)}};a.set_tsr=function(a,b){h.le(a)==h.Pd?w.copy(b,h.ke(a)):c(a,b)};a.fB=c;a.get_object_size=function(a){var b=a.e,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(b=a.e,y.copy(b.wb.F,c)):(b=a.e,a=a.data.b4w_bounding_box,c[0]=
(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,y.transformMat4(c,b.W,c));return c};a.move_local=function(a,b,c,d){a=a.e;v[0]=b;v[1]=c;v[2]=d;b=l.fromMat4(a.W,t);y.transformMat3(v,b,v);y.add(a.h,v,a.h)};a.v=d;a.distance=function(a,b){return y.dist(a.e.h,b.e.h)};a.$z=function(a,b){return y.dist(a.e.h,b)};a.get_object_bounding_box=function(a){return{max_x:a.e.hb.max_x,min_x:a.e.hb.min_x,max_y:a.e.hb.max_y,min_y:a.e.hb.min_y,max_z:a.e.hb.max_z,min_z:a.e.hb.min_z}}};b4w.module.__tsr=function(a,p){function c(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3]}function d(a,b,c){var d=b[0],e=b[1],g=b[2],h=b[3],l=b[4],n=b[5],p=b[6];b=b[7];var t=a[0]*h,u=a[1]*h,k=a[2]*h;a=b*t+n*k-p*u;var h=b*u+p*t-l*k,q=b*k+l*u-n*t,t=-l*t-n*u-p*k;c[0]=a*b+t*-l+h*-p-q*-n;c[1]=h*b+t*-n+q*-l-a*-p;c[2]=q*b+t*-p+a*-n-h*-l;c[0]+=d;c[1]+=e;c[2]+=g;return c}var b=p("__mat4"),e=p("__quat"),h=p("__util"),g=p("__vec3"),l=new Float32Array(3),n=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.from_values=function(a,b,c,d,e,g,h,l){var n=new Float32Array(8);n[0]=a;n[1]=b;n[2]=c;n[3]=d;n[4]=e;n[5]=g;n[6]=h;n[7]=l;return n};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];return b};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.create_sep=function(a,b,d,e){e||(e=new Float32Array(8));c(a,b,d,e);return e};
a.set_sep=c;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.set_scale=function(a,b){b[3]=a};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.set_quat=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.get_trans_view=function(a){return a.subarray(0,3)};a.get_scale=function(a){return a[3]};a.get_quat_view=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],g=a[1],h=a[2];n[0]=a[4];n[1]=a[5];n[2]=a[6];n[3]=a[7];e.invert(n,
n);var l=n[0],p=n[1],v=n[2],B=n[3],d=d*c,g=g*c,t=h*c,h=B*d+p*t-v*g,u=B*g+v*d-l*t,k=B*t+l*g-p*d,d=-l*d-p*g-v*t;b[0]=-(h*B+d*-l+u*-v-k*-p);b[1]=-(u*B+d*-p+k*-l-h*-v);b[2]=-(k*B+d*-v+h*-p-u*-l);b[3]=c;b[4]=l;b[5]=p;b[6]=v;b[7]=B;return b};a.to_mat4=function(a,c){var d=a[3];b.fromRotationTranslation(a.subarray(4),a.subarray(0,3),c);for(var e=0;12>e;e++)c[e]*=d;return c};a.from_mat4=function(a,b){var d=h.sh(a,l),e=h.An(a),g=h.matrix_to_quat(a,n);c(d,e,g,b);return b};a.multiply=function(a,b,c){d(b,a,c);
c[3]=a[3]*b[3];var e=a[4],g=a[5],h=a[6];a=a[7];var l=b[4],n=b[5],p=b[6];b=b[7];c[4]=e*b+a*l+g*p-h*n;c[5]=g*b+a*n+h*l-e*p;c[6]=h*b+a*p+e*n-g*l;c[7]=a*b-e*l-g*n-h*p;return c};a.transform_vec3=d;a.transform_vec3_inv=function(a,b,c){var d=b[3],e=a[0]-b[0],g=a[1]-b[1],h=a[2]-b[2];a=b[4];var l=b[5],n=b[6];b=b[7];var p=a*a+l*l+n*n+b*b,p=p?1/p:0;a=-a*p;l=-l*p;n=-n*p;b*=p;var p=b*e+l*h-n*g,t=b*g+n*e-a*h,u=b*h+a*g-l*e,e=-a*e-l*g-n*h;c[0]=p*b+e*-a+t*-n-u*-l;c[1]=t*b+e*-l+u*-a-p*-n;c[2]=u*b+e*-n+p*-l-t*-a;c[0]/=
d;c[1]/=d;c[2]/=d;return c};a.transform_vectors=function(a,b,c,d){d||(d=0);var e=a.length,g=b[0],h=b[1],l=b[2],n=b[3],p=b[4],t=b[5],u=b[6];b=b[7];for(var k=0;k<e;k+=3){var q=a[k]*n,J=a[k+1]*n,G=a[k+2]*n,D=b*q+t*G-u*J,L=b*J+u*q-p*G,K=b*G+p*J-t*q,q=-p*q-t*J-u*G;c[d+k]=D*b+q*-p+L*-u-K*-t;c[d+k+1]=L*b+q*-t+K*-p-D*-u;c[d+k+2]=K*b+q*-u+D*-t-L*-p;c[d+k]+=g;c[d+k+1]+=h;c[d+k+2]+=l}return c};a.transform_dir_vectors=function(a,b,c,d){d||(d=0);var e=a.length,g=b[3],h=b[4],l=b[5],n=b[6];b=b[7];for(var p=0;p<
e;p+=3){var t=a[p]*g,u=a[p+1]*g,k=a[p+2]*g,q=b*t+l*k-n*u,J=b*u+n*t-h*k,G=b*k+h*u-l*t,t=-h*t-l*u-n*k;c[d+p]=q*b+t*-h+J*-n-G*-l;c[d+p+1]=J*b+t*-l+G*-h-q*-n;c[d+p+2]=G*b+t*-n+q*-l-J*-h}return c};a.transform_dir_vec3=function(a,b,c){var d=b[3],e=b[4],g=b[5],h=b[6];b=b[7];var l=a[0]*d,n=a[1]*d,p=a[2]*d;a=b*l+g*p-h*n;var d=b*n+h*l-e*p,t=b*p+e*n-g*l,l=-e*l-g*n-h*p;c[0]=a*b+l*-e+d*-h-t*-g;c[1]=d*b+l*-g+t*-e-a*-h;c[2]=t*b+l*-h+a*-g-d*-e;return c};a.transform_tangents=function(a,b,c,d){d||(d=0);var e=a.length,
g=b[3],h=b[4],l=b[5],n=b[6];b=b[7];for(var p=0;p<e;p+=4){var t=a[p]*g,u=a[p+1]*g,k=a[p+2]*g,q=b*t+l*k-n*u,J=b*u+n*t-h*k,G=b*k+h*u-l*t,t=-h*t-l*u-n*k;c[d+p]=q*b+t*-h+J*-n-G*-l;c[d+p+1]=J*b+t*-l+G*-h-q*-n;c[d+p+2]=G*b+t*-n+q*-l-J*-h;c[d+p+3]=a[p+3]}return c};a.translate=function(a,b,c){var d=a[3],e=a[4],g=a[5],h=a[6],l=a[7],n=b[0]*d,p=b[1]*d,t=b[2]*d;b=l*n+g*t-h*p;var d=l*p+h*n-e*t,u=l*t+e*p-g*n,n=-e*n-g*p-h*t;c[0]=a[0]+b*l+n*-e+d*-h-u*-g;c[1]=a[1]+d*l+n*-g+u*-e-b*-h;c[2]=a[2]+u*l+n*-h+b*-g-d*-e;c[3]=
a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,d){d||(d=new Float32Array(8));g.lerp(a.subarray(0,3),b.subarray(0,3),c,d.subarray(0,3));var h=a[3];d[3]=h+c*(b[3]-h);e.slerp(a.subarray(4),b.subarray(4),c,d.subarray(4));return d};a.dE=function(a,b,c,d){d||(d=new Float32Array(8));var g=a.subarray(0,3),h=b.subarray(0,3),l=d.subarray(0,3);l[0]=h[0]*(c+1)-g[0]*c;l[1]=h[1]*(c+1)-g[1]*c;l[2]=h[2]*(c+1)-g[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);g=d.subarray(4);
g[0]=b[0]*(c+1)-a[0]*c;g[1]=b[1]*(c+1)-a[1]*c;g[2]=b[2]*(c+1)-a[2]*c;g[3]=b[3]*(c+1)-a[3]*c;e.normalize(g,g);return d};a.jz=function(a,b,c,d,e){e[0]=a[0]+b*c[0];e[1]=a[1]+b*c[1];e[2]=a[2]+b*c[2];e[3]=a[3];c=d[0];var g=d[1];d=d[2];var h=a[4],l=a[5],n=a[6],p=a[7];e[4]=.5*(c*p+g*n-d*l);e[5]=.5*(g*p+d*h-c*n);e[6]=.5*(d*p+c*l-g*h);e[7]=.5*(-c*h-g*l-d*n);e[4]=a[4]+e[4]*b;e[5]=a[5]+e[5]*b;e[6]=a[6]+e[6]*b;e[7]=a[7]+e[7]*b;a=e[4];b=e[5];c=e[6];g=e[7];a=a*a+b*b+c*c+g*g;0<a&&(a=1/Math.sqrt(a),e[4]*=a,e[5]*=
a,e[6]*=a,e[7]*=a)}};b4w.module.__util=function(a,p){function c(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function d(a){return 0<a?1:0>a?-1:0}function b(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function e(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function h(a,b){var c=b;switch(typeof a){case "number":return g(a,c);case "string":return l(a,c);case "boolean":return g(a|0,c);case "function":case "undefined":return g(0,
c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(d=0;d<a.length;d++)c=g(a[d],c);else if(d)for(d=0;d<a.length;d++)c=h(a[d],c);else for(var e in a)c=h(a[e],c)}else c=g(0,c)}return c}function g(a,b){var c=b;M[0]=a;c=(c<<5)-c+V[0];c&=c;c=(c<<5)-c+V[1];return c&c}function l(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),c&=c;return c}function n(a){return(34*a+1)*a%289}function f(a){return a-Math.floor(a)}function m(a){return r((34*
a+5)*a)}function r(a){return a-289*Math.floor(a/289)}function z(a){return a-7*Math.floor(a/7)}function w(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function E(a){return w(a,0,2*Math.PI)}function y(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!H(a[c],b[c]))return!1}else if(d){if(a.length!=
b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!H(a[f],b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function H(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return y(a,b);default:return!0}}function v(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=
e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}var B=p("__print"),t=p("vec3"),u=p("vec4"),k=p("quat"),q=p("mat3"),J=p("mat4"),G=0,D={},L=new Float32Array(3),K=new Float32Array(3),O=new Float32Array(4),A=new Float32Array(4),I=new Float32Array(9),C=new Float32Array(16),Q=new Float32Array(16),M=new Float64Array(1),V=new Uint32Array(M.buffer),R=new Float32Array([0,0,0]),Z=new Float32Array([0,0,0,1]),fa=
new Float32Array([0,0,0,1,0,0,0,1]),W=new Float32Array([1,0,0]),ha=new Float32Array([0,1,0]),S=new Float32Array([0,0,1]),oa=new Float32Array([-1,0,0]),da=new Float32Array([0,-1,0]),ga=new Float32Array([0,0,-1]),aa=Math.floor(44488.07041494893),ea=[new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,
-1,0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])];a.hv=R;a.bv=Z;a.qD=fa;a.AXIS_X=W;a.AXIS_Y=ha;a.AXIS_Z=S;a.AXIS_MX=oa;a.AXIS_MY=da;a.AXIS_MZ=ga;a.Tt=ea;a.keyfind=c;a.Yx=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.cC=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.rw=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.Nv=function(a,b){var c=[],
d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.sign=d;a.SE=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.RE=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.Um=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.Gv=function(a,
b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.MD=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.dF=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.bF=function(a,b){var d=c("name",b,a);1<d.length&&B.error("obj_by_name(): name resolution ambiguity");return d};a.cF=function(a,b){var d=c("name",b,a),e=d.length;1<e&&B.error("obj_by_name(): name resolution ambiguity");if(0>=e)return[];
for(var f=[],g=0;g<e;g++){var k=d[g];if("EMPTY"==k.type&&k.dupli_group)for(var k=k.dupli_group.objects,h=0;h<k.length;h++)f.push(k[h])}return d=d.concat(f)};a.ZB=function(a,b,c,d){d||(d=new Float32Array(16));J.identity(d);d[12]=a;d[13]=b;d[14]=c};var ba=1;a.sA=function(){ba=(69069*ba+5)%Math.pow(2,32);return Math.round(ba/65536)%32768/32767};a.HB=function(a){ba=a};a.Vc=function(a){var b=a[0]%aa*48271-3399*Math.floor(a[0]/aa);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.qk=function(a,b){b||
(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),g=Math.sin(a[2]/2),k=Math.sin(a[0]/2);b[0]=f*g*e+c*d*k;b[1]=f*d*e+c*g*k;b[2]=c*g*e-f*d*k;b[3]=c*d*e-f*g*k;return b};a.Nx=function(a){var b=q.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),g=Math.sin(a[1]);a=Math.sin(a[2]);var k=c*e,h=c*a,l=f*e,m=f*a;b[0]=d*e;b[1]=d*a;b[2]=-g;b[3]=g*l-h;b[4]=g*
m+k;b[5]=d*f;b[6]=g*k+m;b[7]=g*h-l;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=e*e,k=c*d+e*f;.499999<k?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=Math.PI/2):-.499999>k?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*g),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*g),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));t.transformQuat(b,a,c);return c};a.ZD=function(a,b,c){c||(c=new Float32Array(4));
a=t.normalize(a,L);var d=t.dot(b,a);a=t.cross(b,a,K);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.$B=function(a,b,c,d){d||(d=new Float32Array(4));t.transformQuat(c,b,d);d[3]=-t.dot(a,d)};a.Fx=function(a){var b=a.e.quat;switch(a.type){case "CAMERA":L[0]=0;L[1]=-1;L[2]=0;t.transformQuat(L,b,L);K[0]=0;K[1]=0;K[2]=-1;break;case "MESH":L[0]=0;L[1]=0;L[2]=1;t.transformQuat(L,b,L);K[0]=0;K[1]=0;K[2]=1;break;case "EMPTY":L[0]=0,L[1]=
1,L[2]=0,t.transformQuat(L,b,L),K[0]=0,K[1]=1,K[2]=0}L[1]=0;t.normalize(L,L);a=t.dot(L,K);return Math.acos(a)*(0<-L[0]*K[2]?-1:1)};a.yp=function(a,b,c,d){if(0!=c){d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.wF=function(){G++;return G.toString(16)};a.nj=function(a){D[a]||(D[a]=0);var b=a+D[a];D[a]++;return b};a.ad=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.nb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),
a_texcoord:new Float32Array(0)};return{name:a,L:0,fa:null,A:[],J:b,Y:[]}};a.Qf=function(a){return JSON.parse(JSON.stringify(a))};a.la=function(b){if(!(b instanceof Object))return b;var c;c=b.constructor;switch(c){case Float32Array:case Uint32Array:case Uint16Array:c=new c(b);break;case Array:c=new c(b.length);for(var d=0;d<b.length;d++)c[d]=a.la(b[d]);break;default:for(d in c=new c,b)c[d]=a.la(b[d])}return c};a.ni=function(a){var b=a instanceof Array?[]:{},c;for(c in a)if(a[c]instanceof Object){var d=
a[c].constructor;switch(d){case Float32Array:case Uint32Array:case Uint16Array:b[c]=new d(a[c]);break;case Array:b[c]=a[c].slice(0);break;default:b[c]=a[c]}}else b[c]=a[c];return b};a.is_mesh=function(a){return"MESH"===a.type?!0:!1};a.tk=function(a){return"EMPTY"===a.type?!0:!1};a.is_armature=function(a){return"ARMATURE"===a.type?!0:!1};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));q.fromMat4(a,I);var c=I[0],d=I[3],e=I[6],f=I[1],g=I[4],h=I[7],l=I[2],m=I[5],n=I[8],c=Math.sqrt(c*c+d*d+e*
e)||1,f=Math.sqrt(f*f+g*g+h*h)||1,l=Math.sqrt(l*l+m*m+n*n)||1;I[0]/=c;I[3]/=c;I[6]/=c;I[1]/=f;I[4]/=f;I[7]/=f;I[2]/=l;I[5]/=l;I[8]/=l;k.fromMat3(I,b);return b};a.sh=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.An=function(a){O[0]=.577350269189626;O[1]=.577350269189626;O[2]=.577350269189626;O[3]=0;u.transformMat4(O,a,O);return u.length(O)};a.Em=function(a,c){var d=c.left,e=c.right,f=c.top,g=c.bottom,k=c.Wa,h=c.Ua;d[0]=a[3]+a[0];d[1]=a[7]+a[4];d[2]=a[11]+a[8];
d[3]=a[15]+a[12];e[0]=a[3]-a[0];e[1]=a[7]-a[4];e[2]=a[11]-a[8];e[3]=a[15]-a[12];f[0]=a[3]-a[1];f[1]=a[7]-a[5];f[2]=a[11]-a[9];f[3]=a[15]-a[13];g[0]=a[3]+a[1];g[1]=a[7]+a[5];g[2]=a[11]+a[9];g[3]=a[15]+a[13];k[0]=a[3]+a[2];k[1]=a[7]+a[6];k[2]=a[11]+a[10];k[3]=a[15]+a[14];h[0]=a[3]-a[2];h[1]=a[7]-a[6];h[2]=a[11]-a[10];h[3]=a[15]-a[14];b(d);b(e);b(f);b(g);b(k);b(h)};a.CB=function(a,b,c){return c<-e(a,b.left)||c<-e(a,b.right)||c<-e(a,b.top)||c<-e(a,b.bottom)||c<-e(a,b.Wa)||c<-e(a,b.Ua)?!0:!1};a.Lx=function(a,
b,c,d,f){g=t.dot(c,b.Ua);k=t.dot(d,b.Ua);h=t.dot(f,b.Ua);g=Math.sqrt(g*g+k*k+h*h);if(g<-e(a,b.Wa)||g<-e(a,b.Ua))return!0;var g=t.dot(c,b.left),k=t.dot(d,b.left),h=t.dot(f,b.left);if(Math.sqrt(g*g+k*k+h*h)<-e(a,b.left))return!0;g=t.dot(c,b.right);k=t.dot(d,b.right);h=t.dot(f,b.right);if(Math.sqrt(g*g+k*k+h*h)<-e(a,b.right))return!0;g=t.dot(c,b.top);k=t.dot(d,b.top);h=t.dot(f,b.top);if(Math.sqrt(g*g+k*k+h*h)<-e(a,b.top))return!0;g=t.dot(c,b.bottom);k=t.dot(d,b.bottom);h=t.dot(f,b.bottom);return Math.sqrt(g*
g+k*k+h*h)<-e(a,b.bottom)?!0:!1};a.jf=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],k=a[f+1],h=a[f+2];c[d+f]=b[0]*g+b[4]*k+b[8]*h+b[12];c[d+f+1]=b[1]*g+b[5]*k+b[9]*h+b[13];c[d+f+2]=b[2]*g+b[6]*k+b[10]*h+b[14]}};a.RC=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],k=a[f+1],h=a[f+2];c[d+f]=b[0]*g+b[4]*k+b[8]*h;c[d+f+1]=b[1]*g+b[5]*k+b[9]*h;c[d+f+2]=b[2]*g+b[6]*k+b[10]*h}};a.WB=function(a,b,c){for(var d=0,d=0,f=a.length,e=0;e<f;e+=4){var g=a[e],k=a[e+1],h=
a[e+2];c[d+e]=b[0]*g+b[4]*k+b[8]*h;c[d+e+1]=b[1]*g+b[5]*k+b[9]*h;c[d+e+2]=b[2]*g+b[6]*k+b[10]*h;c[d+e+3]=a[e+3]}};a.PC=function(a,b,c){c||(c=new Float32Array(3));O[0]=a[0];O[1]=a[1];O[2]=a[2];O[3]=0;u.transformMat4(O,b,O);c[0]=O[0];c[1]=O[1];c[2]=O[2]};a.hE=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.QC=function(a){for(var b=
[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.Oj=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.Oj(b,c,d,f-1):b[f]<c?a.Oj(b,c,f+1,e):f};a.Pe=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.OD=function(a,b,c){for(var d=0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;return!0};a.LA=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=
a[15]};a.Co=function(a,b,c,d){d||(d=new Float32Array(16));b=J.fromRotationTranslation(b,c,C);J.multiply(b,a,d)};a.transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));c=J.fromRotationTranslation(c,d,C);1!==b&&(d=J.identity(Q),b=t.set(b,b,b,L),J.scale(d,b,d),J.multiply(c,d,c));t.transformMat4(a,c,e);return e};a.Do=function(a,b,c,d){d||(d=new Float32Array(4));b=J.fromRotationTranslation(b,c,C);u.transformMat4(a,b,d)};a.JE=function(a,b,c,d,e){e||(e=new Float32Array(3));b=J.fromRotationTranslation(c,
d,C);J.invert(b,b);t.transformMat4(a,b,e);return e};a.uF=function(a,b,c){c||(c=new Float32Array(16));J.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.aF=function(b,c,d){a.sh(b,c);c[3]=a.An(b);a.matrix_to_quat(b,d)};a.wD=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.HA=function(a,b,c,d){d||(d=new Float32Array(3));t.subtract(b,a,L);t.transformQuat(L,c,L);t.subtract(b,L,d)};a.jy=function(){L[0]=0;L[1]=0;L[2]=0;var a=new Float32Array(16),
b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16);J.lookAt(L,[-1,0,0],[0,-1,0],a);J.scale(a,[-1,1,1],a);J.scale(a,[-1,1,-1],b);J.lookAt(L,[0,-1,0],[0,0,-1],c);J.scale(c,[1,1,-1],c);J.scale(c,[1,-1,-1],d);J.lookAt(L,[0,0,-1],[0,-1,0],e);J.scale(e,[-1,1,1],e);J.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.ny=function(){L[0]=0;L[1]=0;L[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=
new Float32Array(16),f=new Float32Array(16);J.lookAt(L,[1,0,0],[0,-1,0],a);J.scale(a,[-1,1,-1],b);J.lookAt(L,[0,1,0],[0,0,1],c);J.scale(c,[1,-1,-1],d);J.lookAt(L,[0,0,1],[0,-1,0],e);J.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.Xg=function(a,b){return h(a,b)};a.hash_code=h;a.DE=l;a.$E=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,g,k,h,l,m,n,q,t,r,p,u;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*
b+a[15],a;f=a[0];g=a[1];k=a[2];h=a[3];l=a[4];m=a[5];n=a[6];q=a[7];t=a[8];r=a[9];p=a[10];u=a[11];c[0]=f;c[1]=g;c[2]=k;c[3]=h;c[4]=l;c[5]=m;c[6]=n;c[7]=q;c[8]=t;c[9]=r;c[10]=p;c[11]=u;c[12]=f*d+l*e+t*b+a[12];c[13]=g*d+m*e+r*b+a[13];c[14]=k*d+n*e+p*b+a[14];c[15]=h*d+q*e+u*b+a[15];return c};a.Jz=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=
a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.Tk=function(a){return a*Math.PI/180};a.zx=function(a){return 180*a/Math.PI};a.io=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var g=b>a?1:0,k=1-g,e=b+
.211324865405187-g,h=a+.211324865405187-k,l=b+-.577350269189626,m=a+-.577350269189626,c=c%289,d=d%289,q=n(n(d)+c),k=n(n(d+k)+c+g),t=n(n(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+h*h),0),g=Math.max(.5-(l*l+m*m),0),r=2*f(.024390243902439*q)-1,p=2*f(.024390243902439*k)-1,u=2*f(.024390243902439*t)-1,q=Math.abs(r)-.5,k=Math.abs(p)-.5,t=Math.abs(u)-.5,r=r-Math.floor(r+.5),p=p-Math.floor(p+.5),u=u-Math.floor(u+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(r*r+q*q)),d=d*d*d*d*(1.79284291400159-
.85373472095314*(p*p+k*k)),g=g*g*g*g*(1.79284291400159-.85373472095314*(u*u+t*t));return 130*(c*(r*b+q*a)+d*(p*e+k*h)+g*(u*l+t*m))};a.Kp=function(a){var b=1/7,c=b/2,d=r(Math.floor(a[0])),e=r(Math.floor(a[1])),g=f(a[0]);a=f(a[1]);var k=g-.5,h=g-1.5,g=a-.5;a-=1.5;var l=m(d),n=m(d+1),q=l,d=n,l=m(l+e),n=m(n+e),q=m(q+e+1),d=m(d+e+1),e=k+.7*(z(l)*b+c),t=h+.7*(z(n)*b+c),k=k+.7*(z(q)*b+c),h=h+.7*(z(d)*b+c),l=g+.7*(z(Math.floor(l*b))*b+c),g=g+.7*(z(Math.floor(n*b))*b+c),q=a+.7*(z(Math.floor(q*b))*b+c),b=a+
.7*(z(Math.floor(d*b))*b+c);return Math.min(e*e+l*l,t*t+g*g,k*k+q*q,h*h+b*b)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=t.transformQuat(b,a,L);b=c[0];var f=c[1];c=c[2];I[0]=f*f+c*c;I[1]=-f*b;I[2]=-c*b;I[3]=-b*f;I[4]=b*b+c*c;I[5]=-c*f;I[6]=-b*c;I[7]=-f*c;I[8]=b*b+f*f;t.transformMat3(a,I,a);t.normalize(a,a);k.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=O,d=A,c=k.setAxisAngle([0,1,0],Math.PI,k.create()),d=k.setAxisAngle([1,
0,0],Math.PI/2,k.create());k.multiply(c,d,c);k.multiply(a,c,b);return b};a.cleanup=function(){G=0;D={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.Zs=function(a,b,c,d,e){e||(e=new Float32Array(a.length));k.slerp(a,b,Math.exp(-c/d),e)};a.KE=function(a){return"object"===typeof a&&a.buffer&&
a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=q.fromQuat(a,I);K[0]=0;K[1]=1;K[2]=0;L[0]=c[3];L[1]=c[4];L[2]=c[5];var d=t.cross(K,L,L);t.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);K[0]=c[0];K[1]=c[1];K[2]=c[2];t.normalize(K,K);k.rotationTo(K,d,A);k.multiply(A,a,a)};a.Mq=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-
Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,k=a[e*b+c],h=a[e*b+Math.min(c+1,g)],l=a[Math.min(e+1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(k*(1-d)+h*d)*(1-f)+(l*(1-d)+a*d)*f};a.Dg=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.Hs=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.hj=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.Iq=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.yd=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];t.normalize(c,c)};a.aC=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],k=b[2];b=b[3];var h=g*a-k*e,l=k*d-f*a,m=f*e-g*d,n=g*m-k*l,k=k*h-
f*m,f=f*l-g*h;c[0]=d+2*h*b+2*n;c[1]=e+2*l*b+2*k;c[2]=a+2*m*b+2*f};a.assert=function(a){if(!a)throw Error("Assertion failed");};a.ga=function(a){a&&B.error.apply(B,arguments);throw"panic: see above for possible error messages";};a.angle_wrap_periodic=w;a.angle_wrap_0_2pi=E;a.Sm=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.kt=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=y(e,f)}if(!d)return!1}return!0};
a.Tn=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.Gq=function(a){a+=1;132651<a&&B.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d,e){O.set(a);O[3]=b;A.set(d);A[3]=0;a=u.dot(O,A);if(0==a)return null;A.set(c);A[3]=1;a=-u.dot(O,A)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.My=function(a,b,c,d){var e=b[0]-a[0],f=c[0]-a[0],g=b[1]-
a[1],k=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=g*a-b*k;d[1]=f*b-e*a;d[2]=e*k-g*f;return d};a.QD=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.JA=function(a,b,c){var d=t.dot(a,b);-.9999999>d?(t.cross(W,a,L),1E-6>t.length(L)&&t.cross(ha,a,L),t.normalize(L,L),k.setAxisAngle(L,Math.PI,c)):(t.cross(a,b,L),c.set(L),c[3]=1+d,k.normalize(c,c));return c};a.Ne=function(a,b,c){if(b==c)return c-a;a=E(a);b=E(b);c=E(c);var d=Math.abs(b-c);if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-
b;c=E(c+b);a=E(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a,b,c){isFinite(b)&&isFinite(c)&&(a=clamp(a,b,c));return a*a*(3-2*a)};a.lerp=function(a,b,c){return b+a*(c-b)};a.Ov=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(b[d]==a[c])return!0;return!1};a.TD=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=0;return b};a.Ht=function(a,b){for(var c=Math.max(a.length,b.length),e=0;e<c;e++){var f=d((e>=a.length?0:a[e])-(e>=b.length?0:b[e]));if(f)return f}return 0};
a.nl=function(a){return a.join(".")};a.KB=function(a){return a.split(".").map(function(a){return a|0})};a.ft=function(a,b){b[0]=Math.pow(a[0],2.2);b[1]=Math.pow(a[1],2.2);b[2]=Math.pow(a[2],2.2)};a.tn=function(a,b){b[0]=Math.pow(a[0],1/2.2);b[1]=Math.pow(a[1],1/2.2);b[2]=Math.pow(a[2],1/2.2);return b};a.Ek=function(a){var b=a.split("://",2);return 1<b.length?(b[1]=v(b[1]),b.join("://")):v(a)}};b4w.module.__sfx=function(a,p){function c(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;y.warn("deprecated WebAudio implementation");return null}y.warn("WebAudio is not supported");return null}function d(a,c,d){var e=a.k;if("NONE"!=e.behavior){d||(d=0);var f=e.loop,k=e.pitch;if(e.src&&(f||0<=d)){e.Kl=Math.floor(5E4*Math.random());var m=D.currentTime+c;e.Gc=m;e.state=20;b(a);"POSITIONAL"==e.behavior||"BACKGROUND_SOUND"==e.behavior?(c=D.createBufferSource(),
c.buffer=e.src,c.playbackRate.value=k,f?(e.sb&&e.sb.disconnect(),c.loop=!0,c.start(m),e.duration=0):(f=c.buffer?c.buffer.duration:0,d>f?(f=m+d+e.ie,c.loop=!0,c.start(m),c.stop(f),e.duration=d):(c.loop=!1,c.start(m),e.duration=f)),c.connect(e.ec),e.sb=c,h(e),g(e)):"BACKGROUND_MUSIC"==e.behavior&&(H.clear_timeout(e.Ol),H.clear_timeout(e.Pl),d=function(){var b=a.k,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.sb=b.sb||D.createMediaElementSource(c),b.sb.connect(b.ec),20==b.state&&(c.currentTime&&(c.currentTime=
0),c.play()))},0==c?d():e.Ol=H.set_timeout(d,1E3*c),e.duration=f?0:w(a));l(e,m)}}}function b(a){var b=a.k;if(!b.ec){var c=a.e.h;a=a.e.quat;if(t.Bk){var d=D.createBiquadFilter();d.type="peaking"}else d=null;var e=D.createGain();switch(b.behavior){case "POSITIONAL":var f=D.createPanner();"string"!=typeof f.panningModel?(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],c[1],c[2]);B.copy(c,b.qn);c=u;v.quat_to_dir(a,
v.AXIS_MY,c);f.setOrientation(c[0],c[1],c[2]);B.copy(c,b.direction);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.Hw;f.coneOuterAngle=b.Iw;f.coneOuterGain=b.Jw;var g=D.createGain();g.gain.value=z(b);d?(f.connect(d),d.connect(g)):f.connect(g);g.connect(e);b.ec=f;if(b.Zh){var k=D.createGain();e.connect(k);k.connect(D?L.k.ec:null)}else k=null,e.connect(D?L.k.ec:null);break;case "BACKGROUND_SOUND":f=null;g=D.createGain();g.gain.value=z(b);d?(b.ec=d,
d.connect(g)):b.ec=g;g.connect(e);b.Zh?(k=D.createGain(),e.connect(k),k.connect(D?L.k.ec:null)):(k=null,e.connect(D?L.k.ec:null));break;case "BACKGROUND_MUSIC":k=f=null,g=D.createGain(),g.gain.value=z(b),d?(b.ec=d,d.connect(g)):b.ec=g,g.connect(e),e.connect(D?L.k.ec:null)}b.Wi=f;b.xd=d;b.hh=g;b.Xf=e;b.xs=k}}function e(a){var b=a.k,c=b.duration,b=b.delay+b.Ax*Math.random();d(a,b,c)}function h(a){a.Zh&&a.xs.gain.cancelScheduledValues(a.Gc);a.Zi&&a.sb.playbackRate.cancelScheduledValues(a.Gc);a.sj=a.Gc}
function g(a){if(a.Zh||a.Zi){var b=a.xs,c=a.sb,d=c.buffer?c.buffer.duration:0;if(d){var e=a.Gc;O[0]=a.Kl;for(var f=0;5>f;){var g=a.pitch+a.Zi*v.Vc(O);if(e>=a.sj){if(a.Zh){var k=1-v.clamp(a.Zh,0,1)*Math.random();b.gain.setValueAtTime(k,e)}a.Zi&&c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.sj=e-.001}}}function l(a,b){if(a.Fm||a.ie){var c=a.Xf;c.gain.cancelScheduledValues(b);a.Fm?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.Fm)):c.gain.setValueAtTime(1,b);a.ie&&!a.loop&&(c.gain.setValueAtTime(1,
b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.ie))}}function n(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.k;if(20==b.state||40==b.state){var c=b.Xf,d=D.currentTime;b.ie&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.ie));"BACKGROUND_MUSIC"==b.behavior?b.src&&(H.clear_timeout(b.Ol),H.clear_timeout(b.Pl),b.Pl=H.set_timeout(function(){var b=a.k.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.ie)):(c=b.sb,b.duration<c.buffer.duration?
b.ie&&20==b.state?c.stop(d+b.ie):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),b.Gc=0,b.Nn=0,b.Wl=0);b.state=30}}function f(a){a=a.k;if(20==a.state){var b=D.currentTime;a.Nn=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.Gc){O[0]=a.Kl;for(var d=a.sb.buffer.duration,e=a.Gc;e<b;)c=a.pitch+a.Zi*v.Vc(O),e+=d/c;c*=d/c-(e-b)}else c=0;a.Wl=c;a.sb.stop(0);a.sb.disconnect();h(a)}a.state=40}}function m(a){var b=a.k;if(40==b.state){var c=D.currentTime;b.Gc+=c-b.Nn;if("BACKGROUND_MUSIC"==
b.behavior)b.src.play();else{a=a.k;var d=D.createBufferSource();d.loop=a.sb.loop;d.buffer=a.sb.buffer;d.playbackRate.value=a.sb.playbackRate.value;a.Wi?d.connect(a.Wi):d.connect(a.hh);a.sb=d;b.sj=c;b.sb.start(b.Gc,b.Wl);g(b)}l(b,b.Gc);b.state=20}}function r(a){return!a.k||20!=a.k.state&&40!=a.k.state&&30!=a.k.state?!1:!0}function z(a){return a.muted?0:a.volume}function w(a){a=a.k;return(a=a.src)?a.duration:0}var E=p("__config"),y=p("__print"),H=p("__time"),v=p("__util"),B=p("__vec3"),t=E.kd;a.To=
10;a.rl=20;a.So=30;var u=new Float32Array(3),k=new Float32Array(3),q=new Float32Array(3),J=[],G=[],D=null,L=null,K=[],O=[1],A=null;a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(J.push("ogg"),J.push("ogv")),""!=a.canPlayType("audio/mpeg")&&J.push("mp3"),""!=a.canPlayType("audio/mp4")&&(J.push("mp4"),J.push("m4v")),""!=a.canPlayType("audio/webm")&&J.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&
G.push("ogv"),""!=b.canPlayType("video/mp4")&&G.push("m4v"),""!=b.canPlayType("video/webm")&&G.push("webm"));(D=t.Po?c():null)&&y.log("%cINIT WEBAUDIO: "+D.sampleRate+"Hz","color: #00a")};a.qp=function(a){var b={lg:new Float32Array(3),Fr:new Float32Array(3),rh:new Float32Array(3)};a.k=b;if(D){var c=D.createGain(),d=D.createGain();b.hh=c;b.Xf=d;c.connect(d);d.connect(D.destination);if(a.b4w_enable_dynamic_compressor){var d=D.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=
e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.qi=d;b.ec=d}else b.qi=null,b.ec=c;c=D.listener;b.ah=E.p.bm;b.ah||(c.dopplerFactor=a.audio_doppler_factor,c.speedOfSound=a.audio_doppler_speed);b.muted=!1;b.volume=1;b.Wf=0}};a.TA=function(a){L=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<J.indexOf(a)?a:"ogg"==a&&-1<J.indexOf("mp4")?"mp4":"mp3"==a&&-1<J.indexOf("ogg")?"ogg":"mp4"==a&&-1<J.indexOf("ogg")?"ogg":"ogv"==
a&&-1<J.indexOf("m4v")?"m4v":"webm"==a&&-1<J.indexOf("m4v")?"m4v":"m4v"==a&&-1<J.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<G.indexOf(a)?a:"ogv"==a&&-1<G.indexOf("m4v")?"m4v":"webm"==a&&-1<G.indexOf("m4v")?"m4v":"m4v"==a&&-1<G.indexOf("webm")?"webm":""};a.append_object=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.k={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.k.behavior=D?b.b4w_behavior:"NONE";break;
case "BACKGROUND_MUSIC":var c=a.k,d;D?(window.MediaElementAudioSourceNode?d=!0:(y.warn("MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.k.behavior="NONE");a.k.ah=b.b4w_disable_doppler&&E.p.bm;a.k.muted=b.muted;a.k.volume=b.volume;a.k.pitch=b.pitch;a.k.attenuation=b.attenuation;a.k.dist_ref=b.distance_reference;a.k.dist_max=b.distance_max||1E4;a.k.Hw=b.cone_angle_inner;a.k.Iw=b.cone_angle_outer;
a.k.Jw=b.cone_volume_outer;a.k.cyclic=b.b4w_cyclic_play;a.k.loop=b.b4w_loop;a.k.delay=b.b4w_delay;a.k.Ax=b.b4w_delay_random;a.k.Zh=b.b4w_volume_random;a.k.Zi=b.b4w_pitch_random;a.k.Fm=b.b4w_fade_in;a.k.ie=b.b4w_fade_out;a.k.Gc=0;a.k.Nn=0;a.k.Wl=0;a.k.duration=0;a.k.sj=0;a.k.Kl=1;a.k.src=null;a.k.state=10;a.k.qn=new Float32Array(3);a.k.direction=new Float32Array(3);a.k.lo=new Float32Array(3);a.k.Ol=-1;a.k.Pl=-1;a.k.Wf=0;K.push(a)};a.at=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.k.behavior){case "POSITIONAL":return a.rl;
case "BACKGROUND_SOUND":return a.rl;case "BACKGROUND_MUSIC":return a.So;case "NONE":return a.To;default:throw"Wrong speaker behavior";}};a.xC=function(a,b){var c=a.k;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.iA=function(){var a=D.createBufferSource();a.buffer=D.createBuffer(1,22050,22050);a.connect(D.destination);a.start(0)};a.wx=function(a,b,c){D?D.decodeAudioData(a,b,c):c()};a.yB=
function(a){n(a);delete a.k;K.splice(K.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<K.length;a++){var b=K[a].k;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.sb&&b.sb.disconnect()}L&&L.k&&(a=L.k,a.lg[0]=0,a.lg[1]=0,a.lg[2]=0,a.rh[0]=0,a.rh[1]=0,a.rh[2]=0);L=null;K.splice(0);A=null};a.update=function(a){if(D&&0!=K.length){for(var b=0;b<K.length;b++){var c=K[b],d=c.k,f=D.currentTime;D&&!d.loop&&d.cyclic&&20==d.state&&d.duration&&d.Gc+d.duration<f&&e(c);20==d.state&&3>d.sj-f&&g(d)}A&&A.ze.length&&
(-1==A.Ra||a>A.jp+A.pq[A.Ra])&&(b=A,-1<b.Ra&&n(b.ze[b.Ra]),-1==b.Ra&&b.random?c=Math.round(Math.random()*(b.ze.length-1)):b.random?(c=1+Math.round(Math.random()*(b.ze.length-2)),c=(b.Ra+c)%b.ze.length):c=(b.Ra+1)%b.ze.length,e(b.ze[c]),b.Ra=c,b.jp=a)}};a.play=d;a.play_def=e;a.stop=n;a.is_play=function(a){return 20==a.k.state};a.xB=f;a.zB=m;a.playrate=function(a,b){var c=a.k;c.pitch=b;!r(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.sb.playbackRate.value=b,h(c),g(c))};a.get_playrate=
function(a){return a.k.pitch};a.cyclic=function(a,b){a.k.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.k.cyclic};a.Cz=function(a,b,c,d){if(D&&a.k){var e=u;e[0]=0;e[1]=-1;e[2]=0;B.transformQuat(e,c,e);k[0]=0;k[1]=0;k[2]=-1;B.transformQuat(k,c,k);c=D.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],k[0],k[1],k[2]);B.copy(e,a.k.Fr);!a.k.ah&&d&&(q[0]=(b[0]-a.k.lg[0])/d,q[1]=(b[1]-a.k.lg[1])/d,q[2]=(b[2]-a.k.lg[2])/d,v.smooth_v(q,a.k.rh,d,.3,q),c.setVelocity(q[0],q[1],q[2]),
B.copy(q,a.k.rh));B.copy(b,a.k.lg)}};a.listener_reset_speed=function(a,b){if(D&&L.k&&!L.k.ah){var c=u;b?B.copy(b,c):B.copy(L.k.Fr,c);B.scale(c,a,c);D.listener.setVelocity(c[0],c[1],c[2]);B.copy(c,L.k.rh)}};a.AB=function(a,b){var c=a.k;if(r(a)&&"POSITIONAL"==c.behavior){var d=a.e.h,e=c.Wi;e.setPosition(d[0],d[1],d[2]);var f=u;v.quat_to_dir(a.e.quat,v.AXIS_MY,f);e.setOrientation(f[0],f[1],f[2]);f=c.qn;!c.ah&&b&&(k[0]=(d[0]-f[0])/b,k[1]=(d[1]-f[1])/b,k[2]=(d[2]-f[2])/b,v.smooth_v(k,c.lo,b,.3,k),e.setVelocity(k[0],
k[1],k[2]),B.copy(k,c.lo));B.copy(d,f)}};a.speaker_reset_speed=function(a,b,c){var d=a.k;if(r(a)&&"POSITIONAL"==d.behavior&&!d.ah){var e=u;c?B.copy(c,e):B.copy(d.direction,e);B.scale(e,b,e);d.Wi.setVelocity(e[0],e[1],e[2]);B.copy(e,d.lo);B.copy(a.e.h,d.qn)}};a.ne=function(a){return a.k?!0:!1};a.Vm=function(a){return a.k.behavior};a.check_active_speakers=function(){for(var a=0;a<K.length;a++)if(r(K[a]))return!0;return!1};a.bB=function(a){var b=L.k;b&&(b.volume=a,D&&(b.hh.gain.value=z(b)))};a.Ly=function(){var a=
L.k;return a?a.volume:0};a.set_volume=function(a,b){var c=a.k;c.volume=b;r(a)&&(c.hh.gain.value=z(c))};a.get_volume=function(a){return a.k.volume};a.mute=function(a,b){a.k.muted=Boolean(b);r(a)&&(a.k.hh.gain.value=z(a.k))};a.is_muted=function(a){return a.k.muted};a.Tz=function(a){var b=L.k;b&&(b.muted=Boolean(a),D&&(b.hh.gain.value=z(b)))};a.sz=function(){var a=L.k;return a?a.muted:!1};a.get_speaker_objects=function(){return K};a.pause=function(){for(var a=0;a<K.length;a++)f(K[a])};a.resume=function(){for(var a=
0;a<K.length;a++)m(K[a])};a.set_compressor_params=function(a,b){if(a.k&&a.k.qi){var c=a.k.qi;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.k||!a.k.qi)return null;a=a.k.qi;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(r(a)){a=a.k;var d=a.Xf,e=D.currentTime;d.gain.setValueAtTime(d.gain.value,
e);d.gain.linearRampToValueAtTime(b,e+c);a.Wf=c}};a.unduck=function(a){if(r(a)){a=a.k;var b=a.Xf,c=D.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Wf);a.Wf=0}};a.Hx=function(a,b){if(D){var c=L.k,d=c.Xf,e=D.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.Wf=b}};a.dC=function(){if(D){var a=L.k,b=a.Xf,c=D.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Wf);a.Wf=0}};a.apply_playlist=
function(a,b,c){A={Ra:-1,jp:0,random:c,ze:[],pq:[]};for(c=0;c<a.length;c++){var d=a[c],e=w(d);0==e?y.warn("Ignoring speaker with zero duration: "+d.name):(n(d),d.k.cyclic=!1,A.ze.push(d),A.pq.push(e+b))}};a.get_duration=w;a.clear_playlist=function(){if(A)for(var a=A.ze,b=0;b<a.length;b++)n(a[b]);A=null};a.get_positional_params=function(a){return(a=a.k)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.k;
if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.Wi;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.k;c&&c.xd&&(c.xd.frequency.value=b.freq,c.xd.Q.value=b.Q,c.xd.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.k)&&a.xd?{freq:a.xd.frequency.value,Q:a.xd.Q.value,gain:a.xd.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.k;if(!a||
!a.xd)return null;a.xd.getFrequencyResponse(b,c,d)}};b4w.module.__vec3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new p(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var b=new p(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.fromValues=function(a,b,c){var h=new p(3);h[0]=a;h[1]=b;h[2]=c;return h};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set=function(a,b,c,h){h[0]=a;h[1]=b;h[2]=c;return h};a.add=function(a,b,c){c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];
return c};a.subtract=function(a,b,c){c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c};a.sub=a.subtract;a.multiply=function(a,b,c){c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c};a.mul=a.multiply;a.divide=function(a,b,c){c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];return c};a.div=a.divide;a.min=function(a,b,c){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);c[2]=Math.min(a[2],b[2]);return c};a.max=function(a,b,c){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);c[2]=Math.max(a[2],
b[2]);return c};a.scale=function(a,b,c){c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c};a.scaleAndAdd=function(a,b,c,h){h[0]=a[0]+b[0]*c;h[1]=a[1]+b[1]*c;h[2]=a[2]+b[2]*c;return h};a.distance=function(a,b){var c=b[0]-a[0],h=b[1]-a[1],g=b[2]-a[2];return Math.sqrt(c*c+h*h+g*g)};a.dist=a.distance;a.squaredDistance=function(a,b){var c=b[0]-a[0],h=b[1]-a[1],g=b[2]-a[2];return c*c+h*h+g*g};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)};a.len=a.length;
a.squaredLength=function(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];return b};a.normalize=function(a,b){var c=a[0],h=a[1],g=a[2],c=c*c+h*h+g*g;0<c&&(c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};a.cross=function(a,b,c){var h=a[0],g=a[1];a=a[2];var l=b[0],n=b[1];b=b[2];
c[0]=g*b-a*n;c[1]=a*l-h*b;c[2]=h*n-g*l;return c};a.lerp=function(a,b,c,h){var g=a[0],l=a[1];a=a[2];h[0]=g+c*(b[0]-g);h[1]=l+c*(b[1]-l);h[2]=a+c*(b[2]-a);return h};a.random=function(a,b){a=a||1;var e=2*c()*Math.PI,h=2*c()-1,g=Math.sqrt(1-h*h)*a;b[0]=Math.cos(e)*g;b[1]=Math.sin(e)*g;b[2]=h*a;return b};a.transformMat4=function(a,b,c){var h=a[0],g=a[1];a=a[2];var l=b[3]*h+b[7]*g+b[11]*a+b[15],l=l||1;c[0]=(b[0]*h+b[4]*g+b[8]*a+b[12])/l;c[1]=(b[1]*h+b[5]*g+b[9]*a+b[13])/l;c[2]=(b[2]*h+b[6]*g+b[10]*a+b[14])/
l;return c};a.transformMat3=function(a,b,c){var h=a[0],g=a[1];a=a[2];c[0]=h*b[0]+g*b[3]+a*b[6];c[1]=h*b[1]+g*b[4]+a*b[7];c[2]=h*b[2]+g*b[5]+a*b[8];return c};a.transformQuat=function(a,b,c){var h=a[0],g=a[1],l=a[2];a=b[0];var n=b[1],f=b[2];b=b[3];var m=b*h+n*l-f*g,r=b*g+f*h-a*l,p=b*l+a*g-n*h,h=-a*h-n*g-f*l;c[0]=m*b+h*-a+r*-f-p*-n;c[1]=r*b+h*-n+p*-a-m*-f;c[2]=p*b+h*-f+m*-n-r*-a;return c};a.rotateX=function(a,b,c,h){var g=[],l=[];g[0]=a[0]-b[0];g[1]=a[1]-b[1];g[2]=a[2]-b[2];l[0]=g[0];l[1]=g[1]*Math.cos(c)-
g[2]*Math.sin(c);l[2]=g[1]*Math.sin(c)+g[2]*Math.cos(c);h[0]=l[0]+b[0];h[1]=l[1]+b[1];h[2]=l[2]+b[2];return h};a.rotateY=function(a,b,c,h){var g=[],l=[];g[0]=a[0]-b[0];g[1]=a[1]-b[1];g[2]=a[2]-b[2];l[0]=g[2]*Math.sin(c)+g[0]*Math.cos(c);l[1]=g[1];l[2]=g[2]*Math.cos(c)-g[0]*Math.sin(c);h[0]=l[0]+b[0];h[1]=l[1]+b[1];h[2]=l[2]+b[2];return h};a.rotateZ=function(a,b,c,h){var g=[],l=[];g[0]=a[0]-b[0];g[1]=a[1]-b[1];g[2]=a[2]-b[2];l[0]=g[0]*Math.cos(c)-g[1]*Math.sin(c);l[1]=g[0]*Math.sin(c)+g[1]*Math.cos(c);
l[2]=g[2];h[0]=l[0]+b[0];h[1]=l[1]+b[1];h[2]=l[2]+b[2];return h};a.forEach=function(){var c=a.create();return function(a,e,h,g,l,n){e||(e=3);h||(h=0);for(g=g?Math.min(g*e+h,a.length):a.length;h<g;h+=e)c[0]=a[h],c[1]=a[h+1],c[2]=a[h+2],l(c,n,c),a[h]=c[0],a[h+1]=c[1],a[h+2]=c[2];return a}}();a.vD=function(c,b){var e=a.fromValues(c[0],c[1],c[2]),h=a.fromValues(b[0],b[1],b[2]);a.normalize(e,e);a.normalize(h,h);e=a.dot(e,h);return 1<e?0:Math.acos(e)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+
a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};b4w.module.vec3=b4w.module.__vec3;
b4w.module.__vec4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new p(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var b=new p(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=function(a,b,c,h){var g=new p(4);g[0]=a;g[1]=b;g[2]=c;g[3]=h;return g};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set=function(a,b,c,h,g){g[0]=a;g[1]=b;g[2]=c;g[3]=h;return g};a.add=function(a,b,c){c[0]=
a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c};a.subtract=function(a,b,c){c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];return c};a.sub=a.subtract;a.multiply=function(a,b,c){c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];c[3]=a[3]*b[3];return c};a.mul=a.multiply;a.divide=function(a,b,c){c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];c[3]=a[3]/b[3];return c};a.div=a.divide;a.min=function(a,b,c){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);c[2]=Math.min(a[2],b[2]);c[3]=
Math.min(a[3],b[3]);return c};a.max=function(a,b,c){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);c[2]=Math.max(a[2],b[2]);c[3]=Math.max(a[3],b[3]);return c};a.scale=function(a,b,c){c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c};a.scaleAndAdd=function(a,b,c,h){h[0]=a[0]+b[0]*c;h[1]=a[1]+b[1]*c;h[2]=a[2]+b[2]*c;h[3]=a[3]+b[3]*c;return h};a.distance=function(a,b){var c=b[0]-a[0],h=b[1]-a[1],g=b[2]-a[2],l=b[3]-a[3];return Math.sqrt(c*c+h*h+g*g+l*l)};a.dist=a.distance;a.squaredDistance=
function(a,b){var c=b[0]-a[0],h=b[1]-a[1],g=b[2]-a[2],l=b[3]-a[3];return c*c+h*h+g*g+l*l};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],c=a[1],h=a[2];a=a[3];return Math.sqrt(b*b+c*c+h*h+a*a)};a.len=a.length;a.squaredLength=function(a){var b=a[0],c=a[1],h=a[2];a=a[3];return b*b+c*c+h*h+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];b[3]=1/a[3];return b};a.normalize=
function(a,b){var c=a[0],h=a[1],g=a[2],l=a[3],c=c*c+h*h+g*g+l*l;0<c&&(c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c,b[3]=a[3]*c);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};a.lerp=function(a,b,c,h){var g=a[0],l=a[1],n=a[2];a=a[3];h[0]=g+c*(b[0]-g);h[1]=l+c*(b[1]-l);h[2]=n+c*(b[2]-n);h[3]=a+c*(b[3]-a);return h};a.random=function(d,b){d=d||1;b[0]=c();b[1]=c();b[2]=c();b[3]=c();a.normalize(b,b);a.scale(b,d,b);return b};a.transformMat4=function(a,b,c){var h=a[0],
g=a[1],l=a[2];a=a[3];c[0]=b[0]*h+b[4]*g+b[8]*l+b[12]*a;c[1]=b[1]*h+b[5]*g+b[9]*l+b[13]*a;c[2]=b[2]*h+b[6]*g+b[10]*l+b[14]*a;c[3]=b[3]*h+b[7]*g+b[11]*l+b[15]*a;return c};a.transformQuat=function(a,b,c){var h=a[0],g=a[1],l=a[2],n=b[0],f=b[1],m=b[2];b=b[3];var r=b*h+f*l-m*g,p=b*g+m*h-n*l,w=b*l+n*g-f*h,h=-n*h-f*g-m*l;c[0]=r*b+h*-n+p*-m-w*-f;c[1]=p*b+h*-f+w*-n-r*-m;c[2]=w*b+h*-m+r*-f-p*-n;c[3]=a[3];return c};a.forEach=function(){var c=a.create();return function(a,e,h,g,l,n){e||(e=4);h||(h=0);for(g=g?Math.min(g*
e+h,a.length):a.length;h<g;h+=e)c[0]=a[h],c[1]=a[h+1],c[2]=a[h+2],c[3]=a[h+3],l(c,n,c),a[h]=c[0],a[h+1]=c[1],a[h+2]=c[2],a[h+3]=c[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};b4w.module.vec4=b4w.module.__vec4;
b4w.module.__quat=function(a,p){var c=p("__vec3"),d=p("__vec4"),b=p("__mat3"),e="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new e(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=c.create(),d=c.fromValues(1,0,0),e=c.fromValues(0,1,0);return function(n,f,m){var r=c.dot(n,f);if(-.9999999>r)return c.cross(d,n,b),1E-6>c.length(b)&&c.cross(e,n,b),c.normalize(b,b),a.setAxisAngle(b,Math.PI,m),m;if(.9999999<r)return m[0]=0,m[1]=0,m[2]=0,m[3]=1,m;c.cross(n,
f,b);m[0]=b[0];m[1]=b[1];m[2]=b[2];m[3]=1+r;return a.normalize(m,m)}}();a.setAxes=function(){var c=b.create();return function(b,d,e,f){c[0]=d[0];c[3]=d[1];c[6]=d[2];c[1]=e[0];c[4]=e[1];c[7]=e[2];c[2]=-b[0];c[5]=-b[1];c[8]=-b[2];return a.normalize(a.fromMat3(c,f),f)}}();a.clone=d.clone;a.fromValues=d.fromValues;a.copy=d.copy;a.set=d.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=d.add;a.multiply=function(a,b,c){var d=a[0],f=a[1],e=a[2];a=a[3];var r=b[0],p=b[1],w=b[2];b=b[3];c[0]=d*b+a*r+f*w-e*p;c[1]=f*b+a*p+e*r-d*w;c[2]=e*b+a*w+d*p-f*r;c[3]=a*b-d*r-f*p-e*w;return c};a.mul=a.multiply;a.scale=d.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],f=a[1],e=a[2];a=a[3];var r=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*r;c[1]=f*b+e*r;c[2]=e*b-f*r;c[3]=a*b-d*r;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],f=a[1],e=a[2];a=a[3];var r=Math.sin(b);b=Math.cos(b);c[0]=d*
b-e*r;c[1]=f*b+a*r;c[2]=e*b+d*r;c[3]=a*b-f*r;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],f=a[1],e=a[2];a=a[3];var r=Math.sin(b);b=Math.cos(b);c[0]=d*b+f*r;c[1]=f*b-d*r;c[2]=e*b+a*r;c[3]=a*b-e*r;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],f=a[2];b[0]=c;b[1]=d;b[2]=f;b[3]=Math.sqrt(Math.abs(1-c*c-d*d-f*f));return b};a.dot=d.dot;a.lerp=d.lerp;a.slerp=function(a,b,c,d){var f=a[0],e=a[1],r=a[2];a=a[3];var p=b[0],w=b[1],E=b[2];b=b[3];var y,H,v;H=f*p+e*w+r*E+a*b;0>H&&(H=-H,p=-p,w=-w,
E=-E,b=-b);1E-6<1-H?(y=Math.acos(H),v=Math.sin(y),H=Math.sin((1-c)*y)/v,c=Math.sin(c*y)/v):H=1-c;d[0]=H*f+c*p;d[1]=H*e+c*w;d[2]=H*r+c*E;d[3]=H*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],f=a[2],e=a[3],r=c*c+d*d+f*f+e*e,r=r?1/r:0;b[0]=-c*r;b[1]=-d*r;b[2]=-f*r;b[3]=e*r;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=d.length;a.len=a.length;a.squaredLength=d.squaredLength;a.sqrLen=a.squaredLength;a.normalize=d.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var f=(d+1)%3,e=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*f+f]-a[3*e+e]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*f+e]-a[3*e+f])*c;b[f]=(a[3*f+d]+a[3*d+f])*c;b[e]=(a[3*e+d]+a[3*d+e])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};b4w.module.quat=b4w.module.__quat;
b4w.module.__mat3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[4];d[4]=a[5];d[5]=a[6];d[6]=a[8];d[7]=a[9];d[8]=a[10];return d};a.clone=function(a){var d=new p(9);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];return d};a.copy=function(a,d){d[0]=a[0];d[1]=a[1];d[2]=
a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];return d};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,d){if(d===a){var b=a[1],e=a[2],h=a[5];d[1]=a[3];d[2]=a[6];d[3]=b;d[5]=a[7];d[6]=e;d[7]=h}else d[0]=a[0],d[1]=a[3],d[2]=a[6],d[3]=a[1],d[4]=a[4],d[5]=a[7],d[6]=a[2],d[7]=a[5],d[8]=a[8];return d};a.invert=function(a,d){var b=a[0],e=a[1],h=a[2],g=a[3],l=a[4],n=a[5],f=a[6],m=a[7],r=a[8],p=r*l-n*m,w=-r*g+n*f,E=
m*g-l*f,y=b*p+e*w+h*E;if(!y)return null;y=1/y;d[0]=p*y;d[1]=(-r*e+h*m)*y;d[2]=(n*e-h*l)*y;d[3]=w*y;d[4]=(r*b-h*f)*y;d[5]=(-n*b+h*g)*y;d[6]=E*y;d[7]=(-m*b+e*f)*y;d[8]=(l*b-e*g)*y;return d};a.adjoint=function(a,d){var b=a[0],e=a[1],h=a[2],g=a[3],l=a[4],n=a[5],f=a[6],m=a[7],r=a[8];d[0]=l*r-n*m;d[1]=h*m-e*r;d[2]=e*n-h*l;d[3]=n*f-g*r;d[4]=b*r-h*f;d[5]=h*g-b*n;d[6]=g*m-l*f;d[7]=e*f-b*m;d[8]=b*l-e*g;return d};a.determinant=function(a){var d=a[3],b=a[4],e=a[5],h=a[6],g=a[7],l=a[8];return a[0]*(l*b-e*g)+a[1]*
(-l*d+e*h)+a[2]*(g*d-b*h)};a.multiply=function(a,d,b){var e=a[0],h=a[1],g=a[2],l=a[3],n=a[4],f=a[5],m=a[6],r=a[7];a=a[8];var p=d[0],w=d[1],E=d[2],y=d[3],H=d[4],v=d[5],B=d[6],t=d[7];d=d[8];b[0]=p*e+w*l+E*m;b[1]=p*h+w*n+E*r;b[2]=p*g+w*f+E*a;b[3]=y*e+H*l+v*m;b[4]=y*h+H*n+v*r;b[5]=y*g+H*f+v*a;b[6]=B*e+t*l+d*m;b[7]=B*h+t*n+d*r;b[8]=B*g+t*f+d*a;return b};a.mul=a.multiply;a.translate=function(a,d,b){var e=a[0],h=a[1],g=a[2],l=a[3],n=a[4],f=a[5],m=a[6],r=a[7];a=a[8];var p=d[0];d=d[1];b[0]=e;b[1]=h;b[2]=g;
b[3]=l;b[4]=n;b[5]=f;b[6]=p*e+d*l+m;b[7]=p*h+d*n+r;b[8]=p*g+d*f+a;return b};a.rotate=function(a,d,b){var e=a[0],h=a[1],g=a[2],l=a[3],n=a[4],f=a[5],m=a[6],r=a[7];a=a[8];var p=Math.sin(d);d=Math.cos(d);b[0]=d*e+p*l;b[1]=d*h+p*n;b[2]=d*g+p*f;b[3]=d*l-p*e;b[4]=d*n-p*h;b[5]=d*f-p*g;b[6]=m;b[7]=r;b[8]=a;return b};a.scale=function(a,d,b){var e=d[0];d=d[1];b[0]=e*a[0];b[1]=e*a[1];b[2]=e*a[2];b[3]=d*a[3];b[4]=d*a[4];b[5]=d*a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.dy=function(a,d){d[0]=1;d[1]=0;d[2]=
0;d[3]=0;d[4]=1;d[5]=0;d[6]=a[0];d[7]=a[1];d[8]=1;return d};a.by=function(a,d){var b=Math.sin(a),e=Math.cos(a);d[0]=e;d[1]=b;d[2]=0;d[3]=-b;d[4]=e;d[5]=0;d[6]=0;d[7]=0;d[8]=1;return d};a.cy=function(a,d){d[0]=a[0];d[1]=0;d[2]=0;d[3]=0;d[4]=a[1];d[5]=0;d[6]=0;d[7]=0;d[8]=1;return d};a.fromMat2d=function(a,d){d[0]=a[0];d[1]=a[1];d[2]=0;d[3]=a[2];d[4]=a[3];d[5]=0;d[6]=a[4];d[7]=a[5];d[8]=1;return d};a.fromQuat=function(a,d){var b=a[0],e=a[1],h=a[2],g=a[3],l=b+b,n=e+e,f=h+h,b=b*l,m=e*l,e=e*n,r=h*l,p=
h*n,h=h*f,l=g*l,n=g*n,g=g*f;d[0]=1-e-h;d[3]=m-g;d[6]=r+n;d[1]=m+g;d[4]=1-b-h;d[7]=p-l;d[2]=r-n;d[5]=p+l;d[8]=1-b-e;return d};a.normalFromMat4=function(a,d){var b=a[0],e=a[1],h=a[2],g=a[3],l=a[4],n=a[5],f=a[6],m=a[7],r=a[8],p=a[9],w=a[10],E=a[11],y=a[12],H=a[13],v=a[14],B=a[15],t=b*n-e*l,u=b*f-h*l,k=b*m-g*l,q=e*f-h*n,J=e*m-g*n,G=h*m-g*f,D=r*H-p*y,L=r*v-w*y,r=r*B-E*y,K=p*v-w*H,p=p*B-E*H,w=w*B-E*v,E=t*w-u*p+k*K+q*r-J*L+G*D;if(!E)return null;E=1/E;d[0]=(n*w-f*p+m*K)*E;d[1]=(f*r-l*w-m*L)*E;d[2]=(l*p-n*
r+m*D)*E;d[3]=(h*p-e*w-g*K)*E;d[4]=(b*w-h*r+g*L)*E;d[5]=(e*r-b*p-g*D)*E;d[6]=(H*G-v*J+B*q)*E;d[7]=(v*k-y*G-B*u)*E;d[8]=(y*J-H*k+B*t)*E;return d};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.ay=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat3=b4w.module.__mat3;
b4w.module.__mat4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var d=new p(16);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];d[9]=a[9];d[10]=a[10];d[11]=a[11];d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};a.copy=function(a,d){d[0]=a[0];
d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];d[9]=a[9];d[10]=a[10];d[11]=a[11];d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,d){if(d===a){var b=a[1],e=a[2],h=a[3],g=a[6],l=a[7],n=a[11];d[1]=a[4];d[2]=a[8];d[3]=a[12];d[4]=b;d[6]=a[9];d[7]=a[13];d[8]=e;d[9]=g;d[11]=a[14];d[12]=h;d[13]=
l;d[14]=n}else d[0]=a[0],d[1]=a[4],d[2]=a[8],d[3]=a[12],d[4]=a[1],d[5]=a[5],d[6]=a[9],d[7]=a[13],d[8]=a[2],d[9]=a[6],d[10]=a[10],d[11]=a[14],d[12]=a[3],d[13]=a[7],d[14]=a[11],d[15]=a[15];return d};a.invert=function(a,d){var b=a[0],e=a[1],h=a[2],g=a[3],l=a[4],n=a[5],f=a[6],m=a[7],r=a[8],p=a[9],w=a[10],E=a[11],y=a[12],H=a[13],v=a[14],B=a[15],t=b*n-e*l,u=b*f-h*l,k=b*m-g*l,q=e*f-h*n,J=e*m-g*n,G=h*m-g*f,D=r*H-p*y,L=r*v-w*y,K=r*B-E*y,O=p*v-w*H,A=p*B-E*H,I=w*B-E*v,C=t*I-u*A+k*O+q*K-J*L+G*D;if(!C)return null;
C=1/C;d[0]=(n*I-f*A+m*O)*C;d[1]=(h*A-e*I-g*O)*C;d[2]=(H*G-v*J+B*q)*C;d[3]=(w*J-p*G-E*q)*C;d[4]=(f*K-l*I-m*L)*C;d[5]=(b*I-h*K+g*L)*C;d[6]=(v*k-y*G-B*u)*C;d[7]=(r*G-w*k+E*u)*C;d[8]=(l*A-n*K+m*D)*C;d[9]=(e*K-b*A-g*D)*C;d[10]=(y*J-H*k+B*t)*C;d[11]=(p*k-r*J-E*t)*C;d[12]=(n*L-l*O-f*D)*C;d[13]=(b*O-e*L+h*D)*C;d[14]=(H*u-y*q-v*t)*C;d[15]=(r*q-p*u+w*t)*C;return d};a.adjoint=function(a,d){var b=a[0],e=a[1],h=a[2],g=a[3],l=a[4],n=a[5],f=a[6],m=a[7],r=a[8],p=a[9],w=a[10],E=a[11],y=a[12],H=a[13],v=a[14],B=a[15];
d[0]=n*(w*B-E*v)-p*(f*B-m*v)+H*(f*E-m*w);d[1]=-(e*(w*B-E*v)-p*(h*B-g*v)+H*(h*E-g*w));d[2]=e*(f*B-m*v)-n*(h*B-g*v)+H*(h*m-g*f);d[3]=-(e*(f*E-m*w)-n*(h*E-g*w)+p*(h*m-g*f));d[4]=-(l*(w*B-E*v)-r*(f*B-m*v)+y*(f*E-m*w));d[5]=b*(w*B-E*v)-r*(h*B-g*v)+y*(h*E-g*w);d[6]=-(b*(f*B-m*v)-l*(h*B-g*v)+y*(h*m-g*f));d[7]=b*(f*E-m*w)-l*(h*E-g*w)+r*(h*m-g*f);d[8]=l*(p*B-E*H)-r*(n*B-m*H)+y*(n*E-m*p);d[9]=-(b*(p*B-E*H)-r*(e*B-g*H)+y*(e*E-g*p));d[10]=b*(n*B-m*H)-l*(e*B-g*H)+y*(e*m-g*n);d[11]=-(b*(n*E-m*p)-l*(e*E-g*p)+r*
(e*m-g*n));d[12]=-(l*(p*v-w*H)-r*(n*v-f*H)+y*(n*w-f*p));d[13]=b*(p*v-w*H)-r*(e*v-h*H)+y*(e*w-h*p);d[14]=-(b*(n*v-f*H)-l*(e*v-h*H)+y*(e*f-h*n));d[15]=b*(n*w-f*p)-l*(e*w-h*p)+r*(e*f-h*n);return d};a.determinant=function(a){var d=a[0],b=a[1],e=a[2],h=a[3],g=a[4],l=a[5],n=a[6],f=a[7],m=a[8],r=a[9],p=a[10],w=a[11],E=a[12],y=a[13],H=a[14];a=a[15];return(d*l-b*g)*(p*a-w*H)-(d*n-e*g)*(r*a-w*y)+(d*f-h*g)*(r*H-p*y)+(b*n-e*l)*(m*a-w*E)-(b*f-h*l)*(m*H-p*E)+(e*f-h*n)*(m*y-r*E)};a.multiply=function(a,d,b){var e=
a[0],h=a[1],g=a[2],l=a[3],n=a[4],f=a[5],m=a[6],r=a[7],p=a[8],w=a[9],E=a[10],y=a[11],H=a[12],v=a[13],B=a[14];a=a[15];var t=d[0],u=d[1],k=d[2],q=d[3];b[0]=t*e+u*n+k*p+q*H;b[1]=t*h+u*f+k*w+q*v;b[2]=t*g+u*m+k*E+q*B;b[3]=t*l+u*r+k*y+q*a;t=d[4];u=d[5];k=d[6];q=d[7];b[4]=t*e+u*n+k*p+q*H;b[5]=t*h+u*f+k*w+q*v;b[6]=t*g+u*m+k*E+q*B;b[7]=t*l+u*r+k*y+q*a;t=d[8];u=d[9];k=d[10];q=d[11];b[8]=t*e+u*n+k*p+q*H;b[9]=t*h+u*f+k*w+q*v;b[10]=t*g+u*m+k*E+q*B;b[11]=t*l+u*r+k*y+q*a;t=d[12];u=d[13];k=d[14];q=d[15];b[12]=t*e+
u*n+k*p+q*H;b[13]=t*h+u*f+k*w+q*v;b[14]=t*g+u*m+k*E+q*B;b[15]=t*l+u*r+k*y+q*a;return b};a.mul=a.multiply;a.translate=function(a,d,b){var e=d[0],h=d[1];d=d[2];var g,l,n,f,m,r,p,w,E,y,H,v;a===b?(b[12]=a[0]*e+a[4]*h+a[8]*d+a[12],b[13]=a[1]*e+a[5]*h+a[9]*d+a[13],b[14]=a[2]*e+a[6]*h+a[10]*d+a[14],b[15]=a[3]*e+a[7]*h+a[11]*d+a[15]):(g=a[0],l=a[1],n=a[2],f=a[3],m=a[4],r=a[5],p=a[6],w=a[7],E=a[8],y=a[9],H=a[10],v=a[11],b[0]=g,b[1]=l,b[2]=n,b[3]=f,b[4]=m,b[5]=r,b[6]=p,b[7]=w,b[8]=E,b[9]=y,b[10]=H,b[11]=v,
b[12]=g*e+m*h+E*d+a[12],b[13]=l*e+r*h+y*d+a[13],b[14]=n*e+p*h+H*d+a[14],b[15]=f*e+w*h+v*d+a[15]);return b};a.scale=function(a,d,b){var e=d[0],h=d[1];d=d[2];b[0]=a[0]*e;b[1]=a[1]*e;b[2]=a[2]*e;b[3]=a[3]*e;b[4]=a[4]*h;b[5]=a[5]*h;b[6]=a[6]*h;b[7]=a[7]*h;b[8]=a[8]*d;b[9]=a[9]*d;b[10]=a[10]*d;b[11]=a[11]*d;b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.rotate=function(a,d,b,e){var h=b[0],g=b[1];b=b[2];var l=Math.sqrt(h*h+g*g+b*b),n,f,m,r,p,w,E,y,H,v,B,t,u,k,q,J,G,D,L,K;if(1E-7>Math.abs(l))return null;
l=1/l;h*=l;g*=l;b*=l;n=Math.sin(d);f=Math.cos(d);m=1-f;d=a[0];l=a[1];r=a[2];p=a[3];w=a[4];E=a[5];y=a[6];H=a[7];v=a[8];B=a[9];t=a[10];u=a[11];k=h*h*m+f;q=g*h*m+b*n;J=b*h*m-g*n;G=h*g*m-b*n;D=g*g*m+f;L=b*g*m+h*n;K=h*b*m+g*n;h=g*b*m-h*n;g=b*b*m+f;e[0]=d*k+w*q+v*J;e[1]=l*k+E*q+B*J;e[2]=r*k+y*q+t*J;e[3]=p*k+H*q+u*J;e[4]=d*G+w*D+v*L;e[5]=l*G+E*D+B*L;e[6]=r*G+y*D+t*L;e[7]=p*G+H*D+u*L;e[8]=d*K+w*h+v*g;e[9]=l*K+E*h+B*g;e[10]=r*K+y*h+t*g;e[11]=p*K+H*h+u*g;a!==e&&(e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);
return e};a.rotateX=function(a,d,b){var e=Math.sin(d);d=Math.cos(d);var h=a[4],g=a[5],l=a[6],n=a[7],f=a[8],m=a[9],r=a[10],p=a[11];a!==b&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[4]=h*d+f*e;b[5]=g*d+m*e;b[6]=l*d+r*e;b[7]=n*d+p*e;b[8]=f*d-h*e;b[9]=m*d-g*e;b[10]=r*d-l*e;b[11]=p*d-n*e;return b};a.rotateY=function(a,d,b){var e=Math.sin(d);d=Math.cos(d);var h=a[0],g=a[1],l=a[2],n=a[3],f=a[8],m=a[9],r=a[10],p=a[11];a!==b&&(b[4]=a[4],b[5]=a[5],b[6]=a[6],
b[7]=a[7],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[0]=h*d-f*e;b[1]=g*d-m*e;b[2]=l*d-r*e;b[3]=n*d-p*e;b[8]=h*e+f*d;b[9]=g*e+m*d;b[10]=l*e+r*d;b[11]=n*e+p*d;return b};a.rotateZ=function(a,d,b){var e=Math.sin(d);d=Math.cos(d);var h=a[0],g=a[1],l=a[2],n=a[3],f=a[4],m=a[5],r=a[6],p=a[7];a!==b&&(b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[0]=h*d+f*e;b[1]=g*d+m*e;b[2]=l*d+r*e;b[3]=n*d+p*e;b[4]=f*d-h*e;b[5]=m*d-g*e;b[6]=r*d-l*e;b[7]=p*d-n*e;return b};
a.dy=function(a,d){d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=a[0];d[13]=a[1];d[14]=a[2];d[15]=1;return d};a.cy=function(a,d){d[0]=a[0];d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=a[1];d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=a[2];d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.by=function(a,d,b){var e=d[0],h=d[1];d=d[2];var g=Math.sqrt(e*e+h*h+d*d),l;if(1E-7>Math.abs(g))return null;g=1/g;e*=g;h*=g;d*=g;g=Math.sin(a);a=Math.cos(a);l=1-a;b[0]=e*e*l+a;b[1]=h*e*l+d*
g;b[2]=d*e*l-h*g;b[3]=0;b[4]=e*h*l-d*g;b[5]=h*h*l+a;b[6]=d*h*l+e*g;b[7]=0;b[8]=e*d*l+h*g;b[9]=h*d*l-e*g;b[10]=d*d*l+a;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.kE=function(a,d){var b=Math.sin(a),e=Math.cos(a);d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=e;d[6]=b;d[7]=0;d[8]=0;d[9]=-b;d[10]=e;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.lE=function(a,d){var b=Math.sin(a),e=Math.cos(a);d[0]=e;d[1]=0;d[2]=-b;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=b;d[9]=0;d[10]=e;d[11]=0;d[12]=0;d[13]=0;
d[14]=0;d[15]=1;return d};a.mE=function(a,d){var b=Math.sin(a),e=Math.cos(a);d[0]=e;d[1]=b;d[2]=0;d[3]=0;d[4]=-b;d[5]=e;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.fromRotationTranslation=function(a,d,b){var e=a[0],h=a[1],g=a[2],l=a[3],n=e+e,f=h+h,m=g+g;a=e*n;var r=e*f,e=e*m,p=h*f,h=h*m,g=g*m,n=l*n,f=l*f,l=l*m;b[0]=1-(p+g);b[1]=r+l;b[2]=e-f;b[3]=0;b[4]=r-l;b[5]=1-(a+g);b[6]=h+n;b[7]=0;b[8]=e+f;b[9]=h-n;b[10]=1-(a+p);b[11]=0;b[12]=d[0];b[13]=d[1];b[14]=d[2];
b[15]=1;return b};a.fromQuat=function(a,d){var b=a[0],e=a[1],h=a[2],g=a[3],l=b+b,n=e+e,f=h+h,b=b*l,m=e*l,e=e*n,r=h*l,p=h*n,h=h*f,l=g*l,n=g*n,g=g*f;d[0]=1-e-h;d[1]=m+g;d[2]=r-n;d[3]=0;d[4]=m-g;d[5]=1-b-h;d[6]=p+l;d[7]=0;d[8]=r+n;d[9]=p-l;d[10]=1-b-e;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.frustum=function(a,d,b,e,h,g,l){var n=1/(d-a),f=1/(e-b),m=1/(h-g);l[0]=2*h*n;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=2*h*f;l[6]=0;l[7]=0;l[8]=(d+a)*n;l[9]=(e+b)*f;l[10]=(g+h)*m;l[11]=-1;l[12]=0;l[13]=0;l[14]=
g*h*2*m;l[15]=0;return l};a.perspective=function(a,d,b,e,h){a=1/Math.tan(a/2);var g=1/(b-e);h[0]=a/d;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=a;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=(e+b)*g;h[11]=-1;h[12]=0;h[13]=0;h[14]=2*e*b*g;h[15]=0;return h};a.gF=function(a,d,b,e){var h=Math.tan(a.xF*Math.PI/180),g=Math.tan(a.$D*Math.PI/180),l=Math.tan(a.TE*Math.PI/180);a=Math.tan(a.iF*Math.PI/180);var n=2/(l+a),f=2/(h+g);e[0]=n;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=f;e[6]=0;e[7]=0;e[8]=-((l-a)*n*.5);e[9]=(h-g)*f*.5;e[10]=b/
(d-b);e[11]=-1;e[12]=0;e[13]=0;e[14]=b*d/(d-b);e[15]=0;return e};a.ortho=function(a,d,b,e,h,g,l){var n=1/(a-d),f=1/(b-e),m=1/(h-g);l[0]=-2*n;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=-2*f;l[6]=0;l[7]=0;l[8]=0;l[9]=0;l[10]=2*m;l[11]=0;l[12]=(a+d)*n;l[13]=(e+b)*f;l[14]=(g+h)*m;l[15]=1;return l};a.lookAt=function(c,d,b,e){var h,g,l,n,f,m,r,p,w=c[0],E=c[1];c=c[2];l=b[0];n=b[1];g=b[2];r=d[0];b=d[1];h=d[2];if(1E-7>Math.abs(w-r)&&1E-7>Math.abs(E-b)&&1E-7>Math.abs(c-h))return a.identity(e);d=w-r;b=E-b;r=c-h;p=1/Math.sqrt(d*
d+b*b+r*r);d*=p;b*=p;r*=p;h=n*r-g*b;g=g*d-l*r;l=l*b-n*d;(p=Math.sqrt(h*h+g*g+l*l))?(p=1/p,h*=p,g*=p,l*=p):l=g=h=0;n=b*l-r*g;f=r*h-d*l;m=d*g-b*h;(p=Math.sqrt(n*n+f*f+m*m))?(p=1/p,n*=p,f*=p,m*=p):m=f=n=0;e[0]=h;e[1]=n;e[2]=d;e[3]=0;e[4]=g;e[5]=f;e[6]=b;e[7]=0;e[8]=l;e[9]=m;e[10]=r;e[11]=0;e[12]=-(h*w+g*E+l*c);e[13]=-(n*w+f*E+m*c);e[14]=-(d*w+b*E+r*c);e[15]=1;return e};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+
a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.ay=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.mat4=b4w.module.__mat4;b4w.module.__md5=function(a){function p(a,h){var n=a[0],f=a[1],m=a[2],r=a[3],n=d(n,f,m,r,h[0],7,-680876936),r=d(r,n,f,m,h[1],12,-389564586),m=d(m,r,n,f,h[2],17,606105819),f=d(f,m,r,n,h[3],22,-1044525330),n=d(n,f,m,r,h[4],7,-176418897),r=d(r,n,f,m,h[5],12,1200080426),m=d(m,r,n,f,h[6],17,-1473231341),f=d(f,m,r,n,h[7],22,-45705983),n=d(n,f,m,r,h[8],7,1770035416),r=d(r,n,f,m,h[9],12,-1958414417),m=d(m,r,n,f,h[10],17,-42063),f=d(f,m,r,n,h[11],22,-1990404162),n=d(n,f,m,r,h[12],7,1804603682),r=d(r,n,f,m,
h[13],12,-40341101),m=d(m,r,n,f,h[14],17,-1502002290),f=d(f,m,r,n,h[15],22,1236535329),n=b(n,f,m,r,h[1],5,-165796510),r=b(r,n,f,m,h[6],9,-1069501632),m=b(m,r,n,f,h[11],14,643717713),f=b(f,m,r,n,h[0],20,-373897302),n=b(n,f,m,r,h[5],5,-701558691),r=b(r,n,f,m,h[10],9,38016083),m=b(m,r,n,f,h[15],14,-660478335),f=b(f,m,r,n,h[4],20,-405537848),n=b(n,f,m,r,h[9],5,568446438),r=b(r,n,f,m,h[14],9,-1019803690),m=b(m,r,n,f,h[3],14,-187363961),f=b(f,m,r,n,h[8],20,1163531501),n=b(n,f,m,r,h[13],5,-1444681467),r=
b(r,n,f,m,h[2],9,-51403784),m=b(m,r,n,f,h[7],14,1735328473),f=b(f,m,r,n,h[12],20,-1926607734),n=c(f^m^r,n,f,h[5],4,-378558),r=c(n^f^m,r,n,h[8],11,-2022574463),m=c(r^n^f,m,r,h[11],16,1839030562),f=c(m^r^n,f,m,h[14],23,-35309556),n=c(f^m^r,n,f,h[1],4,-1530992060),r=c(n^f^m,r,n,h[4],11,1272893353),m=c(r^n^f,m,r,h[7],16,-155497632),f=c(m^r^n,f,m,h[10],23,-1094730640),n=c(f^m^r,n,f,h[13],4,681279174),r=c(n^f^m,r,n,h[0],11,-358537222),m=c(r^n^f,m,r,h[3],16,-722521979),f=c(m^r^n,f,m,h[6],23,76029189),n=
c(f^m^r,n,f,h[9],4,-640364487),r=c(n^f^m,r,n,h[12],11,-421815835),m=c(r^n^f,m,r,h[15],16,530742520),f=c(m^r^n,f,m,h[2],23,-995338651),n=e(n,f,m,r,h[0],6,-198630844),r=e(r,n,f,m,h[7],10,1126891415),m=e(m,r,n,f,h[14],15,-1416354905),f=e(f,m,r,n,h[5],21,-57434055),n=e(n,f,m,r,h[12],6,1700485571),r=e(r,n,f,m,h[3],10,-1894986606),m=e(m,r,n,f,h[10],15,-1051523),f=e(f,m,r,n,h[1],21,-2054922799),n=e(n,f,m,r,h[8],6,1873313359),r=e(r,n,f,m,h[15],10,-30611744),m=e(m,r,n,f,h[6],15,-1560198380),f=e(f,m,r,n,h[13],
21,1309151649),n=e(n,f,m,r,h[4],6,-145523070),r=e(r,n,f,m,h[11],10,-1120210379),m=e(m,r,n,f,h[2],15,718787259),f=e(f,m,r,n,h[9],21,-343485551);a[0]=n+a[0]&4294967295;a[1]=f+a[1]&4294967295;a[2]=m+a[2]&4294967295;a[3]=r+a[3]&4294967295}function c(a,b,c,d,e,h){b=(b+a&4294967295)+(d+h&4294967295)&4294967295;return(b<<e|b>>>32-e)+c&4294967295}function d(a,b,d,f,e,h,p){return c(b&d|~b&f,a,b,e,h,p)}function b(a,b,d,f,e,h,p){return c(b&f|d&~f,a,b,e,h,p)}function e(a,b,d,f,e,h,p){return c(d^(b|~f),a,b,e,
h,p)}var h="0123456789abcdef".split("");a.jr=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var e=b.substring(d-64,d),r=[],z=void 0,z=0;64>z;z+=4)r[z>>2]=e.charCodeAt(z)+(e.charCodeAt(z+1)<<8)+(e.charCodeAt(z+2)<<16)+(e.charCodeAt(z+3)<<24);p(a,r)}b=b.substring(d-64);e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)e[d>>2]|=b.charCodeAt(d)<<(d%4<<3);e[d>>2]|=128<<(d%4<<3);if(55<d)for(p(a,e),d=0;16>d;d++)e[d]=0;e[14]=8*
c;p(a,e);for(b=0;b<a.length;b++){c=a[b];d="";for(e=0;4>e;e++)d+=h[c>>8*e+4&15]+h[c>>8*e&15];a[b]=d}return a.join("")}};b4w.module.shader_texts=function(a){a["anchors.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",a:[{type:"var",name:"ANCHOR_NUM",b:["0"]},{type:"textline",b:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec4 a ; a = u_view_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_Position = u_proj_matrix * a ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",
name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},
{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform",
"vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]}]}}]},{type:"textline",b:["uniform","vec3","u_color_id",";"]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",
";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",
a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"varying vec3 eU ; varying vec4 eV ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",
d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_perspective_cast_far_bound ; varying vec4 e_ ; varying vec4 fa ; varying vec4 fb ; varying vec4 fc ; uniform float u_perspective_cast_far_bound ; uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ; uniform sampler2D u_shadow_map1 ; uniform sampler2D u_shadow_map2 ; uniform sampler2D u_shadow_map3 ; uniform sampler2D u_shadow_mask ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { float te , tf ; vec3 tg , th , ti , tj ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"tg = u_camera_eye_frag - eU ; tg = normalize ( tg ) ; td ( tg , th , ti , tj , te , tf ) ; tf = tf ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"tf = ( texture2D ( u_sampler , fd ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tf = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( tf < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",
";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 eU ; varying vec4 eV ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL",
"USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 vN ; float vO , vP , vQ ; mat4 vR ; vec3 vS , vT , vU , vV , vW , vX ; vS = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE","USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",
d:3},{type:"logical_or_expr",d:6},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["vT","=","a_normal",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vU = vec3 ( a_tangent ) ; vV = a_tangent [ 3 ] * cross ( vT , vU ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vU = vec3 ( 0.0 ) ; vV = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vT = vec3 ( 0.0 ) ; vU = vec3 ( 0.0 ) ; vV = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"vS = mix ( vS , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"vT = mix ( vT , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vW = vec3 ( a_tangent ) ; vX = a_tangent_next [ 3 ] * cross ( a_normal_next , vW ) ; vU = mix ( vU , vW , u_va_frame_factor ) ; vV = mix ( vV , vX , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uT ( vS , vU , vV , vT ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["vV","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vV = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vU = ( u_model_matrix * vec4 ( vV , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"vR = tM ( u_camera_eye , vU , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vR = tG ( u_camera_eye , vU , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vX = ( u_model_matrix * vec4 ( vV , 1.0 ) ) . xyz ; vR = vR * ty ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vX ) ;".split(" ")}]}}]},
{type:"textline",b:"el vY = tT ( vS - vV , vV , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vR ) ; vY . b = vU ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"el vY = tT ( vS , vV , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vH ( vY . a , vY . b , vT ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["vT","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vT = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vH ( vY . a , vY . b , vT ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"fd = tW ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"eU = vY . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",
d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"eW = vY . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vO = ( dot ( cross ( vY . e , vY . c ) , vY . d ) < 0.0 ) ? - 1.0 : 1.0 ; eX = vec4 ( vY . c , vO ) ;".split(" ")}]}}]},{type:"textline",b:"eV = u_view_matrix * vec4 ( vY . a , 1.0 ) ; vN = u_proj_matrix * eV ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",
b:"vN . xy += u_subpixel_jitter * vN . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vO = vN . x ; vP = vN . y ; vQ = vN . w ; eY . x = ( vO + vQ ) / 2.0 ; eY . y = ( vP + vQ ) / 2.0 ; eY . z = vQ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"eZ = - eV . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["vM","(",")",";"]}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( vY . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",
b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},
{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1},"NODES","ALPHA",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},
{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eU",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eX",";"]}]}}]}]}},{type:"else",
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","e_",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fa",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fb",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fc",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",
{type:"logic_negative_expr",d:1},"NODES","ALPHA",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { float vN , vO ; vec3 vP , vQ , vR , vS ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"vP = u_camera_eye_frag - eU ; vP = normalize ( vP ) ; td ( vP , vQ , vR , vS , vN , vO ) ; vO = vO ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"vO = ( texture2D ( u_colormap0 , fd ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vO = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( vO < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","NO_SHADOWS",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",
d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( gT ( eV . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",
a:[{type:"textline",b:"gl_FragColor . a += 0.00001 * eX . r ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS",
"CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1},"TEXTURE_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute",
"vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD","SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",
b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",
c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1},"TEXTURE_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eU",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS",
"CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eX",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","e_",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec4","fa",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fb",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fc",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec2 wC ; vec4 wD , wE ; float wF ; mat4 wG , wH ; vec3 wI , wJ , wK , wL , wM , wN ; wI = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"CALC_TBN_SPACE","USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",
d:3},{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["wJ","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wJ = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"wK = vec3 ( a_tangent ) ; wL = a_tangent [ 3 ] * cross ( wJ , wK ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wK = vec3 ( 0.0 ) ; wL = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"wI = mix ( wI , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"wJ = mix ( wJ , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"wM = vec3 ( a_tangent ) ; wN = a_tangent_next [ 3 ] * cross ( a_normal_next , wM ) ; wK = mix ( wK , wM , u_va_frame_factor ) ; wL = mix ( wL , wN , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uT ( wI , wK , wL , wJ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",
{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["wL","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wL = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"el wO = wr ( wI , vec3 ( 0.0 ) , vec3 ( 0.0 ) , wJ , wL , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"wK = ( u_model_matrix * vec4 ( wL , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD",{type:"logic_negative_expr",d:1},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["wG","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["wG","=","u_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wH = tM ( u_camera_eye , wK , wG , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wH = tG ( u_camera_eye , wK , wG ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"wN = ( u_model_matrix * vec4 ( wL , 1.0 ) ) . xyz ; wH = wH * ty ( u_wind , u_time , u_jitter_amp , u_jitter_freq , wN ) ;".split(" ")}]}}]},{type:"textline",b:"el wO = tT ( wI - wL , wL , vec3 ( 0.0 ) , vec3 ( 0.0 ) , wJ , wH ) ; wO . b = wK ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"el wO = tT ( wI , wL , vec3 ( 0.0 ) , vec3 ( 0.0 ) , wJ , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["wJ","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wJ = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vH ( wO . a , wO . b , wJ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"eU = wO . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"eW = wO . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"wF = ( dot ( cross ( wO . e , wO . c ) , wO . d ) < 0.0 ) ? - 1.0 : 1.0 ; eX = vec4 ( wO . c , wF ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"wD = u_view_matrix * vec4 ( wO . a , 1.0 ) ; wE = u_proj_matrix * wD ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"wE . xy += u_subpixel_jitter * wE . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"eY = eT ( wE ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"eZ = - eV . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["vM","(",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"fd = tW ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wB ( wO . a , wO . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["eV","=","wD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"wC = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; wF = SHADOW_TEX_RES / 2.0 ; wC = floor ( wC * wF + 0.5 ) / wF - wC ; wE . xy += wC ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","wE",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","wC",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","wC",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","wC",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","wC",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( wC , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , wC ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",
b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","wC",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","wC",";"]}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","wC",";"]}]}}]}]}}]},{type:"textline",b:"void main ( ) { vec4 wD ; mat4 wE ; vec3 wF ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"wF = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; wE = tG ( u_camera_eye , wF , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND",
"BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wE = wE * ty ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"el wG = tT ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , wE ) ; wG . b = wF ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"el wG = tT ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},
{type:"textline",b:"wD = u_proj_matrix * u_view_matrix * vec4 ( wG . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"wC = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["wC","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["wC","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","wD",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 wD ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 fd ; varying float wE ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","NUM_LINES",{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const int wF = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int wF = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float wH ( float wG ) { return wG - floor ( wG * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void wQ ( inout float wI , in float wJ [ wF ] , in float wK ) { float wL , wM , wN , wO ; for ( int wP = 0 ; wP < NUM_RINGS ; wP ++ ) { wL = 40.0 * wJ [ wP ] ; wM = 300.0 * ( wH ( wL ) - 0.005 ) ; wN = wL ; wO = abs ( wN * ( u_halo_size * wM - wK ) ) ; wI += 1.0 - min ( wO , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void wZ ( inout float wR , in float wS [ wF ] , in float wT ) { float wU , wV , wW , wX ; for ( int wY = 0 ; wY < NUM_LINES ; wY ++ ) { wU = wS [ wY ] ; wV = wU ; wW = 1000.0 * ( wH ( wU ) - 0.005 ) ; wX = 20.0 * abs ( wV * fd . x + wW * fd . y ) ; wR += 1.0 - min ( wX , 1.0 ) ; } wR *= wT ; }".split(" ")}]}}]},{type:"textline",b:"void xf ( inout float w_ , in vec2 xa ) { float xb , xc , xd , xe ; xc = atan ( xa . y , xa . x ) ; xc *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; xd = cos ( xc ) ; xe = sin ( xc ) ; xc = ( xd * xa . x + xe * xa . y ) * ( xd * xa . y - xe * xa . x ) ; xb = abs ( xc ) ; if ( xb < 1.0 ) { xb = ( 0.01 * u_halo_size ) / ( xb ) ; w_ *= sqrt ( min ( xb , 1.0 ) ) ; } } void main ( ) { vec3 xg ; float xh , xi , xj , xk ; xh = ( fd . x * fd . x + fd . y * fd . y ) ; xi = sqrt ( xh ) ; xh = max ( 1.0 - xh , 0.0 ) ; xh = pow ( xh , u_halo_hardness ) ; xj = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","NUM_LINES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float xl [ wF ] ; for ( int xm = 0 ; xm < wF ; xm ++ ) { xl [ xm ] = fract ( wE / ( float ( xm ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"xk = 0.0 ; wQ ( xk , xl , xi ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"xi = 0.0 ; wZ ( xi , xl , xh ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"xf ( xh , fd ) ;".split(" ")}]}}]},{type:"textline",b:"xh *= xj ; xg = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"xk *= xh ; xg += u_halo_rings_color * xk ; xh += xk ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"xi *= xj ; xg += u_halo_lines_color * xi ; xh += xi ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"xh *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xi = u_halo_stars_blend * ( wD . y - u_halo_stars_height ) ; xh *= clamp ( xi , 0.0 , 1.0 ) ; xh *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"ef ( xg ) ; ei ( xg , xh ) ; gl_FragColor = vec4 ( xg , xh ) ; }".split(" ")}]};a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 fd ; varying float wE ;".split(" ")},{type:"condition",a:[{type:"if",
c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","wD",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 wF , wG ; mat4 wH , wI ; vec3 wJ ; wJ = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; fd = a_halo_bb_vertex * 2.0 ; wE = fract ( wJ . x + wJ . y + wJ . z ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"wH = tk ( wJ , u_view_matrix ) ; wI = u_view_matrix ; wI [ 3 ] [ 0 ] = 0.0 ; wI [ 3 ] [ 1 ] = 0.0 ; wI [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wH = tk ( wJ , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"wF = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; wF = wH * wF ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",
a:[{type:"textline",b:"wG = u_proj_matrix * wI * wF ; wG . z = 0.99999 * wG . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["wD","=","wF",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wG = u_proj_matrix * u_view_matrix * wF ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","wG",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",
file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 wF ; wF = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( wF , 1.0 ) ; }".split(" ")}]};
a["main.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},
{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",
a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_VECTOR_VIEW",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"PROCEDURAL_FOG",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","ALPHA_AS_SPEC",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",
b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["uniform",
"float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION","USE_REFRACTION","NODES",{type:"logical_and_expr",
d:3},{type:"logical_or_expr",d:2},"REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},
{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],
group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]}]}}]},{type:"textline",b:["varying","vec3","eU",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",
{type:"logical_or_expr",d:8}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","wF",";"]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying",
"vec3","wG",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","e_",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fa",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fb",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","fc",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",
d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2},"USE_NODE_B4W_REFRACTION","USE_REFRACTION","NODES",{type:"logical_and_expr",d:3},{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { vec4 wH , wI , wJ , wK ; mat3 wL ; vec2 wM , wN , wO , wP ; vec3 wQ , wR , wS , wT , wU , wV , wW , wX , wY ; float wZ , w_ , xa , xb , xc , xd , xe ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",
d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"wZ = length ( eV ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"w_ = eU . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",
d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["wQ","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"wR = normalize ( u_camera_eye_frag - eU ) ; td ( wR , wS , wT , wU , xa , xb ) ; wS = wS ; xb = xb ; wU = wU ; xa = xa ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["wM","=","fd",";"]}]}}]},{type:"textline",
b:["wT","=","eW",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) wT = wT ; else wT = - wT ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"wV = cross ( wT , eX . xyz ) * eX . w ; wL = mat3 ( eX . xyz , wV , wT ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"wN = normalize ( u_view_matrix_frag * vec4 ( eW , 0.0 ) ) . st ; wN = wN * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( wZ < PARALLAX_LOD_DIST ) { xc = clamp ( 0.5 * ( PARALLAX_LOD_DIST - wZ ) , 0.0 , 1.0 ) ; xc = u_parallax_scale * xc ; wV = normalize ( wF * wL ) ; xd = 1.0 / PARALLAX_STEPS ; wO = wV . xy * xc / ( PARALLAX_STEPS * wV . z ) ; xc = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["wP","=","wN",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["wP","=","wM",";"]}]}}]},{type:"textline",b:"xe = texture2D ( u_normalmap0 , wP ) . a ; for ( float xf = 1.0 ; xf <= PARALLAX_STEPS ; xf ++ ) { if ( xe < xc ) { xc -= xd ; wP -= wO ; xe = texture2D ( u_normalmap0 , wP ) . a ; } } wO = wP + wO ; xd = texture2D ( u_normalmap0 , wO ) . a - ( xc + xd ) ; xc = xe - xc ; xd = xc / ( xc - xd ) ; wP = xd * wO + ( 1.0 - xd ) * wP ;".split(" ")},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"wM += wP - wN ;".split(" ")}]}}]},{type:"textline",b:["wN","=","wP",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"wN += wP - wM ;".split(" ")}]}}]},{type:"textline",b:["wM","=","wP",";"]}]}}]},{type:"textline",
b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wH = texture2D ( u_normalmap0 , wN ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wH = texture2D ( u_normalmap0 , wM ) ;".split(" ")}]}}]},{type:"textline",b:"wV = wH . rgb - 0.5 ; wV = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , wV , u_normal_factor ) ; wU = wL * wV ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["wU","=","wT",";"]}]}}]},{type:"textline",b:"wU = normalize ( wU ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"wN = normalize ( u_view_matrix_frag * vec4 ( wU , 0.0 ) ) . st ; wN = wN * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"wR = normalize ( wF ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"wT = wG ; ed ( wT ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wH = vec4 ( wT , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["wH","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["xd","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"wI = texture2D ( u_colormap0 , wN ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wI = texture2D ( u_colormap0 , wM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"ed ( wI . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wJ = texture2D ( u_colormap1 , wN ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wJ = texture2D ( u_colormap1 , wM ) ;".split(" ")}]}}]},{type:"textline",b:"ed ( wJ . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"wK = texture2D ( u_stencil0 , wN ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wK = texture2D ( u_stencil0 , wM ) ;".split(" ")}]}}]},{type:"textline",b:"wI = mix ( wI , wJ , wK . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wH . rgb = mix ( wH . rgb , wI . rgb , u_diffuse_color_factor ) ; xc = u_alpha_factor * wI . a ; xc += ( 1.0 - step ( 0.0 , xc ) ) ; wH . a = mix ( xc , 1.0 , u_diffuse_color . a ) ; xd = wI . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wH . rgb *= mix ( vec3 ( 1.0 ) , wI . rgb , u_diffuse_color_factor ) ; wH . a = wI . a ; xd = wI . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"wT = u_diffuse_intensity * wH . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["wS","=","wT",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wV = u_environment_energy * hu ( wU ) ; wV = u_ambient * wV ; xa = gY ( wT ) ; wW = u_emit * wH . rgb ; wX = u_specular_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"wY = vec3 ( xd ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wY = texture2D ( u_specmap0 , wN ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wY = texture2D ( u_specmap0 , wM ) . rgb ;".split(" ")}]}}]},
{type:"textline",b:"ed ( wY . rgb ) ; wX = mix ( wX , wY , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"xd = u_specular_params [ 0 ] ; wM = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; wX = xd * wX ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"af xg = cS ( wW , wV , wT ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"af xg = cN ( wW , wV , wT , wX , eU , wU , wR , wM , u_diffuse_params , xa , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"wS = xg . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"hr ( wS , wR , wU , u_reflect_factor ) ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"hr ( wS , wR , wU , 0.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"wS += xg . b ;".split(" ")}]}}]},{type:"textline",b:"xb = wH . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"wS = max ( wS - sqrt ( 0.01 * - min ( w_ , 0.0 ) ) , 0.5 * wS ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"eb ( wS , w_ , u_time , xa , wU , u_sun_direction , wQ , u_sun_quaternion , eU , wZ ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( xb <= 0.5 ) discard ; xb = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADELESS",
{type:"logic_negative_expr",d:1},"NODES",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xa = max ( max ( xg . b . r , xg . b . g ) , xg . b . b ) * u_specular_alpha ; xb = wH . a * ( 1.0 - xa ) + xa ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES_GLOW",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["xb","=","1.0",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"wS = mix ( hI ( eY , wU . xz * u_refr_bump ) , wS , xb ) ; xb = 1.0 ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"PROCEDURAL_FOG",{type:"logic_negative_expr",d:1},"WATER_EFFECTS",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"xa = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"wU = D ( u_cube_fog , wR ) ; wH = vec4 ( wU , u_fog_color_density . a ) ; ed ( wH . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wH = u_fog_color_density ; wH . rgb *= xa ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"U ( wS , wZ , wR , u_cam_water_depth , u_underwater_fog_color_density , wH , w_ , xa ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"x ( wS , wZ , wH ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"wM = texture2DProj ( u_shadow_mask , eY ) . rg ; wZ = wM . g ; wS = vec3 ( wZ ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"SHADELESS",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"wS = vec3 ( fe . a ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["ef","(","wS",")",
";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2},"NODES_GLOW",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ei ( wS , xb ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( wS , xb ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",
b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",
{type:"logical_or_expr",d:8}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",
{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},
{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",
a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",
a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",
{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:["varying","vec3","eU",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:8}],group:{type:"group",a:[{type:"textline",
b:["varying","vec3","eW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying",
"vec4","eX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","wF",";"]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","wG",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","e_",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fa",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","fb",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4",
"fc",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 wH , wI ; float wJ ; mat4 wK ; vec3 wL , wM , wN , wO , wP , wQ , wR ; wL = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE",
"USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"NODES",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["wM","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wM = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",
{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wN = vec3 ( a_tangent ) ; wO = a_tangent [ 3 ] * cross ( wM , wN ) ;".split(" ")}]}},{type:"elif",c:["NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wP = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; wQ = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; wP = wP - u_camera_eye ; wO = cross ( wP , wQ ) ; wN = cross ( wQ , wO ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"wN = vec3 ( 0.0 ) ; wO = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"wL = mix ( wL , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",
b:"wM = mix ( wM , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"wQ = vec3 ( a_tangent ) ; wP = a_tangent_next [ 3 ] * cross ( a_normal_next , wQ ) ; wN = mix ( wN , wQ , u_va_frame_factor ) ; wO = mix ( wO , wP , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uT ( wL , wN , wO , wM ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["wP","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"wP = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"el wS = wr ( wL , wN , wO , wM , wP , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"wQ = ( u_model_matrix * vec4 ( wP , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wK = tM ( u_camera_eye , wQ , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"wK = tG ( u_camera_eye , wQ , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wR = ( u_model_matrix * vec4 ( wP , 1.0 ) ) . xyz ; wK = wK * ty ( u_wind , u_time , u_jitter_amp , u_jitter_freq , wR ) ;".split(" ")}]}}]},{type:"textline",b:"el wS = tT ( wL - wP , wP , wN , wO , wM , wK ) ; wS . b = wQ ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"el wS = tT ( wL , wP , wN , wO , wM , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wJ = ( dot ( cross ( wS . e , wS . c ) , wS . d ) < 0.0 ) ? - 1.0 : 1.0 ; eX = vec4 ( wS . c , wJ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"vH ( wS . a , wS . b , wM ) ;".split(" ")}]}}]},{type:"textline",
b:"eU = wS . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:"eW = wS . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"wF = u_camera_eye - wS . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"fd = tW ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"wG = wS . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["wG","=","a_color",";"]}]}}]}]}}]},{type:"textline",b:"wH = u_view_matrix * vec4 ( wS . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",
"DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["eV","=","wH",";"]}]}}]},{type:"textline",b:"wI = u_proj_matrix * wH ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"wI . xy += u_subpixel_jitter * wI . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"eY = eT ( wI ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wB ( wS . a , wS . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",
{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"eZ = - wH . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:["vM","(",")",";"]}]}}]},{type:"textline",b:["gl_Position","=","wI",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},
{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"SOFT_STRENGTH",b:["1.0"]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec2 u_texel_size ; uniform vec4 u_fog_color_density ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},
{type:"textline",b:"varying float wH ; varying vec3 wG ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"textline",b:"varying float wI ; void main ( ) { vec4 wJ ; vec3 wK ; float wL , wM , wN ; vec2 wO , wP ; wO = gl_PointCoord - 0.5 ; wL = 2.0 * length ( wO ) ; wL = smoothstep ( u_p_alpha_start , u_p_alpha_end , wL ) ; wL = u_diffuse_color . a * wH * ( 1.0 - wL ) ; wK = wG * u_diffuse_color . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"x ( wK , length ( eV ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"wP = eY . xy / eY . z ; wO = vec2 ( wO . x , - wO . y ) * wI * u_texel_size ; wO = vec2 ( wP + wO ) ; wJ = texture2D ( u_scene_depth , wO ) ; wM = k ( wJ ) ; wN = - eV . z / u_view_max_depth ; wN = wM - wN ; wN = u_view_max_depth / SOFT_STRENGTH * wN ; wL = wL * min ( wN , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["ef","(","wK",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ei ( wK , wL ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( wK , wL ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float wH ; varying vec3 wG ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"textline",b:["varying","float","wI",";"]},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { float xv , xw , xx , xy ; vec4 xz , xA ; wJ xB ; xB = xu ( ) ; xz = u_view_matrix * vec4 ( xB . b , 1.0 ) ; xA = u_proj_matrix * xz ; gl_Position = xA ; wH = xB . c ; wG = xB . d ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:["eV","=","xz",";"]}]}}]},{type:"textline",b:"xv = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; xv = xB . a * xv ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"xw = xA . x ; xx = xA . y ; xy = xA . w ; eY . x = ( xw + xy ) / 2.0 ; eY . y = ( xx + xy ) / 2.0 ; eY . z = xy ; wI = xv ;".split(" ")}]}}]},{type:"textline",b:["gl_PointSize","=","xv",";","}"]}]};a["particles_texture.glslf"]=
{type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"var",name:"SOFT_STRENGTH",b:["1.0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float wH ; varying vec3 wG ; varying vec2 fd ; varying vec3 wF ; varying vec3 eU ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"textline",b:"void main ( ) { vec2 xv ; float xw , xx , xy ; vec3 xz , xA , xB , xC , xD , xE ; vec4 xF , xG ; xF = u_diffuse_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"xG = texture2D ( u_sampler , fd ) ; ed ( xG . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xF . rgb = mix ( xF . rgb , xG . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"xF . rgb *= mix ( vec3 ( 1.0 ) , xG . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"xF . a = xG . a ;".split(" ")}]}}]},{type:"textline",b:"xF . rgb *= wG ; xz = u_diffuse_intensity * xF . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"xA = u_emit * xF . rgb ; xB = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT",
"SKY_TEXTURE",{type:"logic_negative_expr",d:1},"SKY_COLOR",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"xC = u_environment_energy * hu ( vec3 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xC = u_environment_energy * hu ( xB ) ;".split(" ")}]}}]},{type:"textline",b:"xC = u_ambient * xC ; xw = u_specular_params [ 0 ] ; xv = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; xD = xw * u_specular_color ; xE = normalize ( wF ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"af xH = cN ( xA , xC , xz , xD , eU , xB , xE , xv , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"af xH = cS ( xA , xC , xz ) ;".split(" ")}]}}]},{type:"textline",b:"xC = xH . a . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["xC","=","xz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"x ( xC , length ( eV ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"xw = xF . a * wH ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"xx = - eV . z / u_view_max_depth ; xF = texture2DProj ( u_scene_depth , eY ) ; xy = k ( xF ) ; xx = xy - xx ; xx = u_view_max_depth / SOFT_STRENGTH * xx ; xw = xw * min ( xx , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["ef","(","xC",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ei ( xC , xw ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( xC , xw ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",
file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float wH ; varying vec3 wG ; varying vec2 fd ; varying vec3 wF ; varying vec3 eU ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","eV",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float xx ( vec2 xv , vec2 xw ) { return ( atan ( xw . y , xw . x ) - atan ( xv . y , xv . x ) ) ; } void main ( ) { vec4 xy , xz , xA ; mat4 xB ; float xC , xD , xE ; wJ xF ; xF = xu ( ) ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { xC = xF . e ; xB = tk ( xF . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { xC = xF . e ; xB = eF ( ) ; xB [ 3 ] = vec4 ( xF . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { xC = xF . e ; xB = eJ ( radians ( 90.0 ) ) ; xB [ 3 ] = vec4 ( xF . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { xC = xx ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + xF . e ; xB = eH ( radians ( - 90.0 ) ) ; xB [ 3 ] = vec4 ( xF . b , 1.0 ) ; } xy = vec4 ( a_p_bb_vertex * 2.0 * xF . a * u_p_size , 0.0 , 1.0 ) ; xy = xB * eL ( xC ) * xy ; xz = u_view_matrix * xy ; xA = u_proj_matrix * xz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"xC = xA . x ; xD = xA . y ; xE = xA . w ; eY . x = ( xC + xE ) / 2.0 ; eY . y = ( xD + xE ) / 2.0 ; eY . z = xE ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = xA ; wH = xF . c ; wG = xF . d ; fd = a_p_bb_vertex + 0.5 ; eU = xy . xyz ; wF = u_camera_eye - xy . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["eV","=","xz",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 xv ; const float xw = 0.99 ; const float xx = 1.8 ; const int xy = 8 ; float xE ( vec3 xz , vec3 xA ) { float xB , xC , xD ; xB = dot ( xA , xA ) ; xC = 2.0 * dot ( xA , xz ) ; xD = dot ( xz , xz ) - 1.0 ; xB = xC * xC - 4.0 * xB * xD ; xB = sqrt ( xB ) ; xB = ( - xC - xB ) / 2.0 ; xB = xD / xB ; return xB ; } float xL ( float xF , float xG ) { float xH , xI , xJ , xK ; xH = 3.0 * ( 1.0 - xG * xG ) ; xI = 2.0 * ( 2.0 + xG * xG ) ; xJ = 1.0 + xF * xF ; xK = pow ( 1.0 + xG * xG - 2.0 * xG * xF , 1.5 ) ; xK = max ( xK , 0.00001 ) ; return ( xH / xI ) * ( xJ / xK ) ; } float xR ( vec3 xM , vec3 xN , float xO ) { vec3 xP ; float xQ ; xQ = dot ( xN , - xM ) ; if ( xQ < 0.0 ) { return 1.0 ; } xP = xM + xQ * xN ; if ( length ( xP ) < xO ) { return 0.0 ; } else if ( length ( xP ) >= xO ) { xP = normalize ( xP ) * xO - xM ; xQ = acos ( dot ( normalize ( xP ) , xN ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( xQ * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 xV ( float xS , vec3 xT , float xU ) { return xT - xT * pow ( u_sky_color , vec3 ( xU / xS ) ) ; } void main ( ) { float xW , xX , xY , xZ , x_ , ya , yb , yc , yd ; vec3 ye , yf , yg , yh , yi , yj , yk ; ye = normalize ( xv ) ; yf = u_sun_direction ; xW = dot ( ye , yf ) ; xX = xL ( xW , - 0.01 ) * u_rayleigh_brightness * yf . y ; xY = xL ( xW - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - yf . y ) ; xW = smoothstep ( 0.0 , 100.0 , xL ( xW , 0.9995 ) ) * u_spot_brightness ; yg = vec3 ( 0.0 , xw , 0.0 ) ; xZ = xE ( yg , ye ) ; x_ = xZ / float ( xy ) ; ya = xR ( yg , ye , xw - 0.3 ) ; yh = vec3 ( 0.0 , 0.0 , 0.0 ) ; yi = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int yl = 0 ; yl < xy ; yl ++ ) { yb = x_ * float ( yl ) ; yj = yg + ye * yb ; yc = xR ( yj , yf , xw - 0.2 ) ; yd = xE ( yj , yf ) ; yk = xV ( yd , vec3 ( xx ) , u_scatter_strength ) * yc ; yh += xV ( sqrt ( yb ) , u_sky_color * yk , u_rayleigh_strength ) ; yi += xV ( yb , yk , u_mie_strength ) ; } yh = yh * ya * pow ( xZ , u_rayleigh_collection_power ) / float ( xy ) ; yi = ( yi * ya * pow ( xZ , u_mie_collection_power ) ) / float ( xy ) ; yh = vec3 ( xW * yi + xY * yi + xX * yh ) ; ef ( yh ) ; gl_FragColor = vec4 ( yh , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 xv ; void main ( ) { vec4 xw , xx ; xw = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; xx = u_cube_view_matrix * xw ; xv = xx . xyz ; gl_Position = xw ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 fd ; void main ( ) { vec4 xw ; xw = texture2D ( u_sampler , fd ) ; ef ( xw . rgb ) ; ei ( xw . rgb , xw . a ) ; gl_FragColor = xw ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 fd ; void main ( ) { vec2 xw ; float xx ; vec4 xy ; vec3 xz ; fd = a_texcoord ; xz = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; xy = u_proj_matrix * u_view_matrix * vec4 ( xz , 0.0 ) ; xy . x /= xy . w ; xy . y /= xy . w ; xy += 99999.0 * step ( xy . z , 0.0 ) ; xy += 100.0 * ( step ( 1.0 , abs ( xy . x ) ) + step ( 1.0 , abs ( xy . y ) ) ) ; xy . x = - a_lf_dist * xy . x ; xy . y = - a_lf_dist * xy . y ; xx = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; xw = vec2 ( a_lf_bb_vertex . x / xx , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float xA = 1.9 ; xw *= ( 1.0 + xA * length ( xy . xy ) ) ; } gl_Position = vec4 ( xy . xy + xw , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"define",name:"INV_PI",b:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["WO_SKYTEX","PROCEDURAL_SKYDOME",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky",";"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"blending.glslf"},{type:"textline",b:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ; vec3 zC ( vec3 zx , vec3 zy , float zz , float zA ) { float zB ; zB = zz * zA ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return xM ( zy , zx , zB ) ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","ADD",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return xQ ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SUBTRACT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return xU ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return xZ ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SCREEN",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"return yd ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","OVERLAY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yi ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ym ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIVIDE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"return yq ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DARKEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yu ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LIGHTEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yy ( zx , zy , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","HUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yE ( zy , zx , zB ) ;".split(" ")}]}},{type:"elif",
c:["BLENDTYPE","SATURATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yK ( zy , zx , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","VALUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yQ ( zy , zx , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","COLOR",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yW ( zy , zx , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"return za ( zy , zx , zB ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ze ( zy , zx , zB ) ;".split(" ")}]}}]},{type:"textline",b:"return vec3 ( 1.0 , 0.0 , 1.0 ) ; } float zK ( float zD , float zE , float zF , float zG ) { float zH ; vec3 zI , zJ ; zI = vec3 ( zD ) , zJ = vec3 ( zE ) ; zH = zF * zG ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","MIX",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return xM ( zJ , zI , zH ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","ADD",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return xQ ( zI , zJ , zH ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SUBTRACT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return xU ( zI , zJ , zH ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"return zk ( zD , zE , zH , zG ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SCREEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zq ( zD , zE , zH , zG ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","OVERLAY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zw ( zD , zE , zH , zG ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ym ( zI , zJ , zH ) . x ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","DIVIDE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yq ( zI , zJ , zH ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DARKEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yu ( zI , zJ , zH ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LIGHTEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yy ( zI , zJ , zH ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SOFT_LIGHT",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return za ( zJ , zI , zH ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ze ( zJ , zI , zH ) . x ;".split(" ")}]}}]},{type:"textline",b:["return","0.0",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","xv",";"]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",
d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 zL ; float zM , zN , zO ; vec3 zP , zQ , zR , zS , zT ; zQ = normalize ( xv ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME"],group:{type:"group",a:[{type:"textline",b:"zP = textureCube ( u_sky , zQ ) . rgb ;".split(" ")}]}},{type:"elif",c:["WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:"zP = u_horizon_color ; ef ( zP ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"textline",b:"zR = vec3 ( fd , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zR = vec3 ( xv . xy , 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:["zM","=","0.0",";"]},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"zM = abs ( fd . y ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zM = ( fd . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zN = acos ( zQ . y ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"zM = abs ( zN * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"zM = 1.0 - zN * INV_PI ;".split(" ")}]}}]}]}}]}]}}]},{type:"textline",b:"zS = u_horizon_color ; zT = u_zenith_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYTEX"],group:{type:"group",a:[{type:"textline",b:"zN = 1.0 ; zL = textureCube ( u_sky , zQ ) ; ed ( zL . rgb ) ; zN = zL . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"zN = dot ( zL . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["MTEX_NEGATIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"zL = vec4 ( vec3 ( 1.0 ) - zL . rgb , zL . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zN = 1.0 - zN ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ","WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"zL = vec4 ( u_sky_tex_color , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zN = zL . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ"],group:{type:"group",a:[{type:"textline",b:"zS = zC ( zL . rgb , zS , zN , u_sky_tex_fac [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:["zO","=","0.0",";"]},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( zR , vec3 ( 0.0 , 1.0 , 0.0 ) ) >= 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"zO = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",
b:"else zO = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"zO = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"elif",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",b:"zO = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( zO != 0.0 ) zT = zC ( zL . rgb , zT , zN , zO ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_BLEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"zN = dot ( zL . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},{type:"textline",b:"zM = zK ( u_sky_tex_dvar , zM , zN , u_sky_tex_fac [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"zP = mix ( zS , zT , zM ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["zP","=","zS",";"]}]}}]},{type:"textline",b:["ef","(","zP",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ef ( zS ) ; ef ( zT ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"zP = mix ( zS , zT , zM ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["zP","=","zS",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"REFLECTION_PASS",
{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"ed ( zP ) ; zM = u_camera_eye_frag . y - WATER_LEVEL ; zM = min ( - zM * 0.03 , 0.8 ) ; zN = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; zS = vec3 ( 0.0 ) ; zL = u_underwater_fog_color_density ; zL . rgb = mix ( zL . rgb , zS , min ( - zQ . y + zM , 1.0 ) ) * zN ; zM = clamp ( sign ( zQ . y - 0.05 * zM ) , 0.0 , 1.0 ) ; zP = mix ( zL . rgb , zP , zM ) ; ef ( zP ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( zP , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 xv ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 zx , zy ; zx = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; zy = u_sky_vp_inverse * zx ; xv = zy . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"fd = a_position . xy ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","zx",";","}"]}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",
b:["0.0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:["uniform","float","u_time",";"]},
{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","WATER_EFFECTS",{type:"logical_or_expr",
d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",
d:1},"PROCEDURAL_FOG",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",3,{type:"g_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float zx = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 wF ; varying vec3 eU ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH",{type:"logic_negative_expr",
d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 eX ; varying vec3 zy ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eW",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","zz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","zA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","zB",";"]}]}}]},{type:"include",file:"environment.glslf"},
{type:"condition",a:[{type:"if",c:["REFRACTIVE","SHORE_SMOOTHING","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 zN ( in vec2 zC , in vec3 zD , in vec3 zE , in vec3 zF , out float zG ) { float zH , zI , zJ ; vec2 zK ; vec3 zL , zM ; zG = 0.0 ; zL = reflect ( - zE , zD ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"zK = zC . xy + zD . xz * REFL_BUMP / eZ ; zG = u_reflect_factor ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zM = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zM = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"zH = dot ( zE , zD ) ; zG *= max ( 1.0 - 1.0 / zH , 1.0 ) ; } else { zM = texture2D ( u_plane_reflection , zK ) . rgb ; ed ( zM ) ; }".split(" ")}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zG = u_mirror_factor ; zM = zF * textureCube ( u_mirrormap , zL ) . rgb ; ed ( zM ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zG = u_reflect_factor ; zM = zF * vec3 ( 0.3 , 0.5 , 1.0 ) ; ed ( zM ) ;".split(" ")}]}}]},{type:"textline",b:"zL = normalize ( zL + zE ) ; zH = 1.0 - dot ( zE , zL ) ; zI = u_fresnel_params [ 3 ] ; zJ = u_fresnel_params [ 2 ] ; zJ = zI + ( 1.0 - zI ) * pow ( zH , zJ ) ; zG = min ( zG * zJ , 1.0 ) ; return zM ; } void main ( ) { vec4 zO ; vec2 zP , zQ , zR ; float zS , zT , zU , zV , zW , zX ; vec3 zY , zZ , z_ , Aa , Ab , Ac , Ad ; mat3 Ae ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ae = mat3 ( eX , zy , eW ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"zY = normalize ( eW ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zY = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","FOAM",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"zS = eU . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"zP = vec2 ( zz . x , - zz . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zP = vec2 ( eU . x , - eU . z ) + 0.5 ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["zP","=","fd",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zZ = vec3 ( 0.0 ) ; z_ = texture2D ( u_normalmap0 , zP * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; zZ += z_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"Aa = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["Aa","+=","z_",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"z_ = texture2D ( u_normalmap0 , zP * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; zZ += z_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",
a:[{type:"textline",b:["Aa","+=","z_",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"z_ = texture2D ( u_normalmap0 , zP * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; zZ += z_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["Aa","+=","z_",
";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"z_ = texture2D ( u_normalmap0 , zP * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; zZ += z_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["Aa","+=","z_",";"]}]}}]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"Aa = Ae * Aa ; if ( ! eo ( Aa , vec3 ( 0.0 ) ) ) Aa = normalize ( Aa ) ; Aa = mix ( zY , Aa , 0.2 ) ; Aa = normalize ( Aa ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"zY = mix ( zY , normalize ( Ae * zZ ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"zY = mix ( zY , normalize ( Ae * zZ ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"zY = normalize ( zY ) ;".split(" ")}]}}]},{type:"textline",b:"zZ = normalize ( wF ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zQ = eY . xy / eY . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",
d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zT = eZ * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"zU = u_diffuse_color . a ; zO = texture2DProj ( u_scene_depth , eY ) ; zV = k ( zO ) ; zW = max ( zV - eZ , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"zR = zQ + zY . xz * u_refr_bump / eZ ; zV = hA ( zV , zR , zQ ) ; zV = max ( zV - eZ , 0.0 ) ; zV = u_view_max_depth / ABSORB * zV ; if ( u_cam_water_depth < 0.0 ) zX = 0.0 ; else zX = min ( zU * zV , 1.0 ) ; zV = u_view_max_depth / ABSORB * zW ; zU = min ( 15.0 * zU * u_view_max_depth * zW , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"zV = u_view_max_depth / ABSORB * zW ; if ( u_cam_water_depth > 0.0 ) zU = min ( zU * zV , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"zU *= min ( 5.0 * zT , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zU = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"zX = 1.0 - zU ; zR = zQ + zY . xz * u_refr_bump / eZ ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"z_ = texture2D ( u_refractmap , zR ) . rgb ; ed ( z_ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"zV = pow ( min ( zA . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; Ab = mix ( u_shallow_water_col , u_diffuse_color . rgb , zV ) ; zV = pow ( min ( zA . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; Ab = mix ( u_shore_water_col , Ab , zV ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"Ab = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"zW = max ( 1.0 - u_view_max_depth * zW , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zW = 1.0 - zU ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",
b:"zS = max ( zS / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"Ac = normalize ( vec3 ( zA . r , 0.0 , zA . g ) ) ; Ac = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , Ac , 0.8 ) ) ; zV = 1.25 * max ( dot ( Aa , Ac ) - 0.2 , 0.0 ) ; zV += max ( dot ( Aa , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; zW += zV * ( 1.0 - zA . b ) ; zS *= ( 1.0 - 0.95 * pow ( zA . b , 0.1 ) ) ;".split(" ")}]}}]},{type:"textline",b:"zW += zS ; zW = min ( u_foam_factor * zW , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"zO = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + zP * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"zS = u_specular_params [ 0 ] ; zP = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; Aa = zS * u_specular_color ; Ac = u_environment_energy * hu ( zY ) ; Ac = u_ambient * Ac ; Ac = Ac + u_sun_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"Ad = zN ( zQ , zY , zZ , Ac , zS ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ad = zN ( vec2 ( 0.0 ) , zY , zZ , Ac , zS ) ;".split(" ")}]}}]},{type:"textline",b:"Ab = u_diffuse_intensity * Ab ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"af Af = cN ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ab , Aa , eU , zY , zZ , zP , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"af Af = cS ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ab ) ;".split(" ")}]}}]},{type:"textline",b:"Ab = Af . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"zV = max ( dot ( u_sun_direction , - eW ) + SSS_WIDTH , 0.0 ) * max ( dot ( - zZ , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; zV = clamp ( SSS_STRENGTH * zV , 0.0 , 1.0 ) ; Ab = mix ( Ab , u_shallow_water_col , zV ) ; Ab = mix ( Ab , u_shore_water_col , zV ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"Ab = mix ( z_ , Ab , zX ) ;".split(" ")}]}}]},{type:"textline",b:"Ab = mix ( Ab , Ad , zS ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"zS = mix ( zO . g , zO . r , max ( 4.0 * ( zW - 0.75 ) , 0.0 ) ) ; zS = mix ( zO . b , zS , max ( 2.0 * zW - 1.0 , 0.0 ) ) ; zS = mix ( 0.0 , zS , zW ) ; Ab = mix ( Ab , Ac , zS ) ;".split(" ")}]}}]},{type:"textline",
b:"Ab += Af . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"zZ = D ( u_cube_fog , zZ ) ; zO = vec4 ( zZ , u_fog_color_density . a ) ; ed ( zO . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["zO","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",
a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { ab ( Ab , zT , u_cam_water_depth , u_underwater_fog_color_density , clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ) ; } else { x ( Ab , zT , zO ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"x ( Ab , zT , zO ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["ef","(","Ab",")",";"]},{type:"condition",a:[{type:"if",c:["REFRACTIVE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",
b:"zU = max ( zU , Af . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["zU","+=","zS",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"ei ( Ab , zU ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"zZ = fwidth ( zB ) ; zZ = smoothstep ( vec3 ( 0.0 ) , zZ * zx , zB ) ; zS = min ( min ( zZ . x , zZ . y ) , zZ . z ) ; zS = clamp ( zS , 0.0 , 1.0 ) ; Ab = mix ( u_wireframe_edge_color , Ab , zS ) ; zU = mix ( 1.0 , zU , zS ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( Ab , zU ) ; }".split(" ")}]};a["special_water.glslv"]={type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",
b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},
{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"DYNAMIC",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_normal ; attribute vec3 a_tangent ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["GENERATED_MESH",{type:"logic_negative_expr",d:1},"NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",
"DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 wF ; varying vec3 eU ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},
"GENERATED_MESH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","fd",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 eX ; varying vec3 zy ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3",
"eW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","zz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","zA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",
{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","float","eZ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","zB",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 zG ( in vec2 zx ) { float zC ; vec4 zD ; vec2 zE ; zE = 0.5 + vec2 ( ( zx . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( zx . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; zD = texture2D ( u_shore_dist_map , zE ) ; const vec2 zF = vec2 ( 1.0 / 255.0 , 1.0 ) ; zC = dot ( zD . ba , zF ) ; zE = normalize ( zD . rg * 2.0 - 1.0 ) ; return vec3 ( zE , zC ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void zS ( inout vec3 zH , in float zI , in vec3 zJ ) { vec2 zK , zL , zM ; float zN , zO , zP , zQ , zR ; zN = dG ( DST_NOISE_SCALE_0 * ( zH . xz + DST_NOISE_FREQ_0 * zI ) ) * dG ( DST_NOISE_SCALE_1 * ( zH . zx - DST_NOISE_FREQ_1 * zI ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"zO = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; zP = zJ . b ; zQ = sqrt ( zP ) ; zO = max ( zP , DIR_MIN_SHR_FAC ) * sin ( zQ / zO + DIR_FREQ * zI ) ; zR = max ( dG ( DIR_NOISE_SCALE * ( zH . xz + DIR_NOISE_FREQ * zI ) ) , DIR_MIN_NOISE_FAC ) ; zO *= zR ; zQ = WAVES_HEIGHT * mix ( zO , zN , max ( zQ , DST_MIN_FAC ) ) ; zK = zJ . rg ; zO = WAVES_HOR_FAC * zO * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - zP ) , 0.0 ) ; zK = zO * zK ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"zQ = WAVES_HEIGHT * zN ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"zL = 2.0 * ( zH . xz - 0.1 * zI ) ; zM = 1.3 * ( zH . zx + 0.03 * zI ) ; zN = dj ( 0.5 * zL ) . x + dj ( 0.5 * zM ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"zH . xz += zK ; zN *= zP ;".split(" ")}]}}]},{type:"textline",b:"zQ += SMALL_WAVES_FAC * zN ;".split(" ")}]}}]},
{type:"textline",b:"zH . y += zQ ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec4 zT , zU ; vec2 zV ; float zW , zX , zY ; vec3 zZ , z_ , Aa , Ab ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) zB = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) zB = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) zB = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["zZ","=",
"a_position",";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"zW = abs ( zZ . y ) ; zV = u_camera_eye . xz - mod ( u_camera_eye . xz , zW ) ; zZ . y = WATER_LEVEL ; zZ . xz += zV ;".split(" ")}]}},{type:"elif",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["fd","=","a_texcoord",";"]}]}}]},{type:"textline",b:"el Ac = tT ( zZ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"zA = zG ( Ac . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"zX = length ( u_wind ) ; zY = u_time ; zY *= zX ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"zW = zW ; zZ = Ac . a + vec3 ( zW , 0.0 , 0.0 ) ; z_ = Ac . a + vec3 ( 0.0 , 0.0 , zW ) ; if ( a_position . y < 0.0 ) { Ac . a . y = WATER_LEVEL - 1.0 ; zZ . y = Ac . a . y ; z_ . y = Ac . a . y ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zz = Ac . a ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zZ = Ac . a + vec3 ( 0.05 , 0.0 , 0.0 ) ; z_ = Ac . a + vec3 ( 0.0 , 0.0 , 0.05 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"Aa = zG ( zZ . xz ) ; Ab = zG ( z_ . xz ) ; zS ( zZ , zY , Aa ) ; zS ( z_ , zY , Ab ) ; zS ( Ac . a , zY , zA ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"zS ( zZ , zY , vec3 ( 0.0 ) ) ; zS ( z_ , zY , vec3 ( 0.0 ) ) ; zS ( Ac . a , zY , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"zZ = normalize ( zZ - Ac . a ) ; z_ = normalize ( z_ - Ac . a ) ; eW = normalize ( cross ( z_ , zZ ) ) ; zY = dot ( eW , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; zY = clamp ( 0.8 - zY , 0.0 , 1.0 ) ; eW = mix ( eW , vec3 ( 0.0 , 1.0 , 0.0 ) , zY ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"z_ = a_tangent ; eW = a_normal ;".split(" ")}]}}]},{type:"textline",b:"eX = z_ ; zy = cross ( eW , eX ) ;".split(" ")}]}}]},{type:"textline",b:"eU = Ac . a ; wF = u_camera_eye - Ac . a ; zT = u_view_matrix * vec4 ( Ac . a , 1.0 ) ; zU = u_proj_matrix * zT ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"zY = zU . x ; zW = zU . y ; zX = zU . w ; eY . x = ( zY + zX ) / 2.0 ; eY . y = ( zW + zX ) / 2.0 ; eY . z = zX ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"eZ = - zT . z / u_view_max_depth ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","zU",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 zB ; const float zx = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 zC = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 zC = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 zD = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 zE = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 zF = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float zG , zH ; vec3 zI , zJ ; zI = vec3 ( 0.0 ) ; zG = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"zJ = sign ( zB - vec3 ( 0.02 * zx ) ) ; if ( zJ . x < 0.0 || zJ . y < 0.0 || zJ . z < 0.0 ) { zI = zC ; zG = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY",0,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zJ = sign ( zB - vec3 ( 0.02 * zx ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( zJ . x < 0.0 || zJ . y < 0.0 || zJ . z < 0.0 ) zI = u_wireframe_edge_color ; else zI = zF ; zG = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( zJ . x < 0.0 || zJ . y < 0.0 || zJ . z < 0.0 ) zG = 1.0 ; else zG = 0.0 ; zI = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( zJ . x < 0.0 || zJ . y < 0.0 || zJ . z < 0.0 ) zI = u_wireframe_edge_color ; else if ( gl_FrontFacing ) zI = zD ; else zI = zE ; zG = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY",1,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"zJ = fwidth ( zB ) ; zJ = smoothstep ( vec3 ( 0.0 ) , zJ * zx , zB ) ; zH = min ( min ( zJ . x , zJ . y ) , zJ . z ) ; zH = clamp ( zH , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { zI = vec3 ( mix ( u_wireframe_edge_color , zF , zH ) ) ; zG = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { zI = u_wireframe_edge_color ; zG = mix ( 1.0 , 0.0 , zH ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) zI = mix ( u_wireframe_edge_color , zD , zH ) ; else zI = mix ( u_wireframe_edge_color , zE , zH ) ; zG = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["ef","(","zI",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"ei ( zI , zG ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( zI , zG ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},
{type:"textline",b:["varying","vec3","zB",";"]},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 zx ; mat4 zC ; vec3 zD , zE , zF , zG , zH ; if ( a_polyindex == 0.0 ) zB = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) zB = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) zB = vec3 ( 0.0 , 0.0 , 1.0 ) ; zD = a_position ; zE = a_normal ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"el zI = tT ( zD , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"zD = mix ( zD , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"zF = vec3 ( 0.0 ) ; zG = vec3 ( 0.0 ) ; uT ( zD , zF , zG , zE ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["zG","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zG = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"el zI = wr ( zD , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , zG , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"zF = ( u_model_matrix * vec4 ( zG , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zC = tM ( u_camera_eye , zF , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"zC = tG ( u_camera_eye , zF , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zH = ( u_model_matrix * vec4 ( zG , 1.0 ) ) . xyz ; zC = zC * ty ( u_wind , u_time , u_jitter_amp , u_jitter_freq , zH ) ;".split(" ")}]}}]},{type:"textline",b:"el zI = tT ( zD - zG , zG , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , zC ) ; zI . b = zF ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"el zI = tT ( zD , zG , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"vH ( zI . a , zI . b , zE ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"zx = u_view_matrix * vec4 ( zI . a , 1.0 ) ; gl_Position = u_proj_matrix * zx ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",
b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 fd ; void main ( ) { vec4 zx , zC ; zx = texture2D ( u_sampler_left , fd ) ; zC = texture2D ( u_sampler_right , fd ) ; gl_FragColor = vec4 ( zx [ 0 ] , zC [ 1 ] , zC [ 2 ] , zx [ 3 ] + zC [ 3 ] ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},
{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 fd ; vec4 zE ( float zx , float zC ) { vec2 zD ; zD = fd + vec2 ( zx , zC ) * u_texel_size ; return texture2D ( u_color , zD ) ; } float zI ( vec4 zF ) { float zG ; vec3 zH ; zH = vec3 ( 0.299 , 0.587 , 0.114 ) ; zG = dot ( zF . rgb , zH ) ; return zG ; } vec4 zV ( ) { vec2 zJ ; float zK , zL , zM , zN , zO , zP ; vec4 zQ , zR , zS , zT , zU ; zQ = zE ( - 1.0 , - 1.0 ) ; zR = zE ( 1.0 , - 1.0 ) ; zS = zE ( - 1.0 , 1.0 ) ; zT = zE ( 1.0 , 1.0 ) ; zU = zE ( 0.0 , 0.0 ) ; zK = zI ( zQ ) ; zL = zI ( zR ) ; zM = zI ( zS ) ; zN = zI ( zT ) ; zO = zI ( zU ) ; zP = min ( zO , min ( min ( zK , zL ) , min ( zM , zN ) ) ) ; zO = max ( zO , max ( max ( zK , zL ) , max ( zM , zN ) ) ) ; zJ . x = - ( ( zK + zL ) - ( zM + zN ) ) ; zJ . y = ( ( zK + zM ) - ( zL + zN ) ) ; zN = max ( ( zK + zL + zM + zN ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; zN = 1.0 / ( min ( abs ( zJ . x ) , abs ( zJ . y ) ) + zN ) ; zJ = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , zJ * zN ) ) * u_texel_size ; zU = 0.5 * ( texture2D ( u_color , fd + zJ * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , fd + zJ * ( 2.0 / 3.0 - 0.5 ) ) ) ; zT = zU * 0.5 + 0.25 * ( texture2D ( u_color , fd + zJ * - 0.5 ) + texture2D ( u_color , fd + zJ * 0.5 ) ) ; zN = zI ( zT ) ; if ( ( zN < zP ) || ( zN > zO ) ) return zU ; else return zT ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 Az ( ) { bool zW , zX , zY , zZ , z_ ; float Aa , Ab , Ac , Ad , Ae , Af , Ag , Ah , Ai , Aj , Ak , Al , Am , An , Ao ; vec4 Ap , Aq , Ar , As , At ; vec2 Au , Av , Aw , Ax , Ay ; Au . x = fd . x ; Au . y = fd . y ; Ap = texture2D ( u_color , Au ) ; Aq = zE ( 0.0 , 1.0 ) ; Ar = zE ( 1.0 , 0.0 ) ; As = zE ( 0.0 , - 1.0 ) ; At = zE ( - 1.0 , 0.0 ) ; Aa = zI ( Aq ) ; Ab = zI ( Ar ) ; Ac = zI ( As ) ; Ad = zI ( At ) ; Ae = zI ( Ap ) ; Af = max ( Aa , Ae ) ; Ag = min ( Aa , Ae ) ; Af = max ( Ab , Af ) ; Ag = min ( Ab , Ag ) ; Ah = max ( Ac , Ad ) ; Ai = min ( Ac , Ad ) ; Af = max ( Ah , Af ) ; Ag = min ( Ai , Ag ) ; Ai = Af * FXAA_QUALITY_EDGE_THRESHOLD ; Ag = Af - Ag ; Ai = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , Ai ) ; zW = Ag < Ai ; if ( zW ) return Ap ; Ap = zE ( - 1.0 , - 1.0 ) ; At = zE ( 1.0 , 1.0 ) ; As = zE ( 1.0 , - 1.0 ) ; Ar = zE ( - 1.0 , 1.0 ) ; Ai = zI ( Ap ) ; Af = zI ( At ) ; Ah = zI ( As ) ; Aj = zI ( Ar ) ; Ak = Ac + Aa ; Al = Ad + Ab ; Ag = 1.0 / Ag ; Am = Ak + Al ; Ak = ( - 2.0 * Ae ) + Ak ; Al = ( - 2.0 * Ae ) + Al ; An = Ah + Af ; Ah = Ai + Ah ; Ao = ( - 2.0 * Ab ) + An ; Ah = ( - 2.0 * Ac ) + Ah ; Ai = Ai + Aj ; Af = Aj + Af ; Ao = ( abs ( Ak ) * 2.0 ) + abs ( Ao ) ; Ah = ( abs ( Al ) * 2.0 ) + abs ( Ah ) ; Al = ( - 2.0 * Ad ) + Ai ; Af = ( - 2.0 * Aa ) + Af ; Ao = abs ( Al ) + Ao ; Ah = abs ( Af ) + Ah ; An = Ai + An ; Ai = u_texel_size . x ; zW = Ao >= Ah ; An = Am * 2.0 + An ; if ( ! zW ) Ac = Ad ; if ( ! zW ) Aa = Ab ; if ( zW ) Ai = u_texel_size . y ; An = ( An * ( 1.0 / 12.0 ) ) - Ae ; Ab = Ac - Ae ; Ad = Aa - Ae ; Ac = Ac + Ae ; Aa = Aa + Ae ; zX = abs ( Ab ) >= abs ( Ad ) ; Ad = max ( abs ( Ab ) , abs ( Ad ) ) ; if ( zX ) Ai = - Ai ; Ag = clamp ( abs ( An ) * Ag , 0.0 , 1.0 ) ; Av . x = Au . x ; Av . y = Au . y ; Aw . x = ( ! zW ) ? 0.0 : u_texel_size . x ; Aw . y = ( zW ) ? 0.0 : u_texel_size . y ; if ( ! zW ) Av . x += Ai * 0.5 ; if ( zW ) Av . y += Ai * 0.5 ; Ax . x = Av . x - Aw . x ; Ax . y = Av . y - Aw . y ; Ay . x = Av . x + Aw . x ; Ay . y = Av . y + Aw . y ; An = ( ( - 2.0 ) * Ag ) + 3.0 ; Ab = zI ( texture2D ( u_color , Ax ) ) ; Ag = Ag * Ag ; Am = zI ( texture2D ( u_color , Ay ) ) ; if ( ! zX ) Ac = Aa ; Ad = Ad * 1.0 / 4.0 ; Ae = Ae - Ac * 0.5 ; Ag = An * Ag ; zX = Ae < 0.0 ; Ab -= Ac * 0.5 ; Am -= Ac * 0.5 ; zY = abs ( Ab ) >= Ad ; zZ = abs ( Am ) >= Ad ; if ( ! zY ) Ax . x -= Aw . x * 1.5 ; if ( ! zY ) Ax . y -= Aw . y * 1.5 ; z_ = ( ! zY ) || ( ! zZ ) ; if ( ! zZ ) Ay . x += Aw . x * 1.5 ; if ( ! zZ ) Ay . y += Aw . y * 1.5 ; if ( z_ ) { if ( ! zY ) Ab = zI ( texture2D ( u_color , Ax . xy ) ) ; if ( ! zZ ) Am = zI ( texture2D ( u_color , Ay . xy ) ) ; if ( ! zY ) Ab = Ab - Ac * 0.5 ; if ( ! zZ ) Am = Am - Ac * 0.5 ; zY = abs ( Ab ) >= Ad ; zZ = abs ( Am ) >= Ad ; if ( ! zY ) Ax . x -= Aw . x * 2.0 ; if ( ! zY ) Ax . y -= Aw . y * 2.0 ; z_ = ( ! zY ) || ( ! zZ ) ; if ( ! zZ ) Ay . x += Aw . x * 2.0 ; if ( ! zZ ) Ay . y += Aw . y * 2.0 ; if ( z_ ) { if ( ! zY ) Ab = zI ( texture2D ( u_color , Ax . xy ) ) ; if ( ! zZ ) Am = zI ( texture2D ( u_color , Ay . xy ) ) ; if ( ! zY ) Ab = Ab - Ac * 0.5 ; if ( ! zZ ) Am = Am - Ac * 0.5 ; zY = abs ( Ab ) >= Ad ; zZ = abs ( Am ) >= Ad ; if ( ! zY ) Ax . x -= Aw . x * 2.0 ; if ( ! zY ) Ax . y -= Aw . y * 2.0 ; z_ = ( ! zY ) || ( ! zZ ) ; if ( ! zZ ) Ay . x += Aw . x * 2.0 ; if ( ! zZ ) Ay . y += Aw . y * 2.0 ; if ( z_ ) { if ( ! zY ) Ab = zI ( texture2D ( u_color , Ax . xy ) ) ; if ( ! zZ ) Am = zI ( texture2D ( u_color , Ay . xy ) ) ; if ( ! zY ) Ab = Ab - Ac * 0.5 ; if ( ! zZ ) Am = Am - Ac * 0.5 ; zY = abs ( Ab ) >= Ad ; zZ = abs ( Am ) >= Ad ; if ( ! zY ) Ax . x -= Aw . x * 4.0 ; if ( ! zY ) Ax . y -= Aw . y * 4.0 ; z_ = ( ! zY ) || ( ! zZ ) ; if ( ! zZ ) Ay . x += Aw . x * 4.0 ; if ( ! zZ ) Ay . y += Aw . y * 4.0 ; if ( z_ ) { if ( ! zY ) Ab = zI ( texture2D ( u_color , Ax . xy ) ) ; if ( ! zZ ) Am = zI ( texture2D ( u_color , Ay . xy ) ) ; if ( ! zY ) Ab = Ab - Ac * 0.5 ; if ( ! zZ ) Am = Am - Ac * 0.5 ; zY = abs ( Ab ) >= Ad ; zZ = abs ( Am ) >= Ad ; if ( ! zY ) Ax . x -= Aw . x * 2.0 ; if ( ! zY ) Ax . y -= Aw . y * 2.0 ; if ( ! zZ ) Ay . x += Aw . x * 2.0 ; if ( ! zZ ) Ay . y += Aw . y * 2.0 ; } } } } Ad = Au . x - Ax . x ; Ac = Ay . x - Au . x ; if ( ! zW ) Ad = Au . y - Ax . y ; if ( ! zW ) Ac = Ay . y - Au . y ; zZ = ( Ab < 0.0 ) != zX ; Ab = ( Ac + Ad ) ; zX = ( Am < 0.0 ) != zX ; Ab = 1.0 / Ab ; zY = Ad < Ac ; Ac = min ( Ad , Ac ) ; zX = zY ? zZ : zX ; Ag = Ag * Ag ; Ab = ( Ac * ( - Ab ) ) + 0.5 ; Ag = Ag * FXAA_QUALITY_SUBPIX ; Ab = zX ? Ab : 0.0 ; Ag = max ( Ab , Ag ) ; if ( ! zW ) Au . x += Ag * Ai ; if ( zW ) Au . y += Ag * Ai ; return texture2D ( u_color , Au ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_PASS",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , fd ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{type:"equal_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"gl_FragColor = zV ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = Az ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , fd ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 fd ; void main ( ) { vec4 zx ; vec2 zC , zD ; zC = vec2 ( 0.0 , 0.0 ) ; zD = u_texel_size ; zx = texture2D ( u_color , fd ) ; gl_FragColor = zx * 0.0875447373698 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0858112354248 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0808139781061 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0731235112908 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0635705267419 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0530985673112 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0426125984122 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0328565115809 ; zC += zD ; gl_FragColor += texture2D ( u_color , fd + zC ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , fd - zC ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * zx , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 fd ; void main ( ) { vec4 zx , zC ; zx = texture2D ( u_main , fd ) ; zC = texture2D ( u_bloom , fd ) ; zx = zx ; zx += zC ; gl_FragColor = vec4 ( zx . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 fd ; void main ( ) { float zx ; vec3 zC , zD ; vec4 zE ; zE = texture2D ( u_color , fd ) ; zC = zE . rgb ; if ( u_brightness < 0.0 ) zC = zC * ( 1.0 + u_brightness ) ; else zC = zC + ( ( 1.0 - zC ) * u_brightness ) ; zC = ( zC - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; zC *= u_exposure ; zD = vec3 ( 0.299 , 0.587 , 0.114 ) ; zx = dot ( zC , zD ) ; zC = mix ( vec3 ( zx ) , zC , u_saturation ) ; gl_FragColor = vec4 ( zC , zE . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 fd ; void main ( ) { gl_FragColor = g ( clamp ( zI ( u_depth , fd , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]=
{type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 fd ; void main ( ) { float zx , zJ ; vec4 zK , zL ; zK = texture2D ( u_sharp , fd ) ; if ( u_dof_dist > 0.0 ) { zx = zI ( u_depth , fd , u_camera_range ) ; zx *= u_view_max_depth ; if ( zx < u_dof_dist ) zJ = ( u_dof_dist - zx ) / u_dof_front ; else zJ = ( zx - u_dof_dist ) / u_dof_rear ; zJ = clamp ( zJ , 0.0 , 1.0 ) ; zL = texture2D ( u_blurred , fd ) ; gl_FragColor = mix ( zK , zL , zJ ) ; } else gl_FragColor = zK ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_src_color ; uniform sampler2D u_glow_mask_small ; uniform sampler2D u_glow_mask_large ; uniform float u_glow_mask_small_coeff ; uniform float u_glow_mask_large_coeff ; varying vec2 fd ; void main ( ) { float zx ; vec4 zJ , zK , zL ; zJ = texture2D ( u_src_color , fd ) ; zK = texture2D ( u_glow_mask_small , fd ) ; zL = texture2D ( u_glow_mask_large , fd ) ; gl_FragColor = zJ ; if ( zL . a != 0.0 ) { zx = u_glow_mask_large_coeff * zL . a ; zx = clamp ( zx , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , zL . rgb / zL . a , zx ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , zx ) ; } if ( zK . a != 0.0 ) { zx = u_glow_mask_small_coeff * zK . a ; zx = clamp ( zx , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , zK . rgb / zK . a , zx ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , zx ) ; } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float zJ ; varying vec2 zK ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 fd ; varying vec4 zL ; void main ( ) { vec4 zM ; float zN , zO , zP , zQ , zR ; vec2 zS , zT , zU ; zS = ( zL . xy - fd ) ; zN = length ( zS ) ; zS = u_radial_blur_step * zS / zN ; zO = zN / u_radial_blur_step ; zS *= min ( zO , STEPS_PER_PASS ) / STEPS_PER_PASS ; zO = max ( zO , STEPS_PER_PASS ) ; zT = fd ; zP = 0.0 ; for ( float zV = 0.0 ; zV < STEPS_PER_PASS ; zV += 1.0 ) { if ( zV <= zO ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"zQ = zI ( u_input , zT , u_camera_range ) ; zP += max ( ( 1.0 - pow ( zN , 0.3 ) ) * step ( 0.9 , zQ ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"zM = texture2D ( u_input , zT ) ; zP += k ( zM ) ;".split(" ")}]}}]},{type:"textline",b:"} zT += zS ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"zU = fd + zK ; zR = dj ( vec2 ( 2.5 * ( zU . x ) , 2.5 * ( zU . y ) + 1.0 * u_time ) ) . x + 0.75 * dj ( vec2 ( 5.0 * ( zU . x ) - 0.66 * u_time , 5.0 * ( zU . y ) + 0.66 * u_time ) ) . x + 0.5 * dG ( vec2 ( 7.5 * ( zU . x ) + 0.33 * u_time , 7.5 * ( zU . y ) - 0.33 * u_time ) ) ; zR *= clamp ( 1.2 - sqrt ( 0.2 * zN ) , 0.0 , 1.0 ) * zJ ; zP = max ( zR , zP ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = g ( zP / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"include",file:"math.glslv"},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float zJ ; varying vec2 zK ;".split(" ")}]}}]}]}}]},{type:"textline",
b:"varying vec2 fd ; varying vec4 zL ; void main ( ) { float zx , zM ; vec3 zN ; fd = a_bb_vertex + 0.5 ; zN = normalize ( u_sun_direction ) ; zL = u_proj_matrix * u_view_matrix * vec4 ( zN , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { zJ = 1.0 ; zN = vec3 ( 0.0 , 1.0 , 0.0 ) ; zN = er ( u_camera_quat , zN ) ; zN = normalize ( zN ) ; zx = dot ( zN , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; zM = atan ( zN . x , zN . z ) ; zK = vec2 ( - zM , acos ( zx ) ) ; } else { zJ = 0.0 ; }".split(" ")}]}}]},
{type:"textline",b:"zL . xy = 0.5 * ( zL . xy / zL . w + 1.0 ) ; zL += 99999.0 * step ( zL . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 fd ; void main ( ) { float zx ; vec3 zM ; vec4 zN ; zN = texture2D ( u_main , fd ) ; zM = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; ed ( zN . rgb ) ; zx = k ( texture2D ( u_god_rays , fd ) ) ; zM = zN . rgb + u_god_rays_intensity * vec3 ( zx ) * zM ; ef ( zM ) ; gl_FragColor . rgb = zM ; gl_FragColor . a = zN . a ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 fd ; void main ( ) { float zx ; vec4 zM ; zM = texture2D ( u_input , fd ) ; zx = dot ( zM . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( zx ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float zx , zM ; zM = 0.0 ; for ( float zN = 0.025 ; zN < 1.0 ; zN += 0.05 ) for ( float zO = 0.025 ; zO < 1.0 ; zO += 0.05 ) { zx = max ( texture2D ( u_input , vec2 ( zN , zO ) ) . r , 0.01 ) ; zM += log ( zx ) ; } zM = exp ( zM / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( zM ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 fd ; varying float zM ; void main ( ) { vec4 zN ; float zO , zP ; zO = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; zP = texture2D ( u_luminance , fd ) . r ; zN = texture2D ( u_main , fd ) ; zO = zP / zO ; zP = u_bloom_edge_lum ; gl_FragColor = zN * max ( zO - zP , 0.0 ) * zM ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 fd ; varying float zM ; const vec3 zx = vec3 ( 0.0 , 1.0 , 0.0 ) ; void zU ( in vec4 zN , in vec3 zO , out vec3 zP ) { float zQ , zR , zS , zT ; zQ = zN . w * zO . x + zN . y * zO . z - zN . z * zO . y ; zR = zN . w * zO . y + zN . z * zO . x - zN . x * zO . z ; zS = zN . w * zO . z + zN . x * zO . y - zN . y * zO . x ; zT = - zN . x * zO . x - zN . y * zO . y - zN . z * zO . z ; zP . x = zQ * zN . w - zT * zN . x - zR * zN . z + zS * zN . y ; zP . y = zR * zN . w - zT * zN . y - zS * zN . x + zQ * zN . z ; zP . z = zS * zN . w - zT * zN . z - zQ * zN . y + zR * zN . x ; } void main ( ) { vec3 zV ; fd = 2.0 * a_position ; zU ( u_camera_quat , zx , zV ) ; zM = dot ( - zV , u_sun_direction ) * u_bloom_key ; zM *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; uniform float u_motion_blur_decay_threshold ; varying vec2 fd ; float zx = 0.0042 ; void main ( ) { vec4 zN , zO , zP , zQ ; zN = texture2D ( u_mb_tex_curr , fd ) ; zO = texture2D ( u_mb_tex_accum , fd ) ; if ( length ( zN - zO ) > u_motion_blur_decay_threshold ) { zP = ( 1.0 - u_motion_blur_exp ) * zN + u_motion_blur_exp * zO ; zP = zP - zO ; zQ = zN - zO ; zP = min ( max ( abs ( zP ) , vec4 ( zx ) ) , abs ( zQ ) ) * sign ( zP ) ; gl_FragColor = zO + zP ; } else { gl_FragColor = zN ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 fd ; void main ( ) { vec3 zx ; float zN ; vec4 zO , zP , zQ ; zO = texture2D ( u_outline_src , fd ) ; gl_FragColor = zO ; if ( u_draw_outline != 0.0 ) { zP = texture2D ( u_outline_mask , fd ) ; zQ = texture2D ( u_outline_mask_blurred , fd ) ; zN = zQ . a - zP . a ; if ( zN != 0.0 ) { zN = smoothstep ( 0.0 , 1.0 , zQ . a ) ; if ( zP . a == 0.0 ) { zx = u_outline_color ; ef ( zx ) ; zP = vec4 ( clamp ( zx , 0.0 , 1.0 ) , 1.0 ) ; gl_FragColor = mix ( zO , zP , zN ) ; } } } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 fd ; void main ( ) { vec2 zx , zN ; vec4 zO ;".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","POST_EFFECT_NONE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , fd ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","POST_EFFECT_GRAYSCALE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zO = texture2D ( u_color , fd ) ; gl_FragColor . rgb = vec3 ( ( zO . r + zO . g + zO . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_BLUR",
{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_BLUR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zx = vec2 ( 0.0 , 0.0 ) ; zN = u_texel_size ; zO = texture2D ( u_color , fd ) ; gl_FragColor = zO * 0.2270270270 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * 0.1945945946 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * 0.1945945946 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * 0.1216216216 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * 0.1216216216 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * 0.0540540541 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * 0.0540540541 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * 0.0162162162 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_GLOW_BLUR",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zx = vec2 ( 0.0 , 0.0 ) ; zN = u_texel_size ; zO = texture2D ( u_color , fd ) ; gl_FragColor = zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.152507 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.141763 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.141763 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.113861 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.113861 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.079019 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.079019 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.047383 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.047383 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.024549 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.024549 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.01099 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.01099 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.00425 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.00425 ; zx += zN ; zO = texture2D ( u_color , fd + zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.00142 ; zO = texture2D ( u_color , fd - zx ) ; gl_FragColor += zO * ( 1.0 - step ( 0.0 , - zO . a ) ) * 0.00142 ; gl_FragColor = clamp ( gl_FragColor , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_EXTEND",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_EXTEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zN = u_texel_size ; zO = texture2D ( u_color , fd ) ; gl_FragColor = zO ; if ( zO . a == 0.0 ) { zO = texture2D ( u_color , fd + zN ) ; if ( zO . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , zO . a ) ; else { zO = texture2D ( u_color , fd - zN ) ; if ( zO . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , zO . a ) ; } }".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; varying vec2 fd ; void main ( ) { fd = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",
name:"SMAA_EDGE_DETECTION",b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",d:2},"SMAA_PREDICATION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 fd ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","zN",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 zO ; varying vec4 zP ; varying vec4 zQ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","zR",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",
b:["1"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",
name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},
{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},
{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 zX ( vec2 zS , sampler2D zT ) { float zU , zV , zW ; zU = texture2D ( zT , zS ) . r ; zV = texture2D ( zT , zO . xy ) . r ; zW = texture2D ( zT , zO . zw ) . r ; return vec3 ( zU , zV , zW ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 Ab ( vec2 zY , sampler2D zZ ) { vec2 z_ ; vec3 Aa ; Aa = zX ( zY , zZ ) ; z_ = abs ( Aa . xx - Aa . yz ) ; z_ = step ( SMAA_PREDICATION_THRESHOLD , z_ ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * z_ ) ; }".split(" ")}]}}]},
{type:"textline",b:"void Af ( bvec2 Ac , inout vec2 Ad , vec2 Ae ) { if ( Ac . x ) Ad . x = Ae . x ; if ( Ac . y ) Ad . y = Ae . y ; } void Af ( bvec4 Ag , inout vec4 Ah , vec4 Ai ) { Af ( Ag . xy , Ah . xy , Ai . xy ) ; Af ( Ag . zw , Ah . zw , Ai . zw ) ; } vec2 Ak ( vec2 Aj ) { return sign ( Aj ) * floor ( abs ( Aj ) + .5 ) ; } vec4 Ak ( vec4 Al ) { return sign ( Al ) * floor ( abs ( Al ) + .5 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 Ay ( vec2 Am , sampler2D An".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","Ao"]}]}}]},{type:"textline",b:") { vec4 Ap ; float Aq , Ar , As , At , Au ; vec3 Av ; vec2 Aw , Ax ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"Aw = Ab ( Am , Ao ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"Aw = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"Av = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; Aq = dot ( texture2D ( An , Am ) . rgb , Av ) ; Ar = dot ( texture2D ( An , zO . xy ) . rgb , Av ) ; As = dot ( texture2D ( An , zO . zw ) . rgb , Av ) ; Ap . xy = abs ( Aq - vec2 ( Ar , As ) ) ; Aw = step ( Aw , Ap . xy ) ; if ( dot ( Aw , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; At = dot ( texture2D ( An , zP . xy ) . rgb , Av ) ; Au = dot ( texture2D ( An , zP . zw ) . rgb , Av ) ; Ap . zw = abs ( Aq - vec2 ( At , Au ) ) ; Ax = max ( Ap . xy , Ap . zw ) ; Au = dot ( texture2D ( An , zQ . xy ) . rgb , Av ) ; At = dot ( texture2D ( An , zQ . zw ) . rgb , Av ) ; Ap . zw = abs ( vec2 ( Ar , As ) - vec2 ( Au , At ) ) ; Ax = max ( Ax . xy , Ap . zw ) ; At = max ( Ax . x , Ax . y ) ; Aw . xy *= step ( At , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * Ap . xy ) ; return Aw ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vec2 AA ( vec2 Az ) { Az . r = Az . r * abs ( 5.0 * Az . r - 5.0 * 0.75 ) ; return Ak ( Az ) ; } vec4 AA ( vec4 AB ) { AB . rb = AB . rb * abs ( 5.0 * AB . rb - 5.0 * 0.75 ) ; return Ak ( AB ) ; } vec2 AJ ( sampler2D AC , vec2 AD , vec2 AE , out vec2 AF ) { vec3 AG ; vec4 AH ; AH = vec4 ( AD , - 1.0 , 1.0 ) ; AG = vec3 ( u_texel_size , 1.0 ) ; for ( int AI = 0 ; AI < SMAA_MAX_SEARCH_STEPS_DIAG ; AI ++ ) { if ( AH . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && AH . w > 0.9 ) { AH . xyz += AG * vec3 ( AE , 1.0 ) ; AF = texture2D ( AC , AH . xy , 0.0 ) . rg ; AH . w = dot ( AF , vec2 ( 0.5 , 0.5 ) ) ; } } return AH . zw ; } vec2 AR ( sampler2D AK , vec2 AL , vec2 AM , out vec2 AN ) { vec3 AO ; vec4 AP ; AP = vec4 ( AL , - 1.0 , 1.0 ) ; AP . x += 0.25 * u_texel_size . x ; AO = vec3 ( u_texel_size , 1.0 ) ; for ( int AQ = 0 ; AQ < SMAA_MAX_SEARCH_STEPS_DIAG ; AQ ++ ) { if ( AP . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && AP . w > 0.9 ) { AP . xyz = AO * vec3 ( AM , 1.0 ) + AP . xyz ; AN = texture2D ( AK , AP . xy , 0.0 ) . rg ; AN = AA ( AN ) ; AP . w = dot ( AN , vec2 ( 0.5 , 0.5 ) ) ; } } return AP . zw ; } vec2 AX ( sampler2D AS , vec2 AT , vec2 AU , float AV ) { vec2 AW ; AW = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * AU + AT ; AW = SMAA_AREATEX_PIXEL_SIZE * AW + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; AW . x += 0.5 ; AW . y += SMAA_AREATEX_SUBTEX_SIZE * AV ; return texture2D ( AS , AW , 0.0 ) . rg ; } vec2 Bi ( sampler2D AY , sampler2D AZ , vec2 A_ , vec2 Ba , vec4 Bb ) { vec4 Bc , Bd , Be ; vec2 Bf , Bg , Bh ; Bf = vec2 ( 0.0 , 0.0 ) ; if ( Ba . r > 0.0 ) { Bc . xz = AJ ( AY , A_ , vec2 ( - 1.0 , 1.0 ) , Bg ) ; Bc . x += float ( Bg . y > 0.9 ) ; } else Bc . xz = vec2 ( 0.0 , 0.0 ) ; Bc . yw = AJ ( AY , A_ , vec2 ( 1.0 , - 1.0 ) , Bg ) ; if ( Bc . x + Bc . y > 2.0 ) { Bd = vec4 ( - Bc . x + 0.25 , Bc . x , Bc . y , - Bc . y - 0.25 ) * u_texel_size . xyxy + A_ . xyxy ; Be . xy = texture2D ( AY , Bd . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; Be . zw = texture2D ( AY , Bd . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; Be . yxwz = AA ( Be . xyzw ) ; Bh = vec2 ( 2.0 , 2.0 ) * Be . xz + Be . yw ; Af ( bvec2 ( step ( 0.9 , Bc . zw ) ) , Bh , vec2 ( 0.0 , 0.0 ) ) ; Bf += AX ( AZ , Bc . xy , Bh , Bb . z ) ; } Bc . xz = AR ( AY , A_ , vec2 ( - 1 , - 1 ) , Bg ) ; if ( texture2D ( AY , A_ + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { Bc . yw = AR ( AY , A_ , vec2 ( 1 , 1 ) , Bg ) ; Bc . y += float ( Bg . y > 0.9 ) ; } else Bc . yw = vec2 ( 0.0 , 0.0 ) ; if ( Bc . x + Bc . y > 2.0 ) { Be = vec4 ( - Bc . x , - Bc . x , Bc . y , Bc . y ) * u_texel_size . xyxy + A_ . xyxy ; Bd . x = texture2D ( AY , Be . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; Bd . y = texture2D ( AY , Be . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; Bd . zw = texture2D ( AY , Be . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; Bg = vec2 ( 2.0 , 2.0 ) * Bd . xz + Bd . yw ; Af ( bvec2 ( step ( 0.9 , Bc . zw ) ) , Bg , vec2 ( 0 , 0 ) ) ; Bf += AX ( AZ , Bc . xy , Bg , Bb . w ) . gr ; } return Bf ; }".split(" ")}]}}]},
{type:"textline",b:"float Bo ( sampler2D Bj , vec2 Bk , float Bl ) { vec2 Bm , Bn ; Bm = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; Bn = SMAA_SEARCHTEX_SIZE * vec2 ( Bl , 1.0 ) ; Bm += vec2 ( - 1.0 , 1.0 ) ; Bn += vec2 ( 0.5 , - 0.5 ) ; Bm *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; Bn *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( Bj , Bm * Bk + Bn , 0.0 ) . r ; } float Bw ( sampler2D Bp , sampler2D Bq , vec2 Br , float Bs ) { float Bt ; vec2 Bu ; Bu = vec2 ( 0.0 , 1.0 ) ; for ( int Bv = 0 ; Bv < SMAA_MAX_SEARCH_STEPS ; Bv ++ ) { if ( Br . x > Bs && Bu . g > 0.8281 && Bu . r == 0.0 ) { Bu = texture2D ( Bp , Br , 0.0 ) . rg ; Br = - vec2 ( 2.0 , 0.0 ) * u_texel_size + Br ; } } Bt = - ( 255.0 / 127.0 ) * Bo ( Bq , Bu , 0.0 ) + 3.25 ; return u_texel_size . x * Bt + Br . x ; } float BE ( sampler2D Bx , sampler2D By , vec2 Bz , float BA ) { float BB ; vec2 BC ; BC = vec2 ( 0.0 , 1.0 ) ; for ( int BD = 0 ; BD < SMAA_MAX_SEARCH_STEPS ; BD ++ ) { if ( Bz . x < BA && BC . g > 0.8281 && BC . r == 0.0 ) { BC = texture2D ( Bx , Bz , 0.0 ) . rg ; Bz = vec2 ( 2.0 , 0.0 ) * u_texel_size + Bz ; } } BB = - ( 255.0 / 127.0 ) * Bo ( By , BC , 0.5 ) + 3.25 ; return - u_texel_size . x * BB + Bz . x ; } float BM ( sampler2D BF , sampler2D BG , vec2 BH , float BI ) { float BJ ; vec2 BK ; BK = vec2 ( 1.0 , 0.0 ) ; for ( int BL = 0 ; BL < SMAA_MAX_SEARCH_STEPS ; BL ++ ) { if ( BH . y > BI && BK . r > 0.8281 && BK . g == 0.0 ) { BK = texture2D ( BF , BH , 0.0 ) . rg ; BH = - vec2 ( 0.0 , 2.0 ) * u_texel_size + BH ; } } BJ = - ( 255.0 / 127.0 ) * Bo ( BG , BK . gr , 0.0 ) + 3.25 ; return u_texel_size . y * BJ + BH . y ; } float BU ( sampler2D BN , sampler2D BO , vec2 BP , float BQ ) { float BR ; vec2 BS ; BS = vec2 ( 1.0 , 0.0 ) ; for ( int BT = 0 ; BT < SMAA_MAX_SEARCH_STEPS ; BT ++ ) { if ( BP . y < BQ && BS . r > 0.8281 && BS . g == 0.0 ) { BS = texture2D ( BN , BP , 0.0 ) . rg ; BP = vec2 ( 0.0 , 2.0 ) * u_texel_size + BP ; } } BR = - ( 255.0 / 127.0 ) * Bo ( BO , BS . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * BR + BP . y ; } vec2 Ca ( sampler2D BV , vec2 BW , float BX , float BY , float BZ ) { vec2 B_ ; B_ = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * Ak ( 4.0 * vec2 ( BX , BY ) ) + BW ; B_ = SMAA_AREATEX_PIXEL_SIZE * B_ + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; B_ . y = SMAA_AREATEX_SUBTEX_SIZE * BZ + B_ . y ; return texture2D ( BV , B_ , 0.0 ) . rg ; } void Ch ( sampler2D Cb , inout vec2 Cc , vec4 Cd , vec2 Ce ) { vec2 Cf , Cg ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"Cf = step ( Ce . xy , Ce . yx ) ; Cg = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * Cf ; Cg /= Cf . x + Cf . y ; Cf = vec2 ( 1.0 , 1.0 ) ; Cf . x -= Cg . x * texture2D ( Cb , Cd . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; Cf . x -= Cg . y * texture2D ( Cb , Cd . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; Cf . y -= Cg . x * texture2D ( Cb , Cd . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; Cf . y -= Cg . y * texture2D ( Cb , Cd . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; Cc *= clamp ( Cf , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void Co ( sampler2D Ci , inout vec2 Cj , vec4 Ck , vec2 Cl ) { vec2 Cm , Cn ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"Cm = step ( Cl . xy , Cl . yx ) ; Cn = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * Cm ; Cn /= Cm . x + Cm . y ; Cm = vec2 ( 1.0 , 1.0 ) ; Cm . x -= Cn . x * texture2D ( Ci , Ck . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; Cm . x -= Cn . y * texture2D ( Ci , Ck . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; Cm . y -= Cn . x * texture2D ( Ci , Ck . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; Cm . y -= Cn . y * texture2D ( Ci , Ck . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; Cj *= clamp ( Cm , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 CC ( vec2 Cp , vec2 Cq , sampler2D Cr , sampler2D Cs , sampler2D Ct , vec4 Cu ) { float Cv , Cw ; vec3 Cx ; vec2 Cy , Cz , CA ; vec4 CB ; CB = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; Cy = texture2D ( Cr , Cp ) . rg ; if ( Cy . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:"CB . rg = Bi ( Cr , Cs , Cp , Cy , Cu ) ; if ( CB . r == - CB . g ) {".split(" ")}]}}]},{type:"textline",b:"; Cx . x = Bw ( Cr , Ct , zO . xy , zQ . x ) ; Cx . y = zP . y ; Cz . x = Cx . x ; Cv = texture2D ( Cr , Cx . xy , 0.0 ) . r ; Cx . z = BE ( Cr , Ct , zO . zw , zQ . y ) ; Cz . y = Cx . z ; Cz = abs ( Ak ( Cz / u_texel_size . xx - Cq . xx ) ) ; CA = sqrt ( Cz ) ; Cw = texture2D ( Cr , Cx . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; CB . rg = Ca ( Cs , CA , Cv , Cw , Cu . y ) ; Cx . y = Cp . y ; Ch ( Cr , CB . rg , Cx . xyzy , Cz ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"} else Cy . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( Cy . r > 0.0 ) { ; Cx . y = BM ( Cr , Ct , zP . xy , zQ . z ) ; Cx . x = zO . x ; Cy . x = Cx . y ; Cw = texture2D ( Cr , Cx . xy , 0.0 ) . g ; Cx . z = BU ( Cr , Ct , zP . zw , zQ . w ) ; Cy . y = Cx . z ; Cy = abs ( Ak ( Cy / u_texel_size . yy - Cq . yy ) ) ; Cz = sqrt ( Cy ) ; Cv = texture2D ( Cr , Cx . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; CB . ba = Ca ( Cs , Cz , Cw , Cv , Cu . x ) ; Cx . x = Cp . x ; Co ( Cr , CB . ba , Cx . xyxz , Cy ) ; } return CB ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 CO ( vec2 CD , sampler2D CE , sampler2D CF".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","CG"]}]}}]},{type:"textline",b:") { bool CH ; vec2 CI , CJ , CK ; vec4 CL , CM , CN ; CL . x = texture2D ( CF , zN . xy ) . a ; CL . y = texture2D ( CF , zN . zw ) . g ; CL . wz = texture2D ( CF , CD ) . xz ; if ( dot ( CL , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { CM = texture2D ( CE , CD , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"CN = texture2D ( CG , fd ) ; CI = 2.0 * s ( CN ) - 1.0 ; CM . a = sqrt ( 2.0 * length ( CI ) ) ;".split(" ")}]}}]},{type:"textline",b:"return CM ; } else { CH = max ( CL . x , CL . z ) > max ( CL . y , CL . w ) ; CM = vec4 ( 0.0 , CL . y , 0.0 , CL . w ) ; CI = CL . yw ; Af ( bvec4 ( CH , CH , CH , CH ) , CM , vec4 ( CL . x , 0.0 , CL . z , 0.0 ) ) ; Af ( bvec2 ( CH , CH ) , CI , CL . xz ) ; CI /= dot ( CI , vec2 ( 1.0 , 1.0 ) ) ; CM = CM * vec4 ( u_texel_size , - u_texel_size ) + CD . xyxy ; CL = CI . x * texture2D ( CE , CM . xy , 0.0 ) ; CL += CI . y * texture2D ( CE , CM . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"CN = texture2D ( CG , CM . xy ) ; CJ = 2.0 * s ( CN ) - 1.0 ; CK = CI . x * CJ ; CN = texture2D ( CG , CM . zw ) ; CJ = 2.0 * s ( CN ) - 1.0 ; CK += CI . y * CJ ; CL . a = sqrt ( 2.0 * length ( CK ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","CL",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 CY ( vec2 CP , sampler2D CQ , sampler2D CR".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","CS"]}]}}]},{type:"textline",b:") { float CT ; vec2 CU ; vec4 CV , CW , CX ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"CV = texture2D ( CS , fd ) ; CU = 2.0 * s ( CV ) - 1.0 ; CV = texture2D ( CQ , CP ) ; CW = texture2D ( CR , CP - CU ) ; CT = abs ( CV . a * CV . a - CW . a * CW . a ) / 2.0 ; CT = 0.5 * clamp ( 1.0 - sqrt ( CT ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; CX = mix ( CV , CW , CT ) ; CX . a = 1.0 ; return CX ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"CV = texture2D ( CQ , CP ) ; CW = texture2D ( CR , CP ) ; return mix ( CV , CW , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:"void main ( ) { vec4 CZ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"CZ = vec4 ( Ay ( fd , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",
a:[{type:"textline",b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"CZ = CC ( fd , zR , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"CZ = CO ( fd , u_color , u_blend".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"CZ = vec4 ( CY ( fd , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"CZ = texture2D ( u_color , fd ) ;".split(" ")}]}}]},{type:"textline",b:["gl_FragColor","=","CZ",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",
b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 fd ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","zN",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 zO ; varying vec4 zP ; varying vec4 zQ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","zR",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD",
"AA_METHOD_SMAA_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void zS ( vec2 zx ) { zO = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + zx . xyxy ; zP = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + zx . xyxy ; zQ = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + zx . xyxy ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void zV ( vec2 zT , out vec2 zU ) { zU = zT / u_texel_size ; zO = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + zT . xyxy ; zP = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + zT . xyxy ; zQ = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( zO . xz , zP . yw ) ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void zX ( vec2 zW ) { zN = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + zW . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { fd = 2.0 * a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["zS","(","fd",")",";"]}]}},{type:"elif",c:["SMAA_PASS",
"SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"zV ( fd , zR ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["zX","(","fd",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",
b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},{type:"define",name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 fd ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float zS ( in vec2 zx ) { return zI ( u_depth , zx , u_camera_range ) ; } void main ( ) { vec3 zT , zU , zV ; float zW , zX , zY , zZ , z_ , Aa , Ab ; zW = texture2D ( u_color , fd ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( zW , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"zT = normalize ( 2.0 * texture2D ( u_ssao_special_tex , fd * 0.25 / u_texel_size ) . rgb - 1.0 ) ; zX = zS ( fd ) ; zY = zX * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","SSAO_QUALITY_8",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"const float Ac = 8.0 ; const int Ad = 1 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_16",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float Ac = 16.0 ; const int Ad = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_24",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float Ac = 24.0 ; const int Ad = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_32",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"const float Ac = 32.0 ; const int Ad = 4 ;".split(" ")}]}}]},{type:"textline",b:"zZ = u_ssao_radius_increase * 0.001 ; const float Ae = 1.0 + 2.4 / Ac ; z_ = 0.0 ; for ( int Af = 0 ; Af < Ad ; Af ++ ) for ( int Ag = - 1 ; Ag <= 1 ; Ag += 2 ) for ( int Ah = - 1 ; Ah <= 1 ; Ah += 2 ) for ( int Ai = - 1 ; Ai <= 1 ; Ai += 2 ) { zU = reflect ( normalize ( vec3 ( Ag , Ah , Ai ) ) , zT ) * ( zZ *= Ae ) ; zV = vec3 ( fd , zY ) ; zV += vec3 ( zU . xy , zU . z * zY * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"zV . z -= 1.4 * ( zV . z - zY ) * step ( zY , zV . z ) ;".split(" ")}]}}]},{type:"textline",b:"Aa = zS ( zV . xy ) * ( u_camera_range . y - u_camera_range . x ) ; Ab = clamp ( ( zY - Aa ) / Aa , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"z_ += mix ( 1.0 , Ab , step ( Aa , zV . z ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"z_ += mix ( step ( zV . z , Aa ) , 0.5 , Ab ) ;".split(" ")}]}}]},{type:"textline",b:"} z_ = z_ / Ac ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"z_ = clamp ( z_ * z_ + 0.6 * z_ , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"z_ = clamp ( z_ * z_ + z_ , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"zX = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * zX ) ; z_ = mix ( 1.0 , z_ , zX ) ; gl_FragColor = vec4 ( zW , z_ , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 fd ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float zS ( in vec2 zx ) { return zI ( u_depth , zx , u_camera_range ) ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec2 zT , zU ; float zV , zW , zX , zY , zZ , z_ , Aa ; zV = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"zW = zS ( fd ) ; zX = 0.0 ; zY = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},
{type:"textline",b:"zT = vec2 ( - 2.0 ) ; for ( int Ab = 0 ; Ab < 4 ; ++ Ab ) { for ( int Ac = 0 ; Ac < 4 ; ++ Ac ) { zU = ( zT + vec2 ( float ( Ab ) , float ( Ac ) ) ) * u_texel_size ; zZ = texture2D ( u_ssao_mask , fd + zU ) . g ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"z_ = zS ( fd + zU ) ; Aa = 1.0 - clamp ( abs ( z_ - zW ) * zY , 0.0 , 1.0 ) ; zV += zZ * Aa ; zX += Aa ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["zV","+=","zZ",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , fd ) . r , zV / zX , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , fd ) . r , zV / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",
file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 fd ; void main ( ) { vec2 zx ; vec4 zS , zT ; float zU ; zU = texture2D ( u_depth , fd ) . x ; zS = vec4 ( fd * 2.0 - 1.0 , 2.0 * zU - 1.0 , 1.0 ) ; zT = u_view_proj_inverse * zS ; zT = zT / zT . w ; zT = u_view_proj_prev * zT ; zT /= zT . w ; zx = ( zS . xy - zT . xy ) / 4.0 + 0.5 ; zx = clamp ( zx , 0.0 , 1.0 ) ; gl_FragColor = g ( zx ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",
b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"NO_SHADOWS",b:["1"]},{type:"define",name:"SHADOW_CASTING",b:["2"]},{type:"define",name:"SHADOW_MASK_GENERATION",b:["3"]},{type:"define",name:"SHADOW_MAPPING_OPAQUE",b:["4"]},{type:"define",name:"SHADOW_MAPPING_BLEND",b:["5"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",
name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"SPECULAR_BLINN",b:["4"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"DIFFUSE_MINNAERT",b:["4"]},{type:"define",name:"DIFFUSE_TOON",b:["5"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",
b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]},{type:"define",name:"MIX",b:["0"]},{type:"define",name:"ADD",b:["1"]},{type:"define",name:"SUBTRACT",b:["2"]},{type:"define",name:"MULTIPLY",b:["3"]},{type:"define",name:"SCREEN",b:["4"]},{type:"define",name:"OVERLAY",b:["5"]},{type:"define",name:"DIFFERENCE",b:["6"]},{type:"define",name:"DIVIDE",b:["7"]},{type:"define",name:"DARKEN",b:["8"]},{type:"define",name:"LIGHTEN",b:["9"]},{type:"define",name:"HUE",b:["10"]},{type:"define",name:"SATURATION",
b:["11"]},{type:"define",name:"VALUE",b:["12"]},{type:"define",name:"COLOR",b:["13"]},{type:"define",name:"SOFT_LIGHT",b:["14"]},{type:"define",name:"LINEAR_LIGHT",b:["15"]},{type:"define",name:"REFL_NONE",b:["0"]},{type:"define",name:"REFL_MIRRORMAP",b:["1"]},{type:"define",name:"REFL_PLANE",b:["2"]},{type:"define",name:"REFL_CUBE",b:["3"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float a = 255.0 ; float b = 0.0 ; float c = 1.0 ; vec4 g ( const in float d ) { vec4 e , f ; e = vec4 ( a * a * a , a * a , a , c ) ; f = vec4 ( b , c / a , c / a , c / a ) ; e = fract ( d * e ) ; e -= e . xxyz * f ; return e ; } float k ( const in vec4 h ) { vec4 i ; float j ; i = vec4 ( c / ( a * a * a ) , c / ( a * a ) , c / a , c ) ; j = dot ( h , i ) ; return j ; } vec4 g ( const in vec2 l ) { vec4 m ; vec2 n , o ; n = vec2 ( a , c ) ; o = vec2 ( b , c / a ) ; m = fract ( l . xxyy * n . xyxy ) ; m -= m . xxzz * o . xyxy ; if ( l . r == c ) m . rg = vec2 ( b , c ) ; if ( l . g == c ) m . ba = vec2 ( b , c ) ; return m ; } vec2 s ( const in vec4 p ) { vec2 q , r ; r = vec2 ( c / a , c ) ; q . r = dot ( p . rg , r ) ; q . g = dot ( p . ba , r ) ; return q ; }".split(" ")}]};
a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void x ( inout vec3 t , in float u , in vec4 v ) { float w ; w = v . w * u ; w = exp ( - w * w ) ; w = clamp ( w , 0.0 , 1.0 ) ; t = mix ( v . rgb , t , w ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 D ( in mat4 y , in vec3 z ) { vec3 A , B , C ; A = mix ( y [ 0 ] . rgb , y [ 1 ] . rgb , max ( sign ( z . x ) , 0.0 ) ) ; B = mix ( y [ 2 ] . rgb , y [ 3 ] . rgb , max ( sign ( z . z ) , 0.0 ) ) ; C = vec3 ( y [ 0 ] . a , y [ 1 ] . a , y [ 2 ] . a ) ; B = mix ( A , B , abs ( z . z ) ) ; B = mix ( B , C , abs ( z . y ) ) ; return B ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void F ( inout float E ) { E -= 0.5 ; E = 4.0 * ( E * E * E ) + 0.5 ; } void U ( inout vec3 G , in float H , in vec3 I , in float J , in vec4 L , in vec4 M , in float N , in float O ) { vec3 P , Q ; float R , S , T ; R = M . w * H ; R = exp ( - R * R ) ; R = clamp ( R , 0.0 , 1.0 ) ; S = max ( I . y , 0.0 ) ; H = max ( H - max ( J / S , 0.0 ) , 0.0 ) ; T = L . w * H ; T = 1.0 - T ; T = max ( T , 0.0 ) ; F ( T ) ; T += max ( N - 0.5 , 0.0 ) ; if ( T < R ) { P = vec3 ( 0.0 , 0.02 , 0.05 ) ; Q = L . rgb ; J = clamp ( - J * 0.03 , 0.0 , 0.8 ) ; P = mix ( Q , P , min ( S , 1.0 ) ) ; P = mix ( P , vec3 ( 0.0 ) , J ) * O ; G = mix ( P , G , T ) ; } if ( T >= R ) { G = mix ( M . rgb , G , R ) ; } } void ab ( inout vec3 V , in float W , in float X , in vec4 Y , in float Z ) { vec3 _ ; float aa ; aa = Y . w * W ; aa = 1.0 - aa ; aa = clamp ( aa , 0.0 , 1.0 ) ; F ( aa ) ; X = clamp ( - X * 0.03 , 0.0 , 0.8 ) ; _ = mix ( Y . rgb , vec3 ( 0.0 ) , X ) * Z ; V = mix ( _ , V , aa ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",
b:"float ac = 0.0 ; float ad = 1.0 ; float ae = 0.5 ; struct af { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","SPECULAR_PHONG",{type:"equal_expr",d:2},"SPECULAR_SHADER","SPECULAR_COOKTORR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float an ( vec3 ag , vec3 ah , vec3 ai , float aj , float ak ) { float al ; vec3 am ; am = normalize ( ag + ah ) ; al = ( ad - aj ) * max ( dot ( ai , am ) , ac ) + aj ; return pow ( al , ak ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","SPECULAR_WARDISO",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float ax ( vec3 ao , vec3 ap , vec3 aq , float ar ) { float as , at , au , av ; vec3 aw ; aw = normalize ( ao + ap ) ; as = max ( dot ( aq , aw ) , 0.001 ) ; at = max ( dot ( aq , ap ) , 0.01 ) ; au = max ( dot ( aq , ao ) , 0.01 ) ; as = tan ( acos ( as ) ) ; av = max ( ar , 0.001 ) ; return au * ( ad / ( 4.0 * M_PI * av * av ) ) * ( exp ( - ( as * as ) / ( av * av ) ) / ( sqrt ( at * au ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","SPECULAR_TOON",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float aF ( vec3 ay , vec3 az , vec3 aA , float aB , float aC ) { float aD ; vec3 aE ; aE = normalize ( ay + az ) ; aD = acos ( dot ( aE , aA ) ) ; if ( aD < aB ) return ad ; else if ( aD >= aB + aC || aC == ac ) return ac ; else return ad - ( aD - aB ) / aC ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","SPECULAR_BLINN",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"float aS ( vec3 aG , vec3 aH , vec3 aI , float aJ , float aK , float aL ) { float aM , aN , aO , aP , aQ ; vec3 aR ; if ( aJ < 1.0 || aK == ac ) return ac ; else { if ( aK < 100.0 ) aK = sqrt ( 1.0 / aK ) ; else aK = 10.0 / aK ; aR = normalize ( aH + aG ) ; aM = ( ad - aL ) * max ( dot ( aI , aR ) , ac ) + aL ; if ( aM < ac ) return ac ; else { aN = max ( dot ( aI , aH ) , 0.01 ) ; aO = dot ( aI , aG ) ; if ( aO <= 0.01 ) return ac ; else { aP = max ( dot ( aH , aR ) , 0.01 ) ; aQ = ad ; aN = ( 2.0 * aM * aN ) / aP ; aO = ( 2.0 * aM * aO ) / aP ; aO = min ( min ( aQ , aN ) , aO ) ; aN = sqrt ( pow ( aJ , 2.0 ) + pow ( aP , 2.0 ) - ad ) ; aP = pow ( aN - aP , 2.0 ) / pow ( aN + aP , 2.0 ) * ( ad + pow ( aP * ( aN + aP ) - ad , 2.0 ) / pow ( aP * ( aN - aP ) + ad , 2.0 ) ) ; aM = acos ( aM ) ; return max ( aP * aO * exp ( - pow ( aM , 2.0 ) / ( 2.0 * pow ( aK , 2.0 ) ) ) , ac ) ; } } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float bf ( float aT , vec3 aU , vec3 aV , vec3 aW , float aX ) { vec3 aY , aZ ; float a_ , ba , bb , bc , bd , be ; if ( aX > ac ) { a_ = max ( dot ( aU , aW ) , ac ) ; ba = aX * aX ; bb = ad - ae * ( ba / ( ba + 0.33 ) ) ; aY = aV - aT * aU ; aZ = aW - a_ * aU ; if ( length ( aY ) == ac || length ( aZ ) == ac || abs ( aT ) > ad || abs ( a_ ) > ad ) return aT * bb ; else { bc = acos ( aT ) ; a_ = acos ( a_ ) ; aY = normalize ( aY ) ; aZ = normalize ( aZ ) ; bd = max ( bc , a_ ) ; be = min ( bc , a_ ) ; be *= 0.95 ; a_ = max ( dot ( aY , aZ ) , ac ) ; ba = 0.45 * ( ba / ( ba + 0.09 ) ) ; return aT * ( bb + ( ba * a_ * sin ( bd ) * tan ( be ) ) ) ; } } else return aT ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_MINNAERT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float bl ( float bg , vec3 bh , vec3 bi , float bj ) { float bk ; bk = max ( dot ( bh , bi ) , ac ) ; if ( bj <= ad ) return bg * pow ( max ( bk * bg , 0.1 ) , bj - ad ) ; else return bg * pow ( 1.0001 - bk , bj - ad ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_TOON",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"float bq ( float bm , float bn , float bo ) { float bp ; bp = acos ( bm ) ; if ( bp < bn ) return ad ; else if ( bp > ( bn + bo ) || bo == ac ) return ac ; else return ad - ( ( bp - bn ) / bo ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_FRESNEL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float bv ( float br , float bs , float bt ) { float bu ; if ( bs == ac ) { return ad ; } else { bu = ad + abs ( br ) ; bu = bt + ( ad - bt ) * pow ( bu , bs ) ; return clamp ( bu , ac , ad ) ; } }".split(" ")}]}}]},
{type:"textline",b:"void bD ( vec3 bw , vec3 bx , vec3 by , vec2 bz , const float bA , out float bB ) { float bC ; bC = ( ad - bA ) * dot ( bw , bx ) + bA ; bB = bC ; if ( bA == ae ) return ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_FRESNEL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bB = bv ( bC , bz [ 0 ] , bz [ 1 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bB = bf ( bC , bw , bx , by , bz [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_MINNAERT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bB = bl ( bC , bw , by , bz [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","DIFFUSE_TOON",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bB = bq ( bC , bz [ 0 ] , bz [ 1 ] ) ;".split(" ")}]}}]},
{type:"textline",b:"bB = max ( bB , ac ) ;".split(" ")}]}}]},{type:"textline",b:"} void bK ( vec3 bE , vec3 bF , vec3 bG , float bH , vec2 bI , out float bJ ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","SPECULAR_PHONG",{type:"equal_expr",d:2},"SPECULAR_SHADER","SPECULAR_COOKTORR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bJ = an ( bE , bF , bG , bH , bI [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","SPECULAR_WARDISO",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bJ = ax ( bE , bF , bG , bI [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","SPECULAR_TOON",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bJ = aF ( bE , bF , bG , bI [ 0 ] , bI [ 1 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","SPECULAR_BLINN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bJ = aS ( bE , bF , bG , bI [ 0 ] , bI [ 1 ] , bH ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["bJ","=","ac",";"]}]}}]},{type:"textline",b:"} void cf ( vec3 bL , vec3 bM , vec3 bN , vec2 bO , vec4 bP , vec3 bQ , vec3 bR , vec3 bS , inout af bT , float bU , vec2 bV , vec2 bW , float bX ) { float bY , bZ , b_ , ca , cb , cc , cd , ce ; bY = ac ; if ( bO . r != ac ) bD ( bN , bM , bL , bV , bX , bY ) ; bZ = ac ; if ( bO . g != ac ) bK ( bM , bL , bN , bX , bW , bZ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_TRANSLUCENCY"],group:{type:"group",
a:[{type:"textline",b:"if ( dot ( bM , bN ) * dot ( bL , bN ) < ac ) { b_ = bP . x ; ca = bP . y ; cb = bP . z ; cc = bP . w ; cd = clamp ( abs ( dot ( bM , bN ) ) , ac , ad ) ; ce = clamp ( dot ( bL , - bM ) , ac , ad ) ; ca = pow ( ce , ca ) ; bT . a += bU * vec4 ( bS * cd * pow ( bQ , vec3 ( b_ ) ) , ad ) ; bT . a += cb * mix ( vec4 ( bQ , ad ) , vec4 ( ad ) , cc ) * bU * vec4 ( bS * cd * vec3 ( ca ) , ad ) ; } else { bT . b += bS * bR * bZ ; bT . a += vec4 ( bS * bQ * bY , bZ ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"bT . b += bS * bR * bZ ; bT . a += vec4 ( bS * bQ * bY , bZ ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"lamp",name:"POINT",g:[{type:"textline",b:"cI = ct [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; cA = cq [ LAMP_IND ] ; cB = cs [ LAMP_IND ] ; cw = ac ;".split(" ")},{type:"textline",b:"cB = cB ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) cB *= cp ; cA = cA - ck ;".split(" ")},{type:"textline",b:"cx = length ( cA ) ; cB *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + cx * cx ) ; cA = normalize ( cA ) ; cf ( cm , cA , cl , cI , cv , ci , cj , cB , cM , cu , co , cn , cw ) ;".split(" ")}]},
{type:"lamp",name:"SPOT",g:[{type:"textline",b:"cJ = ct [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; cC = cq [ LAMP_IND ] ; cD = cs [ LAMP_IND ] ; cE = cr [ LAMP_IND ] ; cx = ac ;".split(" ")},{type:"textline",b:"cD = cD ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) cD *= cp ; cC = cC - ck ;".split(" ")},{type:"textline",b:"cy = length ( cC ) ; cD *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + cy * cy ) ; cC = normalize ( cC ) ;".split(" ")},{type:"textline",b:"cy = dot ( cC , cE ) ; cy *= smoothstep ( ac , ad , ( cy - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; cD *= cy ; cf ( cm , cC , cl , cJ , cv , ci , cj , cD , cM , cu , co , cn , cx ) ;".split(" ")}]},
{type:"lamp",name:"SUN",g:[{type:"textline",b:"cK = ct [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; cE = cs [ LAMP_IND ] ; cF = cr [ LAMP_IND ] ; cy = ac ;".split(" ")},{type:"textline",b:"cE = cE ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) cE *= cp ; cf ( cm , cF , cl , cK , cv , ci , cj , cE , cM , cu , co , cn , cy ) ;".split(" ")}]},{type:"lamp",name:"HEMI",g:[{type:"textline",b:"cL = ct [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; cG = cs [ LAMP_IND ] ; cH = cr [ LAMP_IND ] ; cz = ae ;".split(" ")},
{type:"textline",b:"cG = cG ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) cG *= cp ; cf ( cm , cH , cl , cL , cv , ci , cj , cG , cM , cu , co , cn , cz ) ;".split(" ")}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"af cN ( vec3 cg , vec3 ch , vec3 ci , vec3 cj , vec3 ck , vec3 cl , vec3 cm , vec2 cn , vec2 co , float cp , vec3 cq [ NUM_LIGHTS ] , vec3 cr [ NUM_LIGHTS ] , vec3 cs [ NUM_LIGHTS ] , vec4 ct [ NUM_LFACTORS ] , float cu , vec4 cv ) { float cw , cx , cy , cz ; vec3 cA , cB , cC , cD , cE , cF , cG , cH ; vec2 cI , cJ , cK , cL ; af cM ; cM . a = vec4 ( cg + ci * ch , ac ) ; cM . b = vec3 ( ac ) ;".split(" ")},
{type:"lamps_main"},{type:"textline",b:["return","cM",";","}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"af cS ( vec3 cO , vec3 cP , vec3 cQ ) { af cR ; cR . a = vec4 ( cO + cQ * cP , ac ) ; cR . b = vec3 ( ac ) ; return cR ; }".split(" ")}]}}]}]};a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float cT = 0.0 ; float cU = 1.0 ; vec4 cW ( vec4 cV ) { return cV - floor ( cV * ( cU / 289.0 ) ) * 289.0 ; } vec3 cW ( vec3 cX ) { return cX - floor ( cX * ( cU / 289.0 ) ) * 289.0 ; } vec2 cW ( vec2 cY ) { return cY - floor ( cY * ( cU / 289.0 ) ) * 289.0 ; } vec4 c_ ( vec4 cZ ) { return cZ - floor ( cZ * ( cU / 7.0 ) ) * 7.0 ; } vec4 db ( vec4 da ) { return cW ( ( 34.0 * da + 5.0 ) * da ) ; }".split(" ")},
{type:"define",name:"K",b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 dj ( vec2 dc ) { vec4 dd , de , df , dg ; vec2 dh , di ; dh = cW ( floor ( dc ) ) ; di = fract ( dc ) ; dd = di . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; de = di . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; df = db ( dh . x + vec4 ( cT , cU , cT , cU ) ) ; df = db ( df + dh . y + vec4 ( cT , cT , cU , cU ) ) ; dg = c_ ( df ) * K + K2 ; df = c_ ( floor ( df * K ) ) * K + K2 ; dg = dd + JITTER * dg ; df = de + JITTER * df ; df = dg * dg + df * df ;".split(" ")},
{type:"condition",a:[{type:"if",c:[1],group:{type:"group",a:[{type:"textline",b:"df . xy = min ( df . xy , df . zw ) ; df . x = min ( df . x , df . y ) ; return df . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"df . xy = ( df . x < df . y ) ? df . xy : df . yx ; df . xz = ( df . x < df . z ) ? df . xz : df . zx ; df . xw = ( df . x < df . w ) ? df . xw : df . wx ; df . y = min ( df . y , df . z ) ; df . y = min ( df . y , df . w ) ; return sqrt ( df . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 dt ( vec2 dk , float dl ) { vec4 dm , dn , dp , dq ; vec2 dr , ds ; dr = cW ( floor ( dk ) ) ; ds = fract ( dk ) ; dm = ds . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; dn = ds . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; dp = db ( dr . x + vec4 ( cT , cU , cT , cU ) ) ; dp = db ( dp + dr . y + vec4 ( cT , cT , cU , cU ) ) ; dq = c_ ( dp ) * K + K2 ; dp = c_ ( floor ( dp * K ) ) * K + K2 ; dq = dm + JITTER * dq ; dp = dn + JITTER * dp ; dn = dq * dq + dp * dp ; dq += dl ; dp += dl ; dm = dq * dq + dp * dp ; dq += dl ; dp += dl ; dp = dq * dq + dp * dp ; dn . xy = min ( dn . xy , dn . zw ) ; dn . x = min ( dn . x , dn . y ) ; dm . xy = min ( dm . xy , dm . zw ) ; dm . x = min ( dm . x , dm . y ) ; dp . xy = min ( dp . xy , dp . zw ) ; dp . x = min ( dp . x , dp . y ) ; return vec3 ( dn . x , dm . x , dp . x ) ; } vec3 dv ( vec3 du ) { return cW ( ( ( du * 34.0 ) + cU ) * du ) ; } float dG ( vec2 dw ) { vec3 dx , dy , dz , dA ; vec4 dB ; vec2 dC , dD , dE ; const vec4 dF = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; dC = floor ( dw + dot ( dw , dF . yy ) ) ; dD = dw - dC + dot ( dC , dF . xx ) ; dE = ( dD . x > dD . y ) ? vec2 ( cU , cT ) : vec2 ( cT , cU ) ; dB = dD . xyxy + dF . xxzz ; dB . xy -= dE ; dC = cW ( dC ) ; dx = dv ( dv ( dC . y + vec3 ( cT , dE . y , cU ) ) + dC . x + vec3 ( cT , dE . x , cU ) ) ; dy = max ( 0.5 - vec3 ( dot ( dD , dD ) , dot ( dB . xy , dB . xy ) , dot ( dB . zw , dB . zw ) ) , cT ) ; dy = dy * dy ; dy = dy * dy ; dx = 2.0 * fract ( dx * dF . www ) - cU ; dz = abs ( dx ) - 0.5 ; dA = floor ( dx + 0.5 ) ; dA = dx - dA ; dy *= 1.79284291400159 - 0.85373472095314 * ( dA * dA + dz * dz ) ; dx . x = dA . x * dD . x + dz . x * dD . y ; dx . yz = dA . yz * dB . xz + dz . yz * dB . yw ; return 130.0 * dot ( dy , dx ) ; } vec2 dK ( vec2 dH ) { float dI , dJ ; dI = dot ( dH , vec2 ( 12.9898 , 78.233 ) ) ; dJ = dot ( dH , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; dI = fract ( sin ( dI ) * 43758.5453 ) * 2.0 - cU ; dJ = fract ( sin ( dJ ) * 43758.5453 ) * 2.0 - cU ; return vec2 ( dI , dJ ) ; }".split(" ")}]};
a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void eb ( inout vec3 dL , float dM , float dN , float dO , vec3 dP , vec3 dQ , vec3 dR , vec4 dS , vec3 dT , float dU ) { float dV , dW , dX ; vec2 dY , dZ ; vec3 d_ ; vec4 ea ; if ( dU > CAUSTICS_VIEW_DISTANCE ) return ; ea = dS ; d_ = dT + dP ; d_ . xz = 10.0 * sin ( 0.1 * d_ . xz ) ; d_ = d_ + 2.0 * cross ( - ea . xyz , cross ( - ea . xyz , d_ ) + ea . w * d_ ) ; dY = d_ . xz ; d_ = dQ ; dV = max ( dot ( dP , d_ ) , 0.0 ) ; dW = 0.025 ; dZ = CAUST_SPEED * dN ; dY . s += 0.25 * sin ( dot ( dT + dN , vec3 ( 1.0 ) ) ) ; dY . t += 0.35 * ( - sin ( dot ( dT - dN , vec3 ( - 0.7 ) ) ) ) ; dY . st += 0.15 * cos ( 4.0 * dM - dZ . x ) + 1.5 * sin ( dM - 0.3 * dZ . y ) ; dX = CAUST_SCALE * ( 1.0 + max ( 0.1 * dM , 0.0 ) ) ; d_ = dt ( ( dY / dX ) , dW ) ; d_ *= CAUST_BRIGHT ; d_ *= d_ ; dW = min ( 0.25 * dM , - dM ) + 1.0 ; dW = max ( dW , 0.0 ) ; dV = dO * dV ; dX = max ( sign ( dM ) , 0.0 ) ; dV = dV + max ( 0.5 * sign ( - dP . y ) * dX , 0.0 ) ; dV = min ( dV , 1.0 ) ; dL += dR * d_ * dW * dV ; }".split(" ")}]};
a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void ed ( inout vec3 ec ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"ec = max ( vec3 ( 0.0 ) , ec ) ; ec = pow ( ec , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void ef ( inout vec3 ee ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"ee = max ( vec3 ( 0.0 ) , ee ) ; ee = pow ( ee , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void ei ( inout vec3 eg , in float eh ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"eg = eg * eh ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float ej = 0.0 ; float ek = 1.0 ; struct el { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool eo ( vec3 em , vec3 en ) { return any ( lessThan ( abs ( em - en ) , vec3 ( EPSILON ) ) ) ; } vec3 er ( in vec4 ep , in vec3 eq ) { return eq + 2.0 * cross ( ep . xyz , cross ( ep . xyz , eq ) + ep . w * eq ) ; } vec4 et ( in vec4 es ) { return vec4 ( - es . xyz , es . w ) / dot ( es , es ) ; } vec3 ey ( vec4 eu , vec4 ev , vec4 ew ) { vec3 ex ; ex = ew . xyz * eu . w ; ex = er ( ev , ex ) ; ex += eu . xyz * ew . w ; return ex ; } vec3 eE ( vec4 ez , vec4 eA , vec4 eB ) { vec4 eC ; vec3 eD ; eD = eB . xyz - ez . xyz * eB . w ; eC = et ( eA ) ; eD = er ( eC , eD ) ; eD /= ez . w ; return eD ; } mat4 eF ( ) { return mat4 ( ek , ej , ej , ej , ej , ek , ej , ej , ej , ej , ek , ej , ej , ej , ej , ek ) ; } mat4 eH ( float eG ) { return mat4 ( ek , ej , ej , ej , ej , cos ( eG ) , sin ( eG ) , ej , ej , - sin ( eG ) , cos ( eG ) , ej , ej , ej , ej , ek ) ; } mat4 eJ ( float eI ) { return mat4 ( cos ( eI ) , ej , - sin ( eI ) , ej , ej , ek , ej , ej , sin ( eI ) , ej , cos ( eI ) , ej , ej , ej , ej , ek ) ; } mat4 eL ( float eK ) { return mat4 ( cos ( eK ) , sin ( eK ) , ej , ej , - sin ( eK ) , cos ( eK ) , ej , ej , ej , ej , ek , ej , ej , ej , ej , ek ) ; } el eN ( in el eM ) { return el ( eM . a , eM . b , normalize ( eM . c ) , normalize ( eM . d ) , normalize ( eM . e ) , eM . f ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"vec3 eT ( vec4 eO ) { vec3 eP ; float eQ , eR , eS ; eQ = eO . x ; eR = eO . y ; eS = eO . w ; eP . x = ( eQ + eS ) / 2.0 ; eP . y = ( eR + eS ) / 2.0 ; eP . z = eS ; return eP ; }".split(" ")}]}}]}]};a["include/shadow.glslf"]={type:"group",
a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["vec4","fe",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",
d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float ff = 0.1 ; const float fg = 0.1 ; const float fh = - 0.01 ; const float fi = 0.05 ; vec4 fj = vec4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 ) ; vec4 fk = vec4 ( 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 ) ; vec4 fl = vec4 ( - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 ) ; vec4 fm = vec4 ( - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; vec4 fn = vec4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 ) ; vec4 fo = vec4 ( - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 ) ; vec4 fp = vec4 ( - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 ) ; vec4 fq = vec4 ( - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ; bool ft ( vec2 fr , float fs ) { return all ( lessThanEqual ( fr , vec2 ( 1.0 + fs ) ) ) && all ( greaterThanEqual ( fr , vec2 ( 0.0 - fs ) ) ) ; } float fC ( float fu , float fv , mat2 fw , vec3 fx , float fy , PRECISION sampler2D fz ) { vec2 fA , fB ; fB . x = fu ; fB . y = fv ; fB = fw * fB ; fA = fx . xy + fB * fy / SHADOW_TEX_RES ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"if ( ! ft ( fA , fh ) ) return 1.0 ; else".split(" ")}]}}]},{type:"textline",b:"return step ( fx . z , texture2D ( fz , fA ) . r ) ; } void fQ ( inout float fD , inout float fE , float fF , float fG , mat2 fH , vec3 fI , vec3 fJ , float fK , float fL , PRECISION sampler2D fM , PRECISION sampler2D fN ) { vec2 fO , fP ; fP . x = fF ; fP . y = fG ; fP = fH * fP ; fO = fI . xy + fP * fK / SHADOW_TEX_RES ; fD += step ( fI . z , texture2D ( fM , fO ) . r ) ; fO = fJ . xy + fP * fL / SHADOW_TEX_RES ; fE += step ( fJ . z , texture2D ( fN , fO ) . r ) ; } float fZ ( vec3 fR , PRECISION sampler2D fS , float fT ) { mat2 fU ; float fV , fW , fX ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:"if ( fR . z > u_perspective_cast_far_bound ) return 1.0 ; else {".split(" ")}]}}]},{type:"textline",b:"fR . z = clamp ( fR . z , 0.0 , 1.0 ) ; fV = 0.0 ; fW = dK ( fR . xy ) . x * M_PI ; fX = cos ( fW ) ; fW = sin ( fW ) ; fU = mat2 ( fX , fW , - fW , fX ) ; for ( int fY = 0 ; fY < 4 ; fY ++ ) { fV += fC ( fj [ fY ] , fn [ fY ] , fU , fR , fT , fS ) ; fV += fC ( fk [ fY ] , fo [ fY ] , fU , fR , fT , fS ) ; fV += fC ( fl [ fY ] , fp [ fY ] , fU , fR , fT , fS ) ; fV += fC ( fm [ fY ] , fq [ fY ] , fU , fR , fT , fS ) ; } fV /= 16.0 ; return clamp ( fV , 0.0 , 1.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["}"]}]}}]},{type:"textline",b:"return 1.0 ; } float gm ( vec3 f_ , PRECISION sampler2D ga , vec3 gb , PRECISION sampler2D gc , float gd , float ge , float gf ) { mat2 gg ; float gh , gi , gj , gk ; f_ . z = clamp ( f_ . z , 0.0 , 1.0 ) ; gb . z = clamp ( gb . z , 0.0 , 1.0 ) ; gh = 0.0 ; gi = 0.0 ; gj = dK ( f_ . xy ) . x * M_PI ; gk = cos ( gj ) ; gj = sin ( gj ) ; gg = mat2 ( gk , gj , - gj , gk ) ; for ( int gl = 0 ; gl < 4 ; gl ++ ) { fQ ( gh , gi , fj [ gl ] , fn [ gl ] , gg , f_ , gb , gd , ge , ga , gc ) ; fQ ( gh , gi , fk [ gl ] , fo [ gl ] , gg , f_ , gb , gd , ge , ga , gc ) ; fQ ( gh , gi , fl [ gl ] , fp [ gl ] , gg , f_ , gb , gd , ge , ga , gc ) ; fQ ( gh , gi , fm [ gl ] , fq [ gl ] , gg , f_ , gb , gd , ge , ga , gc ) ; } gh = mix ( gh , gi , gf ) ; gh /= 16.0 ; return clamp ( gh , 0.0 , 1.0 ) ; } float gq ( vec2 gn ) { float go , gp ; go = min ( gn . x , gn . y ) ; gp = min ( 1.0 - gn . x , 1.0 - gn . y ) ; return min ( go , gp ) ; } float gt ( float gr , float gs ) { if ( gs >= 0.0 && gs <= fg ) gr = ( gr - 1.0 ) / fg * gs + 1.0 ; return gr ; } float gE ( vec3 gu , vec3 gv , PRECISION sampler2D gw , PRECISION sampler2D gx , float gy , float gz , float gA , float gB ) { float gC , gD ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"gD = gq ( gu . xy ) ; if ( - gB > gA && gD >= 0.0 && gD <= ff && ft ( gv . xy , 0.0 ) ) { gD = 1.0 - gD / ff ; gC = gm ( gu , gw , gv , gx , gy , gz , gD ) ; } else".split(" ")}]}}]},{type:"textline",b:"gC = fZ ( gu , gw , gy ) ; return gC ; } float gM ( vec3 gF , PRECISION sampler2D gG , float gH , float gI , float gJ ) { float gK , gL ; gK = fZ ( gF , gG , gH ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - gJ > gI ) { gL = gq ( gF . xy ) ; gK = gt ( gK , gL ) ; }".split(" ")}]}}]},{type:"textline",b:"return gK ; } float gT ( float gN ) { vec3 gO , gP , gQ , gR ; float gS ; gS = 1.0 ; gO = e_ . xyz / e_ . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"gP = fa . xyz / fa . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:"gQ = fb . xyz / fb . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"gR = fc . xyz / fc . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ft ( gO . xy , 0.0 ) ) { gS = gE ( gO , gP , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , gN ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( ft ( gO . xy , fi ) ) { gS = gM ( gO , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , gN ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( ft ( gP . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"gS = gE ( gP , gQ , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , gN ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gS = gM ( gP , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , gN ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( ft ( gQ . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"gS = gE ( gQ , gR , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , gN ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gS = gM ( gQ , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , gN ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( ft ( gR . xy , 0.0 ) ) gS = gM ( gR , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , gN ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","gS",";","}"]}]}}]},{type:"textline",b:"float gY ( inout vec3 gU ) { float gV ; vec3 gW ; vec2 gX ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gX = texture2DProj ( u_shadow_mask , eY ) . rg ; gW = vec3 ( gX . r ) ; gV = gX . g ; fe = vec4 ( gW , gV ) ; gU *= fe . a ; return fe . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},
"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return gT ( eV . z ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_MIRRORMAP",
{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float he ( in vec3 gZ , vec3 g_ , float ha , float hb ) { float hc ; vec3 hd ; hd = normalize ( g_ + gZ ) ; hc = 1.0 - dot ( gZ , hd ) ; hc = hb + ( 1.0 - hb ) * pow ( hc , ha ) ; return hc ; } void hr ( inout vec3 hf , vec3 hg , vec3 hh , float hi ) { vec2 hj , hk ; float hl , hm , hn ; vec3 ho , hp , hq ; ho = reflect ( - hg , hh ) ; hl = u_fresnel_params [ 2 ] ; hm = u_fresnel_params [ 3 ] ; hn = 1.0 ; if ( hl != 0.0 ) hn = he ( hg , ho , hl , hm ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"hp = textureCube ( u_cube_reflection , ho ) . xyz ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"hq = u_refl_plane . xyz * dot ( hh , u_refl_plane . xyz ) ; hq = hh - hq ; hj = ( u_view_matrix_frag * vec4 ( hq , 0.0 ) ) . xy ; hk = eY . xy / eY . z ; hk += hj * REFL_BUMP ; hp = texture2D ( u_plane_reflection , hk ) . rgb ;".split(" ")}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"hp = textureCube ( u_mirrormap , ho ) . xyz ; hi = u_mirror_factor ;".split(" ")}]}}]},{type:"textline",b:"ed ( hp . rgb ) ; hf = mix ( hf , hp , hi * hn ) ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",a:[{type:"textline",b:"vec3 hu ( vec3 hs ) { float ht ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , hs ) . rgb ;".split(" ")}]}},{type:"elif",c:["SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"ht = 0.5 * hs . y + 0.5 ; return mix ( u_horizon_color , u_zenith_color , ht ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"float hA ( in float hv , inout vec2 hw , in vec2 hx ) { float hy ; vec4 hz ; hz = texture2D ( u_scene_depth , hw ) ; hy = k ( hz ) ; if ( hy < eZ ) { hw = hx ; return hv ; } else { return hy ; } return hv ; }".split(" ")}]}}]},{type:"textline",b:"vec3 hI ( in vec3 hB , in vec2 hC ) { vec3 hD ; float hE ; vec4 hF ; vec2 hG , hH ; hG = hB . xy / hB . z ; hH = hG + hC ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"hF = texture2DProj ( u_scene_depth , hB ) ; hE = k ( hF ) ; hA ( hE , hH , hG ) ;".split(" ")}]}}]},{type:"textline",b:"hD = texture2D ( u_refractmap , hH ) . rgb ; ed ( hD ) ; return hD ; }".split(" ")}]}}]}]};a["include/nodes.glslf"]={type:"group",a:[{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",
b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","hJ",";"]}]}}]},{type:"textline",
b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 hK = vec3 ( ZERO_VALUE_NODES ) ; vec3 hL = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"vec3 hP ( in vec3 hM , in float hN ) { vec3 hO ; hO = hK ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"hO = hI ( eY , hM . xz * hN ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"hO = texture2D ( u_refractmap , eY . xy / eY . z ) . rgb ; ed ( hO ) ;".split(" ")}]}}]},{type:"textline",b:["return","hO",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"vec3 hU ( vec3 hQ ) { float hR , hS ; vec4 hT ; hT = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; hT = mix ( vec4 ( hQ . bg , hT . wz ) , vec4 ( hQ . gb , hT . xy ) , step ( hQ . b , hQ . g ) ) ; hT = mix ( vec4 ( hT . xyw , hQ . r ) , vec4 ( hQ . r , hT . yzx ) , step ( hT . x , hQ . r ) ) ; hR = hT . x - min ( hT . w , hT . y ) ; hS = 1.0e-10 ; return vec3 ( abs ( hT . z + ( hT . w - hT . y ) / ( 6.0 * hR + hS ) ) , hR / ( hT . x + hS ) , hT . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"vec3 hY ( vec3 hV ) { vec3 hW ; vec4 hX ; hX = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; hW = abs ( fract ( vec3 ( hV . r , hV . r , hV . r ) + hX . xyz ) * 6.0 - hX . www ) ; return hV . b * mix ( hX . xxx , clamp ( hW - hX . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , hV . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"vec3 h_ ( vec2 hZ ) { return vec3 ( hZ * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"vec2 ib ( vec3 ia ) { return vec2 ( ia . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},
{type:"node",name:"CAMERA",i:[{type:"node_out",name:"je",qualifier:["vec3"],f:!0},{type:"node_out",name:"jf",qualifier:["float"],f:!0},{type:"node_out",name:"jg",qualifier:["float"],f:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_je"],g:[{type:"textline",b:"je = normalize ( iL . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jf"],g:[{type:"textline",b:"jf = abs ( iL . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jg"],
g:[{type:"textline",b:"jg = length ( iL . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",i:[{type:"node_in",name:"jh",qualifier:["float"],f:!1},{type:"node_in",name:"ji",qualifier:["float"],f:!1},{type:"node_in",name:"jj",qualifier:["float"],f:!1},{type:"node_out",name:"jk",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"jk = vec3 ( jh , ji , jj ) ;".split(" ")}]},{type:"node",name:"COMBHSV",i:[{type:"node_in",name:"jl",qualifier:["float"],f:!1},{type:"node_in",name:"jm",qualifier:["float"],
f:!1},{type:"node_in",name:"jn",qualifier:["float"],f:!1},{type:"node_out",name:"jo",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"jo = hY ( vec3 ( jl , jm , jn ) ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",i:[{type:"node_out",name:"jp",qualifier:["vec3"],f:!1},{type:"node_param",name:"ic",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"jp = h_ ( ic ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_OR",i:[{type:"node_out",name:"jq",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"jq = 2.0 * clamp ( hJ , 0.0 , 1.0 ) - hL ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC",i:[{type:"node_out",name:"jr",qualifier:["vec3"],f:!1},{type:"node_param",name:"id",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["jr","=","id",";"]}]},{type:"node",name:"GEOMETRY_VC1",i:[{type:"node_out",name:"js",qualifier:["float"],f:!1},{type:"node_param",name:"ie",qualifier:["varying","float"]}],g:[{type:"textline",b:["js","=","ie",";"]}]},{type:"node",name:"GEOMETRY_VC2",i:[{type:"node_out",name:"jt",qualifier:["float"],f:!1},{type:"node_out",name:"ju",
qualifier:["float"],f:!1},{type:"node_param",name:"ig",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"jt = ig [ 0 ] ; ju = ig [ 1 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",i:[{type:"node_out",name:"jv",qualifier:["float"],f:!1},{type:"node_out",name:"jw",qualifier:["float"],f:!1},{type:"node_out",name:"jx",qualifier:["float"],f:!1},{type:"node_param",name:"ih",qualifier:["varying","vec3"]}],g:[{type:"textline",b:"jv = ih [ 0 ] ; jw = ih [ 1 ] ; jx = ih [ 2 ] ;".split(" ")}]},{type:"node",
name:"GEOMETRY_NO",i:[{type:"node_out",name:"jy",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["jy","=","iP",";"]}]},{type:"node",name:"GEOMETRY_FB",i:[{type:"node_out",name:"jz",qualifier:["float"],f:!1}],g:[{type:"textline",b:"jz = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VW",i:[{type:"node_out",name:"jA",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["jA","=","it",";"]}]},{type:"node",name:"GEOMETRY_LO",i:[{type:"node_out",name:"jB",
qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"jB [ 0 ] = iL [ 0 ] ; jB [ 1 ] = iL [ 1 ] ; jB [ 2 ] = iL [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_GL",i:[{type:"node_out",name:"jC",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"jC = vec3 ( iO . r , - iO . b , iO . g ) ;".split(" ")}]},{type:"node",name:"NEW_GEOMETRY",i:[{type:"node_out",name:"jD",qualifier:["vec3"],f:!1},{type:"node_out",name:"jE",qualifier:["vec3"],f:!1},{type:"node_out",name:"jF",qualifier:["vec3"],f:!1},{type:"node_out",
name:"jG",qualifier:["vec3"],f:!1},{type:"node_out",name:"jH",qualifier:["vec3"],f:!1},{type:"node_out",name:"jI",qualifier:["vec3"],f:!1},{type:"node_out",name:"jJ",qualifier:["float"],f:!1},{type:"node_out",name:"jK",qualifier:["float"],f:!1}],g:[{type:"textline",b:"jD = hK ; jE = hK ; jF = hK ; jG = hK ; jH = hK ; jI = hK ; jJ = ZERO_VALUE_NODES ; jK = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"HUE_SAT",i:[{type:"node_in",name:"jL",qualifier:["float"],f:!1},{type:"node_in",name:"jM",
qualifier:["float"],f:!1},{type:"node_in",name:"jN",qualifier:["float"],f:!1},{type:"node_in",name:"jO",qualifier:["float"],f:!1},{type:"node_in",name:"jP",qualifier:["vec3"],f:!1},{type:"node_out",name:"jQ",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iQ = hU ( jP ) ; iQ [ 0 ] += ( jL - 0.5 ) ; if ( iQ [ 0 ] > UNITY_VALUE_NODES ) iQ [ 0 ] -= UNITY_VALUE_NODES ; else if ( iQ [ 0 ] < ZERO_VALUE_NODES ) iQ [ 0 ] += UNITY_VALUE_NODES ; iQ *= vec3 ( UNITY_VALUE_NODES , jM , jN ) ; iQ = mix ( hL , mix ( hK , iQ , step ( hK , iQ ) ) , step ( iQ , hL ) ) ; jQ = mix ( jP , hY ( iQ ) , jO ) ;".split(" ")}]},
{type:"node",name:"INVERT",i:[{type:"node_in",name:"jR",qualifier:["float"],f:!1},{type:"node_in",name:"jS",qualifier:["vec3"],f:!1},{type:"node_out",name:"jT",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"jT = mix ( jS , hL - jS , jR ) ;".split(" ")}]},{type:"node",name:"LAMP",i:[{type:"node_out",name:"jU",qualifier:["vec3"],f:!0},{type:"node_out",name:"jV",qualifier:["vec3"],f:!1},{type:"node_out",name:"jW",qualifier:["float"],f:!1},{type:"node_out",name:"jX",qualifier:["float"],f:!0}],g:[{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_jU"],g:[{type:"textline",b:"jU = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",b:"iM = u_lamp_light_factors [ LAMP_INDEX ] ; iR = u_lamp_light_directions [ LAMP_INDEX ] ; iS = u_lamp_light_positions [ LAMP_INDEX ] ; iD = iM . z ; if ( iD != - UNITY_VALUE_NODES ) {".split(" ")},{type:"textline",b:"jV = iS - eU ; jW = length ( jV ) ; jV = normalize ( jV ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jX"],g:[{type:"textline",
b:"jX = iD / ( iD + jW * jW ) ; iD = iM . x ; iE = iM . y ; if ( iD > - UNITY_VALUE_NODES ) { iF = dot ( jV , iR ) ; iF *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( iF - iD ) / iE ) ; jX *= iF ; }".split(" ")}]}]},{type:"textline",b:["}","else","{"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jV"],g:[{type:"textline",b:["jV","=","iR",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jW"],g:[{type:"textline",b:"jW = length ( iS - eU ) ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_jX"],g:[{type:"textline",b:["jX","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"NORMAL",i:[{type:"node_in",name:"jY",qualifier:["vec3"],f:!1},{type:"node_out",name:"jZ",qualifier:["vec3"],f:!0},{type:"node_out",name:"j_",qualifier:["float"],f:!0},{type:"node_param",name:"ii",qualifier:["vec3"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jZ"],g:[{type:"textline",b:["jZ","=","ii",";"]}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_j_"],g:[{type:"textline",b:"j_ = - dot ( jY , ii ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",i:[{type:"node_in",name:"ka",qualifier:["vec3"],f:!1},{type:"node_out",name:"kb",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"kb = - ( u_view_matrix_frag * vec4 ( ka , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"BSDF_ANISOTROPIC",i:[{type:"node_in",name:"kc",qualifier:["vec3"],f:!1},{type:"node_in",name:"kd",qualifier:["float"],f:!1},{type:"node_in",name:"ke",
qualifier:["float"],f:!1},{type:"node_in",name:"kf",qualifier:["float"],f:!1},{type:"node_in",name:"kg",qualifier:["vec3"],f:!1},{type:"node_in",name:"kh",qualifier:["vec3"],f:!1},{type:"node_out",name:"ki",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["ki","=","kc",";"]},{type:"textline",b:"kd ; ke ; kf ; kg ; kh ;".split(" ")}]},{type:"node",name:"BSDF_DIFFUSE",i:[{type:"node_in",name:"kj",qualifier:["vec3"],f:!1},{type:"node_in",name:"kk",qualifier:["float"],f:!1},{type:"node_in",name:"kl",
qualifier:["vec3"],f:!1},{type:"node_out",name:"km",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["km","=","kj",";"]},{type:"textline",b:["kk",";","kl",";"]}]},{type:"node",name:"BSDF_GLASS",i:[{type:"node_in",name:"kn",qualifier:["vec3"],f:!1},{type:"node_in",name:"ko",qualifier:["float"],f:!1},{type:"node_in",name:"kp",qualifier:["float"],f:!1},{type:"node_in",name:"kq",qualifier:["vec3"],f:!1},{type:"node_out",name:"kr",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["kr","=","kn",";"]},{type:"textline",
b:"ko ; kp ; kq ;".split(" ")}]},{type:"node",name:"BSDF_GLOSSY",i:[{type:"node_in",name:"ks",qualifier:["vec3"],f:!1},{type:"node_in",name:"kt",qualifier:["float"],f:!1},{type:"node_in",name:"ku",qualifier:["vec3"],f:!1},{type:"node_out",name:"kv",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["kv","=","ks",";"]},{type:"textline",b:["kt",";","ku",";"]}]},{type:"node",name:"BSDF_HAIR",i:[{type:"node_in",name:"kw",qualifier:["vec3"],f:!1},{type:"node_in",name:"kx",qualifier:["float"],f:!1},{type:"node_in",
name:"ky",qualifier:["float"],f:!1},{type:"node_in",name:"kz",qualifier:["float"],f:!1},{type:"node_out",name:"kA",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["kA","=","kw",";"]},{type:"textline",b:"kx ; ky ; kz ;".split(" ")}]},{type:"node",name:"BSDF_TRANSPARENT",i:[{type:"node_in",name:"kB",qualifier:["vec3"],f:!1},{type:"node_out",name:"kC",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["kC","=","kB",";"]}]},{type:"node",name:"BSDF_TRANSLUCENT",i:[{type:"node_in",name:"kD",qualifier:["vec3"],
f:!1},{type:"node_in",name:"kE",qualifier:["vec3"],f:!1},{type:"node_out",name:"kF",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["kF","=","kD",";"]},{type:"textline",b:["kE",";"]}]},{type:"node",name:"BSDF_REFRACTION",i:[{type:"node_in",name:"kG",qualifier:["vec3"],f:!1},{type:"node_in",name:"kH",qualifier:["float"],f:!1},{type:"node_in",name:"kI",qualifier:["float"],f:!1},{type:"node_in",name:"kJ",qualifier:["vec3"],f:!1},{type:"node_out",name:"kK",qualifier:["vec3"],f:!1}],g:[{type:"textline",
b:"kK [ 0 ] = kK [ 1 ] = kK [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"kG ; kH ; kI ; kJ ;".split(" ")}]},{type:"node",name:"BSDF_TOON",i:[{type:"node_in",name:"kL",qualifier:["vec3"],f:!1},{type:"node_in",name:"kM",qualifier:["float"],f:!1},{type:"node_in",name:"kN",qualifier:["float"],f:!1},{type:"node_in",name:"kO",qualifier:["vec3"],f:!1},{type:"node_out",name:"kP",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["kP","=","kL",";"]},{type:"textline",b:"kM ; kN ; kO ;".split(" ")}]},
{type:"node",name:"BSDF_VELVET",i:[{type:"node_in",name:"kQ",qualifier:["vec3"],f:!1},{type:"node_in",name:"kR",qualifier:["float"],f:!1},{type:"node_in",name:"kS",qualifier:["vec3"],f:!1},{type:"node_out",name:"kT",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["kT","=","kQ",";"]},{type:"textline",b:["kR",";","kS",";"]}]},{type:"node",name:"SUBSURFACE_SCATTERING",i:[{type:"node_in",name:"kU",qualifier:["vec3"],f:!1},{type:"node_in",name:"kV",qualifier:["float"],f:!1},{type:"node_in",name:"kW",
qualifier:["vec3"],f:!1},{type:"node_in",name:"kX",qualifier:["float"],f:!1},{type:"node_in",name:"kY",qualifier:["float"],f:!1},{type:"node_in",name:"kZ",qualifier:["vec3"],f:!1},{type:"node_out",name:"k_",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"k_ [ 0 ] = k_ [ 1 ] = k_ [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"kU ; kW ; kX ; kY ; kZ ; kV ;".split(" ")}]},{type:"node",name:"EMISSION",i:[{type:"node_in",name:"la",qualifier:["vec3"],f:!1},{type:"node_in",name:"lb",qualifier:["float"],
f:!1},{type:"node_out",name:"lc",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["lc","=","la",";"]},{type:"textline",b:["lb",";"]}]},{type:"node",name:"AMBIENT_OCCLUSION",i:[{type:"node_in",name:"ld",qualifier:["vec3"],f:!1},{type:"node_out",name:"le",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"le [ 0 ] = le [ 1 ] = le [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["ld",";"]}]},{type:"node",name:"HOLDOUT",i:[{type:"node_out",name:"lf",qualifier:["vec3"],f:!1}],g:[{type:"textline",
b:"lf [ 0 ] = lf [ 1 ] = lf [ 2 ] = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"VOLUME_ABSORPTION",i:[{type:"node_in",name:"lg",qualifier:["vec3"],f:!1},{type:"node_in",name:"lh",qualifier:["float"],f:!1},{type:"node_out",name:"li",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"li [ 0 ] = li [ 1 ] = li [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["lg",";","lh",";"]}]},{type:"node",name:"VOLUME_SCATTER",i:[{type:"node_in",name:"lj",qualifier:["vec3"],f:!1},{type:"node_in",
name:"lk",qualifier:["float"],f:!1},{type:"node_in",name:"ll",qualifier:["float"],f:!1},{type:"node_out",name:"lm",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"lm [ 0 ] = lm [ 1 ] = lm [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"lj ; lk ; ll ;".split(" ")}]},{type:"node",name:"BUMP",i:[{type:"node_in",name:"ln",qualifier:["float"],f:!1},{type:"node_in",name:"lo",qualifier:["float"],f:!1},{type:"node_in",name:"lp",qualifier:["float"],f:!1},{type:"node_in",name:"lq",qualifier:["vec3"],
f:!1},{type:"node_out",name:"lr",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["lr","=","lq",";"]},{type:"textline",b:"ln ; lo ; lp ;".split(" ")}]},{type:"node",name:"NORMAL_MAP",i:[{type:"node_in",name:"ls",qualifier:["float"],f:!1},{type:"node_in",name:"lt",qualifier:["vec3"],f:!1},{type:"node_out",name:"lu",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["lu","=","lt",";"]},{type:"textline",b:["ls",";"]}]},{type:"node",name:"VECT_TRANSFORM",i:[{type:"node_in",name:"lv",qualifier:["vec3"],
f:!1},{type:"node_out",name:"lw",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"lw [ 0 ] = lw [ 1 ] = lw [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["lv",";"]}]},{type:"node",name:"BLACKBODY",i:[{type:"node_in",name:"lx",qualifier:["float"],f:!1},{type:"node_out",name:"ly",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"ly [ 0 ] = ly [ 1 ] = ly [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["lx",";"]}]},{type:"node",name:"WAVELENGTH",i:[{type:"node_in",name:"lz",qualifier:["float"],
f:!1},{type:"node_out",name:"lA",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"lA [ 0 ] = lA [ 1 ] = lA [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["lz",";"]}]},{type:"node",name:"SEPXYZ",i:[{type:"node_in",name:"lB",qualifier:["vec3"],f:!1},{type:"node_out",name:"lC",qualifier:["float"],f:!1},{type:"node_out",name:"lD",qualifier:["float"],f:!1},{type:"node_out",name:"lE",qualifier:["float"],f:!1}],g:[{type:"textline",b:"lC = lB [ 0 ] ; lD = lB [ 1 ] ; lE = lB [ 2 ] ;".split(" ")}]},
{type:"node",name:"COMBXYZ",i:[{type:"node_in",name:"lF",qualifier:["float"],f:!1},{type:"node_in",name:"lG",qualifier:["float"],f:!1},{type:"node_in",name:"lH",qualifier:["float"],f:!1},{type:"node_out",name:"lI",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"lI [ 0 ] = lF ; lI [ 1 ] = lG ; lI [ 2 ] = lH ;".split(" ")}]},{type:"node",name:"BRIGHTCONTRAST",i:[{type:"node_in",name:"lJ",qualifier:["vec3"],f:!1},{type:"node_in",name:"lK",qualifier:["float"],f:!1},{type:"node_in",name:"lL",qualifier:["float"],
f:!1},{type:"node_out",name:"lM",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iF = lK - lL * 0.5 ; lM = max ( ( UNITY_VALUE_NODES + lL ) * lJ + iF , hK ) ;".split(" ")}]},{type:"node",name:"LIGHT_FALLOFF",i:[{type:"node_in",name:"lN",qualifier:["float"],f:!1},{type:"node_in",name:"lO",qualifier:["float"],f:!1},{type:"node_out",name:"lP",qualifier:["float"],f:!1},{type:"node_out",name:"lQ",qualifier:["float"],f:!1},{type:"node_out",name:"lR",qualifier:["float"],f:!1}],g:[{type:"textline",b:"lP = lQ = lR = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",b:["lN",";","lO",";"]}]},{type:"node",name:"TEX_IMAGE",i:[{type:"node_in",name:"lS",qualifier:["vec3"],f:!1},{type:"node_out",name:"lT",qualifier:["vec3"],f:!1},{type:"node_out",name:"lU",qualifier:["float"],f:!1}],g:[{type:"textline",b:"lT [ 0 ] = lT [ 1 ] = lT [ 2 ] = ZERO_VALUE_NODES ; lU = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["lS",";"]}]},{type:"node",name:"TEX_ENVIRONMENT",i:[{type:"node_in",name:"lV",qualifier:["vec3"],f:!1},{type:"node_out",name:"lW",qualifier:["vec3"],
f:!1}],g:[{type:"textline",b:"lW [ 0 ] = lW [ 1 ] = lW [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["lV",";"]}]},{type:"node",name:"TEX_SKY",i:[{type:"node_in",name:"lX",qualifier:["vec3"],f:!1},{type:"node_out",name:"lY",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"lY [ 0 ] = lY [ 1 ] = lY [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["lX",";"]}]},{type:"node",name:"TEX_NOISE",i:[{type:"node_in",name:"lZ",qualifier:["vec3"],f:!1},{type:"node_in",name:"l_",qualifier:["float"],
f:!1},{type:"node_in",name:"ma",qualifier:["float"],f:!1},{type:"node_in",name:"mb",qualifier:["float"],f:!1},{type:"node_out",name:"mc",qualifier:["vec3"],f:!1},{type:"node_out",name:"md",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mc [ 0 ] = mc [ 1 ] = mc [ 2 ] = ZERO_VALUE_NODES ; md = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"lZ ; l_ ; ma ; mb ;".split(" ")}]},{type:"node",name:"TEX_WAVE",i:[{type:"node_in",name:"me",qualifier:["vec3"],f:!1},{type:"node_in",name:"mf",qualifier:["float"],
f:!1},{type:"node_in",name:"mg",qualifier:["float"],f:!1},{type:"node_in",name:"mh",qualifier:["float"],f:!1},{type:"node_in",name:"mi",qualifier:["float"],f:!1},{type:"node_out",name:"mj",qualifier:["vec3"],f:!1},{type:"node_out",name:"mk",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mj [ 0 ] = mj [ 1 ] = mj [ 2 ] = ZERO_VALUE_NODES ; mk = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"me ; mf ; mg ; mh ; mi ;".split(" ")}]},{type:"node",name:"TEX_VORONOI",i:[{type:"node_in",name:"ml",
qualifier:["vec3"],f:!1},{type:"node_in",name:"mm",qualifier:["float"],f:!1},{type:"node_out",name:"mn",qualifier:["vec3"],f:!1},{type:"node_out",name:"mo",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mn [ 0 ] = mn [ 1 ] = mn [ 2 ] = ZERO_VALUE_NODES ; mo = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["ml",";","mm",";"]}]},{type:"node",name:"TEX_MUSGRAVE",i:[{type:"node_in",name:"mp",qualifier:["vec3"],f:!1},{type:"node_in",name:"mq",qualifier:["float"],f:!1},{type:"node_in",name:"mr",
qualifier:["float"],f:!1},{type:"node_in",name:"ms",qualifier:["float"],f:!1},{type:"node_in",name:"mt",qualifier:["float"],f:!1},{type:"node_in",name:"mu",qualifier:["float"],f:!1},{type:"node_in",name:"mv",qualifier:["float"],f:!1},{type:"node_out",name:"mw",qualifier:["vec3"],f:!1},{type:"node_out",name:"mx",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mw [ 0 ] = mw [ 1 ] = mw [ 2 ] = ZERO_VALUE_NODES ; mx = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"mp ; mq ; mr ; ms ; mt ; mu ; mv ;".split(" ")}]},
{type:"node",name:"TEX_GRADIENT",i:[{type:"node_in",name:"my",qualifier:["vec3"],f:!1},{type:"node_out",name:"mz",qualifier:["vec3"],f:!1},{type:"node_out",name:"mA",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mz [ 0 ] = mz [ 1 ] = mz [ 2 ] = ZERO_VALUE_NODES ; mA = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["my",";"]}]},{type:"node",name:"TEX_MAGIC",i:[{type:"node_in",name:"mB",qualifier:["vec3"],f:!1},{type:"node_in",name:"mC",qualifier:["float"],f:!1},{type:"node_in",name:"mD",
qualifier:["float"],f:!1},{type:"node_out",name:"mE",qualifier:["vec3"],f:!1},{type:"node_out",name:"mF",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mE [ 0 ] = mE [ 1 ] = mE [ 2 ] = ZERO_VALUE_NODES ; mF = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"mB ; mC ; mD ;".split(" ")}]},{type:"node",name:"TEX_CHECKER",i:[{type:"node_in",name:"mG",qualifier:["vec3"],f:!1},{type:"node_in",name:"mH",qualifier:["vec3"],f:!1},{type:"node_in",name:"mI",qualifier:["vec3"],f:!1},{type:"node_in",name:"mJ",
qualifier:["float"],f:!1},{type:"node_out",name:"mK",qualifier:["vec3"],f:!1},{type:"node_out",name:"mL",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mK [ 0 ] = mK [ 1 ] = mK [ 2 ] = ZERO_VALUE_NODES ; mL = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"mG ; mH ; mI ; mJ ;".split(" ")}]},{type:"node",name:"TEX_BRICK",i:[{type:"node_in",name:"mM",qualifier:["vec3"],f:!1},{type:"node_in",name:"mN",qualifier:["vec3"],f:!1},{type:"node_in",name:"mO",qualifier:["vec3"],f:!1},{type:"node_in",
name:"mP",qualifier:["vec3"],f:!1},{type:"node_in",name:"mQ",qualifier:["float"],f:!1},{type:"node_in",name:"mR",qualifier:["float"],f:!1},{type:"node_in",name:"mS",qualifier:["float"],f:!1},{type:"node_in",name:"mT",qualifier:["float"],f:!1},{type:"node_in",name:"mU",qualifier:["float"],f:!1},{type:"node_out",name:"mV",qualifier:["vec3"],f:!1},{type:"node_out",name:"mW",qualifier:["float"],f:!1}],g:[{type:"textline",b:"mV [ 0 ] = mV [ 1 ] = mV [ 2 ] = ZERO_VALUE_NODES ; mW = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",b:"mM ; mN ; mO ; mP ; mQ ; mR ; mS ; mT ; mU ;".split(" ")}]},{type:"node",name:"ADD_SHADER",i:[{type:"node_in",name:"mX",qualifier:["vec3"],f:!1},{type:"node_in",name:"mY",qualifier:["vec3"],f:!1},{type:"node_out",name:"mZ",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"mZ = clamp ( mX + mY , hK , hL ) ;".split(" ")}]},{type:"node",name:"MIX_SHADER",i:[{type:"node_in",name:"m_",qualifier:["float"],f:!1},{type:"node_in",name:"na",qualifier:["vec3"],f:!1},{type:"node_in",name:"nb",
qualifier:["vec3"],f:!1},{type:"node_out",name:"nc",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( m_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; nc = iE * na + ( UNITY_VALUE_NODES - iE ) * nb ;".split(" ")}]},{type:"node",name:"UV_MERGED",i:[{type:"node_out",name:"nd",qualifier:["vec3"],f:!1},{type:"node_out",name:"ne",qualifier:["vec3"],f:!1},{type:"node_param",name:"ij",qualifier:["varying","vec2"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nd"],g:[{type:"textline",
b:"nd = h_ ( ij ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ne"],g:[{type:"textline",b:"ne = vec3 ( ij , ZERO_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"TEX_COORD_UV",i:[{type:"node_out",name:"nf",qualifier:["vec3"],f:!1},{type:"node_param",name:"ik",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"nf = vec3 ( ik , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_NO",i:[{type:"node_out",name:"ng",qualifier:["vec3"],f:!1}],g:[{type:"textline",
b:["ng","=","iP",";"]}]},{type:"node",name:"TEX_COORD_GE",i:[{type:"node_out",name:"nh",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"nh = abs ( hJ ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_OB",i:[{type:"node_out",name:"ni",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"ni [ 0 ] = ni [ 1 ] = ni [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_CA",i:[{type:"node_out",name:"nj",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"nj [ 0 ] = iL [ 0 ] ; nj [ 1 ] = iL [ 1 ] ; nj [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"TEX_COORD_WI",i:[{type:"node_out",name:"nk",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"nk [ 0 ] = nk [ 1 ] = nk [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_RE",i:[{type:"node_out",name:"nl",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"nl [ 0 ] = nl [ 1 ] = nl [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"UVMAP",i:[{type:"node_out",name:"nm",qualifier:["vec3"],f:!1},{type:"node_param",name:"il",qualifier:["varying","vec2"]}],
g:[{type:"textline",b:"nm = vec3 ( il , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"PARTICLE_INFO",i:[{type:"node_out",name:"nn",qualifier:["float"],f:!1},{type:"node_out",name:"no",qualifier:["float"],f:!1},{type:"node_out",name:"np",qualifier:["float"],f:!1},{type:"node_out",name:"nq",qualifier:["vec3"],f:!1},{type:"node_out",name:"nr",qualifier:["float"],f:!1},{type:"node_out",name:"ns",qualifier:["vec3"],f:!1},{type:"node_out",name:"nt",qualifier:["vec3"],f:!1}],g:[{type:"textline",
b:"nn = ZERO_VALUE_NODES ; no = ZERO_VALUE_NODES ; np = ZERO_VALUE_NODES ; nq = vec3 ( ZERO_VALUE_NODES ) ; nr = ZERO_VALUE_NODES ; ns = nq ; nt = nq ;".split(" ")}]},{type:"node",name:"HAIR_INFO",i:[{type:"node_out",name:"nu",qualifier:["float"],f:!1},{type:"node_out",name:"nv",qualifier:["float"],f:!1},{type:"node_out",name:"nw",qualifier:["float"],f:!1},{type:"node_out",name:"nx",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"nu = ZERO_VALUE_NODES ; nv = ZERO_VALUE_NODES ; nw = ZERO_VALUE_NODES ; nx = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"OBJECT_INFO",i:[{type:"node_out",name:"ny",qualifier:["vec3"],f:!1},{type:"node_out",name:"nz",qualifier:["float"],f:!1},{type:"node_out",name:"nA",qualifier:["float"],f:!1},{type:"node_out",name:"nB",qualifier:["float"],f:!1}],g:[{type:"textline",b:"nz = ZERO_VALUE_NODES ; nA = ZERO_VALUE_NODES ; nB = ZERO_VALUE_NODES ; ny = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"WIREFRAME",i:[{type:"node_in",name:"nC",qualifier:["float"],f:!1},{type:"node_out",name:"nD",
qualifier:["float"],f:!1}],g:[{type:"textline",b:["nD","=","nC",";"]}]},{type:"node",name:"TANGENT",i:[{type:"node_out",name:"nE",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"nE = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LAYER_WEIGHT",i:[{type:"node_in",name:"nF",qualifier:["float"],f:!1},{type:"node_in",name:"nG",qualifier:["vec3"],f:!1},{type:"node_out",name:"nH",qualifier:["float"],f:!1},{type:"node_out",name:"nI",qualifier:["float"],f:!1}],g:[{type:"textline",b:"nH = nI = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",b:["nG",";","nF",";"]}]},{type:"node",name:"LIGHT_PATH",i:[{type:"node_out",name:"nJ",qualifier:["float"],f:!1},{type:"node_out",name:"nK",qualifier:["float"],f:!1},{type:"node_out",name:"nL",qualifier:["float"],f:!1},{type:"node_out",name:"nM",qualifier:["float"],f:!1},{type:"node_out",name:"nN",qualifier:["float"],f:!1},{type:"node_out",name:"nO",qualifier:["float"],f:!1},{type:"node_out",name:"nP",qualifier:["float"],f:!1},{type:"node_out",name:"nQ",qualifier:["float"],f:!1},{type:"node_out",
name:"nR",qualifier:["float"],f:!1},{type:"node_out",name:"nS",qualifier:["float"],f:!1}],g:[{type:"textline",b:"nJ = nK = nL = ZERO_VALUE_NODES ; nM = nN = nO = ZERO_VALUE_NODES ; nP = nP = nR = nS = ZERO_VALUE_NODES ; nQ = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"ATTRIBUTE",i:[{type:"node_out",name:"nT",qualifier:["vec3"],f:!1},{type:"node_out",name:"nU",qualifier:["vec3"],f:!1},{type:"node_out",name:"nV",qualifier:["float"],f:!1}],g:[{type:"textline",b:"nT = nU = vec3 ( ZERO_VALUE_NODES ) ; nV = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"SCRIPT",i:[],g:[]},{type:"node",name:"CURVE_VEC",i:[{type:"node_in",name:"nW",qualifier:["float"],f:!1},{type:"node_in",name:"nX",qualifier:["vec3"],f:!1},{type:"node_out",name:"nY",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:["nY","=","nX",";"]},{type:"textline",b:["nW",";"]}]},{type:"node",name:"CURVE_RGB",i:[{type:"node_in",name:"nZ",qualifier:["float"],f:!1},{type:"node_in",name:"n_",qualifier:["vec3"],f:!1},{type:"node_out",name:"oa",qualifier:["vec3"],f:!1}],g:[{type:"textline",
b:["oa","=","n_",";"]},{type:"textline",b:["nZ",";"]}]},{type:"node",name:"VALTORGB",i:[{type:"node_in",name:"ob",qualifier:["float"],f:!1},{type:"node_out",name:"oc",qualifier:["vec3"],f:!1},{type:"node_out",name:"od",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oc [ 0 ] = oc [ 1 ] = oc [ 2 ] = clamp ( ob , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; od = oc [ 0 ] ;".split(" ")}]},{type:"node",name:"MAPPING",i:[{type:"node_in",name:"oe",qualifier:["vec3"],f:!1},{type:"node_out",name:"of",qualifier:["vec3"],
f:!1}],g:[{type:"textline",b:["of","=","oe",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",g:[{type:"textline",b:"of = ( MAPPING_TRS_MATRIX * vec4 ( of , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_SCALE",g:[{type:"textline",b:"of = of * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",g:[{type:"textline",b:"of = of + MAPPING_TRANSLATION ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",g:[{type:"textline",b:"of = max ( of , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",g:[{type:"textline",b:"of = min ( of , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],g:[{type:"textline",b:"of = normalize ( of ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",i:[{type:"node_in",name:"og",qualifier:["float"],
f:!1},{type:"node_in",name:"oh",qualifier:["float"],f:!1},{type:"node_out",name:"oi",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oi = og + oh ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oi = clamp ( oi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",i:[{type:"node_in",name:"oj",qualifier:["float"],f:!1},{type:"node_in",name:"ok",qualifier:["float"],f:!1},{type:"node_out",name:"ol",qualifier:["float"],
f:!1}],g:[{type:"textline",b:"ol = oj - ok ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ol = clamp ( ol , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MULTIPLY",i:[{type:"node_in",name:"om",qualifier:["float"],f:!1},{type:"node_in",name:"on",qualifier:["float"],f:!1},{type:"node_out",name:"oo",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oo = om * on ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oo = clamp ( oo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",i:[{type:"node_in",name:"op",qualifier:["float"],f:!1},{type:"node_in",name:"oq",qualifier:["float"],f:!1},{type:"node_out",name:"or",qualifier:["float"],f:!1}],g:[{type:"textline",b:"or = ( oq != ZERO_VALUE_NODES ) ? op / oq : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"or = clamp ( or , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_SINE",i:[{type:"node_in",name:"os",qualifier:["float"],f:!1},{type:"node_in",name:"ot",qualifier:["float"],f:!1},{type:"node_out",name:"ou",qualifier:["float"],f:!1}],g:[{type:"textline",b:"ou = sin ( os ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ou = clamp ( ou , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["ot",";"]}]},{type:"node",name:"MATH_COSINE",i:[{type:"node_in",name:"ov",
qualifier:["float"],f:!1},{type:"node_in",name:"ow",qualifier:["float"],f:!1},{type:"node_out",name:"ox",qualifier:["float"],f:!1}],g:[{type:"textline",b:"ox = cos ( ov ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ox = clamp ( ox , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["ow",";"]}]},{type:"node",name:"MATH_TANGENT",i:[{type:"node_in",name:"oy",qualifier:["float"],f:!1},{type:"node_in",name:"oz",qualifier:["float"],
f:!1},{type:"node_out",name:"oA",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oA = tan ( oy ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oA = clamp ( oA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["oz",";"]}]},{type:"node",name:"MATH_ARCSINE",i:[{type:"node_in",name:"oB",qualifier:["float"],f:!1},{type:"node_in",name:"oC",qualifier:["float"],f:!1},{type:"node_out",name:"oD",qualifier:["float"],f:!1}],
g:[{type:"textline",b:"oD = ( oB <= UNITY_VALUE_NODES && oB >= - UNITY_VALUE_NODES ) ? asin ( oB ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oD = clamp ( oD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["oC",";"]}]},{type:"node",name:"MATH_ARCCOSINE",i:[{type:"node_in",name:"oE",qualifier:["float"],f:!1},{type:"node_in",name:"oF",qualifier:["float"],f:!1},{type:"node_out",name:"oG",qualifier:["float"],
f:!1}],g:[{type:"textline",b:"oG = ( oE <= UNITY_VALUE_NODES && oE >= - UNITY_VALUE_NODES ) ? acos ( oE ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oG = clamp ( oG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["oF",";"]}]},{type:"node",name:"MATH_ARCTANGENT",i:[{type:"node_in",name:"oH",qualifier:["float"],f:!1},{type:"node_in",name:"oI",qualifier:["float"],f:!1},{type:"node_out",name:"oJ",
qualifier:["float"],f:!1}],g:[{type:"textline",b:"oJ = atan ( oH ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oJ = clamp ( oJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["oI",";"]}]},{type:"node",name:"MATH_POWER",i:[{type:"node_in",name:"oK",qualifier:["float"],f:!1},{type:"node_in",name:"oL",qualifier:["float"],f:!1},{type:"node_out",name:"oM",qualifier:["float"],f:!1}],g:[{type:"textline",b:"if ( oK < ZERO_VALUE_NODES || oK == ZERO_VALUE_NODES && oL == ZERO_VALUE_NODES ) oM = ZERO_VALUE_NODES ; else oM = pow ( oK , oL ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oM = clamp ( oM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",i:[{type:"node_in",name:"oN",qualifier:["float"],f:!1},{type:"node_in",name:"oO",qualifier:["float"],f:!1},{type:"node_out",name:"oP",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oP = ( oN > ZERO_VALUE_NODES && oO > ZERO_VALUE_NODES ) ? log2 ( oN ) / log2 ( oO ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oP = clamp ( oP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MINIMUM",i:[{type:"node_in",name:"oQ",qualifier:["float"],f:!1},{type:"node_in",name:"oR",qualifier:["float"],f:!1},{type:"node_out",name:"oS",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oS = min ( oQ , oR ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oS = clamp ( oS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MAXIMUM",i:[{type:"node_in",name:"oT",qualifier:["float"],f:!1},{type:"node_in",name:"oU",qualifier:["float"],f:!1},{type:"node_out",name:"oV",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oV = max ( oT , oU ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oV = clamp ( oV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",i:[{type:"node_in",name:"oW",qualifier:["float"],f:!1},
{type:"node_in",name:"oX",qualifier:["float"],f:!1},{type:"node_out",name:"oY",qualifier:["float"],f:!1}],g:[{type:"textline",b:"oY = floor ( oW + 0.5 ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"oY = clamp ( oY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["oX",";"]}]},{type:"node",name:"MATH_LESS_THAN",i:[{type:"node_in",name:"oZ",qualifier:["float"],f:!1},{type:"node_in",name:"o_",qualifier:["float"],f:!1},
{type:"node_out",name:"pa",qualifier:["float"],f:!1}],g:[{type:"textline",b:"pa = ( oZ < o_ ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"pa = clamp ( pa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",i:[{type:"node_in",name:"pb",qualifier:["float"],f:!1},{type:"node_in",name:"pc",qualifier:["float"],f:!1},{type:"node_out",name:"pd",qualifier:["float"],
f:!1}],g:[{type:"textline",b:"pd = ( pb > pc ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"pd = clamp ( pd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",i:[{type:"node_in",name:"pe",qualifier:["float"],f:!1},{type:"node_in",name:"pf",qualifier:["float"],f:!1},{type:"node_out",name:"pg",qualifier:["float"],f:!1}],g:[{type:"textline",b:"pg = abs ( pf ) > 0.000001 ? mod ( pe , pf ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"pg = clamp ( pg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ABSOLUTE",i:[{type:"node_in",name:"ph",qualifier:["float"],f:!1},{type:"node_in",name:"pi",qualifier:["float"],f:!1},{type:"node_out",name:"pj",qualifier:["float"],f:!1}],g:[{type:"textline",b:"pj = abs ( ph ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"pj = clamp ( pj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["pi",";"]}]},{type:"node",name:"MIX_RGB_MIX",i:[{type:"node_in",name:"pk",qualifier:["float"],f:!1},{type:"node_in",name:"pl",qualifier:["vec3"],f:!1},{type:"node_in",name:"pm",qualifier:["vec3"],f:!1},{type:"node_out",name:"pn",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pn = mix ( pl , pm , iE ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pn = clamp ( pn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_ADD",i:[{type:"node_in",name:"po",qualifier:["float"],f:!1},{type:"node_in",name:"pp",qualifier:["vec3"],f:!1},{type:"node_in",name:"pq",qualifier:["vec3"],f:!1},{type:"node_out",name:"pr",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( po , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pr = mix ( pp , pp + pq , iE ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pr = clamp ( pr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_MULTIPLY",i:[{type:"node_in",name:"ps",qualifier:["float"],f:!1},{type:"node_in",name:"pt",qualifier:["vec3"],f:!1},{type:"node_in",name:"pu",qualifier:["vec3"],f:!1},{type:"node_out",name:"pv",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( ps , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pv = mix ( pt , pt * pu , iE ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pv = clamp ( pv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SUBTRACT",i:[{type:"node_in",name:"pw",qualifier:["float"],f:!1},{type:"node_in",name:"px",qualifier:["vec3"],f:!1},{type:"node_in",name:"py",qualifier:["vec3"],f:!1},{type:"node_out",name:"pz",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pz = mix ( px , px - py , iE ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pz = clamp ( pz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SCREEN",i:[{type:"node_in",name:"pA",qualifier:["float"],f:!1},{type:"node_in",name:"pB",qualifier:["vec3"],f:!1},{type:"node_in",name:"pC",qualifier:["vec3"],f:!1},{type:"node_out",name:"pD",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iD = UNITY_VALUE_NODES - iE ; pD = hL - ( vec3 ( iD ) + iE * ( hL - pC ) ) * ( hL - pB ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",
b:"pD = clamp ( pD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",i:[{type:"node_in",name:"pE",qualifier:["float"],f:!1},{type:"node_in",name:"pF",qualifier:["vec3"],f:!1},{type:"node_in",name:"pG",qualifier:["vec3"],f:!1},{type:"node_out",name:"pH",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iD = UNITY_VALUE_NODES - iE ; pG += step ( pG , hK ) ; pH = iD * pF + iE * pF / pG ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pH = clamp ( pH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",i:[{type:"node_in",name:"pI",qualifier:["float"],f:!1},{type:"node_in",name:"pJ",qualifier:["vec3"],f:!1},{type:"node_in",name:"pK",qualifier:["vec3"],f:!1},{type:"node_out",name:"pL",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pL = mix ( pJ , abs ( pJ - pK ) , iE ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pL = clamp ( pL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",i:[{type:"node_in",name:"pM",qualifier:["float"],f:!1},{type:"node_in",name:"pN",qualifier:["vec3"],f:!1},{type:"node_in",name:"pO",qualifier:["vec3"],f:!1},{type:"node_out",name:"pP",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pP = min ( pN . rgb , pO . rgb * iE ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pP = clamp ( pP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",i:[{type:"node_in",name:"pQ",qualifier:["float"],f:!1},{type:"node_in",name:"pR",qualifier:["vec3"],f:!1},{type:"node_in",name:"pS",qualifier:["vec3"],f:!1},{type:"node_out",name:"pT",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pT = max ( pR . rgb , pS . rgb * iE ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pT = clamp ( pT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_OVERLAY",i:[{type:"node_in",name:"pU",qualifier:["float"],f:!1},{type:"node_in",name:"pV",qualifier:["vec3"],f:!1},{type:"node_in",name:"pW",qualifier:["vec3"],f:!1},{type:"node_out",name:"pX",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iS = vec3 ( UNITY_VALUE_NODES - iE ) ; pX = mix ( pV * ( iS + 2.0 * iE * pW ) , hL - ( iS + 2.0 * iE * ( hL - pW ) ) * ( hL - pV ) , step ( 0.5 , pV ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"pX = clamp ( pX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",i:[{type:"node_in",name:"pY",qualifier:["float"],f:!1},{type:"node_in",name:"pZ",qualifier:["vec3"],f:!1},{type:"node_in",name:"p_",qualifier:["vec3"],f:!1},{type:"node_out",name:"qa",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( pY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iS = hL - iE * p_ ; iR = clamp ( pZ / iS , 0.0 , 1.0 ) ; qa = mix ( mix ( iR , hL , step ( iS , hK ) ) , pZ , step ( pZ , hK ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qa = clamp ( qa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_BURN",i:[{type:"node_in",name:"qb",qualifier:["float"],f:!1},{type:"node_in",name:"qc",qualifier:["vec3"],f:!1},{type:"node_in",name:"qd",qualifier:["vec3"],f:!1},{type:"node_out",name:"qe",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( qb , 0.0 , 1.0 ) ; iS = vec3 ( 1.0 - iE ) ; iS = iS + iE * qd ; iR = clamp ( hL - ( hL - qc ) / iS , 0.0 , 1.0 ) ; qe = mix ( iR , hK , step ( iS , hK ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qe = clamp ( qe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",i:[{type:"node_in",name:"qf",qualifier:["float"],f:!1},{type:"node_in",name:"qg",qualifier:["vec3"],f:!1},{type:"node_in",name:"qh",qualifier:["vec3"],f:!1},{type:"node_out",name:"qi",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( qf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qi = qg ; iR = hU ( qh ) ; if ( iR . y != ZERO_VALUE_NODES ) { iS = hU ( qi ) ; iS . x = iR . x ; iT = hY ( iS ) ; qi = mix ( qi , iT , iE ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qi = clamp ( qi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",i:[{type:"node_in",name:"qj",qualifier:["float"],f:!1},{type:"node_in",name:"qk",qualifier:["vec3"],f:!1},{type:"node_in",name:"ql",qualifier:["vec3"],f:!1},{type:"node_out",name:"qm",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( qj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iD = UNITY_VALUE_NODES - iE ; qm = qk ; iT = hU ( qm ) ; if ( iT . y != ZERO_VALUE_NODES ) { iR = hU ( ql ) ; iT . y = iD * iT . y + iE * iR . y ; qm = hY ( iT ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qm = clamp ( qm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",i:[{type:"node_in",name:"qn",qualifier:["float"],f:!1},{type:"node_in",name:"qo",qualifier:["vec3"],f:!1},{type:"node_in",name:"qp",qualifier:["vec3"],f:!1},{type:"node_out",name:"qq",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( qn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iD = UNITY_VALUE_NODES - iE ; iR = hU ( qo ) ; iU = hU ( qp ) ; iR . z = iD * iR . z + iE * iU . z ; qq = hY ( iR ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qq = clamp ( qq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",i:[{type:"node_in",name:"qr",qualifier:["float"],f:!1},{type:"node_in",name:"qs",qualifier:["vec3"],f:!1},{type:"node_in",name:"qt",qualifier:["vec3"],f:!1},{type:"node_out",name:"qu",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( qr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qu = qs ; iV = hU ( qt ) ; if ( iV . y != ZERO_VALUE_NODES ) { iU = hU ( qu ) ; iU . x = iV . x ; iU . y = iV . y ; iW = hY ( iU ) ; qu = mix ( qu , iW , iE ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qu = clamp ( qu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",i:[{type:"node_in",name:"qv",qualifier:["float"],f:!1},{type:"node_in",name:"qw",qualifier:["vec3"],f:!1},{type:"node_in",name:"qx",qualifier:["vec3"],f:!1},{type:"node_out",name:"qy",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( qv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iD = UNITY_VALUE_NODES - iE ; iW = qx + qw - qx * qw ; qy = qw * ( vec3 ( iD ) + vec3 ( iE ) * ( ( hL - qw ) * qx + iW ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qy = clamp ( qy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",i:[{type:"node_in",name:"qz",qualifier:["float"],f:!1},{type:"node_in",name:"qA",qualifier:["vec3"],f:!1},{type:"node_in",name:"qB",qualifier:["vec3"],f:!1},{type:"node_out",name:"qC",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"iE = clamp ( qz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qC = qA + iE * ( 2.0 * qB - hL ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"qC = clamp ( qC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",i:[{type:"node_in",name:"qD",qualifier:["vec3"],f:!1},{type:"node_in",name:"qE",qualifier:["float"],f:!1}],g:[{type:"textline",b:"iu = qD ; iy = qE ;".split(" ")}]},{type:"node",name:"MATERIAL",i:[{type:"node_in",name:"qF",qualifier:["vec3"],f:!1},{type:"node_in",name:"qG",qualifier:["vec3"],f:!1},{type:"node_in",
name:"qH",qualifier:["float"],f:!1},{type:"node_in",name:"qI",qualifier:["vec3"],f:!0},{type:"node_out",name:"qJ",qualifier:["vec3"],f:!0},{type:"node_out",name:"qK",qualifier:["float"],f:!0},{type:"node_out",name:"qL",qualifier:["vec3"],f:!0},{type:"node_param",name:"im",qualifier:["float"]},{type:"node_param",name:"io",qualifier:["float"]},{type:"node_param",name:"ip",qualifier:["const","vec2"]},{type:"node_param",name:"iq",qualifier:["const","vec3"]}],g:[{type:"textline",b:"iW = clamp ( qF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},
{type:"textline",b:"iV = iq [ 0 ] * clamp ( qG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],g:[{type:"textline",b:"iX = normalize ( qI ) ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["iX","=","iP",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["SHADELESS_MAT",{type:"logic_negative_expr",d:1},"NODES_GLOW",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],g:[{type:"textline",b:"iY = iB * iW ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:["iW","*=","qH",";"]}]}]},{type:"textline",b:"iZ = iC * u_environment_energy * hu ( iX ) ; iE = gY ( iW ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],g:[{type:"textline",b:"iz = vec2 ( ip [ 0 ] , ip [ 1 ] ) ;".split(" ")},{type:"textline",b:"iA = vec2 ( iq [ 1 ] , iq [ 2 ] ) ; jd = cN ( iY , iZ , iW , iV , iO , iX , it , iA , iz , iE , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},
{type:"node_else",g:[{type:"textline",b:"jd = cS ( iY , iZ , iW ) ;".split(" ")}]}]},{type:"textline",b:["ix","=","iE",";"]}]},{type:"node_else",g:[{type:"textline",b:"jd . a = vec4 ( iW , ZERO_VALUE_NODES ) ; jd . b = hK ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qJ"],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:"qJ = jd . a . rgb ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["qJ","=","hK",";"]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"qJ += jd . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qK"],g:[{type:"textline",b:"qK = clamp ( im , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"iD = max ( max ( jd . b . r , jd . b . g ) , jd . b . b ) * io ; qK = im * ( UNITY_VALUE_NODES - iD ) + iD ;".split(" ")}]}]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_qL"],g:[{type:"textline",b:["qL","=","iX",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"iv = jd . b ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["iv","=","hK",";"]}]}]},{type:"textline",b:["iw","=","iX",";"]}]},{type:"node",name:"MATERIAL_EXT",i:[{type:"node_in",name:"qM",qualifier:["vec3"],f:!1},{type:"node_in",name:"qN",qualifier:["vec3"],f:!1},{type:"node_in",name:"qO",qualifier:["float"],f:!1},
{type:"node_in",name:"qP",qualifier:["vec3"],f:!0},{type:"node_in",name:"qQ",qualifier:["float"],f:!1},{type:"node_in",name:"qR",qualifier:["float"],f:!1},{type:"node_in",name:"qS",qualifier:["vec4"],f:!1},{type:"node_in",name:"qT",qualifier:["float"],f:!1},{type:"node_in",name:"qU",qualifier:["float"],f:!1},{type:"node_in",name:"qV",qualifier:["float"],f:!1},{type:"node_out",name:"qW",qualifier:["vec3"],f:!0},{type:"node_out",name:"qX",qualifier:["float"],f:!0},{type:"node_out",name:"qY",qualifier:["vec3"],
f:!0},{type:"node_out",name:"qZ",qualifier:["vec3"],f:!0},{type:"node_out",name:"q_",qualifier:["vec3"],f:!0},{type:"node_param",name:"ir",qualifier:["const","vec2"]},{type:"node_param",name:"is",qualifier:["const","vec3"]}],g:[{type:"textline",b:"iV = clamp ( qM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",b:"i_ = is [ 0 ] * clamp ( qN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],g:[{type:"textline",
b:"ja = normalize ( qP ) ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["ja","=","iP",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["SHADELESS_MAT",{type:"logic_negative_expr",d:1},"NODES_GLOW",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],g:[{type:"textline",b:"jb = qQ * iV ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:["iV","*=","qO",";"]}]}]},{type:"textline",b:"iD = gY ( iV ) ;".split(" ")},{type:"textline",
b:"jc = iC * u_environment_energy * hu ( ja ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],g:[{type:"textline",b:"iz = vec2 ( ir [ 0 ] , ir [ 1 ] ) ; iA = vec2 ( is [ 1 ] , is [ 2 ] ) ; jd = cN ( jb , jc , iV , i_ , iO , ja , it , iA , iz , iD , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , qR , qS ) ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"jd = cS ( jb , jc , iV ) ;".split(" ")}]}]},{type:"textline",
b:["ix","=","iD",";"]}]},{type:"node_else",g:[{type:"textline",b:"jd . a = vec4 ( iV , ZERO_VALUE_NODES ) ; jd . b = hK ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qW"],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:"qW = jd . a . rgb ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["qW","=","hK",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["REFLECTION_TYPE","REFL_NONE",{type:"non_equal_expr",d:2}],g:[{type:"textline",
b:"hr ( qW , it , ja , qT ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"qW += jd . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qX"],g:[{type:"textline",b:"qX = clamp ( qV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"iG = max ( max ( jd . b . r , jd . b . g ) , jd . b . b ) * qU ; qX = clamp ( qV * ( UNITY_VALUE_NODES - iG ) + iG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qY"],g:[{type:"textline",b:["qY","=","ja",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qZ"],g:[{type:"textline",b:"qZ = jd . a . rgb ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_q_"],g:[{type:"textline",b:"q_ = jd . b ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"iv = jd . b ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:["iv",
"=","hK",";"]}]}]},{type:"textline",b:["iw","=","ja",";"]}]},{type:"node",name:"RGB",i:[{type:"node_out",name:"ra",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"ra = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",i:[{type:"node_in",name:"rb",qualifier:["vec3"],f:!1},{type:"node_out",name:"rc",qualifier:["float"],f:!1}],g:[{type:"textline",b:"rc = dot ( rb , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{type:"node",name:"SEPRGB",i:[{type:"node_in",name:"rd",qualifier:["vec3"],
f:!1},{type:"node_out",name:"re",qualifier:["float"],f:!0},{type:"node_out",name:"rf",qualifier:["float"],f:!0},{type:"node_out",name:"rg",qualifier:["float"],f:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_re"],g:[{type:"textline",b:"re = rd . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rf"],g:[{type:"textline",b:"rf = rd . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rg"],g:[{type:"textline",b:"rg = rd . b ;".split(" ")}]}]}]},
{type:"node",name:"SEPHSV",i:[{type:"node_in",name:"rh",qualifier:["vec3"],f:!1},{type:"node_out",name:"ri",qualifier:["float"],f:!0},{type:"node_out",name:"rj",qualifier:["float"],f:!0},{type:"node_out",name:"rk",qualifier:["float"],f:!0}],g:[{type:"textline",b:"i_ = hU ( rh ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ri"],g:[{type:"textline",b:"ri = i_ . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rj"],g:[{type:"textline",b:"rj = i_ . g ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rk"],g:[{type:"textline",b:"rk = i_ . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",i:[{type:"node_in",name:"rl",qualifier:["float"],f:!1},{type:"node_in",name:"rm",qualifier:["float"],f:!1},{type:"node_in",name:"rn",qualifier:["float"],f:!1},{type:"node_out",name:"ro",qualifier:["float"],f:!1}],g:[{type:"textline",b:"ro = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( rl - rn ) * rm ) ) ) ;".split(" ")}]},{type:"node",
name:"GAMMA",i:[{type:"node_in",name:"rp",qualifier:["vec3"],f:!1},{type:"node_in",name:"rq",qualifier:["float"],f:!1},{type:"node_out",name:"rr",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"rr = max ( hK , rp ) ; rr = pow ( rr , vec3 ( rq ) ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",i:[{type:"node_in",name:"rs",qualifier:["vec3"],f:!1},{type:"node_out",name:"rt",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"rt = max ( hK , rs ) ; rt = pow ( rt , vec3 ( 2.2 ) ) ;".split(" ")}]},
{type:"node",name:"B4W_LINEAR_TO_SRGB",i:[{type:"node_in",name:"ru",qualifier:["vec3"],f:!1},{type:"node_out",name:"rv",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"rv = max ( hK , ru ) ; rv = pow ( rv , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_EMPTY",i:[{type:"node_out",name:"rw",qualifier:["vec3"],f:!1},{type:"node_out",name:"rx",qualifier:["vec3"],f:!1},{type:"node_out",name:"ry",qualifier:["float"],f:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ry"],
g:[{type:"textline",b:"rw [ 2 ] = rw [ 1 ] = rw [ 0 ] = 0.0 ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ry"],g:[{type:"textline",b:"rx [ 2 ] = rx [ 1 ] = rx [ 0 ] = 0.0 ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ry"],g:[{type:"textline",b:["ry","=","0.0",";"]}]}]}]},{type:"node",name:"TEXTURE_ENVIRONMENT",i:[{type:"node_in",name:"rz",qualifier:["vec3"],f:!1},{type:"node_out",name:"rA",qualifier:["vec3"],f:!0},{type:"node_out",name:"rB",qualifier:["float"],
f:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]}],g:[{type:"textline",b:"iM = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , rz ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rA"],g:[{type:"textline",b:"rA = iM . xyz ; ed ( rA ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rB"],g:[{type:"textline",b:"rB = iM . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",i:[{type:"node_in",
name:"rC",qualifier:["vec3"],f:!0},{type:"node_in",name:"rD",qualifier:["vec3"],f:!0},{type:"node_in",name:"rE",qualifier:["vec3"],f:!0},{type:"node_in",name:"rF",qualifier:["vec3"],f:!0},{type:"node_out",name:"rG",qualifier:["vec3"],f:!0},{type:"node_out",name:"rH",qualifier:["float"],f:!0},{type:"node_out",name:"rI",qualifier:["vec3"],f:!0},{type:"node_out",name:"rJ",qualifier:["float"],f:!0},{type:"node_out",name:"rK",qualifier:["vec3"],f:!0},{type:"node_out",name:"rL",qualifier:["float"],f:!0},
{type:"node_out",name:"rM",qualifier:["vec3"],f:!0},{type:"node_out",name:"rN",qualifier:["float"],f:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"iM = texture2D ( node_TEXTURE_COLOR_var_texture , ib ( rC ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rG"],g:[{type:"textline",b:"rG = iM . xyz ; ed ( rG ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rH"],g:[{type:"textline",
b:"rH = iM . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv2"],g:[{type:"textline",b:"iM = texture2D ( node_TEXTURE_COLOR_var_texture , ib ( rD ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rI"],g:[{type:"textline",b:"rI = iM . xyz ; ed ( rI ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rJ"],g:[{type:"textline",b:"rJ = iM . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],g:[{type:"textline",
b:"iM = texture2D ( node_TEXTURE_COLOR_var_texture , ib ( rE ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rK"],g:[{type:"textline",b:"rK = iM . xyz ; ed ( rK ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rL"],g:[{type:"textline",b:"rL = iM . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],g:[{type:"textline",b:"iM = texture2D ( node_TEXTURE_COLOR_var_texture , ib ( rF ) ) ;".split(" ")},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_rM"],g:[{type:"textline",b:"rM = iM . xyz ; ed ( rM ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rN"],g:[{type:"textline",b:"rN = iM . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",i:[{type:"node_in",name:"rO",qualifier:["vec3"],f:!0},{type:"node_in",name:"rP",qualifier:["vec3"],f:!0},{type:"node_in",name:"rQ",qualifier:["vec3"],f:!0},{type:"node_in",name:"rR",qualifier:["vec3"],f:!0},{type:"node_out",name:"rS",qualifier:["vec3"],
f:!0},{type:"node_out",name:"rT",qualifier:["float"],f:!0},{type:"node_out",name:"rU",qualifier:["vec3"],f:!0},{type:"node_out",name:"rV",qualifier:["float"],f:!0},{type:"node_out",name:"rW",qualifier:["vec3"],f:!0},{type:"node_out",name:"rX",qualifier:["float"],f:!0},{type:"node_out",name:"rY",qualifier:["vec3"],f:!0},{type:"node_out",name:"rZ",qualifier:["float"],f:!0},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"iM = texture2D ( node_TEXTURE_NORMAL_var_texture , ib ( rO ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rS"],g:[{type:"textline",b:"rS = normalize ( iN * ( iM . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rT"],g:[{type:"textline",b:"rT = iM . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv2"],g:[{type:"textline",b:"iM = texture2D ( node_TEXTURE_NORMAL_var_texture , ib ( rP ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rU"],g:[{type:"textline",b:"rU = normalize ( iN * ( iM . xyz - 0.5 ) ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rV"],g:[{type:"textline",b:"rV = iM . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],g:[{type:"textline",b:"iM = texture2D ( node_TEXTURE_NORMAL_var_texture , ib ( rQ ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rW"],g:[{type:"textline",b:"rW = normalize ( iN * ( iM . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rX"],g:[{type:"textline",b:"rX = iM . w ;".split(" ")}]}]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],g:[{type:"textline",b:"iM = texture2D ( node_TEXTURE_NORMAL_var_texture , ib ( rR ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rY"],g:[{type:"textline",b:"rY = normalize ( iN * ( iM . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rZ"],g:[{type:"textline",b:"rZ = iM . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",i:[{type:"node_out",name:"r_",qualifier:["float"],f:!1}],
g:[{type:"textline",b:"r_ = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",i:[{type:"node_in",name:"sa",qualifier:["vec3"],f:!1},{type:"node_in",name:"sb",qualifier:["vec3"],f:!1},{type:"node_out",name:"sc",qualifier:["vec3"],f:!1},{type:"node_out",name:"sd",qualifier:["float"],f:!0}],g:[{type:"textline",b:"sc = sa + sb ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sd"],g:[{type:"textline",b:"sd = ( abs ( sc [ 0 ] ) + abs ( sc [ 1 ] ) + abs ( sc [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_SUBTRACT",i:[{type:"node_in",name:"se",qualifier:["vec3"],f:!1},{type:"node_in",name:"sf",qualifier:["vec3"],f:!1},{type:"node_out",name:"sg",qualifier:["vec3"],f:!1},{type:"node_out",name:"sh",qualifier:["float"],f:!0}],g:[{type:"textline",b:"sg = se - sf ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sh"],g:[{type:"textline",b:"sh = ( abs ( sg [ 0 ] ) + abs ( sg [ 1 ] ) + abs ( sg [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",
i:[{type:"node_in",name:"si",qualifier:["vec3"],f:!1},{type:"node_in",name:"sj",qualifier:["vec3"],f:!1},{type:"node_out",name:"sk",qualifier:["vec3"],f:!1},{type:"node_out",name:"sl",qualifier:["float"],f:!0}],g:[{type:"textline",b:"sk = si + sj ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sl"],g:[{type:"textline",b:"sl = length ( sk ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sk"],g:[{type:"textline",b:"sk = normalize ( sk ) ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_DOT_PRODUCT",i:[{type:"node_in",name:"sm",qualifier:["vec3"],f:!1},{type:"node_in",name:"sn",qualifier:["vec3"],f:!1},{type:"node_out",name:"so",qualifier:["vec3"],f:!1},{type:"node_out",name:"sp",qualifier:["float"],f:!0}],g:[{type:"textline",b:["so","=","hK",";"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sp"],g:[{type:"textline",b:"sp = dot ( sm , sn ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",i:[{type:"node_in",name:"sq",qualifier:["vec3"],
f:!1},{type:"node_in",name:"sr",qualifier:["vec3"],f:!1},{type:"node_out",name:"ss",qualifier:["vec3"],f:!1},{type:"node_out",name:"st",qualifier:["float"],f:!0}],g:[{type:"textline",b:"ss = cross ( sq , sr ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_st"],g:[{type:"textline",b:"st = length ( ss ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",i:[{type:"node_in",name:"su",qualifier:["vec3"],f:!1},{type:"node_in",name:"sv",qualifier:["vec3"],f:!1},{type:"node_out",
name:"sw",qualifier:["vec3"],f:!1},{type:"node_out",name:"sx",qualifier:["float"],f:!0}],g:[{type:"textline",b:"sw = normalize ( su ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sx"],g:[{type:"textline",b:"sx = length ( su ) ;".split(" ")}]}]},{type:"textline",b:["sv",";"]}]},{type:"node",name:"B4W_REFLECT",i:[{type:"node_in",name:"sy",qualifier:["vec3"],f:!1},{type:"node_in",name:"sz",qualifier:["vec3"],f:!1},{type:"node_out",name:"sA",qualifier:["vec3"],f:!1}],g:[{type:"textline",
b:"sA = reflect ( - sy , sz ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",i:[{type:"node_in",name:"sB",qualifier:["vec3"],f:!1},{type:"node_in",name:"sC",qualifier:["float"],f:!1},{type:"node_in",name:"sD",qualifier:["const","float"],f:!1},{type:"node_in",name:"sE",qualifier:["const","float"],f:!1},{type:"node_out",name:"sF",qualifier:["vec3"],f:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"iG = length ( iL ) ; if ( iG < sE ) { iz = ib ( sB ) ; iH = clamp ( 0.5 * ( sE - iG ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; iH = sC * iH ;".split(" ")},
{type:"textline",b:"i_ = normalize ( it * iN ) ;".split(" ")},{type:"textline",b:"iI = UNITY_VALUE_NODES / sD ;".split(" ")},{type:"textline",b:"iA = i_ . xy * iH / ( sD * i_ . z ) ; iJ = UNITY_VALUE_NODES ; iK = texture2D ( node_B4W_PARALLAX_var_texture , iz ) . a ;".split(" ")},{type:"textline",b:"for ( float sG = 1.0 ; sG <= sD ; sG ++ ) { if ( iK < iJ ) { iJ -= iI ; iz -= iA ; iK = texture2D ( node_B4W_PARALLAX_var_texture , iz ) . a ; } }".split(" ")},{type:"textline",b:"iA = iz + iA ; iI = texture2D ( node_B4W_PARALLAX_var_texture , iA ) . a - ( iJ + iI ) ; iJ = iK - iJ ; iI = iJ / ( iJ - iI ) ;".split(" ")},
{type:"textline",b:"iz = iI * iA + ( UNITY_VALUE_NODES - iI ) * iz ; sF = h_ ( iz ) ; } else sF = sB ;".split(" ")}]},{type:"node",name:"B4W_CLAMP",i:[{type:"node_in",name:"sH",qualifier:["vec3"],f:!1},{type:"node_out",name:"sI",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"sI = clamp ( sH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",i:[{type:"node_in",name:"sJ",qualifier:["vec3"],f:!1},{type:"node_in",name:"sK",qualifier:["float"],f:!1},{type:"node_out",
name:"sL",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"sL = hP ( sJ , sK ) ;".split(" ")}]},{type:"node",name:"B4W_TRANSLUCENCY",i:[{type:"node_in",name:"sM",qualifier:["float"],f:!1},{type:"node_in",name:"sN",qualifier:["float"],f:!1},{type:"node_in",name:"sO",qualifier:["float"],f:!1},{type:"node_in",name:"sP",qualifier:["float"],f:!1},{type:"node_in",name:"sQ",qualifier:["float"],f:!1},{type:"node_out",name:"sR",qualifier:["float"],f:!0},{type:"node_out",name:"sS",qualifier:["vec4"],f:!0}],
g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sR"],g:[{type:"textline",b:["sR","=","sM",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sS"],g:[{type:"textline",b:"sS = vec4 ( sN , sO , sP , sQ ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",i:[{type:"node_out",name:"sT",qualifier:["float"],f:!1}],g:[{type:"textline",b:["sT","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",i:[{type:"node_in",name:"sU",qualifier:["float"],f:!1},{type:"node_in",name:"sV",qualifier:["float"],
f:!1},{type:"node_in",name:"sW",qualifier:["float"],f:!1},{type:"node_out",name:"sX",qualifier:["float"],f:!1}],g:[{type:"textline",b:"sX = smoothstep ( sV , sW , sU ) ;".split(" ")}]},{type:"node",name:"B4W_GLOW_OUTPUT",i:[{type:"node_in",name:"sY",qualifier:["vec3"],f:!1},{type:"node_in",name:"sZ",qualifier:["float"],f:!1}],g:[{type:"textline",b:"iu = sY ; iy = sZ ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",i:[{type:"node_in",name:"s_",qualifier:["vec3"],f:!1},{type:"node_out",name:"ta",
qualifier:["float"],f:!1}],g:[{type:"textline",b:"ta = ( s_ . r + s_ . g + s_ . b ) / 3.0 ;".split(" ")}]},{type:"node",name:"B4W_SCALTOVEC",i:[{type:"node_in",name:"tb",qualifier:["float"],f:!1},{type:"node_out",name:"tc",qualifier:["vec3"],f:!1}],g:[{type:"textline",b:"tc [ 0 ] = tb ; tc [ 1 ] = tb ; tc [ 2 ] = tb ;".split(" ")}]},{type:"nodes_global"},{type:"textline",b:"void td ( in vec3 it , out vec3 iu , out vec3 iv , out vec3 iw , out float ix , out float iy ) { vec2 iz , iA ; float iB , iC , iD , iE , iF , iG , iH , iI , iJ , iK ; vec4 iL , iM ; mat3 iN ; vec3 iO , iP , iQ , iR , iS , iT , iU , iV , iW , iX , iY , iZ , i_ , ja , jb , jc ; iu = hK ; iv = hK ; iw = hK ; ix = ZERO_VALUE_NODES ; iy = ZERO_VALUE_NODES ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL","USE_NODE_MATERIAL_EXT","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["iO","=","eW",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) iO = iO ; else iO = - iO ;".split(" ")}]}}]},{type:"textline",b:"iP = normalize ( iO ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"iQ = cross ( iO , eX . xyz ) * eX . w ; iN = mat3 ( eX . xyz , iQ , iO ) ; iN = iN ;".split(" ")}]}}]},{type:"textline",b:"iO = eU ; iL = eV ; iB = u_emit ; iC = u_ambient ; af jd ;".split(" ")},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 te = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",d:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 tk ( vec3 tf , mat4 tg ) { vec3 th , ti , tj ; th = vec3 ( tg [ 0 ] [ 0 ] , tg [ 1 ] [ 0 ] , tg [ 2 ] [ 0 ] ) ; ti = vec3 ( tg [ 0 ] [ 1 ] , tg [ 1 ] [ 1 ] , tg [ 2 ] [ 1 ] ) ; tj = vec3 ( tg [ 0 ] [ 2 ] , tg [ 1 ] [ 2 ] , tg [ 2 ] [ 2 ] ) ; ti = cross ( tj , th ) ; th = normalize ( th ) ; ti = normalize ( ti ) ; tj = normalize ( tj ) ; return mat4 ( vec4 ( th , 0.0 ) , vec4 ( ti , 0.0 ) , vec4 ( tj , 0.0 ) , vec4 ( tf , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 tq ( vec3 tl , vec3 tm ) { vec3 tn , to , tp ; tn = tl - tm ; tn . y = 0.0 ; to = cross ( te , tn ) ; tp = cross ( tn , to ) ; to = normalize ( to ) ; tp = normalize ( tp ) ; tn = normalize ( tn ) ; return mat4 ( vec4 ( to , 0.0 ) , vec4 ( tp , 0.0 ) , vec4 ( tn , 0.0 ) , vec4 ( tm , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 ty ( in vec3 tr , float ts , float tt , float tu , vec3 tv ) { float tw , tx ; tw = fract ( length ( tv ) / 0.17 ) ; tx = tu + tw / 10.0 ; tw = tw ; if ( tu != 0.0 ) tw /= tu ; tr *= 1.0 + 0.5 * sin ( ts ) ; tw = length ( tr ) * tt * sin ( 2.0 * 3.14 * ts * tx + tw ) ; return eL ( tw ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 tG ( in vec3 tz , in vec3 tA , in mat4 tB ) { vec3 tC ; float tD , tE ; mat4 tF ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",d:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tF = tk ( tA , tB ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",
b:"tD = fract ( ( tA . x * 1.43 + tA . y * 0.123 + tA . z * 6.1 ) ) ; tD = 2.0 * M_PI * tD ; tC = normalize ( vec3 ( tB [ 0 ] [ 2 ] , 0.0 , tB [ 2 ] [ 2 ] ) ) ; tE = acos ( tC [ 2 ] ) ; if ( tC [ 0 ] < 0.0 ) tE = 2.0 * M_PI - tE ; tE = tE - tD ; if ( tE < 0.0 ) tE = 2.0 * M_PI + tE ; tD = tD ; if ( tE <= MAX_BILLBOARD_ANGLE ) tD += tE ; else if ( tE <= M_PI - MAX_BILLBOARD_ANGLE ) tD += MAX_BILLBOARD_ANGLE * ( 2.0 * tE - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( tE <= M_PI + MAX_BILLBOARD_ANGLE ) tD += tE - M_PI ; else if ( tE <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) tD += MAX_BILLBOARD_ANGLE * ( 2.0 * tE - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else tD += tE - 2.0 * M_PI ; tF = eJ ( tD ) ; tF [ 3 ] = vec4 ( tA , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"tF = tq ( tz , tA ) ;".split(" ")}]}}]},{type:"textline",b:["return","tF",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 tM ( in vec3 tH , in vec3 tI , in mat4 tJ , mat4 tK ) { mat4 tL ; tL = tG ( tH , tI , tJ ) ; tK [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; tL = tL * tK ; return tL ; }".split(" ")}]}}]},
{type:"textline",b:"el tT ( in vec3 tN , in vec3 tO , in vec3 tP , in vec3 tQ , in vec3 tR , in mat4 tS ) { tN = ( tS * vec4 ( tN , 1.0 ) ) . xyz ; tO = ( tS * vec4 ( tO , 1.0 ) ) . xyz ; tP = ( tS * vec4 ( tP , 0.0 ) ) . xyz ; tQ = ( tS * vec4 ( tQ , 0.0 ) ) . xyz ; tR = ( tS * vec4 ( tR , 0.0 ) ) . xyz ; return eN ( el ( tN , tO , tP , tQ , tR , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 tW ( vec2 tU , vec3 tV ) { return ( tU + 0.5 ) * tV . xy - 0.5 ; }".split(" ")}]};
a["include/skin.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 uc ( in vec4 tX , in vec4 tY , in float tZ ) { float t_ , ua , ub ; t_ = tX [ 0 ] * tY [ 0 ] + tX [ 1 ] * tY [ 1 ] + tX [ 2 ] * tY [ 2 ] + tX [ 3 ] * tY [ 3 ] ; if ( t_ < 0.0 ) { tY *= - 1.0 ; t_ = - t_ ; } if ( abs ( t_ ) >= 1.0 ) return tX ; ua = acos ( t_ ) ; t_ = sqrt ( 1.0 - t_ * t_ ) ; if ( abs ( t_ ) < 0.001 ) return vec4 ( tX * 0.5 + tY * 0.5 ) ; ub = sin ( ( 1.0 - tZ ) * ua ) / t_ ; t_ = sin ( tZ * ua ) / t_ ; return tX * ub + tY * t_ ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 uo ( in vec3 ud , in vec4 ue , in vec4 uf , in vec4 ug , in vec4 uh , in float ui ) { vec4 uj , uk ; vec3 ul , um , un ; ul = ey ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( ud , 1.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"uj = uc ( ue , uf , ui ) ; uk = mix ( ug , uh , ui ) ; um = er ( uj , ul ) ; um = um * uk . w + uk . xyz ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"un = er ( ue , ul ) ; ul = er ( uf , ul ) ; un = un * ug . w + ug . xyz ; ul = ul * uh . w + uh . xyz ; um = mix ( un , ul , ui ) ;".split(" ")}]}}]},{type:"textline",b:"return eE ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( um , 1.0 ) ) ; } vec3 ux ( in vec3 up , in vec4 uq , in vec4 ur , in float us ) { vec4 ut ; vec3 uu , uv , uw ; uu = ey ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( up , 0.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"ut = uc ( uq , ur , us ) ; uv = er ( ut , uu ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uw = er ( uq , uu ) ; uu = er ( ur , uu ) ; uv = mix ( uw , uu , us ) ;".split(" ")}]}}]},{type:"textline",b:"return eE ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uv , 0.0 ) ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 uo ( in vec3 uy , in vec4 uz , in vec4 uA ) { vec3 uB ; uB = ey ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uy , 1.0 ) ) ; uB = er ( uz , uB ) ; uB = uB * uA . w + uA . xyz ; return eE ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uB , 1.0 ) ) ; } vec3 ux ( in vec3 uC , in vec4 uD ) { vec3 uE ; uE = ey ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uC , 0.0 ) ) ; uE = er ( uD , uE ) ; return eE ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uE , 0.0 ) ) ; }".split(" ")}]}}]},
{type:"textline",b:"void uT ( inout vec3 uF , inout vec3 uG , inout vec3 uH , inout vec3 uI ) { int uJ , uK ; vec4 uL ; vec3 uM , uN , uO , uP ; float uQ , uR ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uQ","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { uM = vec3 ( 0.0 , 0.0 , 0.0 ) ; uN = vec3 ( 0.0 , 0.0 , 0.0 ) ; uO = vec3 ( 0.0 , 0.0 , 0.0 ) ; uP = vec3 ( 0.0 , 0.0 , 0.0 ) ; uL = a_influence ; for ( int uS = 0 ; uS < 4 ; uS ++ ) { uJ = int ( uL [ uS ] ) ; uR = fract ( uL [ uS ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uM += uR * uo ( uF , u_quatsb [ uJ ] , u_quatsa [ uJ ] , u_transb [ uJ ] , u_transa [ uJ ] , uQ ) ; uN += uR * ux ( uG , u_quatsb [ uJ ] , u_quatsa [ uJ ] , uQ ) ; uO += uR * ux ( uH , u_quatsb [ uJ ] , u_quatsa [ uJ ] , uQ ) ; uP += uR * ux ( uI , u_quatsb [ uJ ] , u_quatsa [ uJ ] , uQ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uM += uR * uo ( uF , u_quatsb [ uJ ] , u_transb [ uJ ] ) ; uN += uR * ux ( uG , u_quatsb [ uJ ] ) ; uO += uR * ux ( uH , u_quatsb [ uJ ] ) ; uP += uR * ux ( uI , u_quatsb [ uJ ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} uF = uM ; uG = uN ; uH = uO ; uI = uP ; } if ( ! ( a_influence . y > 0.0 ) ) { uK = int ( a_influence [ 0 ] - 1.0 ) ; if ( uK > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uF = uo ( uF , u_quatsb [ uK ] , u_quatsa [ uK ] , u_transb [ uK ] , u_transa [ uK ] , uQ ) ; uG = ux ( uG , u_quatsb [ uK ] , u_quatsa [ uK ] , uQ ) ; uH = ux ( uH , u_quatsb [ uK ] , u_quatsa [ uK ] , uQ ) ; uI = ux ( uI , u_quatsb [ uK ] , u_quatsa [ uK ] , uQ ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"uF = uo ( uF , u_quatsb [ uK ] , u_transb [ uK ] ) ; uG = ux ( uG , u_quatsb [ uK ] ) ; uH = ux ( uH , u_quatsb [ uK ] ) ; uI = ux ( uI , u_quatsb [ uK ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void vd ( inout vec3 uU , in vec3 uV , in float uW , in float uX , in float uY , in vec3 uZ , in float u_ ) { vec3 va ; float vb , vc ; vb = length ( uV ) ; vc = uX * ( 1.0 + 0.1 * fract ( vb ) ) ; vb = uW * u_ * ( 1.0 + sin ( 2.0 * 3.14 * uY * vc + vb ) ) ; vc = ( uU . y - uV . y ) * abs ( vb ) ; vc += 1.0 ; vc *= vc ; vc = vc * vc - vc ; va = uU ; va . xz += uZ . xz * vc * sign ( vb ) ; va = va - uV ; if ( all ( equal ( va , vec3 ( 0.0 ) ) ) ) uU = uV ; else { vb = length ( uU - uV ) ; uU = uV + normalize ( va ) * vb ; } }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 vf ( vec4 ve ) { return ve * ve * ( 3.0 - 2.0 * ve ) ; } vec4 vh ( vec4 vg ) { return abs ( fract ( vg + 0.5 ) * 2.0 - 1.0 ) ; } vec4 vj ( vec4 vi ) { return vf ( vh ( vi ) ) ; } void vA ( inout vec3 vk , in float vl , in vec3 vm , in vec3 vn , in vec3 vo , in float vp , in float vq , in float vr , in vec3 vs ) { vec3 vt ; vec4 vu ; vec2 vv , vw ; float vx , vy , vz ; vx = dot ( vo , vec3 ( 1.0 ) ) ; vy = vx + vs . g ; vz = dot ( vk , vec3 ( vs . g ) ) ; vv = ( vl + vec2 ( vz , vy ) ) ; vu = ( ( fract ( ( vv . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( vn ) * vp ; vu = vj ( vu ) ; vw = vu . xz + vu . yw ; vw . y = 0.5 - vw . y ; vt = vw . xyx * vs . rbr * vec3 ( vq * vm . x , vr , vq * vm . z ) ; vk += vt ; }".split(" ")}]}}]},
{type:"textline",b:"void vH ( inout vec3 vB , inout vec3 vC , in vec3 vD ) { vec3 vE , vF , vG ; vE = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vF = vC ; vG = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vF = vB ; vG = vC ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vA ( vF , u_time , vD , vE , vG , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"vd ( vF , vG , au_wind_bending_amp , au_wind_bending_freq , u_time , vE , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vd ( vF , vG , au_wind_bending_amp , au_wind_bending_freq , u_time , vE , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vB += vF - vC ; vC = vF ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vB = vF ; vC = vG ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/nodes.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_orco_tex_coord ; varying vec3 hJ ;".split(" ")}]}}]},
{type:"node",name:"TEX_COORD_UV",i:[{type:"node_param",name:"node_TEX_COORD_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"ik",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["ik","=","node_TEX_COORD_UV_var_a_uv",";"]}]},{type:"node",name:"UV_MERGED",i:[{type:"node_param",name:"node_UV_MERGED_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"ij",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["ij","=","node_UV_MERGED_var_a_uv",";"]}]},{type:"node",
name:"UVMAP",i:[{type:"node_param",name:"node_UVMAP_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"il",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["il","=","node_UVMAP_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_UV",i:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"ic",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["ic","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",i:[{type:"node_param",
name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"vI",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["vI","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",i:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"vJ",qualifier:["varying","float"]}],g:[{type:"textline",b:["vJ","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",
i:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"vK",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["vK","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",i:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"vL",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["vL","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},
{type:"nodes_global"},{type:"textline",b:["void","vM","(",")","{"]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["hJ","=","a_orco_tex_coord",";"]}]}}]},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 vR ( vec3 vN , float vO , vec2 vP ) { vec2 vQ ; vQ = vec2 ( ( vN . x - vP . x ) / vO , - ( vN . z - vP . y ) / vO ) ; return fract ( vQ ) ; } vec2 vV ( vec2 vS , float vT , vec2 vU ) { return vec2 ( vS . x * vT , - vS . y * vT ) + vU ; } el vW ( ) { return el ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } el wr ( vec3 vX , vec3 vY , vec3 vZ , vec3 v_ , vec3 wa , PRECISION sampler2D wb , sampler2D wc , vec3 wd , float we , vec3 wf , vec4 wg , mat4 wh ) { mat4 wi ; vec4 wj ; vec2 wk , wl , wm ; float wn , wo ; vec3 wp ; wp = er ( wg , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; wn = - wp . x ; wo = - wp . z ; wk = vec2 ( wf . x + we * ( - 1.0 - wn ) / 2.0 , wf . z + we * ( 1.0 - wo ) / 2.0 ) ; wl = vR ( wa , we , wk ) ; wo = we / 2.0 ; wm = abs ( vV ( wl - vec2 ( 0.5 ) , we , vec2 ( 0.0 ) ) ) ; wo = wo * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( wm ) > wo ) return vW ( ) ; wo = we / wd . z ; wm = ( wl - vec2 ( 0.5 ) ) * wo + vec2 ( 0.5 ) ; wp = wp * ( we / wd . z - 1.0 ) / 2.0 ; wm . x += wp . x ; wm . y -= wp . z ; wj = texture2D ( wc , wm ) ; wo = wj . r ; if ( wo < u_scale_threshold ) return vW ( ) ; wn = wd . y - wd . x ; wn = wd . y - texture2D ( wb , wm ) . r * wn ; wm = vX . xz - wa . xz ; wa . xz = vV ( wl , we , wk ) ; wa . y = wn ; vX . xz = wa . xz + wm ; vX . y *= wo ; vX . y += wn ; wp = wj . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vX -= wa ; wi = tG ( wf , wa , wh ) ; el wq = tT ( vX , wa , vY , vZ , v_ , wi ) ; wq . b = wa ; wq . f = wp ; return eN ( wq ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return eN ( el ( vX , wa , vY , vZ , v_ , wp ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",
a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 wx ( mat4 ws , vec4 wt ) { vec4 wu ; float wv ; vec2 ww ; ww = ( ws * u_v_light_matrix [ 3 ] ) . xy ; wv = SHADOW_TEX_RES / 2.0 ; ww = floor ( ww * wv + 0.5 ) / wv - ww ; wu = ws * wt ; wu . xy += ww ; wu = u_b_light_matrix * wu ; return wu ; } void wB ( vec3 wy , vec3 wz ) { vec4 wA ; wA = u_v_light_matrix * vec4 ( wy + u_normal_offset * wz , 1.0 ) ; e_ = wx ( u_p_light_matrix0 , wA ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"fa = wx ( u_p_light_matrix1 , wA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"fb = wx ( u_p_light_matrix2 , wA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"fc = wx ( u_p_light_matrix3 , wA ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/particles.glslv"]=
{type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct wJ { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void wP ( inout float wK , float wL , vec2 wM , vec2 wN ) { float wO ; wO = wN . x - wM . x ; wO = ( wL - wM . x ) / wO ; wK = mix ( wK , wN . y , clamp ( wO , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void wV ( inout vec3 wQ , float wR , vec4 wS , vec4 wT ) { float wU ; wU = wT . x - wS . x ; wU = ( wR - wS . x ) / wU ; wQ = mix ( wQ , wT . yzw , clamp ( wU , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float xa ( float wW , float wX , vec2 wY [ SIZE_RAMP_LENGTH ] ) { float wZ , w_ ; wZ = wW / wX ; w_ = wY [ 0 ] . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wP ( w_ , wZ , wY [ 0 ] , wY [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wP ( w_ , wZ , wY [ 1 ] , wY [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wP ( w_ , wZ , wY [ 2 ] , wY [ 3 ] ) ;".split(" ")}]}}]},
{type:"textline",b:["return","w_",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 xg ( float xb , float xc , vec4 xd [ COLOR_RAMP_LENGTH ] ) { vec3 xe ; float xf ; xf = xb / xc ; xe = xd [ 0 ] . yzw ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wV ( xe , xf , xd [ 0 ] , xd [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["COLOR_RAMP_LENGTH",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wV ( xe , xf , xd [ 1 ] , xd [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"wV ( xe , xf , xd [ 2 ] , xd [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","xe",";","}"]}]}}]},{type:"textline",b:"float xo ( float xh , float xi , float xj , float xk ) { float xl , xm , xn ; xl = max ( 0.01 , min ( xi , xj ) ) ; xm = max ( 0.01 , min ( xi , xk ) ) ; xn = xi - xm ; xm = clamp ( xh / xl , 0.0 , 1.0 ) - step ( xn , xh ) * ( xh - xn ) / xm ; return xm ; } wJ xu ( ) { vec3 xp , xq ; float xr , xs ; wJ xt ; if ( u_p_cyclic == 1 ) { xr = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( xr < 0.0 ) xr += u_p_length ; } if ( u_p_cyclic != 1 ) { xr = u_p_time - a_p_delay ; } if ( xr < 0.0 || xr >= a_p_lifetime ) { xt . a = 0.0001 ; xt . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( xr < 0.0 || xr >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"xp = a_position ; xq = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xp = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; xq = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"xp += u_p_nfactor * xr * xq ; xp += a_p_vels . xyz * xr ; xp . y -= u_p_gravity * xr * xr / 2.0 ; xs = max ( u_p_mass , EPSILON ) ; xp += ( u_p_wind / xs ) * xr * xr / 2.0 ; xt . b = xp ; xt . e = a_p_vels . w * xr ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xt . a = xa ( xr , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xt . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xt . d = xg ( xr , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"xt . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"xt . c = xo ( xr , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return xt ; }".split(" ")}]};a["include/blending.glslf"]={type:"group",a:[{type:"textline",b:"float xw = 0.0 ; float xx = 1.0 ; vec3 xy = vec3 ( xw ) ; vec3 xz = vec3 ( xx ) ; vec3 xE ( vec3 xA ) { float xB , xC ; vec4 xD ; xD = vec4 ( xw , - xx / 3.0 , 2.0 / 3.0 , - xx ) ; xD = mix ( vec4 ( xA . bg , xD . wz ) , vec4 ( xA . gb , xD . xy ) , step ( xA . b , xA . g ) ) ; xD = mix ( vec4 ( xD . xyw , xA . r ) , vec4 ( xA . r , xD . yzx ) , step ( xD . x , xA . r ) ) ; xB = xD . x - min ( xD . w , xD . y ) ; xC = 1.0e-10 ; return vec3 ( abs ( xD . z + ( xD . w - xD . y ) / ( 6.0 * xB + xC ) ) , xB / ( xD . x + xC ) , xD . x ) ; } vec3 xI ( vec3 xF ) { vec3 xG ; vec4 xH ; xH = vec4 ( xx , 2.0 / 3.0 , xx / 3.0 , 3.0 ) ; xG = abs ( fract ( vec3 ( xF . r , xF . r , xF . r ) + xH . xyz ) * 6.0 - xH . www ) ; return xF . b * mix ( xH . xxx , clamp ( xG - xH . xxx , xw , xx ) , xF . g ) ; } vec3 xM ( vec3 xJ , vec3 xK , float xL ) { return mix ( xJ , xK , xL ) ; } vec3 xQ ( vec3 xN , vec3 xO , float xP ) { return xP * xN + xO ; } vec3 xU ( vec3 xR , vec3 xS , float xT ) { return xS - xT * xR ; } vec3 xZ ( vec3 xV , vec3 xW , float xX ) { float xY ; xY = xx - xX ; return ( vec3 ( xY ) + xX * xV ) * xW ; } vec3 yd ( vec3 x_ , vec3 ya , float yb ) { vec3 yc ; yc = vec3 ( xx - yb ) ; return xz - ( yc + yb * ( xz - x_ ) ) * ( xz - ya ) ; } vec3 yi ( vec3 ye , vec3 yf , float yg ) { vec3 yh ; yh = vec3 ( xx - yg ) ; return mix ( yf * ( yh + 2.0 * yg * ye ) , xz - ( yh + 2.0 * yg * ( xz - ye ) ) * ( xz - yf ) , step ( 0.5 , yf ) ) ; } vec3 ym ( vec3 yj , vec3 yk , float yl ) { return mix ( yk , abs ( yj - yk ) , yl ) ; } vec3 yq ( vec3 yn , vec3 yo , float yp ) { return mix ( yo , yo / ( yn + step ( yn , xy ) ) , yp ) ; } vec3 yu ( vec3 yr , vec3 ys , float yt ) { return mix ( ys , min ( yr , ys ) , yt ) ; } vec3 yy ( vec3 yv , vec3 yw , float yx ) { return max ( yx * yv , yw ) ; } vec3 yE ( vec3 yz , vec3 yA , float yB ) { vec3 yC , yD ; yC = xE ( yA ) ; if ( yC . y != xw ) { yD = xE ( yz ) ; yD = xI ( vec3 ( yC . x , yD . yz ) ) ; return mix ( yz , yD , yB ) ; } return yz ; } vec3 yK ( vec3 yF , vec3 yG , float yH ) { vec3 yI , yJ ; yI = xE ( yF ) ; if ( yI . y != xw ) { yJ = xE ( yG ) ; return xI ( vec3 ( yI . x , mix ( yI . y , yJ . y , yH ) , yI . z ) ) ; } return yF ; } vec3 yQ ( vec3 yL , vec3 yM , float yN ) { vec3 yO , yP ; yO = xE ( yL ) ; yP = xE ( yM ) ; return xI ( vec3 ( yO . xy , mix ( yO . z , yP . z , yN ) ) ) ; } vec3 yW ( vec3 yR , vec3 yS , float yT ) { vec3 yU , yV ; yU = xE ( yS ) ; if ( yU . y != xw ) { yV = xE ( yR ) ; yV = xI ( vec3 ( yU . xy , yV . z ) ) ; return mix ( yR , yV , yT ) ; } return yR ; } vec3 za ( vec3 yX , vec3 yY , float yZ ) { vec3 y_ ; y_ = xz - ( xz - yY ) * ( xz - yX ) ; return mix ( yX , ( ( xz - yX ) * yY * yX ) + yX * y_ , yZ ) ; } vec3 ze ( vec3 zb , vec3 zc , float zd ) { return zb + zd * ( 2.0 * zc - xx ) ; } float zk ( float zf , float zg , float zh , float zi ) { float zj ; zj = xx - zi ; return ( zj + zh * zf ) * zg ; } float zq ( float zl , float zm , float zn , float zo ) { float zp ; zp = xx - zo ; return xx - ( zp + zn * ( xx - zl ) ) * ( xx - zm ) ; } float zw ( float zr , float zs , float zt , float zu ) { float zv ; zv = xx - zu ; return mix ( zs * ( zv + 2.0 * zt * zr ) , xx - ( zv + 2.0 * zt * ( xx - zr ) ) * ( xx - zs ) , step ( 0.5 , zs ) ) ; }".split(" ")}]};
a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float zI ( in sampler2D zC , in vec2 zD , in vec2 zE ) { float zF , zG , zH ; zF = texture2D ( zC , zD ) . r ; zG = zE . x ; zH = zE . y ; zG = 2.0 * zG / ( zG + zH - ( 2.0 * zF - 1.0 ) * ( zH - zG ) ) ; return zG ; }".split(" ")}]}};b4w.module.animation=function(a,p){var c=p("__animation"),d=p("__constraints");p("__physics");var b=p("__print"),e=p("__util");a.SLOT_0=c.SLOT_0;a.SLOT_1=c.SLOT_1;a.SLOT_2=c.SLOT_2;a.SLOT_3=c.SLOT_3;a.SLOT_4=c.SLOT_4;a.SLOT_5=c.SLOT_5;a.SLOT_6=c.SLOT_6;a.SLOT_7=c.SLOT_7;a.SLOT_ALL=c.SLOT_ALL;a.OBJ_ANIM_TYPE_NONE=c.OBJ_ANIM_TYPE_NONE;a.OBJ_ANIM_TYPE_ARMATURE=c.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=c.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=c.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=c.OBJ_ANIM_TYPE_SOUND;
a.OBJ_ANIM_TYPE_PARTICLES=c.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=c.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=c.AB_CYCLIC;a.AB_FINISH_RESET=c.AB_FINISH_RESET;a.AB_FINISH_STOP=c.AB_FINISH_STOP;var h=new Float32Array(4);a.is_animated=function(a){return c.is_animated(a)};a.get_actions=function(){b.error("get_actions() deprecated, use get_anim_names() instead");for(var a=[],d=c.Lq(),e=0;e<d.length;e++)a.push(c.LB(d[e].name));return a};a.get_current_action=function(c,d){b.error("get_current_action() deprecated, use get_current_anim_name() instead");
return a.get_current_anim_name(c,d)};a.get_anim_names=function(a){return c.sk(a)?c.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.vy(a,b)};a.apply=function(a,d,e){if(e>c.SLOT_7)b.error("Can't apply animation to slot "+e+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{e=e||c.SLOT_0;if(c.is_animated(a)){var f=c.get_slot_num_by_anim(a,d);if(-1!=f&&f!=e){b.error('Animation "'+d+'" is already applied to object "'+
a.name+'" (slot "'+f+'").');return}}c.OC(a,d)?c.apply(a,d,e):b.error('No fcurves in action "'+d+'"')}};a.remove=function(a){c.remove(a)};a.remove_slot_animation=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.remove_slot_animation(a,b))};a.apply_def=function(a){c.apply_def(a)};a.play=function(a,d,e){c.is_animated(a)?(e=e||c.SLOT_0,c.play(a,d,e),c.update_object_animation(a,0,e,!0)):b.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.stop(a,
b))};a.is_play=function(a,b){if(!c.is_animated(a))return!1;b=b||c.SLOT_0;return c.is_play(a,b)};a.set_current_frame_float=function(c,d,e){b.error("set_current_frame_float() deprecated, use set_frame() instead");a.set_frame(c,d,e)};a.get_current_frame_float=function(c,d){b.error("get_current_frame_float() deprecated, use get_frame() instead");return a.get_frame(c,d)};a.set_frame=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_frame(a,b,d))};a.set_first_frame=function(a,b){if(c.is_animated(a)){b=
b||c.SLOT_0;var d=c.get_anim_start_frame(a,b);c.set_frame(a,d,b)}};a.set_last_frame=function(a,b){if(c.is_animated(a)){b=b||c.SLOT_0;var d=c.get_anim_start_frame(a,b),e=c.get_anim_length(a,b);c.set_frame(a,d+e-c.ju,b)}};a.get_frame=function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return c.get_current_frame_float(a,b)};a.set_speed=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_speed(a,b||1,d))};a.get_speed=function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return a.C[b]?c.get_speed(a,
b):0};a.get_frame_range=function(a,d){b.error("get_frame_range() deprecated, use get_anim_start_frame() and get_anim_length() instead");if(c.is_animated(a)){d=d||c.SLOT_0;var e=a.C[d];if(e)return[e.start,e.start+e.length]}return null};a.get_anim_start_frame=function(a,b){return c.is_animated(a)&&(b=b||c.SLOT_0,a.C[b])?c.get_anim_start_frame(a,b):-1};a.get_anim_length=function(a,b){return c.is_animated(a)&&(b=b||c.SLOT_0,a.C[b])?c.get_anim_length(a,b):-1};a.cyclic=function(d,e,h){b.error("cyclic() deprecated, use set_behavior() instead");
a.set_behavior(d,e?c.AB_CYCLIC:c.AB_FINISH_RESET,h)};a.is_cyclic=function(a,d){b.error("is_cyclic() deprecated, use get_behavior() instead");if(!c.is_animated(a))return!1;d=d||c.SLOT_0;return c.is_cyclic(a,d)};a.set_behavior=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_behavior(a,b,d))};a.get_behavior=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.get_behavior(a,b)};a.apply_smoothing=function(a,b,d,e){e=e||c.SLOT_0;c.is_animated(a)&&c.apply_smoothing(a,b,d,e)};a.update_object_animation=
function(a,b,d,e){c.is_animated(a)&&(d=d||c.SLOT_0,c.update_object_animation(a,b||0,d,e||!1))};a.frame_to_sec=function(a){return c.frame_to_sec(a)};a.get_bone_translation=function(a,b,c){if(!e.is_armature(a))return null;c||(c=new Float32Array(3));d.zy(a,b,!1,h,null);c[0]=h[0];c[1]=h[1];c[2]=h[2];return c};a.get_first_armature_object=function(a){return e.is_mesh(a)?c.get_first_armature_object(a):null};a.get_slot_num_by_anim=function(a,b){return c.is_animated(a)&&b?c.get_slot_num_by_anim(a,b):null};
a.get_anim_type=function(a,b){return c.is_animated(a)?c.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return c.apply_to_first_empty_slot(a,b)};a.get_skel_mix_factor=function(a){return a.e.Le};a.set_skel_mix_factor=function(a,d,h){e.is_armature(a)?(d=Math.min(Math.max(d,0),1),a.e.Le!=d&&c.set_skel_mix_factor(a,d,h||0)):b.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,p){var c=p("__anchors");p("__print");a.attach_move_cb=c.attach_move_cb;a.detach_move_cb=c.detach_move_cb;a.is_anchor=c.is_anchor;a.get_element_id=c.get_element_id};b4w.module.assets=function(a,p){var c=p("__assets");a.AT_ARRAYBUFFER=c.AT_ARRAYBUFFER;a.AT_JSON=c.AT_JSON;a.AT_TEXT=c.AT_TEXT;a.AT_AUDIOBUFFER=c.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=c.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=c.AT_AUDIO_ELEMENT;a.enqueue=function(a,b,e){c.enqueue(a,b,e)}};b4w.module.camera=function(a,p){function c(a,c){if(b.is_camera(a))return c||(c=new Float32Array(3)),m.copy(a.e.h,c),c;g.error("get_eye(): Wrong object")}function d(a,c){b.is_target_camera(a)?(m.copy(c,a.e.Mb),n.v(a),h.sync_transform(a)):g.error("set_pivot(): Wrong object or camera move style")}var b=p("__camera");p("__config");var e=p("__container"),h=p("__physics"),g=p("__print"),l=p("__constraints"),n=p("__transform"),f=p("__util"),m=p("vec3"),r=p("vec4");p("quat");var z=p("mat3"),w=p("mat4"),E=
new Float32Array(2),y=new Float32Array(3),H=new Float32Array(3),v=new Float32Array(4),B=new Float32Array(9);a.MS_STATIC=b.MS_STATIC;a.MS_ANIMATION=b.MS_STATIC;a.MS_TARGET_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=b.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=b.MS_HOVER_CONTROLS;a.is_camera=b.is_camera;a.is_target_camera=b.is_target_camera;a.is_eye_camera=b.is_eye_camera;a.is_hover_camera=b.is_hover_camera;a.set_move_style=function(a,d){if(!b.is_camera(a))return g.error("set_move_style(): Wrong object"),
!1;if(d!=b.MS_STATIC&&d!=b.MS_EYE_CONTROLS&&d!=b.MS_HOVER_CONTROLS&&d!=b.MS_TARGET_CONTROLS)return g.error("set_move_style(): Wrong camera move style"),!1;a.e.xa=d;a.e.Sb=null;a.e.Zb=null;a.e.zb=null;a.e.Za=!1;b.hz(a);switch(d){case b.MS_TARGET_CONTROLS:var e=c(a,y),l=f.quat_to_dir(a.e.quat,f.AXIS_MY,H),e=m.scaleAndAdd(e,l,10,l);m.copy(e,a.e.Mb)}n.v(a);h.sync_transform(a);return!0};a.get_move_style=function(a){return b.is_camera(a)?b.get_move_style(a):(g.error("get_move_style(): Wrong object"),null)};
a.set_velocity_params=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return g.error("set_velocity_params(): Wrong object or camera move style"),null;var d=a.e;d.Jo=f.clamp(c[0],0,Infinity);d.Io=f.clamp(c[1],0,Infinity);d.Ko=f.clamp(c[2],0,1)};a.get_velocity_params=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return g.error("get_velocity_params(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));var d=a.e;
c[0]=d.Jo;c[1]=d.Io;c[2]=d.Ko;return c};a.set_look_at=function(a,c,d,e){var f=a.e;b.Vx(c,d,e,f.h,f.quat);n.v(a);h.sync_transform(a)};a.get_eye=c;a.set_pivot=d;a.set_trans_pivot=function(a,c,d){b.is_target_camera(a)?(m.copy(c,a.e.h),m.copy(d,a.e.Mb),n.v(a),h.sync_transform(a)):g.error("set_trans_pivot(): Wrong object or camera move style")};a.get_pivot=function(a,c){if(b.is_target_camera(a))return c||(c=new Float32Array(3)),m.copy(a.e.Mb,c),c;g.error("get_pivot(): Wrong object or camera move style")};
a.rotate_pivot=function(b,c,d){g.error("rotate_pivot() deprecated, use rotate_camera() or rotate_target_camera() instead");a.rotate_target_camera(b,c,d)};a.move_pivot=function(a,c,d){if(b.is_target_camera(a)){var e=a.e;if(e.Ct){var f=z.fromMat4(e.W,B),l=m.subtract(e.h,e.Mb,H);y[0]=c;y[1]=0;y[2]=d;m.scale(y,m.len(l),y);m.transformMat3(y,f,y);m.add(e.Mb,y,e.Mb);m.add(e.h,y,e.h);n.v(a);h.sync_transform(a)}}else g.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(b,c){g.error("rotate_hover_cam() deprecated, use rotate_camera() or rotate_hover_camera() instead");
a.rotate_hover_camera(b,c,0)};a.get_hover_cam_angle=function(a){g.error("get_hover_cam_angle() deprecated, use get_camera_angles() instead");return b.is_hover_camera(a)?-b.get_camera_angles(a,E)[1]:(g.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.set_hover_cam_angle=function(a,c){g.error("set_hover_cam_angle() deprecated, use rotate_camera() or rotate_hover_camera() instead");if(b.is_hover_camera(a))if(a.e.Za){var d=b.get_camera_angles(a,E);(d=-c-d[1])&&b.rotate_hover_camera(a,
0,d);n.v(a);h.sync_transform(a)}else g.error("set_hover_cam_angle(): distance/hover_angle limits are not defined or disabled");else g.error("set_hover_cam_angle(): wrong object or camera move style")};a.get_hover_angle_limits=function(a,c){if(b.is_hover_camera(a))return a.e.zb?(c||(c=new Float32Array(2)),c[0]=a.e.zb.Oa,c[1]=a.e.zb.Ya):g.error("get_hover_angle_limits(): camera hasn't angle limits"),c;g.error("get_hover_angle_limits(): wrong object")};a.get_cam_dist_limits=function(a,c){if(b.is_hover_camera(a)||
b.is_target_camera(a))return a.e.Za?(c||(c=new Float32Array(2)),c[0]=a.e.Vf,c[1]=a.e.ee):g.error("get_cam_dist_limits(): camera hasn't distance limits"),c;g.error("get_cam_dist_limits(): wrong object")};a.translate_hover_cam_v=function(b,c){g.error("translate_hover_cam_v() deprecated, use hover_cam_set_translation() instead");a.hover_cam_set_translation(b,c)};a.hover_cam_set_translation=function(a,c){if(b.is_hover_camera(a)){var d=a.e;if(d.Za){var e=m.subtract(c,d.h,y);m.add(e,d.Tb,d.Tb)}n.set_translation(a,
c);n.v(a);h.sync_transform(a)}else g.error("hover_cam_set_translation(): wrong object")};a.set_hover_pivot=function(a,c){if(b.is_hover_camera(a)){var d=a.e;if(d.Za&&d.zb){var e=m.subtract(c,d.Tb,y),e=m.add(e,d.h,e);n.set_translation(a,e)}m.copy(c,d.Tb);n.v(a);h.sync_transform(a)}else g.error("set_hover_pivot(): Wrong object or camera move style")};a.get_hover_cam_pivot=function(a,c){if(!b.is_hover_camera(a))return g.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));m.copy(a.e.Tb,
c);return c};a.has_distance_limits=function(a){return b.is_target_camera(a)||b.is_hover_camera(a)?a.e.Za:(g.error("has_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,c,d,e){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:e|=n.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>d){g.error("apply_vertical_limits(): wrong vertical limits");return}break;default:g.error("apply_vertical_limits(): wrong object");return}a.e.Zb={Oa:c,Ya:d};b.qA(a,e==n.SPACE_LOCAL);
n.v(a);h.sync_transform(a)};a.clear_vertical_limits=function(a){a.e.Zb=null};a.get_vertical_limits=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return g.error("get_vertical_limits(): wrong object"),null;var d=a.e;c=c||new Float32Array(2);return d.Zb?(c[0]=d.Zb.Oa,c[1]=d.Zb.Ya,c):null};a.has_vertical_limits=function(a){if(b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a))return Boolean(a.e.Zb);g.error("has_vertical_limits(): wrong object")};a.apply_horizontal_limits=
function(a,c,d,e){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:e|=n.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>d){g.error("apply_horizontal_limits(): wrong horizontal limits");return}break;default:g.error("apply_horizontal_limits(): wrong object");return}a.e.Sb={left:c,right:d};b.mA(a,e==n.SPACE_LOCAL);n.v(a);h.sync_transform(a)};a.clear_horizontal_limits=function(a){a.e.Sb=null};a.get_horizontal_limits=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&
!b.is_hover_camera(a))return g.error("get_horizontal_limits(): wrong object"),null;var d=a.e;c=c||new Float32Array(2);return d.Sb?(c[0]=d.Sb.left,c[1]=d.Sb.right,c):null};a.has_horizontal_limits=function(a){if(b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a))return Boolean(a.e.Sb);g.error("has_horizontal_limits(): wrong object")};a.apply_hover_angle_limits=function(a,c,d){b.is_hover_camera(a)?c<d?g.error("apply_hover_angle_limits(): wrong hover angle limits"):(c=f.angle_wrap_periodic(c,
-Math.PI,Math.PI),d=f.angle_wrap_periodic(d,-Math.PI,Math.PI),c=f.clamp(c,-Math.PI/2,0),d=f.clamp(d,-Math.PI/2,0),a.e.zb={Oa:c,Ya:d},b.gz(a),n.v(a),h.sync_transform(a)):g.error("apply_hover_angle_limits(): wrong object")};a.clear_hover_angle_limits=function(a){b.is_hover_camera(a)?a.e.zb=null:g.error("clear_hover_angle_limits(): wrong object")};a.apply_distance_limits=function(a,c,d){if(b.is_target_camera(a)||b.is_hover_camera(a))if(c>d)g.error("apply_distance_limits(): wrong distance limits");else{var e=
a.e;e.Za=!0;e.ee=c;e.Vf=d;n.v(a);h.sync_transform(a)}else g.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){b.is_target_camera(a)||b.is_hover_camera(a)?a.e.Za=!1:g.error("clear_distance_limits(): wrong object")};a.set_eye_params=function(b,c,d){g.error("set_eye_params() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,Math.PI/2-d)};a.is_look_up=function(a){f.quat_to_dir(a.e.quat,f.AXIS_MY,y);return 0<=y[1]?!0:!1};a.rotate_camera=
function(c,d,e,f,l){switch(a.get_move_style(c)){case b.MS_STATIC:break;case b.MS_TARGET_CONTROLS:b.rotate_target_camera(c,d,e,f,l);break;case b.MS_EYE_CONTROLS:b.rotate_eye_camera(c,d,e,f,l);break;case b.MS_HOVER_CONTROLS:b.rotate_hover_camera(c,d,e,f,l);break;default:g.error("rotate_camera(): Wrong object")}n.v(c);h.sync_transform(c)};a.rotate_target_camera=function(a,c,d,e,f){b.is_target_camera(a)?(b.rotate_target_camera(a,c,d,e,f),n.v(a),h.sync_transform(a)):g.error("rotate_target_camera(): wrong object")};
a.rotate_eye_camera=function(a,c,d,e,f){b.is_eye_camera(a)?(b.rotate_eye_camera(a,c,d,e,f),n.v(a),h.sync_transform(a)):g.error("rotate_eye_camera(): wrong object")};a.rotate_hover_camera=function(a,c,d,e,f){b.is_hover_camera(a)?(b.rotate_hover_camera(a,c,d,e,f),n.v(a),h.sync_transform(a)):g.error("rotate_hover_camera(): wrong object")};a.rotate=function(b,c,d){g.error("rotate() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,-d)};a.get_camera_angles=function(a,
c){c||(c=new Float32Array(2));b.get_camera_angles(a,c);return c};a.get_camera_angles_char=function(a,c){c||(c=new Float32Array(2));b.get_camera_angles_char(a,c);return c};a.get_angles=function(a,c){g.error("get_angles() deprecated, use get_camera_angles() instead");c||(c=new Float32Array(2));b.get_angles(a,c);return c};a.set_stereo_distance=function(a,c){for(var d=a.e.I,e=0;e<d.length;e++){var f=d[e];f.type!=b.vb&&f.type!=b.Db||b.dB(f,c,f.Gd)}};a.get_stereo_distance=function(a){a=a.e.I;for(var c=
0;c<a.length;c++){var d=a[c];if(d.type==b.vb||d.type==b.Db)return d.lj}return 0};a.is_underwater=function(a){g.error("is_underwater() deprecated, always returns false");return a.e.ut};a.translate_view=function(a,c,d,e){a=a.e.I;for(var f=0;f<a.length;f++){var g=a[f];g.fc||b.nf(g,g.Ba);var h=y;h[0]=-c;h[1]=-d;h[2]=0;w.translate(g.ua,h,g.ua);w.rotateZ(g.ua,e,g.ua);w.multiply(g.ua,g.ra,g.Ld);b.Gp(g);b.Yl(g)}};a.get_fov=function(a){return f.Tk(a.e.I[0].wc)};a.set_fov=function(a,c){for(var d=a.e.I,e=0;e<
d.length;e++){var g=d[e];g.wc=f.zx(c);g.fc||b.nf(g,g.Ba);w.multiply(g.ua,g.ra,g.Ld);b.Gp(g);b.Yl(g)}};a.correct_up=function(a,b){b||(b=f.AXIS_Y);l.correct_up(a,b)};a.zoom_object=function(a,c){if(b.is_target_camera(a)){n.get_object_center(c,!1,y);d(a,y);n.v(a);var e=n.get_object_size(c),f=b.uy(a)/2,e=e/Math.sin(f),f=n.$z(a,y);n.move_local(a,0,e-f,0);n.v(a);h.sync_transform(a)}else g.error("zoom_object(): wrong object")};a.set_ortho_scale=function(c,d){if(b.is_camera(c)&&a.is_ortho_camera(c)){var e=
c.e;if(b.is_target_camera(c)){var f=m.dist(e.h,e.Mb);e.oh=d/2*e.nh/f}else b.is_hover_camera(c)&&a.has_distance_limits(c)?(f=m.distance(e.h,e.Tb),e.oh=d/2*e.nh/f):c.e.I[0].top=d/2;b.tC(c)}else g.error("set_ortho_scale(): wrong object")};a.get_ortho_scale=function(c){if(b.is_camera(c)&&a.is_ortho_camera(c))return 2*c.e.I[0].top;g.error("get_ortho_scale(): wrong object")};a.is_ortho_camera=function(a){if(b.is_camera(a))return a.e.I[0].type==b.Mc;g.error("is_ortho_camera(): wrong object")};a.calc_ray=
function(a,c,d,f){f||(f=new Float32Array(3));var h=a.e.I[0];switch(h.type){case b.Ib:case b.Qd:case b.vb:case b.Db:var l=Math.tan(h.wc*Math.PI/360),n=l*h.Ba;c=e.$l(c,d,E,h);v[0]=(2*c[0]/h.width-1)*n;v[1]=-1;v[2]=(2*c[1]/h.height-1)*l;v[3]=0;r.transformMat4(v,a.e.W,v);f[0]=v[0];f[1]=v[1];f[2]=v[2];m.normalize(f,f);return f;default:return g.error("Non-compatible camera"),f}};a.project_point=function(a,c,d){d||(d=new Float32Array(2));return b.project_point(a,c,d)}};b4w.module.config=function(a,p){var c=p("__config");a.P_LOW=c.P_LOW;a.P_HIGH=c.P_HIGH;a.P_ULTRA=c.P_ULTRA;a.P_CUSTOM=c.P_CUSTOM;a.set=c.set;a.get=c.get;a.reset=c.reset;a.get_std_assets_path=c.get_std_assets_path};b4w.module.controls=function(a,p){var c=p("__controls"),d=p("__print");a.CT_CONTINUOUS=c.CT_CONTINUOUS;a.CT_TRIGGER=c.CT_TRIGGER;a.CT_SHOT=c.CT_SHOT;a.CT_LEVEL=c.CT_LEVEL;a.CT_CHANGE=c.CT_CHANGE;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_A=
65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;
a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=c.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=c.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=c.PL_MULTITOUCH_MOVE_PAN;a.create_custom_sensor=c.create_custom_sensor;a.create_keyboard_sensor=c.create_keyboard_sensor;a.create_collision_sensor=function(a,d,h){return c.create_collision_sensor(a,d||"ANY",
h||!1)};a.create_collision_impulse_sensor=c.create_collision_impulse_sensor;a.create_ray_sensor=function(a,d,h,g,l,n,f){return c.create_ray_sensor(a,d,h,g||"ANY",l||!1,n||!1,f||!1)};a.create_mouse_click_sensor=c.create_mouse_click_sensor;a.create_mouse_wheel_sensor=c.create_mouse_wheel_sensor;a.create_mouse_move_sensor=c.create_mouse_move_sensor;a.create_touch_move_sensor=c.create_touch_move_sensor;a.create_touch_zoom_sensor=c.create_touch_zoom_sensor;a.create_motion_sensor=c.create_motion_sensor;
a.create_vertical_velocity_sensor=c.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=c.create_gyro_angles_sensor;a.create_gyro_delta_sensor=c.create_gyro_delta_sensor;a.create_timer_sensor=function(a,d){return c.create_timer_sensor(a,d||!1)};a.reset_timer_sensor=c.reset_timer_sensor;a.create_elapsed_sensor=c.create_elapsed_sensor;a.create_timeline_sensor=c.create_timeline_sensor;a.create_selection_sensor=function(a,d){return c.create_selection_sensor(a,d||!1)};a.set_custom_sensor=function(a,
d){c.RA(a,d)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=c.get_sensor_value;a.get_sensor_payload=c.get_sensor_payload;a.create_sensor_manifold=function(a,d,h,g,l,n,f){l=l||c.kq;c.create_sensor_manifold(a,d,h,g,l,n,void 0===f?null:f)};a.create_kb_sensor_manifold=function(a,d,h,g,l,n){g=c.create_keyboard_sensor(g);c.create_sensor_manifold(a,d,h,[g],c.kq,l,void 0===n?null:n)};a.check_sensor_manifolds=function(a){return c.check_sensor_manifold(a,null)};a.check_sensor_manifold=
c.check_sensor_manifold;a.remove_sensor_manifolds=function(a){d.error("remove_sensor_manifolds() deprecated, use remove_sensor_manifold() instead");c.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=c.remove_sensor_manifold;a.reset=c.reset;a.register_keyboard_events=c.register_keyboard_events;a.register_mouse_events=function(a,d,h){c.register_mouse_events(a,d,!!h)};a.register_wheel_events=c.register_wheel_events;a.register_touch_events=c.register_touch_events;a.register_device_orientation=
c.register_device_orientation;a.unregister_keyboard_events=c.unregister_keyboard_events;a.unregister_mouse_events=c.unregister_mouse_events;a.unregister_wheel_events=c.unregister_wheel_events;a.unregister_touch_events=c.unregister_touch_events;a.unregister_device_orientation=c.unregister_device_orientation};b4w.module.constraints=function(a,p){var c=p("__camera"),d=p("__constraints"),b=p("__physics"),e=p("__print"),h=p("__transform");a.append_stiff=function(a,c,e,f,m){m=m||1;c instanceof Array&&2==c.length?d.mp(a,c[0],c[1],e,f,m):d.Gl(a,c,e,f,m);h.v(a);b.sync_transform(a)};a.append_semi_stiff=function(a,c,e,f){d.Av(a,c,e,f);h.v(a);b.sync_transform(a)};a.append_semi_stiff_cam=function(a,l,n,f,m,r,p,w){if(!c.is_eye_camera(a))return e.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented."),
null;d.zv(a,l,n,f,m,r,p,w);h.v(a);b.sync_transform(a)};a.append_semi_soft_cam=function(a,l,n,f){if(!c.is_eye_camera(a))return e.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented."),null;if(!f||0>f)f=.25;d.yv(a,l,n,f);h.v(a);b.sync_transform(a)};a.append_stiff_trans=function(a,c,e){d.Bv(a,c,e);h.v(a);b.sync_transform(a)};a.append_copy_trans=function(a,c,e){d.uv(a,c,e);h.v(a);b.sync_transform(a)};a.append_stiff_trans_rot=function(a,c,e,f){d.Cv(a,c,e,f);h.v(a);
b.sync_transform(a)};a.append_track=function(a,c){3==c.length?d.Fv(a,c):d.Ev(a,c);h.v(a);b.sync_transform(a)};a.append_follow=function(a,c,e,f){3==c.length?d.wv(a,c,e,f):d.vv(a,c,e,f);h.v(a);b.sync_transform(a)};a.append_stiff_viewport=function(a,c,e){d.append_stiff_viewport(a,c,e);h.v(a);b.sync_transform(a)};a.remove=function(a){a.ab&&d.remove(a)};a.get_parent=d.get_parent};b4w.module.container=function(a,p){var c=p("__container"),d=p("__print");a.get_canvas=c.get_canvas;a.get_container=c.get_container;a.insert_to_container=function(a,e){2!=arguments.length?d.error("insert_to_container(): two arguments required"):a&&e&&c.insert_to_container(a,e)};a.set_canvas_offsets=c.set_canvas_offsets;a.update_canvas_offsets=c.update_canvas_offsets;a.client_to_canvas_coords=c.client_to_canvas_coords;a.force_offsets_updating=c.force_offsets_updating};b4w.module.data=function(a,p){var c=p("__data");p("__print");p("__util");a.load=c.load;a.unload=function(a){c.unload(a|0)};a.set_debug_resources_root=c.set_debug_resources_root;a.is_primary_loaded=c.is_primary_loaded;a.load_and_add_new=c.load;a.cleanup=a.unload};b4w.module.debug=function(a,p){function c(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function d(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);c.send(b);
if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function b(a){a.sort(function(a,b){return b.Om.ALU_OPS-a.Om.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.Om,g=c.UC,h=e(c.ox),h=h?"\t\t("+h.join(", ")+")":"\t\t(NA)";f.groupCollapsed("FRAG --\x3e","ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",g.ALU_OPS,"TEX",g.TEX_OPS,h);f.groupCollapsed("directives");for(var h=c.Bb.Se,l=0;l<h.length;l++){var m=h[l];f.log(m[0],m[1])}f.groupEnd();f.groupCollapsed("vert src");
f.log(c.TC);f.groupEnd();f.groupCollapsed("vert stats");for(var n in g)"ALU_OPS"!=n&&"TEX_OPS"!=n&&f.log(n,g[n]);f.groupEnd();f.groupCollapsed("frag src");f.log(c.ey);f.groupEnd();f.groupCollapsed("frag stats");for(n in d)"ALU_OPS"!=n&&"TEX_OPS"!=n&&f.log(n,d[n]);f.groupEnd();f.groupEnd()}}function e(a){for(var b=m.Hi(),c=0;c<b.length;c++)for(var d=m.Ka(b[c],"MESH",m.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if(f.o)for(var g=0;g<f.o.length;g++){var h=f.o[g];if(h.Yb==a&&h.Tc.length)return h.Tc}}return null}
p("__batch");p("__config");var h=p("__controls"),g=p("__debug"),l=p("__extensions"),n=p("__physics"),f=p("__print"),m=p("__scenes"),r=p("__scenegraph"),z=p("__shaders"),w=p("__sfx"),E=p("__textures"),y=p("__util"),H=p("vec3");a.physics_stats=function(){n.vx()};a.physics_id=function(a){f.log("O",n.Xx(a));for(var b=n.ty().n.q,c=0;c<b.length;c++){var d=b[c];d.Xa.H==a&&f.log("B",d)}};a.visible_objects=function(){for(var a=m.get_active(),b=m.Ka(a,"MESH",m.DATA_ID_ALL),a=[m.aa(a,"MAIN_OPAQUE"),m.aa(a,"MAIN_BLEND")],
c=0;c<a.length;c++){var d=a[c],e=d.q;if(e.length){f.group(d.type,"DYNAMIC");for(var g=0;g<b.length;g++){var h=b[g],l=h.e;if("DYNAMIC"==l.type)for(var n=0;n<e.length;n++){var r=e[n];if(r.Ta&&r.ed==l){f.xn(h.name,h);break}}}f.groupEnd();f.groupCollapsed(d.type,"STATIC");for(g=0;g<b.length;g++)if(h=b[g],l=h.e,"DYNAMIC"!=l.type)for(n=0;n<e.length;n++)if(r=e[n],r.Ta&&r.ed==l){f.xn(h.name,h);break}f.groupEnd()}}};a.object_info=function(a){for(var b=m.get_active(),c=m.Ka(b,"MESH",m.DATA_ID_ALL),d=0;d<c.length;d++){var e=
c[d];if(e.name==a){f.log("Object",e);for(var g=m.Rm(b),h=0;h<g.length;h++){for(var l=g[h],n=l.q,r=[],p=0;p<n.length;p++)n[p].ed==e.e&&r.push(n[p]);f.log("Subscene "+l.type,r)}}}};a.objects_stat=function(){var a=m.get_active();console.log("Armatures: "+m.Ka(a,"ARMATURE",m.DATA_ID_ALL).length);console.log("Cameras: "+m.Ka(a,"CAMERA",m.DATA_ID_ALL).length);console.log("Curves: "+m.Ka(a,"CURVE",m.DATA_ID_ALL).length);console.log("Empties: "+m.Ka(a,"EMPTY",m.DATA_ID_ALL).length);console.log("Lamps: "+
m.Ka(a,"LAMP",m.DATA_ID_ALL).length);console.log("Meshes: "+m.Ka(a,"MESH",m.DATA_ID_ALL).length);console.log("Speakers: "+m.Ka(a,"SPEAKER",m.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=m.get_active(),b=[m.aa(b,"MAIN_OPAQUE"),m.aa(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.q,e=0;e<d.length;e++){var f=d[e].B;f&&(a+=f.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=m.get_active(),b=[m.aa(b,"MAIN_OPAQUE"),m.aa(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=
b[c];if(d)for(var d=d.q,e=0;e<d.length;e++){var f=d[e].B;f&&(a+=f.num_triangles)}}return a};a.num_draw_calls=function(){var a=m.get_active(),a=[m.aa(a,"MAIN_OPAQUE"),m.aa(a,"MAIN_BLEND")];return a[0].q.length+a[1].q.length};a.num_shaders=function(){return y.yd(z.Oq())};a.geometry_stats=function(){for(var a=m.get_active(),b=m.Rm(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.q,f=0;f<e.length;f++){var g=e[f].B,h=e[f].ed;g&&("COLOR_PICKING"!=d.type&&"OUTLINE_MASK"!=
d.type||h.Hk||h.Gk)&&(a[g.id]=g)}}var e=d=c=b=0,l;for(l in a)g=a[l],g=g.U,g.ak&&(d++,e+=g.ak/1048576),b++,c+=g.jq/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=m.get_active(),c=[m.aa(c,"MAIN_OPAQUE"),m.aa(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=e.q,f=0;f<e.length;f++){var g=e[f].B;if(g)for(var g=g.M,h=0;h<g.length;h++){var l=g[h];if("IMAGE"===l.source||"ENVIRONMENT_MAP"===l.source){var n=l.$a;-1===a.indexOf(n)&&
(a.push(n),l=l.width*l.height*4/1048576/l.im,l*=1.3333,b+=l)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=m.get_active(),c=m.Rm(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var f=e.j,g=[f.ib,f.Qc];g.push.apply(g,e.Hd);for(e=0;e<g.length;e++){var h=g[e];E.Oi(h)&&-1==a.indexOf(h)&&(a.push(h),b+=f.width*f.height*E.Sy(h))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=m.get_active();(a=m.aa(a,"MAIN_OPAQUE"))&&
m.Hr(a.j,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=m.get_active(),b=m.aa(a,"MAIN_OPAQUE"),a=m.QB(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}m.Hr(d.j,b,e)}};a.scenegraph_to_dot=function(){for(var a=m.Hi(),b=0;b<a.length;b++)f.log("\n"+r.tx(m.Tm(a[b])))};a.scenes_to_dot=function(){};a.controls_info=h.debug;a.object_distance=function(a,b){return H.dist(a.e.h,b.e.h)};a.msg=
g.msg;a.fbmsg=g.fbmsg;a.print_telemetry=g.print_telemetry;a.plot_telemetry=g.plot_telemetry;a.fbres=function(a,b){function c(){g.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),f=new Float32Array([-1,0,0]),g=new Float32Array([0,-1,0]),h=new Float32Array([0,0,-1]);if(!y.Pe(a,y.hv))throw"Wrong VEC3_IDENT";if(!y.Pe(b,y.bv))throw"Wrong QUAT4_IDENT";
if(!y.Pe(c,y.AXIS_X))throw"Wrong AXIS_X";if(!y.Pe(d,y.AXIS_Y))throw"Wrong AXIS_Y";if(!y.Pe(e,y.AXIS_Z))throw"Wrong AXIS_Z";if(!y.Pe(f,y.AXIS_MX))throw"Wrong AXIS_MX";if(!y.Pe(g,y.AXIS_MY))throw"Wrong AXIS_MY";if(!y.Pe(h,y.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=w.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==w.Vm(c)&&w.mute(c,!0)}};a.check_finite=function(a){g.check_finite(a)};a.set_debug_params=function(a){var b=m.get_active();if(b=m.aa(b,"WIREFRAME"))"string"==
typeof a.wireframe_mode&&m.jB(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&m.iB(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return f.Gy()};a.get_warning_quantity=function(){return f.Xy()};a.clear_errors_warnings=function(){return f.clear_errors_warnings()};a.analyze_shaders=function(a){var e=z.Oq(),g=0,h;for(h in e)a&&-1===h.indexOf(a)||g++;var g="of "+g+" analyzing...",k={};for(h in e)if(!a||-1!==h.indexOf(a)){var m=e[h],n;
var r=m.Mo;n=m.Fq;var p=l.Pq();if(p){r=p.getTranslatedShaderSource(r);n=p.getTranslatedShaderSource(n);var p=d("/nvidia_vert",r),w=c(p),y=d("/nvidia_frag",n),E=c(y);n={TC:r,yF:p,UC:w,ey:n,jE:y,Om:E}}else f.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),n=void 0;p=m.Bb;r=p.rj+" + "+p.Ci;n.ox=m;n.Bb=p;m=k[r]=k[r]||[];m.push(n);f.log(g)}for(r in k)f.group("%c"+r,"color: #800"),m=k[r],b(m),f.groupEnd()}};b4w.module.geometry=function(a,p){var c=p("__batch"),d=p("__geometry"),b=p("__print"),e=p("__renderer");a.extract_vertex_array=function(a,e,l){if(!d.Ii(a))return b.error("Wrong object:",a.name),null;if(a=c.ma(a,e,"MAIN")){if((e=a.U)&&e.Vb&&e.Vb[l])return d.Rx(e,l);b.error("Attribute not found:"+l);return null}b.error("Wrong material:",e);return null};a.extract_index_array=function(a,e){if(!d.Ii(a))return b.error("Wrong object:",a.name),null;var l=c.ma(a,e,"MAIN");if(l){if((l=l.U)&&l.Vb)return l.Ze;
b.error("Buffer data not found");return null}b.error("Wrong material:",e);return null};a.update_vertex_array=function(a,e,l,n){var f=["MAIN","DEPTH","COLOR_ID"];if(d.Ii(a))for(var m=0;m<f.length;m++){var r=c.ma(a,e,f[m]);r&&(r=r.U)&&r.Vb&&r.Vb[l]&&d.il(r,l,0,n)}else b.error("Wrong object:",a.name)};a.override_geometry=function(a,g,l,n,f){var m=["MAIN","DEPTH","COLOR_ID"];if(d.Ii(a))if(l instanceof Uint16Array||l instanceof Uint32Array)if(n instanceof Float32Array)for(var r=0;r<m.length;r++){var p=
c.ma(a,g,m[r]);if(p){var w=p.U;if(w){d.kC(w,p.ge,l);var E=0,y;for(y in w.Vb)var H=w.Vb[y],E=E+n.length/3*H.Bd;w.nd=new Float32Array(E);var E=w.nd,v=0;for(y in w.Vb)switch(H=w.Vb[y],y){case "a_position":E.set(n,v);H.offset=v;H.length=n.length;v+=H.length;break;case "a_normal":var B;f&&(B=d.Fp(l,n,n));var t=d.Dp(l,n,B);E.set(t,v);H.offset=v;H.length=n.length;v+=H.length;break;case "a_tangent":H.offset=v;H.length=n.length/3*H.Bd;for(var t=new Float32Array(H.length),u=0;u<t.length;u+=4)t[u]=1,t[u+3]=
1;E.set(t,v);v+=H.length;break;default:H.offset=v,H.length=n.length/3*H.Bd,t=new Float32Array(H.length),E.set(t,v),v+=H.length}d.yt(w);e.np(p);(p=c.uc(a,p))&&p.U&&(p.U=w)}}}else b.error("Wrong positions_array type");else b.error("Wrong ibo_array type");else b.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,c,e){if(!d.check_shape_keys(a))return b.error("Wrong object:",a.name),null;if(!d.ir(a,c))return b.error("Wrong key name:",c),null;d.Lv(a,c,parseFloat(e))};a.check_shape_keys=function(a){return d.check_shape_keys(a)};
a.get_shape_keys_names=function(a){return d.check_shape_keys(a)?d.get_shape_keys_names(a):(b.error("Wrong object:",a.name),null)};a.get_shape_key_value=function(a,c){return d.check_shape_keys(a)?d.ir(a,c)?d.get_shape_key_value(a,c):(b.error("Wrong key name:",c),null):(b.error("Wrong object:",a.name),null)}};b4w.module.hud=function(a,p){var c=p("__hud");p("__print");a.draw_mixer_strip=c.draw_mixer_strip;a.plot_array=c.plot_array};b4w.module.lights=function(a,p){function c(a){for(var c=h.get_active(),d=h.Ka(c,"LAMP",h.DATA_ID_ALL),m=0;m<d.length;m++){var p=d[m];if("SUN"==p.sa.type){var r=p;break}}if(!r)return b.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(d=(90-a.vert_position)/180*Math.PI,m=r.e,g.set_rotation_euler(r,[d,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),l.quat_to_dir(m.quat,l.AXIS_Y,a),m=n.length(m.h),n.copy(a,f),n.scale(f,m,f),g.set_translation(r,
f),g.v(r),a=r.sa,a.qq&&(p=r.data.energy,m=c.world.light_settings.environment_energy,d=Math.cos(Math.abs(d)),p*=Math.max(Math.min(3*d,1),0),d=Math.max(d,.1)*m,e.Ls(a,p),h.set_environment_colors(c,d,null,null)),h.Ig(r,c))}function d(a){if(e.wk(a))return a.sa.type;b.error("get_light_type(): Wrong object");return!1}var b=p("__print"),e=p("__lights"),h=p("__scenes");p("__batch");var g=p("__transform"),l=p("__util"),n=p("vec3"),f=new Float32Array(3),m,r=60;a.get_lamps=function(a){var b=h.get_active(),b=
h.Ka(b,"LAMP",h.DATA_ID_ALL);if(!a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.sa.type===a&&c.push(e)}return c};a.get_sun_params=function(){for(var a=h.get_active(),a=h.Ka(a,"LAMP",h.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.sa.type){b=d;break}}return b?(b=b.sa.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=c;a.set_day_time=
function(a){for(var d=h.get_active(),d=h.Ka(d,"LAMP",h.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if("SUN"==f.sa.type){var g=f;break}}if(!g)return b.error("There is no sun on the scene"),null;g=-Math.cos(a/12*Math.PI)*r;d={};d.hor_position=12>a?15*a:15*(a-24);d.vert_position=g;c(d)};a.set_date=function(a){(m=a.getDate())?1582==m&&10==a.YE&&4<a.sx&&15>a.sx&&b.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):b.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=
function(a){r=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(e.wk(a))var c=a.sa;else return b.error("get_light_params(): Wrong object"),!1;if(a=d(a))switch(a){case "SPOT":var f={light_type:a,light_color:c.color,light_energy:c.Te,light_spot_blend:c.Gg,light_spot_size:c.ld,light_distance:c.distance};break;case "POINT":f={light_type:a,light_color:c.color,light_energy:c.Te,light_distance:c.distance};break;default:f={light_type:a,light_color:c.color,light_energy:c.Te}}return f?f:!1};a.get_light_type=
d;a.set_light_params=function(a,c){if(e.wk(a))var d=a.sa;else return b.error("set_light_params(): Wrong object"),!1;var f=h.get_active();"number"==typeof c.light_energy&&(e.Ls(d,c.light_energy),h.Ig(a,f));"object"==typeof c.light_color&&(e.YA(d,c.light_color),h.Ig(a,f));"number"==typeof c.light_spot_blend&&(e.$A(d,c.light_spot_blend),h.Ig(a,f));"number"==typeof c.light_spot_size&&(e.aB(d,c.light_spot_size),h.Ig(a,f));"number"==typeof c.light_distance&&(e.ZA(d,c.light_distance),h.Ig(a,f));h.eC()}};b4w.module.material=function(a,p){function c(a,b){for(var c=a.o,d=0;d<c.length;d++){var e=c[d];if(-1<e.Tc.indexOf(b))return"MAIN"==e.type}return!1}function d(a,b){var c=e.ma(a,b,"MAIN");return Boolean(c&&c.kc[0])}function b(a,b){var c=e.ma(a,b,"MAIN");return Boolean(c&&c.kc[1])}var e=p("__batch"),h=p("__config"),g=p("__print"),l=p("__objects"),n=p("__shaders");p("__util");p("vec4");var f=h.p,m="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.inherit_material=function(a,
b,c,d){if(l.Ki(c)&&l.Ki(a)){for(var f=["MAIN","DEPTH","COLOR_ID"],h=!1,n=0;n<f.length;n++){var p=f[n],t=e.ma(a,b,p),u=e.ma(c,d,p);if(t&&u){var h=!0,k=e.uc(c,d,p);"MAIN"==p&&(e.Ms(u,t),k&&e.Ms(k,t));for(p=0;p<u.Hb.length;p++){var q=u.Hb[p];if(-1!==m.indexOf(q)){var J=t.Hb.indexOf(q);-1!==J&&(u.M[p]=t.M[J],k&&(q=k.Hb.indexOf(q),-1!==q&&(k.M[q]=t.M[J])))}}}}h||g.error("Wrong objects for inheriting material!")}else g.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.o;
for(var c=0;c<a.length;c++)for(var d=0;d<a[c].Tc.length;d++)-1==b.indexOf(a[c].Tc[d])&&b.push(a[c].Tc[d]);return b};a.set_diffuse_color=function(a,b,c){var d=e.ma(a,b,"MAIN");d?(d.Rc.set(c),(a=e.uc(a,b,"MAIN"))&&a.Rc.set(c)):g.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=e.ma(a,b,"MAIN");if(c){var d=new Float32Array(4);d.set(c.Rc);return d}g.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,c){var d=e.ma(a,b,"MAIN");
if(d){if(d.Re=c,a=e.uc(a,b,"MAIN"))a.Re=c}else g.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=e.ma(a,b,"MAIN");if(c)return c.Re;g.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var d=e.ma(a,b,"MAIN");d?(d.Ed.set(c),(a=e.uc(a,b,"MAIN"))&&a.Ed.set(c)):g.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=e.ma(a,b,"MAIN");if(c){var d=Array(3);d[0]=c.Ed[0];d[1]=c.Ed[1];
d[2]=c.Ed[2];return d}g.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,b,c){d(a,b)||g.error('Property "specular_intensity" is missing!');e.ma(a,b,"MAIN").kc[0]=c;(a=e.uc(a,b,"MAIN"))&&(a.kc[0]=c)};a.get_specular_intensity=function(a,b){d(a,b)||g.error('Property "specular_intensity" is missing!');return e.ma(a,b,"MAIN").kc[0]};a.check_specular_intensity=d;a.set_specular_hardness=function(a,c,d){b(a,c)||g.error('Property "specular_hardness" is missing!');e.ma(a,
c,"MAIN").kc[1]=d;(a=e.uc(a,c,"MAIN"))&&(a.kc[1]=d)};a.get_specular_hardness=function(a,c){b(a,c)||g.error('Property "specular_hardness" is missing!');return e.ma(a,c,"MAIN").kc[1]};a.check_specular_hardness=b;a.set_emit_factor=function(a,b,c){var d=e.ma(a,b,"MAIN");if(d){if(d.he=c,a=e.uc(a,b,"MAIN"))a.he=c}else g.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=e.ma(a,b,"MAIN");if(c)return c.he;g.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=
function(a,b,c){var d=e.ma(a,b,"MAIN");if(d){if(d.Td=c,a=e.uc(a,b,"MAIN"))a.Td=c}else g.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=e.ma(a,b,"MAIN");if(c)return c.Td;g.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){var d=e.ma(a,b,"MAIN");if(d){if(d.Qe=c,a=e.uc(a,b,"MAIN"))a.Qe=c}else g.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=e.ma(a,b,"MAIN");
if(c)return c.Qe;g.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var d=e.ma(a,b,"MAIN");if(d){if(d.Ke=c,a=e.uc(a,b,"MAIN"))a.Ke=c}else g.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=e.ma(a,b,"MAIN");if(c)return c.Ke;g.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return g.error("missing arguments in get_material_params"),null;if(!c(a,b))return null;var d=
e.ma(a,b,"MAIN");if(!d)return null;var f={};"MAIN"==d.type&&(f.reflect_factor=d.reflect_factor,f.fresnel=d.cd[2],f.fresnel_factor=5*(1-d.cd[3]),f.parallax_scale=d.parallax_scale,f.parallax_steps=e.yb(d,"PARALLAX_STEPS")[1]);return f};a.get_water_material_params=function(a,b){if(!a||!b)return g.error("missing arguments in get_water_material_params"),null;if(!c(a,b))return null;var d=e.ma(a,b,"MAIN");if(!d||!d.Af)return null;if(!d)return g.error("material not found"),null;var h={};if("MAIN"==d.type){if(f.Gh){var l=
h.shallow_water_col=Array(3);l[0]=d.shallow_water_col[0];l[1]=d.shallow_water_col[1];l[2]=d.shallow_water_col[2];l=h.shore_water_col=Array(3);l[0]=d.shore_water_col[0];l[1]=d.shore_water_col[1];l[2]=d.shore_water_col[2];h.shallow_water_col_fac=d.shallow_water_col_fac;h.shore_water_col_fac=d.shore_water_col_fac}h.foam_factor=d.foam_factor;h.norm_uv_velocity=d.ai;h.absorb_factor=e.yb(d,"ABSORB")[1];h.sss_strength=e.yb(d,"SSS_STRENGTH")[1];h.sss_width=e.yb(d,"SSS_WIDTH")[1];h.dst_noise_scale0=e.yb(d,
"DST_NOISE_SCALE_0")[1];h.dst_noise_scale1=e.yb(d,"DST_NOISE_SCALE_1")[1];h.dst_noise_freq0=e.yb(d,"DST_NOISE_FREQ_0")[1];h.dst_noise_freq1=e.yb(d,"DST_NOISE_FREQ_1")[1];h.dir_min_shore_fac=e.yb(d,"DIR_MIN_SHR_FAC")[1];h.dir_freq=e.yb(d,"DIR_FREQ")[1];h.dir_noise_scale=e.yb(d,"DIR_NOISE_SCALE")[1];h.dir_noise_freq=e.yb(d,"DIR_NOISE_FREQ")[1];h.dir_min_noise_fac=e.yb(d,"DIR_MIN_NOISE_FAC")[1];h.dst_min_fac=e.yb(d,"DST_MIN_FAC")[1];h.waves_hor_fac=e.yb(d,"WAVES_HOR_FAC")[1]}return h};a.set_material_extended_params=
function(a,b,d){if(a&&b&&d){if(!c(a,b))return g.error("setting material params is not possible"),null;var f=e.ma(a,b,"MAIN");if(f){var h=[f];(f=e.uc(a,b,"MAIN"))&&h.push(f);for(a=0;a<h.length;a++)f=h[a],"number"==typeof d.material_reflectivity&&(f.reflect_factor=d.material_reflectivity),"number"==typeof d.material_fresnel&&(f.cd[2]=d.material_fresnel),"number"==typeof d.material_fresnel_factor&&(f.cd[3]=1-d.material_fresnel_factor/5),"number"==typeof d.material_parallax_scale&&(f.parallax_scale=d.material_parallax_scale),
"number"==typeof d.material_parallax_steps&&(b=n.t(parseFloat(d.material_parallax_steps)),e.pa(f,"PARALLAX_STEPS",b),e.kb(f,!0))}else g.error("material not found")}else g.error("missing arguments in set_material_params")};a.set_water_material_params=function(a,b,d){if(!a||!b||!d)return g.error("missing arguments in set_water_material_params"),null;if(!c(a,b))return g.error("setting water material params is not possible"),null;var h=e.ma(a,b,"MAIN");if(!h)return g.error("material not found"),null;
var l=[h];(h=e.uc(a,b,"MAIN"))&&l.push(h);for(a=0;a<l.length;a++)h=l[a],f.Gh&&("object"==typeof d.shallow_water_col&&h.shallow_water_col.set(d.shallow_water_col),"number"==typeof d.shallow_water_col_fac&&(h.shallow_water_col_fac=d.shallow_water_col_fac),"object"==typeof d.shore_water_col&&h.shore_water_col.set(d.shore_water_col),"number"==typeof d.shore_water_col_fac&&(h.shore_water_col_fac=d.shore_water_col_fac)),f.shore_smoothing&&h.ql&&("boolean"==typeof d.shore_smoothing&&(d.shore_smoothing?e.pa(h,
"SHORE_SMOOTHING",1):e.pa(h,"SHORE_SMOOTHING",0)),"number"==typeof d.absorb_factor&&(b=n.t(parseFloat(d.absorb_factor)),e.pa(h,"ABSORB",b))),"number"==typeof d.foam_factor&&f.fh&&(h.foam_factor=d.foam_factor),"number"==typeof d.norm_uv_velocity&&(h.ai=d.norm_uv_velocity),f.water_dynamic&&h.water_dynamic&&("boolean"==typeof d.water_dynamic&&(d.water_dynamic?e.pa(h,"DYNAMIC",1):e.pa(h,"DYNAMIC",0)),"number"==typeof d.waves_height&&(b=n.t(parseFloat(d.waves_height)),e.pa(h,"WAVES_HEIGHT",b)),"number"==
typeof d.waves_length&&(b=n.t(parseFloat(d.waves_length)),e.pa(h,"WAVES_LENGTH",b)),"number"==typeof d.sss_strength&&(b=n.t(parseFloat(d.sss_strength)),e.pa(h,"SSS_STRENGTH",b)),"number"==typeof d.sss_width&&(b=n.t(parseFloat(d.sss_width)),e.pa(h,"SSS_WIDTH",b)),"number"==typeof d.dst_noise_scale0&&(b=n.t(parseFloat(d.dst_noise_scale0)),e.pa(h,"DST_NOISE_SCALE_0",b)),"number"==typeof d.dst_noise_scale1&&(b=n.t(parseFloat(d.dst_noise_scale1)),e.pa(h,"DST_NOISE_SCALE_1",b)),"number"==typeof d.dst_noise_freq0&&
(b=n.t(parseFloat(d.dst_noise_freq0)),e.pa(h,"DST_NOISE_FREQ_0",b)),"number"==typeof d.dst_noise_freq1&&(b=n.t(parseFloat(d.dst_noise_freq1)),e.pa(h,"DST_NOISE_FREQ_1",b)),"number"==typeof d.dir_min_shore_fac&&(b=n.t(parseFloat(d.dir_min_shore_fac)),e.pa(h,"DIR_MIN_SHR_FAC",b)),"number"==typeof d.dir_freq&&(b=n.t(parseFloat(d.dir_freq)),e.pa(h,"DIR_FREQ",b)),"number"==typeof d.dir_noise_scale&&(b=n.t(parseFloat(d.dir_noise_scale)),e.pa(h,"DIR_NOISE_SCALE",b)),"number"==typeof d.dir_noise_freq&&(b=
n.t(parseFloat(d.dir_noise_freq)),e.pa(h,"DIR_NOISE_FREQ",b)),"number"==typeof d.dir_min_noise_fac&&(b=n.t(parseFloat(d.dir_min_noise_fac)),e.pa(h,"DIR_MIN_NOISE_FAC",b)),"number"==typeof d.dst_min_fac&&(b=n.t(parseFloat(d.dst_min_fac)),e.pa(h,"DST_MIN_FAC",b)),"number"==typeof d.waves_hor_fac&&(b=n.t(parseFloat(d.waves_hor_fac)),e.pa(h,"WAVES_HOR_FAC",b))),e.kb(h,!0);return!0}};b4w.module.particles=function(a,p){var c=p("__particles"),d=p("__print");a.set_size=function(a,e,h){c.lh(a)?c.set_size(a,e,h):d.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,e,h){c.lh(a)?c.set_normal_factor(a,e,h):d.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,e,h){c.lh(a)?(h=Math.min(h,1),h=Math.max(h,0),c.set_factor(a,e,h)):d.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,p){var c=p("__physics"),d=p("__print"),b=p("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){c.has_physics(a)?c.enable_simulation(a):d.error("No physics for object "+a.name)};a.disable_simulation=function(a){c.has_physics(a)?c.disable_simulation(a):d.error("No physics for object "+a.name)};a.has_physics=function(a){return c.has_physics(a)};a.has_simulated_physics=function(a){return c.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return c.has_dynamic_physics(a)};a.set_gravity=function(a,b){c.has_physics(a)?c.set_gravity(a,b):d.error("No physics for object "+a.name)};a.set_damping=function(a,b,g){c.has_physics(a)?c.w("set_damping",a.n.H,b,g):d.error("No physics for object "+a.name)};a.reset_damping=function(a){if(c.has_physics(a)){var b=a.game;c.w("set_damping",a.n.H,b.damping,b.rotation_damping)}else d.error("No physics for object "+a.name)};a.set_transform=function(a,b,g){c.has_physics(a)?c.set_transform.apply(this,
arguments):d.error("No physics for object "+a.name)};a.sync_transform=function(a){c.has_physics(a)?c.sync_transform(a):d.error("No physics for object "+a.name)};a.apply_velocity=function(a){c.has_physics(a)?c.apply_velocity.apply(this,arguments):d.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){c.has_physics(a)?c.apply_velocity_world.apply(this,arguments):d.error("No physics for object "+a.name)};a.apply_force=function(a,b,g,l){c.has_physics(a)?c.apply_force.apply(this,
arguments):d.error("No physics for object "+a.name)};a.apply_torque=function(a,b,g,l){c.has_physics(a)?c.apply_torque.apply(this,arguments):d.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,h){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||d.error("Wrong object"),c.vehicle_throttle(a,b.clamp(h,-1,1))):d.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,h,g){if(c.has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||d.error("Wrong object");
h=b.clamp(h,0,1);var l=a.l.eh;-1==g||1==g?l=Math.max(-1,Math.min(l+g*h,1)):0==g&&0<=l?(l-=h,l=Math.max(0,l)):0==g&&0>l?(l+=h,l=Math.min(0,l)):d.error("Wrong steering direction");c.vehicle_throttle(a,b.clamp(l,-1,1))}else d.error("No physics for object "+a.name)};a.vehicle_steer=function(a,h){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||d.error("Wrong object"),c.vehicle_steer(a,b.clamp(h,-1,1))):d.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,h,g){if(c.has_physics(a)){c.is_vehicle_chassis(a)||
c.is_vehicle_hull(a)||d.error("Wrong object");h=b.clamp(h,0,1);var l=a.l.Mh;-1==g||1==g?l=Math.max(-1,Math.min(l+g*h,1)):0==g&&0<=l?(l-=h,l=Math.max(0,l)):0==g&&0>l?(l+=h,l=Math.min(0,l)):d.error("Wrong steering direction");c.vehicle_steer(a,b.clamp(l,-1,1))}else d.error("No physics for object "+a.name)};a.vehicle_brake=function(a,h){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||d.error("Wrong object"),c.vehicle_brake(a,b.clamp(h,0,1))):d.error("No physics for object "+a.name)};
a.vehicle_brake_inc=function(a,h){if(c.has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||d.error("Wrong object");h=b.clamp(h,-1,1);var g=a.l.li;c.vehicle_brake(a,b.clamp(g+g*h,0,1))}else d.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return c.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return c.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!c.has_physics(a))return d.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.b4w_vehicle_settings.name;
d.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!c.has_physics(a))return d.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.l.eh;d.error("Wrong object")};a.get_vehicle_steering=function(a){if(!c.has_physics(a))return d.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.l.Mh;d.error("Wrong object")};a.get_vehicle_brake=function(a){if(!c.has_physics(a))return d.error("No physics for object "+
a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.l.li;d.error("Wrong object")};a.get_vehicle_speed=function(a){if(!c.has_physics(a))return d.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return c.get_vehicle_speed(a);d.error("Wrong object")};a.is_character=function(a){return c.is_character(a)};a.set_character_move_dir=function(a,b,g){c.has_physics(a)?c.set_character_move_dir(a,b,g):d.error("No physics for object "+a.name)};a.set_character_move_type=
function(a,b){c.has_physics(a)?c.set_character_move_type(a,b):d.error("No physics for object "+a.name)};a.set_character_walk_velocity=function(a,b){c.has_physics(a)?c.set_character_walk_velocity(a,b):d.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,b){c.has_physics(a)?c.set_character_run_velocity(a,b):d.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,b){c.has_physics(a)?c.set_character_fly_velocity(a,b):d.error("No physics for object "+
a.name)};a.character_jump=function(a){c.has_physics(a)?c.character_jump(a):d.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,b,g){c.has_physics(a)?c.character_rotation_inc(a,b,g):d.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,b){c.has_physics(a)?c.set_character_rotation_quat(a,b):d.error("No physics for object "+a.name)};a.set_character_rotation=function(a,b,g){c.has_physics(a)?c.set_character_rotation(a,b,g):d.error("No physics for object "+
a.name)};a.set_character_rotation_v=function(a,b){c.has_physics(a)?c.set_character_rotation_v(a,b):d.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,b){c.has_physics(a)?c.set_character_rotation_h(a,b):d.error("No physics for object "+a.name)};a.append_collision_test=function(a,b,g,l){c.has_physics(a)?c.append_collision_test(a,b,g,l||!1):d.error("No physics for object "+a.name)};a.remove_collision_test=function(a,b,g){c.has_physics(a)?c.remove_collision_test(a,b||"ANY",
g):d.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,b){c.has_physics(a)?c.apply_collision_impulse_test(a,b):d.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){c.has_physics(a)?c.clear_collision_impulse_test(a):d.error("No physics for object "+a.name)};a.append_ray_test=function(a,b,d,l,n,f){return c.append_ray_test(a,b,d,l,n,f||!1,!1,!1,!1)};a.append_ray_test_ext=function(a,b,d,l,n,f,m,p,z){return c.append_ray_test(a,b,d,l,n,f||
!1,m||!1,p||!1,z||!1)};a.remove_ray_test=function(a){c.tr(a)?c.remove_ray_test(a):d.error("Wrong ray test ID")};a.change_ray_test_from_to=function(a,b,g){c.tr(a)?c.change_ray_test_from_to(a,b,g):d.error("Wrong ray test ID")};a.apply_constraint=function(a,b,g,l,n,f,m,p,z,w){c.has_physics(b)&&c.has_physics(n)?c.apply_constraint(a,b,g,l,n,f,m,p,z,w):d.error("Wrong objects")};a.clear_constraint=function(a){c.has_physics(a)&&c.cz(a)?c.clear_constraint(a):d.error("Wrong object")};a.pull_to_constraint_pivot=
function(a,b,g,l,n,f){c.has_physics(a)&&c.has_physics(l)?c.pull_to_constraint_pivot(a,b,g,l,n,f):d.error("Wrong objects")}};b4w.module.rgb=function(a,p){p("__print");var c=p("__util"),d=new Float32Array(3);a.create=function(){return new Float32Array(3)};a.from_values=function(a,c,d){var g=new Float32Array(3);g[0]=a;g[1]=c;g[2]=d;return g};a.set=function(a,c,d,g){g[0]=a;g[1]=c;g[2]=d;return g};a.css_to_rgb=function(a,d,h,g){g=g||new Float32Array(3);g[0]=a/255;g[1]=d/255;g[2]=h/255;c.ft(g,g);return g};a.rgb_to_css=function(a){a=c.tn(a,d);return[Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])]};a.rgb_to_css_hex=
function(a){function e(a){a=Math.round(255*a).toString(16);return 1==a.length?"0"+a:a}a=c.tn(a,d);return"#"+e(a[0])+e(a[1])+e(a[2])}};
b4w.module.rgba=function(a,p){p("__print");var c=p("__util"),d=new Float32Array(3);a.create=function(){var a=new Float32Array(4);a[3]=1;return a};a.from_values=function(a,c,d,g){var l=new Float32Array(4);l[0]=a;l[1]=c;l[2]=d;l[3]=g;return l};a.set=function(a,c,d,g,l){l[0]=a;l[1]=c;l[2]=d;l[3]=g;return l};a.css_to_rgba=function(a,d,h,g,l){l=l||new Float32Array(4);l[0]=a/255;l[1]=d/255;l[2]=h/255;l[3]=g;c.ft(l,l);return l};a.rgba_to_css=function(a){var e=c.tn(a,d);return[Math.round(255*e[0]),Math.round(255*
e[1]),Math.round(255*e[2]),a[3]]}};b4w.module.scenes=function(a,p){var c=p("__batch"),d=p("__camera"),b=p("__graph"),e=p("__objects"),h=p("__print"),g=p("__physics"),l=p("__scenes"),n=p("__util");a.DATA_ID_ALL=l.DATA_ID_ALL;a.set_active=function(a){var b=l.Hi();l.set_active(n.keysearch("name",a,b))};a.get_active=function(){return l.ja()?l.get_active().name:""};a.get_scenes=function(){for(var a=l.Hi(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(l.ja())return l.hk(l.get_active());h.error("No active scene");
return!1};a.get_object_by_name=function(a,b){var c=l.zd(l.Ef,a,b|0);if(c)return c;h.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,c){if(a=l.zd(l.tl,a,b,c|0))return a;h.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var c=l.zd(l.ul,a,b|0);if(c)return c;h.error("get object "+a+": not found")};a.get_object_data_id=function(a){return l.get_object_data_id(a)};a.pick_object=l.pick_object;a.outlining_is_enabled=function(a){return a&&a.e&&
a.e.Gb};a.set_outline_intensity=function(a,b){a&&a.e&&a.e.Gb?a.e.fd=b:h.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=function(a){if(a&&a.e&&a.e.Gb)return a.e.fd;h.error("get_outline_intensity(): wrong object")};a.apply_outline_anim=function(a,b,c,d){a&&a.e&&a.e.Gb?l.apply_outline_anim(a,b,c,d):h.error("apply_outline_anim(): wrong object")};a.apply_outline_anim_def=function(a){if(a&&a.e&&a.e.Gb){var b=a.e.Ti;l.apply_outline_anim(a,b.Ik,b.Jk,b.Kk)}else h.error("apply_outline_anim_def(): wrong object")};
a.clear_outline_anim=function(a){a&&a.e&&a.e.Gb?l.clear_outline_anim(a):h.error("clear_outline_anim(): wrong object")};a.set_outline_color=l.set_outline_color;a.get_outline_color=function(a){var b=l.get_active();if(b=l.aa(b,"OUTLINE"))return a=a||new Float32Array(3),a.set(b.gf),a};a.set_glow_intensity=function(b,c){h.error("set_glow_intensity() deprecated, use set_outline_intensity() instead");a.set_outline_intensity(b,c)};a.get_glow_intensity=function(b){h.error("get_glow_intensity() deprecated, use get_outline_intensity() instead");
a.get_outline_intensity(b)};a.apply_glow_anim=function(b,c,d,e){h.error("apply_glow_anim() deprecated, use apply_outline_anim() instead");a.apply_outline_anim(b,c,d,e)};a.apply_glow_anim_def=function(b){h.error("apply_glow_anim_def() deprecated, use apply_outline_anim_def() instead");a.apply_outline_anim_def(b)};a.clear_glow_anim=function(b){h.error("clear_glow_anim() deprecated, use clear_outline_anim() instead");a.clear_outline_anim(b)};a.set_glow_color=function(b){h.error("set_glow_color() deprecated, use set_outline_color() instead");
a.set_outline_color(b)};a.get_glow_color=function(b){h.error("get_glow_color() deprecated, use get_outline_color() instead");a.get_outline_color(b)};a.get_shadow_params=function(){if(!l.ja())return h.error("No active scene"),!1;var a=l.get_active(),b=l.aa(a,"SHADOW_CAST");if(!b)return null;var c=a.e.xe,d=l.aa(a,"MAIN_OPAQUE"),e=l.aa(a,"DEPTH"),g={};g.csm_resolution=c.csm_resolution;g.self_shadow_polygon_offset=b.self_shadow_polygon_offset;e&&(g.self_shadow_normal_offset=e.self_shadow_normal_offset);
g.enable_csm=c.enable_csm;g.csm_num=c.csm_num;g.csm_first_cascade_border=c.csm_first_cascade_border;g.first_cascade_blur_radius=c.first_cascade_blur_radius;g.csm_last_cascade_border=c.csm_last_cascade_border;g.last_cascade_blur_radius=c.last_cascade_blur_radius;g.fade_last_cascade=c.fade_last_cascade;g.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(g.csm_borders=l.Dy(a,d.j),g.blur_radii=new Float32Array(c.csm_num),g.blur_radii.set(d.j.Pk.subarray(0,c.csm_num))):(g.csm_borders=null,
g.blur_radii=null);return g};a.set_shadow_params=function(a){if(!l.ja())return h.error("No active scene"),!1;var e=l.get_active();"number"==typeof a.self_shadow_polygon_offset&&b.S(e.e.jb,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var g=l.aa(e,"DEPTH");g&&("number"==typeof a.self_shadow_normal_offset&&(g.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(g.pcf_blur_radius=a.pcf_blur_radius));var n=l.aa(e,
"MAIN_BLEND");n&&("number"==typeof a.self_shadow_normal_offset&&(n.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(n.pcf_blur_radius=a.pcf_blur_radius),n.oa=!0);n=e.e.xe;"number"==typeof a.csm_first_cascade_border&&(n.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(n.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(n.csm_last_cascade_border=a.csm_last_cascade_border);
"number"==typeof a.last_cascade_blur_radius&&(n.last_cascade_blur_radius=a.last_cascade_blur_radius);if(g){for(var p=g.q,E=0;E<p.length;E++){var y=p[E];y.ed.jc&&(y=y.B,c.op(y,n),c.kb(y))}g.oa=!0}g=e.camera.e.I;for(E=0;E<g.length;E++)d.Eo(g[E],n);l.ao(e)};a.get_environment_colors=function(){if(!l.ja())return h.error("No active scene"),!1;var a=l.get_active();return l.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(!l.ja())return h.error("No active scene"),!1;var d=l.get_active();
l.set_environment_colors(d,parseFloat(a),b,c)};a.get_fog_color_density=function(a){if(!l.ja())return h.error("No active scene"),!1;var b=l.get_active();return l.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(!l.ja())return h.error("No active scene"),!1;var b=l.get_active();l.set_fog_color_density(b,a)};a.get_ssao_params=function(){if(!l.ja())return h.error("No active scene"),!1;var a=l.get_active();return l.get_ssao_params(a)};a.set_ssao_params=function(a){if(!l.ja())return h.error("No active scene"),
!1;var b=l.get_active();l.set_ssao_params(b,a)};a.get_color_correction_params=function(){if(!l.ja())return h.error("No active scene"),null;var a=l.get_active(),a=l.aa(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(!l.ja())return h.error("No active scene"),null;var b=l.get_active(),b=l.aa(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&
(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.oa=!0};a.get_sky_params=function(){if(!l.ja())return h.error("No active scene"),!1;var a=l.get_active();return l.get_sky_params(a)};a.set_sky_params=function(a){if(!l.ja())return h.error("No active scene"),!1;var b=l.get_active();l.set_sky_params(b,a)};a.get_dof_params=function(){if(!l.ja())return h.error("No active scene"),
!1;var a=l.get_active();return l.aa(a,"DOF")?l.get_dof_params(a):null};a.set_dof_params=function(a){if(!l.ja())return h.error("No active scene"),!1;var b=l.get_active();l.set_dof_params(b,a)};a.get_god_rays_params=function(){if(!l.ja())return h.error("No active scene"),!1;var a=l.get_active();return l.aa(a,"GOD_RAYS")?l.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!l.ja())return h.error("No active scene"),!1;var b=l.get_active();l.set_god_rays_params(b,a)};a.get_bloom_params=
function(){if(!l.ja())return h.error("No active scene"),!1;var a=l.get_active();return l.aa(a,"BLOOM")?l.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!l.ja())return h.error("No active scene"),!1;var b=l.get_active();l.set_bloom_params(b,a)};a.get_glow_material_params=function(){if(!l.ja())return h.error("No active scene"),!1;var a=l.get_active();return l.aa(a,"GLOW_COMBINE")?l.get_glow_material_params(a):null};a.set_glow_material_params=function(a){if(!l.ja())return h.error("No active scene"),
!1;var b=l.get_active();l.set_glow_material_params(b,a)};a.get_wind_params=function(){return l.get_wind_params()};a.set_wind_params=function(a){if(!l.ja())return h.error("No active scene"),!1;var b=l.get_active();l.set_wind_params(b,a)};a.get_water_surface_level=l.get_water_surface_level;a.set_water_params=function(a){if(!l.ja())return h.error("No active scene"),!1;var b=l.get_active();l.set_water_params(b,a)};a.get_water_mat_params=function(a){if(!l.ja())return h.error("No active scene"),!1;var b=
l.get_active();l.get_water_mat_params(b,a)};a.update_scene_materials_params=function(){if(!l.ja())return h.error("No active scene"),!1;var a=l.get_active();l.At(a)};a.hide_object=function(a){e.Ki(a)||n.tk(a)?l.hide_object(a):h.error("show/hide is only supported for dynamic meshes/empties")};a.show_object=function(a){e.Ki(a)||n.tk(a)?l.show_object(a):h.error("show/hide is only supported for dynamic meshes/empties")};a.is_hidden=function(a){if(e.Ki(a)||n.tk(a))return l.is_hidden(a);h.error("show/hide is only supported for dynamic meshes/empties");
return!1};a.is_visible=function(a){return a.e.is_visible};a.check_object=function(a){return l.ja()?l.check_object(a,l.get_active()):(h.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return l.zd(l.Ef,a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,c){return l.zd(l.tl,a,b,c|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return l.zd(l.ul,a,b|0)?!0:!1};a.get_all_objects=function(a,b){var c=l.get_active();a||(a="ALL");b||0===b||(b=l.DATA_ID_ALL);return l.Ka(c,a,b)};
a.get_object_name=function(a){return a?a.name:(h.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(h.error("Wrong object"),"UNDEFINED")};a.get_object_dg_parent=function(a){return a.Aa};a.get_object_children=function(a){return a.Nc.slice(0)};a.get_first_character=function(){for(var a=l.Ka(l.get_active(),"MESH",l.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(g.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return l.get_shore_dist(a,
b)};a.get_cam_water_depth=function(){return l.get_cam_water_depth()};a.get_type_mesh_object=function(a){return"MESH"==a.type?a.e.type:null};a.get_meta_tags=function(){if(!l.ja())return h.error("No active scene"),!1;var a=l.get_active();return l.get_meta_tags(a)};a.append_object=function(a){if(!a.e.jn)return h.error('object "'+a.name+'" has been created not by coping.'),!1;var b=a.name;if(l.zd(l.Ef,a.name,0))for(var c=1;;){b=a.name+(3>String(c).length?"."+("000"+String(c)).slice(-3):"."+String(c));
if(!l.zd(l.Ef,b,0)){a.name=b;h.error('object "'+a.name+'" already exists. Name was replaced by "'+b+'".');break}c++}l.append_object(l.get_active(),a,!0)};a.remove_object=function(a){l.remove_object(a)||h.error('object "'+a.name+'" was not copied.')};a.marker_frame=function(a){var b=l.get_active();if(b.timeline_markers&&a in b.timeline_markers)return l.marker_frame(b,a);h.error('"'+a+'" marker not found.');return 0};a.get_mb_params=function(){var a=l.get_active();return(a=l.aa(a,"MOTION_BLUR"))?{mb_factor:a.mb_factor,
mb_decay_threshold:a.mb_decay_threshold}:null};a.set_mb_params=function(a){var b=l.get_active();(b=l.aa(b,"MOTION_BLUR"))?("number"==typeof a.mb_decay_threshold&&(b.mb_decay_threshold=a.mb_decay_threshold),"number"==typeof a.mb_factor&&(b.mb_factor=a.mb_factor)):h.error("The motion blur subscene doesn't exist.")}};b4w.module.sfx=function(a,p){var c=p("__scenes"),d=p("__sfx"),b=p("__print");a.play=function(a,b,c){d.play(a,b,c)};a.play_def=function(a){d.play_def(a)};a.is_play=function(a){return d.is_play(a)};a.speaker_play=function(a,c,g,l){b.error("speaker_play() deprecated, use play() or play_def() instead");d.cyclic(a,c);l&&d.playrate(a,l);d.play(a,0,g)};a.speaker_stop=function(a){b.error("speaker_stop() deprecated, use stop() instead");d.stop(a)};a.stop=function(a){d.stop(a)};a.pause=function(a){d.xB(a)};
a.resume=function(a){d.zB(a)};a.speaker_playback_rate=function(a,c){b.error("speaker_playback_rate() deprecated, use playrate() instead");d.playrate(a,c)};a.playrate=function(a,b){d.playrate(a,b)};a.get_playrate=function(a){return d.get_playrate(a)};a.cyclic=function(a,b){d.cyclic(a,b)};a.is_cyclic=function(a){return d.is_cyclic(a)};a.listener_reset_speed=function(a,b){d.listener_reset_speed(a,b)};a.speaker_reset_speed=function(a,b,c){d.speaker_reset_speed(a,b,c)};a.get_volume=function(a){return a&&
"object"===typeof a?d.get_volume(a):d.Ly()};a.set_volume=function(a,b){a&&"object"===typeof a?d.set_volume(a,b):d.bB(b)};a.mute=function(a,b){a&&"object"===typeof a?d.mute(a,b):d.Tz(b)};a.is_muted=function(a){return a&&"object"===typeof a?d.is_muted(a):d.sz()};a.get_speaker_objects=function(){return d.get_speaker_objects().slice(0)};a.get_speakers=function(){b.error("get_speakers() deprecated, use get_speaker_objects() instead");return a.get_speaker_objects()};a.check_active_speakers=d.check_active_speakers;
a.set_compressor_params=function(a){d.set_compressor_params(c.get_active(),a)};a.get_compressor_params=function(){return d.get_compressor_params(c.get_active())};a.duck=function(a,b,c){a&&"object"===typeof a?d.duck(a,b,c):d.Hx(b,c)};a.unduck=function(a){a&&"object"===typeof a?d.unduck(a):d.dC()};a.apply_playlist=d.apply_playlist;a.clear_playlist=d.clear_playlist;a.detect_audio_container=d.detect_audio_container;a.detect_video_container=d.detect_video_container;a.set_positional_params=d.set_positional_params;
a.get_positional_params=d.get_positional_params;a.set_filter_params=d.set_filter_params;a.get_filter_params=d.get_filter_params;a.get_filter_freq_response=d.get_filter_freq_response;a.get_duration=function(a){if(a&&d.ne(a))return d.get_duration(a);b.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.textures=function(a,p){var c=p("__textures"),d=p("__print");a.get_canvas_texture_context=function(a,e){e||(e=0);var h=c.Ay(a,e);if(h)return h;d.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a,e){e||(e=0);c.nC(a,e)||d.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a,e){e||(e=0);c.play_video(a,e)||d.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a,e){e||(e=0);c.pause_video(a,e)||d.error('Texture with name "'+
a+'" not found!')};a.reset_video=function(a,e){e||(e=0);c.reset_video(a,e)||d.error('Texture with name "'+a+'" not found!')}};b4w.module.time=function(a,p){var c=p("__time");a.set_timeout=c.set_timeout;a.clear_timeout=c.clear_timeout;a.get_timeline=c.get_timeline;a.animate=c.animate;a.clear_animation=c.clear_animation};b4w.module.transform=function(a,p){var c=p("__print"),d=p("__physics"),b=p("__transform"),e=p("__util"),h=p("__objects"),g=new Float32Array(3),l=new Float32Array(4);a.SPACE_LOCAL=b.SPACE_LOCAL;a.SPACE_WORLD=b.SPACE_WORLD;a.set_translation=function(a,e,l,p){h.cc(a)?(g[0]=e,g[1]=l,g[2]=p,b.set_translation(a,g),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,e){h.cc(a)?(b.set_translation(a,e),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.set_translation_rel=function(a,f,l,p,z){h.cc(a)?(g[0]=f,g[1]=l,g[2]=p,e.transform_vec3(g,1,z.e.quat,z.e.h,g),b.set_translation(a,g),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,c){c||(c=new Float32Array(3));b.get_translation(a,c);return c};a.set_rotation=function(a,e,g,p,z){h.cc(a)?(l[0]=e,l[1]=g,l[2]=p,l[3]=z,b.set_rotation(a,l),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.set_rotation_quat=function(){c.error("set_rotation_quat() deprecated, use set_rotation() instead");return a.set_rotation};a.set_rotation_v=function(a,e){h.cc(a)?(b.set_rotation(a,e),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat_v=function(){c.error("set_rotation_quat_v() deprecated, use set_rotation_v() instead");return a.set_rotation_v};a.get_rotation=function(a,c){c||(c=new Float32Array(4));b.get_rotation(a,c);return c};a.get_rotation_quat=
function(){c.error("get_rotation_quat() deprecated, use get_rotation() instead");return a.get_rotation};a.set_rotation_euler=function(a,e,l,p){h.cc(a)?(g[0]=e,g[1]=l,g[2]=p,b.set_rotation_euler(a,g),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,e){h.cc(a)?(b.set_rotation_euler(a,e),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,d){h.cc(a)?(b.set_scale(a,d),b.v(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.get_scale=function(a){return b.get_scale(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return c.error("Wrong object: "+a.name),!1;for(var e=0;e<a.Nc.length;e++)if(!h.cc(a.Nc[e])){c.error('Wrong object: "'+a.Nc[e].name+'" is not dynamic.');return}b.set_translation(a,[0,0,0]);b.set_rotation(a,[0,0,0,1]);b.set_scale(a,1);b.v(a);d.sync_transform(a)};a.get_object_size=function(a){return e.is_mesh(a)?b.get_object_size(a):(c.error("Wrong object: "+a.name),0)};
a.get_object_center=function(a,d,g){return e.is_mesh(a)?b.get_object_center(a,d,g):(c.error("Wrong object: "+a.name),null)};a.move_local=function(a,e,g,l){h.cc(a)?(b.move_local(a,e,g,l),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return b.get_object_bounding_box(a)};a.get_tsr=function(a,d){d||(d=new Float32Array(8));if(h.cc(a))return b.get_tsr(a,d),d;c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr=function(a,
e){h.cc(a)?(b.set_tsr(a,e),b.v(a),d.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.distance=function(a,c){return b.distance(a,c)}};b4w.module.tsr=function(a,p){p("__print");var c=p("__tsr");a.create=c.create;a.from_values=c.from_values;a.copy=c.copy;a.identity=c.identity;a.create_sep=c.create_sep;a.set_sep=c.set_sep;a.set_trans=c.set_trans;a.set_scale=c.set_scale;a.set_transcale=c.set_transcale;a.set_quat=c.set_quat;a.get_trans_view=c.get_trans_view;a.get_scale=c.get_scale;a.get_quat_view=c.get_quat_view;a.invert=c.invert;a.to_mat4=function(a,b){b||(b=new Float32Array(16));c.to_mat4(a,b);return b};a.from_mat4=c.from_mat4;a.multiply=
c.multiply;a.transform_vec3=c.transform_vec3;a.transform_vec3_inv=c.transform_vec3_inv;a.transform_vectors=c.transform_vectors;a.transform_dir_vectors=c.transform_dir_vectors;a.transform_dir_vec3=c.transform_dir_vec3;a.transform_tangents=c.transform_tangents;a.translate=c.translate;a.interpolate=c.interpolate};b4w.module.util=function(a,p){var c=p("__print"),d=p("__util"),b=p("vec3");p("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.f32=function(a){return new Float32Array(a||0)};a.assert=d.assert;a.keyfind=d.keyfind;a.keysearch=d.keysearch;a.matrix_to_quat=function(a){return d.matrix_to_quat(a)};a.euler_to_quat=function(a,b){b||
(b=new Float32Array(4));return d.euler_to_quat(a,b)};a.quat_to_euler=function(a,b){b||(b=new Float32Array(3));return d.quat_to_euler(a,b)};a.sign=d.sign;a.clamp=d.clamp;a.quat_to_dir=d.quat_to_dir;a.ground_project_quat=function(a,b){return d.quat_project(a,d.AXIS_MY,d.AXIS_Y,d.AXIS_MZ,b)};a.cam_quat_to_mesh_quat=function(a,b){return d.cam_quat_to_mesh_quat(a,b)};a.quat_project=function(a,h,g,l,n){return 0!=b.dot(g,l)?(c.error("Wrong in-plane direction"),null):d.quat_project(a,h,g,l,n)};a.hash_code=
d.hash_code;a.smooth=d.smooth;a.smooth_v=d.smooth_v;a.is_vector=d.is_vector;a.correct_cam_quat_up=d.correct_cam_quat_up;a.quat_to_angle_axis=d.quat_to_angle_axis;a.random_from_array=d.random_from_array;a.xz_direction=d.xz_direction;a.line_plane_intersect=d.line_plane_intersect;a.is_mesh=d.is_mesh;a.is_armature=d.is_armature;a.angle_wrap_0_2pi=d.angle_wrap_0_2pi;a.angle_wrap_periodic=d.angle_wrap_periodic;a.smooth_step=d.smooth_step;a.lerp=d.lerp};"object"==typeof module&&module.Cm&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,p){var c=p("__version");a.version=c.version;a.version_str=c.version_str;a.type=c.type;a.date=c.date;a.date_str=c.date_str};"object"==typeof module&&module.Cm&&b4w.module.version(exports);b4w.module.objects=function(a,p){var c=p("__objects"),d=p("__print"),b=p("__util"),e=p("__scenes"),h=p("__geometry");a.get_meta_tags=function(a){if(a&&a.b4w_object_tags)return c.get_meta_tags(a)};a.copy=function(a,l,n){return b.is_mesh(a)?a.cp?(d.error('object "'+a.name+'" is meta-object.'),!1):c.cc(a)?h.Ii(a)||h.check_shape_keys(a)||!n?-1==e.Ka(e.get_active(),"MESH",e.DATA_ID_ALL).indexOf(a)?(d.error('object "'+a.name+'" does not belong to the active scene.'),!1):c.copy(a,l||"",n):(d.error('object "'+
a.name+'" has not dynamic geometry for deep copying.'),!1):(d.error('object "'+a.name+'" is not dynamic.'),!1):(d.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,e,h){if(!b.is_mesh(a))return d.error('The type of the object "'+a.name+'" is not "MESH".'),null;e=e.join("%join%");var f=c.Ty(a,e);null!=f?a.e.qe[f]=h:d.error('The Value node "'+e+'" was not found in the object "'+a.name+'".')};a.set_nodemat_rgb=function(a,e,h,f,m){if(!b.is_mesh(a))return d.error('The type of the object "'+
a.name+'" is not "MESH".'),null;e=e.join("%join%");var p=c.Oy(a,e);null!=p?(a.e.xc[3*p]=h,a.e.xc[3*p+1]=f,a.e.xc[3*p+2]=m):d.error('The RGB node "'+e+'" was not found in the object "'+a.name+'".')}};b4w.module.main=function(a,p){function c(){}function d(){}function b(){}function e(){window.performance||(H.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(H.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});Q.Ns(0)}function h(a,b){a.addEventListener("webglcontextlost",function(a){a.preventDefault();H.error("WebGL context lost");l()},!1);k.jd(b);var c=k.Uq();c&&H.log("%cRENDERER INFO:","color: #00a",
b.getParameter(c.UNMASKED_VENDOR_WEBGL)+", "+b.getParameter(c.UNMASKED_RENDERER_WEBGL));K.jd(b);q.jd(b);C.jd(b);I.jd(b);u.jd(b);t.kB(a);v.init(a);O.Ps(a.width,a.height,1);A.init();d=r();f()}function g(){c=function(){}}function l(){n()||(oa=performance.now()/1E3,A.pause(),L.pause(),C.pause(),z.pause())}function n(){return da<oa}function f(){F(f);var a=performance.now()/1E3;S||(S=a);var b=a-S;if(!(b<1/fa.dd)){for(var c=Q.get_timeline(),e=0;e<ga.length;e++)ga[e](c,b);n()||(da>S&&(b-=da-Math.max(oa,S)),
c+=b,Q.Ns(c),u.update(),D.update(),t.update(),m(c,b),d(b));S=a}}function m(a,b){t.is_primary_loaded()&&(J.reset(),M.update(b),G.update(a,b),A.update(a,b),b&&w.update(b),t.is_primary_loaded()&&(L.update(a,b),t.is_primary_loaded()&&(c(b,a),t.is_primary_loaded()&&(B.update(a,b),t.is_primary_loaded()&&(z.update(),O.update(a,b),z.AC(),aa&&(aa(W.toDataURL()),aa=null))))))}function r(){var a=60,c=0,d=fa.Dq,e=fa.Zx;return function(f){f<1/fa.dd||(a=V.smooth(1/f,a,f,d),f=L.Iy(),c=(c+1)%e,0==c&&b(Math.round(a),
f))}}var z=p("__anchors"),w=p("__animation"),E=p("__compat"),y=p("__config"),H=p("__print"),v=p("__container"),B=p("__controls"),t=p("__data"),u=p("__debug"),k=p("__extensions"),q=p("__geometry"),J=p("__hud"),G=p("__nla"),D=p("__assets"),L=p("__physics"),K=p("__renderer"),O=p("__scenes"),A=p("__sfx"),I=p("__shaders"),C=p("__textures"),Q=p("__time"),M=p("__transform"),V=p("__util"),R=p("__version"),Z=y.context,fa=y.p,W=null,ha=null,S=0,oa=0,da=0,ga=[],aa=null,ea=["webgl","experimental-webgl"],ba=null,
F=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/fa.dd)}}();a.init=function(a,b){y.cB();H.gB(fa.console_verbose);var c=R.version_str()+" "+R.type()+" ("+R.date_str()+")";H.log("%cINIT ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;e();W=a;E.Iv();for(var c=null,d=0;d<ea.length;d++){var f=ea[d];try{c=a.getContext(f,
Z)}catch(g){}if(c)break}c&&E.Dx(c);if(!c)return null;ba=c;h(W,c);y.Kv();E.XA(c);I.Dz();fa.en&&(a.style["touch-action"]="none");H.log("%cSET PRECISION:","color: #00a",fa.precision);b?(J.init(b),ha=b):(y.p.show_hud_debug_info=!1,y.kd.Bk=!1);return c};a.set_check_gl_errors=function(a){u.set_check_gl_errors(a)};a.resize=function(a,b,c){!1!==c&&(W.style.width=a+"px",W.style.height=b+"px",ha&&(ha.style.width=a+"px",ha.style.height=b+"px"));ha&&(ha.width=a,ha.height=b,J.Vh());if(navigator.userAgent.match(/iPhone/i)||
navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))fa.canvas_resolution_factor=1;c=Math.floor(a*fa.canvas_resolution_factor);b=Math.floor(b*fa.canvas_resolution_factor);fa.allow_hidpi&&1<window.devicePixelRatio&&(c*=window.devicePixelRatio,b*=window.devicePixelRatio);W.width=c;W.height=b;if(c>ba.drawingBufferWidth||b>ba.drawingBufferHeight){H.warn("Canvas size exceeds platform limits, downscaling");var d=Math.min(ba.drawingBufferWidth/c,ba.drawingBufferHeight/b);c*=d;b*=d;W.width=
c;W.height=b}O.Ps(c,b,c/a);O.ja()&&M.v(O.get_active().camera);m(Q.get_timeline(),0);t.rC(W.width,W.height)};a.set_fps_callback=function(a){b=a};a.clear_fps_callback=function(){b=function(){}};a.set_render_callback=function(a){c=a};a.clear_render_callback=function(){g()};a.global_timeline=function(){return Q.get_timeline()};a.redraw=function(){H.error("redraw() deprecated");m(Q.get_timeline(),0)};a.pause=l;a.resume=function(){n()&&(da=performance.now()/1E3,A.resume(),L.resume(),C.play(!0),z.resume())};
a.is_paused=n;a.reset=function(){t.unload(0);ha=W=null;da=oa=S=0;b=function(){};d=function(){};c=function(){};ga.length=0;ba=null;Q.reset()};a.canvas_data_url=function(a){aa=a};a.get_canvas_elem=function(){return W};a.detect_mobile=function(){return E.detect_mobile()};a.append_loop_cb=function(a){for(var b=0;b<ga.length;b++)if(ga[b]==a)return;ga.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<ga.length;b++)if(ga[b]==a){ga.splice(b,1);break}}};b4w.module.nla=function(a,p){var c=p("__nla"),d=p("__time"),b=p("__print"),e=p("__util");a.set_frame=function(a){a=e.clamp(a,c.get_frame_start(),c.get_frame_end());c.check_nla_scripts()?b.error("The active scene is using NLA script."):c.set_frame(a,d.get_timeline())};a.get_frame=function(){return c.get_frame(d.get_timeline())};a.stop=function(){c.check_nla_scripts()?b.error("The active scene is using NLA script."):c.JB()};a.play=function(a){c.check_nla_scripts()?b.error("The active scene is using NLA script."):
c.jA(a)};a.is_play=function(){return c.is_play()};a.get_frame_start=function(){return c.get_frame_start()};a.get_frame_end=function(){return c.get_frame_end()};a.check_nla=function(){return c.check_nla()};a.check_nla_scripts=function(){return c.check_nla_scripts()};a.set_range=function(a,d){c.check_nla_scripts()?b.error("The active scene is using NLA script."):(d=parseFloat(d)||c.get_frame_end(),a=parseFloat(a)||c.get_frame_end(),d=e.clamp(d,c.get_frame_start(),c.get_frame_end()),a=e.clamp(a,c.get_frame_start(),
d),c.set_range(a,d))};a.reset_range=function(){c.check_nla_scripts()?b.error("The active scene is using NLA script."):c.reset_range()};a.set_cyclic=function(a){c.check_nla_scripts()?b.error("The active scene is using NLA script."):c.set_cyclic(a)};a.clear_callback=function(){c.check_nla_scripts()?b.error("The active scene is using NLA script."):c.clear_callback()}};b4w.module.app=function(a,p){function c(){var a=G.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=G.is_paused(),G.pause()):a||G.resume()},!1)}function d(a,b,c,d){var e=document.createElement("canvas"),f=document.getElementById(a);e.style.position="absolute";e.style.left=0;e.style.top=0;e.style.width=f.offsetWidth+"px";e.style.height=f.offsetHeight+"px";e.width=f.offsetWidth*window.devicePixelRatio;e.height=f.offsetHeight*window.devicePixelRatio;b?(b=document.createElement("canvas"),
b.style.position="absolute",e.style.left=0,e.style.top=0,b.style.pointerEvents="none"):b=null;f||(L.error('Warning: canvas container "'+a+'" not found, appending to body'),f=document.body);f.appendChild(e);if(!G.init(e,b))return c&&y("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",d),!1;b&&u.insert_to_container(b,"LAST");return!0}function b(a,b){a?(b&&(document.getElementById(b).style.display="block"),Q=document.getElementById(a)):(Q=document.createElement("div"),
Q.innerHTML=0,Q.style.cssText="position:absolute;top: 23px;right: 20px;font-size: 45px;line-height: 50px;font-weight: bold;color: #000;",u.insert_to_container(Q,"JUST_AFTER_CANVAS"))}function e(a,b){var c=String(a);b&&(c+="/"+String(b));Q.innerHTML=c}function h(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function g(){var a=u.get_container();G.resize(a.clientWidth,a.clientHeight,!0)}function l(a,b,c){if(v.has_distance_limits(a))var d=O.get_translation(a,
W),e=v.get_hover_cam_pivot(a,ha),d=I.subtract(d,e,W),d=Math.max(I.len(d),1);else d=10;e=O.get_rotation(a,oa);b=A.quat_to_dir(e,b,W);b[1]=0;I.normalize(b,b);I.scale(b,d*c,b);d=O.get_translation(a,ha);I.add(d,b,d);v.hover_cam_set_translation(a,d)}function n(a,b){if(v.has_distance_limits(a)){var c=v.get_hover_angle_limits(a,Z);if(0>c[1]-c[0]){var d=v.get_camera_angles(a,fa)[1],c=(c[0]-d)/(c[0]-c[1]),d=v.get_cam_dist_limits(a),c=Math.max(c,2/d[0]);v.rotate_hover_camera(a,0,c*b)}}else c=O.get_translation(a,
W),d=I.scale(A.AXIS_Y,-b,ha),I.add(c,d,c),v.hover_cam_set_translation(a,c)}function f(a,b,c,d){O.move_local(a,5*b,5*c,5*d)}function m(a,b,c){var d=O.get_translation(a,W),e=v.get_pivot(a,ha),d=I.dist(d,e),e=Math.abs(b);c=Math.pow(e*c,1-Math.pow(e*c,.15));O.move_local(a,0,0>b?.001<d?-d*c:0:c/(1-c)*d,0)}function r(a,b,c,d){for(var e=c*b;0<a;--a)c+=e,d+=e,e=c*b;return d}function z(a,b,c,d,e){e?(e=v.get_pivot(a,W),a=v.get_eye(a),a=I.dist(e,a)+d,d=0<b?r(b,-c,a,d):r(-b,c/(1-c),a,d)):d-=2*b*c;return d}function w(a,
b){function c(a,b,d,e){if(1==d){var f=r?.003*u[0]:.003*u[1];d=k.get_sensor_value(a,b,0);k.get_sensor_payload(a,b,0)===k.PL_SINGLE_TOUCH_MOVE?(xa+="X"==e?-d*f:0,Eb+="Y"==e?-d*f:0):k.get_sensor_payload(a,b,0)===k.PL_MULTITOUCH_MOVE_PAN&&(a=r?.003*u[1]:7.5E-4*u[0],Fb+="X"==e?-d*a:0,Pa+="Y"==e?-d*a:0)}}function d(a,b,c,e){if(1==c){c=k.get_sensor_value(a,b,1);v.get_velocity_params(a,u);if(r)f=.003*u[0],g=7.5E-4*u[1];else var f=.003*u[1],g=7.5E-4*u[0];if(1===k.get_sensor_payload(a,b,0))fc+="X"==e?-c*f:
0,Ec+="Y"==e?-c*f:0;else if(2===k.get_sensor_payload(a,b,0)||3===k.get_sensor_payload(a,b,0))wc+="X"==e?-c*g:0,gc+="Y"==e?-c*g:0}}function e(a){return a[0]&&(a[1]||a[2])}function g(a,b,c){if(1==c)switch(c=k.get_sensor_value(a,b,0),v.get_velocity_params(a,u),b){case "FORWARD":q?B[0]=1:r?(b=v.get_camera_angles(a,fa)[1],b=Math.abs(b)>=Math.PI/4?A.AXIS_MZ:A.AXIS_MY,l(a,b,.5*u[0]*c)):p?m(a,-u[2],c):f(a,0,-u[0]*c,0);break;case "BACKWARD":q?B[0]=-1:r?(b=v.get_camera_angles(a,fa)[1],b=Math.abs(b)>=Math.PI/
4?A.AXIS_Z:A.AXIS_Y,l(a,b,.5*u[0]*c)):p?m(a,u[2],c):f(a,0,u[0]*c,0);break;case "UP":r?n(a,30*-u[2]*c):q||f(a,0,0,-u[0]*c);break;case "DOWN":r?n(a,30*u[2]*c):q||f(a,0,0,u[0]*c);break;case "LEFT":q?B[1]=1:r?l(a,A.AXIS_MX,.5*u[0]*c):f(a,-u[0]*c,0,0);break;case "RIGHT":q?B[1]=-1:r?l(a,A.AXIS_X,.5*u[0]*c):f(a,u[0]*c,0,0);break;case "ROT_LEFT":p?v.rotate_target_camera(a,2*-u[1]*c,0):v.rotate_eye_camera(a,2*u[1]*c,0);break;case "ROT_RIGHT":p?v.rotate_target_camera(a,2*u[1]*c,0):v.rotate_eye_camera(a,2*-u[1]*
c,0);break;case "ROT_UP":p?v.rotate_target_camera(a,0,2*-u[1]*c):v.rotate_eye_camera(a,0,2*u[1]*c);break;case "ROT_DOWN":p?v.rotate_target_camera(a,0,2*u[1]*c):v.rotate_eye_camera(a,0,2*-u[1]*c)}else switch(b){case "FORWARD":case "BACKWARD":q&&(B[0]=0);break;case "LEFT":case "RIGHT":q&&(B[1]=0)}q&&(D.set_character_move_dir(q,B[0],B[1]),a=v.get_camera_angles_char(a,Z),D.set_character_rotation(q,a[0],a[1]))}M=!0;V=a;R=b;var h=K.get_active_camera(),p=!1,q=null,r=!1;switch(v.get_move_style(h)){case v.MS_TARGET_CONTROLS:p=
!a;break;case v.MS_EYE_CONTROLS:q=K.get_first_character();break;case v.MS_STATIC:return;case v.MS_HOVER_CONTROLS:r=!0}var u=v.get_velocity_params(h,da),x=k.create_elapsed_sensor();if(D.has_simulated_physics(h)){var w=k.create_collision_sensor(h,null,!0);k.create_sensor_manifold(h,"CAMERA_COLLISION",k.CT_CONTINUOUS,[w],null,function(a,b,c){if(1==c&&(c=k.get_sensor_payload(a,b,0).coll_dist,0>c)){var d=k.get_sensor_payload(a,b,0).coll_norm;b=W;I.scale(d,-.25*c,b);c=O.get_translation(a,ha);I.add(c,b,
c);O.set_translation_v(a,c)}})}if(q){var w=O.get_translation(h),y=O.get_rotation(h),y=A.cam_quat_to_mesh_quat(y);w[1]-=.5;D.set_transform(q,w,y);t.append_stiff_trans(h,q,[0,.5,0]);var B=new Float32Array(2),L=!0;D.set_character_move_type(q,D.CM_FLY);k.create_kb_sensor_manifold(h,"TOGGLE_CHAR_MOVE_TYPE",k.CT_SHOT,k.KEY_C,function(){L=!L;D.set_character_move_type(q,L?D.CM_FLY:D.CM_WALK)})}if(b)w=y=E=G=H=Q=k.create_custom_sensor(0);else var w=k.create_keyboard_sensor(k.KEY_W),y=k.create_keyboard_sensor(k.KEY_S),
E=k.create_keyboard_sensor(k.KEY_A),G=k.create_keyboard_sensor(k.KEY_D),H=k.create_keyboard_sensor(k.KEY_R),Q=k.create_keyboard_sensor(k.KEY_F);var J=k.create_keyboard_sensor(k.KEY_UP),oa=k.create_keyboard_sensor(k.KEY_DOWN),ua=k.create_keyboard_sensor(k.KEY_LEFT),Za=k.create_keyboard_sensor(k.KEY_RIGHT);r||(k.create_sensor_manifold(h,"FORWARD",k.CT_CONTINUOUS,[x,w],null,g),k.create_sensor_manifold(h,"BACKWARD",k.CT_CONTINUOUS,[x,y],null,g));p?(k.create_sensor_manifold(h,"ROT_UP",k.CT_CONTINUOUS,
[x,J,H],e,g),k.create_sensor_manifold(h,"ROT_DOWN",k.CT_CONTINUOUS,[x,oa,Q],e,g),k.create_sensor_manifold(h,"ROT_LEFT",k.CT_CONTINUOUS,[x,ua,E],e,g),k.create_sensor_manifold(h,"ROT_RIGHT",k.CT_CONTINUOUS,[x,Za,G],e,g)):r?(k.create_sensor_manifold(h,"LEFT",k.CT_CONTINUOUS,[x,ua,E],e,g),k.create_sensor_manifold(h,"RIGHT",k.CT_CONTINUOUS,[x,Za,G],e,g),k.create_sensor_manifold(h,"FORWARD",k.CT_CONTINUOUS,[x,J,w],e,g),k.create_sensor_manifold(h,"BACKWARD",k.CT_CONTINUOUS,[x,oa,y],e,g),k.create_sensor_manifold(h,
"UP",k.CT_CONTINUOUS,[x,Q],e,g),k.create_sensor_manifold(h,"DOWN",k.CT_CONTINUOUS,[x,H],e,g)):(k.create_sensor_manifold(h,"UP",k.CT_CONTINUOUS,[x,H],e,g),k.create_sensor_manifold(h,"DOWN",k.CT_CONTINUOUS,[x,Q],e,g),k.create_sensor_manifold(h,"LEFT",k.CT_CONTINUOUS,[x,E],e,g),k.create_sensor_manifold(h,"RIGHT",k.CT_CONTINUOUS,[x,G],e,g),k.create_sensor_manifold(h,"ROT_UP",k.CT_CONTINUOUS,[x,J],e,g),k.create_sensor_manifold(h,"ROT_DOWN",k.CT_CONTINUOUS,[x,oa],e,g),k.create_sensor_manifold(h,"ROT_LEFT",
k.CT_CONTINUOUS,[x,ua],e,g),k.create_sensor_manifold(h,"ROT_RIGHT",k.CT_CONTINUOUS,[x,Za],e,g));var cb=0,w=k.create_mouse_wheel_sensor(),Fa=0,y=k.create_touch_zoom_sensor();k.create_sensor_manifold(h,"MOUSE_WHEEL",k.CT_LEVEL,[w],null,function(a,b,c){1==c&&(b=k.get_sensor_value(a,b,0),v.get_velocity_params(a,u),p||r?cb=z(a,b,u[2],cb,p):(u[0]*=1+b*u[2],v.set_velocity_params(a,u)))});k.create_sensor_manifold(h,"TOUCH_ZOOM",k.CT_LEVEL,[y],null,function(a,b,c){1==c&&(c=k.get_sensor_value(a,b,0),v.get_velocity_params(a,
u),k.get_sensor_payload(a,b,0)===k.PL_MULTITOUCH_MOVE_ZOOM&&(Fa=z(a,c,.03*u[2],Fa,p)))});k.create_sensor_manifold(h,"ZOOM_INTERPOL",k.CT_CONTINUOUS,[x],null,function(a,b,c){if(1==c&&(p||r))if(1E-5<Math.abs(cb)||1E-5<Math.abs(Fa)){b=k.get_sensor_value(a,b,0);c=A.smooth(cb,0,b,.1*C);cb-=c;var d=A.smooth(Fa,0,b,.15*C);Fa-=d;if(r)n(a,-(c+d));else{b=v.get_pivot(a,W);var e=v.get_eye(a,ha);.001<I.dist(b,e)+c+d?O.move_local(a,0,c+d,0):(c=I.subtract(e,b,ha),d=I.normalize(c,S),I.scale(d,.001,d),I.add(b,d,c),
O.set_translation_v(a,c),Fa=cb=0)}}else Fa=cb=0});var fc=0,Ec=0,wc=0,gc=0,w=k.create_mouse_move_sensor("X"),y=k.create_mouse_move_sensor("Y"),E=k.create_mouse_click_sensor();k.create_sensor_manifold(h,"MOUSE_X",k.CT_LEVEL,[E,w],null,d,"X");k.create_sensor_manifold(h,"MOUSE_Y",k.CT_LEVEL,[E,y],null,d,"Y");var xa=0,Eb=0,Fb=0,Pa=0,w=k.create_touch_move_sensor("X"),y=k.create_touch_move_sensor("Y");k.create_sensor_manifold(h,"TOUCH_X",k.CT_LEVEL,[w],null,c,"X");k.create_sensor_manifold(h,"TOUCH_Y",k.CT_LEVEL,
[y],null,c,"Y");k.create_sensor_manifold(h,"ROT_TRANS_INTERPOL",k.CT_CONTINUOUS,[x],null,function(a,b,c){if(1==c&&(1E-5<Math.abs(fc)||1E-5<Math.abs(Ec)||1E-5<Math.abs(xa)||1E-5<Math.abs(Eb)||1E-5<Math.abs(wc)||1E-5<Math.abs(gc)||1E-5<Math.abs(Fb)||1E-5<Math.abs(Pa))){var d=k.get_sensor_value(a,b,0),e=A.smooth(fc,0,d,.08*C);b=A.smooth(Ec,0,d,.08*C);fc-=e;Ec-=b;var f=A.smooth(xa,0,d,.12*C);c=A.smooth(Eb,0,d,.12*C);xa-=f;Eb-=c;var g=A.smooth(wc,0,d,.08*C),h=A.smooth(gc,0,d,.08*C);wc-=g;gc-=h;var m=A.smooth(Fb,
0,d,.12*C),d=A.smooth(Pa,0,d,.12*C);Fb-=m;Pa-=d;p?(v.rotate_target_camera(a,e+f,b+c),v.move_pivot(a,g+m,h+d)):r?(e+f&&l(a,A.AXIS_X,.2*(e+f)),b+c&&(e=v.get_camera_angles(a,fa)[1],l(a,Math.abs(e)>Math.PI/4?A.AXIS_Z:A.AXIS_Y,.2*(b+c))),v.rotate_hover_camera(a,g+m,0)):(v.rotate_eye_camera(a,.5*(e+f),.5*(b+c)),q&&(a=v.get_camera_angles_char(a,Z),D.set_character_rotation(q,a[0],a[1])))}});k.create_kb_sensor_manifold(h,"DEC_STEREO_DIST",k.CT_SHOT,k.KEY_LEFT_SQ_BRACKET,function(a){var b=v.get_stereo_distance(a);
v.set_stereo_distance(a,.9*b)});k.create_kb_sensor_manifold(h,"INC_STEREO_DIST",k.CT_SHOT,k.KEY_RIGHT_SQ_BRACKET,function(a){var b=v.get_stereo_distance(a);v.set_stereo_distance(a,1.1*b)})}function E(){var a=K.get_active_camera();M=!1;for(var b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL".split(" "),c=0;c<b.length;c++)k.remove_sensor_manifold(a,b[c]);v.get_move_style(a)==v.MS_EYE_CONTROLS&&
K.get_first_character()&&t.remove(a)}function y(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div");if(d)for(var h=0;h<d.length;h++){var k=document.getElementById(d[h]);k&&k.parentNode.removeChild(k)}e.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";f.style.cssText="color:#fff;font-size:24px;";g.style.cssText="color:#fff;font-size:20px;";f.innerHTML=a;g.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+
c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(f);e.appendChild(g);document.body.appendChild(e)}function H(a,b,c,d){function e(){var g=performance.now()-f;d(a+g*(b-a)/c);g>=c&&G.remove_loop_cb(e)}var f=performance.now();G.append_loop_cb(e)}p("animation");var v=p("camera"),B=p("config"),t=p("constraints"),u=p("container"),k=p("controls"),q=p("data"),J=p("debug"),G=p("main"),D=p("physics"),L=p("print"),K=p("scenes"),O=p("transform"),A=p("util"),I=p("vec3"),C=1,Q=null,M=!1,V=!1,R=!1,Z=new Float32Array(2),
fa=new Float32Array(2),W=new Float32Array(3),ha=new Float32Array(3),S=new Float32Array(3),oa=new Float32Array(4),da=new Float32Array(3);a.init=function(a){function f(){var a=d(n,E,z,p),h=u.get_canvas();if(a){var k=u.get_container();g();G.set_check_gl_errors(A);L&&(b(r,v),G.set_fps_callback(e));y&&c();t&&G.append_loop_cb(function(){k.style.height=k.clientWidth/t+"px"});m&&G.append_loop_cb(function(){var a=k.clientWidth,b=k.clientHeight;a==h.clientWidth&&b==h.clientHeight||G.resize(a,b,!0)});D&&G.append_loop_cb(function(){u.force_offsets_updating()});
l(h,!0)}else l(h,!1)}function h(a){a.keyCode==k.KEY_P&&(G.is_paused()?G.resume():G.pause())}function l(){}a=a||{};var m=!1,n=null,p=null,r=null,t=0,v=null,A=!1,w=!0,y=!0,z=!0,C=!1,L=!1,I=!1,D=!1,K;for(K in a)switch(K){case "canvas_container_id":n=a.canvas_container_id;break;case "callback":l=a.callback;break;case "autoresize":m=a.autoresize;break;case "do_not_use_onload":break;case "gl_debug":A=a.gl_debug;break;case "show_hud_debug_info":I=a.show_hud_debug_info;break;case "sfx_mix_mode":C=a.sfx_mix_mode;
break;case "show_fps":L=a.show_fps;break;case "track_container_position":D=a.track_container_position;break;case "fps_wrapper_id":v=a.fps_wrapper_id;break;case "fps_elem_id":r=a.fps_elem_id;break;case "error_purge_elements":p=a.error_purge_elements;break;case "report_init_failure":z=a.report_init_failure;break;case "pause_invisible":y=a.pause_invisible;break;case "key_pause_enabled":w=a.key_pause_enabled;break;case "force_container_ratio":t=a.force_container_ratio;break;default:B.set(K,a[K])}w&&document.addEventListener("keydown",
h,!1);B.set("show_hud_debug_info",I);B.set("sfx_mix_mode",C);var E=I||C||null;"complete"==document.readyState?window.setTimeout(f,0):window.addEventListener("load",f,!1);window.addEventListener("unload",function(){q.cleanup()},!1)};a.resize_to_container=g;a.set_onclick=function(a,b){var c=h(a);c.addEventListener("mouseup",function(){b(c.value)},!1)};a.set_onchange=function(a,b){var c=h(a);c.addEventListener("change",function(){var a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,
b){var c=h(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.enable_camera_controls=w;a.disable_camera_controls=E;a.set_camera_move_style=function(a){var b=M;b&&E();var c=K.get_active_camera();v.set_move_style(c,a);b&&w(V,R)};a.enable_object_controls=function(a){function b(a){return a[0]&&(a[1]||a[2])}function c(a,b,e){if(1==e)switch(e=k.get_sensor_value(a,b,0),b){case "FORWARD":d?D.vehicle_throttle(a,1):O.move_local(a,0,0,1*e);break;case "BACKWARD":d?D.vehicle_throttle(a,
-1):O.move_local(a,0,0,-1*e);break;case "LEFT":d?D.vehicle_steer(a,-1):O.move_local(a,1*e,0,0);break;case "RIGHT":d?D.vehicle_steer(a,1):O.move_local(a,-1*e,0,0)}else switch(b){case "FORWARD":case "BACKWARD":d&&D.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":d&&D.vehicle_steer(a,0)}}var d=D.is_vehicle_chassis(a)||D.is_vehicle_hull(a),e=k.create_elapsed_sensor(),f=k.create_keyboard_sensor(k.KEY_W),g=k.create_keyboard_sensor(k.KEY_S),h=k.create_keyboard_sensor(k.KEY_A),l=k.create_keyboard_sensor(k.KEY_D),
m=k.create_keyboard_sensor(k.KEY_UP),n=k.create_keyboard_sensor(k.KEY_DOWN),p=k.create_keyboard_sensor(k.KEY_LEFT),q=k.create_keyboard_sensor(k.KEY_RIGHT);k.create_sensor_manifold(a,"FORWARD",k.CT_CONTINUOUS,[e,f,m],b,c);k.create_sensor_manifold(a,"BACKWARD",k.CT_CONTINUOUS,[e,g,n],b,c);k.create_sensor_manifold(a,"LEFT",k.CT_CONTINUOUS,[e,h,p],b,c);k.create_sensor_manifold(a,"RIGHT",k.CT_CONTINUOUS,[e,l,q],b,c)};a.disable_object_controls=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],
c=0;c<b.length;c++)k.remove_sensor_manifold(a,b[c])};a.enable_controls=function(a){var b=u.get_container();a=a||!1;k.register_keyboard_events(document,!1);k.register_mouse_events(b,!0,a);k.register_wheel_events(b,!0);k.register_touch_events(b,!0);k.register_device_orientation()};a.disable_controls=function(){var a=u.get_container();k.unregister_keyboard_events(document);k.unregister_mouse_events(a);k.unregister_wheel_events(a);k.unregister_touch_events(a);k.unregister_device_orientation()};a.enable_debug_controls=
function(){k.create_kb_sensor_manifold(null,"CAMERA_SHOT",k.CT_SHOT,k.KEY_K,function(){J.make_camera_frustum_shot()});k.create_kb_sensor_manifold(null,"LIGHT_SHOT",k.CT_SHOT,k.KEY_L,function(){J.make_light_frustum_shot()});k.create_kb_sensor_manifold(null,"TELEMETRY",k.CT_SHOT,k.KEY_T,function(){J.plot_telemetry()})};a.request_fullscreen=function(a,b,c){function d(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||
document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",
d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.requestFullScreen==a.webkitRequestFullScreen?a.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen()};a.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.check_fullscreen=
function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?!0:!1};a.report_app_error=y;a.get_url_params=function(a){a=!!a;var b=location.href.toString();if(-1==b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("="),f=e[0];1<e.length?(e=e[1],a?f in c?c[f].push(e):c[f]=[e]:c[f]=e):a?f in c||(c[f]=[]):c[f]=""}return c};a.css_animate=function(a,
b,c,d,e,f,g,h){function k(a){l[b]=f+a+g;if(c>d&&a<=d||c<d&&a>=d)l[b]=f+d+g,h()}if(a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)){f=f||"";g=g||"";h=h||function(){};var l=a.style;a=b.charAt(0).toUpperCase()+b.slice(1);if(void 0==l[b])if(void 0!=l["webkit"+a])b="webkit"+a;else if(void 0!=l["ms"+a])b="ms"+a;else if(void 0!=l["moz"+a])b="moz"+a;else return;H(c,d,e,k)}};a.attr_animate=function(a,b,c,d,e,f){function g(e){0<=e&&a.setAttribute(b,e);if(c>d&&e<=d||c<d&&e>=d)a.setAttribute(b,d),f()}a&&b&&isFinite(c)&&
isFinite(d)&&isFinite(e)&&(f=f||function(){},H(c,d,e,g))};a.set_camera_smooth_factor=function(a){C=a};a.get_camera_smooth_factor=function(){return C}};b4w.module.camera_anim=function(a,p){function c(a,b,c,d){b=f.angle_wrap_0_2pi(a-b);a=f.angle_wrap_0_2pi(c-a);if(1E-6>Math.abs(b)||1E-6>2*Math.PI-Math.abs(b))b=0;if(1E-6>Math.abs(a)||1E-6>2*Math.PI-Math.abs(a))a=0;d[0]=b;d[1]=a;return d}var d=p("camera"),b=p("controls"),e=p("print"),h=p("scenes"),g=p("time"),l=p("transform"),n=p("tsr"),f=p("util"),m=p("vec3"),r=p("quat"),z=new Float32Array(2),w=new Float32Array(2),E=new Float32Array(3),y=new Float32Array(3),H=new Float32Array(3),v=new Float32Array(4),
B=new Float32Array(2),t=new Float32Array(2),u=new Float32Array(8),k=new Float32Array(8),q=new Float32Array(8),J=!1,G=!1;a.track_to_target=function(a,c,g,h,k,n,p,q){if(!d.is_eye_camera(a))e.error("track_to_target(): wrong object");else if(a&&c){if(f.is_vector(c))var t=c;else t=H,l.get_object_center(c,!1,t);c=g||1;g=h||2;var u=k||1;k=n||1;y[0]=0;y[1]=-1;y[2]=0;var w=l.get_rotation(a);n=f.quat_to_dir(w,y);h=d.get_camera_angles(a,z);var B=l.get_translation(a);m.subtract(t,B,E);m.normalize(E,E);var G=
r.rotationTo(n,E,r.create());r.multiply(G,w,v);f.correct_cam_quat_up(v,!1);m.subtract(t,B,y);var J=m.length(y)*(1-1/g),t=Math.asin(E[1]);g=Math.acos(-E[2]/Math.abs(Math.cos(t)));0<E[0]&&(g=2*Math.PI-g);var ha=g-h[0],S=t-h[1];H[0]=0;H[1]=0;H[2]=-1;g=l.get_rotation(a);0>f.quat_to_dir(g,H)[1]?(S=0<n[1]?t-Math.PI+h[1]:t+Math.PI+h[1],ha=0<ha?-Math.PI+ha:Math.PI+ha):Math.abs(ha)>Math.PI&&(ha=0<ha?ha-2*Math.PI:ha+2*Math.PI);var oa=0,t=b.create_elapsed_sensor();n=Math.abs(ha/c);c=Math.abs(S/c);var da=n>c?
n:c,ga=da+u,aa=ga+k,ea=aa+u,ba=ha,F=S,U=J,Y=function(){b.remove_sensor_manifold(a,"TRACK_TO_TARGET");p&&p()};b.create_sensor_manifold(a,"TRACK_TO_TARGET",b.CT_CONTINUOUS,[t],null,function(a,c,e){if(e)if(d.is_eye_camera(a))if(e=b.get_sensor_value(a,c,0),oa+=e,oa<da){var f=ha/da*e;e*=S/da;c=oa/da;c=6*c*(1-c);f*=c;e*=c;ba-=f;F-=e;d.rotate_eye_camera(a,f,e)}else oa<ga?(ba&&(d.rotate_eye_camera(a,ba,F),ba=0,q&&q()),c=(oa-da)/u,e=-J*e/u,U-=f,l.move_local(a,0,6*e*c*(1-c),0)):oa<aa?U&&(l.move_local(a,0,U,
0),U=0):oa<ea?(c=(oa-aa)/u,e=J*e/u,e=6*e*c*(1-c),l.move_local(a,0,e,0)):(l.set_translation_v(a,B),Y());else Y()})}};a.auto_rotate=function(a,g){function k(e,g,h){if(1==h)if(h=d.get_move_style(e),h==d.MS_STATIC)l();else if(h!=d.MS_HOVER_CONTROLS&&d.has_horizontal_limits(e)){h=d.get_horizontal_limits(e,t);if(null===n||h[0]!=n[0]||h[1]!=n[1]){n=n||B;n.set(h);p=Math.min(.2,f.angle_wrap_0_2pi(n[1]-n[0])/2);h=n;var r=d.get_camera_angles(m,z)[0];h=c(r,h[0],h[1],w);q=a*Math.min(1,h[0]/.2,h[1]/.2)}g=b.get_sensor_value(e,
g,0);h=d.get_camera_angles(e,z)[0];h=c(h,n[0],n[1],w);h[1]>p&&h[0]>p?q=f.sign(q)*a:h[1]<p?q-=Math.pow(a,2)/.4*g:h[0]<p&&(q+=Math.pow(a,2)/.4*g);d.rotate_camera(e,g*q,0)}else n=null,g=b.get_sensor_value(e,g,0),d.rotate_camera(e,g*a,0)}function l(){b.remove_sensor_manifold(m,"AUTO_ROTATE");b.remove_sensor_manifold(m,"DISABLE_AUTO_ROTATE");g()}g=g||function(){};var m=h.get_active_camera();if(d.get_move_style(m)==d.MS_STATIC)e.error("auto_rotate(): wrong camera type");else{var n=null,p=0,q=0;if(b.check_sensor_manifold(m,
"AUTO_ROTATE"))l();else{var r=b.create_mouse_move_sensor("X"),u=b.create_mouse_move_sensor("Y"),v=b.create_mouse_click_sensor(),y=b.create_touch_move_sensor(),E=b.create_touch_zoom_sensor(),G=b.create_elapsed_sensor();b.create_sensor_manifold(m,"DISABLE_AUTO_ROTATE",b.CT_LEVEL,[r,u,v,y,E],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]},l);b.create_sensor_manifold(m,"AUTO_ROTATE",b.CT_CONTINUOUS,[G],function(a){return a[0]},k)}}};a.is_auto_rotate=function(){var a=h.get_active_camera();return b.check_sensor_manifold(a,
"AUTO_ROTATE")};a.check_auto_rotate=function(){var a=h.get_active_camera();return d.get_move_style(a)==d.MS_STATIC?!1:!0};a.move_camera_to_point=function(a,b,c,h,p){if(d.get_move_style(a)!=d.MS_STATIC)e.error("move_camera_to_point(): wrong camera type");else if(!J)if(a)if(b){c=c||1;h=h||.01;var r=l.get_tsr(a,u),t=l.get_tsr(b,k);b=m.distance(n.get_trans_view(r),n.get_trans_view(t))/c;c=f.quat_to_dir(n.get_quat_view(r),f.AXIS_MY,E);var v=f.quat_to_dir(n.get_quat_view(t),f.AXIS_MY,y);c=Math.min(Math.abs(m.dot(c,
v)),1);h=1E3*Math.max(b,Math.acos(c)/h);J=!0;g.animate(0,1,h,function(b){var c=n.interpolate(r,t,f.smooth_step(b),q);l.set_tsr(a,c);1==b&&(J=!1,p&&p())})}else e.error("move_camera_to_point(): you mast specify point object");else e.error("move_camera_to_point(): you mast specify camera object")};a.rotate_camera=function(a,b,c,f,h){if(!G)if(a)if(b||c){G=!0;var k=0,l=0,m=0!=b?b:c;g.animate(0,m,f||1E3,function(e){k-=e;l-=e;c&&b?d.rotate_camera(a,k,l):c?d.rotate_camera(a,0,l):b&&d.rotate_camera(a,k,0);
l=k=e;e==m&&(G=!1,h&&h())})}else e.error("rotate_camera(): you mast specify rotation angle");else e.error("rotate_camera(): you mast specify camera object")};a.is_moving=function(){return J};a.is_rotating=function(){return G}};b4w.module.gyroscope=function(a,p){function c(a){var b=d.create_gyro_angles_sensor(),c=!0;d.create_sensor_manifold(a,"CAMERA_ROTATE_GYRO",d.CT_CONTINUOUS,[b],null,function(a,b,p){if(0<p){g=d.get_sensor_payload(a,b,0);c&&(h[0]=g[0],h[1]=g[1],h[2]=g[2],c=!1);p=b=0;0==window.orientation&&(b=g[1]-h[1],p=g[0]-h[0],g[1]>n&&g[1]<l&&(p=0));if(180==window.orientation){b=g[1]-h[1];0>g[1]&&(b=-b);p=h[0]-g[0];if(b>Math.PI/2||b<-Math.PI/2)b=0;g[1]>-l&&g[1]<-n&&(p=0)}if(-90==window.orientation){b=g[0]-h[0];if(b>
Math.PI/2||b<-Math.PI/2)b=0;p=h[1]-g[1];if(g[0]>f||g[0]<m)p=0}if(90==window.orientation){b=h[0]-g[0];if(b>Math.PI/2||b<-Math.PI/2)b=0;p=g[1]-h[1];if(g[0]>f||g[0]<m)p=0}e.rotate_camera(a,p,b);h[0]=g[0];h[1]=g[1];h[2]=g[2]}})}var d=p("controls"),b=p("scenes"),e=p("camera"),h=new Float32Array(3),g=new Float32Array(3),l=110*Math.PI/180,n=70*Math.PI/180,f=70*Math.PI/180,m=70*-Math.PI/180;a.enable_camera_rotation=function(){var a=b.get_active_camera();c(a)}};b4w.module.mixer=function(a,p){function c(){H=y.length=0;v=d();B=new Float32Array(v.length);t=new Float32Array(v.length);var a=w.get_speaker_objects();if(a.length){y.push(b());for(var c=0;c<a.length;c++)y.push(h(a[c]));y.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function d(){for(var a=new Float32Array(100),b=0,c=0;100>c;c++)a[c]=20*Math.pow(1E3,b),b+=1/
99;return a}function b(){var a=e("MASTER");a.N.push(["VOLUME",w.get_volume(null),0,1,50,!1]);var b=w.get_compressor_params();b&&(a.N.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.N.push(["KNEE",b.knee,0,40,40,!1]),a.N.push(["RATIO",b.ratio,1,20,20,!1]),a.N.push(["ATTACK",b.attack,0,1,1E3,!1]),a.N.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=w.is_muted(null)?1:0;a.Xc=-1;return a}function e(a){return{id:a,N:[],Gf:0,mute:-1,Xc:-1,za:null}}function h(a){var b=e(z.get_object_name(a));b.mute=w.is_muted(a)?
1:0;b.Xc=0;b.za=a;return b}function g(a){if(a.za){a.N.length=0;a.N.push(["VOLUME",w.get_volume(a.za),0,1,50,!1]);var b=w.get_positional_params(a.za);b&&(a.N.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.N.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.N.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=w.get_filter_params(a.za))a.N.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.N.push(["EQ_Q",b.Q,0,10,100,!1]),a.N.push(["EQ_GAIN",b.gain,-70,30,100,!1]);E.clamp(a.Gf,0,a.N.length-1)}}function l(a){for(var b=
0;b<y.length;b++){var c=y[b];if(c!=a&&1==c.Xc)return!0}return!1}function n(a){for(var b=0;b<y.length;b++){var c=y[b];c!=a&&0==c.mute&&0==c.Xc&&w.mute(c.za,!1)}}function f(){if(0==y.length)return[0,-1];var a=8*Math.floor(H/8),b=a+7,a=E.clamp(a,0,y.length-1),b=E.clamp(b,0,y.length-1);return[a,b]}var m=p("controls");p("debug");var r=p("hud"),z=p("scenes"),w=p("sfx"),E=p("util"),y=[],H=0,v=null,B=null,t=null;a.enable_mixer_controls=function(){function a(b,c,d){if(1==d){var e=Boolean(m.get_sensor_value(b,
c,2))?-1:1,f=y[H];if(f)switch(d=f.N[f.Gf],d[1]=d[5]?d[1]*Math.pow(d[3]/d[2],e/d[4]):d[1]+(d[3]-d[2])/d[4]*e,d[1]=E.clamp(d[1],d[2],d[3]),d[0]){case "VOLUME":"MASTER"!=f.id?w.set_volume(f.za,d[1]):w.set_volume(null,d[1]);break;case "DIST_REF":e=w.get_positional_params(f.za);e.dist_ref=d[1];w.set_positional_params(f.za,e);break;case "ATTENUATION":e=w.get_positional_params(f.za);e.attenuation=d[1];w.set_positional_params(f.za,e);break;case "DIST_MAX":e=w.get_positional_params(f.za);e.dist_max=d[1];w.set_positional_params(f.za,
e);break;case "EQ_FREQ":e=w.get_filter_params(f.za);e.freq=d[1];w.set_filter_params(f.za,e);break;case "EQ_Q":e=w.get_filter_params(f.za);e.Q=d[1];w.set_filter_params(f.za,e);break;case "EQ_GAIN":e=w.get_filter_params(f.za);e.gain=d[1];w.set_filter_params(f.za,e);break;case "THRESHOLD":f=w.get_compressor_params();f.threshold=d[1];w.set_compressor_params(f);break;case "KNEE":f=w.get_compressor_params();f.knee=d[1];w.set_compressor_params(f);break;case "RATIO":f=w.get_compressor_params();f.ratio=d[1];
w.set_compressor_params(f);break;case "ATTACK":f=w.get_compressor_params();f.attack=d[1];w.set_compressor_params(f);break;case "RELEASE":f=w.get_compressor_params();f.release=d[1];w.set_compressor_params(f);break;default:throw"Unknown strip param";}"INC_DEC"==c?m.reset_timer_sensor(b,c,6,.35):m.reset_timer_sensor(b,c,6,.05)}else m.reset_timer_sensor(b,c,6,10)}function b(a,c,d){if(1==d){d=Boolean(m.get_sensor_value(a,c,0))?-1:1;if(y.length){1==d&&H<y.length-1?H++:-1==d&&0<H&&H--;d=f();for(var e=d[0];e<=
d[1];e++)g(y[e])}"SWITCH_STRIP"==c?m.reset_timer_sensor(a,c,5,.15+.3):m.reset_timer_sensor(a,c,5,.15)}else m.reset_timer_sensor(a,c,5,10)}c();var d=m.create_keyboard_sensor(m.KEY_LEFT_SQ_BRACKET),e=m.create_keyboard_sensor(m.KEY_RIGHT_SQ_BRACKET),h=m.create_keyboard_sensor(m.KEY_SEMI_COLON),p=m.create_keyboard_sensor(m.KEY_SINGLE_QUOTE),z=m.create_keyboard_sensor(m.KEY_SHIFT),K=m.create_timer_sensor(.15,!0),O=m.create_timer_sensor(.05,!0),d=[d,e,h,p,z,K,O];m.create_sensor_manifold(null,"SWITCH_STRIP",
m.CT_TRIGGER,d,function(a){return(a[0]||a[1])&&!a[4]},b);m.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",m.CT_SHOT,d,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},b);m.create_sensor_manifold(null,"SWITCH_PARAM",m.CT_SHOT,d,function(a){return(a[0]||a[1])&&a[4]},function(a,b){var c=Boolean(m.get_sensor_value(a,b,0))?-1:1,d=y[H];d&&(1==c&&d.Gf<d.N.length-1?d.Gf++:-1==c&&0<d.Gf&&d.Gf--)});m.create_sensor_manifold(null,"INC_DEC",m.CT_TRIGGER,d,function(a){return(a[2]||a[3])&&!a[4]},a);m.create_sensor_manifold(null,
"INC_DEC_HOLD",m.CT_SHOT,d,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},a);m.create_sensor_manifold(null,"MUTE_SOLO",m.CT_SHOT,d,function(a){return(a[2]||a[3])&&a[4]},function(a,b){if(Boolean(m.get_sensor_value(a,b,2))){var c=y[H];c&&0<=c.mute&&("MASTER"!=c.id?0==c.mute?(c.mute=1,w.mute(c.za,!0),1==c.Xc&&(c.Xc=0,l(c)||n(c))):(c.mute=0,l(c)||w.mute(c.za,!1)):0==c.mute?(c.mute=1,w.mute(null,!0)):(c.mute=0,w.mute(null,!1)))}else if((c=y[H])&&0<=c.Xc)if(0==c.Xc){c.Xc=1;w.mute(c.za,!1);1==c.mute&&(c.mute=
0);for(var d=0;d<y.length;d++){var e=y[d];e!=c&&0==e.mute&&0==e.Xc&&w.mute(e.za,!0)}}else c.Xc=0,l(c)?w.mute(c.za,!0):n(c)});d=m.create_elapsed_sensor();m.create_sensor_manifold(null,"MIXER_DRAW",m.CT_CONTINUOUS,[d],null,function(){if(y[H])for(var a=f(),b=a[0];b<=a[1];b++){var c=y[b];r.draw_mixer_strip(c.id,b==H,b%8,c.N,c.Gf,c.mute,c.Xc);if(c.za&&w.get_filter_params(c.za)){w.get_filter_freq_response(c.za,v,B,t);for(c=0;c<B.length;c++)B[c]=20*Math.log(B[c])/Math.LN10;r.plot_array("EQ",b%8,B,20,2E4,
-10,10)}}});d=m.create_timer_sensor(1,!0);m.create_sensor_manifold(null,"MIXER_UPDATE",m.CT_TRIGGER,[d],null,function(){for(var a=f(),b=a[0];b<=a[1];b++)g(y[b])})}};b4w.module.npc_ai=function(a,p){function c(a,b){var c=b.destination,d=H;E.get_translation(b.empty,d);var e=v;E.get_translation(b.collider,e);var h=0;b.bi?h=b.bi:b.Ge&&(h=b.Ge,b.type==J&&(h*=.5),b.type==D&&(h*=a));switch(b.type){case J:if(b.random&&b.kf){c[0]=(12*Math.random()-6)*b.speed+d[0];c[2]=(12*Math.random()-6)*b.speed+d[2];var m=k,d=B,p=b.speed,w=b.rot_speed;E.get_rotation(b.collider,m);l.transformQuat(r.AXIS_Z,m,d);d[1]=0;l.normalize(d,d);m=.5*p/Math.sin(w/2);p=l.dist(c,e);p<2*m&&l.scaleAndAdd(c,
d,2*m-p,c);b.kf=!1}c[1]=e[1];h&&(c[1]+=h);break;case G:case D:b.random&&b.kf&&(b.type==D?(b.speed=Math.random()+.1,m=b.Lz-b.Rz):m=b.max_height-b.min_height,c[0]=10*Math.random()-5+d[0],c[1]=e[1]+(Math.random()*m-.5*m),c[2]=10*Math.random()-5+d[2],b.kf=!1),h&&(c[1]=e[1]+h)}var c=H,d=v,p=B,e=q,z=b.rig,m=b.collider,h=b.destination,y=b.speed,fa=b.actions,W=f.get_current_anim_name(z);if(!f.is_play(z)||!fa.Ji||-1==fa.Ji.indexOf(W)){E.get_translation(m,c);var w=h[0]-c[0],ha=h[2]-c[2],w=Math.sqrt(w*w+ha*
ha);if(w>2*y*a)b.state=20,r.xz_direction(h,c,p),fa=b.rig,f.is_animated(fa)&&(z=b.speed,y=f.get_frame(fa),fa=f.get_anim_length(fa),z*=fa/24*(1-y/fa),.9>w/z&&l.scaleAndAdd(h,p,z-w,h)),w=k,z=t,E.get_rotation(b.collider,w),l.transformQuat(r.AXIS_Z,w,d),z[0]=d[0],z[1]=0,z[2]=d[2],l.normalize(z,z),y=l.dot(z,p),fa=a/(Math.abs(Math.acos(y))/Math.PI)*b.rot_speed*b.$n,n.rotationTo(z,p,e),n.rotationTo(r.AXIS_Z,z,w),1<=Math.abs(y)?n.copy(w,e):(n.multiply(e,w,e),n.slerp(w,e,Math.min(fa,1),e)),p=a,b.type!=G&&(p=
Math.max(p,1/60),w=u,z=k,n.setAxisAngle(r.AXIS_X,-Math.asin(d[1]),z),n.setAxisAngle(r.AXIS_X,-Math.atan(b.Ge/(b.speed*p)),w),n.slerp(z,w,p,w),n.multiply(e,w,e)),E.set_rotation_v(m,e),d=B,m=t,r.quat_to_dir(e,r.AXIS_Z,d),l.scale(d,b.speed*a,m),l.add(m,c,m),m[1]=b.type!=J?(h[1]-c[1])*a*.1+c[1]:h[1],E.set_translation_v(b.collider,m);else if(b.type==J)fa.move?W&&-1!=fa.move.indexOf(W)&&f.is_play(z)?b.state=20:(b.state=10,b.kf=!0):(b.state=10,b.kf=!0);else if(b.type==D||b.type==G)b.kf=!0;if(g(b)&&(c=b.rig,
!f.is_play(c))){e=null;switch(b.state){case 10:e=b.actions;e=e.Ji?r.random_from_array(e.Ji):null;break;case 20:e=f.get_current_anim_name(b.rig),d=h=b.actions,d.se&&-1==d.se.indexOf(e)&&d.move&&-1!=d.move.indexOf(e)&&.33<Math.random()?(h=b.actions,e=h.se[h.move.indexOf(e)]):(d=b.actions,d.move&&(-1!=d.move.indexOf(e)||!d.se&&!d.df||!d.df&&!e||d.se&&-1!=d.se.indexOf(e)||d.df&&-1!=d.df.indexOf(e))?(h=b.actions,h.se?(d=h.se.indexOf(e),-1!=d?(e=d+1,e=e<h.move.length?e:0,e=h.move[e]):e=-1!=h.move.indexOf(e)?
e:r.random_from_array(h.move)):e=r.random_from_array(h.move)):(d=b.actions,e=d.df&&-1==d.df.indexOf(e)&&d.move&&-1==d.move.indexOf(e)?r.random_from_array(h.df):null))}e&&(f.apply(c,e),f.set_behavior(c,f.AB_FINISH_RESET),f.set_frame(c,0),f.play(c))}}}function d(a,b,c,d){if(d)if(1==c)switch(d.type){case G:a:{for(c=0;3>c;c++){var e=m.get_sensor_payload(a,b,c).hit_fract;if(e){b=e;break a}}b=void 0}a=100*b;d.Ge=a<d.min_height?10:a>d.max_height?-10:0;break;case J:a=m.get_sensor_payload(a,b,0).hit_fract;
d.Ge=d.rs==a?0:1-100*a;d.rs=a;break;case D:a=m.get_sensor_payload(a,b,0).hit_fract,"CLOSE_GROUND"==b?(d.Ge=100*a-1,d.Ge=.1>d.Ge?.05:0):"CLOSE_WATER"==b&&(d.bi=100*a,d.bi=d.bi<d.Rz?-.02:d.bi>d.Lz?.02:0)}else d.Ge=0}function b(){for(var a=0;a<y.length;a++){var b=y[a];e(b);h(b);b.rig&&f.get_current_anim_name(b.rig)&&f.play(b.rig)}}function e(a){var b=l.create(),c=a.collider;switch(a.type){case G:var e=m.create_ray_sensor(c,b,[0,-100,0],"TERRAIN",!0),f=m.create_ray_sensor(c,b,[0,-100,0],"STONE",!0),b=
m.create_ray_sensor(c,b,[0,-100,0],"WATER",!0),e=[e,f,b];m.create_sensor_manifold(c,"CLOSE_GROUND",m.CT_CONTINUOUS,e,function(a){return a[0]||a[1]||a[2]},d,a);break;case J:e=m.create_ray_sensor(c,[0,1,0],[0,-99,0],"TERRAIN",!0);e=[e];m.create_sensor_manifold(c,"CLOSE_GROUND",m.CT_CONTINUOUS,e,null,d,a);break;case D:e=m.create_ray_sensor(c,[0,1,0],[0,-99,0],"TERRAIN",!0),b=m.create_ray_sensor(c,b,[0,100,0],"WATER",!0),e=[e],m.create_sensor_manifold(c,"CLOSE_WATER",m.CT_CONTINUOUS,[b],null,d,a),m.create_sensor_manifold(c,
"CLOSE_GROUND",m.CT_CONTINUOUS,e,null,d,a)}}function h(a){function b(c,d,e){1==e?(E.get_translation(a.empty,a.destination),a.$n=4):a.$n=1}var c=a.collider;if(a.type==J){var d=m.create_collision_sensor(c,"CONSTRUCTION",!1);m.create_sensor_manifold(c,"CONSTRUCTION_COLL",m.CT_CONTINUOUS,[d],null,b)}}function g(a){var b=a.rig;if(!f.is_play(b))return!0;b=f.get_current_anim_name(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.Ji)return!1;if(-1==c.Ji.indexOf(b))break;break;case 20:if(!c.move||
-1!=c.move.indexOf(b)||c.df&&-1!=c.df.indexOf(b)||c.se&&-1!=c.se.indexOf(b))return!1;break;default:return!1}return!0}var l=p("vec3"),n=p("quat"),f=p("animation"),m=p("controls"),r=p("util"),z=p("scenes"),w=p("main"),E=p("transform"),y=[];new Float32Array(9);var H=new Float32Array(3),v=new Float32Array(3),B=new Float32Array(3),t=new Float32Array(3),u=new Float32Array(4),k=new Float32Array(4),q=new Float32Array(4),J=a.NT_WALKING=10,G=a.NT_FLYING=20,D=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=
new Float32Array(3);a.start=[];a.ended=[];a.fk=[];a.Ge=null;a.rs=null;a.bi=null;a.kf=!0;a.$n=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.fk[b]=!1;y.push(a)};a.enable_animation=function(){if(y.length){b();var a=m.create_elapsed_sensor();m.create_sensor_manifold(y[0].collider,"ELAPSED",m.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,b,d){if(1==d)for(a=m.get_sensor_value(a,b,0),b=0;b<y.length;b++){d=y[b];var e=a;if(z.is_visible(d.obj))if(d.random)c(e,d);else{for(var f=
w.global_timeline(),g=0;g<d.path.length;g++)if(!d.ended[g]){d.fk[g]||(d.fk[g]=!0,d.destination[0]=d.path[g][0],d.destination[1]=d.path[g][1],d.destination[2]=d.path[g][2],d.start[g]=f+d.delay[g]);if(f<d.start[g])break;c(e,d);d.ended[g]=d.kf;break}a:{for(e=0;e<d.path.length;e++)if(0==d.ended[e]){e=!1;break a}e=!0}if(e)for(e=0;e<d.path.length;e++)d.fk[e]=!1,d.ended[e]=!1}}})}};a.disable_animation=function(){if(!(0>=y.length))for(var a=0;a<y.length;a++){var b=y[a];m.check_sensor_manifolds(b.collider)&&
m.remove_sensor_manifold(b.collider);f.is_play(b.rig)&&f.stop(b.rig)}}};b4w.module.mouse=function(a,p){function c(){1==D&&(D=0);var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document);z.remove_sensor_manifold(y.get_active_camera(),"SMOOTH_PL")}function d(a){2==D&&(D=0);a.removeEventListener("mousedown",e,!1);a.removeEventListener("mouseup",h,!1);a.removeEventListener("mousemove",b,!1);z.remove_sensor_manifold(y.get_active_camera(),"SMOOTH_DRAG")}function b(a){J()&&(k[0]+=2*(a.clientX-t),k[1]+=
2*(a.clientY-u),t=a.clientX,u=a.clientY);a.preventDefault()}function e(a){t=a.clientX;u=a.clientY;a.currentTarget.addEventListener("mousemove",b,!1);a.preventDefault()}function h(a){a.currentTarget.removeEventListener("mousemove",b,!1);a.preventDefault()}function g(a,b){if(.01<Math.abs(k[0])||.01<Math.abs(k[1])){var c=z.get_sensor_value(a,b,0),d=H.smooth(k[0],0,c,.1*B),e=H.smooth(k[1],0,c,.1*B),c=y.get_first_character(),f=y.get_active_camera();m.rotate_eye_camera(f,4E-4*-d,4E-4*-e);k[0]-=d;k[1]-=
e;c&&(d=m.get_camera_angles_char(f,q),w.set_character_rotation(c,d[0],d[1]))}}function l(){v.detect_mobile()||v.get_canvas_elem().addEventListener("mousemove",f)}function n(){v.detect_mobile()||(v.get_canvas_elem().removeEventListener("mousemove",f),G&&y.set_outline_intensity(G,0))}function f(a){a=r.client_to_canvas_coords(a.clientX,a.clientY,q);(a=y.pick_object(a[0],a[1]))?(y.outlining_is_enabled(a)&&y.set_outline_intensity(a,1),y.outlining_is_enabled(G)&&a!=G&&y.set_outline_intensity(G,0)):y.outlining_is_enabled(G)&&
y.set_outline_intensity(G,0);G=a}var m=p("camera"),r=p("container"),z=p("controls"),w=p("physics"),E=p("print"),y=p("scenes"),H=p("util"),v=p("main"),B=1,t=0,u=0,k=new Float32Array(2),q=new Float32Array(2),J=null,G=null,D=0;a.request_pointerlock=function(a,b,c,e,f){function h(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){d(a);a.addEventListener("mousemove",e,!1);var f=y.get_active_camera();if(!z.check_sensor_manifold(f,"SMOOTH_PL")){var k=
z.create_elapsed_sensor();z.create_sensor_manifold(f,"SMOOTH_PL",z.CT_CONTINUOUS,[k],null,g)}b()}else a.removeEventListener("mousemove",e,!1),D=0,document.removeEventListener("pointerlockchange",h,!1),document.removeEventListener("webkitpointerlockchange",h,!1),document.removeEventListener("mozpointerlockchange",h,!1),c()}if(1!=D){D=1;b=b||function(){};c=c||function(){};f=f||function(){return!0};e=e||function(a){if(f()){if("number"==typeof a.movementX){var b=a.movementX;a=a.movementY}else"number"==
typeof a.webkitMovementX?(b=a.webkitMovementX,a=a.webkitMovementY):"number"==typeof a.mozMovementX?(b=a.mozMovementX,a=a.mozMovementY):a=b=0;k[0]+=b;k[1]+=a}};document.addEventListener("pointerlockchange",h,!1);document.addEventListener("webkitpointerlockchange",h,!1);document.addEventListener("mozpointerlockchange",h,!1);var l=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof l?l.apply(a):E.error("Pointer lock is not available")}};a.exit_pointerlock=c;
a.check_pointerlock=function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,b){if(2!=D){D=2;c();J=b||function(){return!0};a.addEventListener("mousedown",e,!1);a.addEventListener("mouseup",h,!1);var d=y.get_active_camera();if(!z.check_sensor_manifold(d,"SMOOTH_DRAG")){var f=z.create_elapsed_sensor();z.create_sensor_manifold(d,"SMOOTH_DRAG",z.CT_CONTINUOUS,[f],null,g)}}};a.exit_mouse_drag=d;a.enable_mouse_hover_outline=
l;a.enable_mouse_hover_glow=function(){E.error("enable_mouse_hover_glow() deprecated, use enable_mouse_hover_outline() instead");l()};a.disable_mouse_hover_outline=n;a.disable_mouse_hover_glow=function(){E.error("disable_mouse_hover_glow() deprecated, use disable_mouse_hover_outline() instead");n()};a.get_coords_x=function(a){return"clientX"in a?a.clientX:a.touches&&"clientX"in a.touches[0]?a.touches[0].clientX:-1};a.get_coords_y=function(a){return"clientY"in a?a.clientY:a.touches&&"clientY"in a.touches[0]?
a.touches[0].clientY:-1};a.set_plock_smooth_factor=function(a){B=a};a.get_plock_smooth_factor=function(){return B}};b4w.module.preloader=function(a,p){var c=p("app"),d,b,e,h,g,l,n,f,m,r=null;a.create_simple_preloader=function(a){var c=null,f=null,m="#bf9221",n="#000",p;for(p in a)switch(p){case "canvas_container_id":c=a.canvas_container_id;break;case "background_container_id":f=a.background_container_id;break;case "bg_color":n=a.bg_color;break;case "bar_color":m=a.bar_color;break;case "preloader_fadeout":d=a.preloader_fadeout}a=document.createElement("div");p=document.createElement("div");a.id="simple_preloader_container";
var B=document.createElement("div"),t=document.createElement("div"),f=document.getElementById(f);r=document.getElementById(c);a.style.cssText="z-index: 4;background-color: "+n+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";p.style.cssText="position: absolute;left: 50%;top: 82%;width: 300px;height: 20px;margin-left: -150px;margin-top: -10px;border-style:solid;border-width:4px;border-color: #000;border-radius: 0px;";B.style.cssText="position: absolute;left: 0px;top: 1px;width: 0px;height: 18px;background-color: "+
m+";border-radius: 0px;";t.style.cssText="position: absolute;left: 50%;top: 50%;width: 100%;height: 100%;margin-left: -150px;margin-top: -10px;text-align: center;font-size: 17px;font-weight: bold;color: #000;font-family: Verdana;"+p.appendChild(B);p.appendChild(t);a.appendChild(p);document.body.appendChild(a);b="SIMPLE";e=a;h=B;g=t;l=f};a.create_rotation_preloader=function(a){var c=null,d=null,f="rgba(0,0,0,0)",h="",m="",p="rgba(0,0,0,0)",t;for(t in a)switch(t){case "canvas_container_id":c=a.canvas_container_id;
break;case "background_container_id":d=a.background_container_id;break;case "frame_bg_color":f=a.frame_bg_color;break;case "bg_color":p=a.bg_color;break;case "frame_class":h=a.frame_class;break;case "anim_elem_class":m=a.anim_elem_class}a=document.createElement("div");t=document.createElement("div");var u=document.createElement("div"),k=document.createElement("div"),d=document.getElementById(d);r=document.getElementById(c);a.style.cssText="z-index: 4;background-color: "+p+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";
t.style.cssText="position: absolute;left: 50%;top: 50%;width: 117px;height: 117px;margin-left: -58px;margin-top: -58px;background-color: "+f+";";u.style.cssText="position: absolute;left: 0px;top: 0px;width: 100%;height: 100%;background-position: center;background-repeat: no-repeat;";k.style.cssText="position: absolute;width: 100%;height: 100%;text-align: center;margin-top: 38px;font-size: 36px;color: #ffffff;font-family: Arial;font-weight: bold;";u.className=m;t.appendChild(u);t.className=h;t.appendChild(k);
a.appendChild(t);r.appendChild(a);b="ROTATION";e=a;n=u;g=k;l=d};a.create_advanced_preloader=function(a){var c=a.preloader_width,c=c/(c-a.img_width),d=document.getElementById(a.preloader_bar_id),n=document.getElementById(a.fill_band_id),p=document.getElementById(a.preloader_caption_id),v=document.getElementById(a.preloader_container_id),B=document.getElementById(a.background_container_id);r=document.getElementById(a.canvas_container_id);b="ADVANCED";h=d;f=n;m=c;g=p;e=v;l=B};a.update_preloader=function(a){g.innerHTML=
a+"%";"SIMPLE"==b&&(h.style.width=a+"%");"ADVANCED"==b&&(h.style.width=a/m+"%",f.style.width=100-a+"%");"ROTATION"==b&&(n.style.transform="rotate("+a+"deg)");100==a&&(d?(c.css_animate(l,"opacity",1,0,1500,null,null,function(){l.parentNode.removeChild(l)}),c.css_animate(e,"opacity",1,0,1E3,null,null,function(){e.parentNode.removeChild(e)})):(e.parentNode.removeChild(e),l&&l.parentNode.removeChild(l)))}};b4w.module.storage=function(a,p){function c(a){e=a;try{h=window.localStorage}catch(c){b.warn("Applying chrome localStorage bug workaround"),h=null}h||(b.warn("localStorage is not available, initializing temporary storage"),h={})}function d(){return h[e]?JSON.parse(h[e]):{}}var b=p("__print"),e="",h=null;a.init=c;a.set=function(a,b){var c=d();c[a]=String(b);h[e]=JSON.stringify(c)};a.cleanup=function(){delete h[e]};a.get=function(a){var b=d();return b[a]?b[a]:""};a.debug=function(){b.log(d())};c("b4w")};b4w.module.screenshooter=function(a,p){var c=p("main");a.shot=function(){c.canvas_data_url(function(a){var b=window.document.createElement("a");document.body.appendChild(b);b.style.display="none";b.href=a;b.download="screenshot.png";b.click();document.body.removeChild(b)})}};
