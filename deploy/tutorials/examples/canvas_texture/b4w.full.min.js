var b4w=function(a){var p={};a.module=p;var c={};a.register=function(a,c){if(p[a])throw Error('Module "'+a+'" already registered');p[a]=c};a.require=function(a,e){if(!p[a])throw Error('Module "'+a+'" not found');e=e||"__B4W_DEF_NS";c[e]||(c[e]=function(a){return function(b){var e=p[b];if(!e)throw Error('Module "'+b+'" not found');e.uh||(e.uh={});e.uh[a]||(e.uh[a]={},e(e.uh[a],c[a]));return e.uh[a]}}(e));return c[e](a)};a.module_check=function(a){return p[a]?!0:!1};return a}({});"object"==typeof module&&module.ql&&(GLOBAL.b4w={module:{}});b4w.module.__version=function(a){function p(){return"25.02.2015 10:28:57"}a.version=function(){return"15.02"};a.type=function(){return"RELEASE"};a.date=p;a.timestamp=function(){var a=p(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.ql&&b4w.module.__version(exports);b4w.module.__config=function(a,p){function c(){return b4w.module_check(a.Rb.Zi)}var b=p("__print"),e=p("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.Gu=e.ya(a.context);a.p={alpha_sort:!0,alpha_sort_threshold:.1,kq:5,qe:1E4,console_verbose:!1,do_not_load_resources:!1,tk:!1,Tv:1.5,Sv:10,background_color:[0,0,0,0],force_selectable:!1,all_objs_selectable:!1,Df:.01,resolution_factor:1,canvas_resolution_factor:1,mk:3,allow_cors:!1,vl:!1,
Qi:!0,show_hud_debug_info:!1,qB:!0,Ae:"DEPTH",anaglyph_use:!1,ck:!0,ni:.5,Cc:!0,glow:!0,Ge:!0,og:!0,yg:!0,gg:!0,Fg:!0,kg:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,ds:!1,rg:!0,ei:!0,Da:!0,$j:!0,water_dynamic:!0,shore_smoothing:!0,Pg:!0,Oc:1024,em:512,max_bones:53,Tr:!0,precision:"highp",quality:a.P_HIGH,Dk:!0,of:!1,Hx:!1,kr:!1,So:!1,Yr:!1,uf:!1,Qp:!1,wo:!1,fp:!1,NC:!1,Ec:!1,allow_hidpi:!1,yj:!1,gp:!1};a.sv=e.ya(a.p);a.kd={Ba:-1,kp:!1,lf:1};a.controls={Fx:1/120};a.md={dir:"ASSETS=../../assets/",
zx:15,Pq:!0,gm:!1,jl:!1};a.Xt=e.ya(a.md);a.Rb={shaders_dir:"../../shaders/",Ty:"include/",Zi:"built_in_data",smaa_search_texture_path:"",smaa_area_texture_path:"",my:"./",Zq:["b4w.min.js","b4w.full.min.js","src/b4w.js","USER_DEFINED_MODULE"]};a.sb={enabled:!0,qe:60,ih:""};a.Qx=e.ya(a.sb);a.ri={uj:1024,ij:384};a.uy=e.ya(a.ri);a.Od={nA:!0,Pj:!1,Un:!1,ro:!1,To:!1};a.Sy=e.ya(a.Od);a.ll={enabled:!1,vz:"MAIN_OPAQUE",uz:0,Wy:"COLOR"};a.ov=e.ya(a.ll);a.Ut=function(){var b=a.p,c=a.sb,e=a.ri;switch(b.quality){case a.P_ULTRA:b.Ae=
"DEPTH";b.shore_smoothing=!0;b.glow=!0;b.Ge=!0;b.og=!0;b.yg=!0;b.gg=!0;b.ck=!0;b.ni=1;b.Cc=!0;b.rg=!0;b.ei=!0;b.Da=!0;b.$j=!0;b.resolution_factor=1.75;e.uj=2048;b.mk=3;b.Qi=!0;b.tk=!1;b.max_bones=53;b.precision="highp";b.water_dynamic=!0;b.Pg=!0;b.antialiasing=!0;b.smaa=!0;b.kg=!0;b.Fg=!0;b.allow_hidpi=!0;c.qe=120;break;case a.P_HIGH:b.Ae="DEPTH";b.shore_smoothing=!0;b.glow=!0;b.Ge=!0;b.og=!0;b.yg=!0;b.gg=!0;b.ck=!0;b.ni=.5;b.Cc=!0;b.rg=!0;b.ei=!0;b.Da=!0;b.$j=!0;b.resolution_factor=1;e.uj=1024;b.mk=
3;b.Qi=!0;b.tk=!1;b.max_bones=53;b.precision="highp";b.water_dynamic=!0;b.Pg=!0;b.antialiasing=!0;b.smaa=!1;b.kg=!0;b.Fg=!0;b.allow_hidpi=!1;c.qe=60;break;case a.P_LOW:b.Ae="NONE",b.shore_smoothing=!1,b.glow=!1,b.Ge=!1,b.og=!1,b.yg=!1,b.gg=!1,b.ck=!1,b.ni=.5,b.Cc=!1,b.rg=!1,b.ei=!1,b.Da=!1,b.$j=!1,b.resolution_factor=1,e.uj=512,b.mk=2,b.Qi=!1,b.tk=!0,b.max_bones=53,b.precision="mediump",b.water_dynamic=!1,b.Pg=!1,b.antialiasing=!1,b.smaa=!1,b.kg=!1,b.Fg=!1,b.allow_hidpi=!1,c.qe=60}};a.set=function(c,
e){switch(c){case "all_objs_selectable":a.p.all_objs_selectable=e;break;case "allow_cors":a.p.allow_cors=e;break;case "allow_hidpi":a.p.allow_hidpi=e;break;case "alpha":a.context.alpha=e;break;case "alpha_sort":a.p.alpha_sort=e;break;case "alpha_sort_threshold":a.p.alpha_sort_threshold=e;break;case "anaglyph_use":a.p.anaglyph_use=e;break;case "animation_framerate":a.kd.Ba=e;break;case "antialiasing":a.p.antialiasing=e;break;case "assets_dds_available":a.md.jl=e;break;case "assets_min50_available":a.md.gm=
e;break;case "background_color":a.p.background_color=e;break;case "built_in_module_name":a.Rb.Zi=e;break;case "canvas_resolution_factor":a.p.canvas_resolution_factor=e;break;case "console_verbose":a.p.console_verbose=e;break;case "context_antialias":a.context.antialias=e;break;case "do_not_load_resources":a.p.do_not_load_resources=e;break;case "force_selectable":a.p.force_selectable=e;break;case "gyro_use":a.p.yj=e;break;case "glow":a.p.glow=e;break;case "physics_enabled":a.sb.enabled=e;break;case "physics_uranium_path":a.sb.ih=
e;break;case "precision":a.p.precision=e;break;case "quality":a.p.quality=e;break;case "resolution_factor":a.p.resolution_factor=e;break;case "sfx_mix_mode":a.Od.Pj=e;break;case "shaders_dir":a.Rb.shaders_dir=e;break;case "show_hud_debug_info":a.p.show_hud_debug_info=e;break;case "smaa":a.p.smaa=e;break;case "smaa_search_texture_path":a.Rb.smaa_search_texture_path=e;break;case "smaa_area_texture_path":a.Rb.smaa_area_texture_path=e;break;case "wireframe_debug":a.p.wireframe_debug=e;break;default:b.error("B4W config set - property unknown: "+
c)}};a.get=function(c){switch(c){case "all_objs_selectable":return a.p.all_objs_selectable;case "allow_cors":return a.p.allow_cors;case "allow_hidpi":return a.p.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.p.alpha_sort;case "alpha_sort_threshold":return a.p.alpha_sort_threshold;case "anaglyph_use":return a.p.anaglyph_use;case "animation_framerate":return a.kd.Ba;case "antialiasing":return a.p.antialiasing;case "assets_dds_available":return a.md.jl;case "assets_min50_available":return a.md.gm;
case "background_color":return a.p.background_color;case "built_in_module_name":return a.Rb.Zi;case "canvas_resolution_factor":return a.p.canvas_resolution_factor;case "console_verbose":return a.p.console_verbose;case "context_antialias":return a.context.antialias;case "do_not_load_resources":return a.p.do_not_load_resources;case "force_selectable":return a.p.force_selectable;case "gyro_use":return a.p.yj;case "glow":return a.p.glow;case "physics_enabled":return a.sb.enabled;case "physics_uranium_path":return a.sb.ih;
case "precision":return a.p.precision;case "quality":return a.p.quality;case "resolution_factor":return a.p.resolution_factor;case "sfx_mix_mode":return a.Od.Pj;case "shaders_dir":return a.Rb.shaders_dir;case "show_hud_debug_info":return a.p.show_hud_debug_info;case "smaa":return a.p.smaa;case "smaa_search_texture_path":return a.Rb.smaa_search_texture_path;case "smaa_area_texture_path":return a.Rb.smaa_area_texture_path;case "wireframe_debug":return a.p.wireframe_debug;default:b.error("B4W config get - property unknown: "+
c)}};a.reset=function(){a.context=e.ya(a.Gu);a.p=e.ya(a.sv);a.md=e.ya(a.Xt);a.sb=e.ya(a.Qx);a.ri=e.ya(a.uy);a.Od=e.ya(a.Sy);a.ll=e.ya(a.ov)};a.Up=c;a.Ky=function(){var d=a.Rb,e=a.sb;if(c())d.smaa_search_texture_path="smaa_search_texture.png",d.smaa_area_texture_path="smaa_area_texture.png";else if(""==d.smaa_search_texture_path||""==d.smaa_area_texture_path||""==e.ih){for(var g=null,f=document.getElementsByTagName("script"),r=0;r<f.length;r++){for(var h=f[r].src,n=0;n<d.Zq.length;n++)if(0<=h.indexOf(d.Zq[n])){g=
h;break}if(null!==g)break}g||(b.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),g=document.location.href);f=g.indexOf("?");0<=f&&(g=g.substring(0,f));g=g.substring(0,g.lastIndexOf("/")+1)+d.my;e.ih=e.ih||g+"uranium.js";d.smaa_search_texture_path=d.smaa_search_texture_path||g+"smaa_search_texture.png";d.smaa_area_texture_path=d.smaa_area_texture_path||g+"smaa_area_texture.png"}};a.get_std_assets_path=function(){return a.md.dir.replace("ASSETS=","")}};b4w.module.__boundings=function(a,p){function c(a,b){for(var c=a[0],d=a[1],q=a[2],f=a[0],k=a[1],e=a[2],g=3;g<a.length;g+=3)var m=a[g],h=a[g+1],l=a[g+2],c=Math.max(c,m),d=Math.max(d,h),q=Math.max(q,l),f=Math.min(f,m),k=Math.min(k,h),e=Math.min(e,l);b.max_x=c;b.max_y=d;b.max_z=q;b.min_x=f;b.min_y=k;b.min_z=e;return b}function b(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,q=a.max_z,f=a.min_x,k=a.min_y,e=a.min_z;b[0]=f;b[1]=k;b[2]=e;b[3]=c;b[4]=k;b[5]=e;b[6]=c;b[7]=d;b[8]=e;b[9]=f;b[10]=
d;b[11]=e;b[12]=f;b[13]=k;b[14]=q;b[15]=c;b[16]=k;b[17]=q;b[18]=c;b[19]=d;b[20]=q;b[21]=f;b[22]=d;b[23]=q;return b}function e(a,b,c){f.add(b,c,a.A);f.scale(a.A,.5,a.A);a.ua=f.distance(a.A,b);return a}var d=p("__geometry"),l=p("__util"),g=p("__tsr"),f=p("vec3"),r=new Float32Array(24),h=new Float32Array(3),n=new Float32Array(3),m=new Float32Array(3);a.Fo=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.XA=function(){return{max_x:1E12,min_x:-1E12,
max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.ed=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.Yo=function(a,b){var c=a.max_y,d=a.max_z,q=a.min_x,f=a.min_y,k=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,q);a.min_y=Math.min(b.min_y,f);a.min_z=Math.min(b.min_z,k)};a.cu=c;a.Qk=function(d,f,e){e||(e=a.ed());d=b(d,r);l.ue(d,f,d);return c(d,e)};a.Jv=b;a.MC=function(b,c,d){d||
(d=a.ed());var f=c.min_x,q=c.max_x,e=c.min_y,k=c.max_y,g=c.min_z;c=c.max_z;if(f>=b.max_x||q<=b.min_x||e>=b.max_y||k<=b.min_y||g>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,f);d.max_x=Math.min(b.max_x,q);d.min_y=Math.max(b.min_y,e);d.max_y=Math.min(b.max_y,k);d.min_z=Math.max(b.min_z,g);d.max_z=Math.min(b.max_z,c);return d};a.QC=function(b,c,d){d||(d=a.ed());var f=b.max_x-b.min_x,q=b.max_y-b.min_y,e=b.max_z-b.min_z;d.min_x=
b.min_x-.5*(c-1)*f;d.max_x=b.max_x+.5*(c-1)*f;d.min_y=b.min_y-.5*(c-1)*q;d.max_y=b.max_y+.5*(c-1)*q;d.min_z=b.min_z-.5*(c-1)*e;d.max_z=b.max_z+.5*(c-1)*e;return d};a.Sk=function(b,c,d){d||(d=a.Gi());f.transformMat4(b.A,c,d.A);d.ua=b.ua*l.Lj(c);return d};a.Rk=function(a,b,c){c||(c={We:new Float32Array(3),Xe:new Float32Array(3),Ye:new Float32Array(3),A:new Float32Array([0,0,0])});g.xi(a.A,b,c.A);f.copy(a.We,c.We);f.copy(a.Xe,c.Xe);f.copy(a.Ye,c.Ye);g.nk(c.We,b,c.We);g.nk(c.Xe,b,c.Xe);g.nk(c.Ye,b,c.Ye);
return c};a.dl=function(a,b){return{ua:a,A:new Float32Array(b)}};a.Gi=function(){return{A:new Float32Array([0,0,0]),ua:0}};a.cl=function(a,b,c,d){return{We:new Float32Array(a),Xe:new Float32Array(b),Ye:new Float32Array(c),A:new Float32Array([d[0],d[1],d[2]])}};a.eu=function(){return{A:new Float32Array([0,0,0]),ua:1E12}};a.Gv=function(a,b){var c=f.subtract(b.A,a.A,f.create());0==f.length(c)&&f.set(1,0,0,c);var d=f.normalize(c,f.create()),c=f.scale(d,a.ua,f.create());f.add(c,a.A,c);var q=f.scale(d,
-a.ua,f.create());f.add(q,a.A,q);var e=f.scale(d,b.ua,f.create());f.add(e,b.A,e);var k=f.scale(d,-b.ua,f.create());f.add(k,b.A,k);c=[c,q,e,k];d=f.normalize(d,f.create());q=c[0];e=c[0];for(k=1;k<c.length;k++){var g=f.dot(c[k],d);g<f.dot(q,d)&&(q=c[k]);g>f.dot(e,d)&&(e=c[k])}d=[q,e];c=d[0];d=d[1];a.A=f.scale(f.add(c,d,f.create()),.5,f.create());a.ua=f.length(f.subtract(d,c,f.create()))/2};a.Go=function(a,b){var c=b.max_y,d=b.min_y,q=Math.max(0,c-d-2*a);return{ua:a,height:q,A:new Float32Array([0,(c+
d)/2,0])}};a.Io=function(a,b){var c=b.max_y,d=b.min_y,q=Math.max(0,c-d);return{ua:a,height:q,A:new Float32Array([0,(c+d)/2,0])}};a.Ho=function(a,b){var c=b.max_y,d=b.min_y,q=Math.max(0,c-d);return{ua:a,height:q,A:new Float32Array([0,(c+d)/2,0])}};a.$A=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.by=function(a){for(var b=0,c=0,d=0,q=0,f=0,k=0,e=0,g=0,m=0;m<a.submeshes.length;m++){var h=a.submeshes[m];if(h.position.length){b=
q=h.position[0];c=f=h.position[1];d=k=h.position[2];break}}for(m=0;m<a.submeshes.length;m++)for(var h=a.submeshes[m],h=h.position,l=0;l<h.length/3;l++)var n=h[3*l],y=h[3*l+1],I=h[3*l+2],b=Math.max(n,b),c=Math.max(y,c),d=Math.max(I,d),q=Math.min(n,q),f=Math.min(y,f),k=Math.min(I,k),e=Math.max(Math.sqrt(n*n+y*y+I*I),e),g=Math.max(Math.sqrt(n*n+I*I),g);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=q;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=f;a.b4w_bounding_box.max_z=d;a.b4w_bounding_box.min_z=
k;a.b4w_bounding_sphere_radius=e;a.b4w_bounding_cylinder_radius=g};a.Cw=function(b){var c=b.subarray(0,3),g=b.subarray(6,9),l=b.subarray(12,15),q=b.subarray(18,21);b=f.subtract(g,c,h);f.normalize(b,b);var r=d.Fw(c,g,l,n),r=f.cross(r,b,r);f.normalize(r,r);var k=f.create(),x=f.create();f.subtract(g,c,m);x[0]=f.dot(m,b);x[1]=f.dot(m,r);g=f.create();f.subtract(l,c,m);g[0]=f.dot(m,b);g[1]=f.dot(m,r);l=f.create();f.subtract(q,c,m);l[0]=f.dot(m,b);l[1]=f.dot(m,r);q=a.Gi();l=[k,x,g,l];k=e(q,l[0],l[1]);for(q=
2;q<l.length;q++)if(f.distance(k.A,l[q])>k.ua){for(var v=k,k=l,x=l[q],g=q-1,v=e(v,x,k[0]),G=1;G<=g;G++)if(f.distance(v.A,k[G])>v.ua){for(var A=v,v=k,C=x,M=k[G],y=G-1,A=e(A,C,M),I=0;I<=y;I++)if(f.distance(A.A,v[I])>A.ua){var H=C,Y=M,J=v[I],D=f.subtract(Y,J,m),D=f.squaredLength(D),T=f.subtract(H,J,m),K=f.squaredLength(T),T=f.subtract(H,Y,m),R=f.squaredLength(T),T=D*(K+R-D),N=K*(R+D-K),D=R*(D+K-R),K=T+N+D;f.copy(H,A.A);f.scale(A.A,T/K,A.A);f.scaleAndAdd(A.A,Y,N/K,A.A);f.scaleAndAdd(A.A,J,D/K,A.A);A.ua=
f.distance(A.A,H)}v=A}k=v}q=k;b=f.scale(b,q.A[0],m);f.scaleAndAdd(b,r,q.A[1],b);f.add(b,c,q.A);return q}};b4w.module.__compat=function(a,p){function c(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function b(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function e(){return!window.ActiveXObject&&"ActiveXObject"in window}var d=p("__config"),l=p("__extensions"),g=p("__print"),
f=p("__util");a.Ey=function(a){var h=d.kd,n=d.p,m=d.context,s=d.ri,B=d.Od;n.Oc=a.getParameter(a.MAX_TEXTURE_SIZE);n.em=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var z=Boolean(l.zw());c("Firefox")&&d.Up()&&(g.warn("Firefox detected for single HTML version, disable video textures."),n.fp=!0);c("Firefox/28.0")&&(c("Linux")||c("Macintosh"))&&(g.warn("Firefox 28 detected, applying depth hack"),z=!1);c("iPad")||c("iPhone")?(g.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
m.alpha||(n.background_color[3]=1),n.Yr=!0,n.smaa=!1,n.Ge=!1,n.precision="highp",n.Qp=!0):c("Mac OS X")&&c("Safari")&&!c("Chrome")&&(g.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),B.Un=!0,B.ro=!0);c("Windows")&&(c("Chrome/40")||c("Firefox/33")||c("Firefox/34")||c("Firefox/35")||c("Firefox/36"))&&(g.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),n.wo=!0);b()&&(g.warn("Mobile detected, applying glsl loops unroll hack, applying various hacks for video textures."),
n.of=!0,n.uf=!0,c("iPad")||c("iPhone")||(g.warn("Mobile (not iOS) detected, disable playback rate for video textures."),B.To=!0));(c("Firefox/35.0")||c("Firefox/36.0"))&&c("Windows")&&(g.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),n.gp=!0);if(c("iPhone")||e())g.warn("iPhone or IE11 detected. Enable sequential video fallback for video textures."),n.Ec=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(g.warn("Not enough varyings, disable shadows on blend objects"),n.So=!0);if(m=
l.xp())c("Macintosh")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(g.warn("OS X / Intel HD 3000 detected, applying depth and glsl loops unroll hacks"),z=!1,n.of=!0),-1<a.getParameter(m.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(g.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),z=!1,h.kp=!0),-1<a.getParameter(m.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&
(g.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),n.precision="highp",n.Ae="NONE"),-1<a.getParameter(m.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T760")&&(g.warn("ARM Mali-T760 detected, disable SSAO."),n.Ge=!1),-1<a.getParameter(m.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(g.warn("Qualcomm Adreno detected, applying shader constants hack."),n.kr=!0,-1<
a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(g.warn('Qualcomm Adreno305 detected, set "highp" precision.'),n.precision="highp"),-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(g.warn('Qualcomm Adreno330 detected, set "highp" precision.'),n.precision="highp")),-1<a.getParameter(m.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(m.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&(g.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),
n.vl=!0);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(g.warn("Vertex textures are not allowed. Disabling vertex textures"),n.Dk=!1);n.allow_hidpi&&1<window.devicePixelRatio&&(g.log("%cENABLE HIDPI MODE","color: #00a"),n.resolution_factor=1,n.smaa=!1);z||(n.rg=!1,n.ei=!1,n.Da=!1,n.water_dynamic=!1,n.shore_smoothing=!1,n.Pg=!1,n.Cc=!1,n.smaa=!1);n.Tr=Boolean(l.yp());n.kj=z;h=f.clamp(a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),128,Infinity);n.max_bones=f.trunc((h-50)/4);n.yC=f.trunc((h-50)/
2);0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(n.precision="mediump");e()&&(g.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),s.ij=512);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(g.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),n.vl=!0)};a.detect_mobile=b;a.St=function(){c("Firefox/35.0")&&c("Windows")&&(g.warn("Windows/Firefox 35 detected, forcing context's alpha"),d.context.alpha=!0)};
a.Rl=e};b4w.module.__constraints=function(a,p){function c(a){var b={};b.type=a;return b}function b(a,b){a.kb&&a.kb.T&&e(a.kb.T,a);if(b.T){var c=b.T;if(-1==c.Wd.indexOf(a))c.Wd.push(a);else throw"Descendant object override is forbidden";}a.kb=b}function e(a,b){var c=a.Wd.indexOf(b);if(-1!=c)a.Wd.splice(c,1);else throw"No descendant object";}function d(a,b,c){switch(b.type){case 1:var d=a.d.quat,e=b.T.d.L;c=b.T.d.quat;b.xe?(B.copy(b.xe,d),B.multiply(c,d,d)):B.copy(c,d);s.transformMat4(b.offset,e,a.d.g);a.d.scale=
b.dk*b.T.d.scale;break;case 9:var D=a.d.g,d=a.d.quat,e=b.T.d.L;c=b.T.d.quat;B.multiply(B.invert(b.Of,b.Of),d,d);B.multiply(c,d,d);s.transformMat4(b.offset,e,D);B.copy(c,b.Of);break;case 10:D=a.d.g;d=a.d.quat;e=b.T.d.L;c=b.T.d.quat;B.multiply(B.invert(b.Of,b.Of),d,d);B.multiply(c,d,d);s.transformMat4(b.offset,e,D);B.copy(c,b.Of);var d=a.d.quat,D=b.T.d.quat,m=s.transformQuat(n.AXIS_Y,d,u),e=B.invert(D,x),A=s.transformQuat(m,e,q),v=F;v[0]=A[0];v[1]=0;v[2]=A[2];var N=s.length(v),e=-v[2]/N,e=Math.acos(e)*
n.sign(v[0]),N=N/s.length(A),N=Math.acos(N)*n.sign(A[1]),A=!1;e<-b.qo&&(e=-b.qo,A=!0);e>b.so&&(e=b.so,A=!0);N<-b.uo&&(N=-b.uo,A=!0);N>b.po&&(N=b.po,A=!0);A&&(b=Math.sin(N),N=Math.cos(N),A=Math.sin(e),e=Math.cos(e),v=q,v[0]=N*A,v[1]=b,v[2]=-N*e,s.transformQuat(v,D,v),b=B.rotationTo(m,v,x),B.multiply(b,d,d),B.normalize(d,d));"CAMERA"==a.d.type&&(b=s.transformQuat(n.AXIS_Y,c,q),f(a,b));break;case 12:D=a.d.g;d=a.d.quat;e=b.T.d.L;N=b.T.d.g;a=b.Yy;A=u;m=x;s.transformMat4(b.offset,e,A);n.smooth_v(A,D,c,
a,D);b=u;s.sub(N,D,b);s.normalize(b,b);v=d;D=C;e=D.subarray(0,3);N=D.subarray(3,6);A=D.subarray(6,9);s.copy(b,N);s.negate(N,N);s.normalize(N,N);Boolean(.999999<Math.abs(s.dot(b,n.AXIS_Y)))?(b=z.fromQuat(B.normalize(v,m),M),s.copy(b.subarray(0,3),e)):s.cross(n.AXIS_Y,N,e);s.normalize(e,e);s.cross(e,N,A);s.normalize(A,A);B.fromMat3(D,m);B.normalize(m,m);n.qr(m,d,c,.16*a,d);break;case 2:d=a.d.quat;D=k;c=x;r(b.T,b.ju,!0,D,c);b.xe?(B.copy(b.xe,d),B.multiply(c,d,d)):B.copy(c,d);a.d.scale=b.dk*D[3];n.xi(b.offset,
D[3],c,D,a.d.g);break;case 3:D=a.d.g;d=a.d.quat;c=b.T.d.g;l(D,d,c);"CAMERA"==a.d.type&&f(a,n.AXIS_Y);break;case 4:D=a.d.g;d=a.d.quat;c=b.target;l(D,d,c);"CAMERA"==a.d.type&&f(a,n.AXIS_Y);break;case 5:D=a.d.g;d=a.d.quat;c=b.T.d.g;g(D,d,c,b.Jf);d=s.dist(D,c);if(b=d>b.ci?d-b.ci:d<b.Jf?d-b.Jf:0)s.sub(c,D,u),s.normalize(u,u),s.scale(u,b,u),s.add(D,u,D);"CAMERA"==a.d.type&&f(a,n.AXIS_Y);break;case 6:D=a.d.g;d=a.d.quat;c=b.target;g(D,d,c,b.Jf);d=s.dist(D,c);if(b=d>b.ci?d-b.ci:d<b.Jf?d-b.Jf:0)s.sub(c,D,u),
s.normalize(u,u),s.scale(u,b,u),s.add(D,u,D);"CAMERA"==a.d.type&&f(a,n.AXIS_Y);break;case 7:e=b.T.d.L;s.transformMat4(b.offset,e,a.d.g);break;case 8:N=b.T.d.g;D=a.d.g;s.add(N,b.offset,D);break;case 13:d=a.d.quat;e=b.T.d.L;c=b.T.d.quat;b.xe?(B.copy(b.xe,d),B.multiply(c,d,d)):B.copy(c,d);s.transformMat4(b.offset,e,a.d.g);break;case 11:c=b.T.d,c=h.lg(c.g,c.scale,c.quat,G),h.multiply(c,b.Nr,c),D=a.d.g,D[0]=c[0],D[1]=c[1],D[2]=c[2],a.d.scale=c[3],d=a.d.quat,d[0]=c[4],d[1]=c[5],d[2]=c[6],d[3]=c[7]}}function l(a,
b,c){var d=u;n.quat_to_dir(b,n.AXIS_MY,d);s.normalize(d,d);var e=q;s.subtract(c,a,e);s.normalize(e,e);a=k;n.cr(d,e,a);B.multiply(a,b,b)}function g(a,b,c,d){var e=u;n.quat_to_dir(b,n.AXIS_MY,e);s.normalize(e,e);var D=q;s.subtract(c,a,D);a=s.length(D);s.normalize(D,D);a>d-.001&&(d=n.cr(e,D,k),B.multiply(d,b,b),B.normalize(b,b))}function f(a,b){var c=a.d,d=c.quat,e=n.quat_to_dir(c.quat,n.AXIS_Y,u);s.normalize(e,e);if(.999999<Math.abs(s.dot(b,e)))e=B.identity(x);else{var D=s.cross(b,e,q);s.normalize(D,
D);c.P==m.MS_TARGET_CONTROLS?c.lk&&(D[0]*=-1,D[1]*=-1,D[2]*=-1):0<n.quat_to_dir(c.quat,n.AXIS_Z,F)[1]&&(D[0]*=-1,D[1]*=-1,D[2]*=-1);c=n.quat_to_dir(c.quat,n.AXIS_X,F);s.normalize(c,c);var k=n.clamp(s.dot(c,D),-1,1),f=Math.acos(k),e=-.999999>=k?B.setAxisAngle(e,f,x):B.rotationTo(c,D,x);B.normalize(e,e)}B.multiply(e,d,d)}function r(a,b,c,d,q){var D=a.d,e=D.kf,f=D.oc[b];b=f.Eh;a=a.pose.bones[f.tm];var f=a.Fn,g=k,m=D.lc,l=D.kc,n=D.dc,C=D.cc,M=m[4*b+1],r=m[4*b+2],z=m[4*b+3],s=l[4*b+1],u=l[4*b+2],F=l[4*
b+3];g[0]=(1-e)*m[4*b]+e*l[4*b];g[1]=(1-e)*M+e*s;g[2]=(1-e)*r+e*u;g[3]=(1-e)*z+e*F;m=x;l=v;m[0]=n[4*b];m[1]=n[4*b+1];m[2]=n[4*b+2];m[3]=n[4*b+3];l[0]=C[4*b];l[1]=C[4*b+1];l[2]=C[4*b+2];l[3]=C[4*b+3];B.slerp(m,l,e,m);e=G;h.Oy(g,e);h.Fm(m,e);c?(c=A,h.translate(f,a.yt,c),h.multiply(e,c,e)):h.multiply(e,f,e);h.multiply(D.Sd,e,e);d[0]=e[0];d[1]=e[1];d[2]=e[2];d[3]=e[3];q&&(q[0]=e[4],q[1]=e[5],q[2]=e[6],q[3]=e[7])}var h=p("__tsr"),n=p("__util"),m=p("__camera"),s=p("vec3"),B=p("quat"),z=p("mat3");p("mat4");
a.zA=1;a.yA=2;a.CA=3;a.DA=4;a.tA=5;a.uA=6;a.AA=7;a.sA=8;a.xA=9;a.wA=10;a.fd=11;a.vA=12;a.BA=13;var u=new Float32Array(3),q=new Float32Array(3),F=new Float32Array(3),k=new Float32Array(4),x=new Float32Array(4),v=new Float32Array(4),G=new Float32Array(16),A=new Float32Array(16),C=new Float32Array(9),M=new Float32Array(9),G=new Float32Array(8);a.gs=9*Math.PI/10;a.Nn=function(a,q,H,e,f){var D=c(1);D.T=q;D.offset=new Float32Array(H);D.xe=e?new Float32Array(e):null;D.dk=f;b(a,D);d(a,D,0)};a.Mn=function(a,
q,H,e,f,D){var k=c(2);k.T=q;k.ju=H;k.offset=new Float32Array(e);k.xe=f?new Float32Array(f):null;k.dk=D;b(a,k);d(a,k,0)};a.Lt=function(a,q,H,e){var f=c(9),D=a.d.quat,k=q.d.quat;f.T=q;f.offset=new Float32Array(H);f.Of=new Float32Array(k);e&&(B.copy(e,D),B.multiply(k,D,D));b(a,f);d(a,f,0)};a.Kt=function(a,q,H,e,f,D,k,g){var m=c(10),l=a.d.quat,h=q.d.quat;m.T=q;m.offset=new Float32Array(H);m.Of=new Float32Array(h);m.qo=f;m.so=D;m.uo=k;m.po=g;e&&(B.copy(e,l),B.multiply(h,l,l));b(a,m);d(a,m,0)};a.Jt=function(a,
q,H,e){var f=c(12);f.T=q;f.offset=new Float32Array(H);f.Yy=e;b(a,f);d(a,f,0)};a.Nt=function(a,q,H,e){var f=c(13);f.T=q;f.offset=new Float32Array(H);f.dk=1;f.xe=e?new Float32Array(e):null;b(a,f);d(a,f,0)};a.Pt=function(a,q){var H=c(3);H.T=q;b(a,H);d(a,H,0)};a.Qt=function(a,q){var H=c(4);H.target=new Float32Array(q);b(a,H);d(a,H,0)};a.Gt=function(a,q,H,e){var f=c(5);f.T=q;f.Jf=H;f.ci=e;b(a,f);d(a,f,0)};a.Ht=function(a,q,H,e){var f=c(6);f.target=new Float32Array(q);f.Jf=H;f.ci=e;b(a,f);d(a,f,0)};a.Mt=
function(a,q,H){var e=c(7);e.T=q;e.offset=new Float32Array(H);b(a,e);d(a,e,0)};a.Ft=function(a,q,H){var e=c(8);e.T=q;e.offset=new Float32Array(H);b(a,e);d(a,e,0)};a.Et=function(a,q,H){var e=c(11);e.T=q;e.Nr=new Float32Array(H);b(a,e);d(a,e,0)};a.Mz=function(a,b){a.kb&&d(a,a.kb,b)};a.oy=l;a.py=g;a.correct_up=f;a.remove=function(a){a.kb.T&&e(a.kb.T,a);a.kb=null};a.Dd=function(a){return a.kb?a.kb.type:null};a.SB=function(a){return a.kb&&a.kb.T?a.kb.T:null};a.Cd=function(a){return a.kb&&11==a.kb.type?
a.kb.Nr:null};a.sw=r};b4w.module.__controls=function(a,p){function c(a){return{type:a,value:0,Y:null,bm:null,am:null,Kj:null,zc:!1,key:0,Zb:"",Zk:null,jm:!1,Yk:function(){},Xk:null,xo:function(){},Wc:null,Pm:new Float32Array(3),pl:new Float32Array(3),$l:!1,Vq:function(){},axis:"",jc:0,gh:new Float32Array(3),ak:new Float32Array(4),threshold:0,Tq:new Float32Array(4),Ti:0,Si:0,br:0,Ui:0,sc:0,repeat:!1,Vn:!1,xj:0,wj:0,vj:0,Ll:0,Kl:0,Jl:0}}function b(a,b){var t;if(a.Kj){t=a.bm;for(var c=a.am,y=0;y<t.length;y++)c[y]=t[y].value;
t=a.Kj(c)}else t=!1;t||(a.value=Number(b))}function e(a){a=I.indexOf(a);-1<a?I.splice(a,1):F.error("Wrong object")}function d(a,b){for(var t=0,c=0;c<b.length;c++)for(var y=b[c].Se,d=0;d<y.length;d++)for(var q=y[d].Tc,H=0;H<q.length;H++)q[H]===a&&t++;return t}function l(a,b){switch(a.type){case 80:k.remove_collision_test(a.Zk,a.Zb,a.Yk);a.zc=!0;break;case 90:k.clear_collision_impulse_test(a.Xk);a.zc=!0;break;case 100:k.remove_ray_test(a.Wc,a.Zb,a.Pm,a.pl,a.$l);a.zc=!0;break;case 130:a.zc=!0}var t=
b.indexOf(a);-1<t&&b.splice(t,1)}function g(a){for(var t=0;t<H.length;t++){var c=H[t];20==c.type&&a.keyCode==c.key&&b(c,1)}S&&a.preventDefault();U&&U(a)}function f(a){for(var t=0;t<H.length;t++){var c=H[t];20==c.type&&0==a.keyCode&&16==c.key&&b(c,0);20==c.type&&a.keyCode==c.key&&b(c,0)}S&&a.preventDefault();U&&U(a)}function r(a){var c=!1,y=null;D=a.clientX;T=a.clientY;for(var d=0;d<H.length;d++){var q=H[d];50==q.type&&(b(q,1),q.Y=a.which);160==q.type&&(c||(y=x.pick_object(a.clientX,a.clientY),c=!0),
q.value=y==q.Wc?1:0)}W&&a.preventDefault();t&&t(a)}function h(a){for(var c=0;c<H.length;c++){var y=H[c];50==y.type&&b(y,0);160==y.type&&y.Vn&&(y.value=0)}W&&!P&&a.preventDefault();t&&t(a)}function n(a){var c=a.clientX,y=a.clientY;D=c;T=y;for(var d=c-K,q=y-R,e=Math.sqrt(d*d+q*q),f=0;f<H.length;f++){var k=H[f];if(40===k.type)switch(k.axis){case "X":b(k,d);k.Y=c;break;case "Y":b(k,q);k.Y=y;break;case "XY":b(k,e),k.Y[0]=c,k.Y[1]=y}}W&&!P&&a.preventDefault();t&&t(a)}function m(a){var t=a.wheelDelta||-40*
a.detail,t=t*M.Fx;J+=t;for(t=0;t<H.length;t++){var c=H[t];30===c.type&&b(c,J)}ja&&a.preventDefault();V&&V(a)}function s(a){var b=a.targetTouches;if(1==b.length){for(var t=b[0],b=t.pageX,t=t.pageY,c=!1,y=null,d=0;d<H.length;d++){var q=H[d];160==q.type&&(c||(y=x.pick_object(b,t),c=!0),q.value=y==q.Wc)}O[0]=b;O[1]=-1;aa[0]=t;aa[1]=-1}else 1<b.length&&(w=ga=u(b),O[0]=b[0].pageX,O[1]=b[1].pageX,aa[0]=b[0].pageY,aa[1]=b[1].pageY);N.set(O);ca.set(aa);oa&&oa(a)}function B(t){var c=t.targetTouches;if(0!==
c.length){if(1===c.length){N[0]=c[0].pageX;N[1]=-1;ca[0]=c[0].pageY;ca[1]=-1;var c=N[0]-O[0],y=ca[0]-aa[0],d=Math.sqrt(c*c+y*y);if(-1!=O[1]&&-1!=aa[1]){var q=N[0]-O[1],e=ca[0]-aa[1],f=Math.sqrt(q*q+e*e);f<d&&(c=q,y=e,d=f)}for(f=0;f<H.length;f++){var D=H[f];if(60===D.type)switch(D.Y=a.PL_SINGLE_TOUCH_MOVE,D.axis){case "X":b(D,c);break;case "Y":b(D,y);break;case "XY":b(D,d)}}}else if(1<c.length){N[0]=c[0].pageX;N[1]=c[1].pageX;ca[0]=c[0].pageY;ca[1]=c[1].pageY;w=u(c);d=w-ga;q=X;q[0]=(N[0]+N[1])/2;q[1]=
(ca[0]+ca[1])/2;e=ba;e[0]=(O[0]+O[1])/2;e[1]=(aa[0]+aa[1])/2;var k,c=q[0],y=q[1],f=e[0],D=e[1];k=Math.sqrt((c-f)*(c-f)+(y-D)*(y-D));for(f=0;f<H.length;f++)if(D=H[f],70===D.type&&Math.abs(k)<Math.abs(d)&&(D.Y=a.PL_MULTITOUCH_MOVE_ZOOM,b(D,d)),60===D.type&&Math.abs(k)>Math.abs(d))switch(D.Y=a.PL_MULTITOUCH_MOVE_PAN,D.axis){case "X":c=q[0]-e[0];b(D,c);break;case "Y":y=q[1]-e[1];b(D,y);break;case "XY":b(D,k)}}qa&&t.preventDefault();oa&&oa(t)}}function z(a){for(var t=0;t<H.length;t++){var c=H[t];if(170==
c.type||180==c.type)c.wj=a.beta,c.xj=a.gamma,c.vj=a.alpha,c.value||(c.Ll=a.gamma,c.Kl=a.beta,c.Jl=a.alpha,b(c,1))}}function u(a){var b=a[0],t=a[1];a=b.pageX;var b=b.pageY,c=t.pageX,t=t.pageY;return Math.sqrt((a-c)*(a-c)+(b-t)*(b-t))}var q=p("__config"),F=p("__print"),k=p("__physics"),x=p("__scenes"),v=p("__time"),G=p("__util"),A=p("vec3"),C=p("quat"),M=q.controls,y=q.p,I=[],H=[],Y={},J=0,D=0,T=0,K=0,R=0,N=new Float32Array(2),ca=new Float32Array(2),O=new Float32Array(2),aa=new Float32Array(2),X=new Float32Array(2),
ba=new Float32Array(2),w=0,ga=0,ka=!1,L=0,S=!1,W=!1,ja=!1,qa=!1,P=!1,U=null,t=null,V=null,oa=null;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.update=function(t,c){for(var y=0;y<H.length;y++){var d=H[y],q=t,e=c;if(e)switch(d.type){case 110:var f=d.Wc,k=f.d.g,f=f.d.quat,P=A.dist(d.gh,k),W=d.Tq;C.invert(d.ak,W);C.multiply(f,W,W);C.normalize(W,W);W=Math.abs(2*Math.acos(W[3]));P/=e;d.Ti=G.smooth(P,d.Ti,
e,.3);d.Y[0]=P;P=W/e;d.Si=G.smooth(P,d.Si,e,.3);d.Y[1]=P;d.Ti>=d.threshold||d.Si>=d.br?b(d,1):b(d,0);A.copy(k,d.gh);C.copy(f,d.ak);d.jc=q;break;case 120:f=d.Wc;k=f.d.g;f=Math.abs(k[1]-d.gh[1])/e;d.Ui=G.smooth(f,d.Ui,e,.3);d.Y=f;d.Ui>=d.threshold?b(d,1):b(d,0);A.copy(k,d.gh);d.jc=q;break;case 130:!d.zc&&0<=d.sc&&q-d.jc>=d.sc&&(b(d,1),d.repeat?d.jc=q:d.sc=-d.sc);break;case 140:d.jc||(d.jc=q);b(d,q-d.jc);d.jc=q;break;case 150:b(d,q);break;case 170:d.Y[0]=Math.PI*(d.xj-d.Ll)/180;d.Y[1]=Math.PI*(d.wj-
d.Kl)/180;d.Y[2]=Math.PI*(d.vj-d.Jl)/180;d.Ll=d.xj;d.Kl=d.wj;d.Jl=d.vj;break;case 180:d.Y[0]=Math.PI*d.xj/180,d.Y[1]=Math.PI*d.wj/180,d.Y[2]=Math.PI*d.vj/180}}for(y=0;y<I.length;y++)for(e=I[y],d=e.Se,q=0;q<d.length;q++)if(k=d[q],k.Qr!=L){k.Qr=L;for(var f=k,P=f.Tc,W=f.zy,m=0;m<P.length;m++)W[m]=P[m].value;var f=f.sx(W),P=k,W=P.aq,g=m=void 0;switch(P.type){case a.CT_CONTINUOUS:f?g=m=1:1==W?g=m=-1:m=0;break;case a.CT_TRIGGER:f&&-1==W?g=m=1:f||1!=W?m=0:g=m=-1;break;case a.CT_SHOT:f&&-1==W?g=m=1:f||1!=
W?m=0:(m=0,g=-1);break;case a.CT_LEVEL:m=P.$p!=f?1:0;break;default:G.ga("Wrong sensor manifold type: "+P.type)}g&&(P.aq=g);if(P=m)if(W=e==Y?null:e,ka=!1,k.callback(W,k.id,P,k.nu),k.$p=f,ka){y=-1;break}}for(y=0;y<I.length;y++)for(e=I[y],d=e.Se,q=0;q<d.length;q++)for(k=d[q],e=k.Tc,k=0;k<e.length;k++)switch(f=e[k],f.type){case 30:b(f,0);break;case 40:b(f,0);break;case 60:b(f,0);break;case 70:b(f,0);break;case 130:b(f,0)}J=0;K=D;R=T;O.set(N);aa.set(ca);ga=w;L++};a.create_custom_sensor=function(a){var t=
c(10);b(t,a);return t};a.create_keyboard_sensor=function(a){var b=c(20);b.key=a;return b};a.create_collision_sensor=function(a,t,d){if(!a||!a.l)return F.error("Wrong collision object"),null;var y=c(80);y.Zk=a;y.Zb=t||"ANY";y.jm=d;y.Yk=function(a,t){b(y,a);a&&t&&d&&(y.Y=y.Y||new Float32Array(3),y.Y[0]=t[0],y.Y[1]=t[1],y.Y[2]=t[2])};y.zc=!0;return y};a.create_collision_impulse_sensor=function(a){if(!a||!a.l)return F.error("Wrong collision impulse object"),null;var t=c(90);t.Xk=a;t.xo=function(a){b(t,
a)};t.zc=!0;return t};a.create_ray_sensor=function(a,t,d,y,q){if(!a)return F.error("Wrong collision object"),null;var e=c(100);e.Wc=a;e.Pm=t;e.pl=d;e.$l=y;e.Zb=q||"ANY";e.Vq=function(a,t){b(e,a);a&&(e.Y=t)};e.zc=!0;return e};a.create_mouse_click_sensor=function(){return c(50)};a.create_mouse_wheel_sensor=function(){return c(30)};a.create_mouse_move_sensor=function(a){var b=c(40);b.axis=a||"XY";b.Y="XY"==b.axis?new Float32Array(2):0;return b};a.create_touch_move_sensor=function(a){var b=c(60);b.axis=
a||"XY";b.Y=0;return b};a.create_touch_zoom_sensor=function(){var a=c(70);a.Y=0;return a};a.create_motion_sensor=function(a,b,t){if(!a)return F.error("Wrong collision object"),null;var d=c(110);d.Wc=a;var y=a.d.g;a=a.d.quat;d.Tq=new Float32Array(4);d.gh=new Float32Array(y);d.ak=new Float32Array(a);d.Ti=0;d.Si=0;d.threshold=b;d.br=t;d.jc=0;d.Y=new Float32Array([0,0]);return d};a.create_vertical_velocity_sensor=function(a,b){if(!a)return F.error("Wrong collision object"),null;var t=c(120);t.Wc=a;var d=
a.d.quat;t.gh=new Float32Array(a.d.g);t.ak=new Float32Array(d);t.Ui=0;t.threshold=b;t.jc=0;t.Y=0;return t};a.create_timer_sensor=function(a,b){var t=c(130);t.sc=a;t.repeat=b;t.zc=!0;return t};a.reset_timer_sensor=function(a,b,t,c){a=a||Y;a=a.Ic;if(!a||!a[b])return F.error("reset_timer_sensor(): wrong object"),null;b=a[b].Tc[t];if(!b)return F.error("reset_timer_sensor(): sensor not found"),null;b.jc=v.wg();b.sc=c};a.create_elapsed_sensor=function(){var a=c(140);a.jc=0;return a};a.create_gyro_delta_sensor=
function(){var a=c(170);a.Y=new Float32Array(3);return a};a.create_gyro_angles_sensor=function(){var a=c(180);a.Y=new Float32Array(3);return a};a.create_timeline_sensor=function(){return c(150)};a.create_selection_sensor=function(a,b){var t=c(160);t.Wc=a;t.Vn=b;return t};a.yy=b;a.get_sensor_value=function(a,b,t){a=a||Y;a=a.Ic;if(!a||!a[b])return F.error("get_sensor_value(): wrong object"),null;b=a[b].Tc[t];return b?b.value:(F.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=
function(a,b,t){a=a||Y;a=a.Ic;if(!a||!a[b])return F.error("get_sensor_payload(): wrong object"),null;b=a[b].Tc[t];return b?b.Y:(F.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){I=[];H=[];Y={}};a.check_sensor_manifold=function(a,b){a=a||Y;if(!a.Ic)return!1;if(b&&a.Ic[b])return!0;if(!b)for(var t in a.Ic)return!0;return!1};a.remove_sensor_manifold=function(a,b){a=a||Y;var t=a.Ic;if(t){var c=a.Se;if(b){var y=t[b];if(y){for(var q=y.Tc,f=0;f<q.length;f++)1===d(q[f],I)&&l(q[f],
H);delete t[b];y=c.indexOf(y);-1<y?c.splice(y,1):G.ga("Incorrect manifolds array");Object.getOwnPropertyNames(t).length||e(a)}}else{for(b in t){y=t[b];q=y.Tc;for(f=0;f<q.length;f++)1===d(q[f],I)&&l(q[f],H);delete t[b];y=c.indexOf(y);-1<y?c.splice(y,1):G.ga("Incorrect manifolds array")}e(a);ka=!0}}};a.create_sensor_manifold=function(a,b,t,c,y,q,e){a=a||Y;a.Ic=a.Ic||{};a.Se=a.Se||[];var f=a.Ic,D=a.Se,P=f[b];if(P){c=P.Tc;for(var W=0;W<c.length;W++)1===d(c[W],I)&&l(c[W],H);P=D.indexOf(P);-1<P?D.splice(P,
1):G.ga("Incorrect manifolds array")}t={id:b,type:t,Tc:c.slice(0),sx:y,zy:Array(c.length),callback:q,nu:e,aq:-1,$p:0,Qr:-1};f[b]=t;D.push(t);-1==I.indexOf(a)&&I.push(a);a=t.Tc;for(b=0;b<a.length;b++){f=a[b];if(f.zc){switch(f.type){case 80:k.append_collision_test(f.Zk,f.Zb,f.Yk,f.jm);break;case 90:k.apply_collision_impulse_test(f.Xk,f.xo);break;case 100:k.append_ray_test(f.Wc,f.Zb,f.Pm,f.pl,f.$l,f.Vq);break;case 130:f.jc=v.wg(),0>f.sc&&(f.sc=-f.sc)}f.zc=!1}-1==H.indexOf(f)&&H.push(f)}ka=!0};a.ml=function(a){for(var b=
0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.rv=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<I.length;a++){var b=I[a],t=b.Ic,b=b.Se,c;for(c in t)delete t[c];b.splice(0,b.length)}for(a=0;a<H.length;a++)l(H[a],H),a--;I.splice(0,I.length)};a.debug=function(){F.log(String(I.length)+" objects with manifolds",I);F.log(String(H.length)+" sensors",H);for(var a=[],b=[],t=0;t<H.length;t++){var c=H[t];80==c.type&&a.push(c);
100==c.type&&b.push(c)}F.log(String(a.length)+" collision sensors",a);F.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",g,!1);a.addEventListener("keyup",f,!1);S=b};a.register_mouse_events=function(a,b,t){if(t)var c=window;else c=a,c.addEventListener("mouseout",h,!1);a.addEventListener("mousedown",r,!1);c.addEventListener("mousemove",n,!1);c.addEventListener("mouseup",h,!1);W=b;P=t};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",
m,!1);a.addEventListener("DOMMouseScroll",m,!1);ja=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",s,!1);a.addEventListener("touchmove",B,!1);document.addEventListener("touchstart",function(){});qa=b};a.register_device_orientation=function(){window.DeviceOrientationEvent&&y.yj&&window.addEventListener("deviceorientation",z,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",g,!1);a.removeEventListener("keyup",f,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",
r,!1);a.removeEventListener("mousemove",n,!1);a.removeEventListener("mouseout",h,!1);a.removeEventListener("mouseup",h,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",m,!1);a.removeEventListener("DOMMouseScroll",m,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",s,!1);a.removeEventListener("touchmove",B,!1);document.removeEventListener("touchstart",function(){})};a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&y.yj&&
window.removeEventListener("deviceorientation",z,!1)};a.SA=function(a){U=a};a.TA=function(a){t=a};a.VA=function(a){V=a};a.UA=function(a){oa=a}};b4w.module.__curve=function(a,p){function c(a,b,c,d,e){var n=d.length;e||(e=new Float32Array(n));for(var m=n+a,s=new Float32Array(m),B=1;B<=m-1;B++)s[B-1]=b>=c[B-1]&&b<c[B+1-1]?1:0;for(var z=2;z<=a;z++)for(B=1;B<=m-z;B++)s[B-1]=(0!=s[B-1]?(b-c[B-1])*s[B-1]/(c[B+z-1-1]-c[B-1]):0)+(0!=s[B+1-1]?(c[B+z-1]-b)*s[B+1-1]/(c[B+z-1]-c[B+1-1]):0);b==c[m-1]&&(s[n-1]=1);a=0;for(B=1;B<=n;B++)a+=s[B-1]*d[B-1];for(B=1;B<=n;B++)e[B-1]=0!=a?s[B-1]*d[B-1]/a:0;return e}function b(a){a=a.Ij;return a[a.length-1]}function e(a){a=
a.Mo;return a[a.length-1]}var d=p("__util");a.dv=function(a){var b={},d=a.data;a=d.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var e=a.order_u;b.te=e;a=a.points;var h=a.length/5,n=[],m=h+e,h=h+2;n[0]=0;for(var s=2;s<=m;s++)n[s-1]=s>e&&s<h?n[s-2]+1:n[s-2];b.Ij=n;if("2D"==d.dimensions)b.oe=!1;else if("3D"==d.dimensions)b.oe=!0;else throw"Wrong curve dimensions";e=[];n=[];for(d=0;d<a.length;d+=5)e.push(a[d]),e.push(a[d+1]),e.push(a[d+2]),b.oe&&e.push(a[d+3]),n.push(a[d+4]);b.bl=
e;b.on=n;a=[];for(var d=b.bl,e=b.oe?4:3,n=b.on,m=b.Ij,h=b.te,s=d.length/e,B=s+h,z=0,u=m[B-1]/999,q=0;1E3>q;q++){5E-6>m[B-1]-z&&(z=m[B-1]);for(var F=c(h,z,m,n),k=0;k<e;k++)for(var x=a[e*q+k]=0;x<s;x++)a[e*q+k]+=F[x]*d[e*x+k];z+=u}e=b.oe?4:3;n=new Float32Array(1E3);n[0]=0;for(d=1;1E3>d;d+=1)m=a[(d-1)*e],h=a[(d-1)*e+1],s=a[(d-1)*e+2],B=a[d*e],z=a[d*e+1],u=a[d*e+2],n[d]=n[d-1]+Math.sqrt((B-m)*(B-m)+(z-h)*(z-h)+(u-s)*(u-s));b.Mo=n;return b};a.lz=function(a,d,e){e||(e=[]);var r=d,h=Math.max(r,0);d=h=Math.min(r,
b(a));var r=a.bl,h=a.oe?4:3,n=a.on,m=a.Ij,s=a.te;a=r.length/h;var B=a+s;5E-6>m[B-1]-d&&(d=m[B-1]);B=new Float32Array(a);c(s,d,m,n,B);for(d=0;d<h;d++)for(n=e[d]=0;n<a;n++)e[d]+=B[n]*r[h*n+d]};a.iz=function(a,b,c){c||(c=[]);var d=a.bl,e=a.oe?4:3,n=a.on,m=a.Ij,s=a.te;a=d.length/e;var B=a+s;5E-6>m[B-1]-b&&(b=m[B-1]);var B=new Float32Array(a),z=b;b=B;var u=n.length;b||(b=new Float32Array(u));var q=new Float32Array(u),F=new Float32Array(u),k=q,x=F;k||(k=new Float32Array(u));x||(x=new Float32Array(u));for(var v=
u+s,G=new Float32Array(v),A=new Float32Array(v),C=1;C<=v-1;C++)G[C-1]=z>=m[C-1]&&z<m[C+1-1]?1:0;z==m[v-1]&&(G[u-1]=1);for(var M=2;M<=s;M++)for(C=1;C<=v-M;C++){var y=0!=G[C-1]?G[C-1]/(m[C+M-1-1]-m[C-1]):0,I=0!=G[C+1-1]?-G[C+1-1]/(m[C+M-1]-m[C+1-1]):0,H=0!=A[C-1]?(z-m[C-1])*A[C-1]/(m[C+M-1-1]-m[C-1]):0,Y=0!=A[C+1-1]?(m[C+M-1]-z)*A[C+1-1]/(m[C+M-1]-m[C+1-1]):0;G[C-1]=(0!=G[C-1]?(z-m[C-1])*G[C-1]/(m[C+M-1-1]-m[C-1]):0)+(0!=G[C+1-1]?(m[C+M-1]-z)*G[C+1-1]/(m[C+M-1]-m[C+1-1]):0);A[C-1]=y+I+H+Y}for(C=1;C<=
u;C++)k[C-1]=G[C-1],x[C-1]=A[C-1];m=0;for(s=1;s<=u;s++)m+=q[s-1]*n[s-1];z=0;for(s=1;s<=u;s++)z+=F[s-1]*n[s-1];for(s=1;s<=u;s++)b[s-1]=0!=m?F[s-1]*n[s-1]/m+q[s-1]*n[s-1]*z/(m*m):0;for(n=0;n<e;n++)for(m=c[n]=0;m<a;m++)c[n]+=B[m]*d[e*m+n]};a.OC=b;a.kz=e;a.jz=function(a,c){if(0>=c)return 0;var f=b(a);if(c>=e(a))return f;var r=a.Mo,h=d.Wi(r,c,0,r.length-1);return f*(h+(c-r[h])/(r[h+1]-r[h]))/1E3}};b4w.module.__dds=function(a,p){function c(a,b,c,d){var e=new Uint16Array(4),f=new Uint16Array(c*d),q=0,h=0,k=0,g=h=q=0,l=0,r=0,A=0,C=c/4;d/=4;for(var M=0;M<d;M++)for(var y=0;y<C;y++)k=b+4*(M*C+y),e[0]=a[k],e[1]=a[k+1],q=e[0]&31,h=e[0]&2016,g=e[0]&63488,l=e[1]&31,r=e[1]&2016,A=e[1]&63488,e[2]=5*q+3*l>>3|5*h+3*r>>3&2016|5*g+3*A>>3&63488,e[3]=5*l+3*q>>3|5*r+3*h>>3&2016|5*A+3*g>>3&63488,q=a[k+2],h=4*M*c+4*y,f[h]=e[q&3],f[h+1]=e[q>>2&3],f[h+2]=e[q>>4&3],f[h+3]=e[q>>6&3],h+=c,f[h]=e[q>>8&3],f[h+1]=e[q>>
10&3],f[h+2]=e[q>>12&3],f[h+3]=e[q>>14],q=a[k+3],h+=c,f[h]=e[q&3],f[h+1]=e[q>>2&3],f[h+2]=e[q>>4&3],f[h+3]=e[q>>6&3],h+=c,f[h]=e[q>>8&3],f[h+1]=e[q>>10&3],f[h+2]=e[q>>12&3],f[h+3]=e[q>>14];return f}function b(a,b,d,e){var z=new Int32Array(d,0,31),u,q,F,k,x,v;if(542327876!=z[0])return g.error("Invalid magic number in DDS header"),0;if(!z[20]&4)return g.error("Unsupported format, must contain a FourCC code"),0;u=z[21];switch(u){case f:q=8;F=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case r:q=16;F=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case h:q=16;F=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return g.error("Unsupported FourCC code:",l(u)),null}v=1;z[2]&131072&&!1!==e&&(v=Math.max(1,z[7]));k=z[4];x=z[3];z=z[1]+4;if(b)for(u=0;u<v;++u)e=Math.max(4,k)/4*Math.max(4,x)/4*q,b=new Uint8Array(d,z,e),a.compressedTexImage2D(a.TEXTURE_2D,u,F,k,x,0,b),z+=e,k=Math.max(.5*k,1),x=Math.max(.5*x,1);else if(u==f)Math.max(4,k),Math.max(4,x),b=new Uint16Array(d),d=c(b,z/2,k,x),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,k,x,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,d),e&&a.generateMipmap(a.TEXTURE_2D);else return g.error("No manual decoder for",l(u),"and no native support"),0;return v}function e(a,c,d,e,f,h){var q=new XMLHttpRequest;q.open("GET",d,!0);q.responseType="arraybuffer";q.onload=function(){if(200==q.status){a.bindTexture(a.TEXTURE_2D,e);var d=b(a,c,q.response,f);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}h&&
h(e)};q.send(null);return e}function d(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function l(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var g=p("__print"),f=d("DXT1"),r=d("DXT3"),h=d("DXT5");a.tB=c;a.$z=b;a.Bp=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.ww=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case f:b=6;break;case r:case h:b=4;break;default:g.error("Unsupported FourCC code:",l(a))}return b};
a.sC=e;a.rC=function(a,b,c,d){var f=a.createTexture();e(a,b,c,f,!0,d);return f}};b4w.module.__debug=function(a,p){function c(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function b(a,b){typeof a!=typeof b&&g.ga("Structure assertion failed: incompatible types");for(var c in a)c in b||g.ga("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||g.ga("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&g.ga("Structure assertion failed: incompatible types for key "+c)}var e=
p("__extensions"),d=p("__print"),l=p("__textures"),g=p("__util"),f=null,r={},h=!1,n={},m=[],s=-1,B=null,z=!1;a.An={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.fc=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(r[a[d]]=d)}f=a};a.uu=function(a){if(h){var b=f.getError();if(b!=f.NO_ERROR){if(b in r)throw"B4W Error: "+b+", gl."+r[b]+
" ("+a+")";throw"Unknown GL error: "+b+" ("+a+")";}}};a.ru=function(){if(h)switch(f.checkFramebufferStatus(f.FRAMEBUFFER)){case f.FRAMEBUFFER_COMPLETE:break;case f.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case f.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case f.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case f.FRAMEBUFFER_UNSUPPORTED:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:d.error("B4W Error: FRAMEBUFFER CHECK FAILED")}};a.no=function(){if(-1!=s)return s;f.bindFramebuffer(f.FRAMEBUFFER,f.createFramebuffer());var a=l.hj("DEBUG",l.qh);l.resize(a,1,1);f.framebufferTexture2D(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,a.Ib,a.La,0);f.checkFramebufferStatus(f.FRAMEBUFFER)!=f.FRAMEBUFFER_COMPLETE?(s=!0,d.warn("B4W warning: depth-only issue was found")):s=!1;f.bindFramebuffer(f.FRAMEBUFFER,
null);return s};a.vu=function(a,b,e){if(h&&!f.getShaderParameter(a,f.COMPILE_STATUS))throw e=c(e),d.error("B4W Error: shader compilation failed:\n"+e+"\n"+f.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.wu=function(a,b,k,m,g,l){if(h&&!f.getProgramParameter(a,f.LINK_STATUS)){var A=e.qp();A&&(g=A.getTranslatedShaderSource(k),l=A.getTranslatedShaderSource(m));g=c(g);l=c(l);d.error("B4W Error: shader linking failed:\n"+g+"\n\n\n"+l+"\n"+f.getProgramInfoLog(a)+" ("+
b+")");throw"Engine failed: see above for error messages";}};a.set_check_gl_errors=function(a){h=a};a.uB=function(a){n[a]=a in n?n[a]+1:1};a.update=function(){for(var a in n)d.log(a,n[a]),n[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(g.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}m.push(a)};a.msg=function(){for(var a=1,b=0;b<m.length;b++){var c=m[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=
arguments[b],g.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);m.push(c)};var u=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},e=Math.max(0,performance.now()-1E3*a),f=0;f<m.length;f++){var h=m[f];a=h[0];if(!(a<e)){var g=String(h[1]);c[g]||(c[g]=u[b++%u.length]);a=["%c"+(a/1E3).toFixed(6),c[g],g];for(g=2;g<h.length;g++)a.push(h[g]);d.log.apply(this,a)}}m.splice(0)};a.plot_telemetry=
function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-1E3*a),e=0;e<m.length;e++){var f=m[e];a=f[0];if(!(a<c))for(var h=2;h<f.length;h++){var g=String(f[1]);3<f.length&&(g+="_"+String(h-2));b[g]||(b[g]=g+"\n");b[g]+=String(a)+" "+f[h]+"\n"}}a="";for(g in b)a+=b[g]+"\n\n";d.log(a);m.splice(0)};a.aB=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&
b("gecko")&&b("firefox");case "msie":return b("mozilla")&&b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(g.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.RA=function(a,b){typeof a!=b&&g.ga("Type assertion failed: value type is not a {"+b+"}:",a)};a.PA=b;a.QA=function(a){z?b(a,
B):z=!0;B=a}};b4w.module.__extensions=function(a,p){function c(a){if(a in d)return d[a];var c=e.getExtension(a)||null;d[a]=c;b.log("%cGET EXTENSION","color: #"+(c?"0a0":"a00"),a);return c}var b=p("__print"),e=null,d={};a.fc=function(a){e=a};a.yp=function(){return c("WEBGL_compressed_texture_s3tc")||c("WEBKIT_WEBGL_compressed_texture_s3tc")||c("MOZ_WEBGL_compressed_texture_s3tc")};a.zw=function(){return c("WEBGL_depth_texture")||c("WEBKIT_WEBGL_depth_texture")||c("MOZ_WEBGL_depth_texture")};a.pw=function(){return c("EXT_texture_filter_anisotropic")||
c("WEBKIT_EXT_texture_filter_anisotropic")||c("MOZ_EXT_texture_filter_anisotropic")};a.qp=function(){return c("WEBGL_debug_shaders")};a.xp=function(){return c("WEBGL_debug_renderer_info")};a.rp=function(){return c("OES_element_index_uint")};a.Kw=function(){return c("OES_standard_derivatives")};a.cleanup=function(){d={}}};b4w.module.__graph=function(a){function p(a,b,d){d||(d=null);if(c(a,b))throw"Graph already has node with given ID";a.Fa.push(b,d)}function c(a,b){for(var c=a.Fa,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function b(a,b,d,e){e||(e=null);if(c(a,b)&&c(a,d))a.ta.push(b,d,e);else throw"Wrong node IDs";}function e(a,b){if(!c(a,b))throw"Node not found";for(var d=a.Fa,e=0;e<d.length;e+=2)d[e]==b&&(d.splice(e,2),e-=2)}function d(a){a=a.Fa;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}
function l(a,b){for(var c=a.Fa,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function g(a){var b=[],c={};f(a,c);for(var d=a.Fa,e=0;e<d.length;e+=2)0==F(a,d[e])&&r(a,d[e],c,b);return{Fa:b,ta:a.ta.slice(0)}}function f(a,b){for(var c=a.Fa,d=0;d<c.length;d+=2)b[c[d]]=!1}function r(a,b,c,d){if(!c[b]){c[b]=!0;for(var e=0;e<q(a,b);e++)r(a,k(a,b,e),c,d);d.unshift(b,u(a,b))}}function h(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var e=0;e<q(a,b);e++){var f=k(a,b,e);h(a,f,c,d)}if(20==d||30==d)for(e=
0;e<F(a,b);e++)f=x(a,b,e),h(a,f,c,d)}}function n(a){var b=a.Fa;a=a.ta;for(var c=[],d=[],e=[],f=0;f<b.length;f++)e[b[2*f]]=f,c.push(f,b[2*f+1]);for(f=0;f<a.length;f+=3)d.push(e[a[f]],e[a[f+1]],a[f+2]);return{Fa:c,ta:d}}function m(a,b,c){if(c.Lc==c.se){for(var d=0,e=0;d<c.se;d++)-1!=c.sd[d]&&(a[e]=d,b[e]=c.sd[d],e++);return!0}if(c.se>c.Gg||c.He>c.Ie||c.bh>c.eh||c.ah>c.dh)return!1;for(var e=d=-1,f=!1;!f&&s(c,M,d,e);)if(d=M[0],e=M[1],B(c,d,e)){var h;h=c;f={};f.Nh=h.Nh;f.Oh=h.Oh;f.lm=h.lm;f.nj=h.nj;f.se=
h.se;f.Gg=h.Gg;f.te=h.te;f.Lc=f.Sj=h.Lc;f.ah=h.ah;f.bh=h.bh;f.He=h.He;f.dh=h.dh;f.eh=h.eh;f.Ie=h.Ie;f.vh=-1;f.sd=h.sd;f.df=h.df;f.qf=h.qf;f.rf=h.rf;f.Lf=h.Lf;f.Mf=h.Mf;f.fk=h.fk;h.fk[0]+=1;var f=h=f,g=d,C=e,l=f.Nh,n=f.Oh,A=f.se,r=f.Gg,u=f.sd,v=f.df,w=f.qf,G=f.rf,p=f.Lf,L=f.Mf;z(g<A);z(C<r);z(f.Lc<A);z(f.Lc<r);A=++f.Lc;f.vh=g;w[g]||(w[g]=A,f.ah++,p[g]&&f.He++);p[g]||(p[g]=A,f.bh++,w[g]&&f.He++);G[C]||(G[C]=A,f.dh++,L[C]&&f.Ie++);L[C]||(L[C]=A,f.eh++,G[C]&&f.Ie++);u[g]=C;v[C]=g;for(u=0;u<F(l,g);u++)v=
x(l,g,u),w[v]||(w[v]=A,f.ah++,p[v]&&f.He++);for(u=0;u<q(l,g);u++)v=k(l,g,u),p[v]||(p[v]=A,f.bh++,w[v]&&f.He++);for(u=0;u<F(n,C);u++)v=x(n,C,u),G[v]||(G[v]=A,f.dh++,L[v]&&f.Ie++);for(u=0;u<q(n,C);u++)v=k(n,C,u),L[v]||(L[v]=A,f.eh++,G[v]&&f.Ie++);f=m(a,b,h);z(1>=h.Lc-h.Sj);z(-1!=h.vh);v=h.Nh;g=h.Oh;C=h.Lc;l=h.vh;n=h.sd;w=h.df;A=h.qf;G=h.rf;r=h.Lf;p=h.Mf;if(h.Sj<C){A[l]==C&&(A[l]=0);for(L=0;L<F(v,l);L++)u=x(v,l,L),A[u]==C&&(A[u]=0);r[l]==C&&(r[l]=0);for(L=0;L<q(v,l);L++)u=k(v,l,L),r[u]==C&&(r[u]=0);
v=n[l];G[v]==C&&(G[v]=0);for(L=0;L<F(g,v);L++)u=x(g,v,L),G[u]==C&&(G[u]=0);p[v]==C&&(p[v]=0);for(L=0;L<q(g,v);L++)u=k(g,v,L),p[u]==C&&(p[u]=0);n[l]=-1;w[v]=-1;h.Lc=h.Sj;h.vh=-1}}return f}function s(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var e=a.He,f=a.Ie,q=a.bh,k=a.eh,h=a.ah,g=a.dh,m=a.Lc,C=a.se,l=a.Gg,n=a.sd,A=a.df,M=a.qf,u=a.rf,r=a.Lf,s=a.Mf;if(e>m&&f>m)for(;c<C&&(-1!=n[c]||0==r[c]||0==M[c]);)c++,d=0;else if(q>m&&k>m)for(;c<C&&(-1!=n[c]||0==r[c]);)c++,d=0;else if(h>m&&g>m)for(;c<C&&(-1!=n[c]||0==M[c]);)c++,
d=0;else if(0==c&&0!=a.te){for(M=0;M<C&&-1!=n[c=a.te[M]];)M++;M==C&&(c=C)}else for(;c<C&&-1!=n[c];)c++,d=0;if(e>m&&f>m)for(;d<l&&(-1!=A[d]||0==s[d]||0==u[d]);)d++;else if(q>m&&k>m)for(;d<l&&(-1!=A[d]||0==s[d]);)d++;else if(h>m&&g>m)for(;d<l&&(-1!=A[d]||0==u[d]);)d++;else for(;d<l&&-1!=A[d];)d++;return c<C&&d<l?(b[0]=c,b[1]=d,!0):!1}function B(a,b,c){var d=a.Nh,e=a.Oh,f=a.Gg,h=a.sd,m=a.df,g=a.qf,C=a.rf,l=a.Lf,n=a.Mf;z(b<a.se);z(c<f);z(-1==h[b]);z(-1==m[c]);if(!(0,a.lm)(u(d,b),u(e,c)))return!1;for(var A=
f=0,M=0,r=0,s=0,B=0,p=0;p<q(d,b);p++){var L=k(d,b,p);if(-1!=h[L]){var S=h[L];if(!v(e,c,S)||!G(a.nj,d,b,L,e,c,S))return!1}else g[L]&&M++,l[L]&&f++,g[L]||l[L]||s++}for(p=0;p<F(d,b);p++)if(L=x(d,b,p),-1!=h[L]){if(S=h[L],!v(e,S,c)||!G(a.nj,d,L,b,e,S,c))return!1}else g[L]&&M++,l[L]&&f++,g[L]||l[L]||s++;for(p=0;p<q(e,c);p++)if(S=k(e,c,p),-1!=m[S]){if(L=m[S],!v(d,b,L))return!1}else C[S]&&r++,n[S]&&A++,C[S]||n[S]||B++;for(p=0;p<F(e,c);p++)if(S=x(e,c,p),-1!=m[S]){if(L=m[S],!v(d,L,b))return!1}else C[S]&&r++,
n[S]&&A++,C[S]||n[S]||B++;return M<=r&&f<=A&&s<=B}function z(a){if(!a)throw"Assertion failed";}function u(a,b){for(var c=a.Fa,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function q(a,b){for(var c=a.ta,d=0,e=0;e<c.length;e+=3)c[e]==b&&d++;return d}function F(a,b){for(var c=a.ta,d=0,e=0;e<c.length;e+=3)c[e+1]==b&&d++;return d}function k(a,b,c){a=a.ta;for(var d=0,e=0;e<a.length;e+=3)if(a[e]==b){if(d==c)return a[e+1];d++}return-1}function x(a,b,c){a=a.ta;for(var d=0,e=0;e<a.length;e+=3)if(a[e+
1]==b){if(d==c)return a[e];d++}return-1}function v(a,b,c){a=a.ta;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function G(a,b,c,d,e,f,q){for(var k=A(b,c,d),h=A(e,f,q),m=0;m<k;m++){for(var g=!1,l=0;l<h;l++)if(a(C(b,c,d,m),C(e,f,q,l))){g=!0;break}if(!g)return!1}return!0}function A(a,b,c){var d=0;a=a.ta;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&d++;return d}function C(a,b,c,d){a=a.ta;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(e==d)return a[f+2];e++}return null}
var M=[-1,-1];a.wn=-1;a.FA=10;a.rn=20;a.IA=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var e=a[d];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:c.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";}}return{Fa:b,ta:c}};a.lB=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c.push(a[e][0],a[e][1]);for(e=0;e<b.length;e++)d.push(b[e][0],b[e][1],b[e][2]);return{Fa:c,ta:d}};a.Gk=p;a.XB=c;a.ae=b;a.Lg=e;a.Kg=function(a,b,c,d){if(!v(a,b,c))throw"Edge not found";
a=a.ta;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(-1==d)a.splice(f,3);else{if(d==e){a.splice(f,3);break}e++}f-=3}};a.w=function(a,b){if(-1==l(a,b)){var c=d(a);p(a,c,b);return c}throw"Non-unique attribute";};a.ky=function(a,b,c,d,e){a=a.ta;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&a[f+2]==d&&(a[f+2]=e)};a.np=d;a.Hg=l;a.m=function(a,c,d,e){c=l(a,c);d=l(a,d);if(-1!=c&&-1!=d)b(a,c,d,e);else throw"Attributes not found";};a.R=function(a,b){for(var c=a.Fa,d=0;d<c.length&&!b(c[d],c[d+
1]);d+=2);};a.Je=function(a,b){for(var c=a.ta,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.Rd=function(a,b,c){for(var d=a.ta,e=0;e<d.length;e+=3)if(d[e+1]==b){var f=d[e];if(c(f,u(a,f),d[e+2]))break}};a.Ke=function(a,b,c){for(var d=a.ta,e=0;e<d.length;e+=3)if(d[e]==b){var f=d[e+1];if(c(f,u(a,f),d[e+2]))break}};a.Xm=g;a.Bz=function(a){a=g(a).Fa;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.gC=function(){};a.Cr=function(a,b,d){if(!c(a,b))throw"No such node";var e={};f(a,e);h(a,b,e,
d);b=[];for(var q in e)e[q]&&(q=Number(q),b.push(q,u(a,q)));a={Fa:b,ta:a.ta.slice(0)};e=a.ta;for(q=0;q<e.length;q+=3)b=e[q+1],c(a,e[q])&&c(a,b)||(e.splice(q,3),q-=3);return a};a.Jw=function(a){for(var b=[],c=a.Fa,d=0;d<c.length;d+=2){var e=c[d];F(a,e)||b.push(e)}return b};a.Gl=function(a){for(var b=[],c=a.Fa,d=0;d<c.length;d+=2){var e=c[d];q(a,e)||b.push(e)}return b};a.match=function(a,b,c,d){var e={};e.Nh=n(a);e.Oh=n(b);e.lm=c||function(a,b){return a==b};e.nj=d||function(a,b){return a==b};d=a.Fa.length/
2;var f=b.Fa.length/2;e.se=d;e.Gg=f;e.te=0;e.Lc=e.Sj=0;e.He=e.ah=e.bh=0;e.Ie=e.dh=e.eh=0;e.vh=-1;e.sd=Array(d);e.df=Array(f);e.qf=Array(d);e.rf=Array(f);e.Lf=Array(d);e.Mf=Array(f);e.fk=[1];for(c=0;c<d;c++)e.sd[c]=-1,e.qf[c]=0,e.Lf[c]=0;for(c=0;c<f;c++)e.df[c]=-1,e.rf[c]=0,e.Mf[c]=0;f=Array(d);d=Array(d);if(m(f,d,e)){for(c=0;c<f.length;c++)f[c]=a.Fa[2*f[c]],d[c]=b.Fa[2*d[c]];return[f,d]}return null};a.Ra=u;a.Ig=q;a.Op=F;a.vg=k;a.qj=x;a.OB=A;a.ug=C;a.replace=function(a,b,c){for(var f=a.ta,q=d(a),k=
0;k<b.length;k++){var h=b[k];e(a,h);for(var m=0;m<f.length;m+=3)f[m]==h&&(f[m]=q),f[m+1]==h&&(f[m+1]=q),f[m]==f[m+1]&&(f.splice(m,3),m-=3)}p(a,q,c)};a.cy=function(a,b,c,d,e){if(!v(a,b,c))throw"Edge not found";a=a.ta;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&(a[f]=d,a[f+1]=e)};a.mB=function(a,b){var c=a.Fa,d=a.ta,e;e="digraph debug {\n    node [shape=box];\n";for(var f=0;f<c.length;f+=2){var q=c[f],k=c[f+1],k=b?b(q,k):String(q);e+="    ";e+=String(q)+' [label="'+k.replace(/\"/g,'\\"')+'"];\n'}for(f=
0;f<d.length;f+=3)c=d[f],q=d[f+1],e+="    ",e+=String(c)+" -> "+String(q)+";\n";return e+="}"}};b4w.module.__ipc=function(a){var p=a.ls=0;a.ms=1;a.ns=2;a.os=3;a.ps=4;a.qs=5;var c=a.ss=6,b=a.ts=7,e=a.us=8;a.vs=9;a.rs=10;a.Us=11;a.Gc=12;a.ws=13;a.xs=14;a.ys=15;a.As=16;a.zs=17;a.Bs=18;a.Cs=19;a.Ds=20;a.Es=21;a.Fs=22;a.Gs=23;a.Hs=24;a.Is=25;a.Js=26;a.Ks=27;a.Ls=28;a.Ms=29;a.Ns=30;a.Os=31;a.Ps=32;a.Qs=33;a.Ss=34;a.Ts=35;a.Vs=36;a.yn=37;a.Ws=38;a.Xs=39;a.Ys=40;a.Zs=41;a.$s=42;a.at=43;a.bt=44;a.ct=45;a.dt=46;a.et=47;a.ft=48;a.gt=49;a.ht=50;a.zn=51;var d=a.dg=52;a.it=53;a.xn=54;a.jt=55;a.kt=56;a.GA=
57;a.Rs=58;for(var l=null,g=[],f=[],r=[],h=[],n=0;59>n;n++)g.push(null),f.push(null),r.push(null),h.push(null);f[e]={msg_id:0,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3)};f[c]={msg_id:0,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4)};f[b]={msg_id:0,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0};f[p]={msg_id:0,body_id_a:0,body_id_b:0,result:0,
coll_point:new Float32Array(3)};f[d]={msg_id:0,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4)};h[e]=["msg_id",1,"body_id",1,"time",1,"trans",3,"quat",4,"linvel",3,"angvel",3];h[c]=["msg_id",1,"chassis_hull_body_id",1,"prop_ind",1,"trans",3,"quat",4];h[b]=["msg_id",1,"body_id",1,"from",3,"to",3,"local",1,"body_id_b_hit",1,"cur_result",1];h[p]=["msg_id",1,"body_id_a",1,"body_id_b",1,"result",1,"coll_point",3];h[d]=["msg_id",1,"body_id",1,"trans",3,"quat",4];a.init=function(a,b){a.addEventListener("message",
function(a){var c=a.data;a=c[0]|0;if(h[a]){for(var d=f[a],e=h[a],m=0,k=0;k<e.length;k+=2){var g=e[k],l=e[k+1];if(1==l)d[g]="msg_id"==g||"body_id"==g||"body_id_a"==g||"body_id_b"==g?c[m]|0:c[m];else for(var n=0;n<l;n++)d[g][n]=c[m+n];m+=l}c=d}b(a,c)},!1);l=a};a.cleanup=function(){l=null};a.q=function(){var a=arguments[0]|0;if(h[a]){var b=f[a],c=h[a],d=0;if(!r[a]){for(var e=0,q=1;q<c.length;q+=2)e+=c[q];r[a]=new Float32Array(e)}e=r[a];for(q=0;q<c.length;q+=2){var n=b[c[q]],k=c[q+1];1==k?e[d]=n:e.set(n,
d);d+=k}g[a]||(g[a]=e);a=g[a]}else for(b=arguments.length,g[a]||(g[a]=Array(b),g[a][0]=a),a=g[a],c=1;c<b;c++)a[c]=arguments[c];l.postMessage(a)};a.vp=function(a){return f[a]}};b4w.module.__hud=function(a,p){function c(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function b(a){e(' SCENE "'+a.name+'"');if(a.d){var b=0,c=0;f.R(a.d.qb,function(a,d){if("SINK"==d.type)e(" (F)",d.type);else{var f=d.type,q=Math.round(d.j.width)+"x"+Math.round(d.j.height),h=d.o.length,k=d.Dh,g=d.enqueue&&d.U;g?e(" (A)",f,d.Hf,q,k,"of",h):e(" (P)",f,d.Hf,q,k,"of",h);d.Dh=0;g&&(b+=h,c+=k)}});return[b,c]}e("No INFO")}function e(){for(var a=80+20*h[0],b=[5,
18,3,10,4,3,5],c=arguments[0],d=1;d<arguments.length;d++){for(var e="",f=0;f<b[d]-String(arguments[d]).length;f++)e+=" ";c+=e+arguments[d]}h[0]++;r.fillText(c,30,a)}function d(a,b,c){b*=a.va;c.x=a.x+b;c.y=a.y;c.va=a.va-2*b;c.na=a.na}function l(a){return a.x+a.va/2}function g(a){var b=r,c={x:0,y:0,va:0,na:0},e=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.va=e;c.na=b;d(c,.01,c);e=.02*c.na;c.x=c.x;c.y+=e;c.va=c.va;c.na-=2*e;e=c.va/8;c.x+=e*a;c.y=c.y;c.va=e;c.na=c.na;d(c,.02,c);return c}var f=p("__graph"),
r=null,h=[0,0];a.init=function(a){a=a.getContext("2d");c(a);return r=a};a.hh=function(){r&&c(r)};a.reset=function(){var a=r;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),h[0]=0,h[1]=0)};a.Vy=function(a,c){var d=r;if(d){d.textAlign="left";d.fillStyle="rgba(0,255,0,255)";e(" FPS",(1/c).toFixed(2));h[0]++;for(var f=d=0,g=0;g<a.length;g++){var l=b(a[g]),d=d+l[0],f=f+l[1];h[0]++}e(" ---------------------------------------------");
e("    ","TOTAL ACTIVE","","",f,"of",d)}};a.print=function(){var a=r;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",e.apply(Math,arguments))};a.plot_array=function(a,b,c,d,e,f,q){var h=r;if(h){b=g(b);var k=b.na/5;b.x=b.x;b.y+=4*k;b.va=b.va;b.na=k;h.textAlign="center";h.fillStyle="#00FF00";r.fillText(a,l(b),b.y-10);h.strokeStyle="#00FF00";h.lineWidth=.5;h.beginPath();h.moveTo(b.x,b.y);h.lineTo(b.x+b.va,b.y);h.lineTo(b.x+b.va,b.y+b.na);h.lineTo(b.x,b.y+b.na);h.closePath();h.stroke();if(!f&&
!q)for(f=1E6,q=-1E6,a=0;a<c.length;a++)f=Math.min(f,c[a]),q=Math.max(q,c[a]);h.textAlign="right";r.fillText(String(f),b.x-10,b.y+b.na);r.fillText(String(q),b.x-10,b.y);h.textAlign="center";r.fillText(String(d),b.x,b.y+b.na+15);r.fillText(String(e),b.x+b.va,b.y+b.na+15);h.strokeStyle="#FF0000";h.lineWidth=1.5;h.beginPath();d=b.va/(c.length-1);q=b.na/(q-f);for(a=0;a<c.length;a++)e=b.x+d*a,k=b.y+b.na-(c[a]-f)*q,0==a?h.moveTo(e,k):h.lineTo(e,k);h.stroke()}};a.draw_mixer_strip=function(a,b,c,d,e,f,q){var h=
r;if(h)for(h.textAlign="center",h.fillStyle="#00FF00",h.font="bold 12px Courier",c=g(c),r.fillText(b?"["+a+"]":a,l(c),c.y),0<=f&&r.fillText(f?"[M]":"[ ]",l(c)-15,c.y+30),0<=q&&r.fillText(q?"[S]":"[ ]",l(c)+15,c.y+30),a={x:0,y:0,va:0,na:0},b=0;b<d.length;b++){f=d[b];var k="VOLUME"==f[0];if(k){q=c.y+350;var x=c.va,v=a;v.x=c.x;v.y=q;v.va=x;v.na=250}else{q=c.y+10+50*b;var x=c.va,v=c.na,G=a;G.x=c.x;G.y=q;G.va=x;G.na=v}q=h;var x=a,G=b==e,A=f[0],v=f[1],C=f[2],M=f[3],y=(M-C)/f[4],y=1>y?Math.floor(1/y-1E-5).toFixed(0).length:
0;f=f[5]?Math.log(v/C)/Math.log(M/C):(v-C)/(M-C);q.textAlign="center";G?q.fillText("["+A+"]",l(x),x.y):q.fillText(A,l(x),x.y);q.strokeStyle="#00FF00";q.lineWidth=k?3:1;k?(q.textAlign="right",q.fillText(M.toFixed(y),l(x)-10,x.y+15),q.textAlign="right",q.fillText(C.toFixed(y),l(x)-10,x.y+x.na-15)):(q.textAlign="right",q.fillText(C.toFixed(y),x.x+28,x.y+15),q.textAlign="left",q.fillText(M.toFixed(y),x.x+x.va-28,x.y+15));q.beginPath();if(k){var I=x.y+15+(x.na-30)*(1-f);q.moveTo(l(x),x.y+15);q.lineTo(l(x),
x.y+x.na-15);q.moveTo(l(x)-5,x.y+15);q.lineTo(l(x)+5,x.y+15);q.moveTo(l(x)-5,x.y+x.na-15);q.lineTo(l(x)+5,x.y+x.na-15);q.moveTo(l(x)-5,I);q.lineTo(l(x)+5,I)}else{var H=x.x+30+(x.va-60)*f;q.moveTo(x.x+30,x.y+15);q.lineTo(x.x+x.va-30,x.y+15);q.moveTo(x.x+30,x.y+15-5);q.lineTo(x.x+30,x.y+15+5);q.moveTo(x.x+x.va-30,x.y+15-5);q.lineTo(x.x+x.va-30,x.y+15+5);q.moveTo(H,x.y+15-5);q.lineTo(H,x.y+15+5)}q.stroke();"EQ_Q"==A?(f=Math.log(1+1/(2*v*v)+Math.sqrt((2+1/(v*v))*(2+1/(v*v))/4-1))/Math.log(2),k?(q.textAlign=
"left",q.fillText(v.toFixed(y),l(x)+10,I),q.textAlign="left",q.fillText("("+f.toFixed(y+1)+")",l(x)+10,I+10)):(q.textAlign="right",q.fillText(v.toFixed(y),H,x.y+30),q.textAlign="left",q.fillText("("+f.toFixed(y+1)+")",H,x.y+30))):k?(q.textAlign="left",q.fillText(v.toFixed(y),l(x)+10,I)):(q.textAlign="center",q.fillText(v.toFixed(y),H,x.y+30))}}};b4w.module.__renderer=function(a,p){function c(a){if(a){var b=(a.fa?z.COLOR_BUFFER_BIT:0)|(a.ja?z.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=n;break;case "DEPTH":a=m;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":a=s;break;case "GLOW_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=B;break;default:a=h.background_color}}else b=z.COLOR_BUFFER_BIT|z.DEPTH_BUFFER_BIT,a=h.background_color;z.colorMask(!0,!0,!0,!0);z.depthMask(!0);z.clearColor(a[0],
a[1],a[2],a[3]);z.clear(b)}function b(a,b,c){z.bindBuffer(z.ARRAY_BUFFER,a.$f);for(var d=0;d<b.length;d++){var e=b[d];z.enableVertexAttribArray(e.Cf);z.vertexAttribPointer(e.Cf,e.Pc,z.FLOAT,!1,0,e.au+e.Uv*c)}a.Fd?(z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,a.Fd),z.drawElements(a.mode,a.count,a.Pl,0)):z.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)e=b[d],z.disableVertexAttribArray(e.Cf)}function e(a){switch(a){case 0:return z.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return z.TEXTURE_CUBE_MAP_NEGATIVE_X;
case 2:return z.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return z.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return z.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return z.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function d(a){var b=a.yi,c=[],d=[],e={},f;for(f in b){var h=!1;switch(f){case "u_proj_matrix":var g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.qa)},h=!0;break;case "u_view_matrix":case "u_view_matrix_frag":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.ia)};h=!0;break;case "u_shadow_cast_billboard_view_matrix":g=function(a,
b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.lr)};h=!0;break;case "u_view_proj_prev":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Xx)};h=!0;break;case "u_view_proj_inverse":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.mh)};h=!0;break;case "u_sky_vp_inverse":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Vc)};h=!0;break;case "u_camera_eye":case "u_camera_eye_frag":g=function(a,b,c,d,e,f){a.uniform3fv(b,f.je)};h=!0;break;case "u_camera_eye_last":g=function(a,b,c,d,e,f){a.uniform3fv(b,f.ep)};h=
!0;break;case "u_camera_quat":g=function(a,b,c,d,e,f){a.uniform4fv(b,f.quat)};h=!0;break;case "u_view_max_depth":g=function(a,b,c,d,e,f){a.uniform1f(b,f.Qa)};h=!0;break;case "u_camera_range":g=function(a,b,c,d,e,f){a.uniform2f(b,f.Ja,f.Qa)};break;case "u_csm_center_dists":g=function(a,b,c,d,e,f){a.uniform4fv(b,f.Ko)};break;case "u_cam_water_depth":g=function(a,b,c){a.uniform1f(b,c.Uk)};h=!0;break;case "u_waves_height":g=function(a,b,c){a.uniform1f(b,c.Oe)};break;case "u_waves_length":g=function(a,
b,c){a.uniform1f(b,c.cg)};break;case "u_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.Ob)};break;case "u_underwater_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.Fc)};break;case "u_bloom_key":g=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":g=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":g=function(a,b,c){a.uniform1f(b,c.time)};h=!0;break;case "u_wind":g=function(a,b,c){a.uniform3fv(b,c.Ei)};break;case "u_horizon_color":g=function(a,
b,c){a.uniform3fv(b,c.qc)};break;case "u_zenith_color":g=function(a,b,c){a.uniform3fv(b,c.wc)};break;case "u_environment_energy":g=function(a,b,c){a.uniform1f(b,c.ie)};break;case "u_sky_color":g=function(a,b,c){a.uniform3fv(b,c.Rg)};break;case "u_rayleigh_brightness":g=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":g=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":g=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":g=
function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":g=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":g=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":g=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":g=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":g=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;
case "u_light_positions":g=function(a,b,c){a.uniform3fv(b,c.Af)};break;case "u_light_directions":g=function(a,b,c){a.uniform3fv(b,c.xf)};break;case "u_light_color_intensities":g=function(a,b,c){a.uniform3fv(b,c.wf)};break;case "u_light_factors1":g=function(a,b,c){a.uniform4fv(b,c.yf)};break;case "u_light_factors2":g=function(a,b,c){a.uniform4fv(b,c.zf)};break;case "u_shadow_lamp_id":g=function(a,b,c){a.uniform1i(b,c.mr)};break;case "u_sun_quaternion":g=function(a,b,c){a.uniform4fv(b,c.Gr)};break;
case "u_sun_intensity":g=function(a,b,c){a.uniform3fv(b,c.Fr)};break;case "u_sun_direction":g=function(a,b,c){a.uniform3fv(b,c.kk)};break;case "u_height":g=function(a,b,c,d,e,f){a.uniform1f(b,f.height)};h=!0;break;case "u_model_matrix":g=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.L)};h=!0;break;case "u_transb":g=function(a,b,c,d){a.uniform4fv(b,d.lc)};h=!0;break;case "u_transa":g=function(a,b,c,d){a.uniform4fv(b,d.kc)};h=!0;break;case "u_quat":g=function(a,b,c,d){a.uniform4fv(b,d.quat)};h=!0;break;
case "u_quatsb":g=function(a,b,c,d){a.uniform4fv(b,d.dc)};h=!0;break;case "u_quatsa":g=function(a,b,c,d){a.uniform4fv(b,d.cc)};h=!0;break;case "u_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.kf)};h=!0;break;case "au_center_pos":g=function(){};h=!0;break;case "au_wind_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.dd)};h=!0;break;case "au_wind_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.Pe)};h=!0;break;case "au_detail_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.ee)};h=!0;break;case "au_detail_bending_amp":g=
function(a,b,c,d){a.uniform1f(b,d.de)};h=!0;break;case "au_branch_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.be)};h=!0;break;case "u_anim_values":g=function(a,b,c,d){a.uniform1fv(b,d.Ff)};h=!0;break;case "u_diffuse_color":g=function(a,b,c,d,e){a.uniform4fv(b,e.zb)};h=!0;break;case "u_diffuse_intensity":g=function(a,b,c,d,e){a.uniform1f(b,e.ff)};h=!0;break;case "u_diffuse_params":g=function(a,b,c,d,e){a.uniform2fv(b,e.vd)};h=!0;break;case "u_emit":g=function(a,b,c,d,e){a.uniform1f(b,e.ge)};h=
!0;break;case "u_ambient":g=function(a,b,c,d,e){a.uniform1f(b,e.Jc)};h=!0;break;case "u_specular_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.Pd)};h=!0;break;case "u_specular_alpha":g=function(a,b,c,d,e){a.uniform1f(b,e.Tg)};h=!0;break;case "u_specular_params":g=function(a,b,c,d,e){a.uniform3fv(b,e.vc)};h=!0;break;case "u_reflect_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.mi)};h=!0;break;case "u_mirror_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.hm)};h=!0;break;case "u_grass_map_dim":g=function(a,
b,c,d,e){a.uniform3fv(b,e.Qb)};h=!0;break;case "u_grass_size":g=function(a,b,c,d,e){a.uniform1f(b,e.Il)};h=!0;break;case "u_scale_threshold":g=function(a,b,c,d,e){a.uniform1f(b,e.tj)};h=!0;break;case "u_cube_fog":g=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.$b)};break;case "u_jitter_amp":g=function(a,b,c,d,e){a.uniform1f(b,e.Gj)};h=!0;break;case "u_jitter_freq":g=function(a,b,c,d,e){a.uniform1f(b,e.Hj)};h=!0;break;case "u_wireframe_mode":g=function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;
case "u_wireframe_edge_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":g=function(a,b,c){a.uniform2fv(b,c.ox)};h=!0;break;case "u_subsample_indices":g=function(a,b,c){a.uniform4fv(b,c.px)};h=!0;break;case "u_refr_bump":g=function(a,b,c,d,e){a.uniform1f(b,e.Wq)};h=!0;break;case "u_lamp_light_positions":g=function(a,b,c,d,e){a.uniform3fv(b,e.Wl)};break;case "u_lamp_light_directions":g=function(a,b,c,d,e){a.uniform3fv(b,e.Ul)};break;case "u_lamp_light_color_intensities":g=
function(a,b,c,d,e){a.uniform3fv(b,e.Tl)};break;case "u_lamp_light_factors":g=function(a,b,c,d,e){a.uniform4fv(b,e.Vl)};break;case "u_halo_size":g=function(a,b,c,d,e){a.uniform1f(b,e.Hp)};h=!0;break;case "u_halo_hardness":g=function(a,b,c,d,e){a.uniform1f(b,e.Ep)};h=!0;break;case "u_halo_rings_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.Gp)};h=!0;break;case "u_halo_lines_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.Fp)};h=!0;break;case "u_halo_stars_blend":g=function(a,b,c,d,e){a.uniform1f(b,e.Ip)};
h=!0;break;case "u_halo_stars_height":g=function(a,b,c,d,e){a.uniform1f(b,e.Jp)};h=!0;break;case "u_fresnel_params":g=function(a,b,c,d,e){a.uniform4fv(b,e.Bd)};h=!0;break;case "u_texture_scale":g=function(a,b,c,d,e){a.uniform3fv(b,e.Zc)};h=!0;break;case "u_parallax_scale":g=function(a,b,c,d,e){a.uniform1f(b,e.fi)};h=!0;break;case "u_color_id":g=function(a,b,c,d,e){a.uniform3fv(b,e.Ao)};h=!0;break;case "u_line_points":g=function(a,b,c,d,e){a.uniform3fv(b,e.qC)};h=!0;break;case "u_diffuse_color_factor":g=
function(a,b,c,d,e){a.uniform1f(b,e.ef)};h=!0;break;case "u_alpha_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Ue)};h=!0;break;case "u_specular_color_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.sr)};h=!0;break;case "u_normal_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.oq)};h=!0;break;case "u_normalmap0_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Gf[0])};h=!0;break;case "u_normalmap1_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Gf[1])};h=!0;break;case "u_normalmap2_scale":g=function(a,b,c,
d,e){a.uniform2fv(b,e.Gf[2])};h=!0;break;case "u_normalmap3_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Gf[3])};h=!0;break;case "u_foam_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.foam_factor)};h=!0;break;case "u_foam_uv_freq":g=function(a,b,c,d,e){a.uniform2fv(b,e.ip)};h=!0;break;case "u_foam_mag":g=function(a,b,c,d,e){a.uniform2fv(b,e.hp)};h=!0;break;case "u_foam_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.ul)};h=!0;break;case "u_water_norm_uv_velocity":g=function(a,b,c,d,e){a.uniform1f(b,
e.xk)};h=!0;break;case "u_shallow_water_col":g=function(a,b,c,d,e){a.uniform3fv(b,e.shallow_water_col)};h=!0;break;case "u_shore_water_col":g=function(a,b,c,d,e){a.uniform3fv(b,e.shore_water_col)};h=!0;break;case "u_water_shallow_col_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.shallow_water_col_fac)};h=!0;break;case "u_water_shore_col_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.shore_water_col_fac)};h=!0;break;case "u_p_length":g=function(a,b,c,d,e){a.uniform1f(b,e.Bq)};h=!0;break;case "u_p_cyclic":g=
function(a,b,c,d,e){a.uniform1i(b,e.xq)};h=!0;break;case "u_p_max_lifetime":g=function(a,b,c,d,e){a.uniform1f(b,e.Dq)};h=!0;break;case "u_p_fade_in":g=function(a,b,c,d,e){a.uniform1f(b,e.yq)};h=!0;break;case "u_p_fade_out":g=function(a,b,c,d,e){a.uniform1f(b,e.zq)};h=!0;break;case "u_p_size":g=function(a,b,c,d,e){a.uniform1f(b,e.qm)};h=!0;break;case "u_p_alpha_start":g=function(a,b,c,d,e){a.uniform1f(b,e.uq)};h=!0;break;case "u_p_alpha_end":g=function(a,b,c,d,e){a.uniform1f(b,e.tq)};h=!0;break;case "u_p_nfactor":g=
function(a,b,c,d,e){a.uniform1f(b,e.pm)};h=!0;break;case "u_p_gravity":g=function(a,b,c,d,e){a.uniform1f(b,e.Aq)};h=!0;break;case "u_p_mass":g=function(a,b,c,d,e){a.uniform1f(b,e.Cq)};h=!0;break;case "u_p_size_ramp":g=function(a,b,c,d,e){a.uniform2fv(b,e.Eq)};h=!0;break;case "u_p_color_ramp":g=function(a,b,c,d,e){a.uniform4fv(b,e.vq)};h=!0;break;case "u_p_wind":g=function(a,b,c,d,e){a.uniform3fv(b,e.Uj)};h=!0;break;case "u_texel_size":g=function(a,b,c,d,e){a.uniform2fv(b,e.Vm)};h=!0;break;case "u_p_time":g=
function(a,b,c,d,e){a.uniform1f(b,e.Qc.M.time)};h=!0;break;case "u_va_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.Wr)};h=!0;break;case "u_normal_offset":g=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":g=function(a,b,c,d,e,f){a.uniform4fv(b,f.Zj)};break;case "u_v_light_matrix":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Vr)};h=!0;break;case "u_b_light_matrix":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Xn)};break;case "u_p_light_matrix0":g=function(a,
b,c){a.uniformMatrix4fv(b,!1,c.Nf[0])};h=!0;break;case "u_p_light_matrix1":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Nf[1])};h=!0;break;case "u_p_light_matrix2":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Nf[2])};h=!0;break;case "u_p_light_matrix3":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Nf[3])};h=!0;break;case "u_motion_blur_exp":g=function(a,b,c){a.uniform1f(b,c.lq)};h=!0;break;case "u_refl_plane":g=function(a,b,c){a.uniform4fv(b,c.Bb)};break;case "u_radial_blur_step":g=function(a,b,c){a.uniform1f(b,
c.bk)};break;case "u_god_rays_intensity":g=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":g=function(a,b,c){a.uniform1f(b,c.Wg)};break;case "u_ssao_blur_discard_value":g=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};h=!0;break;case "u_ssao_influence":g=function(a,b,c){a.uniform1f(b,c.Vg)};break;case "u_ssao_dist_factor":g=function(a,b,c){a.uniform1f(b,c.Ug)};break;case "u_dof_dist":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_distance)};h=!0;break;
case "u_dof_front":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_front)};h=!0;break;case "u_dof_rear":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_rear)};h=!0;break;case "u_glow_intensity":g=function(a,b,c,d,e){a.uniform1f(b,e.xg)};h=!0;break;case "u_glow_color":g=function(a,b,c){a.uniform3fv(b,c.Rh)};break;case "u_draw_glow":g=function(a,b,c){a.uniform1f(b,c.ol)};h=!0;break;case "u_brightness":g=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":g=function(a,b,c){a.uniform1f(b,c.contrast)};
break;case "u_exposure":g=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":g=function(a,b,c){a.uniform1f(b,c.saturation)};break;default:g=null}g&&(g={name:f,zl:g,Cf:b[f]},h?c.push(g):(d.push(g),e[f]=g))}a.Mr=c;a.gi=d;a.sm=e}var l=p("__config"),g=p("__debug"),f=p("__textures"),r=p("__util"),h=l.p,n=[1,1,1,1],m=[1,1,1,1],s=[0,0,0,1],B=[0,0,0,0];new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var z=null,u=new Uint8Array(4);
a.fc=function(a){var b=h.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);z=a};a.Gh=function(a){if(a.U){var f=a.j;z.bindFramebuffer(z.FRAMEBUFFER,f.ke);if(a.Ik){var k=f.vb;z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,k.Ib,k.La,0)}z.viewport(0,0,f.width,f.height);c(a);a.xa?z.enable(z.BLEND):z.disable(z.BLEND);
a.Gb?z.enable(z.DEPTH_TEST):z.disable(z.DEPTH_TEST);if(a.Aa){for(var f=a.j,k=a.o,l=0;l<k.length;l++){var m=k[l],r=m.n,n=r.Nb;z.useProgram(n.ji);m=m.fb;n.gi.length||d(n);for(var n=n.gi,C=n.length;C--;){var s=n[C];s.zl(z,s.Cf,a,m,r,f)}}a.Aa=!1}switch(a.type){case "SHADOW_CAST":z.enable(z.POLYGON_OFFSET_FILL);z.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);z.cullFace(z.BACK);break;case "MAIN_REFLECT":z.disable(z.POLYGON_OFFSET_FILL);z.cullFace(z.FRONT);break;default:z.disable(z.POLYGON_OFFSET_FILL),
z.cullFace(z.BACK)}f=a.j;k=a.o;for(l=0;l<k.length;l++)if(n=k[l],n.U){var r=a,m=f,C=n.fb,y=n.n,s=y.Nb;z.useProgram(s.ji);for(var n=y.mb,B=y.Tn,H=s.Mr,Y=H.length;Y--;){var J=H[Y];J.zl(z,J.Cf,r,C,y,m)}m=y.Bo;z.colorMask(m,m,m,m);z.depthMask(y.V);y.sa?z.enable(z.CULL_FACE):z.disable(z.CULL_FACE);m=y.N;for(y=0;y<m.length;y++)H=m[y],z.activeTexture(z.TEXTURE0+y),z.bindTexture(H.Ib,H.La);if("SKY"==r.type){m=r;s=s.yi;y=m.j.vb.La;H=m.Lo;for(Y=0;6>Y;Y++){J=e(Y);if(h.wo){var D=new Uint8Array([91.8,142.8,.96*
255,255]);z.bindTexture(z.TEXTURE_CUBE_MAP,y);z.texImage2D(J,0,z.RGBA,1,1,0,z.RGBA,z.UNSIGNED_BYTE,D)}else z.uniformMatrix4fv(s.u_cube_view_matrix,!1,H[Y]),z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,J,y,0),b(n,B,C.dn);if(m.Qj&&3!=Y){var J=m,D=Y,T=u;z.readPixels(191,191,1,1,z.RGBA,z.UNSIGNED_BYTE,T);255!=T[0]&&255!=T[1]&&255!=T[2]||z.readPixels(191,220,1,1,z.RGBA,z.UNSIGNED_BYTE,T);var K=T[0],p=T[1],T=T[2],K=K/255,p=p/255,T=T/255;2===D?(J.$b[3]=K,J.$b[7]=p,J.$b[11]=T):2>D?(J.$b[4*D]=
K,J.$b[4*D+1]=p,J.$b[4*D+2]=T):(J.$b[4*(D-2)]=K,J.$b[4*(D-2)+1]=p,J.$b[4*(D-2)+2]=T)}}r.Dh+=6}else b(n,B,C.dn),r.Dh++}g.uu("draw subscene: "+a.type);z.bindFramebuffer(z.FRAMEBUFFER,null)}};a.clear=function(a){z.bindFramebuffer(z.FRAMEBUFFER,a.j.ke);c(a)};a.Pn=function(a){var b=a.Tn;b.length=0;var c=a.mb;a=a.Nb;c&&a||r.ga("Incomplete batch");c=c.Sb;a=a.attributes;for(var d in a){var e=c[d];b.push({Cf:a[d],au:4*e.offset,Uv:1<e.frames?4*e.length:0,Pc:e.Pc})}};a.$t=d;a.Qn=function(a){var b=a.Nb,c=a.N;
a=a.ic;z.useProgram(b.ji);for(var d=0;d<c.length;d++)z.uniform1i(b.yi[a[d]],d)};a.ay=function(a,b,c){var d,e,f;d||(d=1);e||(e=1);f||(f=new Uint8Array(4*d*e));f.length!=4*d*e&&r.ga("read_pixels(): Wrong storage");z.bindFramebuffer(z.FRAMEBUFFER,a);z.readPixels(b,c,d,e,z.RGBA,z.UNSIGNED_BYTE,f);z.bindFramebuffer(z.FRAMEBUFFER,null);return f};a.Hz=function(a){var b=a.Nb;z.useProgram(b.ji);b.gi.length||d(b);b=b.sm.u_cube_fog;b.zl(z,b.Cf,null,null,a,null)};a.jy=function(a,b){var c=z.createFramebuffer();
z.bindFramebuffer(z.FRAMEBUFFER,c);if(a){var d=a,e=d.La,d=d.Ib==z.TEXTURE_CUBE_MAP?z.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.Ib;z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,d,e,0)}f.Vp(b)?z.framebufferRenderbuffer(z.FRAMEBUFFER,z.DEPTH_ATTACHMENT,z.RENDERBUFFER,b.Le):f.Xh(b)&&(d=b,e=d.La,d=d.Ib,z.framebufferTexture2D(z.FRAMEBUFFER,z.DEPTH_ATTACHMENT,d,e,0));g.ru();z.bindFramebuffer(z.FRAMEBUFFER,null);return c};a.iy=function(a,b,c,d,e){null==a?(z.bindFramebuffer(z.FRAMEBUFFER,a),z.viewport(0,0,
d,e),z.clear(z.COLOR_BUFFER_BIT|z.DEPTH_BUFFER_BIT)):(f.Xh(b)&&z.deleteTexture(b.La),f.Vp(c)?z.deleteRenderbuffer(c.Le):f.Xh(c)&&z.deleteTexture(c.La),z.deleteFramebuffer(a))};a.$B=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,p){function c(a,c,d){var e=a.fe;"string"==typeof d&&(a=b(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==c){e[a][1]=d;return}e.push([c,d])}function b(a,b){for(var c=a.fe,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function e(a,b){var c=a+b;if(x[c])return x[c];if(q){var d=q[b];if(!d)return null}else{d=z.Lw(a+b);if(!d)return null;d=F.Kq.parse(d)}return x[c]=d}function d(a,b,c,d){function f(b){b=b.a;for(var c=0;c<b.length;c++){var n=b[c];switch(n.type){case "condition":a:for(var n=
n.a,C=0;C<n.length;C++){var v=n[C];switch(v.type){case "if":case "elif":var S=v.c;try{var W=h(S)}catch(B){throw"Failed to process #"+v.type+" expression: "+S.join(" ");}if(W){f(v.group);break a}break;case "else":f(v.group);break a;case "ifdef":v.name in k&&f(v.group);break;case "ifndef":v.name in k||f(v.group)}}break;case "include":n=e(u.shaders_dir,u.Ty+n.file);f(n);break;case "var":case "export":case "import":break;case "define":C=n.name;k[C]=n.b;n.H&&(r[C]=n.H);break;case "error":throw"Shader error: #error "+
n.b.join(" ");case "line":break;case "pragma":q.push("#pragma "+n.name+" "+n.b.join(" "));break;case "undef":n=n.name;delete k[n];delete r[n];break;case "warning":m.warn("Shader warning: #warning "+n.b.join(" "));break;case "extension":q.push("#extension "+l(n.b,k,r,!1));break;case "#":break;case "node":z[n.name]=n;break;case "nodes_global":n=d;for(C=0;C<n.length;C++)if(v=n[C],S=z[v.id])for(var T=0,P=0;P<S.k.length;P++){var U=S.k[P];"node_param"==U.type&&(U=U.qualifier.join(" ")+" ","vert"==a?U+=
v.Di[T]:"frag"==a&&(U+=v.H[T],null!==v.Wj[T]&&(U+=" = "+v.Wj[T])),U+=";",q.push(U),T++)}break;case "nodes_main":n=d;for(C=0;C<n.length;C++)if(v=n[C],S=z[v.id]){T={};P={};for(U=0;U<v.Fh.length;U++)P[v.Fh[U][0]]=[v.Fh[U][1]];G=F=x=0;for(var U=v,t=S.k,V=T,oa=P,M=0;M<t.length;M++){var p=t[M];switch(p.type){case "node_in":var da=U.F[x];if(null!==U.Rp[x]){if(("MATERIAL"==U.id&&3===x||"MATERIAL_EXT"==U.id&&3===x)&&p.e){x++;continue}var ia=p.qualifier.join(" ")+" ",ia=ia+da,ia=ia+(" = "+U.Rp[x]),ia=ia+";";
q.push(ia)}V[p.name]=da;x++;break;case "node_out":da=U.Ta[F];if(!p.e||-1<s.indexOf(da))ia=p.qualifier.join(" ")+" ",ia+=da,ia+=";",q.push(ia),V[p.name]=da;-1<s.indexOf(da)&&(oa["USE_OUT_"+p.name]=[1]);F++;break;case "node_param":"vert"==a?da=U.Di[G]:"frag"==a&&(da=U.H[G]),V[p.name]=da,G++}}g(v,S.f,T,P)}break;case "textline":q.push(l(n.b,k,r,!1));break;default:throw"Unknown element type: "+n.type;}}}function h(a,b){var c=l(a,k,r,!0,b);return B.Kq.parse(c)}function g(a,b,c,d){for(var e=0;e<b.length;e++){var f=
b[e];switch(f.type){case "node_condition":a:for(var W=a,f=f.a,m=c,n=d,P=0;P<f.length;P++){var y=f[P];switch(y.type){case "node_if":case "node_elif":var t=y.c;try{var V=h(t,n)}catch(u){throw"Failed to process #"+y.type+" expression: "+t.join(" ");}if(V){g(W,y.f,m,n);break a}break;case "node_else":g(W,y.f,m,n);break a;case "node_ifdef":(y.name in k||y.name in n)&&g(W,y.f,m,n);break;case "node_ifndef":y.name in k||y.name in n||g(W,y.f,m,n)}}break;case "textline":W=[];for(m=0;m<f.b.length;m++)n=f.b[m],
n in c?W.push(c[n]):W.push(n);q.push(l(W,k,r,!0,d))}}}for(var q=[],k={},n=0;n<c.length;n++)k[c[n][0]]=[c[n][1]];for(n=0;n<d.length;n++)k["USE_NODE_"+d[n].id]=[1];var r={},z={},s=[];for(n in d)for(var v in d[n].F)s.push(d[n].F[v]);f(b);var x=0,F=0,G=0;return q.join("\n")}function l(a,b,c,d,e){var f=[];g(a,b,c,d,f,e);return f.join(" ")}function g(a,b,c,d,e,f){for(var h=0;h<a.length;h++){var q=a[h];q in b||f&&q in f?(q=f&&f[q]||b[q],0==q.length&&d?e.push(0):g(q,b,c,d,e,f)):e.push(q)}}function f(a,b,
c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);s.vu(d,b,c);return d}function r(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return h(a);case 2:return"vec2("+h(a[0])+","+h(a[1])+")";case 3:return"vec3("+h(a[0])+","+h(a[1])+","+h(a[2])+")";case 4:return"vec4("+h(a[0])+","+h(a[1])+","+h(a[2])+","+h(a[3])+")";case 9:return"mat3("+h(a[0])+","+h(a[1])+","+h(a[2])+","+h(a[3])+","+h(a[4])+","+h(a[5])+","+h(a[6])+","+h(a[7])+","+h(a[8])+")";case 16:return"mat4("+h(a[0])+","+h(a[1])+
","+h(a[2])+","+h(a[3])+","+h(a[4])+","+h(a[5])+","+h(a[6])+","+h(a[7])+","+h(a[8])+","+h(a[9])+","+h(a[10])+","+h(a[11])+","+h(a[12])+","+h(a[13])+","+h(a[14])+","+h(a[15])+")";default:throw"Wrong glsl value dimension";}}function h(a){return a%1?String(a):String(a)+".0"}var n=p("__config"),m=p("__print"),s=p("__debug"),B=p("__gpp_eval"),z=p("__assets");p("__util");var u=n.Rb;if(b4w.module_check("shader_texts"))var q=p("shader_texts"),F=null;else q=null,F=p("__gpp_parser");var k={},x={},v=[],G=null;
a.fc=function(a){G=a};a.G=c;a.Aw=b;a.hC=function(a,b){for(var c=a.fe,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.By=function(a){a.fe=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE USE_REFRACTION SHORE_SMOOTHING SKINNED SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
d=0;d<b.length;d++){var e=b[d],f;switch(e){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_LIGHTS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "USE_REFRACTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":f=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":f=1;break;case "SHADOW_TEX_RES":f=r(2048);break;case "AA_METHOD":f="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":f="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":f="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":f="POST_EFFECT_NONE";break;case "SHADOW_SRC":f="SHADOW_SRC_NONE";break;case "SHADOW_DST":f=
"SHADOW_DST_NONE";break;case "SSAO_QUALITY":f="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":f="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":f="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":f=n.p.precision;break;case "EPSILON":f="highp"==n.p.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":f="u_va_frame_factor";break;default:m.error("Unknown directive ("+a.Bi+", "+a.Kh+"): "+e)}c(a,e,f)}};a.TB=function(a){return a.Bi};a.sp=function(a){return a.Kh};a.cx=function(a,d){for(var e=
d.fe,f=0;f<e.length;f++){var h=e[f][0],g=e[f][1];b(a,h)&&c(a,h,g)}};a.uw=function(a,b){var c=JSON.stringify(a)+JSON.stringify(b),h=k[c];if(h)return h;var g=a.Kh,h=e(u.shaders_dir,a.Bi),g=e(u.shaders_dir,g);if(!h||!g)return null;var q=a.fe||[],l=d("vert",h,q,b),q=d("frag",g,q,b),h=G,n=f(h,c,l,h.VERTEX_SHADER),D=f(h,c,q,h.FRAGMENT_SHADER),g=h.createProgram();h.attachShader(g,n);h.attachShader(g,D);h.linkProgram(g);h.validateProgram(g);h.getProgramParameter(g,h.VALIDATE_STATUS)==h.EA&&m.error("B4W Error - shader program is not valid",
c);s.wu(g,c,n,D,l,q);l={kn:n,mp:D,ji:g,attributes:{},yi:{},gi:[],sm:{},Mr:[],Va:a};n=h.getProgramParameter(g,h.ACTIVE_ATTRIBUTES);for(q=0;q<n;q++)D=h.getActiveAttrib(g,q).name,l.attributes[D]=h.getAttribLocation(g,D);n=h.getProgramParameter(g,h.ACTIVE_UNIFORMS);for(q=0;q<n;q++)D=h.getActiveUniform(g,q).name.split("[0]").join(""),l.yi[D]=h.getUniformLocation(g,D);return k[c]=h=l};a.nv=function(){return v};a.vw=function(){return k};a.cleanup=function(){for(var a in k){var b=k[a];G.deleteProgram(b.ji);
G.deleteShader(b.kn);G.deleteShader(b.mp);delete k[a]}for(var c in x)delete x[c];for(var d in v)delete v[d]};a.nB=function(a){var b=a.fe;m.log("Shader: "+a.Bi+" "+a.Kh+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)m.log("  "+b[a][0],b[a][1])};a.s=r;a.oo=function(a,b){return b in a.yi?!0:!1};a.Ow=function(a){return(G.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,p){function c(a){return 65536<a.I?G.rp()?!1:!0:!1}function b(a){return 0<a.ca.length?!0:!1}function e(a,c,e){if(!b(a))return a;e||k.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.I*(c||1)+", will use drawArrays","color: #aa0");c=a.ca;e=a.I;var f=a.D,h=a.u,g;for(g in f){var q=f[g],m=s(q,e);f[g]=d(c,q,m)}for(f=0;f<h.length;f++){var l=h[f];for(g in l)q=l[g],m=s(q,e),l[g]=d(c,q,m)}a.I=c.length;a.ca=new Uint16Array(0);return a}function d(a,b,c){if(0==
b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var f=a[e],h=0;h<c;h++)d[c*e+h]=b[c*f+h];return d}function l(a,b){var c=a.bd,d=a.Sb[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function g(b,c){var d,e;switch(c){case a.ph:case a.Ji:d=I.TRIANGLES;e=I.STATIC_DRAW;break;case a.tn:d=I.POINTS;e=I.STATIC_DRAW;break;case a.sn:d=I.TRIANGLES;e=I.DYNAMIC_DRAW;break;case a.hs:d=I.POINTS;e=I.DYNAMIC_DRAW;
break;case a.js:d=I.LINES;e=I.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.Ai=e}function f(a){a.le?(a.Fd||(a.Fd=I.createBuffer()),I.bindBuffer(I.ELEMENT_ARRAY_BUFFER,a.Fd),I.bufferData(I.ELEMENT_ARRAY_BUFFER,a.le,a.Ai),a.jj=a.le.byteLength):a.jj=0;a.$f||(a.$f=I.createBuffer());I.bindBuffer(I.ARRAY_BUFFER,a.$f);I.bufferData(I.ARRAY_BUFFER,a.bd,a.Ai);a.Po=a.bd.byteLength}function r(a){for(var b=v.wb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].ca.length;b.ca=new Uint32Array(c);
for(d=c=0;d<a.length;d++)c+=a[d].I;b.I=c;var e=a[0],f;for(f in e.D){for(d=c=0;d<a.length;d++)c+=a[d].D[f].length;b.D[f]=new Float32Array(c)}for(f in e.u[0]){for(d=c=0;d<a.length;d++)c+=a[d].u[0][f].length;for(d=0;d<e.u.length;d++)b.u[d]=b.u[d]||{},b.u[d][f]=new Float32Array(c)}for(e=d=c=0;e<a.length;e++){f=a[e];for(var h=f.ca,g=f.I,q=f.D,k=0;k<h.length;k++)b.ca[c+k]=h[k]+d;var c=c+h.length,m;for(m in q){var h=q[m],l=d*s(h,g);b.D[m].set(h,l)}for(k=0;k<f.u.length;k++){var q=f.u[k],n=b.u[k];for(m in q)h=
q[m],l=d*s(h,g),n[m].set(h,l)}d+=g}return b}function h(a,b,c,d,f,h){var g=v.wb("SUBMESH_"+a.name+"_"+b),l=a.submeshes[b],r=l.base_length,y=a.materials[b];g.I=r;if(n(c,"a_texcoord")){var u=null,z=a.materials[b];b=a.submeshes[b];if(z.texture_slots.length)switch(z=z.texture_slots[0],z.texture_coords){case "UV":z=a.uv_textures.indexOf(z.uv_layer);-1==z||0==z?u=new Float32Array(b.texcoord):1==z&&(u=new Float32Array(b.texcoord2));break;case "ORCO":for(var s=a.b4w_bounding_box,u=new Float32Array(2*b.base_length),
z=(s.max_x+s.min_x)/2,B=(s.max_z+s.min_z)/2,x=s.max_x-s.min_x,s=s.max_z-s.min_z,F=0,L=0;L<b.position.length;L+=3)u[F++]=(b.position[L]-z)/x+.5,u[F++]=(B-b.position[L+2])/s+.5}null===u&&(u=new Float32Array(b.texcoord));b=u}else b=new Float32Array(0);var S,u=l.group;if(n(c,"a_influence")&&d){z=new Float32Array(4*r);B=u.length/r;x=new Float32Array(B);for(s=0;s<B;s++)for(S in x[s]=-1,d)if(F=d[S],F.Zr===s){x[s]=F.Eh;break}L=3<B?B:4;d=new Float32Array(L);S=new Uint32Array(L);for(var s=new Float32Array(4),
F=new Float32Array(L),L=new Uint32Array(L),W=new Float32Array(4),ja=0;ja<r;ja++)d.set(F),S.set(L),s.set(W),z.set(m(u,B,ja,r,x,d,S,s),4*ja)}else z=new Float32Array(0);S=z;d=f?v.ya(f):{};d.a_color={mf:!0};d.a_color.src=n(c,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,rc:7}]:[];f={a_texcoord:b,a_influence:S};S=l.vertex_colors;b=l.color;u=a.name;z=[];for(B=0;B<S.length;B++)z.push(S[B].name);for(var I in d)if(B=d[I].src,B.length){for(s=x=0;s<B.length;s++)x+=v.Rf(B[s].rc);f[I]=new Float32Array(x*
r);for(s=F=0;s<B.length;s++){var P=B[s].name,L=B[s].rc,W=v.$q(L),U=z.indexOf(P);if(-1==U)throw'B4W Error: vertex color "'+P+'" for mesh "'+u+'" not found.';var ja=S[U].mask,t=v.Rf(ja);(L&ja)!==L&&k.error("B4W Error: Wrong color extraction from "+P+" to "+I+".");for(var V=P=0;V<U;V++)P+=v.Rf(S[V].mask);U=P*r;for(P=0;P<r;P++)for(V=0;3>V;V++)W[V]&&(f[I][P*x+(F+v.qi(L,V))]=b[U+P*t+v.qi(ja,V)]);F+=t}}else f[I]=new Float32Array(0);I=a.uv_textures;d=l.texcoord;S=l.texcoord2;b=a.name;if(h)for(var oa in h){u=
I.indexOf(oa);if(-1==u)throw'B4W Error: uv map "'+oa+'" for mesh "'+b+'" not found';if(0==u)var G=new Float32Array(d);else 1==u&&(G=new Float32Array(S));f[h[oa]]=G}g.D=f;g.ca=new Uint32Array(l.indices);h=l.position.length/r/3;G=(oa=n(c,"a_normal")&&l.normal.length?!0:!1)&&n(c,"a_tangent")&&l.tangent.length?!0:!1;I=oa&&y.texture_slots.length&&n(c,"a_tangent")&&"ORCO"==y.texture_slots[0].texture_coords?!0:!1;for(f=0;f<h;f++){y={};d=new Float32Array(3*r);S=new Float32Array(oa?3*r:0);b=new Float32Array(G||
I?4*r:0);u=f*r*3;z=u+3*r;d.set(l.position.subarray(u,z),0);oa&&(u=f*r*3,z=u+3*r,S.set(l.normal.subarray(u,z),0));if(G)u=f*r*4,z=u+4*r,b.set(l.tangent.subarray(u,z),0);else if(I)for(u=S,z=b,B=r,k.warn('B4W Warning: Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+a.name+'". Please add a UV-map.'),x=0;x<B;x++)s=C,F=M,s[0]=u[3*x],s[1]=u[3*x+1],s[2]=u[3*x+2],A.cross(s,v.AXIS_Z,F),0==A.length(F)&&A.cross(s,v.AXIS_X,F),A.normalize(F,F),z[4*x]=F[0],z[4*x+1]=
F[1],z[4*x+2]=F[2],z[4*x+3]=1;else if(oa&&n(c,"a_tangent"))for(b=new Float32Array(4*r),f=0;f<b.length;f++)b[f]=1;y.a_position=d;y.a_normal=S;y.a_tangent=b;g.u.push(y)}if(1<h){a=g.u[0];var y={},p;for(p in a)y[p]=new Float32Array(a[p]);g.u.push(y)}n(c,"a_polyindex")&&(e(g,1,!0),g.D.a_polyindex=q(g));return g}function n(a,b){return-1<a.indexOf(b)?!0:!1}function m(a,b,c,d,e,f,h,g){for(var q=!0,k=0;k<b;k++){var l=a[k*d+c];if(-1!==l){var m=e[k];-1!==m&&(f[k]=l,h[k]=m,q=!1)}}if(q)return g;B(f,h,!1);for(k=
a=0;4>k;k++)a+=f[k];if(.01>a)return g;for(k=0;4>k;k++)f[k]/=a;if(.01>Math.abs(f[0]-1))g[0]=h[0]+1;else for(k=0;4>k;k++)g[k]=h[k]+f[k];return g}function s(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function B(a,b,c){var d=a.length,e=d,f=!1;for(c=c?-1:1;1<e||f;){1<e&&(e=Math.floor(e/1.247330950103979));for(var f=!1,h=0;e+h<d;h++)0>c*(a[h]-a[h+e])&&(f=a[h],a[h]=a[h+e],a[h+e]=f,f=b[h],
b[h]=b[h+e],b[h+e]=f,f=!0)}}function z(a,b,c){var d=[],e=[];A.subtract(b,a,d);A.subtract(c,a,e);A.normalize(d,d);A.normalize(e,e);return Math.acos(A.dot(d,e))}function u(a,c,d){c||(c=[]);d=d?a.u[0].a_normal:a.u[0].a_position;if(b(a)){a=a.ca;for(var e=a.length/3,f=0;f<e;f++){var h=new Float32Array(9),g=a[3*f];h[0]=d[3*g];h[1]=d[3*g+1];h[2]=d[3*g+2];g=a[3*f+1];h[3]=d[3*g];h[4]=d[3*g+1];h[5]=d[3*g+2];g=a[3*f+2];h[6]=d[3*g];h[7]=d[3*g+1];h[8]=d[3*g+2];c[f]=h}}else for(f=0;f<d.length;f++)h=new Float32Array(9),
h[0]=d[9*f],h[1]=d[9*f+1],h[2]=d[9*f+2],h[3]=d[9*f+3],h[4]=d[9*f+4],h[5]=d[9*f+5],h[6]=d[9*f+6],h[7]=d[9*f+7],h[8]=d[9*f+8],c[f]=h;return c}function q(a){for(var b=new Float32Array(a.I),c=0;c<a.I;c++)b[c]=c%3;return b}function F(a,b,c){var d=A.dist(a,b);a=A.dist(a,c);b=A.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}var k=p("__print"),x=p("__tsr"),v=p("__util"),G=p("__extensions"),A=p("vec3"),C=new Float32Array(3),M=new Float32Array(3),y=new Float32Array(3);a.jd=10;a.Bn=20;a.JA=30;a.Ji=10;a.tn=
20;a.sn=30;a.hs=40;a.js=50;a.ph=a.Ji;var I=null;a.fc=function(a){I=a};a.pB=function(a){var b=_buffers[a];I.deleteBuffer(b.Fd);I.deleteBuffer(b.$f);delete _buffers[a]};a.sz=function(d,h,q,k){c(d)&&e(d);var l=d.ca,m=d.I,n=d.u,r={},y;for(y in d.D)y in k&&!k[y].mf||(r[y]=d.D[y]);k={le:null,bd:null,Pl:0,count:0,Sb:{},mode:0,Ai:0,jj:0,Po:0,$f:null,Fd:null,Aj:null};if(l.length)if(y=l.length,65536>=m)var u=new Uint16Array(l),z=I.UNSIGNED_SHORT;else u=new Uint32Array(l),z=I.UNSIGNED_INT;else y=m,u=null;var v=
0,B=n.length,C;for(C in n[0])var x=n[0][C],v=v+x.length*B;for(C in r)x=r[C],v+=x.length;C=new Float32Array(v);var v=0,B={},A;for(A in r){var L=r[A];if(x=L.length)C.set(L,v),B[A]={WA:A,Pc:s(L,m),offset:v,frames:1,length:x},v+=x}r=n.length;for(A in n[0])if(L=n[0][A],x=L.length,L=s(L,m),x){B[A]={Pc:L,offset:v,frames:r,length:x};1<r&&(B[A+"_next"]={Pc:L,offset:v+x,frames:r,length:x});for(var S=0;S<r;S++)L=n[S][A],C.set(L,v),v+=x}k.count=y;k.le=u;k.bd=C;k.Pl=z;k.Sb=B;g(k,q);f(k);h!=a.jd&&b(d)&&(k.Aj={Cx:new Float32Array(l.length),
Dx:new Float32Array(l.length),zv:new Float32Array(l.length/3),type:h});return k};a.mx=c;a.lx=b;a.Sm=e;a.Jz=function(a,b,c){g(a,b);a.count=c.length;a.le=c;a.Pl=c instanceof Uint16Array?I.UNSIGNED_SHORT:I.UNSIGNED_INT};a.rk=function(a,b,c,d){var e=a.bd,h=a.Sb,g=h[b];if(g){if(c&&g.Pc!=c)throw'Error: invalid num_comp for "'+b+'"';e.set(d,g.offset)}else e=e.length,g=new Float32Array(e+d.length),g.set(a.bd),g.set(d,e),a.bd=g,h[b]={Pc:c,offset:e};f(a)};a.Iv=l;a.vC=function(a){a.Ai=I.STATIC_DRAW};a.vx=function(a){a.Ai=
I.DYNAMIC_DRAW};a.Oz=f;a.vo=function(a){a.Fd&&I.deleteBuffer(a.Fd);a.$f&&I.deleteBuffer(a.$f)};a.Kp=function(a,b){return a.submeshes[b].base_length?!1:!0};a.Dr=function(a,b){for(var c=0;c<a.u.length;c++){var d=a.u[c].a_position;x.ok(d,b,d,0);d=a.u[c].a_normal;0<d.length&&x.Kr(d,b,d,0);d=a.u[c].a_tangent;0<d.length&&x.Lr(d,b,d,0)}(c=a.D.au_center_pos)&&c.length&&x.ok(c,b,c,0);return a};a.qz=function(a,b){var c=a.D.au_center_pos;if(c&&c.length){var d=new Float32Array(c);x.ok(d,b,d,0);for(var e=0;e<
a.u.length;e++)for(var f=0;f<d.length;f++)a.u[e].a_position[f]+=d[f]-c[f];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.pz=function(a,b){var c=a.I,d;for(d in b){var e=b[d].length;a.D[d]=new Float32Array(e*c);for(var f=0;f<c;f++)for(var h=0;h<e;h++)a.D[d][f*e+h]=b[d][h]}};a.rz=r;a.ux=function(a,b,c){if(!a.I)return v.wb("EMPTY");var d=c.length;65536<a.I*d&&!G.rp()&&e(a,d);var f=a.ca,h=a.I,g=a.D;a=a.u;for(var q in b){var k=b[q].length,l=k*h;g[q]=new Float32Array(l);
for(var m=0;m<h;m++)for(l=0;l<k;l++)g[q][m*k+l]=b[q][l]}b=v.wb("CLONE_"+d+"_SUBMESHES");b.I=h*d;b.ca=new Uint32Array(f.length*d);for(m=0;m<d;m++)for(k=f.length*m,q=h*m,l=0;l<f.length;l++)b.ca[k+l]=f[l]+q;for(var n in g)for(f=g[n],l=f.length*d,k=s(f,h),b.D[n]=new Float32Array(l),m=0;m<d;m++)q=h*k*m,b.D[n].set(f,q);for(n in a[0])for(m=0;m<a.length;m++)for(f=a[m][n],l=f.length*d,k=s(f,h),b.u[m]=b.u[m]||{},b.u[m][n]=new Float32Array(l),l=0;l<d;l++)switch(g=c[l],q=h*k*l,n){case "a_position":x.ok(f,g,b.u[m][n],
q);break;case "a_normal":x.Kr(f,g,b.u[m][n],q);break;case "a_tangent":x.Lr(f,g,b.u[m][n],q);break;default:throw"Wrong attribute name: "+n;}return b};a.dp=h;a.Lv=function(a){var b=a.I,c=a.u[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint16Array(4*a.ca.length);for(var f=0;f<b;f++)d[12*f]=c[3*f],d[12*f+1]=c[3*f+1],d[12*f+2]=c[3*f+2],d[12*f+3]=c[3*f],d[12*f+4]=c[3*f+1],d[12*f+5]=c[3*f+2],d[12*f+6]=c[3*f],d[12*f+7]=c[3*f+1],d[12*f+8]=c[3*f+2],d[12*f+9]=c[3*f],d[12*f+10]=c[3*f+
1],d[12*f+11]=c[3*f+2],e[8*f]=-.5,e[8*f+1]=-.5,e[8*f+2]=-.5,e[8*f+3]=.5,e[8*f+4]=.5,e[8*f+5]=.5,e[8*f+6]=.5,e[8*f+7]=-.5,a[6*f]=4*f+2,a[6*f+1]=4*f+1,a[6*f+2]=4*f,a[6*f+3]=4*f+2,a[6*f+4]=4*f,a[6*f+5]=4*f+3;c=v.wb("HALO");c.u=[];c.u[0]={};c.I=4*b;c.u[0].a_position=d;c.D.a_halo_bb_vertex=e;c.ca=a;return c};a.Xw=n;a.Mv=function(a){for(var b=["a_position","a_normal"],c=[],d=0;d<a.submeshes.length;d++){var e=h(a,d,b,null,null,null);e.I&&c.push(e)}return 0==c.length?v.wb("EMPTY"):1==c.length?c[0]:r(c)};
a.Iz=function(a,b,c){for(var d=a.le,e=l(a,"a_position"),f=a.Aj,h=f.Cx,g=f.Dx,f=f.zv,q=d,k=q.length/3,m=0;m<k;m++){var n=q[3*m],r=q[3*m+1],y=q[3*m+2],u=e[3*n+1],z=e[3*n+2],s=e[3*r+1],S=e[3*r+2],W=e[3*y+1],B=e[3*y+2];h[3*m]=(e[3*n]+e[3*r]+e[3*y])/3;h[3*m+1]=(u+s+W)/3;h[3*m+2]=(z+S+B)/3}v.ue(h,b,g);b=h.length/3;for(e=0;e<b;e++)g=h[3*e]-c[0],q=h[3*e+1]-c[1],k=h[3*e+2]-c[2],f[e]=g*g+q*q+k*k;c=d;d=f.length;if(!(2>d))for(h=d,e=!1;1<h||e;)for(1<h&&(h=Math.floor(h/1.247330950103979)),e=!1,b=0;h+b<d;b++)0>
f[b]-f[b+h]&&(e=f[b],f[b]=f[b+h],f[b+h]=e,e=c,g=b,q=b+h,k=e[3*g],m=e[3*g+1],n=e[3*g+2],e[3*g]=e[3*q],e[3*g+1]=e[3*q+1],e[3*g+2]=e[3*q+2],e[3*q]=k,e[3*q+1]=m,e[3*q+2]=n,e=!0);d=c;I.bindBuffer(I.ELEMENT_ARRAY_BUFFER,a.Fd);I.bufferData(I.ELEMENT_ARRAY_BUFFER,d,I.DYNAMIC_DRAW)};a.az=B;a.fo=function(a,b,c){for(var d=b.length/3,e=a.length/3,f=[],h=Array(3),g=Array(3),q=Array(3),k=0;k<e;k++){for(var m=a[3*k],l=a[3*k+1],n=a[3*k+2],r=0;3>r;r++)h[r]=b[3*m+r],g[r]=b[3*l+r],q[r]=b[3*n+r];if(c)var r=z(h,g,q),
y=z(g,q,h),u=Math.PI-r-y;else u=y=r=1;var s=f,S;S=h;var W=q,v=[],B=[],P=[];A.subtract(g,S,v);A.subtract(W,S,B);A.cross(v,B,P);A.normalize(P,P);S=P;for(W=0;3>W;W++)v=3*l+W,B=3*n+W,s[3*m+W]=r*S[W],s[v]=y*S[W],s[B]=u*S[W]}if(c)for(var U in c)for(k=c[U],a=0;3>a;a++){b=3*k[0]+a;for(e=1;e<k.length;e++)h=3*k[e]+a,f[b]+=f[h];for(e=1;e<k.length;e++)h=3*k[e]+a,f[h]=f[b]}for(k=0;k<d;k++){c=k;U=f;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=U[e];A.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,U[e]=a[b]}return f};
a.io=function(a,b,c){for(var d={},e=b.length/3,f=0;f<e;f++){var h=String(b[3*f])+String(b[3*f+1])+String(b[3*f+2]);d[h]=[]}e=a.length;for(f=0;f<e;f++)b=a[f],h=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),h in d&&d[h].push(b);return d};a.Al=function(a,b,c,d){var e=u(a,null,!1);if(c)var f=u(a,null,!0);var h=e.length,g=new Float32Array(h),q=C,k=M;for(a=0;a<h;a++){var m=e[a];q.set(m.subarray(0,3));k.set(m.subarray(3,6));y.set(m.subarray(6));g[a]=Math.sqrt(F(q,k,y))}q=new Float32Array(h);q[0]=g[0];
for(a=1;a<h;a++)q[a]=q[a-1]+g[a];h=q[g.length-1];g=[];for(a=0;a<b;a++){var k=h*v.tc(d),k=v.Wi(q,k,0,q.length-1),m=c?f[k]:e[k],k=a,l=m,n=d,m=void 0,m=new Float32Array(3),r=l[0],z=l[1],s=l[2],B=l[3],S=l[4],W=l[5],x=l[6],A=l[7],P=l[8],l=v.tc(n),n=v.tc(n);1<l+n&&(l=1-l,n=1-n);var U=1-l-n,z=U*z+l*S+n*A,s=U*s+l*W+n*P;m[0]=U*r+l*B+n*x;m[1]=z;m[2]=s;g[k]=m}return g};a.vB=u;a.cp=q;a.UC=F;a.Fw=function(a,b,c,d){var e=b[0]-a[0],f=c[0]-a[0],h=b[1]-a[1],g=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=h*a-b*g;d[1]=f*
b-e*a;d[2]=e*g-h*f;return d};a.sy=function(a,b,c){a=a.u[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]}};b4w.module.__objects=function(a,p){function c(a){a={type:a,ud:0,Ww:[0,0],g:new Float32Array(3),quat:new Float32Array(4),Sd:new Float32Array(8),L:new Float32Array(16),Sp:new Float32Array(16),Ua:new Float32Array(3),Ed:new Float32Array(3),Ag:0,ne:0,lk:!1,Ur:!1,P:0,fn:1,en:1,gn:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,gf:null,Or:!1,wd:0,mg:0,tb:!1,Ia:null,Ga:null,Sa:null,Xo:!0,K:null,rj:null,Mh:0,Hh:0,wl:0,$h:0,Df:0,Lq:"",sk:!1,Vb:!1,Cb:!1,Wb:!1,ec:!1,Ub:!1,Bc:!1,af:!1,cd:!1,lj:!1,yd:!1,Da:!1,
ng:!1,Sh:!1,Jj:!1,Sc:!1,Tj:!1,Fj:!1,is_visible:!1,Fi:0,dd:0,Pe:0,ee:0,de:0,be:0,Id:"",Hb:null,Vi:!1,od:!1,wh:"",Pk:!1,kf:0,time:0,dn:0,Wr:0,max_bones:0,Lh:!1,vk:!1,Wh:!1,Zd:!1,Yd:1,Fk:0,Ek:1,pk:new Int8Array([-1,-1]),hk:[],jq:[],nr:[],dc:null,cc:null,lc:null,kc:null,oc:null,Mq:null,Ff:null,ai:null,Lb:null,Mk:null,Kk:null,Lk:null,Na:null,yc:null,ub:null,Ze:null,$e:null,scale:1,pe:1E4};F.identity(a.quat);u.identity(a.Sd);x.identity(a.L);x.identity(a.Sp);return a}function b(a,b,c,d){var e=a.d.H,f;for(f in e){var h=
a.name+"_"+f;f in d||(d[f]=b.length,b.push(e[f][0]));c.push(h,d[f])}}var e=p("__animation"),d=p("__batch"),l=p("__boundings"),g=p("__camera"),f=p("__config"),r=p("__constraints"),h=p("__curve"),n=p("__lights"),m=p("__nla"),s=p("__particles");p("__print");var B=p("__scenes"),z=p("__transform"),u=p("__tsr"),q=p("__util"),F=p("quat"),k=p("vec3"),x=p("mat4"),v=f.p,G=0,A=new Float32Array(4);a.gj=c;a.cn=function(a,f){var y;y=a.parent;if(!(y=y&&y.Dn)){if(!(y="ARMATURE"===a.type||"CAMERA"===a.type)&&(y="MESH"===
a.type)){var F=e.Cj(a),H=a.b4w_do_not_batch,p=a.b4w_dynamic_geometry,J=a.b4w_collision,D=a.b4w_vehicle,T=a.b4w_floating;y=a.b4w_character;var K=a.b4w_billboard,R=s.Zw(a),N=m.Lp(a);if(!(F=F||H||p||J||D||T))a:{F=a.data;for(H=0;H<F.materials.length;H++)if("LENS_FLARES"===F.materials[H].name){F=!0;break a}F=!1}y=F||R||y||K||N}!y&&(y="EMPTY"===a.type)&&(y=e.Cj(a),K=m.Lp(a),y=y||K)}y=y?!0:!1;a.Dn=y;a.d=c("MESH"===a.type?y?"DYNAMIC":"STATIC":a.type);a.kb=null;a.Wd=[];a.Kb||(a.Kb=null);y=a.d;R=a.location;
K=a.scale[0];q.Yx(a.rotation_quaternion,A);z.set_translation(a,R);z.set_rotation(a,A);z.set_scale(a,K);switch(a.type){case "ARMATURE":R=a.pose.bones;for(K=0;K<R.length;K++)N=R[K],F=N.bone,H=new Float32Array(F.matrix_local),p=new Float32Array(16),x.invert(H,p),J=new Float32Array(N.matrix_basis),D=new Float32Array(3),k.subtract(F.tail_local,F.head_local,D),q.fA(D,p,D),N.yt=D,N.st=[N].concat(N.parent_recursive),N.Fn=u.lp(H,u.create()),N.En=u.lp(J,u.create()),N.Bk=u.create(),N.Oi=!1;R=e.ku(a);y.oc=R;
R=e.ho(a,R);a.b4w_animation_mixing?(y.dc=new Float32Array(R.ra),y.cc=new Float32Array(R.ra),y.lc=new Float32Array(R.g),y.kc=new Float32Array(R.g)):(y.dc=R.ra,y.cc=R.ra,y.lc=R.g,y.kc=R.g);y.Mq=R;y.kf=0;y.Zd=a.b4w_animation_mixing;break;case "MESH":y.Sc=v.all_objs_selectable||a.b4w_selectable;y.Tj=a.b4w_selectable;y.od=a.b4w_billboard;y.fu=a.b4w_pres_glob_orientation;y.wh="BASIC";y.Pk="SPHERICAL"==a.b4w_billboard_geometry;y.rj={Rw:a.b4w_glow_settings.glow_duration,Tw:a.b4w_glow_settings.glow_period,
Uw:a.b4w_glow_settings.glow_relapses};y.Sc&&(a.Cn=q.$v(G),G++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.d.vk=a.data.b4w_vertex_anim.length?!0:!1;if(K=e.get_first_armature_object(a)){R=a.d;N=a.data.vertex_groups;if(N.length){F=K.data.bones;H=K.pose.bones;p=0;J={};for(D=0;D<F.length;D++){var T=F[D].name,ca=q.keysearch("name",T,N);if(ca){var O=q.Fl(H,"name",T);J[T]={co:D,Eh:p++,tm:O,Zr:ca.index}}}R.oc=J;R.max_bones=p;R.Wh=!0}R=a.d.oc;R=e.ho(K,R);K.b4w_animation_mixing?(y.dc=new Float32Array(R.ra),
y.cc=new Float32Array(R.ra),y.lc=new Float32Array(R.g),y.kc=new Float32Array(R.g)):(y.dc=R.ra,y.cc=R.ra,y.lc=R.g,y.kc=R.g);y.Mq=R;y.kf=0}if(e.Ml(a)){K=a.d;R=a.data.materials;N=[];F=[];for(H=0;H<R.length;H++)if((p=R[H].node_tree)&&p.animation_data)for(D=p.animation_data,p={},(J=D.action)&&b(J,N,F,p),D=D.nla_tracks,T=0;T<D.length;T++)for(ca=D[T].strips,O=0;O<D[T].strips.length;O++)J=ca[O].action,b(J,N,F,p);K.Ff=N;K.ai=F}a.W=[];y.Vb=a.b4w_shadow_cast;y.Cb=a.b4w_shadow_receive;y.Wb=a.b4w_shadow_cast_only&&
y.Vb;y.ec=a.b4w_reflexible;y.Ub=a.b4w_reflexible_only&&y.ec;y.Bc=a.b4w_reflective;y.af=a.b4w_caustics;y.cd=a.b4w_wind_bending;y.Fi=a.b4w_wind_bending_angle;K=d.mA(a.b4w_wind_bending_angle,d.bu(a.data.b4w_bounding_box),a.scale[0]);y.dd=K;y.Pe=a.b4w_wind_bending_freq;y.ee=a.b4w_detail_bending_freq;y.de=a.b4w_detail_bending_amp;y.be=a.b4w_branch_bending_amp;y.Sh=!1;y.Id=a.b4w_main_bend_stiffness_col;K=a.b4w_detail_bend_colors;y.Hb={};y.Hb.cq=K.leaves_stiffness_col;y.Hb.bq=K.leaves_phase_col;y.Hb.sq=
K.overall_stiffness_col;y.ng=a.b4w_do_not_cull;y.lj=a.b4w_disable_fogging;y.yd=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";K=a.data.materials[0];y.Mh=K.physics.friction;y.Hh=K.physics.elasticity;y.$h=0;y.pe=1E4;y.Df=a.b4w_lod_transition;y.Jj=!0;break;case "CAMERA":g.ou(a);g.Yt(a);break;case "LAMP":n.qx(a);break;case "CURVE":if(K=h.dv(a))a.xt=K;break;case "EMPTY":y.Lb=l.ed(),K=l.Gi(),y.yc=K}if(!f&&(a.parent&&"OBJECT"==a.parent_type?(R=y.g,N=y.quat,K=y.scale,r.Nn(a,a.parent,R,N,K)):
a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?(R=y.g,N=y.quat,K=y.scale,r.Mn(a,a.parent,a.parent_bone,R,N,K)):a.Kb&&a.Kb.b4w_group_relative?(K=u.lg(y.g,y.scale,y.quat),r.Et(a,a.Kb,K)):a.Kb&&!a.Kb.b4w_group_relative&&(z.v(a),N=y.L,x.multiply(a.Kb.d.L,N,N),R=q.Ef(N),K=q.Lj(N),N=q.matrix_to_quat(N),z.set_translation(a,R),z.set_rotation(a,N),z.set_scale(a,K)),K=a.dupli_group))for(R=K.objects,K=0;K<R.length;K++)R[K].Kb=a;a.field&&(y.wl=a.field.strength,B.Rr(a));y.sk=a.game.use_collision_compound;
y.Lq=a.game.physics_type;z.v(a)};a.Rz=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.d||"DYNAMIC"!=c.d.type&&"CAMERA"!=c.d.type||z.v(c);c.b4w_use_default_animation&&e.Cj(c)&&(e.apply_def(c),c.C&&e.play(c,null,e.SLOT_ALL))}};a.Dj=function(a){return"MESH"==a.type&&a.Dn?!0:!1};a.get_meta_tags=function(a){a=a.b4w_object_tags;return{title:a.title,description:a.description,category:a.category}};a.cleanup=function(){G=0}};b4w.module.__particles=function(a,p){function c(){throw"_rand() undefined";}function b(a,b,c,d,e,f,h){var g=a.M.nl,l=a.M.Mc,n=a.M.time;a=a.M.Oq;for(var C=b?4:1,p=0;p<g.length;p+=C){var y=g[p];if(y>a&&y<=n)for(y=0;8>y;y++)l[8*p+y]=e[y];for(y=0;8>y;y++)m[y]=l[8*p+y];y=s;y[0]=c[3*p];y[1]=c[3*p+1];y[2]=c[3*p+2];r.xi(y,m,y);f[3*p]=y[0];f[3*p+1]=y[1];f[3*p+2]=y[2];var I=s;I[0]=d[3*p];I[1]=d[3*p+1];I[2]=d[3*p+2];r.nk(I,m,I);h[3*p]=I[0];h[3*p+1]=I[1];h[3*p+2]=I[2];if(b)for(y=1;4>y;y++)f[3*(p+y)]=f[3*p],f[3*
(p+y)+1]=f[3*p+1],f[3*(p+y)+2]=f[3*p+2],h[3*(p+y)]=I[0],h[3*(p+y)+1]=I[1],h[3*(p+y)+2]=I[2]}}function e(a){a?(f.mz(a),c=function(){return f.$x()}):c=function(){return Math.random()}}var d=p("__config"),l=p("__geometry"),g=p("__scenes"),f=p("__util"),r=p("__tsr"),h=p("vec3"),n=d.kd,m=new Float32Array(8),s=new Float32Array(3);a.zg=function(a){return 0<a.particle_systems.length?!0:!1};a.zj=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.VB=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.Zw=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.ew=function(a,d,g,q){g.M=g.M||{};var m=l.Mv(d),k=g.settings.count,r=g.settings.frame_start/n.Ba,s=g.settings.frame_end/n.Ba,G=g.settings.lifetime/n.Ba,A=g.settings.lifetime_random,C=g.settings.emit_from,p=
g.settings.factor_random,y=g.settings.angular_velocity_mode,I=g.settings.angular_velocity_factor,H=g.settings.b4w_randomize_emission,Y=g.settings.b4w_cyclic;e(g.seed);var J=g.M.cA="WORLD"==g.settings.b4w_coordinate_system?!0:!1;g.M.frame=0;if(d=!a.pf){var D;D=[];for(var T=0;T<k;T++)D.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);D=new Float32Array(D);for(var T=[],K=0;K<k;K++)T.push(4*K,4*K+2,4*K+1,4*K,4*K+3,4*K+2);T=new Uint16Array(T)}switch(C){case "VERT":for(var K=m.u[0].a_position,m=m.u[0].a_normal,R=K.length/
3,C=[],N=0;N<k;N++){var ca=Math.round((R-1)*c());C.push(ca);d&&(C.push(ca),C.push(ca),C.push(ca))}R=[];for(N=0;N<C.length;N++)R.push(K[3*C[N]]),R.push(K[3*C[N]+1]),R.push(K[3*C[N]+2]);K=new Float32Array(R);R=[];for(N=0;N<C.length;N++)R.push(m[3*C[N]]),R.push(m[3*C[N]+1]),R.push(m[3*C[N]+2]);C=new Float32Array(R);break;case "FACE":K=[];C=[];N=[];f.Bj(0,N);R=l.Al(m,k,!1,N);f.Bj(0,N);m=l.Al(m,k,!0,N);for(N=0;N<R.length;N++)K.push(R[N][0],R[N][1],R[N][2]),d&&(K.push(R[N][0],R[N][1],R[N][2]),K.push(R[N][0],
R[N][1],R[N][2]),K.push(R[N][0],R[N][1],R[N][2])),C.push(m[N][0],m[N][1],m[N][2]),d&&(C.push(m[N][0],m[N][1],m[N][2]),C.push(m[N][0],m[N][1],m[N][2]),C.push(m[N][0],m[N][1],m[N][2]));K=new Float32Array(K);C=new Float32Array(C);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}C=[K,C];m=C[0];C=C[1];g.M.Tx=new Float32Array(m);g.M.Kx=new Float32Array(C);g.M.Ux=new Float32Array(m.length);g.M.Lx=new Float32Array(C.length);g.M.time=0;g.M.Oq=
-1;K=[];s=(s-r)/k;for(R=0;R<k;R++)N=H?s*R+10*s*(.5-c()):s*R,Y||(N+=r),K.push(N),d&&(K.push(N),K.push(N),K.push(N));r=new Float32Array(K);g.M.nl=new Float32Array(r);g.M.Qo=new Float32Array(r);g.M.Mc=new Float32Array(8*r.length);for(H=0;H<8*r.length;H++)for(Y=0;8>Y;Y++)g.M.Mc[8*H+Y]=q[Y];J&&b(g,d,m,C,q,m,C);g=[];q=G*A;for(A=0;A<k;A++)J=q*c(),g.push(G-J),d&&(g.push(G-J),g.push(G-J),g.push(G-J));G=new Float32Array(g);g=[];for(q=0;q<k;q++){A=[c()-.5,c()-.5,c()-.5];h.normalize(A,A);g.push(p*A[0]);g.push(p*
A[1]);g.push(p*A[2]);switch(y){case "NONE":g.push(0);break;case "SPIN":case "VELOCITY":g.push(I);break;case "RAND":g.push(2*I*(c()-.5));break;default:throw"Undefined velocity factor";}if(d)for(A=g.slice(-4),J=0;12>J;J++)g.push(A[J%4])}k=new Float32Array(g);p=f.wb("EMITTER_PARTICLES");y=f.td();y.a_position=m;y.a_normal=C;p.u[0]=y;d?p.ca=T:(a.xd=l.tn,p.ca=new Uint16Array(0));p.I=m.length/3;p.D.a_p_delay=r;p.D.a_p_lifetime=G;p.D.a_p_vels=k;d&&(p.D.a_p_bb_vertex=D);return p};a.Nz=function(a){for(var c=
a.W,d=0;d<c.length;d++){var e=c[d],f=c[d].Qc;if(f){var h=e.mb;if(!f.M.cA)break;var g=f.M.Ux,m=f.M.Lx;b(f,!e.pf,f.M.Tx,f.M.Kx,a.d.Sd,g,m);l.vx(h);l.rk(h,"a_position",3,g);l.rk(h,"a_normal",3,m)}}};a.Cy=function(a,b,c){var d=b.settings.lifetime/n.Ba,e=b.settings.normal_factor,f=9.81*b.settings.effector_weights.gravity,h=b.settings.effector_weights.wind,m=b.settings.mass,l=b.settings.b4w_fade_in/n.Ba,r=b.settings.b4w_fade_out/n.Ba,s=b.settings.b4w_cyclic;a.Bq=b.settings.frame_end/n.Ba-b.settings.frame_start/
n.Ba;a.xq=s?1:0;a.pm=e;a.Aq=f;e=g.Qw();a.Uj[0]=e[0]*h;a.Uj[1]=e[1]*h;a.Uj[2]=e[2]*h;a.Dq=d;a.Cq=m;a.yq=l;a.zq=r;a.pf?(d=c.halo.size,h=c.halo.hardness,30>h?(h=.5,m=.9):40>h?(h=.1,m=1):50>h?(h=0,m=.8):(h=0,m=.5)):(d=b.settings.particle_size,m=h=1);a.qm=d;a.uq=h;a.tq=m;d=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(d[0]&&d[0].use_map_size&&d[0].texture&&"BLEND"==d[0].texture.type&&d[0].texture.use_color_ramp){d=d[0].texture.color_ramp.elements;h=Math.min(2*d.length,b.length);for(m=0;m<h;m+=2)l=
d[m/2],b[m]=l.position,b[m+1]=(l.color[0]+l.color[1]+l.color[2])/3;a.Fq=d.length}a.Eq.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){d=b[0].texture.color_ramp.elements;h=Math.min(4*d.length,c.length);for(m=0;m<h;m+=4)l=d[m/4],c[m]=l.position,c[m+1]=l.color[0],c[m+2]=l.color[1],c[m+3]=l.color[2];a.wq=d.length}a.vq.set(c)};a.My=function(a,b){a.M.Oq=a.M.time;a.M.time=b};a.Vx=
function(a){for(var b=a.I,c=a.u[0].a_position,d=a.D.a_texcoord,e=[],f=[],h=0;h<b;h++)f.push(c[3*h]),f.push(c[3*h+1]),e.push(c[3*h+2]);e=new Float32Array(e);f=new Float32Array(f);a.D.a_lf_dist=e;a.D.a_lf_bb_vertex=f;a.D.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.W;for(var d=0;d<a.length;d++){var e=a[d],f=e.Qc;f&&f.name==b&&(e.qm=c)}};a.set_normal_factor=function(a,b,c){a=a.W;for(var d=0;d<a.length;d++){var e=a[d],f=e.Qc;f&&f.name==b&&(e.pm=c)}};a.set_factor=function(a,b,c){a=a.W;for(var d=
0;d<a.length;d++){var e=a[d],f=e.Qc;if(f&&f.name==b){var h=f.M.nl;if(1==c)f=h;else if(0==c)for(var g=!e.pf,m=g?4:1,f=f.M.Qo,n=0;n<f.length;n+=m)f[n]=1E4,g&&(f[n+1]=f[n],f[n+2]=f[n],f[n+3]=f[n]);else for(var r=1/c,f=f.M.Qo,m=(g=!e.pf)?4:1,s=0,n=0;n<f.length;n+=m)n>=s?(f[n]=h[n],s+=r):f[n]=1E4,g&&(f[n+1]=f[n],f[n+2]=f[n],f[n+3]=f[n]);l.rk(e.mb,"a_p_delay",1,f)}}};a.Yz=function(a,b,c){a=a.particle_systems;for(var d=0;d<a.length;d++){var e=a[d];if("EMITTER"==e.settings.type)for(var f=e.M.nl,d=0;d<8*f.length;d++)e.M.Mc[8*
d]=b[0],e.M.Mc[8*d+1]=b[1],e.M.Mc[8*d+2]=b[2],e.M.Mc[8*d+3]=b[3],e.M.Mc[8*d+4]=c[0],e.M.Mc[8*d+5]=c[1],e.M.Mc[8*d+6]=c[2],e.M.Mc[8*d+7]=c[3]}}};b4w.module.__primitives=function(a,p){function c(a,b,c,d){for(var e=[],f=[],l=[],u=[],q=2*c/(a-1),p=2*d/(b-1),k=0;k<a;k++)for(var x=-c+k*q,v=0;v<b;v++)if(f.push(x,0,-d+v*p),l.push(0,1,0),u.push(k/(a-1),v/(b-1)),k&&v){var G=k*b+v,A=G-1,C=(k-1)*b+v,M=C-1;e.push(G,A,C);e.push(A,M,C)}a=g.td();a.a_position=new Float32Array(f);a.a_normal=new Float32Array(l);l=g.wb("GRID_PLANE");l.u[0]=a;l.D.a_texcoord=new Float32Array(u);l.ca=new Uint32Array(e);l.I=f.length/3;return l}function b(a){var b=a.length;if(b%
4)throw"Wrong array";for(var c=[],e=[],f=0;f<b;f+=4){var l=a[f+1],z=a[f+2],u=a[f+3];d(a[f],e);d(l,e);d(z,e);d(u,e);c.push(f,f+1,f+2);c.push(f,f+2,f+3)}a=g.td();a.a_position=new Float32Array(e);b=g.wb("FROM_QUADS");b.u[0]=a;b.ca=new Uint32Array(c);b.I=e.length/3;return b}function e(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function d(a,b){b.push(a[0],a[1],a[2])}var l=p("__geometry"),g=p("__util"),f=p("__config").p;a.LB=function(a){for(var b=g.wb("LINE"),c=[],d=0;d<2*a;d++)c.push(d);d=g.td();d.a_point=
new Float32Array(c);b.u[0]=d;b.ca=new Uint32Array(c);b.I=2*a;return b};a.MB=function(a,b){var d=c(2,2,a,b);d.name="PLANE";return d};a.KB=c;a.iw=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==u-1)||1==b%2&&(0==a||a==z-1)?!0:!1}var e=c/=Math.pow(2,a-1),B=c,z=b+1,u=b+1;b=[];c=[];for(var q=0,p=0,k=-1,x=[],v=0;v<a;v++){for(var G=2*e/(z-1),A=2*B/(u-1),C=[],M=[],y=0,I=0;I<z;I++){for(var H=-e+I*G,Y=[],J=0;J<u;J++){var D=-B+J*A;if(H>-q&&H<q&&D>-p&&D<p)Y.push(-1),y++;else{for(var T=null,K=0;K<x.length;K+=
3)if(H==x[K]&&D==x[K+1]){T=x[K+2];break}K=null!==T?T:k+1;d(I,J)?(Y.push(-2),y++):(null==T&&(0==J||J==u-1||0==I||I==z-1?(T=v==a-1?G:2*G,C.push(H,D,K)):T=G,c.push(H,T,D),k++),Y.push(K));if(I&&J)if(1==I)if(d(I-1,J)){if(1<J){var D=K-1,T=M[I-1][J+1],R=T-1;b.push(K,D,R)}else T=M[I-1][J+1],R=T-1;b.push(K,R,T)}else d(I,J)||(D=K-1,T=M[I-1][J],b.push(K,D,T));else if(I==z-1){if(!d(I,J))if(J==u-1)D=K-1,T=M[I-1][J-1],R=M[I-2][J],b.push(K,D,T),b.push(K,T,R);else{var D=K-1,T=M[I-1][J],R=T-1,N=T+1;b.push(K,D,R);
b.push(K,R,T);b.push(K,T,N);2==J&&(N=M[I-2][J-2],b.push(D,N,R))}}else 1==J?d(I,J-1)?(D=M[I-1][J],T=M[I-1][J-1],b.push(K,T,D)):(D=Y[J-1],T=M[I-1][J],R=M[I-2][J-1],b.push(K,D,T),b.push(D,R,T)):J==u-1?d(I,J)||(D=Y[J-1],T=M[I-1][J-1],R=M[I-2][J],b.push(K,D,T),b.push(K,T,R)):-1!=M[I-1][J]&&-1!=M[I-1][J-1]&&-1!=Y[J-1]?(D=Y[J-1],T=M[I-1][J],R=M[I-1][J-1],b.push(K,D,T),b.push(D,R,T),J==u-2&&d(I,J+1)&&(N=M[I-1][J+1],b.push(K,T,N))):J==u-2&&d(I,J+1)&&(T=M[I-1][J],N=M[I-1][J+1],b.push(K,T,N))}}M.push(Y)}x=C;
q=e;p=B;e*=2;B*=2}2E4>q&&(a=-(2*q)/(z-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-q,a,-p),c.push(-q,a,p),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(q,a,-p),c.push(q,a,p),K=k+1,b.push(K+3,K+2,K+1,K+2,K+0,K+1,K+6,K+4,K+2,K+4,K+0,K+2,K+5,K+7,K+1,K+7,K+3,K+1,K+5,K+4,K+7,K+7,K+4,K+6));a=g.td();a.a_position=new Float32Array(c);e=g.wb("multigrid_plane");e.u[0]=a;e.ca=new Uint32Array(b);e.I=c.length/3;f.ds&&(l.Sm(e,1,!0),a.a_polyindex=l.cp(e));return e};a.JB=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var c=[],e=[],f=0;f<b;f+=3){var l=a[f+1],z=a[f+2];d(a[f],e);d(l,e);d(z,e);c.push(f,f+1,f+2)}a=g.td();a.a_position=new Float32Array(e);b=g.wb("FROM_TRIANGLES");b.u[0]=a;b.ca=new Uint32Array(c);b.I=e.length/3;return b};a.IB=b;a.fw=function(a){a=g.gA(a);var c=[];c.push(a[0],a[1],a[2],a[3]);c.push(a[0],a[3],a[5],a[4]);c.push(a[3],a[2],a[6],a[5]);c.push(a[1],a[7],a[6],a[2]);c.push(a[0],a[4],a[7],a[1]);c.push(a[4],a[5],a[6],a[7]);a=b(c);a.name="FRUSTUM";return a};a.gw=function(){var a=g.wb("BILLBOARD"),
b=g.td();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.u[0]=b;a.ca=new Uint32Array([0,2,1,1,2,3]);a.I=4;return a};a.Ha=function(){var a=g.wb("BILLBOARD"),b=g.td();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.u[0]=b;a.ca=new Uint32Array([0,2,1,0,3,2]);a.I=4;return a};a.cw=function(){var a=g.wb("CUBEMAP_BOARD"),b=g.td();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.u[0]=b;a.ca=new Uint32Array([0,2,1,0,3,2]);a.I=4;return a};a.op=function(a,b){var c=g.wb("UV_SPHERE"),
f,s,B=[],z=[],u=[];for(s=0;8>=s;s++)for(f=0;16>=f;f++){var q=f/16,p=s/8;z.push(-a*Math.cos(2*q*Math.PI)*Math.sin(p*Math.PI)+b[0],a*Math.cos(p*Math.PI)+b[1],a*Math.sin(2*q*Math.PI)*Math.sin(p*Math.PI)+b[2])}for(s=q=0;8>s;s++)for(f=0;16>f;f++){var p=e(z,17*s+f+1),k=e(z,17*s+f),x=e(z,17*(s+1)+f),v=e(z,17*(s+1)+f+1);Math.abs(p[1])==a+b[1]?(d(p,B),d(x,B),d(v,B),u.push(q,q+1,q+2),q+=3):Math.abs(x[1])==a+b[1]?(d(p,B),d(k,B),d(x,B),u.push(q,q+1,q+2),q+=3):(d(p,B),d(k,B),d(x,B),d(v,B),u.push(q,q+1,q+2),u.push(q,
q+2,q+3),q+=4)}f={};f.a_position=B;z=l.io(u,z,B);f.a_normal=l.fo(u,B,z);f.a_tangent=[];c.D.a_influence=[];c.D.a_color=[];c.D.a_texcoord=[];c.u[0]=f;c.ca=u;c.I=B.length/3;return c}};b4w.module.__prerender=function(a,p){var c=p("__config"),b=p("__debug"),e=p("__geometry"),d=p("__util"),l=p("__renderer"),g=p("vec3"),f=c.p,r="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH GLOW_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.um=function(a){if(-1<r.indexOf(a.type)){for(var c=!1,m=a.o,s=0;s<m.length;s++){var B=m[s],z=B,u=a,q=z.fb,p=u.j;z.U=!0;q.is_visible=!1;if(q)if(q.Sh)z.U=!1;else{var k=p.je,x=q.ub.A,v=q.pe,k=Math.sqrt((x[0]-k[0])*(x[0]-k[0])+(x[1]-
k[1])*(x[1]-k[1])+(x[2]-k[2])*(x[2]-k[2])),x=q.Df*q.ub.ua;k>=q.$h&&k<v+x?(q.is_visible=!0,"GLOW_MASK"!=u.type||Boolean(z.n.xg)?(p=p.xl,q.ng?q=!1:"STATIC"===q.type?(v=q.ub,q=v.A,q=d.hz(q,p,v.ua)):(v=q.$e,q=v.A,q=d.Ev(q,p,v.We,v.Xe,v.Ye)),q?z.U=!1:"WIREFRAME"==u.type&&(z.U=z.n.wireframe_mode==b.An.WM_DEBUG_SPHERES?z.n.kl:!z.n.kl)):z.U=!1):z.U=!1}else z.U=!1;B.U&&(c=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||c?a.U=!0:(a.U&&l.clear(a),a.U=!1)}}if("MAIN_BLEND"==
a.type&&(c=a.j.je,g.dist(c,a.fs)>f.alpha_sort_threshold&&f.alpha_sort&&a.o)){for(m=0;m<a.o.length;m++)B=a.o[m],z=B.n,s=B.fb.L,z&&z.xa&&z.Vd!=e.jd&&(z=z.mb)&&B.U&&(B=z.Aj)&&B.type==e.Bn&&e.Iz(z,s,c);a.fs.set(c)}}};b4w.module.__print=function(a){var p=!1,c=0,b=0;a.Py=function(a){p=a};a.log=function(){p&&console.log.apply(console,arguments)};a.error=function(){c++;console.error.apply(console,arguments)};a.warn=function(){b++;console.warn.apply(console,arguments)};a.time=function(){p&&console.time.apply(console,arguments)};a.timeEnd=function(){p&&console.timeEnd.apply(console,arguments)};a.group=function(){p&&console.group.apply(console,arguments)};a.groupCollapsed=function(){p&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){p&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.Pw=function(){return b};a.Bw=function(){return c};a.clear_errors_warnings=function(){c=b=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,p){function c(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=
.5,b("node material",a,"specular_toon_size"));"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in
a||(a.diffuse_fresnel_factor=.5,b("node material",a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name=
"B4W_"+a.node_tree_name}}}function b(a,b,c){c=c+">>"+a;c in B||(B[c]={Rm:[],Yq:"undefined",type:a});B[c].Rm.push(b.name)}function e(a,b){param_id in B||(B[param_id]={Rm:[],Yq:"deprecated",type:a});B[param_id].Rm.push(b.name)}function d(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=r.cf(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var f=r.Ah(d[c]);e.submeshes.push(f)}return e}var l=
p("__boundings"),g=p("__curve"),f=p("__print"),r=p("__util"),h=p("vec3"),n=p("vec4"),m=p("quat"),s=p("mat4"),B={};a.su=function(a){B={};var d=a.worlds;if(0==d.length){f.warn("WARNING Datablock world is missing, reexport scene");var g={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},b4w_fog_color:[.5,.5,.5],b4w_fog_density:0};d.push(g)}for(var d=a.worlds,h=0;h<d.length;h++){var g=d[h],k=g.b4w_shadow_settings;
"csm_resolution"in k||(b("world",g,"b4w_shadow_settings.csm_resolution"),k.csm_resolution=2048);"self_shadow_polygon_offset"in k||(b("world",g,"b4w_shadow_settings.self_shadow_polygon_offset"),k.self_shadow_polygon_offset=1);"self_shadow_normal_offset"in k||(b("world",g,"b4w_shadow_settings.self_shadow_normal_offset"),k.self_shadow_normal_offset=.01);"b4w_enable_csm"in k||(b("world",g,"b4w_shadow_settings.b4w_enable_csm"),k.b4w_enable_csm=!1);"csm_num"in k||(b("world",g,"b4w_shadow_settings.csm_num"),
k.csm_num=1);"csm_first_cascade_border"in k||(b("world",g,"b4w_shadow_settings.csm_first_cascade_border"),k.csm_first_cascade_border=10);"first_cascade_blur_radius"in k||(b("world",g,"b4w_shadow_settings.first_cascade_blur_radius"),k.first_cascade_blur_radius=3);"csm_last_cascade_border"in k||(b("world",g,"b4w_shadow_settings.csm_last_cascade_border"),k.csm_last_cascade_border=100);"last_cascade_blur_radius"in k||(b("world",g,"b4w_shadow_settings.last_cascade_blur_radius"),k.last_cascade_blur_radius=
1.5);"fade_last_cascade"in k||(b("world",g,"b4w_shadow_settings.fade_last_cascade"),k.fade_last_cascade=!0);"blend_between_cascades"in k||(b("world",g,"b4w_shadow_settings.blend_between_cascades"),k.blend_between_cascades=!0);k=g.b4w_ssao_settings;"dist_factor"in k||(b("world",g,"b4w_ssao_settings.dist_factor"),k.dist_factor=0,k.samples=16);"hemisphere"in k||(b("world",g,"b4w_ssao_settings.hemisphere"),k.hemisphere=!1);"blur_depth"in k||(b("world",g,"b4w_ssao_settings.blur_depth"),k.blur_depth=!1);
"blur_discard_value"in k||(b("world",g,"b4w_ssao_settings.blur_discard_value"),k.blur_discard_value=1);"b4w_glow_color"in g||(g.b4w_glow_color=[1,1,1],b("object",g,"b4w_glow_color"));"b4w_glow_factor"in g||(g.b4w_glow_factor=1,b("object",g,"b4w_glow_factor"));"b4w_fog_density"in g||(b("world",g,"b4w_fog_density"),g.b4w_fog_density=0);"b4w_sky_settings"in g&&"rayleigh_brightness"in g.b4w_sky_settings||(b("world",g,"rayleigh_brightness"),g.b4w_sky_settings={procedural_skydome:!1,use_as_enviroment_map:!1,
color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"b4w_bloom_settings"in g?("blur"in g.b4w_bloom_settings||(b("world",g,"b4w_bloom_settings.blur"),g.b4w_bloom_settings.blur=4),"edge_lum"in g.b4w_bloom_settings||(b("world",g,"b4w_bloom_settings.edge_lum"),g.b4w_bloom_settings.edge_lum=1)):(b("world",g,"b4w_bloom_settings"),g.b4w_bloom_settings=
{key:.2,blur:4});"b4w_motion_blur_settings"in g?("motion_blur_factor"in g.b4w_motion_blur_settings||(b("world",g,"b4w_motion_blur_settings.motion_blur_factor"),g.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in g.b4w_motion_blur_settings||(b("world",g,"b4w_motion_blur_settings.motion_blur_decay_threshold"),g.b4w_motion_blur_settings.motion_blur_decay_threshold=.01)):(b("world",g,"b4w_motion_blur_settings"),g.b4w_motion_blur_settings={motion_blur_factor:.01,motion_blur_decay_threshold:.01});
"b4w_color_correction_settings"in g||(b("world",g,"b4w_color_correction_settings"),g.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in g.b4w_god_rays_settings||(b("world",g,"b4w_god_rays_settings.steps_per_pass"),g.b4w_god_rays_settings.steps_per_pass=10)}d=a.scenes;for(h=0;h<d.length;h++)g=d[h],"b4w_use_nla"in g||(g.b4w_use_nla=!1,b("scene",g,"b4w_use_nla")),"fps"in g||(g.fps=24,b("scene",g,"fps")),"b4w_nla_cyclic"in g||(g.b4w_nla_cyclic=!1,b("scene",
g,"b4w_nla_cyclic")),"b4w_nla_script"in g||(g.b4w_nla_script=[],b("scene",g,"b4w_nla_script")),"b4w_detect_collisions"in g&&(e("scene",g),delete g.b4w_detect_collisions),"audio_doppler_speed"in g||(g.audio_doppler_speed=343.3),"audio_doppler_factor"in g||(g.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in g||(g.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",g,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in g||(g.b4w_enable_convolution_engine=
!1),"b4w_enable_bloom"in g||(g.b4w_enable_bloom=!1,b("scene",g,"b4w_enable_bloom")),"b4w_enable_motion_blur"in g||(g.b4w_enable_motion_blur=!1,b("scene",g,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in g||(g.b4w_enable_color_correction=!1,b("scene",g,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in g||(g.b4w_enable_antialiasing=!0,b("scene",g,"b4w_enable_antialiasing")),"b4w_tags"in g||(g.b4w_tags={title:"",description:""},b("scene",g,"b4w_tags"));g=a.meshes;for(h=0;h<g.length;h++)for(k=
g[h],k.b4w_bounding_box||(b("mesh",k,"b4w_bounding_box"),k.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0}),k.uv_textures||(b("mesh",k,"uv_textures"),k.uv_textures=[]),k.b4w_bounding_sphere_center||(k.b4w_bounding_sphere_center=[0,0,0]),k.b4w_bounding_cylinder_center||(k.b4w_bounding_cylinder_center=[0,0,0]),k.b4w_bounding_ellipsoid_center||(k.b4w_bounding_ellipsoid_center=[0,0,0]),k.b4w_bounding_ellipsoid_axes||(d=k.b4w_bounding_box,k.b4w_bounding_ellipsoid_axes=[(d.max_x-d.min_x)/
2,(d.max_y-d.min_y)/2,(d.max_z-d.min_z)/2]),d=0;d<k.b4w_vertex_anim.length;d++){var l=k.b4w_vertex_anim[d];"allow_nla"in l||(b('mesh["b4w_vertex_anim"]',k,"allow_nla"),l.allow_nla=!0)}d=a.cameras;for(h=0;h<d.length;h++)g=d[h],g.type||(g.type="PERSP",b("camera",g,"type")),"b4w_eye_target_dist"in g&&(delete g.b4w_eye_target_dist,e("camera",g)),"b4w_trans_velocity"in g||(g.b4w_trans_velocity=1,b("camera",g,"b4w_trans_velocity")),"b4w_rot_velocity"in g||(g.b4w_rot_velocity=1,b("camera",g,"b4w_rot_velocity")),
"b4w_zoom_velocity"in g||(g.b4w_zoom_velocity=.1,b("camera",g,"b4w_zoom_velocity")),"b4w_use_distance_limits"in g||(g.b4w_use_distance_limits=!1,b("camera",g,"b4w_use_distance_limits")),"b4w_distance_min"in g||(g.b4w_distance_min=1,b("camera",g,"b4w_distance_min")),"b4w_distance_max"in g||(g.b4w_distance_max=100,b("camera",g,"b4w_distance_max")),"b4w_horizontal_translation_min"in g||(g.b4w_horizontal_translation_min=-100,b("camera",g,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in
g||(g.b4w_horizontal_translation_max=100,b("camera",g,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in g||(g.b4w_vertical_translation_min=-100,b("camera",g,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in g||(g.b4w_vertical_translation_max=100,b("camera",g,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in g||(g.b4w_use_horizontal_clamping=!1,b("camera",g,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in g||(g.b4w_rotation_left_limit=-Math.PI,
b("camera",g,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in g||(g.b4w_rotation_right_limit=Math.PI,b("camera",g,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in g||(g.b4w_horizontal_clamping_type="LOCAL",b("camera",g,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in g||(g.b4w_use_vertical_clamping=!1,b("camera",g,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in g||(g.b4w_rotation_down_limit=-Math.PI/2,b("camera",g,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in
g||(g.b4w_rotation_up_limit=Math.PI/2,b("camera",g,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in g||(g.b4w_vertical_clamping_type="LOCAL",b("camera",g,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in g||(g.b4w_hover_angle_min=Math.PI/6,b("camera",g,"b4w_hover_angle_min")),"b4w_hover_angle_max"in g||(g.b4w_hover_angle_max=Math.PI/6,b("camera",g,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in g||(g.b4w_enable_hover_hor_rotation=!0,b("camera",g,"b4w_enable_hover_hor_rotation")),
"b4w_use_panning"in g||(g.b4w_use_panning=!0,b("camera",g,"b4w_use_panning"));d=a.lamps;for(h=0;h<d.length;h++)g=d[h],"b4w_generate_shadows"in g||(g.b4w_generate_shadows=!1,b("lamp",g,"b4w_generate_shadows")),"b4w_dynamic_intensity"in g||(g.b4w_dynamic_intensity=!1,b("lamp",g,"b4w_dynamic_intensity")),"use_diffuse"in g||(g.use_diffuse=!0,b("lamp",g,"use_diffuse")),"use_specular"in g||(g.use_specular=!0,b("lamp",g,"use_specular"));d=a.speakers;for(h=0;h<d.length;h++)g=d[h],"b4w_behavior"in g||(g.b4w_behavior=
g.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in g||(g.b4w_disable_doppler=!1),"b4w_delay"in g||(g.b4w_delay=0),"b4w_delay_random"in g||(g.b4w_delay_random=0),"b4w_volume_random"in g||(g.b4w_volume_random=0),"b4w_pitch_random"in g||(g.b4w_pitch_random=0),"b4w_fade_in"in g||(g.b4w_fade_in=0),"b4w_fade_out"in g||(g.b4w_fade_out=0),"b4w_loop"in g||(g.b4w_loop=!1),"b4w_loop_count"in g||(g.b4w_loop_count=0),"b4w_loop_count_random"in g||(g.b4w_loop_count_random=0),"b4w_playlist_id"in
g||(g.b4w_playlist_id="");d=a.textures;for(h=0;h<d.length;h++)g=d[h],"b4w_anisotropic_filtering"in g||(g.b4w_anisotropic_filtering="OFF",b("texture",g,"b4w_anisotropic_filtering")),"b4w_water_foam"in g||(g.b4w_water_foam=!1,b("texture",g,"b4w_water_foam")),"b4w_foam_uv_freq"in g||(g.b4w_foam_uv_freq=[1,1],b("texture",g,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in g||(g.b4w_foam_uv_magnitude=[1,1],b("texture",g,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in g||(g.b4w_parallax_steps=5,b("material",
g,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in g||(g.b4w_parallax_lod_dist=10,b("material",g,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in g||(g.b4w_shore_dist_map=!1,b("texture",g,"b4w_shore_dist_map")),"b4w_shore_boundings"in g||(g.b4w_shore_boundings=new Float32Array(4),g.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",g,"b4w_shore_boundings")),"b4w_max_shore_dist"in g||(g.b4w_max_shore_dist=100,b("texture",g,"b4w_max_shore_dist")),"b4w_disable_compression"in g||(g.b4w_disable_compression=
!1,b("texture",g,"b4w_disable_compression")),"b4w_source_type"in g||(g.b4w_source_type="",b("texture",g,"b4w_source_type")),"b4w_source_id"in g||(g.b4w_source_id="",b("texture",g,"b4w_source_id")),"b4w_source_size"in g||(g.b4w_source_size=1024,b("texture",g,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in g||(g.b4w_enable_canvas_mipmapping=!0,b("texture",g,"b4w_enable_canvas_mipmapping"));g=a.materials;for(h=0;h<g.length;h++){k=g[h];"b4w_node_mat_type"in k&&e("material",k);"b4w_skydome"in k&&
e("material",k);"b4w_procedural_skydome"in k&&e("material",k);k.b4w_water&&("b4w_water_shore_smoothing"in k||(k.b4w_water_shore_smoothing=!1,b("material",k,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in k||(k.b4w_water_dynamic=!1,b("material",k,"b4w_water_dynamic")),"b4w_waves_height"in k||(k.b4w_waves_height=1,b("material",k,"b4w_waves_height")),"b4w_waves_length"in k||(k.b4w_waves_length=1,b("material",k,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in k||(k.b4w_water_dst_noise_scale0=.05,
b("material",k,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in k||(k.b4w_water_dst_noise_scale1=.03,b("material",k,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in k||(k.b4w_water_dst_noise_freq0=1.3,b("material",k,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in k||(k.b4w_water_dst_noise_freq1=1,b("material",k,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in k||(k.b4w_water_dir_min_shore_fac=.4,b("material",k,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in
k||(k.b4w_water_dir_freq=.5,b("material",k,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in k||(k.b4w_water_dir_noise_scale=.05,b("material",k,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in k||(k.b4w_water_dir_noise_freq=.07,b("material",k,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in k||(k.b4w_water_dir_min_noise_fac=.5,b("material",k,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in k||(k.b4w_water_dst_min_fac=.2,b("material",k,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in
k||(k.b4w_water_waves_hor_fac=5,b("material",k,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in k||(k.b4w_water_absorb_factor=6,b("material",k,"b4w_water_absorb_factor")),"b4w_water_fog_color"in k||(k.b4w_water_fog_color=new Float32Array(3),k.b4w_water_fog_color=[.5,.7,.7],b("material",k,"b4w_water_fog_color")),"b4w_foam_factor"in k||(k.b4w_foam_factor=5,b("material",k,"b4w_foam_factor")),"b4w_generated_mesh"in k||(k.b4w_generated_mesh=!1,b("material",k,"b4w_generated_mesh")),"b4w_water_num_cascads"in
k||(k.b4w_water_num_cascads=5,b("material",k,"b4w_water_num_cascads")),"b4w_water_subdivs"in k||(k.b4w_water_subdivs=64,b("material",k,"b4w_water_subdivs")),"b4w_water_detailed_dist"in k||(k.b4w_water_detailed_dist=1E3,b("material",k,"b4w_water_detailed_dist")));"b4w_dynamic_grass_size"in k||(k.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in k||(k.b4w_dynamic_grass_color="");"diffuse_intensity"in k||(k.diffuse_intensity=1,b("material",k,"diffuse_intensity"));"b4w_use_ghost"in k||(k.b4w_use_ghost=
!1);"b4w_collision_group"in k||(k.b4w_collision_group=128,b("material",k,"b4w_collision_group"));"b4w_collision_mask"in k||(k.b4w_collision_mask=127,b("material",k,"b4w_collision_mask"));"b4w_do_not_render"in k||(k.b4w_do_not_render=!1,b("material",k,"b4w_do_not_render"));"HALO"!=k.type||"b4w_halo_sky_stars"in k||(k.b4w_halo_sky_stars=!1,b("material",k,"b4w_halo_sky_stars"));"HALO"!=k.type||"b4w_halo_stars_blend_height"in k||(k.b4w_halo_stars_blend_height=10,b("material",k,"b4w_halo_stars_blend_height"));
"HALO"!=k.type||"b4w_halo_stars_min_height"in k||(k.b4w_halo_stars_min_height=0,b("material",k,"b4w_halo_stars_min_height"));"specular_shader"in k||(k.specular_shader="COOKTORR",b("material",k,"specular_shader"));"diffuse_shader"in k||(k.diffuse_shader="LAMBERT",b("material",k,"diffuse_shader"));"roughness"in k||(k.roughness=.5,b("material",k,"roughness"));"diffuse_fresnel"in k||(k.diffuse_fresnel=.1,b("material",k,"diffuse_fresnel"));"diffuse_fresnel_factor"in k||(k.diffuse_fresnel_factor=.5,b("material",
k,"diffuse_fresnel_factor"));"specular_slope"in k||(k.specular_slope=.2,b("material",k,"specular_slope"));"specular_toon_size"in k||(k.specular_toon_size=.5,b("material",k,"specular_toon_size"));"specular_toon_smooth"in k||(k.specular_toon_smooth=.1,b("material",k,"specular_toon_smooth"));"specular_alpha"in k||(k.specular_alpha=1,b("material",k,"specular_alpha"));"b4w_wettable"in k||(k.b4w_wettable=!1,b("material",k,"b4w_wettable"));"b4w_refractive"in k||(k.b4w_refractive=!1,b("material",k,"b4w_refractive"));
"b4w_refr_bump"in k||(k.b4w_refr_bump=0,b("material",k,"b4w_refr_bump"));"b4w_shallow_water_col"in k||(k.b4w_shallow_water_col=[0,.8,.3],b("material",k,"b4w_shallow_water_col"));"b4w_shore_water_col"in k||(k.b4w_shore_water_col=[0,.9,.2],b("material",k,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in k||(k.b4w_shallow_water_col_fac=1,b("material",k,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in k||(k.b4w_shore_water_col_fac=.5,b("material",k,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in
k||(k.b4w_water_sss_strength=5.9,b("material",k,"b4w_water_sss_strength"));"b4w_water_sss_width"in k||(k.b4w_water_sss_width=.45,b("material",k,"b4w_water_sss_width"));"b4w_render_above_all"in k||(k.b4w_render_above_all=!1,b("material",k,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in k||(k.b4w_water_norm_uv_velocity=.05,b("material",k,"b4w_water_norm_uv_velocity"));l=k.texture_slots;for(d=0;d<l.length;d++){var m=l[d];"blend_type"in m||(m.blend_type="MIX",b("texture_slot",m,"blend_type"))}if(k.node_tree)for(k=
k.node_tree.nodes,d=0;d<k.length;d++)c(k[d])}g=a.node_groups;for(h=0;h<g.length;h++)for(k=g[h].node_tree.nodes,d=0;d<k.length;d++)c(k[d]);g=a.objects;for(h=0;h<g.length;h++){k=g[h];switch(k.type){case "MESH":"b4w_dynamic_geometry"in k||(k.b4w_dynamic_geometry=!1);"b4w_reflexible"in k||(k.b4w_reflexible=!1);"b4w_reflexible_only"in k||(k.b4w_reflexible_only=!1);"b4w_reflective"in k||(k.b4w_reflective=!1);"b4w_wind_bending"in k||(k.b4w_wind_bending=!1,b("object",k,"b4w_wind_bending"));"b4w_wind_bending_angle"in
k||(k.b4w_wind_bending_angle=10,k.b4w_wind_bending_freq=.25,b("object",k,"wind bending params"));"b4w_detail_bending_amp"in k||(k.b4w_detail_bending_amp=.1,k.b4w_branch_bending_amp=.3,b("object",k,"detail bending params"));"b4w_detail_bending_freq"in k||(k.b4w_detail_bending_freq=1,b("object",k,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in k||(k.b4w_main_bend_stiffness_col="",b("object",k,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in k||(k.b4w_detail_bend_colors={leaves_stiffness_col:"",
leaves_phase_col:"",overall_stiffness_col:""},b("object",k,"b4w_detail_bend_colors"));"b4w_caustics"in k||(k.b4w_caustics=!1);"vertex_groups"in k&&k.vertex_groups.length&&k.data&&0==k.data.vertex_groups.length&&(k.data.vertex_groups=k.vertex_groups,delete k.vertex_groups,b("object",k,"vertex_groups"));"b4w_vertex_anim"in k&&k.b4w_vertex_anim.length&&k.data&&0==k.data.b4w_vertex_anim.length&&(k.data.b4w_vertex_anim=k.b4w_vertex_anim,delete k.b4w_vertex_anim,b("object",k,"b4w_vertex_anim"));"b4w_do_not_render"in
k||(k.b4w_do_not_render=!1);"use_ghost"in k.game||(k.game.use_ghost=!1);"use_sleep"in k.game||(k.game.use_sleep=!1);"velocity_min"in k.game||(k.game.velocity_min=0);"velocity_max"in k.game||(k.game.velocity_max=0);"collision_group"in k.game||(k.game.collision_group=1);"collision_mask"in k.game||(k.game.collision_mask=255);"b4w_vehicle_settings"in k?k.b4w_vehicle_settings&&("steering_ratio"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.steering_ratio=10),"steering_max"in k.b4w_vehicle_settings||
(k.b4w_vehicle_settings.steering_max=1),"inverse_control"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.inverse_control=!1),"force_max"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.force_max=1500),"brake_max"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.brake_max=100),"speed_ratio"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in k.b4w_vehicle_settings||
(k.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.roll_influence=
.1),"max_suspension_travel_cm"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.floating_factor=3),"floating_factor"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in k.b4w_vehicle_settings||(k.b4w_vehicle_settings.water_rot_damp=.9)):(k.b4w_vehicle_settings=null,b("object",k,"b4w_vehicle_settings"));
"b4w_floating_settings"in k?k.b4w_floating_settings&&("floating_factor"in k.b4w_floating_settings||(k.b4w_floating_settings.floating_factor=3),"water_lin_damp"in k.b4w_floating_settings||(k.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in k.b4w_floating_settings||(k.b4w_floating_settings.water_rot_damp=.8)):(k.b4w_floating_settings=null,b("object",k,"b4w_floating_settings"));"b4w_character_settings"in k?k.b4w_character_settings&&("walk_speed"in k.b4w_character_settings||(k.b4w_character_settings.walk_speed=
4),"run_speed"in k.b4w_character_settings||(k.b4w_character_settings.run_speed=8),"step_height"in k.b4w_character_settings||(k.b4w_character_settings.step_height=.25),"jump_strength"in k.b4w_character_settings||(k.b4w_character_settings.jump_strength=5),"waterline"in k.b4w_character_settings||(k.b4w_character_settings.waterline=0)):(k.b4w_character_settings=null,b("object",k,"b4w_character_settings"));"b4w_selectable"in k||(k.b4w_selectable=!1,b("object",k,"b4w_selectable"));"b4w_billboard"in k||
(k.b4w_billboard=!1,b("object",k,"b4w_billboard"));"b4w_billboard_geometry"in k||(k.b4w_billboard_geometry="SPHERICAL",b("object",k,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in k||(k.b4w_pres_glob_orientation=!1,b("object",k,"b4w_pres_glob_orientation"));"b4w_glow_settings"in k||(k.b4w_glow_settings={},k.b4w_glow_settings.glow_duration=1,k.b4w_glow_settings.glow_period=1,k.b4w_glow_settings.glow_relapses=0,b("object",k,"b4w_glow_settings"));"b4w_lod_transition"in k||(k.b4w_lod_transition=
.01,b("object",k,"b4w_lod_transition"));"lod_levels"in k||(k.lod_levels=[],b("object",k,"lod_levels"));"b4w_animation_mixing"in k||(k.b4w_animation_mixing=!1,b("object",k,"b4w_animation_mixing"));break;case "EMPTY":"b4w_group_relative"in k||(k.b4w_group_relative=!1,b("object",k,"b4w_group_relative"))}"b4w_anim_behavior"in k||(k.b4w_anim_behavior=k.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",k,"b4w_anim_behavior"));if(!("rotation_quaternion"in k)){d=[0,0,0,1];r.euler_to_quat(k.rotation_euler,
d);var l=d,m=d[0],n=d[1],s=d[2];l[0]=d[3];l[1]=m;l[2]=n;l[3]=s;k.rotation_quaternion=d;b("object",k,"rotation_quaternion")}"webgl_do_not_batch"in k&&(k.b4w_do_not_batch=k.webgl_do_not_batch)&&e("object",k);"b4w_shadow_cast_only"in k||(k.b4w_shadow_cast_only=!1,b("object",k,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in k||(k.b4w_correct_bounding_offset="AUTO",b("object",k,"b4w_correct_bounding_offset"));l=k.particle_systems;for(d=0;d<l.length;d++)m=l[d],n=m.settings,"use_whole_group"in n||
(n.use_whole_group=!1,b("object",n,"use_whole_group")),m.transforms||(m.transforms=new Float32Array,b("particle_system",m,"transforms")),"b4w_billboard_align"in n||(n.b4w_billboard_align="VIEW",b("particle_settings",n,"b4w_billboard_align")),"b4w_dynamic_grass"in n||(n.b4w_dynamic_grass=!1,b("object",n,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in n||(n.b4w_dynamic_grass_scale_threshold=.01,b("object",n,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in n||(n.b4w_initial_rand_rotation=
!1,b("particle_settings",n,"b4w_initial_rand_rotation")),"b4w_rotation_type"in n||(n.b4w_rotation_type="Z",b("particle_settings",n,"b4w_rotation_type")),"b4w_rand_rotation_strength"in n||(n.b4w_rand_rotation_strength=1,b("particle_settings",n,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in n||(n.b4w_hair_billboard=!1,b("particle_settings",n,"b4w_hair_billboard")),"b4w_hair_billboard_type"in n||(n.b4w_hair_billboard_type="BASIC",b("particle_settings",n,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in
n||(n.b4w_hair_billboard_jitter_amp=0,b("particle_settings",n,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in n||(n.b4w_hair_billboard_jitter_freq=0,b("particle_settings",n,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in n||(n.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",n,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in n||(n.b4w_wind_bend_inheritance="PARENT",b("particle_settings",n,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in
n||(n.b4w_shadow_inheritance="PARENT",b("particle_settings",n,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in n||(n.b4w_reflection_inheritance="PARENT",b("particle_settings",n,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in n||(n.b4w_vcol_from_name="",b("particle_settings",n,"b4w_vcol_from_name")),"b4w_vcol_to_name"in n||(n.b4w_vcol_to_name="",b("particle_settings",n,"b4w_vcol_to_name")),"b4w_coordinate_system"in n||(n.b4w_coordinate_system="LOCAL",b("particle_settings",n,"b4w_coordinate_system")),
"b4w_allow_nla"in n||(n.b4w_allow_nla=!0,b("particle_settings",n,"b4w_allow_nla"));"constraints"in k||(k.constraints=[],b("object",k,"constraints"));l=k.modifiers;for(d=0;d<l.length;d++){a:{m=l[d];switch(m.type){case "ARRAY":if(!("fit_type"in m)){f.error("WARNING Incomplete modifier "+String(m.type)+' for "'+k.name+'", reexport '+(k.library?"library"+k.library.split("/").slice(-1)[0]:"main scene"));m=!1;break a}}m=!0}m||(l.splice(d,1),d--)}"animation_data"in k||(k.animation_data={action:null,nla_tracks:[]},
b("object",k,"animation_data"));if(k.animation_data)for(("action"in k.animation_data)||(k.animation_data.action=null,f.warn("B4W Warning: no action in animation data "+k.name)),("nla_tracks"in k.animation_data)||(k.animation_data.nla_tracks=[],f.warn("B4W Warning: no NLA in animation data "+k.name)),l=k.animation_data.nla_tracks,d=0;d<l.length;d++)for(m=l[d],n=0;n<m.strips.length;n++)s=m.strips[n],"action"in s||(s.action=null,f.warn("B4W Warning: no action in NLA strip "+k.name)),"action_frame_start"in
s||(s.action_frame_start=0,f.warn("B4W Warning: no action_frame_start in NLA strip "+k.name)),"action_frame_end"in s||(s.action_frame_end=s.frame_end-s.frame_start,f.warn("B4W Warning: no action_frame_start in NLA strip "+k.name));"b4w_collision_id"in k||(k.b4w_collision_id="",b("material",k,"b4w_collision_id"));d=k.scale;0==d[0]&&0==d[1]&&0==d[2]?d=!0:(l=Math.abs((d[1]-d[2])/d[1]),d=.001>Math.abs((d[0]-d[1])/d[0])&&.001>l);d||f.warn("B4W Warning: non-uniform scale for object "+k.name)}for(var C in B)h=
B[C],d=C.match(/.*?(?=>>|$)/i)[0],f.warn("WARNING "+String(d)+" is "+h.Yq+" for "+h.type+", reexport "+a.b4w_filepath_blend)};a.Tt=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var e=b[c].type;if("ARRAY"==e||"CURVE"==e){b=!0;break a}}b=!1}if(!b)return null;b=d(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var f=a[c];switch(f.type){case "ARRAY":for(var e=b,B=f,v=0,p=0,A=0,C=new Float32Array(16),f=[],M=1;M<B.count;M++){B.use_constant_offset&&(v+=B.constant_offset_displace[0],
p+=B.constant_offset_displace[1],A+=B.constant_offset_displace[2]);if(B.use_relative_offset)var y=e.b4w_bounding_box,v=v+(y.max_x-y.min_x)*B.relative_offset_displace[0],p=p+(y.max_y-y.min_y)*B.relative_offset_displace[1],A=A+(y.max_z-y.min_z)*B.relative_offset_displace[2];r.Cz(v,p,A,C);for(var I=y=d(e),H=C,Y=0;Y<I.submeshes.length;Y++){var J=I.submeshes[Y];r.ue(J.position,H,J.position,0);r.hA(J.normal,H,J.normal);r.zz(J.tangent,H,J.tangent)}f.push(y)}for(M=0;M<f.length;M++)for(B=e,v=f[M],p=0;p<B.submeshes.length;p++){A=
B.submeshes[p];C=v.submeshes[p];y=A.base_length;I=A.indices.length;A.base_length+=C.base_length;for(var D in A)if("base_length"!=D)if("indices"==D)for(A[D]=r.Fz(A[D],C[D]),H=I;H<A.indices.length;H++)A.indices[H]+=y;else A[D]=r.Rv(A[D],C[D])}break;case "CURVE":for(var e=b,M=f.object.xt,B=new Float32Array(16),p=M.oe?4:3,v=new Float32Array(p),p=new Float32Array(p),A=new Float32Array(3),C=new Float32Array(4),y=new Float32Array(4),I=new Float32Array(3),H=new Float32Array(3),Y=new Float32Array(3),J=new Float32Array(4),
T=new Float32Array(4),K=0;K<e.submeshes.length;K++){var R=e.submeshes[K],N=R.position,ca=R.normal,R=R.tangent,O;a:switch(O=f.deform_axis,O){case "POS_X":case "NEG_X":O=0;break a;case "POS_Y":case "NEG_Y":O=1;break a;case "POS_Z":case "NEG_Z":O=2;break a;default:throw"Wrong deform axis value "+O;}I[0]=0;I[1]=0;I[2]=0;I[O]=1;for(var aa=g.kz(M),X=0;X<N.length/3;X++){Y[0]=N[3*X];Y[1]=N[3*X+1];Y[2]=N[3*X+2];var ba=Y[O],w=g.jz(M,ba);g.lz(M,w,v);A[0]=v[0];A[1]=v[1];A[2]=v[2];g.iz(M,w,p);H[0]=p[0];H[1]=0;
H[2]=p[2];h.normalize(H,H);m.rotationTo(I,H,C);0>ba?(v[0]=H[0],v[1]=H[1],v[2]=H[2],h.scale(v,ba,v),h.add(A,v,A)):ba>aa&&(v[0]=H[0],v[1]=H[1],v[2]=H[2],h.scale(v,ba-aa,v),h.add(A,v,A));s.fromRotationTranslation(C,A,B);M.oe&&(m.setAxisAngle(I,v[3],y),h.transformQuat(Y,y,Y));Y[O]=0;h.transformMat4(Y,B,Y);N[3*X]=Y[0];N[3*X+1]=Y[1];N[3*X+2]=Y[2];ca.length&&(J[0]=ca[3*X],J[1]=ca[3*X+1],J[2]=ca[3*X+2],J[3]=0,n.transformMat4(J,B,J),ca[3*X]=J[0],ca[3*X+1]=J[1],ca[3*X+2]=J[2]);R.length&&(T[0]=R[3*X],T[1]=R[3*
X+1],T[2]=R[3*X+2],T[3]=0,n.transformMat4(T,B,T),R[3*X]=T[0],R[3*X+1]=T[1],R[3*X+2]=T[2])}}}l.by(b)}return b};a.kB=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,
b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,
hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.Zt=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_use_nla)for(var d=d.b4w_nla_script,e=0;e<d.length;e++){var f=d[e];switch(f.type){case "SELECT":case "SELECT_PLAY":for(var g=0;g<a.length;g++){var h=a[g];h.name==f.object&&(h.b4w_selectable=!0)}break;case "SHOW":case "HIDE":for(g=0;g<a.length;g++)h=a[g],h.name==f.object&&
(h.b4w_do_not_batch=!0)}}}}};b4w.module.__scenegraph=function(a,p){function c(a){a=Ga.ya(a);a.ke=null;a.vb=null;a.pc=null;return a}function b(a,b){var c=[];Q.Je(a,function(b,e,f){-1<c.indexOf(f)?Q.ky(a,b,e,f,d(f)):c.push(f)});Q.R(a,function(e,f){for(var g=0;g<f.da.length;g++){var t=f.da[g];b||"MAIN_REFLECT"!=f.type||(t.Xf=!0);-1<c.indexOf(t)?f.da[g]=d(t):c.push(t)}"ANTIALIASING"==f.type&&Q.Rd(a,e,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.da.length;c++){var d=b.da[c];d.pa=fa.B;d.oa=fa.B}});b||Q.Rd(a,e,function(a,
b,c){"DEPTH"==c.O&&(c.Xf=!0)})});Q.R(a,function(b){var c={};e(a,b,c);for(var d in c){b=c[d];for(var f=b[0],g=0;g<b.length;g++)if(b[g].pa==fa.B){f=b[g];break}for(var t=b[0],g=0;g<b.length;g++)if(b[g].oa==fa.B){t=b[g];break}for(var h=b[0],g=0;g<b.length;g++)if(!b[g].Xf){h=b[g];break}for(g=0;g<b.length;g++)b[g].pa=f.pa,b[g].oa=t.oa,b[g].Xf=h.Xf}})}function e(a,b,c){Q.Rd(a,b,function(b,d,f){f.Ca&&f.O==f.ea&&(c[f.O]=c[f.O]||[],-1==c[f.O].indexOf(f)&&c[f.O].push(f),e(a,b,c))});Q.Ke(a,b,function(a,b,d){d.Ca&&
(c[d.O]=c[d.O]||[],-1==c[d.O].indexOf(d)&&c[d.O].push(d))});b=Q.Ra(a,b);if("MOTION_BLUR"==b.type)for(var d=0;d<b.da.length;d++){var f=b.da[d];c[f.O].push(f)}}function d(a){if(a.ha)throw"Failed to clone slink with attached texture";return Ga.cf(a)}function l(a){var b=Q.Xm(a),c=[];Q.R(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":var e=[];break;default:e=c}for(var g=0;g<d.da.length;g++){var t=d.da[g],k=n(e,t,f(t));t.ha=k;
d.$c[g]=k}for(g=0;g<d.$c.length;g++)k=d.$c[g],h(e,k);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":e=[]}Q.Ke(b,a,function(c,d,g){if(!g.ha){if((c=r(b,a,g.O))&&g.Ca&&!g.ha){d=e;for(var t=c,h=0;h<d.length;h++){var k=d[h];k.Um===t&&k.li++}}else c=n(e,g,f(g));g.ha=c}});Q.Rd(b,a,function(a,b,c){h(e,c.ha)});Q.Ke(b,a,function(a,b,c){c.ha&&"NONE"==c.ea&&h(e,c.ha)})})}function g(a){s(a,function(b,c,d){b.hh&&(qa(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&
"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||qa(a,d,"ANTIALIASING"))&&(b.Ee*=wa.resolution_factor)})}function f(a){a=Ga.cf(a);delete a.ea;delete a.Ca;delete a.ha;return JSON.stringify(a)}function r(a,b,c){var d=null;Q.Rd(a,b,function(a,b,e){if(e.Ca&&e.O==e.ea&&e.O==c&&e.ha)return d=e.ha,!0});Q.Ke(a,b,function(a,b,e){if(e.Ca&&e.O==c&&e.ha)return d=e.ha,!0});return d}function h(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.Um===b&&d.li&&d.li--}}function n(a,b,c){for(var d=null,e=0;e<a.length;e++){var f=a[e];
if(f.id==c&&0===f.li){d=f;break}}if(d)return d.li++,d.Um;b=m(b);a.push({id:c,li:1,Um:b});return b}function m(a){var b=a.Ee*a.size;switch(a.O){case "COLOR":var c=fa.hj("COLOR",fa.fg);fa.resize(c,b,b);fa.Dm(c,a.pa,a.oa);return c;case "DEPTH":return a.Xf?(c=fa.hj("DEPTH_RBUF",fa.eg),fa.resize(c,b,b)):(c=fa.hj("DEPTH_TEX",fa.qh),fa.resize(c,b,b),fa.Dm(c,a.pa,a.oa)),c;case "CUBEMAP":return c=fa.Nu(b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.O;}}function s(a,b){var c=!1;Q.Je(a,function(d,
e,f){if(f&&(d=Q.Ra(a,d),e=Q.Ra(a,e),b(f,!1,d,e)))return c=!0});c||Q.R(a,function(a,c){for(var d=0;d<c.da.length;d++)if(b(c.da[d],!0,c,null))return!0})}function B(a){Q.R(a,function(b,c){if("SINK"!=c.type){var d=c.j;Q.Ke(a,b,function(a,b,c){c.Ca&&c.ha&&(ma.ek(d,c.O,c.ha),c.O==c.ea&&b.j&&ma.ek(b.j,c.O,c.ha))});for(var e=0;e<c.da.length;e++){var f=c.da[e];f.Ca&&f.O==f.ea&&ma.ek(d,f.O,c.$c[e])}!d.vb&&!d.pc||d.ke||(d.ke=ya.jy(d.vb,d.pc))}})}function z(a){var b=null,c=0;Q.R(a,function(a,d){if(d.type==ta.vz){if(c==
ta.uz)return b=d,!0;c++}});return b}function u(a,b){var c=Q.Hg(a,b),d=v("NONE"),e=Q.w(a,d),f=Q.Gl(a)[0];Q.Je(a,function(b,c){c==f&&Q.cy(a,b,f,b,e)});Q.Je(a,function(e,f,g){if(e==c)return Q.m(a,b,d,k(ta.Wy,"u_color",g.size,g.Ee,g.hh)),!0});Q.ae(a,e,f,k("SCREEN","NONE",.5,.5,!0))}function q(a,b){var c=F("SHADOW_CAST");c.el=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.Xl){case "SPOT":case "POINT":c.j=ma.nb(ma.mc);ma.Em(c.j,180*b.Uf/Math.PI,.1,2*b.distance);break;default:c.j=ma.nb(ma.sh)}return c}
function F(a){return{type:a,xa:!1,Gq:!1,Ik:!1,Qj:!1,Dh:0,time:0,j:null,Lo:null,Bb:null,o:[],da:[],$c:[],Ei:new Float32Array(3),fs:new Float32Array(3),Qb:new Float32Array(3),Ob:new Float32Array(4),$b:new Float32Array(16),ie:0,Hf:0,mr:0,xf:null,Af:null,wf:null,yf:null,zf:null,qc:new Float32Array(3),wc:new Float32Array(3),Fr:new Float32Array([0,0,0]),kk:new Float32Array(3),Gr:new Float32Array(4),Sg:null,sj:0,ol:0,Vh:!1,Rh:new Float32Array(3),Me:0,Ma:null,uk:!1,Be:new Float32Array(2),Ce:new Float32Array(2),
Qg:0,Eg:0,Uk:0,Fc:null,Oe:0,cg:0,Ne:0,af:!1,ko:0,lo:new Float32Array(2),jo:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,Rg:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,Wg:0,Vg:0,Ug:0,wr:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,
Dg:0,bk:0,Zg:0,el:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,Vr:null,Xn:null,Nf:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,ao:0,ap:0,Mj:0,Nj:0,lq:0,ii:"",ox:new Float32Array(2),U:!0,enqueue:!0,fa:!0,ja:!0,Gb:!0,Aa:!0}}function k(a,b,c,d,e){return{O:a,ea:b,size:c,Ee:d,hh:e,Ca:!0,ha:null,Xf:!1,pa:fa.gd,oa:fa.gd}}function x(){var a=F("GRASS_MAP");a.j=ma.nb(ma.rh);return a}function v(a){var b=F("POSTPROCESSING");b.fa=!1;b.ja=!1;b.Gb=!1;b.j=ma.nb(ma.jb);b.ii=a;return b}function G(a){var b=
F("BLOOM_BLUR");b.fa=!1;b.ja=!1;b.Gb=!1;b.j=ma.nb(ma.jb);b.ii=a;return b}function A(a,b,c,d,e,f,g,t,h){var k=F("MAIN_"+a);if("OPAQUE"===a)k.fa=!0,k.ja=c,k.xa=!1;else if("BLEND"===a)k.fa=!1,k.ja=!1,k.xa=!0;else if("XRAY"===a)k.fa=!1,k.ja=!0,k.xa=!0;else if("REFLECT"===a)k.fa=!0,k.ja=!0,k.xa=!1;else throw"wrong main subscene type";k.xa&&t&&(k.self_shadow_normal_offset=t.self_shadow_normal_offset);k.j=b;k.qc.set(g.qc);k.wc.set(g.wc);k.ie=g.ie;k.Sg=g.Sg;k.Ob=f;d&&(k.Ma=d,d.Ob&&(k.Fc=new Float32Array(d.Ob)),
k.Oe=d.waves_height,k.cg=d.waves_length,k.Ne=d.Ne,d.bj&&h&&(k.af=!0,k.ko=d.bj,k.lo.set(d.Wk),k.jo=d.Vk),d.gk&&(k.uk=!0,a=d.Uy,k.Be[0]=(a[0]+a[1])/2,k.Be[1]=(a[2]+a[3])/2,k.Ce[0]=a[0]-a[1],k.Ce[1]=a[2]-a[3],k.Qg=d.Qg,k.Eg=d.Eg));k.xf=new Float32Array(3*e);k.Af=new Float32Array(3*e);k.wf=new Float32Array(3*e);k.yf=new Float32Array(4*e);k.zf=new Float32Array(4*e);return k}function C(a,b){var c=F("COLOR_PICKING");b&&(c.type+="_XRAY",c.fa=!1,c.ja=!0);c.enqueue=!1;c.j=a;return c}function M(a){var b=F("WIREFRAME");
b.U=!1;b.fa=!1;b.ja=!1;b.j=a;return b}function y(a,b){var c=F("DEPTH");c.j=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function I(a){var b=F("DEPTH_PACK");b.fa=!1;b.ja=!1;b.j=a;return b}function H(a,b,c){var d=F("SSAO");d.fa=!1;d.ja=!1;d.Gb=!1;d.j=a;d.Ob=b;d.Fc=new Float32Array(b);d.Wg=c.radius_increase;d.ssao_hemisphere=c.ax;d.Vg=c.influence;d.Ug=c.dist_factor;d.wr=c.qy;return d}function Y(a,b){var c=F("SSAO_BLUR");c.fa=!1;c.ja=!1;c.Gb=!1;c.ssao_blur_depth=b.hu;c.ssao_blur_discard_value=
b.$n;c.j=a;return c}function J(){var a=F("ANTIALIASING");a.fa=!1;a.ja=!1;a.Gb=!1;a.j=ma.nb(ma.jb);return a}function D(a){var b=F(a);b.fa="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.ja=!1;b.Gb=!1;b.j=ma.nb(ma.jb);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.px=new Float32Array(4));return b}function T(a,b,c,d){var e=F("COMPOSITING");e.fa=!1;e.ja=!1;e.Gb=!1;e.j=ma.nb(ma.jb);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function K(a,b){var c=F("MOTION_BLUR");
c.fa=!1;c.ja=!1;c.Gb=!1;c.j=ma.nb(ma.jb);c.Ik=!0;c.Mj=a;c.Nj=b;return c}function R(a){var b=F("DOF");b.fa=!1;b.ja=!1;b.Gb=!1;b.j=a;return b}function N(a){var b=F("GLOW_MASK");b.j=a;b.Gb=!1;return b}function ca(a){var b=F("GLOW");b.Rh.set(a.Rh);b.sj=a.sj;b.ap=5;b.ao=3;b.Gb=!1;b.j=ma.nb(ma.jb);return b}function O(){var a=F("REFRACT");a.fa=!1;a.ja=!1;a.Gb=!1;a.j=ma.nb(ma.jb);return a}function aa(a,b,c,d,e,f,g){var t=F("GOD_RAYS");t.fa=!1;t.ja=!1;t.Gb=!1;t.qc[0]=1;t.qc[1]=1;t.qc[2]=1;t.wc[0]=1;t.wc[1]=
1;t.wc[2]=1;t.ie=1;t.Gq=d;t.Me=b;t.bk=e;t.Dg=c;t.Zg=g;t.j=a;t.Hf=f;t.xf=new Float32Array(3*f);t.Af=new Float32Array(3*f);t.wf=new Float32Array(3*f);t.yf=new Float32Array(4*f);t.zf=new Float32Array(4*f);return t}function X(a,b){var c=F("GOD_RAYS_COMBINE");c.fa=!1;c.ja=!1;c.Gb=!1;c.j=ma.nb(ma.jb);c.god_rays_intensity=a;c.Hf=b;c.xf=new Float32Array(3*b);c.Af=new Float32Array(3*b);c.wf=new Float32Array(3*b);c.yf=new Float32Array(4*b);c.zf=new Float32Array(4*b);return c}function ba(a,b){var c=F("SKY");
c.enqueue=!1;c.fa=!1;c.ja=!1;c.Gb=!1;var d=ma.nb(ma.jb);d.width=Za.ij;d.height=Za.ij;c.j=d;c.Lo=Ga.dw();c.Hf=a;c.xf=new Float32Array(3*a);c.Af=new Float32Array(3*a);c.wf=new Float32Array(3*a);c.yf=new Float32Array(4*a);c.zf=new Float32Array(4*a);c.qc[0]=1;c.qc[1]=1;c.qc[2]=1;c.wc[0]=1;c.wc[1]=1;c.wc[2]=1;c.ie=1;c.Rg.set(b.Rg);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;
c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function w(){var a=F("COPY");a.fa=!1;a.ja=!1;a.j=ma.nb(ma.jb);return a}function ga(){var a=F("ANAGLYPH");a.fa=!1;a.ja=!1;a.j=ma.nb(ma.jb);return a}function ka(){var a=F("LUMINANCE");a.fa=!1;a.ja=!1;a.j=ma.nb(ma.jb);
return a}function L(){var a=F("AVERAGE_LUMINANCE");a.fa=!1;a.ja=!1;a.j=ma.nb(ma.jb);return a}function S(a,b,c,d){var e=F("LUMINANCE_TRUNCED");e.fa=!1;e.ja=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.j=d;e.xf=new Float32Array(3*c);e.Af=new Float32Array(3*c);e.wf=new Float32Array(3*c);e.yf=new Float32Array(4*c);e.zf=new Float32Array(4*c);return e}function W(a){var b=F("BLOOM");b.fa=!1;b.ja=!1;b.j=ma.nb(ma.jb);b.bloom_blur=a;return b}function ja(){var a=F("SINK");a.enqueue=!1;return a}function qa(a,b,c){if(b.type===
c)return!0;b=V(a,b);for(var d=0;d<b.length;d++)if(qa(a,b[d],c))return!0;return!1}function P(a,b,c){if(b.type===c)return!0;b=t(a,b);for(var d=0;d<b.length;d++)if(P(a,b[d],c))return!0;return!1}function U(a,b,c){if(b.type===c)return b;b=t(a,b);for(var d=0;d<b.length;d++){var e=U(a,b[d],c);if(e)return e}return null}function t(a,b){var c=Q.Hg(a,b);if(c==Q.wn)throw"Subscene not in graph";for(var d=[],e=Q.Op(a,c),f=0;f<e;f++){var g=Q.qj(a,c,f);g!=c&&d.push(Q.Ra(a,g))}return d}function V(a,b){var c=Q.Hg(a,
b);if(c==Q.wn)throw"Subscene not in graph";for(var d=[],e=Q.Ig(a,c),f=0;f<e;f++){var g=Q.vg(a,c,f);g!=c&&d.push(Q.Ra(a,g))}return d}function oa(a){var b=[],c=[];s(a,function(a){a.ha&&-1==b.indexOf(a.ha)&&(b.push(a.ha),c.push(a.ha,b.length-1))});return c}function ra(a,b){var c;c=""+(a.O+"\\n");c+="NONE"!=a.ea?a.ea+"\\n":"";c+="(";if(a.hh){var d=a.Ee;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.O){c+=" ";if(a.Xf)c+="RR";else{var d=a.pa,e=a.oa,
f="";d==fa.B?f+="L":d==fa.gd&&(f+="N");e==fa.B?f+="L":e==fa.gd&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.ha&&(c+=" "+b[d+1])}return c+")\\n"}var ma=p("__camera"),da=p("__config"),ia=p("__debug"),Q=p("__graph"),ya=p("__renderer"),fa=p("__textures"),Ga=p("__util");p("vec4");var ta=da.ll,wa=da.p,Za=da.ri;a.xu=function(a){switch(a.ea){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "NONE":return!1;default:return!0}};a.Ez=s;a.Xu=function(a,d,e){function f(b,e){var g=c(Ca[e]);
d.K.push(g);g=A(b,g,!1,F,qa,eb,$a,Ja,a.$g);m.push(g);Q.w(t,g);Q.m(t,h[e],g,n[e]);Q.m(t,h[e],g,V[e]);Fa&&(Q.m(t,Fa,g,xb),Q.m(t,Fa,g,yb));if(Wa){for(var l=0;l<p.length;l++)Q.m(t,p[l],g,ra[l]);l=P[e];if("DEPTH_PACK"==l.type){var W=k("COLOR","u_scene_depth",1,1,!0);W.pa=fa.gd;W.oa=fa.gd}else W=k("DEPTH","u_scene_depth",1,1,!0),W.pa=fa.B,W.oa=fa.B;Q.m(t,l,g,W)}U.length&&(Q.m(t,U[e],g,r[e]),g.Bb=Aa[0]);s.length&&Q.m(t,s[e],g,oa[e]);return g}var t=Q.create(),h=[],m=[],P=[],n=[],V=[],U=[],r=[],s=[],oa=[],
p=[],ra=[],qa=a.Zp,F=a.Ma,da=a.ym,ya=a.Ge,hc=a.yg,kb=a.xx,Aa=a.dy,fb=a.gg,zb=a.Fg,ic=a.kg,Ab=a.antialiasing,$a=a.rA,eb=a.Ob,Ja=a.Uc,Zb=a.Bx,Xa=a.gu,Ia=a.pu,Bb=a.Vw,Sb=a.Sw,qb=a.og,Wa=a.vv,ab=Boolean(e.length),Ca=[];if(a.anaglyph_use&&!ab){var rb=d.K[0],Mb=c(rb);ma.iq(rb,ma.Eb);ma.iq(Mb,ma.Jb);Ca.push(rb,Mb);d.K.push(Mb)}else{var va=d.K[0];Ca.push(va)}if(da){ma.bn(Ca[0],Ja);for(var tb=Ja.csm_num,ea=0;ea<tb;ea++){var Nb=q(ea,Ja);Q.w(t,Nb);p.push(Nb);var Ba=Ja.csm_resolution,va=Nb.j;va.width=Ba;va.height=
Ba;Nb.fa=!1;ra.push(k("DEPTH","u_shadow_map"+ea,Ba,1,!1));(ia.no()||wa.gp)&&Nb.da.push(k("COLOR","COLOR",Ba,1,!1))}}if(0<Aa.length&&!ab)for(ea=0;ea<Ca.length;ea++){va=c(Ca[ea]);d.K.push(va);var Da=A("REFLECT",va,!1,F,qa,eb,$a,null,a.$g);Da.Bb=Aa[0];Da.j.Bb=Aa[0];Q.w(t,Da);U.push(Da);r.push(k("COLOR","u_reflectmap",1,wa.ni,!0));Da.da.push(k("DEPTH","DEPTH",1,wa.ni,!0))}h=[];m=[];if(a.Da){var Fa=x();Q.w(t,Fa);Ba=Za.uj;Fa.j.width=Ba;Fa.j.height=Ba;var xb=k("DEPTH","u_grass_map_depth",Ba,1,!1);xb.pa=
fa.B;xb.oa=fa.B;var yb=k("COLOR","u_grass_map_color",Ba,1,!1);yb.pa=fa.B;yb.oa=fa.B}else yb=xb=Fa=null;for(ea=0;ea<Ca.length;ea++){var va=Ca[ea],Qa={};V.push(k("DEPTH","DEPTH",1,1,!0));if(Wa){var Ob=c(va);d.K.push(Ob);if(da){Qa=y(Ob,Ja);Q.w(t,Qa);for(var lb=0;lb<p.length;lb++)Nb=p[lb],Q.m(t,Nb,Qa,ra[lb]);var Pb=k("COLOR","u_color",1,1,!0),bc=k("DEPTH","u_depth",1,1,!0);if(ya){var vc=c(va);d.K.push(vc);var Tb=a.nz,Gb=H(vc,eb,Tb);Q.w(t,Gb);var jc=k("COLOR","u_ssao_mask",1,1,!0);Q.m(t,Qa,Gb,Pb);Q.m(t,
Qa,Gb,bc);var kc=c(va);d.K.push(kc);var Ya=Y(kc,Tb);Q.w(t,Ya);var lc=k("COLOR","u_shadow_mask",1,1,!0);Q.m(t,Gb,Ya,jc);Q.m(t,Qa,Ya,bc)}var Ub=c(Ob);d.K.push(Ub);var gb=I(Ub)}else Qa=y(Ob,Ja),Q.w(t,Qa),ia.no()&&Qa.da.push(k("COLOR","COLOR",1,1,!0)),Ub=c(Ob),d.K.push(Ub),gb=I(Ub);Q.w(t,gb);Q.m(t,Qa,gb,k("DEPTH","u_depth",1,1,!0));P.push(gb);Fa&&(Q.m(t,Fa,Qa,xb),Q.m(t,Fa,Qa,yb))}Da=A("OPAQUE",va,!Wa,F,qa,eb,$a,null,a.$g);Q.w(t,Da);m.push(Da);Wa&&(Q.m(t,Qa,Da,V[ea]),jc?Q.m(t,Ya,Da,lc):Q.m(t,Qa,Da,k("COLOR",
"u_shadow_mask",1,1,!0)));var cc=k("COLOR","u_color",1,1,!0);n.push(k("COLOR","COLOR",1,1,!0));Fa&&(Q.m(t,Fa,Da,xb),Q.m(t,Fa,Da,yb));U.length&&(Q.m(t,U[ea],Da,r[ea]),Da.Bb=Aa[0])}h=m;m=[];if(!ab&&a.Co){va=c(h[0].j);d.K.push(va);var ub=C(va,!1);Q.w(t,ub);if(a.Td){va=c(h[0].j);d.K.push(va);var E=C(va,!0);Q.w(t,E);Q.m(t,ub,E,k("COLOR","COLOR",1,1,!0));Q.m(t,ub,E,k("DEPTH","DEPTH",1,1,!0))}}else ub=null;if(kb.Cc&&!ab)for(ea=0;ea<Ca.length;ea++){var hb=O();Q.w(t,hb);Q.m(t,h[ea],hb,cc);s.push(hb);oa.push(k("COLOR",
"u_refractmap",1,1,!0))}for(var bb=[],ea=0;ea<Ca.length;ea++)Da=f("BLEND",ea),bb.push(Da);h=m;m=[];if(a.Td){for(ea=0;ea<Ca.length;ea++)f("XRAY",ea);h=m;m=[]}if(wa.wireframe_debug){for(ea=0;ea<Ca.length;ea++){va=Ga.ya(Ca[ea]);d.K.push(va);var cb=M(va);m.push(cb);Q.w(t,cb);Q.m(t,h[ea],cb,n[ea]);Q.m(t,h[ea],cb,V[ea]);Fa&&(Q.m(t,Fa,cb,xb),Q.m(t,Fa,cb,yb))}h=m;m=[]}if(hc&&Wa&&!ab){for(ea=0;ea<Ca.length;ea++){var na=Bb.Dg,Z=Bb.fx,Ka=Bb.Zg,Ua=h[ea],La=F?1:0,Hb=k("DEPTH","u_input",1,1,!0);Hb.pa=fa.B;Hb.oa=
fa.B;var Ib=k("COLOR","u_input",1,.25,!0);Ib.pa=fa.B;Ib.oa=fa.B;var Jb=na/Ka,dc=c(Ca[ea]);d.K.push(dc);var Kb=aa(dc,La,na,!0,Jb,qa,Ka);Q.w(t,Kb);Q.m(t,Ua,Kb,Hb);var Jb=na/Ka*.5,Vb=c(Ca[ea]);d.K.push(Vb);var mc=aa(Vb,La,na,!1,Jb,qa,Ka);Q.w(t,mc);Q.m(t,Kb,mc,Ib);var Jb=na/Ka*.25,Ec=c(Ca[ea]);d.K.push(Ec);var Ra=aa(Ec,La,na,!1,Jb,qa,Ka);Q.w(t,Ra);Q.m(t,mc,Ra,Ib);U.length&&(Kb.Bb=Aa[0],mc.Bb=Aa[0],Ra.Bb=Aa[0]);var Ma=X(Z,qa);m.push(Ma);Q.w(t,Ma);Q.m(t,Ua,Ma,k("COLOR","u_main",1,1,!0));Q.m(t,Ra,Ma,k("COLOR",
"u_god_rays",1,1,!0))}h=m;m=[]}if(fb&&!ab){for(ea=0;ea<Ca.length;ea++){var Ua=h[ea],Yc=ka();Q.w(t,Yc);Q.m(t,Ua,Yc,k("COLOR","u_input",1,1,!0));var Cb=L();Q.w(t,Cb);Cb.j.width=1;Cb.j.height=1;var Fc=k("COLOR","u_input",1,.25,!0);Fc.pa=fa.B;Fc.oa=fa.B;var wc=k("COLOR","u_luminance",1,.25,!0);wc.pa=fa.B;wc.oa=fa.B;Q.m(t,Yc,Cb,Fc);var kd=Xa.key,Wb=Xa.Bv,ec=c(Ca[ea]);d.K.push(ec);var $b=S(kd,Wb,qa,ec);Q.w(t,$b);Q.m(t,Ua,$b,k("COLOR","u_main",1,1,!0));Q.m(t,Yc,$b,wc);Q.m(t,Cb,$b,k("COLOR","u_average_lum",
1,1,!1));var mb=k("COLOR","u_color",1,.25,!0);mb.pa=fa.B;mb.oa=fa.B;var Db=G("X_BLUR");Q.w(t,Db);Q.m(t,$b,Db,mb);var xc=G("Y_BLUR");Q.w(t,xc);Q.m(t,Db,xc,mb);var yc=W(Xa.blur);Q.w(t,yc);var nc=k("COLOR","u_bloom",1,.25,!0);nc.pa=fa.B;nc.oa=fa.B;Q.m(t,xc,yc,nc);Q.m(t,Ua,yc,k("COLOR","u_main",1,1,!0));m.push(yc)}h=m;m=[]}if(zb&&!ab){for(ea=0;ea<h.length;ea++){var ac=h[ea],oc=K(Zb.Mj,Zb.Nj);m.push(oc);Q.w(t,oc);Q.m(t,ac,oc,k("COLOR","u_mb_tex_curr",1,1,!0));oc.da.push(k("COLOR","u_mb_tex_accum",1,1,
!0))}h=m;m=[]}if(qb&&Wa&&!ab){for(ea=0;ea<h.length;ea++){var Ua=h[ea],Qb=c(Ca[ea]);d.K.push(Qb);mb=k("COLOR","u_color",1,1,!0);mb.pa=fa.B;mb.oa=fa.B;var sb=v("X_BLUR");Q.w(t,sb);Q.m(t,Ua,sb,mb);var Eb=v("Y_BLUR");Q.w(t,Eb);Q.m(t,sb,Eb,mb);var Qa=bb[ea],fc=R(Qb);Qb.dof_distance=d.dof_distance;Qb.gf=d.gf;Qb.dof_front=d.dof_front;Qb.dof_rear=d.dof_rear;Qb.dof_power=d.dof_power;Qb.dof_on=1;m.push(fc);Q.w(t,fc);Q.m(t,Ua,fc,k("COLOR","u_sharp",1,1,!0));Q.m(t,Eb,fc,k("COLOR","u_blurred",1,1,!0));Q.m(t,Qa,
fc,k("DEPTH","u_depth",1,1,!0))}h=m;m=[]}if(!ab&&a.glow){for(ea=0;ea<Ca.length;ea++){var Ua=h[ea],vb=c(Ca[ea]);d.K.push(vb);var Kc=N(vb);Q.w(t,Kc);var zc=v("X_EXTEND"),md=k("COLOR","u_color",1,1,!0),Lc=k("COLOR","u_glow_mask",1,1,!0);zc.Vh=!0;Q.w(t,zc);Q.m(t,Kc,zc,md);var Ac=k("COLOR","u_color",1,.5,!0);Ac.pa=fa.B;Ac.oa=fa.B;var Gc=v("Y_EXTEND");Gc.Vh=!0;Q.w(t,Gc);Q.m(t,zc,Gc,Ac);sb=v("X_BLUR");sb.Vh=!0;Q.w(t,sb);Q.m(t,Gc,sb,Ac);var Fb=k("COLOR","u_color",1,.25,!0);Fb.pa=fa.B;Fb.oa=fa.B;var Zc=k("COLOR",
"u_glow_mask_blurred",1,.25,!0);Zc.pa=fa.B;Zc.oa=fa.B;Eb=v("Y_BLUR");Eb.Vh=!0;Q.w(t,Eb);Q.m(t,sb,Eb,Fb);var Hc=ca(Sb);Q.w(t,Hc);Q.m(t,Ua,Hc,k("COLOR","u_glow_src",1,1,!0));Q.m(t,Kc,Hc,Lc);Q.m(t,Eb,Hc,Zc);m.push(Hc)}h=m;m=[]}if(ic&&!ab){for(ea=0;ea<h.length;ea++){var Ua=h[ea],Mc=T(Ia.brightness,Ia.contrast,Ia.exposure,Ia.saturation);Q.w(t,Mc);Q.m(t,Ua,Mc,k("COLOR","u_color",1,1,!0));m.push(Mc)}h=m;m=[]}if(Ab){for(ea=0;ea<h.length;ea++)if(Ua=h[ea],wa.smaa){var Bc=k("COLOR","u_color",1,1,!0);Bc.pa=fa.B;
Bc.oa=fa.B;var ib=D("SMAA_EDGE_DETECTION");Q.w(t,ib);Q.m(t,Ua,ib,Bc);var gc=D("SMAA_BLENDING_WEIGHT_CALCULATION");Q.w(t,gc);Q.m(t,ib,gc,Bc);var Nc=k("COLOR","u_search_tex",1,1,!1),Ic=k("COLOR","u_area_tex",1,1,!1);Nc.pa=fa.B;Nc.oa=fa.B;Ic.pa=fa.B;Ic.oa=fa.B;gc.da.push(Nc);gc.da.push(Ic);var Oc=D("SMAA_NEIGHBORHOOD_BLENDING");Q.w(t,Oc);Q.m(t,Ua,Oc,Bc);var Pc=k("COLOR","u_blend",1,1,!0);Pc.pa=fa.B;Pc.oa=fa.B;Q.m(t,gc,Oc,Pc);m.push(Oc)}else{var Qc=J();Q.w(t,Qc);var Rc=k("COLOR","u_color",1,1,!0);Rc.pa=
fa.B;Rc.oa=fa.B;Q.m(t,Ua,Qc,Rc);if(1<wa.resolution_factor){var $c=v("NONE");Q.w(t,$c);Q.m(t,Qc,$c,Rc);m.push($c)}else m.push(Qc)}h=m;m=[]}if(a.anaglyph_use&&!ab){var Sc=ga();Q.w(t,Sc);Q.m(t,h[0],Sc,k("COLOR","u_sampler_left",1,1,!0));Q.m(t,h[1],Sc,k("COLOR","u_sampler_right",1,1,!0));m.push(Sc)}else m.push(h[0]);var fd=Q.Hg(t,h[0]),pc=!1;Q.Rd(t,fd,function(a,b,c){if(c.O==c.ea)return pc=!0});if(pc){var Rb=w();Q.w(t,Rb);Q.m(t,h[0],Rb,k("COLOR","u_color",1,1,!0));h=m;m=[];m.push(Rb)}ub&&(E?m.push(E):
m.push(ub));if(!ab&&a.Jm.procedural_skydome){var qc=ba(qa,a.Jm);Q.w(t,qc);m.push(qc)}var rc=ja();Q.w(t,rc);for(ea=0;ea<m.length;ea++)switch(m[ea].type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":Q.m(t,m[ea],rc,k("COLOR","NONE",1,1,!0));Q.m(t,m[ea],rc,k("DEPTH","NONE",1,1,!0));break;case "SKY":Q.m(t,qc,rc,k("CUBEMAP","u_sky",Za.ij,1,!1));break;default:if(ab){var ad=e[0].d,Cc=k("COLOR","OFFSCREEN",1,1,!0);Cc.ha=ad;Q.m(t,m[ea],rc,Cc);for(lb=1;lb<e.length;lb++){var bd=e[lb].d,Rb=w();Q.w(t,Rb);Q.m(t,
m[ea],Rb,k("COLOR","u_color",1,1,!0));Cc=k("COLOR","OFFSCREEN",1,bd.Tf/ad.Tf,!0);Cc.ha=bd;Q.m(t,Rb,rc,Cc)}}else Q.m(t,m[ea],rc,k("SCREEN","NONE",1,1,!0))}if(Wa)for(var Tc=Q.Gl(t),ea=0;ea<Tc.length;ea++)for(var cd=Tc[ea],lb=0;lb<P.length;lb++)Qa=P[lb],Q.Ra(t,cd)==Qa&&Q.Lg(t,cd);if(ta.enabled){var Xb=z(t);Xb&&u(t,Xb)}b(t,Wa);1<wa.resolution_factor&&g(t);l(t);B(t);return t};a.cC=F;a.yB=function(a){var b=null;Q.R(a,function(a,c){return c.j&&null===c.j.ke?(b=c,!0):!1});return b};a.ob=function(a,b,c){a=
t(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.WB=qa;a.$w=P;a.Qv=U;a.up=t;a.RB=V;a.bb=function(a,b){var c=null;Q.R(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.mv=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=oa(a);Q.R(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(f+=" ("+d.ii.replace(/_/g,
" ")+")");if(d.j){for(var f=f+"\\n",t=0;t<c.length;t+=2)c[t]==d.j.vb&&(f+="C"+c[t+1]+" ");for(t=0;t<c.length;t+=2)c[t]==d.j.pc&&(f+="D"+c[t+1])}d.da.length&&(f+="\\n-----\\n");for(t=0;t<d.da.length;t++)f+=ra(d.da[t],c);t="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(t+",bold")+'"];\n')});Q.Je(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+ra(e,c)+'" style="'+(e.Ca?"solid":"dotted")+'"];\n'});return b+="}"};a.Yu=function(a){a=
Q.Bz(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,p){function c(){return{name:"",type:0,source:"",width:0,height:0,al:1,Pi:!0,Tf:1024,Wo:!1,pd:null,Ya:null,Mg:null,dr:1,Nd:0,Ng:!1,wk:!1,vf:!1,S:0,za:0,sg:0,aA:!1,Wf:!1,im:0,Pb:0,Ib:0,La:null,Le:null}}function b(b,d,f){var g=b.type,h=new Uint8Array([204,204,204,255]),k=c();switch(g){case "DATA_TEX2D":case "IMAGE":var m=A.createTexture(),l=A.TEXTURE_2D;A.bindTexture(l,m);A.texImage2D(l,0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,h);b.image&&"MOVIE"==b.image.source&&(k.vf=
!0,k.S=b.frame_start,k.za=b.frame_offset,k.sg=b.frame_duration,k.aA=b.use_auto_refresh,k.Wf=b.use_cyclic,k.im=b.movie_length,0!=k.za&&B.warn('Frame offset for texture "'+b.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":m=A.createTexture();l=A.TEXTURE_2D;A.bindTexture(l,m);if("NONE"==b.b4w_source_type)return null;if("SCENE"==b.b4w_source_type)if(b.b4w_source_id&&(f=q.keysearch("name",b.b4w_source_id,f)))k.Tf=b.b4w_source_size,f.Xd=f.Xd||[],f.Xd.push(b),
A.texImage2D(l,0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,h);else return null;break;case "ENVIRONMENT_MAP":m=A.createTexture();l=A.TEXTURE_CUBE_MAP;A.bindTexture(l,m);f="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var n=0;6>n;n++)A.texImage2D(A["TEXTURE_CUBE_MAP_"+f[n]],0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,h);break;case "VORONOI":case "BLEND":return null;default:return B.error('B4W warning: texture "'+b.name+'" has unsupported type "'+g+'"'),null}("NONE"!=g||b.b4w_enable_canvas_mipmapping&&
"CANVAS"==b.b4w_source_type)&&"DATA_TEX2D"!=g?A.texParameteri(l,A.TEXTURE_MIN_FILTER,C[F.mk]):A.texParameteri(l,A.TEXTURE_MIN_FILTER,A.LINEAR);A.texParameteri(l,A.TEXTURE_MAG_FILTER,A.LINEAR);h=l;f=b.b4w_anisotropic_filtering;"DEFAULT"===f&&(f=d);"OFF"!==f&&F.Qi&&(d=u.pw())&&(f=parseFloat(f.split("x")[0]),A.texParameterf(h,d.TEXTURE_MAX_ANISOTROPY_EXT,f));"REPEAT"!=b.extension||b.b4w_shore_dist_map?(A.texParameteri(l,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(l,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE)):
(A.texParameteri(l,A.TEXTURE_WRAP_S,A.REPEAT),A.texParameteri(l,A.TEXTURE_WRAP_T,A.REPEAT));k.type=a.fg;k.width=1;k.height=1;k.La=m;k.Ib=l;"CANVAS"==b.b4w_source_type&&"NONE"==g?(g=b.b4w_source_id,m=b.b4w_source_size,k.Wo=b.b4w_enable_canvas_mipmapping,k.name=g,k.source="CANVAS",l=document.createElement("canvas"),l.setAttribute("id",g),l.width=m,l.height=m,k.pd=l.getContext("2d"),v[g]=k,e(k)):"SCENE"==b.b4w_source_type&&"NONE"==g?(k.name=b.b4w_source_id,k.source="SCENE"):(k.name=b.name,k.source=g,
A.generateMipmap(l),A.bindTexture(l,null));return b.d=k}function e(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Ib;A.bindTexture(b,a.La);var c=f(a),d=r(a),e=a.pd.canvas;A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!0);A.texImage2D(b,0,c,c,d,e);A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!1);a.Wo&&A.generateMipmap(b);A.bindTexture(b,null);a.width=e.width;a.height=e.height}function d(a){var b=a.Ib;A.bindTexture(b,a.La);A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!0);A.texImage2D(b,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,a.Mg[a.Nd]);
A.bindTexture(b,null)}function l(a){A.texParameteri(a,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE);A.texParameteri(a,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE);A.texParameteri(a,A.TEXTURE_MAG_FILTER,A.LINEAR);A.texParameteri(a,A.TEXTURE_MIN_FILTER,A.LINEAR)}function g(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function f(b){switch(b.type){case a.fg:b=A.RGBA;break;case a.zk:b=A.RGB;break;case a.Li:b=A.RGBA;break;case a.Mi:b=A.RGB;break;case a.qh:b=A.DEPTH_COMPONENT;
break;default:throw"Wrong texture type";}return b}function r(b){switch(b.type){case a.fg:b=A.UNSIGNED_BYTE;break;case a.zk:b=A.UNSIGNED_BYTE;break;case a.Li:b=A.FLOAT;break;case a.Mi:b=A.FLOAT;break;case a.qh:b=A.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function h(a){return a in G?(F.Ec?G[a].Ng=!0:G[a].Ya.play(),!0):null}function n(a){return a in G?(a=G[a],F.Ec?(a.Nd=a.za,d(a),a.Nd++):a.Ya.currentTime=a.za/a.Pb,!0):null}function m(a){return a in G?(F.Ec?G[a].Ng=!1:G[a].Ya.pause(),
!0):null}var s=p("__config"),B=p("__print"),z=p("__dds"),u=p("__extensions"),q=p("__util"),F=s.p,k=s.kd,x=s.Od;a.gd=0;a.B=0;a.pt=0;a.nt=0;a.ot=0;a.mt=0;a.fg=10;a.zk=20;a.Li=30;a.Mi=40;a.qh=50;a.eg=60;var v={},G={},A=null,C;a.fc=function(b){C=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.gd=b.NEAREST;a.B=b.LINEAR;a.pt=b.NEAREST_MIPMAP_NEAREST;a.nt=b.LINEAR_MIPMAP_NEAREST;a.ot=b.NEAREST_MIPMAP_LINEAR;a.mt=b.LINEAR_MIPMAP_LINEAR;A=b};a.tw=function(a){return a in
v?v[a].pd:null};a.Lz=function(a){return a in v?(e(v[a]),!0):!1};a.hj=function(b,d){var e=c();e.name=b;e.type=d;e.source="NONE";if(d==a.eg)e.Le=A.createRenderbuffer();else{var f=A.TEXTURE_2D,g=A.createTexture();A.bindTexture(f,g);A.texParameteri(f,A.TEXTURE_MAG_FILTER,A.LINEAR);A.texParameteri(f,A.TEXTURE_MIN_FILTER,A.LINEAR);A.texParameteri(f,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE);A.texParameteri(f,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE);A.bindTexture(f,null);e.Ib=f;e.La=g}return e};a.Nu=function(b){var d=A.createTexture(),
e=A.TEXTURE_CUBE_MAP;A.bindTexture(e,d);A.texParameteri(e,A.TEXTURE_MAG_FILTER,A.LINEAR);A.texParameteri(e,A.TEXTURE_MIN_FILTER,A.LINEAR);A.texParameteri(e,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE);A.texParameteri(e,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),g=0;6>g;g++)A.texImage2D(A[f[g]],0,A.RGBA,b,b,0,A.RGBA,A.UNSIGNED_BYTE,
null);A.bindTexture(e,null);e=c();e.name="CUBEMAP";e.type=a.fg;e.source="NONE";e.width=3*b;e.height=2*b;e.al=1;e.La=d;e.Ib=A.TEXTURE_CUBE_MAP;return e};a.Dm=function(b,c,d){if(b.type!=a.eg){var e=b.Ib;A.bindTexture(e,b.La);c&&A.texParameteri(e,A.TEXTURE_MIN_FILTER,c);d&&A.texParameteri(e,A.TEXTURE_MAG_FILTER,d);A.bindTexture(e,null)}};a.PB=function(b){if(b.type==a.eg)return{min:a.gd,tx:a.gd};var c=b.Ib;A.bindTexture(c,b.La);b=A.getTexParameter(c,A.TEXTURE_MIN_FILTER);var d=A.getTexParameter(c,A.TEXTURE_MAG_FILTER);
A.bindTexture(c,null);return{min:b,tx:d}};a.resize=function(b,c,d){c=Math.max(c,1);d=Math.max(d,1);if(b.width!=c||b.height!=d){if(b.type==a.eg)A.bindRenderbuffer(A.RENDERBUFFER,b.Le),A.renderbufferStorage(A.RENDERBUFFER,A.DEPTH_COMPONENT16,c,d),A.bindRenderbuffer(A.RENDERBUFFER,null);else{var e=b.Ib;A.bindTexture(e,b.La);var g=f(b),h=r(b);A.texImage2D(e,0,g,c,d,0,g,h,null);A.bindTexture(e,null)}c>F.Oc||d>F.Oc?B.error('B4W warning: Slink texture "'+b.name+'" has unsupported size'):(b.width=c,b.height=
d)}};a.gv=b;a.Zz=function(a){var b=a.Ib;A.bindTexture(b,a.La);A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!0);4!=a.Ya.length?A.texImage2D(b,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,a.Ya):A.texImage2D(b,0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,a.Ya);A.bindTexture(b,null)};a.Vz=d;a.zi=function(a,b,c,d){var e=a.source,f=a.Ib;A.bindTexture(f,a.La);if(4==b.length){var h=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==e)if(h)A.texImage2D(f,0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,b),a.width=1,a.height=
1;else if(c){c=z.Bp(b);if(c.width>F.Oc||c.height>F.Oc){B.error("B4W warning: texture has unsupported size",d);return}z.$z(A,u.yp(),b,!0);g(c.width,c.height)&&(a.Wn||B.warn("B4W warning: using NPOT texture",d),l(f));a.width=c.width;a.height=c.height;a.al=z.ww(b)}else{A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!0);if(b.width>F.Oc||b.height>F.Oc){B.error("B4W warning: texture has unsupported size",d);return}a.vf?F.Ec?b&&(G[a.name]=a,a.Mg=b,a.Pb=a.im/b.length,a.sg=Math.round(a.sg/a.Pb),a.za=Math.round(a.za/
a.Pb),a.S=Math.round(a.S/a.Pb),a.Nd=a.za,A.texImage2D(f,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,a.Mg[0])):(a.Ya=b,a.Ya.loop=a.Wf,b&&(G[a.name]=a),a.Pb=k.Ba,b.duration&&(a.Pb=a.im/b.duration),x.To||(b.playbackRate=k.Ba/a.Pb,x.ro&&2<b.playbackRate&&(b.playbackRate=2)),A.texImage2D(f,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,a.Ya)):A.texImage2D(f,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,b);F.Ec&&a.vf?(a.width=b[0].width,a.height=b[0].height):(a.width=b.width,a.height=b.height);g(b.width,b.height)?(a.Wn||(a.vf?B.warn("B4W warning: using NPOT video texture",
d):B.warn("B4W warning: using NPOT texture",d)),l(f)):a.vf||A.generateMipmap(f)}else if("ENVIRONMENT_MAP"==e)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],h){for(h=0;6>h;h++)e=c[h],A.texImage2D(A["TEXTURE_CUBE_MAP_"+e[0]],0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!1);var m=b.width/3;if(m>F.em||m>F.em){B.error("B4W warning: cubemap has unsupported size",d);return}for(h=
0;6>h;h++){var e=c[h],n=document.createElement("canvas");n.width=m;n.height=m;var q=n.getContext("2d");"POSITIVE_Y"==e[0]||"NEGATIVE_Y"==e[0]?(q.translate(0,m),q.scale(1,-1)):(q.translate(m,0),q.scale(-1,1));q.drawImage(b,e[1]*m,e[2]*m,m,m,0,0,m,m);A.texImage2D(A["TEXTURE_CUBE_MAP_"+e[0]],0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,n)}a.width=3*m;a.height=2*m;g(b.width/3,b.height/2)?(B.warn("B4W warning: using NPOT cube map texture",d),l(f)):A.generateMipmap(f)}else"DATA_TEX2D"==e&&(A.texImage2D(f,0,A.RGBA,b.width,
b.height,0,A.RGBA,A.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);A.bindTexture(f,null)};a.uv=function(a){A.deleteTexture(a)};a.Xh=function(a){return a&&a.name&&(a.La||a.Le)?!0:!1};a.Vp=function(a){return a&&a.name&&a.Le?!0:!1};a.iC=function(b){return b.type==a.Li||b.type==a.Mi?!0:!1};a.Mw=function(b){var c=0;switch(b.type){case a.fg:case a.zk:c=4;break;case a.Li:case a.Mi:c=16;break;case a.qh:c=3;break;case a.eg:c=2}return c};a.kw=function(a){var c=null,c={name:"special_ssao_texture",
type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};b(c,null,a);c.image={filepath:null};return c};a.cleanup=function(){v={};G={}};a.play_video=h;a.reset_video=n;a.pause_video=m;a.pause=function(){for(var a in G)F.Ec&&!G[a].Ng||!F.Ec&&G[a].Ya.paused||(m(a),G[a].wk=!0)};a.reset=function(){for(var a in G)n(a),G[a].wk=!1};a.play=function(a){for(var b in G)if(!a||G[b].wk)h(b),G[b].wk=!1}};b4w.module.__assets=function(a,p){function c(){return z.Up()?p(z.Rb.Zi).data:null}function b(){var a={Ni:null,wt:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.Ni=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=c();b&&a.Ni in b&&(a.status=200,b[a.Ni]&&(a.response=a.wt(b[a.Ni])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function e(b){for(var c=0,e=0;e<b.length;e++){var k=b[e];20===k.state&&c++;if(c>=v.zx)break;if(10===k.state)switch(k.state=20,c++,k.type){case a.AT_ARRAYBUFFER:d(k,"arraybuffer");break;case a.AT_JSON:d(k,"json");break;case a.AT_TEXT:d(k,"text");break;case a.AT_AUDIOBUFFER:l(k);break;case a.AT_IMAGE_ELEMENT:g(k);
break;case a.AT_AUDIO_ELEMENT:f(k);break;case a.Ii:r(k);break;case a.Hi:h(k);break;default:throw"Wrong asset type: "+k.type;}}}function d(a,d){var e=c(),f=e&&a.r in e?new b:new XMLHttpRequest;f.open("GET",a.r,!0);"text"==d?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==d?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=d;f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;if(b){if("json"==d&&
"string"==typeof b)try{b=JSON.parse(b)}catch(c){a.$a(null,a.uri,a.type,a.r,a.gb);u.error(c+" (parsing JSON "+a.r+")");return}a.$a(b,a.uri,a.type,a.r,a.gb)}else a.$a(null,a.uri,a.type,a.r,a.gb),u.error("B4W Error: empty responce when trying to get "+a.r)}else a.$a(null,a.uri,a.type,a.r,a.gb),u.error("B4W Error: "+f.status+" when trying to get "+a.r);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.Sq(b.loaded/b.total)},!1);f.send(null)}function l(a){var d=c(),e=d&&a.r in
d?new b:new XMLHttpRequest;e.open("GET",a.r,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?q.qv(b,function(b){a.$a(b,a.uri,a.type,a.r,a.gb);a.state=30},function(){a.$a(null,a.uri,a.type,a.r,a.gb);u.error("B4W Error: failed to decode "+a.r);a.state=30}):(a.$a(null,a.uri,a.type,a.r,a.gb),u.error("B4W Error: empty responce when trying to get "+a.r),a.state=30)}else a.$a(null,a.uri,a.type,a.r,a.gb),u.error("B4W Error: "+
e.status+" when trying to get "+a.r),a.state=30};e.send(null)}function g(a){var b=document.createElement("img");G.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.$a(b,a.uri,a.type,a.r,a.gb),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.$a(null,a.uri,a.type,a.r,a.gb),u.error("B4W Error: could not load image: "+a.r),a.state=30)},!1);var d=c();if(d&&a.r in d)if(d[a.r]){var e=m(a.r);b.src="data:"+e+";base64,"+d[a.r]}else x.Rl()?(d=document.createEvent("CustomEvent"),
d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.r}function f(a){var b=document.createElement("audio");G.allow_cors&&(b.crossOrigin="Anonymous");b.addEventListener("loadeddata",function(){40!=a.state&&(a.$a(b,a.uri,a.type,a.r,a.gb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.$a(null,a.uri,a.type,a.r,a.gb),u.error("B4W Error: could not load sound: "+a.r),a.state=30)},!1);var d=c();if(d&&a.r in d)if(d[a.r]){var e=s(a.r);b.src=
"data:"+e+";base64,"+d[a.r];40!=a.state&&(a.$a(b,a.uri,a.type,a.r,a.gb),a.state=30)}else x.Rl()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.r,G.uf&&b.load();setTimeout(function(){b.Zy=1},5E3)}function r(a){var b=document.createElement("video");b.muted=!0;if(G.allow_cors||G.uf)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.$a(b,a.uri,a.type,a.r,a.gb),a.state=30)},!1);b.addEventListener("error",
function(){40!=a.state&&(a.$a(null,a.uri,a.type,a.r),u.error("B4W Error: could not load video: "+a.r,a.gb),a.state=30)},!1);var d=c();if(d&&a.r in d)if(d[a.r]){var e=B(a.r);b.src="data:"+e+";base64,"+d[a.r];40!=a.state&&(a.$a(b,a.uri,a.type,a.r,a.gb),a.state=30)}else x.Rl()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.r,G.uf&&b.load();setTimeout(function(){b.Zy=1},1E4)}function h(a){function d(b){a.$a(b,a.uri,
a.type,a.r,a.gb)}var e=c(),f=e&&a.r in e?new b:new XMLHttpRequest;f.open("GET",a.r,!0);f.responseType="arraybuffer";f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;b?n(b,d):(a.$a(null,a.uri,a.type,a.r,a.gb),u.error("B4W Error: empty responce when trying to get "+a.r))}else a.$a(null,a.uri,a.type,a.r,a.gb),u.error("B4W Error: "+f.status+" when trying to get "+a.r);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&
a.Sq(b.loaded/b.total)},!1);f.send(null)}function n(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],f={images:[],Pb:c[4]},g=20,h=0;h<e;h++){var k=c[g/4],m=new Blob([d.subarray(g+4,g+4+k)],{type:"image/jpg"}),l=document.createElement("img");l.src=window.URL.createObjectURL(m);f.images.push(l);g+=k+8-k%4}l.onload=function(){b(f)}}function m(a){var b="image";switch(F.Dl(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function s(a){var b="audio";switch(F.Dl(a).toLowerCase()){case "ogv":case "ogg":b+=
"/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function B(a){var b="video";switch(F.Dl(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var z=p("__config"),u=p("__print"),q=p("__sfx"),F=p("__util"),k=p("__version"),x=p("__compat"),v=z.md,G=z.p;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.Ii=70;a.Hi=80;var A=[],C=0,
M={};a.vi=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.Lw=function(a){if(M[a])return M[a];var b=v.Pq?a+k.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return M[a]=b;throw"Error XHR: responce is empty, GET "+a;}throw"Error XHR: "+c.status+", GET "+a;};a.cleanup=function(){for(var a=0;a<A.length;a++)A[a].state=40;A=[];C=0;M=
{}};a.enqueue=function(a,b,d,f){for(var g=0;g<a.length;g++){var h=a[g],h={uri:h[0],type:h[1],r:h[2],gb:h[3],state:10,$a:b||function(){},Hq:d||function(){},Sq:f||function(){},Iq:C};if(v.Pq){var m=c();m&&h.r in m||(h.r+=k.timestamp())}A.push(h)}e(A);C++};a.update=function(){e(A);for(var a=A,b=0,c=!0,d=0;d<a.length;d++){var f=a[d];f.Iq===a[b].Iq?30!==f.state&&(c=!1):(c&&(a[d-1].Hq(),c=d-b,a.splice(b,c),d-=c),b=d,c=30===a[d].state?!0:!1);d===a.length-1&&c&&(a[d].Hq(),a.splice(b))}}};b4w.module.__loader=function(a,p){function c(c,d,e,f){var g=u,h=s.create(),l;for(l in d){var n=b(d[l]);(f&&n.eb||!c&&n.Ab)&&m(n);s.w(h,n)}for(l in d)for(n=d[l],n.name=l,c=0;c<n.F.length;c++)s.m(h,d[n.F[c]],n,null);d=b({name:"out",Ka:a.ks,Oa:function(a,b,c,d,e){0===b.id&&(g.Qq=!0);3!=b.status&&(b.status=2);b.gq(b.id,!0);e(b,c);B.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},hb:5});var r=[];if(e)for(e=s.Gl(h),c=0;c<e.length;c++)r.push(s.Ra(h,e[c]));else s.R(h,function(a,b){b.ab||r.push(b)});
s.w(h,d);for(c=0;c<r.length;c++)d.F.push(r[c].name),s.m(h,r[c],d,null);return h}function b(a){a.ab=a.ab||!1;a.Ka||0===a.Ka||(a.Ka=a.Hc);a.F=a.F||[];a.Uh=a.Uh||!1;a.Im=a.Im||!1;a.hb=a.hb||0;a.eb=a.eb||!1;a.Ab=a.Ab||!1;a.status=0;a.tC=0;a.Zl=0;a.bf=a.bf||null;return a}function e(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];s.Ra(a.Xc,f).Uh&&(s.Ke(a.Xc,f,function(d){var e=!0;s.Rd(a.Xc,d,function(a,b){if(!b.Uh)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=
d.length-1;0<=e;e--)b.splice(d[e],1);return c}function d(a){function b(c,d){var e=s.Ra(a.Xc,c),f=s.Ra(a.Xc,d),g=f.Ka-e.Ka;0==g&&(g=e.ab-f.ab);return g}var c=[],d=a.Qd,f=!1;do{var g=e(a,d);c.push.apply(c,d);0<g.length&&(f=!0);d=g}while(0<g.length);f&&c.sort(b);a.Qd=c;return a.Qd.length}function l(a,b,c){if(b.Im)return b.Uh=!0,f(a,b),!1;if(!b.Oa&&!b.hg&&!b.zh)return f(a,b),!1;if(0==b.status&&(b.status++,b.Oa))return b.Oa(c,a,b,b.bf,f,r),!0;if(1==b.status){if(b.hg)return b.hg(c,a,b,b.bf,f,r),!0;b.status++}return 2==
b.status&&(b.status++,b.zh)?(b.zh(c,a,b,b.bf,f,r),!0):!1}function g(a){if(0==a.jk)return 100;var b=0;s.R(a.Xc,function(c,d){a.do_not_load_resources&&d.eb||(b+=d.Zl*d.hb)});return z.trunc(100*b/a.jk)}function f(a,b){b.Uh=!0;b.status=3;h(a,b,1)}function r(a,b,c){1>c?h(a,b,c):b.status++}function h(a,b,c){var d=u;if(b.Oa||b.hg||b.zh)if(b.Zl=c,b=g(a),a.No!=b||1==c)a.Om(b,performance.now()-a.Jr),a.No=b,d.cm=!0}function n(a,b){var c=null;s.R(a.Xc,function(a,d){if(d.name==b)return c=d,1});return c}function m(a){a.Im=
!0;a.Zl=1}var s=p("__graph"),B=p("__print"),z=p("__util");a.Hc=0;a.Qe=1;a.ks=2;var u=null;a.zp=function(){return u};a.Zu=function(){var a={ad:[],il:0,Ck:0,Qq:!1,cm:!1};return u=a};a.hv=function(a,b,d,e,f,g,h,m){var l=u,n={id:l.ad.length,status:0,r:b,Yn:"",gq:d||function(){},fq:m||!1,ZC:g,Jr:0,No:0,jk:0,zm:!1,Om:e||function(){},Do:f||function(){},Xc:null,Qd:null,Ol:!1,Nl:!1,Ql:!1};a=c(0===n.id,a,g,h);n.Xc=a;b=[];d=s.Jw(a);for(e=0;e<d.length;e++)b.push(d[e]);n.Qd=b;s.R(a,function(a,b){!(b.Oa||b.hg||
b.zh)||n.do_not_load_resources&&b.eb||(n.jk+=b.hb)});l.ad.push(n);l.Ck++;return n.id};a.Uz=function(b){var c=u;if(c&&0!=u.Ck)if(c.cm)c.cm=!1;else{var e=performance.now();do{var f=c.ad[c.il],g=b[f.id];if(3!=f.status)if(0==f.status&&(f.status=1,f.Jr=performance.now(),f.Om(0,0)),d(f)){var h=f,m=h.Qd.length;do{var n=s.Ra(h.Xc,h.Qd[0]),r=l(h,n,g);n.Ka==a.Qe&&(h.zm=!0);n=h.Qd.shift();h.Qd.push(n);m--}while(!r&&0!=m)}else f.Do(g,f),f.status=3,c.Ck--,h=f,h.Om=null,h.Do=null,h.Xc=null,h.Qd=null;c.Qq&&(c.il=
(c.il+1)%c.ad.length);if(f.zm){f.zm=!1;break}}while(16>performance.now()-e)}};a.PC=r;a.or=function(a,b){var c=n(a,b);null!==c&&m(c)};a.Az=function(a){return a&&3==a.status};a.is_primary_loaded=function(a){var b=u;if(!b)return!1;a|=0;return b.ad[a]&&(3==b.ad[a].status||2==b.ad[a].status)};a.cleanup=function(){u=null}};b4w.module.__nla=function(a,p){function c(){return{type:"CLIP",S:0,ba:0,Md:!1,paused:!1,$d:"",nc:0,Hn:0,At:0,$o:0,Zo:0,stop_video:!1}}function b(a,b){for(var c=a.b4w_nla_script,d=b.ye,e=0;e<c.length;e++){var f=c[e];switch(f.type){case "PLAY":d.push({type:"PLAY",S:f.frame_range[0],ba:f.frame_range[1],me:!1});break;case "SELECT":case "SELECT_PLAY":var g=z.Qh(z.Ki,f.object,0),h=z.Iw(a),k=h.indexOf(g);if(-1==k){B.error("NLA script error: non-selectable object");return}for(var f={type:f.type,pr:"SELECT"==
f.type?f.target_slot:e+1,Xy:e+1,ze:-1,xy:h.length,wy:k,S:f.frame_range[0],ba:f.frame_range[1],me:!1},k=[],l=0;l<h.length;l++)k.push(m.create_selection_sensor(h[l],!0));m.create_sensor_manifold(g,"NLA_SELECT_"+e,m.CT_SHOT,k,m.rv,function(a,c,d,e){if(!(b.xb>=b.ye.length)&&(d=b.ye[b.xb],"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.me)){for(d=0;d<e.xy;d++)if(m.get_sensor_value(a,c,d)&&d==e.wy){e.ze=1;return}e.ze=0}},f);d.push(f);break;case "JUMP":d.push({type:"JUMP",Km:f.target_slot});break;case "CONDJUMP":d.push({type:"CONDJUMP",
Km:f.target_slot,Cu:f.condition,oi:f.register1,pi:f.register2,nm:f.number1,om:f.number2});break;case "REGSTORE":d.push({type:"REGSTORE",ey:f.registerd,Mx:f.number1});break;case "MATH":d.push({type:"MATH",Ox:f.operation,oi:f.register1,pi:f.register2,nm:f.number1,om:f.number2,Jg:f.registerd});break;case "SHOW":case "HIDE":g=z.Qh(z.Ki,f.object,0);d.push({type:f.type,obj:g});break;case "REDIRECT":d.push({type:"REDIRECT",url:f.url});break;case "PAGEPARAM":d.push({type:"PAGEPARAM",Px:f.param_name,Jg:f.registerd});
break;case "NOOP":d.push({type:"NOOP"})}}}function e(a,b,c,f){if(a.ye.length){if(a.xb>=a.ye.length)if(a.cyclic)a.xb=0;else{a.za-=k.Ba*c;return}var g=l(a,b,f,!1),h=a.ye[a.xb];switch(h.type){case "PLAY":h.me?g>=h.ba&&(h.me=!1,a.xb++,e(a,b,c,f)):(a.za+=h.S-g,h.me=!0,d(a,h));break;case "SELECT":case "SELECT_PLAY":-1<h.ze?"SELECT"==h.type||"SELECT_PLAY"==h.type&&0==h.ze?(a.xb=h.ze?h.pr:h.Xy,h.ze=-1,e(a,b,c,f)):h.me?g>=h.ba&&(h.me=!1,a.xb=h.pr,h.ze=-1,e(a,b,c,f)):(a.za+=h.S-g,h.me=!0,d(a,h)):a.za-=k.Ba*
c;break;case "JUMP":a.xb=h.Km;e(a,b,c,f);break;case "CONDJUMP":var g=-1==h.oi?h.nm:a.Rc[h.oi],m=-1==h.pi?h.om:a.Rc[h.pi],n=!1;switch(h.Cu){case "EQUAL":g==m&&(n=!0);break;case "NOTEQUAL":g!=m&&(n=!0);break;case "LESS":g<m&&(n=!0);break;case "GREATER":g>m&&(n=!0);break;case "LEQUAL":g<=m&&(n=!0);break;case "GEQUAL":g>=m&&(n=!0)}n?a.xb=h.Km:a.xb++;e(a,b,c,f);break;case "REGSTORE":a.Rc[h.ey]=h.Mx;a.xb++;e(a,b,c,f);break;case "MATH":g=-1==h.oi?h.nm:a.Rc[h.oi];m=-1==h.pi?h.om:a.Rc[h.pi];switch(h.Ox){case "ADD":a.Rc[h.Jg]=
g+m;break;case "MUL":a.Rc[h.Jg]=g*m;break;case "SUB":a.Rc[h.Jg]=g-m;break;case "DIV":0==m&&q.ga("Division by zero in NLA script"),a.Rc[h.Jg]=g/m}a.xb++;e(a,b,c,f);break;case "SHOW":z.show_object(h.obj);a.xb++;e(a,b,c,f);break;case "HIDE":z.hide_object(h.obj);a.xb++;e(a,b,c,f);break;case "REDIRECT":window.location.href=h.url;a.ye.length=0;break;case "PAGEPARAM":a:{g=location.href.toString();if(-1!=g.indexOf("?"))for(g=g.split("?")[1].split("&"),m=0;m<g.length;m++)if(n=g[m].split("="),1<n.length&&n[0]==
h.Px){g=Number(n[1]);break a}g=0}a.Rc[h.Jg]=g;a.xb++;e(a,b,c,f);break;case "NOOP":a.xb++,e(a,b,c,f)}}}function d(a,b){for(var c=a.ye,d=0;d<c.length;d++){var e=c[d];e!=b&&(e.ze=-1)}}function l(a,b,c,d){b=(b-c)*k.Ba+a.za-a.S;a.cyclic&&d&&(b%=a.ba-a.S+1);return b+=a.S}function g(a,b){b?F.pause_video(a.name):(F.reset_video(a.name),F.play_video(a.name))}function f(a,b){for(var d=[],e=0;e<a.length;e++){var f=a[e].strips;if(f)for(var g=0;g<f.length;g++){var h=f[g],k=c();k.type=h.type;k.S=h.frame_start;k.ba=
h.frame_end;k.$d=h.action?h.action.name:"";k.nc=b;k.Hn=h.action_frame_start;k.At=h.action_frame_end;d.push(k)}}return d}function r(a){return u.Hd(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}var h=p("__animation"),n=p("__camera"),m=p("__controls"),s=p("__config");p("__loader");p("__particles");var B=p("__print"),z=p("__scenes"),u=p("__sfx"),q=p("__util"),F=p("__textures"),k=s.kd,x=s.p,v=[],G=-1;a.Tz=function(a,d){var e={S:a.frame_start,ba:a.frame_end,za:0,Yh:-1,cyclic:d,
Kd:[],N:[],ye:[],xb:0,Rc:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}};b(a,e);for(var g=z.Ea(a,"ALL",z.DATA_ID_ALL),k=0;k<g.length;k++){var m=g[k],l=0,s=[],D=m.animation_data;if(D&&D.nla_tracks.length&&(D=D.nla_tracks,q.sf(m)||n.is_camera(m)||q.is_mesh(m)||q.ix(m)||u.Hd(m))){var p=f(D,l);p.length&&(s=s.concat(p),l++)}r(m)&&(D=m.data.animation_data.nla_tracks,p=f(D,l),p.length&&(s=s.concat(p),l++));if(h.Ml(m))for(var G=m.data.materials,F=0;F<G.length;F++)if(p=G[F].node_tree,D=p.animation_data,p&&D){for(var D=
D.nla_tracks,p=f(D,-1),N=[],ca=0;ca<p.length;ca++)D=p[ca],-1==N.indexOf(D.$d)&&N.push(D.$d),D.nc=l+N.indexOf(D.$d),s.push(D);l+=N.length}for(F=0;F<m.particle_systems.length;F++)G=m.particle_systems[F],D=G.settings,"EMITTER"==D.type&&D.b4w_allow_nla&&(D=c(),D.type="CLIP",D.S=e.S,D.ba=e.ba+1,D.$d=G.name,D.nc=l,s.push(D),l++);G=l+1;if(q.is_mesh(m)&&m.data)for(F=0;F<m.data.b4w_vertex_anim.length;F++)p=m.data.b4w_vertex_anim[F],p.allow_nla&&(l=G,D=c(),D.type="CLIP",D.S=e.S,D.ba=e.ba+1,D.$d=p.name,D.nc=
l,s.push(D));s.length&&(m.Ak=s,e.Kd.push(m))}g=a.d.lh;for(F=0;F<g.length;F++)if(k=g[F].d,k.Ya||k.Mg)D=c(),D.type="VIDEO",m=1,x.Ec&&(m=k.Pb),D.S=Math.min(k.S*m,e.ba),D.ba=k.Wf?e.ba:Math.min((k.sg+k.S+k.za)*m,e.ba),D.$d=g[F].name,k.vt=D,e.N.push(k);F=e.S;g=e.ba;for(k=0;k<e.Kd.length;k++)for(m=e.Kd[k],l=m.Ak,s=0;s<l.length;s++)D=l[s],G=m.name+" ["+D.S+":"+D.ba+"]",D.S=Math.max(F,D.S),D.ba=Math.min(g+1,D.ba),D.S>D.ba&&(B.warn("NLA: out of scene range: "+G),l.splice(s,1),s--);for(F=0;F<e.Kd.length;F++)for(g=
e.Kd[F].Ak,k=0;k<g.length;k++){m=g[k];l=e.S;s=e.ba+1;for(D=0;D<g.length;D++)G=g[D],m.nc==G.nc&&(G.ba<=m.S&&(l=m.S),G.S>=m.ba&&(s=Math.min(s,G.S)));m.$o=l;m.Zo=s}v.push(e)};a.start=function(){G=0};a.update=function(a,b){if(!(0>G)){0==G&&(G=a);for(var c=0;c<v.length;c++){var d=v[c];e(d,a,b,G);for(var f=l(d,a,G,!0),m=0;m<d.Kd.length;m++){for(var n=d.Kd[m],r=n.Ak,s=0;s<r.length;s++){var q=r[s];"SOUND"==q.type&&f<d.Yh-1E-6&&(q.Md=!1)}for(s=0;s<r.length;s++)switch(q=r[s],q.type){case "CLIP":if(q.$o<=f&&
f<q.Zo&&!q.Md){var B=n,z=q;h.apply(B,z.$d,z.nc);h.set_behavior(B,h.AB_FINISH_STOP,z.nc);for(B=0;B<r.length;B++)r[B]!=q&&r[B].nc==q.nc&&(r[B].Md=!1);q.Md=!0}q.Md&&(B=n,h.set_current_frame_float(B,f-q.S+q.Hn,q.nc),h.update_object_animation(B,0,q.nc));break;case "SOUND":(f<d.Yh-1E-6||d.Yh<q.S)&&q.S<=f&&f<q.ba&&!q.Md&&(u.play(n,(q.S-f)/k.Ba,(q.ba-q.S)/k.Ba),q.Md=!0),d.Yh<q.ba&&q.ba<=f&&q.Md&&(q.Md=!1)}}for(m=0;m<d.N.length;m++)q=d.N[m].vt,q.S<=Math.round(f)&&Math.round(f)<q.ba&&!q.stop_video&&(g(d.N[m],
q.stop_video),q.stop_video=!0),q.ba<=Math.round(f)&&q.stop_video&&(g(d.N[m],q.stop_video),q.stop_video=!1);d.Yh=f}}};a.cleanup=function(){v.length=0;G=-1};a.Lp=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||r(a)||h.Ml(a)?!0:!1}};b4w.module.__camera=function(a,p){function c(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function b(b){var c={type:b,name:"",Ee:1,width:0,height:0,ke:null,vb:null,pc:null,Za:0,Ad:0,Ja:0,Qa:0,left:0,right:0,top:0,bottom:0,je:new Float32Array(3),ep:new Float32Array(3),quat:new Float32Array(4),ia:new Float32Array(16),YA:new Float32Array(16),qa:new Float32Array(16),
mh:new Float32Array(16),Xx:new Float32Array(16),Vc:new Float32Array(16),lr:new Float32Array(16),bg:new Float32Array(16),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,gf:null,dof_on:0,xl:{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Ja:new Float32Array([0,0,0,0]),Qa:new Float32Array([0,0,0,0])},wi:0,Yc:0,Bb:null,Ch:null,fl:null,Ko:new Float32Array(4),Zj:new Float32Array(4)};if(b==a.jb)return c;switch(b){case a.mc:l(c,
40,.1,1E3);break;case a.hd:l(c,2.5,.1,1E3);break;case a.Re:break;case a.rh:break;case a.sh:break;case a.Eb:case a.Jb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function e(b,c,d){if(b.type!=a.Eb&&b.type!=a.Jb)throw"set_stereo_params(): wrong camera type";b.wi=c;b.Yc=d;F(b,b.Za);if(Y.Z())for(c=Y.get_active(),b=c.d.Uc,c=Y.Cl(c).d.K,d=0;d<c.length;d++)A(c[d],b)}function d(a,b){var c=a.d,d=J.quat_to_dir(c.quat,J.AXIS_MY,O),e=Math.asin(d[1]/
D.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?J.quat_to_dir(c.quat,J.AXIS_MZ,aa):J.quat_to_dir(c.quat,J.AXIS_Z,aa)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b}function l(b,c,d,e,f){switch(b.type){case a.mc:case a.Eb:case a.Jb:b.Ad=c;b.Za=1;break;case a.hd:b.top=c;b.Za=1;break;case a.Re:delete b.Ad;b.Ad=c;b.Za=f/c;break;case a.rh:b.top=c;b.Za=f/c;break;default:H.error("set_frustum(): Unsupported camera type: "+b.type)}b.Ja=
d;b.Qa=e}function g(b,c){var d=c.d.g,e=c.d.quat,f=ka;N.rotateX(c.d.L,-Math.PI/2,f);N.invert(f,b.ia);if(b.Bb){var f=b.Bb[0],g=b.Bb[1],t=b.Bb[2],h=b.Bb[3],m=ka;m[0]=1-2*f*f;m[1]=-2*f*g;m[2]=-2*f*t;m[3]=0;m[4]=-2*f*g;m[5]=1-2*g*g;m[6]=-2*g*t;m[7]=0;m[8]=-2*f*t;m[9]=-2*g*t;m[10]=1-2*t*t;m[11]=0;m[12]=-2*f*h;m[13]=-2*g*h;m[14]=-2*t*h;m[15]=1;N.multiply(b.ia,m,b.ia);F(b,b.Za,!0);f=ba;g=ka;N.invert(b.ia,g);N.transpose(g,g);T.transformMat4(b.Bb,g,f);g=w;g[0]=(J.sign(f[0])+b.qa[8])/b.qa[0];g[1]=(J.sign(f[1])+
b.qa[9])/b.qa[5];g[2]=-1;g[3]=(1+b.qa[10])/b.qa[14];T.scale(f,2/(f[0]*g[0]+f[1]*g[1]+f[2]*g[2]+f[3]*g[3]),f);b.qa[2]=f[0];b.qa[6]=f[1];b.qa[10]=f[2]+1;b.qa[14]=f[3]}b.type==a.Eb?b.ia[12]+=b.Yc/2:b.type==a.Jb&&(b.ia[12]-=b.Yc/2);N.multiply(b.qa,b.ia,b.bg);x(b);k(b);D.copy(b.je,b.ep);D.copy(d,b.je);K.copy(e,b.quat)}function f(b,c,d,e){N.lookAt(c,d,e,b.ia);b.type==a.Eb?b.ia[12]+=b.Yc/2:b.type==a.Jb&&(b.ia[12]-=b.Yc/2);N.multiply(b.qa,b.ia,b.bg);x(b);k(b);D.copy(c,b.je)}function r(a){var b=a.d.K;if(!b)throw"Wrong object";
for(var c=a.d,d=0;d<b.length;d++){var e=b[d];g(e,a);J.bp(e.bg,e.xl);if(e.gf)if(e.dof_on){var f=D.dist(c.g,e.gf.location);e.dof_distance=f}else e.dof_distance=0}}function h(b){b=b.d;if(b.Ia){var c=O;b.P==a.MS_TARGET_CONTROLS?D.subtract(b.g,b.Ua,c):J.quat_to_dir(b.quat,J.AXIS_MY,c);c[1]=0;D.normalize(c,c);var d=-Math.acos(-c[2]);0>c[0]&&(d=-2*Math.PI-d);b.P==a.MS_EYE_CONTROLS&&(d*=-1);b.Ia.left+=d;b.Ia.right+=d}}function n(b){b=b.d;if(b.Ga){var c=O;b.P==a.MS_TARGET_CONTROLS?D.subtract(b.g,b.Ua,c):J.quat_to_dir(b.quat,
J.AXIS_MY,c);D.normalize(c,c);c=Math.asin(c[1]);b.Ga.Wa+=c;b.Ga.Pa+=c}}function m(a){a=a.d;if(a.Ia)if(a.Ga){var b=J.Ve(a.Ga.Wa+Math.PI/2),c=J.Ve(a.Ga.Pa+Math.PI/2);if(c>Math.PI)a.Ga={Pa:-Math.PI/2,Wa:Math.PI/2};else if(b>Math.PI||b<c)a.Ga.Wa=Math.PI/2}else a.Ga={Pa:-Math.PI/2,Wa:Math.PI/2}}function s(b){var c=b.d;if(G(b)&&c.K[0].type===a.hd){if(c.P===a.MS_TARGET_CONTROLS)var d=D.dist(c.g,c.Ua),c=d/c.Ag*c.ne;else c.tb&&c.P===a.MS_HOVER_CONTROLS?(d=q(b,O),d=D.len(d),c=d/c.Ag*c.ne):c=c.ne;for(var e in b.d.K)d=
b.d.K[e],d.top=c,F(d,d.Za);r(b)}}function B(a){a=J.quat_to_dir(a.d.quat,J.AXIS_MY,O);D.normalize(a,a);return-Math.asin(a[1])}function z(a,b,c){if(b==c)return c-a;a=J.Ve(a);b=J.Ve(b);c=J.Ve(c);var d=Math.abs(b-c);if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-b;c=J.Ve(c+b);a=J.Ve(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0}function u(a,b,c){a=a.d;var d=D.subtract(a.Ua,a.g,O);b=K.setAxisAngle(b,c,X);D.transformQuat(d,b,d);D.subtract(a.Ua,d,a.g);K.multiply(b,a.quat,a.quat)}function q(a,
b){var c=a.d;if(c.tb){var d=J.quat_to_dir(c.quat,J.AXIS_MY,O);D.normalize(d,d);if(c.Sa.Wa-c.Sa.Pa)var e=(-Math.asin(d[1])-c.Sa.Pa)/(c.Sa.Wa-c.Sa.Pa),e=Math.max(e,0);else e=0;return D.scale(d,-(e*(c.mg-c.wd)+c.wd),b)}return null}function F(b,c,d){switch(b.type){case a.mc:if(!c)throw"No aspect ratio";b.Za=c;case a.Re:N.perspective(J.Zx(b.Ad),b.Za,b.Ja,b.Qa,b.qa);break;case a.hd:if(!c)throw"No aspect ratio";b.Za=c;case a.rh:c=b.top*b.Za;N.ortho(-c,c,-b.top,b.top,b.Ja,b.Qa,b.qa);break;case a.sh:N.ortho(b.left,
b.right,b.bottom,b.top,b.Ja,b.Qa,b.qa);break;case a.Eb:case a.Jb:if(!c)throw"No aspect ratio";b.Za=c;var e=Math.tan(b.Ad*Math.PI/360);c=b.Ja*e;var f=b.Za*b.wi*e;b.type==a.Eb?(e=f-b.Yc/2,f+=b.Yc/2):(e=f+b.Yc/2,f-=b.Yc/2);e=-(b.Ja/b.wi*e);f*=b.Ja/b.wi;N.frustum(e,f,-c,c,b.Ja,b.Qa,b.qa);b.left=e;b.right=f;break;case a.jb:return;default:throw"Wrong camera type: "+b.type;}d||(N.multiply(b.qa,b.ia,b.bg),x(b),k(b))}function k(a){N.copy(a.ia,a.Vc);a.Vc[12]=0;a.Vc[13]=0;a.Vc[14]=0;a.Vc[15]=1;N.multiply(a.qa,
a.Vc,a.Vc);N.invert(a.Vc,a.Vc)}function x(a){N.copy(a.ia,a.mh);N.multiply(a.qa,a.mh,a.mh);N.invert(a.mh,a.mh)}function v(b,c,d,e,f){e||(e=new Float32Array(24));c||(c=b.Ja);d||(d=b.Qa);var g,t,h,m,k,l,n,r;switch(b.type){case a.jb:throw"Extraction from NONE camera is not possible";case a.mc:case a.Re:g=c*Math.tan(b.Ad*Math.PI/360);m=-g;t=g*b.Za;h=-t;k=d/c*g;r=-k;l=k*b.Za;n=-l;break;case a.hd:case a.rh:h=b.top*b.Za;g=k=b.top;t=l=h;m=r=-b.top;h=n=-h;break;case a.sh:g=k=b.top;t=l=b.right;m=r=b.bottom;
h=n=b.left;break;case a.Eb:case a.Jb:k=c/b.Ja;g=c*Math.tan(b.Ad*Math.PI/360);m=-g;t=b.right*k;h=b.left*k;n=d/c;k=g*n;r=-k;l=t*n;n*=h;break;default:throw"Wrong camera type: "+b.type;}e[0]=h;e[1]=m;e[2]=-c;e[3]=t;e[4]=m;e[5]=-c;e[6]=t;e[7]=g;e[8]=-c;e[9]=h;e[10]=g;e[11]=-c;e[12]=n;e[13]=r;e[14]=-d;e[15]=n;e[16]=k;e[17]=-d;e[18]=l;e[19]=k;e[20]=-d;e[21]=l;e[22]=r;e[23]=-d;f&&(c=ka,N.invert(b.ia,c),J.ue(e,c,e,0));return e}function G(a){return"CAMERA"===a.type?!0:!1}function A(a,b){if(b.enable_csm){var c=
b.csm_num;if(!a.Ch){var d=b.csm_num;a.Ch=Array(d);for(var e=0;e<d;e++)a.Ch[e]=new Float32Array(3);a.fl=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.Ja:C(b,a,d-1),f=C(b,a,d),e=v(a,e,f,L),e=y.Cw(e);a.Ch[d].set(e.A);a.fl[d]=e.ua;a.Ko[d]=D.length(e.A);a.Zj[d]=M(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.Zj[0]=b.first_cascade_blur_radius}function C(a,b,c){var d=a.csm_num,e=J.clamp(a.csm_first_cascade_border,b.Ja,b.Qa);a=J.clamp(a.csm_last_cascade_border,b.Ja,b.Qa);return J.clamp(M(e,
a,d,c),b.Ja,b.Qa)}function M(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var y=p("__boundings");p("__config");var I=p("__constraints"),H=p("__print"),Y=p("__scenes"),J=p("__util"),D=p("vec3"),T=p("vec4"),K=p("quat"),R=p("mat3"),N=p("mat4");a.jb=10;a.mc=20;a.hd=30;a.Re=40;a.rh=50;a.sh=60;a.Eb=70;a.Jb=80;a.MS_STATIC=0;a.MS_ANIMATION=1;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var ca=new Float32Array(2),O=new Float32Array(3),
aa=new Float32Array(3),X=new Float32Array(4);new Float32Array(4);var ba=new Float32Array(4),w=new Float32Array(4),ga=new Float32Array(16),ka=new Float32Array(16),L=new Float32Array(24);a.ou=function(d){var e=d.d,f=d.data;switch(f.type){case "PERSP":var g=b(a.mc);if(f.angle_y)var k=f.angle_y/Math.PI*180;l(g,k,f.clip_start,f.clip_end);break;case "ORTHO":g=b(a.hd),l(g,f.ortho_scale/2,f.clip_start,f.clip_end)}g.name=d.name;e.Or=!1;e.P=c(f.b4w_move_style);e.dof_distance=d.data.dof_distance;e.gf=d.data.dof_object;
e.dof_front=d.data.b4w_dof_front;e.dof_rear=d.data.b4w_dof_rear;e.dof_power=d.data.b4w_dof_power;e.Xo=d.data.b4w_enable_hover_hor_rotation;e.K=[g];if(e.P==a.MS_TARGET_CONTROLS||e.P==a.MS_EYE_CONTROLS||e.P==a.MS_HOVER_CONTROLS)e.fn=d.data.b4w_trans_velocity,e.en=d.data.b4w_rot_velocity,e.gn=d.data.b4w_zoom_velocity;e.P==a.MS_TARGET_CONTROLS&&e.Ua.set(f.b4w_target);f=d.d;if(f.P===a.MS_TARGET_CONTROLS||f.P===a.MS_EYE_CONTROLS||f.P===a.MS_HOVER_CONTROLS)g=d.data,f.P===a.MS_TARGET_CONTROLS||f.P===a.MS_EYE_CONTROLS?
(g.b4w_use_horizontal_clamping&&(f.Ia={left:g.b4w_rotation_left_limit,right:g.b4w_rotation_right_limit}),g.b4w_use_vertical_clamping&&(f.Ga={Pa:g.b4w_rotation_down_limit,Wa:g.b4w_rotation_up_limit}),"LOCAL"==g.b4w_horizontal_clamping_type&&h(d),"LOCAL"==g.b4w_vertical_clamping_type&&n(d),m(d),g.b4w_use_panning&&(f.Ur=g.b4w_use_panning)):f.P===a.MS_HOVER_CONTROLS&&(g.b4w_use_horizontal_clamping&&g.b4w_horizontal_translation_min<=g.b4w_horizontal_translation_max&&(f.Ia={left:g.b4w_horizontal_translation_min,
right:g.b4w_horizontal_translation_max}),g.b4w_use_vertical_clamping&&g.b4w_vertical_translation_min<=g.b4w_vertical_translation_max&&(f.Ga={Pa:-g.b4w_vertical_translation_max,Wa:-g.b4w_vertical_translation_min}),g.b4w_use_distance_limits&&g.b4w_hover_angle_min<=g.b4w_hover_angle_max&&(f.Sa={Pa:g.b4w_hover_angle_min,Wa:g.b4w_hover_angle_max})),f.tb=g.b4w_use_distance_limits&&g.b4w_distance_min<=g.b4w_distance_max,f.tb&&(f.wd=g.b4w_distance_min,f.mg=g.b4w_distance_max);f=d.d;if(f.P===a.MS_HOVER_CONTROLS&&
f.tb)if(f.Sa){var k=B(d),r=J.quat_to_dir(f.quat,J.AXIS_Z,O),g=0;0<r[1]&&(g-=Math.asin(r[1]/D.len(r)));k>f.Sa.Wa?g+=k-f.Sa.Wa:k<f.Sa.Pa&&(g+=f.Sa.Pa-k);(g||0>k)&&H.warn("B4W Warning: Active hover camera has wrong orientation");g&&(k=J.quat_to_dir(f.quat,J.AXIS_X,aa),g=K.setAxisAngle(k,-g,X),K.normalize(g,g),K.multiply(g,f.quat,f.quat));g=J.quat_to_dir(f.quat,J.AXIS_MY,O);k=ba;k.set(J.AXIS_Y);k[3]=0;g=J.line_plane_intersect(k,0,f.g,g,f.Ed);if(!g||100<D.len(g))f.Ed[0]=f.g[0],f.Ed[1]=0,f.Ed[2]=f.g[2]}else f.tb=
!1;d=d.d;switch(d.P){case a.MS_TARGET_CONTROLS:d.Ag=D.dist(d.g,d.Ua);d.ne=d.K[0].top;break;case a.MS_HOVER_CONTROLS:d.tb&&(d.Ag=D.dist(d.g,d.Ed),d.ne=d.K[0].top)}d=J.quat_to_dir(e.quat,J.AXIS_Z,O);e.P==a.MS_TARGET_CONTROLS&&(e.lk=0<d[1])};a.nb=b;a.ZA=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.vb);case "DEPTH":return Boolean(a.pc);case "SCREEN":return!Boolean(a.vb)&&!Boolean(a.pc);default:throw"Wrong attachment type: "+b;}};a.ek=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.vb=
c;break;case "DEPTH":a.pc=c;break;case "SCREEN":a.vb=null;a.pc=null;break;default:throw"Wrong attachment type: "+b;}};a.NB=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.vb;case "DEPTH":return a.pc;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.iq=function(b,c){if(b.type!=a.mc||c!=a.Eb&&c!=a.Jb)throw"make_stereo(): wrong camera type";b.type=c;e(b,6,.065)};a.Ly=e;a.ar=function(a,b){var c=a.d.quat,d=X,e=O;e[0]=0;e[1]=1;e[2]=0;K.setAxisAngle(e,b,d);K.multiply(d,
c,c)};a.HC=function(a,b){var c=a.d.quat,d=X,e=O;e[0]=1;e[1]=0;e[2]=0;K.setAxisAngle(e,b,d);K.multiply(d,c,c)};a.GC=function(a,b){var c=a.d.quat;K.invert(c,c);var d=X,e=O;e[0]=0;e[1]=0;e[2]=1;K.setAxisAngle(e,-b,d);K.multiply(d,c,c);K.invert(c,c)};a.Am=function(a,b){var c=a.d.quat;K.invert(c,c);var d=X,e=O;e[0]=1;e[1]=0;e[2]=0;K.setAxisAngle(e,-b,d);K.multiply(d,c,c);K.invert(c,c)};a.get_angles=d;a.Em=l;a.Dy=function(b,c,d,e,f,g,t){switch(b.type){case a.sh:b.left=c;b.right=d;b.bottom=e;b.top=f;b.Ja=
g;b.Qa=t;break;default:H.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.d.P};a.JC=g;a.KC=f;a.ir=function(a,b,c){var d=O;d[0]=0;d[1]=-1;d[2]=0;D.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=aa;e[0]=0;e[1]=0;e[2]=-1;D.transformQuat(e,c,e);f(a,b,d,e)};a.IC=function(a,b,c){if("CAMERA"!=a.type)throw"Wrong camera object";a=a.d;a.g.set(b);a.quat.set(c)};a.Nv=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];N.lookAt(a,b,c,ka);N.invert(ka,
ka);N.rotateX(ka,Math.PI/2,ka);R.fromMat4(ka,ga);K.fromMat3(ga,e)};a.Pr=r;a.Kz=function(b){var c=b.d;c.P==a.MS_TARGET_CONTROLS&&(c.tb?I.py(c.g,c.quat,c.Ua,c.wd,I.gs):I.oy(c.g,c.quat,c.Ua));c.P!=a.MS_TARGET_CONTROLS&&c.P!=a.MS_EYE_CONTROLS||I.correct_up(b,J.AXIS_Y)};a.bx=h;a.iA=n;a.hn=m;a.Sz=s;a.yu=function(b){var c=b.d;if(c.P===a.MS_TARGET_CONTROLS||c.P===a.MS_EYE_CONTROLS){if(c.Ia){var e=c.Ia.left,f=c.Ia.right,g=d(b,ca),g=g[0],g=c.P==a.MS_TARGET_CONTROLS?g-Math.PI:-1*g;if(g=z(g,e,f))c.P==a.MS_TARGET_CONTROLS?
u(b,J.AXIS_Y,g):(g=K.setAxisAngle(J.AXIS_MY,g,X),K.multiply(g,b.d.quat,b.d.quat))}c.Ga&&(e=c.Ga.Pa,f=c.Ga.Wa,g=d(b,ca),g=g[1],c.P==a.MS_TARGET_CONTROLS&&(g*=-1),g=0<J.quat_to_dir(c.quat,J.AXIS_Z,O)[1]?J.sign(g)*Math.PI-g:g,g=z(g,e,f))&&(c.P==a.MS_TARGET_CONTROLS?(e=J.quat_to_dir(b.d.quat,J.AXIS_MX,aa),u(b,e,g)):(e=g,g=b.d,f=J.quat_to_dir(g.quat,J.AXIS_X,O),e=K.setAxisAngle(f,e,X),K.multiply(e,g.quat,g.quat)));c.P===a.MS_TARGET_CONTROLS&&(c.tb&&(g=b.d,e=D.subtract(g.g,g.Ua,O),f=D.length(e),f>g.mg?
(D.scale(e,g.mg/f,e),D.add(g.Ua,e,g.g)):f<g.wd&&(f=J.quat_to_dir(g.quat,J.AXIS_MY,aa),D.scale(f,100*g.wd,f),D.add(e,f,e),D.scale(e,-g.wd/D.length(e),e),D.add(g.Ua,e,g.g))),s(b))}c.P===a.MS_HOVER_CONTROLS&&(c=b.d,g=c.tb?c.Ed:c.g,c.Ia&&(g[0]=J.clamp(g[0],c.Ia.left,c.Ia.right)),c.Ga&&(g[2]=J.clamp(g[2],c.Ga.Pa,c.Ga.Wa)),c=b.d,c.tb&&(e=J.quat_to_dir(c.quat,J.AXIS_Z,O),g=0,0<e[1]&&(g=Math.asin(e[1]/D.len(e))),e=D.negate(d(b,ca),ca),e[1]<c.Sa.Pa?g+=e[1]-c.Sa.Pa:e[1]>c.Sa.Wa&&(g+=e[1]-c.Sa.Wa),g&&(e=J.quat_to_dir(c.quat,
J.AXIS_X,aa),D.normalize(e,e),g=K.setAxisAngle(e,g,X),K.normalize(g,g),K.multiply(g,c.quat,c.quat)),g=q(b,O),D.add(c.Ed,g,c.g),s(b)))};a.tp=B;a.Dw=q;a.jC=function(b){switch(b.type){case a.mc:case a.hd:case a.Eb:case a.Jb:return!0;default:return!1}};a.nw=function(b){b=b.d.K[0];switch(b.type){case a.mc:case a.Re:case a.Eb:case a.Jb:return Math.PI*b.Ad/180;default:return H.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.Og=F;a.lu=k;a.mu=x;a.Kv=v;a.Yt=function(a){a=a.d;var b=y.ed();b.min_x=
-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Lb=b;var c=y.dl(1,[0,0,0]);a.yc=c;a.Kk=y.Go(1,b);a.Mk=y.Io(1,b);a.Lk=y.Ho(1,b)};a.is_camera=G;a.rb=function(b){return G(b)&&b.d&&b.d.P==a.MS_TARGET_CONTROLS?!0:!1};a.cb=function(b){return G(b)&&b.d&&b.d.P==a.MS_HOVER_CONTROLS?!0:!1};a.tf=function(b){return G(b)&&b.d&&b.d.P==a.MS_EYE_CONTROLS?!0:!1};a.bn=A;a.kv=C};b4w.module.__lights=function(a,p){function c(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),ig:new Float32Array(3),Uf:0,ik:0,jw:!1,Vo:!1,jh:!0,kh:!0,he:1,distance:25,xB:"INVERSE_SQUARE"}}function b(a){a.ig[0]=a.color[0]*a.he;a.ig[1]=a.color[1]*a.he;a.ig[2]=a.color[2]*a.he}var e=p("__util"),d=p("vec3");a.bC=c;a.qx=function(a){var g=a.data,f=c(g.type);f.name=a.name;f.jh=g.use_diffuse;f.kh=g.use_specular;var r=e.quat_to_dir(a.d.quat,e.AXIS_Y,[]);d.normalize(r,
r);f.direction[0]=r[0];f.direction[1]=r[1];f.direction[2]=r[2];f.color[0]=g.color[0];f.color[1]=g.color[1];f.color[2]=g.color[2];f.he=g.energy;b(f);f.distance=g.distance;if("POINT"===f.type||"SPOT"===f.type)f.distance=g.distance;"SPOT"===f.type&&(f.Uf=g.spot_size,f.ik=g.spot_blend);f.jw=g.b4w_generate_shadows;f.Vo=g.b4w_dynamic_intensity;a.la=f};a.Fy=function(a,c){a.color[0]=c[0];a.color[1]=c[1];a.color[2]=c[2];b(a)};a.Hy=function(a,b){a.ik=b};a.Gy=function(a,b){a.distance=b};a.Iy=function(a,b){a.Uf=
b};a.er=function(a,c){a.he=c;b(a)};a.Sl=function(a){return"LAMP"===a.type?!0:!1};a.Pz=function(a){if("LAMP"!=a.type)throw"Wrong light object";var b=a.la;b&&e.quat_to_dir(a.d.quat,e.AXIS_Y,b.direction)}};b4w.module.__scenes=function(a,p){function c(){if(!kb)throw"No active scene available";return kb}function b(){return kb?!0:!1}function e(a,b,c,d){for(var e=null,f=0;f<b.length;f++){var g=b[f];if((c?g.origin_name:g.name)==a&&g.d.ud==d){e=g;break}}return e}function d(a,b){b||(b="ALL");var c=[];l(a.objects,b,c);return c}function l(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&l(e.objects,b,c)}}function g(b){if("NONE"==sa.Ae||!b.b4w_render_shadows)return!1;
var c=!1,d=!1;if(0==ba(b,"LAMP",a.DATA_ID_ALL).length)return!1;b=ba(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){var f=b[e];f.b4w_shadow_cast&&(c=!0);f.b4w_shadow_receive&&(d=!0);if(c&&d)return!0}return!1}function f(a){if(!a.lb)return!1;a=a.lb.LAMP;for(var b=0;b<a.length;b++)if("SUN"==a[b].la.type)return!0;return!1}function r(a){if(!sa.shore_smoothing)return!1;a=w(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}function h(b){var c=w(b),
d=[];b=ba(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<c.length;e++){var f=c[e];if(f.b4w_water){for(var g={},t=0;t<b.length;t++)for(var h=b[t],m=h.data.materials,k=0;k<m.length;k++)m[k]==f&&(g.Ne=h.location[1]);if(sa.kj)for(g.Ob=f.b4w_water_fog_color.slice(0),g.Ob.push(f.b4w_water_fog_density),f.b4w_water_dynamic?(g.pg=!0,g.waves_height=f.b4w_waves_height,g.waves_length=f.b4w_waves_length,g.dst_noise_scale0=f.b4w_water_dst_noise_scale0,g.dst_noise_scale1=f.b4w_water_dst_noise_scale1,g.dst_noise_freq0=f.b4w_water_dst_noise_freq0,
g.dst_noise_freq1=f.b4w_water_dst_noise_freq1,g.dir_min_shore_fac=f.b4w_water_dir_min_shore_fac,g.dir_freq=f.b4w_water_dir_freq,g.dir_noise_scale=f.b4w_water_dir_noise_scale,g.dir_noise_freq=f.b4w_water_dir_noise_freq,g.dir_min_noise_fac=f.b4w_water_dir_min_noise_fac,g.dst_min_fac=f.b4w_water_dst_min_fac,g.waves_hor_fac=f.b4w_water_waves_hor_fac):(g.pg=!1,g.waves_height=0,g.waves_length=0),g.bj=null,g.Vk=null,g.Wk=new Float32Array(2),g.gk=null,f=f.texture_slots,t=0;t<f.length;t++)h=f[t].texture,"VORONOI"==
h.type&&(g.bj=h.noise_scale,g.Wk.set([.3,.7]),g.Vk=h.noise_intensity),!0===h.b4w_shore_dist_map&&(g.gk=h.image,g.Qg=h.image.size[0],g.Uy=h.b4w_shore_boundings,g.Eg=h.b4w_max_shore_dist);else g.waves_height=0,g.waves_length=0,g.bj=null,g.Vk=null,g.Wk=null,g.Ob=null,g.pg=!1;d.push(g)}}if(0<d.length){g=d[0];if(!g.pg)for(e=0;e<d.length;e++)d[e].pg&&(g=d[e]);return g}return null}function n(a){function b(a){if(a){a=a.nodes;for(var d=0;d<a.length;d++){var e=a[d];"GROUP"==e.type&&e.node_group&&b(e.node_group.node_tree);
"GROUP"==e.type&&"B4W_REFRACTION"==e.node_tree_name&&(c.Cc=!0)}}}var c={};a=w(a);for(var d=0;d<a.length;d++){var e=a[d];e.b4w_refractive&&(c.Cc=!0);e.node_tree&&b(e.node_tree)}return c}function m(b){if(!sa.ck||!b.b4w_render_reflections)return!1;var c=[];b=ba(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var e=b[d];if(e.b4w_reflective){var f;a:{e=e.constraints;for(f=0;f<e.length;f++){var g=e[f];if("LOCKED_TRACK"==g.type&&"REFLECTION PLANE"==g.name){f=g.target;break a}}f=null}f&&(e=f.location,
f=f.d.quat,g=new Float32Array(4),ua.Dz(e,f,ua.AXIS_Y,g),c.push(g))}}return c}function s(a,b){var c={},d=a.world.b4w_sky_settings;c.procedural_skydome=d.procedural_skydome&&b;c.use_as_environment_lighting=d.use_as_environment_lighting;c.Rg=d.color;c.rayleigh_brightness=d.rayleigh_brightness;c.mie_brightness=d.mie_brightness;c.spot_brightness=d.spot_brightness;c.scatter_strength=d.scatter_strength;c.rayleigh_strength=d.rayleigh_strength;c.mie_strength=d.mie_strength;c.rayleigh_collection_power=d.rayleigh_collection_power;
c.mie_collection_power=d.mie_collection_power;c.mie_distribution=d.mie_distribution;!b&&d.procedural_skydome&&za.warn("B4W Warning: There is no sun on the scene. Procedural sky won't be rendered");return c}function B(a){var b={};a=a.world.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.ax=a.hemisphere;b.hu=a.blur_depth;b.$n=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;b.qy=a.samples;return b}function z(a){var b={};a=a.world.b4w_bloom_settings;b.blur=a.blur;b.Bv=
a.edge_lum;b.key=a.key;return b}function u(a){var b={};a=a.world.b4w_motion_blur_settings;b.Mj=a.motion_blur_decay_threshold;b.Nj=a.motion_blur_factor;return b}function q(a){var b={};a=a.world.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}function F(a){var b={};a=a.world.b4w_god_rays_settings;b.fx=a.intensity;b.Dg=a.max_ray_length;b.Zg=a.steps_per_pass;return b}function k(a){var b={};a=a.world;b.Rh=a.b4w_glow_color;
b.sj=a.b4w_glow_factor;return b}function x(a){var b=a.world;a=[0,0,0];var c=[0,0,0],d=b.light_settings,e=b.texture_slots;if(d.use_environment_light)if("SKY_COLOR"==d.environment_color||"SKY_TEXTURE"==d.environment_color)a=b.horizon_color.slice(0),c=b.zenith_color.slice(0);else if("PLAIN"==d.environment_color)a=[1,1,1],c=[1,1,1];else throw"Unsupported world environment color"+d.environment_color;b={};b.ie=d.environment_energy;b.qc=a;b.wc=c;b.Sg=e;return b}function v(b){if(!sa.Da)return!1;var c=!1,
d=!1;b=ba(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){for(var f=b[e],g=f.data.materials,t=0;t<g.length;t++)g[t].b4w_terrain&&(c=!0);f=f.particle_systems;for(t=0;t<f.length;t++)g=f[t].settings,"HAIR"==g.type&&g.b4w_dynamic_grass&&(d=!0);if(c&&d)return!0}return!1}function G(b){b=ba(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)if(b[c].d.Sc)return!0;return!1}function A(b){b=ba(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,e=0;e<d.length;e++){var f=d[e],
g=f.game_settings.alpha_blend;if(f.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g)return!0}return!1}function C(a,b,c){var d=ta.Hg(a,b);ta.Rd(a,d,function(a,b,d){if(d.Ca){switch(d.O){case "COLOR":case "CUBEMAP":a=b.j.vb;break;case "DEPTH":a=b.j.pc;break;case "SCREEN":a=null;break;default:throw"Wrong slink";}switch(d.ea){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(!a)throw"Connection of SCREEN is forbidden";if(a.Le)throw"Batch texture can't use renderbuffer";
la.oo(c.Nb,d.ea)&&da.Ri(c,a,d.ea)}}});for(a=0;a<b.da.length;a++){var d=b.da[a],e=b.$c[a];switch(d.ea){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(e.Le)throw"Batch texture can't use renderbuffer";la.oo(c.Nb,d.ea)&&da.Ri(c,e,d.ea)}}}function M(a,b,c,d,e){for(var f=b.d,g=b.W,t=0;t<g.length;t++){var h=g[t];if(!(h.Wb||h.Ub||"MAIN"!=h.type&&"NODES"!=h.type&&"PARTICLES"!=h.type||D(a,h))){if("OPAQUE"===d){if(h.xa)continue;var m=pa.bb(c,"SHADOW_CAST")&&
h.Cb?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE"}else if("BLEND"===d||"XRAY"===d){if(!h.xa)continue;if("XRAY"==d!=h.Td)continue;if(pa.bb(c,"SHADOW_CAST")&&h.Cb)switch(sa.Ae){case "DEPTH":m="SHADOW_SRC_DEPTH";break;default:throw"Wrong shadows type";}else m="SHADOW_SRC_NONE"}else throw"Wrong main subscene type";"NODES"==h.type&&h.Ct&&(b.d.MA.push(h.Ct),b.d.LA.push(h.OA));var k=h.Va,l=e.d.Uc;la.G(k,"SHADOW_SRC",m);da.Hk(h,l);la.G(k,"NUM_LIGHTS",a.Hf);"special_skydome.glslf"==la.sp(k)&&la.G(k,"REFLECTION_PASS",
0);la.G(k,"SSAO_ONLY",0);a.Ma&&a.Fc?la.G(k,"WATER_EFFECTS",1):la.G(k,"WATER_EFFECTS",0);a.Ma&&a.af&&f.af?(la.G(k,"CAUSTICS",1),la.G(k,"CAUST_SCALE",a.ko),la.G(k,"CAUST_SPEED",la.s(a.lo,2)),la.G(k,"CAUST_BRIGHT",a.jo)):la.G(k,"CAUSTICS",0);a.Ma&&(la.G(k,"WAVES_HEIGHT",la.s(a.Oe)),la.G(k,"WAVES_LENGTH",la.s(a.cg)),la.G(k,"WATER_LEVEL",la.s(a.Ne)));h.Bc&&pa.bb(c,"MAIN_REFLECT")&&-1===h.ic.indexOf("u_mirrormap")?la.G(k,"REFLECTIVE",1):la.G(k,"REFLECTIVE",0);var n=pa.bb(c,"SKY");n?h.Rq?(l=n.j.vb,da.Ri(h,
l,"u_sky")):sa.$j?(h.$b=n.$b,la.G(k,"PROCEDURAL_FOG",1)):la.G(k,"PROCEDURAL_FOG",0):la.G(k,"PROCEDURAL_FOG",0);if("SKY_TEXTURE"==e.world.light_settings.environment_color){l=null;if(e.d.Jm.procedural_skydome&&e.world.b4w_sky_settings.use_as_environment_lighting)l=n.j.vb;else for(t=0;t<a.Sg.length;t++)if(a.Sg[t].texture.b4w_use_as_environment_lighting){l=da.rw(a.Sg[t],!1);break}l?(la.G(k,"SKY_TEXTURE",1),da.Ri(h,l,"u_sky_texture")):za.warn("B4W Warning: environment lighting is set to 'Sky Texture', but there is no world texture with environment map")}h.Da&&
(l=pa.bb(c,"GRASS_MAP"))&&J(h,l,f);h.wm?"NODES"==h.type?(la.G(k,"REFRACTIVE",1),e.d.Cc?la.G(k,"USE_REFRACTION",1):la.G(k,"USE_REFRACTION",0)):e.d.Cc?la.G(k,"REFRACTIVE",1):la.G(k,"REFRACTIVE",0):(la.G(k,"REFRACTIVE",0),la.G(k,"USE_REFRACTION",0));h.Me&&(h.nn&&pa.bb(c,"DEPTH")?la.G(k,"SHORE_SMOOTHING",1):la.G(k,"SHORE_SMOOTHING",0),h.water_dynamic&&a.Ma&&a.Oe?la.G(k,"DYNAMIC",1):la.G(k,"DYNAMIC",0));"PARTICLES"==h.type&&(la.G(k,"SIZE_RAMP_LENGTH",h.Fq),la.G(k,"COLOR_RAMP_LENGTH",h.wq));for(var n=h.N,
V=0;V<n.length;V++)if(l=n[V],"SCENE"==l.source)for(var P=0;P<Aa.length;P++)for(var r=Aa[P],s=Aa[P].Xd,U=0;U<s.length;U++)s[U].d==l&&ta.m(fb,r,e,null);if(h.Bg){var l=0,q;for(q in h.Bg)l++;la.G(k,"NUM_LAMP_LIGHTS",l);h.Wl=new Float32Array(3*l);h.Ul=new Float32Array(3*l);h.Tl=new Float32Array(3*l);h.Vl=new Float32Array(4*l);for(V=0;V<e.lb.LAMP.length;V++)y(h,e.lb.LAMP[V])}Y(c,a,m);da.Db(h);m={U:!0,fb:f,n:h};I(h);a.o.push(m);C(c,a,h);H(h)}}a.o.sort(function(a,b){var c;if(a.n&&b.n){c=a.n.xa;var d=b.n.xa;
(c=c==d?0:c>d?1:-1)||(c=a.n.Kf,d=b.n.Kf,c=c==d?0:c>d?1:-1)}else c=0;return c})}function y(a,b){var c=b.uuid;if(c in a.Bg){c=a.Bg[c];a.Wl.set(b.d.g,3*c);a.Ul.set(b.la.direction,3*c);a.Tl.set(b.la.ig,3*c);var d=Sb;O(b.la,Bb,d);a.Vl.set(d,4*c)}}function I(a){var b=a.Nb.attributes,c=a.mb.Sb,d;for(d in b)if(!c[d])throw'B4W Error: missing data for "'+d+'" attribute';if("MAIN"==a.type||"NODES"==a.type)b=la.Ow(a.Nb.kn),10<b&&("MAIN"==a.type&&za.warn("B4W Warning: Varying limit exceeded for main shader - "+
b+', materials: "'+a.Ac.join(", ")+'"'),"NODES"==a.type&&(d=c=0,a.Zf&&(c=ua.nf(a.Zf)),a.Xa&&(d=ua.nf(a.Xa)),za.warn("B4W Warning: Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.Ac.join(", ")+'"')))}function H(a){8<a.N.length&&za.warn("B4W Warning: too many textures used - "+a.N.length+' (max 8), materials "'+a.Ac.join(", ")+'"')}function Y(a,b,c){for(var d=0,e=pa.up(a,b),f=0;f<e.length;f++){var g=e[f];"SHADOW_SRC_DEPTH"!=c||"SHADOW_CAST"!=g.type&&"POSTPROCESSING"!=
g.type||(g=pa.Qv(a,g,"SHADOW_CAST").j,b.Vr=g.ia,b.Xn=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.Nf=b.Nf||[],b.Nf[d]=g.qa,d++)}}function J(a,b,c){a.Qb=b.Qb;var d=b.Qb[0],e=b.Qb[1],f=b.Qb[2];c=c.Lb;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,c);b.Qb[2]=f;b=b.j;Q.Em(b,f/2,-e,-d,f/2);Q.Og(b);d=a.Il||0;d=0==d?c:Math.max(d,c);a.Il=d}function D(a,b){for(var c=a.o,d=0;d<c.length;d++){var e=c[d].n;if(e&&e.id==b.id)return!0}return!1}function T(a){var b=S(a,"MAIN_OPAQUE"),
c=!0;ta.R(a.d.qb,function(d,e){"SHADOW_CAST"===e.type&&(K(e,b,e.o,a,c),c=!1)})}function K(b,c,d,e,f){if(0!=d.length){var g=b.j;c=c.j;var t=ba(e,"LAMP",a.DATA_ID_ALL),t=R(t)||t[0],h=t.d;Q.ir(g,h.g,h.quat);xa.copy(c.je,g.je);Ea.copy(c.ia,g.lr);if("SPOT"==t.la.type||"POINT"==t.la.type)Q.Og(g,g.Za);else{t=rb;ia.ed(t);for(h=0;h<d.length;h++){var k=d[h].fb;0==h?ia.Fo(k.Na,t):ia.Yo(t,k.Na)}d=ia.Jv(t,ab);ua.ue(d,g.ia,d);if(e.d.Uc.enable_csm){e=xa.copy(c.Ch[b.el],Ia);t=Ea.invert(c.ia,Wa);ua.ue(e,t,e);ua.ue(e,
g.ia,e);b=c.fl[b.el];if(f)for(tb=0,f=2;f<d.length;f+=3)tb=Math.min(tb,d[f]);f=rb;f.max_x=e[0]+b;f.max_y=e[1]+b;f.max_z=0;f.min_x=e[0]-b;f.min_y=e[1]-b;f.min_z=tb}else{b=f=rb;c=Ca;c.set(d);e=Zb/9;d=Ea.identity(Wa);Ea.rotate(d,e,ua.AXIS_MZ,d);h=t=-1;for(k=0;10>k;k++){var m=ia.cu(c,Mb),l=(m.max_x-m.min_x)*(m.max_y-m.min_y);if(-1==t||l<t)t=l,h=k,ia.Fo(m,b);ua.ue(c,d,c)}b=h*e;0<b&&(c=Ea.identity(Wa),Ea.rotate(c,b,ua.AXIS_MZ,c),Ea.multiply(c,g.ia,g.ia));b=f.max_x-f.min_x;c=f.max_y-f.min_y;b&&c&&(e=Math.abs(b-
c)/2,2<b/c?(f.max_y+=e,f.min_y-=e):2<c/b&&(f.max_x+=e,f.min_x-=e));f.max_x+=.005;f.max_y+=.005;f.max_z+=.005;f.min_x-=.005;f.min_y-=.005;f.min_z-=.005}Q.Dy(g,f.min_x,f.max_x,f.min_y,f.max_y,-f.max_z,-f.min_z);Q.Og(g)}ua.bp(g.bg,g.xl)}}function R(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.data.b4w_generate_shadows)return c}return!1}function N(a,b){for(var c=b.d,d=b.W,e="COLOR_PICKING_XRAY"==a.type,f=0;f<d.length;f++){var g=d[f];if(g.Td==e&&"COLOR_ID"==g.type&&!D(a,g)){da.aa(g,"USE_GLOW",0);da.Db(g);
var t={U:!0,fb:c,n:g};I(g);a.o.push(t)}}}function ca(a){var b=ua.Ah(a);a.Va=JSON.parse(JSON.stringify(a.Va));return b}function O(a,b,c){b[0]=1;b[1]=0;b[2]=0;b[3]=a.jh?1:0;c[0]=-1;c[1]=-1;c[2]=-1;c[3]=a.kh?1:0;switch(a.type){case "HEMI":b[0]=.5;b[1]=.5;break;case "POINT":c[2]=a.distance;break;case "SPOT":c[2]=a.distance,b=c[0]=Math.cos(a.Uf/2),c[1]=a.ik*(1-b)}}function aa(a,b){for(var c=L(b,nb),d=a.la,e=a.d,f=d.index,g=0;g<c.length;g++){var t=c[g];t.Af.set(e.g,3*f);t.xf.set(d.direction,3*f);t.wf.set(d.ig,
3*f);var h=Bb,k=Sb;O(d,h,k);switch(d.type){case "SUN":if(t.Gr.set(e.quat),t.Fr=d.ig,"SKY"===t.type){var m=Ia;m[0]=m[1]=m[2]=1;var l=Math.acos(xa.dot(t.kk,m)),m=Math.acos(xa.dot(d.direction,m));t.Qj=Math.floor(l/.025)!=Math.floor(m/.025)?!0:!1;xa.copy(d.direction,t.kk);X(b,t)}else xa.copy(d.direction,t.kk);case "HEMI":case "POINT":case "SPOT":break;default:za.error("B4W Warning: unknown light type: "+d.type)}t.yf.set(h,4*f);t.zf.set(k,4*f);t.Aa=!0;for(h=0;h<t.o.length;h++)k=t.o[h].n,k.Bg&&y(k,a)}}
function X(a,b){Ta.Gh(b);if(b.Qj)for(var c=L(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY"]),d=0;d<c.length;d++)for(var e=c[d].o,f=0;f<e.length;f++){var g=e[f];g.U&&(g=g.n,da.qu(g)&&Ta.Hz(g))}}function ba(b,c,d){if(!b.lb)throw"Access to uninitialized scene";b=b.lb[c];if(d==a.DATA_ID_ALL)return b;c=[];for(var e=0;e<b.length;e++){var f=b[e];f.d.ud==d&&c.push(f)}return c}function w(b){var c=[];b=ba(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++)for(var e=b[d].data,f=0;f<e.materials.length;f++){var g=
e.materials[f];-1==c.indexOf(g)&&c.push(g)}return c}function ga(a,b,c){for(var d=a.d,e=a.camera.d.K,f=0;f<e.length;f++){var g=e[f];Q.Og(g,b/c);d.ym&&Q.bn(g,d.Uc)}d.ym&&(d.Rj=!0,S(a,"DEPTH").Aa=!0,S(a,"MAIN_BLEND").Aa=!0);Q.Pr(a.camera);pa.Ez(d.qb,function(d,e,f){if(d.hh){var g=d.Ee*b,t=d.Ee*c;if(e)for(e=0;e<f.da.length;e++)f.da[e]==d&&Va.resize(d.ha,g,t);else Va.Xh(d.ha)&&Va.resize(d.ha,g,t),d=f.j,d.width=g,d.height=t,"DOF"==f.type&&W(a,{dof_power:f.j.dof_power,dof_on:f.j.dof_on}),ka(f,1/b,1/c)}})}
function ka(a,b,c){a=a.o;for(var d=0;d<a.length;d++){var e=a[d].n;e&&da.ui(e,b,c)}}function L(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];ta.R(a.d.qb,function(a,b){b.type==e&&c.push(b)})}return c}function S(a,b){return pa.bb(a.d.qb,b)}function W(a,b){var c=S(a,"DOF");if(!c)return za.error("DOF is not enabled on scene. Check camera settings"),0;var d=a.d.qb;"boolean"==typeof b.dof_on&&(c.j.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.j.dof_distance=b.dof_distance);"number"==
typeof b.dof_front&&(c.j.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.j.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.j.dof_power=b.dof_power;for(var e=pa.ob(d,c,"POSTPROCESSING"),d=pa.ob(d,e,"POSTPROCESSING"),e=[e,d],d=0;d<e.length;d++){var f=e[d].o[0].n;f&&(da.Sf(f,c.j.dof_power),ka(e[d],1/c.j.width,1/c.j.height))}}c.Aa=!0}function ja(a,b){var c=S(kb,"MAIN_OPAQUE");if(!c||!c.Ma)return za.error("get_water_surface_level() - no water parameters on this scene"),0;var d=c.Oe,e=c.cg,
f=c.Ne,g=c.Ma;if(!d||!g.pg)return g.Ne;var t=xa.length(c.Ei),h=c.time;t&&(h*=t);var k=Xa;k[0]=20/e*(a-.25*h);k[1]=20/e*(b-.25*h);t=ua.mo(k);k[0]=17/e*(b+.1*h);k[1]=17/e*(a+.1*h);var k=ua.mo(k),t=t+k-1,m=g.dst_noise_scale0,k=g.dst_noise_scale1,l=g.dst_noise_freq0,n=g.dst_noise_freq1,V=Xa;V[0]=m*(a+l*h);V[1]=m*(b+l*h);m=ua.Lm(V);V[0]=k*(b-n*h);V[1]=k*(a-n*h);k=ua.Lm(V);k*=d*m;if(c.uk)if(n=(a-c.Be[0])/c.Ce[0],V=(c.Be[1]+b)/c.Ce[1],n+=.5,V+=.5,1<n||0>n||1<V||0>V)d=k;else var n=ua.pp(kb.d.Gm,c.Qg,n,V),
m=g.dir_freq,P=g.dir_noise_scale,r=g.dir_noise_freq,l=g.dir_min_noise_fac,V=g.dst_min_fac,c=e/c.Eg/Math.PI,P=[P/e*(a+r*h),P/e*(b+r*h)],e=Math.sqrt(n),d=d*Math.max(n,g.dir_min_shore_fac)*Math.sin(e/c+m*h)*Math.max(ua.Lm(P),l),g=Math.max(e,V),d=d*(1-g)+k*g,t=t*n;else d=k;return f+(d+.05*t)}function qa(a,b){a.Vh&&"POSTPROCESSING"==a.type&&b.U!=a.U&&(a.U=b.U);b.U||"GLOW"!=a.type||(a.ol=0)}function P(a,b,c,d){var e=ta.Ra(a,b);Q.ek(e.j,c,d);e.Ik=!0;ta.Ke(a,b,function(b,e,f){f.Ca&&f.O==c&&pa.xu(f)&&U(a,
b,f.ea,d)});ta.Rd(a,b,function(b,e,f){f.Ca&&f.O==c&&f.O==f.ea&&P(a,b,c,d)})}function U(a,b,c,d){a=ta.Ra(a,b).o;for(b=0;b<a.length;b++)da.ly(a[b].n,d,c)}function t(a){var b=S(a,"GRASS_MAP");if(b){var c=b.j,d=a.camera.d,e=d.g;a=Ia;a[0]=0;a[1]=-b.Qb[2]/2;a[2]=0;xa.transformQuat(a,d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=qb;b[0]=0;b[1]=0;b[2]=0;b[3]=1;Q.ir(c,a,b)}}function V(a,b){ta.R(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.da[0]||!d.$c[0])throw"Wrong MOTION_BLUR subscene";var e=d.da[0],f=d.$c[0];
d.$c[0]=d.j.vb;ta.Ke(a,c,function(b,c,d){d.Ca&&U(a,b,d.ea,f)});P(a,c,e.O,f);U(a,c,e.ea,d.$c[0]);d.lq=Math.exp(-b/d.Nj)}})}function oa(b,c){var d=0,e=b.ut;0==e.Wm&&(e.Wm=c);var f=c-e.Wm;if(e.Xq&&f/e.sc>=e.Xq)a.clear_glow_anim(b);else{f%=e.sc;if(f<e.Cp)switch(e=f/(e.Cp/5),f=Math.floor(e),f){case 0:d=(e-f)/2;break;case 1:d=(e-f)/2+.5;break;case 2:d=1;break;case 3:d=1-(e-f)/2;break;case 4:d=.5-(e-f)/2}for(e=0;e<b.W.length;e++)f=b.W[e],"COLOR_ID"==f.type&&(f.xg=d)}}function ra(a){ta.R(a.d.qb,function(a,
b){b.Aa=!0})}function ma(a){if("WIND"==a.field.type){a=a.d;ua.quat_to_dir(a.quat,ua.AXIS_Y,va);xa.normalize(va,va);xa.scale(va,a.wl,va);a=Aa;for(var b=0;b<a.length;b++)for(var c=L(a[b],ob),d=0;d<c.length;d++)c[d].Ei.set(va)}}var da=p("__batch"),ia=p("__boundings"),Q=p("__camera"),ya=p("__config"),fa=p("__debug"),Ga=p("__geometry"),ta=p("__graph"),wa=p("__hud"),Za=p("__objects");p("__particles");var Sa=p("__prerender"),Oa=p("__primitives"),za=p("__print"),Ta=p("__renderer"),pa=p("__scenegraph"),tc=
p("__sfx"),la=p("__shaders"),Va=p("__textures"),ua=p("__util"),xa=p("vec3"),Ea=p("mat4"),sa=ya.p,Ha=ya.kd,Pa="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),pb=["ARMATURE","EMPTY","MESH","SPEAKER"],Lb="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GLOW_MASK WIREFRAME".split(" "),nb="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),Yb=["MAIN_OPAQUE","SSAO","MAIN_BLEND","MAIN_XRAY",
"MAIN_REFLECT"],ob="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS GLOW_MASK WIREFRAME".split(" "),uc=["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],hc=0,kb=null,Aa=[],fb=null,zb=[],ic=0,Ab=0,$a=1,eb=0,Ja=0,Zb=Math.PI/2;a.Ki=0;a.un=1;a.vn=2;a.DATA_ID_ALL=-1;var Xa=new Float32Array(2),Ia=new Float32Array(3),Bb=new Float32Array(4),Sb=new Float32Array(4),qb=new Float32Array(4),Wa=new Float32Array(16),ab=new Float32Array(24),Ca=new Float32Array(24),
rb=ia.ed(),Mb=ia.ed(),va=new Float32Array(3),tb=null;a.set_active=function(a){kb=a;tc.Ay(a)};a.Wx=function(a,b){var c=a.d,d=pa.Yu(c.qb);if(a==b){ga(a,ic,Ab);for(var e=0;e<d.length;e++)a.d.Qf.push(d[e])}else for(e=a.Xd[0],ga(a,e.d.Tf,e.d.Tf),e=0;e<d.length;e++)b.d.Qf.push(d[e]);d=L(a,ob);for(e=0;e<d.length;e++)d[e].Ei.set(va);for(e=0;e<c.Qf.length;e++)"SHADOW_CAST"==c.Qf[e].type&&Ta.Gh(c.Qf[e])};a.get_active=c;a.Z=b;a.Cl=function(a){return a.camera};a.Ph=function(){return Aa};a.Gw=function(){if(1==
Aa.length)return Aa;for(var a=[],b=0;b<Aa.length;b++){var c=Aa[b];if(!c.Xd.length){b=ta.Hg(fb,c);b=ta.Cr(fb,b,ta.rn);b=ta.Xm(b);ta.R(b,function(b,c){a.push(c)});break}}return a};a.Qh=function(b,c,d,f){for(var g=Aa,t=null,h="",k=0;k<g.length;k++){var m=ba(g[k],"ALL",a.DATA_ID_ALL);switch(b){case a.Ki:h=c;t=e(c,m,!1,d);break;case a.un:h=d;t=null;(m=e(c,m,!1,f))&&m.dupli_group&&(t=e(d,m.dupli_group.objects,!0,f));break;case a.vn:for(var h=c[c.length-1],t=null,l=0;l<c.length;l++)if((t=e(c[l],m,0!=l,d))&&
t.dupli_group)m=t.dupli_group.objects;else break}if(t)break}t||za.warn("get object "+h+": not found");return t};a.Ot=function(a,b,c){for(var e in pb){var f=pb[e],g=d(a,f),t=b.d.lh,h=!1;for(e=0;e<c.length;e++)if(h=!0,c[e].d&&c[e].d.vf){for(var k=0;k<t.length;k++)t[k]==c[e]&&(h=!1);h&&t.push(c[e])}f in b.lb||(b.lb[f]=[]);for(k=0;k<g.length;k++)ua.sf(g[k])&&g[k].proxy||(b.lb.ALL.push(g[k]),b.lb[f].push(g[k]))}};a.It=function(b,c){b.lb={ALL:[]};for(var e in Pa){var t=Pa[e],l=d(b,t);b.lb[t]=[];for(var V=
0;V<l.length;V++)ua.sf(l[V])&&l[V].proxy||(b.lb.ALL.push(l[V]),b.lb[t].push(l[V]))}b.Xd=b.Xd||[];b.d=b.d||{};t=b.d;l=b.camera.d;e=b.world.b4w_shadow_settings;V=t.Uc={};e.csm_resolution>sa.Oc?(V.csm_resolution=sa.Oc,za.error("B4W warning: Shadow map texture has unsupported size. Changed to "+sa.Oc+".")):V.csm_resolution=e.csm_resolution;V.self_shadow_polygon_offset=e.self_shadow_polygon_offset;V.self_shadow_normal_offset=e.self_shadow_normal_offset;V.enable_csm=e.b4w_enable_csm;var P=ba(b,"LAMP",a.DATA_ID_ALL);
if(P=R(P)||P[0])V.Xl=P.la.type,V.Uf=P.la.Uf,V.distance=P.la.distance,"SPOT"!=V.Xl&&"POINT"!=V.Xl||!V.enable_csm||(za.warn("B4W Warning: Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),V.enable_csm=!1);V.enable_csm?(V.csm_num=e.csm_num,V.csm_first_cascade_border=e.csm_first_cascade_border,V.first_cascade_blur_radius=e.first_cascade_blur_radius,V.csm_last_cascade_border=e.csm_last_cascade_border,V.last_cascade_blur_radius=e.last_cascade_blur_radius,V.fade_last_cascade=e.fade_last_cascade,
V.blend_between_cascades=e.blend_between_cascades):(V.csm_num=1,V.csm_first_cascade_border=e.csm_first_cascade_border,V.first_cascade_blur_radius=e.first_cascade_blur_radius,V.csm_last_cascade_border=e.csm_last_cascade_border,V.last_cascade_blur_radius=e.last_cascade_blur_radius,V.fade_last_cascade=!1,V.blend_between_cascades=!1);t.lh=[];for(e=0;e<c.length;e++)c[e].d&&c[e].d.vf&&t.lh.push(c[e]);e=b.world.b4w_fog_color;t.Ob=new Float32Array([e[0],e[1],e[2],b.world.b4w_fog_density]);t.$g=f(b);t.Jm=
s(b,t.$g);t.rA=x(b);t.Zp=ba(b,"LAMP",a.DATA_ID_ALL).length;t.Ma=h(b);t.xx=n(b);t.Co=G(b)||sa.force_selectable;t.Td=A(b);t.pq=0;l.K[0].type!=Q.mc&&sa.anaglyph_use?(za.warn("B4W Warning: Anaglyph stereo is disabled for the non-perspective camera"),e=!1):e=sa.anaglyph_use;t.anaglyph_use=e;t.ym=sa.kj&&g(b);t.BB=b.world.b4w_fog_color;t.shore_smoothing=r(b);t.dy=m(b);t.gu=z(b);t.Bx=u(b);t.pu=q(b);t.Vw=F(b);t.Sw=k(b);t.og=sa.og&&(0<l.dof_distance||l.gf);t.Da=v(b);t.Fg=sa.Fg&&b.b4w_enable_motion_blur;t.kg=
sa.kg&&b.b4w_enable_color_correction;t.antialiasing=sa.antialiasing&&b.b4w_enable_antialiasing;t.gg=sa.gg&&b.b4w_enable_bloom&&t.$g;t.Ge=sa.Ge&&b.b4w_enable_ssao;t.nz=B(b);t.yg=sa.yg&&b.b4w_enable_god_rays&&t.$g;t.Cc=sa.Cc&&b.b4w_render_refractions;t.glow=sa.glow?t.Co:!1;t.vv=sa.kj;e=b.Xd.sort(function(a,b){return b.d.Tf-a.d.Tf});t.qb=pa.Xu(t,l,e);t.Qf=[];t.Rj=!1;t.km=!1;Aa.push(b);fb||(fb=ta.create());ta.w(fb,b)};a.$k=d;a.El=function(a){return a.d.qb};a.bw=function(a){ta.R(a,function(b,c){var d=
null;switch(c.type){case "POSTPROCESSING":d=da.Jo(c.ii);break;case "SSAO":d=da.ev(c);break;case "SSAO_BLUR":d=da.fv(c);da.ui(d,1/c.j.width,1/c.j.height);break;case "DEPTH_PACK":d=da.Ou();break;case "REFRACT":case "COPY":d=da.Jo("NONE");break;case "GOD_RAYS":pa.ob(a,c,"WIREFRAME")||pa.ob(a,c,"MAIN_BLEND")||pa.ob(a,c,"GOD_RAYS");d=da.Ru(c.Gq|0,(c.Bb&&c.Me)|0,c.Zg);break;case "GOD_RAYS_COMBINE":pa.ob(a,c,"WIREFRAME")||pa.ob(a,c,"MAIN_BLEND");pa.ob(a,c,"GOD_RAYS");d=da.Su();break;case "MOTION_BLUR":d=
da.Wu(c.Mj);break;case "DOF":d=da.Pu();da.Sf(d,c.j.dof_power);for(var e=pa.ob(a,c,"POSTPROCESSING"),f=pa.ob(a,e,"POSTPROCESSING"),g=[e,f],t=0;t<g.length;t++){var h=g[t].o;(e=h[0].n)&&da.Sf(e,c.j.dof_power)}break;case "GLOW":g=pa.ob(a,c,"POSTPROCESSING");t=pa.ob(a,g,"POSTPROCESSING");e=pa.ob(a,t,"POSTPROCESSING");f=pa.ob(a,e,"POSTPROCESSING");d=da.Qu();g=[t,g];for(t=0;t<g.length;t++)h=g[t].o,(h=h[0].n)&&da.Sf(h,c.ao);g=[f,e];for(t=0;t<g.length;t++)h=g[t].o,(h=h[0].n)&&da.Sf(h,c.ap*c.sj);break;case "COMPOSITING":d=
da.Mu();break;case "ANTIALIASING":d=da.Iu();break;case "LANCZOS":d=da.Tu(c.oC);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=da.cv(c.type);break;case "ANAGLYPH":d=da.Hu();break;case "SKY":d=da.bv();da.ui(d,1/c.j.width,1/c.j.height);break;case "LUMINANCE":d=da.Uu();break;case "AVERAGE_LUMINANCE":d=da.Ju();break;case "LUMINANCE_TRUNCED":d=da.Vu();break;case "BLOOM_BLUR":d=da.Ku(c.ii);da.ui(d,1/c.j.width,1/c.j.height);
break;case "BLOOM":d=pa.ob(a,c,"BLOOM_BLUR");g=[pa.ob(a,d,"BLOOM_BLUR"),d];for(t=0;t<g.length;t++)h=g[t].o,(h=h[0].n)&&da.Sf(h,c.bloom_blur);d=da.Lu();break;case "VELOCITY":d=da.iv()}d&&(e={U:!0,fb:Za.gj("NONE"),n:d},I(d),c.o.push(e),C(a,c,d),H(d))})};a.append_object=function(a,b){switch(b.type){case "MESH":var c=a.d.qb,d=b.d;!pa.bb(c,"SHADOW_CAST")&&d.Cb&&(d.Cb=!1);for(var d=L(a,Lb),e=0;e<d.length;e++){var f=d[e],g=b,t=c,h=a;switch(f.type){case "MAIN_OPAQUE":M(f,g,t,"OPAQUE",h);break;case "MAIN_BLEND":M(f,
g,t,"BLEND",h);break;case "MAIN_XRAY":M(f,g,t,"XRAY",h);break;case "MAIN_REFLECT":t=g.d;g=g.W;for(h=0;h<g.length;h++){var k=g[h],m=ca(k);if(!("MAIN"!=m.type&&"NODES"!=m.type&&"PARTICLES"!=m.type||D(f,m)||m.xa)&&m.ec){var l=m.Va;la.G(l,"DISABLE_FOG",0);la.G(l,"WATER_EFFECTS",0);"special_skydome.glslf"==la.sp(l)&&la.G(l,"REFLECTION_PASS",1);la.G(l,"SHADOW_SRC","SHADOW_SRC_NONE");la.G(l,"TEXTURE_NORM",0);da.Db(m);l={U:!0,fb:t,n:m};I(m);f.o.push(l);"MAIN"==m.type&&(k.Fb||(k.Fb=[]),k.Fb.push(m))}}break;
case "DEPTH":k=g.d;g=g.W;for(m=0;m<g.length;m++){var n=g[m];if("DEPTH"==n.type&&!D(f,n)&&!n.Wb){if(pa.$w(t,f,"SHADOW_CAST"))if(n.Cb){switch(sa.Ae){case "DEPTH":var l="SHADOW_SRC_DEPTH",V="SHADOW_DST_MASK";break;default:throw"Wrong shadows type";}n=da.an(n,l,V);da.Hk(n,h.d.Uc);pa.up(t,f);Y(t,f,l)}else n=da.an(n,"SHADOW_SRC_NONE","SHADOW_DST_MASK");else n=da.an(n,"SHADOW_SRC_NONE","SHADOW_DST_NONE");n.Da&&(l=pa.bb(t,"GRASS_MAP"))&&J(n,l,k);da.Db(n);l={U:!0,fb:k,n:n};I(n);f.o.push(l);C(t,f,n);H(n)}}break;
case "SHADOW_CAST":k=!1;m=g.d;g=g.W;for(l=0;l<g.length;l++)if(n=g[l],n.Vb||n.Cb)if(k=!0,"DEPTH"==n.type&&!D(f,n)&&n.Vb){switch(sa.Ae){case "DEPTH":V="SHADOW_DST_DEPTH";break;default:throw"Wrong shadows type";}n=da.av(n,V);n.Da&&(V=pa.bb(t,"GRASS_MAP"))&&J(n,V,m);da.aa(n,"SHADOW_TEX_RES",la.s(h.d.Uc.csm_resolution));da.Db(n);V={U:!0,fb:m,n:n};I(n);f.o.push(V)}k&&K(f,pa.bb(t,"MAIN_OPAQUE"),f.o,h,!0);break;case "COLOR_PICKING":N(f,g);break;case "COLOR_PICKING_XRAY":N(f,g);break;case "GRASS_MAP":t=g.d;
g=g.W;for(h=0;h<g.length;h++)k=g[h],"GRASS_MAP"!=k.type||D(f,k)||(da.Db(k),m={U:!0,fb:t,n:k},I(k),f.o.push(m),k=f.j,V=t.Na,m=f.Qb[0],l=f.Qb[1],n=f.Qb[2],0==m&&0==l?(m=V.min_y,l=V.max_y):(m=Math.min(m,V.min_y),l=Math.max(l,V.max_y)),V=1E-4*(l-m),f.Qb[0]=m-V,f.Qb[1]=l+V,Q.Em(k,n/2,-l,-m,n/2),Q.Og(k));break;case "GLOW_MASK":t=g.d;g=g.W;for(h=0;h<g.length;h++)k=g[h],"COLOR_ID"!=k.type||D(f,k)||(m=ca(k),da.aa(m,"USE_GLOW",1),da.Db(m),g.push(m),l={U:!0,fb:t,n:m},I(m),f.o.push(l),k.Fb||(k.Fb=[]),k.Fb.push(m));
break;case "WIREFRAME":for(h=g.d,g=g.W,k=0;k<g.length;k++)m=g[k],"WIREFRAME"!=m.type||D(f,m)||(m.Da&&(l=pa.bb(t,"GRASS_MAP"))&&J(m,l,h),da.Db(m),l={U:!0,fb:h,n:m},I(m),f.o.push(l),C(t,f,m),H(m))}}break;case "LAMP":b.la.index=a.d.pq++;c=L(a,nb);for(d=0;d<c.length;d++)c[d].Hf++;aa(b,a)}};a.UB=D;a.Cm=function(a){a.d.Rj=!0};a.xw=function(a,b){for(var c=a.d.Uc,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=Q.kv(c,b,e);return d};a.hide_object=function(a){a.d.Sh=!0};a.show_object=function(a){a.d.Sh=
!1};a.hy=function(a,b){for(var c=b.d,d=L(a,Lb),e=0;e<d.length;e++)for(var f=d[e].o,g=f.length-1;0<=g;g--){var t=f[g];t.fb==c&&(t.n&&Ga.vo(t.n.mb),f.splice(g,1))}};a.check_object=function(a,b){return b.lb[a.type]&&-1<b.lb[a.type].indexOf(a)?!0:!1};a.$y=function(a){var b=a.lb.LAMP;if(b.length==a.d.pq){for(var c=[],d=0;d<b.length;d++)c[b[d].la.index]=d;for(d=0;d<c.length-1;d++)for(var e=d+1;e<c.length;e++){var f=b[c[d]].la,g=b[c[e]].la;if(g.jh&&g.kh&&(!f.jh||!f.kh)||!f.jh&&(g.jh||!f.kh&&g.kh))f=c[d],
c[d]=c[e],c[e]=f}for(d=0;d<c.length;d++)b[c[d]].la.index=d,aa(b[c[d]],a)}};a.Vf=aa;a.Wz=function(b){var c=ba(b,"LAMP",a.DATA_ID_ALL);if(c=R(c)||c[0]){b=L(b,nb);for(var d=0;d<b.length;d++)b[d].mr=c.la.index}};a.cleanup=function(){for(var a=0;a<Aa.length;a++){var b=Aa[a];ta.R(b.d.qb,function(a,b){if("SINK"!=b.type){var c=b.j;Ta.iy(c.ke,c.vb,c.pc,c.width,c.height);for(var c=b.o,d=0;d<c.length;d++){var e=c[d].n;e&&da.zu(e)}}});b.d.qb=[];b.d.Qf=[]}kb=null;Aa.length=0;fb=null;zb.length=0;va[0]=0;va[1]=
0;va[2]=0};a.hq=function(a,b,c){a=Q.Kv(a,a.Ja,a.Qa,null,!0);var d=Oa.fw(a);a=Za.gj("DYNAMIC");a.Na=a.Lb={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.ub=a.yc=ia.eu();var e=a.ub.ua;a.$e=a.Ze=ia.cl([e,0,0],[0,e,0],[0,0,e],a.ub.A);c=da.$u(d,c);b.o.push({U:!0,fb:a,n:c})};a.Ea=ba;a.Hw=function(a){return[a.frame_start,a.frame_end]};a.jr=function(a,b,c,d,e){ic=a;Ab=b;$a=c;eb=e;Ja=d;kb&&ga(kb,a,b)};a.ui=ka;a.tz=L;a.ma=S;a.get_environment_colors=function(a){a=L(a,nb)[0];var b=a.qc,
c=a.wc,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.ie,d,e]};a.set_environment_colors=function(a,b,c,d){a=L(a,nb);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.ie=b);c&&f.qc.set(c);d&&f.wc.set(d);f.Aa=!0}};a.get_sky_params=function(a){if(a=S(a,"SKY")){var b={};b.color=Array(3);xa.copy(a.Rg,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=
a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=S(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&
(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.Rg.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==
typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.Aa=!0,c.Qj=!0,X(a,c))};a.get_fog_color_density=function(a,b){var c=b||[],d=L(a,Yb)[0].Ob;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,
b){for(var c=L(a,Yb),d=0;d<c.length;d++){var e=c[d];e.Ob.set(b);e.Aa=!0}};a.get_ssao_params=function(a){var b=S(a,"SSAO");a=S(a,"SSAO_BLUR");if(!b)return null;var c=b.o[0].n,d={};d.ssao_quality=da.pb(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.$n=a.ssao_blur_discard_value;d.radius_increase=b.Wg;d.influence=b.Vg;d.dist_factor=b.Ug;d.ssao_only=b.ssao_only;d.ssao_white=da.pb(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=S(a,"SSAO"),
d=S(a,"SSAO_BLUR");if(!c)return za.error("SSAO is not enabled on scene"),0;if("string"==typeof b.ssao_quality){var e=c.o[0].n;da.aa(e,"SSAO_QUALITY",b.ssao_quality);da.Db(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.o[0].n,da.aa(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),da.Db(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.o[0].n,da.aa(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),da.Db(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.Wg&&
(c.Wg=b.Wg);"number"==typeof b.Vg&&(c.Vg=b.Vg);"number"==typeof b.Ug&&(c.Ug=b.Ug);if("number"==typeof b.ssao_only){c=S(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var f=0;f<c.o.length;f++)e=c.o[f].n,da.aa(e,"SSAO_ONLY",b.ssao_only),da.Db(e,!0)}"number"==typeof b.ssao_white&&(e=c.o[0].n,da.aa(e,"SSAO_WHITE",b.ssao_white),da.Db(e,!0));c.Aa=!0;d.Aa=!0};a.get_dof_params=function(a){a=S(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.j.dof_distance;b.dof_front=a.j.dof_front;b.dof_rear=a.j.dof_rear;
b.dof_power=a.j.dof_power;return b};a.set_dof_params=W;a.get_god_rays_params=function(a){var b=L(a,["GOD_RAYS"]);a=S(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].Dg;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=da.pb(b[0].o[0].n,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=L(a,["GOD_RAYS"]),d=S(a,"GOD_RAYS_COMBINE");if(!c||!d)return za.error("God Rays are not enabled on scene"),0;"number"==typeof b.god_rays_intensity&&
(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].Dg=e,c[f].bk=e/c[f].Zg/(f+1),c[f].Aa=!0;if("number"==typeof b.god_rays_steps)for(var g=la.s(b.god_rays_steps,1),e=c[0].Dg,f=0;f<c.length;f++){c[f].Zg=g;c[f].bk=e/g/(f+1);c[f].Aa=!0;var t=c[f].o[0].n;da.aa(t,"STEPS_PER_PASS",g);da.Db(t,!0)}d.Aa=!0};a.get_bloom_params=function(a){var b=S(a,["LUMINANCE_TRUNCED"]);a=S(a,"BLOOM");if(!b||!a)return null;var c=
{};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=function(a,b){var c=S(a,"LUMINANCE_TRUNCED"),d=S(a,"BLOOM");if(!c||!d)return za.error("Bloom is not enabled on scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.Aa=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.Aa=!0);if("number"==typeof b.bloom_blur)for(var e=a.d.qb,c=pa.ob(e,d,"BLOOM_BLUR"),e=pa.ob(e,c,"BLOOM_BLUR"),c=[c,e],e=0;e<c.length;e++){var f=
c[e].o[0].n;f&&(da.Sf(f,b.bloom_blur),ka(c[e],1/d.j.width,1/d.j.height))}};a.get_wind_params=function(){var a=va,b=xa.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.set_wind_params=function(b,c){for(var d=ba(b,"ALL",a.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if("EMPTY"===f.type&&f.field&&"WIND"===f.field.type)var g=f}if(!g)return za.error("There is no wind on the scene"),0;d=g.d;"number"==typeof c.wind_dir&&(Ia=[0,c.wind_dir/180*
Math.PI,-Math.PI/2],ua.euler_to_quat(Ia,qb),d.quat.set(qb),ma(g));"number"==typeof c.wind_strength&&(d.wl=c.wind_strength,ma(g));ra(b)};a.vy=function(a){a.d.km=!0};a.get_water_surface_level=ja;a.get_water_mat_params=function(a,b){var c=S(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.Oe,b.waves_length=c.cg,c.Fc)){b.water_fog_density=c.Fc[3];var d=b.water_fog_color=[];d[0]=c.Fc[0];d[1]=c.Fc[1];d[2]=c.Fc[2]}};a.set_water_params=function(a,b){var c=S(a,"MAIN_OPAQUE");if(!c||!c.Ma)return za.error("set_water_params() - no water parameters on this scene"),
null;c=c.Ma;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=
b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.pg=b.water_dynamic);for(var d=L(a,uc),e=0;e<d.length;e++){var f=d[e];"number"==typeof b.water_fog_density&&c.Ob&&(f.Fc[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&
c.Ob&&f.Fc.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.Oe=b.waves_height);"number"==typeof b.waves_length&&(f.cg=b.waves_length);f.Aa=!0}};a.get_shore_dist=function(a,b){var c=S(kb,"MAIN_OPAQUE");if(!c.uk)return 100;var d=c.Eg,e=c.Ne,f=(a[0]-c.Be[0])/c.Ce[0],g=(c.Be[1]+a[2])/c.Ce[1],f=f+.5,g=g+.5;if(1<f||0>f||1<g||0>g)e=1;else return c=d*ua.pp(kb.d.Gm,c.Qg,f,g),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(a,b){for(var d=c().camera.d,e=0;e<Aa.length;e++){var f=Aa[e],g=f.d.qb;
if(f.d.Ma)var h=d.g[1]-ja(d.g[0],d.g[2]);for(var k=f.d.lh,m=0;m<k.length;m++){var l=k[m].d,n=l.Ya,P=l.sg+l.za;if(n){var r=Math.round(n.currentTime*l.Pb),s=l.za/l.Pb;if(r<l.za-(sa.uf?5:0)||k[m].d.Wf&&r>P)n.currentTime=s;!l.Wf&&r>P&&n.pause();2<=n.readyState&&!n.paused&&Va.Zz(l)}else if(l.Mg){n=Math.min(l.Mg.length,l.sg+l.za);if(l.Nd<l.za||l.Wf&&l.Nd>=n)l.Nd=l.za;!l.Wf&&l.Nd>=n&&(l.Ng=!1);n=Math.round(a*Ha.Ba/l.Pb)*l.dr;n!=hc&&l.Ng&&(Va.Vz(l),l.Nd++);hc=n}}ta.R(g,function(b,c){-1<ob.indexOf(c.type)&&
(c.time=a);-1<uc.indexOf(c.type)&&f.d.Ma&&(c.Uk=h)})}for(e=0;e<zb.length;e++)oa(zb[e],a);for(e=0;e<Aa.length;e++)if(f=Aa[e],m=f.d,d=m.Qf,m.Rj&&(T(f),m.Rj=!1),m.km&&(t(f),m.km=!1),d.length){f.b4w_enable_motion_blur&&V(m.qb,b);if(m.glow){for(var g=S(f,"GLOW_MASK").o,U=0,m=0;m<g.length;m++)U+=g[m].n.xg;ta.R(f.d.qb,function(a,b){"GLOW"===b.type&&(b.ol=U)})}g=null;for(m=0;m<d.length;m++)"GLOW_MASK"==d[m].type&&(g=m);for(m=0;m<d.length;m++)k=d[m],Sa.um(k),null!==g&&qa(k,d[g]),Ta.Gh(k)}sa.show_hud_debug_info&&
wa.Vy(Aa,b)};a.Bl=function(a){var b=[];ta.R(a.d.qb,function(a,c){b.push(c)});return b};a.apply_glow_anim=function(a,b,c,d){a.ut={Wm:0,Cp:b,sc:c,Xq:d};-1==zb.indexOf(a)&&zb.push(a)};a.clear_glow_anim=function(a){if(a.W)for(var b=0;b<a.W.length;b++){var c=a.W[b];"COLOR_ID"==c.type&&(c.xg=0)}a=zb.indexOf(a);-1!=a&&zb.splice(a,1)};a.fB=function(){zb=[]};a.get_cam_water_depth=function(){var a=S(kb,"MAIN_BLEND"),b=kb;return a||b.d.Ma?a.Uk:null};a.get_object_data_id=function(a){return a.d.ud};a.Sr=ra;a.Ry=
function(a,b){switch(b){case "WM_NONE":a.U=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.o.length;c++)a.o[c].n.wireframe_mode=fa.An[b];a.U=!0}a.xa="WM_TRANSPARENT_WIREFRAME"==b;a.Aa=!0};a.Qy=function(a,b){for(var c=0;c<a.o.length;c++)a.o[c].n.wireframe_edge_color=b,a.Aa=!0};a.Jn=function(a,b){for(var c=0;c<b.length;c++)a.lb.ALL.push(b[c]),a.lb.MESH.push(b[c])};a.Rr=ma;a.pick_object=function(d,e){if(!b())return za.error("No active scene"),
null;var f=c(),g=S(f,"COLOR_PICKING");if(g){d-=Ja;e-=eb;d*=$a;e*=$a;Sa.um(g);Ta.Gh(g);var t=S(f,"COLOR_PICKING_XRAY");t?(Sa.um(t),Ta.Gh(t),g=t.j):g=g.j;e=g.height-e;g=Ta.ay(g.ke,d,e);f=ba(f,"MESH",a.DATA_ID_ALL);for(t=0;t<f.length;t++){var h=f[t].Cn;if(h&&5>Math.abs(255*h[0]-g[0])&&5>Math.abs(255*h[1]-g[1])&&5>Math.abs(255*h[2]-g[2]))return f[t]}}else za.error("Color picking is not available");return null};a.Qw=function(){return va};a.Iw=function(b){var c=[];b=ba(b,"MESH",a.DATA_ID_ALL);for(var d=
0;d<b.length;d++){var e=b[d];e.d.Sc&&c.push(e)}return c};a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b}};b4w.module.__physics=function(a,p){function c(a,b){for(var d=a.Wd,e=0;e<d.length;e++)d[e].d.sk&&b.push(d[e]),c(d[e],b)}function b(a,b){if(ca)switch(a){case C.qs:G.log(b);break;case C.ns:G.error(b);break;case C.os:A.fbmsg.apply(this,b.slice(1));break;case C.us:var c=e(b.body_id);if(c){var d=b.trans,f=b.quat,g=b.linvel,h=b.angvel,c=c.l;c.gl=b.time;I.ti(d,1,f,c.hl);J.copy(g,c.dq);J.copy(h,c.Ln)}break;case C.ss:(d=e(b.chassis_hull_body_id))&&I.ti(b.trans,1,b.quat,d.i.ki[b.prop_ind]);break;case C.ps:if(c=
e(b[1]))d=b[4],c=c.xc.Xi[b[2]],y.set_translation(c,b[3]),y.set_rotation(c,d),y.v(c);break;case C.vs:if(c=e(b[1]))c.i.speed=b[2];break;case C.ls:for(var d=b.body_id_a,c=b.body_id_b,f=b.result,g=b.coll_point,d=parseInt(d),h=ca.l.o,k=0;k<h.length;k++)for(var m=h[k].sb,l=0;l<m.Kc.length;l++){for(var n=m.Kc[l],r=n.Vj,s=!1,q=0;q<r.length;q++){var B=r[q];if(B[0]===d&&B[1]===c){n.Jq[q]=f;s=!0;break}}if(s){r=n.Jq;for(q=s=0;q<r.length;q++)s=s||r[q];n.callback(s,g)}}break;case C.ms:if(c=e(b[1]))c=c.l,c.ej&&
c.ej(b[2]);break;case C.ts:if(c=e(b.body_id))for(c=c.l,f=b.from,g=b.to,h=b.local,k=b.body_id_b_hit,m=b.cur_result,l=0;l<c.ve.length;l++)if(r=c.ve[l],H.dj(r.O,f)&&H.dj(r.ea,g)&&r.local==h){for(d in r.Ld)r.Ld[d]=1;-1!=k&&(r.Ld[k]=m);for(var n=r.Zb,q=r.callback,r=r.Ld,s=!1,B=1,D=0;D<ca.l.o.length;D++){var v=ca.l.o[D].sb;if(("ANY"==n||v.id==n)&&v.J in r&&1!==r[v.J]){s=!0;B=r[v.J];break}}q(s,B)}break;case C.rs:console.log("Physics message ping: ",performance.now()-b[1]);break;default:G.error("Wrong message: "+
a)}}function e(a){return aa[a]||null}function d(){X.body++;return X.body}function l(a){return{J:a,dm:0,Ej:!1,De:!0,lC:!1,is_character:!1,jx:!1,fj:null,id:"",hB:{},Kc:[],ej:null,ve:[],gl:0,hl:new Float32Array([0,0,0,1,0,0,0,1]),dq:new Float32Array(3),Ln:new Float32Array(3),aj:new Float32Array(3),$i:new Float32Array(4)}}function g(a,b){switch(a){case "BOX":var c=b.Lb;break;case "CYLINDER":c=b.Mk;break;case "CONE":c=b.Lk;break;case "SPHERE":c=b.yc;break;case "CAPSULE":c=b.Kk}return c}function f(a){if(!a)return null;
var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.A&&(b.center=a.A);"number"===typeof a.ua&&(b.radius=a.ua);"number"===typeof a.height&&(b.height=a.height);return b}function r(a,b,c,d){var e=a.d.g,f=b.d.L,g=new Float32Array(16);T.invert(f,g);f=new Float32Array(3);
J.transformMat4(e,g,f);switch(b.i.type){case 10:b=b.b4w_vehicle_settings;a=a.d.Lb;C.q(C.xs,c,f,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:C.q(C.ws,c,f,a.RC)}}function h(a){return a.l&&a.l.fj?!0:!1}function n(a,b,c,d,e,f,g,h,k,m){var l;X.Eo++;l=X.Eo.toString(16);C.q(C.Es,l,a,h,b.l.J,c,d,e.l.J,f,g,k,m);b.l.fj=l}function m(a){var b=a.l;if(b&&(0===b.dm||!0===b.Ej||!1===b.De||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.g[0]!=a.l.aj[0]||a.d.g[1]!=a.l.aj[1]||a.d.g[2]!=
a.l.aj[2]||a.d.quat[0]!=a.l.$i[0]||a.d.quat[1]!=a.l.$i[1]||a.d.quat[2]!=a.l.$i[2])){a.l.aj.set(a.d.g);a.l.$i.set(a.d.quat);var b=a.l,c=C.vp(C.dg);c.msg_id=C.dg;c.body_id=a.l.J;c.trans=a.d.g;"DYNAMIC"===b.type?(c.quat=w,D.identity(w)):c.quat=a.d.quat;C.q(C.dg,c)}a=a.Wd;for(b=0;b<a.length;b++)m(a[b])}function s(a,b,c,d,e){e=e||new Float32Array(3);a=a.d.quat;e[0]=b;e[1]=c;e[2]=d;J.transformQuat(e,a,e)}function B(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.l.o.length;e++){var f=
b.l.o[e];if("ANY"==a||f.sb.id==a)f=f.sb.J,c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function z(a,b){C.q(C.Gc,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=H.On(e.O)+H.On(e.ea)+String(e.local);c[f]=c[f]||{O:e.O,ea:e.ea,local:e.local,bo:[]};var g=c[f].bo,h;for(h in e.Ld)-1==g.indexOf(h)&&g.push(h)}for(f in c)d=c[f].O,e=c[f].ea,h=c[f].local,g=c[f].bo,C.q(C.yn,a,d,e,h,g)}else C.q(C.yn,a,null,null,!1,null)}function u(a,b){if(b.Yg){var c=a.l.J,d=b.qg*b.jp,e=b.xh*b.eo,f=-b.Xg*b.Qm*2*Math.PI/
b.yr;b.Tp&&(f*=-1);switch(b.type){case 10:C.q(C.Gc,c);C.q(C.kt,c,d,e,f);break;case 20:C.q(C.Gc,c),C.q(C.jt,c,d,e,f)}}}function q(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function F(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function k(a){return a.b4w_character?!0:!1}function x(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}p("__camera");var v=p("__config");p("__constraints");var G=p("__print"),A=p("__debug"),C=p("__ipc");
p("__renderer");var M=p("__scenes"),y=p("__transform"),I=p("__tsr"),H=p("__util"),Y=p("__version"),J=p("vec3"),D=p("quat"),T=p("mat4"),K=v.sb,R=v.p,N=null,ca=null,O=[],aa=[],X={es:0,body:0,Eo:0,shape:0},ba=new Float32Array(3),w=new Float32Array(4),ga=new Float32Array(4),ka=new Float32Array(16),L=new Float32Array(8),S=new Float32Array(8);a.dx=function(a){if(K.enabled){var c=K.ih+Y.timestamp();G.log("%cLOAD PHYSICS","color: #0a0",c,"Max FPS: "+K.qe);N=new Worker(c);C.init(N,b);C.q(C.Us,a,K.qe)}};a.Rn=
function(a){var b;X.es++;b=X.es;C.q(C.Js,b);a.l={};a.l.qA=b;a.l.o=[]};a.cleanup=function(){if(K.enabled){C.q(C.Ps);ca=null;O.length=0;aa.length=0;for(var a in X)X[a]=0}};a.append_object=function(a,b){ca=b;C.q(C.Zs,b.l.qA);var e=a.d;if(!e)throw"No object render: "+a.name;if(a.parent&&e.sk)return null;var m=[];e.sk&&c(a,m);if(q(a)||F(a)||k(a)||x(a)||a.b4w_collision){var s,t=a,V=e.Lq,B=t.d,v=t.game,z=d();if("CAMERA"==t.type)var L=v.use_collision_bounds?v.collision_bounds_type:"BOX",p=g(L,B),S=B.Mh,w=
B.Hh,S=.5,w=0;else"EMPTY"==t.type?(L="EMPTY",p=null,w=S=0):(L=v.use_collision_bounds?v.collision_bounds_type:"BOX",p=g(L,B),S=B.Mh,w=B.Hh);var A=B.g,y=B.quat,K=v.use_ghost,N=v.use_sleep,I=v.mass,R=v.velocity_min,Y=v.velocity_max,X=v.damping,ba=v.rotation_damping,pa=v.collision_group,tc=v.collision_mask,la=B.yc.ua,Va=f(p),ua=t.b4w_correct_bounding_offset,xa;var Ea=L;if(m.length){var sa=[],Ha={};Ha.quat=new Float32Array([0,0,0,1]);Ha.trans=new Float32Array(3);Ha.worker_bounding=Va;Ha.bounding_type=
Ea;sa.push(Ha);T.invert(B.L,ka);D.invert(B.quat,ga);for(var Pa=0;Pa<m.length;Pa++){var pb={},Lb=m[Pa],nb=Lb.game.collision_bounds_type,Yb=new Float32Array(4),ob=new Float32Array(3);J.transformMat4(Lb.d.g,ka,ob);D.multiply(ga,Lb.d.quat,Yb);pb.trans=ob;pb.quat=Yb;pb.bounding_type=nb;pb.worker_bounding=f(g(nb,Lb.d));sa.push(pb)}xa=sa}else xa=[];C.q(C.As,z,A,y,V,K,N,I,R,Y,X,ba,pa,tc,L,Va,la,S,w,xa,ua);O.push(t);aa[z]=t;var uc=l(z);uc.type=V;uc.dm=I;uc.Ej=K;s=uc;a.l=s;var hc={n:null,sb:s};b.l.o.push(hc)}else for(var kb=
a.W||[],Aa=0;Aa<kb.length;Aa++){var fb=kb[Aa],zb;if(zb="PHYSICS"==fb.type){var ic;a:{for(var Ab=b.l.o,$a=0;$a<Ab.length;$a++){var eb=Ab[$a].n;if(eb&&eb.id==fb.id){ic=!0;break a}}ic=!1}zb=!ic}if(zb)if(fb.hc.I)if(fb.Me&&b.d.Ma){var Ja=fb,Zb=ca,Xa=M.ma(Zb,"MAIN_OPAQUE");C.q(C.Is,Xa.Ne);if(Xa.Ma&&Ja.lA){var Ia={};Ia.dst_noise_scale0=Ja.dst_noise_scale0;Ia.dst_noise_scale1=Ja.dst_noise_scale1;Ia.dst_noise_freq0=Ja.dst_noise_freq0;Ia.dst_noise_freq1=Ja.dst_noise_freq1;Ia.dir_min_shore_fac=Ja.dir_min_shore_fac;
Ia.dir_freq=Ja.dir_freq;Ia.dir_noise_scale=Ja.dir_noise_scale;Ia.dir_noise_freq=Ja.dir_noise_freq;Ia.dir_min_noise_fac=Ja.dir_min_noise_fac;Ia.dst_min_fac=Ja.dst_min_fac;Ia.waves_hor_fac=Ja.waves_hor_fac;var Bb=Xa.Oe,Sb=Xa.cg;Xa.uk?C.q(C.xn,Ia,Xa.Ce[0],Xa.Ce[1],Xa.Be[0],Xa.Be[1],Xa.Eg,Bb,Sb,Xa.Qg,Zb.d.Gm):C.q(C.xn,Ia,0,0,0,0,0,Bb,Sb,0,null)}}else{var qb;if(fb.bA){var Wa=a,ab=fb,Ca=d(),rb=ab.hc;C.q(C.Gs,Ca,rb.u[0].a_position,rb.ca||null,Wa.d.g,ab.yo,ab.zo);var Mb=l(Ca);Mb.Ej=!0;qb=Mb}else{var va=a,
tb=fb,ea=d(),Nb=tb.hc;C.q(C.Hs,ea,Nb.u[0].a_position,Nb.ca||null,va.d.g,tb.Mh,tb.Hh,tb.yo,tb.zo);qb=l(ea)}s=qb;s.id=fb.Zb;hc={n:fb,sb:s};b.l.o.push(hc)}else G.error("Object "+a.name+" has collision material with no assigned vertices")}if(q(a)||F(a)){var Ba=a,Da=Ba.l.J;q(Ba)?(Ba.i.type=10,C.q(C.Bs,Da,Ba.i.wz,Ba.i.yz,Ba.i.xz,Ba.i.oA,Ba.i.Ax)):F(Ba)&&(Ba.i.type=20,C.q(C.zs,Da,Ba.i.tl,Ba.i.ln,Ba.i.mn));if(Ba.i.Pf){var Fa=Ba.i.Pf;switch(Ba.i.type){case 10:r(Fa[1],Ba,Da,!0);r(Fa[0],Ba,Da,!0);r(Fa[3],Ba,
Da,!1);r(Fa[2],Ba,Da,!1);break;case 20:for(var xb=0;xb<Fa.length;xb++)r(Fa[xb],Ba,Da,!1)}}Ba.l.id=Ba.b4w_vehicle_settings.name;u(a,a.i)}else if(k(a)){var yb=a.d,Qa=a.l,Ob=yb.Lb.max_y-yb.Lb.min_y,lb=Qa.J,Pb=a.b4w_character_settings,bc=Pb.walk_speed,vc=Pb.run_speed,Tb=Pb.step_height,Gb=Pb.jump_strength,jc=Pb.waterline,kc=H.xv(a);C.q(C.Cs,lb,kc,Ob,bc,vc,Tb,Gb,jc);Qa.is_character=!0}else if(x(a)){var Ya=a,lc=Ya.l.J;C.q(C.Fs,lc,Ya.xc.tl,Ya.xc.ln,Ya.xc.mn);if(Ya.xc.Xi)for(var Ub=Ya.xc.Xi,gb=0;gb<Ub.length;gb++){var cc=
Ub[gb],ub=cc.d.g,E=Ya.d.L,hb=new Float32Array(16);T.invert(E,hb);var bb=new Float32Array(3);J.transformMat4(ub,hb,bb);C.q(C.ys,lc,bb,cc.iu)}Ya.l.jx=!0}else a.b4w_collision&&(s.id=a.b4w_collision_id);for(Aa=0;Aa<O.length;Aa++)if(a=O[Aa],a.l){var cb=a;if(!h(cb))for(var na=0;na<cb.constraints.length;na++){var Z=cb.constraints[na],Ka=Z.target,Ua=Z.pivot_type;if("RIGID_BODY_JOINT"==Z.type&&Ka.l){var La=new Float32Array([Z.pivot_x,Z.pivot_y,Z.pivot_z]),Hb,Ib=new Float32Array([Z.axis_x,Z.axis_y,Z.axis_z]);
Hb=H.euler_to_quat(Ib,new Float32Array(4));var Jb=T.fromRotationTranslation(Hb,La,new Float32Array(16)),dc=T.multiply(cb.d.L,Jb,new Float32Array(16)),Kb=T.invert(Ka.d.L,new Float32Array(16)),Vb=T.multiply(Kb,dc,Kb),mc=H.Ef(Vb),Ec=H.matrix_to_quat(Vb),Ra=Z,Ma={};Ma.use_limit_x=Ra.use_limit_x;Ma.use_limit_y=Ra.use_limit_y;Ma.use_limit_z=Ra.use_limit_z;Ma.use_angular_limit_x=Ra.use_angular_limit_x;Ma.use_angular_limit_y=Ra.use_angular_limit_y;Ma.use_angular_limit_z=Ra.use_angular_limit_z;Ma.limit_max_x=
Ra.limit_max_x;Ma.limit_min_x=Ra.limit_min_x;Ma.limit_max_y=Ra.limit_max_y;Ma.limit_min_y=Ra.limit_min_y;Ma.limit_max_z=Ra.limit_max_z;Ma.limit_min_z=Ra.limit_min_z;Ma.limit_angle_max_x=Ra.limit_angle_max_x;Ma.limit_angle_min_x=Ra.limit_angle_min_x;Ma.limit_angle_max_y=Ra.limit_angle_max_y;Ma.limit_angle_min_y=Ra.limit_angle_min_y;Ma.limit_angle_max_z=Ra.limit_angle_max_z;Ma.limit_angle_min_z=Ra.limit_angle_min_z;n(Ua,cb,La,Hb,Ka,mc,Ec,Ma,null,null)}}}};a.Pv=e;a.update=function(){for(var a=0;a<O.length;a++){var b=
O[a],c=b.l;if(c.De&&c.gl){var d=performance.now()/1E3-c.gl,d=Math.min(d,10/60);R.Hx&&(d=0);var e=L;I.ex(c.hl,d,c.dq,c.Ln,L);y.set_translation(b,I.Ap(e));y.set_rotation(b,I.wp(e));y.v(b);m(b);if(b.i)for(var c=b,d=c.i.Pf,e=c.d.Sd,f=L,g=0;g<d.length;g++){var h=d[g];I.multiply(e,c.i.ki[g],f);y.hr(h,f);y.v(h)}b.i&&b.i.Yg&&(c=b.i,d=c.Yg)&&(e=b.i.zr,h=ka,f=b.d.g,g=b.d.quat,H.Zm(b.i.Ar,g,f,h),H.Ef(h,d.d.g),H.matrix_to_quat(h,d.d.quat),h=w,H.$m(e,g,f,h),e=ga,D.setAxisAngle(h,-c.Xg*c.Qm*2*Math.PI,e),D.multiply(e,
d.d.quat,d.d.quat),y.v(d));b.i&&b.i.Nm&&(c=b.i,d=c.Nm)&&(f=b.i.ur,e=ka,g=b.d.g,h=b.d.quat,H.Zm(b.i.vr,h,g,e),H.Ef(e,d.d.g),H.matrix_to_quat(e,d.d.quat),e=w,H.$m(f,h,g,e),f=ga,g=Math.abs(c.speed)*c.tr,g>c.fm&&(g=c.fm),D.setAxisAngle(e,-g,f),D.multiply(f,d.d.quat,d.d.quat),y.v(d));b.i&&b.i.Tm&&(c=b.i,d=c.Tm)&&(e=b.i.Hr,h=ka,f=b.d.g,g=b.d.quat,H.Zm(b.i.Ir,g,f,h),H.Ef(h,d.d.g),H.matrix_to_quat(h,d.d.quat),b=w,H.$m(e,g,f,b),e=ga,D.setAxisAngle(b,-Math.abs(c.qg)*c.Ro,e),D.multiply(e,d.d.quat,d.d.quat),
y.v(d))}}if(a=ca)a=M.ma(a,"MAIN_OPAQUE"),a.Ma&&0<a.Ma.waves_height&&(b=J.length(a.Ei),C.q(C.it,a.time*b))};a.lw=function(){return ca};a.pause=function(){K.enabled&&C.q(C.Vs)};a.resume=function(){K.enabled&&C.q(C.Ys)};a.enable_simulation=function(a){a=a.l;if(!a)throw"No object physics";if(!a.De){var b=a.J;a.De=!0;C.q(C.Ts,b)}};a.disable_simulation=function(a){a=a.l;if(!a)throw"No object physics";if(a.De){var b=a.J;a.De=!1;C.q(C.Ss,b)}};a.has_physics=function(a){return a.l?!0:!1};a.has_dynamic_physics=
function(a){return(a=a.l)&&a.De&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.dm&&0==a.Ej?!0:!1};a.has_simulated_physics=function(a){return(a=a.l)&&a.De?!0:!1};a.set_gravity=function(a,b){C.q(C.ht,a.l.J,b)};a.Yw=h;a.apply_constraint=n;a.clear_constraint=function(a){a=a.l;C.q(C.Xs,a.fj);a.fj=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,g){c=I.lg(c,1,d,L);f=I.lg(f,1,g,S);I.invert(c,c);I.multiply(f,c,c);y.Nw(e,f);I.multiply(f,c,c);y.hr(b,c);y.v(b);a.set_transform(b,b.d.g,b.d.quat)};a.set_transform=
function(a,b,c){I.ti(a.d.g,1,a.d.quat,a.l.hl);var d=C.vp(C.dg);d.msg_id=C.dg;d.body_id=a.l.J;d.trans=b;d.quat=c;C.q(C.Gc,a.l.J);C.q(C.dg,d)};a.sync_transform=m;a.apply_velocity=function(a,b,c,d){s(a,b,c,d,ba);a=a.l.J;C.q(C.Gc,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(ba[0]),f=Math.abs(ba[1]),g=Math.abs(ba[2]);ba[0]=e?ba[0]/e*Math.max(e,b):0;ba[1]=f?ba[1]/f*Math.max(f,c):0;ba[2]=g?ba[2]/g*Math.max(g,d):0;C.q(C.zn,a,ba[0],ba[1],ba[2])};a.apply_velocity_world=function(a,b,c,d){a=a.l.J;
C.q(C.Gc,a);C.q(C.zn,a,b,c,d)};a.apply_force=function(a,b,c,d){s(a,b,c,d,ba);a=a.l.J;C.q(C.Gc,a);C.q(C.Ks,a,ba[0],ba[1],ba[2])};a.apply_torque=function(a,b,c,d){s(a,b,c,d,ba);a=a.l.J;C.q(C.Gc,a);C.q(C.Ms,a,ba[0],ba[1],ba[2])};a.set_character_move_dir=function(a,b,c){a=a.l.J;C.q(C.Gc,a);C.q(C.bt,a,b,c)};a.set_character_move_type=function(a,b){C.q(C.ct,a.l.J,b)};a.set_character_walk_velocity=function(a,b){C.q(C.gt,a.l.J,b)};a.set_character_run_velocity=function(a,b){C.q(C.et,a.l.J,b)};a.set_character_fly_velocity=
function(a,b){C.q(C.$s,a.l.J,b)};a.character_jump=function(a){C.q(C.Ns,a.l.J)};a.character_rotation_inc=function(a,b,c){C.q(C.Os,a.l.J,b,c)};a.set_character_rotation=function(a,b,c){C.q(C.dt,a.l.J,b,c)};a.set_character_rotation_h=function(a,b){C.q(C.at,a.l.J,b)};a.set_character_rotation_v=function(a,b){C.q(C.ft,a.l.J,b)};a.dB=function(){return!1};a.cB=function(){return!1};a.check_collision=function(){G.error("check_collision() deprecated");return!1};a.bB=function(){G.error("check_collision_any() deprecated");
return!1};a.check_ray_hit=function(){G.error("check_ray_hit() deprecated");return!1};a.XC=function(){G.error("update_object_coords() deprecated")};a.append_collision_test=function(a,b,c,d){var e=a.l,f=e.J;b=b||"ANY";for(var g=0;g<e.Kc.length;g++){var h=e.Kc[g];if(h.Zb==b&&h.callback==c)return}g=[];a=a.l.J;h=[];B(b,ca,h,null);for(var k=0;k<h.length;k++){var m=h[k];a<m?g.push([a,m]):a>m&&g.push([m,a])}h={Zb:b,callback:c,Vj:g,Jq:new Uint8Array(g.length),jm:d||!1};e.Kc.push(h);C.q(C.Gc,f);C.q(C.Ds,g,
d)};a.remove_collision_test=function(a,b,c){a=a.l;b=b||"ANY";for(var d=0;d<a.Kc.length;d++){var e=a.Kc[d];if(e.Zb==b&&e.callback==c){a.Kc.splice(d,1);d--;for(var e=e.Vj,f=ca.l.o,g=0;g<f.length;g++)for(var h=f[g].sb,k=0;k<h.Kc.length;k++)for(var m=h.Kc[k],l=0;l<m.Vj.length;l++)for(var n=m.Vj[l],r=0;r<e.length;r++){var s=e[r];n[0]===s[0]&&n[1]===s[1]&&(e.splice(r,1),r--)}e.length&&C.q(C.Ws,e)}}};a.apply_collision_impulse_test=function(a,b){var c=a.l;c?(C.q(C.Ls,c.J),c.ej=b):G.error("Object "+a.name+
" has no physics")};a.clear_collision_impulse_test=function(a){var b=a.l;b?(C.q(C.Qs,b.J),b.ej=null):G.error("Object "+a.name+" has no physics")};a.append_ray_test=function(a,b,c,d,e,f){var g=a.l;if(g){a=g.J;b=b||"ANY";c={O:new Float32Array(c),ea:new Float32Array(d),local:e,callback:f,Zb:b,Ld:{}};B(b,ca,null,c.Ld);delete c.Ld[a];for(var h in c.Ld)c.Ld[h]=1;g.ve.push(c);z(a,g.ve)}else G.error("Object "+a.name+" has no physics")};a.remove_ray_test=function(a,b,c,d,e){if(b=a.l){a=b.J;for(var f=0;f<b.ve.length;f++){var g=
b.ve[f];H.dj(g.O,c)&&H.dj(g.ea,d)&&g.local==e&&(b.ve.splice(f,1),f--)}z(a,b.ve)}else G.error("Object "+a.name+" has no physics")};a.vehicle_throttle=function(a,b){var c=a.i;c.qg=b;u(a,c)};a.vehicle_steer=function(a,b){var c=a.i;c.Xg=b;u(a,c)};a.vehicle_brake=function(a,b){var c=a.i;c.xh=b;u(a,c)};a.is_vehicle_chassis=q;a.is_vehicle_hull=F;a.hx=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==
a?!0:!1};a.gx=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.kx=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.Xp=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.Wp=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.Yp=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.i.speed};a.pA=
function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=k;a.kC=x;a.QB=function(){return 0};a.pv=function(){C.q(C.Rs)};a.gy=function(a){var b=O.indexOf(a);-1!=b?(O.splice(b,1),a=aa.indexOf(a),-1!=a&&aa.splice(a,1)):G.error("Object ",a.name," doesn't have bounding physics")};a.reset=function(){N.terminate()}};b4w.module.__data=function(a,p){function c(a,b){for(var c=X(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}la[b.id]=null;Va[b.id]=null}function b(a,b,c){var d;a instanceof ArrayBuffer&&(a=ja.Bp(a));d=a.width;a=a.height;ra.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(ua)&&c&&ra.warn("B4W Warning: image",b,"is not from app root.")}function e(a,b,c,d,e,f){d=b.r;if(!d)throw"Nothing requested";U.enqueue([[d,U.AT_JSON,
d]],function(d,f,g,t){if(d){ra.log("%cLOAD METADATA","color: #616",t);f=d.b4w_format_version;if(Number(f)<Oa.kq)throw"Incompatible file version: "+f+". Required: "+Oa.kq;for(var h in d)a[h]=d[h];(d=a.binaries[0].binfile)?b.Yn=d:(P.or(b,"load_binaries"),P.or(b,"prepare_bindata"));if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)ra.error("EXPORT ERROR:",a.b4w_export_errors[d]);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)ra.warn("EXPORT WARNING:",a.b4w_export_warnings[d]);
e(b,c)}else b.gq(b.id,!1)},null,function(a){f(b,c,a)})}function d(a,b,c,d,e,f){d=ca(b.r)+b.Yn;if(!d)throw"Binary data is missing";U.enqueue([[d,U.AT_ARRAYBUFFER,d]],function(d,f,g,t){d&&(ra.log("%cLOAD BINARY","color: #616",t),a.bin_data=d,e(b,c))},null,function(a){f(b,c,a)})}function l(a,b,c,d,e){d=a.bin_data;var f=a.binaries[0],t=a.objects,h=a.meshes;a=a.actions;for(var k=wa.tu(),m=["indices"],l=["normal","tangent"],n=["color","group"],V=["position","texcoord","texcoord2"],r=0;r<h.length;r++)for(var s=
h[r].submeshes,q=0;q<s.length;q++)for(var P in s[q]){var B=s[q][P][1];if(-1!=m.indexOf(P)){var U=4*s[q][P][0]+f["int"],v=s[q],D=P,z=d;if(k)var u=new Uint32Array(z,U,B);else for(var u=new Uint32Array(B),z=new DataView(z),L=0;L<B;L++)u[L]=z.getUint32(U+4*L,!0);v[D]=u}else if(-1!=V.indexOf(P))U=4*s[q][P][0]+f["float"],s[q][P]=g(d,U,B,k);else if(-1!=l.indexOf(P)){U=2*s[q][P][0]+f["short"];v=s[q];D=P;z=d;u=new Float32Array(B);z=new DataView(z);for(L=0;L<B;L++)u[L]=z.getInt16(U+2*L,!0)/32767;v[D]=u}else if(-1!=
n.indexOf(P)){U=2*s[q][P][0]+f.ushort;v=s[q];D=P;z=d;u=new Float32Array(B);z=new DataView(z);for(L=0;L<B;L++)u[L]=z.getUint16(U+2*L,!0)/65535;v[D]=u}}for(P=0;P<t.length;P++)for(h=t[P].particle_systems,m=0;m<h.length;m++)l=h[m],l.transforms=g(d,4*l.transforms[0]+f["float"],l.transforms[1],k);for(t=0;t<a.length;t++){P=a[t];var h=P.fcurves,l=P.frame_range,m=l[0],l=l[1],n=ka.qw(m,l),V=null,s=r=!1,p;for(p in h)r|=-1<p.indexOf("rotation_euler"),s|=-1<p.indexOf("rotation_quaternion");for(p in h)if(r&&s&&
-1<p.indexOf("rotation_euler"))delete h[p];else{var q=h[p],x;for(x in q)B=q[x],U=g(d,f["float"]+4*B.bin_data_pos[0],B.bin_data_pos[1],k),v=new Float32Array(n),null===V&&(V=new Int8Array(n)),ka.Vt(B,U,v,V,m,l),B.Yb=v;-1<p.indexOf("rotation_euler")&&ka.Ov(h,p)}P.rt=V}e(b,c)}function g(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function f(a,b,c,d,e){var f=a.cameras,g=a.groups,t=a.materials,h=a.meshes,m=
a.node_groups,k=a.objects,l=a.particles,n=a.scenes,r=a.speakers,q=a.textures,P=a.worlds;m||(ra.warn('B4W Warning: "node_groups" datablock undefined. reexport main scene.'),m=a.node_groups=[]);for(var U="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),v={},D=0;D<U.length;D++)for(var z=a[U[D]],u=0;u<z.length;u++){var L=z[u];v[L.uuid]=L}for(var p=0;p<n.length;p++){for(var x=n[p],S=x.objects,w=0;w<S.length;w++)B(S,
w,v);x.camera&&B(x,"camera",v);x.world&&B(x,"world",v)}for(p=0;p<g.length;p++)for(var A=g[p].objects,w=0;w<A.length;w++)B(A,w,v);for(p=0;p<k.length;p++){var W=k[p];W.dupli_group&&B(W,"dupli_group",v);W.parent&&B(W,"parent",v);if(W.animation_data){var y=W.animation_data;y.action&&B(y,"action",v);if(y.nla_tracks)for(w=0;w<y.nla_tracks.length;w++)for(var T=y.nla_tracks[w],G=0;G<T.strips.length;G++)T.strips[G].action&&B(T.strips[G],"action",v)}switch(W.type){case "MESH":if(!W.data)throw"mesh not found for object "+
W.name;B(W,"data",v);for(var F=W.modifiers,w=0;w<F.length;w++){var Q=F[w];"ARMATURE"==Q.type?B(Q,"object",v):"CURVE"==Q.type&&B(Q,"object",v)}var K=W.particle_systems;if(K)for(w=0;w<K.length;w++)B(K[w],"settings",v);break;case "ARMATURE":B(W,"data",v);for(var da=W.pose.bones,N=W.data.bones,w=0;w<da.length;w++){var J=da[w];J.bone=N[J.bone];for(var H=J.parent_recursive,G=0;G<H.length;G++)H[G]=da[H[G]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":B(W,"data",v)}var I=W.constraints;if(I)for(w=
0;w<I.length;w++){var ya=I[w];ya.target&&B(ya,"target",v)}var R=W.lod_levels;if(R)for(w=0;w<R.length;w++){var O=R[w];O.object&&B(O,"object",v)}}for(p=0;p<h.length;p++)for(var ja=h[p].materials,w=0;w<ja.length;w++)B(ja,w,v);for(p=0;p<t.length;p++){for(var fa=t[p],qa=fa.texture_slots,w=0;w<qa.length;w++)B(qa[w],"texture",v);var ca=fa.node_tree;ca&&s(ca,v)}for(p=0;p<m.length;p++)(ca=m[p].node_tree)&&s(ca,v);for(p=0;p<q.length;p++){var aa=q[p],E=aa.type;"IMAGE"!=E&&"ENVIRONMENT_MAP"!=E||B(aa,"image",
v)}for(p=0;p<f.length;p++){var ta=f[p];ta.dof_object&&B(ta,"dof_object",v)}for(p=0;p<r.length;p++){var Y=r[p];Y.sound&&B(Y,"sound",v);if(Y.animation_data&&(y=Y.animation_data,y.action&&B(y,"action",v),y.nla_tracks))for(w=0;w<y.nla_tracks.length;w++)for(T=y.nla_tracks[w],G=0;G<T.strips.length;G++)T.strips[G].action&&B(T.strips[G],"action",v)}for(p=0;p<l.length;p++){for(var Va=l[p],qa=Va.texture_slots,w=0;w<qa.length;w++)B(qa[w],"texture",v);Va.dupli_group&&B(Va,"dupli_group",v);Va.dupli_object&&B(Va,
"dupli_object",v)}for(p=0;p<P.length;p++)if(qa=P[p].texture_slots)for(w=0;w<qa.length;w++)B(qa[w],"texture",v);ma.su(a);xa=0===b.id;Ea||(Ea=a.scenes[0]);for(var la=a.textures,tc=xa?a.scenes[0].b4w_anisotropic_filtering:Ea.b4w_anisotropic_filtering,ua=0;ua<la.length;ua++)xa||"SCENE"!=la[ua].b4w_source_type||(la[ua].b4w_source_id=""),Ga.gv(la[ua],tc,a.scenes);for(var Ua={},La=a.objects,Hb=0;Hb<La.length;Hb++){var Ib=La[Hb];if("MESH"===Ib.type&&!Ib.particle_systems.length)for(var Jb=Ib.data,ga=Jb.name,
Kb=Jb.submeshes,Vb=Jb.materials,za=0;za<Kb.length;za++)0!==Kb[za].base_length||Ua[ga]||(Vb[za]&&ra.warn('B4W Warning: material "'+Vb[za].name+'" is not assigned to any face (object "'+Ib.name+'").'),Ua[ga]=!0)}for(var sa=a.meshes,Ta=0;Ta<sa.length;Ta++){var Ha=sa[Ta];Ha.materials.length||Ha.uv_textures.length&&ra.warn('B4W Warning: mesh "'+Ha.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,
alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,
b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});for(var Pa=a.meshes,pb=wa.keysearch("name","DEFAULT",a.materials),
nb=0;nb<Pa.length;nb++){var ob=Pa[nb];0==ob.materials.length&&ob.materials.push(pb)}for(var Yb=a.actions,Wb=b.id,ec=0;ec<Yb.length;ec++){var $b=Yb[ec];$b.tt=Wb;ka.Dt($b)}for(var mb=a.scenes,Db=0;Db<mb.length;Db++){for(var xc=mb[Db],yc=ia.$k(xc,"ALL"),nc=[],ac=0;ac<yc.length;ac++)for(var oc=yc[ac].particle_systems,Qb=0;Qb<oc.length;Qb++){var sb=oc[Qb].settings;if("HAIR"==sb.type)if("OBJECT"==sb.render_type)V.cn(sb.dupli_object,!0);else if("GROUP"==sb.render_type){for(var Eb=sb.dupli_group,fc=ia.$k(xc,
"EMPTY"),vb=0;vb<fc.length;vb++)fc[vb].dupli_group==Eb&&nc.push(fc[vb]);for(vb=0;vb<Eb.objects.length;vb++)V.cn(Eb.objects[vb],!0)}else ra.warn("B4W Warning: render type",sb.render_type,"not supported for particle systems ("+sb.name+").")}for(ac=0;ac<nc.length;ac++)M(nc[ac],[xc])}ba(a,b.id);for(var Kc=a.scenes,zc=0;zc<Kc.length;zc++){for(var md=Kc[zc],Lc=[],Ac=[],Gc=Kc[zc].objects,Fb=0;Fb<Gc.length;Fb++){var Zc=Gc[Fb];C(Gc,Zc,Lc,Ac);var Hc=Zc.dupli_group;if(Hc)for(var Mc=Hc.objects,Bc=0;Bc<Mc.length;Bc++)C(Mc,
Mc[Bc],Lc,Ac)}for(Fb=0;Fb<Ac.length;Fb++)M(Ac[Fb],[md]);for(Fb=0;Fb<Lc.length;Fb++)wa.Rt(Lc[Fb][0],Lc[Fb][1])}ba(a,b.id);var ib=X(a,b.id);ma.Zt(ib,a.scenes);for(ua=0;ua<ib.length;ua++){var gc=ib[ua];!xa&&gc.parent&&-1<Lb.indexOf(gc.parent.type)&&(gc.parent="");V.cn(gc,!1);gc.d.ud=b.id}for(var Nc=0;Nc<ib.length;Nc++){var Ic=ib[Nc];if("MESH"==Ic.type){var Oc=ka.get_first_armature_object(Ic);if(Oc){var Pc=Oc.d;if(Pc.Zd){var Qc=Ic.d.oc,Rc=[],$c;for($c in Qc){var Sc=Qc[$c];Rc.push(4*Sc.Eh,4*Sc.co)}Pc.jq.push(Rc)}Pc.hk.push(Ic.d)}}}for(var fd=
-1,pc=0;pc<ib.length;pc++){var Rb=ib[pc],qc=Rb.d;if(wa.is_mesh(Rb)&&qc.Wh){var rc=qc.max_bones;rc>fd&&(fd=rc)}}for(pc=0;pc<ib.length;pc++)if(Rb=ib[pc],qc=Rb.d,wa.is_mesh(Rb)&&qc.Wh){qc.max_bones=fd;var ad=Rb,Cc=qc.max_bones,bd=Oa.max_bones,Tc=ad.d;Cc>2*bd?wa.ga('B4W Error: too many bones for "'+ad.name+'"'):Cc>bd?(ra.warn('B4W Warning: too many bones for "'+ad.name+'" / '+Cc+" bones (max "+bd+"). Blending between frames will be disabled."),Tc.Lh=!1):Tc.Lh=!0;Tc.Lh=Tc.Lh&&!pa.kp}for(var cd=0;cd<ib.length;cd++){var Xb=
ib[cd];if(wa.is_mesh(Xb)){var pd=Xb.lod_levels.length;if(pd)for(var ed=Xb,Dc=0;Dc<pd;Dc++){var Jc=Xb.lod_levels[Dc].object;if(!Jc){ed.d.Jj=!0;ed.d.pe=Xb.lod_levels[Dc].distance;break}Jc.d.Df=Xb.d.Df;ed.d.pe=Xb.lod_levels[Dc].distance;Jc.d.$h=Xb.lod_levels[Dc].distance;if(Xb.lod_levels[Dc+1])Jc.d.pe=Xb.lod_levels[Dc+1].distance;else{Jc.d.Jj=!0;Jc.d.pe=1E4;break}ed.d.Jj=!1;ed=Jc}}}for(var ld=0;ld<ib.length;ld++){var ha=ib[ld];if(ha.b4w_vehicle){var db=ha.b4w_vehicle_settings;if("CHASSIS"==db.part){ha.i=
{};ha.i.jp=db.force_max;ha.i.eo=db.brake_max;ha.i.wz=db.suspension_compression;ha.i.yz=db.suspension_stiffness;ha.i.xz=db.suspension_damping;ha.i.oA=db.wheel_friction;ha.i.FC=db.roll_influence;ha.i.Ax=db.max_suspension_travel_cm;ha.i.qg=0;ha.i.xh=1;ha.i.Xg=0;ha.i.speed=0;ha.i.Pf=[];ha.i.ki=[];ha.i.Yg=null;for(var qd=ha.Kb?ha.Kb.dupli_group.objects:ib,Uc=0;Uc<qd.length;Uc++){var Na=qd[Uc];if(Na.b4w_vehicle){var jb=Na.b4w_vehicle_settings;if(oa.hx(Na)&&db.name==jb.name){var rd=oa.pA(Na.b4w_vehicle_settings.part);
ha.i.Pf[rd]=Na;ha.i.ki[rd]=new Float32Array(8)}else if(oa.Xp(Na)&&db.name==jb.name){ha.i.Yg=Na;ha.i.Qm=jb.steering_max;ha.i.yr=jb.steering_ratio;ha.i.Tp=jb.inverse_control;var wb=Sa.invert(ha.d.L,new Float32Array(16)),gd=Sa.multiply(wb,Na.d.L,wb);ha.i.Ar=gd;var Vc=new Float32Array([1,0,0,0]);Za.transformMat4(Vc,gd,Vc);ha.i.zr=Vc}else if(oa.Wp(Na)&&db.name==jb.name){ha.i.Nm=Na;ha.i.tr=jb.speed_ratio;ha.i.fm=jb.max_speed_angle;var wb=Sa.invert(ha.d.L,new Float32Array(16)),hd=Sa.multiply(wb,Na.d.L,wb);
ha.i.vr=hd;var Wc=new Float32Array([1,0,0,0]);Za.transformMat4(Wc,hd,Wc);ha.i.ur=Wc}else if(oa.Yp(Na)&&db.name==jb.name){ha.i.Tm=Na;ha.i.Ro=jb.delta_tach_angle;var wb=Sa.invert(ha.d.L,new Float32Array(16)),id=Sa.multiply(wb,Na.d.L,wb);ha.i.Ir=id;var Xc=new Float32Array([1,0,0,0]);Za.transformMat4(Xc,id,Xc);ha.i.Hr=Xc}}}if(4!=ha.i.Pf.length)throw"Not enough wheels for chassis "+ha.name;}else if("HULL"==db.part){ha.i={};ha.i.Pf=[];ha.i.ki=[];ha.i.jp=db.force_max;ha.i.eo=db.brake_max;ha.i.tl=db.floating_factor;
ha.i.ln=db.water_lin_damp;ha.i.mn=db.water_rot_damp;ha.i.qg=0;ha.i.xh=1;ha.i.Xg=0;ha.i.speed=0;ha.i.Yg=null;for(var sd=ha.Kb?ha.Kb.dupli_group.objects:ib,Uc=0;Uc<sd.length;Uc++)Na=sd[Uc],Na.b4w_vehicle&&(jb=Na.b4w_vehicle_settings,oa.gx(Na)&&db.name==jb.name?(ha.i.Pf.push(Na),ha.i.ki.push(new Float32Array(8))):oa.Xp(Na)&&db.name==jb.name?(ha.i.Yg=Na,ha.i.Qm=jb.steering_max,ha.i.yr=jb.steering_ratio,ha.i.Tp=jb.inverse_control,wb=Sa.invert(ha.d.L,new Float32Array(16)),gd=Sa.multiply(wb,Na.d.L,wb),ha.i.Ar=
gd,Vc=new Float32Array([1,0,0,0]),Za.transformMat4(Vc,gd,Vc),ha.i.zr=Vc):oa.Wp(Na)&&db.name==jb.name?(ha.i.Nm=Na,ha.i.tr=jb.speed_ratio,ha.i.fm=jb.max_speed_angle,wb=Sa.invert(ha.d.L,new Float32Array(16)),hd=Sa.multiply(wb,Na.d.L,wb),ha.i.vr=hd,Wc=new Float32Array([1,0,0,0]),Za.transformMat4(Wc,hd,Wc),ha.i.ur=Wc):oa.Yp(Na)&&db.name==jb.name&&(ha.i.Tm=Na,ha.i.Ro=jb.delta_tach_angle,wb=Sa.invert(ha.d.L,new Float32Array(16)),id=Sa.multiply(wb,Na.d.L,wb),ha.i.Ir=id,Xc=new Float32Array([1,0,0,0]),Za.transformMat4(Xc,
id,Xc),ha.i.Hr=Xc))}}}for(var nd=0;nd<ib.length;nd++){var sc=ib[nd];if(sc.b4w_floating){var jd=sc.b4w_floating_settings;if("MAIN_BODY"==jd.part){sc.xc={};sc.xc.tl=jd.floating_factor;sc.xc.ln=jd.water_lin_damp;sc.xc.mn=jd.water_rot_damp;sc.xc.Xi=[];for(var td=sc.Kb?sc.Kb.dupli_group.objects:ib,od=0;od<td.length;od++){var dd=td[od];if(dd.b4w_floating){var ud=dd.b4w_floating_settings;oa.kx(dd)&&jd.name==ud.name&&(sc.xc.Xi.push(dd),dd.iu=dd.b4w_floating_settings.synchronize_position)}}}}}e(b,c)}function r(a,
b,c,d,e){!xa&&1<a.scenes.length&&(a.scenes=[a.scenes[0]],ra.warn("B4W Warning: loading data contains multiple scenes.","Only the first one will be loaded."));-1==pa.Ba&&xa&&(pa.Ba=a.scenes[0].fps);for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];if(xa&&!f.camera)throw"Scene check failed: No camera";for(var g=ia.$k(f,"MESH"),t=0;t<g.length;t++){var h=g[t],m=ma.Tt(h);m&&(a.meshes.push(m),h.data=m)}for(var t=X(a,b.id),h=a.meshes,m=h.slice(0),k=0;k<t.length;k++){var l=t[k];"MESH"==l.type&&(l=m.indexOf(l.data),
-1<l&&m.splice(l,1))}for(k=0;k<m.length;k++)h.splice(h.indexOf(m[k]),1);xa?(ia.It(f,a.textures),f.d.lh.length&&(b.Ol=!0),Ta.enabled&&f.b4w_enable_physics&&oa.Rn(f),f.b4w_enable_audio&&ya.Sn(f),t=ia.El(f),h=f.b4w_batch_grid_size):(ia.Ot(f,Ea,a.textures),Ta.enabled&&f.b4w_enable_physics&&!Ea.l&&oa.Rn(Ea),f.b4w_enable_audio&&!Ea.h&&ya.Sn(Ea),t=ia.El(Ea),h=Ea.b4w_batch_grid_size);g=L.hw(t,h,g,f.world,Ea.d.Zp);xa?(ia.Jn(f,g),ia.bw(t)):ia.Jn(Ea,g)}d=a.materials;if(za.jl&&Oa.Tr)for(a=0;a<d.length;a++){f=
d[a];h=f.texture_slots;for(g=0;g<h.length;g++)if(m=h[g],k=m.texture,"IMAGE"==k.type||"ENVIRONMENT_MAP"==k.type)t=k.image,t.Xb||(-1<t.filepath.indexOf(".dds")?t.Xb=!0:(t.Xb=!k.b4w_disable_compression&&!m.use_map_normal&&"ENVIRONMENT_MAP"!=k.type&&!k.b4w_shore_dist_map&&"MOVIE"!=t.source,t.Xb&&(t.filepath+=".dds")));if(g=f.node_tree)for(h=g.nodes,g=0;g<h.length;g++)t=h[g],"TEXTURE"==t.type&&((m=t.texture)?(t=m.image)&&!t.Xb&&(t.Xb=m.d.Pi&&!m.b4w_disable_compression&&"MOVIE"!=t.source,t.Xb&&(t.filepath+=
".dds")):ra.warn("B4W Warning: material ",f.name," has empty textures."))}else for(a=a.images,d=0;d<a.length;d++)f=a[d],f.Xb=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds"));e(b,c)}function h(a,b,c,d,e){d=a.groups;a=a.objects;for(var f={},g={},t={},h={},m=0;m<d.length;m++){var k=d[m];f[k.uuid]=k;t[k.uuid]=k}for(m=0;m<a.length;m++)k=a[m],g[k.uuid]=k,h[k.uuid]=k;n(a,null,h,t);for(var l in t)l in f||d.push(t[l]);for(l in h)l in g||a.push(h[l]);e(b,c)}function n(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=
a[f],h=c[g.uuid];if(g=h.proxy){b&&-1==e.indexOf(g.uuid)&&e.push(g.uuid);for(var k=c[g.uuid],l=k.constraints,g=0;g<l.length;g++){var V=wa.cf(l[g]);V.name+="_CLONE";h.constraints.push(V)}"b4w_proxy_inherit_anim"in h&&!h.b4w_proxy_inherit_anim||(h.animation_data&&(k.animation_data=wa.cf(h.animation_data)),k.b4w_use_default_animation=h.b4w_use_default_animation,k.b4w_auto_skel_anim=h.b4w_auto_skel_anim,k.b4w_anim_behavior=h.b4w_anim_behavior,k.b4w_cyclic_animation=h.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)h=
wa.Fl(a,"uuid",e[f]),-1<h&&a.splice(h,1);e={};for(f=0;f<a.length;f++)g=a[f],h=c[g.uuid],b&&(l=wa.cf(h),h="origin_name"in h?h.origin_name:h.name,l.name=b+"*"+h,l.origin_name=h,m(l),c[l.uuid]=l,e[g.uuid]=l.uuid,g.uuid=l.uuid),h=c[g.uuid],h.dupli_group&&(g=h.dupli_group,l=d[g.uuid],k=wa.cf(l),k.name=wa.qk(l.name+"_CLONE"),k.uuid=t.Mp("Group"+k.name),d[k.uuid]=k,g.uuid=k.uuid,n(k.objects,h.name,c,d));if(b)for(f=0;f<a.length;f++){g=a[f];h=c[g.uuid];h.parent&&h.parent.uuid in e?h.parent.uuid=e[h.parent.uuid]:
h.parent&&(ra.warn("B4W Warning: Object's \""+h.name+'" parent is not in dupli group. Disabling parenting.'),h.parent=null);l=h.constraints;for(g=0;g<l.length;g++)b=l[g],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=h.modifiers;for(g=0;g<b.length;g++)d=b[g],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((h=h.lod_levels)&&h.length)for(g=0;g<h.length;g++)b=h[g],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var r in e)sa[r]=e[r]}function m(a){a.uuid=
t.Mp("Object"+a.name)}function s(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&B(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in sa&&(e.lamp.uuid=sa[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&B(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var f=e[d];z(f,"from_node",c);z(f,"to_node",c);u(f,"from_socket",f.from_node.outputs);u(f,"to_socket",f.to_node.inputs)}if(c=a.animation_data)if(c.action&&B(c,"action",b),c.nla_tracks)for(d=
0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],f=0;f<e.strips.length;f++)e.strips[f].action&&B(e.strips[f],"action",b)}function B(a,b,c){(c=c[a[b].uuid])||ra.error("Dangling link found:",b,a);a[b]=c}function z(a,b,c){c=wa.keysearch("name",a[b].name,c);a[b]=c}function u(a,b,c){c=wa.keysearch("identifier",a[b].identifier,c);a[b]=c}function q(a,c,d,e,f,g){if(!Oa.do_not_load_resources){for(var t=ca(c.r),h=a.images,k={},m=[],l=0;l<h.length;l++){var n=h[l],V=n.uuid;if("FILE"===n.source||"MOVIE"===n.source){var r=
F(n,a.textures);if(!r.length)ra.warn("B4W Warning: image ",n.name," has no users.");else if(!(r[0].b4w_shore_dist_map||"MOVIE"===n.source&&Oa.fp)){r=aa(t+n.filepath);if("FILE"===n.source){var s=n.Xb?U.AT_ARRAYBUFFER:U.AT_IMAGE_ELEMENT;za.gm&&Oa.tk&&(r=U.vi(r),"dds"==r[1]?(r=U.vi(r[0]),r=r[0]+".min50."+r[1]+".dds"):r=r[0]+".min50."+r[1])}else"MOVIE"===n.source&&(Oa.Ec?(r=U.vi(r),r=r[0]+".altconv.seq",s=U.Hi):(r=U.vi(r),s=ya.detect_video_container(r[1]),r=s!=r[1]?r[0]+".altconv."+s:r[0]+"."+s,s=U.Ii));
m.push([V,s,r]);k[V]=n}}}m.length?(e.Np=0,U.enqueue(m,function(f,t,h,l){if(f){if(h==U.Ii||h==U.Hi){if(h==U.Ii)var n=f.videoWidth,V=f.videoHeight;else n=f.images[0].width,V=f.images[0].height;ra.log("%cLOAD VIDEO "+n+"x"+V,"color: #"+(2048<n||2048<V?"a00":1024<n||1024<V?"aa0":"0a0"),l);-1==l.indexOf(ua)&&ra.warn("B4W Warning: video",l,"is not from app root.")}else b(f,l,!0);t=k[t];l=F(t,a.textures);for(n=0;n<l.length;n++){var V=l[n],r=V.image.filepath;h==U.Hi?(V.d.dr=f.Pb,Ga.zi(V.d,f.images,t.Xb,r)):
Ga.zi(V.d,f,t.Xb,r)}}f=++e.Np/m.length;g(c,d,f)},function(){ra.log("%cLOADED ALL IMAGES","color: #0a0");f(c,d)})):f(c,d)}}function F(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function k(a,b,c,d,e,f){if(!Oa.do_not_load_resources){a=X(a,b.id);for(var g=ca(b.r),t=[],h={},k=0;k<a.length;k++){var m=a[k];if(x(m)){var l=m.data.sound,n=l.uuid;"BACKGROUND_MUSIC"==ya.Hl(m)?(n=wa.aw(),b.Nl=!0):"NONE"!=ya.Hl(m)&&Oa.Qp&&(b.Ql=!0);if(!(n in h)){h[n]=[];l=aa(g+l.filepath);
switch(ya.rr(m)){case ya.yk:var V=U.AT_AUDIOBUFFER;break;case ya.pn:V=U.AT_AUDIO_ELEMENT}var l=U.vi(l),r=ya.detect_audio_container(l[1]),l=r!=l[1]?l[0]+".altconv."+r:l[0]+"."+r;t.push([n,V,l])}h[n].push(m)}}t.length?U.enqueue(t,function(a,e,g,k){if(a)for(ra.log("%cLOAD SOUND","color: #0aa",k),-1==k.indexOf(ua)&&ra.warn("B4W Warning: sound",k,"is not from app root."),e=h[e],g=0;g<e.length;g++)ya.Xz(e[g],a);a=++d.bz/t.length;f(b,c,a)},function(){ra.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)}):
e(b,c)}}function x(a){return ya.Hd(a)&&ya.rr(a)!=ya.qn?!0:!1}function v(a,b){for(var c=ia.Ea(a,"SPEAKER",ia.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];ya.Hd(e)&&(ya.is_cyclic(e)||b)&&ya.play_def(e)}}function G(a){a=a.d.lh;for(var b=0;b<a.length;b++)Oa.Ec&&a[b].use_auto_refresh?a[b].d.Ng=!0:a[b].d.Ya&&a[b].use_auto_refresh&&a[b].d.Ya.play()}function A(a,b,c,d,e){Q.start();ra.log("%cSTART NLA","color: #0a0");e(b,c)}function C(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,
f=0;f<e;f++){var g=b.lod_levels[f],t=g.object;if(t){var h=wa.Ah(t);h.name=b.name+"_LOD_"+String(f+1);m(h);h.lod_levels=[];c.push([a,h]);d.push(t);g.object=h}}}function M(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var f=d[e].dupli_group;f&&(f=f.objects,g=f.indexOf(a),-1<g&&f.splice(g,1))}var g=d.indexOf(a);-1<g&&d.splice(g,1)}}function y(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d],g=xa?f.b4w_enable_physics:Ea.b4w_enable_physics||f.b4w_enable_physics;
xa||(f=Ea);for(var t=0;t<nb.length;t++)for(var h=ia.Ea(f,nb[t],ia.DATA_ID_ALL),k=0;k<h.length;k++){var m=h[k];m.d.ud==b.id&&Ta.enabled&&g&&(oa.append_object(m,f),b.fq&&oa.has_physics(m)&&oa.disable_simulation(m))}}e(b,c)}function I(a,c,d,e,f){var g={};e=[];for(var t=a.scenes,h=0;h<a.scenes.length;h++){var k=t[h];if(k.d.Ma&&(k=k.d.Ma.gk)&&"FILE"===k.source){var m=k.uuid,l=aa(ca(c.r)+k.filepath);e.push([m,k.Xb?U.AT_ARRAYBUFFER:U.AT_IMAGE_ELEMENT,l]);g[m]=k}}e.length?U.enqueue(e,function(c,d,e,f){if(c){b(c,
f,!0);d=g[d];f=F(d,a.textures);for(e=0;e<f.length;e++){var h=f[e];Ga.zi(h.d,c,d.Xb,h.image.filepath)}for(e=0;e<t.length;e++)if(f=t[e],f.d.Ma.gk===d){var k=c,m=d,l=document.createElement("canvas"),h=m.size[0],m=m.size[1];l.width=h;l.height=m;l=l.getContext("2d");l.drawImage(k,0,0);k=l.getImageData(0,0,h,m).data;l=new Float32Array(4);l[0]=1/16581375;l[1]=1/65025;l[2]=1/255;l[3]=1;for(var h=h*m,m=new Float32Array(h),n=0;n<h;n++)m[n]=l[1]*k[4*n+2]+l[2]*k[4*n+3];f.d.Gm=m}}},function(){f(c,d)}):f(c,d)}
function H(a,c,d,e,f){if(Oa.antialiasing&&Oa.smaa){e=a.scenes[0];a=[];for(var g=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],t=0;t<g.length;t++){var h=ia.ma(e,g[t]);h&&a.push(h)}if(a.length){e=[];t=U.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",t,S.Rb.smaa_search_texture_path]);e.push(["AREA_TEXTURE",t,S.Rb.smaa_area_texture_path]);for(t=0;t<a.length;t++)if(g=a[t],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.da;for(t=0;t<a.length;t++)if(g=
a[t],"u_search_tex"==g.ea)var k=g.ha;else if("u_area_tex"==g.ea)var m=g.ha;break}e.length?U.enqueue(e,function(a,c,d,e){a&&(b(a,e,!1),c="SEARCH_TEXTURE"==c?k:m,c.source="IMAGE",c.Wn=!0,Ga.zi(c,a,-1!=e.indexOf(".dds")?1:0,e),Ga.Dm(c,Ga.B,Ga.B))},function(){f(c,d)}):f(c,d)}else f(c,d)}else f(c,d)}function Y(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];xa||(e=Ea);for(var f=ia.Ea(e,"ALL",ia.DATA_ID_ALL),g=0;g<f.length;g++){var t=f[g];t.d.ud==b.id&&(b.fq&&wa.is_mesh(t)&&ia.hide_object(t),
d.Kn.push({ty:e,obj:t}))}}}function J(a,b,c,d,e,f){a=d.Kn;var g=d.rq;a.length?(e=a[g].obj,g=a[g].ty,ia.append_object(g,e),-1!=Yb.indexOf(e.type)&&g.b4w_enable_audio&&ya.append_object(e,g),d=++d.rq/a.length):d=1;f(b,c,d)}function D(a,b,c,d,e){if(xa){d=ia.Gw();for(var f=d[d.length-1],g=0;g<d.length;g++){var t=d[g];ia.$y(t);ia.Wz(t);ia.Wx(t,f);t.b4w_use_nla&&Q.Tz(t,t.b4w_nla_cyclic)}ia.set_active(f)}else ia.Sr(Ea);a=X(a,b.id);V.Rz(a);e(b,c)}function T(a,b,c,d,e){if(xa)for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||
G(a.scenes[d]),v(a.scenes[d]);else a.scenes[0].b4w_use_nla||G(Ea),v(Ea);e(b,c)}function K(a,b,c,d,e){Oa.uf&&(b.Ol||b.Nl||b.Ql)?Ha||R(a,e,b,c):e(b,c)}function R(a,b,c,d){var e=ob.canvas.parentElement;pb=e.style.zIndex;e.style.zIndex="999";Ha=document.createElement("div");Ha.style.position="relative";Ha.style.height="88px";Ha.style.width="88px";var f=Math.round(ob.canvas.offsetWidth/2-44);Ha.style.top=Math.round(ob.canvas.offsetHeight/2-44).toString()+"px";Ha.style.left=f.toString()+"px";Ha.style.backgroundImage=
"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABYCAYAAABxlTA0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAhOSURBVHic7Z1tjFxVGcd/z1AKsbzotoW0IQqFhpSXFlugxbbGRkNSLJEQLVJttH7VEl8+oCYYExLFDxilJib6AWshtlterN20hkBKsNitpFVapB9YIzGBWEq3+IKCLf374Tx3587szGxn5577Mt1fcnN37r1zznP+c/a55557znOMkiDJgLnAADDT9+ktOQYwChwHTvh+tGl7zcyUp/3tsCIzlzQdWAwsA24CLs4o6X8ALwDDwEEz+19G6XZN7gJLugi4mSDqh4HzUqffBN6gXkPT++RvaKzhM5v2lwCzUmm+C/yRIPYfzOyfMcrVjlwE9n//lcAngQVALXV6hFD435vZ3zLK74PARwg/4lWpU6eBI8Au4Lk83Eh0gSUtBDYA8/3QaeAlYB8wbGbHIuc/myD0LcB11H/cEeBhM3sxZv7RBJZ0OfBF4EY/9CawDdhrZv+Kle8ENl0IrADuou5GDhKE/muMPDMXWNIs4PPAxz39t4FBYGeRN5s0fnO9HVgLzAAE7AG2ZP0flZnAkmrAOuBOYDpwEhgCBouqsRPhNXotsAY4l2DzDoLQ72WRRyYCS7oAuJfQKohWG2Lhfno9sIqgySHg+6WoGJIuk/QzSUOSHpF0TdE2TRZJ13gZhiT93FsjhRq0RNI2N2iTpEsKNSgDJM2S9GMv06CkGyf+Vnsm7SIk3QF8idDs2Qc8aGbv9GJMWZB0HvBVQttdhFbGE5NJq2uBJU0DvgJ8wg9tBR4ty7N /lkhaS/DNBjwDbDKzU7Ez/bL/+zwh6aNRMysBkpZK2u5l/lrszNZ4Ro9LujpqZiVC0ryUyHfGyuQGSTsk7ZS0PEomJcZr8k7ferrxtUp8rqSt/guuyzTxCiFpbap1cUZNuNpEF0iaAXwHuAB4HvhVb2ZWFzMbBH4HvA+4z58EO9JRYH/8vRe4DPgL8MN+bC10yY8IWswBviXpnE4XT1SDP0d44/AWcL+ZvZuJiRXGNbifoMlCQjOueyTNlvSk+5zrMrSxL/DH6p2u0ex213WqwesJPUzPm9lLmVtYcczsZUKn1rl0qMUtBZZ0BaFn6RSwOYaBfcIWQhfnKtdsHO1q8AbC4+Fvzez1SMZVHu+OHSJotaHVNeMElrSIcGP7L6GfIRqSdklaEDOPHBgkvLVZ7No10CCwv/1NfonHzeytyMatBg5JekjSwIRXlxDvlB/0jxtcw9ZIWumthl9KOj+2cWrkuKSN3ltXKSRNl/QL125l+lyzi7jV91sL6NsdAB4i1OjVOefdE/4yd5t/vDV9bkxgfyS+HngPeC4368azANhVQf+8lzDm43rXEmiswUuAacCfzezfORvXikr5Z/fFLxM0vCk5nhb4Ft8P52jXREwDNgKvVMQ/J9olWgaB3fAlfmx/zkadCVXxz4nAS3xwy1gNXkjognvVzI4WYdkZUmr/bGZ/B14FzgdugLrAy3xfJvfQiTL750TDZQA1bxgvbTpZBcrqnxMXu1SS1QijDGcCo2Y2Upxdk6Zs/nmEMFj8YmBOjSAuQNU7dUrhn/2NT6LlzBqNE0v6gTL450TLvhQYivfPiZYD/SpwQlH++awROCFv/9wgcHKTO97m4n4iL/+caHnW1OA0efjnlje5s6EGp4npnxtq8BQRqZGqzkUaUgCjwD3AQjPbnXHaiZajaYHL1mkSi1PAJmC+mcUasT7mdqdxdtXg3cA3zOxI5HwSLU+kBe7nGnyEIGzWrqAdYzW4RuqOl1PmeRLTz3 ZirOnbrzX4FPBT4LtmVkT7vq8FzsvPdqKlwHMLMiYr8vaznUi0PF4DjhH88ICkq9p/p7QU5Wdb4hoOEOIGvV7zHvix90iFWdY9ebRnJ0PyAnm/mSl5VB5uOll2dhNq7D0F3cQ60fCGPhH4EPAf4IqSz5g/AtxmZrcVfBNriaRLgcuBd4A/gQvs/14H/LoyuolS+dkOJNodSMLnpHvT9vm+TG6irH62HYl2iZakO5sPEAp0raQZZvZ2npa1oAzt2TPGZ31eS9DwheT4WA12QQ8TRF+Rt4EpSu1nO7AcOAc4nK6czR3uT/n+7mR0YI5Uxc+Ow7X6rH98Kn2uWeC9hKE/s4BPxTcNqJ6fbcXtBM1GCBq2R9Ki1JT9i2JaVfQwpyyQdKHqgaE6T+MC8FiOBwnjhe+OaVwF/WwrkuiBB1vFwWz30vNhQrSl1ZLmRDSu0vgk8DV4ZKpW17QU2ANl7iG0KL4Qy8A+IJkwv6ddcNFOr+2Tic4rpsIZjEchwuEqgkZb2l3XVmCf6Pykf/ymQlTVKRhzDd8mTALf0SlG50QDTx4hhOd+PyFGTd5t49KhEBXwPoImhwkataWjwGZ2GngAeA24EogbmK3k+HyWrwPzgKPA9zJptytEWE3aenf1nGBFkbTONdgu6UNZJ75Y0m88Tk0ZuzSjImm56oHp4pRf0h3+Cz4maV6UTEqIpCu9zEOSPtPNd7saXWlmvwaeJsxk/IGkm7v5fhXxMj5AKPOzZra9m+/3Gt5WwGYze6zbdKqApE8THrSS8LY/MbOT3aSRVYDmPYTYuqVYZaBXvDm6kfAg0VOA5l4NSYcYf7CE84a7RtKAlyWTEONZGJQOkr9ZFY4rLOlqL0NmQfJjLfPwLGGZhzeySD82PlRhPfAxMl7mYWqhkiosVJJGU0vtNJDnYlHHgEcJi0UVshyEQiy4FYSwvUnE1GotFtWMxi93dhJ4kTDgcH/ssWXeslnq2yKCK4CqL3eWRu0X7BPwC mGg3HDGC/Yt820+9XL234J9zajzkpNHCcEsTlBfZvJE02eoLzf5Ad/Sn+cCl6bS7P8lJ9uhqUVT80N9uuzv/wFReZvk3/McjgAAAABJRU5ErkJggg==')";
Pa=document.createElement("div");Pa.style.position="relative";Pa.style.height=ob.canvas.offsetHeight.toString()+"px";Pa.style.width=ob.canvas.offsetWidth.toString()+"px";Pa.style.background="rgba(0, 0, 0, 0.5)";Pa.style.zIndex="999";e.appendChild(Pa);Pa.appendChild(Ha);Ha.addEventListener("click",function(){c.Ol&&(Ga.play(),Ga.pause(),Ga.reset());if(c.Nl){if(xa)for(var e=0;e<a.scenes.length;e++)v(a.scenes[e],!0);else v(Ea,!0);ya.pause()}c.Ql&&ya.Sx();N();b(c,d)},!1)}function N(){if(Ha){var a=ob.canvas.parentElement;
a.style.zIndex=pb;Pa.removeChild(Ha);a.removeChild(Pa);Ha=Pa=null;pb=0}}function ca(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function O(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function aa(a){var b=a.split("://",2);
return 1<b.length?(b[1]=O(b[1]),b.join("://")):O(a)}function X(a,b){Va[b]||ba(a,b);return Va[b]}function ba(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)w(c[e].objects,0,d);Va[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],f=0;f<c.length;f++)for(var g=c[f],t=0;t<g.length;t++)Va[b].push(g[t])}function w(a,b,c){c[b]=c[b]||[];for(var d=c[b],e=0;e<a.length;e++){var f=a[e],g=ga(f);d[g]=d[g]||[];(xa||-1==Lb.indexOf(f.type))&&-1==d[g].indexOf(f)&&d[g].push(f);(f=f.dupli_group)&&w(f.objects,b+1,c)}}function ga(a){return(a=
a.parent||ka.get_first_armature_object(a))?1+ga(a):0}var ka=p("__animation"),L=p("__batch"),S=p("__config"),W=p("__controls"),ja=p("__dds"),qa=p("__extensions");p("__lights");var P=p("__loader"),U=p("__assets"),t=p("__md5"),V=p("__objects"),oa=p("__physics"),ra=p("__print"),ma=p("__reformer"),da=p("__renderer"),ia=p("__scenes"),Q=p("__nla"),ya=p("__sfx"),fa=p("__shaders"),Ga=p("__textures"),ta=p("__nodemat"),wa=p("__util"),Za=p("vec4"),Sa=p("mat4"),Oa=S.p,za=S.md,Ta=S.sb,pa=S.kd,tc=S.Od,la=null,Va=
null,ua="",xa=!1,Ea=null,sa={},Ha=null,Pa=null,pb=0,Lb=["LAMP","CAMERA"],nb=["MESH","CAMERA","EMPTY"],Yb=["SPEAKER"],ob=null;a.is_primary_loaded=function(a){return P.is_primary_loaded(a)};a.update=function(){P.Uz(la)};a.fc=function(a){ob=a};a.Qz=function(a,b){if(Ha){Pa.style.height=b.toString()+"px";Pa.style.width=a.toString()+"px";var c=Math.round(a/2-44);Ha.style.top=Math.round(b/2-44).toString()+"px";Ha.style.left=c.toString()+"px"}};a.load=function(a,b,g,t,m){var n={load_main:{Ka:P.Qe,ab:!1,F:[],
eb:!1,hb:500,Ab:!1,Oa:e},duplicate_objects:{Ka:P.Hc,ab:!1,F:["load_main"],eb:!1,hb:50,Ab:!1,Oa:h},load_binaries:{Ka:P.Qe,ab:!1,F:["load_main"],eb:!1,hb:500,Ab:!1,Oa:d},prepare_bindata:{Ka:P.Hc,ab:!1,F:["duplicate_objects","load_binaries"],eb:!1,hb:0,Ab:!1,Oa:l},prepare_root_datablocks:{Ka:P.Hc,ab:!1,F:["duplicate_objects","prepare_bindata"],eb:!1,hb:150,Ab:!1,Oa:f},prepare_root_scenes:{Ka:P.Hc,ab:!1,F:["prepare_root_datablocks"],eb:!1,hb:350,Ab:!1,Oa:r},load_smaa_textures:{Ka:P.Qe,ab:!0,F:["prepare_root_scenes"],
eb:!1,hb:10,Ab:!0,Oa:H},load_shoremap:{Ka:P.Qe,ab:!0,F:["prepare_root_scenes"],eb:!1,hb:10,Ab:!0,Oa:I},load_textures:{Ka:P.Qe,ab:!0,F:["prepare_root_scenes"],eb:!0,hb:500,Ab:!1,Oa:q,bf:{Np:0}},add_physics_objects:{Ka:P.Hc,ab:!1,F:["load_shoremap"],eb:!1,hb:20,Ab:!1,Oa:y},add_objects:{Ka:P.Hc,ab:!1,F:["add_physics_objects"],eb:!1,hb:800,Ab:!1,Oa:Y,hg:J,zh:D,bf:{Kn:[],rq:0}},load_speakers:{Ka:P.Qe,ab:!0,F:["add_objects"],eb:!0,hb:30,Ab:!1,Oa:k,bf:{bz:0}},mobile_media_start:{Ka:P.Hc,ab:!Oa.uf,F:["load_textures",
"load_speakers"],eb:!0,hb:5,Ab:!1,Oa:K,hg:K},synchronize_media:{Ka:P.Hc,ab:!0,F:["mobile_media_start"],eb:!0,hb:70,Ab:!1,Oa:T},start_nla:{Ka:P.Hc,ab:!0,F:["mobile_media_start"],eb:!1,hb:5,Ab:!1,Oa:A}},V=P.zp();V||(V=P.Zu(),la=[],Va=[],sa={});la[V.ad.length]={};return P.hv(n,a,b,g,c,t||tc.Un,Oa.do_not_load_resources,m)};a.unload=function(a){var b=P.zp();if(!b||!b.ad.length||a&&!P.Az(b.ad[a]))ra.error("Unable to unload data!");else{if(0==a)ra.log("%cUNLOAD ALL","color: #00a"),ka.cleanup(),ya.cleanup(),
Q.cleanup(),ia.cleanup(),P.cleanup(),oa.cleanup(),V.cleanup(),wa.cleanup(),da.cleanup(),ta.cleanup(),fa.cleanup(),W.cleanup(),qa.cleanup(),U.cleanup(),Ga.cleanup(),Va=null,sa={},xa=!1,la=Ea=null;else{ra.log("%cUNLOAD DATA "+a,"color: #00a");ka.fy(a);for(var b=ia.Ph(),c=0;c<b.length;c++)for(var d=b[c],e=ia.Ea(d,"ALL",ia.DATA_ID_ALL),f=e.length-1;0<=f;f--){var g=e[f];if(g.d.ud==a){var t=d,h=g;ka.is_animated(h)&&ka.remove(h);ia.clear_glow_anim(h);oa.has_physics(h)&&(oa.disable_simulation(h),oa.gy(h));
W.check_sensor_manifold(h)&&W.remove_sensor_manifold(h);ia.hy(t,h);ya.Hd(h)&&ya.dz(h);e.splice(f,1);t=ia.Ea(d,g.type,ia.DATA_ID_ALL);g=t.indexOf(g);-1!=g&&t.splice(g,1)}}}N()}};a.set_debug_resources_root=function(a){ua=a}};b4w.module.__batch=function(a,p){function c(a){a={type:a,id:0,xm:0,If:"",N:[],ic:[],Ac:[],mm:[],rd:[],Zf:null,Xa:{},Nb:null,Va:null,Tn:[],Qc:null,mb:null,oc:null,Fb:null,Oo:!1,num_vertices:0,num_triangles:0,Gj:0,Hj:0,xg:0,tj:0,Il:0,Qb:new Float32Array(3),Ao:new Float32Array(3),$b:new Float32Array(16),xa:!1,Bo:!1,V:!1,Td:!1,sa:!1,Yf:!1,yd:!1,Vb:!1,Wb:!1,Cb:!1,ec:!1,Ub:!1,Bc:!1,Da:!1,Rq:!1,xd:R.ph,Vd:R.jd,fh:0,Vm:new Float32Array(2),t:new Float32Array(2),Dp:!1,Hp:0,Ep:0,Ip:0,Jp:0,Gp:new Float32Array(3),
Fp:new Float32Array(3),pf:!1,Jc:0,ge:0,ff:1,mi:0,sr:0,Tg:1,fi:0,ef:0,Ue:1,oq:0,hm:0,Kf:0,Wq:0,vd:Array(2),vc:new Float32Array(3),Zc:new Float32Array(3),Pd:new Float32Array(3),zb:new Float32Array(4),Bd:new Float32Array(4),Bg:null,Wl:null,Ul:null,Tl:null,Vl:null,Me:!1,water_dynamic:!1,nn:!1,as:!1,bs:0,cs:0,$r:0,xk:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,ip:new Float32Array(2),hp:new Float32Array(2),ul:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
Gf:null,wm:!1,Bq:0,xq:0,pm:0,Aq:0,Dq:0,Cq:0,yq:0,zq:0,qm:0,uq:0,tq:0,Fq:0,wq:0,Uj:new Float32Array(3),Eq:new Float32Array(8),vq:new Float32Array(16)};a.zb[3]=1;a.Bo=!0;a.V=!0;a.fh=1;return a}function b(a,b,c){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=g.d,k=l(g.data.b4w_bounding_box),m=g.data.b4w_bounding_cylinder_radius,n=g.data.b4w_bounding_sphere_radius,r=g.data.b4w_bounding_sphere_center,s=g.data.b4w_bounding_ellipsoid_axes,q=g.data.b4w_bounding_ellipsoid_center;if(h.od){var n=Math.max(Math.abs(k.max_x),
Math.abs(k.min_x)),m=Math.max(Math.abs(k.max_y),Math.abs(k.min_y)),P=Math.max(Math.abs(k.max_z),Math.abs(k.min_z)),P=Math.sqrt(n*n+m*m+P*P),n=Math.sqrt(n*n+m*m);k.max_x=k.max_y=k.max_z=P;k.min_x=k.min_y=k.min_z=-P;m=n;n=P;r[0]=r[1]=r[2]=0;s[0]=s[1]=s[2]=P;q[0]=q[1]=q[2]=0}h.Lb=k;P=J.Qk(k,h.L);h.Na=P;var P=h,v=m;P.Mk=J.Io(v,k);P.Kk=J.Go(m,k);P.Lk=J.Ho(v,k);r=J.dl(n,r);h.yc=r;r=J.Sk(r,h.L);h.ub=r;s=J.cl([s[0],0,0],[0,s[1],0],[0,0,s[2]],q);h.Ze=s;s=J.Rk(s,h.Sd);h.$e=s;e=e.concat(d(g,h,b,c))}return e}
function e(a,b,c,e){for(var f=[],g=[],h={},k=0;k<a.length;k++){var m=a[k],n=m.d,r=l(m.data.b4w_bounding_box),s=J.Qk(r,n.L),q=J.dl(m.data.b4w_bounding_sphere_radius,m.data.b4w_bounding_sphere_center),P=J.Sk(q,n.L),v=m.data.b4w_bounding_ellipsoid_axes,v=J.cl([v[0],0,0],[0,v[1],0],[0,0,v[2]],m.data.b4w_bounding_ellipsoid_center),B=J.Rk(v,n.Sd);n.Lb=r;n.Na=s;n.yc=q;n.ub=P;n.Ze=v;n.$e=B;r={};r.Vb=n.Vb;r.Wb=n.Wb;r.Cb=n.Cb;r.Sc=n.Sc;r.Tj=n.Tj;r.rj=n.rj;r.ec=n.ec;r.Ub=n.Ub;r.Bc=n.Bc;r.af=n.af;r.cd=n.cd;r.Id=
n.Id;r.Hb=n.Hb;r.od=n.od;r.wh=n.wh;r.Da=n.Da;r.ng=n.ng;r.lj=n.lj;r.yd=n.yd;s=n.ub.A;r.Ww=0==c?[0,0]:[Math.floor(s[0]/c),Math.floor(s[2]/c)];r.pe=n.pe;r.$h=n.$h;r.Df=n.Df;n=JSON.stringify(r);h[n]=h[n]||[];h[n].push(m)}for(var U in h){r=JSON.parse(U);c=h[U];var m=O.gj("STATIC"),D;for(D in r)m[D]=r[D];m.ud=a[0].d.ud;m.dd=0;m.Pe=0;m.ee=0;m.de=0;m.be=0;m.Sh=!1;for(k=0;k<c.length;k++)n=c[k],0==k?(m.Na=S.ya(n.d.Na),m.ub=S.ya(n.d.ub),m.Ze=S.ya(n.d.Ze),m.$e=S.ya(n.d.$e)):(J.Yo(m.Na,n.d.Na),J.Gv(m.ub,n.d.ub));
m.Lb=S.ya(m.Na);m.yc=S.ya(m.ub);g.push({Mb:m,Kd:c})}for(a=0;a<g.length;a++)for(h=g[a].Mb,k=g[a].Kd,U=0;U<k.length;U++){D=k[U];c=d(D,h,b,e);m=A(D.d)||A(h);n={};h.cd&&(n.au_center_pos=[m[0],m[1],m[2]],n.au_wind_bending_amp=[D.d.dd],n.au_wind_bending_freq=[D.b4w_wind_bending_freq],n.au_detail_bending_amp=[D.b4w_detail_bending_amp],n.au_detail_bending_freq=[D.b4w_detail_bending_freq],n.au_branch_bending_amp=[D.b4w_branch_bending_amp]);for(r=0;r<c.length;r++)P=c[r].Mb,s=c[r].hc,q=c[r].n,P.Fj?P.od?R.qz(s,
m):R.Dr(s,m):("COLOR_ID"==q.type?(P=c[r].Mb=D.d,P.type="DYNAMIC",q.If=D.uuid,F(q,P),C(q,S.yh(P,0))):s=R.Dr(s,m),R.pz(s,n));f=f.concat(c)}return f}function d(a,b,d,e){for(var h=[],m=g(d,b),k=S.yh(b,0),l=a.data,n=l.materials,r=0;r<m.length;r++){var s=m[r];if(!a.b4w_do_not_render||"PHYSICS"==s)for(var q=0;q<n.length;q++){var P=n[q];if(("LENS_FLARES"!=P.name||0!=e)&&!R.Kp(l,q)){var v=c(s);if(f(v,P,!0)){v.xd=l.xd||R.ph;"COLOR_ID"===s&&v.Ao.set(a.Cn);F(v,b);for(var B=v,U=a.particle_systems,D=0;D<U.length;D++){var z=
U[D].settings.b4w_vcol_from_name,p=U[D].settings.b4w_vcol_to_name;""!==z&&""!==p&&(B.Xa[z]={mf:!1,src:[{name:z,rc:7}]})}"DYNAMIC"==b.type&&(v.If=a.uuid);C(v,k);B=R.dp(l,q,v.rd,v.oc,v.Xa,v.Zf);"LENS_FLARES"==P.name&&(B=aa.Vx(B));h.push({n:v,hc:B,bc:[P.name],Mb:b,Dc:[a]})}}}}m=a.particle_systems;if(0<m.length&&h.length){e=!0;for(r=0;r<m.length;r++)if(m[r].settings.use_render_emitter){e=!1;break}r=h[0].n;m=h[0].hc;l=[];n=a.particle_systems;s=a.data;for(q=0;q<n.length;q++)if(P=n[q],v=P.settings,v.count)if("EMITTER"==
v.type){if("DYNAMIC"==b.type){B=c("PARTICLES");U=s.materials;D=P.settings.material-1;D>=U.length&&(T.warn('B4W Warning: Wrong material used for rendering particle system "'+P.name+'"'),D=0);U=U[D];"HALO"===P.settings.render_type&&(B.pf=!0);f(B,U);F(B,b);D=B;z=P;switch(z.settings.b4w_billboard_align){case "VIEW":x(D,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":x(D,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":x(D,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":x(D,"BILLBOARD_ALIGN",
"BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}x(D,"BILLBOARD",0);ga.G(D.Va,"WORLD_SPACE","WORLD"==z.settings.b4w_coordinate_system?1:0);B.yd=!0;B.If=a.name+"_"+v.uuid;C(B,k);B.Qc=P;v=aa.ew(B,s,P,a.d.Sd);aa.Cy(B,P,U);l.push({n:B,hc:v,bc:[U.name],Mb:b,Dc:[a]})}}else if("HAIR"==v.type){B=S.Bj(P.seed);v.b4w_dynamic_grass&&(b.ng=!0);if(P.transforms.length)var u=P.transforms;else for(var U=R.Al(m,v.count,!1,B),u=new Float32Array(4*U.length),L=0;L<U.length;L++)D=.75+.5*S.tc(B),
u[4*L]=U[L][0],u[4*L+1]=U[L][1],u[4*L+2]=U[L][2],u[4*L+3]=D;U=w.bb(d,"GRASS_MAP")?!0:!1;if("OBJECT"==v.render_type)D=[g(d,v.dupli_object.d)],P=G(a,b,r,m,[v.dupli_object],D,[u],v,P,U,B,!1),l=l.concat(P);else if("GROUP"==v.render_type){z=v.dupli_group.objects;p=!1;D=[];for(L=0;L<z.length;L++){var A=g(d,v.dupli_group.objects[L].d);D.push(A)}if(v.use_whole_group){p=u;u=z;L={};for(A=0;A<p.length;A+=4)for(var y=0;y<u.length;y++){var K=W.create();W.scale(u[y].d.g,u[y].d.scale,K);var J=W.clone([p[A],p[A+
1],p[A+2]]);W.add(J,K,J);L[y]||(L[y]=new Float32Array(p.length));L[y][A]=J[0];L[y][A+1]=J[1];L[y][A+2]=J[2];L[y][A+3]=p[A+3]}u=L;p=!0}else if(v.use_group_count){for(var J=z,N=v.dupli_weights,L=B,A={},y=[],K=0;K<J.length;K++)for(var H=J[K],H=H.origin_name||H.name,I=0;I<N.length;I++){var O=N[I];H==O.name.split(": ")[0]&&y.push(O)}N.length!=y.length&&T.error("B4W Error: dupli weights match failed");for(K=0;K<u.length;K+=4){var ja,N=y;ja=[0];for(J=0;J<N.length;J++)ja[J+1]=ja[J]+N[J].count;N=ja[ja.length-
1]*S.tc(L);for(J=H=0;J<ja.length;J++)if(N>=ja[J]&&N<ja[J+1]){H=J;break}ja=H;A[ja]=A[ja]||[];A[ja].push(u[K],u[K+1],u[K+2],u[K+3])}for(ja in A)A[ja]=new Float32Array(A[ja]);u=A}else{L=B;A=z.length;y={};for(K=0;K<u.length;K+=4){var M=Math.floor(A*S.tc(L));y[M]=y[M]||[];y[M].push(u[K],u[K+1],u[K+2],u[K+3])}for(M in y)y[M]=new Float32Array(y[M]);u=y}P=G(a,b,r,m,z,D,u,v,P,U,B,p);l=l.concat(P)}"INSTANCE"==v.b4w_wind_bend_inheritance&&(a.d.dd=0)}else throw"Unknown particle settings type";a=l;h=e?a:h.concat(a)}return h}
function l(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function g(a,b){var c=["MAIN","NODES"];b.Sc&&(w.bb(a,"COLOR_PICKING")||w.bb(a,"GLOW_MASK"))&&c.push("COLOR_ID");w.bb(a,"WIREFRAME")&&c.push("WIREFRAME");c.push("PHYSICS");(w.bb(a,"DEPTH")||w.bb(a,"SHADOW_CAST"))&&c.push("DEPTH");w.bb(a,"GRASS_MAP")&&c.push("GRASS_MAP");if(b.Wb||b.Ub){var d=null;b.Wb&&(d=["MAIN","NODES","COLOR_ID","PHYSICS","WIREFRAME"]);if(b.Ub)var e=["COLOR_ID","PHYSICS","DEPTH",
"WIREFRAME"],d=null!==d?S.Wt(d,e):e;for(e=0;e<d.length;e++){var f=c.indexOf(d[e]);-1!==f&&c.splice(f,1)}}return c}function f(a,b,c){var d,e;switch(a.type){case "MAIN":if(b.b4w_do_not_render||b.use_nodes)a=!1;else{h(a,b);var f=b.game_settings.alpha_blend;a.Td=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;a.Kf=b.offset_z;a.Zc.set([1,1,1]);var g=b.texture_slots;ja.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.zb);switch(b.name){case "LENS_FLARES":y(a,"special_lens_flares.glslv",
"special_lens_flares.glslf");k(a,"a_position");k(a,"a_texcoord");var l=c?[1,1,1,0]:null,l=n(g[0],l);I(a,l);break;default:y(a,"main.glslv","main.glslf");var q=m("use_map_color_diffuse",g),v=m("use_map_color_spec",g),U=m("use_map_normal",g),D=m("use_map_mirror",g),p=m("use_stencil",g),f=q[0],v=v[0],U=U[0],D=D[0],q=q[1],g=p[0]&&m("use_rgb_to_intensity",g)[0];if(f){switch(f.blend_type){case "MIX":x(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":x(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}l=
"IMAGE"==f.texture.d.source&&c?[a.zb[0],a.zb[1],a.zb[2],1]:"ENVIRONMENT_MAP"==f.texture.d.source&&c?[.8,.8,.8,1]:null;l=n(f,l);I(a,l,"u_colormap0");a.ef=f.diffuse_color_factor;a.Ue=f.use_map_alpha?f.alpha_factor:0;a.Zc.set(f.scale)}p=f&&f==v;v&&(p||(l=c?[.5,.5,.5,1]:null,l=n(v,l),I(a,l,"u_specmap0")),a.sr=v.specular_color_factor);if(U){k(a,"a_normal");k(a,"a_tangent");l=c?[.5,.5,1,1]:null;l=n(U,l);I(a,l,"u_normalmap0");a.oq=U.normal_factor;var L=U.texture;if(L.b4w_use_map_parallax&&P.ei){var l=ga.s(L.b4w_parallax_steps),
w=ga.s(L.b4w_parallax_lod_dist);x(a,"PARALLAX",1);x(a,"PARALLAX_STEPS",l);x(a,"PARALLAX_LOD_DIST",w);a.fi=L.b4w_parallax_scale}}D&&(l=c?[0,0,.5,1]:null,l=n(D,l),I(a,l,"u_mirrormap"),a.hm=D.mirror_factor);if(L=f&&q&&g?1:0)l=c?[.8,.8,.8,1]:null,l=n(q,l),I(a,l,"u_colormap1"),l=c?[.5,.5,.5,1]:null,l=n(g,l),I(a,l,"u_stencil0");(c=f||v||U)&&a.Zc.set(c.scale);x(a,"TEXTURE_SPEC",void 0==v?0:1);x(a,"TEXTURE_MIRROR",void 0==D?0:1);x(a,"ALPHA_AS_SPEC",p?1:0);x(a,"TEXTURE_STENCIL_ALPHA_MASK",L);k(a,"a_position");
k(a,"a_normal");(f||v||U)&&k(a,"a_texcoord");if(b.b4w_water){a.Me=!0;a.nn=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;c=b.texture_slots;y(a,"special_water.glslv","special_water.glslf");k(a,"a_position");k(a,"a_texcoord");k(a,"a_normal");k(a,"a_tangent");P.ds?(k(a,"a_polyindex"),a.V=!0,a.wireframe_edge_color=[0,0,0],x(a,"DEBUG_WIREFRAME",1)):x(a,"DEBUG_WIREFRAME",0);p=m("use_map_normal",c);D=m("use_map_mirror",c)[0];p.length&&(L=n(p[0]),I(a,L,"u_normalmap0"),a.xk=b.b4w_water_norm_uv_velocity);
x(a,"NUM_NORMALMAPS",p.length);a.Gf=Array(p.length);for(L=0;L<p.length;L++)a.Gf[L]=new Float32Array(2),a.Gf[L].set([p[L].scale[0],p[L].scale[1]]);D?(x(a,"TEXTURE_MIRROR",1),p=n(D),I(a,p,"u_mirrormap"),a.hm=D.mirror_factor):x(a,"TEXTURE_MIRROR",0);D=null;for(L=0;L<c.length;L++)if(d=c[L],!0===d.texture.b4w_water_foam){D=d;break}D&&P.rg?(x(a,"FOAM",1),p=n(D),I(a,p,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.ip.set(D.texture.b4w_foam_uv_freq),a.hp.set(D.texture.b4w_foam_uv_magnitude),a.ul[0]=D.scale[0],
a.ul[1]=D.scale[1]):x(a,"FOAM",0);for(L=0;L<c.length;L++)if(d=c[L],!0===d.texture.b4w_shore_dist_map){e=d;break}e&&P.Dk?(e=n(e),I(a,e,"u_shore_dist_map"),x(a,"SHORE_PARAMS",1),e=d.texture.b4w_shore_boundings,x(a,"MAX_SHORE_DIST",ga.s(d.texture.b4w_max_shore_dist)),x(a,"SHORE_MAP_SIZE_X",ga.s(e[0]-e[1])),x(a,"SHORE_MAP_SIZE_Y",ga.s(e[2]-e[3])),x(a,"SHORE_MAP_CENTER_X",ga.s((e[0]+e[1])/2)),x(a,"SHORE_MAP_CENTER_Y",ga.s((e[2]+e[3])/2))):x(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&P.kj?(x(a,"GENERATED_MESH",
1),a.as=!0,a.bs=b.b4w_water_num_cascads,a.cs=b.b4w_water_subdivs,a.$r=b.b4w_water_detailed_dist):x(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){d=ga.s(b.b4w_water_dst_noise_scale0);e=ga.s(b.b4w_water_dst_noise_scale1);c=ga.s(b.b4w_water_dst_noise_freq0);var D=ga.s(b.b4w_water_dst_noise_freq1),p=ga.s(b.b4w_water_dir_min_shore_fac),L=ga.s(b.b4w_water_dir_freq),l=ga.s(b.b4w_water_dir_noise_scale),w=ga.s(b.b4w_water_dir_noise_freq),S=ga.s(b.b4w_water_dir_min_noise_fac),C=ga.s(b.b4w_water_dst_min_fac),
A=ga.s(b.b4w_water_waves_hor_fac);x(a,"DST_NOISE_SCALE_0",d);x(a,"DST_NOISE_SCALE_1",e);x(a,"DST_NOISE_FREQ_0",c);x(a,"DST_NOISE_FREQ_1",D);x(a,"DIR_MIN_SHR_FAC",p);x(a,"DIR_FREQ",L);x(a,"DIR_NOISE_SCALE",l);x(a,"DIR_NOISE_FREQ",w);x(a,"DIR_MIN_NOISE_FAC",S);x(a,"DST_MIN_FAC",C);x(a,"WAVES_HOR_FAC",A)}B(a,b);z(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;
x(a,"ABSORB",ga.s(b.b4w_water_absorb_factor));x(a,"SSS_STRENGTH",ga.s(b.b4w_water_sss_strength));x(a,"SSS_WIDTH",ga.s(b.b4w_water_sss_width));d=a.Va;e=a.rd;a.Va=d;a.rd=e}"HALO"===b.type&&(d=b.halo,y(a,"halo.glslv","halo.glslf"),x(a,"NUM_RINGS",d.ring_count),x(a,"NUM_LINES",d.line_count),x(a,"NUM_STARS",d.star_tip_count),x(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.rd=["a_position"],a.Hp=d.size,a.Ep=d.hardness/20,a.Gp.set(d.b4w_halo_rings_color),a.Fp.set(d.b4w_halo_lines_color),a.Ip=1/b.b4w_halo_stars_blend_height,
a.Jp=b.b4w_halo_stars_min_height,a.Dp=!0);x(a,"TEXCOORD",0);x(a,"NORMAL_TEXCOORD",0);f&&r(a,f,"TEXTURE_COLOR0_CO");q&&r(a,q,"TEXTURE_COLOR1_CO");g&&r(a,g,"TEXTURE_STENCIL_ALPHA_MASK_CO");v&&r(a,v,"TEXTURE_SPEC_CO");U&&r(a,U,"TEXTURE_NORM_CO");x(a,"SHADELESS",b.use_shadeless?1:0);a.Yf=b.use_shadeless}f=b.game_settings.alpha_blend;x(a,"ALPHA","OPAQUE"===f?0:1);x(a,"ALPHA_CLIP","CLIP"===f?1:0);x(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(x(a,"VERTEX_COLOR",1),
k(a,"a_color")):x(a,"VERTEX_COLOR",0);a.Jc=b.ambient;a.ff=b.diffuse_intensity;a.ge=b.emit;a.Pd.set(b.specular_color);a.Tg=b.specular_alpha;B(a,b);z(a,b);b.b4w_wettable?x(a,"WETTABLE",1):x(a,"WETTABLE",0);s(a,b);P.of?x(a,"UNROLL_LOOPS",1):x(a,"UNROLL_LOOPS",0);a.wm=b.b4w_refractive;a.Wq=b.b4w_refr_bump;a=!0}break;case "NODES":a=u(a,b);break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)a=!1;else if(h(a,b),a.xa)a=!1;else{y(a,"depth.glslv","depth.glslf");k(a,
"a_position");k(a,"a_normal");f=b.game_settings.alpha_blend;x(a,"ALPHA","OPAQUE"===f?0:1);a.Zc.set([1,1,1]);if((b=m("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===f){a.Zc.set(b.scale);x(a,"TEXTURE_COLOR",1);k(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)f=n(b),I(a,f,"u_colormap0");"NONE"==b.texture.d.source&&(f=n(b),I(a,f,"u_colormap0"))}else x(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.bA=b.b4w_use_ghost,a.Zb=b.b4w_collision_id,
a.yo=b.b4w_collision_group,a.zo=b.b4w_collision_mask,a.Mh=b.physics.friction,a.Hh=b.physics.elasticity,a=!0):b.b4w_water?(a.Me=!0,a.lA=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,
a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_do_not_render||"HALO"===b.type)a=!1;else{h(a,b);a.Vd=R.jd;a.V=!0;a.xa=!1;f=b.game_settings.alpha_blend;a.Td=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;y(a,"color_id.glslv","color_id.glslf");k(a,"a_position");f=b.game_settings.alpha_blend;x(a,"ALPHA","OPAQUE"===f?0:1);a.Zc.set([1,1,1]);if((b=m("use_map_color_diffuse",
b.texture_slots)[0])&&"CLIP"===f){a.Zc.set(b.scale);x(a,"TEXTURE_COLOR",1);k(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)f=n(b),I(a,f,"u_colormap0");"NONE"==b.texture.d.source&&(f=n(b),I(a,f,"u_colormap0"))}else x(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?a=!1:(h(a,b),a.xa=!1,a.Vd=R.jd,a.V=!0,y(a,"grass_map.glslv","grass_map.glslf"),k(a,"a_position"),f=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?
b.b4w_dynamic_grass_color:null,a.Xa.a_grass_size={mf:!0,src:[]},f?(a.Xa.a_grass_size.src.push({name:f,rc:4}),x(a,"DYNAMIC_GRASS_SIZE",1)):x(a,"DYNAMIC_GRASS_SIZE",0),a.Xa.a_grass_color={mf:!0,src:[]},b?(a.Xa.a_grass_color.src.push({name:b,rc:7}),x(a,"DYNAMIC_GRASS_COLOR",1)):x(a,"DYNAMIC_GRASS_COLOR",0),P.of?x(a,"UNROLL_LOOPS",1):x(a,"UNROLL_LOOPS",0),a=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?a=!1:(y(a,"wireframe.glslv","wireframe.glslf"),
k(a,"a_position"),k(a,"a_normal"),k(a,"a_polyindex"),a.V=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],P.of?x(a,"UNROLL_LOOPS",1):x(a,"UNROLL_LOOPS",0),a=!0);break;case "PARTICLES":if(b.b4w_do_not_render)a=!1;else{f=b.texture_slots;if(a.pf)y(a,"particles_color.glslv","particles_color.glslf");else if(y(a,"particles_texture.glslv","particles_texture.glslf"),f=m("use_map_color_diffuse",f)[0]){x(a,"TEXTURE_COLOR",1);switch(f.blend_type){case "MIX":x(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");
break;case "MULTIPLY":x(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.ef=f.diffuse_color_factor;a.Ue=f.use_map_alpha?f.alpha_factor:0;f=n(f);I(a,f)}ja.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.zb);a.Jc=b.ambient;a.ff=b.diffuse_intensity;a.ge=b.emit;a.Pd.set(b.specular_color);a.Tg=b.specular_alpha;k(a,"a_position");k(a,"a_normal");f=b.game_settings.alpha_blend;x(a,"ALPHA","OPAQUE"===f?0:1);x(a,"ALPHA_CLIP","CLIP"===f?1:0);x(a,"PARTICLES_SHADELESS",b.use_shadeless?
1:0);B(a,b);z(a,b);h(a,b);f=b.game_settings.alpha_blend;a.Td=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;a.Kf=b.offset_z;P.of?x(a,"UNROLL_LOOPS",1):x(a,"UNROLL_LOOPS",0);a=!0}break;default:throw"Wrong batch type: "+a.type;}return a}function r(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":x(a,c,"TEXTURE_COORDS_UV_ORCO");x(a,"TEXCOORD",1);break;case "NORMAL":x(a,c,"TEXTURE_COORDS_NORMAL");x(a,"NORMAL_TEXCOORD",1);break;default:x(a,c,0)}}function h(a,b){var c=b.game_settings,d=c.alpha_blend;
switch(d){case "ALPHA_SORT":a.xa=!0;a.Vd=R.Bn;a.V=!0;break;case "ALPHA":a.xa=!0;a.Vd=R.jd;a.V=!0;break;case "CLIP":a.xa=!1;a.Vd=R.jd;a.V=!0;break;case "ADD":a.xa=!0;a.Vd=R.jd;a.V=!1;break;case "OPAQUE":a.xa=!1;a.Vd=R.jd;a.V=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.sa=c.use_backface_culling}function n(a,b){var c=a.texture,d=c.d,c=c.image;d&&b&&c&&ka.zi(d,b,c.Xb,c.filepath);return d}function m(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var f=b[e];1==f[a]&&f.texture&&f.texture.d&&
c.push(f)}return c}function s(a,b){var c=b.raytrace_transparency;a.Bd[0]=c.fresnel;a.Bd[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.mi=c.reflect_factor;a.Bd[2]=c.fresnel;a.Bd[3]=1-c.fresnel_factor/5}function B(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":x(a,"SPECULAR_SHADER","SPECULAR_PHONG");c=b.specular_hardness;break;case "WARDISO":x(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;case "TOON":x(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;
d=b.specular_toon_smooth;break;default:T.error("B4W Error: unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.vc[0]=b.specular_intensity;a.vc[1]=c;a.vc[2]=d}function z(a,b){switch(b.diffuse_shader){case "LAMBERT":x(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.vd[0]=0;a.vd[1]=0;break;case "OREN_NAYAR":x(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.vd[0]=b.roughness;a.vd[1]=0;break;case "FRESNEL":x(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.vd[0]=b.diffuse_fresnel;
a.vd[1]=b.diffuse_fresnel_factor;break;default:T.error("B4W Error: unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.vd[0]=0,a.vd[1]=0}}function u(a,b){if(!b.use_nodes||b.b4w_do_not_render)return!1;var c=ca.Au(b.node_tree,b.uuid,!1);if(!c)return T.error('Failed to create node graph for material "'+b.name+'", disable nodes'),q(a,b),!0;y(a,"nodes.glslv","nodes.glslf");var d=b.game_settings.alpha_blend;x(a,"ALPHA","OPAQUE"===d?0:1);x(a,"ALPHA_CLIP","CLIP"===d?1:0);x(a,"DOUBLE_SIDED_LIGHTING",
b.b4w_double_sided_lighting?1:0);k(a,"a_position");h(a,b);a.Kf=b.offset_z;d=b.game_settings.alpha_blend;a.Td=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;ja.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.zb);a.ge=b.emit;a.Jc=b.ambient;s(a,b);b.b4w_wettable?x(a,"WETTABLE",1):x(a,"WETTABLE",0);a.mm=ca.Bu(c);var e=!1;N.R(c,function(c,d){switch(d.type){case "GEOMETRY_UV":var f=d.data.name,g=d.data.value;a.Zf||(a.Zf={});a.Zf[g]=f;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":f=
d.data.name;a.Xa[f]={mf:!0,src:[{name:d.data.value}]};g=0;if("GEOMETRY_VC"==d.type)g=7;else for(var h=0;h<d.Ta.length;h++){var m="RGB".indexOf(d.Ta[h].identifier);-1<m&&(g|=1<<2-m)}a.Xa[f].src[0].rc=g;break;case "GEOMETRY_NO":k(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":f=d.data.value;k(a,"a_normal");x(a,"DIFFUSE_SHADER","DIFFUSE_"+f.wv);x(a,"SPECULAR_SHADER","SPECULAR_"+f.gz);x(a,"SHADELESS_MAT",f.Yf?1:0);a.Yf=f.Yf;a.Tg=f.Tg;e=!0;break;case "TEXTURE_COLOR":case "TEXTURE_COLOR2":case "TEXTURE_COLOR3":case "TEXTURE_COLOR4":case "TEXTURE_ENVIRONMENT":f=
d.data.name;g=d.data.value;!1!==g.d.Pi&&(g.d.Pi="TEXTURE_ENVIRONMENT"!=d.type?!0:!1);I(a,g.d,f);break;case "TEXTURE_NORMAL":case "TEXTURE_NORMAL2":case "TEXTURE_NORMAL3":case "TEXTURE_NORMAL4":case "B4W_PARALLAX":x(a,"CALC_TBN_SPACE",1);k(a,"a_normal");k(a,"a_tangent");f=d.data.name;(g=d.data.value)?(g.d.Pi=!1,I(a,g.d,f)):T.error("Missing texture in node ",d.name,"for material ",b.name);break;case "LAMP":d.data&&(a.Bg=d.data);break;case "B4W_REFRACTION":a.wm=!0}});e||(a.Yf=!0);P.of?x(a,"UNROLL_LOOPS",
1):x(a,"UNROLL_LOOPS",0);return!0}function q(a,b){y(a,"main.glslv","main.glslf");var c=b.game_settings.alpha_blend;x(a,"ALPHA","OPAQUE"===c?0:1);x(a,"ALPHA_CLIP","CLIP"===c?1:0);x(a,"SHADELESS",1);k(a,"a_position");k(a,"a_normal");ja.set(1,0,1,1,a.zb);x(a,"VERTEX_COLOR",0);a.Kf=b.offset_z;h(a,b)}function F(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.Fj?x(a,"AU_QUALIFIER","attribute"):x(a,"AU_QUALIFIER","uniform"),x(a,"STATIC_BATCH",0)):(x(a,"AU_QUALIFIER","attribute"),x(a,"STATIC_BATCH",1));
"WIREFRAME"==a.type&&(K.Kw()?x(a,"WIREFRAME_QUALITY",1):x(a,"WIREFRAME_QUALITY",0),a.kl?(x(a,"DEBUG_SPHERE",1),a.Oo?x(a,"DEBUG_SPHERE_DYNAMIC",1):x(a,"DEBUG_SPHERE_DYNAMIC",0)):x(a,"DEBUG_SPHERE",0),x(a,"ALPHA",1));b.cd?(""!==b.Id?(a.Xa.a_bending_col_main={mf:!0,src:[{name:b.Id,rc:4}]},k(a,"a_bending_col_main"),""!==b.Hb.cq&&""!==b.Hb.bq&&""!==b.Hb.sq?(a.Xa.a_bending_col_detail={mf:!0,src:[{name:b.Hb.cq,rc:4},{name:b.Hb.bq,rc:2},{name:b.Hb.sq,rc:1}]},k(a,"a_bending_col_detail"),k(a,"a_normal"),x(a,
"DETAIL_BEND",1)):x(a,"DETAIL_BEND",0),x(a,"MAIN_BEND_COL",1)):x(a,"MAIN_BEND_COL",0),x(a,"WIND_BEND",1)):x(a,"WIND_BEND",0);b.Vi?x(a,"BEND_CENTER_ONLY",1):x(a,"BEND_CENTER_ONLY",0);x(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.fu|0);b.od?x(a,"BILLBOARD",1):x(a,"BILLBOARD",0);b.od&&b.Fj?x(a,"HAIR_BILLBOARD",1):x(a,"HAIR_BILLBOARD",0);b.Pk?x(a,"BILLBOARD_SPHERICAL",1):x(a,"BILLBOARD_SPHERICAL",0);switch(b.wh){case "RANDOM":x(a,"BILLBOARD_RANDOM",1);x(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":x(a,"BILLBOARD_RANDOM",
0);x(a,"BILLBOARD_JITTERED",1);break;default:x(a,"BILLBOARD_RANDOM",0),x(a,"BILLBOARD_JITTERED",0)}b.Da&&P.Dk?x(a,"DYNAMIC_GRASS",1):x(a,"DYNAMIC_GRASS",0);a.Da=b.Da;a.yd=b.yd;a.Vb=b.Vb;a.Wb=b.Wb;a.Cb=b.Cb&&!a.Yf&&!(a.xa&&P.So);a.ec=b.ec;a.Ub=b.Ub;a.Bc=b.Bc;b.Wh?(k(a,"a_influence"),x(a,"SKINNED",1),b.Lh?x(a,"FRAMES_BLENDING",1):x(a,"FRAMES_BLENDING",0),x(a,"MAX_BONES",b.max_bones)):(x(a,"SKINNED",0),x(a,"FRAMES_BLENDING",0));b.vk?(x(a,"VERTEX_ANIM",1),P.Yr?x(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):
x(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):x(a,"VERTEX_ANIM",0);if(b.Wh&&b.vk)throw"Skinning and vertex animation are mutually exlusive";b.lj?x(a,"DISABLE_FOG",1):x(a,"DISABLE_FOG",0);b.oc&&(a.oc=b.oc);if(b.Ff&&"NODES"==a.type){for(var c=a.mm,d=b.ai,e=0;e<c.length;e++){var f=c[e];switch(f.id){case "ANIM_VALUE":for(var g=f.Wj[1],h=0;h<d.length;h+=2)if(d[h]==g){f.Wj[0]=d[h+1];break}}}x(a,"NUM_ANIM_VALUES",b.Ff.length)}}}function k(a,b){var c=a.rd;-1==c.indexOf(b)&&c.push(b)}function x(a,
b,c){ga.G(a.Va,b,c)}function v(a,b){if("PHYSICS"==a.type)a.hc=b;else{var c=a.Vd,d=a.xd;a.Dp&&(b=R.Lv(b));a.as&&(b=X.iw(a.bs,a.cs,a.$r));c=R.sz(b,c,d,a.Xa);a.yd||c.Aj||(c.le=null,c.bd=null);a.mb=c;c=b.u.length;a.num_vertices=b.I*c;a:switch(a.xd){case R.ph:case R.Ji:case R.sn:d=!0;break a;default:d=!1}d?R.lx(b)?a.num_triangles=b.ca.length/3*c:a.num_triangles=b.I/3*c:a.num_triangles=0}}function G(a,b,d,e,g,h,m,k,l,n,r,s){var q=[],P=k.b4w_dynamic_grass;if(!n&&P)return q;for(var v="INSTANCE"==k.b4w_wind_bend_inheritance,
D="INSTANCE"==k.b4w_shadow_inheritance,U="INSTANCE"==k.b4w_reflection_inheritance,B=[],p=[],u=0;u<g.length;u++){var z=g[u],x=S.Ah(b);x.od=k.b4w_hair_billboard;x.wh=k.b4w_hair_billboard_type;x.Pk="SPHERICAL"==k.b4w_hair_billboard_geometry;x.Da=P;x.Fj=!0;x.Ff=z.d.Ff;x.ai=z.d.ai;v?(x.cd=z.d.cd,x.Fi=z.d.Fi,x.Pe=z.d.Pe,x.ee=z.d.ee,x.Id=z.d.Id,x.de=z.d.de,x.be=z.d.be,x.dd=z.d.dd,x.Hb=z.d.Hb,x.Vi=!1):(x.cd=a.d.cd,x.Fi=a.d.Fi,x.Pe=a.d.Pe,x.ee=a.d.ee,x.Id=a.d.Id,x.de=a.d.de,x.be=a.d.be,x.dd=a.d.dd,x.Hb=a.d.Hb,
x.Vi=!0);D?(x.Vb=z.d.Vb,x.Wb=z.d.Wb,x.Cb=z.d.Cb):(x.Vb=a.d.Vb,x.Wb=a.d.Wb,x.Cb=a.d.Cb);U?(x.ec=z.d.ec,x.Ub=z.d.Ub,x.Bc=z.d.Bc):(x.ec=a.d.ec,x.Ub=a.d.Ub,x.Bc=a.d.Bc);B.push(x);var w=m[u];w||(w=new Float32Array);s&&S.Bj(l.seed,r);for(var A=new Float32Array(3),y=new Float32Array([0,0,0,1]),G=[],K=0;K<w.length;K+=4){A[0]=w[K];A[1]=w[K+1];A[2]=w[K+2];var J=w[K+3];if(k.b4w_initial_rand_rotation){switch(k.b4w_rotation_type){case "XYZ":var N=new Float32Array([S.tc(r),S.tc(r),S.tc(r)]);W.normalize(N,N);break;
case "Z":N=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+k.b4w_rotation_type;}qa.setAxisAngle(N,k.b4w_rand_rotation_strength*(2*Math.PI*S.tc(r)-Math.PI),y)}var H=L.lg(A,J,y);G.push(H)}p.push(G)}for(var I={},u=0;u<g.length;u++){var O=h[u],x=B[u],M=S.yh(x,0),G=p[u];if(G.length)for(var ca=g[u].data,aa=ca.materials,K=0;K<aa.length;K++)if(!R.Kp(ca,K))for(var Y=0;Y<O.length;Y++){var X=O[Y];if("COLOR_ID"!==X){var ba=c(X),ga=aa[K];if(f(ba,ga,!0)){ba.xd=ca.xd||R.ph;F(ba,
x);ba.If=k.uuid;"JITTERED"==k.b4w_hair_billboard_type&&(ba.Gj=k.b4w_hair_billboard_jitter_amp,ba.Hj=k.b4w_hair_billboard_jitter_freq);P&&(ba.tj=k.b4w_dynamic_grass_scale_threshold);v||(delete ba.Xa.a_bending_col_main,delete ba.Xa.a_bending_col_detail);C(ba,M);var ka=R.dp(ca,K,ba.rd,ba.oc,ba.Xa,ba.Zf),Ab=[];if(x.cd||x.Da||x.od)Ab.au_wind_bending_amp=[x.dd],Ab.au_wind_bending_freq=[x.Pe],Ab.au_detail_bending_freq=[x.ee],Ab.au_detail_bending_amp=[x.de],Ab.au_branch_bending_amp=[x.be];var $a=R.ux(ka,
Ab,G),eb=$a,Ja=G;eb.D.au_center_pos=new Float32Array(3*eb.I);for(var Zb=Ja.length,Xa=eb.I/Zb,Ia=0;Ia<Zb;Ia++)for(var Bb=Ja[Ia],Sb=3*Xa*Ia,qb=0;qb<Xa;qb++)eb.D.au_center_pos[Sb+3*qb]=Bb[0],eb.D.au_center_pos[Sb+3*qb+1]=Bb[1],eb.D.au_center_pos[Sb+3*qb+2]=Bb[2];$a=eb;if(x.Vi){var Wa=$a,ab=a.d.L;Wa.D.a_emitter_center=new Float32Array(3*Wa.I);var Ca=ja.fromValues(0,0,0,1);ja.transformMat4(Ca,ab,Ca);for(var rb=0;rb<Wa.I;rb++)Wa.D.a_emitter_center[3*rb]=Ca[0],Wa.D.a_emitter_center[3*rb+1]=Ca[1],Wa.D.a_emitter_center[3*
rb+2]=Ca[2];$a=Wa}var Mb=k.b4w_vcol_from_name,va=k.b4w_vcol_to_name,tb=ba,ea=d,Nb=!v,Ba=ca,Da=[];if(""!==Mb&&""!==va){var Fa,xb=va,yb=tb.Xa,Qa=[],Ob=void 0;for(Ob in yb)for(var lb=yb[Ob].src,Pb=0,bc=0;bc<lb.length;bc++){var vc=lb[bc].rc;xb==lb[bc].name&&Qa.push(Ob,vc,Pb);Pb+=S.Rf(vc)}Fa=Qa;if(0<Fa.length)for(var Tb=0;Tb<Fa.length;Tb+=3)Da.push({Ih:Mb,oj:7,Xj:Fa[Tb],Yj:Fa[Tb+1],mj:Fa[Tb+2]});else R.Xw(tb.rd,"a_color")&&va==Ba.active_vcol_name&&Da.push({Ih:Mb,oj:7,Xj:"a_color",Yj:7,mj:0})}Nb&&("a_bending_col_main"in
ea.Xa&&Da.push({Ih:"a_bending_col_main",oj:4,Xj:"a_bending_col_main",Yj:4,mj:0}),"a_bending_col_detail"in ea.Xa&&Da.push({Ih:"a_bending_col_detail",oj:7,Xj:"a_bending_col_detail",Yj:7,mj:0}));for(var Gb=$a,jc=G,kc=e,Ya=Da,lc=ba.Xa,Ub=!1,gb=0;gb<Ya.length;gb++){var cc=Ya[gb].Ih,ub=kc.D[cc];if(ub&&0<ub.length){Ub=!0;break}}if(Ub){var E,hb=a.d.Lb,bb=kc.u[0].a_position,cb=jc,na=I,Z=new Float32Array(3),Ka=new Float32Array(3),Ua=new Uint32Array(cb.length);if(!("verts_indices"in na)){na.qd=new Float32Array(3);
na.nd=new Float32Array(3);na.jn=new Uint32Array(bb.length/3);na.bi=new Uint32Array(bb.length/3);na.qd[0]=(hb.max_x-hb.min_x)/20;na.qd[1]=(hb.max_y-hb.min_y)/20;na.qd[2]=(hb.max_z-hb.min_z)/20;na.nd[0]=hb.min_x;na.nd[1]=hb.min_y;na.nd[2]=hb.min_z;for(var La=0;La<bb.length/3;La++){var Hb=S.trunc((bb[3*La]-na.nd[0])/na.qd[0]),Ib=S.trunc((bb[3*La+1]-na.nd[1])/na.qd[1]),Jb=S.trunc((bb[3*La+2]-na.nd[2])/na.qd[2]),Hb=S.clamp(Hb,0,19),Ib=S.clamp(Ib,0,19),Jb=S.clamp(Jb,0,19);na.jn[La]=La;na.bi[La]=Jb*Math.pow(20,
2)+20*Ib+Hb}R.az(na.bi,na.jn,!0);na.ag=new Uint32Array(Math.pow(20,3));for(La=0;La<na.bi.length;La++)na.ag[na.bi[La]]++;delete na.bi;for(La=1;La<na.ag.length;La++)na.ag[La]+=na.ag[La-1]}for(var dc=0;dc<cb.length;dc++){Z[0]=cb[dc][0];Z[1]=cb[dc][1];Z[2]=cb[dc][2];for(var Kb=1E10,Vb=-1,mc=S.trunc((Z[0]-na.nd[0])/na.qd[0]),Ec=S.trunc((Z[1]-na.nd[1])/na.qd[1]),Ra=S.trunc((Z[2]-na.nd[2])/na.qd[2]),mc=S.clamp(mc,0,19),Ec=S.clamp(Ec,0,19),Ra=S.clamp(Ra,0,19),Ma=Ra*Math.pow(20,2)+20*Ec+mc,Yc=na.ag[Ma],Cb=
0==Ma?0:na.ag[Ma-1];Cb<Yc;Cb++){var Fc=na.jn[Cb];Ka[0]=bb[3*Fc];Ka[1]=bb[3*Fc+1];Ka[2]=bb[3*Fc+2];W.sub(Ka,Z,Ka);var wc=W.sqrLen(Ka);wc<=Kb&&(Kb=wc,Vb=Fc)}if(-1==Vb)for(Cb=0;Cb<bb.length/3;Cb++)Ka[0]=bb[3*Cb],Ka[1]=bb[3*Cb+1],Ka[2]=bb[3*Cb+2],W.sub(Ka,Z,Ka),wc=W.sqrLen(Ka),wc<=Kb&&(Kb=wc,Vb=Cb);Ua[dc]=Vb}E=Ua;for(var kd=Gb.I/jc.length,gb=0;gb<Ya.length;gb++){var Wb=Ya[gb].Xj,ec=Ya[gb].Yj,cc=Ya[gb].Ih,$b=Ya[gb].oj,ub=kc.D[cc];switch(Wb){case "a_bending_col_main":var mb=1;break;case "a_bending_col_detail":mb=
3;break;case "a_color":mb=3;break;default:for(var Db=mb=0;Db<lc[Wb].src.length;Db++)mb+=S.Rf(lc[Wb].src[Db].rc)}if(ub&&0<ub.length){var xc=S.Rf($b),yc=S.Rf(ec),nc=$b&ec,ac=S.$q(nc);nc!=ec&&T.error("Wrong color extraction from "+cc+" to "+Wb+".");if("a_bending_col_main"==Wb||"a_bending_col_detail"==Wb)Gb.D[Wb]=new Float32Array(Gb.I*yc);for(Db=0;Db<jc.length;Db++){var oc=E[Db],Qb=oc*xc,sb=Db*kd*mb;if(-1!=oc)for(var Eb=0;Eb<kd;Eb++)for(var fc=Eb*mb,vb=0;vb<ac.length;vb++)ac[vb]&&(Gb.D[Wb][sb+fc+(Ya[gb].mj+
S.qi(ec,vb))]=ub[Qb+S.qi($b,vb)])}}else Gb.D[Wb]=new Float32Array(0)}}$a=Gb;q.push({n:ba,hc:$a,bc:[ga.name],Mb:x,Dc:[a]})}}}}return q}function A(a){return L.lg(a.g,a.scale,a.quat)}function C(a,b){for(var c=null,d=null,e=0;e<a.N.length;e++){var f=a.N[e].pd;f&&(c||(c={}),c[e]=f,a.N[e].pd=null);if(f=a.N[e].Ya)d||(d={}),d[e]=f,a.N[e].Ya=null}a.id=0;a.xm=b;a.id=S.yh(a,b);if(c)for(var g in c)a.N[g].pd=c[g];if(d)for(g in d)a.N[g].Ya=d[g]}function M(a,b,d,e,f){var g=c("WIREFRAME");y(g,"wireframe.glslv","wireframe.glslf");
g.wireframe_mode=0;g.kl=!0;g.V=!0;g.If=d;f&&(g.Oo=!0);F(g,b);C(g,S.yh(b,0));e?(b=X.op(1,a.A),R.sy(b,[a.We[0],a.Xe[1],a.Ye[2]],a.A)):b=X.op(a.ua,a.A);R.Sm(b,1,!0);b.D.a_polyindex=R.cp(b);v(g,b);return g}function y(a,b,c){a.Va={Bi:b,Kh:c,fe:[]};ga.By(a.Va)}function I(a,b,c){1==a.N.length&&0==a.ic.length&&a.ic.push("default0");c=c||"default"+String(a.N.length);-1==a.ic.indexOf(c)&&(a.N.push(b),a.ic.push(c));a.Nb&&ba.Qn(a)}function H(a){if(!a.Va)throw"No shaders info for batch "+a.name;a.Nb=ga.uw(a.Va,
a.mm);ba.$t(a.Nb);ba.Pn(a);ba.Qn(a)}function Y(a,b,c){var d=a.Va;ga.G(d,"SHADOW_SRC",b);ga.G(d,"SHADOW_DST",c);return a}var J=p("__boundings"),D=p("__config"),T=p("__print"),K=p("__extensions"),R=p("__geometry"),N=p("__graph"),ca=p("__nodemat"),O=p("__objects"),aa=p("__particles"),X=p("__primitives");p("__reformer");var ba=p("__renderer"),w=p("__scenegraph");p("__scenes");var ga=p("__shaders"),ka=p("__textures"),L=p("__tsr"),S=p("__util"),W=p("vec3"),ja=p("vec4"),qa=p("quat"),P=D.p,U=["MAIN","NODES"];
a.aC=c;a.hw=function(a,d,f,g,h){for(var m=[],l=[],r=0;r<f.length;r++){var s=f[r];switch(s.d.type){case "DYNAMIC":m.push(s);break;case "STATIC":l.push(s)}}f=[];f=f.concat(b(m,a,h));d=f=f.concat(e(l,a,d,h));r=[];s=[];h={};for(f=0;f<d.length;f++){var l=d[f].n,q=d[f].Mb,m=null;if(l.id in h){var D=h[l.id],B=s[D].n,z=s[D].Mb,p=null,u=null;for(a=0;a<l.N.length;a++){var L=l.N[a].pd;L&&(p||(p={}),p[a]=L,l.N[a].pd=null);if(L=l.N[a].Ya)u||(u={}),u[a]=L,l.N[a].Ya=null}S.Br(l,B)&&S.Br(q,z)&&(m=s[D]);if(p)for(a in p)l.N[a].pd=
p[a];if(u)for(a in u)l.N[a].Ya=u[a];if(!m){do l.id++;while(h[l.id])}}m||(m={n:l,Mb:d[f].Mb,Dc:[],Er:[],bc:[]},h[l.id]=s.length,s.push(m));m.Dc=m.Dc.concat(d[f].Dc);d[f].hc&&d[f].hc.I&&m.Er.push(d[f].hc);if(m.bc.length)for(a=0;a<d[f].bc.length;a++)l=d[f].bc[a],-1==m.bc.indexOf(l)&&m.bc.push(l);else m.bc=d[f].bc}for(f=0;f<s.length;f++){d=s[f].Er;if(0==d.length)a=S.wb(S.qk("%empty"));else if(1==d.length)a=d[0];else{h=[];for(a=0;a<d.length;a++)R.mx(d[a])||h.push(a);if(h.length<d.length)for(a=0;a<h.length;a++)R.Sm(d[h[a]]);
a=R.rz(d)}r.push({n:s[f].n,Mb:s[f].Mb,hc:a,bc:s[f].bc,Dc:s[f].Dc})}f=r;for(r=0;r<f.length;r++)v(f[r].n,f[r].hc),f[r].n.Ac=f[r].bc;a=[];for(r=0;r<f.length;r++)if(d=f[r].n,"STATIC"==f[r].Mb.type)s=S.Pp(S.qk("%meta")),s.d=f[r].Mb,s.W=[d],a.push(s);else for(h=[],m=0;m<f[r].Dc.length;m++)if(s=f[r].Dc[m],-1==h.indexOf(s.name)){for(l=0;l<s.W.length;l++)if(s.W[l]==d)throw"Batch already exist in object";s.W.push(d);h.push(s.name)}if(P.wireframe_debug){for(r=0;r<f.length;r++)d=f[r].Mb,"DYNAMIC"==d.type&&(s=
f[r].Dc[0],-1<U.indexOf(f[r].n.type)&&(d=M(d.Ze,d,s.name,!0,!0),s.W.push(d)));for(r=0;r<a.length;r++)s=a[r],d=s.d,-1<U.indexOf(s.W[0].type)&&(d=M(d.yc,d,s.name,!1),s.W.push(d))}s=null;if(g.texture_slots)for(r=0;r<g.texture_slots.length;r++)if(g.texture_slots[r].texture.b4w_use_as_skydome){s=n(g.texture_slots[r],null);break}if(g.b4w_sky_settings.procedural_skydome||s)d=c("MAIN"),y(d,"special_skydome.glslv","special_skydome.glslf"),g.b4w_sky_settings.procedural_skydome?d.Rq=!0:I(d,s,"u_sky"),g.b4w_sky_settings.reflexible&&
(d.ec=!0,g.b4w_sky_settings.reflexible_only&&(d.Ub=!0)),k(d,"a_position"),d.Kf=99999,g=X.gw(),v(d,g),s=S.Pp(S.qk("%meta")),s.d=O.gj("DYNAMIC"),s.d.ng=!0,s.d.Lb=J.ed(),s.d.yc=J.Gi(),s.d.Na=J.ed(),s.d.ub=J.Gi(),s.W=[d],a.push(s);return a};a.mA=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.bu=l;a.rw=n;a.Hk=function(a,b){x(a,"CSM_SECTION0",0);x(a,"CSM_SECTION1",0);x(a,"CSM_SECTION2",0);
x(a,"CSM_SECTION3",0);for(var c=0;c<b.csm_num;c++)x(a,"CSM_SECTION"+String(c),1);x(a,"SHADOW_TEX_RES",ga.s(b.csm_resolution));x(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);x(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.aa=x;a.pb=function(a,b){return ga.Aw(a.Va,b)};a.Ri=I;a.ly=function(a,b,c){c=a.ic.indexOf(c);-1<c&&(a.N[c]=b)};a.$u=function(a,b){var d=c("MAIN");d.xa=!0;ja.set(b[0],b[1],b[2],.5,d.zb);d.xd=R.Ji;v(d,a);y(d,"main.glslv","main.glslf");x(d,"SHADELESS",1);H(d);
return d};a.Db=H;a.qu=function(a){return a.Nb.gi.length?a.Nb.sm.u_cube_fog?!0:!1:!1};a.av=function(a,b){var d=c("DEPTH");d.sa=a.sa;d.Zc.set(a.Zc);d.Da=a.Da;d.mb=a.mb;d.id=a.id;d.xm=a.xm;a.N.length&&(d.N[0]=a.N[0],d.ic[0]=a.ic[0]);d.rd=a.rd;d.Gj=a.Gj;d.Hj=a.Hj;d.tj=a.tj;d.num_triangles=a.num_triangles;d.num_vertices=a.num_vertices;d.If=a.If;for(var e=0;e<a.Ac.length;e++)d.Ac.push(a.Ac[e]);d.Qc=a.Qc;a.Fb||(a.Fb=[]);a.Fb.push(d);y(d,"depth.glslv","depth.glslf");ga.cx(d.Va,a.Va);return d=Y(d,"SHADOW_SRC_NONE",
b)};a.an=Y;a.Ou=function(){var a=c("DEPTH_PACK");a.sa=!0;a.V=!1;var b=X.Ha();v(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");H(a);return a};a.Jo=function(a){var b=c("POSTPROCESSING");y(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":x(b,"POST_EFFECT","POST_EFFECT_NONE");b.t[0]=1;b.t[1]=1;break;case "GRAYSCALE":x(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");b.t[0]=1;b.t[1]=1;break;case "X_BLUR":x(b,"POST_EFFECT","POST_EFFECT_X_BLUR");
b.t[0]=1;b.t[1]=0;break;case "Y_BLUR":x(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");b.t[0]=0;b.t[1]=1;break;case "X_EXTEND":x(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");b.t[0]=1;b.t[1]=0;break;case "Y_EXTEND":x(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");b.t[0]=0;b.t[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}b.sa=!0;b.V=!1;a=X.Ha();v(b,a);H(b);return b};a.jB=function(){var a=c("EDGE");a.V=!1;a.sa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ha();v(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");
H(a);return a};a.ev=function(a){var b=c("SSAO");b.V=!1;b.sa=!0;b.t[0]=1;b.t[1]=1;var d=X.Ha();v(b,d);y(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");x(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.wr);x(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:ka.kw(a)};d={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,
203,0,117,73,12,0])};a=n(a,d);I(b,a,"u_ssao_special_tex");H(b);return b};a.fv=function(a){var b=c("SSAO_BLUR");b.V=!1;b.sa=!0;b.t[0]=1;b.t[1]=1;var d=X.Ha();v(b,d);y(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");x(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);H(b);return b};a.Pu=function(){var a=c("DOF");a.V=!1;a.sa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ha();v(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");x(a,"DEPTH_RGBA",1);H(a);return a};a.Qu=function(){var a=
c("GLOW");a.V=!1;a.sa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ha();v(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");H(a);return a};a.Ru=function(a,b,d){var e=c("GOD_RAYS");e.V=!1;e.sa=!0;e.t[0]=1;e.t[1]=1;var f=X.Ha();v(e,f);y(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");x(e,"DEPTH_RGBA",a);x(e,"WATER_EFFECTS",b);x(e,"STEPS_PER_PASS",ga.s(d,1));H(e);return e};a.Su=function(){var a=c("GOD_RAYS_COM");a.V=!1;a.sa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ha();v(a,b);y(a,"postprocessing/postprocessing.glslv",
"postprocessing/god_rays_combine.glslf");H(a);return a};a.bv=function(){var a=c("SKY");a.V=!1;a.sa=!0;a.t[0]=1;a.t[1]=1;var b=X.cw();v(a,b);y(a,"procedural_skydome.glslv","procedural_skydome.glslf");x(a,"NUM_LIGHTS",1);x(a,"WATER_EFFECTS",1);H(a);return a};a.Iu=function(){var a=c("ANTIALIASING");a.V=!1;a.sa=!0;a.t[0]=1;a.t[1]=1;a.fh=1/P.resolution_factor;var b=X.Ha();v(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");x(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");H(a);
return a};a.cv=function(a){var b=c("SMAA"),d=X.Ha();v(b,d);y(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");x(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");x(b,"SMAA_PASS",a);x(b,"SMAA_PREDICATION",0);x(b,"SMAA_REPROJECTION",0);H(b);b.V=!1;b.sa=!0;b.t[0]=1;b.t[1]=1;b.fh=1/P.resolution_factor;return b};a.Tu=function(a){var b=c("LANCZOS");b.V=!1;b.sa=!0;b.fh=1/P.resolution_factor;"LANCZOS_X"==a?(b.t[0]=1,b.t[1]=0):"LANCZOS_Y"==a&&(b.t[0]=0,b.t[1]=1);a=X.Ha();v(b,a);y(b,"postprocessing/postprocessing.glslv",
"postprocessing/lanczos.glslf");H(b);return b};a.Mu=function(){var a=c("COMPOSITING");a.V=!1;a.sa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ha();v(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");H(a);return a};a.Wu=function(a){var b=c("MOTION_BLUR");b.sa=!0;b.V=!1;var d=X.Ha();v(b,d);y(b,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");x(b,"BLUR_DECAY_THRESHOLD",ga.s(a));H(b);return b};a.Hu=function(){var a=c("ANAGLYPH");a.sa=!0;a.V=!1;var b=X.Ha();v(a,
b);y(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");H(a);return a};a.Uu=function(){var a=c("LUMINANCE");a.V=!1;a.sa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ha();v(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");H(a);return a};a.Ju=function(){var a=c("LUMINANCE");a.V=!1;a.sa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ha();v(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");H(a);return a};a.Vu=function(){var a=c("LUMINANCE_X_BLUR");
a.V=!1;a.sa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ha();v(a,b);y(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");H(a);return a};a.Ku=function(a){var b=c("POSTPROCESSING");switch(a){case "X_BLUR":b.t[0]=1;b.t[1]=0;break;case "Y_BLUR":b.t[0]=0;b.t[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}b.sa=!0;b.V=!1;a=X.Ha();v(b,a);y(b,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");H(b);return b};a.Lu=function(){var a=c("BLOOM");
a.V=!1;a.sa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ha();v(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");H(a);return a};a.iv=function(){var a=c("VELOCITY");a.V=!1;a.sa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ha();v(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");H(a);return a};a.ui=function(a,b,c){var d=a.fh;a.Vm[0]=b*a.t[0]*d;a.Vm[1]=c*a.t[1]*d};a.Sf=function(a,b){a.fh=b};a.X=function(a,b,c){a=a.W;for(var d=null,e=0;e<a.length;e++){var f=a[e];if(-1<
f.Ac.indexOf(b)&&(c&&f.type==c||!c)){if(f.Fb)return f;d=null===d?f:d}}return d};a.zu=function(a){for(var b=a.N,c=0;c<b.length;c++)ka.uv(b[c].La);R.vo(a.mb)}};b4w.module.__nodemat=function(a,p){function c(a,c,e){if(c in S)return S[c];for(var f=O.create(),k=a.nodes,n=a.links,q=a.animation_data,v=0;v<k.length;v++)if(!z(f,k[v],0,q))return S[c]=null;if(e&&-1==s(a,f,"GROUP_OUTPUT","group"))return null;v=Y(f);if(!J(f,n,v))return null;if(e)return f;for(v=0;v<n.length;v++){e=n[v];for(var k=l(e.from_node,f),q=l(e.to_node,f),D=0;D<k.length;D++)for(var B=0;B<q.length;B++){for(var p=k[D],u=q[B],L=O.Ra(f,p),x=O.Ra(f,u),w=f,A=x,x=[],C=e.from_socket.identifier,y=e.to_socket.identifier,
W=L.Ta,L=0;L<W.length;L++)if(W[L].identifier==C){x.push(L);break}A=A.F;for(L=0;L<A.length;L++)if(A[L].identifier==y){x.push(L);break}2==x.length&&O.ae(w,p,u,x)}}d(f);a=s(a,f,"OUTPUT","material");if(-1==a)return S[c]=null;g(f);f=O.Cr(f,a,O.rn);b(f);r(f);h(f);m(f);return S[c]=f}function b(a){O.R(a,function(b,c){for(var d=c.F,f=c.Ta,g=0;g<d.length;g++)e(a,d[g],b,g,1);for(g=0;g<f.length;g++)e(a,f[g],b,g,0)})}function e(a,b,c,d,e){if(b.Gd){var f=!0;O.Je(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&
g[1]==d)f=!1});f&&(b.Gd=!1)}}function d(a){var b=[];O.R(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":O.Je(a,function(a,e,f){a==c&&"Translucency"==d.Ta[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)O.ae(a,b[c],b[c+1],b[c+2])}function l(a,b){var c=[];O.R(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function g(a){var b=[];O.R(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=
2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var g=f(a,d);if(-1!=g){var h=O.qj(a,g,0);O.Kg(a,g,d,-1);-1!=h&&O.Kg(a,h,g,-1);d=O.Ra(a,g);e.data=d.data;e.H[0]=d.H[0];O.Lg(a,g)}e.F.splice(1,1)}else if("REROUTE"==e.type){for(var e=O.qj(a,d,0),m=O.Ig(a,d),g=[],h=[],k=[],l=0;l<m;l++){var n=O.vg(a,d,l),r=h.indexOf(n);-1!=r?k[r]+=1:(h.push(n),k.push(1),g.push(d,n))}if(-1!=e)for(m=O.ug(a,e,d,0)[0],l=0;l<h.length;l++)for(n=0;n<k[l];n++)r=O.ug(a,d,h[l],n)[1],O.ae(a,e,h[l],[m,r]);for(l=0;l<g.length;l+=2)O.Kg(a,
g[l],g[l+1],-1)}}}function f(a,b){for(var c=a.ta,d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function r(a){var b=[];O.R(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var m=c[h];if(n(f,m.wa)){g=[];h=O.Ig(a,e);for(r=0;r<h;r++){var k=O.vg(a,e,r),l=O.ug(a,e,k,0);g.push(e,k,l);
O.ae(a,m.id,k,l)}for(var r=0;r<g.length;r+=3)O.Kg(a,g[r],g[r+1],0);O.Lg(a,e);g=!1;break}}g&&(m={id:e,wa:f},c.push(m))}}function h(a){var b=[];O.R(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var m=c[h];if(!(3<=m.Oj.length)&&n(f,m.wa)){for(var h=[],k=O.Op(a,e),g={},l=0;l<k;l++){var r=O.qj(a,e,l);r in g||(g[r]=0);var s=O.ug(a,r,e,g[r]++);h.push(r,e,s)}for(var k=[],g=O.Ig(a,e),q={},
l=0;l<g;l++)r=O.vg(a,e,l),r in q||(q[r]=0),s=O.ug(a,e,r,q[r]++),k.push(e,r,s);for(var g=h.concat(k),l=0;l<g.length;l+=3)O.Kg(a,g[l],g[l+1],0);O.Lg(a,e);l={wa:f,Cv:h,Dv:k};m.Oj.push(l);g=!1;break}}g&&(m={id:e,wa:f,Oj:[]},c.push(m))}for(d=0;d<c.length;d++){m=c[d];e=m.Oj.length;k=m.wa.F.length;g=m.wa.Ta.length;for(h=0;h<e;h++){s=m.Oj[h];l=s.wa;f=s.Cv;q=s.Dv;m.wa.F=m.wa.F.concat(l.F);m.wa.Ta=m.wa.Ta.concat(l.Ta);for(l=0;l<m.wa.F.length;l++)m.wa.F[l].identifier+=X.trunc(l/k)+1;for(l=0;l<m.wa.Ta.length;l++)m.wa.Ta[l].identifier+=
X.trunc(l/g)+1;for(l=0;l<f.length;l+=3)r=f[l],s=f[l+2],s[1]+=(h+1)*k,O.ae(a,r,m.id,s);for(l=0;l<q.length;l+=3)r=q[l+1],s=q[l+2],s[0]+=(h+1)*g,O.ae(a,m.id,r,s)}switch(e){case 1:m.wa.type+="2";break;case 2:m.wa.type+="3";break;case 3:m.wa.type+="4"}O.Lg(a,m.id);O.Gk(a,m.id,m.wa)}}function n(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==
b.data.value;default:return!1}}function m(a){var b=[];O.R(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],f=!1,g=[],h=[],m=[[],[],[]],k=O.Ig(a,d),l=0;l<k;l++){var n=O.vg(a,d,l);if("SEPRGB"!=O.Ra(a,n).type){f=!1;break}g.push(d,n);for(var r={},s=O.Ig(a,n),f=0;f<s;f++){var q=O.vg(a,n,f);q in r||(r[q]=0);var v=O.ug(a,n,q,r[q]++);g.push(n,q);m[v[0]].push(d,q,v)}h.push(n);f=!0}if(f){for(l=d=k=0;l<m.length;l++)m[l].length&&(k++,d|=1<<2-l);if(k){e.type+=
k;e.Ta=[];for(l=0;l<m.length;l++)if(m[l].length)for(e.Ta.push({yb:0,identifier:"RGB"[l],Gd:!0,name:"RGB"[l]}),f=0;f<m[l].length;f+=3)m[l][f+2][0]=X.qi(d,l);for(l=0;l<g.length;l+=2)O.Kg(a,g[l],g[l+1],0);for(l=0;l<h.length;l++)O.Lg(a,h[l]);for(l=0;l<m.length;l++)for(f=0;f<m[l].length;f+=3)O.ae(a,m[l][f],m[l][f+1],m[l][f+2])}}}}function s(a,b,c,d){a=a.nodes;for(var e=null,f=0;f<a.length;f++){var g=a[f];g.type==c&&(e=g)}return e?l(e,b)[0]:(ca.error('No "'+c+'" node in node '+d),-1)}function B(a,b,c,d){return{name:a,
type:b,inputs:c,outputs:d}}function z(a,b,c,d){var e=b.name,f=b.type,g=[],h=[],m=[],l=[],n=null,r=[];switch(f){case "CAMERA":h=[];m=y(b);break;case "COMBRGB":case "COMBHSV":h=M(b);m=y(b);break;case "GEOMETRY":a:{for(var f=b.outputs,s=0;s<f.length;s++)if(f[s].is_linked){f=!0;break a}f=!1}if(!f)return!0;f=x(b,c);if(!f)return ca.error("Geometry output is not supported"),!1;switch(f){case "GEOMETRY_UV":if(!b.uv_layer)return ca.error('Missing uv layer in node "',b.name,'"'),!1;n=k("param_GEOMETRY_UV_a");
s=k("param_GEOMETRY_UV_v");g.push(I(n));g.push(I(s));m.push(G(b,"UV"));l.push(I(s));n={name:n,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return ca.error("Missing vertex color layer in node ",b.name),!1;n=k("param_GEOMETRY_VC_a");s=k("param_GEOMETRY_VC_v");g.push(I(n));g.push(I(s));m.push(G(b,"Vertex Color"));l.push(I(s));n={name:n,value:b.color_layer};break;case "GEOMETRY_NO":m.push(G(b,"Normal"));break;case "GEOMETRY_FB":m.push(G(b,"Front/Back"));break;case "GEOMETRY_VW":m.push(G(b,
"View"));break;case "GEOMETRY_GL":m.push(G(b,"Global"))}break;case "GROUP":s=b.node_tree_name;switch(s){case "B4W_LINEAR_TO_SRGB":if(!u(b,[1],[1])){n=q(b);break}f="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!u(b,[1],[1])){n=q(b);break}f="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!u(b,[1],[1])){n=q(b);break}f="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!u(b,[1,1],[1])){n=q(b);break}f="B4W_REFLECT";break;case "B4W_REFRACTION":if(!u(b,[1,0],[1])){n=q(b);
break}f="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!u(b,[1,1,0,0,0],[1])){n=q(b);break}f="B4W_PARALLAX";if(!b.inputs[1].is_linked)return ca.error('Missing texture in node "',b.name,'"'),!1;var D=k("temp_texture");l.push(I(D));break;case "B4W_CLAMP":if(!u(b,[1],[1])){n=q(b);break}f="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!u(b,[0,0,0,0,0],[0])){n=q(b);break}f="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!u(b,[],[0])){n=q(b);break}f="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!u(b,[0,0,0],[0])){n=
q(b);break}f="B4W_SMOOTHSTEP";break;default:n=q(b)}h=M(b);m=y(b);"B4W_TRANSLUCENCY"==s&&(s=C("TranslucencyParams","TranslucencyParams",[0,0,0,0]),s.Gd=m[0].Gd,m.push(s));break;case "LAMP":n=b.lamp;if(!n)return ca.error("There is no lamp in node: "+b.name),!1;m.push(G(b,"Color"));m.push(G(b,"Light Vector"));m.push(G(b,"Distance"));m.push(G(b,"Visibility Factor"));n.uuid in W?l.push(I(k("param_LAMP_lamp_index"),W[n.uuid],1)):(W[n.uuid]=ja,l.push(I(k("param_LAMP_lamp_index"),ja++,1)));n=W;break;case "NORMAL":h=
M(b);m=y(b);s=G(b,"Normal");l.push(I(k("param_NORMAL_Normal"),s.yb,3));break;case "MAPPING":s=b.vector_type;f="MAPPING";h.push(v(b,"Vector"));m.push(G(b,"Vector"));var D=b.rotation,B=b.scale,p=b.translation,L=ga.create(),A=X.Fv(D),S=new Float32Array([B[0],0,0,0,B[1],0,0,0,B[2]]);ga.multiply(A,S,L);L=X.wx(L,ka.create());switch(s){case "POINT":L[12]=p[0];L[13]=p[1];L[14]=p[2];break;case "TEXTURE":L[12]=p[0];L[13]=p[1];L[14]=p[2];L=ka.invert(L,L);break;case "NORMAL":ka.invert(L,L),ka.transpose(L,L)}switch(s){case "NORMAL":r.push(["MAPPING_IS_NORMAL",
1]);case "TEXTURE":r.push(["MAPPING_TRS_MATRIX",aa.s(L,16)]);break;case "POINT":0!==w.length(D)?r.push(["MAPPING_TRS_MATRIX",aa.s(L,16)]):(0!==w.length(B)&&r.push(["MAPPING_SCALE",aa.s(B,3)]),0!==w.length(p)&&r.push(["MAPPING_TRANSLATION",aa.s(p,3)]));break;case "VECTOR":0!==w.length(D)?r.push(["MAPPING_TRS_MATRIX",aa.s(L,16)]):0!==w.length(B)&&r.push(["MAPPING_SCALE",aa.s(B,3)])}b.use_min&&r.push(["MAPPING_MIN_CLIP",aa.s(b.min,3)]);b.use_max&&r.push(["MAPPING_MAX_CLIP",aa.s(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":n=
v(b,"Color");n.yb.splice(3);h.push(n);(n=v(b,"Alpha"))?h.push(n):h.push(C("Alpha","Alpha",1));n=v(b,"Spec");n.yb.splice(3);h.push(n);s=v(b,"Normal");s.yb.splice(3);h.push(s);m.push(G(b,"Color"));m.push(G(b,"Alpha"));m.push(G(b,"Normal"));"MATERIAL_EXT"==f&&((n=v(b,"Emit"))?h.push(n):h.push(C("Emit","Emit",0)),n=v(b,"Translucency"),n.yb=0,n.name="Translucency",n.identifier="Translucency",n?h.push(n):h.push(C(n.name,n.identifier,n.yb)),n=v(b,"Translucency"),n.yb=[0,0,0,0],n.name="TranslucencyParams",
n.identifier="TranslucencyParams",n?h.push(n):h.push(C(n.name,n.identifier,n.yb)),(n=v(b,"Ray Mirror"))?h.push(n):h.push(C("Ray Mirror","Ray Mirror",0)),(n=v(b,"SpecTra"))?h.push(n):h.push(C("SpecTra","SpecTra",0)),m.push(G(b,"Diffuse")),m.push(G(b,"Spec")));D=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":n=b.specular_hardness;break;case "WARDISO":n=b.specular_slope;break;case "TOON":n=b.specular_toon_size;D=b.specular_toon_smooth;break;default:ca.error("B4W Error: unsupported specular shader: "+
b.specular_shader+' (material "'+b.material_name+'")'),n=b.specular_hardness}switch(b.diffuse_shader){case "LAMBERT":p=B=0;break;case "OREN_NAYAR":B=b.roughness;p=0;break;case "FRESNEL":B=b.diffuse_fresnel;p=b.diffuse_fresnel_factor;break;default:ca.error("B4W Error: unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),p=B=0}l.push(I(k("param_MATERIAL_diffuse"),[B,p],2));l.push(I(k("param_MATERIAL_spec"),[b.specular_intensity,n,D],3));n={name:b.name,value:{gz:b.specular_shader,
wv:b.diffuse_shader,Yf:b.use_shadeless,Tg:b.specular_alpha}};s.Gd&&r.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&r.push(["USE_MATERIAL_DIFFUSE",1]);b.use_specular&&r.push(["USE_MATERIAL_SPECULAR",1]);break;case "MATH":switch(b.operation){case "ADD":f="MATH_ADD";break;case "SUBTRACT":f="MATH_SUBTRACT";break;case "MULTIPLY":f="MATH_MULTIPLY";break;case "DIVIDE":f="MATH_DIVIDE";break;case "SINE":f="MATH_SINE";break;case "COSINE":f="MATH_COSINE";break;case "TANGENT":f="MATH_TANGENT";break;case "ARCSINE":f=
"MATH_ARCSINE";break;case "ARCCOSINE":f="MATH_ARCCOSINE";break;case "ARCTANGENT":f="MATH_ARCTANGENT";break;case "POWER":f="MATH_POWER";break;case "LOGARITHM":f="MATH_LOGARITHM";break;case "MINIMUM":f="MATH_MINIMUM";break;case "MAXIMUM":f="MATH_MAXIMUM";break;case "ROUND":f="MATH_ROUND";break;case "LESS_THAN":f="MATH_LESS_THAN";break;case "GREATER_THAN":f="MATH_GREATER_THAN";break;case "MODULO":f="MATH_MODULO";break;case "ABSOLUTE":f="MATH_ABSOLUTE";break;default:return ca.error("Unsupported MATH operation: "+
b.operation),!1}r.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);h=M(b);m=y(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":f="MIX_RGB_MIX";break;case "ADD":f="MIX_RGB_ADD";break;case "MULTIPLY":f="MIX_RGB_MULTIPLY";break;case "SUBTRACT":f="MIX_RGB_SUBTRACT";break;case "SCREEN":f="MIX_RGB_SCREEN";break;case "DIVIDE":f="MIX_RGB_DIVIDE";break;case "DIFFERENCE":f="MIX_RGB_DIFFERENCE";break;case "DARKEN":f="MIX_RGB_DARKEN";break;case "LIGHTEN":f="MIX_RGB_LIGHTEN";break;case "OVERLAY":f="MIX_RGB_OVERLAY";
break;case "DODGE":f="MIX_RGB_DODGE";break;case "BURN":f="MIX_RGB_BURN";break;case "HUE":f="MIX_RGB_HUE";break;case "SATURATION":f="MIX_RGB_SATURATION";break;case "VALUE":f="MIX_RGB_VALUE";break;case "COLOR":f="MIX_RGB_COLOR";break;case "SOFT_LIGHT":f="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":f="MIX_RGB_LINEAR_LIGHT";break;default:return ca.error("Unsupported MIX_RGB blend type: "+b.blend_type),!1}r.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);h=M(b);m=y(b);break;case "OUTPUT":h=M(b);m=[];
break;case "RGB":s=G(b,"Color");m.push(s);l.push(I(k("param_RGB_Color"),s.yb,3));break;case "SEPRGB":case "SEPHSV":h=M(b);m=y(b);break;case "TEXTURE":if(!b.texture)return ca.error("No texture attached to node: "+b.name),!1;a:{f=b.outputs;n=!1;for(s=0;s<f.length;s++)if(D=f[s],D.is_linked)switch(D.identifier){case "Color":f="ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";break a;case "Normal":f="TEXTURE_NORMAL";break a;case "Value":n=!0;break;default:throw"Unknown texture output";
}f=n?"ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR":void 0}h.push(v(b,"Vector"));if("TEXTURE_COLOR"==f||"TEXTURE_ENVIRONMENT"==f)m.push(G(b,"Color")),m.push(G(b,"Value"));if("TEXTURE_NORMAL"==f){if("ENVIRONMENT_MAP"==b.texture.type)return ca.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),!1;m.push(G(b,"Normal"));m.push(G(b,"Value"))}D=k("param_TEXTURE_texture");l.push(I(D));n={name:D,value:b.texture};break;case "VALUE":a:if(d){if(f=d.action)for(s in A=f.d.H,A)if(A=
s.match(/"(.*?)"/)[1],A==b.name){D=f.name+"_"+s;break a}D=d.nla_tracks;for(B=0;B<D.length;B++)for(p=D[B].strips,L=0;L<D[B].strips.length;L++)for(s in f=p[L].action,A=f.d.H,A)if(A=s.match(/"(.*?)"/)[1],A==b.name){D=f.name+"_"+s;break a}D=void 0}else D=null;s=G(b,"Value");D?(f="ANIM_VALUE",B={name:k("param_ANIM_VALUE_Value"),value:"0"},l.push(B),B={name:"-1",value:D},l.push(B)):(f="VALUE",l.push(I(k("param_value_value"),s.yb,1)));m.push(s);break;case "VECT_MATH":switch(b.operation){case "ADD":f="VECT_MATH_ADD";
break;case "SUBTRACT":f="VECT_MATH_SUBTRACT";break;case "AVERAGE":f="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":f="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":f="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":f="VECT_MATH_NORMALIZE";break;default:return ca.error("Unsupported VECT_MATH operation: "+b.operation),!1}h=M(b);m=y(b);break;default:h=M(b),m=y(b)}e={name:e,type:f,Di:g,F:h,Ta:m,H:l,data:n,Fh:r};O.Gk(a,O.np(a),e);if(e="GEOMETRY"==b.type)a:{e=b.outputs;for(h=g=0;h<e.length;h++)if(e[h].is_linked&&
g++>c){e=!0;break a}e=!1}return e&&!z(a,b,++c,d)?!1:!0}function u(a,b,c){for(var d=a.inputs,e=a.outputs,f=a.node_tree_name,g=0;g<b.length;g++){var h=d[g],m=b[g];if(!h||h.default_value instanceof Array!=m)return ca.warn('B4W Warning: Wrong inputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1}for(g=0;g<c.length;g++)if(b=e[g],d=c[g],!b||b.default_value instanceof Array!=d)return ca.warn('B4W Warning: Wrong outputs for custom node group "'+a.name+'" of type: "',
f,'".Processing as general node group.'),!1;return!0}function q(a){var b=a.node_group.node_tree,d={},e;for(e in b)if("links"==e||"nodes"==e){d[e]=[];for(var f=0;f<b[e].length;f++){d[e][f]={};for(var g in b[e][f])if("links"==e){d[e][f][g]={};for(var h in b[e][f][g])d[e][f][g][h]=F(b[e][f][g][h])}else d[e][f][g]=F(b[e][f][g])}}else d[e]=F(b[e]);b=a.node_tree_name;if("B4W_REPLACE"==b||"B4W_LEVELS_OF_QUALITY"==b)e=B("Group input","GROUP_INPUT",[],a.inputs),f=B("Group output","GROUP_OUTPUT",a.outputs,
[]),g=null,g="B4W_REPLACE"==b||"B4W_LEVELS_OF_QUALITY"==b&&(qa.quality==ba.P_LOW||qa.vl)?{from_node:e,from_socket:e.outputs[1],to_node:f,to_socket:f.inputs[0]}:{from_node:e,from_socket:e.outputs[0],to_node:f,to_socket:f.inputs[0]},d.nodes=[e,f],d.links=[g];b=a.name;e=d.nodes;f=d.links;for(g=0;g<e.length;g++)e[g].name=H(e[g].type,b,e[g].name);for(g=0;g<f.length;g++)f[g].from_node.name=H(f[g].from_node.type,b,f[g].from_node.name),f[g].to_node.name=H(f[g].to_node.type,b,f[g].to_node.name);return{Ix:c(d,
a.node_group.uuid,!0),Jx:d.links}}function F(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?X.Ah(a):a}function k(a){L[a]||(L[a]=0);var b=a+L[a],b=b.replace(/ /g,"_").replace(/\//g,"_");L[a]++;return b}function x(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";
case "Global":return"GEOMETRY_GL";default:return null}}}function v(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return A(e)}return null}function G(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return A(e)}return null}function A(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=X.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,Gd:d,yb:a}}function C(a,b,c){return{name:a,identifier:b,Gd:!1,yb:c}}function M(a){for(var b=[],
c=0;c<a.inputs.length;c++){var d=A(a.inputs[c]);d.yb.length&&d.yb.splice(3);b.push(d)}return b}function y(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=A(a.outputs[c]);b.push(d)}return b}function I(a,b,c){b=null===b||void 0===b?null:aa.s(b,c);return{name:a,value:b}}function H(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"*"+c}function Y(a){var b=[];O.R(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function J(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.Ix,
f=c[d].data.Jx;if(!e)return!1;O.R(e,function(b,c){O.Gk(a,O.np(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);N(c[d],b,a)}return!0}function D(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function T(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var f=c[e],g=null,h=0;h<b.length;h++)if(f.from_socket.identifier==b[h].to_socket.identifier){g=b[h];break}g?(f.from_node=g.from_node,
f.from_socket=g.from_socket):d.push(f)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function K(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function R(a,b,c,d){for(var e=0;e<d.length;e++){for(var f=d[e],g,h=0;h<c.F.length;h++)if(f.from_socket.identifier==c.F[h].identifier){g=c.F[h].yb;break}for(var h=f,m=b,k=g,n=l(h.to_node,m),r=0;r<n.length;r++)for(var s=O.Ra(m,n[r]),q=0;q<s.F.length;q++)if(s.F[q].identifier==h.to_socket.identifier){s.F[q].yb=
k;break}f=a.indexOf(f);-1!=f&&a.splice(f,1)}}function N(a,b,c){for(var d=a.name,e=[],f=[],g=[],h=[],m=0;m<b.length;m++){var k=b[m];D(k.from_node,d,k,e,g,h);D(k.to_node,d,k,f,g,h)}f=T(b,f,g);e=T(b,h,e);K(b,f);R(b,c,a,f);if(e.length){var l;O.R(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(l=b)});R(b,c,l,e)}}var ca=p("__print"),O=p("__graph"),aa=p("__shaders"),X=p("__util"),ba=p("__config"),w=p("vec3");p("vec4");var ga=p("mat3"),ka=p("mat4"),L={},S={},W={},ja=0;new Float32Array(4);
var qa=ba.p;a.Au=c;a.Bu=function(a){var b=[],c={};L={};var d=O.Xm(a);O.R(d,function(a,d){var e;e=[];for(var f=[],g=[],h=[],m=[],l=[],n=0;n<d.F.length;n++){var r=d.F[n];if(r.Gd)e.push(null),f.push(null);else{e.push(k("in_"+d.type+"_"+r.identifier));var s=aa.s(r.yb,0);qa.kr&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==r.identifier||"Color2"==r.identifier||"Fac"==r.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==r.identifier||"Value_001"==r.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==
r.identifier)&&(r=s,r=r.replace(/(,)/g,"$1 "),r=r.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),r=r.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),s=r=r.replace(/\s+/g,""));f.push(s)}}for(n=0;n<d.Ta.length;n++)r=d.Ta[n],r.Gd?g.push(null):g.push(k("out_"+d.type+"_"+r.identifier));for(n=0;n<d.H.length;n++)r=d.H[n],h.push(r.name),m.push(r.value);for(n=0;n<d.Di.length;n++)l.push(d.Di[n].name);e={id:d.type,F:e,Rp:f,Ta:g,H:h,Wj:m,Di:l,Fh:d.Fh};b.push(e);c[a]=
e});O.Je(d,function(a,b,e){var f=O.Ra(d,a);O.Ra(d,b);var g=f.Ta[e[0]];a=c[a].Ta;b=c[b].F;f=a[e[0]]||k("out_"+f.type+"_"+g.identifier);a[e[0]]=f;b[e[1]]=f});return b};a.cleanup=function(){for(var a in S)delete S[a];for(var b in W)delete W[b];ja=0}};b4w.module.__animation=function(a,p){function c(a,b){var c=a.C[b];c&&c.sl&&c.Jh&&(c.Jh=!1,c.sl(a))}function b(a,b,c){c=a.C[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.ac=d;c.ld=b.name;for(e=d=0;e<a.data.b4w_vertex_anim.length;e++){var f=a.data.b4w_vertex_anim[e];if(f==b)break;else d+=f.frame_end-f.frame_start+1}c.Xr=d}function e(a,b,c){a=a.C[c];a.type=50;a.ld=b.name;c=b.settings;a.start=c.frame_start;a.length=c.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=c.lifetime);
a.Qc=b}function d(a){return a.replace(/_B4W_BAKED$/,"")}function l(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:aa.ga("Wrong animation behavior")}}function g(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&d.animation_data&&(d=d.animation_data,d.action&&b.push(d.action))}return b}function f(a){return aa.is_mesh(a)&&a.d.vk?!0:!1}function r(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==
c.type)return c.object}return null}function h(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function n(a,b,d){F(a,b,d);c(a,d);a.d.Zd&&(v(a,b),x(a,b))}function m(a,b,c){var d=b.frame_range,e=b.d,f=a.C[c];f.ld=b.name;f.Gn=d;f.Bt=e.Rx;f.zt=e.du;f.start=d[0];f.length=d[1]-d[0];f.ac=d[0];d=aa.nf(e.Yi);if(aa.sf(a)&&d){f.type=10;var g=s(a,b);g||(g=G(a,b,u(a)),a.th.push(b,g));f.g=g.g;f.ra=g.ra;var f=a.d,g=f.hk,h=a.C[c],e=h.Hm,m;a:{m=f.nr;for(var k=0;k<m.length;k+=2)if(b==m[k]){m=
m[k+1];break a}m=null}if(m)h.Hm=m;else{for(h=0;h<g.length;h++)m=G(a,b,g[h].oc),e.push(m);f.nr.push(b,e)}f.Zd&&(b=f.pk,c>b[1]?(f=b[1],b[1]=c,b[0]=f):c>b[0]&&c<b[1]&&(b[0]=c),B(a))}else if(N.Hd(a)&&(e.H.volume||e.H.pitch))f.volume=e.H.volume||null,f.pitch=e.H.pitch||null,f.type=40;else if("MESH"==a.type&&q(b)){f.type=70;e=s(a,b);if(!e){e=[];h=[];m=b.d;k=a.d.ai;for(g in m.H)for(var l=b.name+"_"+g,n=0;n<k.length;n+=2)if(l==k[n]){e.push(k[n+1]);h.push(m.H[g]);break}e={dA:e,eA:h};a.th.push(b,e)}f.mq=e.dA;
f.nq=e.eA}else if(g=e.H.tsr){f.type=20;e=s(a,b);if(!e){e=b.d.qq;h=[];m=[];for(k=0;k<e;k++)h.push(g.subarray(8*k,8*k+4)),m.push(g.subarray(8*k+4,8*k+8));e={g:h,ra:m};a.th.push(b,e)}f.g=e.g;f.ra=e.ra;D.zg(a)&&D.Yz(a,f.g,f.ra)}else K.warn('B4W Warning: Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),f.type=60;aa.sf(a)&&!d&&z(a,c)}function s(a,b){for(var c=a.th,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function B(a){var b=a.d.pk;if(-1!=b[0]&&-1!=b[1]){var c=a.C;
a=c[b[1]].ac;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.ac;d=Math.floor(a);b.ac=d+e}}function z(a,b){var c=a.d.pk,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.C;0<=d;d--){var f=e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function u(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var e=b[d].name;c[e]={co:d,Eh:d,tm:aa.Fl(a,"name",e),Zr:-1}}return c}function q(a){a=a.d;for(var b in a.H)if(-1!=b.indexOf("nodes"))return!0;return!1}function F(a,b,c){if((c=a.C[c])&&
(c.play||0==b)){var d=a.d,e=c.ac,f=c.start,g=c.length,e=e+c.speed*b*ba.Ba,h=c.type,m=c.speed;if(0<=m&&e>=f+g||0>m&&e<f)switch(c.Jh=!0,c.behavior){case 10:e=0<=m?(e-f)%g+f:f+g-1E-6;break;case 20:e=0<=m?f:f+g-1E-6;c.play=!1;break;case 30:e=0<=m?f+g-1E-6:f,c.play=!1}c.ac=e;switch(h){case 10:if(!d.Zd){e=k(c,e,w);b=e[0];f=e[1];e=e[2];d.dc=c.ra[b];d.cc=c.ra[f];d.lc=c.g[b];d.kc=c.g[f];d.kf=e;d=d.hk;c=c.Hm;for(g=0;g<d.length;g++)h=d[g],m=c[g],h.dc=m.ra[b],h.cc=m.ra[f],h.lc=m.g[b],h.kc=m.g[f],h.kf=e;ca.v(a)}break;
case 20:h=e=k(c,e,w);(d=ga)||(d=new Float32Array(4));var f=h[0],g=h[1],h=h[2],m=c.g,l=m[f][1],n=m[f][2],r=m[g][1],s=m[g][2];d[0]=(1-h)*m[f][0]+h*m[g][0];d[1]=(1-h)*l+h*r;d[2]=(1-h)*n+h*s;f=e;(g=L)||(g=new Float32Array(4));h=c.ra;X.slerp(h[f[0]].subarray(0,4),h[f[1]].subarray(0,4),f[2],g);f=g;g=e[2];h=c.g;e=(1-g)*h[e[0]][3]+g*h[e[1]][3];c.Ym&&(g=ka,ca.get_translation(a,g),aa.smooth_v(d,g,b,c.Ym,d));c.vm&&(g=S,ca.get_rotation(a,g),aa.qr(f,g,b,c.vm,f));ca.set_translation(a,d);ca.set_rotation(a,f);ca.set_scale(a,
e);ca.v(a);T.sync_transform(a);break;case 30:(a=w)||(a=Array(3));f=e-c.start;0>f&&(f=0);f>=c.length&&(f=c.length);b=Math.floor(f);e=b+1;f-=b;10!=c.behavior&&e==c.length&&(e=b-=1,f=1);c=c.Xr;a[0]=b+c;a[1]=e+c;a[2]=f;e=w;d.dn=e[0];d.Wr=e[2];break;case 40:e=k(c,e,w);b=e[0];d=e[1];e=e[2];c.volume&&N.set_volume(a,(1-e)*c.volume[b]+e*c.volume[d]);c.pitch&&N.playrate(a,(1-e)*c.pitch[b]+e*c.pitch[d]);break;case 50:D.My(c.Qc,e/ba.Ba);break;case 70:e=k(c,e,w);b=e[0];d=e[1];e=e[2];f=c.nq;c=c.mq;for(g=0;g<c.length;g++)h=
f[g],a.d.Ff[c[g]]=(1-e)*h[b]+e*h[d];break;case 60:break;default:throw"Unknown animation type:"+h;}}}function k(a,b,c){c||(c=Array(3));var d=a.Gn[0],e=a.Gn[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.Bt;e=Math.floor(b);a=a.zt[e]?b-e:0;c[0]=e;c[1]=e+1;c[2]=a;return c}function x(a,b){var c=a.d,d=c.Yd,e=c.pk,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var g=a.C[f];if(g.play||0==b)var h=k(g,g.ac,w),m=h[0],l=h[1],h=h[2],n=g.ra[m],r=g.ra[l],m=g.g[m],l=g.g[l];else d=1}else d=1;e=a.C[e];if(e.play||0==b)var h=k(e,e.ac,w),
s=h[0],q=h[1],h=h[2];else if(-1!=f&&g.play)d=0;else return;f=e.ra[s];g=e.ra[q];s=e.g[s];e=e.g[q];if(1==d)c.dc.set(f),c.cc.set(g),c.lc.set(s),c.kc.set(e);else if(0==d)c.dc.set(n),c.cc.set(r),c.lc.set(m),c.kc.set(l);else{for(q=0;q<n.length;q+=4){for(var v=L,D=S,B=0;4>B;B++)v[B]=n[q+B],D[B]=f[q+B];X.slerp(v,D,d,v);for(B=0;4>B;B++)c.dc[q+B]=v[B];for(B=0;4>B;B++)v[B]=r[q+B],D[B]=g[q+B];X.slerp(v,D,d,v);for(B=0;4>B;B++)c.cc[q+B]=v[B]}aa.Zn(m,s,d,c.lc);aa.Zn(l,e,d,c.kc)}ca.v(a);d=c.hk;n=c.jq;for(q=0;q<d.length;q++){r=
d[q];m=n[q];for(l=0;l<m.length;l+=2)for(s=m[l],f=m[l+1],g=0;4>g;g++)r.dc[s+g]=c.dc[f+g],r.cc[s+g]=c.cc[f+g],r.lc[s+g]=c.lc[f+g],r.kc[s+g]=c.kc[f+g];r.kf=h}}}function v(a,b){var c=a.d,d=c.Yd,e=c.Fk;if(0!=e){var d=c.Ek-d,f=e*b;aa.sign(d)==aa.sign(e)&&Math.abs(f)<Math.abs(d)?c.Yd+=f:(c.Yd=c.Ek,c.Fk=0)}}function G(a,b,c){for(var d=a.pose.bones,e=[],f=[],g=b.d.qq,h=0;h<g;h++){for(var m=0;m<d.length;m++){var k=d[m],l=O.create(),n=b.d.Yi[k.name];n&&O.copy(n.subarray(8*h,8*h+8),l);k.En=l;k.Oi=!1}m=A(a,c);
e.push(m.g);f.push(m.ra)}return{g:e,ra:f}}function A(a,b){var c=[],d=[],e=a.pose.bones,f=new Float32Array(4),g=new Float32Array(4),h;for(h in b){var m=b[h],k=m.Eh,l=e[m.tm],m=f,n=g,r=l.st,s=r[r.length-1],q=s.Bk;s.Oi||O.identity(q);for(s=r.length-1;0<=s;s--){var l=r[s],v=l.Bk;if(l.Oi)q=v;else{var B=l.Fn,D=l.En;O.invert(B,W);O.multiply(D,W,W);O.multiply(B,W,W);O.multiply(q,W,v);q=v;l.Oi=!0}}l=l.Bk;m[0]=l[0];m[1]=l[1];m[2]=l[2];m[3]=l[3];n[0]=l[4];n[1]=l[5];n[2]=l[6];n[3]=l[7];X.normalize(n,n);for(m=
0;4>m;m++)n=4*k+m,c[n]=f[m],d[n]=g[m]}c=new Float32Array(c);d=new Float32Array(d);return{g:c,ra:d}}function C(a,b,c,d,e,f,g){var h=a+(b-a)/2,m=M(h,d,e,f,g)-c;return.02>Math.abs(m)?h:0<m?C(a,h,c,d,e,f,g):C(h,b,c,d,e,f,g)}function M(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function y(a,b){a.C||(a.C=[null,null,null,null,null,null,null,null]);a.C[b]={type:null,ld:null,ra:null,g:null,Hm:[],play:!1,behavior:20,ac:0,start:0,length:0,Ym:0,vm:0,Jh:!1,Xr:null,speed:1,volume:null,pitch:null,
nq:[],mq:[]};a.th=a.th||[];-1==ja.indexOf(a)&&ja.push(a)}function I(a,b){ca.v(a);T.sync_transform(a);n(a,0,b)}function H(a,c,d){d=d||0;if(aa.is_mesh(a)){var f=aa.keysearch("name",c,a.data.b4w_vertex_anim);if(f)return y(a,d),b(a,f,d),I(a,d),!0;if((f=aa.keysearch("name",c,a.particle_systems))&&"EMITTER"==f.settings.type)return y(a,d),e(a,f,d),I(a,d),!0}if(f=aa.keysearch("name",c,qa)||aa.keysearch("name",c+"_B4W_BAKED",qa)){if(!aa.nf(f.fcurves))return K.error('No fcurves in action "'+f.name+'"'),!1;
y(a,d);m(a,f,d);I(a,d);return!0}K.error('Unsupported object: "',a.name,'" or animation name: "',c,'"');return!1}function Y(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&d.animation_data)return!0}return!1}var J=p("__config"),D=p("__particles"),T=p("__physics"),K=p("__print"),R=p("__scenes"),N=p("__sfx"),ca=p("__transform"),O=p("__tsr"),aa=p("__util");p("mat4");var X=p("quat");p("vec4");var ba=J.kd;a.OBJ_ANIM_TYPE_ARMATURE=
10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_STATIC=60;a.OBJ_ANIM_TYPE_MATERIAL=70;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var w=Array(3),ga=new Float32Array(3),ka=new Float32Array(3),L=new Float32Array(4),S=new Float32Array(4),W=new Float32Array(8);new Float32Array(16);var ja=[],qa=[];a.frame_to_sec=function(a){return a/
ba.Ba};a.update=function(a){for(var b=0;b<ja.length;b++){for(var d=ja[b],e=0;8>e;e++)F(d,a,e);d.d.Zd&&(v(d,a),x(d,a))}for(b=0;b<ja.length;b++)for(d=ja[b],e=0;8>e&&d.C;e++)c(d,e)};a.mw=function(){return qa};a.yw=function(a,b){var c=a.C[b];return c&&c.ld?d(c.ld):null};a.get_anim_names=function(a){var b=[];if(f(a))for(var c=0;c<a.data.b4w_vertex_anim.length;c++)b.push(a.data.b4w_vertex_anim[c].name);var e,c=[];for(e=0;e<qa.length;e++){var h=qa[e],m=h.d;aa.nf(h.d.Yi)?"ARMATURE"==a.type&&c.push(h):m.H.volume||
m.H.pitch?N.Hd(a)&&c.push(h):q(h)||c.push(h)}"MESH"==a.type&&(c=c.concat(g(a)));e=c;for(c=0;c<e.length;c++)b.push(d(e[c].name));if(D.zg(a)&&D.zj(a))for(c=0;c<a.particle_systems.length;c++)b.push(a.particle_systems[c].name);return b};a.oz=d;a.get_anim_type=function(a,b){var c=a.C[b];return c?c.type:null};a.apply_def=function(a){var c=0,d;d=[];var h=a.animation_data;if(h&&h.action){var k=aa.nf(h.action.d.Yi);"ARMATURE"!=a.type&&k||d.push(h.action)}N.Hd(a)&&a.data.animation_data&&a.data.animation_data.action&&
d.push(a.data.animation_data.action);"MESH"==a.type&&(d=d.concat(g(a)));for(h=0;h<d.length;h++)k=d[h],aa.nf(k.fcurves)?(y(a,c),m(a,k,c),I(a,c),a.C[c].behavior=l(a.b4w_anim_behavior),c++):K.error('No fcurves in action "'+k.name+'"');k=a.particle_systems;for(h=0;h<k.length;h++){var n=k[h],r=n.settings;"EMITTER"==r.type&&(y(a,c),e(a,n,c),I(a,c),a.C[c].behavior=l(a.b4w_anim_behavior),r.b4w_cyclic&&(a.C[c].behavior=10),c++)}f(a)?(y(a,c),b(a,a.data.b4w_vertex_anim[0],c),I(a,c),a.C[c].behavior=l(a.b4w_anim_behavior)):
d.length||D.zj(a)||(y(a,0),d=a.C[0],d.type=60,d.ld=a.name+"_STATIC",h=R.Hw(R.get_active()),d.start=h[0],d.length=h[1]-h[0]+1,I(a,c))};a.get_first_armature_object=r;a.play=function(a,b,c){h(a.C,c,function(a){a.play=!0;a.sl=b?b:null;a.Jh=!1});a.d.Zd&&B(a)};a.stop=function(a,b){h(a.C,b,function(a){a.play=!1;a.sl=null;a.Jh=!1})};a.is_play=function(a,b){var c=a.C[b];return c?c.play:!1};a.set_current_frame_float=function(a,b,c){var d=a.C;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.ac=b,n(a,0,c))}else if(e=
d[c])e.ac=b,n(a,0,c)};a.get_current_frame_float=function(a,b){var c=a.C[b];return c&&c.ac?c.ac:0};a.is_cyclic=function(a,b){var c=a.C[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){h(a.C,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.C[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){h(a.C,d,function(a){a.Ym=b||0;a.vm=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.C[c]=null;else a.C[b]=null;a.d.Zd&&z(a,b)};a.update_object_animation=
n;a.Cj=function(a){if("ARMATURE"==a.type||r(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||D.zg(a)&&D.zj(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||Y(a)?!0:!1};a.is_animated=function(a){return a.C?!0:!1};a.ku=u;a.ho=A;a.Dt=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);X.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?
(d=4,e=0==b?3:b-1):(d=-1<a.indexOf("scale")?3:0,e=0);return d+e}function d(a,b,c,e){if(-1<c.search(f)){a=b;c=c.split('"')[1];var h=g}else-1<c.indexOf("location")?(c="tsr",h=g):-1<c.indexOf("rotation_quaternion")?(c="tsr",h=g):-1<c.indexOf("scale")?(c="tsr",h=g):h=0;if(!a[c]){b=a;var m=c;if("object"==typeof h&&h.length)for(var k=h.length,l=new Float32Array(e*k),n=0;n<e;n++)for(var r=0;r<k;r++)l[n*k+r]=h[r];else if("number"==typeof h)for(l=new Float32Array(e),n=0;n<e;n++)l[n]=h;else throw"Wrong storage default value";
b[m]=l}return a[c]}a.d={};var e=a.d;e.Rx=1/ba.lf;var f=new RegExp(/pose.bones\[\".+\"\]/g),g=O.create(),h=a.fcurves,m={},k={},l=0,n;for(n in h){var r=h[n],s;for(s in r){var q=r[s].Yb;l||(l=q.length);for(var v=d(m,k,n,l),B=v.length/l,D=c(n,s|0),L=0;L<l;L++)v[L*B+D]=q[L]}}for(var p in m)"tsr"==p&&b(m[p],l);for(var u in k)b(k[u],l);e.H=m;e.Yi=k;e.du=a.rt;e.qq=l;qa.push(a)};a.qw=function(a,b){return(b-a)*ba.lf+1};a.Vt=function(a,b,c,d,e,f){var g,h,m=new Float32Array(2),k=new Float32Array(2),l=new Float32Array(2),
n=new Float32Array(2),r=b[1],s=b[2],q=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var v=0,B=0,D=null;e<=f;e++)if(e<r)for(var L=0;L<ba.lf;L++)c[v++]=s;else if(e>q)for(L=0;L<ba.lf;L++)c[v++]=a;else{var p=b[B],u=3;0===p&&(u+=2);0===D&&(u+=2);var z=2===p?0:1;if(b[B+1]==b[B+u+1])D=p,B+=u;else{L=0;e==b[B+1]&&(z&&(d[v]=1),c[v]=b[B+2],v++,L++);if(e==q)for(;L<ba.lf;L++)c[v++]=a;else for(m[0]=b[B+1],m[1]=b[B+2],0!==p?(k[0]=0,k[1]=0):0===D?(k[0]=b[B+5],k[1]=b[B+6]):(k[0]=b[B+3],k[1]=b[B+4]),0!==
p?(l[0]=0,l[1]=0):(l[0]=b[B+u+3],l[1]=b[B+u+4]),n[0]=b[B+u+1],n[1]=b[B+u+2];L<ba.lf;L++){var x=e+L/ba.lf;switch(p){case 0:g=m;h=k;var w=l,A=n,S=[],y=[],W=void 0,T=void 0,G=void 0,W=void 0;S[0]=g[0]-h[0];S[1]=g[1]-h[1];y[0]=A[0]-w[0];y[1]=A[1]-w[1];G=A[0]-g[0];W=Math.abs(S[0]);T=Math.abs(y[0]);0!=W+T&&W+T>G&&(W=G/(W+T),h[0]=g[0]-W*S[0],h[1]=g[1]-W*S[1],w[0]=A[0]-W*y[0],w[1]=A[1]-W*y[1]);z&&(d[v]=1);c[v]=M(C(0,1,x,m[0],k[0],l[0],n[0]),m[1],k[1],l[1],n[1]);v++;break;case 1:h=m[0];w=m[1];g=A=(n[1]-w)/
(n[0]-h);h=w-A*h;z&&(d[v]=1);c[v]=g*x+h;v++;break;case 2:z&&(d[v]=1);c[v]=b[B+2];v++;break;default:throw"Unknown keyframe intepolation mode: "+p;}}e+1==b[B+u+1]&&(D=p,B+=u)}}};a.zB=function(a){for(var b=0;b<a.length;b++)if(a[b].KA)return a[b];return!1};a.apply=H;a.get_slot_num_by_anim=function(a,b){for(var c=a.C,e=0;e<c.length;e++){var f=c[e];if(f&&d(f.ld)==d(b))return e}return-1};a.ow=function(a,b){var c=a.C[b];return c&&c.ld?d(c.ld):null};a.remove=function(a){a.C=null;a=ja.indexOf(a);-1!=a&&ja.splice(a,
1)};a.fy=function(a){for(var b=qa.length-1;0<=b;b--)qa[b].tt==a&&qa.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.C)return H(a,b,0)?0:-1;for(var c=0;c<a.C.length;c++)if(!a.C[c])return H(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.d.Fk=(b-a.d.Yd)/c;a.d.Ek=b};a.set_speed=function(a,b,c){h(a.C,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.C[b].speed};a.get_anim_start_frame=function(a,b){return a.C[b].start};a.get_anim_length=function(a,b){return a.C[b].length};
a.Ml=Y;a.cleanup=function(){ja.length=0;qa.length=0};a.Ov=function(a,b){var c=a[b],d=(c[0]||c[1]||c[2]).Yb.length,e=L,f=ga,g=Boolean(c[0]);g||(c[0]={Yb:new Float32Array(d)});var h=Boolean(c[1]);h||(c[1]={Yb:new Float32Array(d)});var m=Boolean(c[2]);m||(c[2]={Yb:new Float32Array(d)});c[3]={Yb:new Float32Array(d)};for(var k=0;k<d;k++)f[0]=g?c[0].Yb[k]:0,f[1]=h?c[1].Yb[k]:0,f[2]=m?c[2].Yb[k]:0,aa.euler_to_quat(f,e),c[0].Yb[k]=e[3],c[1].Yb[k]=e[0],c[2].Yb[k]=e[1],c[3].Yb[k]=e[2];d=b.replace("euler","quaternion");
a[d]=c;delete a[b]}};b4w.module.__time=function(a,p){p("__util");var c=0,b=0,e=[],d=0;a.fr=function(a){c=a;b=performance.now();for(a=0;a<e.length;a++){var d=e[a];c>d.Hv&&(e.splice(a,1),a--,d.callback())}};a.wg=function(){return c};a.gr=function(a,g){var f;d++;f=d;e.push({id:f,callback:a,Hv:c+(performance.now()-b+g)/1E3});return f};a.cj=function(a){for(var b=0;b<e.length;b++)if(e[b].id==a){e.splice(b,1);break}};a.reset=function(){b=c=0;d=e.length=0}};b4w.module.__transform=function(a,p){function c(a){var m=a.d;d.Mz(a,k);e.Kz(a);if("CAMERA"==a.type&&(e.yu(a),m.P==e.MS_TARGET_CONTROLS)){var s=n.quat_to_dir(m.quat,n.AXIS_Z,u);m.lk=0<s[1]}var s=m.g,q=m.scale,B=m.quat;h.ti(s,q,B,m.Sd);var p=m.L;z.identity(p);z.fromQuat(B,p);"CAMERA"!=a.type&&n.ry(p,q,p);p[12]=s[0];p[13]=s[1];p[14]=s[2];z.invert(p,m.Sp);a.C&&g.zj(a)&&g.Nz(a);m.Lb&&m.Na&&(b.Qk(m.Lb,p,m.Na),b.Sk(m.yc,p,m.ub),b.Rk(m.Ze,m.Sd,m.$e),m.Vb&&f.Cm(f.get_active()));switch(a.type){case "SPEAKER":r.fz(a,
k);break;case "CAMERA":e.Pr(a);f.Z()&&f.Cl(f.get_active())==a&&r.rx(f.get_active(),s,B,k);break;case "LAMP":l.Pz(a);f.Z()&&f.Vf(a,f.get_active());break;case "EMPTY":a.field&&f.Rr(a)}"LAMP"!=a.type&&"CAMERA"!=a.type||!f.Z()||(m=f.get_active(),f.Cm(m),f.vy(m));a=a.Wd;for(m=0;m<a.length;m++)c(a[m])}var b=p("__boundings"),e=p("__camera"),d=p("__constraints"),l=p("__lights"),g=p("__particles"),f=p("__scenes"),r=p("__sfx"),h=p("__tsr"),n=p("__util"),m=p("vec3"),s=p("quat"),B=p("mat3"),z=p("mat4"),u=new Float32Array(3),
q=new Float32Array(4),F=new Float32Array(9),k=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){k=a};a.set_translation=function(a,b){d.Dd(a)==d.fd?h.Ny(b,d.Cd(a)):a.d.g.set(b)};a.get_translation=function(a,b){d.Dd(a)==d.fd?m.copy(h.Ap(d.Cd(a)),b):m.copy(a.d.g,b)};a.set_rotation=function(a,b){d.Dd(a)==d.fd?h.Fm(b,d.Cd(a)):a.d.quat.set(b)};a.get_rotation=function(a,b){d.Dd(a)==d.fd?s.copy(h.wp(d.Cd(a)),b):s.copy(a.d.quat,b)};a.set_rotation_euler=function(a,b){if(d.Dd(a)==d.fd){var c=n.euler_to_quat(b,
q);h.Fm(c,d.Cd(a))}else n.euler_to_quat(b,a.d.quat)};a.set_scale=function(a,b){d.Dd(a)==d.fd?h.set_scale(b,d.Cd(a)):a.d.scale=b};a.get_scale=function(a){return d.Dd(a)==d.fd?h.get_scale(d.Cd(a)):a.d.scale};a.Nw=function(a,b){if(d.Dd(a)==d.fd)h.copy(d.Cd(a),b);else{var c=a.d;h.ti(c.g,c.scale,c.quat,b)}};a.hr=function(a,b){if(d.Dd(a)==d.fd)h.copy(b,d.Cd(a));else{var c=a.d;c.g[0]=b[0];c.g[1]=b[1];c.g[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}};a.get_object_size=
function(a){var b=a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(b=a.d,m.copy(b.ub.A,c)):(b=a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,m.transformMat4(c,b.L,c));return c};a.move_local=function(a,b,c,d){a=a.d;var e=u;e[0]=b;e[1]=c;e[2]=d;b=B.fromMat4(a.L,F);m.transformMat3(e,
b,e);m.add(a.g,e,a.g)};a.v=c;a.distance=function(a,b){return m.dist(a.d.g,b.d.g)};a.Nx=function(a,b){return m.dist(a.d.g,b)};a.get_object_bounding_box=function(a){return{max_x:a.d.Na.max_x,min_x:a.d.Na.min_x,max_y:a.d.Na.max_y,min_y:a.d.Na.min_y,max_z:a.d.Na.max_z,min_z:a.d.Na.min_z}}};b4w.module.__tsr=function(a,p){function c(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3]}function b(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],l=b[4],q=b[5],p=b[6];b=b[7];var k=a[0]*g,x=a[1]*g,v=a[2]*g;a=b*k+q*v-p*x;var g=b*x+p*k-l*v,G=b*v+l*x-q*k,k=-l*k-q*x-p*v;c[0]=a*b+k*-l+g*-p-G*-q;c[1]=g*b+k*-q+G*-l-a*-p;c[2]=G*b+k*-p+a*-q-g*-l;c[0]+=d;c[1]+=e;c[2]+=f;return c}var e=p("__util"),d=p("vec3"),l=p("quat");p("mat4");var g=new Float32Array(3),f=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.lg=function(a,b,d,e){e||(e=new Float32Array(8));c(a,b,d,e);return e};a.ti=c;a.Ny=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.set_scale=function(a,b){b[3]=a};a.Oy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.Fm=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.Ap=function(a){return a.subarray(0,
3)};a.get_scale=function(a){return a[3]};a.wp=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],e=a[1],g=a[2];f[0]=a[4];f[1]=a[5];f[2]=a[6];f[3]=a[7];l.invert(f,f);var p=f[0],u=f[1],q=f[2],F=f[3],d=d*c,e=e*c,k=g*c,g=F*d+u*k-q*e,x=F*e+q*d-p*k,v=F*k+p*e-u*d,d=-p*d-u*e-q*k;b[0]=-(g*F+d*-p+x*-q-v*-u);b[1]=-(x*F+d*-u+v*-p-g*-q);b[2]=-(v*F+d*-q+g*-u-x*-p);b[3]=c;b[4]=p;b[5]=u;b[6]=q;b[7]=F;return b};a.lp=function(a,b){var d=e.Ef(a,g),m=e.Lj(a),l=e.matrix_to_quat(a,
f);c(d,m,l,b);return b};a.multiply=function(a,c,d){b(c,a,d);d[3]=a[3]*c[3];var e=a[4],f=a[5],g=a[6];a=a[7];var l=c[4],p=c[5],q=c[6];c=c[7];d[4]=e*c+a*l+f*q-g*p;d[5]=f*c+a*p+g*l-e*q;d[6]=g*c+a*q+e*p-f*l;d[7]=a*c-e*l-f*p-g*q;return d};a.xi=b;a.ok=function(a,b,c,d){d||(d=0);var e=a.length,f=b[0],g=b[1],l=b[2],q=b[3],p=b[4],k=b[5],x=b[6];b=b[7];for(var v=0;v<e;v+=3){var G=a[v]*q,A=a[v+1]*q,C=a[v+2]*q,M=b*G+k*C-x*A,y=b*A+x*G-p*C,I=b*C+p*A-k*G,G=-p*G-k*A-x*C;c[d+v]=M*b+G*-p+y*-x-I*-k;c[d+v+1]=y*b+G*-k+
I*-p-M*-x;c[d+v+2]=I*b+G*-x+M*-k-y*-p;c[d+v]+=f;c[d+v+1]+=g;c[d+v+2]+=l}};a.Kr=function(a,b,c,d){d||(d=0);var e=a.length,f=b[3],g=b[4],l=b[5],q=b[6];b=b[7];for(var p=0;p<e;p+=3){var k=a[p]*f,x=a[p+1]*f,v=a[p+2]*f,G=b*k+l*v-q*x,A=b*x+q*k-g*v,C=b*v+g*x-l*k,k=-g*k-l*x-q*v;c[d+p]=G*b+k*-g+A*-q-C*-l;c[d+p+1]=A*b+k*-l+C*-g-G*-q;c[d+p+2]=C*b+k*-q+G*-l-A*-g}};a.nk=function(a,b,c){var d=b[3],e=b[4],f=b[5],g=b[6];b=b[7];var l=a[0]*d,q=a[1]*d,p=a[2]*d;a=b*l+f*p-g*q;var d=b*q+g*l-e*p,k=b*p+e*q-f*l,l=-e*l-f*q-
g*p;c[0]=a*b+l*-e+d*-g-k*-f;c[1]=d*b+l*-f+k*-e-a*-g;c[2]=k*b+l*-g+a*-f-d*-e};a.Lr=function(a,b,c,d){d||(d=0);var e=a.length,f=b[3],g=b[4],l=b[5],q=b[6];b=b[7];for(var p=0;p<e;p+=4){var k=a[p]*f,x=a[p+1]*f,v=a[p+2]*f,G=b*k+l*v-q*x,A=b*x+q*k-g*v,C=b*v+g*x-l*k,k=-g*k-l*x-q*v;c[d+p]=G*b+k*-g+A*-q-C*-l;c[d+p+1]=A*b+k*-l+C*-g-G*-q;c[d+p+2]=C*b+k*-q+G*-l-A*-g;c[d+p+3]=a[p+3]}};a.translate=function(a,b,c){var d=a[3],e=a[4],f=a[5],g=a[6],l=a[7],q=b[0]*d,p=b[1]*d,k=b[2]*d;b=l*q+f*k-g*p;var d=l*p+g*q-e*k,x=
l*k+e*p-f*q,q=-e*q-f*p-g*k;c[0]=a[0]+b*l+q*-e+d*-g-x*-f;c[1]=a[1]+d*l+q*-f+x*-e-b*-g;c[2]=a[2]+x*l+q*-g+b*-f-d*-e;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.dC=function(a,b,c,e){e||(e=new Float32Array(8));d.lerp(a.subarray(0,3),b.subarray(0,3),c,e.subarray(0,3));var f=a[3];e[3]=f+c*(b[3]-f);l.slerp(a.subarray(4),b.subarray(4),c,e.subarray(4));return e};a.wB=function(a,b,c,d){d||(d=new Float32Array(8));var e=a.subarray(0,3),f=b.subarray(0,3),g=d.subarray(0,3);g[0]=f[0]*(c+1)-e[0]*
c;g[1]=f[1]*(c+1)-e[1]*c;g[2]=f[2]*(c+1)-e[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);e=d.subarray(4);e[0]=b[0]*(c+1)-a[0]*c;e[1]=b[1]*(c+1)-a[1]*c;e[2]=b[2]*(c+1)-a[2]*c;e[3]=b[3]*(c+1)-a[3]*c;l.normalize(e,e);return d};a.ex=function(a,b,c,d,e){var f=a.subarray(0,3),g=e.subarray(0,3);g[0]=f[0]+b*c[0];g[1]=f[1]+b*c[1];g[2]=f[2]+b*c[2];e[3]=a[3];a=a.subarray(4);e=e.subarray(4);c=d[0];f=d[1];d=d[2];var g=a[0],p=a[1],q=a[2],F=a[3];e[0]=.5*(c*F+f*q-d*p);e[1]=.5*(f*F+d*g-c*q);e[2]=.5*
(d*F+c*p-f*g);e[3]=.5*(-c*g-f*p-d*q);e[0]=a[0]+e[0]*b;e[1]=a[1]+e[1]*b;e[2]=a[2]+e[2]*b;e[3]=a[3]+e[3]*b;l.normalize(e,e)}};b4w.module.__util=function(a,p){function c(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function b(a,c){var d=a instanceof Array?[]:{},e;for(e in a)d[e]=!a[e]||"object"!=typeof a[e]||-1!=c.indexOf(a[e])||a[e]instanceof Float32Array?a[e]:b(a[e],c);return d}function e(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function d(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function l(a,b){var c=b;switch(typeof a){case "number":return g(a,
c);case "string":return f(a,c);case "boolean":return g(a|0,c);case "function":case "undefined":return g(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(d=0;d<a.length;d++)c=g(a[d],c);else if(d)for(d=0;d<a.length;d++)c=l(a[d],c);else for(var e in a)c=l(a[e],c)}else c=g(0,c)}return c}function g(a,b){var c=b;D[0]=a;c=(c<<5)-c+T[0];c&=c;c=(c<<5)-c+T[1];return c&c}function f(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),
c&=c;return c}function r(a){return(34*a+1)*a%289}function h(a){return a-Math.floor(a)}function n(a){return m((34*a+5)*a)}function m(a){return a-289*Math.floor(a/289)}function s(a){return a-7*Math.floor(a/7)}function B(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!z(a[c],b[c]))return!1}else if(d){if(a.length!=
b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!z(a[f],b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function z(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return B(a,b);default:return!0}}var u=p("__print"),q=p("vec3"),F=p("vec4"),k=p("quat"),x=p("mat3"),v=p("mat4"),G=0,A={},C=new Float32Array(3),M=new Float32Array(3),y=new Float32Array(4),I=new Float32Array(4),
H=new Float32Array(9),Y=new Float32Array(16),J=new Float32Array(16),D=new Float64Array(1),T=new Uint32Array(D.buffer),K=new Float32Array([0,0,0]),R=new Float32Array([0,0,0,1]),N=new Float32Array([0,0,0,1,0,0,0,1]),ca=new Float32Array([1,0,0]),O=new Float32Array([0,1,0]),aa=new Float32Array([0,0,1]),X=new Float32Array([-1,0,0]),ba=new Float32Array([0,-1,0]),w=new Float32Array([0,0,-1]),ga=Math.floor(44488.07041494893);a.qt=K;a.lt=R;a.HA=N;a.AXIS_X=ca;a.AXIS_Y=O;a.AXIS_Z=aa;a.AXIS_MX=X;a.AXIS_MY=ba;
a.AXIS_MZ=w;a.keyfind=c;a.Rv=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Fz=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.tu=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.Wt=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.sign=function(a){return 0<a?1:0>a?-1:0};a.nC=function(a,
b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.mC=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.Fl=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.Rt=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.eB=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<
a.length;d++)if(c==a[d])return!1;return!0};a.BC=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.zC=function(a,b){var d=c("name",b,a);1<d.length&&u.error("obj_by_name(): name resolution ambiguity");return d};a.AC=function(a,b){var d=c("name",b,a),e=d.length;1<e&&u.error("obj_by_name(): name resolution ambiguity");if(0>=e)return[];for(var f=[],g=0;g<e;g++){var h=d[g];if("EMPTY"==h.type&&h.dupli_group)for(var h=h.dupli_group.objects,m=0;m<h.length;m++)f.push(h[m])}return d=
d.concat(f)};a.Cz=function(a,b,c,d){d||(d=new Float32Array(16));v.identity(d);d[12]=a;d[13]=b;d[14]=c};var ka=1;a.$x=function(){ka=(69069*ka+5)%Math.pow(2,32);return Math.round(ka/65536)%32768/32767};a.mz=function(a){ka=a};a.tc=function(a){var b=a[0]%ga*48271-3399*Math.floor(a[0]/ga);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.Bj=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/
2),g=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.Fv=function(a){var b=x.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),g=Math.sin(a[1]);a=Math.sin(a[2]);var h=c*e,m=c*a,l=f*e,k=f*a;b[0]=d*e;b[1]=d*a;b[2]=-g;b[3]=g*l-m;b[4]=g*k+h;b[5]=d*f;b[6]=g*h+k;b[7]=g*m-l;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=e*e,h=c*d+e*f;.499999<h?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=
Math.PI/2):-.499999>h?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*g),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*g),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));q.transformQuat(b,a,c);return c};a.rB=function(a,b,c){c||(c=new Float32Array(4));a=q.normalize(a,C);var d=q.dot(b,a);a=q.cross(b,a,M);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.Dz=
function(a,b,c,d){d||(d=new Float32Array(4));q.transformQuat(c,b,d);d[3]=-q.dot(a,d)};a.xv=function(a){var b=a.d.quat;switch(a.type){case "CAMERA":C[0]=0;C[1]=-1;C[2]=0;q.transformQuat(C,b,C);M[0]=0;M[1]=0;M[2]=-1;break;case "MESH":C[0]=0;C[1]=0;C[2]=1;q.transformQuat(C,b,C);M[0]=0;M[1]=0;M[2]=1;break;case "EMPTY":C[0]=0,C[1]=1,C[2]=0,q.transformQuat(C,b,C),M[0]=0,M[1]=1,M[2]=0}C[1]=0;q.normalize(C,C);a=q.dot(C,M);return Math.acos(a)*(0<-C[0]*M[2]?-1:1)};a.Zn=function(a,b,c,d){if(0!=c){d=d||[];for(var e=
0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.VC=function(){G++;return G.toString(16)};a.qk=function(a){A[a]||(A[a]=0);var b=a+A[a];A[a]++;return b};a.td=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.wb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,I:0,ca:null,u:[],D:b}};a.Pp=function(a){return{name:a,type:"MESH",modifiers:[],particle_systems:[],data:null}};
a.cf=function(a){return JSON.parse(JSON.stringify(a))};a.gB=function(a,c){var d=[],e;for(e in c){var f=c[e];if(f)for(var g=0;g<f.length;g++)d.push(f[g])}return b(a,d)};a.ya=function(b){var c=b instanceof Array?[]:{},d;for(d in b)c[d]=b[d]&&"object"==typeof b[d]?b[d]instanceof Float32Array?new Float32Array(b[d]):b[d]instanceof Uint32Array?new Uint32Array(b[d]):b[d]instanceof Uint16Array?new Uint16Array(b[d]):a.ya(b[d]):b[d];return c};a.Ah=function(a){var b=a instanceof Array?[]:{},c;for(c in a)b[c]=
a[c]&&"object"==typeof a[c]?a[c]instanceof Float32Array?new Float32Array(a[c]):a[c]instanceof Uint32Array?new Uint32Array(a[c]):a[c]instanceof Uint16Array?new Uint16Array(a[c]):a[c]instanceof Array?a[c].slice(0):a[c]:a[c];return b};a.is_mesh=function(a){return"MESH"===a.type?!0:!1};a.ix=function(a){return"EMPTY"===a.type?!0:!1};a.sf=function(a){return"ARMATURE"===a.type?!0:!1};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));x.fromMat4(a,H);var c=H[0],d=H[3],e=H[6],f=H[1],g=H[4],h=H[7],m=
H[2],l=H[5],n=H[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+g*g+h*h)||1,m=Math.sqrt(m*m+l*l+n*n)||1;H[0]/=c;H[3]/=c;H[6]/=c;H[1]/=f;H[4]/=f;H[7]/=f;H[2]/=m;H[5]/=m;H[8]/=m;k.fromMat3(H,b);return b};a.Ef=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.Lj=function(a){y[0]=.577350269189626;y[1]=.577350269189626;y[2]=.577350269189626;y[3]=0;F.transformMat4(y,a,y);return F.length(y)};a.bp=function(a,b){var c=b.left,d=b.right,f=b.top,g=b.bottom,h=b.Ja,m=b.Qa;c[0]=
a[3]+a[0];c[1]=a[7]+a[4];c[2]=a[11]+a[8];c[3]=a[15]+a[12];d[0]=a[3]-a[0];d[1]=a[7]-a[4];d[2]=a[11]-a[8];d[3]=a[15]-a[12];f[0]=a[3]-a[1];f[1]=a[7]-a[5];f[2]=a[11]-a[9];f[3]=a[15]-a[13];g[0]=a[3]+a[1];g[1]=a[7]+a[5];g[2]=a[11]+a[9];g[3]=a[15]+a[13];h[0]=a[3]+a[2];h[1]=a[7]+a[6];h[2]=a[11]+a[10];h[3]=a[15]+a[14];m[0]=a[3]-a[2];m[1]=a[7]-a[6];m[2]=a[11]-a[10];m[3]=a[15]-a[14];e(c);e(d);e(f);e(g);e(h);e(m)};a.hz=function(a,b,c){return c<-d(a,b.left)||c<-d(a,b.right)||c<-d(a,b.top)||c<-d(a,b.bottom)||c<
-d(a,b.Ja)||c<-d(a,b.Qa)?!0:!1};a.Ev=function(a,b,c,e,f){g=q.dot(c,b.Qa);h=q.dot(e,b.Qa);m=q.dot(f,b.Qa);g=Math.sqrt(g*g+h*h+m*m);if(g<-d(a,b.Ja)||g<-d(a,b.Qa))return!0;var g=q.dot(c,b.left),h=q.dot(e,b.left),m=q.dot(f,b.left);if(Math.sqrt(g*g+h*h+m*m)<-d(a,b.left))return!0;g=q.dot(c,b.right);h=q.dot(e,b.right);m=q.dot(f,b.right);if(Math.sqrt(g*g+h*h+m*m)<-d(a,b.right))return!0;g=q.dot(c,b.top);h=q.dot(e,b.top);m=q.dot(f,b.top);if(Math.sqrt(g*g+h*h+m*m)<-d(a,b.top))return!0;g=q.dot(c,b.bottom);h=
q.dot(e,b.bottom);m=q.dot(f,b.bottom);return Math.sqrt(g*g+h*h+m*m)<-d(a,b.bottom)?!0:!1};a.ue=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],m=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*m+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*m+b[13];c[d+f+2]=b[2]*g+b[6]*h+b[10]*m+b[14]}};a.hA=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],m=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*m;c[d+f+1]=b[1]*g+b[5]*h+b[9]*m;c[d+f+2]=b[2]*g+b[6]*h+b[10]*m}};a.zz=function(a,b,c){for(var d=
0,d=0,e=a.length,f=0;f<e;f+=4){var g=a[f],h=a[f+1],m=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*m;c[d+f+1]=b[1]*g+b[5]*h+b[9]*m;c[d+f+2]=b[2]*g+b[6]*h+b[10]*m;c[d+f+3]=a[f+3]}};a.fA=function(a,b,c){c||(c=new Float32Array(3));y[0]=a[0];y[1]=a[1];y[2]=a[2];y[3]=0;F.transformMat4(y,b,y);c[0]=y[0];c[1]=y[1];c[2]=y[2]};a.AB=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=
0;f<d;f++)b[e*d+f]=a[e][f];return b};a.gA=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.Wi=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.Wi(b,c,d,f-1):b[f]<c?a.Wi(b,c,f+1,e):f};a.ce=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.dj=function(a,b){for(var c=0;c<a.length;c++)if(1E-7<Math.abs(a[c]-b[c]))return!1;return!0};a.ry=function(a,b,c){c||(c=new Float32Array(16));for(var d=
0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.Zm=function(a,b,c,d){d||(d=new Float32Array(16));b=v.fromRotationTranslation(b,c,Y);v.multiply(b,a,d)};a.xi=function(a,b,c,d,e){e||(e=new Float32Array(3));c=v.fromRotationTranslation(c,d,Y);1!==b&&(d=v.identity(J),b=q.set(b,b,b,C),v.scale(d,b,d),v.multiply(c,d,c));q.transformMat4(a,c,e);return e};a.$m=function(a,b,c,d){d||(d=new Float32Array(4));b=v.fromRotationTranslation(b,c,Y);F.transformMat4(a,b,d)};a.eC=function(a,b,c,
d,e){e||(e=new Float32Array(3));b=v.fromRotationTranslation(c,d,Y);v.invert(b,b);q.transformMat4(a,b,e);return e};a.SC=function(a,b,c){c||(c=new Float32Array(16));v.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.xC=function(b,c,d){a.Ef(b,c);c[3]=a.Lj(b);a.matrix_to_quat(b,d)};a.On=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.ny=function(a,b,c,d){d||(d=new Float32Array(3));q.subtract(b,a,C);q.transformQuat(C,c,C);q.subtract(b,C,d)};
a.dw=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16),g=new Float32Array(16);v.lookAt(a,[-1,0,0],[0,-1,0],b);v.scale(b,[-1,1,1],b);v.scale(b,[-1,1,-1],c);v.lookAt(a,[0,-1,0],[0,0,-1],d);v.scale(d,[1,1,-1],d);v.scale(d,[1,-1,-1],e);v.lookAt(a,[0,0,-1],[0,-1,0],f);v.scale(f,[-1,1,1],f);v.scale(f,[-1,1,-1],g);return[b,c,d,e,f,g]};a.yh=function(a,b){return l(a,b)};a.hash_code=l;a.YB=f;a.wC=function(a,
b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,m,l,k,n,r,s,q,D,p;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];h=a[2];m=a[3];l=a[4];k=a[5];n=a[6];r=a[7];s=a[8];q=a[9];D=a[10];p=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=m;c[4]=l;c[5]=k;c[6]=n;c[7]=r;c[8]=s;c[9]=q;c[10]=D;c[11]=p;c[12]=f*d+l*e+s*b+a[12];c[13]=g*d+k*e+q*b+a[13];c[14]=h*d+n*e+D*b+a[14];c[15]=m*d+r*e+p*b+a[15];return c};a.wx=function(a,
b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.Zx=function(a){return a*Math.PI/180};a.oB=function(a){return 180*a/Math.PI};
a.Lm=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=b>a?1:0,g=1-f,e=b+.211324865405187-f,m=a+.211324865405187-g,l=b+-.577350269189626,k=a+-.577350269189626,c=c%289,d=d%289,n=r(r(d)+c),g=r(r(d+g)+c+f),s=r(r(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+m*m),0),f=Math.max(.5-(l*l+k*k),0),q=2*h(.024390243902439*n)-1,D=2*h(.024390243902439*g)-1,p=2*h(.024390243902439*
s)-1,n=Math.abs(q)-.5,g=Math.abs(D)-.5,s=Math.abs(p)-.5,q=q-Math.floor(q+.5),D=D-Math.floor(D+.5),p=p-Math.floor(p+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(q*q+n*n)),d=d*d*d*d*(1.79284291400159-.85373472095314*(D*D+g*g)),f=f*f*f*f*(1.79284291400159-.85373472095314*(p*p+s*s));return 130*(c*(q*b+n*a)+d*(D*e+g*m)+f*(p*l+s*k))};a.mo=function(a){var b=1/7,c=b/2,d=m(Math.floor(a[0])),e=m(Math.floor(a[1])),f=h(a[0]);a=h(a[1]);var g=f-.5,l=f-1.5,f=a-.5;a-=1.5;var k=n(d),r=n(d+1),q=k,d=r,k=n(k+e),
r=n(r+e),q=n(q+e+1),d=n(d+e+1),e=g+.7*(s(k)*b+c),D=l+.7*(s(r)*b+c),g=g+.7*(s(q)*b+c),l=l+.7*(s(d)*b+c),k=f+.7*(s(Math.floor(k*b))*b+c),f=f+.7*(s(Math.floor(r*b))*b+c),q=a+.7*(s(Math.floor(q*b))*b+c),b=a+.7*(s(Math.floor(d*b))*b+c);return Math.min(e*e+k*k,D*D+f*f,g*g+q*q,l*l+b*b)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=q.transformQuat(b,a,C);b=c[0];var f=c[1];c=c[2];H[0]=f*f+c*c;H[1]=-f*b;H[2]=-c*b;H[3]=-b*f;H[4]=b*b+c*c;H[5]=-c*f;H[6]=-b*c;H[7]=-f*c;H[8]=b*b+f*f;q.transformMat3(a,
H,a);q.normalize(a,a);k.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=y,d=I,c=k.setAxisAngle([0,1,0],Math.PI,k.create()),d=k.setAxisAngle([1,0,0],Math.PI/2,k.create());k.multiply(c,d,c);k.multiply(a,c,b);return b};a.cleanup=function(){G=0;A={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);
for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.qr=function(a,b,c,d,e){e||(e=new Float32Array(a.length));k.slerp(a,b,Math.exp(-c/d),e)};a.fC=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=x.fromQuat(a,H);M[0]=0;M[1]=1;M[2]=0;C[0]=c[3];C[1]=c[4];C[2]=c[5];var d=q.cross(M,C,C);
q.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);M[0]=c[0];M[1]=c[1];M[2]=c[2];q.normalize(M,M);k.rotationTo(M,d,I);k.multiply(I,a,a)};a.pp=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],m=a[e*b+Math.min(c+1,g)],l=a[Math.min(e+1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+m*d)*(1-f)+(l*(1-d)+a*d)*f};a.Rf=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.$q=function(a){for(var b=
[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.qi=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.aw=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.nf=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,
c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];q.normalize(c,c)};a.TC=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var m=g*a-h*e,l=h*d-f*a,k=f*e-g*d,n=g*k-h*l,h=h*m-f*k,f=f*l-g*m;c[0]=d+2*m*b+2*n;c[1]=e+2*l*b+2*h;c[2]=a+2*k*b+2*f;return c};a.ga=function(a){a&&u.error.apply(u,arguments);throw"panic: see above for possible error messages";};a.Ve=function(a){return a-2*Math.floor(a/(2*Math.PI))*Math.PI};a.Dl=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};
a.Br=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=B(e,f)}if(!d)return!1}return!0};a.Yx=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.$v=function(a){a+=1;132651<a&&u.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return[b/51,c/51,a%51/51]};a.line_plane_intersect=function(a,b,c,d,e){y.set(a);y[3]=b;I.set(d);I[3]=0;a=F.dot(y,I);if(0==a)return null;
I.set(c);I[3]=1;a=-F.dot(y,I)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.iB=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.cr=function(a,b,c){var d=q.dot(a,b);-.9999999>d?(q.cross(ca,a,C),1E-6>q.length(C)&&q.cross(O,a,C),q.normalize(C,C),k.setAxisAngle(C,Math.PI,c)):(q.cross(a,b,C),c.set(C),c[3]=1+d,k.normalize(c,c));return c}};b4w.module.__sfx=function(a,p){function c(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;u.warn("B4W warning: deprecated WebAudio implementation");return null}u.warn("B4W warning: WebAudio is not supported");return null}function b(a,b,c){var d=a.h;if("NONE"!=d.behavior){c||(c=0);var h=d.loop,m=d.pitch;if(d.src&&(h||0<=c)){d.Jk=Math.floor(5E4*Math.random());var k=y.currentTime+b;d.gc=k;d.state=20;e(a);"POSITIONAL"==d.behavior||"BACKGROUND_SOUND"==d.behavior?
(b=y.createBufferSource(),b.buffer=d.src,b.playbackRate.value=m,h?(d.ib&&d.ib.disconnect(),b.loop=!0,b.start(k),d.duration=0):(h=b.buffer?b.buffer.duration:0,c>h?(h=k+c+d.zd,b.loop=!0,b.start(k),b.stop(h),d.duration=c):(b.loop=!1,b.start(k),d.duration=h)),b.connect(d.Tb),d.ib=b,l(d),g(d)):"BACKGROUND_MUSIC"==d.behavior&&(q.cj(d.Nk),q.cj(d.Ok),c=function(){var b=a.h,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.ib=b.ib||y.createMediaElementSource(c),b.ib.connect(b.Tb),20==b.state&&(c.currentTime&&(c.currentTime=
0),c.play()))},0==b?c():d.Nk=q.gr(c,1E3*b),d.duration=h?0:B(a));f(d,k)}}}function e(a){var b=a.h;if(!b.Tb){var c=a.d.g;a=a.d.quat;if(x.Pj){var d=y.createBiquadFilter();d.type="peaking"}else d=null;var e=y.createGain();switch(b.behavior){case "POSITIONAL":var f=y.createPanner();"string"!=typeof f.panningModel?(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],c[1],c[2]);b.Yl.set(c);c=v;F.quat_to_dir(a,F.AXIS_MY,
c);f.setOrientation(c[0],c[1],c[2]);b.direction.set(c);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.Du;f.coneOuterAngle=b.Eu;f.coneOuterGain=b.Fu;var g=y.createGain();g.gain.value=s(b);d?(f.connect(d),d.connect(g)):f.connect(g);g.connect(e);b.Tb=f;if(b.nh){var h=y.createGain();e.connect(h);h.connect(y?I.h.Tb:null)}else h=null,e.connect(y?I.h.Tb:null);break;case "BACKGROUND_SOUND":f=null;g=y.createGain();g.gain.value=s(b);d?(b.Tb=d,d.connect(g)):
b.Tb=g;g.connect(e);b.nh?(h=y.createGain(),e.connect(h),h.connect(y?I.h.Tb:null)):(h=null,e.connect(y?I.h.Tb:null));break;case "BACKGROUND_MUSIC":h=f=null,g=y.createGain(),g.gain.value=s(b),d?(b.Tb=d,d.connect(g)):b.Tb=g,g.connect(e),e.connect(y?I.h.Tb:null)}b.di=f;b.Nc=d;b.tg=g;b.jf=e;b.Uq=h}}function d(a){var c=a.h,d=c.duration,c=c.delay+c.tv*Math.random();b(a,c,d)}function l(a){a.nh&&a.Uq.gain.cancelScheduledValues(a.gc);a.hi&&a.ib.playbackRate.cancelScheduledValues(a.gc);a.Ci=a.gc}function g(a){if(a.nh||
a.hi){var b=a.Uq,c=a.ib,d=c.buffer?c.buffer.duration:0;if(d){var e=a.gc;Y[0]=a.Jk;for(var f=0;5>f;){var g=a.pitch+a.hi*F.tc(Y);if(e>=a.Ci){if(a.nh){var h=1-F.clamp(a.nh,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.hi&&c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.Ci=e-.001}}}function f(a,b){if(a.rl||a.zd){var c=a.jf;c.gain.cancelScheduledValues(b);a.rl?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.rl)):c.gain.setValueAtTime(1,b);a.zd&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),
c.gain.linearRampToValueAtTime(0,b+a.duration+a.zd))}}function r(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.h;if(20==b.state||40==b.state){var c=b.jf,d=y.currentTime;b.zd&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.zd));"BACKGROUND_MUSIC"==b.behavior?b.src&&(q.cj(b.Nk),q.cj(b.Ok),b.Ok=q.gr(function(){var b=a.h.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.zd)):(c=b.ib,b.duration<c.buffer.duration?b.zd&&20==b.state?c.stop(d+b.zd):20==b.state&&
(c.stop(0),c.disconnect()):c.disconnect(),b.gc=0,b.rm=0,b.Tk=0);b.state=30}}function h(a){a=a.h;if(20==a.state){var b=y.currentTime;a.rm=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.gc){Y[0]=a.Jk;for(var d=a.ib.buffer.duration,e=a.gc;e<b;)c=a.pitch+a.hi*F.tc(Y),e+=d/c;c*=d/c-(e-b)}else c=0;a.Tk=c;a.ib.stop(0);a.ib.disconnect();l(a)}a.state=40}}function n(a){var b=a.h;if(40==b.state){var c=y.currentTime;b.gc+=c-b.rm;if("BACKGROUND_MUSIC"==b.behavior)b.src.play();else{a=
a.h;var d=y.createBufferSource();d.loop=a.ib.loop;d.buffer=a.ib.buffer;d.playbackRate.value=a.ib.playbackRate.value;a.di?d.connect(a.di):d.connect(a.tg);a.ib=d;b.Ci=c;b.ib.start(b.gc,b.Tk);g(b)}f(b,b.gc);b.state=20}}function m(a){return!a.h||20!=a.h.state&&40!=a.h.state&&30!=a.h.state?!1:!0}function s(a){return a.muted?0:a.volume}function B(a){a=a.h;return(a=a.src)?a.duration:0}var z=p("__config"),u=p("__print"),q=p("__time"),F=p("__util"),k=p("vec3"),x=z.Od;a.qn=10;a.yk=20;a.pn=30;var v=new Float32Array(3),
G=new Float32Array(3),A=new Float32Array(3),C=[],M=[],y=null,I=null,H=[],Y=[1],J=null;a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(C.push("ogg"),C.push("ogv")),""!=a.canPlayType("audio/mpeg")&&C.push("mp3"),""!=a.canPlayType("audio/mp4")&&(C.push("mp4"),C.push("m4v")),""!=a.canPlayType("audio/webm")&&C.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&M.push("ogv"),""!=b.canPlayType("video/mp4")&&
M.push("m4v"),""!=b.canPlayType("video/webm")&&M.push("webm"));(y=x.nA?c():null)&&u.log("%cINIT WEBAUDIO: "+y.sampleRate+"Hz","color: #00a")};a.Sn=function(a){var b={Bf:new Float32Array(3),eq:new Float32Array(3),Cg:new Float32Array(3)};a.h=b;if(y){var c=y.createGain(),d=y.createGain();b.tg=c;b.jf=d;c.connect(d);d.connect(y.destination);if(a.b4w_enable_dynamic_compressor){var d=y.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=
e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.Bh=d;b.Tb=d}else b.Bh=null,b.Tb=c;c=y.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;b.muted=!1;b.volume=1;b.hf=0}};a.Ay=function(a){I=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<C.indexOf(a)?a:"ogg"==a&&-1<C.indexOf("mp4")?"mp4":"mp3"==a&&-1<C.indexOf("ogg")?"ogg":"mp4"==a&&-1<C.indexOf("ogg")?"ogg":"ogv"==a&&-1<C.indexOf("m4v")?"m4v":"webm"==a&&-1<C.indexOf("m4v")?"m4v":
"m4v"==a&&-1<C.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<M.indexOf(a)?a:"ogv"==a&&-1<M.indexOf("m4v")?"m4v":"webm"==a&&-1<M.indexOf("m4v")?"m4v":"m4v"==a&&-1<M.indexOf("webm")?"webm":""};a.append_object=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.h={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.h.behavior=y?b.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var c=a.h,d;y?(window.MediaElementAudioSourceNode?
d=!0:(u.warn("B4W warning: MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.h.behavior="NONE");a.h.yv=b.b4w_disable_doppler;a.h.muted=b.muted;a.h.volume=b.volume;a.h.pitch=b.pitch;a.h.attenuation=b.attenuation;a.h.dist_ref=b.distance_reference;a.h.dist_max=b.distance_max||1E4;a.h.Du=b.cone_angle_inner;a.h.Eu=b.cone_angle_outer;a.h.Fu=b.cone_volume_outer;a.h.cyclic=b.b4w_cyclic_play;
a.h.loop=b.b4w_loop;a.h.delay=b.b4w_delay;a.h.tv=b.b4w_delay_random;a.h.nh=b.b4w_volume_random;a.h.hi=b.b4w_pitch_random;a.h.rl=b.b4w_fade_in;a.h.zd=b.b4w_fade_out;a.h.gc=0;a.h.rm=0;a.h.Tk=0;a.h.duration=0;a.h.Ci=0;a.h.Jk=1;a.h.src=null;a.h.state=10;a.h.Yl=new Float32Array(3);a.h.direction=new Float32Array(3);a.h.Mm=new Float32Array(3);a.h.Nk=-1;a.h.Ok=-1;a.h.hf=0;H.push(a)};a.rr=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.h.behavior){case "POSITIONAL":return a.yk;case "BACKGROUND_SOUND":return a.yk;
case "BACKGROUND_MUSIC":return a.pn;case "NONE":return a.qn;default:throw"Wrong speaker behavior";}};a.Xz=function(a,b){var c=a.h;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.Sx=function(){var a=y.createBufferSource();a.buffer=y.createBuffer(1,22050,22050);a.connect(y.destination);a.start(0)};a.qv=function(a,b,c){y?y.decodeAudioData(a,b,c):c()};a.dz=function(a){r(a);delete a.h;H.splice(H.indexOf(a),
1)};a.cleanup=function(){for(var a=0;a<H.length;a++){var b=H[a].h;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.ib&&b.ib.disconnect()}I&&I.h&&(a=I.h,a.Bf[0]=0,a.Bf[1]=0,a.Bf[2]=0,a.Cg[0]=0,a.Cg[1]=0,a.Cg[2]=0);I=null;H.splice(0);J=null};a.update=function(a){if(y&&0!=H.length){for(var b=0;b<H.length;b++){var c=H[b],e=c.h,f=y.currentTime;y&&!e.loop&&e.cyclic&&20==e.state&&e.duration&&e.gc+e.duration<f&&d(c);20==e.state&&3>e.Ci-f&&g(e)}J&&(-1==J.Ca||a>J.In+J.Uo[J.Ca])&&(b=J,-1<b.Ca&&r(b.Fe[b.Ca]),
-1==b.Ca&&b.random?c=Math.round(Math.random()*(b.Fe.length-1)):b.random?(c=1+Math.round(Math.random()*(b.Fe.length-2)),c=(b.Ca+c)%b.Fe.length):c=(b.Ca+1)%b.Fe.length,d(b.Fe[c]),b.Ca=c,b.In=a)}};a.play=b;a.play_def=d;a.stop=r;a.is_play=function(a){return 20==a.h.state};a.cz=h;a.ez=n;a.playrate=function(a,b){var c=a.h;c.pitch=b;!m(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.ib.playbackRate.value=b,l(c),g(c))};a.get_playrate=function(a){return a.h.pitch};a.cyclic=function(a,b){a.h.cyclic=
Boolean(b)};a.is_cyclic=function(a){return a.h.cyclic};a.rx=function(a,b,c,d){if(y&&a.h){var e=v;e[0]=0;e[1]=-1;e[2]=0;k.transformQuat(e,c,e);G[0]=0;G[1]=0;G[2]=-1;k.transformQuat(G,c,G);c=y.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],G[0],G[1],G[2]);a.h.eq.set(e);d&&(A[0]=(b[0]-a.h.Bf[0])/d,A[1]=(b[1]-a.h.Bf[1])/d,A[2]=(b[2]-a.h.Bf[2])/d,F.smooth_v(A,a.h.Cg,d,.3,A),c.setVelocity(A[0],A[1],A[2]),a.h.Cg.set(A));a.h.Bf.set(b)}};a.listener_reset_speed=function(a,b){if(y&&I.h){var c=
v;b?c.set(b):c.set(I.h.eq);k.scale(c,a,c);y.listener.setVelocity(c[0],c[1],c[2]);I.h.Cg.set(c)}};a.fz=function(a,b){var c=a.h;if(m(a)&&"POSITIONAL"==c.behavior){var d=a.d.g,e=c.di;e.setPosition(d[0],d[1],d[2]);var f=v;F.quat_to_dir(a.d.quat,F.AXIS_MY,f);e.setOrientation(f[0],f[1],f[2]);f=c.Yl;!c.yv&&b&&(G[0]=(d[0]-f[0])/b,G[1]=(d[1]-f[1])/b,G[2]=(d[2]-f[2])/b,F.smooth_v(G,c.Mm,b,.3,G),e.setVelocity(G[0],G[1],G[2]),c.Mm.set(G));f.set(d)}};a.speaker_reset_speed=function(a,b,c){var d=a.h;if(m(a)&&"POSITIONAL"==
d.behavior){var e=v;c?e.set(c):e.set(d.direction);k.scale(e,b,e);d.di.setVelocity(e[0],e[1],e[2]);d.Mm.set(e);d.Yl.set(a.d.g)}};a.Hd=function(a){return a.h?!0:!1};a.Hl=function(a){return a.h.behavior};a.check_active_speakers=function(){for(var a=0;a<H.length;a++)if(m(H[a]))return!0;return!1};a.Jy=function(a){var b=I.h;b&&(b.volume=a,y&&(b.tg.gain.value=s(b)))};a.Ew=function(){var a=I.h;return a?a.volume:0};a.set_volume=function(a,b){var c=a.h;c.volume=b;m(a)&&(c.tg.gain.value=s(c))};a.get_volume=
function(a){return a.h.volume};a.mute=function(a,b){a.h.muted=Boolean(b);m(a)&&(a.h.tg.gain.value=s(a.h))};a.is_muted=function(a){return a.h.muted};a.Gx=function(a){var b=I.h;b&&(b.muted=Boolean(a),y&&(b.tg.gain.value=s(b)))};a.nx=function(){var a=I.h;return a?a.muted:!1};a.get_speaker_objects=function(){return H};a.pause=function(){for(var a=0;a<H.length;a++)h(H[a])};a.resume=function(){for(var a=0;a<H.length;a++)n(H[a])};a.set_compressor_params=function(a,b){if(a.h&&a.h.Bh){var c=a.h.Bh;c.threshold.value=
b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.h||!a.h.Bh)return null;a=a.h.Bh;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(m(a)){a=a.h;var d=a.jf,e=y.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.hf=c}};a.unduck=function(a){if(m(a)){a=a.h;var b=a.jf,c=y.currentTime;
b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.hf);a.hf=0}};a.Av=function(a,b){if(y){var c=I.h,d=c.jf,e=y.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.hf=b}};a.Gz=function(){if(y){var a=I.h,b=a.jf,c=y.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.hf);a.hf=0}};a.apply_playlist=function(a,b,c){J={Ca:-1,In:0,random:c,Fe:[],Uo:[]};for(c=0;c<a.length;c++){var d=a[c],e=B(d);0==e?u.warn("B4W warning: Ignoring speaker with zero duration: "+
d.name):(r(d),d.h.cyclic=!1,J.Fe.push(d),J.Uo.push(e+b))}};a.get_duration=B;a.clear_playlist=function(){if(J)for(var a=J.Fe,b=0;b<a.length;b++)r(a[b]);J=null};a.get_positional_params=function(a){return(a=a.h)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.h;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.di;d&&(d.refDistance=c.dist_ref,
d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.h;c&&c.Nc&&(c.Nc.frequency.value=b.freq,c.Nc.Q.value=b.Q,c.Nc.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.h)&&a.Nc?{freq:a.Nc.frequency.value,Q:a.Nc.Q.value,gain:a.Nc.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.h;if(!a||!a.Nc)return null;a.Nc.getFrequencyResponse(b,c,d)}};b4w.module.vec3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new p(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var c=new p(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.fromValues=function(a,c,d){var l=new p(3);l[0]=a;l[1]=c;l[2]=d;return l};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.set=function(a,c,d,l){l[0]=a;l[1]=c;l[2]=d;return l};a.add=function(a,c,d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];return d};
a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);return d};
a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;return d};a.scaleAndAdd=function(a,c,d,l){l[0]=a[0]+c[0]*d;l[1]=a[1]+c[1]*d;l[2]=a[2]+c[2]*d;return l};a.distance=function(a,c){var d=c[0]-a[0],l=c[1]-a[1],g=c[2]-a[2];return Math.sqrt(d*d+l*l+g*g)};a.dist=a.distance;a.squaredDistance=function(a,c){var d=c[0]-a[0],l=c[1]-a[1],g=c[2]-a[2];return d*d+l*l+g*g};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1];a=a[2];return Math.sqrt(c*c+d*d+a*a)};a.len=a.length;a.squaredLength=
function(a){var c=a[0],d=a[1];a=a[2];return c*c+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];return c};a.normalize=function(a,c){var d=a[0],l=a[1],g=a[2],d=d*d+l*l+g*g;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};a.cross=function(a,c,d){var l=a[0],g=a[1];a=a[2];var f=c[0],r=c[1];c=c[2];d[0]=g*c-a*r;d[1]=
a*f-l*c;d[2]=l*r-g*f;return d};a.lerp=function(a,c,d,l){var g=a[0],f=a[1];a=a[2];l[0]=g+d*(c[0]-g);l[1]=f+d*(c[1]-f);l[2]=a+d*(c[2]-a);return l};a.random=function(a,e){a=a||1;var d=2*c()*Math.PI,l=2*c()-1,g=Math.sqrt(1-l*l)*a;e[0]=Math.cos(d)*g;e[1]=Math.sin(d)*g;e[2]=l*a;return e};a.transformMat4=function(a,c,d){var l=a[0],g=a[1];a=a[2];var f=c[3]*l+c[7]*g+c[11]*a+c[15],f=f||1;d[0]=(c[0]*l+c[4]*g+c[8]*a+c[12])/f;d[1]=(c[1]*l+c[5]*g+c[9]*a+c[13])/f;d[2]=(c[2]*l+c[6]*g+c[10]*a+c[14])/f;return d};a.transformMat3=
function(a,c,d){var l=a[0],g=a[1];a=a[2];d[0]=l*c[0]+g*c[3]+a*c[6];d[1]=l*c[1]+g*c[4]+a*c[7];d[2]=l*c[2]+g*c[5]+a*c[8];return d};a.transformQuat=function(a,c,d){var l=a[0],g=a[1],f=a[2];a=c[0];var r=c[1],h=c[2];c=c[3];var n=c*l+r*f-h*g,m=c*g+h*l-a*f,s=c*f+a*g-r*l,l=-a*l-r*g-h*f;d[0]=n*c+l*-a+m*-h-s*-r;d[1]=m*c+l*-r+s*-a-n*-h;d[2]=s*c+l*-h+n*-r-m*-a;return d};a.rotateX=function(a,c,d,l){var g=[],f=[];g[0]=a[0]-c[0];g[1]=a[1]-c[1];g[2]=a[2]-c[2];f[0]=g[0];f[1]=g[1]*Math.cos(d)-g[2]*Math.sin(d);f[2]=
g[1]*Math.sin(d)+g[2]*Math.cos(d);l[0]=f[0]+c[0];l[1]=f[1]+c[1];l[2]=f[2]+c[2];return l};a.rotateY=function(a,c,d,l){var g=[],f=[];g[0]=a[0]-c[0];g[1]=a[1]-c[1];g[2]=a[2]-c[2];f[0]=g[2]*Math.sin(d)+g[0]*Math.cos(d);f[1]=g[1];f[2]=g[2]*Math.cos(d)-g[0]*Math.sin(d);l[0]=f[0]+c[0];l[1]=f[1]+c[1];l[2]=f[2]+c[2];return l};a.rotateZ=function(a,c,d,l){var g=[],f=[];g[0]=a[0]-c[0];g[1]=a[1]-c[1];g[2]=a[2]-c[2];f[0]=g[0]*Math.cos(d)-g[1]*Math.sin(d);f[1]=g[0]*Math.sin(d)+g[1]*Math.cos(d);f[2]=g[2];l[0]=f[0]+
c[0];l[1]=f[1]+c[1];l[2]=f[2]+c[2];return l};a.forEach=function(){var b=a.create();return function(a,c,l,g,f,r){c||(c=3);l||(l=0);for(g=g?Math.min(g*c+l,a.length):a.length;l<g;l+=c)b[0]=a[l],b[1]=a[l+1],b[2]=a[l+2],f(b,r,b),a[l]=b[0],a[l+1]=b[1],a[l+2]=b[2];return a}}();a.NA=function(b,c){var d=a.fromValues(b[0],b[1],b[2]),l=a.fromValues(c[0],c[1],c[2]);a.normalize(d,d);a.normalize(l,l);d=a.dot(d,l);return 1<d?0:Math.acos(d)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==
typeof a&&(a.vec3=a)};
b4w.module.vec4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new p(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var c=new p(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.fromValues=function(a,c,d,l){var g=new p(4);g[0]=a;g[1]=c;g[2]=d;g[3]=l;return g};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.set=function(a,c,d,l,g){g[0]=a;g[1]=c;g[2]=d;g[3]=l;return g};a.add=function(a,c,d){d[0]=
a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3]+c[3];return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];d[3]=a[3]-c[3];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];d[3]=a[3]*c[3];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];d[3]=a[3]/c[3];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);d[3]=
Math.min(a[3],c[3]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);d[3]=Math.max(a[3],c[3]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;d[3]=a[3]*c;return d};a.scaleAndAdd=function(a,c,d,l){l[0]=a[0]+c[0]*d;l[1]=a[1]+c[1]*d;l[2]=a[2]+c[2]*d;l[3]=a[3]+c[3]*d;return l};a.distance=function(a,c){var d=c[0]-a[0],l=c[1]-a[1],g=c[2]-a[2],f=c[3]-a[3];return Math.sqrt(d*d+l*l+g*g+f*f)};a.dist=a.distance;a.squaredDistance=
function(a,c){var d=c[0]-a[0],l=c[1]-a[1],g=c[2]-a[2],f=c[3]-a[3];return d*d+l*l+g*g+f*f};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1],l=a[2];a=a[3];return Math.sqrt(c*c+d*d+l*l+a*a)};a.len=a.length;a.squaredLength=function(a){var c=a[0],d=a[1],l=a[2];a=a[3];return c*c+d*d+l*l+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];c[3]=1/a[3];return c};a.normalize=
function(a,c){var d=a[0],l=a[1],g=a[2],f=a[3],d=d*d+l*l+g*g+f*f;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};a.lerp=function(a,c,d,l){var g=a[0],f=a[1],r=a[2];a=a[3];l[0]=g+d*(c[0]-g);l[1]=f+d*(c[1]-f);l[2]=r+d*(c[2]-r);l[3]=a+d*(c[3]-a);return l};a.random=function(b,e){b=b||1;e[0]=c();e[1]=c();e[2]=c();e[3]=c();a.normalize(e,e);a.scale(e,b,e);return e};a.transformMat4=function(a,c,d){var l=a[0],
g=a[1],f=a[2];a=a[3];d[0]=c[0]*l+c[4]*g+c[8]*f+c[12]*a;d[1]=c[1]*l+c[5]*g+c[9]*f+c[13]*a;d[2]=c[2]*l+c[6]*g+c[10]*f+c[14]*a;d[3]=c[3]*l+c[7]*g+c[11]*f+c[15]*a;return d};a.transformQuat=function(a,c,d){var l=a[0],g=a[1],f=a[2],r=c[0],h=c[1],n=c[2];c=c[3];var m=c*l+h*f-n*g,s=c*g+n*l-r*f,p=c*f+r*g-h*l,l=-r*l-h*g-n*f;d[0]=m*c+l*-r+s*-n-p*-h;d[1]=s*c+l*-h+p*-r-m*-n;d[2]=p*c+l*-n+m*-h-s*-r;d[3]=a[3];return d};a.forEach=function(){var b=a.create();return function(a,c,l,g,f,r){c||(c=4);l||(l=0);for(g=g?Math.min(g*
c+l,a.length):a.length;l<g;l+=c)b[0]=a[l],b[1]=a[l+1],b[2]=a[l+2],b[3]=a[l+3],f(b,r,b),a[l]=b[0],a[l+1]=b[1],a[l+2]=b[2],a[l+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};
b4w.module.quat=function(a,p){var c=p("vec3"),b=p("vec4"),e=p("mat3"),d="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new d(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=c.create(),d=c.fromValues(1,0,0),f=c.fromValues(0,1,0);return function(e,h,n){var m=c.dot(e,h);if(-.9999999>m)return c.cross(d,e,b),1E-6>c.length(b)&&c.cross(f,e,b),c.normalize(b,b),a.setAxisAngle(b,Math.PI,n),n;if(.9999999<m)return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n;c.cross(e,
h,b);n[0]=b[0];n[1]=b[1];n[2]=b[2];n[3]=1+m;return a.normalize(n,n)}}();a.setAxes=function(){var b=e.create();return function(c,d,e,h){b[0]=d[0];b[3]=d[1];b[6]=d[2];b[1]=e[0];b[4]=e[1];b[7]=e[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,h),h)}}();a.clone=b.clone;a.fromValues=b.fromValues;a.copy=b.copy;a.set=b.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=b.add;a.multiply=function(a,b,c){var d=a[0],e=a[1],n=a[2];a=a[3];var m=b[0],s=b[1],p=b[2];b=b[3];c[0]=d*b+a*m+e*p-n*s;c[1]=e*b+a*s+n*m-d*p;c[2]=n*b+a*p+d*s-e*m;c[3]=a*b-d*m-e*s-n*p;return c};a.mul=a.multiply;a.scale=b.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],e=a[1],n=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*m;c[1]=e*b+n*m;c[2]=n*b-e*m;c[3]=a*b-d*m;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],e=a[1],n=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);c[0]=d*
b-n*m;c[1]=e*b+a*m;c[2]=n*b+d*m;c[3]=a*b-e*m;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],e=a[1],n=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);c[0]=d*b+e*m;c[1]=e*b-d*m;c[2]=n*b+a*m;c[3]=a*b-n*m;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];b[0]=c;b[1]=d;b[2]=e;b[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};a.dot=b.dot;a.lerp=b.lerp;a.slerp=function(a,b,c,d){var e=a[0],n=a[1],m=a[2];a=a[3];var s=b[0],p=b[1],z=b[2];b=b[3];var u,q,F;q=e*s+n*p+m*z+a*b;0>q&&(q=-q,s=-s,p=-p,
z=-z,b=-b);1E-6<1-q?(u=Math.acos(q),F=Math.sin(u),q=Math.sin((1-c)*u)/F,c=Math.sin(c*u)/F):q=1-c;d[0]=q*e+c*s;d[1]=q*n+c*p;d[2]=q*m+c*z;d[3]=q*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],e=a[2],n=a[3],m=c*c+d*d+e*e+n*n,m=m?1/m:0;b[0]=-c*m;b[1]=-d*m;b[2]=-e*m;b[3]=n*m;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=b.length;a.len=a.length;a.squaredLength=b.squaredLength;a.sqrLen=a.squaredLength;a.normalize=b.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var e=(d+1)%3,n=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*e+e]-a[3*n+n]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*e+n]-a[3*n+e])*c;b[e]=(a[3*e+d]+a[3*d+e])*c;b[n]=(a[3*n+d]+a[3*d+n])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};
b4w.module.mat3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new p(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=
a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var e=a[1],d=a[2],l=a[5];b[1]=a[3];b[2]=a[6];b[3]=e;b[5]=a[7];b[6]=d;b[7]=l}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var e=a[0],d=a[1],l=a[2],g=a[3],f=a[4],r=a[5],h=a[6],n=a[7],m=a[8],s=m*f-r*n,p=-m*g+r*h,z=
n*g-f*h,u=e*s+d*p+l*z;if(!u)return null;u=1/u;b[0]=s*u;b[1]=(-m*d+l*n)*u;b[2]=(r*d-l*f)*u;b[3]=p*u;b[4]=(m*e-l*h)*u;b[5]=(-r*e+l*g)*u;b[6]=z*u;b[7]=(-n*e+d*h)*u;b[8]=(f*e-d*g)*u;return b};a.adjoint=function(a,b){var e=a[0],d=a[1],l=a[2],g=a[3],f=a[4],r=a[5],h=a[6],n=a[7],m=a[8];b[0]=f*m-r*n;b[1]=l*n-d*m;b[2]=d*r-l*f;b[3]=r*h-g*m;b[4]=e*m-l*h;b[5]=l*g-e*r;b[6]=g*n-f*h;b[7]=d*h-e*n;b[8]=e*f-d*g;return b};a.determinant=function(a){var b=a[3],e=a[4],d=a[5],l=a[6],g=a[7],f=a[8];return a[0]*(f*e-d*g)+a[1]*
(-f*b+d*l)+a[2]*(g*b-e*l)};a.multiply=function(a,b,e){var d=a[0],l=a[1],g=a[2],f=a[3],r=a[4],h=a[5],n=a[6],m=a[7];a=a[8];var s=b[0],p=b[1],z=b[2],u=b[3],q=b[4],F=b[5],k=b[6],x=b[7];b=b[8];e[0]=s*d+p*f+z*n;e[1]=s*l+p*r+z*m;e[2]=s*g+p*h+z*a;e[3]=u*d+q*f+F*n;e[4]=u*l+q*r+F*m;e[5]=u*g+q*h+F*a;e[6]=k*d+x*f+b*n;e[7]=k*l+x*r+b*m;e[8]=k*g+x*h+b*a;return e};a.mul=a.multiply;a.translate=function(a,b,e){var d=a[0],l=a[1],g=a[2],f=a[3],r=a[4],h=a[5],n=a[6],m=a[7];a=a[8];var s=b[0];b=b[1];e[0]=d;e[1]=l;e[2]=g;
e[3]=f;e[4]=r;e[5]=h;e[6]=s*d+b*f+n;e[7]=s*l+b*r+m;e[8]=s*g+b*h+a;return e};a.rotate=function(a,b,e){var d=a[0],l=a[1],g=a[2],f=a[3],r=a[4],h=a[5],n=a[6],m=a[7];a=a[8];var s=Math.sin(b);b=Math.cos(b);e[0]=b*d+s*f;e[1]=b*l+s*r;e[2]=b*g+s*h;e[3]=b*f-s*d;e[4]=b*r-s*l;e[5]=b*h-s*g;e[6]=n;e[7]=m;e[8]=a;return e};a.scale=function(a,b,e){var d=b[0];b=b[1];e[0]=d*a[0];e[1]=d*a[1];e[2]=d*a[2];e[3]=b*a[3];e[4]=b*a[4];e[5]=b*a[5];e[6]=a[6];e[7]=a[7];e[8]=a[8];return e};a.Yv=function(a,b){b[0]=1;b[1]=0;b[2]=
0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.Wv=function(a,b){var e=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=e;b[2]=0;b[3]=-e;b[4]=d;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.Xv=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var e=a[0],d=a[1],l=a[2],g=a[3],f=e+e,r=d+d,h=l+l,e=e*f,n=d*f,d=d*r,m=l*f,s=
l*r,l=l*h,f=g*f,r=g*r,g=g*h;b[0]=1-d-l;b[3]=n-g;b[6]=m+r;b[1]=n+g;b[4]=1-e-l;b[7]=s-f;b[2]=m-r;b[5]=s+f;b[8]=1-e-d;return b};a.normalFromMat4=function(a,b){var e=a[0],d=a[1],l=a[2],g=a[3],f=a[4],r=a[5],h=a[6],n=a[7],m=a[8],s=a[9],p=a[10],z=a[11],u=a[12],q=a[13],F=a[14],k=a[15],x=e*r-d*f,v=e*h-l*f,G=e*n-g*f,A=d*h-l*r,C=d*n-g*r,M=l*n-g*h,y=m*q-s*u,I=m*F-p*u,m=m*k-z*u,H=s*F-p*q,s=s*k-z*q,p=p*k-z*F,z=x*p-v*s+G*H+A*m-C*I+M*y;if(!z)return null;z=1/z;b[0]=(r*p-h*s+n*H)*z;b[1]=(h*m-f*p-n*I)*z;b[2]=(f*s-r*
m+n*y)*z;b[3]=(l*s-d*p-g*H)*z;b[4]=(e*p-l*m+g*I)*z;b[5]=(d*m-e*s-g*y)*z;b[6]=(q*M-F*C+k*A)*z;b[7]=(F*G-u*M-k*v)*z;b[8]=(u*C-q*G+k*x)*z;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.Vv=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new p(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];b[1]=
a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var e=a[1],d=a[2],l=a[3],g=a[6],f=a[7],r=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=e;b[6]=a[9];b[7]=a[13];b[8]=d;b[9]=g;b[11]=a[14];b[12]=l;b[13]=f;
b[14]=r}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var e=a[0],d=a[1],l=a[2],g=a[3],f=a[4],r=a[5],h=a[6],n=a[7],m=a[8],s=a[9],p=a[10],z=a[11],u=a[12],q=a[13],F=a[14],k=a[15],x=e*r-d*f,v=e*h-l*f,G=e*n-g*f,A=d*h-l*r,C=d*n-g*r,M=l*n-g*h,y=m*q-s*u,I=m*F-p*u,H=m*k-z*u,Y=s*F-p*q,J=s*k-z*q,D=p*k-z*F,T=x*D-v*J+G*Y+A*H-C*I+M*y;if(!T)return null;
T=1/T;b[0]=(r*D-h*J+n*Y)*T;b[1]=(l*J-d*D-g*Y)*T;b[2]=(q*M-F*C+k*A)*T;b[3]=(p*C-s*M-z*A)*T;b[4]=(h*H-f*D-n*I)*T;b[5]=(e*D-l*H+g*I)*T;b[6]=(F*G-u*M-k*v)*T;b[7]=(m*M-p*G+z*v)*T;b[8]=(f*J-r*H+n*y)*T;b[9]=(d*H-e*J-g*y)*T;b[10]=(u*C-q*G+k*x)*T;b[11]=(s*G-m*C-z*x)*T;b[12]=(r*I-f*Y-h*y)*T;b[13]=(e*Y-d*I+l*y)*T;b[14]=(q*v-u*A-F*x)*T;b[15]=(m*A-s*v+p*x)*T;return b};a.adjoint=function(a,b){var e=a[0],d=a[1],l=a[2],g=a[3],f=a[4],r=a[5],h=a[6],n=a[7],m=a[8],s=a[9],p=a[10],z=a[11],u=a[12],q=a[13],F=a[14],k=a[15];
b[0]=r*(p*k-z*F)-s*(h*k-n*F)+q*(h*z-n*p);b[1]=-(d*(p*k-z*F)-s*(l*k-g*F)+q*(l*z-g*p));b[2]=d*(h*k-n*F)-r*(l*k-g*F)+q*(l*n-g*h);b[3]=-(d*(h*z-n*p)-r*(l*z-g*p)+s*(l*n-g*h));b[4]=-(f*(p*k-z*F)-m*(h*k-n*F)+u*(h*z-n*p));b[5]=e*(p*k-z*F)-m*(l*k-g*F)+u*(l*z-g*p);b[6]=-(e*(h*k-n*F)-f*(l*k-g*F)+u*(l*n-g*h));b[7]=e*(h*z-n*p)-f*(l*z-g*p)+m*(l*n-g*h);b[8]=f*(s*k-z*q)-m*(r*k-n*q)+u*(r*z-n*s);b[9]=-(e*(s*k-z*q)-m*(d*k-g*q)+u*(d*z-g*s));b[10]=e*(r*k-n*q)-f*(d*k-g*q)+u*(d*n-g*r);b[11]=-(e*(r*z-n*s)-f*(d*z-g*s)+m*
(d*n-g*r));b[12]=-(f*(s*F-p*q)-m*(r*F-h*q)+u*(r*p-h*s));b[13]=e*(s*F-p*q)-m*(d*F-l*q)+u*(d*p-l*s);b[14]=-(e*(r*F-h*q)-f*(d*F-l*q)+u*(d*h-l*r));b[15]=e*(r*p-h*s)-f*(d*p-l*s)+m*(d*h-l*r);return b};a.determinant=function(a){var b=a[0],e=a[1],d=a[2],l=a[3],g=a[4],f=a[5],r=a[6],h=a[7],n=a[8],m=a[9],s=a[10],p=a[11],z=a[12],u=a[13],q=a[14];a=a[15];return(b*f-e*g)*(s*a-p*q)-(b*r-d*g)*(m*a-p*u)+(b*h-l*g)*(m*q-s*u)+(e*r-d*f)*(n*a-p*z)-(e*h-l*f)*(n*q-s*z)+(d*h-l*r)*(n*u-m*z)};a.multiply=function(a,b,e){var d=
a[0],l=a[1],g=a[2],f=a[3],r=a[4],h=a[5],n=a[6],m=a[7],s=a[8],p=a[9],z=a[10],u=a[11],q=a[12],F=a[13],k=a[14];a=a[15];var x=b[0],v=b[1],G=b[2],A=b[3];e[0]=x*d+v*r+G*s+A*q;e[1]=x*l+v*h+G*p+A*F;e[2]=x*g+v*n+G*z+A*k;e[3]=x*f+v*m+G*u+A*a;x=b[4];v=b[5];G=b[6];A=b[7];e[4]=x*d+v*r+G*s+A*q;e[5]=x*l+v*h+G*p+A*F;e[6]=x*g+v*n+G*z+A*k;e[7]=x*f+v*m+G*u+A*a;x=b[8];v=b[9];G=b[10];A=b[11];e[8]=x*d+v*r+G*s+A*q;e[9]=x*l+v*h+G*p+A*F;e[10]=x*g+v*n+G*z+A*k;e[11]=x*f+v*m+G*u+A*a;x=b[12];v=b[13];G=b[14];A=b[15];e[12]=x*d+
v*r+G*s+A*q;e[13]=x*l+v*h+G*p+A*F;e[14]=x*g+v*n+G*z+A*k;e[15]=x*f+v*m+G*u+A*a;return e};a.mul=a.multiply;a.translate=function(a,b,e){var d=b[0],l=b[1];b=b[2];var g,f,r,h,n,m,s,p,z,u,q,F;a===e?(e[12]=a[0]*d+a[4]*l+a[8]*b+a[12],e[13]=a[1]*d+a[5]*l+a[9]*b+a[13],e[14]=a[2]*d+a[6]*l+a[10]*b+a[14],e[15]=a[3]*d+a[7]*l+a[11]*b+a[15]):(g=a[0],f=a[1],r=a[2],h=a[3],n=a[4],m=a[5],s=a[6],p=a[7],z=a[8],u=a[9],q=a[10],F=a[11],e[0]=g,e[1]=f,e[2]=r,e[3]=h,e[4]=n,e[5]=m,e[6]=s,e[7]=p,e[8]=z,e[9]=u,e[10]=q,e[11]=F,
e[12]=g*d+n*l+z*b+a[12],e[13]=f*d+m*l+u*b+a[13],e[14]=r*d+s*l+q*b+a[14],e[15]=h*d+p*l+F*b+a[15]);return e};a.scale=function(a,b,e){var d=b[0],l=b[1];b=b[2];e[0]=a[0]*d;e[1]=a[1]*d;e[2]=a[2]*d;e[3]=a[3]*d;e[4]=a[4]*l;e[5]=a[5]*l;e[6]=a[6]*l;e[7]=a[7]*l;e[8]=a[8]*b;e[9]=a[9]*b;e[10]=a[10]*b;e[11]=a[11]*b;e[12]=a[12];e[13]=a[13];e[14]=a[14];e[15]=a[15];return e};a.rotate=function(a,b,e,d){var l=e[0],g=e[1];e=e[2];var f=Math.sqrt(l*l+g*g+e*e),r,h,n,m,s,p,z,u,q,F,k,x,v,G,A,C,M,y,I,H;if(1E-7>Math.abs(f))return null;
f=1/f;l*=f;g*=f;e*=f;r=Math.sin(b);h=Math.cos(b);n=1-h;b=a[0];f=a[1];m=a[2];s=a[3];p=a[4];z=a[5];u=a[6];q=a[7];F=a[8];k=a[9];x=a[10];v=a[11];G=l*l*n+h;A=g*l*n+e*r;C=e*l*n-g*r;M=l*g*n-e*r;y=g*g*n+h;I=e*g*n+l*r;H=l*e*n+g*r;l=g*e*n-l*r;g=e*e*n+h;d[0]=b*G+p*A+F*C;d[1]=f*G+z*A+k*C;d[2]=m*G+u*A+x*C;d[3]=s*G+q*A+v*C;d[4]=b*M+p*y+F*I;d[5]=f*M+z*y+k*I;d[6]=m*M+u*y+x*I;d[7]=s*M+q*y+v*I;d[8]=b*H+p*l+F*g;d[9]=f*H+z*l+k*g;d[10]=m*H+u*l+x*g;d[11]=s*H+q*l+v*g;a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);
return d};a.rotateX=function(a,b,e){var d=Math.sin(b);b=Math.cos(b);var l=a[4],g=a[5],f=a[6],r=a[7],h=a[8],n=a[9],m=a[10],s=a[11];a!==e&&(e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);e[4]=l*b+h*d;e[5]=g*b+n*d;e[6]=f*b+m*d;e[7]=r*b+s*d;e[8]=h*b-l*d;e[9]=n*b-g*d;e[10]=m*b-f*d;e[11]=s*b-r*d;return e};a.rotateY=function(a,b,e){var d=Math.sin(b);b=Math.cos(b);var l=a[0],g=a[1],f=a[2],r=a[3],h=a[8],n=a[9],m=a[10],s=a[11];a!==e&&(e[4]=a[4],e[5]=a[5],e[6]=a[6],
e[7]=a[7],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);e[0]=l*b-h*d;e[1]=g*b-n*d;e[2]=f*b-m*d;e[3]=r*b-s*d;e[8]=l*d+h*b;e[9]=g*d+n*b;e[10]=f*d+m*b;e[11]=r*d+s*b;return e};a.rotateZ=function(a,b,e){var d=Math.sin(b);b=Math.cos(b);var l=a[0],g=a[1],f=a[2],r=a[3],h=a[4],n=a[5],m=a[6],s=a[7];a!==e&&(e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);e[0]=l*b+h*d;e[1]=g*b+n*d;e[2]=f*b+m*d;e[3]=r*b+s*d;e[4]=h*b-l*d;e[5]=n*b-g*d;e[6]=m*b-f*d;e[7]=s*b-r*d;return e};
a.Yv=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.Xv=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.Wv=function(a,b,e){var d=b[0],l=b[1];b=b[2];var g=Math.sqrt(d*d+l*l+b*b),f;if(1E-7>Math.abs(g))return null;g=1/g;d*=g;l*=g;b*=g;g=Math.sin(a);a=Math.cos(a);f=1-a;e[0]=d*d*f+a;e[1]=l*d*f+b*
g;e[2]=b*d*f-l*g;e[3]=0;e[4]=d*l*f-b*g;e[5]=l*l*f+a;e[6]=b*l*f+d*g;e[7]=0;e[8]=d*b*f+l*g;e[9]=l*b*f-d*g;e[10]=b*b*f+a;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e};a.FB=function(a,b){var e=Math.sin(a),d=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=d;b[6]=e;b[7]=0;b[8]=0;b[9]=-e;b[10]=d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.GB=function(a,b){var e=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=0;b[2]=-e;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=e;b[9]=0;b[10]=d;b[11]=0;b[12]=0;b[13]=0;
b[14]=0;b[15]=1;return b};a.HB=function(a,b){var e=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=e;b[2]=0;b[3]=0;b[4]=-e;b[5]=d;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,e){var d=a[0],l=a[1],g=a[2],f=a[3],r=d+d,h=l+l,n=g+g;a=d*r;var m=d*h,d=d*n,s=l*h,l=l*n,g=g*n,r=f*r,h=f*h,f=f*n;e[0]=1-(s+g);e[1]=m+f;e[2]=d-h;e[3]=0;e[4]=m-f;e[5]=1-(a+g);e[6]=l+r;e[7]=0;e[8]=d+h;e[9]=l-r;e[10]=1-(a+s);e[11]=0;e[12]=b[0];e[13]=b[1];e[14]=b[2];
e[15]=1;return e};a.fromQuat=function(a,b){var e=a[0],d=a[1],l=a[2],g=a[3],f=e+e,r=d+d,h=l+l,e=e*f,n=d*f,d=d*r,m=l*f,s=l*r,l=l*h,f=g*f,r=g*r,g=g*h;b[0]=1-d-l;b[1]=n+g;b[2]=m-r;b[3]=0;b[4]=n-g;b[5]=1-e-l;b[6]=s+f;b[7]=0;b[8]=m+r;b[9]=s-f;b[10]=1-e-d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,e,d,l,g,f){var r=1/(b-a),h=1/(d-e),n=1/(l-g);f[0]=2*l*r;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2*l*h;f[6]=0;f[7]=0;f[8]=(b+a)*r;f[9]=(d+e)*h;f[10]=(g+l)*n;f[11]=-1;f[12]=0;f[13]=0;f[14]=
g*l*2*n;f[15]=0;return f};a.perspective=function(a,b,e,d,l){a=1/Math.tan(a/2);var g=1/(e-d);l[0]=a/b;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=a;l[6]=0;l[7]=0;l[8]=0;l[9]=0;l[10]=(d+e)*g;l[11]=-1;l[12]=0;l[13]=0;l[14]=2*d*e*g;l[15]=0;return l};a.DC=function(a,b,e,d){var l=Math.tan(a.WC*Math.PI/180),g=Math.tan(a.sB*Math.PI/180),f=Math.tan(a.pC*Math.PI/180);a=Math.tan(a.EC*Math.PI/180);var r=2/(f+a),h=2/(l+g);d[0]=r;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=h;d[6]=0;d[7]=0;d[8]=-((f-a)*r*.5);d[9]=(l-g)*h*.5;d[10]=e/
(b-e);d[11]=-1;d[12]=0;d[13]=0;d[14]=e*b/(b-e);d[15]=0;return d};a.ortho=function(a,b,e,d,l,g,f){var r=1/(a-b),h=1/(e-d),n=1/(l-g);f[0]=-2*r;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=-2*h;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=2*n;f[11]=0;f[12]=(a+b)*r;f[13]=(d+e)*h;f[14]=(g+l)*n;f[15]=1;return f};a.lookAt=function(c,b,e,d){var l,g,f,r,h,n,m,s,p=c[0],z=c[1];c=c[2];f=e[0];r=e[1];g=e[2];m=b[0];e=b[1];l=b[2];if(1E-7>Math.abs(p-m)&&1E-7>Math.abs(z-e)&&1E-7>Math.abs(c-l))return a.identity(d);b=p-m;e=z-e;m=c-l;s=1/Math.sqrt(b*
b+e*e+m*m);b*=s;e*=s;m*=s;l=r*m-g*e;g=g*b-f*m;f=f*e-r*b;(s=Math.sqrt(l*l+g*g+f*f))?(s=1/s,l*=s,g*=s,f*=s):f=g=l=0;r=e*f-m*g;h=m*l-b*f;n=b*g-e*l;(s=Math.sqrt(r*r+h*h+n*n))?(s=1/s,r*=s,h*=s,n*=s):n=h=r=0;d[0]=l;d[1]=r;d[2]=b;d[3]=0;d[4]=g;d[5]=h;d[6]=e;d[7]=0;d[8]=f;d[9]=n;d[10]=m;d[11]=0;d[12]=-(l*p+g*z+f*c);d[13]=-(r*p+h*z+n*c);d[14]=-(b*p+e*z+m*c);d[15]=1;return d};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+
a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.Vv=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.__gpp_eval=function(a){a.Kq=function(){function a(c,b,e,d,l,g){this.message=c;this.offset=d;this.Zh=l;this.jg=g;this.name="SyntaxError"}(function(a,b){function e(){this.constructor=a}e.prototype=b.prototype;a.prototype=new e})(a,Error);return{SyntaxError:a,parse:function(c){function b(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function e(a){if(hb!==a){hb>a&&(hb=0,bb={Zh:1,jg:1,si:!1});var b=bb,d,e;for(d=
hb;d<a;d++)e=c.charAt(d),"\n"===e?(b.si||b.Zh++,b.jg=1,b.si=!1):"\r"===e||"\u2028"===e||"\u2029"===e?(b.Zh++,b.jg=1,b.si=!0):(b.jg++,b.si=!1);hb=a}return bb}function d(a){E<cb||(E>cb&&(cb=E,na=[]),na.push(a))}function l(){var a,b,e;a=E;b=O();b!==w?(b=g(),b!==w?(e=O(),e!==w?(Z++,10===c.charCodeAt(E)?(e=kc,E++):(e=w,0===Z&&d(Ya)),e===w&&(c.substr(E,2)===lc?(e=lc,E+=2):(e=w,0===Z&&d(Ub)),e===w&&(13===c.charCodeAt(E)?(e=gb,E++):(e=w,0===Z&&d(cc)))),Z--,e===w&&0===Z&&d(jc),e===w&&(e=null),e!==w?a=b:(E=
a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w);return a}function g(){var a,b,e,g,h,m,k,l;a=E;b=f();if(b!==w){e=[];g=E;h=O();h!==w?(44===c.charCodeAt(E)?(m=L,E++):(m=w,0===Z&&d(S)),m!==w?(k=O(),k!==w?(l=f(),l!==w?g=h=[h,m,k,l]:(E=g,g=w)):(E=g,g=w)):(E=g,g=w)):(E=g,g=w);for(;g!==w;)e.push(g),g=E,h=O(),h!==w?(44===c.charCodeAt(E)?(m=L,E++):(m=w,0===Z&&d(S)),m!==w?(k=O(),k!==w?(l=f(),l!==w?g=h=[h,m,k,l]:(E=g,g=w)):(E=g,g=w)):(E=g,g=w)):(E=g,g=w);e!==w?a=b=0==e.length?b:e[e.length-1]:(E=a,a=w)}else E=a,a=w;return a}
function f(){var a,b,e,f;a=E;b=r();b!==w?(e=O(),e!==w?(63===c.charCodeAt(E)?(e=W,E++):(e=w,0===Z&&d(ja)),e!==w?(e=O(),e!==w?(e=g(),e!==w?(f=O(),f!==w?(58===c.charCodeAt(E)?(f=qa,E++):(f=w,0===Z&&d(P)),f!==w?(f=O(),f!==w?(f=g(),f!==w?a=b?e:f:(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w);a===w&&(a=r());return a}function r(){var a,b,c,d,e,f,g,m;a=E;b=h();if(b!==w){c=[];d=E;e=O();e!==w?(f=ca(),f!==w?(g=O(),g!==w?(m=h(),m!==w?d=e=[e,f,g,m]:(E=d,d=w)):
(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==w;)c.push(d),d=E,e=O(),e!==w?(f=ca(),f!==w?(g=O(),g!==w?(m=h(),m!==w?d=e=[e,f,g,m]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else E=a,a=w}else E=a,a=w;return a}function h(){var a,b,c,d,e,f,g,h;a=E;b=n();if(b!==w){c=[];d=E;e=O();e!==w?(f=N(),f!==w?(g=O(),g!==w?(h=n(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==w;)c.push(d),d=E,e=O(),e!==w?(f=N(),f!==w?(g=O(),g!==w?(h=n(),h!==w?d=e=
[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else E=a,a=w}else E=a,a=w;return a}function n(){var a,b,c,d,e,f,g,h;a=E;b=m();if(b!==w){c=[];d=E;e=O();e!==w?(f=R(),f!==w?(g=O(),g!==w?(h=m(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==w;)c.push(d),d=E,e=O(),e!==w?(f=R(),f!==w?(g=O(),g!==w?(h=m(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)a|=c[b][3];else E=a,a=w}else E=
a,a=w;return a}function m(){var a,b,c,d,e,f,g,h;a=E;b=s();if(b!==w){c=[];d=E;e=O();e!==w?(f=K(),f!==w?(g=O(),g!==w?(h=s(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==w;)c.push(d),d=E,e=O(),e!==w?(f=K(),f!==w?(g=O(),g!==w?(h=s(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else E=a,a=w}else E=a,a=w;return a}function s(){var a,b,c,d,e,f,g,h;a=E;b=B();if(b!==w){c=[];d=E;e=O();e!==w?(f=T(),f!==w?(g=O(),g!==w?
(h=B(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==w;)c.push(d),d=E,e=O(),e!==w?(f=T(),f!==w?(g=O(),g!==w?(h=B(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else E=a,a=w}else E=a,a=w;return a}function B(){var a,b,c,d,e,f,g,h;a=E;b=z();if(b!==w){c=[];d=E;e=O();e!==w?(f=D(),f!==w?(g=O(),g!==w?(h=z(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==w;)c.push(d),d=E,e=O(),e!==w?(f=D(),
f!==w?(g=O(),g!==w?(h=z(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else E=a,a=w}else E=a,a=w;return a}function z(){var a,b,c,d,e,f,g,h;a=E;b=u();if(b!==w){c=[];d=E;e=O();e!==w?(f=J(),f!==w?(g=O(),g!==w?(h=u(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==w;)c.push(d),d=E,e=O(),e!==w?(f=J(),f!==w?(g=O(),g!==w?(h=u(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=
d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else E=a,a=w}else E=a,a=w;return a}function u(){var a,b,c,d,e,f,g,h;a=E;b=q();if(b!==w){c=[];d=E;e=O();e!==w?(f=Y(),f!==w?(g=O(),g!==w?(h=q(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==w;)c.push(d),d=E,e=O(),e!==w?(f=Y(),f!==w?(g=O(),g!==w?(h=q(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=
w)):(E=d,d=w)):(E=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else E=a,a=w}else E=a,a=w;return a}function q(){var a,b,c,d,e,f,g,h;a=E;b=F();if(b!==w){c=[];d=E;e=O();e!==w?(f=H(),f!==w?(g=O(),g!==w?(h=F(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==w;)c.push(d),d=E,e=O(),e!==w?(f=H(),f!==w?(g=O(),g!==w?(h=F(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "+":a+=
c[b][3];break;case "-":a-=c[b][3]}else E=a,a=w}else E=a,a=w;return a}function F(){var a,b,c,d,e,f,g,h;a=E;b=k();if(b!==w){c=[];d=E;e=O();e!==w?(f=I(),f!==w?(g=O(),g!==w?(h=k(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==w;)c.push(d),d=E,e=O(),e!==w?(f=I(),f!==w?(g=O(),g!==w?(h=k(),h!==w?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "*":a*=c[b][3];break;case "/":a=Math.floor(a/c[b][3]);break;case "%":a%=
c[b][3]}else E=a,a=w}else E=a,a=w;return a}function k(){var a,e,f;a=E;c.substr(E,7)===U?(e=U,E+=7):(e=w,0===Z&&d(t));e!==w?(f=O(),f!==w?(f=v(),f!==w?a=f:(E=a,a=w)):(E=a,a=w)):(E=a,a=w);if(a===w){a=E;e=x();if(e!==w)if(f=O(),f!==w)if(c.substr(E,2)===xa?(f=xa,E+=2):(f=w,0===Z&&d(Ea)),f===w&&(c.substr(E,2)===sa?(f=sa,E+=2):(f=w,0===Z&&d(Ha))),f!==w){a:{a=e;switch(f){case "++":e=++a;break a;case "--":e=--a;break a}e=void 0}a=e}else E=a,a=w;else E=a,a=w;else E=a,a=w;a===w&&(a=x());a===w&&(a=E,c.substr(E,
2)===xa?(e=xa,E+=2):(e=w,0===Z&&d(Ea)),e===w&&(c.substr(E,2)===sa?(e=sa,E+=2):(e=w,0===Z&&d(Ha)),e===w&&(43===c.charCodeAt(E)?(e=Pa,E++):(e=w,0===Z&&d(pb)),e===w&&(45===c.charCodeAt(E)?(e=Lb,E++):(e=w,0===Z&&d(nb)),e===w&&(126===c.charCodeAt(E)?(e=Yb,E++):(e=w,0===Z&&d(ob)),e===w&&(33===c.charCodeAt(E)?(e=uc,E++):(e=w,0===Z&&d(hc))))))),e!==w?(f=O(),f!==w?(f=k(),f!==w?a=e=b(e,f):(E=a,a=w)):(E=a,a=w)):(E=a,a=w))}return a}function x(){var a,b,e;Z++;var f;a=E;48===c.charCodeAt(E)?(b=ia,E++):(b=w,0===
Z&&d(Q));if(b!==w)if(wa.test(c.charAt(E))?(b=c.charAt(E),E++):(b=w,0===Z&&d(Za)),b!==w){b=E;e=[];f=A();if(f!==w)for(;f!==w;)e.push(f),f=A();else e=w;b=e!==w?c.substring(b,E):e;b!==w?a=b=parseInt("0x"+b):(E=a,a=w)}else E=a,a=w;else E=a,a=w;if(a===w){a=E;48===c.charCodeAt(E)?(b=ia,E++):(b=w,0===Z&&d(Q));if(b===w)if(b=E,Ga.test(c.charAt(E))?(e=c.charAt(E),E++):(e=w,0===Z&&d(ta)),e!==w){var h;f=[];h=G();if(h!==w)for(;h!==w;)f.push(h),h=G();else f=w;f===w&&(f=null);f!==w?b=e=[e,f]:(E=b,b=w)}else E=b,b=
w;a=b!==w?c.substring(a,E):b;a!==w&&(a=parseInt(a))}Z--;a===w&&0===Z&&d(da);a===w&&(b=C(),b!==w&&(b=0),a=b,a===w&&(a=E,40===c.charCodeAt(E)?(b=V,E++):(b=w,0===Z&&d(oa)),b!==w?(b=O(),b!==w?(b=g(),b!==w?(e=O(),e!==w?(41===c.charCodeAt(E)?(e=ra,E++):(e=w,0===Z&&d(ma)),e!==w?a=b:(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)));return a}function v(){var a,b,e,f,g;b=C();b!==w&&(b=0);a=b;if(a===w){b=[];f=e=E;Z++;40===c.charCodeAt(E)?(g=V,E++):(g=w,0===Z&&d(oa));g===w&&(41===c.charCodeAt(E)?(g=ra,
E++):(g=w,0===Z&&d(ma)));Z--;g===w?f=void 0:(E=f,f=w);f!==w?(g=X(),g!==w?e=f=[f,g]:(E=e,e=w)):(E=e,e=w);if(e!==w)for(;e!==w;)b.push(e),f=e=E,Z++,40===c.charCodeAt(E)?(g=V,E++):(g=w,0===Z&&d(oa)),g===w&&(41===c.charCodeAt(E)?(g=ra,E++):(g=w,0===Z&&d(ma))),Z--,g===w?f=void 0:(E=f,f=w),f!==w?(g=X(),g!==w?e=f=[f,g]:(E=e,e=w)):(E=e,e=w);else b=w;b!==w&&(b=1);a=b;a===w&&(a=E,40===c.charCodeAt(E)?(b=V,E++):(b=w,0===Z&&d(oa)),b!==w?(e=O(),e!==w?(f=v(),f!==w?(g=O(),g!==w?(41===c.charCodeAt(E)?(b=ra,E++):(b=
w,0===Z&&d(ma)),b!==w?a=f:(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w))}return a}function G(){var a;ya.test(c.charAt(E))?(a=c.charAt(E),E++):(a=w,0===Z&&d(fa));return a}function A(){var a;Sa.test(c.charAt(E))?(a=c.charAt(E),E++):(a=w,0===Z&&d(Oa));return a}function C(){var a,b;Z++;b=a=E;Z++;var e,f,g,h;e=E;c.substr(E,7)===U?(f=U,E+=7):(f=w,0===Z&&d(t));f!==w?(g=E,Z++,h=y(),Z--,h===w?g=void 0:(E=g,g=w),g!==w?e=f=[f,g]:(E=e,e=w)):(E=e,e=w);Z--;e===w?b=void 0:(E=b,b=w);if(b!==w){Z++;b=E;e=M();
if(e!==w){f=[];for(g=y();g!==w;)f.push(g),g=y();f!==w?b=e+=f.join(""):(E=b,b=w)}else E=b,b=w;Z--;b===w&&0===Z&&d(za);b!==w?a=b:(E=a,a=w)}else E=a,a=w;Z--;a===w&&0===Z&&d(za);return a}function M(){var a;Va.test(c.charAt(E))?(a=c.charAt(E),E++):(a=w,0===Z&&d(ua));a===w&&(36===c.charCodeAt(E)?(a=Ta,E++):(a=w,0===Z&&d(pa)),a===w&&(95===c.charCodeAt(E)?(a=tc,E++):(a=w,0===Z&&d(la))));return a}function y(){var a;a=M();a===w&&(a=G());return a}function I(){var a,b,e,f;a=E;42===c.charCodeAt(E)?(b=kb,E++):
(b=w,0===Z&&d(Aa));b===w&&(47===c.charCodeAt(E)?(b=fb,E++):(b=w,0===Z&&d(zb)),b===w&&(37===c.charCodeAt(E)?(b=ic,E++):(b=w,0===Z&&d(Ab))));b!==w?(e=E,Z++,61===c.charCodeAt(E)?(f=$a,E++):(f=w,0===Z&&d(eb)),Z--,f===w?e=void 0:(E=e,e=w),e!==w?a=b:(E=a,a=w)):(E=a,a=w);return a}function H(){var a,b,e;a=E;43===c.charCodeAt(E)?(b=Pa,E++):(b=w,0===Z&&d(pb));b!==w?(b=E,Z++,43===c.charCodeAt(E)?(e=Pa,E++):(e=w,0===Z&&d(pb)),e===w&&(61===c.charCodeAt(E)?(e=$a,E++):(e=w,0===Z&&d(eb))),Z--,e===w?b=void 0:(E=b,
b=w),b!==w?a="+":(E=a,a=w)):(E=a,a=w);a===w&&(a=E,45===c.charCodeAt(E)?(b=Lb,E++):(b=w,0===Z&&d(nb)),b!==w?(b=E,Z++,45===c.charCodeAt(E)?(e=Lb,E++):(e=w,0===Z&&d(nb)),e===w&&(61===c.charCodeAt(E)?(e=$a,E++):(e=w,0===Z&&d(eb))),Z--,e===w?b=void 0:(E=b,b=w),b!==w?a="-":(E=a,a=w)):(E=a,a=w));return a}function Y(){var a;c.substr(E,2)===Ja?(a=Ja,E+=2):(a=w,0===Z&&d(Zb));a===w&&(c.substr(E,2)===Xa?(a=Xa,E+=2):(a=w,0===Z&&d(Ia)));return a}function J(){var a;c.substr(E,2)===Bb?(a=Bb,E+=2):(a=w,0===Z&&d(Sb));
a===w&&(c.substr(E,2)===qb?(a=qb,E+=2):(a=w,0===Z&&d(Wa)),a===w&&(60===c.charCodeAt(E)?(a=ab,E++):(a=w,0===Z&&d(Ca)),a===w&&(62===c.charCodeAt(E)?(a=rb,E++):(a=w,0===Z&&d(Mb)))));return a}function D(){var a;c.substr(E,2)===va?(a=va,E+=2):(a=w,0===Z&&d(tb));a===w&&(c.substr(E,2)===ea?(a=ea,E+=2):(a=w,0===Z&&d(Nb)));return a}function T(){var a,b,e;a=E;38===c.charCodeAt(E)?(b=Ba,E++):(b=w,0===Z&&d(Da));b!==w?(b=E,Z++,38===c.charCodeAt(E)?(e=Ba,E++):(e=w,0===Z&&d(Da)),Z--,e===w?b=void 0:(E=b,b=w),b!==
w?a="&":(E=a,a=w)):(E=a,a=w);return a}function K(){var a,b,e;a=E;94===c.charCodeAt(E)?(b=Fa,E++):(b=w,0===Z&&d(xb));b!==w?(b=E,Z++,94===c.charCodeAt(E)?(e=Fa,E++):(e=w,0===Z&&d(xb)),Z--,e===w?b=void 0:(E=b,b=w),b!==w?a="^":(E=a,a=w)):(E=a,a=w);return a}function R(){var a,b,e;a=E;124===c.charCodeAt(E)?(b=yb,E++):(b=w,0===Z&&d(Qa));b!==w?(b=E,Z++,124===c.charCodeAt(E)?(e=yb,E++):(e=w,0===Z&&d(Qa)),Z--,e===w?b=void 0:(E=b,b=w),b!==w?a="|":(E=a,a=w)):(E=a,a=w);return a}function N(){var a;c.substr(E,2)===
Ob?(a=Ob,E+=2):(a=w,0===Z&&d(lb));a!==w&&(a="&&");return a}function ca(){var a;c.substr(E,2)===Pb?(a=Pb,E+=2):(a=w,0===Z&&d(bc));a!==w&&(a="||");return a}function O(){var a,b;a=[];for(b=aa();b!==w;)a.push(b),b=aa();return a}function aa(){var a;Z++;Tb.test(c.charAt(E))?(a=c.charAt(E),E++):(a=w,0===Z&&d(Gb));Z--;a===w&&0===Z&&d(vc);return a}function X(){var a;c.length>E?(a=c.charAt(E),E++):(a=w,0===Z&&d(ub));return a}var ba=1<arguments.length?arguments[1]:{},w={},ga={start:l},ka=l,L=",",S={type:"literal",
value:",",description:'","'},W="?",ja={type:"literal",value:"?",description:'"?"'},qa=":",P={type:"literal",value:":",description:'":"'},U="defined",t={type:"literal",value:"defined",description:'"defined"'},V="(",oa={type:"literal",value:"(",description:'"("'},ra=")",ma={type:"literal",value:")",description:'")"'},da={type:"other",description:"number"},ia="0",Q={type:"literal",value:"0",description:'"0"'},ya=/^[0-9]/,fa={type:"class",value:"[0-9]",description:"[0-9]"},Ga=/^[1-9]/,ta={type:"class",
value:"[1-9]",description:"[1-9]"},wa=/^[xX]/,Za={type:"class",value:"[xX]",description:"[xX]"},Sa=/^[0-9a-fA-F]/,Oa={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},za={type:"other",description:"identifier"},Ta="$",pa={type:"literal",value:"$",description:'"$"'},tc="_",la={type:"literal",value:"_",description:'"_"'},Va=/^[a-zA-Z]/,ua={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},xa="++",Ea={type:"literal",value:"++",description:'"++"'},sa="--",Ha={type:"literal",value:"--",description:'"--"'},
Pa="+",pb={type:"literal",value:"+",description:'"+"'},Lb="-",nb={type:"literal",value:"-",description:'"-"'},Yb="~",ob={type:"literal",value:"~",description:'"~"'},uc="!",hc={type:"literal",value:"!",description:'"!"'},kb="*",Aa={type:"literal",value:"*",description:'"*"'},fb="/",zb={type:"literal",value:"/",description:'"/"'},ic="%",Ab={type:"literal",value:"%",description:'"%"'},$a="=",eb={type:"literal",value:"=",description:'"="'},Ja="<<",Zb={type:"literal",value:"<<",description:'"<<"'},Xa=
">>",Ia={type:"literal",value:">>",description:'">>"'},Bb="<=",Sb={type:"literal",value:"<=",description:'"<="'},qb=">=",Wa={type:"literal",value:">=",description:'">="'},ab="<",Ca={type:"literal",value:"<",description:'"<"'},rb=">",Mb={type:"literal",value:">",description:'">"'},va="==",tb={type:"literal",value:"==",description:'"=="'},ea="!=",Nb={type:"literal",value:"!=",description:'"!="'},Ba="&",Da={type:"literal",value:"&",description:'"&"'},Fa="^",xb={type:"literal",value:"^",description:'"^"'},
yb="|",Qa={type:"literal",value:"|",description:'"|"'},Ob="&&",lb={type:"literal",value:"&&",description:'"&&"'},Pb="||",bc={type:"literal",value:"||",description:'"||"'},vc={type:"other",description:"whitespace"},Tb=/^[\t\x0B\f ]/,Gb={type:"class",value:"[\\t\\v\\f ]",description:"[\\t\\v\\f ]"},jc={type:"other",description:"end of line"},kc="\n",Ya={type:"literal",value:"\n",description:'"\\n"'},lc="\r\n",Ub={type:"literal",value:"\r\n",description:'"\\r\\n"'},gb="\r",cc={type:"literal",value:"\r",
description:'"\\r"'},ub={type:"any",description:"any character"},E=0,hb=0,bb={Zh:1,jg:1,si:!1},cb=0,na=[],Z=0,Ka;if("startRule"in ba){if(!(ba.xr in ga))throw Error("Can't start parsing from rule \""+ba.xr+'".');ka=ga[ba.xr]}Ka=ka();if(Ka!==w&&E===c.length)return Ka;Ka!==w&&E<c.length&&d({type:"end",description:"end of input"});throw function(b,d,f){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,
1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0100-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,function(a){return"\\u"+b(a)})}
var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var m=e(f),k=f<c.length?c.charAt(f):null;null!==d&&g(d);return new a(null!==b?b:h(d,k),0,0,f,m.Zh,m.jg)}(null,na,cb);}}}()};b4w.module.__md5=function(a){function p(a,f){var l=a[0],h=a[1],n=a[2],m=a[3],l=b(l,h,n,m,f[0],7,-680876936),m=b(m,l,h,n,f[1],12,-389564586),n=b(n,m,l,h,f[2],17,606105819),h=b(h,n,m,l,f[3],22,-1044525330),l=b(l,h,n,m,f[4],7,-176418897),m=b(m,l,h,n,f[5],12,1200080426),n=b(n,m,l,h,f[6],17,-1473231341),h=b(h,n,m,l,f[7],22,-45705983),l=b(l,h,n,m,f[8],7,1770035416),m=b(m,l,h,n,f[9],12,-1958414417),n=b(n,m,l,h,f[10],17,-42063),h=b(h,n,m,l,f[11],22,-1990404162),l=b(l,h,n,m,f[12],7,1804603682),m=b(m,l,h,n,
f[13],12,-40341101),n=b(n,m,l,h,f[14],17,-1502002290),h=b(h,n,m,l,f[15],22,1236535329),l=e(l,h,n,m,f[1],5,-165796510),m=e(m,l,h,n,f[6],9,-1069501632),n=e(n,m,l,h,f[11],14,643717713),h=e(h,n,m,l,f[0],20,-373897302),l=e(l,h,n,m,f[5],5,-701558691),m=e(m,l,h,n,f[10],9,38016083),n=e(n,m,l,h,f[15],14,-660478335),h=e(h,n,m,l,f[4],20,-405537848),l=e(l,h,n,m,f[9],5,568446438),m=e(m,l,h,n,f[14],9,-1019803690),n=e(n,m,l,h,f[3],14,-187363961),h=e(h,n,m,l,f[8],20,1163531501),l=e(l,h,n,m,f[13],5,-1444681467),m=
e(m,l,h,n,f[2],9,-51403784),n=e(n,m,l,h,f[7],14,1735328473),h=e(h,n,m,l,f[12],20,-1926607734),l=c(h^n^m,l,h,f[5],4,-378558),m=c(l^h^n,m,l,f[8],11,-2022574463),n=c(m^l^h,n,m,f[11],16,1839030562),h=c(n^m^l,h,n,f[14],23,-35309556),l=c(h^n^m,l,h,f[1],4,-1530992060),m=c(l^h^n,m,l,f[4],11,1272893353),n=c(m^l^h,n,m,f[7],16,-155497632),h=c(n^m^l,h,n,f[10],23,-1094730640),l=c(h^n^m,l,h,f[13],4,681279174),m=c(l^h^n,m,l,f[0],11,-358537222),n=c(m^l^h,n,m,f[3],16,-722521979),h=c(n^m^l,h,n,f[6],23,76029189),l=
c(h^n^m,l,h,f[9],4,-640364487),m=c(l^h^n,m,l,f[12],11,-421815835),n=c(m^l^h,n,m,f[15],16,530742520),h=c(n^m^l,h,n,f[2],23,-995338651),l=d(l,h,n,m,f[0],6,-198630844),m=d(m,l,h,n,f[7],10,1126891415),n=d(n,m,l,h,f[14],15,-1416354905),h=d(h,n,m,l,f[5],21,-57434055),l=d(l,h,n,m,f[12],6,1700485571),m=d(m,l,h,n,f[3],10,-1894986606),n=d(n,m,l,h,f[10],15,-1051523),h=d(h,n,m,l,f[1],21,-2054922799),l=d(l,h,n,m,f[8],6,1873313359),m=d(m,l,h,n,f[15],10,-30611744),n=d(n,m,l,h,f[6],15,-1560198380),h=d(h,n,m,l,f[13],
21,1309151649),l=d(l,h,n,m,f[4],6,-145523070),m=d(m,l,h,n,f[11],10,-1120210379),n=d(n,m,l,h,f[2],15,718787259),h=d(h,n,m,l,f[9],21,-343485551);a[0]=l+a[0]&4294967295;a[1]=h+a[1]&4294967295;a[2]=n+a[2]&4294967295;a[3]=m+a[3]&4294967295}function c(a,b,c,d,e,m){b=(b+a&4294967295)+(d+m&4294967295)&4294967295;return(b<<e|b>>>32-e)+c&4294967295}function b(a,b,d,e,l,m,s){return c(b&d|~b&e,a,b,l,m,s)}function e(a,b,d,e,l,m,s){return c(b&e|d&~e,a,b,l,m,s)}function d(a,b,d,e,l,m,s){return c(d^(b|~e),a,b,l,
m,s)}var l="0123456789abcdef".split("");a.Mp=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var e=b.substring(d-64,d),m=[],s=void 0,s=0;64>s;s+=4)m[s>>2]=e.charCodeAt(s)+(e.charCodeAt(s+1)<<8)+(e.charCodeAt(s+2)<<16)+(e.charCodeAt(s+3)<<24);p(a,m)}b=b.substring(d-64);e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)e[d>>2]|=b.charCodeAt(d)<<(d%4<<3);e[d>>2]|=128<<(d%4<<3);if(55<d)for(p(a,e),d=0;16>d;d++)e[d]=0;e[14]=8*
c;p(a,e);for(b=0;b<a.length;b++){c=a[b];d="";for(e=0;4>e;e++)d+=l[c>>8*e+4&15]+l[c>>8*e&15];a[b]=d}return a.join("")}};b4w.module.shader_texts=function(a){a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_glow_intensity",";"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",
b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_glow_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},
{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",
a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 cl = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"cl = mix ( cl , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 cm = vec3 ( 0.0 ) ; vec3 cn = vec3 ( 0.0 ) ; vec3 co = vec3 ( 0.0 ) ; bt ( cl , cm , cn , co ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","cp","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cp = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 cq = ( u_model_matrix * vec4 ( cp , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",
b:"mat4 cr = ag ( u_camera_eye , cq , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 cr = aa ( u_camera_eye , cq , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 cs = ( u_model_matrix * vec4 ( cp , 1.0 ) ) . xyz ; cr = cr * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , cs ) ;".split(" ")}]}}]},{type:"textline",b:"d ct = an ( cl - cp , cp , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , cr ) ; ct . b = cq ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"d ct = an ( cl , cp , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","cu","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cu = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ck ( ct . a , ct . b , cu ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = aq ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( ct . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ;".split(" ")}]}}]},{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_shadow_mask",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"shadow.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:"float ft = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float ft = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( ft < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cs ( cF ) ;".split(" ")}]}},
{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( fn ( cL . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"WIND_BEND && MAIN_BEND_COL && DETAIL_BEND || SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:"BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},
{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 gw = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"gw = mix ( gw , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 gx = vec3 ( 0.0 ) ; vec3 gy = vec3 ( 0.0 ) ; vec3 gz = vec3 ( 0.0 ) ; bt ( gw , gx , gy , gz ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","gA","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d gB = gh ( gw , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gA , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gC = ( u_model_matrix * vec4 ( gA , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! HAIR_BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["mat4","gD","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["mat4","gD",
"=","u_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 gE = ag ( u_camera_eye , gC , gD , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 gE = aa ( u_camera_eye , gC , gD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 gF = ( u_model_matrix * vec4 ( gA , 1.0 ) ) . xyz ; gE = gE * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , gF ) ;".split(" ")}]}}]},
{type:"textline",b:"d gB = an ( gw - gA , gA , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gE ) ; gB . b = gC ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d gB = an ( gw , gA , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","gG","=","a_normal",
";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gG = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ck ( gB . a , gB . b , gG ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gH = u_view_matrix * vec4 ( gB . a , 1.0 ) ; vec4 gI = u_proj_matrix * gH ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"gI . xy += u_subpixel_jitter * gI . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:"a = aq ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gr ( gB . a ) ; cL = gH ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"cF = - gH . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 gJ = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; float gK = SHADOW_TEX_RES / 2.0 ; gJ = floor ( gJ * gK + 0.5 ) / gK - gJ ; gI . xy += gJ ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gI",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","gw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gw",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gw",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","gw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( gw , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , gw ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",
b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],
group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gw",";"]}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gw",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gx = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; mat4 gy = aa ( u_camera_eye , gx , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"gy = gy * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"d gz = an ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gy ) ; gz . b = gx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d gz = an ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gA = u_proj_matrix * u_view_matrix * vec4 ( gz . a , 1.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gw = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["gw","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gw","=","a_grass_color",";"]}]}}]}]}}]},
{type:"textline",b:["gl_Position","=","gA",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 gE ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float gF ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",
">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int gG = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int gG = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float gI ( float gH ) { return gH - floor ( gH * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void gR ( inout float gJ , in float gK [ gG ] , in float gL ) { for ( int gM = 0 ; gM < NUM_RINGS ; gM ++ ) { float gN = 40.0 * gK [ gM ] ; float gO = 300.0 * ( gI ( gN ) - 0.005 ) ; float gP = gN ; float gQ = abs ( gP * ( u_halo_size * gO - gL ) ) ; gJ += 1.0 - min ( gQ , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void g_ ( inout float gS , in float gT [ gG ] , in float gU ) { for ( int gV = 0 ; gV < NUM_LINES ; gV ++ ) { float gW = gT [ gV ] ; float gX = gW ; float gY = 1000.0 * ( gI ( gW ) - 0.005 ) ; float gZ = 20.0 * abs ( gX * a . x + gY * a . y ) ; gS += 1.0 - min ( gZ , 1.0 ) ; } gS *= gU ; }".split(" ")}]}}]},{type:"textline",b:"void hg ( inout float ha , in vec2 hb ) { float hc , hd ; hd = atan ( hb . y , hb . x ) ; hd *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float he = cos ( hd ) ; float hf = sin ( hd ) ; hd = ( he * hb . x + hf * hb . y ) * ( he * hb . y - hf * hb . x ) ; hc = abs ( hd ) ; if ( hc < 1.0 ) { hc = ( 0.01 * u_halo_size ) / ( hc ) ; ha *= sqrt ( min ( hc , 1.0 ) ) ; } } void main ( ) { float hh = ( a . x * a . x + a . y * a . y ) ; float hi = sqrt ( hh ) ; hh = max ( 1.0 - hh , 0.0 ) ; hh = pow ( hh , u_halo_hardness ) ; float hj = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hk [ gG ] ; for ( int hl = 0 ; hl < gG ; hl ++ ) { hk [ hl ] = fract ( gF / ( float ( hl ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"float hm = 0.0 ; gR ( hm , hk , hi ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hn = 0.0 ; g_ ( hn , hk , hh ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"hg ( hh , a ) ;".split(" ")}]}}]},{type:"textline",b:"hh *= hj ; vec3 ho = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"hm *= hh ; ho += u_halo_rings_color * hm ; hh += hm ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"hn *= hj ; ho += u_halo_lines_color * hn ; hh += hn ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"hh *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float hp = u_halo_stars_blend * ( gE . y - u_halo_stars_height ) ; hh *= clamp ( hp , 0.0 , 1.0 ) ; hh *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"gA ( ho ) ; gD ( ho , hh ) ; gl_FragColor = vec4 ( ho , hh ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float gF ;".split(" ")},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gE",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 gG = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; a = a_halo_bb_vertex * 2.0 ; gF = fract ( gG . x + gG . y + gG . z ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",
a:[{type:"textline",b:"mat4 gH = z ( gG , u_view_matrix ) ; mat4 gI = u_view_matrix ; gI [ 3 ] [ 0 ] = 0.0 ; gI [ 3 ] [ 1 ] = 0.0 ; gI [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 gH = z ( gG , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gJ = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; vec4 gK = gH * gJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"vec4 gL = u_proj_matrix * gI * gK ; gL . z = 0.99999 * gL . w ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["gE","=","gK",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 gL = u_proj_matrix * u_view_matrix * gK ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gL",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};
a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 gG = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( gG , 1.0 ) ; }".split(" ")}]};a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",
name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ; uniform int u_shadow_lamp_id ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D",
"u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_reflect_factor ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 kE ; varying vec3 kF ; varying vec3 kG ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kH",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],
group:{type:"group",a:[{type:"textline",b:"float lu = kF . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["vec2","lv","=","a",";"]}]}}]},{type:"textline",b:["vec3","lw","=","kG",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) lw = lw ; else lw = - lw ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:"vec3 lx = cross ( lw , kH . xyz ) * kH . w ; mat3 ly = mat3 ( kH . xyz , lx , lw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float lz = length ( cL ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"vec2 lA = normalize ( u_view_matrix_frag * vec4 ( kG , 0.0 ) ) . st ; lA = lA * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( lz < PARALLAX_LOD_DIST ) { float lB = clamp ( 0.5 * ( PARALLAX_LOD_DIST - lz ) , 0.0 , 1.0 ) ; float lC = u_parallax_scale * lB ; vec3 lD = normalize ( kE * ly ) ; float lE = 1.0 / PARALLAX_STEPS ; vec2 lF = lD . xy * lC / ( PARALLAX_STEPS * lD . z ) ; float lG = 1.0 ; float lH ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:["vec2","lI","=","lA",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","lI","=","lv",";"]}]}}]},{type:"textline",b:"lH = texture2D ( u_normalmap0 , lI ) . a ; for ( float lJ = 1.0 ; lJ <= PARALLAX_STEPS ; lJ ++ ) { if ( lH < lG ) { lG -= lE ; lI -= lF ; lH = texture2D ( u_normalmap0 , lI ) . a ; } } vec2 lK = lI + lF ; float lL = texture2D ( u_normalmap0 , lK ) . a - ( lG + lE ) ; float lM = lH - lG ; float lN = lM / ( lM - lL ) ; lI = lN * lK + ( 1.0 - lN ) * lI ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lv += lI - lA ;".split(" ")}]}}]},{type:"textline",b:["lA","=","lI",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lA += lI - lv ;".split(" ")}]}}]},{type:"textline",b:["lv","=","lI",";"]}]}}]},{type:"textline",
b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["vec4","lO",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lO = texture2D ( u_normalmap0 , lA ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lO = texture2D ( u_normalmap0 , lv ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lP = lO . rgb - 0.5 ; lP = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , lP , u_normal_factor ) ; vec3 lQ = ly * lP ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","lQ","=","lw",";"]}]}}]},{type:"textline",b:"lQ = normalize ( lQ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lA = normalize ( u_view_matrix_frag * vec4 ( lQ , 0.0 ) ) . st ; lA = lA * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lR = normalize ( kE ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],
group:{type:"group",a:[{type:"textline",b:"vec3 lS = kI ; gy ( lS ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec4 lT = vec4 ( lS , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","lT","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["float","lU","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:"vec4 lV = texture2D ( u_colormap0 , lA ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec4 lV = texture2D ( u_colormap0 , lv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"gy ( lV . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","lW",
";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lW = texture2D ( u_colormap1 , lA ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lW = texture2D ( u_colormap1 , lv ) ;".split(" ")}]}}]},{type:"textline",b:"gy ( lW . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec4 lX = texture2D ( u_stencil0 , lA ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 lX = texture2D ( u_stencil0 , lv ) ;".split(" ")}]}}]},{type:"textline",b:"lV = mix ( lV , lW , lX . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lT . rgb = mix ( lT . rgb , lV . rgb , u_diffuse_color_factor ) ; float lY = u_alpha_factor * lV . a ; lY += ( 1.0 - step ( 0.0 , lY ) ) ; lT . a = mix ( lY , 1.0 , u_diffuse_color . a ) ; lU = lV . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lT . rgb *= mix ( vec3 ( 1.0 ) , lV . rgb , u_diffuse_color_factor ) ; lT . a = lV . a ; lU = lV . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 lZ = u_diffuse_intensity * lT . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["vec3","l_","=","lZ",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float ma = 0.5 * lQ . y + 0.5 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 mb = u_environment_energy * textureCube ( u_sky_texture , lQ ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mb = u_environment_energy * mix ( u_horizon_color , u_zenith_color , ma ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 mc = u_ambient * mb ; float md = fs ( lZ ) ; vec3 me = u_emit * lT . rgb ; vec3 mf = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"vec3 mg = vec3 ( lU ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 mg = texture2D ( u_specmap0 , lA ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mg = texture2D ( u_specmap0 , lv ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"gy ( mg . rgb ) ; mf = mix ( mf , mg , u_specular_color_factor ) ;".split(" ")}]}}]},
{type:"textline",b:"float mh = u_specular_params [ 0 ] ; vec2 mi = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 mj = mh * mf ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS","==","0"],group:{type:"group",a:[{type:"textline",b:"hw mk = kc ( me , mc , lZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hw mk = jY ( me , mc , lZ , mj , kF , lQ , lR , mi , u_diffuse_params , md , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) , u_shadow_lamp_id ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 l_ = mk . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["float","ml","=","u_reflect_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","ml","=","0.0",";"]}]}}]},{type:"textline",b:"lf ( l_ , lR , lQ , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , ml ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"l_ += mk . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"l_ = max ( l_ - sqrt ( 0.01 * - min ( lu , 0.0 ) ) , 0.5 * l_ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"kD ( l_ , lu , u_time , md , lQ , u_sun_direction , u_sun_intensity , u_sun_quaternion , kF , lz ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"float mm = lT . a ; if ( mm <= 0.5 ) discard ; mm = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float mm = lT . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"mm += mk . a . a * mj . r * u_specular_alpha ;".split(" ")}]}}]}]}}]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["float","mm","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"l_ = mix ( lt ( cK , lQ . xz * u_refr_bump ) , l_ , mm ) ; mm = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float mn = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 mo = gS ( u_cube_fog , lR ) ; vec4 mp = vec4 ( mo , u_fog_color_density . a ) ; gy ( mp . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 mp = u_fog_color_density ; mp . rgb *= mn ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"hk ( l_ , lz , lR , u_cam_water_depth , u_underwater_fog_color_density , mp , lu , mn ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gL ( l_ , lz , mp ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SSAO_ONLY && SHADOW_SRC == SHADOW_SRC_MASK && ! SHADELESS".split(" "),group:{type:"group",a:[{type:"textline",b:"l_ = vec3 ( dT . a ) ;".split(" ")}]}}]},{type:"textline",b:["gA","(","l_",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"gD ( l_ , mm ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( l_ , mm ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 kE ; varying vec3 kF ; varying vec3 kG ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 lu = a_position ; vec3 lv = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec3 lw = vec3 ( a_tangent ) ; vec3 lx = a_tangent [ 3 ] * cross ( lv , lw ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 ly = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 lz = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vec3 lA = ly - u_camera_eye ; vec3 lx = cross ( lA , lz ) ; vec3 lw = cross ( lz , lx ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lw = vec3 ( 0.0 ) ; vec3 lx = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"lu = mix ( lu , a_position_next , u_va_frame_factor ) ; lv = mix ( lv , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vec3 lB = vec3 ( a_tangent ) ; vec3 lC = a_tangent_next [ 3 ] * cross ( a_normal_next , lB ) ; lw = mix ( lw , lB , u_va_frame_factor ) ; lx = mix ( lx , lC , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bt ( lu , lw , lx , lv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","lD","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lD = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d lE = gh ( lu , lw , lx , lv , lD , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 lF = ( u_model_matrix * vec4 ( lD , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 lG = ag ( u_camera_eye , lF , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 lG = aa ( u_camera_eye , lF , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 lH = ( u_model_matrix * vec4 ( lD , 1.0 ) ) . xyz ; lG = lG * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lH ) ;".split(" ")}]}}]},{type:"textline",b:"d lE = an ( lu - lD , lD , lw , lx , lv , lG ) ; lE . b = lF ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d lE = an ( lu , lD , lw , lx , lv , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"float lI = ( dot ( cross ( lE . e , lE . c ) , lE . d ) < 0.0 ) ? - 1.0 : 1.0 ; kH = vec4 ( lE . c , lI ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ck ( lE . a , lE . b , lv ) ;".split(" ")}]}}]},{type:"textline",b:"kF = lE . a ; kG = lE . e ; kE = u_camera_eye - lE . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",
a:[{type:"textline",b:"a = aq ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kI = lE . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["kI","=","a_color",";"]}]}}]},{type:"textline",b:"vec4 lJ = u_view_matrix * vec4 ( lE . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),
group:{type:"group",a:[{type:"textline",b:["cL","=","lJ",";"]}]}}]},{type:"textline",b:"vec4 lK = u_proj_matrix * lJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"lK . xy += u_subpixel_jitter * lK . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gr","(","lK",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",
b:"gr ( lE . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:"float lL = lK . x ; float lM = lK . y ; float lN = lK . w ; cK . x = ( lL + lN ) / 2.0 ; cK . y = ( lM + lN ) / 2.0 ; cK . z = lN ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kJ = - lJ . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position",
"=","lK",";","}"]}]};a["nodes.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_ANIM_VALUES",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",
b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",
b:"uniform float u_time ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ; uniform int u_shadow_lamp_id ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_reflectmap ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_ANIM_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_anim_values [ NUM_ANIM_VALUES ] ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 kF ; varying vec4 cL ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","kH",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"textline",
b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 lu = vec3 ( ZERO_VALUE_NODES ) ; vec3 lv = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")},{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 lz ( in vec3 lw , in float lx ) { vec3 ly = lu ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"ly = lt ( cK , lw . xz * lx ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ly = texture2D ( u_refractmap , cK . xy / cK . z ) . rgb ; gy ( ly ) ;".split(" ")}]}}]},{type:"textline",b:["return","ly",";","}"]}]}}]},{type:"textline",b:"vec3 lC ( float lA , vec3 lB ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , lB ) . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"return mix ( u_horizon_color , u_zenith_color , lA ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_SEPHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 lJ ( vec3 lD ) { vec4 lE = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; vec4 lF = mix ( vec4 ( lD . bg , lE . wz ) , vec4 ( lD . gb , lE . xy ) , step ( lD . b , lD . g ) ) ; vec4 lG = mix ( vec4 ( lF . xyw , lD . r ) , vec4 ( lD . r , lF . yzx ) , step ( lF . x , lD . r ) ) ; float lH = lG . x - min ( lG . w , lG . y ) ; float lI = 1.0e-10 ; return vec3 ( abs ( lG . z + ( lG . w - lG . y ) / ( 6.0 * lH + lI ) ) , lH / ( lG . x + lI ) , lG . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_COMBHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 lN ( vec3 lK ) { vec4 lL = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; vec3 lM = abs ( fract ( vec3 ( lK . r , lK . r , lK . r ) + lL . xyz ) * 6.0 - lL . www ) ; return lK . b * mix ( lL . xxx , clamp ( lM - lL . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , lK . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_B4W_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 lP ( vec2 lO ) { return vec3 ( lO * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_TEXTURE_COLOR || USE_NODE_TEXTURE_NORMAL || USE_NODE_TEXTURE_COLOR2 || USE_NODE_TEXTURE_NORMAL2 || USE_NODE_TEXTURE_COLOR3 || USE_NODE_TEXTURE_NORMAL3 || USE_NODE_TEXTURE_NORMAL4 || USE_NODE_TEXTURE_COLOR4 || USE_NODE_B4W_PARALLAX".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lR ( vec3 lQ ) { return vec2 ( lQ . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},{type:"node",name:"CAMERA",k:[{type:"node_out",name:"mz",qualifier:["vec3"],e:!0},{type:"node_out",name:"mA",qualifier:["float"],e:!0},{type:"node_out",name:"mB",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mz"],f:[{type:"textline",b:"mz = normalize ( mp . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_mA"],f:[{type:"textline",b:"mA = abs ( mp . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mB"],f:[{type:"textline",b:"mB = length ( mp . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",k:[{type:"node_in",name:"mC",qualifier:["float"],e:!1},{type:"node_in",name:"mD",qualifier:["float"],e:!1},{type:"node_in",name:"mE",qualifier:["float"],e:!1},{type:"node_out",name:"mF",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mF = vec3 ( mC , mD , mE ) ;".split(" ")}]},
{type:"node",name:"COMBHSV",k:[{type:"node_in",name:"mG",qualifier:["float"],e:!1},{type:"node_in",name:"mH",qualifier:["float"],e:!1},{type:"node_in",name:"mI",qualifier:["float"],e:!1},{type:"node_out",name:"mJ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mJ = lN ( vec3 ( mG , mH , mI ) ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_out",name:"mK",qualifier:["vec3"],e:!1},{type:"node_param",name:"lS",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"mK = lP ( lS ) ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC",k:[{type:"node_out",name:"mL",qualifier:["vec3"],e:!1},{type:"node_param",name:"lT",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["mL","=","lT",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_out",name:"mM",qualifier:["float"],e:!1},{type:"node_param",name:"lU",qualifier:["varying","float"]}],f:[{type:"textline",b:["mM","=","lU",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_out",name:"mN",qualifier:["float"],e:!1},{type:"node_out",name:"mO",
qualifier:["float"],e:!1},{type:"node_param",name:"lV",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"mN = lV [ 0 ] ; mO = lV [ 1 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_out",name:"mP",qualifier:["float"],e:!1},{type:"node_out",name:"mQ",qualifier:["float"],e:!1},{type:"node_out",name:"mR",qualifier:["float"],e:!1},{type:"node_param",name:"lW",qualifier:["varying","vec3"]}],f:[{type:"textline",b:"mP = lW [ 0 ] ; mQ = lW [ 1 ] ; mR = lW [ 2 ] ;".split(" ")}]},{type:"node",
name:"GEOMETRY_NO",k:[{type:"node_out",name:"mS",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mS","=","mi",";"]}]},{type:"node",name:"GEOMETRY_FB",k:[{type:"node_out",name:"mT",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mT = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VW",k:[{type:"node_out",name:"mU",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mU","=","mn",";"]}]},{type:"node",name:"GEOMETRY_GL",k:[{type:"node_out",name:"mV",
qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mV = vec3 ( mo . r , - mo . b , mo . g ) ;".split(" ")}]},{type:"node",name:"HUE_SAT",k:[{type:"node_in",name:"mW",qualifier:["float"],e:!1},{type:"node_in",name:"mX",qualifier:["float"],e:!1},{type:"node_in",name:"mY",qualifier:["float"],e:!1},{type:"node_in",name:"mZ",qualifier:["float"],e:!1},{type:"node_in",name:"m_",qualifier:["vec3"],e:!1},{type:"node_out",name:"na",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ vec3 nb = lJ ( m_ ) ; nb [ 0 ] += ( mW - 0.5 ) ; if ( nb [ 0 ] > UNITY_VALUE_NODES ) nb [ 0 ] -= UNITY_VALUE_NODES ; else if ( nb [ 0 ] < ZERO_VALUE_NODES ) nb [ 0 ] += UNITY_VALUE_NODES ; nb *= vec3 ( UNITY_VALUE_NODES , mX , mY ) ; nb = mix ( lv , mix ( lu , nb , step ( lu , nb ) ) , step ( nb , lv ) ) ; na = mix ( m_ , lN ( nb ) , mZ ) ; }".split(" ")}]},
{type:"node",name:"INVERT",k:[{type:"node_in",name:"nc",qualifier:["float"],e:!1},{type:"node_in",name:"nd",qualifier:["vec3"],e:!1},{type:"node_out",name:"ne",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ne = mix ( nd , lv - nd , nc ) ;".split(" ")}]},{type:"node",name:"LAMP",k:[{type:"node_out",name:"nf",qualifier:["vec3"],e:!1},{type:"node_out",name:"ng",qualifier:["vec3"],e:!1},{type:"node_out",name:"nh",qualifier:["float"],e:!1},{type:"node_out",name:"ni",qualifier:["float"],e:!1},{type:"node_param",
name:"lX",qualifier:["const","float"]}],f:[{type:"textline",b:"{ const int nj = int ( lX ) ; nf = u_lamp_light_color_intensities [ nj ] ; vec4 nk = u_lamp_light_factors [ nj ] ; vec3 nl = u_lamp_light_directions [ nj ] ; vec3 nm = u_lamp_light_positions [ nj ] ; float nn = nk . z ; if ( nn != - UNITY_VALUE_NODES ) { ng = nm - kF ; nh = length ( ng ) ; ng = normalize ( ng ) ; ni = nn / ( nn + nh * nh ) ; float no = nk . x ; float np = nk . y ; if ( no > - UNITY_VALUE_NODES ) { float nq = dot ( ng , nl ) ; nq *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( nq - no ) / np ) ; ni *= nq ; } } else { ng = nl ; nh = length ( nm - kF ) ; ni = UNITY_VALUE_NODES ; } }".split(" ")}]},
{type:"node",name:"NORMAL",k:[{type:"node_in",name:"nr",qualifier:["vec3"],e:!1},{type:"node_out",name:"ns",qualifier:["vec3"],e:!0},{type:"node_out",name:"nt",qualifier:["float"],e:!0},{type:"node_param",name:"lY",qualifier:["vec3"]}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ns"],f:[{type:"textline",b:["ns","=","lY",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nt"],f:[{type:"textline",b:"nt = - dot ( nr , lY ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",
k:[{type:"node_in",name:"nu",qualifier:["vec3"],e:!1},{type:"node_out",name:"nv",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"nv = - ( u_view_matrix_frag * vec4 ( nu , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"MAPPING",k:[{type:"node_in",name:"nw",qualifier:["vec3"],e:!1},{type:"node_out",name:"nx",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["nx","=","nw",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",f:[{type:"textline",b:"nx = ( MAPPING_TRS_MATRIX * vec4 ( nx , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_SCALE",f:[{type:"textline",b:"nx = nx * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",f:[{type:"textline",b:"nx = nx + MAPPING_TRANSLATION ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",f:[{type:"textline",b:"nx = max ( nx , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",f:[{type:"textline",
b:"nx = min ( nx , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],f:[{type:"textline",b:"nx = normalize ( nx ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",k:[{type:"node_in",name:"ny",qualifier:["float"],e:!1},{type:"node_in",name:"nz",qualifier:["float"],e:!1},{type:"node_out",name:"nA",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nA = ny + nz ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",
b:"nA = clamp ( nA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",k:[{type:"node_in",name:"nB",qualifier:["float"],e:!1},{type:"node_in",name:"nC",qualifier:["float"],e:!1},{type:"node_out",name:"nD",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nD = nB - nC ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nD = clamp ( nD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_MULTIPLY",k:[{type:"node_in",name:"nE",qualifier:["float"],e:!1},{type:"node_in",name:"nF",qualifier:["float"],e:!1},{type:"node_out",name:"nG",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nG = nE * nF ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nG = clamp ( nG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",k:[{type:"node_in",name:"nH",qualifier:["float"],e:!1},{type:"node_in",name:"nI",
qualifier:["float"],e:!1},{type:"node_out",name:"nJ",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nJ = ( nI != ZERO_VALUE_NODES ) ? nH / nI : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nJ = clamp ( nJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SINE",k:[{type:"node_in",name:"nK",qualifier:["float"],e:!1},{type:"node_in",name:"nL",qualifier:["float"],e:!1},{type:"node_out",name:"nM",
qualifier:["float"],e:!1}],f:[{type:"textline",b:"nM = sin ( nK ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nM = clamp ( nM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nL",";"]}]},{type:"node",name:"MATH_COSINE",k:[{type:"node_in",name:"nN",qualifier:["float"],e:!1},{type:"node_in",name:"nO",qualifier:["float"],e:!1},{type:"node_out",name:"nP",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nP = cos ( nN ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nP = clamp ( nP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nO",";"]}]},{type:"node",name:"MATH_TANGENT",k:[{type:"node_in",name:"nQ",qualifier:["float"],e:!1},{type:"node_in",name:"nR",qualifier:["float"],e:!1},{type:"node_out",name:"nS",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nS = tan ( nQ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],
f:[{type:"textline",b:"nS = clamp ( nS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nR",";"]}]},{type:"node",name:"MATH_ARCSINE",k:[{type:"node_in",name:"nT",qualifier:["float"],e:!1},{type:"node_in",name:"nU",qualifier:["float"],e:!1},{type:"node_out",name:"nV",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nV = ( nT <= UNITY_VALUE_NODES && nT >= - UNITY_VALUE_NODES ) ? asin ( nT ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nV = clamp ( nV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nU",";"]}]},{type:"node",name:"MATH_ARCCOSINE",k:[{type:"node_in",name:"nW",qualifier:["float"],e:!1},{type:"node_in",name:"nX",qualifier:["float"],e:!1},{type:"node_out",name:"nY",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nY = ( nW <= UNITY_VALUE_NODES && nW >= - UNITY_VALUE_NODES ) ? acos ( nW ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",
a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nY = clamp ( nY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nX",";"]}]},{type:"node",name:"MATH_ARCTANGENT",k:[{type:"node_in",name:"nZ",qualifier:["float"],e:!1},{type:"node_in",name:"n_",qualifier:["float"],e:!1},{type:"node_out",name:"oa",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oa = atan ( nZ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",
b:"oa = clamp ( oa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["n_",";"]}]},{type:"node",name:"MATH_POWER",k:[{type:"node_in",name:"ob",qualifier:["float"],e:!1},{type:"node_in",name:"oc",qualifier:["float"],e:!1},{type:"node_out",name:"od",qualifier:["float"],e:!1}],f:[{type:"textline",b:"if ( ob < ZERO_VALUE_NODES || ob == ZERO_VALUE_NODES && oc == ZERO_VALUE_NODES ) od = ZERO_VALUE_NODES ; else od = pow ( ob , oc ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"od = clamp ( od , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",k:[{type:"node_in",name:"oe",qualifier:["float"],e:!1},{type:"node_in",name:"of",qualifier:["float"],e:!1},{type:"node_out",name:"og",qualifier:["float"],e:!1}],f:[{type:"textline",b:"og = ( oe > ZERO_VALUE_NODES && of > ZERO_VALUE_NODES ) ? log2 ( oe ) / log2 ( of ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"og = clamp ( og , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MINIMUM",k:[{type:"node_in",name:"oh",qualifier:["float"],e:!1},{type:"node_in",name:"oi",qualifier:["float"],e:!1},{type:"node_out",name:"oj",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oj = min ( oh , oi ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oj = clamp ( oj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MAXIMUM",k:[{type:"node_in",name:"ok",qualifier:["float"],e:!1},{type:"node_in",name:"ol",qualifier:["float"],e:!1},{type:"node_out",name:"om",qualifier:["float"],e:!1}],f:[{type:"textline",b:"om = max ( ok , ol ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"om = clamp ( om , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",k:[{type:"node_in",name:"on",qualifier:["float"],e:!1},
{type:"node_in",name:"oo",qualifier:["float"],e:!1},{type:"node_out",name:"op",qualifier:["float"],e:!1}],f:[{type:"textline",b:"op = floor ( on + 0.5 ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"op = clamp ( op , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["oo",";"]}]},{type:"node",name:"MATH_LESS_THAN",k:[{type:"node_in",name:"oq",qualifier:["float"],e:!1},{type:"node_in",name:"or",qualifier:["float"],e:!1},
{type:"node_out",name:"os",qualifier:["float"],e:!1}],f:[{type:"textline",b:"os = ( oq < or ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"os = clamp ( os , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",k:[{type:"node_in",name:"ot",qualifier:["float"],e:!1},{type:"node_in",name:"ou",qualifier:["float"],e:!1},{type:"node_out",name:"ov",qualifier:["float"],
e:!1}],f:[{type:"textline",b:"ov = ( ot > ou ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ov = clamp ( ov , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",k:[{type:"node_in",name:"ow",qualifier:["float"],e:!1},{type:"node_in",name:"ox",qualifier:["float"],e:!1},{type:"node_out",name:"oy",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oy = abs ( ox ) > 0.000001 ? mod ( ow , ox ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oy = clamp ( oy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ABSOLUTE",k:[{type:"node_in",name:"oz",qualifier:["float"],e:!1},{type:"node_in",name:"oA",qualifier:["float"],e:!1},{type:"node_out",name:"oB",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oB = abs ( oz ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oB = clamp ( oB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["oA",";"]}]},{type:"node",name:"MIX_RGB_MIX",k:[{type:"node_in",name:"oC",qualifier:["float"],e:!1},{type:"node_in",name:"oD",qualifier:["vec3"],e:!1},{type:"node_in",name:"oE",qualifier:["vec3"],e:!1},{type:"node_out",name:"oF",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oG = clamp ( oC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oF = mix ( oD , oE , oG ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oF = clamp ( oF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_ADD",k:[{type:"node_in",name:"oH",qualifier:["float"],e:!1},{type:"node_in",name:"oI",qualifier:["vec3"],e:!1},{type:"node_in",name:"oJ",qualifier:["vec3"],e:!1},{type:"node_out",name:"oK",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oL = clamp ( oH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oK = mix ( oI , oI + oJ , oL ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oK = clamp ( oK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_MULTIPLY",k:[{type:"node_in",name:"oM",qualifier:["float"],e:!1},{type:"node_in",name:"oN",qualifier:["vec3"],e:!1},{type:"node_in",name:"oO",qualifier:["vec3"],e:!1},{type:"node_out",name:"oP",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oQ = clamp ( oM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oP = mix ( oN , oN * oO , oQ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oP = clamp ( oP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SUBTRACT",k:[{type:"node_in",name:"oR",qualifier:["float"],e:!1},{type:"node_in",name:"oS",qualifier:["vec3"],e:!1},{type:"node_in",name:"oT",qualifier:["vec3"],e:!1},{type:"node_out",name:"oU",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oV = clamp ( oR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oU = mix ( oS , oS - oT , oV ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oU = clamp ( oU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SCREEN",k:[{type:"node_in",name:"oW",qualifier:["float"],e:!1},{type:"node_in",name:"oX",qualifier:["vec3"],e:!1},{type:"node_in",name:"oY",qualifier:["vec3"],e:!1},{type:"node_out",name:"oZ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float o_ = clamp ( oW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pa = UNITY_VALUE_NODES - o_ ; oZ = lv - ( vec3 ( pa ) + o_ * ( lv - oY ) ) * ( lv - oX ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oZ = clamp ( oZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DIVIDE",k:[{type:"node_in",name:"pb",qualifier:["float"],e:!1},{type:"node_in",name:"pc",qualifier:["vec3"],e:!1},{type:"node_in",name:"pd",qualifier:["vec3"],e:!1},{type:"node_out",name:"pe",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pf = clamp ( pb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pg = UNITY_VALUE_NODES - pf ; pd += step ( pd , lu ) ; pe = pg * pc + pf * pc / pd ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pe = clamp ( pe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",k:[{type:"node_in",name:"ph",qualifier:["float"],e:!1},{type:"node_in",name:"pi",qualifier:["vec3"],e:!1},{type:"node_in",name:"pj",qualifier:["vec3"],e:!1},{type:"node_out",name:"pk",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pl = clamp ( ph , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pk = mix ( pi , abs ( pi - pj ) , pl ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pk = clamp ( pk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DARKEN",k:[{type:"node_in",name:"pm",qualifier:["float"],e:!1},{type:"node_in",name:"pn",qualifier:["vec3"],e:!1},{type:"node_in",name:"po",qualifier:["vec3"],e:!1},{type:"node_out",name:"pp",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pq = clamp ( pm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pp = min ( pn . rgb , po . rgb * pq ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pp = clamp ( pp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_LIGHTEN",k:[{type:"node_in",name:"pr",qualifier:["float"],e:!1},{type:"node_in",name:"ps",qualifier:["vec3"],e:!1},{type:"node_in",name:"pt",qualifier:["vec3"],e:!1},{type:"node_out",name:"pu",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pv = clamp ( pr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pu = max ( ps . rgb , pt . rgb * pv ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pu = clamp ( pu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_OVERLAY",k:[{type:"node_in",name:"pw",qualifier:["float"],e:!1},{type:"node_in",name:"px",qualifier:["vec3"],e:!1},{type:"node_in",name:"py",qualifier:["vec3"],e:!1},{type:"node_out",name:"pz",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pA = clamp ( pw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pB = UNITY_VALUE_NODES - pA ; vec3 pC = vec3 ( pB ) ; pz = mix ( px * ( pC + 2.0 * pA * py ) , lv - ( pC + 2.0 * pA * ( lv - py ) ) * ( lv - px ) , step ( 0.5 , px ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pz = clamp ( pz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DODGE",k:[{type:"node_in",name:"pD",qualifier:["float"],e:!1},{type:"node_in",name:"pE",qualifier:["vec3"],e:!1},{type:"node_in",name:"pF",qualifier:["vec3"],e:!1},{type:"node_out",name:"pG",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pH = clamp ( pD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pI = lv - pH * pF ; vec3 pJ = pE / ( pI + step ( pI , lu ) ) ; pG = ( lv - step ( pE , lu ) ) * mix ( mix ( lv , pJ , step ( pJ , lv ) ) , lv , step ( pI , lu ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pG = clamp ( pG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_BURN",k:[{type:"node_in",name:"pK",qualifier:["float"],e:!1},{type:"node_in",name:"pL",qualifier:["vec3"],e:!1},{type:"node_in",name:"pM",qualifier:["vec3"],e:!1},{type:"node_out",name:"pN",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pO = clamp ( pK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pP = lv - pO * ( lv - pM ) ; vec3 pQ = lv - ( lv - pL ) / ( pP + step ( pP , lu ) ) ; pN = mix ( mix ( lu , mix ( lv , pQ , step ( pQ , lv ) ) , step ( ZERO_VALUE_NODES , pQ ) ) , lu , step ( pP , lu ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pN = clamp ( pN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_HUE",k:[{type:"node_in",name:"pR",qualifier:["float"],e:!1},{type:"node_in",name:"pS",qualifier:["vec3"],e:!1},{type:"node_in",name:"pT",qualifier:["vec3"],e:!1},{type:"node_out",name:"pU",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pV = clamp ( pR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pW , pX , pY ; pU = pS ; pX = lJ ( pT ) ; if ( pX . y != ZERO_VALUE_NODES ) { pW = lJ ( pU ) ; pW . x = pX . x ; pY = lN ( pW ) ; pU = mix ( pU , pY , pV ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pU = clamp ( pU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SATURATION",k:[{type:"node_in",name:"pZ",qualifier:["float"],e:!1},{type:"node_in",name:"p_",qualifier:["vec3"],e:!1},{type:"node_in",name:"qa",qualifier:["vec3"],e:!1},{type:"node_out",name:"qb",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qc = clamp ( pZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qd = UNITY_VALUE_NODES - qc ; qb = p_ ; vec3 qe , qf ; qe = lJ ( qb ) ; if ( qe . y != ZERO_VALUE_NODES ) { qf = lJ ( qa ) ; qe . y = qd * qe . y + qc * qf . y ; qb = lN ( qe ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qb = clamp ( qb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_VALUE",k:[{type:"node_in",name:"qg",qualifier:["float"],e:!1},{type:"node_in",name:"qh",qualifier:["vec3"],e:!1},{type:"node_in",name:"qi",qualifier:["vec3"],e:!1},{type:"node_out",name:"qj",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qk = clamp ( qg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float ql = UNITY_VALUE_NODES - qk ; vec3 qm , qn ; qm = lJ ( qh ) ; qn = lJ ( qi ) ; qm . z = ql * qm . z + qk * qn . z ; qj = lN ( qm ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qj = clamp ( qj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_COLOR",k:[{type:"node_in",name:"qo",qualifier:["float"],e:!1},{type:"node_in",name:"qp",qualifier:["vec3"],e:!1},{type:"node_in",name:"qq",qualifier:["vec3"],e:!1},{type:"node_out",name:"qr",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qs = clamp ( qo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qt , qu , qv ; qr = qp ; qu = lJ ( qq ) ; if ( qu . y != ZERO_VALUE_NODES ) { qt = lJ ( qr ) ; qt . x = qu . x ; qt . y = qu . y ; qv = lN ( qt ) ; qr = mix ( qr , qv , qs ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qr = clamp ( qr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",k:[{type:"node_in",name:"qw",qualifier:["float"],e:!1},{type:"node_in",name:"qx",qualifier:["vec3"],e:!1},{type:"node_in",name:"qy",qualifier:["vec3"],e:!1},{type:"node_out",name:"qz",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qA = clamp ( qw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qB = UNITY_VALUE_NODES - qA ; vec3 qC = qy + qx - qy * qx ; qz = qx * ( vec3 ( qB ) + vec3 ( qA ) * ( ( lv - qx ) * qy + qC ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qz = clamp ( qz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",k:[{type:"node_in",name:"qD",qualifier:["float"],e:!1},{type:"node_in",name:"qE",qualifier:["vec3"],e:!1},{type:"node_in",name:"qF",qualifier:["vec3"],e:!1},{type:"node_out",name:"qG",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qH = clamp ( qD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qG = clamp ( qE + qH * ( 2.0 * qF - lv ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qG = clamp ( qG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"OUTPUT",k:[{type:"node_in",name:"qI",qualifier:["vec3"],e:!1},{type:"node_in",name:"qJ",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mt = qI ; my = qJ ;".split(" ")}]},{type:"node",name:"MATERIAL",k:[{type:"node_in",name:"qK",qualifier:["vec3"],e:!1},{type:"node_in",name:"qL",qualifier:["float"],
e:!1},{type:"node_in",name:"qM",qualifier:["vec3"],e:!1},{type:"node_in",name:"qN",qualifier:["vec3"],e:!0},{type:"node_out",name:"qO",qualifier:["vec3"],e:!0},{type:"node_out",name:"qP",qualifier:["float"],e:!0},{type:"node_out",name:"qQ",qualifier:["vec3"],e:!0},{type:"node_param",name:"lZ",qualifier:["const","vec2"]},{type:"node_param",name:"l_",qualifier:["const","vec3"]}],f:[{type:"textline",b:"{ vec3 qR = clamp ( qK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qS = l_ [ 0 ] * clamp ( qM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"vec3 qT = normalize ( qN ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["vec3","qT","=","mi",";"]}]}]},{type:"textline",b:["hw","qU",";"]},{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT"],f:[{type:"textline",b:"vec3 qV = mq * qR ; float qW = 0.5 * qT . y + 0.5 ; vec3 qX = ms * u_environment_energy * lC ( qW , qT ) ; float qY = fs ( qR ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"vec2 qZ = vec2 ( lZ [ 0 ] , lZ [ 1 ] ) ; vec2 q_ = vec2 ( l_ [ 1 ] , l_ [ 2 ] ) ; qU = jY ( qV , qX , qR , qS , mo , qT , mn , q_ , qZ , qY , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) , u_shadow_lamp_id ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:"qU = kc ( qV , qX , qR ) ;".split(" ")}]}]},{type:"textline",b:["mx","=","qY",";"]}]},
{type:"node_else",f:[{type:"textline",b:"qU . a = vec4 ( qR , ZERO_VALUE_NODES ) ; qU . b = lu ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qO"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"qO = qU . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["qO","=","lu",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"qO += qU . b ;".split(" ")}]}]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_qP"],f:[{type:"textline",b:"qP = clamp ( qL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"qP += qU . a . a * qS . r * mr ; qP = clamp ( qP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qQ"],f:[{type:"textline",b:["qQ","=","qT",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],
f:[{type:"textline",b:"mu = qU . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["mu","=","lu",";"]}]}]},{type:"textline",b:["mv","=","qT",";","}"]}]},{type:"node",name:"MATERIAL_EXT",k:[{type:"node_in",name:"ra",qualifier:["vec3"],e:!1},{type:"node_in",name:"rb",qualifier:["float"],e:!1},{type:"node_in",name:"rc",qualifier:["vec3"],e:!1},{type:"node_in",name:"rd",qualifier:["vec3"],e:!0},{type:"node_in",name:"re",qualifier:["float"],e:!1},{type:"node_in",name:"rf",qualifier:["float"],
e:!1},{type:"node_in",name:"rg",qualifier:["vec4"],e:!1},{type:"node_in",name:"rh",qualifier:["float"],e:!1},{type:"node_in",name:"ri",qualifier:["float"],e:!1},{type:"node_out",name:"rj",qualifier:["vec3"],e:!0},{type:"node_out",name:"rk",qualifier:["float"],e:!0},{type:"node_out",name:"rl",qualifier:["vec3"],e:!0},{type:"node_out",name:"rm",qualifier:["vec3"],e:!0},{type:"node_out",name:"rn",qualifier:["vec3"],e:!0},{type:"node_param",name:"ma",qualifier:["const","vec2"]},{type:"node_param",name:"mb",
qualifier:["const","vec3"]}],f:[{type:"textline",b:"{ vec3 ro = clamp ( ra , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 rp = mb [ 0 ] * clamp ( rc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"vec3 rq = normalize ( rd ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["vec3","rq","=","mi",";"]}]}]},{type:"textline",b:["hw","rr",";"]},{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT"],
f:[{type:"textline",b:"float rs = fs ( ro ) ; vec3 rt = re * ro ; float ru = 0.5 * rq . y + 0.5 ; vec3 rv = ms * u_environment_energy * lC ( ru , rq ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"vec2 rw = vec2 ( ma [ 0 ] , ma [ 1 ] ) ; vec2 rx = vec2 ( mb [ 1 ] , mb [ 2 ] ) ; rr = jY ( rt , rv , ro , rp , mo , rq , mn , rx , rw , rs , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , rf , rg , u_shadow_lamp_id ) ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",b:"rr = kc ( rt , rv , ro ) ;".split(" ")}]}]},{type:"textline",b:["mx","=","rs",";"]}]},{type:"node_else",f:[{type:"textline",b:"rr . a = vec4 ( ro , ZERO_VALUE_NODES ) ; rr . b = lu ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rj"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"rj = rr . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["rj","=","lu",";"]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],f:[{type:"textline",b:"lf ( rj , mn , rq , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , rh ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"rj += rr . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rk"],f:[{type:"textline",b:"rk = clamp ( rb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],
f:[{type:"textline",b:"rk += rr . a . a * rp . r * ri ; rk = clamp ( rk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rl"],f:[{type:"textline",b:["rl","=","rq",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rm"],f:[{type:"textline",b:"rm = rr . a . rgb ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rn"],f:[{type:"textline",b:"rn = rr . b ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"mu = rr . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["mu","=","lu",";"]}]}]},{type:"textline",b:["mv","=","rq",";","}"]}]},{type:"node",name:"RGB",k:[{type:"node_out",name:"ry",qualifier:["vec3"],e:!1},{type:"node_param",name:"mc",qualifier:["vec3"]}],f:[{type:"textline",b:["ry","=","mc",";"]}]},{type:"node",name:"RGBTOBW",k:[{type:"node_in",name:"rz",qualifier:["vec3"],e:!1},{type:"node_out",name:"rA",qualifier:["float"],e:!1}],
f:[{type:"textline",b:"rA = rz . r * 0.35 + rz . g * 0.45 + rz . b * 0.2 ;".split(" ")}]},{type:"node",name:"SEPRGB",k:[{type:"node_in",name:"rB",qualifier:["vec3"],e:!1},{type:"node_out",name:"rC",qualifier:["float"],e:!0},{type:"node_out",name:"rD",qualifier:["float"],e:!0},{type:"node_out",name:"rE",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rC"],f:[{type:"textline",b:"rC = rB . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rD"],
f:[{type:"textline",b:"rD = rB . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rE"],f:[{type:"textline",b:"rE = rB . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",k:[{type:"node_in",name:"rF",qualifier:["vec3"],e:!1},{type:"node_out",name:"rG",qualifier:["float"],e:!0},{type:"node_out",name:"rH",qualifier:["float"],e:!0},{type:"node_out",name:"rI",qualifier:["float"],e:!0}],f:[{type:"textline",b:"{ vec3 rJ = lJ ( rF ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_rG"],f:[{type:"textline",b:"rG = rJ . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rH"],f:[{type:"textline",b:"rH = rJ . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rI"],f:[{type:"textline",b:"rI = rJ . b ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"SQUEEZE",k:[{type:"node_in",name:"rK",qualifier:["float"],e:!1},{type:"node_in",name:"rL",qualifier:["float"],e:!1},{type:"node_in",name:"rM",qualifier:["float"],
e:!1},{type:"node_out",name:"rN",qualifier:["float"],e:!1}],f:[{type:"textline",b:"rN = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( rK - rM ) * rL ) ) ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",k:[{type:"node_in",name:"rO",qualifier:["vec3"],e:!1},{type:"node_out",name:"rP",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rP = max ( lu , rO ) ; rP = pow ( rP , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",k:[{type:"node_in",name:"rQ",
qualifier:["vec3"],e:!1},{type:"node_out",name:"rR",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rR = max ( lu , rQ ) ; rR = pow ( rR , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_COLOR",k:[{type:"node_in",name:"rS",qualifier:["vec3"],e:!1},{type:"node_out",name:"rT",qualifier:["vec3"],e:!1},{type:"node_out",name:"rU",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 rV = texture2D ( node_TEXTURE_COLOR_var_texture , lR ( rS ) ) ; rT = rV . xyz ; gy ( rT ) ; rU = rV . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_NORMAL",k:[{type:"node_in",name:"rW",qualifier:["vec3"],e:!1},{type:"node_out",name:"rX",qualifier:["vec3"],e:!1},{type:"node_out",name:"rY",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 rZ = texture2D ( node_TEXTURE_NORMAL_var_texture , lR ( rW ) ) ; mw = rZ . xyz - 0.5 ; rX = normalize ( ml * mw ) ; rY = rZ . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_ENVIRONMENT",
k:[{type:"node_in",name:"r_",qualifier:["vec3"],e:!1},{type:"node_out",name:"sa",qualifier:["vec3"],e:!0},{type:"node_out",name:"sb",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]}],f:[{type:"textline",b:"{ vec4 sc = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , r_ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sa"],f:[{type:"textline",b:"sa = sc . xyz ; gy ( sa ) ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_sb"],f:[{type:"textline",b:"sb = sc . w ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"TEXTURE_COLOR2",k:[{type:"node_in",name:"sd",qualifier:["vec3"],e:!1},{type:"node_in",name:"se",qualifier:["vec3"],e:!1},{type:"node_out",name:"sf",qualifier:["vec3"],e:!1},{type:"node_out",name:"sg",qualifier:["float"],e:!1},{type:"node_out",name:"sh",qualifier:["vec3"],e:!1},{type:"node_out",name:"si",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_COLOR2_var_texture",
qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sj = texture2D ( node_TEXTURE_COLOR2_var_texture , lR ( sd ) ) ; sf = sj . xyz ; gy ( sf ) ; sg = sj . w ; sj = texture2D ( node_TEXTURE_COLOR2_var_texture , lR ( se ) ) ; sh = sj . xyz ; gy ( sh ) ; si = sj . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_NORMAL2",k:[{type:"node_in",name:"sk",qualifier:["vec3"],e:!1},{type:"node_in",name:"sl",qualifier:["vec3"],e:!1},{type:"node_out",name:"sm",qualifier:["vec3"],e:!1},{type:"node_out",
name:"sn",qualifier:["float"],e:!1},{type:"node_out",name:"so",qualifier:["vec3"],e:!1},{type:"node_out",name:"sp",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL2_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sq = texture2D ( node_TEXTURE_NORMAL2_var_texture , lR ( sk ) ) ; mw = sq . xyz - 0.5 ; sm = normalize ( ml * mw ) ; sn = sq . w ; sq = texture2D ( node_TEXTURE_NORMAL2_var_texture , lR ( sl ) ) ; mw = sq . xyz - 0.5 ; so = normalize ( ml * mw ) ; sp = sq . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_COLOR3",k:[{type:"node_in",name:"sr",qualifier:["vec3"],e:!1},{type:"node_in",name:"ss",qualifier:["vec3"],e:!1},{type:"node_in",name:"st",qualifier:["vec3"],e:!1},{type:"node_out",name:"su",qualifier:["vec3"],e:!1},{type:"node_out",name:"sv",qualifier:["float"],e:!1},{type:"node_out",name:"sw",qualifier:["vec3"],e:!1},{type:"node_out",name:"sx",qualifier:["float"],e:!1},{type:"node_out",name:"sy",qualifier:["vec3"],e:!1},{type:"node_out",name:"sz",qualifier:["float"],e:!1},
{type:"node_param",name:"node_TEXTURE_COLOR3_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sA = texture2D ( node_TEXTURE_COLOR3_var_texture , lR ( sr ) ) ; su = sA . xyz ; gy ( su ) ; sv = sA . w ; sA = texture2D ( node_TEXTURE_COLOR3_var_texture , lR ( ss ) ) ; sw = sA . xyz ; gy ( sw ) ; sx = sA . w ; sA = texture2D ( node_TEXTURE_COLOR3_var_texture , lR ( st ) ) ; sy = sA . xyz ; gy ( sy ) ; sz = sA . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_COLOR4",k:[{type:"node_in",
name:"sB",qualifier:["vec3"],e:!1},{type:"node_in",name:"sC",qualifier:["vec3"],e:!1},{type:"node_in",name:"sD",qualifier:["vec3"],e:!1},{type:"node_in",name:"sE",qualifier:["vec3"],e:!1},{type:"node_out",name:"sF",qualifier:["vec3"],e:!1},{type:"node_out",name:"sG",qualifier:["float"],e:!1},{type:"node_out",name:"sH",qualifier:["vec3"],e:!1},{type:"node_out",name:"sI",qualifier:["float"],e:!1},{type:"node_out",name:"sJ",qualifier:["vec3"],e:!1},{type:"node_out",name:"sK",qualifier:["float"],e:!1},
{type:"node_out",name:"sL",qualifier:["vec3"],e:!1},{type:"node_out",name:"sM",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_COLOR4_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sN = texture2D ( node_TEXTURE_COLOR4_var_texture , lR ( sB ) ) ; sF = sN . xyz ; gy ( sF ) ; sG = sN . w ; sN = texture2D ( node_TEXTURE_COLOR4_var_texture , lR ( sC ) ) ; sH = sN . xyz ; gy ( sH ) ; sI = sN . w ; sN = texture2D ( node_TEXTURE_COLOR4_var_texture , lR ( sD ) ) ; sJ = sN . xyz ; gy ( sJ ) ; sK = sN . w ; sN = texture2D ( node_TEXTURE_COLOR4_var_texture , lR ( sE ) ) ; sL = sN . xyz ; gy ( sL ) ; sM = sN . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_NORMAL3",k:[{type:"node_in",name:"sO",qualifier:["vec3"],e:!1},{type:"node_in",name:"sP",qualifier:["vec3"],e:!1},{type:"node_in",name:"sQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"sR",qualifier:["vec3"],e:!1},{type:"node_out",name:"sS",qualifier:["float"],e:!1},{type:"node_out",name:"sT",qualifier:["vec3"],e:!1},{type:"node_out",name:"sU",qualifier:["float"],e:!1},{type:"node_out",name:"sV",qualifier:["vec3"],e:!1},{type:"node_out",name:"sW",qualifier:["float"],
e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL3_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sX = texture2D ( node_TEXTURE_NORMAL3_var_texture , lR ( sO ) ) ; mw = sX . xyz - 0.5 ; sR = normalize ( ml * mw ) ; sS = sX . w ; sX = texture2D ( node_TEXTURE_NORMAL3_var_texture , lR ( sP ) ) ; mw = sX . xyz - 0.5 ; sT = normalize ( ml * mw ) ; sU = sX . w ; sX = texture2D ( node_TEXTURE_NORMAL3_var_texture , lR ( sQ ) ) ; mw = sX . xyz - 0.5 ; sV = normalize ( ml * mw ) ; sW = sX . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_NORMAL4",k:[{type:"node_in",name:"sY",qualifier:["vec3"],e:!1},{type:"node_in",name:"sZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"s_",qualifier:["vec3"],e:!1},{type:"node_in",name:"ta",qualifier:["vec3"],e:!1},{type:"node_out",name:"tb",qualifier:["vec3"],e:!1},{type:"node_out",name:"tc",qualifier:["float"],e:!1},{type:"node_out",name:"td",qualifier:["vec3"],e:!1},{type:"node_out",name:"te",qualifier:["float"],e:!1},{type:"node_out",name:"tf",qualifier:["vec3"],e:!1},
{type:"node_out",name:"tg",qualifier:["float"],e:!1},{type:"node_out",name:"th",qualifier:["vec3"],e:!1},{type:"node_out",name:"ti",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL4_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 tj = texture2D ( node_TEXTURE_NORMAL4_var_texture , lR ( sY ) ) ; mw = tj . xyz - 0.5 ; tb = normalize ( ml * mw ) ; tc = tj . w ; tj = texture2D ( node_TEXTURE_NORMAL4_var_texture , lR ( sZ ) ) ; mw = tj . xyz - 0.5 ; td = normalize ( ml * mw ) ; te = tj . w ; tj = texture2D ( node_TEXTURE_NORMAL4_var_texture , lR ( s_ ) ) ; mw = tj . xyz - 0.5 ; tf = normalize ( ml * mw ) ; tg = tj . w ; tj = texture2D ( node_TEXTURE_NORMAL4_var_texture , lR ( ta ) ) ; mw = tj . xyz - 0.5 ; th = normalize ( ml * mw ) ; ti = tj . w ; }".split(" ")}]},
{type:"node",name:"VALUE",k:[{type:"node_out",name:"tk",qualifier:["float"],e:!1},{type:"node_param",name:"md",qualifier:["const","float"]}],f:[{type:"textline",b:["tk","=","md",";"]}]},{type:"node",name:"ANIM_VALUE",k:[{type:"node_out",name:"tl",qualifier:["float"],e:!1},{type:"node_param",name:"me",qualifier:["const","int"]}],f:[{type:"textline",b:"tl = u_anim_values [ me ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",k:[{type:"node_in",name:"tm",qualifier:["vec3"],e:!1},{type:"node_in",name:"tn",
qualifier:["vec3"],e:!1},{type:"node_out",name:"to",qualifier:["vec3"],e:!1},{type:"node_out",name:"tp",qualifier:["float"],e:!0}],f:[{type:"textline",b:"to = tm + tn ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tp"],f:[{type:"textline",b:"tp = ( abs ( to [ 0 ] ) + abs ( to [ 1 ] ) + abs ( to [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_SUBTRACT",k:[{type:"node_in",name:"tq",qualifier:["vec3"],e:!1},{type:"node_in",name:"tr",qualifier:["vec3"],e:!1},{type:"node_out",
name:"ts",qualifier:["vec3"],e:!1},{type:"node_out",name:"tt",qualifier:["float"],e:!0}],f:[{type:"textline",b:"ts = tq - tr ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tt"],f:[{type:"textline",b:"tt = ( abs ( ts [ 0 ] ) + abs ( ts [ 1 ] ) + abs ( ts [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",k:[{type:"node_in",name:"tu",qualifier:["vec3"],e:!1},{type:"node_in",name:"tv",qualifier:["vec3"],e:!1},{type:"node_out",name:"tw",qualifier:["vec3"],
e:!1},{type:"node_out",name:"tx",qualifier:["float"],e:!0}],f:[{type:"textline",b:"tw = tu + tv ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tx"],f:[{type:"textline",b:"tx = length ( tw ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tw"],f:[{type:"textline",b:"tw = normalize ( tw ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",k:[{type:"node_in",name:"ty",qualifier:["vec3"],e:!1},{type:"node_in",name:"tz",qualifier:["vec3"],e:!1},
{type:"node_out",name:"tA",qualifier:["vec3"],e:!1},{type:"node_out",name:"tB",qualifier:["float"],e:!0}],f:[{type:"textline",b:["tA","=","lu",";"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tB"],f:[{type:"textline",b:"tB = dot ( ty , tz ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",k:[{type:"node_in",name:"tC",qualifier:["vec3"],e:!1},{type:"node_in",name:"tD",qualifier:["vec3"],e:!1},{type:"node_out",name:"tE",qualifier:["vec3"],e:!1},{type:"node_out",name:"tF",
qualifier:["float"],e:!0}],f:[{type:"textline",b:"tE = cross ( tC , tD ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tF"],f:[{type:"textline",b:"tF = length ( tE ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",k:[{type:"node_in",name:"tG",qualifier:["vec3"],e:!1},{type:"node_in",name:"tH",qualifier:["vec3"],e:!1},{type:"node_out",name:"tI",qualifier:["vec3"],e:!1},{type:"node_out",name:"tJ",qualifier:["float"],e:!0}],f:[{type:"textline",b:"tI = normalize ( tG ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tJ"],f:[{type:"textline",b:"tJ = length ( tG ) ;".split(" ")}]}]},{type:"textline",b:["tH",";"]}]},{type:"node",name:"B4W_REFLECT",k:[{type:"node_in",name:"tK",qualifier:["vec3"],e:!1},{type:"node_in",name:"tL",qualifier:["vec3"],e:!1},{type:"node_out",name:"tM",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"tM = reflect ( - tK , tL ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",k:[{type:"node_in",name:"tN",qualifier:["vec3"],e:!1},{type:"node_in",
name:"tO",qualifier:["float"],e:!1},{type:"node_in",name:"tP",qualifier:["const","float"],e:!1},{type:"node_in",name:"tQ",qualifier:["const","float"],e:!1},{type:"node_out",name:"tR",qualifier:["vec3"],e:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ float tS = length ( mp ) ; if ( tS < tQ ) { vec2 tT = lR ( tN ) ; float tU = clamp ( 0.5 * ( tQ - tS ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float tV = tO * tU ; vec3 tW = normalize ( mn * ml ) ; float tX = UNITY_VALUE_NODES / tP ; vec2 tY = tW . xy * tV / ( tP * tW . z ) ; float tZ = UNITY_VALUE_NODES ; float t_ = texture2D ( node_B4W_PARALLAX_var_texture , tT ) . a ; for ( float ua = 1.0 ; ua <= tP ; ua ++ ) { if ( t_ < tZ ) { tZ -= tX ; tT -= tY ; t_ = texture2D ( node_B4W_PARALLAX_var_texture , tT ) . a ; } } vec2 ub = tT + tY ; float uc = texture2D ( node_B4W_PARALLAX_var_texture , ub ) . a - ( tZ + tX ) ; float ud = t_ - tZ ; float ue = ud / ( ud - uc ) ; tT = ue * ub + ( UNITY_VALUE_NODES - ue ) * tT ; tR = lP ( tT ) ; } else tR = tN ; }".split(" ")}]},
{type:"node",name:"B4W_CLAMP",k:[{type:"node_in",name:"uf",qualifier:["vec3"],e:!1},{type:"node_out",name:"ug",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ug = clamp ( uf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",k:[{type:"node_in",name:"uh",qualifier:["vec3"],e:!1},{type:"node_in",name:"ui",qualifier:["float"],e:!1},{type:"node_out",name:"uj",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"uj = lz ( uh , ui ) ;".split(" ")}]},{type:"node",
name:"B4W_TRANSLUCENCY",k:[{type:"node_in",name:"uk",qualifier:["float"],e:!1},{type:"node_in",name:"ul",qualifier:["float"],e:!1},{type:"node_in",name:"um",qualifier:["float"],e:!1},{type:"node_in",name:"un",qualifier:["float"],e:!1},{type:"node_in",name:"uo",qualifier:["float"],e:!1},{type:"node_out",name:"up",qualifier:["float"],e:!0},{type:"node_out",name:"uq",qualifier:["vec4"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_up"],f:[{type:"textline",b:["up","=","uk",";"]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_uq"],f:[{type:"textline",b:"uq = vec4 ( ul , um , un , uo ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",k:[{type:"node_out",name:"ur",qualifier:["float"],e:!1}],f:[{type:"textline",b:["ur","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",k:[{type:"node_in",name:"us",qualifier:["float"],e:!1},{type:"node_in",name:"ut",qualifier:["float"],e:!1},{type:"node_in",name:"uu",qualifier:["float"],e:!1},{type:"node_out",name:"uv",qualifier:["float"],
e:!1}],f:[{type:"textline",b:"uv = smoothstep ( ut , uu , us ) ;".split(" ")}]},{type:"nodes_global"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3","mf","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float mg = kF . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3","mh","=","kG",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) mh = mh ; else mh = - mh ;".split(" ")}]}}]},{type:"textline",b:"vec3 mi = normalize ( mh ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",
a:[{type:"textline",b:"vec3 mj = cross ( mh , kH . xyz ) * kH . w ; mat3 mk = mat3 ( kH . xyz , mj , mh ) ; mat3 ml = mk ;".split(" ")}]}}]},{type:"textline",b:"vec3 mm = u_camera_eye_frag - kF ; vec3 mn = normalize ( mm ) ; vec3 mo = kF ; vec4 mp = cL ; float mq = u_emit ; float mr = u_specular_alpha ; float ms = u_ambient ; vec3 mt ; vec3 mu ; vec3 mv ; vec3 mw ; float mx ; float my ;".split(" ")},{type:"nodes_main"},{type:"textline",b:"vec3 uw = mt ; float ux = my ;".split(" ")},{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"uw = max ( uw - sqrt ( 0.01 * - min ( mg , ZERO_VALUE_NODES ) ) , 0.5 * uw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"kD ( uw , mg , u_time , mx , mv , u_sun_direction , mf , u_sun_quaternion , kF , length ( cL ) ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),
group:{type:"group",a:[{type:"textline",b:"float uy = clamp ( length ( u_sun_intensity ) + u_environment_energy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 uz = gS ( u_cube_fog , mn ) ; vec4 uA = vec4 ( uz , u_fog_color_density . a ) ; gy ( uA . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec4 uA = u_fog_color_density ; uA . rgb *= uy ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"hk ( uw , length ( cL ) , mn , u_cam_water_depth , u_underwater_fog_color_density , uA , mg , uy ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gL ( uw , length ( cL ) , uA ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( ux < 0.5 ) discard ; ux = UNITY_VALUE_NODES ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 uB = texture2DProj ( u_shadow_mask , cK ) . rg ; float uC = uB . g ; uw = vec3 ( uC ) ;".split(" ")}]}}]},{type:"textline",b:["gA","(","uw",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gD ( uw , ux ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( uw , ux ) ; }".split(" ")}]};
a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",
b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",
b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",
";"]}]}}]},{type:"textline",b:"varying vec3 kF ; varying vec4 cL ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kH",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"lS",qualifier:["varying",
"vec2"]}],f:[{type:"textline",b:["lS","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",k:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"lX",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["lX","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"lY",
qualifier:["varying","float"]}],f:[{type:"textline",b:["lY","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"lZ",qualifier:["varying","vec2"]}],f:[{type:"textline",b:["lZ","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute",
"vec3"]},{type:"node_param",name:"l_",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["l_","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec3 ma = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mb = a_normal ; vec3 mc = vec3 ( a_tangent ) ; vec3 md = a_tangent [ 3 ] * cross ( mb , mc ) ;".split(" ")}]}},{type:"elif",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec3 mb = a_normal ; vec3 mc = vec3 ( 0.0 ) ; vec3 md = vec3 ( 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mb = vec3 ( 0.0 ) ; vec3 mc = vec3 ( 0.0 ) ; vec3 md = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"ma = mix ( ma , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"mb = mix ( mb , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 me = vec3 ( a_tangent ) ; vec3 mf = a_tangent_next [ 3 ] * cross ( a_normal_next , me ) ; mc = mix ( mc , me , u_va_frame_factor ) ; md = mix ( md , mf , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",
b:"bt ( ma , mc , md , mb ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","mg","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mg = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 mh = ( u_model_matrix * vec4 ( mg , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],
group:{type:"group",a:[{type:"textline",b:"mat4 mi = ag ( u_camera_eye , mh , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 mi = aa ( u_camera_eye , mh , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 mj = ( u_model_matrix * vec4 ( mg , 1.0 ) ) . xyz ; mi = mi * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , mj ) ;".split(" ")}]}}]},
{type:"textline",b:"d mk = an ( ma - mg , mg , mc , md , mb , mi ) ; mk . b = mh ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d mk = an ( ma , mg , mc , md , mb , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ck ( mk . a , mk . b , mb ) ;".split(" ")}]}}]},{type:"textline",b:"kF = mk . a ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"kG = mk . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"float ml = ( dot ( cross ( mk . e , mk . c ) , mk . d ) < 0.0 ) ? - 1.0 : 1.0 ; kH = vec4 ( mk . c , ml ) ;".split(" ")}]}}]},{type:"textline",b:"cL = u_view_matrix * vec4 ( mk . a , 1.0 ) ; vec4 mm = u_proj_matrix * cL ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"mm . xy += u_subpixel_jitter * mm . w ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gr","(","mm",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gr ( mk . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_B4W_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:"float mn = mm . x ; float mo = mm . y ; float mp = mm . w ; cK . x = ( mn + mp ) / 2.0 ; cK . y = ( mo + mp ) / 2.0 ; cK . z = mp ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kJ = - cL . z / u_view_max_depth ;".split(" ")}]}}]},{type:"nodes_main"},{type:"textline",b:["gl_Position","=","mm",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float ma ; varying vec3 kI ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cL",";"]}]}}]},{type:"textline",b:"void main ( ) { float mb = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; float mc = smoothstep ( u_p_alpha_start , u_p_alpha_end , mb ) ; float md = u_diffuse_color . a * ma * ( 1.0 - clamp ( mc , 0.0 , 1.0 ) ) ; vec3 me = kI * u_diffuse_color . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gL ( me , length ( cL ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["gA","(","me",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gD ( me , md ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( me , md ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",
b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",
b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float ma ; varying vec3 kI ; varying vec3 cL ;".split(" ")},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { mb mT ; mT = mS ( ) ; vec4 mU = u_view_matrix * vec4 ( mT . b , 1.0 ) ; gl_Position = u_proj_matrix * mU ; ma = mT . c ; kI = mT . d ; cL = mU . xyz ; float mV = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = mT . a * mV ; }".split(" ")}]};
a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"fog.glslf"},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float ma ; varying vec3 kI ; varying vec2 a ; varying vec3 kE ; varying vec3 kF ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 lu = u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"vec4 lv = texture2D ( u_sampler , a ) ; gy ( lv . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lu . rgb = mix ( lu . rgb , lv . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lu . rgb *= mix ( vec3 ( 1.0 ) , lv . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"lu . a = lv . a ;".split(" ")}]}}]},{type:"textline",b:"lu . rgb *= kI ; vec3 lw = u_diffuse_intensity * lu . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","PARTICLES_SHADELESS"],group:{type:"group",a:[{type:"textline",b:"vec3 lx = u_emit * lu . rgb ; vec3 ly = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 lz = u_environment_energy * textureCube ( u_sky_texture , ly ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lA = 0.5 ; vec3 lz = u_environment_energy * mix ( u_horizon_color , u_zenith_color , lA ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lB = u_ambient * lz ; float lC = u_specular_params [ 0 ] ; vec2 lD = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 lE = lC * u_specular_color ; vec3 lF = normalize ( kE ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hw lG = jY ( lx , lB , lw , lE , kF , ly , lF , lD , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) , 0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hw lG = kc ( lx , lB , lw ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lH = lG . a . rgb ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["vec3","lH","=","lw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gL ( lH , length ( cL ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"float lI = lu . a * ma ; gA ( lH ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gD ( lH , lI ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lH , lI ) ; }".split(" ")}]};
a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float ma ; varying vec3 kI ; varying vec2 a ; varying vec3 kE ; varying vec3 kF ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float lw ( vec2 lu , vec2 lv ) { return ( atan ( lv . y , lv . x ) - atan ( lu . y , lu . x ) ) ; } void main ( ) { mb lx ; lx = mS ( ) ; float ly ; mat4 lz ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { ly = lx . e ; lz = z ( lx . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { ly = lx . e ; lz = k ( ) ; lz [ 3 ] = vec4 ( lx . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { ly = lx . e ; lz = o ( radians ( 90.0 ) ) ; lz [ 3 ] = vec4 ( lx . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { ly = lw ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + lx . e ; lz = m ( radians ( - 90.0 ) ) ; lz [ 3 ] = vec4 ( lx . b , 1.0 ) ; } vec4 lA = vec4 ( a_p_bb_vertex * 2.0 * lx . a * u_p_size , 0.0 , 1.0 ) ; vec4 lB = lz * q ( ly ) * lA ; vec4 lC = u_view_matrix * lB ; vec4 lD = u_proj_matrix * lC ; gl_Position = lD ; ma = lx . c ; kI = lx . d ; a = a_p_bb_vertex + 0.5 ; kF = lB . xyz ; kE = u_camera_eye - lB . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["cL","=","lC",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 mT ; const float mU = 0.99 ; const float mV = 1.8 ; const int mW = 8 ; float nf ( vec3 mX , vec3 mY ) { float mZ = dot ( mY , mY ) ; float m_ = 2.0 * dot ( mY , mX ) ; float na = dot ( mX , mX ) - 1.0 ; float nb = m_ * m_ - 4.0 * mZ * na ; float nc = sqrt ( nb ) ; float nd = ( - m_ - nc ) / 2.0 ; float ne = na / nd ; return ne ; } float nm ( float ng , float nh ) { float ni = 3.0 * ( 1.0 - nh * nh ) ; float nj = 2.0 * ( 2.0 + nh * nh ) ; float nk = 1.0 + ng * ng ; float nl = pow ( 1.0 + nh * nh - 2.0 * nh * ng , 1.5 ) ; nl = max ( nl , 0.00001 ) ; return ( ni / nj ) * ( nk / nl ) ; } float nu ( vec3 nn , vec3 no , float np ) { float nq = dot ( no , - nn ) ; if ( nq < 0.0 ) { return 1.0 ; } vec3 nr = nn + nq * no ; if ( length ( nr ) < np ) { return 0.0 ; } else if ( length ( nr ) >= np ) { vec3 ns = normalize ( nr ) * np - nn ; float nt = acos ( dot ( normalize ( ns ) , no ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( nt * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 ny ( float nv , vec3 nw , float nx ) { return nw - nw * pow ( u_sky_color , vec3 ( nx / nv ) ) ; } void main ( ) { vec3 nz = normalize ( mT ) ; vec3 nA = u_sun_direction ; float nB = dot ( nz , nA ) ; float nC = nm ( nB , - 0.01 ) * u_rayleigh_brightness * nA . y ; float nD = nm ( nB - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - nA . y ) ; float nE = smoothstep ( 0.0 , 100.0 , nm ( nB , 0.9995 ) ) * u_spot_brightness ; vec3 nF = vec3 ( 0.0 , mU , 0.0 ) ; float nG = nf ( nF , nz ) ; float nH = nG / float ( mW ) ; float nI = nu ( nF , nz , mU - 0.3 ) ; vec3 nJ = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 nK = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int nL = 0 ; nL < mW ; nL ++ ) { float nM = nH * float ( nL ) ; vec3 nN = nF + nz * nM ; float nO = nu ( nN , nA , mU - 0.2 ) ; float nP = nf ( nN , nA ) ; vec3 nQ = ny ( nP , vec3 ( mV ) , u_scatter_strength ) * nO ; nJ += ny ( sqrt ( nM ) , u_sky_color * nQ , u_rayleigh_strength ) ; nK += ny ( nM , nQ , u_mie_strength ) ; } nJ = nJ * nI * pow ( nG , u_rayleigh_collection_power ) / float ( mW ) ; nK = ( nK * nI * pow ( nG , u_mie_collection_power ) ) / float ( mW ) ; vec3 nR = vec3 ( nE * nK + nD * nK + nC * nJ ) ; gA ( nR ) ; gl_FragColor = vec4 ( nR , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 mT ; void main ( ) { vec4 lu = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 lv = u_cube_view_matrix * lu ; mT = lv . xyz ; gl_Position = lu ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_sampler , a ) ; gA ( lu . rgb ) ; gD ( lu . rgb , lu . a ) ; gl_FragColor = lu ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { a = a_texcoord ; vec3 lu = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 lv = u_proj_matrix * u_view_matrix * vec4 ( lu , 0.0 ) ; lv . x /= lv . w ; lv . y /= lv . w ; lv += 99999.0 * step ( lv . z , 0.0 ) ; lv += 100.0 * ( step ( 1.0 , abs ( lv . x ) ) + step ( 1.0 , abs ( lv . y ) ) ) ; lv . x = - a_lf_dist * lv . x ; lv . y = - a_lf_dist * lv . y ; float lw = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 lx = vec2 ( a_lf_bb_vertex . x / lw , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float ly = 1.9 ; lx *= ( 1.0 + ly * length ( lv . xy ) ) ; } gl_Position = vec4 ( lv . xy + lx , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:["uniform","samplerCube","u_sky",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 mT ; void main ( ) { vec3 lu = textureCube ( u_sky , mT ) . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),group:{type:"group",a:[{type:"textline",b:"gy ( lu . rgb ) ; float lv = u_camera_eye_frag . y - WATER_LEVEL ; lv = min ( - lv * 0.03 , 0.8 ) ; float lw = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; vec3 lx = normalize ( mT ) ; vec3 ly = vec3 ( 0.0 ) ; vec4 lz = u_underwater_fog_color_density ; lz . rgb = mix ( lz . rgb , ly , min ( - lx . y + lv , 1.0 ) ) * lw ; float lA = clamp ( sign ( lx . y - 0.05 * lv ) , 0.0 , 1.0 ) ; lu = mix ( lz . rgb , lu , lA ) ; gA ( lu . rgb ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( lu , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 mT ; void main ( ) { vec4 lu = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 lv = u_sky_vp_inverse * lu ; mT = lv . xyz ; gl_Position = lu ; }".split(" ")}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",
name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:"uniform float u_time ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE","||","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float lu = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 kE ; varying vec3 kF ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kG",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 kH ; varying vec3 mU ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mV",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","&&","SHORE_SMOOTHING"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 nl ( in vec2 mY , in vec3 mZ , in vec3 m_ , in vec3 na , out float nb ) { vec3 nc = reflect ( - m_ , mZ ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nd = mY . xy + mZ . xz * REFL_BUMP / kJ ; nb = u_reflect_factor ; vec3 ne ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"ne = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ne = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"float nf = dot ( m_ , mZ ) ; nb *= max ( 1.0 - 1.0 / nf , 1.0 ) ; } else { ne = texture2D ( u_reflectmap , nd ) . rgb ; gy ( ne ) ; }".split(" ")}]}},
{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"nb = u_mirror_factor ; vec3 ne = na * textureCube ( u_mirrormap , nc ) . rgb ; gy ( ne ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nb = u_reflect_factor ; vec3 ne = na * vec3 ( 0.3 , 0.5 , 1.0 ) ; gy ( ne ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 ng = normalize ( nc + m_ ) ; float nh = 1.0 - dot ( m_ , ng ) ; float ni = u_fresnel_params [ 3 ] ; float nj = u_fresnel_params [ 2 ] ; float nk = ni + ( 1.0 - ni ) * pow ( nh , nj ) ; nb = min ( nb * nk , 1.0 ) ; return ne ; } void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 nm = mat3 ( kH , mU , kG ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nn = normalize ( kG ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 nm = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 nn = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","FOAM"],group:{type:"group",a:[{type:"textline",b:"float no = kF . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"vec2 np = vec2 ( mV . x , - mV . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 np = vec2 ( kF . x , - kF . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","np","=","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 nq = vec3 ( 0.0 ) ; vec3 nr = texture2D ( u_normalmap0 , np * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nq += nr ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"textline",b:"vec3 ns = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["ns","+=","nr",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"nr = texture2D ( u_normalmap0 , np * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nq += nr ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["ns","+=","nr",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"nr = texture2D ( u_normalmap0 , np * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nq += nr ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],
group:{type:"group",a:[{type:"textline",b:["ns","+=","nr",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"nr = texture2D ( u_normalmap0 , np * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nq += nr ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["ns",
"+=","nr",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 nt = nm * ns ; if ( ! g ( nt , vec3 ( 0.0 ) ) ) nt = normalize ( nt ) ; vec3 nu = mix ( nn , nt , 0.2 ) ; nu = normalize ( nu ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"nn = mix ( nn , normalize ( nm * nq ) , 0.3 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"nn = mix ( nn , normalize ( nm * nq ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"nn = normalize ( nn ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nv = normalize ( kE ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nw = cK . xy / cK . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",
b:"float nx = kJ * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float ny = u_diffuse_color . a ; vec4 nz = texture2DProj ( u_scene_depth , cK ) ; float nA = cw ( nz ) ; float nB = max ( nA - kJ , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nC = nw + nn . xz * u_refr_bump / kJ ; float nD = ll ( nA , nC , nw ) ; float nE = max ( nD - kJ , 0.0 ) ; float nF = u_view_max_depth / ABSORB * nE ; float nG ; if ( u_cam_water_depth < 0.0 ) nG = 0.0 ; else nG = min ( ny * nF , 1.0 ) ; float nH = u_view_max_depth / ABSORB * nB ; ny = min ( 15.0 * ny * u_view_max_depth * nB , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float nH = u_view_max_depth / ABSORB * nB ; if ( u_cam_water_depth > 0.0 ) ny = min ( ny * nH , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ny *= min ( 5.0 * nx , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float ny = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float nG = 1.0 - ny ; vec2 nC = nw + nn . xz * REFR_BUMP / kJ ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 nI = texture2D ( u_refractmap , nC ) . rgb ; gy ( nI ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float nJ = pow ( min ( mW . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 nK = mix ( u_shallow_water_col , u_diffuse_color . rgb , nJ ) ; nJ = pow ( min ( mW . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; nK = mix ( u_shore_water_col , nK , nJ ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nK = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float nL = max ( 1.0 - u_view_max_depth * nB , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nL = 1.0 - ny ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:"float nM = max ( no / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 nN = normalize ( vec3 ( mW . r , 0.0 , mW . g ) ) ; vec3 nO = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , nN , 0.8 ) ) ; float nP = 1.25 * max ( dot ( nu , nO ) - 0.2 , 0.0 ) ; nP += max ( dot ( nu , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; nL += nP * ( 1.0 - mW . b ) ; nM *= ( 1.0 - 0.95 * pow ( mW . b , 0.1 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"nL += nM ; nL = min ( u_foam_factor * nL , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 nQ = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + np * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"float nR = u_specular_params [ 0 ] ; vec2 nS = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 nT = nR * u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 nU = u_environment_energy * textureCube ( u_sky_texture , nn ) . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nU = u_environment_energy * u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"vec3 nV = u_ambient * nU ; vec3 nW = nV + u_sun_intensity ; float nX ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 nY = nl ( nw , nn , nv , nW , nX ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nY = nl ( vec2 ( 0.0 ) , nn , nv , nW , nX ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 nZ = u_diffuse_intensity * nK ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hw n_ = jY ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , nZ , nT , kF , nn , nv , nS , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) , 0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hw n_ = kc ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , nZ ) ;".split(" ")}]}}]},
{type:"textline",b:"nZ = n_ . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float oa = max ( dot ( u_sun_direction , - kG ) + SSS_WIDTH , 0.0 ) * max ( dot ( - nv , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; oa = clamp ( SSS_STRENGTH * oa , 0.0 , 1.0 ) ; nZ = mix ( nZ , u_shallow_water_col , oa ) ; nZ = mix ( nZ , u_shore_water_col , oa ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:"nZ = mix ( nI , nZ , nG ) ;".split(" ")}]}}]},{type:"textline",b:"nZ = mix ( nZ , nY , nX ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"float ob = mix ( nQ . g , nQ . r , max ( 4.0 * ( nL - 0.75 ) , 0.0 ) ) ; ob = mix ( nQ . b , ob , max ( 2.0 * nL - 1.0 , 0.0 ) ) ; ob = mix ( 0.0 , ob , nL ) ; nZ = mix ( nZ , nW , ob ) ;".split(" ")}]}}]},{type:"textline",b:"nZ += n_ . b ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 oc = gS ( u_cube_fog , nv ) ; vec4 od = vec4 ( oc , u_fog_color_density . a ) ; gy ( od . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","od","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { ht ( nZ , nx , u_cam_water_depth , u_underwater_fog_color_density , clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ) ; } else { gL ( nZ , nx , od ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gL ( nZ , nx , od ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["gA","(","nZ",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"ny = max ( ny , n_ . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["ny","+=","ob",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gD ( nZ , ny ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 oe = fwidth ( mX ) ; vec3 of = smoothstep ( vec3 ( 0.0 ) , oe * lu , mX ) ; float og = min ( min ( of . x , of . y ) , of . z ) ; og = clamp ( og , 0.0 , 1.0 ) ; nZ = mix ( u_wireframe_edge_color , nZ , og ) ; ny = mix ( 1.0 , ny , og ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( nZ , ny ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",
b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 kE ; varying vec3 kF ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","kG",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 kH ; varying vec3 mU ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mV",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mW",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"vec3 lA ( in vec2 lu ) { vec2 lv = 0.5 + vec2 ( ( lu . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( lu . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; vec4 lw = texture2D ( u_shore_dist_map , lv ) ; const vec2 lx = vec2 ( 1.0 / 255.0 , 1.0 ) ; float ly = dot ( lw . ba , lx ) ; vec2 lz = normalize ( lw . rg * 2.0 - 1.0 ) ; return vec3 ( lz , ly ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},
{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void lR ( inout vec3 lB , in float lC , in vec3 lD ) { float lE = dM ( DST_NOISE_SCALE_0 * ( lB . xz + DST_NOISE_FREQ_0 * lC ) ) * dM ( DST_NOISE_SCALE_1 * ( lB . zx - DST_NOISE_FREQ_1 * lC ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float lF = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float lG = lD . b ; float lH = sqrt ( lG ) ; float lI = max ( lG , DIR_MIN_SHR_FAC ) * sin ( lH / lF + DIR_FREQ * lC ) ; float lJ = max ( dM ( DIR_NOISE_SCALE * ( lB . xz + DIR_NOISE_FREQ * lC ) ) , DIR_MIN_NOISE_FAC ) ; lI *= lJ ; float lK = WAVES_HEIGHT * mix ( lI , lE , max ( lH , DST_MIN_FAC ) ) ; vec2 lL = lD . rg ; float lM = WAVES_HOR_FAC * lI * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - lG ) , 0.0 ) ; vec2 lN = lM * lL ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float lK = WAVES_HEIGHT * lE ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"vec2 lO = 2.0 * ( lB . xz - 0.1 * lC ) ; vec2 lP = 1.3 * ( lB . zx + 0.03 * lC ) ; float lQ = dg ( 0.5 * lO ) . x + dg ( 0.5 * lP ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lB . xz += lN ; lQ *= lG ;".split(" ")}]}}]},{type:"textline",
b:"lK += SMALL_WAVES_FAC * lQ ;".split(" ")}]}}]},{type:"textline",b:"lB . y += lK ; }".split(" ")}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) mX = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) mX = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) mX = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["vec3","mY","=","a_position",
";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float mZ = abs ( mY . y ) ; vec2 m_ = u_camera_eye . xz - mod ( u_camera_eye . xz , mZ ) ; mY . y = WATER_LEVEL ; mY . xz += m_ ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},{type:"textline",b:"d na = an ( mY , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC",
"&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"mV = na . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"mW = lA ( na . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float nb = length ( u_wind ) ; float nc = u_time ; nc *= nb ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["float",
"nd","=","mZ",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","nd","=","0.1",";"]}]}}]},{type:"textline",b:"vec3 ne = na . a + vec3 ( nd , 0.0 , 0.0 ) ; vec3 nf = na . a + vec3 ( 0.0 , 0.0 , nd ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 ng = lA ( ne . xz ) ; vec3 nh = lA ( nf . xz ) ; lR ( ne , nc , ng ) ; lR ( nf , nc , nh ) ; lR ( na . a , nc , mW ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"lR ( ne , nc , vec3 ( 0.0 ) ) ; lR ( nf , nc , vec3 ( 0.0 ) ) ; lR ( na . a , nc , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_position . y < 0.0 ) { na . a . y = WATER_LEVEL - 1.0 ; ne . y = na . a . y ; nf . y = na . a . y ; }".split(" ")}]}}]},{type:"textline",b:"vec3 ni = normalize ( ne - na . a ) ; vec3 nj = normalize ( nf - na . a ) ; kG = normalize ( cross ( nj , ni ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"kH = nj ; mU = cross ( kG , kH ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float nk = dot ( kG , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float nl = clamp ( 0.8 - nk , 0.0 , 1.0 ) ; kG = mix ( kG , vec3 ( 0.0 , 1.0 , 0.0 ) , nl ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"kF = na . a ; kE = u_camera_eye - na . a ; vec4 nm = u_view_matrix * vec4 ( na . a , 1.0 ) ; vec4 nn = u_proj_matrix * nm ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float no = nn . x ; float np = nn . y ; float nq = nn . w ; cK . x = ( no + nq ) / 2.0 ; cK . y = ( np + nq ) / 2.0 ; cK . z = nq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"kJ = - nm . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",
b:["gl_Position","=","nn",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 mX ; const float lu = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 lv = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lv = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lw = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 lx = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 ly = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec3 lz = vec3 ( 0.0 ) ; float lA = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"vec3 lB = sign ( mX - vec3 ( 0.02 * lu ) ) ; if ( lB . x < 0.0 || lB . y < 0.0 || lB . z < 0.0 ) { lz = lv ; lA = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lB = sign ( mX - vec3 ( 0.02 * lu ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( lB . x < 0.0 || lB . y < 0.0 || lB . z < 0.0 ) lz = u_wireframe_edge_color ; else lz = ly ; lA = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( lB . x < 0.0 || lB . y < 0.0 || lB . z < 0.0 ) lA = 1.0 ; else lA = 0.0 ; lz = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( lB . x < 0.0 || lB . y < 0.0 || lB . z < 0.0 ) lz = u_wireframe_edge_color ; else if ( gl_FrontFacing ) lz = lw ; else lz = lx ; lA = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 lC = fwidth ( mX ) ; vec3 lD = smoothstep ( vec3 ( 0.0 ) , lC * lu , mX ) ; float lE = min ( min ( lD . x , lD . y ) , lD . z ) ; lE = clamp ( lE , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { lz = vec3 ( mix ( u_wireframe_edge_color , ly , lE ) ) ; lA = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { lz = u_wireframe_edge_color ; lA = mix ( 1.0 , 0.0 , lE ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) lz = mix ( u_wireframe_edge_color , lw , lE ) ; else lz = mix ( u_wireframe_edge_color , lx , lE ) ; lA = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["gA","(","lz",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gD ( lz , lA ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lz , lA ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",b:["varying","vec3","mX",";"]},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { if ( a_polyindex == 0.0 ) mX = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) mX = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) mX = vec3 ( 0.0 , 0.0 , 1.0 ) ; vec3 lu = a_position ; vec3 lv = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"d lw = an ( lu , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"lu = mix ( lu , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 lx = vec3 ( 0.0 ) ; vec3 ly = vec3 ( 0.0 ) ; bt ( lu , lx , ly , lv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["vec3","lz","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lz = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d lw = gh ( lu , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lz , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 lA = ( u_model_matrix * vec4 ( lz , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 lB = ag ( u_camera_eye , lA , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 lB = aa ( u_camera_eye , lA , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND",
"&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 lC = ( u_model_matrix * vec4 ( lz , 1.0 ) ) . xyz ; lB = lB * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lC ) ;".split(" ")}]}}]},{type:"textline",b:"d lw = an ( lu - lz , lz , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lB ) ; lw . b = lA ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d lw = an ( lu , lz , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ck ( lw . a , lw . b , lv ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec4 lD = u_view_matrix * vec4 ( lw . a , 1.0 ) ; gl_Position = u_proj_matrix * lD ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_sampler_left , a ) ; vec4 lv = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( lu [ 0 ] , lv [ 1 ] , lv [ 2 ] , lu [ 3 ] + lv [ 3 ] ) ; }".split(" ")}]};
a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 lx ( float lu , float lv ) { vec2 lw = a + vec2 ( lu , lv ) * u_texel_size ; return texture2D ( u_color , lw ) ; } float lB ( vec4 ly ) { vec3 lz = vec3 ( 0.299 , 0.587 , 0.114 ) ; float lA = dot ( ly . rgb , lz ) ; return lA ; } vec4 m_ ( ) { vec4 lC = lx ( - 1.0 , - 1.0 ) ; vec4 lD = lx ( 1.0 , - 1.0 ) ; vec4 lE = lx ( - 1.0 , 1.0 ) ; vec4 lF = lx ( 1.0 , 1.0 ) ; vec4 lG = lx ( 0.0 , 0.0 ) ; float lH = lB ( lC ) ; float lI = lB ( lD ) ; float lJ = lB ( lE ) ; float lK = lB ( lF ) ; float lL = lB ( lG ) ; float lM = min ( lL , min ( min ( lH , lI ) , min ( lJ , lK ) ) ) ; float lN = max ( lL , max ( max ( lH , lI ) , max ( lJ , lK ) ) ) ; vec2 lO ; lO . x = - ( ( lH + lI ) - ( lJ + lK ) ) ; lO . y = ( ( lH + lJ ) - ( lI + lK ) ) ; float lP = max ( ( lH + lI + lJ + lK ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float lQ = 1.0 / ( min ( abs ( lO . x ) , abs ( lO . y ) ) + lP ) ; lO = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , lO * lQ ) ) * u_texel_size ; vec4 lR = 0.5 * ( texture2D ( u_color , a + lO * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + lO * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 mY = lR * 0.5 + 0.25 * ( texture2D ( u_color , a + lO * - 0.5 ) + texture2D ( u_color , a + lO * 0.5 ) ) ; float mZ = lB ( mY ) ; if ( ( mZ < lM ) || ( mZ > lN ) ) return lR ; else return mY ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 oL ( ) { vec2 na ; na . x = a . x ; na . y = a . y ; vec4 nb = texture2D ( u_color , na ) ; vec4 nc = lx ( 0.0 , 1.0 ) ; vec4 nd = lx ( 1.0 , 0.0 ) ; vec4 ne = lx ( 0.0 , - 1.0 ) ; vec4 nf = lx ( - 1.0 , 0.0 ) ; float ng = lB ( nc ) ; float nh = lB ( nd ) ; float ni = lB ( ne ) ; float nj = lB ( nf ) ; float nk = lB ( nb ) ; float nl = max ( ng , nk ) ; float nm = min ( ng , nk ) ; float nn = max ( nh , nl ) ; float no = min ( nh , nm ) ; float np = max ( ni , nj ) ; float nq = min ( ni , nj ) ; float nr = max ( np , nn ) ; float ns = min ( nq , no ) ; float nt = nr * FXAA_QUALITY_EDGE_THRESHOLD ; float nu = nr - ns ; float nv = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , nt ) ; bool nw = nu < nv ; if ( nw ) return nb ; vec4 nx = lx ( - 1.0 , - 1.0 ) ; vec4 ny = lx ( 1.0 , 1.0 ) ; vec4 nz = lx ( 1.0 , - 1.0 ) ; vec4 nA = lx ( - 1.0 , 1.0 ) ; float nB = lB ( nx ) ; float nC = lB ( ny ) ; float nD = lB ( nz ) ; float nE = lB ( nA ) ; float nF = ni + ng ; float nG = nj + nh ; float nH = 1.0 / nu ; float nI = nF + nG ; float nJ = ( - 2.0 * nk ) + nF ; float nK = ( - 2.0 * nk ) + nG ; float nL = nD + nC ; float nM = nB + nD ; float nN = ( - 2.0 * nh ) + nL ; float nO = ( - 2.0 * ni ) + nM ; float nP = nB + nE ; float nQ = nE + nC ; float nR = ( abs ( nJ ) * 2.0 ) + abs ( nN ) ; float nS = ( abs ( nK ) * 2.0 ) + abs ( nO ) ; float nT = ( - 2.0 * nj ) + nP ; float nU = ( - 2.0 * ng ) + nQ ; float nV = abs ( nT ) + nR ; float nW = abs ( nU ) + nS ; float nX = nP + nL ; float nY = u_texel_size . x ; bool nZ = nV >= nW ; float n_ = nI * 2.0 + nX ; if ( ! nZ ) ni = nj ; if ( ! nZ ) ng = nh ; if ( nZ ) nY = u_texel_size . y ; float oa = ( n_ * ( 1.0 / 12.0 ) ) - nk ; float ob = ni - nk ; float oc = ng - nk ; float od = ni + nk ; float oe = ng + nk ; bool of = abs ( ob ) >= abs ( oc ) ; float og = max ( abs ( ob ) , abs ( oc ) ) ; if ( of ) nY = - nY ; float oh = clamp ( abs ( oa ) * nH , 0.0 , 1.0 ) ; vec2 oi ; oi . x = na . x ; oi . y = na . y ; vec2 oj ; oj . x = ( ! nZ ) ? 0.0 : u_texel_size . x ; oj . y = ( nZ ) ? 0.0 : u_texel_size . y ; if ( ! nZ ) oi . x += nY * 0.5 ; if ( nZ ) oi . y += nY * 0.5 ; vec2 ok ; ok . x = oi . x - oj . x ; ok . y = oi . y - oj . y ; vec2 ol ; ol . x = oi . x + oj . x ; ol . y = oi . y + oj . y ; float om = ( ( - 2.0 ) * oh ) + 3.0 ; float on = lB ( texture2D ( u_color , ok ) ) ; float oo = oh * oh ; float op = lB ( texture2D ( u_color , ol ) ) ; if ( ! of ) od = oe ; float oq = og * 1.0 / 4.0 ; float or = nk - od * 0.5 ; float os = om * oo ; bool ot = or < 0.0 ; on -= od * 0.5 ; op -= od * 0.5 ; bool ou = abs ( on ) >= oq ; bool ov = abs ( op ) >= oq ; if ( ! ou ) ok . x -= oj . x * 1.5 ; if ( ! ou ) ok . y -= oj . y * 1.5 ; bool ow = ( ! ou ) || ( ! ov ) ; if ( ! ov ) ol . x += oj . x * 1.5 ; if ( ! ov ) ol . y += oj . y * 1.5 ; if ( ow ) { if ( ! ou ) on = lB ( texture2D ( u_color , ok . xy ) ) ; if ( ! ov ) op = lB ( texture2D ( u_color , ol . xy ) ) ; if ( ! ou ) on = on - od * 0.5 ; if ( ! ov ) op = op - od * 0.5 ; ou = abs ( on ) >= oq ; ov = abs ( op ) >= oq ; if ( ! ou ) ok . x -= oj . x * 2.0 ; if ( ! ou ) ok . y -= oj . y * 2.0 ; ow = ( ! ou ) || ( ! ov ) ; if ( ! ov ) ol . x += oj . x * 2.0 ; if ( ! ov ) ol . y += oj . y * 2.0 ; if ( ow ) { if ( ! ou ) on = lB ( texture2D ( u_color , ok . xy ) ) ; if ( ! ov ) op = lB ( texture2D ( u_color , ol . xy ) ) ; if ( ! ou ) on = on - od * 0.5 ; if ( ! ov ) op = op - od * 0.5 ; ou = abs ( on ) >= oq ; ov = abs ( op ) >= oq ; if ( ! ou ) ok . x -= oj . x * 2.0 ; if ( ! ou ) ok . y -= oj . y * 2.0 ; ow = ( ! ou ) || ( ! ov ) ; if ( ! ov ) ol . x += oj . x * 2.0 ; if ( ! ov ) ol . y += oj . y * 2.0 ; if ( ow ) { if ( ! ou ) on = lB ( texture2D ( u_color , ok . xy ) ) ; if ( ! ov ) op = lB ( texture2D ( u_color , ol . xy ) ) ; if ( ! ou ) on = on - od * 0.5 ; if ( ! ov ) op = op - od * 0.5 ; ou = abs ( on ) >= oq ; ov = abs ( op ) >= oq ; if ( ! ou ) ok . x -= oj . x * 4.0 ; if ( ! ou ) ok . y -= oj . y * 4.0 ; ow = ( ! ou ) || ( ! ov ) ; if ( ! ov ) ol . x += oj . x * 4.0 ; if ( ! ov ) ol . y += oj . y * 4.0 ; if ( ow ) { if ( ! ou ) on = lB ( texture2D ( u_color , ok . xy ) ) ; if ( ! ov ) op = lB ( texture2D ( u_color , ol . xy ) ) ; if ( ! ou ) on = on - od * 0.5 ; if ( ! ov ) op = op - od * 0.5 ; ou = abs ( on ) >= oq ; ov = abs ( op ) >= oq ; if ( ! ou ) ok . x -= oj . x * 2.0 ; if ( ! ou ) ok . y -= oj . y * 2.0 ; if ( ! ov ) ol . x += oj . x * 2.0 ; if ( ! ov ) ol . y += oj . y * 2.0 ; } } } } float ox = na . x - ok . x ; float oy = ol . x - na . x ; if ( ! nZ ) ox = na . y - ok . y ; if ( ! nZ ) oy = ol . y - na . y ; bool oz = ( on < 0.0 ) != ot ; float oA = ( oy + ox ) ; bool oB = ( op < 0.0 ) != ot ; float oC = 1.0 / oA ; bool oD = ox < oy ; float oE = min ( ox , oy ) ; bool oF = oD ? oz : oB ; float oG = os * os ; float oH = ( oE * ( - oC ) ) + 0.5 ; float oI = oG * FXAA_QUALITY_SUBPIX ; float oJ = oF ? oH : 0.0 ; float oK = max ( oJ , oI ) ; if ( ! nZ ) na . x += oK * nY ; if ( nZ ) na . y += oK * nY ; return texture2D ( u_color , na ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = m_ ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = oL ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 lu = vec2 ( 0.0 , 0.0 ) ; vec2 lv = u_texel_size ; vec4 lw = texture2D ( u_color , a ) ; gl_FragColor = lw * 0.0875447373698 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0858112354248 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0808139781061 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0731235112908 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0635705267419 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0530985673112 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0426125984122 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0328565115809 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * lw , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_main , a ) ; vec4 lv = texture2D ( u_bloom , a ) ; vec4 lw = lu ; lw += lv ; gl_FragColor = vec4 ( lw . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_color , a ) ; vec3 lv = lu . rgb ; if ( u_brightness < 0.0 ) lv = lv * ( 1.0 + u_brightness ) ; else lv = lv + ( ( 1.0 - lv ) * u_brightness ) ; lv = ( lv - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; lv *= u_exposure ; vec3 lw = vec3 ( 0.299 , 0.587 , 0.114 ) ; float lx = dot ( lv , lw ) ; lv = mix ( vec3 ( lx ) , lv , u_saturation ) ; gl_FragColor = vec4 ( lv , lu . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = cs ( clamp ( ne ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { vec4 nf = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { float ng = ne ( u_depth , a , u_camera_range ) ; ng *= u_view_max_depth ; float nh ; if ( ng < u_dof_dist ) nh = ( u_dof_dist - ng ) / u_dof_front ; else nh = ( ng - u_dof_dist ) / u_dof_rear ; nh = clamp ( nh , 0.0 , 1.0 ) ; vec4 ni = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( nf , ni , nh ) ; } else gl_FragColor = nf ; }".split(" ")}]};
a["postprocessing/edge.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; uniform vec2 u_texel_size ; varying vec2 a ; float lz ( float lu , float lv , float lw ) { vec2 lx = a + vec2 ( lu , lv ) * u_texel_size ; vec4 ly = texture2D ( u_sampler , lx ) * lw ; return cw ( ly ) ; } void main ( ) { float lA = ( lz ( - 1.0 , - 1.0 , - 1.0 ) + lz ( 0.0 , - 1.0 , - 1.0 ) + lz ( 1.0 , - 1.0 , - 1.0 ) + lz ( - 1.0 , 0.0 , - 1.0 ) + lz ( 0.0 , 0.0 , 8.0 ) + lz ( 1.0 , 0.0 , - 1.0 ) + lz ( - 1.0 , 1.0 , - 1.0 ) + lz ( 0.0 , 1.0 , - 1.0 ) + lz ( 1.0 , 1.0 , - 1.0 ) ) ; lA *= 1000.0 ; gl_FragColor = vec4 ( lA , lA , lA , 1.0 ) ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_glow_src ; uniform sampler2D u_glow_mask ; uniform sampler2D u_glow_mask_blurred ; uniform vec3 u_glow_color ; uniform float u_draw_glow ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_glow_src , a ) ; gl_FragColor = lu ; if ( u_draw_glow != 0.0 ) { vec4 lv = texture2D ( u_glow_mask , a ) ; vec4 lw = texture2D ( u_glow_mask_blurred , a ) ; float lx = lw . a - lv . a ; if ( lx != 0.0 ) { float ly = smoothstep ( 0.0 , 1.0 , lw . a ) ; if ( lv . a == 0.0 ) { vec3 lz = u_glow_color ; gA ( lz ) ; vec4 lA = vec4 ( clamp ( lz , 0.0 , 1.0 ) , ly ) ; gl_FragColor = mix ( lu , lA , ly ) ; } } } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float nf ; varying vec2 ng ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 nh ; void main ( ) { vec2 ni = ( nh . xy - a ) ; float nj = length ( ni ) ; vec2 nk = u_radial_blur_step * ni / nj ; float nl = nj / u_radial_blur_step ; nk *= min ( nl , STEPS_PER_PASS ) / STEPS_PER_PASS ; nl = max ( nl , STEPS_PER_PASS ) ; vec2 nm = a ; float nn = 0.0 ; for ( float no = 0.0 ; no < STEPS_PER_PASS ; no += 1.0 ) { if ( no <= nl ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"float np = ne ( u_input , nm , u_camera_range ) ; nn += max ( ( 1.0 - pow ( nj , 0.3 ) ) * step ( 0.9 , np ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 nq = texture2D ( u_input , nm ) ; nn += cw ( nq ) ;".split(" ")}]}}]},{type:"textline",b:"} nm += nk ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"vec2 nr = a + ng ; float ns = dg ( vec2 ( 2.5 * ( nr . x ) , 2.5 * ( nr . y ) + 1.0 * u_time ) ) . x + 0.75 * dg ( vec2 ( 5.0 * ( nr . x ) - 0.66 * u_time , 5.0 * ( nr . y ) + 0.66 * u_time ) ) . x + 0.5 * dM ( vec2 ( 7.5 * ( nr . x ) + 0.33 * u_time , 7.5 * ( nr . y ) - 0.33 * u_time ) ) ; ns *= clamp ( 1.2 - sqrt ( 0.2 * nj ) , 0.0 , 1.0 ) * nf ; nn = max ( ns , nn ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = cs ( nn / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform vec4 u_refl_plane ; varying float nf ; varying vec2 ng ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"varying vec2 a ; varying vec4 nh ; void lB ( in vec4 lu , in vec3 lv , out vec3 lw ) { float lx = lu . w * lv . x + lu . y * lv . z - lu . z * lv . y ; float ly = lu . w * lv . y + lu . z * lv . x - lu . x * lv . z ; float lz = lu . w * lv . z + lu . x * lv . y - lu . y * lv . x ; float lA = - lu . x * lv . x - lu . y * lv . y - lu . z * lv . z ; lw . x = lx * lu . w - lA * lu . x - ly * lu . z + lz * lu . y ; lw . y = ly * lu . w - lA * lu . y - lz * lu . x + lx * lu . z ; lw . z = lz * lu . w - lA * lu . z - lx * lu . y + ly * lu . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 lC = normalize ( u_sun_direction ) ; nh = u_proj_matrix * u_view_matrix * vec4 ( lC , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_camera_eye . y + a_bb_vertex . t < - u_refl_plane . w ) { nf = 1.0 ; vec3 lD = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 lE ; lB ( u_camera_quat , lD , lE ) ; lE = normalize ( lE ) ; float lF = dot ( lE , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lG = atan ( lE . x , lE . z ) ; ng = vec2 ( - lG , acos ( lF ) ) ; } else { nf = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"nh . x /= nh . w ; nh . y /= nh . w ; nh . x = 0.5 * ( nh . x + 1.0 ) ; nh . y = 0.5 * ( nh . y + 1.0 ) ; nh += 99999.0 * step ( nh . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_main , a ) ; vec3 lv = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; gy ( lu . rgb ) ; float lw = cw ( texture2D ( u_god_rays , a ) ) ; vec3 lx = lu . rgb + u_god_rays_intensity * vec3 ( lw ) * lv ; gA ( lx ) ; gl_FragColor . rgb = lx ; gl_FragColor . a = lu . a ; }".split(" ")}]};
a["postprocessing/lanczos.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_color , a ) * 0.38026 ; lu += texture2D ( u_color , a - u_texel_size ) * 0.27667 ; lu += texture2D ( u_color , a + u_texel_size ) * 0.27667 ; lu += texture2D ( u_color , a - 2.0 * u_texel_size ) * 0.08074 ; lu += texture2D ( u_color , a + 2.0 * u_texel_size ) * 0.08074 ; lu += texture2D ( u_color , a - 3.0 * u_texel_size ) * - 0.02612 ; lu += texture2D ( u_color , a + 3.0 * u_texel_size ) * - 0.02612 ; lu += texture2D ( u_color , a - 4.0 * u_texel_size ) * - 0.02143 ; lu += texture2D ( u_color , a + 4.0 * u_texel_size ) * - 0.02143 ; gl_FragColor = lu ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_input , a ) ; float lv = dot ( lu . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( lv ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float lu ; float lv = 0.0 ; for ( float lw = 0.025 ; lw < 1.0 ; lw += 0.05 ) for ( float lx = 0.025 ; lx < 1.0 ; lx += 0.05 ) { lu = max ( texture2D ( u_input , vec2 ( lw , lx ) ) . r , 0.01 ) ; lv += log ( lu ) ; } float ly = exp ( lv / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( ly ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float ni ; void main ( ) { float nj = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; float nk = texture2D ( u_luminance , a ) . r ; vec4 nl = texture2D ( u_main , a ) ; float nm = nk / nj ; float nn = u_bloom_edge_lum ; gl_FragColor = nl * max ( nm - nn , 0.0 ) * ni ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float ni ; const vec3 lu = vec3 ( 0.0 , 1.0 , 0.0 ) ; void lC ( in vec4 lv , in vec3 lw , out vec3 lx ) { float ly = lv . w * lw . x + lv . y * lw . z - lv . z * lw . y ; float lz = lv . w * lw . y + lv . z * lw . x - lv . x * lw . z ; float lA = lv . w * lw . z + lv . x * lw . y - lv . y * lw . x ; float lB = - lv . x * lw . x - lv . y * lw . y - lv . z * lw . z ; lx . x = ly * lv . w - lB * lv . x - lz * lv . z + lA * lv . y ; lx . y = lz * lv . w - lB * lv . y - lA * lv . x + ly * lv . z ; lx . z = lA * lv . w - lB * lv . z - ly * lv . y + lz * lv . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 lD ; lC ( u_camera_quat , lu , lD ) ; ni = dot ( - lD , u_sun_direction ) * u_bloom_key ; ni *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_mb_tex_curr , a ) ; vec4 lv = texture2D ( u_mb_tex_accum , a ) ; if ( length ( lu - lv ) > BLUR_DECAY_THRESHOLD ) { gl_FragColor = ( 1.0 - u_motion_blur_exp ) * lu + u_motion_blur_exp * lv ; } else { gl_FragColor = lu ; } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"vec4 lu = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( lu . r + lu . g + lu . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lv = vec2 ( 0.0 , 0.0 ) ; vec2 lw = u_texel_size ; vec4 lx ; lx = texture2D ( u_color , a ) ; gl_FragColor = lx * 0.2270270270 ; lv += lw ; lx = texture2D ( u_color , a + lv ) ; gl_FragColor += lx * 0.1945945946 ; lx = texture2D ( u_color , a - lv ) ; gl_FragColor += lx * 0.1945945946 ; lv += lw ; lx = texture2D ( u_color , a + lv ) ; gl_FragColor += lx * 0.1216216216 ; lx = texture2D ( u_color , a - lv ) ; gl_FragColor += lx * 0.1216216216 ; lv += lw ; lx = texture2D ( u_color , a + lv ) ; gl_FragColor += lx * 0.0540540541 ; lx = texture2D ( u_color , a - lv ) ; gl_FragColor += lx * 0.0540540541 ; lv += lw ; lx = texture2D ( u_color , a + lv ) ; gl_FragColor += lx * 0.0162162162 ; lx = texture2D ( u_color , a - lv ) ; gl_FragColor += lx * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 lw = u_texel_size ; vec4 lx = texture2D ( u_color , a ) ; gl_FragColor = lx ; if ( lx . a == 0.0 ) { lx = texture2D ( u_color , a + lw ) ; if ( lx . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , lx . a ) ; else { lx = texture2D ( u_color , a - lw ) ; if ( lx . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , lx . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; varying vec2 a ; void main ( ) { a = a_bb_vertex + 0.5 ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",
b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","nj",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nk ; varying vec4 nl ; varying vec4 nm ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nn",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",
b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",
a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",
")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec3 nt ( vec2 no , sampler2D np ) { float nq = texture2D ( np , no ) . r ; float nr = texture2D ( np , nk . xy ) . r ; float ns = texture2D ( np , nk . zw ) . r ; return vec3 ( nq , nr , ns ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nz ( vec2 nu , sampler2D nv ) { vec3 nw = nt ( nu , nv ) ; vec2 nx = abs ( nw . xx - nw . yz ) ; vec2 ny = step ( SMAA_PREDICATION_THRESHOLD , nx ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * ny ) ; }".split(" ")}]}}]},{type:"textline",b:"void nD ( bvec2 nA , inout vec2 nB , vec2 nC ) { if ( nA . x ) nB . x = nC . x ; if ( nA . y ) nB . y = nC . y ; } void nD ( bvec4 nE , inout vec4 nF , vec4 nG ) { nD ( nE . xy , nF . xy , nG . xy ) ; nD ( nE . zw , nF . zw , nG . zw ) ; } vec2 nI ( vec2 nH ) { return sign ( nH ) * floor ( abs ( nH ) + .5 ) ; } vec4 nI ( vec4 nJ ) { return sign ( nJ ) * floor ( abs ( nJ ) + .5 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 n_ ( vec2 nK , sampler2D nL".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","nM"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"vec2 nN = nz ( nK , nM ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 nN = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nO = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float nP = dot ( texture2D ( nL , nK ) . rgb , nO ) ; float nQ = dot ( texture2D ( nL , nk . xy ) . rgb , nO ) ; float nR = dot ( texture2D ( nL , nk . zw ) . rgb , nO ) ; vec4 nS ; nS . xy = abs ( nP - vec2 ( nQ , nR ) ) ; vec2 nT = step ( nN , nS . xy ) ; if ( dot ( nT , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float nU = dot ( texture2D ( nL , nl . xy ) . rgb , nO ) ; float nV = dot ( texture2D ( nL , nl . zw ) . rgb , nO ) ; nS . zw = abs ( nP - vec2 ( nU , nV ) ) ; vec2 nW = max ( nS . xy , nS . zw ) ; float nX = dot ( texture2D ( nL , nm . xy ) . rgb , nO ) ; float nY = dot ( texture2D ( nL , nm . zw ) . rgb , nO ) ; nS . zw = abs ( vec2 ( nQ , nR ) - vec2 ( nX , nY ) ) ; nW = max ( nW . xy , nS . zw ) ; float nZ = max ( nW . x , nW . y ) ; nT . xy *= step ( nZ , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * nS . xy ) ; return nT ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 ob ( vec2 oa ) { oa . r = oa . r * abs ( 5.0 * oa . r - 5.0 * 0.75 ) ; return nI ( oa ) ; } vec4 ob ( vec4 oc ) { oc . rb = oc . rb * abs ( 5.0 * oc . rb - 5.0 * 0.75 ) ; return nI ( oc ) ; } vec2 ok ( sampler2D od , vec2 oe , vec2 of , out vec2 og ) { vec4 oh = vec4 ( oe , - 1.0 , 1.0 ) ; vec3 oi = vec3 ( u_texel_size , 1.0 ) ; for ( int oj = 0 ; oj < SMAA_MAX_SEARCH_STEPS_DIAG ; oj ++ ) { if ( oh . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && oh . w > 0.9 ) { oh . xyz += oi * vec3 ( of , 1.0 ) ; og = texture2D ( od , oh . xy , 0.0 ) . rg ; oh . w = dot ( og , vec2 ( 0.5 , 0.5 ) ) ; } } return oh . zw ; } vec2 os ( sampler2D ol , vec2 om , vec2 on , out vec2 oo ) { vec4 op = vec4 ( om , - 1.0 , 1.0 ) ; op . x += 0.25 * u_texel_size . x ; vec3 oq = vec3 ( u_texel_size , 1.0 ) ; for ( int or = 0 ; or < SMAA_MAX_SEARCH_STEPS_DIAG ; or ++ ) { if ( op . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && op . w > 0.9 ) { op . xyz = oq * vec3 ( on , 1.0 ) + op . xyz ; oo = texture2D ( ol , op . xy , 0.0 ) . rg ; oo = ob ( oo ) ; op . w = dot ( oo , vec2 ( 0.5 , 0.5 ) ) ; } } return op . zw ; } vec2 oy ( sampler2D ot , vec2 ou , vec2 ov , float ow ) { vec2 ox = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * ov + ou ; ox = SMAA_AREATEX_PIXEL_SIZE * ox + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; ox . x += 0.5 ; ox . y += SMAA_AREATEX_SUBTEX_SIZE * ow ; return texture2D ( ot , ox , 0.0 ) . rg ; } vec2 oN ( sampler2D oz , sampler2D oA , vec2 oB , vec2 oC , vec4 oD ) { vec2 oE = vec2 ( 0.0 , 0.0 ) ; vec4 oF ; vec2 oG ; if ( oC . r > 0.0 ) { oF . xz = ok ( oz , oB , vec2 ( - 1.0 , 1.0 ) , oG ) ; oF . x += float ( oG . y > 0.9 ) ; } else oF . xz = vec2 ( 0.0 , 0.0 ) ; oF . yw = ok ( oz , oB , vec2 ( 1.0 , - 1.0 ) , oG ) ; if ( oF . x + oF . y > 2.0 ) { vec4 oH = vec4 ( - oF . x + 0.25 , oF . x , oF . y , - oF . y - 0.25 ) * u_texel_size . xyxy + oB . xyxy ; vec4 oI ; oI . xy = texture2D ( oz , oH . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; oI . zw = texture2D ( oz , oH . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; oI . yxwz = ob ( oI . xyzw ) ; vec2 oJ = vec2 ( 2.0 , 2.0 ) * oI . xz + oI . yw ; nD ( bvec2 ( step ( 0.9 , oF . zw ) ) , oJ , vec2 ( 0.0 , 0.0 ) ) ; oE += oy ( oA , oF . xy , oJ , oD . z ) ; } oF . xz = os ( oz , oB , vec2 ( - 1 , - 1 ) , oG ) ; if ( texture2D ( oz , oB + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { oF . yw = os ( oz , oB , vec2 ( 1 , 1 ) , oG ) ; oF . y += float ( oG . y > 0.9 ) ; } else oF . yw = vec2 ( 0.0 , 0.0 ) ; if ( oF . x + oF . y > 2.0 ) { vec4 oK = vec4 ( - oF . x , - oF . x , oF . y , oF . y ) * u_texel_size . xyxy + oB . xyxy ; vec4 oL ; oL . x = texture2D ( oz , oK . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; oL . y = texture2D ( oz , oK . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; oL . zw = texture2D ( oz , oK . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 oM = vec2 ( 2.0 , 2.0 ) * oL . xz + oL . yw ; nD ( bvec2 ( step ( 0.9 , oF . zw ) ) , oM , vec2 ( 0 , 0 ) ) ; oE += oy ( oA , oF . xy , oM , oD . w ) . gr ; } return oE ; }".split(" ")}]}}]},
{type:"textline",b:"float oT ( sampler2D oO , vec2 oP , float oQ ) { vec2 oR = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 oS = SMAA_SEARCHTEX_SIZE * vec2 ( oQ , 1.0 ) ; oR += vec2 ( - 1.0 , 1.0 ) ; oS += vec2 ( 0.5 , - 0.5 ) ; oR *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; oS *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( oO , oR * oP + oS , 0.0 ) . r ; } float pa ( sampler2D oU , sampler2D oV , vec2 oW , float oX ) { vec2 oY = vec2 ( 0.0 , 1.0 ) ; for ( int oZ = 0 ; oZ < SMAA_MAX_SEARCH_STEPS ; oZ ++ ) { if ( oW . x > oX && oY . g > 0.8281 && oY . r == 0.0 ) { oY = texture2D ( oU , oW , 0.0 ) . rg ; oW = - vec2 ( 2.0 , 0.0 ) * u_texel_size + oW ; } } float o_ = - ( 255.0 / 127.0 ) * oT ( oV , oY , 0.0 ) + 3.25 ; return u_texel_size . x * o_ + oW . x ; } float pi ( sampler2D pb , sampler2D pc , vec2 pd , float pe ) { vec2 pf = vec2 ( 0.0 , 1.0 ) ; for ( int pg = 0 ; pg < SMAA_MAX_SEARCH_STEPS ; pg ++ ) { if ( pd . x < pe && pf . g > 0.8281 && pf . r == 0.0 ) { pf = texture2D ( pb , pd , 0.0 ) . rg ; pd = vec2 ( 2.0 , 0.0 ) * u_texel_size + pd ; } } float ph = - ( 255.0 / 127.0 ) * oT ( pc , pf , 0.5 ) + 3.25 ; return - u_texel_size . x * ph + pd . x ; } float pq ( sampler2D pj , sampler2D pk , vec2 pl , float pm ) { vec2 pn = vec2 ( 1.0 , 0.0 ) ; for ( int po = 0 ; po < SMAA_MAX_SEARCH_STEPS ; po ++ ) { if ( pl . y > pm && pn . r > 0.8281 && pn . g == 0.0 ) { pn = texture2D ( pj , pl , 0.0 ) . rg ; pl = - vec2 ( 0.0 , 2.0 ) * u_texel_size + pl ; } } float pp = - ( 255.0 / 127.0 ) * oT ( pk , pn . gr , 0.0 ) + 3.25 ; return u_texel_size . y * pp + pl . y ; } float py ( sampler2D pr , sampler2D ps , vec2 pt , float pu ) { vec2 pv = vec2 ( 1.0 , 0.0 ) ; for ( int pw = 0 ; pw < SMAA_MAX_SEARCH_STEPS ; pw ++ ) { if ( pt . y < pu && pv . r > 0.8281 && pv . g == 0.0 ) { pv = texture2D ( pr , pt , 0.0 ) . rg ; pt = vec2 ( 0.0 , 2.0 ) * u_texel_size + pt ; } } float px = - ( 255.0 / 127.0 ) * oT ( ps , pv . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * px + pt . y ; } vec2 pF ( sampler2D pz , vec2 pA , float pB , float pC , float pD ) { vec2 pE = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * nI ( 4.0 * vec2 ( pB , pC ) ) + pA ; pE = SMAA_AREATEX_PIXEL_SIZE * pE + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; pE . y = SMAA_AREATEX_SUBTEX_SIZE * pD + pE . y ; return texture2D ( pz , pE , 0.0 ) . rg ; } void pN ( sampler2D pG , inout vec2 pH , vec4 pI , vec2 pJ ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pK = step ( pJ . xy , pJ . yx ) ; vec2 pL = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pK ; pL /= pK . x + pK . y ; vec2 pM = vec2 ( 1.0 , 1.0 ) ; pM . x -= pL . x * texture2D ( pG , pI . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; pM . x -= pL . y * texture2D ( pG , pI . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; pM . y -= pL . x * texture2D ( pG , pI . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; pM . y -= pL . y * texture2D ( pG , pI . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; pH *= clamp ( pM , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void pV ( sampler2D pO , inout vec2 pP , vec4 pQ , vec2 pR ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pS = step ( pR . xy , pR . yx ) ; vec2 pT = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pS ; pT /= pS . x + pS . y ; vec2 pU = vec2 ( 1.0 , 1.0 ) ; pU . x -= pT . x * texture2D ( pO , pQ . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; pU . x -= pT . y * texture2D ( pO , pQ . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; pU . y -= pT . x * texture2D ( pO , pQ . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; pU . y -= pT . y * texture2D ( pO , pQ . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; pP *= clamp ( pU , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qn ( vec2 pW , vec2 pX , sampler2D pY , sampler2D pZ , sampler2D p_ , vec4 qa ) { vec4 qb = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 qc = texture2D ( pY , pW ) . rg ; if ( qc . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"qb . rg = oN ( pY , pZ , pW , qc , qa ) ; if ( qb . r == - qb . g ) {".split(" ")}]}}]},
{type:"textline",b:"vec2 qd ; vec3 qe ; qe . x = pa ( pY , p_ , nk . xy , nm . x ) ; qe . y = nl . y ; qd . x = qe . x ; float qf = texture2D ( pY , qe . xy , 0.0 ) . r ; qe . z = pi ( pY , p_ , nk . zw , nm . y ) ; qd . y = qe . z ; qd = abs ( nI ( qd / u_texel_size . xx - pX . xx ) ) ; vec2 qg = sqrt ( qd ) ; float qh = texture2D ( pY , qe . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; qb . rg = pF ( pZ , qg , qf , qh , qa . y ) ; qe . y = pW . y ; pN ( pY , qb . rg , qe . xyzy , qd ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else qc . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( qc . r > 0.0 ) { vec2 qi ; vec3 qj ; qj . y = pq ( pY , p_ , nl . xy , nm . z ) ; qj . x = nk . x ; qi . x = qj . y ; float qk = texture2D ( pY , qj . xy , 0.0 ) . g ; qj . z = py ( pY , p_ , nl . zw , nm . w ) ; qi . y = qj . z ; qi = abs ( nI ( qi / u_texel_size . yy - pX . yy ) ) ; vec2 ql = sqrt ( qi ) ; float qm = texture2D ( pY , qj . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; qb . ba = pF ( pZ , ql , qk , qm , qa . x ) ; qj . x = pW . x ; pV ( pY , qb . ba , qj . xyxz , qi ) ; } return qb ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qE ( vec2 qo , sampler2D qp , sampler2D qq".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qr"]}]}}]},{type:"textline",b:") { vec4 qs ; qs . x = texture2D ( qq , nj . xy ) . a ; qs . y = texture2D ( qq , nj . zw ) . g ; qs . wz = texture2D ( qq , qo ) . xz ; if ( dot ( qs , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 qt = texture2D ( qp , qo , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qu = texture2D ( qr , a ) ; vec2 qv = 2.0 * cE ( qu ) - 1.0 ; qt . a = sqrt ( 2.0 * length ( qv ) ) ;".split(" ")}]}}]},{type:"textline",b:"return qt ; } else { bool qw = max ( qs . x , qs . z ) > max ( qs . y , qs . w ) ; vec4 qx = vec4 ( 0.0 , qs . y , 0.0 , qs . w ) ; vec2 qy = qs . yw ; nD ( bvec4 ( qw , qw , qw , qw ) , qx , vec4 ( qs . x , 0.0 , qs . z , 0.0 ) ) ; nD ( bvec2 ( qw , qw ) , qy , qs . xz ) ; qy /= dot ( qy , vec2 ( 1.0 , 1.0 ) ) ; vec4 qz = qx * vec4 ( u_texel_size , - u_texel_size ) + qo . xyxy ; vec4 qA = qy . x * texture2D ( qp , qz . xy , 0.0 ) ; qA += qy . y * texture2D ( qp , qz . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qB = texture2D ( qr , qz . xy ) ; vec2 qC = 2.0 * cE ( qB ) - 1.0 ; vec2 qD = qy . x * qC ; qB = texture2D ( qr , qz . zw ) ; qC = 2.0 * cE ( qB ) - 1.0 ; qD += qy . y * qC ; qA . a = sqrt ( 2.0 * length ( qD ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","qA",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qQ ( vec2 qF , sampler2D qG , sampler2D qH".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qI"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qJ = texture2D ( qI , a ) ; vec2 qK ; qK = 2.0 * cE ( qJ ) - 1.0 ; vec4 qL = texture2D ( qG , qF ) ; vec4 qM = texture2D ( qH , qF - qK ) ; float qN = abs ( qL . a * qL . a - qM . a * qM . a ) / 2.0 ; float qO = 0.5 * clamp ( 1.0 - sqrt ( qN ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; vec4 qP = mix ( qL , qM , qO ) ; qP . a = 1.0 ; return qP ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qL = texture2D ( qG , qF ) ; vec4 qM = texture2D ( qH , qF ) ; return mix ( qL , qM , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qR = vec4 ( n_ ( a , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qR = qn ( a , nn , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qR = qE ( a , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],
group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qR = vec4 ( qQ ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qR = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","qR",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","nj",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nk ; varying vec4 nl ; varying vec4 nm ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nn",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"void lv ( vec2 lu ) { nk = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + lu . xyxy ; nl = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + lu . xyxy ; nm = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + lu . xyxy ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"void ly ( vec2 lw , out vec2 lx ) { lx = lw / u_texel_size ; nk = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + lw . xyxy ; nl = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + lw . xyxy ; nm = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( nk . xz , nl . yw ) ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS",
"==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"void lA ( vec2 lz ) { nj = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + lz . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { a = a_bb_vertex + 0.5 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:["lv","(","a",")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"ly ( a , nn ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["lA","(","a",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},{type:"define",
name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float np ( in vec2 no ) { return ne ( u_depth , no , u_camera_range ) ; } void main ( ) { float nq = texture2D ( u_color , a ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( nq , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"vec3 nr = normalize ( 2.0 * texture2D ( u_ssao_special_tex , a * 0.25 / u_texel_size ) . rgb - 1.0 ) ; float ns = np ( a ) ; float nt = ns * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_8"],group:{type:"group",a:[{type:"textline",b:"const float nu = 8.0 ; const int nv = 1 ;".split(" ")}]}},
{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"const float nu = 16.0 ; const int nv = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_24"],group:{type:"group",a:[{type:"textline",b:"const float nu = 24.0 ; const int nv = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"const float nu = 32.0 ; const int nv = 4 ;".split(" ")}]}}]},{type:"textline",b:"float nw = u_ssao_radius_increase * 0.001 ; const float nx = 1.0 + 2.4 / nu ; float ny = 0.0 ; for ( int nz = 0 ; nz < nv ; nz ++ ) for ( int nA = - 1 ; nA <= 1 ; nA += 2 ) for ( int nB = - 1 ; nB <= 1 ; nB += 2 ) for ( int nC = - 1 ; nC <= 1 ; nC += 2 ) { vec3 nD = reflect ( normalize ( vec3 ( nA , nB , nC ) ) , nr ) * ( nw *= nx ) ; vec3 nE = vec3 ( a , nt ) ; nE += vec3 ( nD . xy , nD . z * nt * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nE . z -= 1.4 * ( nE . z - nt ) * step ( nt , nE . z ) ;".split(" ")}]}}]},{type:"textline",b:"float nF = np ( nE . xy ) * ( u_camera_range . y - u_camera_range . x ) ; float nG = clamp ( ( nt - nF ) / nF , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"ny += mix ( 1.0 , nG , step ( nF , nE . z ) ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"ny += mix ( step ( nE . z , nF ) , 0.5 , nG ) ;".split(" ")}]}}]},{type:"textline",b:"} ny = ny / nu ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"ny = clamp ( ny * ny + 0.6 * ny , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ny = clamp ( ny * ny + ny , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"float nH = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * ns ) ; ny = mix ( 1.0 , ny , nH ) ; gl_FragColor = vec4 ( nq , ny , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float np ( in vec2 no ) { return ne ( u_depth , no , u_camera_range ) ; }".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float nq = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nr = np ( a ) ; float ns = 0.0 ; float nt = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",b:"vec2 nu = vec2 ( - 2.0 ) ; for ( int nv = 0 ; nv < 4 ; ++ nv ) { for ( int nw = 0 ; nw < 4 ; ++ nw ) { vec2 nx = ( nu + vec2 ( float ( nv ) , float ( nw ) ) ) * u_texel_size ; float ny = texture2D ( u_ssao_mask , a + nx ) . g ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nz = np ( a + nx ) ; float nA = 1.0 - clamp ( abs ( nz - nr ) * nt , 0.0 , 1.0 ) ; nq += ny * nA ; ns += nA ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["nq","+=","ny",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nq / ns , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nq / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { float lu = texture2D ( u_depth , a ) . x ; vec4 lv = vec4 ( a * 2.0 - 1.0 , 2.0 * lu - 1.0 , 1.0 ) ; vec4 lw = u_view_proj_inverse * lv ; vec4 lx = lw / lw . w ; vec4 ly = u_view_proj_prev * lx ; ly /= ly . w ; vec2 lz = ( lv . xy - ly . xy ) / 4.0 + 0.5 ; lz = clamp ( lz , 0.0 , 1.0 ) ; gl_FragColor = cs ( lz ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float b = 0.0 ; float c = 1.0 ; struct d { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool g ( vec3 e , vec3 f ) { return any ( lessThan ( abs ( e - f ) , vec3 ( EPSILON ) ) ) ; } vec3 j ( in vec4 h , in vec3 i ) { return i + 2.0 * cross ( h . xyz , cross ( h . xyz , i ) + h . w * i ) ; } mat4 k ( ) { return mat4 ( c , b , b , b , b , c , b , b , b , b , c , b , b , b , b , c ) ; } mat4 m ( float l ) { return mat4 ( c , b , b , b , b , cos ( l ) , sin ( l ) , b , b , - sin ( l ) , cos ( l ) , b , b , b , b , c ) ; } mat4 o ( float n ) { return mat4 ( cos ( n ) , b , - sin ( n ) , b , b , c , b , b , sin ( n ) , b , cos ( n ) , b , b , b , b , c ) ; } mat4 q ( float p ) { return mat4 ( cos ( p ) , sin ( p ) , b , b , - sin ( p ) , cos ( p ) , b , b , b , b , c , b , b , b , b , c ) ; } d s ( in d r ) { return d ( r . a , r . b , normalize ( r . c ) , normalize ( r . d ) , normalize ( r . e ) , r . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 t = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 z ( vec3 u , mat4 v ) { vec3 w = vec3 ( v [ 0 ] [ 0 ] , v [ 1 ] [ 0 ] , v [ 2 ] [ 0 ] ) ; vec3 x = vec3 ( v [ 0 ] [ 1 ] , v [ 1 ] [ 1 ] , v [ 2 ] [ 1 ] ) ; vec3 y = vec3 ( v [ 0 ] [ 2 ] , v [ 1 ] [ 2 ] , v [ 2 ] [ 2 ] ) ; x = cross ( y , w ) ; return mat4 ( vec4 ( w , 0.0 ) , vec4 ( x , 0.0 ) , vec4 ( y , 0.0 ) , vec4 ( u , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 F ( vec3 A , vec3 B ) { vec3 C = A - B ; C . y = 0.0 ; C = normalize ( C ) ; vec3 D = normalize ( cross ( t , C ) ) ; vec3 E = normalize ( cross ( C , D ) ) ; return mat4 ( vec4 ( D , 0.0 ) , vec4 ( E , 0.0 ) , vec4 ( C , 0.0 ) , vec4 ( B , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 Q ( in vec3 G , float H , float I , float J , vec3 L ) { float M = fract ( length ( L ) / 0.17 ) ; float N = J + M / 10.0 ; float O = M ; if ( J != 0.0 ) O /= J ; G *= 1.0 + 0.5 * sin ( H ) ; float P = length ( G ) * I * sin ( 2.0 * 3.14 * H * N + O ) ; return q ( P ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 aa ( in vec3 R , in vec3 S , in mat4 T ) {".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 U = z ( S , T ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"float V = fract ( ( S . x * 1.43 + S . y * 0.123 + S . z * 6.1 ) ) ; float W = 2.0 * M_PI * V ; vec3 X = normalize ( vec3 ( T [ 0 ] [ 2 ] , 0.0 , T [ 2 ] [ 2 ] ) ) ; float Y = acos ( X [ 2 ] ) ; if ( X [ 0 ] < 0.0 ) Y = 2.0 * M_PI - Y ; float Z = Y - W ; if ( Z < 0.0 ) Z = 2.0 * M_PI + Z ; float _ = W ; if ( Z <= MAX_BILLBOARD_ANGLE ) _ += Z ; else if ( Z <= M_PI - MAX_BILLBOARD_ANGLE ) _ += MAX_BILLBOARD_ANGLE * ( 2.0 * Z - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( Z <= M_PI + MAX_BILLBOARD_ANGLE ) _ += Z - M_PI ; else if ( Z <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) _ += MAX_BILLBOARD_ANGLE * ( 2.0 * Z - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else _ += Z - 2.0 * M_PI ; mat4 U = o ( _ ) ; U [ 3 ] = vec4 ( S , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 U = F ( R , S ) ;".split(" ")}]}}]},{type:"textline",b:["return","U",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 ag ( in vec3 ab , in vec3 ac , in mat4 ad , mat4 ae ) { mat4 af = aa ( ab , ac , ad ) ; ae [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; af *= ae ; return af ; }".split(" ")}]}}]},{type:"textline",b:"d an ( in vec3 ah , in vec3 ai , in vec3 aj , in vec3 ak , in vec3 al , in mat4 am ) { ah = ( am * vec4 ( ah , 1.0 ) ) . xyz ; ai = ( am * vec4 ( ai , 1.0 ) ) . xyz ; aj = ( am * vec4 ( aj , 0.0 ) ) . xyz ; ak = ( am * vec4 ( ak , 0.0 ) ) . xyz ; al = ( am * vec4 ( al , 0.0 ) ) . xyz ; return s ( d ( ah , ai , aj , ak , al , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};
a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 aq ( vec2 ao , vec3 ap ) { return ( ao + 0.5 ) * ap . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 az ( in vec4 ar , in vec4 as , in float at ) { float au = ar [ 0 ] * as [ 0 ] + ar [ 1 ] * as [ 1 ] + ar [ 2 ] * as [ 2 ] + ar [ 3 ] * as [ 3 ] ; if ( au < 0.0 ) { as *= - 1.0 ; au = - au ; } if ( abs ( au ) >= 1.0 ) return ar ; float av = acos ( au ) ; float aw = sqrt ( 1.0 - au * au ) ; if ( abs ( aw ) < 0.001 ) return vec4 ( ar * 0.5 + as * 0.5 ) ; float ax = sin ( ( 1.0 - at ) * av ) / aw ; float ay = sin ( at * av ) / aw ; return ar * ax + as * ay ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aO ( in vec3 aA , in vec4 aB , in vec4 aC , in vec4 aD , in vec4 aE , in float aF ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aG = az ( aB , aC , aF ) ; vec4 aH = mix ( aD , aE , aF ) ; vec3 aI = j ( aG , aA ) ; vec3 aJ = aI * aH . w + aH . xyz ; return aJ ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aK = j ( aB , aA ) ; vec3 aL = j ( aC , aA ) ; vec3 aM = aK * aD . w + aD . xyz ; vec3 aN = aL * aE . w + aE . xyz ; return mix ( aM , aN , aF ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 aX ( in vec3 aP , in vec4 aQ , in vec4 aR , in float aS ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aT = az ( aQ , aR , aS ) ; vec3 aU = j ( aT , aP ) ; return aU ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aV = j ( aQ , aP ) ; vec3 aW = j ( aR , aP ) ; return mix ( aV , aW , aS ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec3 aO ( in vec3 aY , in vec4 aZ , in vec4 a_ ) { vec3 ba = j ( aZ , aY ) ; vec3 bb = ba * a_ . w + a_ . xyz ; return bb ; } vec3 aX ( in vec3 bc , in vec4 bd ) { vec3 be = j ( bd , bc ) ; return be ; }".split(" ")}]}}]},{type:"textline",b:"void bt ( inout vec3 bf , inout vec3 bg , inout vec3 bh , inout vec3 bi ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["float","bj","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { vec3 bk = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bl = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bm = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bn = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec4 bo = a_influence ; for ( int bp = 0 ; bp < 4 ; bp ++ ) { int bq = int ( bo [ bp ] ) ; float br = fract ( bo [ bp ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bk += br * aO ( bf , u_quatsb [ bq ] , u_quatsa [ bq ] , u_transb [ bq ] , u_transa [ bq ] , bj ) ; bl += br * aX ( bg , u_quatsb [ bq ] , u_quatsa [ bq ] , bj ) ; bm += br * aX ( bh , u_quatsb [ bq ] , u_quatsa [ bq ] , bj ) ; bn += br * aX ( bi , u_quatsb [ bq ] , u_quatsa [ bq ] , bj ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bk += br * aO ( bf , u_quatsb [ bq ] , u_transb [ bq ] ) ; bl += br * aX ( bg , u_quatsb [ bq ] ) ; bm += br * aX ( bh , u_quatsb [ bq ] ) ; bn += br * aX ( bi , u_quatsb [ bq ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} bf = bk ; bg = bl ; bh = bm ; bi = bn ; } if ( ! ( a_influence . y > 0.0 ) ) { int bs = int ( a_influence [ 0 ] - 1.0 ) ; if ( bs > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bf = aO ( bf , u_quatsb [ bs ] , u_quatsa [ bs ] , u_transb [ bs ] , u_transa [ bs ] , bj ) ; bg = aX ( bg , u_quatsb [ bs ] , u_quatsa [ bs ] , bj ) ; bh = aX ( bh , u_quatsb [ bs ] , u_quatsa [ bs ] , bj ) ; bi = aX ( bi , u_quatsb [ bs ] , u_quatsa [ bs ] , bj ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"bf = aO ( bf , u_quatsb [ bs ] , u_transb [ bs ] ) ; bg = aX ( bg , u_quatsb [ bs ] ) ; bh = aX ( bh , u_quatsb [ bs ] ) ; bi = aX ( bi , u_quatsb [ bs ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bH ( inout vec3 bu , in vec3 bv , in float bw , in float bx , in float by , in vec3 bz , in float bA ) { float bB = length ( bv ) ; float bC = bx * ( 1.0 + 0.1 * fract ( bB ) ) ; float bD = bw * bA * ( 1.0 + sin ( 2.0 * 3.14 * by * bC + bB ) ) ; float bE = ( bu . y - bv . y ) * abs ( bD ) ; bE += 1.0 ; bE *= bE ; bE = bE * bE - bE ; vec3 bF = bu ; bF . xz += bz . xz * bE * sign ( bD ) ; float bG = length ( bu - bv ) ; bu = bv + normalize ( bF - bv ) * bG ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bJ ( vec4 bI ) { return bI * bI * ( 3.0 - 2.0 * bI ) ; } vec4 bL ( vec4 bK ) { return abs ( fract ( bK + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bN ( vec4 bM ) { return bJ ( bL ( bM ) ) ; } void cd ( inout vec3 bO , in float bP , in vec3 bQ , in vec3 bR , in vec3 bS , in float bT , in float bU , in float bV , in vec3 bW ) { float bX ; float bY ; float bZ ; vec2 b_ ; vec4 ca ; vec2 cb ; vec3 cc ; bX = dot ( bS , vec3 ( 1.0 ) ) ; bY = bX + bW . g ; bZ = dot ( bO , vec3 ( bW . g ) ) ; b_ = ( bP + vec2 ( bZ , bY ) ) ; ca = ( ( fract ( ( b_ . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bR ) * bT ; ca = bN ( ca ) ; cb = ca . xz + ca . yw ; cb . y = 0.5 - cb . y ; cc = cb . xyx * bW . rbr * vec3 ( bU * bQ . x , bV , bU * bQ . z ) ; bO += cc ; }".split(" ")}]}}]},
{type:"textline",b:"void ck ( inout vec3 ce , inout vec3 cf , in vec3 cg ) { vec3 ch = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vec3 ci = cf ; vec3 cj = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ci = ce ; vec3 cj = cf ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"cd ( ci , u_time , cg , ch , cj , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bH ( ci , cj , au_wind_bending_amp , au_wind_bending_freq , u_time , ch , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bH ( ci , cj , au_wind_bending_amp , au_wind_bending_freq , u_time , ch , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"ce += ci - cf ; cf = ci ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ce = ci ; cf = cj ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",
b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",
b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float cl = 255.0 ; float cm = 0.0 ; float cn = 1.0 ; vec4 cs ( const in float co ) { vec4 cp = vec4 ( cl * cl * cl , cl * cl , cl , cn ) ; vec4 cq = vec4 ( cm , cn / cl , cn / cl , cn / cl ) ; vec4 cr = fract ( co * cp ) ; cr -= cr . xxyz * cq ; return cr ; } float cw ( const in vec4 ct ) { float cu ; vec4 cv = vec4 ( cn / ( cl * cl * cl ) , cn / ( cl * cl ) , cn / cl , cn ) ; cu = dot ( ct , cv ) ; return cu ; } vec4 cs ( const in vec2 cx ) { vec2 cy = vec2 ( cl , cn ) ; vec2 cz = vec2 ( cm , cn / cl ) ; vec4 cA = fract ( cx . xxyy * cy . xyxy ) ; cA -= cA . xxzz * cz . xyxy ; if ( cx . r == cn ) cA . rg = vec2 ( cm , cn ) ; if ( cx . g == cn ) cA . ba = vec2 ( cm , cn ) ; return cA ; } vec2 cE ( const in vec4 cB ) { vec2 cC ; vec2 cD = vec2 ( cn / cl , cn ) ; cC . r = dot ( cB . rg , cD ) ; cC . g = dot ( cB . ba , cD ) ; return cC ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float cM = 0.0 ; float cN = 1.0 ; vec4 cP ( vec4 cO ) { return cO - floor ( cO * ( cN / 289.0 ) ) * 289.0 ; } vec3 cP ( vec3 cQ ) { return cQ - floor ( cQ * ( cN / 289.0 ) ) * 289.0 ; } vec2 cP ( vec2 cR ) { return cR - floor ( cR * ( cN / 289.0 ) ) * 289.0 ; } vec4 cT ( vec4 cS ) { return cS - floor ( cS * ( cN / 7.0 ) ) * 7.0 ; } vec4 cV ( vec4 cU ) { return cP ( ( 34.0 * cU + 5.0 ) * cU ) ; }".split(" ")},{type:"define",name:"K",
b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 dg ( vec2 cW ) { vec2 cX = cP ( floor ( cW ) ) ; vec2 cY = fract ( cW ) ; vec4 cZ = cY . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 c_ = cY . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 da = cV ( cX . x + vec4 ( cM , cN , cM , cN ) ) ; da = cV ( da + cX . y + vec4 ( cM , cM , cN , cN ) ) ; vec4 db = cT ( da ) * K + K2 ; vec4 dc = cT ( floor ( da * K ) ) * K + K2 ; vec4 dd = cZ + JITTER * db ; vec4 de = c_ + JITTER * dc ; vec4 df = dd * dd + de * de ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"df . xy = min ( df . xy , df . zw ) ; df . x = min ( df . x , df . y ) ; return df . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"df . xy = ( df . x < df . y ) ? df . xy : df . yx ; df . xz = ( df . x < df . z ) ? df . xz : df . zx ; df . xw = ( df . x < df . w ) ? df . xw : df . wx ; df . y = min ( df . y , df . z ) ; df . y = min ( df . y , df . w ) ; return sqrt ( df . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 dw ( vec2 dh , float di ) { vec2 dj = cP ( floor ( dh ) ) ; vec2 dk = fract ( dh ) ; vec4 dl = dk . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 dm = dk . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 dn = cV ( dj . x + vec4 ( cM , cN , cM , cN ) ) ; dn = cV ( dn + dj . y + vec4 ( cM , cM , cN , cN ) ) ; vec4 dp = cT ( dn ) * K + K2 ; vec4 dq = cT ( floor ( dn * K ) ) * K + K2 ; vec4 dr = dl + JITTER * dp ; vec4 ds = dm + JITTER * dq ; vec4 dt = dr * dr + ds * ds ; dr += di ; ds += di ; vec4 du = dr * dr + ds * ds ; dr += di ; ds += di ; vec4 dv = dr * dr + ds * ds ; dt . xy = min ( dt . xy , dt . zw ) ; dt . x = min ( dt . x , dt . y ) ; du . xy = min ( du . xy , du . zw ) ; du . x = min ( du . x , du . y ) ; dv . xy = min ( dv . xy , dv . zw ) ; dv . x = min ( dv . x , dv . y ) ; return mat3 ( dt . xx , cM , du . xx , cM , dv . xx , cM ) ; } vec3 dy ( vec3 dx ) { return cP ( ( ( dx * 34.0 ) + cN ) * dx ) ; } float dM ( vec2 dz ) { const vec4 dA = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 dB = floor ( dz + dot ( dz , dA . yy ) ) ; vec2 dC = dz - dB + dot ( dB , dA . xx ) ; vec2 dD ; dD = ( dC . x > dC . y ) ? vec2 ( cN , cM ) : vec2 ( cM , cN ) ; vec4 dE = dC . xyxy + dA . xxzz ; dE . xy -= dD ; dB = cP ( dB ) ; vec3 dF = dy ( dy ( dB . y + vec3 ( cM , dD . y , cN ) ) + dB . x + vec3 ( cM , dD . x , cN ) ) ; vec3 dG = max ( 0.5 - vec3 ( dot ( dC , dC ) , dot ( dE . xy , dE . xy ) , dot ( dE . zw , dE . zw ) ) , cM ) ; dG = dG * dG ; dG = dG * dG ; vec3 dH = 2.0 * fract ( dF * dA . www ) - cN ; vec3 dI = abs ( dH ) - 0.5 ; vec3 dJ = floor ( dH + 0.5 ) ; vec3 dK = dH - dJ ; dG *= 1.79284291400159 - 0.85373472095314 * ( dK * dK + dI * dI ) ; vec3 dL ; dL . x = dK . x * dC . x + dI . x * dC . y ; dL . yz = dK . yz * dE . xz + dI . yz * dE . yw ; return 130.0 * dot ( dG , dL ) ; } vec2 dS ( vec2 dN ) { float dO = dot ( dN , vec2 ( 12.9898 , 78.233 ) ) ; float dP = dot ( dN , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float dQ = fract ( sin ( dO ) * 43758.5453 ) * 2.0 - cN ; float dR = fract ( sin ( dP ) * 43758.5453 ) * 2.0 - cN ; return vec2 ( dQ , dR ) ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","dT",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"const float dU = 0.1 ; const float dV = 0.1 ; const float dW = - 0.01 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"const float dX = 0.05 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mat4 dY = mat4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 , 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 , - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 , - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; mat4 dZ = mat4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 , - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 , - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 , - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"bool eb ( vec2 d_ , float ea ) { return all ( lessThanEqual ( d_ , vec2 ( 1.0 + ea ) ) ) && all ( greaterThanEqual ( d_ , vec2 ( 0.0 - ea ) ) ) ; }".split(" ")}]}}]},{type:"textline",b:"float eo ( vec3 ec , sampler2D ed , float ee ) { float ef ; ec . z = clamp ( ec . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",
a:[{type:"textline",b:"ef = 0.0 ; float eg = dS ( ec . xy ) . x * M_PI ; float eh = cos ( eg ) ; float ei = sin ( eg ) ; mat2 ej = mat2 ( eh , ei , - ei , eh ) ; vec2 ek , el ; for ( int em = 0 ; em < 4 ; em ++ ) for ( int en = 0 ; en < 4 ; en ++ ) { el . x = dY [ em ] [ en ] ; el . y = dZ [ em ] [ en ] ; el = ej * el ; ek = ec . xy + el * ee / SHADOW_TEX_RES ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ! eb ( ek , dW ) ) ef += 1.0 ; else".split(" ")}]}}]},
{type:"textline",b:"ef += step ( ec . z , texture2D ( ed , ek ) . r ) ; } ef /= 16.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["ef","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( ef , 0.0 , 1.0 ) ; } float eG ( vec3 ep , sampler2D eq , vec3 er , sampler2D es , float et , float eu , float ev ) { float ew , ex ; ep . z = clamp ( ep . z , 0.0 , 1.0 ) ; er . z = clamp ( er . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],
group:{type:"group",a:[{type:"textline",b:"ew = 0.0 ; ex = 0.0 ; float ey = dS ( ep . xy ) . x * M_PI ; float ez = cos ( ey ) ; float eA = sin ( ey ) ; mat2 eB = mat2 ( ez , eA , - eA , ez ) ; vec2 eC , eD ; for ( int eE = 0 ; eE < 4 ; eE ++ ) for ( int eF = 0 ; eF < 4 ; eF ++ ) { eD . x = dY [ eE ] [ eF ] ; eD . y = dZ [ eE ] [ eF ] ; eD = eB * eD ; eC = ep . xy + eD * et / SHADOW_TEX_RES ; ew += step ( ep . z , texture2D ( eq , eC ) . r ) ; eC = er . xy + eD * eu / SHADOW_TEX_RES ; ex += step ( er . z , texture2D ( es , eC ) . r ) ; } ew = mix ( ew , ex , ev ) ; ew /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["ew","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( ew , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"float eK ( vec2 eH ) { float eI = min ( eH . x , eH . y ) ; float eJ = min ( 1.0 - eH . x , 1.0 - eH . y ) ; return min ( eI , eJ ) ; } float eN ( float eL , float eM ) { if ( eM >= 0.0 && eM <= dV ) eL = ( eL - 1.0 ) / dV * eM + 1.0 ; return eL ; } float eZ ( vec3 eO , vec3 eP , sampler2D eQ , sampler2D eR , float eS , float eT , float eU , float eV ) { float eW ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"float eX = eK ( eO . xy ) ; if ( - eV > eU && eX >= 0.0 && eX <= dU && eb ( eP . xy , 0.0 ) ) { float eY = 1.0 - eX / dU ; eW = eG ( eO , eQ , eP , eR , eS , eT , eY ) ; } else".split(" ")}]}}]},{type:"textline",b:"eW = eo ( eO , eQ , eS ) ; return eW ; } float fg ( vec3 e_ , sampler2D fa , float fb , float fc , float fd ) { float fe = eo ( e_ , fa , fb ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - fd > fc ) { float ff = eK ( e_ . xy ) ; fe = eN ( fe , ff ) ; }".split(" ")}]}}]},{type:"textline",b:"return fe ; } float fn ( float fh ) { float fi = 1.0 ; vec3 fj = cG . xyz / cG . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"vec3 fk = cH . xyz / cH . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:"vec3 fl = cI . xyz / cI . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"vec3 fm = cJ . xyz / cJ . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( eb ( fj . xy , 0.0 ) ) { fi = eZ ( fj , fk , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , fh ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( eb ( fj . xy , dX ) ) { fi = fg ( fj , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , fh ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( eb ( fk . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"fi = eZ ( fk , fl , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , fh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"fi = fg ( fk , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , fh ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( eb ( fl . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"fi = eZ ( fl , fm , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , fh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"fi = fg ( fl , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , fh ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( eb ( fm . xy , 0.0 ) ) fi = fg ( fm , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , fh ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","fi",";","}"]}]}}]}]}}]},{type:"textline",b:"float fs ( inout vec3 fo ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 fp = texture2DProj ( u_shadow_mask , cK ) . rg ; vec3 fq = vec3 ( fp . r ) ; float fr = fp . g ; dT = vec4 ( fq , fr ) ; fo *= dT . a ; return dT . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return fn ( cL . z ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 fx ( vec3 ft , float fu , vec2 fv ) { vec2 fw = vec2 ( ( ft . x - fv . x ) / fu , - ( ft . z - fv . y ) / fu ) ; return fract ( fw ) ; } vec2 fB ( vec2 fy , float fz , vec2 fA ) { return vec2 ( fy . x * fz , - fy . y * fz ) + fA ; } d fC ( ) { return d ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } d gh ( vec3 fD , vec3 fE , vec3 fF , vec3 fG , vec3 fH , sampler2D fI , sampler2D fJ , vec3 fK , float fL , vec3 fM , vec4 fN , mat4 fO ) { vec3 fP = j ( fN , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; float fQ = - fP . x ; float fR = - fP . z ; vec2 fS = vec2 ( fM . x + fL * ( - 1.0 - fQ ) / 2.0 , fM . z + fL * ( 1.0 - fR ) / 2.0 ) ; vec2 fT = fx ( fH , fL , fS ) ; float fU = fL / 2.0 ; vec2 fV = abs ( fB ( fT - vec2 ( 0.5 ) , fL , vec2 ( 0.0 ) ) ) ; float fW = fU * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( fV ) > fW ) return fC ( ) ; float fX = fL / fK . z ; vec2 fY = ( fT - vec2 ( 0.5 ) ) * fX + vec2 ( 0.5 ) ; vec3 fZ = fP * ( fL / fK . z - 1.0 ) / 2.0 ; fY . x += fZ . x ; fY . y -= fZ . z ; vec4 f_ = texture2D ( fJ , fY ) ; float ga = f_ . r ; if ( ga < u_scale_threshold ) return fC ( ) ; float gb = fK . y - fK . x ; float gc = fK . y - texture2D ( fI , fY ) . r * gb ; vec2 gd = fD . xz - fH . xz ; fH . xz = fB ( fT , fL , fS ) ; fH . y = gc ; fD . xz = fH . xz + gd ; fD . y *= ga ; fD . y += gc ; vec3 ge = f_ . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fD -= fH ; mat4 gf = aa ( fM , fH , fO ) ; d gg = an ( fD , fH , fE , fF , fG , gf ) ; gg . b = fH ; gg . f = ge ; return s ( gg ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return s ( d ( fD , fH , fE , fF , fG , ge ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"vec4 gn ( mat4 gi , vec4 gj ) { vec2 gk = ( gi * u_v_light_matrix [ 3 ] ) . xy ; float gl = SHADOW_TEX_RES / 2.0 ; gk = floor ( gk * gl + 0.5 ) / gl - gk ; vec4 gm = gi * gj ; gm . xy += gk ; gm = u_b_light_matrix * gm ; return gm ; } void gr ( vec3 go ) { vec3 gp = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ; vec4 gq = u_v_light_matrix * vec4 ( go + u_normal_offset * gp , 1.0 ) ; cG = gn ( u_p_light_matrix0 , gq ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cH = gn ( u_p_light_matrix1 , gq ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cI = gn ( u_p_light_matrix2 , gq ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cJ = gn ( u_p_light_matrix3 , gq ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void gr ( vec4 gs ) { float gt = gs . x ; float gu = gs . y ; float gv = gs . w ; cK . x = ( gt + gv ) / 2.0 ; cK . y = ( gu + gv ) / 2.0 ; cK . z = gv ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void gy ( inout vec3 gx ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"gx = max ( vec3 ( 0.0 ) , gx ) ; gx = pow ( gx , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gA ( inout vec3 gz ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"gz = max ( vec3 ( 0.0 ) , gz ) ; gz = pow ( gz , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gD ( inout vec3 gB , in float gC ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"gB = gB * gC ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void gL ( inout vec3 gG , in float gH , in vec4 gI ) { float gJ = gI . w * gH ; float gK = exp ( - gJ * gJ ) ; gK = clamp ( gK , 0.0 , 1.0 ) ; gG = mix ( gI . rgb , gG , gK ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 gS ( in mat4 gM , in vec3 gN ) { vec3 gO = mix ( gM [ 0 ] . rgb , gM [ 1 ] . rgb , max ( sign ( gN . x ) , 0.0 ) ) ; vec3 gP = mix ( gM [ 2 ] . rgb , gM [ 3 ] . rgb , max ( sign ( gN . z ) , 0.0 ) ) ; vec3 gQ = vec3 ( gM [ 0 ] . a , gM [ 1 ] . a , gM [ 2 ] . a ) ; vec3 gR = mix ( gO , gP , abs ( gN . z ) ) ; gR = mix ( gR , gQ , abs ( gN . y ) ) ; return gR ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void gU ( inout float gT ) { gT -= 0.5 ; gT = 4.0 * ( gT * gT * gT ) + 0.5 ; } void hk ( inout vec3 gV , in float gW , in vec3 gX , in float gY , in vec4 gZ , in vec4 g_ , in float ha , in float hb ) { float hc = g_ . w * gW ; float hd = exp ( - hc * hc ) ; hd = clamp ( hd , 0.0 , 1.0 ) ; float he = max ( gX . y , 0.0 ) ; gW = max ( gW - max ( gY / he , 0.0 ) , 0.0 ) ; float hf = gZ . w * gW ; float hg = 1.0 - hf ; hg = max ( hg , 0.0 ) ; gU ( hg ) ; hg += max ( ha - 0.5 , 0.0 ) ; if ( hg < hd ) { vec3 hh = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 hi = gZ . rgb ; gY = clamp ( - gY * 0.03 , 0.0 , 0.8 ) ; vec3 hj = mix ( hi , hh , min ( he , 1.0 ) ) ; hj = mix ( hj , vec3 ( 0.0 ) , gY ) * hb ; gV = mix ( hj , gV , hg ) ; } if ( hg >= hd ) { gV = mix ( g_ . rgb , gV , hd ) ; } } void ht ( inout vec3 hl , in float hm , in float hn , in vec4 ho , in float hp ) { float hq = ho . w * hm ; float hr = 1.0 - hq ; hr = clamp ( hr , 0.0 , 1.0 ) ; gU ( hr ) ; hn = clamp ( - hn * 0.03 , 0.0 , 0.8 ) ; vec3 hs = mix ( ho . rgb , vec3 ( 0.0 ) , hn ) * hp ; hl = mix ( hs , hl , hr ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"float hu = 0.0 ; float hv = 1.0 ; struct hw { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float hE ( vec3 hx , vec3 hy , vec3 hz , vec4 hA , float hB ) { vec3 hC = normalize ( hx + hy ) ; float hD = hA [ 0 ] * max ( dot ( hz , hC ) , hu ) + hA [ 1 ] ; return pow ( hD , hB ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float hP ( vec3 hF , vec3 hG , vec3 hH , float hI ) { vec3 hJ = normalize ( hF + hG ) ; float hK = max ( dot ( hH , hJ ) , 0.001 ) ; float hL = max ( dot ( hH , hG ) , 0.01 ) ; float hM = max ( dot ( hH , hF ) , 0.01 ) ; float hN = tan ( acos ( hK ) ) ; float hO = max ( hI , 0.001 ) ; return hM * ( hv / ( 4.0 * M_PI * hO * hO ) ) * ( exp ( - ( hN * hN ) / ( hO * hO ) ) / ( sqrt ( hL * hM ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float hX ( vec3 hQ , vec3 hR , vec3 hS , float hT , float hU ) { vec3 hV = normalize ( hQ + hR ) ; float hW = acos ( dot ( hV , hS ) ) ; if ( hW < hT ) return hv ; else if ( hW >= hT + hU || hU == hu ) return hu ; else return hv - ( hW - hT ) / hU ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",
b:"void is ( float hY , vec3 hZ , vec3 h_ , vec3 ia , float ib , inout float ic ) { if ( ib > hu ) { float id = max ( dot ( hZ , ia ) , hu ) ; float ie = ib * ib ; float ig = hv - 0.5 * ( ie / ( ie + 0.33 ) ) ; vec3 ih = h_ - hY * hZ ; vec3 ii = ia - id * hZ ; if ( length ( ih ) == hu || length ( ii ) == hu || abs ( hY ) > hv || abs ( id ) > hv ) ic = ic * ig ; else { float ij = acos ( hY ) ; float ik = acos ( id ) ; vec3 il = normalize ( ih ) ; vec3 im = normalize ( ii ) ; float io , ip ; io = max ( ij , ik ) ; ip = min ( ij , ik ) ; ip *= 0.95 ; float iq = max ( dot ( il , im ) , hu ) ; float ir = 0.45 * ( ie / ( ie + 0.09 ) ) ; ic = ic * ( ig + ( ir * iq * sin ( io ) * tan ( ip ) ) ) ; } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void iz ( vec3 it , vec3 iu , float iv , float iw , out float ix ) { float iy ; if ( iv == hu ) { ix = hv ; } else { iy = hv + abs ( dot ( iu , it ) ) ; iy = iw + ( hv - iw ) * pow ( iy , iv ) ; ix = clamp ( iy , hu , hv ) ; } }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS","&&","NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"void jg ( inout hw iA , vec3 iB , vec3 iC , vec3 iD , vec3 iE , vec3 iF , vec2 iG , vec2 iH , float iI , vec3 iJ , vec3 iK , vec3 iL , vec4 iM , vec4 iN , float iO , vec4 iP ) { if ( iM . w + iN . w == hu ) return ; vec3 iQ = vec3 ( hu ) ; vec3 iR = iL * iI ; float iS = iN . z ; if ( iS != - hv ) { iQ = iJ - iD ; float iT = length ( iQ ) ; iR *= iS / ( iS + iT * iT ) ; iQ = normalize ( iQ ) ; float iU = iN . x ; float iV = iN . y ; if ( iU > - hv ) { float iW = dot ( iQ , iK ) ; iW *= smoothstep ( hu , hv , ( iW - iU ) / iV ) ; iR *= iW ; } } else iQ = iK ; float iX = hu ; if ( iM . w != hu ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"iz ( iE , iQ , iH [ 0 ] , iH [ 1 ] , iX ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float iY = max ( dot ( iE , iQ ) , hu ) ; iX = iM [ 0 ] * iY + iM [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"is ( iY , iE , iQ , iF , iH [ 0 ] , iX ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"} float iZ = hu ; if ( iN . w != hu ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"iZ = hE ( iQ , iF , iE , iM , iG [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"iZ = hP ( iQ , iF , iE , iG [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],
group:{type:"group",a:[{type:"textline",b:"iZ = hX ( iQ , iF , iE , iG [ 0 ] , iG [ 1 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["iZ","=","hu",";"]}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( iQ , iE ) * dot ( iF , iE ) < hu ) { float i_ = iP . x ; float ja = iP . y ; float jb = iP . z ; float jc = iP . w ; float jd = clamp ( abs ( dot ( iQ , iE ) ) , hu , hv ) ; float je = clamp ( dot ( iF , - iQ ) , hu , hv ) ; float jf = pow ( je , ja ) ; iA . a += iO * vec4 ( iR * jd * pow ( iB , vec3 ( i_ ) ) , hv ) ; iA . a += jb * mix ( vec4 ( iB , hv ) , vec4 ( hv ) , jc ) * iO * vec4 ( iR * jd * vec3 ( jf ) , hv ) ; } else { iA . b += iR * iC * iZ ; iA . a += vec4 ( iR * iB * iX , iZ ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"iA . b += iR * iC * iZ ; iA . a += vec4 ( iR * iB * iX , iZ ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hw jY ( vec3 jh , vec3 ji , vec3 jj , vec3 jk , vec3 jl , vec3 jm , vec3 jn , vec2 jo , vec2 jp , float jq , vec3 jr [ NUM_LIGHTS ] , vec3 js [ NUM_LIGHTS ] , vec3 jt [ NUM_LIGHTS ] , vec4 ju [ NUM_LIGHTS ] , vec4 jv [ NUM_LIGHTS ] , float jw , vec4 jx , int jy ) { hw jz ; jz . a = vec4 ( jh + jj * ji , hu ) ; jz . b = vec3 ( hu ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"textline",b:"float jA = hv ; if ( jy == 0 ) jA = jq ; jg ( jz , jj , jk , jl , jm , jn , jo , jp , jA , jr [ 0 ] , js [ 0 ] , jt [ 0 ] , ju [ 0 ] , jv [ 0 ] , jw , jx ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","1"],group:{type:"group",a:[{type:"textline",b:"float jB = hv ; if ( jy == 1 ) jB = jq ; jg ( jz , jj , jk , jl , jm , jn , jo , jp , jB , jr [ 1 ] , js [ 1 ] , jt [ 1 ] , ju [ 1 ] , jv [ 1 ] , jw , jx ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","2"],group:{type:"group",a:[{type:"textline",b:"float jC = hv ; if ( jy == 2 ) jC = jq ; jg ( jz , jj , jk , jl , jm , jn , jo , jp , jC , jr [ 2 ] , js [ 2 ] , jt [ 2 ] , ju [ 2 ] , jv [ 2 ] , jw , jx ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","3"],group:{type:"group",a:[{type:"textline",b:"float jD = hv ; if ( jy == 3 ) jD = jq ; jg ( jz , jj , jk , jl , jm , jn , jo , jp , jD , jr [ 3 ] , js [ 3 ] , jt [ 3 ] , ju [ 3 ] , jv [ 3 ] , jw , jx ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int jE = 0 ; jE < NUM_LIGHTS ; jE ++ ) { vec4 jF = ju [ jE ] ; vec4 jG = jv [ jE ] ; if ( jF . w + jG . w != hu ) { vec3 jH = vec3 ( hu ) ; vec3 jI = jt [ jE ] ; if ( jE == jy ) jI *= jq ; float jJ = jG . z ; if ( jJ != - hv ) { jH = jr [ jE ] - jl ; float jK = length ( jH ) ; jI *= jJ / ( jJ + jK * jK ) ; jH = normalize ( jH ) ; float jL = jG . x ; float jM = jG . y ; if ( jL > - hv ) { float jN = dot ( jH , js [ jE ] ) ; jN *= smoothstep ( hu , hv , ( jN - jL ) / jM ) ; jI *= jN ; } } else jH = js [ jE ] ; float jO = hu ; if ( jF . w != hu ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"iz ( jm , jH , jp [ 0 ] , jp [ 1 ] , jO ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float jP = max ( dot ( jm , jH ) , hu ) ; jO = jF [ 0 ] * jP + jF [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"is ( jP , jm , jH , jn , jp [ 0 ] , jO ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"} float jQ = hu ; if ( jG . w != hu ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"jQ = hE ( jH , jn , jm , jF , jo [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"jQ = hP ( jH , jn , jm , jo [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],
group:{type:"group",a:[{type:"textline",b:"jQ = hX ( jH , jn , jm , jo [ 0 ] , jo [ 1 ] ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( jH , jm ) * dot ( jn , jm ) < hu ) { float jR = jx . x ; float jS = jx . y ; float jT = jx . z ; float jU = jx . w ; float jV = clamp ( abs ( dot ( jH , jm ) ) , hu , hv ) ; float jW = clamp ( dot ( jn , - jH ) , hu , hv ) ; float jX = pow ( jW , jS ) ; jz . a += jw * vec4 ( jI * jV * pow ( jj , vec3 ( jR ) ) , hv ) ; jz . a += jT * mix ( vec4 ( jj , hv ) , vec4 ( hv ) , jU ) * jw * vec4 ( jI * jV * vec3 ( jX ) , hv ) ; } else { jz . b += jI * jk * jQ ; jz . a += vec4 ( jI * jj * jO , jQ ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"jz . b += jI * jk * jQ ; jz . a += vec4 ( jI * jj * jO , jQ ) ;".split(" ")}]}}]},{type:"textline",b:["}","}"]}]}}]},{type:"textline",b:["return","jz",";","}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hw kc ( vec3 jZ , vec3 j_ , vec3 ka ) { hw kb ; kb . a = vec4 ( jZ + ka * j_ , hu ) ; kb . b = vec3 ( hu ) ; return kb ; }".split(" ")}]}}]}]};a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2",
"(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void kD ( inout vec3 kd , float ke , float kf , float kg , vec3 kh , vec3 ki , vec3 kj , vec4 kk , vec3 kl , float km ) { if ( km > CAUSTICS_VIEW_DISTANCE ) return ; vec4 kn = kk ; vec3 ko = kl + kh ; ko . xz = 10.0 * sin ( 0.1 * ko . xz ) ; vec3 kp = ko + 2.0 * cross ( - kn . xyz , cross ( - kn . xyz , ko ) + kn . w * ko ) ; vec2 kq = kp . xz ; vec3 kr = ki ; float ks = max ( dot ( kh , kr ) , 0.0 ) ; float kt = 0.025 ; kq . s += 0.5 * sin ( dot ( kl + kf , vec3 ( 1.0 ) ) ) ; kq . t += 0.7 * ( - sin ( dot ( kl - kf , vec3 ( - 0.7 ) ) ) ) ; kq . st += 0.23 * cos ( 4.0 * ke - CAUST_SPEED . x * kf ) ; kq . st += 3.0 * sin ( ke - 0.3 * CAUST_SPEED . y * kf ) ; float ku = CAUST_SCALE * ( 1.0 + max ( 0.1 * ke , 0.0 ) ) ; mat3 kv = dw ( ( kq / ku ) , kt ) ; float kw = ( kv * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; float kx = ( kv * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; float ky = ( kv * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; vec3 kz = CAUST_BRIGHT * vec3 ( kw , kx , ky ) ; float kA = kg * ks ; float kB = max ( sign ( ke ) , 0.0 ) ; kA = min ( kA + 0.5 * sign ( - kh . y ) * kB , 1.0 ) ; kA *= 1.0 - kB * ( 0.1 * ke ) ; kz *= kA ; kz *= kz ; float kC = min ( - ke + 10.0 , 1.0 ) ; kd += max ( ( 2.0 * kj * kz ) * kC , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float kR ( in vec3 kK , in vec3 kL , in float kM , in float kN ) { vec3 kO = normalize ( kL + kK ) ; float kP = 1.0 - dot ( kK , kO ) ; float kQ = kN + ( 1.0 - kN ) * pow ( kP , kM ) ; return kQ ; } void lf ( inout vec3 kS , in vec3 kT , in vec3 kU , in float kV , in float kW , in float kX ) { vec3 kY = reflect ( - kT , kU ) ; float kZ = 1.0 ; if ( kV != 0.0 ) kZ = kR ( kT , kY , kV , kW ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 k_ = u_refl_plane . xyz * dot ( kU , u_refl_plane . xyz ) ; vec3 la = kU - k_ ; vec2 lb = ( u_view_matrix_frag * vec4 ( la , 0.0 ) ) . xy ; vec2 lc = cK . xy / cK . z ; lc += lb * REFL_BUMP ; vec3 ld = texture2D ( u_reflectmap , lc ) . rgb ; gy ( ld . rgb ) ; kS = mix ( kS , ld , kX * kZ ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"vec3 le = textureCube ( u_mirrormap , kY ) . xyz ; gy ( le . rgb ) ; kS = mix ( kS , le , u_mirror_factor * kZ ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]}}]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float ll ( in float lg , inout vec2 lh , in vec2 li ) { vec4 lj = texture2D ( u_scene_depth , lh ) ; float lk = cw ( lj ) ; if ( lk < kJ ) { lh = li ; return lg ; } else { return lk ; } return lg ; } vec3 lt ( in vec3 lm , in vec2 ln ) { vec2 lo = lm . xy / lm . z ; vec2 lp = lo + ln ; vec4 lq = texture2DProj ( u_scene_depth , lm ) ; float lr = cw ( lq ) ; ll ( lr , lp , lo ) ; vec3 ls = texture2D ( u_refractmap , lp ) . rgb ; gy ( ls ) ; return ls ; }".split(" ")}]}}]}]};
a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct mb { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mi ( inout float mc , float md , vec2 me , vec2 mf ) { float mg = mf . x - me . x ; float mh = ( md - me . x ) / mg ; mc = mix ( mc , mf . y , clamp ( mh , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mp ( inout vec3 mj , float mk , vec4 ml , vec4 mm ) { float mn = mm . x - ml . x ; float mo = ( mk - ml . x ) / mn ; mj = mix ( mj , mm . yzw , clamp ( mo , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"float mw ( float mq , float mr , vec2 ms [ SIZE_RAMP_LENGTH ] ) { float mt = mq / mr ; float mu = ms [ 0 ] . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mi ( mu , mt , ms [ 0 ] , ms [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mi ( mu , mt , ms [ 1 ] , ms [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mi ( mu , mt , ms [ 2 ] , ms [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mv = 1 ; mv < SIZE_RAMP_LENGTH ; mv ++ ) mi ( mu , mt , ms [ mv - 1 ] , ms [ mv ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mu",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 mD ( float mx , float my , vec4 mz [ COLOR_RAMP_LENGTH ] ) { float mA = mx / my ; vec3 mB = mz [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mp ( mB , mA , mz [ 0 ] , mz [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mp ( mB , mA , mz [ 1 ] , mz [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mp ( mB , mA , mz [ 2 ] , mz [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mC = 1 ; mC < COLOR_RAMP_LENGTH ; mC ++ ) mp ( mB , mA , mz [ mC - 1 ] , mz [ mC ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mB",";","}"]}]}}]},{type:"textline",b:"float mM ( float mE , float mF , float mG , float mH ) { float mI = max ( 0.01 , min ( mF , mG ) ) ; float mJ = max ( 0.01 , min ( mF , mH ) ) ; float mK = mF - mJ ; float mL = clamp ( mE / mI , 0.0 , 1.0 ) - step ( mK , mE ) * ( mE - mK ) / mJ ; return mL ; } mb mS ( ) { mb mN ; float mO ; if ( u_p_cyclic == 1 ) { mO = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( mO < 0.0 ) mO += u_p_length ; } if ( u_p_cyclic != 1 ) { mO = u_p_time - a_p_delay ; } if ( mO < 0.0 || mO >= a_p_lifetime ) { mN . a = 0.0001 ; mN . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( mO < 0.0 || mO >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mP = a_position ; vec3 mQ = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mP = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 mQ = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"mP += u_p_nfactor * mO * mQ ; mP += a_p_vels . xyz * mO ; mP . y -= u_p_gravity * mO * mO / 2.0 ; float mR = max ( u_p_mass , EPSILON ) ; mP += ( u_p_wind / mR ) * mO * mO / 2.0 ; mN . b = mP ; mN . e = a_p_vels . w * mO ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mN . a = mw ( mO , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mN . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mN . d = mD ( mO , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mN . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"mN . c = mM ( mO , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return mN ; }".split(" ")}]};a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float ne ( in sampler2D mY , in vec2 mZ , in vec2 m_ ) { float na = texture2D ( mY , mZ ) . r ; float nb = m_ . x ; float nc = m_ . y ; float nd = 2.0 * nb / ( nb + nc - ( 2.0 * na - 1.0 ) * ( nc - nb ) ) ; return nd ; }".split(" ")}]}};b4w.module.animation=function(a,p){var c=p("__animation"),b=p("__constraints");p("__physics");var e=p("__print"),d=p("__util");a.SLOT_0=c.SLOT_0;a.SLOT_1=c.SLOT_1;a.SLOT_2=c.SLOT_2;a.SLOT_3=c.SLOT_3;a.SLOT_4=c.SLOT_4;a.SLOT_5=c.SLOT_5;a.SLOT_6=c.SLOT_6;a.SLOT_7=c.SLOT_7;a.SLOT_ALL=c.SLOT_ALL;a.OBJ_ANIM_TYPE_ARMATURE=c.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=c.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=c.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=c.OBJ_ANIM_TYPE_SOUND;a.OBJ_ANIM_TYPE_PARTICLES=
c.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=c.OBJ_ANIM_TYPE_MATERIAL;a.OBJ_ANIM_TYPE_STATIC=c.OBJ_ANIM_TYPE_STATIC;a.AB_CYCLIC=c.AB_CYCLIC;a.AB_FINISH_RESET=c.AB_FINISH_RESET;a.AB_FINISH_STOP=c.AB_FINISH_STOP;var l=new Float32Array(4);a.is_animated=function(a){return c.is_animated(a)};a.get_actions=function(){for(var a=[],b=c.mw(),d=0;d<b.length;d++)a.push(c.oz(b[d].name));return a};a.get_current_action=function(b,c){return a.get_current_anim_name(b,c)};a.get_anim_names=function(a){return c.Cj(a)?
c.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.yw(a,b)};a.apply=function(a,b,d){if(d>c.SLOT_7)e.error("Can't apply animation to slot "+d+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{d=d||c.SLOT_0;if(c.is_animated(a)){var h=c.get_slot_num_by_anim(a,b);if(-1!=h&&h!=d){e.error('Animation "'+b+'" is already applied to object "'+a.name+'" (slot "'+h+'").');return}}c.apply(a,b,d)}};a.remove=function(a){c.remove(a)};
a.remove_slot_animation=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.remove_slot_animation(a,b))};a.apply_def=function(a){c.apply_def(a)};a.play=function(a,b,d){c.is_animated(a)?(d=d||c.SLOT_0,c.play(a,b,d),c.update_object_animation(a,0,d)):e.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.stop(a,b))};a.is_play=function(a,b){if(!c.is_animated(a))return!1;b=b||c.SLOT_0;return c.is_play(a,b)};a.set_current_frame_float=function(b,c,d){a.set_frame(b,
c,d)};a.get_current_frame_float=function(b,c){return a.get_frame(b,c)};a.set_frame=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_current_frame_float(a,b,d),c.update_object_animation(a,0,d))};a.get_frame=function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return c.get_current_frame_float(a,b)};a.set_speed=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_speed(a,b||1,d))};a.get_speed=function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return c.get_speed(a,b)};a.get_frame_range=
function(a,b){if(c.is_animated(a)){b=b||c.SLOT_0;var d=a.C[b];if(d)return[d.start,d.start+d.length]}return null};a.get_anim_start_frame=function(a,b){return c.is_animated(a)?(b=b||c.SLOT_0,c.get_anim_start_frame(a,b)):-1};a.get_anim_length=function(a,b){return c.is_animated(a)?(b=b||c.SLOT_0,c.get_anim_length(a,b)):-1};a.cyclic=function(b,d,e){a.set_behavior(b,d?c.AB_CYCLIC:c.AB_FINISH_RESET,e)};a.is_cyclic=function(a,b){if(!c.is_animated(a))return!1;b=b||c.SLOT_0;return c.is_cyclic(a,b)};a.set_behavior=
function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_behavior(a,b,d))};a.get_behavior=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.get_behavior(a,b)};a.apply_smoothing=function(a,b,d,e){e=e||c.SLOT_0;c.is_animated(a)&&c.apply_smoothing(a,b,d,e)};a.update_object_animation=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.update_object_animation(a,b||0,d))};a.frame_to_sec=function(a){return c.frame_to_sec(a)};a.get_bone_translation=function(a,c,e){if(!d.sf(a))return null;
e||(e=new Float32Array(3));b.sw(a,c,!1,l,null);e[0]=l[0];e[1]=l[1];e[2]=l[2];return e};a.get_first_armature_object=function(a){return d.is_mesh(a)?c.get_first_armature_object(a):null};a.get_slot_num_by_anim=function(a,b){return c.is_animated(a)&&b?c.get_slot_num_by_anim(a,b):null};a.get_anim_name=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.ow(a,b)};a.get_anim_type=function(a,b){return c.is_animated(a)?c.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return c.apply_to_first_empty_slot(a,
b)};a.get_skel_mix_factor=function(a){return a.d.Yd};a.set_skel_mix_factor=function(a,b,l){d.sf(a)?(b=Math.min(Math.max(b,0),1),a.d.Yd!=b&&c.set_skel_mix_factor(a,b,l||0)):e.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.assets=function(a,p){var c=p("__assets");a.AT_ARRAYBUFFER=c.AT_ARRAYBUFFER;a.AT_JSON=c.AT_JSON;a.AT_TEXT=c.AT_TEXT;a.AT_AUDIOBUFFER=c.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=c.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=c.AT_AUDIO_ELEMENT;a.enqueue=function(a,e,d){c.enqueue(a,e,d)}};b4w.module.camera=function(a,p){function c(a,c){b.rb(a)?(r.copy(c,a.d.Ua),g.v(a),e.sync_transform(a)):d.error("set_pivot(): Wrong object or camera move style")}var b=p("__camera");p("__config");var e=p("__physics"),d=p("__print"),l=p("__constraints"),g=p("__transform"),f=p("__util"),r=p("vec3"),h=p("vec4"),n=p("quat"),m=p("mat3"),s=p("mat4"),B=new Float32Array(2),z=new Float32Array(3),u=new Float32Array(3),q=new Float32Array(4),F=new Float32Array(4),k=new Float32Array(4),x=new Float32Array(9);a.MS_STATIC=
b.MS_STATIC;a.MS_ANIMATION=b.MS_ANIMATION;a.MS_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_TARGET_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=b.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=b.MS_HOVER_CONTROLS;a.is_camera=function(a){return b.is_camera(a)};a.set_move_style=function(a,b){a.d.P=b};a.get_move_style=function(a){return b.is_camera(a)?b.get_move_style(a):(d.error("get_move_style(): Wrong object"),null)};a.set_velocity_params=function(a,c){if(!b.rb(a)&&!b.tf(a)&&!b.cb(a))return d.error("set_velocity_params(): Wrong object or camera move style"),
null;var e=a.d;e.fn=c[0];e.en=c[1];e.gn=c[2]};a.get_velocity_params=function(a,c){if(!b.rb(a)&&!b.tf(a)&&!b.cb(a))return d.error("get_velocity_params(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));var e=a.d;c[0]=e.fn;c[1]=e.en;c[2]=e.gn;return c};a.change_eye_target_dist=function(){d.error("change_eye_target_dist() deprecated")};a.set_look_at=function(a,c,d,f){var h=a.d;b.Nv(c,d,f,h.g,h.quat);g.v(a);e.sync_transform(a)};a.get_eye=function(a,c){if(b.is_camera(a))return c||(c=
new Float32Array(3)),r.copy(a.d.g,c),c;d.error("get_eye(): Wrong object")};a.set_pivot=c;a.set_trans_pivot=function(a,c,f){b.rb(a)?(r.copy(c,a.d.g),r.copy(f,a.d.Ua),g.v(a),e.sync_transform(a)):d.error("set_trans_pivot(): Wrong object or camera move style")};a.get_pivot=function(a,c){if(b.rb(a))return c||(c=new Float32Array(3)),r.copy(a.d.Ua,c),c;d.error("get_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(a,c,h){if(b.rb(a)){var m=a.d,k=b.get_angles(a,B);0<f.quat_to_dir(m.quat,
f.AXIS_Z,z)[1]&&(k[1]=f.sign(k[1])*Math.PI-k[1]);k=Math.abs(k[1]+h)%(2*Math.PI);m.lk=k>Math.PI/2&&k<3*Math.PI/2;z[0]=1;z[1]=0;z[2]=0;r.transformQuat(z,m.quat,z);n.setAxisAngle(z,h,q);z[0]=0;z[1]=1;z[2]=0;h=f.quat_to_dir(m.quat,f.AXIS_MY,u);.999999>Math.abs(r.dot(h,z))&&(n.setAxisAngle(z,c,F),n.multiply(F,q,q));f.ny(m.g,m.Ua,q,m.g);g.v(a);e.sync_transform(a)}else d.error("rotate_pivot(): wrong object")};a.move_pivot=function(a,c,f){if(b.rb(a)){var h=a.d;if(h.Ur){var k=m.fromMat4(h.L,x),l=r.subtract(h.g,
h.Ua,u);z[0]=c;z[1]=0;z[2]=f;r.scale(z,r.len(l),z);r.transformMat3(z,k,z);r.add(h.Ua,z,h.Ua);r.add(h.g,z,h.g);g.v(a);e.sync_transform(a)}}else d.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(a,c){if(b.cb(a)){var h=a.d;if(h.tb&&h.Xo&&c){var m=n.setAxisAngle(f.AXIS_Y,c,q);n.normalize(m,m);n.multiply(m,h.quat,h.quat);g.v(a);e.sync_transform(a)}}else d.error("rotate_hover_cam(): wrong object")};a.get_hover_cam_angle=function(a){return b.cb(a)?b.tp(a):(d.error("get_hover_cam_angle(): wrong object or camera move style"),
null)};a.set_hover_cam_angle=function(a,c){if(b.cb(a)){var h=a.d;if(h.tb){var m=f.quat_to_dir(h.quat,f.AXIS_X,z),k=b.tp(a)-c,m=n.setAxisAngle(m,k,q),h=n.multiply(m,h.quat,q);g.set_rotation(a,h);g.v(a);e.sync_transform(a)}else d.warn("set_hover_cam_angle(): undefined without distance limits")}else d.error("set_hover_cam_angle(): wrong object or camera move style")};a.get_hover_angle_limits=function(a,c){if(b.cb(a))return a.d.Sa?(c||(c=new Float32Array(2)),c[0]=a.d.Sa.Wa,c[1]=a.d.Sa.Pa):d.warn("get_hover_angle_limits(): camera hasn't angle limits"),
c;d.error("get_hover_angle_limits(): wrong object")};a.get_cam_dist_limits=function(a,c){if(b.cb(a)||b.rb(a))return a.d.tb?(c||(c=new Float32Array(2)),c[0]=a.d.mg,c[1]=a.d.wd):d.warn("get_cam_dist_limits(): camera hasn't distance limits"),c;d.error("get_cam_dist_limits(): wrong object")};a.translate_hover_cam_v=function(a,c){if(b.cb(a)){var f=a.d;f.tb?r.copy(c,f.Ed):g.set_translation(a,c);g.v(a);e.sync_transform(a)}else d.error("translate_hover_cam_v(): wrong object")};a.get_hover_cam_pivot=function(a,
c){if(!b.cb(a))return d.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));r.copy(a.d.Ed,c);return c};a.has_distance_limits=function(a){return b.rb(a)||b.cb(a)?a.d.tb:(d.error("has_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,c,f,h){if(b.rb(a)||b.tf(a)){var m=a.d;m.Ga={Pa:c,Wa:f};h==g.SPACE_LOCAL&&b.iA(a);b.hn(a)}else if(b.cb(a)){if(c>f){d.error("apply_vertical_limits(): wrong horizontal limits");return}m=a.d;m.Ga={Pa:-f,Wa:-c}}else{d.error("apply_vertical_limits(): wrong object");
return}g.v(a);e.sync_transform(a)};a.clear_vertical_limits=function(a){a.d.Ga=null;(b.rb(a)||b.tf(a))&&b.hn(a)};a.apply_horizontal_limits=function(a,c,f,h){if(b.rb(a)||b.tf(a)){var m=a.d;m.Ia={left:c,right:f};h==g.SPACE_LOCAL&&b.bx(a);b.hn(a)}else if(b.cb(a)){if(c>f){d.error("apply_horizontal_limits(): wrong horizontal limits");return}m=a.d;m.Ia={left:c,right:f}}else{d.error("apply_horizontal_limits(): wrong object");return}g.v(a);e.sync_transform(a)};a.clear_horizontal_limits=function(a){a.d.Ia=
null};a.get_horizontal_limits=function(a,c){if(b.rb(a)||b.tf(a)||b.cb(a)){var e=a.d;c=c||new Float32Array(2);if(e.Ia)return c[0]=e.Ia.left,c[1]=e.Ia.right,c}else d.error("get_horizontal_limits(): wrong object")};a.has_horizontal_limits=function(a){if(b.rb(a)||b.tf(a)||b.cb(a))return Boolean(a.d.Ia);d.error("has_horizontal_limits(): wrong object")};a.apply_hover_angle_limits=function(a,c,f){b.cb(a)?c>f?d.error("apply_hover_angle_limits(): wrong vertical limits"):(a.d.Sa={Pa:c,Wa:f},g.v(a),e.sync_transform(a)):
d.error("apply_hover_angle_limits(): wrong object")};a.clear_hover_angle_limits=function(a){b.cb(a)?a.d.Sa=null:d.error("clear_hover_angle_limits(): wrong object")};a.apply_distance_limits=function(a,c,f){if(b.rb(a)||b.cb(a))if(c>f)d.error("apply_distance_limits(): wrong distance limits");else{var h=a.d;h.tb=!0;h.wd=c;h.mg=f;g.v(a);e.sync_transform(a)}else d.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){b.rb(a)||b.cb(a)?a.d.tb=!1:d.error("clear_distance_limits(): wrong object")};
a.set_eye_params=function(a,c,d){n.identity(a.d.quat);b.Am(a,Math.PI/2);b.ar(a,c);b.Am(a,-d);g.v(a);e.sync_transform(a)};a.is_look_up=function(a){f.quat_to_dir(a.d.quat,f.AXIS_MY,z);return 0<=z[1]?!0:!1};a.rotate=function(a,c,d){b.ar(a,c);b.Am(a,-d);g.v(a);e.sync_transform(a)};a.get_angles=function(a,c){c||(c=new Float32Array(2));b.get_angles(a,c);return c};a.set_stereo_distance=function(a,c){for(var d=a.d.K,e=0;e<d.length;e++){var f=d[e];f.type!=b.Eb&&f.type!=b.Jb||b.Ly(f,c,f.Yc)}};a.get_stereo_distance=
function(a){a=a.d.K;for(var c=0;c<a.length;c++){var d=a[c];if(d.type==b.Eb||d.type==b.Jb)return d.wi}return 0};a.is_underwater=function(a){return a.d.Or};a.translate_view=function(a,c,d,e){a=a.d.K;for(var f=0;f<a.length;f++){var g=a[f];g.Bb||b.Og(g,g.Za);var h=z;h[0]=-c;h[1]=-d;h[2]=0;s.translate(g.qa,h,g.qa);s.rotateZ(g.qa,e,g.qa);s.multiply(g.qa,g.ia,g.bg);b.mu(g);b.lu(g)}};a.correct_up=function(a,b){b||(b=f.AXIS_Y);l.correct_up(a,b)};a.zoom_object=function(a,f){if(b.rb(a)){g.get_object_center(f,
!1,z);c(a,z);g.v(a);var h=g.get_object_size(f),m=b.nw(a)/2,h=h/Math.sin(m),m=g.Nx(a,z);g.move_local(a,0,h-m,0);g.v(a);e.sync_transform(a)}else d.error("zoom_object(): wrong object")};a.set_ortho_scale=function(c,e){if(b.is_camera(c)){var f=c.d;if(b.rb(c)){var g=r.dist(f.g,f.Ua);f.ne=e/2*f.Ag/g}else b.cb(c)&&a.has_distance_limits(c)?(g=b.Dw(c),g=r.len(g),f.ne=e/2*f.Ag/g):f.ne=e/2;b.Sz(c)}else d.error("set_ortho_scale(): wrong object")};a.get_ortho_scale=function(a){if(b.is_camera(a))return a.d.K[0].type==
b.hd?2*a.d.K[0].top:0;d.error("get_ortho_scale(): wrong object")};a.is_ortho_camera=function(a){if(b.is_camera(a))return a.d.K[0].type==b.hd;d.error("is_ortho_camera(): wrong object")};a.calc_ray=function(a,c,e,f){f||(f=new Float32Array(3));var g=a.d.K[0];switch(g.type){case b.mc:case b.Re:case b.Eb:case b.Jb:var m=Math.tan(g.Ad*Math.PI/360);k[0]=(2*c/g.width-1)*m*g.Za;k[1]=-1;k[2]=(2*e/g.height-1)*m;k[3]=0;h.transformMat4(k,a.d.L,k);f[0]=k[0];f[1]=k[1];f[2]=k[2];r.normalize(f,f);return f;default:return d.error("Non-compatible camera"),
f}};a.project_point=function(a,c,e){e||(e=new Float32Array(2));var f=a.d.K[0];switch(f.type){case b.mc:case b.Re:case b.Eb:case b.Jb:return g.get_translation(a,z),r.subtract(c,z,z),k.set(z),k[3]=0,h.transformMat4(k,f.bg,k),a=-k[1]/k[3],e[0]=(k[0]/k[3]+1)/2*f.width|0,e[1]=(a+1)/2*f.height|0,e;default:return d.error("Non-compatible camera"),e}}};b4w.module.config=function(a,p){var c=p("__config");a.P_LOW=c.P_LOW;a.P_HIGH=c.P_HIGH;a.P_ULTRA=c.P_ULTRA;a.P_CUSTOM=c.P_CUSTOM;a.set=c.set;a.get=c.get;a.reset=c.reset;a.get_std_assets_path=c.get_std_assets_path};b4w.module.controls=function(a,p){var c=p("__controls");p("__print");a.CT_CONTINUOUS=c.CT_CONTINUOUS;a.CT_TRIGGER=c.CT_TRIGGER;a.CT_SHOT=c.CT_SHOT;a.CT_LEVEL=c.CT_LEVEL;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;
a.KEY_NUM9=105;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=
190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=c.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=c.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=c.PL_MULTITOUCH_MOVE_PAN;a.create_custom_sensor=c.create_custom_sensor;a.create_keyboard_sensor=c.create_keyboard_sensor;a.create_collision_sensor=c.create_collision_sensor;a.create_collision_impulse_sensor=c.create_collision_impulse_sensor;
a.create_ray_sensor=c.create_ray_sensor;a.create_mouse_click_sensor=c.create_mouse_click_sensor;a.create_mouse_wheel_sensor=c.create_mouse_wheel_sensor;a.create_mouse_move_sensor=c.create_mouse_move_sensor;a.create_touch_move_sensor=c.create_touch_move_sensor;a.create_touch_zoom_sensor=c.create_touch_zoom_sensor;a.create_motion_sensor=c.create_motion_sensor;a.create_vertical_velocity_sensor=c.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=c.create_gyro_angles_sensor;a.create_gyro_delta_sensor=
c.create_gyro_delta_sensor;a.create_timer_sensor=function(a,e){return c.create_timer_sensor(a,e||!1)};a.reset_timer_sensor=c.reset_timer_sensor;a.create_elapsed_sensor=c.create_elapsed_sensor;a.create_timeline_sensor=c.create_timeline_sensor;a.create_selection_sensor=function(a,e){return c.create_selection_sensor(a,e||!1)};a.set_custom_sensor=function(a,e){c.yy(a,e)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=c.get_sensor_value;a.get_sensor_payload=c.get_sensor_payload;a.sensor_make_positive=
function(){throw"Deprecated method execution";};a.sensor_make_negative=function(){throw"Deprecated method execution";};a.create_sensor_lock=function(a,e,d){a.bm=e.slice(0);a.am=Array(e.length);a.Kj=d||c.ml};a.remove_sensor_lock=function(a){a.bm=null;a.am=null;a.Kj=null};a.create_sensor_manifold=function(a,e,d,l,g,f,p){g=g||c.ml;c.create_sensor_manifold(a,e,d,l,g,f,void 0===p?null:p)};a.create_kb_sensor_manifold=function(a,e,d,l,g,f){l=c.create_keyboard_sensor(l);c.create_sensor_manifold(a,e,d,[l],
c.ml,g,void 0===f?null:f)};a.check_sensor_manifolds=function(a){return c.check_sensor_manifold(a,null)};a.check_sensor_manifold=c.check_sensor_manifold;a.remove_sensor_manifolds=function(a){c.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=c.remove_sensor_manifold;a.reset=c.reset;a.register_keyboard_events=c.register_keyboard_events;a.register_mouse_events=function(a,e,d){c.register_mouse_events(a,e,!!d)};a.register_wheel_events=c.register_wheel_events;a.register_touch_events=c.register_touch_events;
a.register_device_orientation=c.register_device_orientation;a.unregister_keyboard_events=c.unregister_keyboard_events;a.unregister_mouse_events=c.unregister_mouse_events;a.unregister_wheel_events=c.unregister_wheel_events;a.unregister_device_orientation=c.register_device_orientation;a.unregister_touch_events=c.unregister_touch_events};b4w.module.constraints=function(a,p){var c=p("__constraints"),b=p("__physics"),e=p("__transform");a.append_stiff=function(a,l,g,f,p){p=p||1;l instanceof Array&&2==l.length?c.Mn(a,l[0],l[1],g,f,p):c.Nn(a,l,g,f,p);e.v(a);b.sync_transform(a)};a.append_semi_stiff=function(a,l,g,f){c.Lt(a,l,g,f);e.v(a);b.sync_transform(a)};a.append_semi_stiff_cam=function(a,l,g,f,p,h,n,m){c.Kt(a,l,g,f,p,h,n,m);e.v(a);b.sync_transform(a)};a.append_semi_soft_cam=function(a,l,g,f){if(!f||0>f)f=.25;c.Jt(a,l,g,f);e.v(a);b.sync_transform(a)};
a.append_stiff_trans=function(a,l,g){c.Mt(a,l,g);e.v(a);b.sync_transform(a)};a.append_copy_trans=function(a,l,g){c.Ft(a,l,g);e.v(a);b.sync_transform(a)};a.append_stiff_trans_rot=function(a,l,g,f){c.Nt(a,l,g,f);e.v(a);b.sync_transform(a)};a.append_track=function(a,l){3==l.length?c.Qt(a,l):c.Pt(a,l);e.v(a);b.sync_transform(a)};a.append_follow=function(a,l,g,f){3==l.length?c.Ht(a,l,g,f):c.Gt(a,l,g,f);e.v(a);b.sync_transform(a)};a.remove=function(a){a.kb&&c.remove(a)}};b4w.module.data=function(a,p){var c=p("__data");p("__print");var b=p("__util");a.load=c.load;a.unload=function(a){c.unload(a|0)};a.set_debug_resources_root=c.set_debug_resources_root;a.is_primary_loaded=c.is_primary_loaded;a.load_and_add_new=c.load;a.get_bpy_world=function(){b.ga("get_bpy_world() deprecated");return null};a.cleanup=a.unload};b4w.module.debug=function(a,p){p("__batch");var c=p("__print"),b=p("__controls"),e=p("__debug"),d=p("__physics"),l=p("__scenegraph"),g=p("__scenes"),f=p("__sfx"),r=p("__textures"),h=p("__util");p("__config");var n=p("vec3");a.physics_worker=function(){d.pv()};a.physics_id=function(a){c.log("O",d.Pv(a));for(var b=d.lw().l.o,e=0;e<b.length;e++){var f=b[e];f.sb.J==a&&c.log("B",f)}};a.visible_objects=function(){for(var a=g.get_active(),b=g.Ea(a,"MESH",g.DATA_ID_ALL),a=g.ma(a,"MAIN_OPAQUE").o,d=0;d<b.length;d++){var e=
b[d],f=e.d;if("DYNAMIC"==f.type)for(var h=0;h<a.length;h++){var l=a[h];if(l.U&&l.fb==f){c.log(e.name,e);break}}}};a.object_info=function(a){for(var b=g.get_active(),d=g.Ea(b,"MESH",g.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if(f.name==a){c.log("Object",f);for(var h=g.Bl(b),l=0;l<h.length;l++){for(var k=h[l],n=k.o,p=[],r=0;r<n.length;r++)n[r].fb==f.d&&p.push(n[r]);c.log("Subscene "+k.type,p)}}}};a.objects_stat=function(){var a=g.get_active();console.log("Armatures: "+g.Ea(a,"ARMATURE",g.DATA_ID_ALL).length);
console.log("Cameras: "+g.Ea(a,"CAMERA",g.DATA_ID_ALL).length);console.log("Curves: "+g.Ea(a,"CURVE",g.DATA_ID_ALL).length);console.log("Empties: "+g.Ea(a,"EMPTY",g.DATA_ID_ALL).length);console.log("Lamps: "+g.Ea(a,"LAMP",g.DATA_ID_ALL).length);console.log("Meshes: "+g.Ea(a,"MESH",g.DATA_ID_ALL).length);console.log("Speakers: "+g.Ea(a,"SPEAKER",g.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=g.get_active(),b=[g.ma(b,"MAIN_OPAQUE"),g.ma(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];
if(d)for(var d=d.o,e=0;e<d.length;e++){var f=d[e].n;f&&(a+=f.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=g.get_active(),b=[g.ma(b,"MAIN_OPAQUE"),g.ma(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.o,e=0;e<d.length;e++){var f=d[e].n;f&&(a+=f.num_triangles)}}return a};a.num_draw_calls=function(){var a=g.get_active(),a=[g.ma(a,"MAIN_OPAQUE"),g.ma(a,"MAIN_BLEND")];return a[0].o.length+a[1].o.length};a.geometry_stats=function(){for(var a=g.get_active(),b=g.Bl(a),
a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.o,f=0;f<e.length;f++){var h=e[f].n,k=e[f].fb;h&&("COLOR_PICKING"!=d.type&&"GLOW_MASK"!=d.type||k.Tj)&&(a[h.id]=h)}}var e=d=c=b=0,l;for(l in a)h=a[l],h=h.mb,h.jj&&(d++,e+=h.jj/1048576),b++,c+=h.Po/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=g.get_active(),c=[g.ma(c,"MAIN_OPAQUE"),g.ma(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=
e.o,f=0;f<e.length;f++){var h=e[f].n;if(h)for(var h=h.N,k=0;k<h.length;k++){var l=h[k];if("IMAGE"===l.source||"ENVIRONMENT_MAP"===l.source){var n=l.La;-1===a.indexOf(n)&&(a.push(n),l=l.width*l.height*4/1048576/l.al,l*=1.3333,b+=l)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=g.get_active(),c=g.Bl(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var f=e.j,h=[f.vb,f.pc];h.push.apply(h,e.$c);for(e=0;e<h.length;e++){var k=h[e];r.Xh(k)&&-1==a.indexOf(k)&&
(a.push(k),b+=f.width*f.height*r.Mw(k))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=g.get_active();(a=g.ma(a,"MAIN_OPAQUE"))&&g.hq(a.j,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=g.get_active(),b=g.ma(a,"MAIN_OPAQUE"),a=g.tz(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}g.hq(d.j,b,e)}};a.scenegraph_to_dot=function(){for(var a=
g.Ph(),b=0;b<a.length;b++)c.log(l.mv(g.El(a[b])))};a.scenes_to_dot=function(){};a.controls_info=b.debug;a.object_distance=function(a,b){return n.dist(a.d.g,b.d.g)};a.msg=e.msg;a.fbmsg=e.fbmsg;a.print_telemetry=e.print_telemetry;a.plot_telemetry=e.plot_telemetry;a.fbres=function(a,b){function c(){e.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,
0,1]),f=new Float32Array([-1,0,0]),g=new Float32Array([0,-1,0]),k=new Float32Array([0,0,-1]);if(!h.ce(a,h.qt))throw"Wrong VEC3_IDENT";if(!h.ce(b,h.lt))throw"Wrong QUAT4_IDENT";if(!h.ce(c,h.AXIS_X))throw"Wrong AXIS_X";if(!h.ce(d,h.AXIS_Y))throw"Wrong AXIS_Y";if(!h.ce(e,h.AXIS_Z))throw"Wrong AXIS_Z";if(!h.ce(f,h.AXIS_MX))throw"Wrong AXIS_MX";if(!h.ce(g,h.AXIS_MY))throw"Wrong AXIS_MY";if(!h.ce(k,h.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=f.get_speaker_objects(),b=0;b<a.length;b++){var c=
a[b];"BACKGROUND_MUSIC"==f.Hl(c)&&f.mute(c,!0)}};a.check_finite=function(a){e.check_finite(a)};a.set_debug_params=function(a){var b=g.get_active();if(b=g.ma(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&g.Ry(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&g.Qy(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return c.Bw()};a.get_warning_quantity=function(){return c.Pw()};a.clear_errors_warnings=function(){return c.clear_errors_warnings()}};b4w.module.geometry=function(a,p){function c(a){return a&&a.d&&a.d.yd?!0:!1}var b=p("__batch"),e=p("__geometry"),d=p("__print"),l=p("__renderer");a.extract_vertex_array=function(a,f,l){if(!c(a))return d.error("Wrong object:",a.name),null;if(a=b.X(a,f,"MAIN")||b.X(a,f,"NODES")){if((f=a.mb)&&f.Sb&&f.Sb[l])return e.Iv(f,l);d.error("Attribute not found:"+l);return null}d.error("Wrong material:",f);return null};a.extract_index_array=function(a,e){if(!c(a))return d.error("Wrong object:",a.name),null;var l=
b.X(a,e,"MAIN")||b.X(a,e,"NODES");if(l){if((l=l.mb)&&l.Sb)return l.le;d.error("Buffer data not found");return null}d.error("Wrong material:",e);return null};a.update_vertex_array=function(a,f,l,h){var n=["MAIN","NODES","DEPTH","COLOR_ID"];if(c(a))for(var m=0;m<n.length;m++){var s=b.X(a,f,n[m]);s&&(s=s.mb)&&s.Sb&&s.Sb[l]&&e.rk(s,l,0,h)}else d.error("Wrong object:",a.name)};a.override_geometry=function(a,f,p,h,n){var m=["MAIN","NODES","DEPTH","COLOR_ID"];if(c(a))if(p instanceof Uint16Array||p instanceof
Uint32Array)if(h instanceof Float32Array)for(var s=0;s<m.length;s++){var B=b.X(a,f,m[s]);if(B){var z=B.mb;if(z){e.Jz(z,B.xd,p);var u=0,q;for(q in z.Sb)var F=z.Sb[q],u=u+h.length/3*F.Pc;z.bd=new Float32Array(u);var u=z.bd,k=0;for(q in z.Sb)switch(F=z.Sb[q],q){case "a_position":u.set(h,k);F.offset=k;F.length=h.length;k+=F.length;break;case "a_normal":var x;n&&(x=e.io(p,h,h));var v=e.fo(p,h,x);u.set(v,k);F.offset=k;F.length=h.length;k+=F.length;break;case "a_tangent":F.offset=k;F.length=h.length/3*F.Pc;
for(var G=new Float32Array(F.length),v=0;v<G.length;v+=4)G[v]=1,G[v+3]=1;u.set(G,k);k+=F.length;break;default:F.offset=k,F.length=h.length/3*F.Pc,v=new Float32Array(F.length),u.set(v,k),k+=F.length}e.Oz(z);l.Pn(B);if(B.Fb)for(v=0;v<B.Fb.length;v++)(F=B.Fb[v])&&F.mb&&(F.mb=z)}}}else d.error("Wrong positions_array type");else d.error("Wrong ibo_array type");else d.error("Wrong object:",a.name)}};b4w.module.hud=function(a,p){var c=p("__hud");p("__print");a.draw_mixer_strip=c.draw_mixer_strip;a.plot_array=c.plot_array};b4w.module.lights=function(a,p){function c(a){for(var b=l.get_active(),c=l.Ea(b,"LAMP",l.DATA_ID_ALL),m=0;m<c.length;m++){var n=c[m];if("SUN"==n.la.type){var p=n;break}}if(!p)return e.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(c=(90-a.vert_position)/180*Math.PI,m=p.d,g.set_rotation_euler(p,[c,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),f.quat_to_dir(m.quat,f.AXIS_Y,a),m=r.length(m.g),r.copy(a,h),r.scale(h,m,h),g.set_translation(p,
h),g.v(p),a=p.la,a.Vo&&(n=p.data.energy,m=b.world.light_settings.environment_energy,c=Math.cos(Math.abs(c)),n*=Math.max(Math.min(3*c,1),0),c=Math.max(c,.1)*m,d.er(a,n),l.set_environment_colors(b,c,null,null)),l.Vf(p,b))}function b(a){if(d.Sl(a))return a.la.type;e.error("get_light_type(): Wrong object");return!1}var e=p("__print"),d=p("__lights"),l=p("__scenes"),g=p("__transform"),f=p("__util"),r=p("vec3"),h=new Float32Array(3),n,m=60;a.get_lamps=function(a){var b=l.get_active(),b=l.Ea(b,"LAMP",l.DATA_ID_ALL);
if(!a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.la.type===a&&c.push(e)}return c};a.get_sun_params=function(){for(var a=l.get_active(),a=l.Ea(a,"LAMP",l.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.la.type){b=d;break}}return b?(b=b.la.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=c;a.set_day_time=function(a){for(var b=l.get_active(),
b=l.Ea(b,"LAMP",l.DATA_ID_ALL),d=0;d<b.length;d++){var f=b[d];if("SUN"==f.la.type){var g=f;break}}if(!g)return e.error("There is no sun on the scene"),null;g=-Math.cos(a/12*Math.PI)*m;b={};b.hor_position=12>a?15*a:15*(a-24);b.vert_position=g;c(b)};a.set_date=function(a){(n=a.getDate())?1582==n&&10==a.uC&&4<a.lv&&15>a.lv&&e.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):e.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){m=Math.min(Math.max(a,
0),90)};a.get_light_params=function(a){if(d.Sl(a))var c=a.la;else return e.error("get_light_params(): Wrong object"),!1;if(a=b(a))switch(a){case "SPOT":var f={light_type:a,light_color:c.color,light_energy:c.he,light_spot_blend:c.ik,light_spot_size:c.Uf,light_distance:c.distance};break;case "POINT":f={light_type:a,light_color:c.color,light_energy:c.he,light_distance:c.distance};break;default:f={light_type:a,light_color:c.color,light_energy:c.he}}return f?f:!1};a.get_light_type=b;a.set_light_params=
function(a,b){if(d.Sl(a))var c=a.la;else return e.error("set_light_params(): Wrong object"),!1;var f=l.get_active();"number"==typeof b.light_energy&&(d.er(c,b.light_energy),l.Vf(a,f));"object"==typeof b.light_color&&(d.Fy(c,b.light_color),l.Vf(a,f));"number"==typeof b.light_spot_blend&&(d.Hy(c,b.light_spot_blend),l.Vf(a,f));"number"==typeof b.light_spot_size&&(d.Iy(c,b.light_spot_size),l.Vf(a,f));"number"==typeof b.light_distance&&(d.Gy(c,b.light_distance),l.Vf(a,f))}};b4w.module.material=function(a,p){function c(a,b){for(var c=a.W,d=0;d<c.length;d++){var e=c[d];if(-1<e.Ac.indexOf(b))return"MAIN"==e.type}return!1}function b(a,b){var c=d.X(a,b,"MAIN");return Boolean(c&&c.vc[0])}function e(a,b){var c=d.X(a,b,"MAIN");return Boolean(c&&c.vc[1])}var d=p("__batch"),l=p("__config"),g=p("__print"),f=p("__objects"),r=p("__shaders");p("__util");p("vec4");var h=l.p,n="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.max_bones=function(){g.error("max_bones() deprecated, return default value");
return h.max_bones};a.set_max_bones=function(){g.error("set_max_bones() deprecated")};a.set_batch_param=function(){g.error("set_batch_param() deprecated")};a.inherit_material=function(a,b,c,e){if(f.Dj(c)&&f.Dj(a)){for(var h=["MAIN","DEPTH","COLOR_ID"],l=!1,p=0;p<h.length;p++){var k=h[p],r=d.X(a,b,k),v=d.X(c,e,k);if(r&&v)for(l=!0,"MAIN"==k&&(v.zb.set(r.zb),v.ff=r.ff,v.Pd.set(r.Pd),v.vc.set(r.vc),v.ge=r.ge,v.Jc=r.Jc,v.Jc=r.Jc,v.ef=r.ef,v.Ue=r.Ue),k=0;k<v.ic.length;k++){var G=v.ic[k];if(-1!==n.indexOf(G)){var A=
r.ic.indexOf(G);if(-1!==A&&(v.N[k]=r.N[A],v.Fb))for(k=0;k<v.Fb.length;k++){var C=v.Fb[k],M=C.ic.indexOf(G);-1!==M&&(C.N[M]=r.N[A])}}}}l||g.error("Wrong objects for inheriting material!")}else g.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++)b.push(a[c].name);return b};a.set_diffuse_color=function(a,b,c){(a=d.X(a,b,"MAIN"))?a.zb.set(c):g.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=
d.X(a,b,"MAIN");if(c){var e=Array(4);e[0]=c.zb[0];e[1]=c.zb[1];e[2]=c.zb[2];e[3]=c.zb[3];return e}g.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,c){(a=d.X(a,b,"MAIN"))?a.ff=c:g.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=d.X(a,b,"MAIN");if(c)return c.ff;g.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){(a=d.X(a,b,"MAIN"))?a.Pd.set(c):g.error('Couldn\'t set property "specular_color"!')};
a.get_specular_color=function(a,b){var c=d.X(a,b,"MAIN");if(c){var e=Array(3);e[0]=c.Pd[0];e[1]=c.Pd[1];e[2]=c.Pd[2];return e}g.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,c,e){b(a,c)||g.error('Property "specular_intensity" is missing!');d.X(a,c,"MAIN").vc[0]=e};a.get_specular_intensity=function(a,c){b(a,c)||g.error('Property "specular_intensity" is missing!');return d.X(a,c,"MAIN").vc[0]};a.check_specular_intensity=b;a.set_specular_hardness=function(a,b,
c){e(a,b)||g.error('Property "specular_hardness" is missing!');d.X(a,b,"MAIN").vc[1]=c};a.get_specular_hardness=function(a,b){e(a,b)||g.error('Property "specular_hardness" is missing!');return d.X(a,b,"MAIN").vc[1]};a.check_specular_hardness=e;a.set_emit_factor=function(a,b,c){(a=d.X(a,b,"MAIN"))?a.ge=c:g.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=d.X(a,b,"MAIN");if(c)return c.ge;g.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,
b,c){(a=d.X(a,b,"MAIN"))?a.Jc=c:g.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=d.X(a,b,"MAIN");if(c)return c.Jc;g.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){(a=d.X(a,b,"MAIN"))?a.ef=c:g.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=d.X(a,b,"MAIN");if(c)return c.ef;g.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,
b){var c=d.X(a,b,"MAIN");c?c.Ue=alpha_factor:g.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=d.X(a,b,"MAIN");if(c)return c.Ue;g.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return g.error("B4W Error: missing arguments in get_material_params"),null;if(!c(a,b))return null;var e=d.X(a,b,"MAIN");if(!e)return null;var f={};"MAIN"==e.type&&(f.mi=e.mi,f.DB=e.Bd[2],f.EB=5*(1-e.Bd[3]),f.fi=e.fi,f.CC=d.pb(e,
"PARALLAX_STEPS")[1]);return f};a.get_water_material_params=function(a,b){if(!a||!b)return g.error("B4W Error: missing arguments in get_water_material_params"),null;if(!c(a,b))return null;var e=d.X(a,b,"MAIN");if(!e||!e.Me)return null;if(!e)return g.warn("B4W Warning: material not found"),null;var f={};if("MAIN"==e.type){if(h.Pg){var l=f.shallow_water_col=Array(3);l[0]=e.shallow_water_col[0];l[1]=e.shallow_water_col[1];l[2]=e.shallow_water_col[2];l=f.shore_water_col=Array(3);l[0]=e.shore_water_col[0];
l[1]=e.shore_water_col[1];l[2]=e.shore_water_col[2];f.shallow_water_col_fac=e.shallow_water_col_fac;f.shore_water_col_fac=e.shore_water_col_fac}f.foam_factor=e.foam_factor;f.norm_uv_velocity=e.xk;f.absorb_factor=d.pb(e,"ABSORB")[1];f.sss_strength=d.pb(e,"SSS_STRENGTH")[1];f.sss_width=d.pb(e,"SSS_WIDTH")[1];f.dst_noise_scale0=d.pb(e,"DST_NOISE_SCALE_0")[1];f.dst_noise_scale1=d.pb(e,"DST_NOISE_SCALE_1")[1];f.dst_noise_freq0=d.pb(e,"DST_NOISE_FREQ_0")[1];f.dst_noise_freq1=d.pb(e,"DST_NOISE_FREQ_1")[1];
f.dir_min_shore_fac=d.pb(e,"DIR_MIN_SHR_FAC")[1];f.dir_freq=d.pb(e,"DIR_FREQ")[1];f.dir_noise_scale=d.pb(e,"DIR_NOISE_SCALE")[1];f.dir_noise_freq=d.pb(e,"DIR_NOISE_FREQ")[1];f.dir_min_noise_fac=d.pb(e,"DIR_MIN_NOISE_FAC")[1];f.dst_min_fac=d.pb(e,"DST_MIN_FAC")[1];f.waves_hor_fac=d.pb(e,"WAVES_HOR_FAC")[1]}return f};a.set_material_extended_params=function(a,b,e){if(a&&b&&e){if(!c(a,b))return g.warn("B4W Warning: setting material params is not possible"),null;a=d.X(a,b,"MAIN");a?"MAIN"==a.type&&("number"==
typeof e.material_reflectivity&&(a.mi=e.material_reflectivity),"number"==typeof e.material_fresnel&&(a.Bd[2]=e.material_fresnel),"number"==typeof e.material_fresnel_factor&&(a.Bd[3]=1-e.material_fresnel_factor/5),"number"==typeof e.material_parallax_scale&&(a.fi=e.material_parallax_scale),"number"==typeof e.material_parallax_steps&&(e=r.s(parseFloat(e.material_parallax_steps)),d.aa(a,"PARALLAX_STEPS",e),d.Db(a,!0))):g.warn("B4W Warning: material not found")}else g.error("B4W Error: missing arguments in set_material_params")};
a.set_water_material_params=function(a,b,e){if(!a||!b||!e)return g.error("B4W Error: missing arguments in set_water_material_params"),null;if(!c(a,b))return g.warn("B4W Warning: setting water material params is not possible"),null;a=d.X(a,b,"MAIN");if(!a)return g.warn("B4W Warning: material not found"),null;"MAIN"==a.type&&(h.Pg&&("object"==typeof e.shallow_water_col&&a.shallow_water_col.set(e.shallow_water_col),"number"==typeof e.shallow_water_col_fac&&(a.shallow_water_col_fac=e.shallow_water_col_fac),
"object"==typeof e.shore_water_col&&a.shore_water_col.set(e.shore_water_col),"number"==typeof e.shore_water_col_fac&&(a.shore_water_col_fac=e.shore_water_col_fac)),h.shore_smoothing&&a.nn&&("boolean"==typeof e.shore_smoothing&&(e.shore_smoothing?d.aa(a,"SHORE_SMOOTHING",1):d.aa(a,"SHORE_SMOOTHING",0)),"number"==typeof e.absorb_factor&&(b=r.s(parseFloat(e.absorb_factor)),d.aa(a,"ABSORB",b))),"number"==typeof e.foam_factor&&h.rg&&(a.foam_factor=e.foam_factor),"number"==typeof e.norm_uv_velocity&&(a.xk=
e.norm_uv_velocity),h.water_dynamic&&a.water_dynamic&&("boolean"==typeof e.water_dynamic&&(e.water_dynamic?d.aa(a,"DYNAMIC",1):d.aa(a,"DYNAMIC",0)),"number"==typeof e.waves_height&&(b=r.s(parseFloat(e.waves_height)),d.aa(a,"WAVES_HEIGHT",b)),"number"==typeof e.waves_length&&(b=r.s(parseFloat(e.waves_length)),d.aa(a,"WAVES_LENGTH",b)),"number"==typeof e.sss_strength&&(b=r.s(parseFloat(e.sss_strength)),d.aa(a,"SSS_STRENGTH",b)),"number"==typeof e.sss_width&&(b=r.s(parseFloat(e.sss_width)),d.aa(a,"SSS_WIDTH",
b)),"number"==typeof e.dst_noise_scale0&&(b=r.s(parseFloat(e.dst_noise_scale0)),d.aa(a,"DST_NOISE_SCALE_0",b)),"number"==typeof e.dst_noise_scale1&&(b=r.s(parseFloat(e.dst_noise_scale1)),d.aa(a,"DST_NOISE_SCALE_1",b)),"number"==typeof e.dst_noise_freq0&&(b=r.s(parseFloat(e.dst_noise_freq0)),d.aa(a,"DST_NOISE_FREQ_0",b)),"number"==typeof e.dst_noise_freq1&&(b=r.s(parseFloat(e.dst_noise_freq1)),d.aa(a,"DST_NOISE_FREQ_1",b)),"number"==typeof e.dir_min_shore_fac&&(b=r.s(parseFloat(e.dir_min_shore_fac)),
d.aa(a,"DIR_MIN_SHR_FAC",b)),"number"==typeof e.dir_freq&&(b=r.s(parseFloat(e.dir_freq)),d.aa(a,"DIR_FREQ",b)),"number"==typeof e.dir_noise_scale&&(b=r.s(parseFloat(e.dir_noise_scale)),d.aa(a,"DIR_NOISE_SCALE",b)),"number"==typeof e.dir_noise_freq&&(b=r.s(parseFloat(e.dir_noise_freq)),d.aa(a,"DIR_NOISE_FREQ",b)),"number"==typeof e.dir_min_noise_fac&&(b=r.s(parseFloat(e.dir_min_noise_fac)),d.aa(a,"DIR_MIN_NOISE_FAC",b)),"number"==typeof e.dst_min_fac&&(b=r.s(parseFloat(e.dst_min_fac)),d.aa(a,"DST_MIN_FAC",
b)),"number"==typeof e.waves_hor_fac&&(e=r.s(parseFloat(e.waves_hor_fac)),d.aa(a,"WAVES_HOR_FAC",e))),d.Db(a,!0));return!0}};b4w.module.particles=function(a,p){var c=p("__particles"),b=p("__print");a.set_size=function(a,d,l){c.zg(a)?c.set_size(a,d,l):b.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,d,l){c.zg(a)?c.set_normal_factor(a,d,l):b.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,d,l){c.zg(a)?(l=Math.min(l,1),l=Math.max(l,0),c.set_factor(a,d,l)):b.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,p){var c=p("__print"),b=p("__physics"),e=p("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){b.has_physics(a)?b.enable_simulation(a):c.error("No physics for object "+a.name)};a.disable_simulation=function(a){b.has_physics(a)?b.disable_simulation(a):c.error("No physics for object "+a.name)};a.has_physics=function(a){return b.has_physics(a)};a.has_simulated_physics=function(a){return b.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return b.has_dynamic_physics(a)};a.set_gravity=function(a,e){b.has_physics(a)?b.set_gravity(a,e):c.error("No physics for object "+a.name)};a.set_damping=function(a,e,g){b.has_physics(a)?b.q("set_damping",a.l.J,e,g):c.error("No physics for object "+a.name)};a.reset_damping=function(a){if(b.has_physics(a)){var e=a.game;b.q("set_damping",a.l.J,e.damping,e.rotation_damping)}else c.error("No physics for object "+a.name)};a.set_transform=function(a,e,g){b.has_physics(a)?b.set_transform.apply(this,
arguments):c.error("No physics for object "+a.name)};a.sync_transform=function(a){b.has_physics(a)?b.sync_transform(a):c.error("No physics for object "+a.name)};a.apply_velocity=function(a){b.has_physics(a)?b.apply_velocity.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){b.has_physics(a)?b.apply_velocity_world.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_force=function(a,e,g,f){b.has_physics(a)?b.apply_force.apply(this,
arguments):c.error("No physics for object "+a.name)};a.apply_torque=function(a,e,g,f){b.has_physics(a)?b.apply_torque.apply(this,arguments):c.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,l){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_throttle(a,e.clamp(l,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,l,g){if(b.has_physics(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");
l=e.clamp(l,0,1);var f=a.i.qg;-1==g||1==g?f=Math.max(-1,Math.min(f+g*l,1)):0==g&&0<=f?(f-=l,f=Math.max(0,f)):0==g&&0>f?(f+=l,f=Math.min(0,f)):c.error("Wrong steering direction");b.vehicle_throttle(a,e.clamp(f,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_steer=function(a,l){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_steer(a,e.clamp(l,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,l,g){if(b.has_physics(a)){b.is_vehicle_chassis(a)||
b.is_vehicle_hull(a)||c.error("Wrong object");l=e.clamp(l,0,1);var f=a.i.Xg;-1==g||1==g?f=Math.max(-1,Math.min(f+g*l,1)):0==g&&0<=f?(f-=l,f=Math.max(0,f)):0==g&&0>f?(f+=l,f=Math.min(0,f)):c.error("Wrong steering direction");b.vehicle_steer(a,e.clamp(f,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_brake=function(a,l){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_brake(a,e.clamp(l,0,1))):c.error("No physics for object "+a.name)};
a.vehicle_brake_inc=function(a,l){if(b.has_physics(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");l=e.clamp(l,-1,1);var g=a.i.xh;b.vehicle_brake(a,e.clamp(g+g*l,0,1))}else c.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return b.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return b.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.b4w_vehicle_settings.name;
c.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.i.qg;c.error("Wrong object")};a.get_vehicle_steering=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.i.Xg;c.error("Wrong object")};a.get_vehicle_brake=function(a){if(!b.has_physics(a))return c.error("No physics for object "+
a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.i.xh;c.error("Wrong object")};a.get_vehicle_speed=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return b.get_vehicle_speed(a);c.error("Wrong object")};a.is_character=function(a){return b.is_character(a)};a.set_character_move_dir=function(a,e,g){b.has_physics(a)?b.set_character_move_dir(a,e,g):c.error("No physics for object "+a.name)};a.set_character_move_type=
function(a,e){b.has_physics(a)?b.set_character_move_type(a,e):c.error("No physics for object "+a.name)};a.set_character_dist_to_water=function(){c.warn("Function set_character_dist_to_water() is deprecated")};a.set_character_walk_velocity=function(a,e){b.has_physics(a)?b.set_character_walk_velocity(a,e):c.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,e){b.has_physics(a)?b.set_character_run_velocity(a,e):c.error("No physics for object "+a.name)};a.set_character_fly_velocity=
function(a,e){b.has_physics(a)?b.set_character_fly_velocity(a,e):c.error("No physics for object "+a.name)};a.character_jump=function(a){b.has_physics(a)?b.character_jump(a):c.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,e,g){b.has_physics(a)?b.character_rotation_inc(a,e,g):c.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,e){b.has_physics(a)?b.set_character_rotation_quat(a,e):c.error("No physics for object "+a.name)};a.set_character_rotation=
function(a,e,g){b.has_physics(a)?b.set_character_rotation(a,e,g):c.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,e){b.has_physics(a)?b.set_character_rotation_v(a,e):c.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,e){b.has_physics(a)?b.set_character_rotation_h(a,e):c.error("No physics for object "+a.name)};a.append_collision_test=function(a,e,g,f){b.has_physics(a)?b.append_collision_test(a,e,g,f):c.error("No physics for object "+a.name)};
a.remove_collision_test=function(a,e){b.has_physics(a)?b.remove_collision_test(a,e):c.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,e){b.has_physics(a)?b.apply_collision_impulse_test(a,e):c.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){b.has_physics(a)?b.clear_collision_impulse_test(a):c.error("No physics for object "+a.name)};a.append_ray_test=function(a,e,g,f,p,h){b.has_physics(a)?b.append_ray_test(a,e,g,f,p,h):c.error("No physics for object "+
a.name)};a.remove_ray_test=function(a,e,g,f,p){b.has_physics(a)?b.remove_ray_test(a,e,g,f,p):c.error("No physics for object "+a.name)};a.apply_constraint=function(a,e,g,f,p,h,n,m,s,B){b.has_physics(e)&&b.has_physics(p)?b.apply_constraint(a,e,g,f,p,h,n,m,s,B):c.error("Wrong objects")};a.clear_constraint=function(a){b.has_physics(a)&&b.Yw(a)?b.clear_constraint(a):c.error("Wrong object")};a.pull_to_constraint_pivot=function(a,e,g,f,p,h){b.has_physics(a)&&b.has_physics(f)?b.pull_to_constraint_pivot(a,
e,g,f,p,h):c.error("Wrong objects")}};b4w.module.scenes=function(a,p){var c=p("__batch"),b=p("__camera"),e=p("__graph"),d=p("__objects"),l=p("__print"),g=p("__physics"),f=p("__scenes"),r=p("__util");a.DATA_ID_ALL=f.DATA_ID_ALL;a.set_active=function(a){var b=f.Ph();f.set_active(r.keysearch("name",a,b))};a.get_active=function(){return f.Z()?f.get_active().name:""};a.get_scenes=function(){for(var a=f.Ph(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(f.Z())return f.Cl(f.get_active());l.error("No active scene");
return!1};a.get_object_by_name=function(a,b){return f.Qh(f.Ki,a,b|0)};a.get_object_by_dupli_name=function(a,b,c){return f.Qh(f.un,a,b,c|0)};a.get_object_by_dupli_name_list=function(a,b){return f.Qh(f.vn,a,b|0)};a.get_object_by_empty_name=function(b,c,d){l.warn("get_object_by_empty_name() deprecated, use get_object_by_dupli_name() instead");return a.get_object_by_dupli_name(b,c,d)};a.get_object_data_id=function(a){return f.get_object_data_id(a)};a.pick_object=f.pick_object;a.set_glow_intensity=function(a,
b){for(var c=0;c<a.W.length;c++){var d=a.W[c];"COLOR_ID"==d.type&&(d.xg=b)}};a.apply_glow_anim=function(a,b,c,d){a.d&&a.d.Sc&&f.apply_glow_anim(a,b,c,d)};a.apply_glow_anim_def=function(a){if(a.d&&a.d.Sc){var b=a.d.rj;f.apply_glow_anim(a,b.Rw,b.Tw,b.Uw)}};a.clear_glow_anim=function(a){a.d&&a.d.Sc&&f.clear_glow_anim(a)};a.set_glow_color=function(a){var b=f.get_active();if(b=f.ma(b,"GLOW"))b.Rh.set(a),b.Aa=!0};a.get_shadow_params=function(){if(!f.Z())return l.error("No active scene"),!1;var a=f.get_active(),
b=f.ma(a,"SHADOW_CAST");if(!b)return null;var c=a.d.Uc,d=f.ma(a,"MAIN_OPAQUE"),e=f.ma(a,"DEPTH"),g={};g.csm_resolution=c.csm_resolution;g.self_shadow_polygon_offset=b.self_shadow_polygon_offset;e&&(g.self_shadow_normal_offset=e.self_shadow_normal_offset);g.enable_csm=c.enable_csm;g.csm_num=c.csm_num;g.csm_first_cascade_border=c.csm_first_cascade_border;g.first_cascade_blur_radius=c.first_cascade_blur_radius;g.csm_last_cascade_border=c.csm_last_cascade_border;g.last_cascade_blur_radius=c.last_cascade_blur_radius;
g.fade_last_cascade=c.fade_last_cascade;g.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(g.csm_borders=f.xw(a,d.j),g.blur_radii=new Float32Array(c.csm_num),g.blur_radii.set(d.j.Zj.subarray(0,c.csm_num))):(g.csm_borders=null,g.blur_radii=null);return g};a.set_shadow_params=function(a){if(!f.Z())return l.error("No active scene"),!1;var d=f.get_active();"number"==typeof a.self_shadow_polygon_offset&&e.R(d.d.qb,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});
var g=f.ma(d,"DEPTH");g&&("number"==typeof a.self_shadow_normal_offset&&(g.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(g.pcf_blur_radius=a.pcf_blur_radius));var p=f.ma(d,"MAIN_BLEND");p&&("number"==typeof a.self_shadow_normal_offset&&(p.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(p.pcf_blur_radius=a.pcf_blur_radius),p.Aa=!0);p=d.d.Uc;"number"==typeof a.csm_first_cascade_border&&(p.csm_first_cascade_border=
a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(p.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(p.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(p.last_cascade_blur_radius=a.last_cascade_blur_radius);if(g){for(var r=g.o,z=0;z<r.length;z++){var u=r[z];u.fb.Cb&&(u=u.n,c.Hk(u,p),c.Db(u))}g.Aa=!0}g=d.camera.d.K;for(z=0;z<g.length;z++)b.bn(g[z],p);f.Cm(d)};a.get_environment_colors=
function(){if(!f.Z())return l.error("No active scene"),!1;var a=f.get_active();return f.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(!f.Z())return l.error("No active scene"),!1;var d=f.get_active();f.set_environment_colors(d,parseFloat(a),b,c)};a.get_fog_color_density=function(a){if(!f.Z())return l.error("No active scene"),!1;var b=f.get_active();return f.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(!f.Z())return l.error("No active scene"),!1;var b=
f.get_active();f.set_fog_color_density(b,a)};a.get_ssao_params=function(){if(!f.Z())return l.error("No active scene"),!1;var a=f.get_active();return f.get_ssao_params(a)};a.set_ssao_params=function(a){if(!f.Z())return l.error("No active scene"),!1;var b=f.get_active();f.set_ssao_params(b,a)};a.get_color_correction_params=function(){if(!f.Z())return l.error("No active scene"),null;var a=f.get_active(),a=f.ma(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;
b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(!f.Z())return l.error("No active scene"),null;var b=f.get_active(),b=f.ma(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.Aa=!0};a.get_sky_params=function(){if(!f.Z())return l.error("No active scene"),
!1;var a=f.get_active();return f.get_sky_params(a)};a.set_sky_params=function(a){if(!f.Z())return l.error("No active scene"),!1;var b=f.get_active();f.set_sky_params(b,a)};a.get_dof_params=function(){if(!f.Z())return l.error("No active scene"),!1;var a=f.get_active();return f.ma(a,"DOF")?f.get_dof_params(a):null};a.set_dof_params=function(a){if(!f.Z())return l.error("No active scene"),!1;var b=f.get_active();f.set_dof_params(b,a)};a.get_god_rays_params=function(){if(!f.Z())return l.error("No active scene"),
!1;var a=f.get_active();return f.ma(a,"GOD_RAYS")?f.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!f.Z())return l.error("No active scene"),!1;var b=f.get_active();f.set_god_rays_params(b,a)};a.get_bloom_params=function(){if(!f.Z())return l.error("No active scene"),!1;var a=f.get_active();return f.ma(a,"BLOOM")?f.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!f.Z())return l.error("No active scene"),!1;var b=f.get_active();f.set_bloom_params(b,a)};a.get_wind_params=
function(){return f.get_wind_params()};a.set_wind_params=function(a){if(!f.Z())return l.error("No active scene"),!1;var b=f.get_active();f.set_wind_params(b,a)};a.get_water_surface_level=f.get_water_surface_level;a.set_water_params=function(a){if(!f.Z())return l.error("No active scene"),!1;var b=f.get_active();f.set_water_params(b,a)};a.get_water_mat_params=function(a){if(!f.Z())return l.error("No active scene"),!1;var b=f.get_active();f.get_water_mat_params(b,a)};a.update_scene_materials_params=
function(){if(!f.Z())return l.error("No active scene"),!1;var a=f.get_active();f.Sr(a)};a.hide_object=function(a){d.Dj(a)?f.hide_object(a):l.error("B4W Error: show/hide is only supported for dynamic meshes")};a.show_object=function(a){d.Dj(a)?f.show_object(a):l.error("B4W Error: show/hide is only supported for dynamic meshes")};a.is_visible=function(a){return a.d.is_visible};a.check_object=function(a){return f.Z()?f.check_object(a,f.get_active()):(l.error("No active scene"),!1)};a.get_all_objects=
function(a,b){var c=f.get_active();a||(a="ALL");b||0===b||(b=f.DATA_ID_ALL);return f.Ea(c,a,b)};a.get_appended_objs=function(b,c){l.warn("get_appended_objs() deprecated, use get_all_objects() instead");return a.get_all_objects(b,c)};a.get_object_name=function(a){return a?a.name:(l.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(l.error("Wrong object ID"),"UNDEFINED")};a.get_object_dg_parent=function(a){return a.Kb};a.get_object_children=function(a){return a.Wd.slice(0)};
a.get_first_character=function(){for(var a=f.Ea(f.get_active(),"MESH",f.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(g.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return f.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return f.get_cam_water_depth()};a.get_type_mesh_object=function(a){return"MESH"==a.type?a.d.type:null};a.get_meta_tags=function(){if(!f.Z())return l.error("No active scene"),!1;var a=f.get_active();return f.get_meta_tags(a)};a.append_object=
function(){r.ga('Method "append_object" is deprecated')};a.add_object=function(){r.ga('Method "add_object" is deprecated')};a.remove_object=function(){r.ga('Method "remove_object" is deprecated')};a.get_screen_scenes=function(){r.ga("get_screen_scenes() deprecated")};a.set_light_pos=function(){r.ga("set_light_pos() deprecated, use lights module instead")};a.set_light_direction=function(){r.ga("set_light_direction() deprecated, use lights module instead")};a.set_dir_light_color=function(){r.ga("set_dir_light_color() deprecated, use lights module instead")};
a.get_lights_names=function(){r.ga("get_lights_names() deprecated, use lights module instead")};a.remove_all=function(){r.ga("remove_all() deprecated, use lights module instead")};a.check_collision=function(){r.ga("check_collision() deprecated, use lights module instead")};a.check_ray_hit=function(){r.ga("check_ray_hit() deprecated, use lights module instead")}};b4w.module.sfx=function(a,p){var c=p("__scenes"),b=p("__sfx"),e=p("__print");a.play=function(a,c,e){b.play(a,c,e)};a.play_def=function(a){b.play_def(a)};a.is_play=function(a){return b.is_play(a)};a.speaker_play=function(a,c,e,f){b.cyclic(a,c);f&&b.playrate(a,f);b.play(a,0,e)};a.speaker_stop=function(a){b.stop(a)};a.stop=function(a){b.stop(a)};a.pause=function(a){b.cz(a)};a.resume=function(a){b.ez(a)};a.speaker_playback_rate=function(a,c){b.playrate(a,c)};a.playrate=function(a,c){b.playrate(a,c)};
a.get_playrate=function(a){return b.get_playrate(a)};a.cyclic=function(a,c){b.cyclic(a,c)};a.is_cyclic=function(a){return b.is_cyclic(a)};a.listener_reset_speed=function(a,c){b.listener_reset_speed(a,c)};a.speaker_reset_speed=function(a,c,e){b.speaker_reset_speed(a,c,e)};a.get_volume=function(a){return a&&"object"===typeof a?b.get_volume(a):b.Ew()};a.set_volume=function(a,c){a&&"object"===typeof a?b.set_volume(a,c):b.Jy(c)};a.mute=function(a,c){a&&"object"===typeof a?b.mute(a,c):b.Gx(c)};a.is_muted=
function(a){return a&&"object"===typeof a?b.is_muted(a):b.nx()};a.get_speaker_objects=function(){return b.get_speaker_objects().slice(0)};a.get_speakers=function(){return a.get_speaker_objects()};a.check_active_speakers=b.check_active_speakers;a.set_compressor_params=function(a){b.set_compressor_params(c.get_active(),a)};a.get_compressor_params=function(){return b.get_compressor_params(c.get_active())};a.duck=function(a,c,e){a&&"object"===typeof a?b.duck(a,c,e):b.Av(c,e)};a.unduck=function(a){a&&
"object"===typeof a?b.unduck(a):b.Gz()};a.apply_playlist=b.apply_playlist;a.clear_playlist=b.clear_playlist;a.detect_audio_container=b.detect_audio_container;a.detect_video_container=b.detect_video_container;a.set_positional_params=b.set_positional_params;a.get_positional_params=b.get_positional_params;a.set_filter_params=b.set_filter_params;a.get_filter_params=b.get_filter_params;a.get_filter_freq_response=b.get_filter_freq_response;a.get_duration=function(a){if(a&&b.Hd(a))return b.get_duration(a);
e.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.shaders=function(a,p){function c(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function b(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);
c.send(b);if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function e(a){for(var b=f.Ph(),c=0;c<b.length;c++)for(var d=f.Ea(b[c],"MESH",f.DATA_ID_ALL),e=0;e<d.length;e++){var g=d[e];if(g.W)for(var l=0;l<g.W.length;l++){var p=g.W[l];if(p.Nb==a&&p.Ac.length)return p.Ac}}return null}function d(a){a.sort(function(a,b){return b.yl.ALU_OPS-a.yl.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.yl,f=c.kA,g=e(c.jv),g=g?"\t\t("+g.join(", ")+")":"\t\t(NA)";l.groupCollapsed("FRAG --\x3e",
"ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",f.ALU_OPS,"TEX",f.TEX_OPS,g);l.groupCollapsed("directives");for(var g=c.Va.fe,p=0;p<g.length;p++){var q=g[p];l.log(q[0],q[1])}l.groupEnd();l.groupCollapsed("vert src");l.log(c.jA);l.groupEnd();l.groupCollapsed("vert stats");for(var r in f)"ALU_OPS"!=r&&"TEX_OPS"!=r&&l.log(r,f[r]);l.groupEnd();l.groupCollapsed("frag src");l.log(c.Zv);l.groupEnd();l.groupCollapsed("frag stats");for(r in d)"ALU_OPS"!=r&&"TEX_OPS"!=r&&l.log(r,d[r]);l.groupEnd();
l.groupEnd()}}p("__config");var l=p("__print"),g=p("__extensions"),f=p("__scenes"),r=p("__shaders");p("__util");a.report_repeatful_compilation=function(){var a=r.nv(),b=0,c;for(c in a){var d=a[c],e=d.count;1<e&&l.log(e-1,d.LC,d.ZB);b+=e-1}l.log("TOTAL OVERHEAD:",b);return"OK"};a.analyze=function(a){var e=r.vw(),f=0,p;for(p in e)a&&-1===p.indexOf(a)||f++;var f="of "+f+" analyzing...",B={};for(p in e)if(!a||-1!==p.indexOf(a)){var z=e[p],u;var q=z.kn;u=z.mp;var F=g.qp();if(F){q=F.getTranslatedShaderSource(q);
u=F.getTranslatedShaderSource(u);var F=b("/nvidia_vert",q),k=c(F),x=b("/nvidia_frag",u),v=c(x);u={jA:q,YC:F,kA:k,Zv:u,CB:x,yl:v}}else l.error("B4W Error: WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),u=void 0;F=z.Va;q=F.Bi+" + "+F.Kh;u.jv=z;u.Va=F;z=B[q]=B[q]||[];z.push(u);l.log(f)}for(q in B)l.group("%c"+q,"color: #800"),z=B[q],d(z),l.groupEnd()}};b4w.module.textures=function(a,p){var c=p("__textures"),b=p("__print");a.get_canvas_texture_context=function(a){var d=c.tw(a);if(d)return d;b.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a){c.Lz(a)||b.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a){c.play_video(a)||b.error('Texture with name "'+a+'" not found!')};a.stop_video=function(c){b.warn("stop_video() deprecated, use pause_video() instead");return a.pause_video(c)};
a.pause_video=function(a){c.pause_video(a)||b.error('Texture with name "'+a+'" not found!')};a.reset_video=function(a){c.reset_video(a)||b.error('Texture with name "'+a+'" not found!')}};b4w.module.transform=function(a,p){var c=p("__print"),b=p("__physics"),e=p("__transform"),d=p("__util"),l=new Float32Array(3),g=new Float32Array(4);a.SPACE_LOCAL=e.SPACE_LOCAL;a.SPACE_WORLD=e.SPACE_WORLD;a.set_translation=function(a,c,d,g){l[0]=c;l[1]=d;l[2]=g;e.set_translation(a,l);e.v(a);b.sync_transform(a)};a.set_translation_v=function(a,c){e.set_translation(a,c);e.v(a);b.sync_transform(a)};a.set_translation_rel=function(a,c,g,n,m){l[0]=c;l[1]=g;l[2]=n;d.xi(l,1,m.d.quat,m.d.g,l);e.set_translation(a,
l);e.v(a);b.sync_transform(a)};a.get_translation=function(a,b){b||(b=new Float32Array(3));e.get_translation(a,b);return b};a.set_rotation=function(a,c,d,l,m){g[0]=c;g[1]=d;g[2]=l;g[3]=m;e.set_rotation(a,g);e.v(a);b.sync_transform(a)};a.set_rotation_quat=a.set_rotation;a.set_rotation_v=function(a,c){e.set_rotation(a,c);e.v(a);b.sync_transform(a)};a.set_rotation_quat_v=a.set_rotation_v;a.get_rotation=function(a,b){b||(b=new Float32Array(4));e.get_rotation(a,b);return b};a.get_rotation_quat=a.get_rotation;
a.set_rotation_euler=function(a,c,d,g){l[0]=c;l[1]=d;l[2]=g;e.set_rotation_euler(a,l);e.v(a);b.sync_transform(a)};a.set_rotation_euler_v=function(a,c){e.set_rotation_euler(a,c);e.v(a);b.sync_transform(a)};a.set_scale=function(a,b){e.set_scale(a,b);e.v(a)};a.get_scale=function(a){return e.get_scale(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return c.error("Wrong object: "+a.name),!1;e.set_translation(a,[0,0,0]);e.set_rotation(a,[0,0,0,1]);e.set_scale(a,1);e.v(a);b.sync_transform(a)};
a.get_object_size=function(a){return d.is_mesh(a)?e.get_object_size(a):(c.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,b,g){return d.is_mesh(a)?e.get_object_center(a,b,g):(c.error("Wrong object: "+a.name),null)};a.move_local=function(a,c,d,g){e.move_local(a,c,d,g);e.v(a);b.sync_transform(a)};a.get_object_bounding_box=function(a){return e.get_object_bounding_box(a)}};b4w.module.util=function(a,p){var c=p("__print"),b=p("__util"),e=p("vec3");p("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.keyfind=b.keyfind;a.keysearch=b.keysearch;a.matrix_to_quat=function(a){return b.matrix_to_quat(a)};a.euler_to_quat=function(a,c){c||(c=new Float32Array(4));return b.euler_to_quat(a,c)};a.quat_to_euler=
function(a,c){c||(c=new Float32Array(3));return b.quat_to_euler(a,c)};a.sign=b.sign;a.clamp=b.clamp;a.quat_to_dir=b.quat_to_dir;a.ground_project_quat=function(a,c){return b.quat_project(a,b.AXIS_MY,b.AXIS_Y,b.AXIS_MZ,c)};a.cam_quat_to_mesh_quat=function(a,c){return b.cam_quat_to_mesh_quat(a,c)};a.quat_project=function(a,l,g,f,p){return 0!=e.dot(g,f)?(c.error("Wrong in-plane direction"),null):b.quat_project(a,l,g,f,p)};a.hash_code=b.hash_code;a.smooth=b.smooth;a.smooth_v=b.smooth_v;a.is_vector=b.is_vector;
a.correct_cam_quat_up=b.correct_cam_quat_up;a.quat_to_angle_axis=b.quat_to_angle_axis;a.random_from_array=b.random_from_array;a.xz_direction=b.xz_direction;a.line_plane_intersect=b.line_plane_intersect;a.is_mesh=b.is_mesh};"object"==typeof module&&module.ql&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,p){var c=p("__version");a.version=c.version;a.type=c.type;a.date=c.date};"object"==typeof module&&module.ql&&b4w.module.version(exports);b4w.module.objects=function(a,p){var c=p("__objects");a.get_meta_tags=function(a){if(a&&a.b4w_object_tags)return c.get_meta_tags(a)}};b4w.module.main=function(a,p){function c(){}function b(){}function e(){}function d(){window.performance||(F.log("Apply performance workaround"),window.performance={});var a=Date.now();if(window.performance.now)b=a-performance.now();else{F.log("Apply performance.now() workaround");window.performance.now=function(){return Date.now()-a};var b=a}K.fr(0);return b}function l(a,c){a.addEventListener("webglcontextlost",function(a){a.preventDefault();F.error("B4W Error: WebGL context lost");h()},!1);G.fc(c);
var d=G.xp();d&&F.log("%cRENDERER INFO:","color: #00a",c.getParameter(d.UNMASKED_VENDOR_WEBGL)+", "+c.getParameter(d.UNMASKED_RENDERER_WEBGL));H.fc(c);A.fc(c);T.fc(c);D.fc(c);v.fc(c);x.fc(c);Y.jr(a.width,a.height,1,g("x"),g("y"));J.init();b=B();m()}function g(a){if("x"==a)var b=X.offsetLeft;else if("y"==a)b=X.offsetTop;else return 0;return f(b,X,a)}function f(a,b,c){a=a||0;if(b=b.offsetParent){if("x"==c)var d=b.offsetLeft;else"y"==c&&(d=b.offsetTop);a=f(a+d,b,c)}return a}function r(){c=function(){}}
function h(){n()||(ga=performance.now()/1E3,J.pause(),I.pause(),T.pause())}function n(){return ka<ga}function m(){qa(m);var a=performance.now()/1E3;w||(w=a);var c=a-w;if(!(c<1/aa.qe)){for(var d=K.wg(),e=0;e<L.length;e++)L[e](d,c);n()||(ka>w&&(c-=ka-Math.max(ga,w)),d+=c,K.fr(d),v.update(),y.update(),x.update(),s(d,c),b(c));w=a}}function s(a,b){x.is_primary_loaded()&&(C.reset(),R.update(b),M.update(a,b),J.update(a,b),z.update(b),x.is_primary_loaded()&&(I.update(a,b),x.is_primary_loaded()&&(c(b,a),x.is_primary_loaded()&&
(k.update(a,b),x.is_primary_loaded()&&(Y.update(a,b),S&&(S(X.toDataURL()),S=null))))))}function B(){var a=60,b=0,c=0,d=aa.Tv,f=aa.Sv;return function(g){a=N.smooth(1/g,a,g,d);b=N.smooth(0,b,g,d);c=(c+1)%f;0==c&&e(Math.round(a),Math.round(b))}}var z=p("__animation"),u=p("__compat"),q=p("__config"),F=p("__print"),k=p("__controls"),x=p("__data"),v=p("__debug"),G=p("__extensions"),A=p("__geometry"),C=p("__hud"),M=p("__nla"),y=p("__assets"),I=p("__physics"),H=p("__renderer"),Y=p("__scenes"),J=p("__sfx"),
D=p("__shaders"),T=p("__textures"),K=p("__time"),R=p("__transform"),N=p("__util"),ca=p("__version"),O=q.context,aa=q.p,X=null,ba=null,w=0,ga=0,ka=0,L=[],S=null,W=["webgl","experimental-webgl"],ja=null,qa=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/aa.qe)}}();a.init=function(a,b){q.Ky();F.Py(aa.console_verbose);var c=ca.version()+
" "+ca.type()+" ("+ca.date()+")";F.log("%cINIT B4W ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;c=d();X=a;u.St();var e;e=null;for(var f=0;f<W.length;f++){var g=W[f];try{e=a.getContext(g,O)}catch(h){}if(e)break}if(!e)return null;ja=e;l(X,e);q.Ut();u.Ey(e);F.log("%cSET PRECISION:","color: #00a",aa.precision);b?(C.init(b),ba=b):(q.p.show_hud_debug_info=!1,q.Od.Pj=!1);I.dx(c);return e};a.set_check_gl_errors=function(a){v.set_check_gl_errors(a)};a.resize=function(a,b,c){!1!==c&&
(X.style.width=a+"px",X.style.height=b+"px",ba&&(ba.style.width=a+"px",ba.style.height=b+"px"));ba&&(ba.width=a,ba.height=b,C.hh());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))aa.canvas_resolution_factor=1;c=a*aa.canvas_resolution_factor;b*=aa.canvas_resolution_factor;aa.allow_hidpi&&1<window.devicePixelRatio&&(c*=window.devicePixelRatio,b*=window.devicePixelRatio);X.width=c;X.height=b;if(c>ja.drawingBufferWidth||b>ja.drawingBufferHeight){F.warn("B4W Warning: canvas size exceeds platform limits, downscaling");
var d=Math.min(ja.drawingBufferWidth/c,ja.drawingBufferHeight/b);c*=d;b*=d;X.width=c;X.height=b}Y.jr(c,b,c/a,g("x"),g("y"));s(K.wg(),0);x.Qz(X.width,X.height)};a.set_fps_callback=function(a){e=a};a.clear_fps_callback=function(){e=function(){}};a.set_on_before_render_callback=function(a){c=a};a.set_render_callback=function(a){c=a};a.clear_on_before_render_callback=function(){r()};a.clear_render_callback=function(){r()};a.global_timeline=function(){return K.wg()};a.redraw=function(){s(K.wg(),0)};a.pause=
h;a.resume=function(){n()&&(ka=performance.now()/1E3,J.resume(),I.resume(),T.play(!0))};a.is_paused=n;a.reset=function(){x.unload(0);I.reset();ba=X=null;ka=ga=w=0;e=function(){};b=function(){};c=function(){};L.length=0;ja=null;K.reset()};a.canvas_data_url=function(a){S=a};a.get_canvas_elem=function(){return X};a.set_texture_quality=function(){N.ga("set_texture_quality() deprecated")};a.set_shaders_dir=function(){N.ga("set_shaders_dir() deprecated")};a.detect_mobile=function(){return u.detect_mobile()};
a.append_loop_cb=function(a){for(var b=0;b<L.length;b++)if(L[b]==a)return;L.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<L.length;b++)if(L[b]==a){L.splice(b,1);break}}};b4w.module.app=function(a,p){function c(){var a=k.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=k.is_paused(),k.pause()):a||k.resume()},!1)}function b(a,b){var c=String(a);b&&(c+="/"+String(b));H.innerHTML=c}function e(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function d(a,b,c){if(s.has_distance_limits(a))var d=A.get_translation(a,J),e=s.get_hover_cam_pivot(a,D),d=M.subtract(d,e,J),d=Math.max(M.len(d),1);
else d=10;e=A.get_rotation_quat(a,R);b=C.quat_to_dir(e,b,J);b[1]=0;M.normalize(b,b);M.scale(b,d*c,b);s.has_distance_limits(a)?(e=s.get_hover_cam_pivot(a,D),M.add(e,b,e),s.translate_hover_cam_v(a,e)):(d=A.get_translation(a,D),M.add(d,b,d),s.translate_hover_cam_v(a,d))}function l(a,b){if(s.has_distance_limits(a)){var c=s.get_hover_angle_limits(a,Y);if(0<c[0]-c[1]){var d=s.get_hover_cam_angle(a),c=(d-c[1])/(c[0]-c[1]),e=s.get_cam_dist_limits(a),c=Math.max(c,2/e[0]);s.set_hover_cam_angle(a,d-c*b)}}else d=
A.get_translation(a,J),c=M.scale(C.AXIS_Y,-b,D),M.add(d,c,d),s.translate_hover_cam_v(a,d)}function g(a,b,c,d){A.move_local(a,5*b,5*c,5*d)}function f(a,b,c){var d=A.get_translation(a,J),e=s.get_pivot(a,D),d=M.dist(d,e),e=Math.abs(b);c=Math.pow(e*c,1-Math.pow(e*c,.15));A.move_local(a,0,0>b?.001<d?-d*c:0:c/(1-c)*d,0)}function r(a,b,c,d){for(var e=c*b;0<a;--a)c+=e,d+=e,e=c*b;return d}function h(a,b,c,d,e){e?(e=s.get_pivot(a,J),a=s.get_eye(a),a=M.dist(e,a)+d,d=0<b?r(b,-c,a,d):r(-b,c/(1-c),a,d)):d-=2*b*
c;return d}function n(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div");if(d)for(var h=0;h<d.length;h++){var k=document.getElementById(d[h]);k&&k.parentNode.removeChild(k)}e.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";f.style.cssText="color:#fff;font-size:24px;";g.style.cssText="color:#fff;font-size:20px;";f.innerHTML=a;g.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+
c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(f);e.appendChild(g);document.body.appendChild(e)}function m(a,b,c,d){function e(g){g=1E3*g-f;d(a+g*(b-a)/c);g>=c&&k.remove_loop_cb(e)}var f=1E3*k.global_timeline();k.append_loop_cb(e)}p("animation");var s=p("camera"),B=p("config"),z=p("constraints"),u=p("controls"),q=p("data"),F=p("debug"),k=p("main"),x=p("physics"),v=p("print"),G=p("scenes"),A=p("transform"),C=p("util"),M=p("vec3");p("quat");var y=null,I=null,H=null,Y=new Float32Array(2),J=
new Float32Array(3),D=new Float32Array(3),T=new Float32Array(3),K=new Float32Array(3),R=new Float32Array(4);a.init=function(a){function d(){var a;a=g;var e=D,q=l,r=document.createElement("canvas");r.style.position="absolute";r.style.left="0px";r.style.top="0px";if(t){var s=document.createElement("canvas");s.style.cssText="z-index: 2; position:absolute; left:0px; top:0px; pointer-events: none;"}else s=null;k.init(r,s)?(I=r,e=document.getElementById(a),e||(v.error('Warning: canvas container "'+a+'" not found, appending to body'),
e=document.body),e.appendChild(r),s&&e.appendChild(s),a=e):(e&&n("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",q),a=null);a?(y=a,k.set_check_gl_errors(h),z&&((a=m)?(p&&(document.getElementById(p).style.display="block"),H=document.getElementById(a)):(H=document.createElement("div"),H.innerHTML=0,H.style.cssText="             position:absolute;            top: 23px;            right: 20px;            font-size: 45px;            line-height: 50px;            font-weight: bold;            color: #000;            z-index: 1;        ",
document.body.appendChild(H)),k.set_fps_callback(b)),x&&c(),f(I,!0)):f(I,!1)}function e(a){a.keyCode==u.KEY_P&&(k.is_paused()?k.resume():k.pause())}function f(){}a=a||{};var g=null,h=!1,l=null,m=null,p=null,r=!0,s=!1,x=!0,D=!0,z=!1,A=!1,C;for(C in a)switch(C){case "canvas_container_id":g=a.canvas_container_id;break;case "callback":f=a.callback;break;case "do_not_use_onload":break;case "gl_debug":h=a.gl_debug;break;case "show_hud_debug_info":A=a.show_hud_debug_info;break;case "sfx_mix_mode":s=a.sfx_mix_mode;
break;case "show_fps":z=a.show_fps;break;case "fps_wrapper_id":p=a.fps_wrapper_id;break;case "fps_elem_id":m=a.fps_elem_id;break;case "error_purge_elements":l=a.error_purge_elements;break;case "report_init_failure":D=a.report_init_failure;break;case "pause_invisible":x=a.pause_invisible;break;case "key_pause_enabled":r=a.key_pause_enabled;break;default:B.set(C,a[C])}r&&document.addEventListener("keydown",e,!1);B.set("show_hud_debug_info",A);B.set("sfx_mix_mode",s);var t=A||s||null;"complete"==document.readyState?
window.setTimeout(d,0):window.addEventListener("load",d,!1);window.addEventListener("unload",function(){q.cleanup()},!1)};a.resize_to_containter=function(){k.resize(y.clientWidth,y.clientHeight,!0)};a.get_canvas_container=function(){return y};a.set_onclick=function(a,b){var c=e(a);c.addEventListener("mouseup",function(){b(c.value)},!1)};a.set_onchange=function(a,b){var c=e(a);c.addEventListener("change",function(){var a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,b){var c=e(a);
c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.enable_camera_controls=function(a,b){function c(a,b,d,e){if(1==d){var f=r?.003*v[0]:.003*v[1];d=u.get_sensor_value(a,b,0);u.get_sensor_payload(a,b,0)===u.PL_SINGLE_TOUCH_MOVE?(Oa+="X"==e?-d*f:0,za+="Y"==e?-d*f:0):u.get_sensor_payload(a,b,0)===u.PL_MULTITOUCH_MOVE_PAN&&(a=r?.003*v[1]:7.5E-4*v[0],Ta+="X"==e?-d*a:0,pa+="Y"==e?-d*a:0)}}function e(a,b,c,d){if(1==c){c=u.get_sensor_value(a,b,1);s.get_velocity_params(a,v);if(r)f=.003*
v[0],g=7.5E-4*v[1];else var f=.003*v[1],g=7.5E-4*v[0];if(1===u.get_sensor_payload(a,b,0))ta+="X"==d?-c*f:0,wa+="Y"==d?-c*f:0;else if(2===u.get_sensor_payload(a,b,0)||3===u.get_sensor_payload(a,b,0))Za+="X"==d?-c*g:0,Sa+="Y"==d?-c*g:0}}function k(a){return a[0]&&(a[1]||a[2])}function m(a,b,c){if(!B||!u.get_sensor_value(a,"CAMERA_COLLISION",1)){if(1==c)switch(c=u.get_sensor_value(a,b,0),s.get_velocity_params(a,v),b){case "FORWARD":q?F[0]=1:r?Math.abs(s.get_hover_cam_angle(a))>=Math.PI/4?d(a,C.AXIS_MZ,
.5*v[0]*c):d(a,C.AXIS_MY,.5*v[0]*c):p?f(a,-v[2],c):g(a,0,-v[0]*c,0);break;case "BACKWARD":q?F[0]=-1:r?Math.abs(s.get_hover_cam_angle(a))>=Math.PI/4?d(a,C.AXIS_Z,.5*v[0]*c):d(a,C.AXIS_Y,.5*v[0]*c):p?f(a,v[2],c):g(a,0,v[0]*c,0);break;case "UP":r?l(a,30*-v[2]*c):q||g(a,0,0,-v[0]*c);break;case "DOWN":r?l(a,30*v[2]*c):q||g(a,0,0,v[0]*c);break;case "LEFT":q?F[1]=1:r?d(a,C.AXIS_MX,.5*v[0]*c):g(a,-v[0]*c,0,0);break;case "RIGHT":q?F[1]=-1:r?d(a,C.AXIS_X,.5*v[0]*c):g(a,v[0]*c,0,0);break;case "ROT_LEFT":p?s.rotate_pivot(a,
2*-v[1]*c,0):s.rotate(a,2*v[1]*c,0);break;case "ROT_RIGHT":p?s.rotate_pivot(a,2*v[1]*c,0):s.rotate(a,2*-v[1]*c,0);break;case "ROT_UP":p?s.rotate_pivot(a,0,2*-v[1]*c):s.rotate(a,0,2*-v[1]*c);break;case "ROT_DOWN":p?s.rotate_pivot(a,0,2*v[1]*c):s.rotate(a,0,2*v[1]*c)}else switch(b){case "FORWARD":case "BACKWARD":q&&(F[0]=0);break;case "LEFT":case "RIGHT":q&&(F[1]=0)}q&&(x.set_character_move_dir(q,F[0],F[1]),b=Y,s.get_angles(a,b),b[0]+=Math.PI,b[1]*=-1,x.set_character_rotation(q,b[0],b[1]))}}var n=G.get_active_camera(),
p=!1,q=null,r=!1;switch(s.get_move_style(n)){case s.MS_TARGET_CONTROLS:p=!a;break;case s.MS_EYE_CONTROLS:q=G.get_first_character();break;case s.MS_STATIC:return;case s.MS_HOVER_CONTROLS:r=!0}var v=s.get_velocity_params(n,K),y=u.create_elapsed_sensor();if(x.has_simulated_physics(n)){var B=u.create_collision_sensor(n,null,!0);u.create_sensor_manifold(n,"CAMERA_COLLISION",u.CT_CONTINUOUS,[y,B],null,function(a,b,c){if(1==c){b=u.get_sensor_payload(a,b,1);c=A.get_translation(a,J);var d=D;M.sub(c,b,d);M.normalize(d,
d);M.scale(d,.01,d);M.add(c,d,c);A.set_translation_v(a,c)}})}if(q){var H=A.get_translation(n),I=A.get_rotation(n),I=C.cam_quat_to_mesh_quat(I);H[1]-=.5;x.set_transform(q,H,I);z.append_stiff_trans(n,q,[0,.5,0]);var F=new Float32Array(2),t=!0;x.set_character_move_type(q,x.CM_FLY);u.create_kb_sensor_manifold(n,"TOGGLE_CHAR_MOVE_TYPE",u.CT_SHOT,u.KEY_C,function(){t=!t;x.set_character_move_type(q,t?x.CM_FLY:x.CM_WALK)})}if(b)H=I=R=oa=ra=ma=u.create_custom_sensor(0);else var H=u.create_keyboard_sensor(u.KEY_W),
I=u.create_keyboard_sensor(u.KEY_S),R=u.create_keyboard_sensor(u.KEY_A),oa=u.create_keyboard_sensor(u.KEY_D),ra=u.create_keyboard_sensor(u.KEY_R),ma=u.create_keyboard_sensor(u.KEY_F);var da=u.create_keyboard_sensor(u.KEY_UP),ia=u.create_keyboard_sensor(u.KEY_DOWN),Q=u.create_keyboard_sensor(u.KEY_LEFT),ya=u.create_keyboard_sensor(u.KEY_RIGHT);r||(u.create_sensor_manifold(n,"FORWARD",u.CT_CONTINUOUS,[y,H],null,m),u.create_sensor_manifold(n,"BACKWARD",u.CT_CONTINUOUS,[y,I],null,m));p?(u.create_sensor_manifold(n,
"ROT_UP",u.CT_CONTINUOUS,[y,da,ra],k,m),u.create_sensor_manifold(n,"ROT_DOWN",u.CT_CONTINUOUS,[y,ia,ma],k,m),u.create_sensor_manifold(n,"ROT_LEFT",u.CT_CONTINUOUS,[y,Q,R],k,m),u.create_sensor_manifold(n,"ROT_RIGHT",u.CT_CONTINUOUS,[y,ya,oa],k,m)):r?(u.create_sensor_manifold(n,"LEFT",u.CT_CONTINUOUS,[y,Q,R],k,m),u.create_sensor_manifold(n,"RIGHT",u.CT_CONTINUOUS,[y,ya,oa],k,m),u.create_sensor_manifold(n,"FORWARD",u.CT_CONTINUOUS,[y,da,H],k,m),u.create_sensor_manifold(n,"BACKWARD",u.CT_CONTINUOUS,[y,
ia,I],k,m),u.create_sensor_manifold(n,"UP",u.CT_CONTINUOUS,[y,ma],k,m),u.create_sensor_manifold(n,"DOWN",u.CT_CONTINUOUS,[y,ra],k,m)):(u.create_sensor_manifold(n,"UP",u.CT_CONTINUOUS,[y,ra],k,m),u.create_sensor_manifold(n,"DOWN",u.CT_CONTINUOUS,[y,ma],k,m),u.create_sensor_manifold(n,"LEFT",u.CT_CONTINUOUS,[y,R],k,m),u.create_sensor_manifold(n,"RIGHT",u.CT_CONTINUOUS,[y,oa],k,m),u.create_sensor_manifold(n,"ROT_UP",u.CT_CONTINUOUS,[y,da],k,m),u.create_sensor_manifold(n,"ROT_DOWN",u.CT_CONTINUOUS,[y,
ia],k,m),u.create_sensor_manifold(n,"ROT_LEFT",u.CT_CONTINUOUS,[y,Q],k,m),u.create_sensor_manifold(n,"ROT_RIGHT",u.CT_CONTINUOUS,[y,ya],k,m));var fa=0,H=u.create_mouse_wheel_sensor(),Ga=0,I=u.create_touch_zoom_sensor();u.create_sensor_manifold(n,"MOUSE_WHEEL",u.CT_LEVEL,[H],null,function(a,b,c){1==c&&(b=u.get_sensor_value(a,b,0),s.get_velocity_params(a,v),p||r?fa=h(a,b,v[2],fa,p):(v[0]*=1+b*v[2],s.set_velocity_params(a,v)))});u.create_sensor_manifold(n,"TOUCH_ZOOM",u.CT_LEVEL,[I],null,function(a,
b,c){1==c&&(c=u.get_sensor_value(a,b,0),s.get_velocity_params(a,v),u.get_sensor_payload(a,b,0)===u.PL_MULTITOUCH_MOVE_ZOOM&&(Ga=h(a,c,.03*v[2],Ga,p)))});u.create_sensor_manifold(n,"ZOOM_INTERPOL",u.CT_CONTINUOUS,[y],null,function(a,b,c){if(1==c&&(p||r))if(1E-5<Math.abs(fa)||1E-5<Math.abs(Ga)){b=u.get_sensor_value(a,b,0);c=C.smooth(fa,0,b,.1);fa-=c;var d=C.smooth(Ga,0,b,.15);Ga-=d;if(!B||!u.get_sensor_value(a,"CAMERA_COLLISION",1))if(r)l(a,-(c+d));else{b=s.get_pivot(a,J);var e=s.get_eye(a,D);.001<
M.dist(b,e)+c+d?A.move_local(a,0,c+d,0):(c=M.subtract(e,b,D),d=M.normalize(c,T),M.scale(d,.001,d),M.add(b,d,c),A.set_translation_v(a,c),Ga=fa=0)}}else Ga=fa=0});var ta=0,wa=0,Za=0,Sa=0,H=u.create_mouse_move_sensor("X"),I=u.create_mouse_move_sensor("Y"),R=u.create_mouse_click_sensor();u.create_sensor_manifold(n,"MOUSE_X",u.CT_LEVEL,[R,H],null,e,"X");u.create_sensor_manifold(n,"MOUSE_Y",u.CT_LEVEL,[R,I],null,e,"Y");var Oa=0,za=0,Ta=0,pa=0,H=u.create_touch_move_sensor("X"),I=u.create_touch_move_sensor("Y");
u.create_sensor_manifold(n,"TOUCH_X",u.CT_LEVEL,[H],null,c,"X");u.create_sensor_manifold(n,"TOUCH_Y",u.CT_LEVEL,[I],null,c,"Y");u.create_sensor_manifold(n,"ROT_TRANS_INTERPOL",u.CT_CONTINUOUS,[y],null,function(a,b,c){if(1==c&&(.001<Math.abs(ta)||.001<Math.abs(wa)||.001<Math.abs(Oa)||.001<Math.abs(za)||.001<Math.abs(Za)||.001<Math.abs(Sa)||1E-5<Math.abs(Ta)||1E-5<Math.abs(pa))){var e=u.get_sensor_value(a,b,0);b=C.smooth(ta,0,e,.08);c=C.smooth(wa,0,e,.08);ta-=b;wa-=c;var f=C.smooth(Oa,0,e,.12),g=C.smooth(za,
0,e,.12);Oa-=f;za-=g;var h=C.smooth(Za,0,e,.08),k=C.smooth(Sa,0,e,.08);Za-=h;Sa-=k;var l=C.smooth(Ta,0,e,.12),e=C.smooth(pa,0,e,.12);Ta-=l;pa-=e;p?(s.rotate_pivot(a,b+f,c+g),s.move_pivot(a,h+l,k+e)):r?(b+f&&d(a,C.AXIS_X,.2*(b+f)),c+g&&(Math.abs(s.get_hover_cam_angle(a))>Math.PI/4?d(a,C.AXIS_Z,.2*(c+g)):d(a,C.AXIS_Y,.2*(c+g))),s.rotate_hover_cam(a,h+l)):(s.rotate(a,.5*(b+f),.5*-(c+g)),q&&(b=Y,s.get_angles(a,b),b[0]+=Math.PI,b[1]*=-1,x.set_character_rotation(q,b[0],b[1])))}});u.create_kb_sensor_manifold(n,
"DEC_STEREO_DIST",u.CT_SHOT,u.KEY_LEFT_SQ_BRACKET,function(a){var b=s.get_stereo_distance(a);s.set_stereo_distance(a,.9*b)});u.create_kb_sensor_manifold(n,"INC_STEREO_DIST",u.CT_SHOT,u.KEY_RIGHT_SQ_BRACKET,function(a){var b=s.get_stereo_distance(a);s.set_stereo_distance(a,1.1*b)})};a.disable_camera_controls=function(){for(var a=G.get_active_camera(),b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL".split(" "),
c=0;c<b.length;c++)u.remove_sensor_manifold(a,b[c])};a.enable_object_controls=function(a){function b(a){return a[0]&&(a[1]||a[2])}function c(a,b,e){if(1==e)switch(e=u.get_sensor_value(a,b,0),b){case "FORWARD":d?x.vehicle_throttle(a,1):A.move_local(a,0,0,1*e);break;case "BACKWARD":d?x.vehicle_throttle(a,-1):A.move_local(a,0,0,-1*e);break;case "LEFT":d?x.vehicle_steer(a,-1):A.move_local(a,1*e,0,0);break;case "RIGHT":d?x.vehicle_steer(a,1):A.move_local(a,-1*e,0,0)}else switch(b){case "FORWARD":case "BACKWARD":d&&
x.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":d&&x.vehicle_steer(a,0)}}var d=x.is_vehicle_chassis(a)||x.is_vehicle_hull(a),e=u.create_elapsed_sensor(),f=u.create_keyboard_sensor(u.KEY_W),g=u.create_keyboard_sensor(u.KEY_S),h=u.create_keyboard_sensor(u.KEY_A),k=u.create_keyboard_sensor(u.KEY_D),l=u.create_keyboard_sensor(u.KEY_UP),m=u.create_keyboard_sensor(u.KEY_DOWN),n=u.create_keyboard_sensor(u.KEY_LEFT),p=u.create_keyboard_sensor(u.KEY_RIGHT);u.create_sensor_manifold(a,"FORWARD",u.CT_CONTINUOUS,
[e,f,l],b,c);u.create_sensor_manifold(a,"BACKWARD",u.CT_CONTINUOUS,[e,g,m],b,c);u.create_sensor_manifold(a,"LEFT",u.CT_CONTINUOUS,[e,h,n],b,c);u.create_sensor_manifold(a,"RIGHT",u.CT_CONTINUOUS,[e,k,p],b,c)};a.disable_object_controls=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)u.remove_sensor_manifold(a,b[c])};a.enable_controls=function(a){u.register_keyboard_events(document,!1);u.register_mouse_events(a,!0);u.register_wheel_events(a,!0);u.register_touch_events(a,
!0);u.register_device_orientation()};a.disable_controls=function(a){u.unregister_keyboard_events(document);u.unregister_mouse_events(a);u.unregister_wheel_events(a);u.unregister_touch_events(a);u.unregister_device_orientation()};a.enable_debug_controls=function(){u.create_kb_sensor_manifold(null,"CAMERA_SHOT",u.CT_SHOT,u.KEY_K,function(){F.make_camera_frustum_shot()});u.create_kb_sensor_manifold(null,"LIGHT_SHOT",u.CT_SHOT,u.KEY_L,function(){F.make_light_frustum_shot()});u.create_kb_sensor_manifold(null,
"TELEMETRY",u.CT_SHOT,u.KEY_T,function(){F.plot_telemetry()})};a.request_fullscreen=function(a,b,c){function d(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",
d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.requestFullScreen==a.webkitRequestFullScreen?a.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen()};a.exit_fullscreen=
function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.check_fullscreen=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?!0:!1};a.report_app_error=n;a.get_url_params=function(a){a=!!a;var b=location.href.toString();
if(-1==b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("="),f=e[0];1<e.length?(e=e[1],a?f in c?c[f].push(e):c[f]=[e]:c[f]=e):a?f in c||(c[f]=[]):c[f]=""}return c};a.css_animate=function(a,b,c,d,e,f,g){m(c,d,e,function(e){var h=e;f&&(h+=f);a.style[b]=h;(c>d&&e<=d||c<d&&e>=d)&&g()})}};b4w.module.camera_anim=function(a,p){function c(a,c){var d=b.get_move_style(a),e=b.get_horizontal_limits(a),f=b.get_angles(a,r)[0],f=d==b.MS_TARGET_CONTROLS?f-Math.PI:-1*f;return c*Math.min(1,(e[1]-f)/.2,(f-e[0])/.2)}var b=p("camera"),e=p("controls"),d=p("print"),l=p("scenes"),g=p("transform"),f=p("util"),r=new Float32Array(2),h=new Float32Array(3),n=new Float32Array(3),m=new Float32Array(3),s=new Float32Array(4),B=p("vec3"),z=p("quat");a.track_to_target=function(a,c,d,k,l,p,r,A){if(a&&c){if(f.is_vector(c))var C=
c;else C=m,g.get_object_center(c,!1,C);c=d||1;d=k||2;var M=l||1;l=p||1;n[0]=0;n[1]=-1;n[2]=0;var y=g.get_rotation_quat(a);p=f.quat_to_dir(y,n);k=b.get_angles(a);var I=g.get_translation(a);B.subtract(C,I,h);B.normalize(h,h);var H=z.rotationTo(p,h,z.create());z.multiply(H,y,s);f.correct_cam_quat_up(s,!1);B.subtract(C,I,n);var Y=B.length(n)*(1-1/d),C=Math.asin(h[1]);d=Math.acos(-h[2]/Math.abs(Math.cos(C)));0<h[0]&&(d=2*Math.PI-d);var J=d-k[0],D=C-k[1];m[0]=0;m[1]=0;m[2]=-1;d=g.get_rotation_quat(a);0>
f.quat_to_dir(d,m)[1]?(D=0<p[1]?C-Math.PI+k[1]:C+Math.PI+k[1],J=0<J?-Math.PI+J:Math.PI+J):Math.abs(J)>Math.PI&&(J=0<J?J-2*Math.PI:J+2*Math.PI);var D=-D,T=0,C=e.create_elapsed_sensor();p=Math.abs(J/c);c=Math.abs(D/c);var K=p>c?p:c,R=K+M,N=R+l,ca=N+M,O=J,aa=D,X=Y;e.create_sensor_manifold(a,"TRACK_TO_TARGET",e.CT_CONTINUOUS,[C],null,function(a,c,d){if(d)if(d=e.get_sensor_value(a,c,0),T+=d,T<K){var f=J/K*d;d*=D/K;c=T/K;c=6*c*(1-c);f*=c;d*=c;O-=f;aa-=d;b.rotate(a,f,d)}else T<R?(O&&(b.rotate(a,O,aa),O=
0,A&&A()),c=(T-K)/M,d=-Y*d/M,X-=f,g.move_local(a,0,6*d*c*(1-c),0)):T<N?X&&(g.move_local(a,0,X,0),X=0):T<ca?(c=(T-N)/M,d=Y*d/M,d=6*d*c*(1-c),g.move_local(a,0,d,0)):(g.set_translation_v(a,I),e.remove_sensor_manifold(a,c),r&&r())})}};a.auto_rotate=function(a,g){function h(c,d,g){if(1==g)if(n!=b.MS_HOVER_CONTROLS&&b.has_horizontal_limits(c)){d=e.get_sensor_value(c,d,0);g=b.get_move_style(c);var k=b.get_horizontal_limits(c),l=b.get_angles(c,r)[0],m=Math.min(.2,(k[1]-k[0])/2),l=g==b.MS_TARGET_CONTROLS?
l-Math.PI:-1*l;k[1]-l>m&&l-k[0]>m?p=f.sign(p)*a:k[1]-l<m?p-=Math.pow(a,2)/.4*d:l-k[0]<m&&(p+=Math.pow(a,2)/.4*d);switch(g){case b.MS_TARGET_CONTROLS:b.rotate_pivot(c,d*p,0);break;case b.MS_EYE_CONTROLS:b.rotate(c,d*p,0)}}else switch(d=e.get_sensor_value(c,d,0),b.get_move_style(c)){case b.MS_TARGET_CONTROLS:b.rotate_pivot(c,d*a,0);break;case b.MS_EYE_CONTROLS:b.rotate(c,d*a,0);break;case b.MS_HOVER_CONTROLS:b.rotate_hover_cam(c,d*a)}}function k(){e.remove_sensor_manifold(m,"AUTO_ROTATE");e.remove_sensor_manifold(m,
"DISABLE_AUTO_ROTATE");g()}g=g||function(){};var m=l.get_active_camera(),n=b.get_move_style(m);if(n==b.MS_STATIC)d.error("auto_rotate(): wrong camera type");else{if(b.has_horizontal_limits(m))var p=c(m,a);if(e.check_sensor_manifold(m,"AUTO_ROTATE"))k();else{var s=e.create_mouse_move_sensor("X"),z=e.create_mouse_move_sensor("Y"),B=e.create_mouse_click_sensor(),y=e.create_touch_move_sensor(),I=e.create_touch_zoom_sensor(),H=e.create_elapsed_sensor();e.create_sensor_manifold(m,"DISABLE_AUTO_ROTATE",
e.CT_LEVEL,[s,z,B,y,I],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]},k);e.create_sensor_manifold(m,"AUTO_ROTATE",e.CT_CONTINUOUS,[H],function(a){return a[0]},h)}}};a.is_auto_rotate=function(){var a=l.get_active_camera();return e.check_sensor_manifold(a,"AUTO_ROTATE")}};b4w.module.gyroscope=function(a,p){function c(a){var c=b.create_gyro_angles_sensor(),e=!0;b.create_sensor_manifold(a,"CAMERA_ROTATE_GYRO",b.CT_CONTINUOUS,[c],null,function(a,c,m){if(0<m){g=b.get_sensor_payload(a,c,0);e&&(l[0]=g[0],l[1]=g[1],l[2]=g[2],e=!1);m=c=0;0==window.orientation&&(c=g[1]-l[1],m=g[0]-l[0],g[1]>r&&g[1]<f&&(m=0));if(180==window.orientation){c=g[1]-l[1];0>g[1]&&(c=-c);m=l[0]-g[0];if(c>Math.PI/2||c<-Math.PI/2)c=0;g[1]>-f&&g[1]<-r&&(m=0)}if(-90==window.orientation){c=g[0]-l[0];if(c>
Math.PI/2||c<-Math.PI/2)c=0;m=l[1]-g[1];if(g[0]>h||g[0]<n)m=0}if(90==window.orientation){c=l[0]-g[0];if(c>Math.PI/2||c<-Math.PI/2)c=0;m=g[1]-l[1];if(g[0]>h||g[0]<n)m=0}switch(d.get_move_style(a)){case d.MS_TARGET_CONTROLS:d.rotate_pivot(a,m,c);break;case d.MS_EYE_CONTROLS:d.rotate(a,m,c);break;case d.MS_HOVER_CONTROLS:d.rotate_hover_cam(a,m)}l[0]=g[0];l[1]=g[1];l[2]=g[2]}})}var b=p("controls"),e=p("scenes"),d=p("camera"),l=new Float32Array(3),g=new Float32Array(3),f=110*Math.PI/180,r=70*Math.PI/180,
h=70*Math.PI/180,n=70*-Math.PI/180;a.enable_camera_rotation=function(){var a=e.get_active_camera();c(a)}};b4w.module.mixer=function(a,p){function c(){q=u.length=0;F=b();k=new Float32Array(F.length);x=new Float32Array(F.length);var a=B.get_speakers();if(a.length){u.push(e());for(var c=0;c<a.length;c++)u.push(l(a[c]));u.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function b(){for(var a=new Float32Array(100),b=0,c=0;100>c;c++)a[c]=20*Math.pow(1E3,b),b+=1/99;return a}
function e(){var a=d("MASTER");a.H.push(["VOLUME",B.get_volume(null),0,1,50,!1]);var b=B.get_compressor_params();b&&(a.H.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.H.push(["KNEE",b.knee,0,40,40,!1]),a.H.push(["RATIO",b.ratio,1,20,20,!1]),a.H.push(["ATTACK",b.attack,0,1,1E3,!1]),a.H.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=B.is_muted(null)?1:0;a.uc=-1;return a}function d(a){return{id:a,H:[],Te:0,mute:-1,uc:-1,ka:null}}function l(a){var b=d(s.get_object_name(a));b.mute=B.is_muted(a)?1:0;
b.uc=0;b.ka=a;return b}function g(a){if(a.ka){a.H.length=0;a.H.push(["VOLUME",B.get_volume(a.ka),0,1,50,!1]);var b=B.get_positional_params(a.ka);b&&(a.H.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.H.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.H.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=B.get_filter_params(a.ka))a.H.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.H.push(["EQ_Q",b.Q,0,10,100,!1]),a.H.push(["EQ_GAIN",b.gain,-70,30,100,!1]);z.clamp(a.Te,0,a.H.length-1)}}function f(a){for(var b=
0;b<u.length;b++){var c=u[b];if(c!=a&&1==c.uc)return!0}return!1}function r(a){for(var b=0;b<u.length;b++){var c=u[b];c!=a&&0==c.mute&&0==c.uc&&B.mute(c.ka,!1)}}function h(){if(0==u.length)return[0,-1];var a=8*Math.floor(q/8),b=a+7,a=z.clamp(a,0,u.length-1),b=z.clamp(b,0,u.length-1);return[a,b]}var n=p("controls");p("debug");var m=p("hud"),s=p("scenes"),B=p("sfx"),z=p("util"),u=[],q=0,F=null,k=null,x=null;a.enable_mixer_controls=function(){function a(b,c,d){if(1==d){var e=Boolean(n.get_sensor_value(b,
c,2))?-1:1,f=u[q];if(f)switch(d=f.H[f.Te],d[1]=d[5]?d[1]*Math.pow(d[3]/d[2],e/d[4]):d[1]+(d[3]-d[2])/d[4]*e,d[1]=z.clamp(d[1],d[2],d[3]),d[0]){case "VOLUME":"MASTER"!=f.id?B.set_volume(f.ka,d[1]):B.set_volume(null,d[1]);break;case "DIST_REF":e=B.get_positional_params(f.ka);e.dist_ref=d[1];B.set_positional_params(f.ka,e);break;case "ATTENUATION":e=B.get_positional_params(f.ka);e.attenuation=d[1];B.set_positional_params(f.ka,e);break;case "DIST_MAX":e=B.get_positional_params(f.ka);e.dist_max=d[1];B.set_positional_params(f.ka,
e);break;case "EQ_FREQ":e=B.get_filter_params(f.ka);e.freq=d[1];B.set_filter_params(f.ka,e);break;case "EQ_Q":e=B.get_filter_params(f.ka);e.Q=d[1];B.set_filter_params(f.ka,e);break;case "EQ_GAIN":e=B.get_filter_params(f.ka);e.gain=d[1];B.set_filter_params(f.ka,e);break;case "THRESHOLD":f=B.get_compressor_params();f.threshold=d[1];B.set_compressor_params(f);break;case "KNEE":f=B.get_compressor_params();f.knee=d[1];B.set_compressor_params(f);break;case "RATIO":f=B.get_compressor_params();f.ratio=d[1];
B.set_compressor_params(f);break;case "ATTACK":f=B.get_compressor_params();f.attack=d[1];B.set_compressor_params(f);break;case "RELEASE":f=B.get_compressor_params();f.release=d[1];B.set_compressor_params(f);break;default:throw"Unknown strip param";}"INC_DEC"==c?n.reset_timer_sensor(b,c,6,.35):n.reset_timer_sensor(b,c,6,.05)}else n.reset_timer_sensor(b,c,6,10)}function b(a,c,d){if(1==d){d=Boolean(n.get_sensor_value(a,c,0))?-1:1;if(u.length){1==d&&q<u.length-1?q++:-1==d&&0<q&&q--;d=h();for(var e=d[0];e<=
d[1];e++)g(u[e])}"SWITCH_STRIP"==c?n.reset_timer_sensor(a,c,5,.15+.3):n.reset_timer_sensor(a,c,5,.15)}else n.reset_timer_sensor(a,c,5,10)}c();var d=n.create_keyboard_sensor(n.KEY_LEFT_SQ_BRACKET),e=n.create_keyboard_sensor(n.KEY_RIGHT_SQ_BRACKET),l=n.create_keyboard_sensor(n.KEY_SEMI_COLON),p=n.create_keyboard_sensor(n.KEY_SINGLE_QUOTE),s=n.create_keyboard_sensor(n.KEY_SHIFT),H=n.create_timer_sensor(.15,!0),Y=n.create_timer_sensor(.05,!0),d=[d,e,l,p,s,H,Y];n.create_sensor_manifold(null,"SWITCH_STRIP",
n.CT_TRIGGER,d,function(a){return(a[0]||a[1])&&!a[4]},b);n.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",n.CT_SHOT,d,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},b);n.create_sensor_manifold(null,"SWITCH_PARAM",n.CT_SHOT,d,function(a){return(a[0]||a[1])&&a[4]},function(a,b){var c=Boolean(n.get_sensor_value(a,b,0))?-1:1,d=u[q];d&&(1==c&&d.Te<d.H.length-1?d.Te++:-1==c&&0<d.Te&&d.Te--)});n.create_sensor_manifold(null,"INC_DEC",n.CT_TRIGGER,d,function(a){return(a[2]||a[3])&&!a[4]},a);n.create_sensor_manifold(null,
"INC_DEC_HOLD",n.CT_SHOT,d,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},a);n.create_sensor_manifold(null,"MUTE_SOLO",n.CT_SHOT,d,function(a){return(a[2]||a[3])&&a[4]},function(a,b){if(Boolean(n.get_sensor_value(a,b,2))){var c=u[q];c&&0<=c.mute&&("MASTER"!=c.id?0==c.mute?(c.mute=1,B.mute(c.ka,!0),1==c.uc&&(c.uc=0,f(c)||r(c))):(c.mute=0,f(c)||B.mute(c.ka,!1)):0==c.mute?(c.mute=1,B.mute(null,!0)):(c.mute=0,B.mute(null,!1)))}else if((c=u[q])&&0<=c.uc)if(0==c.uc){c.uc=1;B.mute(c.ka,!1);1==c.mute&&(c.mute=
0);for(var d=0;d<u.length;d++){var e=u[d];e!=c&&0==e.mute&&0==e.uc&&B.mute(e.ka,!0)}}else c.uc=0,f(c)?B.mute(c.ka,!0):r(c)});d=n.create_elapsed_sensor();n.create_sensor_manifold(null,"MIXER_DRAW",n.CT_CONTINUOUS,[d],null,function(){if(u[q])for(var a=h(),b=a[0];b<=a[1];b++){var c=u[b];m.draw_mixer_strip(c.id,b==q,b%8,c.H,c.Te,c.mute,c.uc);if(c.ka&&B.get_filter_params(c.ka)){B.get_filter_freq_response(c.ka,F,k,x);for(c=0;c<k.length;c++)k[c]=20*Math.log(k[c])/Math.LN10;m.plot_array("EQ",b%8,k,20,2E4,
-10,10)}}});d=n.create_timer_sensor(1,!0);n.create_sensor_manifold(null,"MIXER_UPDATE",n.CT_TRIGGER,[d],null,function(){for(var a=h(),b=a[0];b<=a[1];b++)g(u[b])})}};b4w.module.npc_ai=function(a,p){function c(a,b){var c=b.destination,d=q;z.get_translation(b.empty,d);var e=F;z.get_translation(b.collider,e);var l=0;b.oh?l=b.oh:b.Ud&&(l=b.Ud,b.type==C&&(l*=.5),b.type==y&&(l*=a));switch(b.type){case C:if(b.random&&b.we){c[0]=(12*Math.random()-6)*b.speed+d[0];c[2]=(12*Math.random()-6)*b.speed+d[2];var n=G,d=k,p=b.speed,s=b.rot_speed;z.get_rotation_quat(b.collider,n);f.transformQuat(m.AXIS_Z,n,d);d[1]=0;f.normalize(d,d);n=.5*p/Math.sin(s/2);p=f.dist(c,e);p<2*n&&f.scaleAndAdd(c,
d,2*n-p,c);b.we=!1}c[1]=e[1];l&&(c[1]+=l);break;case M:case y:b.random&&b.we&&(b.type==y?(b.speed=Math.random()+.1,n=b.yx-b.Ex):n=b.max_height-b.min_height,c[0]=10*Math.random()-5+d[0],c[1]=e[1]+(Math.random()*n-.5*n),c[2]=10*Math.random()-5+d[2],b.we=!1),l&&(c[1]=e[1]+l)}var c=q,d=F,p=k,e=A,u=b.rig,n=b.collider,l=b.destination,B=b.speed,aa=b.actions,X=h.get_current_action(u);if(!h.is_play(u)||!aa.Th||-1==aa.Th.indexOf(X)){z.get_translation(n,c);var s=l[0]-c[0],ba=l[2]-c[2],s=Math.sqrt(s*s+ba*ba);
if(s>2*B*a)b.state=20,m.xz_direction(l,c,p),aa=b.rig,h.is_animated(aa)&&(u=b.speed,B=h.get_current_frame_float(aa),aa=h.get_anim_length(aa),u*=aa/24*(1-B/aa),.9>s/u&&f.scaleAndAdd(l,p,u-s,l)),s=G,u=x,z.get_rotation_quat(b.collider,s),f.transformQuat(m.AXIS_Z,s,d),u[0]=d[0],u[1]=0,u[2]=d[2],f.normalize(u,u),B=f.dot(u,p),aa=a/(Math.abs(Math.acos(B))/Math.PI)*b.rot_speed*b.Bm,r.rotationTo(u,p,e),r.rotationTo(m.AXIS_Z,u,s),1<=Math.abs(B)?r.copy(s,e):(r.multiply(e,s,e),r.slerp(s,e,Math.min(aa,1),e)),p=
a,b.type!=M&&(p=Math.max(p,1/60),s=v,u=G,r.setAxisAngle(m.AXIS_X,-Math.asin(d[1]),u),r.setAxisAngle(m.AXIS_X,-Math.atan(b.Ud/(b.speed*p)),s),r.slerp(u,s,p,s),r.multiply(e,s,e)),z.set_rotation_quat_v(n,e),d=k,n=x,m.quat_to_dir(e,m.AXIS_Z,d),f.scale(d,b.speed*a,n),f.add(n,c,n),n[1]=b.type!=C?(l[1]-c[1])*a*.1+c[1]:l[1],z.set_translation_v(b.collider,n);else if(b.type==C)aa.move?X&&-1!=aa.move.indexOf(X)&&h.is_play(u)?b.state=20:(b.state=10,b.we=!0):(b.state=10,b.we=!0);else if(b.type==y||b.type==M)b.we=
!0;if(g(b)&&(c=b.rig,!h.is_play(c))){e=null;switch(b.state){case 10:e=b.actions;e=e.Th?m.random_from_array(e.Th):null;break;case 20:e=h.get_current_action(b.rig),d=l=b.actions,d.Jd&&-1==d.Jd.indexOf(e)&&d.move&&-1!=d.move.indexOf(e)&&.33<Math.random()?(l=b.actions,e=l.Jd[l.move.indexOf(e)]):(d=b.actions,d.move&&(-1!=d.move.indexOf(e)||!d.Jd&&!d.re||!d.re&&!e||d.Jd&&-1!=d.Jd.indexOf(e)||d.re&&-1!=d.re.indexOf(e))?(l=b.actions,l.Jd?(d=l.Jd.indexOf(e),-1!=d?(e=d+1,e=e<l.move.length?e:0,e=l.move[e]):
e=-1!=l.move.indexOf(e)?e:m.random_from_array(l.move)):e=m.random_from_array(l.move)):(d=b.actions,e=d.re&&-1==d.re.indexOf(e)&&d.move&&-1==d.move.indexOf(e)?m.random_from_array(l.re):null))}e&&(h.apply(c,e),h.cyclic(c,!1),h.set_current_frame_float(c,0),h.play(c))}}}function b(a,b,c,d){if(d)if(1==c)switch(d.type){case M:a:{for(c=0;3>c;c++){var e=n.get_sensor_payload(a,b,c);if(e){b=e;break a}}b=void 0}a=100*b;d.Ud=a<d.min_height?10:a>d.max_height?-10:0;break;case C:a=n.get_sensor_payload(a,b,0);d.Ud=
d.Nq==a?0:1-100*a;d.Nq=a;break;case y:a=n.get_sensor_payload(a,b,0),"CLOSE_GROUND"==b?(d.Ud=100*a-1,d.Ud=.1>d.Ud?.05:0):"CLOSE_WATER"==b&&(d.oh=100*a,d.oh=d.oh<d.Ex?-.02:d.oh>d.yx?.02:0)}else d.Ud=0}function e(){for(var a=0;a<u.length;a++){var b=u[a];d(b);l(b);b.rig&&h.get_current_action(b.rig)&&h.play(b.rig)}}function d(a){var c=[0,0,0],d=a.collider;switch(a.type){case M:var e=n.create_ray_sensor(d,c,[0,-100,0],!1,"TERRAIN"),f=n.create_ray_sensor(d,c,[0,-100,0],!1,"STONE"),c=n.create_ray_sensor(d,
c,[0,-100,0],!1,"WATER"),e=[e,f,c];n.create_sensor_manifold(d,"CLOSE_GROUND",n.CT_CONTINUOUS,e,function(a){return a[0]||a[1]||a[2]},b,a);break;case C:e=n.create_ray_sensor(d,[0,1,0],[0,-99,0],!1,"TERRAIN");e=[e];n.create_sensor_manifold(d,"CLOSE_GROUND",n.CT_CONTINUOUS,e,null,b,a);break;case y:e=n.create_ray_sensor(d,[0,1,0],[0,-99,0],!1,"TERRAIN"),c=n.create_ray_sensor(d,[0,0,0],[0,100,0],!1,"WATER"),e=[e],n.create_sensor_manifold(d,"CLOSE_WATER",n.CT_CONTINUOUS,[c],null,b,a),n.create_sensor_manifold(d,
"CLOSE_GROUND",n.CT_CONTINUOUS,e,null,b,a)}}function l(a){function b(c,d,e){1==e?(z.get_translation(a.empty,a.destination),a.Bm=4):a.Bm=1}var c=a.collider;if(a.type==C){var d=n.create_collision_sensor(c,"CONSTRUCTION",!1);n.create_sensor_manifold(c,"CONSTRUCTION_COLL",n.CT_CONTINUOUS,[d],null,b)}}function g(a){var b=a.rig;if(!h.is_play(b))return!0;b=h.get_current_action(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.Th)return!1;if(-1==c.Th.indexOf(b))break;break;case 20:if(!c.move||
-1!=c.move.indexOf(b)||c.re&&-1!=c.re.indexOf(b)||c.Jd&&-1!=c.Jd.indexOf(b))return!1;break;default:return!1}return!0}var f=p("vec3"),r=p("quat"),h=p("animation"),n=p("controls"),m=p("util"),s=p("scenes"),B=p("main"),z=p("transform"),u=[];new Float32Array(9);var q=new Float32Array(3),F=new Float32Array(3),k=new Float32Array(3),x=new Float32Array(3),v=new Float32Array(4),G=new Float32Array(4),A=new Float32Array(4),C=a.NT_WALKING=10,M=a.NT_FLYING=20,y=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=
new Float32Array(3);a.start=[];a.ended=[];a.pj=[];a.Ud=null;a.Nq=null;a.oh=null;a.we=!0;a.Bm=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.pj[b]=!1;u.push(a)};a.enable_animation=function(){if(u.length){e();var a=n.create_elapsed_sensor();n.create_sensor_manifold(u[0].collider,"ELAPSED",n.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,b,d){if(1==d)for(a=n.get_sensor_value(a,b,0),b=0;b<u.length;b++){d=u[b];var e=a;if(s.is_visible(d.obj))if(d.random)c(e,d);else{for(var f=
B.global_timeline(),g=0;g<d.path.length;g++)if(!d.ended[g]){d.pj[g]||(d.pj[g]=!0,d.destination[0]=d.path[g][0],d.destination[1]=d.path[g][1],d.destination[2]=d.path[g][2],d.start[g]=f+d.delay[g]);if(f<d.start[g])break;c(e,d);d.ended[g]=d.we;break}a:{for(e=0;e<d.path.length;e++)if(0==d.ended[e]){e=!1;break a}e=!0}if(e)for(e=0;e<d.path.length;e++)d.pj[e]=!1,d.ended[e]=!1}}})}};a.disable_animation=function(){if(!(0>=u.length))for(var a=0;a<u.length;a++){var b=u[a];n.check_sensor_manifolds(b.collider)&&
n.remove_sensor_manifolds(b.collider);h.is_play(b.rig)&&h.stop(b.rig)}}};b4w.module.mouse=function(a,p){function c(){var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document)}function b(a){a.removeEventListener("mousedown",d,!1);a.removeEventListener("mouseup",l,!1);a.removeEventListener("mousemove",e,!1)}function e(a){G()&&(x[0]+=2*(a.clientX-F),x[1]+=2*(a.clientY-k),F=a.clientX,k=a.clientY);a.preventDefault()}function d(a){F=a.clientX;k=a.clientY;a.currentTarget.addEventListener("mousemove",e,
!1);a.preventDefault()}function l(a){a.currentTarget.removeEventListener("mousemove",e,!1);a.preventDefault()}function g(a,b){if(.01<Math.abs(x[0])||.01<Math.abs(x[1])){var c=m.get_sensor_value(a,b,0),d=u.smooth(x[0],0,c,.1),e=u.smooth(x[1],0,c,.1),c=z.get_first_character(),f=z.get_active_camera();n.rotate(f,4E-4*-d,4E-4*e);x[0]-=d;x[1]-=e;c&&(d=v,n.get_angles(f,d),d[0]+=Math.PI,d[1]*=-1,s.set_character_rotation(c,d[0],d[1]))}}function f(a){(a=z.pick_object(r(a),h(a)))?(z.set_glow_intensity(a,1),
A&&a!=A&&z.set_glow_intensity(A,0)):A&&z.set_glow_intensity(A,0);A=a}function r(a){return a.clientX||a.touches&&a.touches[0].pageX||-1}function h(a){return a.clientY||a.touches&&a.touches[0].pageY||-1}var n=p("camera"),m=p("controls"),s=p("physics"),B=p("print"),z=p("scenes"),u=p("util"),q=p("main"),F=0,k=0,x=new Float32Array(2),v=new Float32Array(2),G=null,A=null;a.request_pointerlock=function(a,c,d,e,f){function h(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===
a){b(a);a.addEventListener("mousemove",e,!1);var f=z.get_active_camera();if(!m.check_sensor_manifold(f,"SMOOTH_PL")){var k=m.create_elapsed_sensor();m.create_sensor_manifold(f,"SMOOTH_PL",m.CT_CONTINUOUS,[k],null,g)}c()}else a.removeEventListener("mousemove",e,!1),document.removeEventListener("pointerlockchange",h,!1),document.removeEventListener("webkitpointerlockchange",h,!1),document.removeEventListener("mozpointerlockchange",h,!1),d()}c=c||function(){};d=d||function(){};f=f||function(){return!0};
e=e||function(a){if(f()){var b=a.movementY||a.webkitMovementY||a.mozMovementY||0;x[0]+=a.movementX||a.webkitMovementX||a.mozMovementX||0;x[1]+=b}};document.addEventListener("pointerlockchange",h,!1);document.addEventListener("webkitpointerlockchange",h,!1);document.addEventListener("mozpointerlockchange",h,!1);var k=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof k?k.apply(a):B.error("Pointer lock is not available")};a.exit_pointerlock=c;a.check_pointerlock=
function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,b){c();G=b||function(){return!0};a.addEventListener("mousedown",d,!1);a.addEventListener("mouseup",l,!1);var e=z.get_active_camera();if(!m.check_sensor_manifold(e,"SMOOTH_DRAG")){var f=m.create_elapsed_sensor();m.create_sensor_manifold(e,"SMOOTH_DRAG",m.CT_CONTINUOUS,[f],null,g)}};a.exit_mouse_drag=b;a.enable_mouse_hover_glow=function(){q.detect_mobile()||
q.get_canvas_elem().addEventListener("mousemove",f)};a.disable_mouse_hover_glow=function(){q.detect_mobile()||(q.get_canvas_elem().removeEventListener("mousemove",f),A&&z.set_glow_intensity(A,0))};a.get_coords_x=r;a.get_coords_y=h};b4w.module.preloader=function(a,p){var c=p("app"),b,e,d,l,g,f,r,h,n,m=null;a.create_simple_preloader=function(a){var c=null,h=null,n="#bf9221",p="#000",r;for(r in a)switch(r){case "canvas_container_id":c=a.canvas_container_id;break;case "background_container_id":h=a.background_container_id;break;case "bg_color":p=a.bg_color;break;case "bar_color":n=a.bar_color;break;case "preloader_fadeout":b=a.preloader_fadeout}a=document.createElement("div");r=document.createElement("div");a.id="simple_preloader_container";
var k=document.createElement("div"),x=document.createElement("div"),h=document.getElementById(h);m=document.getElementById(c);a.style.cssText="         z-index: 4;        background-color: "+p+";        width: 100%;        height: 100%;        position: absolute;        margin: 0;        padding: 0;        top: 0;        left: 0;    ";r.style.cssText="         position: absolute;        left: 50%;        top: 82%;        width: 300px;        height: 20px;        margin-left: -150px;        margin-top: -10px;        border-style:solid;        border-width:4px;        border-color: #000;        border-radius: 0px;    ";
k.style.cssText="         position: absolute;        left: 0px;        top: 1px;        width: 0px;        height: 18px;        background-color: "+n+";        border-radius: 0px;    ";x.style.cssText="         position: absolute;        left: 50%;        top: 50%;        width: 100%;        height: 100%;        margin-left: -150px;        margin-top: -10px;        text-align: center;        font-size: 17px;        font-weight: bold;        color: #000;        font-family: Verdana;    ";r.appendChild(k);
r.appendChild(x);a.appendChild(r);document.body.appendChild(a);e="SIMPLE";d=a;l=k;g=x;f=h};a.create_rotation_preloader=function(a){var b=null,c=null,h="rgba(0,0,0,0)",l="",n="",k="rgba(0,0,0,0)",p;for(p in a)switch(p){case "canvas_container_id":b=a.canvas_container_id;break;case "background_container_id":c=a.background_container_id;break;case "frame_bg_color":h=a.frame_bg_color;break;case "bg_color":k=a.bg_color;break;case "frame_class":l=a.frame_class;break;case "anim_elem_class":n=a.anim_elem_class}a=
document.createElement("div");p=document.createElement("div");var v=document.createElement("div"),G=document.createElement("div"),c=document.getElementById(c);m=document.getElementById(b);a.style.cssText="         z-index: 4;        background-color: "+k+";        width: 100%;        height: 100%;        position: absolute;        margin: 0;        padding: 0;        top: 0;        left: 0;    ";p.style.cssText="         position: absolute;        left: 50%;        top: 50%;        width: 117px;        height: 117px;        margin-left: -58px;        margin-top: -58px;        background-color: "+
h+";    ";v.style.cssText="         position: absolute;        left: 0px;        top: 0px;        width: 100%;        height: 100%;        background-position: center;        background-repeat: no-repeat;    ";G.style.cssText="         position: absolute;        width: 100%;        height: 100%;        text-align: center;        margin-top: 38px;        font-size: 36px;        color: #ffffff;        font-family: Arial;        font-weight: bold;    ";v.className=n;p.appendChild(v);p.className=l;p.appendChild(G);
a.appendChild(p);m.appendChild(a);e="ROTATION";d=a;r=v;g=G;f=c};a.create_advanced_preloader=function(a){var b=a.preloader_width,b=b/(b-a.img_width),c=document.getElementById(a.preloader_bar_id),p=document.getElementById(a.fill_band_id),q=document.getElementById(a.preloader_caption_id),r=document.getElementById(a.preloader_container_id),k=document.getElementById(a.background_container_id);m=document.getElementById(a.canvas_container_id);e="ADVANCED";l=c;h=p;n=b;g=q;d=r;f=k};a.update_preloader=function(a){g.innerHTML=
a+"%";"SIMPLE"==e&&(l.style.width=a+"%");"ADVANCED"==e&&(l.style.width=a/n+"%",h.style.width=100-a+"%");"ROTATION"==e&&(r.style.transform="rotate("+a+"deg)");100==a&&(b?(c.css_animate(f,"opacity",1,0,1500,null,function(){f.style.display="none"}),c.css_animate(d,"opacity",1,0,1E3,null,function(){d.style.display="none"})):(d.style.display="none",m.style.zIndex=1,f&&(f.style.display="none")))}};b4w.module.storage=function(a,p){function c(a){d=a;try{l=window.localStorage}catch(b){e.warn("Applying chrome localStorage bug workaround"),l=null}l||(e.warn("localStorage is not available, initializing temporary storage"),l={})}function b(){return l[d]?JSON.parse(l[d]):{}}var e=p("__print"),d="",l=null;a.init=c;a.set=function(a,c){var e=b();e[a]=String(c);l[d]=JSON.stringify(e)};a.cleanup=function(){delete l[d]};a.get=function(a){var c=b();return c[a]?c[a]:""};a.debug=function(){e.log(b())};c("b4w")};b4w.module.screenshooter=function(a,p){var c=p("main");a.shot=function(){c.canvas_data_url(function(a){var c=window.document.createElement("a");document.body.appendChild(c);c.style="display: none";c.href=a;c.download="screenshot.png";c.click();document.body.removeChild(c)})}};
