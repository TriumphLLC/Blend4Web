
节点材质
********


目录
^^^^

* 节点材质

  * 标准节点

  * 游戏引擎特定节点

    * 钳制（B4W_CLAMP）

    * 夜光输出（B4W_GLOW_OUTPUT）

    * 质量层级（B4W_LEVELS_OF_QUALITY）

    * 视差（B4W_PARALLAX）

    * 反射 (B4W_REFLECT)

    * 折射（B4W_REFRACTION）

    * 替换（B4W_REPLACE）

    * 平滑步进（B4W_SMOOTHSTEP）

    * 时间（B4W_TIME）

    * 半透明（B4W_TRANSLUCENCY）

    * 矢量视图（B4W_VECTOR_VIEW）

    * 线性到 SRGB和SRGB线性（已取消）

  * Cycles 节点

  * Limitations

着色器节点通过将现有的着色器进行基本变换和批处理，显著地扩展了Blender
的标准材质的潜力。

[图片]


标准节点
========

Blend4Web支持所有标准的Blender节点，但他们中的一些工作的不够快，因此不
建议在实时应用程序中使用。创建非常复杂的材质，尤其是使用大量的
"Geometry" 和 "Texture" 节点，也不推荐。

引擎能部分支持某些Cycles节点。本内容的更详尽描述在  相应章节.

[1] 这个节点的法线贴图使用的 "Color Space" 参数需要设置为 "Non-
    Color". 如果没设置会引起各种不可预见的效果（尽管不会将引起弄崩溃）

[2] 如果至少一个内部参数 "Space to convert from..." 或 "Space to
    convert to..." 设置为 "Object", 那么所有使用这个材质的物体都会被考
    虑为  动态.



Please keep in mind that node materials have certain limitations
concerning the number of specific nodes in the material. These
limitations are described here.


游戏引擎特定节点
================

引擎特定的节点扩展标准节点以支持额外的功能。这些节点采用特殊命名的名称
和输入格式创建为节点组（"节点组" 或 "节点树"）。为方便起见，被打开时，
所有的特殊节点已经添加到Blend文件。

[图片]


钳制（B4W_CLAMP）
-----------------

节点限制输出值。其结果是所有的输出矢量分量取从0到1中间的值。

[图片]


输入参数
~~~~~~~~

*图像*
   关联向量


输出参数
~~~~~~~~

*图像*
   钳制向量


夜光输出（B4W_GLOW_OUTPUT）
---------------------------

应用  发光效果 到节点材质。除了 *B4W_GLOW_OUTPUT* 节点，该节点材质应具
有 *输出* 节点。

[图片]


输入参数
~~~~~~~~

*发光颜色*
   发光颜色

*系数*
   发光的比例。 *系数*  \in [0, 1].

   * *系数 = 0*  - 没有发光。

   * *Factor* \in (0, 1] - 有一个发光，与 *发光颜色* 同色。


质量层级（B4W_LEVELS_OF_QUALITY）
---------------------------------

设置根据当前的图像质量设置输出颜色。可用于，例如，与如果应用程序在移动
装置上运行用更简单材质的更换复杂材质。

[图片]

参见: 品质配置


输入参数
~~~~~~~~

*高质量*
   节点链接这个参数到 "Color" 参数高，最高的质量使用的情况。

*低*
   节点链接这个参数到 "Color" 参数低质量的使用情况。

*系数*
   此值指定什么质量设置（"HIGH" 或 "LOW"）将在Blender视口中可见。可以
   从0变化到1，如果该值低于0.5时，"HIGH" 设置将是可见的，如果它是0.5或
   更高时，"LOW" 设置将是可见的。


视差（B4W_PARALLAX）
--------------------

该节点使用高度贴图实现纹理坐标偏移。

[图片]


输入参数
~~~~~~~~

*UV*
   源纹理坐标。

*高度贴图*
   RGBA纹理压缩到alpha通道的高度图。

*缩放*
   纹理坐标偏移的因子。

*步进*
   迭代产生纹理的步数坐标偏移。这个值越大最后的质量越好。

*LOD距离*
   从相距距离最远开始，效果能被观察到。


输出参数
~~~~~~~~

*UV*
   结果是纹理坐标用着输入纹理节点。


反射 (B4W_REFLECT)
------------------

计算入射矢量和法线矢量之间的反射方向。可用方块贴图应用到物体。

[图片]


输入参数
~~~~~~~~

*矢量*
   入射向量。应连接至 "Geometry" 节点的 "View" 插座。

*矢量*
   法向量。需要进行归一化以达到所期望的结果。应连接至 "Geometry" 节点
   的 "Normal" 插座。


输出参数
~~~~~~~~

*矢量*
   反射向量。应该连接到包含立方贴图的 "Texture" 节点的 "Vector" 插座。


折射（B4W_REFRACTION）
----------------------

一个物体产生折射效果。这种效果仅在Blend4Web引擎，而不是在Blender的视口
。

[图片]


输入参数
~~~~~~~~

*法线*
   添加扰动法线贴图。

*折射凹凸*
   扰动强度值。

   默认值是0


输出参数
~~~~~~~~

*Color*
   对物体后面的材质产生扰动。

注解: 需要在 "Render > Reflections and Refractions" 面板设置
  "Refractions" 选项值为 "AUTO" 或 "ON" 。物体的透明度类型必须设置为
  "Alpha Blend".

参见: 透明


替换（B4W_REPLACE）
-------------------

节点替换取决于工作环境（即Blender视口或Blend4Web）的输入。在Blender工
作时，"Color1" 输入被连接到 "Color" 输出和 "Color2" 输入被忽略。相反在
引擎中输入被替换时（这时 "Color1" 被忽略，"Color2" 被连接到输出）。节
点意欲在视口中显示的一个节点的结构和其他 - 在引擎中。

[图片]

作为一项规则是用于法线贴图。 Blender的节点材质不支持坐标的切线空间。因
此，唯一可能的在视口中来显示法线贴图正确的方法是在 "Material" 节点内的
使用。


输入参数
~~~~~~~~

*Color1*
   节点的设置，这将是在Blender视口中可见。

*Color2*
   节点设置，就可以在Blend4Web引擎可见。


输出参数
~~~~~~~~

*Color*
   应连接到 "Material" 或 "扩展Material" 节点的 "Color" 插座。


平滑步进（B4W_SMOOTHSTEP）
--------------------------

进行基于第一值的两个输入值之间的平滑内插。

[图片]


输入参数
~~~~~~~~

*值*
   决定插值的平滑度的值。

*Edge0*
   首个插值。

*Edge1*
   第二插值。


输出参数
~~~~~~~~

*值*
   插值。

注解: 对于正确的插值，输入 "Value" 必须在 "Edge0" 和 "Edge1" 之间。


时间（B4W_TIME）
----------------

提供时间表，从引擎起动计数（以秒计）。可用于在节点的材质，如UV坐标动画
任何参数，混合的因子，透明度等。

[图片]


输入参数
~~~~~~~~

无


输出参数
~~~~~~~~

*值*
   从引擎起动开始经过的时间（秒）。

参见: 值和 RGB 节点的动画


半透明（B4W_TRANSLUCENCY）
--------------------------

节点实现了一个半透明效果（只对于光源）的薄的物体，如布，树叶，纸张等的
效果，由两部分组成：1）物体侧的增亮这是相对的光源和2）光点就在光源处的
外观。

[图片]


输入参数
~~~~~~~~

*Color*
   它定义了材质异质性单通道纹理 - 白色表示最大的半透明效果，而黑色代表
   不存在。白色默认情况下使用。

*背面因子*
   为这是相对的光源侧的材质颜色校正系数。它描述了半透明区域的颜色丰富
   性的效果。

   * *背面系数<1*  - 增亮

   * *背面系数= 1*  - 无修正

   * *背面系数> 1*  - 变黑

   默认值是0

*光点硬度*
   光点模糊的系数。这个值越大就越小，当场和更清晰的现货边缘。缺省值为
   1000。

*斑点强度*
   光斑强度。这个值越亮越大，光点。默认值是1。

*光斑漫射系数*
   光斑的颜色材质漫反射颜色影响。

   * *光斑漫射系数 = 0*  - 光斑有漫反射颜色

   * *光斑漫射系数 = 1*  - 光斑颜色为白色

   默认值是0


输出参数
~~~~~~~~

*半透明*
   输出应被连接到 "扩展Material" 节点的 "Translucency" 输入。

注解: 如果  网格法线被编辑了 ，这个节点不会正常工作。


矢量视图（B4W_VECTOR_VIEW）
---------------------------

该节点将一个向量坐标转换到相机的空间。转换是必要的，因为引擎定义矢量坐
标系在世界空间。如果正常矢量是由该节点转变它应该只对影响，不用于连接到
"Material" 或 "扩展Material" 节点的输出。

[图片]


输入参数
~~~~~~~~

*矢量*
   向量的坐标在世界空间。


输出参数
~~~~~~~~

*矢量*
   矢量坐标在摄像机空间。


线性到 SRGB和SRGB线性（已取消）
-------------------------------

从sRGB到线性空间转换颜色反之亦然。 从版本15.04这个功能已经被宣布弃用。
在较新的版本，具有2.200的数值内置 "Gamma" 节点应使用将颜色从sRGB转换为
线性空间，并用0.455的值相同的节点将颜色从线性空间转换为sRGB。

[图片]

参见: 伽马在节点材质中


Cycles 节点
===========

注解: Cycles节点的支持是不建议在生产中使用环境的实验性功能。此外应指
  出的是 ，在 Blend4Web 中使用Cycles节点会产生相似的图像，但不是完全跟
  使用 Cycles渲染器本身创建的图像一样。

引擎支持以下 "Cycles" 节点︰

* "材质输出" (只支持 "Surface" 和  "Displacement" 输入）;

* "BSDF Diffuse";

* "BSDF Glossy" (只支持 "GGX" 分布;  "Roughness" 参数不影响反射);

* "透明BSDF";

* "Mix Shader";

* "Fresnel";

* "Layer Weight";

* "Image Texture";

* "Environment Texture";

* "Object Info";

* "Bump".

部分支持以下节点︰

* "Texture Coordinates" ("From Dupli" 参数不支持);

* "UV Map" ("From Dupli" 参数不支持);

* "Geometry" (  "Pointness" 和 "Parametric" 参数不支持).

* "Emission" (不会影响场景中的打灯效果).

"Cycles" nodes are also supported for "World" object. However, at the
moment node material does not affect the colors of the environment.

其他 "Cycles" 节点在大多数情况下在不会在Blend4Web中跟他们在Blender中一
样良好工作。他们不会工作也可能引起材质的不正常显示和工作。但是，使用这
些节点不会在应用程序工作流中导致不稳定。


Limitations
===========

Node materials can be complex, but their complexity is limited by the
capabilities of the hardware you use. It might not be noticeable most
of the time, but if you are making a very complex material, you might
exceed the number of textures and varying vectors (vectors that are
used by a vertex shader to hand over data to a fragment shader) that
your system allows to use in one shader. And even if you won't, some
users of your application might not have devices as powerful as yours,
so they can experience problems where you will not.

If you want to know how your scene would behave on a low-end device
but don't have one in your possession, there is also a very useful
option called "Min Capabilities Mode". It is native to Scene Viewer
and can be found on the Tools & Debug panel.

The number of textures and varying vectors supported by your device
can be viewed on the WebGL Report web page accessible from the SDK
Index page.

The two following tables list various material nodes along with the
numbers of textures and varying vectors the engine allocates to them.

**Varying Vectors**

+------------------------------------------------------+----------------------------------------------------------+
| **Node/Effect**                                      | **Allocated Varying Vectors**                            |
+------------------------------------------------------+----------------------------------------------------------+
| Always reserved                                      | 3                                                        |
+------------------------------------------------------+----------------------------------------------------------+
| "Input -> Texture" node (if the "Normal" output is   | 1                                                        |
| used)                                                |                                                          |
+------------------------------------------------------+----------------------------------------------------------+
| "Blend4Web -> Parallax" node                         | 1                                                        |
+------------------------------------------------------+----------------------------------------------------------+
| "Vector -> Normal Map" node                          | 1                                                        |
+------------------------------------------------------+----------------------------------------------------------+
| "Input -> Material" node (if the "Shading -> Tangent | 1                                                        |
| Shading" option is enabled on that material)         |                                                          |
+------------------------------------------------------+----------------------------------------------------------+
| "Input -> Geometry" node (if the "UV" output is      | 1                                                        |
| used)                                                |                                                          |
+------------------------------------------------------+----------------------------------------------------------+
| "Input -> UV Map" cycles node                        | 1                                                        |
+------------------------------------------------------+----------------------------------------------------------+
| "Input -> Texture Coordinate" cycles node (if the    | 1                                                        |
| "UV" output is used)                                 |                                                          |
+------------------------------------------------------+----------------------------------------------------------+
| "Input -> Geometry" node (if the "Vertex Color"      | 1                                                        |
| output is used)                                      |                                                          |
+------------------------------------------------------+----------------------------------------------------------+
| Shadows on an object with the "Alpha Blend" material | 1 - 4  (depending on the number of shadow cascades or    |
|                                                      | shadow casters)                                          |
+------------------------------------------------------+----------------------------------------------------------+
| Shadows on an object with the``Opaque`` material     | 1                                                        |
| Refraction effect on a material  Plane Reflections   |                                                          |
| enabled on an object                                 |                                                          |
+------------------------------------------------------+----------------------------------------------------------+
| Refraction effect on a material                      | 2                                                        |
+------------------------------------------------------+----------------------------------------------------------+

**Textures**

+------------------------------------------------------+----------------------------------------------------------+
| **Node/Effect**                                      | **Allocated Textures**                                   |
+------------------------------------------------------+----------------------------------------------------------+
| "Blend4Web -> Parallax" node                         | 1                                                        |
+------------------------------------------------------+----------------------------------------------------------+
| "Input -> Texture" node                              | 1                                                        |
+------------------------------------------------------+----------------------------------------------------------+
| "Texture -> Environment Texture" cycles node         | 1                                                        |
+------------------------------------------------------+----------------------------------------------------------+
| "Vector -> Vector Curves" node  "Color -> RGB        | 1  (the number of the nodes in the material doesn't      |
| Curves" node  "Converter -> Color Ramp" node         | matter)                                                  |
+------------------------------------------------------+----------------------------------------------------------+
| Shadows on an object with the "Alpha Blend" material | 1 - 4  (depending on the number of shadow casters and/or |
|                                                      | shadow cascades)                                         |
+------------------------------------------------------+----------------------------------------------------------+
| Shadows on an object with an "Opaque" material       | 1                                                        |
+------------------------------------------------------+----------------------------------------------------------+
| Refraction effect on a material                      | 2                                                        |
+------------------------------------------------------+----------------------------------------------------------+
| "World -> Environment Lighting -> SkyTexture" is     | 1                                                        |
| enabled for a World                                  |                                                          |
+------------------------------------------------------+----------------------------------------------------------+
| Reflection effect on an object                       | 1                                                        |
+------------------------------------------------------+----------------------------------------------------------+
