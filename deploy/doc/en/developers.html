<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>For Application Developers &mdash; User Manual: Blend4Web vv15.07</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.4/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.4/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'v15.07',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="User Manual: Blend4Web vv15.07" href="index.html" />
    <link rel="next" title="For Engine Developers" href="developers_advanced.html" />
    <link rel="prev" title="Non-Linear Animation" href="nla.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Blend4Web. User Manual</a>
        <span class="navbar-text navbar-version pull-left"><b>v15.07</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_steps.html">Quick Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Installing the SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="viewer.html">Scene Viewer</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_player.html">Web Player</a></li>
<li class="toctree-l1"><a class="reference internal" href="addon.html">The Add-on</a></li>
<li class="toctree-l1"><a class="reference internal" href="objects.html">Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="camera.html">Camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="materials.html">Materials</a></li>
<li class="toctree-l1"><a class="reference internal" href="textures.html">Textures</a></li>
<li class="toctree-l1"><a class="reference internal" href="node_materials.html">Node Materials</a></li>
<li class="toctree-l1"><a class="reference internal" href="lighting.html">Lighting, Shadows and Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="postprocessing_effects.html">Postprocessing Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="particles.html">Particle System. Fluids</a></li>
<li class="toctree-l1"><a class="reference internal" href="particles_instancing.html">Particle System. Instancing</a></li>
<li class="toctree-l1"><a class="reference internal" href="animation.html">Animation</a></li>
<li class="toctree-l1"><a class="reference internal" href="outdoor_rendering.html">Outdoor Rendering</a></li>
<li class="toctree-l1"><a class="reference internal" href="gamma_alpha.html">Gamma and Alpha</a></li>
<li class="toctree-l1"><a class="reference internal" href="audio.html">Audio System</a></li>
<li class="toctree-l1"><a class="reference internal" href="physics.html">Physics</a></li>
<li class="toctree-l1"><a class="reference internal" href="nla.html">Non-Linear Animation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">For Application Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers_advanced.html">For Engine Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_short_manual.html">Team Work. Using Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="problems_and_solutions.html">Problems and Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">For Application Developers</a><ul>
<li><a class="reference internal" href="#hello-world">Hello World!</a></li>
<li><a class="reference internal" href="#id2">Loading a Scene into an App</a></li>
<li><a class="reference internal" href="#id3">Creating Apps Quickly</a></li>
<li><a class="reference internal" href="#sdk">Developing Apps Within the SDK</a></li>
<li><a class="reference internal" href="#canvas-nonfullscreen-coords">Non-FullScreen Web Apps</a></li>
<li><a class="reference internal" href="#code-snippets">Code Examples</a></li>
<li><a class="reference internal" href="#converter">Resource Conversion</a></li>
<li><a class="reference internal" href="#id7">Module System</a></li>
<li><a class="reference internal" href="#event-model">Event-Driven Model</a><ul>
<li><a class="reference internal" href="#index-0">Sensors</a></li>
<li><a class="reference internal" href="#id10">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#quality-settings">Quality Profiles</a></li>
<li><a class="reference internal" href="#repo-file-structure">SDK File Structure</a></li>
<li><a class="reference internal" href="#canvas">Canvas Textures</a></li>
<li><a class="reference internal" href="#blender-blend4web">Differences between Blrnder&#8217;s and Blend4Web&#8217;s coordinates</a></li>
<li><a class="reference internal" href="#browser-for-local-loading">Setting up the Browser for Loading Local Resources</a></li>
<li><a class="reference internal" href="#local-web-server">Running a Local Server</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="nla.html" title="Previous Chapter: Non-Linear Animation"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Non-Linear Anima...</span>
    </a>
  </li>
  <li>
    <a href="developers_advanced.html" title="Next Chapter: For Engine Developers"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">For Engine Devel... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control"/>
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container content_container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="developers">
<span id="id1"></span><h1>For Application Developers<a class="headerlink" href="#developers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="hello-world">
<h2>Hello World!<a class="headerlink" href="#hello-world" title="Permalink to this headline">¶</a></h2>
<p>The simplest Blend4Web app may look like this:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;b4w.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="kd">function</span> <span class="nx">hello</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">m_version</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;Hello, Blend4Web &quot;</span> <span class="o">+</span> <span class="nx">m_version</span><span class="p">.</span><span class="nx">version</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;!&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">&quot;hello()&quot;</span><span class="nt">&gt;&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>This app prints a message and the engine&#8217;s version in the browser window. Let&#8217;s look at this example in detail. The engine library (without add-ons) is embedded with the <code class="docutils literal"><span class="pre">&lt;script</span> <span class="pre">src=&quot;...&quot;&gt;</span></code> element. Then, the app waits for the page to load and prints the current version in the browser window. In this example, <code class="docutils literal"><span class="pre">version</span></code> is the only used module which has a function with the same name - <code class="docutils literal"><span class="pre">version()</span></code>. A more detailed info about the usage of engine&#8217;s modules and functions can be found in the <a class="reference external" href="https://www.blend4web.com/api_doc/index.html">API documentation</a>.</p>
<p>The compiled engine file <code class="docutils literal"><span class="pre">b4w.min.js</span></code> can be copied from the SDK&#8217;s <code class="docutils literal"><span class="pre">deploy/apps/common</span></code> directory and placed in the same directory as the HTML file.</p>
</div>
<div class="section" id="id2">
<h2>Loading a Scene into an App<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>To load a 3D scene you need:</p>
<ol class="arabic simple">
<li><p class="first">Place a <code class="docutils literal"><span class="pre">&lt;canvas&gt;</span></code> element on a page for rendering.</p>
</li>
<li><p class="first">Call the <code class="docutils literal"><span class="pre">m_main.init()</span></code> function with the created element id to init the WebGL context after the page is loaded.</p>
</li>
<li><p class="first">Call the <code class="docutils literal"><span class="pre">m_data.load()</span></code> function to load a 3D scene.</p>
</li>
</ol>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;b4w.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="kd">function</span> <span class="nx">hello</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">m_main</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">m_data</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">canvas_elem</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;canvas_id&quot;</span><span class="p">);</span>
    <span class="nx">m_main</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">canvas_elem</span><span class="p">);</span>
    <span class="nx">m_data</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s2">&quot;some_scene.json&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">&quot;hello()&quot;</span><span class="nt">&gt;&lt;canvas</span> <span class="na">id=</span><span class="s">&quot;canvas_id&quot;</span><span class="nt">&gt;&lt;/canvas&gt;&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Note that a real app should include error checking, setting up the engine before initializing and also a basic system for interacting with the user.</p>
</div>
<div class="section" id="id3">
<h2>Creating Apps Quickly<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Creating an app from scratch can be a tedious task, especially for beginners. To address this there is a special add-on for the engine called <code class="docutils literal"><span class="pre">app</span></code>:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;b4w.full.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>

<span class="kd">var</span> <span class="nx">m_app</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">m_data</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">);</span>

<span class="nx">m_app</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
    <span class="nx">canvas_container_id</span><span class="o">:</span> <span class="s2">&quot;container_id&quot;</span><span class="p">,</span>
    <span class="nx">callback</span><span class="o">:</span> <span class="nx">load_cb</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">load_cb</span><span class="p">()</span>
    <span class="nx">m_data</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s2">&quot;some_scene.json&quot;</span><span class="p">,</span> <span class="nx">loaded_cb</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">loaded_cb</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m_app</span><span class="p">.</span><span class="nx">enable_controls</span><span class="p">();</span>
    <span class="nx">m_app</span><span class="p">.</span><span class="nx">enable_camera_controls</span><span class="p">();</span>
<span class="p">}</span>

<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;container_id&quot;</span> <span class="na">style=</span><span class="s">&quot;width: 350px; height: 200px;&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>In this case the <code class="docutils literal"><span class="pre">app</span></code> module will create a <code class="docutils literal"><span class="pre">&lt;canvas&gt;</span></code> element inside the container with the specified <code class="docutils literal"><span class="pre">container_id</span></code> id. Then it will initialize the engine after the page is loaded and will finally execute the <code class="docutils literal"><span class="pre">load_cb</span></code> callback.</p>
<p>Then the some_scene.json scene is loaded similar to the previous example. The only difference is that after the scene is loaded, the control system is initialized and camera movement with keyboard and mouse (or sensor screen) becomes possible.</p>
<p>In case when the <code class="docutils literal"><span class="pre">app</span></code> module is used, it is necessary to specify dimensions of the container element. Otherwise the created <code class="docutils literal"><span class="pre">&lt;canvas&gt;</span></code> element will have zero dimensions.</p>
</div>
<div class="section" id="sdk">
<span id="app-building"></span><span id="sdk-dev"></span><h2>Developing Apps Within the SDK<a class="headerlink" href="#sdk" title="Permalink to this headline">¶</a></h2>
<p>The SDK includes a script <code class="docutils literal"><span class="pre">apps_dev/project.py</span></code> for building applications.</p>
<p>Example:</p>
<div class="highlight-bash"><div class="highlight"><pre>./project.py -p my_project_path -o advanced -b copy -v 15.02 -s my_resources_path
</pre></div>
</div>
<ul class="simple">
<li><p class="first">Option <code class="docutils literal"><span class="pre">&quot;-p&quot;</span></code> points at the name of the directory where the project is.</p>
</li>
<li><p class="first">Option <code class="docutils literal"><span class="pre">&quot;-a&quot;</span></code> (not necessary) points at the html file relative to which the app will be constructed.</p>
</li>
<li><p class="first">Option <code class="docutils literal"><span class="pre">&quot;-o&quot;</span></code> (not necessary) is used to select the method ofjs files optimisation. Avaliable methods: <code class="docutils literal"><span class="pre">whitespace</span></code>, <code class="docutils literal"><span class="pre">simple</span></code> (by default) and <code class="docutils literal"><span class="pre">advanced</span></code>.</p>
</li>
<li><p class="first">With the <code class="docutils literal"><span class="pre">&quot;-b&quot;</span></code> parameter (optional) the engine&#8217;s directory can be specified. Available options: <strong>link</strong> (default) - the engine file is linked from <code class="docutils literal"><span class="pre">deploy/apps/common/</span></code>, <strong>copy</strong> - the engine file is copied into the directory with the built app, <strong>combine</strong> - the engine file is merged with the minified script located in the app&#8217;s root, <strong>compile</strong> - required engine modules are compiled together with the app code.</p>
</li>
<li><p class="first">With the <code class="docutils literal"><span class="pre">&quot;-d&quot;</span></code> parameter (optional) the directory for the compiled app can be specified.</p>
</li>
<li><p class="first">With the <code class="docutils literal"><span class="pre">&quot;-s&quot;</span></code> parameter (optional) the directory can be specified where the scene resources are located.</p>
</li>
<li><p class="first">Option <code class="docutils literal"><span class="pre">&quot;-e&quot;</span></code> (not necessary) points at the directory inwhich the resources will be stored (relatively to the app&#8217;s root).</p>
</li>
<li><p class="first">The <code class="docutils literal"><span class="pre">&quot;-v&quot;</span></code> parameter (optional) adds version statement to the urls of scripts and styles. This will force the browser to use updated scripts and styles instead of loading them from the browser cache.</p>
</li>
<li><p class="first">The <code class="docutils literal"><span class="pre">&quot;-j&quot;</span></code> parameter (optional) specifies JavaScript files to be excluded from compilation.</p>
</li>
<li><p class="first">The <code class="docutils literal"><span class="pre">&quot;-c&quot;</span></code> parameter (optional) specifies CSS styles to be excluded from compilation.</p>
</li>
</ul>
<p>App structure:</p>
<ul class="simple">
<li><p class="first">In the root of the directory the single html file must be stored if <code class="docutils literal"><span class="pre">-a</span></code> option is disabled</p>
</li>
<li><p class="first">Scripts and styles can be stored in the app&#8217;s root and in the subfolders</p>
</li>
</ul>
<p>How the app builder works:</p>
<ul class="simple">
<li><p class="first">The project is being copied in the <em>deploy/apps/project_name/</em> directory.</p>
</li>
<li><p class="first">If <code class="docutils literal"><span class="pre">-d</span></code> option is enabled, the project is being copied in thecorresponding directory.</p>
</li>
<li><p class="first">Scripts and styles are compiled relative to the parent directory.</p>
</li>
</ul>
</div>
<div class="section" id="canvas-nonfullscreen-coords">
<span id="id4"></span><h2>Non-FullScreen Web Apps<a class="headerlink" href="#canvas-nonfullscreen-coords" title="Permalink to this headline">¶</a></h2>
<p>The Canvas element, to which the rendering is performed, can change its position relative to the browser window. This can occur due to some manipulations over the DOM tree, or as a result of page scrolling which is especially relevant for non-fullscreen web applications.</p>
<p>In most cases this will not affect the performance of the app by any means. However, some DOM events related to mouse cursor or touch position may carry incorrect information. This occurs because the coordinates obtained from the corresponding events are measured relative to the origin of the browser window, while the engine works with the coordinate space of the Canvas element itself (its origin is located in the top left corner).</p>
<p>In order to obtain coordinates suitable for use in the engine, you can transform them by using the <code class="docutils literal"><span class="pre">client_to_canvas_coords</span></code> method of the <code class="docutils literal"><span class="pre">container</span></code> module:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">m_cont</span>   <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">_vec2_tmp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="c1">// . . .</span>
<span class="kd">var</span> <span class="nx">canvas_xy</span> <span class="o">=</span> <span class="nx">m_cont</span><span class="p">.</span><span class="nx">client_to_canvas_coords</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span> <span class="nx">_vec2_tmp</span><span class="p">);</span>
<span class="c1">// . . .</span>
</pre></div>
</div>
<p>In order to obtain coordinates in the Canvas space, the engine should know its position relative to the browser window. However, if this position is subjected to changes during the work of the app (due to scrolling for example), the Canvas position should be recalculated. To do this automatically, you can set the <code class="docutils literal"><span class="pre">track_container_position</span></code> property upon app initialization:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">exports</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m_app</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
        <span class="c1">// . . .</span>
        <span class="nx">track_container_position</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="c1">// . . .</span>
    <span class="p">});</span>
    <span class="c1">// . . .</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Please note, that this setting can lead to performance degradation in some browsers (such as Firefox) due to frequent DOM tree accesses. If the performance is critical, you can update the Canvas position manually when it is really necessary. To do this, use the <code class="docutils literal"><span class="pre">force_offsets_updating</span></code> and <code class="docutils literal"><span class="pre">update_canvas_offsets</span></code> methods instead of the <code class="docutils literal"><span class="pre">track_container_position</span></code> setting, or even the lower-level <code class="docutils literal"><span class="pre">set_canvas_offsets</span></code> method from the <code class="docutils literal"><span class="pre">container</span></code> module:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">m_cont</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">);</span>
<span class="c1">// . . .</span>
<span class="nx">m_cont</span><span class="p">.</span><span class="nx">force_offsets_updating</span><span class="p">();</span>
<span class="c1">// . . .</span>
<span class="nx">m_cont</span><span class="p">.</span><span class="nx">update_canvas_offsets</span><span class="p">();</span>
<span class="c1">// . . .</span>
<span class="nx">m_cont</span><span class="p">.</span><span class="nx">set_canvas_offsets</span><span class="p">(</span><span class="nx">offset_left</span><span class="p">,</span> <span class="nx">offset_top</span><span class="p">);</span>
<span class="c1">// . . .</span>
</pre></div>
</div>
</div>
<div class="section" id="code-snippets">
<span id="id5"></span><h2>Code Examples<a class="headerlink" href="#code-snippets" title="Permalink to this headline">¶</a></h2>
<p>The SDK includes the Code Snippets application which demonstrates how to use the engine&#8217;s functionality.</p>
<dl class="docutils">
<dt>Currently, this application contains the following examples:</dt>
<dd><ul class="first last simple">
<li><p class="first">Canvas Texture - working with canvas textures</p>
</li>
<li><p class="first">Camera Animation - procedural camera animation</p>
</li>
<li><p class="first">Camera Move Styles - changing control modes for the camera</p>
</li>
<li><p class="first">Custom Anchors - creating custom annotations</p>
</li>
<li><p class="first">Dynamic Geometry - procedural geometry modification</p>
</li>
<li><p class="first">Gyro (Mobile Only) - working with mobile devices&#8217; gyroscopes</p>
</li>
<li><p class="first">Instancing - copying scene objects in runtime</p>
</li>
<li><p class="first">Material API - tweaking material properties and replacing objects&#8217; materials</p>
</li>
<li><p class="first">Morphing - using shape keys</p>
</li>
</ul>
</dd>
</dl>
<p>The Code Snippets application is available at <code class="docutils literal"><span class="pre">SDK/apps_dev/code_snippets/code_snippets_dev.html</span></code>. It can be also run by using a link in the <code class="docutils literal"><span class="pre">index.html</span></code> file located in the SDK root.</p>
</div>
<div class="section" id="converter">
<span id="id6"></span><h2>Resource Conversion<a class="headerlink" href="#converter" title="Permalink to this headline">¶</a></h2>
<p>Existing browsers do not fully support all possible media formats, so in order to create cross-browser applications and for optimization purposes we need to use a resource converter. The conversion is performed according as follows:</p>
<dl class="docutils">
<dt>for audio (convert_media):</dt>
<dd><ul class="first last simple">
<li>ogg -&gt; mp4</li>
<li>mp3 -&gt; ogg</li>
<li>mp4 -&gt; ogg</li>
</ul>
</dd>
</dl>
<p>We recommend to use <em>Ogg</em> as the basic format. In this case the only conversion required for cross-browser compatibility will be <em>ogg</em> to <em>mp4</em>. Example of an input file: <code class="docutils literal"><span class="pre">file_name.ogg</span></code>, example of an output file: <code class="docutils literal"><span class="pre">file_name.altconv.mp4</span></code>.</p>
<dl class="docutils">
<dt>for video (convert_media):</dt>
<dd><ul class="first last simple">
<li>webm -&gt; m4v</li>
<li>m4v -&gt; webm</li>
<li>ogv -&gt; webm</li>
<li>webm -&gt; seq</li>
<li>m4v -&gt; seq</li>
<li>ogv -&gt; seq</li>
</ul>
</dd>
</dl>
<p>We recommend to use <em>WebM</em> as the basic format. In this case the only conversion required for cross-browser compatibility will be <em>webm</em> to <em>m4v</em> (<em>webm</em> to <em>seq</em> for iPhone). Example of an input file: <code class="docutils literal"><span class="pre">file_name.webm</span></code>, example of an output file: <code class="docutils literal"><span class="pre">file_name.altconv.m4v</span></code>.</p>
<dl class="docutils">
<dt>for images (convert_dds):</dt>
<dd><ul class="first last simple">
<li>png -&gt; dds</li>
<li>jpg -&gt; dds</li>
</ul>
</dd>
</dl>
<p>Example of an input file: <code class="docutils literal"><span class="pre">file_name.jpg</span></code>, example of an output file: <code class="docutils literal"><span class="pre">file_name.altconv.jpg.dds</span></code>.</p>
<p>For the purpose of optimizing application performance it&#8217;s possible to use <em>min50</em> (halved) and <em>DDS</em> textures. In order to do this, we need to pass the following parameters during the application initialization.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">exports</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m_app</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
        <span class="c1">// . . .</span>
        <span class="nx">assets_dds_available</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">assets_min50_available</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="c1">// . . .</span>
    <span class="p">});</span>
    <span class="c1">// . . .</span>
<span class="p">}</span>
</pre></div>
</div>
<p id="seq">The <code class="docutils literal"><span class="pre">.seq</span></code> file format is used for sequential video. This is applied for IE 11 and iPhone because they are currently missing support for standard video formats for textures. Using dds format for images is more optimal compared to other formats.</p>
<p>To support a wider range of platforms, a Python script (scripts/converter.py) for converting the source files into other formats is included into the distribution. Run it with the command:</p>
<div class="highlight-bash"><div class="highlight"><pre>&gt; ./converter.py <span class="o">[</span>-d file_path<span class="o">]</span> resize_textures <span class="p">|</span> convert_dds <span class="p">|</span> convert_media
</pre></div>
</div>
<p>With the -d parameter you can specify the path to a directory in which converting will take place.</p>
<p>To exclude some directory from resource conversion, it is enough to put a file named <code class="docutils literal"><span class="pre">.b4w_no_conv</span></code> in it. This will not affect conversion in nested directories.</p>
<p>The <strong>resize_textures</strong> argument is used for decreasing texture resolution for the <strong>LOW</strong> mode.</p>
<p>The engine can use files which are manually created by a user if they have the following names: <code class="docutils literal"><span class="pre">file_name.altconv.m4v</span></code>, <code class="docutils literal"><span class="pre">file_name.altconv.mp3</span></code> and so on. Such files should be placed in the same directory as the mediafiles used in Blender.</p>
<p>You can also use the free and cross-platform application <a class="reference external" href="http://www.mirovideoconverter.com/">Miro Video Converter</a> to convert mediafiles.</p>
</div>
<div class="section" id="id7">
<h2>Module System<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>While the engine gives an app programmer an API in the scale of dozens of modules, it occupies a single <code class="docutils literal"><span class="pre">b4w</span></code> namespace. To call a module&#8217;s method import it first with the <code class="docutils literal"><span class="pre">b4w.require</span></code> function.</p>
<p>It is possible to register external modules if their names do not collide with already existing modules. A module can be registered with a <code class="docutils literal"><span class="pre">b4w.register</span></code> call. Check if a module with some name already exists with a <code class="docutils literal"><span class="pre">b4w.module_check</span></code> call.</p>
<p>Example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// check if module exists</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">b4w</span><span class="p">.</span><span class="nx">module_check</span><span class="p">(</span><span class="s2">&quot;my_module&quot;</span><span class="p">))</span>
    <span class="k">throw</span> <span class="s2">&quot;Failed to register module: my_module&quot;</span><span class="p">;</span>

<span class="c1">// register my_module</span>
<span class="nx">b4w</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;my_module&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">require</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// import module &quot;version&quot;</span>
    <span class="kd">var</span> <span class="nx">m_version</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">);</span>

    <span class="c1">// export print_build_date() from module &quot;my_module&quot;</span>
    <span class="nx">exports</span><span class="p">.</span><span class="nx">print_build_date</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// exec function date() from module &quot;version&quot;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Engine build date: &quot;</span> <span class="o">+</span> <span class="nx">m_version</span><span class="p">.</span><span class="nx">date</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// import module &quot;my_module&quot;</span>
<span class="kd">var</span> <span class="nx">m_my_module</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;my_module&quot;</span><span class="p">);</span>

<span class="c1">// exec function print_build_date() from module &quot;my_module&quot;</span>
<span class="nx">m_my_module</span><span class="p">.</span><span class="nx">print_build_date</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="event-model">
<span id="id8"></span><h2>Event-Driven Model<a class="headerlink" href="#event-model" title="Permalink to this headline">¶</a></h2>
<p>The event-driven model provides a universal interface for describing the 3D scene&#8217;s change of state. It simpifies the processing of physics events and user actions.</p>
<div class="section" id="index-0">
<span id="id9"></span><h3>Sensors<a class="headerlink" href="#index-0" title="Permalink to this headline">¶</a></h3>
<p>The basic unit of the event-driven model is a sensor. A sensor is a programming entity and can only be active (1, one) or inactive (0, zero). Some sensors may carry a payload. For example the ray-tracing sensor (Ray Sensor) provides the relative length of the intersection ray.</p>
<p id="index-1">Users cannot directly control sensors via the external API. Instead all sensors must be present in one or multiple collections - so called sensor manifolds. A manifold is a logic container associated with a scene object. It generates a response to a defined set of sensor events by executing a callback function. To define the manifold it is required to have the following information (see also the API documenation for decription of the <code class="docutils literal"><span class="pre">controls.create_sensor_manifold()</span></code> function):</p>
<ul>
<li><p class="first">An object to carry the manifold (e.g. a thrown object).</p>
</li>
<li><p class="first">An unique id of the manifold (e.g. &#8220;IMPACT&#8221;).</p>
</li>
<li><p class="first">A callback execution mode (the options are: <code class="docutils literal"><span class="pre">CT_CONTINUOUS</span></code>,</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">CT_LEVEL</span></code>, <code class="docutils literal"><span class="pre">CT_SHOT</span></code>, <code class="docutils literal"><span class="pre">CT_TRIGGER</span></code>).</p>
</div></blockquote>
</li>
<li><p class="first">An array of sensors.</p>
</li>
<li><p class="first">A logic function to define the combination of the sensor states for which the callback function is executed.</p>
</li>
<li><p class="first">A callback function.</p>
</li>
<li><p class="first">An optional parameter to pass into the callback function.</p>
</li>
</ul>
</div>
<div class="section" id="id10">
<h3>Example<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Lets consider the task to insonify the impact of a thrown stone. A distinctive sound should be produced for impacting different media (for example terrain and wall). There are collision meshes with physical materials in the Blender scene, material ids are &#8220;TERRAIN&#8221; and &#8220;WALL&#8221;. There is also a physical object being thrown in the scene, the object is named &#8220;Stone&#8221;.</p>
<p>Lets define a collision sensor for each medium, by the type of the sound produced.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// import the modules</span>
<span class="kd">var</span> <span class="nx">m_scenes</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;scenes&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">m_controls</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;controls&quot;</span><span class="p">);</span>

<span class="c1">// get the object being thrown</span>
<span class="kd">var</span> <span class="nx">stone</span> <span class="o">=</span> <span class="nx">m_scenes</span><span class="p">.</span><span class="nx">get_object_by_name</span><span class="p">(</span><span class="s2">&quot;Stone&quot;</span><span class="p">);</span>

<span class="c1">// create the sensors</span>
<span class="kd">var</span> <span class="nx">sensor_impact_terrain</span> <span class="o">=</span> <span class="nx">m_controls</span><span class="p">.</span><span class="nx">create_collision_sensor</span><span class="p">(</span><span class="nx">stone</span><span class="p">,</span> <span class="s2">&quot;TERRAIN&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">sensor_impact_wall</span>    <span class="o">=</span> <span class="nx">m_controls</span><span class="p">.</span><span class="nx">create_collision_sensor</span><span class="p">(</span><span class="nx">stone</span><span class="p">,</span> <span class="s2">&quot;WALL&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Add the sensors into an array. Use the OR logic in the logic function. Place the sound processing code in the callback function. Create the sensor manifold with the &#8220;IMPACT&#8221; id and the CT_SHOT type.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// array of the sensors</span>
<span class="kd">var</span> <span class="nx">impact_sens_array</span> <span class="o">=</span> <span class="p">[</span><span class="nx">sensor_impact_terrain</span><span class="p">,</span> <span class="nx">sensor_impact_wall</span><span class="p">];</span>

<span class="c1">// manifold logic function</span>
<span class="kd">var</span> <span class="nx">impact_sens_logic</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="nx">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])};</span>

<span class="c1">// callback</span>
<span class="kd">var</span> <span class="nx">impact_cb</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">manifold_id</span><span class="p">,</span> <span class="nx">pulse</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// NOTE: it&#39;s possible to play both sounds simultaneously</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">m_controls</span><span class="p">.</span><span class="nx">get_sensor_value</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">manifold_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;play the terrain impact sound&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">m_controls</span><span class="p">.</span><span class="nx">get_sensor_value</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">manifold_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;play the wall impact sound&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// create the manifold</span>
<span class="nx">m_controls</span><span class="p">.</span><span class="nx">create_sensor_manifold</span><span class="p">(</span><span class="nx">stone</span><span class="p">,</span> <span class="s2">&quot;IMPACT&quot;</span><span class="p">,</span> <span class="nx">m_ctl</span><span class="p">.</span><span class="nx">CT_SHOT</span><span class="p">,</span>
    <span class="nx">impact_sens_array</span><span class="p">,</span> <span class="nx">impact_sens_logic</span><span class="p">,</span> <span class="nx">impact_cb</span><span class="p">);</span>
</pre></div>
</div>
<p>When the &#8220;Stone&#8221; object collides with any physical material of &#8220;TERRAIN&#8221; or &#8220;WALL&#8221;, the callback function is executed. Inside this function we get the values of both sensors by their indices in the sensor array (0 - &#8220;TERRAIN&#8221;, 1 - &#8220;WALL&#8221;). The sensor value = 1 (active) means that the collision happened with the corresponding physical material. As a result the corresponding sound is produced (the code is not shown).</p>
</div>
</div>
<div class="section" id="quality-settings">
<span id="id11"></span><h2>Quality Profiles<a class="headerlink" href="#quality-settings" title="Permalink to this headline">¶</a></h2>
<p>Several quality profiles are implemented in order to support platforms with different functionality.</p>
<blockquote>
<div><ul class="simple">
<li><p class="first"><em>low quality</em> (P_LOW) - a range of functions is turned off (such as shadows, dynamic reflection, postprocessing), the size of textures is halved when using a release version, anti-aliasing is disabled</p>
</li>
<li><p class="first"><em>high quality</em> (P_HIGH) - all features requested by the scene are used, the anti-aliasing method is FXAA</p>
</li>
<li><p class="first"><em>maximum quality</em> (P_ULTRA) - rendering resolution is doubled, resolution of shadow maps is increased, the anti-aliasing method is SMAA</p>
</li>
</ul>
</div></blockquote>
<a class="reference internal image-reference" href="_images/quality.jpg"><img alt="_images/quality.jpg" class="align-center" src="_images/quality.jpg" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Switching the quality profiles can be performed in runtime before initialization of the WebGL context. The default profile is P_HIGH.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">m_cfg</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">m_main</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">);</span>

<span class="nx">m_cfg</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;quality&quot;</span><span class="p">,</span> <span class="nx">m_cfg</span><span class="p">.</span><span class="nx">P_LOW</span><span class="p">);</span>
<span class="nx">m_main</span><span class="p">.</span><span class="nx">init</span><span class="p">(...);</span>
</pre></div>
</div>
<p>Application developers can also set the <strong>quality</strong> parameter upon engine initialization using the <code class="docutils literal"><span class="pre">app.js</span></code> add-on:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">m_cfg</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">m_app</span> <span class="o">=</span> <span class="nx">b4w</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">);</span>

<span class="nx">m_app</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
    <span class="nx">canvas_container_id</span><span class="o">:</span> <span class="s2">&quot;body_id&quot;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="nx">m_cfg</span><span class="p">.</span><span class="nx">P_HIGH</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="repo-file-structure">
<span id="id12"></span><h2>SDK File Structure<a class="headerlink" href="#repo-file-structure" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><strong>apps_dev</strong></dt>
<dd><p class="first">source code of the applications (not all applications are available as a free version)</p>
<dl class="last docutils">
<dt><strong>Makefile</strong></dt>
<dd><p class="first last">the file for building all applications from the SDK</p>
</dd>
<dt><strong>project.py</strong></dt>
<dd><p class="first last">script for application developers</p>
</dd>
<dt><strong>viewer</strong></dt>
<dd><p class="first">the sources files of the Viewer application</p>
<dl class="last docutils">
<dt><strong>assets.json</strong></dt>
<dd><p class="first last">meta data with information about scenes loaded by the Viewer</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt><strong>csrc</strong></dt>
<dd><p class="first last">source code (in C) of the binary part of the engine exporter and of the other utilities</p>
</dd>
<dt><strong>doc_src</strong></dt>
<dd><p class="first last">source files of the current manual written in reST</p>
</dd>
<dt><strong>blender</strong></dt>
<dd><p class="first last">source files of the Blender scenes (not all scenes are available as a free version)</p>
</dd>
<dt><strong>blender_scripts</strong></dt>
<dd><p class="first last">exporter and utility scripts for Blender</p>
</dd>
<dt><strong>deploy</strong></dt>
<dd><p class="first">the resource directory for deploying on the server (scene source files, compiled applications and documentation)</p>
<dl class="last docutils">
<dt><strong>api_doc</strong></dt>
<dd><p class="first last">API documentation for developers (built automatically, based on the engine&#8217;s source code)</p>
</dd>
<dt><strong>apps</strong></dt>
<dd><p class="first">3D applications intended for deploying; the directory duplicates <em>apps_dev</em></p>
<dl class="last docutils">
<dt><strong>common</strong></dt>
<dd><p class="first last">Compiled engine files. Shared by all applications from SDK (hence the name).</p>
</dd>
</dl>
</dd>
<dt><strong>assets</strong></dt>
<dd><p class="first last">downloadable resources: scenes, textures and sounds</p>
</dd>
<dt><strong>doc</strong></dt>
<dd><p class="first last">the current user manual in HTML format, built autamatically from <em>doc_src</em></p>
</dd>
<dt><strong>globals_detect</strong></dt>
<dd><p class="first last">utility code for detecting global variables</p>
</dd>
<dt><strong>tutorials</strong></dt>
<dd><p class="first last">source files for the tutorials</p>
</dd>
</dl>
</dd>
<dt><strong>index.html</strong> и <strong>index_assets</strong></dt>
<dd><p class="first last">main SDK webpage files</p>
</dd>
<dt><strong>license</strong></dt>
<dd><p class="first last">files with license texts</p>
</dd>
<dt><strong>Makefile</strong></dt>
<dd><p class="first last">makefile for building the engine, the applications, the documentation and for deploying on a remote server (not available as a free version)</p>
</dd>
<dt><strong>README.rst</strong></dt>
<dd><p class="first last">README file</p>
</dd>
<dt><strong>scripts</strong></dt>
<dd><p class="first">utility scripts</p>
<dl class="last docutils">
<dt><strong>chrome_debug.sh</strong></dt>
<dd><p class="first last">script which starts Chrome in debugging mode</p>
</dd>
<dt><strong>compile_b4w.py</strong></dt>
<dd><p class="first last">script for building engine code and applications</p>
</dd>
<dt><strong>converter.py</strong></dt>
<dd><p class="first last">script which halves the texture dimensions, compresses the textures into the DDS format, converts sound files into mp4 and ogg formats</p>
</dd>
<dt><strong>custom_json_encoder.py</strong></dt>
<dd><p class="first last">fork of the json Python module, sorts the keys in reverse order</p>
</dd>
<dt><strong>gen_glmatrix.sh</strong></dt>
<dd><p class="first last">script for generating the math module based on the source code of glMatrix 2</p>
</dd>
<dt><strong>graph.sh</strong></dt>
<dd><p class="first last">SVG generator for the current scene graph, used for debugging rendering</p>
</dd>
<dt><strong>memory.sh</strong></dt>
<dd><p class="first last">script for checking memory (RAM) and video memory (VRAM)</p>
</dd>
<dt><strong>plot.sh</strong></dt>
<dd><p class="first last">debugging information graph builder</p>
</dd>
<dt><strong>reexporter.py</strong></dt>
<dd><p class="first last">script for automatic reexport of all scenes from the SDK</p>
</dd>
<dt><strong>remove_alpha_channel.sh</strong></dt>
<dd><p class="first last">script for removing the images alpha channel</p>
</dd>
<dt><strong>report_unused_resources.py</strong></dt>
<dd><p class="first last">script for checking of and reporting about unused resources (images and sounds referenced by the exported files)</p>
</dd>
<dt><strong>screencast.sh</strong></dt>
<dd><p class="first last">script for screen video recording</p>
</dd>
<dt><strong>shader_analyzer.py</strong></dt>
<dd><p class="first last">script starting the local web server which calculates complexity of the shaders</p>
</dd>
</dl>
</dd>
<dt><strong>shaders</strong></dt>
<dd><p class="first last">GLSL shaders of the engine</p>
</dd>
<dt><strong>src</strong></dt>
<dd><p class="first">main source code of the engine&#8217;s kernel</p>
<dl class="last docutils">
<dt><strong>addons</strong></dt>
<dd><p class="first last">source code of engine addons</p>
</dd>
<dt><strong>ext</strong></dt>
<dd><p class="first last">source code of the external declarations that form the engine&#8217;s API</p>
</dd>
<dt><strong>libs</strong></dt>
<dd><p class="first last">source code of the libraries</p>
</dd>
</dl>
</dd>
<dt><strong>tools</strong></dt>
<dd><p class="first">Various tools for building the engine and applications</p>
<dl class="last docutils">
<dt><strong>closure-compiler</strong></dt>
<dd><p class="first last">Google Closure compiler, its externs and their generators</p>
</dd>
<dt><strong>glsl</strong></dt>
<dd><dl class="first last docutils">
<dt><strong>compiler</strong></dt>
<dd><p class="first last">compiler for the engine&#8217;s GLSL shaders</p>
</dd>
<dt><strong>pegjs</strong></dt>
<dd><p class="first last">grammars of the PEG.js parser generator for implementing the GLSL preprocessor, and also the script for generating the parser modules from these grammars</p>
</dd>
</dl>
</dd>
<dt><strong>yuicompressor</strong></dt>
<dd><p class="first last">utility for compressing CSS files</p>
</dd>
</dl>
</dd>
<dt><strong>uranium</strong></dt>
<dd><p class="first last">source code and building scripts of the Uranium physics engine (the fork of Bullet)</p>
</dd>
<dt><strong>VERSION</strong></dt>
<dd><p class="first last">contains the current version of the engine</p>
</dd>
</dl>
</div>
<div class="section" id="canvas">
<span id="canvas-texture"></span><h2>Canvas Textures<a class="headerlink" href="#canvas" title="Permalink to this headline">¶</a></h2>
<p>Such textures can be accessed via the <code class="docutils literal"><span class="pre">textures</span></code> module. The workflow is described below.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">m_tex</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;textures&quot;</span><span class="p">);</span>
<span class="p">...</span>
<span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">m_tex</span><span class="p">.</span><span class="nx">get_canvas_texture_context</span><span class="p">(</span><span class="s2">&quot;canvas_id&quot;</span><span class="p">);</span>
<span class="p">...</span>
<span class="c1">// operations with canvas context</span>
<span class="p">...</span>
<span class="nx">m_tex</span><span class="p">.</span><span class="nx">update_canvas_texture_context</span><span class="p">(</span><span class="s2">&quot;canvas_id&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The context can be obtained with the <code class="docutils literal"><span class="pre">get_canvas_texture_context()</span></code> function, to which a &#8220;canvas_id&#8221; identifier specified by the user in Blender is passed. After any <a class="reference external" href="http://www.w3.org/TR/2014/CR-2dcontext-20140821/">operations with the context</a> the <code class="docutils literal"><span class="pre">update_canvas_texture_context()</span></code> function should be executed, which performs visualization of the changes of the &#8220;canvas_id&#8221; element.</p>
</div>
<div class="section" id="blender-blend4web">
<span id="b4w-blender-coordinates"></span><h2>Differences between Blrnder&#8217;s and Blend4Web&#8217;s coordinates<a class="headerlink" href="#blender-blend4web" title="Permalink to this headline">¶</a></h2>
<p>In blender&#8217;s coordinate system the <code class="docutils literal"><span class="pre">UP</span></code> vector which points upwardsis codirectional with the Z axis. Blend4Web, as OpenGL, uses Y axis in this case. So the engine&#8217;s coordinated are being rotated by 90° on X axis relatively to Blender&#8217;s.</p>
<img alt="_images/axes.png" class="align-center" src="_images/axes.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>API methods use the engine&#8217;s coordinates so working with them can be different than working in Blender.</p>
</div>
<div class="section" id="browser-for-local-loading">
<span id="id14"></span><h2>Setting up the Browser for Loading Local Resources<a class="headerlink" href="#browser-for-local-loading" title="Permalink to this headline">¶</a></h2>
<p>Since version 15.02 the Blend4Web SDK includes the <a class="reference internal" href="setup.html#local-development-server"><span>development server</span></a> to solve the problem of loading local resources. Nevertheless the following instructions can still be useful for developers.</p>
<p>The engine&#8217;s renderer is a web application and it works when you view an HTML file in a browser. After initialization the resources (scenes, textures) are loaded. This process is subject to the <a class="reference external" href="http://en.wikipedia.org/wiki/Same-origin_policy">same-origin policy</a> rule. In particular this rule forbids loading from a local directory. A simple way to bypass this limitation is to set up the browser for loading local resources (recommended). Another way is to use a <a class="reference internal" href="#local-web-server"><span>local web server</span></a>.</p>
<p>Setting up the browser for loading local resources can be a simple and versatile method to bypass security limitation. It is recommended to use such browsers only for viewing local content.</p>
<p><em>Chrome under Windows</em>:</p>
<p>Right click on the browser shortcut, select the <code class="docutils literal"><span class="pre">Properties</span></code> option and add the <code class="docutils literal"><span class="pre">--allow-file-access-from-files</span></code> option to the executable filepath (after the space symbol). Click <code class="docutils literal"><span class="pre">OK</span></code>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference internal image-reference" href="_images/chrome_file_access.png"><img alt="_images/chrome_file_access.png" class="align-center" src="_images/chrome_file_access.png" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>For convenience create a copy of the shortcut and modify it for local viewing while leaving the original shortcut untouched for normal surfing.</p>
<p><em>Chrome under OS X</em>:</p>
<p>Open Terminal and run the browser with the following parameter:</p>
<p>&gt; /Applications/GoogleChrome.app/Contents/MacOS/GoogleChrome &#8211;allow-file-access-from-files</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>Chrome/Chromium under Linux</em>:</p>
<p>Run the browser with the parameter:</p>
<div class="highlight-python"><div class="highlight"><pre>&gt; google-chrome --allow-file-access-from-files
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python"><div class="highlight"><pre>&gt; chromium-browser --allow-file-access-from-files
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>Firefox under Windows/Linux/OS X</em>:</p>
<p>Enter <strong>about:config</strong> to the browser&#8217;s address bar, search for the <code class="docutils literal"><span class="pre">security.fileuri.strict_origin_policy</span></code> parameter and double-click on it to switch from <code class="docutils literal"><span class="pre">true</span></code> to <code class="docutils literal"><span class="pre">false</span></code>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference internal image-reference" href="_images/firefox_strict_origin.jpg"><img alt="_images/firefox_strict_origin.jpg" class="align-center" src="_images/firefox_strict_origin.jpg" style="width: 100%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>Safari/OS X</em>:</p>
<p>Enable the &#8220;Develop&#8221; menu in Preferences, and activate the  &#8220;Disable Local File Restrictions&#8221; option.</p>
<a class="reference internal image-reference" href="_images/safari_setup.png"><img alt="_images/safari_setup.png" class="align-center" src="_images/safari_setup.png" style="width: 100%;" /></a>
</div>
<div class="section" id="local-web-server">
<span id="id16"></span><h2>Running a Local Server<a class="headerlink" href="#local-web-server" title="Permalink to this headline">¶</a></h2>
<p>You may prefer running your own web server instead of the <a class="reference internal" href="setup.html#local-development-server"><span>development server</span></a> included in the SDK. An easy way to do this is running the web server from the standard <a class="reference external" href="http://en.wikipedia.org/wiki/Python_(programming_language)">Python</a> library.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>Under Windows</em>:</p>
<ol class="arabic">
<li><p class="first">Download and install the latest Python distribution from the <a class="reference external" href="http://www.python.org/downloads/">official site</a>. When installing select the option for adding the executable to the path (<code class="docutils literal"><span class="pre">Add</span> <span class="pre">python.exe</span> <span class="pre">to</span> <span class="pre">Path</span></code>).</p>
</li>
<li><p class="first">Run Command Prompt.</p>
</li>
<li><p class="first">Type the following command in the SDK&#8217;s root directory:</p>
<div class="highlight-python"><div class="highlight"><pre>&gt; python -m http.server
</pre></div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>Under Linux/OS X</em>:</p>
<ol class="arabic">
<li><p class="first">If Python is not already present in your distribution, download and install its current version from the <a class="reference external" href="http://www.python.org/downloads/">official site</a>.</p>
</li>
<li><p class="first">Run Terminal.</p>
</li>
<li><p class="first">Type the following command in the SDK&#8217;s root directory:</p>
<div class="highlight-python"><div class="highlight"><pre>&gt; python3 -m http.server
</pre></div>
</div>
</li>
</ol>
<p>After starting the server, open the index webpage with the SDK links by navigating to <a class="reference external" href="http://localhost:8000">http://localhost:8000</a>.</p>
<p>If needed, a port number can be specified by the additional parameter:</p>
<div class="highlight-python"><div class="highlight"><pre>&gt; python3 -m http.server 8080
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015, Triumph LLC.<br/>
      Last updated on 2015-07-29.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>