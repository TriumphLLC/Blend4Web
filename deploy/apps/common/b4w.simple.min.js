var b4w="object"===typeof b4w?b4w:function(a){var r={};a.module=r;var u={};a.cleanup=function(a,b){var h=r[a];h&&(h._compiled=null);u[b||"__b4w_default"]=null};a.register=function(a,b){r[a]||(r[a]=b)};a.require=function(a,b){if(!r[a])throw Error('Module "'+a+'" not found');b=b||"__b4w_default";u[b]||(u[b]=function(a){return function(b){var c=r[b];if(!c)throw Error('Module "'+b+'" not found');c._compiled||(c._compiled={});c._compiled[a]||(c._compiled[a]={},c(c._compiled[a],u[a]));return c._compiled[a]}}(b));
return u[b](a)};a.module_check=function(a){return r[a]?!0:!1};a.get_namespace=function(a){for(var b in u)if(u[b]==a)return b;return""};a.worker_listeners=[];a.worker_namespaces=[];return a}({});"object"==typeof module&&module.exports&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a,r){function u(){var a=c,b=a.getDate(),b=10>b?"0"+String(b):String(b),q=a.getMonth()+1,q=10>q?"0"+String(q):String(q),k=String(a.getFullYear()),p=a.getHours(),p=10>p?"0"+String(p):String(p),f=a.getMinutes(),f=10>f?"0"+String(f):String(f),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return b+"."+q+"."+k+" "+p+":"+f+":"+a}var c=new Date(2016,4,31,15,25,46),b=[16,5];a.version=function(){return b};a.version_str=function(){for(var a="",d=0;d<b.length;d++)a=1==d?a+(10>
b[d]?"0"+b[d]:b[d]):a+b[d],d!=b.length-1&&(a+=".");return a};a.type=function(){return"RELEASE"};a.date=function(){return c};a.date_str=u;a.timestamp=function(){var a=u(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.exports&&b4w.module.__version(exports);b4w.module.__config=function(a,r){function u(){return b4w.module_check(a.paths.built_in_data_module)}function c(){for(var d=a.paths,c=null,h=document.getElementsByTagName("script"),p=0;p<h.length;p++){for(var f=h[p].src,w=0;w<d.js_src_search_paths.length;w++)if(0<=f.indexOf(d.js_src_search_paths[w])){c=f;break}if(null!==c)break}c||(b.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),c=document.location.href);d=c.indexOf("?");0<=d&&(c=c.substring(0,d));
return c.substring(0,c.lastIndexOf("/")+1)}var b=r("__print"),h=r("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.context_save=h.clone_object_r(a.context);a.defaults={alpha_sort:!0,alpha_sort_threshold:.1,min_format_version:[5,7],max_fps:1E4,console_verbose:!1,do_not_load_resources:!1,use_min50:!1,fps_measurement_interval:1.5,fps_callback_interval:10,background_color:[0,0,0,0],canvas_resolution_factor:1,texture_min_filter:3,allow_cors:!1,
force_low_quality_nodes:!1,anisotropic_filtering:!0,show_hud_debug_info:!1,depth_textures:!0,shadows:!0,stereo:"NONE",reflections:!0,refractions:!0,ssao:!0,dof:!0,god_rays:!0,bloom:!0,motion_blur:!0,compositing:!0,antialiasing:!0,smaa:!1,debug_view:!1,water_wireframe_debug:!1,foam:!0,parallax:!0,dynamic_grass:!0,procedural_fog:!0,water_dynamic:!0,shore_smoothing:!0,shore_distance:!0,max_texture_size:1024,max_cube_map_size:512,use_dds:!0,precision:"highp",quality:a.P_HIGH,allow_vertex_textures:!0,
no_phy_interp_hack:!1,shader_constants_hack:!1,disable_blend_shadows_hack:!1,vert_anim_mix_normals_hack:!1,is_mobile_device:!1,disable_doppler_hack:!1,init_wa_context_hack:!1,clear_procedural_sky_hack:!1,sky_update_hack:!1,seq_video_fallback:!1,allow_hidpi:!1,firefox_shadows_slink_hack:!1,mobile_firefox_media_hack:!1,enable_selectable:!0,enable_outlining:!0,glow_materials:!0,max_vertex_uniform_vectors:128,ie11_edge_touchscreen_hack:!1,macos_tex_reuse_hack:!1,loaded_data_version:[0,0],edge_min_tex_size_hack:!1,
quality_aa_method:!0,amd_skinning_hack:!1,url_params:null,webgl2:!0,msaa_samples:4,safari_canvas_alpha_hack:!1,resize_cubemap_canvas_hack:!1,chrome_html_bkg_music_hack:!1,media_auto_activation:!0,max_cast_lamps:4,mac_os_shadow_hack:!1,allow_shaders_debug_ext:!1,gl_debug:!1,gamepad_setting_cont:""};a.defaults_save=h.clone_object_r(a.defaults);a.animation={framerate:-1,frames_blending_hack:!1,frame_steps:1};a.controls={mouse_wheel_notch_multiplier:1/120};a.assets={dir:"ASSETS=../../assets/",max_requests:15,
prevent_caching:!0,min50_available:!1,dds_available:!1};a.assets_save=h.clone_object_r(a.assets);a.paths={shaders_dir:"",shaders_include_dir:"include/",shaders_postp_dir:"postprocessing/",built_in_data_module:"built_in_data",js_src_search_paths:"b4w.min.js b4w.full.min.js b4w.simple.min.js b4w.whitespace.min.js src/b4w.js USER_DEFINED_MODULE".split(" "),resources_dir:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.hmd_params={webvr:{distortion_coefs:[.22,.28],chromatic_aberration_coefs:[-.015,
.02,.025,.02]},nonwebvr:{inter_lens_dist:.064,base_line_dist:.035,screen_to_lens_dist:.039,distortion_coefs:[.34,.55],chromatic_aberration_coefs:[0,0,0,0],width_dist:.11,height_dist:.062,bevel_size:.004}};a.physics={enabled:!0,max_fps:60,uranium_path:"",calc_fps:!1,ping:!1,use_workers:!0};a.physics_save=h.clone_object_r(a.physics);a.scenes={grass_tex_size:1024,cubemap_tex_size:384,cube_reflect_low:32,cube_reflect_medium:128,cube_reflect_high:256,plane_reflect_low:.25,plane_reflect_medium:.5,plane_reflect_high:1};
a.scenes_save=h.clone_object_r(a.scenes);a.sfx={webaudio:!0,mix_mode:!1,audio_loading_hack:!1,clamp_playback_rate_hack:!1,disable_playback_rate_hack:!1};a.sfx_save=h.clone_object_r(a.sfx);a.outlining={outlining_overview_mode:!1,outline_color:[1,.4,.05],outline_duration:.2,outline_period:3.8,outline_relapses:1};a.debug_subs={enabled:!1,subs_type:"COPY",subs_number:0,slink_type:"COLOR"};a.debug_subs_save=h.clone_object_r(a.debug_subs);a.apply_quality=function(){var b=a.defaults,c=a.physics,h=a.scenes;
switch(b.quality){case a.P_ULTRA:b.shadows=!0;b.shore_smoothing=!0;b.ssao=!0;b.dof=!0;b.god_rays=!0;b.bloom=!0;b.reflections=!0;b.refractions=!0;b.foam=!0;b.parallax=!0;b.dynamic_grass=!0;b.procedural_fog=!0;h.grass_tex_size=2048;b.texture_min_filter=3;b.anisotropic_filtering=!0;b.use_min50=!1;b.precision="highp";b.water_dynamic=!0;b.shore_distance=!0;b.antialiasing=!0;b.smaa=!1;b.compositing=!0;b.motion_blur=!0;b.allow_hidpi=!0;b.enable_outlining=!0;b.glow_materials=!0;b.msaa_samples=16;c.max_fps=
120;break;case a.P_HIGH:b.shadows=!0;b.shore_smoothing=!0;b.ssao=!0;b.dof=!0;b.god_rays=!0;b.bloom=!0;b.reflections=!0;b.refractions=!0;b.foam=!0;b.parallax=!0;b.dynamic_grass=!0;b.procedural_fog=!0;h.grass_tex_size=1024;b.texture_min_filter=3;b.anisotropic_filtering=!0;b.use_min50=!1;b.precision="highp";b.water_dynamic=!0;b.shore_distance=!0;b.antialiasing=!0;b.smaa=!1;b.compositing=!0;b.motion_blur=!0;b.allow_hidpi=!1;b.enable_outlining=!0;b.glow_materials=!0;b.msaa_samples=4;c.max_fps=60;break;
case a.P_LOW:b.shadows=!1,b.shore_smoothing=!1,b.ssao=!1,b.dof=!1,b.god_rays=!1,b.bloom=!1,b.reflections=!1,b.refractions=!1,b.foam=!1,b.parallax=!1,b.dynamic_grass=!1,b.procedural_fog=!1,h.grass_tex_size=512,b.texture_min_filter=2,b.anisotropic_filtering=!1,b.use_min50=!0,b.precision="mediump",b.water_dynamic=!1,b.shore_distance=!1,b.antialiasing=!1,b.smaa=!1,b.compositing=!1,b.motion_blur=!1,b.allow_hidpi=!1,b.enable_outlining=!1,b.glow_materials=!1,b.msaa_samples=1,c.max_fps=60}};a.set=function(c,
h){switch(c){case "allow_cors":a.defaults.allow_cors=h;break;case "allow_hidpi":a.defaults.allow_hidpi=h;break;case "alpha":a.context.alpha=h;break;case "alpha_sort":a.defaults.alpha_sort=h;break;case "alpha_sort_threshold":a.defaults.alpha_sort_threshold=h;break;case "anaglyph_use":b.error_deprecated_cfg("anaglyph_use","stereo");a.defaults.stereo=h?"ANAGLYPH":a.defaults.stereo;break;case "animation_framerate":a.animation.framerate=h;break;case "antialiasing":a.defaults.antialiasing=h;break;case "assets_dds_available":a.assets.dds_available=
h;break;case "assets_min50_available":a.assets.min50_available=h;break;case "audio":a.sfx.webaudio=h;break;case "background_color":a.defaults.background_color=h;break;case "built_in_module_name":a.paths.built_in_data_module=h;break;case "canvas_resolution_factor":a.defaults.canvas_resolution_factor=h;break;case "console_verbose":a.defaults.console_verbose=h;break;case "do_not_load_resources":a.defaults.do_not_load_resources=h;break;case "gamepad_setting_cont":a.defaults.gamepad_setting_cont=h;break;
case "stereo":a.defaults.stereo=h;break;case "media_auto_activation":a.defaults.media_auto_activation=h;break;case "physics_enabled":a.physics.enabled=h;break;case "physics_uranium_path":a.physics.uranium_path=h;break;case "physics_calc_fps":a.physics.calc_fps=h;break;case "physics_use_workers":a.physics.use_workers=h;break;case "precision":a.defaults.precision=h;break;case "prevent_caching":a.assets.prevent_caching=h;break;case "quality":a.defaults.quality=h;break;case "sfx_mix_mode":a.sfx.mix_mode=
h;break;case "shaders_dir":a.paths.shaders_dir=h;break;case "show_hud_debug_info":a.defaults.show_hud_debug_info=h;break;case "smaa":a.defaults.smaa=h;break;case "smaa_search_texture_path":a.paths.smaa_search_texture_path=h;break;case "smaa_area_texture_path":a.paths.smaa_area_texture_path=h;break;case "debug_view":a.defaults.debug_view=h;break;case "enable_selectable":a.defaults.enable_selectable=h;break;case "enable_outlining":a.defaults.enable_outlining=h;break;case "outlining_overview_mode":a.outlining.outlining_overview_mode=
h;break;case "glow_materials":a.defaults.glow_materials=h;break;case "url_params":a.defaults.url_params=h;break;case "gl_debug":a.defaults.gl_debug=h;break;default:b.error("Unknown config property: "+c)}};a.get=function(c){switch(c){case "allow_cors":return a.defaults.allow_cors;case "allow_hidpi":return a.defaults.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.defaults.alpha_sort;case "alpha_sort_threshold":return a.defaults.alpha_sort_threshold;case "anaglyph_use":return"ANAGLYPH"==
a.defaults.stereo;case "animation_framerate":return a.animation.framerate;case "antialiasing":return a.defaults.antialiasing;case "assets_dds_available":return a.assets.dds_available;case "assets_min50_available":return a.assets.min50_available;case "audio":return a.sfx.webaudio;case "background_color":return a.defaults.background_color;case "built_in_module_name":return a.paths.built_in_data_module;case "canvas_resolution_factor":return a.defaults.canvas_resolution_factor;case "console_verbose":return a.defaults.console_verbose;
case "do_not_load_resources":return a.defaults.do_not_load_resources;case "gamepad_setting_cont":return a.defaults.gamepad_setting_cont;case "is_mobile_device":return a.defaults.is_mobile_device;case "stereo":return a.defaults.stereo;case "media_auto_activation":return a.defaults.media_auto_activation;case "physics_enabled":return a.physics.enabled;case "physics_uranium_path":return a.physics.uranium_path;case "physics_calc_fps":return a.physics.calc_fps;case "physics_use_workers":return a.physics.use_workers;
case "precision":return a.defaults.precision;case "prevent_caching":return a.assets.prevent_caching;case "quality":return a.defaults.quality;case "sfx_mix_mode":return a.sfx.mix_mode;case "shaders_dir":return a.paths.shaders_dir;case "show_hud_debug_info":return a.defaults.show_hud_debug_info;case "smaa":return a.defaults.smaa;case "smaa_search_texture_path":return a.paths.smaa_search_texture_path;case "smaa_area_texture_path":return a.paths.smaa_area_texture_path;case "debug_view":return a.defaults.debug_view;
case "enable_selectable":return a.defaults.enable_selectable;case "enable_outlining":return a.defaults.enable_outlining;case "outlining_overview_mode":return a.outlining.outlining_overview_mode;case "glow_materials":return a.defaults.glow_materials;case "url_params":return a.defaults.url_params;case "gl_debug":return a.defaults.gl_debug;default:b.error("Unknown config property: "+c)}};a.reset=function(){a.context=h.clone_object_r(a.context_save);a.defaults=h.clone_object_r(a.defaults_save);a.assets=
h.clone_object_r(a.assets_save);a.physics=h.clone_object_r(a.physics_save);a.scenes=h.clone_object_r(a.scenes_save);a.sfx=h.clone_object_r(a.sfx_save);a.debug_subs=h.clone_object_r(a.debug_subs_save)};a.is_built_in_data=u;a.set_paths=function(){var b=a.paths,h=a.physics;u()||""!=b.shaders_dir||(b.shaders_dir=c()+"../shaders/");if(u())b.smaa_search_texture_path="smaa_search_texture.png",b.smaa_area_texture_path="smaa_area_texture.png";else if(""==b.smaa_search_texture_path||""==b.smaa_area_texture_path){var k=
c()+b.resources_dir;b.smaa_search_texture_path=b.smaa_search_texture_path||k+"smaa_search_texture.png";b.smaa_area_texture_path=b.smaa_area_texture_path||k+"smaa_area_texture.png"}h.enabled&&""==h.uranium_path&&(k=c()+b.resources_dir,h.uranium_path=k+"uranium.js")};a.get_std_assets_path=function(){return a.assets.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,r){function u(){e=!0;m.get_container().addEventListener("mouseup",function(a){function e(){return"visible"==b.style.visibility&&!J&&!D}if(!n&&!z&&(a=E))if("visible"==a.lastElementChild.style.visibility)c(),E=null;else if(1==a.style.opacity){var b=a.lastElementChild,f=b.firstElementChild,M=f.innerHTML;b.style.visibility="visible";var B=Math.min(parseInt(b.style.width)||200,q(M)-24),N=k(M,B),J=!1,D=!1,M=a.offsetWidth-24;a=a.offsetHeight-16;N==a&&(b.style.height=N+"px");
B!=M?(n=J=!0,C.animate(M,B,200,function(a){a==B&&(J=!1,D||(n=!1),e&&(f.style.visibility="visible"));b.style.width=a+"px"})):J=!1;N!=a?(n=D=!0,C.animate(a,N,200,function(a){a==N&&(D=!1,J||(n=!1),e&&(f.style.visibility="visible"));b.style.height=a+"px"})):D=!1}})}function c(){var a=E.lastElementChild;a.style.visibility="hidden";a.firstElementChild.style.visibility="hidden"}function b(a){a.style.cssText+="color:       #fff;font-family: Arial;font-size:   12px;font-weight: bold;line-height: 15px;"}function h(a){a.style.cssText+=
"background-color:   #000;border-radius:      20px 20px 20px 0px;bottom:             0;box-shadow:         0px 0px 10px rgb(180, 180, 200);-webkit-box-shadow: 0px 0px 10px rgb(180, 180, 200);font-size:          12px;left:               0;line-height:        15px;opacity:            1.0;overflow:           hidden;padding:            8px 12px;position:           absolute;z-index:            2;"}function d(a,e,f){var M=document.createElement("div"),K=document.createElement("span");f&&(M.style.width=
f+"px");h(M);b(K);K.innerHTML=a;M.style.visibility="hidden";K.style.visibility="hidden";M.appendChild(K);e.appendChild(M);e.addEventListener("mousedown",function(a){n||e==E||1!=e.style.opacity||z||(E&&"visible"==E.lastElementChild.style.visibility&&c(),E=e)})}function q(a){var e=document.createElement("div"),n=document.createElement("span");n.innerHTML=a;b(n);h(e);e.appendChild(n);document.body.appendChild(e);a=e.offsetWidth+1;document.body.removeChild(e);return a}function k(a,e){var n=document.createElement("div"),
f=document.createElement("span");f.innerHTML=a;b(f);h(n);n.style.width=e+"px";n.style.display="inline-block";n.appendChild(f);document.body.appendChild(n);f=n.offsetHeight-16;document.body.removeChild(n);return f}function p(){for(var a=0,e=0;e<y.length;e++)y[e].detect_visibility&&a++;M=new Float32Array(3*a)}function f(a,e){return e.depth-a.depth}var w=r("__batch"),g=r("__camera"),m=r("__container"),l=r("__objects"),t=r("__print"),F=r("__renderer"),H=r("__scenes"),C=r("__time"),x=r("__tsr"),y=[],z=
!1,E=null,e=!1,n=!1,M=new Float32Array(0),D=new Uint8Array(16),G=new Float32Array(2),Q=new Float32Array(3);a.append=function(a){var n;a:{for(n=0;n<y.length;n++)if(y[n].obj==a){n=!0;break a}n=!1}if(!n){n=a.anchor.detect_visibility&&Boolean(H.get_subs(H.get_main(),"ANCHOR_VISIBILITY"));n={type:a.anchor.type,obj:a,x:0,y:0,depth:0,appearance:"out",detect_visibility:n,element:null,move_cb:null,annotation_max_width:a.anchor.max_width,annotation_height:0,annotation_width:0,element_id:a.anchor.element_id};
switch(n.type){case "ANNOTATION":var f=n.annotation_max_width,c=document.createElement("div"),M=document.createElement("span"),B="",N=a.name,J=m.get_container();a=l.get_meta_tags(a);c.style.cssText+="background-color:   #000;border-radius:      20px 20px 20px 0px;box-shadow:         0px 0px 10px rgb(180, 180, 200);-webkit-box-shadow: 0px 0px 10px rgb(180, 180, 200);font-size:          12px;line-height:        15px;opacity:            1.0;padding:            8px 12px;position:           absolute;";
c.style.visibility="hidden";J.appendChild(c);a&&(B=a.description||B,N=a.title||N);M.innerHTML=N;M.style.cssText+="-webkit-touch-callout: none;-webkit-user-select:   none;-khtml-user-select:    none;-moz-user-select:      none;-ms-user-select:       none;user-select:           none;cursor:                default;";b(M);c.appendChild(M);B&&d(B,c,f);n.element=c;n.annotation_height=n.element.offsetHeight;n.annotation_width=n.element.offsetWidth;break;case "ELEMENT":n.element=document.getElementById(a.anchor.element_id),
n.element?(n.annotation_height=n.element.offsetHeight,n.annotation_width=n.element.offsetWidth):(t.warn("Anchor HTML element was not found, making it generic"),n.type="GENERIC")}y.push(n);p();e||u()}};a.remove=function(a){for(var e=0;e<y.length;e++){var b=y[e];if(b.obj==a){"ANNOTATION"==b.type&&(a=b,m.get_container().removeChild(a.element));y.splice(e,1);p();break}}};a.update=function(){for(var a=0,e=y.length;e--;){var b=y[e];if(b.detect_visibility){var n=x.get_trans_view(b.obj.render.world_tsr);
M.set(n,3*a++)}var c;c=b;var n=Q,B=H.get_camera(H.get_main());c=x.get_trans_view(c.obj.render.world_tsr);c=n=g.project_point(B,c,n);n=c[0];B=c[1];c=c[2];if(n!=b.x||B!=b.y||c!=b.depth){switch(b.type){case "ANNOTATION":var N=b.element;N.style.left=Math.floor(n)+"px";N.style.top=Math.floor(B-b.annotation_height)+"px";break;case "ELEMENT":var N=b.element,J=N.getBoundingClientRect();N.style.cssText+="left:"+Math.floor(n-J.width/2)+"px;top:"+Math.floor(B-J.height/2)+"px;"}b.x=n;b.y=B;b.depth=c;b.move_cb&&
b.move_cb(n,B,b.appearance,b.obj,N)}}y.sort(f);for(e=0;e<y.length;e++)b=y[e],"GENERIC"!=b.type&&(b.element.style.zIndex=e);0<a&&(a=H.get_subs(H.get_main(),"ANCHOR_VISIBILITY").bundles[0].batch,w.update_anchor_visibility_batch(a,M))};a.update_visibility=function(){for(var a=m.get_container(),e=y.length;e--;){var b=y[e],n=b.obj,f=b.x,B=b.y,N=b.depth,N=0>f||0>B||0>N||1<N||H.is_hidden(n)||f>=a.clientWidth||B>=a.clientHeight?"out":"visible";if(b.detect_visibility&&"out"!=N){var N=b,c=H.get_subs(H.get_main(),
"ANCHOR_VISIBILITY").camera,M=m.canvas_to_viewport_coords(N.x,N.y,G,c);F.read_pixels(c.framebuffer,M[0],c.height-M[1],2,2,D);N=1020==D[0]+D[4]+D[8]+D[12]?"visible":"out"==N.appearance||0==D[0]+D[4]+D[8]+D[12]?"covered":N.appearance}if(N!=b.appearance){switch(b.type){case "ANNOTATION":case "ELEMENT":var d=b.element;if(!d)break;"out"==N?(d.style.visibility="hidden",d.children.length&&(d.children[0].style.visibility="hidden")):"visible"==N?(d.style.visibility="visible",d.children.length&&(d.children[0].style.visibility=
"visible"),d.style.opacity=1):(d.style.visibility="visible",d.style.opacity=.1,d.children.length&&(d.children[0].style.visibility="visible"),"ANNOTATION"==b.type&&1<d.children.length&&(c=d.children[1],c.style.visibility="hidden",c.children.length&&(c.children[0].style.visibility="hidden")))}b.appearance=N;b.move_cb&&b.move_cb(f,B,b.appearance,n,d)}}};a.attach_move_cb=function(a,e){for(var b=0;b<y.length;b++)y[b].obj==a&&(y[b].move_cb=e)};a.detach_move_cb=function(a){for(var e=0;e<y.length;e++)y[e].obj==
a&&(y[e].move_cb=null)};a.cleanup=function(){for(var a=0;a<y.length;a++){var e=y[a];"ANNOTATION"==e.type&&m.get_container().removeChild(e.element)}y.length=0};a.is_anchor=function(a){for(var e=0;e<y.length;e++)if(y[e].obj==a)return!0;return!1};a.get_element_id=function(a){for(var e=0;e<y.length;e++)if(y[e].obj==a)return y[e].element_id;return!1};a.pause=function(){z=!0};a.resume=function(){z=!1};a.pick_anchor=function(a,e){for(var b=-1,n=0;n<y.length;n++){var c;if(c="visible"==y[n].appearance){var B=
y[n];c=a;var N=e,f=Math.round(B.annotation_width),M=Math.round(B.annotation_height),D=B.x,B=B.y;c=c>=D&&c<=D+f&&N<B&&N>=B-M?!0:!1}if(c)if(0>b)var d=y[n].depth,b=n;else y[n].depth<d&&(b=n,d=y[n].depth)}return 0>b?null:y[b].obj}};b4w.module.__armature=function(a,r){function u(a){a=a.render;for(var b=a.skinned_renders,c=a.mesh_to_arm_bone_maps,f=0;f<b.length;f++){for(var d=b[f],g=c[f],m=0;m<g.length;m+=2)for(var h=g[m],k=g[m+1],e=0;4>e;e++)d.quats_before[h+e]=a.quats_before[k+e],d.quats_after[h+e]=a.quats_after[k+e],d.trans_before[h+e]=a.trans_before[k+e],d.trans_after[h+e]=a.trans_after[k+e];d.frame_factor=a.frame_factor}}function c(a,b,d,g){var m=a.tsr_bone_pose,k=a.tsr_local_rest,w=a.tsr_local_pose,z=a.parent_bone_ptr;z?
(z=z.tsr_local_pose,b?h.multiply(z,m,w):(b=f,h.invert(z,b),h.multiply(b,w,m))):b?h.copy(m,w):h.copy(w,m);m=p;h.invert(k,m);h.multiply(w,m,m);k=a.bone_index;d[4*k]=m[0];d[4*k+1]=m[1];d[4*k+2]=m[2];d[4*k+3]=m[3];g[4*k]=m[4];g[4*k+1]=m[5];g[4*k+2]=m[6];g[4*k+3]=m[7];a=a.descend_bones_ptrs;for(k=0;k<a.length;k++)w=a[k],w.constraint||c(w,!0,d,g)}var b=r("__util"),h=r("__tsr"),d=r("__quat"),q=r("__mat4"),k=r("__vec3"),p=h.create(),f=h.create(),w=new Float32Array(4),g=new Float32Array(4),m=new Float32Array(4);
a.update_object=function(a,c){for(var f=a.data.bones,d=a.pose.bones,g={},m=0;m<d.length;m++){var w=d[m],z=w.bone,E=z.name,e=E,E={bone_index:0,vgroup_index:-1,parent_bone_ptr:null,descend_bones_ptrs:[],chain:[],constraint:null,tsr_bone_rest:h.create(),tsr_bone_pose:h.create(),tsr_local_rest:h.create(),tsr_local_pose:h.create(),tsr_basis:h.create(),tsr_channel_cache:h.create(),tsr_channel_cache_valid:!1,tail:new Float32Array(3)},e=g[e]=E,E=new Float32Array(z.matrix_local),n=new Float32Array(16);q.invert(E,
n);var w=new Float32Array(w.matrix_basis),M=e.tail;k.subtract(z.tail_local,z.head_local,M);b.vecdir_multiply_matrix(M,n,M);h.from_mat4(E,e.tsr_local_rest);h.from_mat4(w,e.tsr_basis);h.copy(e.tsr_local_rest,e.tsr_local_pose)}for(m=0;m<f.length;m++){E=f[m].name;w=b.keysearch("name",E,d);e=g[E];z=w.parent_recursive;e.chain.push(e);for(w=0;w<z.length;w++)n=z[w],n=n.name,n=g[n],e.chain.push(n);z.length?(n=z[0],n=n.name,n=g[n],e.parent_bone_ptr=n,h.invert(n.tsr_local_rest,p),h.multiply(p,e.tsr_local_rest,
e.tsr_bone_rest),n.descend_bones_ptrs.push(e)):h.copy(e.tsr_local_rest,e.tsr_bone_rest);e.bone_index=m;e.name=E;h.multiply(e.tsr_bone_rest,e.tsr_basis,e.tsr_bone_pose)}c.render.bone_pointers=g};a.get_bone_tsr=function(a,b,c,k,q){var x=a.render,y=x.frame_factor;b=x.bone_pointers[b];var z=b.bone_index;a=b.tsr_local_rest;var E=x.trans_before,e=x.trans_after,n=x.quats_before,x=x.quats_after,M=E[4*z+1],D=E[4*z+2],G=E[4*z+3],Q=e[4*z+1],v=e[4*z+2],P=e[4*z+3];w[0]=(1-y)*E[4*z]+y*e[4*z];w[1]=(1-y)*M+y*Q;w[2]=
(1-y)*D+y*v;w[3]=(1-y)*G+y*P;g[0]=n[4*z];g[1]=n[4*z+1];g[2]=n[4*z+2];g[3]=n[4*z+3];m[0]=x[4*z];m[1]=x[4*z+1];m[2]=x[4*z+2];m[3]=x[4*z+3];d.slerp(g,m,y,g);y=p;h.set_transcale(w,y);h.set_quat(g,y);c?(c=f,h.translate(a,b.tail,c),h.multiply(y,c,y)):h.multiply(y,a,y);if(k){if(k=b.parent_bone_ptr)c=f,h.invert(k.tsr_local_pose,c),h.multiply(c,y,y);k=f;h.invert(b.tsr_bone_rest,k);h.multiply(k,y,y)}h.copy(y,q)};a.set_bone_tsr=function(a,b,f,d){var g=a.render;b=g.bone_pointers[b];var m=g.trans_before,k=g.quats_before;
d?h.multiply(b.tsr_bone_rest,f,b.tsr_bone_pose):h.copy(f,b.tsr_local_pose);c(b,d,m,k);g.frame_factor=0;u(a)};a.update_skinned_renders=u;a.update_bone_tsr_r=c;a.check_bone=function(a,b){return b in a.render.bone_pointers}};b4w.module.__boundings=function(a,r){function u(a,b){for(var e=a[0],n=a[1],c=a[2],f=a[0],d=a[1],g=a[2],v=3;v<a.length;v+=3)var l=a[v],S=a[v+1],m=a[v+2],e=Math.max(e,l),n=Math.max(n,S),c=Math.max(c,m),f=Math.min(f,l),d=Math.min(d,S),g=Math.min(g,m);b.max_x=e;b.max_y=n;b.max_z=c;b.min_x=f;b.min_y=d;b.min_z=g;return b}function c(a,b){b||(b=new Float32Array(24));var e=a.max_x,n=a.max_y,c=a.max_z,f=a.min_x,d=a.min_y,g=a.min_z;b[0]=f;b[1]=d;b[2]=g;b[3]=e;b[4]=d;b[5]=g;b[6]=e;b[7]=n;b[8]=g;b[9]=f;b[10]=
n;b[11]=g;b[12]=f;b[13]=d;b[14]=c;b[15]=e;b[16]=d;b[17]=c;b[18]=e;b[19]=n;b[20]=c;b[21]=f;b[22]=n;b[23]=c;return b}function b(){return{axis_x:new Float32Array(3),axis_y:new Float32Array(3),axis_z:new Float32Array(3),center:new Float32Array([0,0,0])}}function h(a,b,e,n,c){return{axis_x:new Float32Array(a),axis_y:new Float32Array(b),axis_z:new Float32Array(e),center:new Float32Array([n[0],n[1],n[2]])}}function d(a,b){var e=w.calk_average_position(a,H),e=b?w.calc_covariance_matrix(a,e,x):g.identity(x),
e=w.find_eigenvectors(e,5E-4,C);f.copy(a,l);f.transformMat3(l,e,l);for(var n=l[0],c=n,d=l[1],m=d,k=l[2],v=k,p=0,S=0,I=0,K=0,B=0,N=0,J=3;J<a.length;J+=3)l[0]=a[J],l[1]=a[J+1],l[2]=a[J+2],f.transformMat3(l,e,l),p=l[0],S=l[1],I=l[2],p>n&&(n=p),p<c&&(c=p),S>d&&(d=S),S<m&&(m=S),I>k&&(k=I),I<v&&(v=I);d-=m;k-=v;n=Math.max(n-c,1E-9);d=Math.max(d,1E-9);k=Math.max(k,1E-9);Math.max(n,d,k);c=g.identity(x);c[0]=0!=n?1/n:1E8;c[4]=0!=d?1/d:1E8;c[8]=0!=k?1/k:1E8;g.transpose(e,y);l[0]=a[0];l[1]=a[1];l[2]=a[2];f.transformMat3(l,
y,l);f.transformMat3(l,c,l);f.transformMat3(l,e,l);p=l[0];S=l[0];I=l[1];K=l[1];B=l[2];N=l[2];for(J=3;J<a.length;J+=3)l[0]=a[J],l[1]=a[J+1],l[2]=a[J+2],f.transformMat3(l,y,l),f.transformMat3(l,c,l),f.transformMat3(l,e,l),p=Math.max(p,l[0]),S=Math.min(S,l[0]),I=Math.max(I,l[1]),K=Math.min(K,l[1]),B=Math.max(B,l[2]),N=Math.min(N,l[2]);J=Math.sqrt((p-S)*(p-S)+(I-K)*(I-K)+(B-N)*(B-N))/2;J=Math.min(J,1);F[0]=(p+S)/2;F[1]=(I+K)/2;F[2]=(B+N)/2;p=F;c=g.identity(x);c[0]=n;c[4]=d;c[8]=k;f.transformMat3(p,y,
p);f.transformMat3(p,c,p);f.transformMat3(p,e,p);c=[e[0],e[3],e[6]];S=[e[1],e[4],e[7]];e=[e[2],e[5],e[8]];f.scale(c,n*J,c);f.scale(S,d*J,S);f.scale(e,k*J,e);return h(c,S,e,p)}function q(a,b,e){f.add(b,e,a.center);f.scale(a.center,.5,a.center);a.radius=f.distance(a.center,b);return a}var k=r("__tsr"),p=r("__util"),f=r("__vec3"),w=r("__math"),g=r("__mat3");r("__quat");var m=new Float32Array(24),l=new Float32Array(3),t=new Float32Array(3),F=new Float32Array(3),H=new Float32Array(3),C=new Float32Array(9),
x=new Float32Array(9),y=new Float32Array(9);new Float32Array(9);a.copy_bb=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.big_bounding_box=function(){return{max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.zero_bounding_box=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.calc_min_bb_side=function(a){var b=a.max_x-a.min_x,e=a.max_y-a.min_y;e<b&&(b=e);a=a.max_z-a.min_z;
a<b&&(b=a);return b};a.expand_bounding_box=function(a,b){var e=a.max_y,n=a.max_z,c=a.min_x,f=a.min_y,d=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,e);a.max_z=Math.max(b.max_z,n);a.min_x=Math.min(b.min_x,c);a.min_y=Math.min(b.min_y,f);a.min_z=Math.min(b.min_z,d);return a};a.bb_from_coords=u;a.bounding_box_transform=function(b,f,e){e||(e=a.zero_bounding_box());b=c(b,m);k.transform_vectors(b,f,b);return u(b,e)};a.extract_bb_corners=c;a.shrink_bounding_box=function(b,c,e){e||(e=
a.zero_bounding_box());var n=c.min_x,f=c.max_x,d=c.min_y,g=c.max_y,l=c.min_z;c=c.max_z;if(n>=b.max_x||f<=b.min_x||d>=b.max_y||g<=b.min_y||l>=b.max_z||c<=b.min_z)return e.min_x=-.1,e.max_x=.1,e.min_y=-.1,e.max_y=.1,e.min_z=-.2,e.max_z=-.1,e;e.min_x=Math.max(b.min_x,n);e.max_x=Math.min(b.max_x,f);e.min_y=Math.max(b.min_y,d);e.max_y=Math.min(b.max_y,g);e.min_z=Math.max(b.min_z,l);e.max_z=Math.min(b.max_z,c);return e};a.stretch_bounding_box=function(b,c,e){e||(e=a.zero_bounding_box());var n=b.max_x-b.min_x,
f=b.max_y-b.min_y,d=b.max_z-b.min_z;e.min_x=b.min_x-.5*(c-1)*n;e.max_x=b.max_x+.5*(c-1)*n;e.min_y=b.min_y-.5*(c-1)*f;e.max_y=b.max_y+.5*(c-1)*f;e.min_z=b.min_z-.5*(c-1)*d;e.max_z=b.max_z+.5*(c-1)*d;return e};a.bounding_sphere_transform=function(b,c,e){e||(e=a.zero_bounding_sphere());k.transform_vec3(b.center,c,e.center);e.radius=b.radius*k.get_scale(c);return e};a.bounding_ellipsoid_transform=function(a,c,e){e||(e=b());k.transform_vec3(a.center,c,e.center);f.copy(a.axis_x,e.axis_x);f.copy(a.axis_y,
e.axis_y);f.copy(a.axis_z,e.axis_z);k.transform_dir_vec3(e.axis_x,c,e.axis_x);k.transform_dir_vec3(e.axis_y,c,e.axis_y);k.transform_dir_vec3(e.axis_z,c,e.axis_z);return e};a.create_bounding_sphere=function(a,b){return{radius:a,center:new Float32Array(b)}};a.zero_bounding_sphere=function(){return{center:new Float32Array([0,0,0]),radius:0}};a.zero_bounding_ellipsoid=b;a.create_bounding_ellipsoid=h;a.big_bounding_sphere=function(){return{center:new Float32Array([0,0,0]),radius:1E12}};a.expand_bounding_sphere=
function(a,b){var e=f.subtract(b.center,a.center,f.create());0==f.length(e)&&f.set(1,0,0,e);var n=f.normalize(e,f.create()),e=f.scale(n,a.radius,f.create());f.add(e,a.center,e);var c=f.scale(n,-a.radius,f.create());f.add(c,a.center,c);var d=f.scale(n,b.radius,f.create());f.add(d,b.center,d);var g=f.scale(n,-b.radius,f.create());f.add(g,b.center,g);e=[e,c,d,g];n=f.normalize(n,f.create());c=e[0];d=e[0];for(g=1;g<e.length;g++){var l=f.dot(e[g],n);l<f.dot(c,n)&&(c=e[g]);l>f.dot(d,n)&&(d=e[g])}n=[c,d];
e=n[0];n=n[1];a.center=f.scale(f.add(e,n,f.create()),.5,f.create());a.radius=f.length(f.subtract(n,e,f.create()))/2};a.create_bounding_ellipsoid_by_bb=d;a.calc_be_local_by_tsr=function(a,b){var e=p.clone_object_r(a),n=k.get_trans_value(b,H);f.subtract(e.center,n,e.center);return e};a.create_bounding_capsule=function(a,b){var e=b.max_y,n=b.min_y,c=Math.max(0,e-n-2*a);return{radius:a,height:c,center:new Float32Array([0,(e+n)/2,0])}};a.create_bounding_cylinder=function(a,b){var e=b.max_y,n=b.min_y,c=
Math.max(0,e-n);return{radius:a,height:c,center:new Float32Array([0,(e+n)/2,0])}};a.create_bounding_cone=function(a,b){var e=b.max_y,n=b.min_y,c=Math.max(0,e-n);return{radius:a,height:c,center:new Float32Array([0,(e+n)/2,0])}};a.check_bb_intersection=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.recalculate_mesh_boundings=function(a){for(var b=0,e=0,n=0,c=0,f=0,g=0,l=0,v=0,h=0,S=0,I=0,K=0,B=0,N=0,J=0;J<a.submeshes.length;J++){var k=
a.submeshes[J];if(k.position.length){b=c=k.position[0];e=f=k.position[1];n=g=k.position[2];break}}for(J=0;J<a.submeshes.length;J++){for(var k=a.submeshes[J],p=k.position,l=S=k.position[0],v=I=k.position[1],h=K=k.position[2],w=0;w<p.length/3;w++)var t=p[3*w],x=p[3*w+1],q=p[3*w+2],b=Math.max(t,b),e=Math.max(x,e),n=Math.max(q,n),c=Math.min(t,c),f=Math.min(x,f),g=Math.min(q,g),l=Math.max(t,l),v=Math.max(x,v),h=Math.max(q,h),S=Math.min(t,S),I=Math.min(x,I),K=Math.min(q,K),B=Math.max(Math.sqrt(t*t+x*x+
q*q),B),N=Math.max(Math.sqrt(t*t+q*q),N);p=k.boundings.bounding_box;p.max_x=l;p.min_x=S;p.max_y=v;p.min_y=I;p.max_z=h;p.min_z=K;p=m;p[0]=S;p[1]=I;p[2]=K;p[3]=l;p[4]=I;p[5]=K;p[6]=l;p[7]=v;p[8]=K;p[9]=S;p[10]=v;p[11]=K;p[12]=S;p[13]=I;p[14]=h;p[15]=l;p[16]=I;p[17]=h;p[18]=l;p[19]=v;p[20]=h;p[21]=S;p[22]=v;p[23]=h;l=d(p,!1);k.boundings.bounding_ellipsoid_center=l.center;k.boundings.bounding_ellipsoid_axes=[l.axis_x[0],l.axis_y[1],l.axis_z[2]]}a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=c;a.b4w_bounding_box.max_y=
e;a.b4w_bounding_box.min_y=f;a.b4w_bounding_box.max_z=n;a.b4w_bounding_box.min_z=g;a.b4w_bounding_box_source.max_x=b;a.b4w_bounding_box_source.min_x=c;a.b4w_bounding_box_source.max_y=e;a.b4w_bounding_box_source.min_y=f;a.b4w_bounding_box_source.max_z=n;a.b4w_bounding_box_source.min_z=g;a.b4w_bounding_sphere_radius=B;a.b4w_bounding_cylinder_radius=N;p=m;p[0]=c;p[1]=f;p[2]=g;p[3]=b;p[4]=f;p[5]=g;p[6]=b;p[7]=e;p[8]=g;p[9]=c;p[10]=e;p[11]=g;p[12]=c;p[13]=f;p[14]=n;p[15]=b;p[16]=f;p[17]=n;p[18]=b;p[19]=
e;p[20]=n;p[21]=c;p[22]=e;p[23]=n;l=d(p,!1);a.b4w_bounding_ellipsoid_center=l.center;a.b4w_bounding_ellipsoid_axes=[l.axis_x[0],l.axis_y[1],l.axis_z[2]]};a.get_frustum_mec=function(b){var c=b.subarray(0,3),e=b.subarray(6,9),n=b.subarray(12,15),d=b.subarray(18,21);b=f.subtract(e,c,l);f.normalize(b,b);var g=p.get_plane_normal(c,e,n,t),g=f.cross(g,b,g);f.normalize(g,g);var m=f.create(),h=f.create();f.subtract(e,c,F);h[0]=f.dot(F,b);h[1]=f.dot(F,g);e=f.create();f.subtract(n,c,F);e[0]=f.dot(F,b);e[1]=
f.dot(F,g);n=f.create();f.subtract(d,c,F);n[0]=f.dot(F,b);n[1]=f.dot(F,g);d=a.zero_bounding_sphere();n=[m,h,e,n];m=q(d,n[0],n[1]);for(d=2;d<n.length;d++)if(f.distance(m.center,n[d])>m.radius){for(var v=m,m=n,h=n[d],e=d-1,v=q(v,h,m[0]),k=1;k<=e;k++)if(f.distance(v.center,m[k])>v.radius){for(var S=v,v=m,I=h,K=m[k],B=k-1,S=q(S,I,K),N=0;N<=B;N++)if(f.distance(S.center,v[N])>S.radius){var J=I,w=K,x=v[N],y=f.subtract(w,x,F),y=f.squaredLength(y),C=f.subtract(J,x,F),H=f.squaredLength(C),C=f.subtract(J,w,
F),aa=f.squaredLength(C),C=y*(H+aa-y),r=H*(aa+y-H),y=aa*(y+H-aa),H=C+r+y;f.copy(J,S.center);f.scale(S.center,C/H,S.center);f.scaleAndAdd(S.center,w,r/H,S.center);f.scaleAndAdd(S.center,x,y/H,S.center);S.radius=f.distance(S.center,J)}v=S}m=v}d=m;b=f.scale(b,d.center[0],F);f.scaleAndAdd(b,g,d.center[1],b);f.add(b,c,d.center);return d}};b4w.module.__compat=function(a,r){function u(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function c(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function b(){return!window.ActiveXObject&&"ActiveXObject"in window}var h=r("__config"),d=r("__debug"),q=r("__extensions"),
k=r("__print"),p="R600;RV610;RV630;RV620;RV635;RV670;RS780;RS880;RV770;RV730;RV710;RV740;CEDAR;REDWOOD;JUNIPER;CYPRESS;PALM (Wrestler/Ontario);SUMO (Llano);SUMO2 (Llano);ARUBA (Trinity/Richland);BARTS;TURKS;CAICOS;CAYMAN".split(";");a.NVIDIA_OLD_GPU_CUBEMAP_MAX_SIZE=256;var f=h.animation,w=h.defaults,g=h.context,m=h.scenes,l=h.sfx,t=h.physics;a.detect_tegra_invalid_enum_issue=function(a){a.getError()==a.INVALID_ENUM&&k.warn("Possible Tegra invalid enum issue detected, ignoring")};a.set_hardware_defaults=
function(F){w.max_vertex_uniform_vectors=F.getParameter(F.MAX_VERTEX_UNIFORM_VECTORS);w.max_texture_size=F.getParameter(F.MAX_TEXTURE_SIZE);w.max_cube_map_size=F.getParameter(F.MAX_CUBE_MAP_TEXTURE_SIZE);w.msaa_samples=w.webgl2?Math.min(w.msaa_samples,F.getParameter(F.MAX_SAMPLES)):1;w.webgl2&&d.check_multisample_issue()&&(w.msaa_samples=1);var H=Boolean(q.get_depth_texture());u("Firefox/28.0")&&(u("Linux")||u("Macintosh"))&&(k.warn("Firefox 28 detected, applying depth hack"),H=!1);u("Windows Phone")||
(u("iPad")||u("iPhone")?(k.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack, disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),g.alpha||(w.background_color[3]=1),w.vert_anim_mix_normals_hack=!0,w.smaa=!1,w.ssao=!1,w.precision="highp",w.init_wa_context_hack=!0,m.cubemap_tex_size=256):u("Mac OS X")&&u("Safari")&&!u("Chrome")&&(k.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures. Applying canvas alpha hack."),
w.safari_canvas_alpha_hack=!0,l.audio_loading_hack=!0,l.clamp_playback_rate_hack=!0));u("Windows")&&(u("Chrome/40")||u("Firefox/33")||u("Firefox/34")||u("Firefox/35")||u("Firefox/36"))&&(k.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),w.clear_procedural_sky_hack=!0);u("Chrome")&&!c()&&h.is_built_in_data()&&(k.warn('Chrome (non-mobile) was detected for a single HTML-exported file. "Background Music" speakers were changed to "Background Sound".'),w.chrome_html_bkg_music_hack=
!0);u("Mac OS X")&&(w.mac_os_shadow_hack=!0,k.warn("OS X detected, applying shadows hack."));c()&&(k.warn("Mobile detected, applying various hacks for video textures."),w.is_mobile_device=!0,u("iPad")||u("iPhone")||u("Windows Phone")||(k.warn("Mobile (not iOS) detected, disable playback rate for video textures."),l.disable_playback_rate_hack=!0));(u("Firefox/35.0")||u("Firefox/36.0"))&&u("Windows")&&(k.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),w.firefox_shadows_slink_hack=
!0);if(u("iPhone")||b()||u("Edge"))k.warn("iPhone, IE11 or Edge detected. Enable sequential video fallback for video textures."),w.seq_video_fallback=!0;10>F.getParameter(F.MAX_VARYING_VECTORS)&&(k.warn("Not enough varyings, disable shadows on blend objects"),w.disable_blend_shadows_hack=!0);u("Windows Phone")&&(k.warn("Windows Phone detected. Disable debug view mode, glow materials, ssao, smaa, shadows, reflections, refractions."),w.debug_view=!1,w.precision="highp",w.glow_materials=!1,w.ssao=!1,
w.smaa=!1,w.shadows=!1,w.reflections=!1,w.refractions=!1,w.quality_aa_method=!1);if(u("UCBrowser")||u("Firefox")&&w.is_mobile_device)k.warn("Mobile Firefox detected, disable workers."),t.use_workers=!1;var C=q.get_renderer_info();if(C){var x=F.getParameter(C.UNMASKED_VENDOR_WEBGL),C=F.getParameter(C.UNMASKED_RENDERER_WEBGL),y=/\b4\d{2}\b/;u("Macintosh")&&-1<C.indexOf("Intel HD Graphics 3000")&&(k.warn("OS X / Intel HD 3000 detected, applying depth hack"),H=!1);-1<x.indexOf("ARM")&&y.test(C)&&(k.warn("ARM Mali-400 series detected, applying depth and frames blending hacks"),
H=!1,f.frames_blending_hack=!0);-1<x.indexOf("ARM")&&-1<C.indexOf("Mali-T604")&&(k.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),w.precision="highp",w.shadows=!1);-1<x.indexOf("ARM")&&-1<C.indexOf("Mali-T760")&&(k.warn('ARM Mali-T760 detected, set "highp" precision and disable SSAO.'),w.precision="highp",w.ssao=!1,w.amd_skinning_hack=!0);-1<x.indexOf("Qualcomm")&&-1<C.indexOf("Adreno")&&(k.warn("Qualcomm Adreno detected, applying shader constants hack."),w.shader_constants_hack=
!0,-1<C.indexOf("305")&&(k.warn('Qualcomm Adreno305 detected, set "highp" precision.'),w.precision="highp"),-1<C.indexOf("330")&&(k.warn('Qualcomm Adreno330 detected, set "highp" precision.'),w.precision="highp"),-1<C.indexOf("420")&&(k.warn("Qualcomm Adreno420 detected, setting max cubemap size to 4096, setting max texture size to 4096."),w.max_texture_size=4096,w.max_cube_map_size=4096));-1<x.indexOf("NVIDIA")&&-1<C.indexOf("Tegra 3")&&(k.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),
w.force_low_quality_nodes=!0);u("Windows")&&u("Chrome")&&!u("Edge")&&(C.match(/NVIDIA GeForce 8..0/)||C.match(/NVIDIA GeForce 9..0/)||C.match(/NVIDIA GeForce( (G|GT|GTS|GTX))? 2../))&&(k.warn("Chrome / Windows / NVIDIA GeForce 8/9/200 series detected, setting max cubemap size to 256, use canvas for resizing."),w.max_cube_map_size=a.NVIDIA_OLD_GPU_CUBEMAP_MAX_SIZE,w.resize_cubemap_canvas_hack=!0);x="";for(y=0;y<p.length;y++)if(-1<C.indexOf(p[y])){x=p[y];break}x&&(k.warn("Architecture "+x+" detected. Blending between frames and shadows on blend objects will be disabled."),
w.amd_skinning_hack=!0,w.disable_blend_shadows_hack=!0)}0==F.getParameter(F.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(k.warn("Vertex textures are not allowed. Disabling vertex textures"),w.allow_vertex_textures=!1);H||(w.foam=!1,w.parallax=!1,w.dynamic_grass=!1,w.water_dynamic=!1,w.shore_smoothing=!1,w.shore_distance=!1,w.smaa=!1);w.use_dds=Boolean(q.get_s3tc());w.depth_tex_available=H;if(F.getShaderPrecisionFormat)var z=F.getShaderPrecisionFormat(F.FRAGMENT_SHADER,F.HIGH_FLOAT);F.getShaderPrecisionFormat&&
0!==z.precision||(w.precision="mediump");b()&&(k.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),m.cubemap_tex_size=512);if(b()&&u("Touch")||u("Edge"))k.warn("IE11 and touchscreen or Edge detected. Behaviour of the mouse move sensor will be changed."),w.ie11_edge_touchscreen_hack=!0;128>=F.getParameter(F.MAX_FRAGMENT_UNIFORM_VECTORS)&&(k.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),w.force_low_quality_nodes=!0);u("Chrome")&&!u("Edge")&&
k.log("Chrome detected. Some of deprecated functions related to the Doppler effect won't be called.");if(u("Chrome")&&!u("Edge")||u("Firefox"))w.disable_doppler_hack=!0;c()&&u("Firefox")&&(k.log("Mobile firefox detected. Applying autoplay media hack."),w.mobile_firefox_media_hack=!0);u("Edge")&&(k.warn("Microsoft Edge detected, set up new minimal texture size."),w.edge_min_tex_size_hack=!0);u("SamsungBrowser")&&(k.warn("Default Android browser detected, setting max cubemap size to 1024, setting max texture size to 1024."),
w.max_texture_size=1024,w.max_cube_map_size=1024)};a.check_user_agent=u;a.detect_mobile=c;a.apply_context_alpha_hack=function(){u("Firefox/35.0")&&u("Windows")&&(k.warn("Windows/Firefox 35 detected, forcing context's alpha"),h.context.alpha=!0)};a.is_ie11=b};b4w.module.__constraints=function(a,r){function u(a){var e={};e.type=a;return e}function c(a,e){a.constraint&&a.constraint.obj_parent&&b(a.constraint.obj_parent,a);if(e.obj_parent){var n=e.obj_parent;if(-1==n.cons_descends.indexOf(a))n.cons_descends.push(a);else throw"Descendant object override is forbidden";}a.constraint=e}function b(a,e){var b=a.cons_descends.indexOf(e);if(-1!=b)a.cons_descends.splice(b,1);else throw"No descendant object";}function h(a,b,c){switch(b.type){case 1:var d=l.get_quat_view(a.render.world_tsr),
g=b.obj_parent.render.world_tsr;c=l.get_quat_view(b.obj_parent.render.world_tsr);b.rotation_offset?(m.copy(b.rotation_offset,d),m.multiply(c,d,d)):m.copy(c,d);var K=l.transform_vec3(b.offset,g,x);l.set_trans(K,a.render.world_tsr);K=l.get_scale(b.obj_parent.render.world_tsr);l.set_scale(b.scale_offset*K,a.render.world_tsr);break;case 9:K=l.get_trans_view(a.render.world_tsr);d=l.get_quat_view(a.render.world_tsr);g=b.obj_parent.render.world_tsr;c=l.get_quat_view(b.obj_parent.render.world_tsr);m.multiply(m.invert(b.parent_prev_rotation,
b.parent_prev_rotation),d,d);m.multiply(c,d,d);l.transform_vec3(b.offset,g,K);m.copy(c,b.parent_prev_rotation);break;case 10:K=l.get_trans_view(a.render.world_tsr);d=l.get_quat_view(a.render.world_tsr);g=b.obj_parent.render.world_tsr;c=l.get_quat_view(b.obj_parent.render.world_tsr);m.multiply(m.invert(b.parent_prev_rotation,b.parent_prev_rotation),d,d);m.multiply(c,d,d);l.transform_vec3(b.offset,g,K);m.copy(c,b.parent_prev_rotation);K=l.get_quat_view(a.render.world_tsr);d=l.get_quat_view(b.obj_parent.render.world_tsr);
d=m.multiply(d,b.rotation_offset,e);d=f.get_camera_angles_from_quat(d,H);c=f.get_camera_angles_from_quat(K,C);K=t.calc_returning_angle(c[0],d[0]+b.clamp_right,d[0]+b.clamp_left);d=t.calc_returning_angle(c[1],d[1]+b.clamp_down,d[1]+b.clamp_up);f.rotate_eye_camera(a,K,d);break;case 13:var K=l.get_trans_view(a.render.world_tsr),d=l.get_quat_view(a.render.world_tsr),g=b.obj_parent.render.world_tsr,B=l.get_trans_view(g),N=b.softness,J=x,h=e;l.transform_vec3(b.offset,g,J);t.smooth_v(J,K,c,N,K);g=x;F.sub(B,
K,g);F.normalize(g,g);var O=d,K=n,B=K.subarray(0,3),J=K.subarray(3,6),z=K.subarray(6,9);F.copy(g,J);F.negate(J,J);F.normalize(J,J);Boolean(.999999<Math.abs(F.dot(g,t.AXIS_Y)))?(g=w.fromQuat(m.normalize(O,h),M),F.copy(g.subarray(0,3),B)):F.cross(t.AXIS_Y,J,B);F.normalize(B,B);F.cross(B,J,z);F.normalize(z,z);m.fromMat3(K,h);m.normalize(h,h);t.smooth_q(h,d,c,.16*N,d);break;case 2:d=l.get_quat_view(a.render.world_tsr);c=D;p.get_bone_tsr(b.obj_parent,b.bone_name,!0,!1,c);l.multiply(b.obj_parent.render.world_tsr,
c,c);d[0]=c[4];d[1]=c[5];d[2]=c[6];d[3]=c[7];b.rotation_offset&&(m.copy(b.rotation_offset,d),m.multiply(d,b.rotation_offset,d));l.set_scale(b.scale_offset*c[3],a.render.world_tsr);K=l.get_trans_view(a.render.world_tsr);l.transform_vec3(b.offset,c,K);break;case 3:K=l.get_trans_view(a.render.world_tsr);d=l.get_quat_view(a.render.world_tsr);c=l.get_trans_view(b.obj_parent.render.world_tsr);q(K,d,c);break;case 4:K=l.get_trans_view(a.render.world_tsr);d=l.get_quat_view(a.render.world_tsr);c=b.target;q(K,
d,c);break;case 5:K=l.get_trans_view(a.render.world_tsr);d=l.get_quat_view(a.render.world_tsr);c=l.get_trans_view(b.obj_parent.render.world_tsr);q(K,d,c);d=F.dist(K,c);if(d=d>b.dist_max?d-b.dist_max:d<b.dist_min?d-b.dist_min:0)F.sub(c,K,x),F.normalize(x,x),F.scale(x,d,x),F.add(K,x,K);break;case 6:K=l.get_trans_view(a.render.world_tsr);d=l.get_quat_view(a.render.world_tsr);c=b.target;q(K,d,c);d=F.dist(K,c);if(d=d>b.dist_max?d-b.dist_max:d<b.dist_min?d-b.dist_min:0)F.sub(c,K,x),F.normalize(x,x),F.scale(x,
d,x),F.add(K,x,K);break;case 7:g=b.obj_parent.render.world_tsr;K=l.get_trans_view(a.render.world_tsr);l.transform_vec3(b.offset,g,K);break;case 8:B=l.get_trans_view(b.obj_parent.render.world_tsr);K=l.get_trans_view(a.render.world_tsr);F.add(B,b.offset,K);break;case 14:d=l.get_quat_view(a.render.world_tsr);g=b.obj_parent.render.world_tsr;c=l.get_quat_view(b.obj_parent.render.world_tsr);b.rotation_offset?(m.copy(b.rotation_offset,d),m.multiply(c,d,d)):m.copy(c,d);K=l.get_trans_view(a.render.world_tsr);
l.transform_vec3(b.offset,g,K);break;case 11:l.multiply(b.obj_parent.render.world_tsr,b.tsr_offset,a.render.world_tsr);break;case 12:K=b.tsr_offset;c=D;p.get_bone_tsr(b.obj_parent,b.bone_name,!0,!1,c);l.multiply(b.obj_parent.render.world_tsr,c,c);l.multiply(c,K,a.render.world_tsr);break;case 15:d=b.obj_parent,c=f.get_first_cam(d),K=l.get_trans_view(a.render.world_tsr),g=f.get_edge(c,"LEFT"),B=f.get_edge(c,"RIGHT"),N=f.get_edge(c,"TOP"),h=f.get_edge(c,"BOTTOM"),J="heights"==b.hor_units?N-h:B-g,b.left_edge?
(g=f.get_edge(c,"LEFT"),K[0]=g+J*b.left_right_dist):(B=f.get_edge(c,"RIGHT"),K[0]=B-J*b.left_right_dist),g="heights"==b.vert_units?N-h:B-g,K[2]=b.top_edge?-(N-g*b.top_bottom_dist):-(h+g*b.top_bottom_dist),f.is_ortho(c)?K[1]=-b.distance:(K[1]=-1,F.normalize(K,K),c=b.distance/Math.abs(K[1]),F.scale(K,c,K)),l.transform_dir_vec3(K,d.render.world_tsr,K),c=l.get_trans_view(d.render.world_tsr),F.add(c,K,K),K=l.get_quat_view(a.render.world_tsr),d=l.get_quat_view(d.render.world_tsr),b.rotation_offset?(m.copy(b.rotation_offset,
K),m.multiply(d,K,K)):m.copy(d,K)}"CAMERA"==a.render.type&&(K=t.AXIS_Y,10==b.type&&(c=l.get_quat_view(b.obj_parent.render.world_tsr),K=F.transformQuat(K,c,G)),f.update_camera_upside_down(a),k(a,K))}function d(a,b){switch(b.type){case 1:var e=b.target.render.world_tsr,c=D;l.invert(a.render.world_tsr,c);l.multiply(c,e,c);p.set_bone_tsr(a,b.bone_name,c,!1)}a.need_update_transform=!0}function q(a,b,e){var c=x;t.quat_to_dir(b,t.AXIS_MY,c);F.normalize(c,c);var n=y;F.subtract(e,a,n);F.normalize(n,n);a=t.rotation_to_stable(c,
n,E);m.multiply(a,b,b);m.normalize(b,b)}function k(a,b,c){var n=a.render,d=l.get_quat_view(n.world_tsr),g=t.quat_to_dir(d,t.AXIS_Y,x);F.normalize(g,g);if(.999999<Math.abs(F.dot(b,g)))g=m.identity(e);else{var B=F.cross(b,g,y);F.normalize(B,B);n.move_style==f.MS_TARGET_CONTROLS?n.target_cam_upside_down&&F.negate(B,B):(n=t.quat_to_dir(d,t.AXIS_Z,z),0<F.dot(n,b)&&F.negate(B,B));n=t.quat_to_dir(d,t.AXIS_X,z);F.normalize(n,n);var N=t.clamp(F.dot(n,B),-1,1);-.999999>=N?(B=Math.acos(N),g=m.setAxisAngle(g,
B,e)):g=m.rotationTo(n,B,e);m.normalize(g,g)}m.multiply(g,d,d);c&&(c=t.quat_to_dir(d,t.AXIS_MZ,x),0>F.dot(b,c)&&m.rotateY(d,Math.PI,d));f.update_camera_upside_down(a)}var p=r("__armature"),f=r("__camera"),w=r("__mat3"),g=r("__print"),m=r("__quat"),l=r("__tsr"),t=r("__util"),F=r("__vec3");a.CONS_TYPE_STIFF_OBJ=1;a.CONS_TYPE_STIFF_BONE=2;a.CONS_TYPE_TRACK_OBJ=3;a.CONS_TYPE_TRACK_POINT=4;a.CONS_TYPE_FOLLOW_OBJ=5;a.CONS_TYPE_FOLLOW_POINT=6;a.CONS_TYPE_STIFF_TRANS_OBJ=7;a.CONS_TYPE_COPY_TRANS_OBJ=8;a.CONS_TYPE_SEMI_STIFF_OBJ=
9;a.CONS_TYPE_SEMI_STIFF_CAM_OBJ=10;a.CONS_TYPE_CHILD_OF=11;a.CONS_TYPE_CHILD_OF_BONE=12;a.CONS_TYPE_SEMI_SOFT_CAM_OBJ=13;a.CONS_TYPE_STIFF_TRANS_ROT_OBJ=14;a.CONS_TYPE_STIFF_VIEWPORT=15;a.BONE_CONS_TYPE_STIFF_OBJ=1;var H=new Float32Array(2),C=new Float32Array(2),x=new Float32Array(3),y=new Float32Array(3),z=new Float32Array(3),E=new Float32Array(4),e=new Float32Array(4),n=new Float32Array(9),M=new Float32Array(9),D=l.create(),G=new Float32Array(3);a.append_stiff_obj=function(a,b,e,n,d){var f=u(1);
f.obj_parent=b;f.offset=new Float32Array(e);f.rotation_offset=n?new Float32Array(n):null;f.scale_offset=d;c(a,f);h(a,f,0)};a.append_stiff_bone=function(a,b,e,n,d,f){var B=u(2);B.obj_parent=b;B.bone_name=e;B.offset=new Float32Array(n);B.rotation_offset=d?new Float32Array(d):null;B.scale_offset=f;c(a,B);h(a,B,0)};a.append_semi_stiff_obj=function(a,b,e,n){var d=u(9),f=l.get_quat_view(a.render.world_tsr),B=l.get_quat_view(b.render.world_tsr);d.obj_parent=b;d.offset=new Float32Array(e);d.parent_prev_rotation=
new Float32Array(B);n&&(m.copy(n,f),m.multiply(B,f,f));c(a,d);h(a,d,0)};a.append_semi_stiff_cam_obj=function(a,b,e,n,d,f,B,N){var J=u(10),g=l.get_quat_view(a.render.world_tsr),M=l.get_quat_view(b.render.world_tsr);J.obj_parent=b;J.offset=new Float32Array(e);J.parent_prev_rotation=new Float32Array(M);J.clamp_left=t.angle_wrap_0_2pi(d);J.clamp_right=t.angle_wrap_0_2pi(f);J.clamp_up=t.angle_wrap_periodic(B,-Math.PI,Math.PI);J.clamp_down=t.angle_wrap_periodic(N,-Math.PI,Math.PI);n?(J.rotation_offset=
new Float32Array(n),m.copy(n,g),m.multiply(M,g,g)):J.rotation_offset=m.create();c(a,J);h(a,J,0)};a.append_semi_soft_cam_obj=function(a,b,e,n){var d=u(13);d.obj_parent=b;d.offset=new Float32Array(e);d.softness=n;c(a,d);h(a,d,0)};a.append_stiff_trans_rot_obj=function(a,b,e,n,d){var f=u(14);f.obj_parent=b;f.offset=new Float32Array(e);f.scale_offset=d||1;f.rotation_offset=n?new Float32Array(n):null;c(a,f);h(a,f,0)};a.remove_parent_descendant=b;a.append_track_obj=function(a,b){var e=u(3);e.obj_parent=
b;c(a,e);h(a,e,0)};a.append_track_point=function(a,b){var e=u(4);e.target=new Float32Array(b);c(a,e);h(a,e,0)};a.append_follow_obj=function(a,b,e,n){var d=u(5);d.obj_parent=b;d.dist_min=e;d.dist_max=n;c(a,d);h(a,d,0)};a.append_follow_point=function(a,b,e,n){var d=u(6);d.target=new Float32Array(b);d.dist_min=e;d.dist_max=n;c(a,d);h(a,d,0)};a.append_stiff_trans_obj=function(a,b,e){var n=u(7);n.obj_parent=b;n.offset=new Float32Array(e);c(a,n);h(a,n,0)};a.append_copy_trans_obj=function(a,b,e){var n=u(8);
n.obj_parent=b;n.offset=new Float32Array(e);c(a,n);h(a,n,0)};a.append_child_of=function(a,b,e){var n=u(11);n.obj_parent=b;n.tsr_offset=new Float32Array(e);c(a,n);h(a,n,0)};a.append_child_of_bone=function(a,b,e,n){var d=u(12);d.obj_parent=b;d.bone_name=e;d.tsr_offset=new Float32Array(n);c(a,d);h(a,d,0)};a.append_stiff_viewport=function(a,b,e){var n=u(15);n.obj_parent=b;if(t.isdef(e.left))n.left_edge=!0,n.left_right_dist=e.left;else if(t.isdef(e.right))n.left_edge=!1,n.left_right_dist=e.right;else{g.error("append_stiff_viewport: Wrong positioning params");
return}if(t.isdef(e.top))n.top_edge=!0,n.top_bottom_dist=e.top;else if(t.isdef(e.bottom))n.top_edge=!1,n.top_bottom_dist=e.bottom;else{g.error("append_stiff_viewport: Wrong positioning params");return}t.isdef(e.distance)?(n.distance=e.distance,t.isdef(e.rotation)?n.rotation_offset=new Float32Array(e.rotation):n.rotation_offset=null,t.isdef(e.hor_units)?n.hor_units=e.hor_units:n.hor_units="widths",t.isdef(e.vert_units)?n.vert_units=e.vert_units:n.vert_units="heights",c(a,n),h(a,n,0)):g.error("append_stiff_viewport: Wrong positioning params")};
a.update_constraint=function(a,b){a.constraint&&h(a,a.constraint,b)};a.append_stiff_bone_to_obj=function(a,b,e,n,c,f){var B=u(1);B.bone_name=e;B.target=b;B.offset=new Float32Array(n);B.rotation_offset=c?new Float32Array(c):null;B.scale_offset=f;b=B.target;e=B.bone_name;n=a.render.bone_pointers[e];c=b.cons_armat_bone_descends;for(f=0;f<c;f++){var N=c[f];if(N[0]==a&&N[1]==e){c.splice(f,1);break}}b.cons_armat_bone_descends.push([a,e]);n.constraint=B;d(a,B)};a.update_bone_constraint=function(a,b){var e=
a.render.bone_pointers[b];e.constraint&&d(a,e.constraint)};a.rotate_to=q;a.correct_up=k;a.check_constraint=function(a){return a.constraint?!0:!1};a.remove=function(a){a.constraint.obj_parent&&b(a.constraint.obj_parent,a);a.constraint=null};a.get_type=function(a){return a.constraint?a.constraint.type:null};a.has_child_of=function(a){a=a.constraint;return!a||11!=a.type&&12!=a.type?!1:!0};a.get_child_of_parent_tsr=function(a){if((a=a.constraint)&&11==a.type)return a.obj_parent.render.world_tsr;if(a&&
12==a.type){var b=D;p.get_bone_tsr(a.obj_parent,a.bone_name,!0,!1,b);l.multiply(a.obj_parent.render.world_tsr,b,b);return b}return null};a.get_child_of_offset=function(a){a=a.constraint;return!a||11!=a.type&&12!=a.type?null:a.tsr_offset}};b4w.module.__container=function(a,r){var u,c,b,h,d;function q(a,b){u=a;c=b}function k(){var a=y.getBoundingClientRect();q(a.left,a.top)}function p(){return x.allow_hidpi&&2<=window.devicePixelRatio?!0:!1}var f=r("__anchors"),w=r("__config"),g=r("__data"),m=r("__hud"),l=r("__print"),t=r("__scenes"),F=r("__time"),H=r("__transform"),C=r("__util"),x=w.defaults,y=null,z=null,E=null,e=!1;h=b=0;d=1;u=c=0;var n=null;a.DEFAULT_CANVAS_W=320;a.DEFAULT_CANVAS_H=240;a.setup_context=function(a){n=a};a.get_canvas=
function(){return y};a.get_canvas_hud=function(){return z};a.get_container=function(){return E};a.init=function(a,b){a&&a.parentNode?(y=a,z=b,E=a.parentNode):C.panic("canvas container is not available")};a.insert_to_container=function(a,b){b=b||"LAST";switch(b){case "FIRST":E.insertBefore(a,E.firstElementChild);break;case "JUST_BEFORE_CANVAS":E.insertBefore(a,y);break;case "JUST_AFTER_CANVAS":y.nextElementSibling?E.insertBefore(a,y.nextElementSibling):E.appendChild(a,y);break;case "LAST":E.appendChild(a,
y);break;default:l.error(b+" invalid stack order")}};a.get_viewport_width=function(){return b};a.get_viewport_height=function(){return h};a.set_canvas_offsets=q;a.update_canvas_offsets=k;a.setup_viewport_dim=function(a,e,n){b=a;h=e;d=n;k()};a.force_offsets_updating=function(){e=!0};a.client_to_canvas_coords=function(a,b,n){n||(n=new Float32Array(2));var d=n;e&&(k(),e=!1);d[0]=a-u;a=n;e&&(k(),e=!1);a[1]=b-c;return n};a.canvas_to_viewport_coords=function(a,e,n,c){n||(n=new Float32Array(2));n[0]=a*d;
n[1]=e*d;c&&(a=c.width/b,n[0]*=a,n[1]*=a);return n};a.viewport_to_canvas_coords=function(a,e,n,c){n||(n=new Float32Array(2));n[0]=a/d;n[1]=e/d;c&&(a=c.width/b,n[0]/=a,n[1]/=a);return n};a.is_child=function(b){return b&&b.parentNode?b.parentNode==E?!0:a.is_child(b.parentNode):!1};a.is_hidpi=p;a.find_script=function(a){var b=document.getElementsByTagName("script");a=C.normpath_preserve_protocol(a);for(var e=0;e<b.length;e++)if(b[e].src==a)return b[e];return null};a.resize=function(b,e,c){if(!b||!e){b=
a.DEFAULT_CANVAS_W;e=a.DEFAULT_CANVAS_H;var d=E;d.style.width=a.DEFAULT_CANVAS_W+"px";d.style.height=a.DEFAULT_CANVAS_H+"px"}var d=y,h=z;!1!==c&&(d.style.width=b+"px",d.style.height=e+"px",h&&(h.style.width=b+"px",h.style.height=e+"px"));h&&(h.width=b,h.height=e,m.update_dim());c=Math.floor(b*x.canvas_resolution_factor);e=Math.floor(e*x.canvas_resolution_factor);p()&&(c*=window.devicePixelRatio,e*=window.devicePixelRatio);if(h=t.get_main())h=h._render,c=Math.floor(c*h.resolution_factor),e=Math.floor(e*
h.resolution_factor);d.width=c;d.height=e;if(c>n.drawingBufferWidth||e>n.drawingBufferHeight)l.warn("Canvas size exceeds platform limits, downscaling"),h=Math.min(n.drawingBufferWidth/c,n.drawingBufferHeight/e),c*=h,e*=h,d.width=c,d.height=e;t.setup_dim(c,e,c/b);t.check_active()&&H.update_transform(t.get_active()._camera);g.update_media_controls(d.width,d.height);g.is_primary_loaded()&&(f.update(),t.update(F.get_timeline(),0),f.update_visibility())}};b4w.module.__controls=function(a,r){function u(a,b){b||(b=m.get_container());return{type:a,value:0,payload:null,element:b,do_activation:!1,key:0,collision_id:"",calc_pos_norm:!1,collision_obj:null,collision_cb:function(){},col_imp_obj:null,col_imp_cb:function(){},source_object:null,from:new Float32Array(3),to:new Float32Array(3),is_binary_value:!1,ign_src_rot:!1,ray_test_id:0,ray_test_cb:function(){},axis:"",time_last:0,trans_last:new Float32Array(3),quat_last:new Float32Array(4),threshold:0,quat_temp:new Float32Array(4),
avg_linear_vel:0,avg_angular_vel:0,rotation_threshold:0,avg_vertical_vel:0,period:0,repeat:!1,auto_release:!1,gamepad_id:0,callback:function(){}}}function c(a){a||(a=m.get_container());for(var b=0;b<v.length;b++){var c=v[b];if(a==c.element)return c}c={element:a,is_updated_keyboard:!0,is_mouse_downed:!1,is_touch_ended:!0,mouse_last_x:0,mouse_last_y:0,mouse_curr_x:0,mouse_curr_y:0,touches_last_x:new Float32Array(2),touches_curr_x:new Float32Array(2),touches_last_y:new Float32Array(2),touches_curr_y:new Float32Array(2),
touch_zoom_curr_dist:0,touch_zoom_last_dist:0,touch_start_rot:0,downed_keys:new Uint8Array(256),wheel_delta:0,selected_obj:null,is_updated_gyro_quat:!1,gyro_quat:C.create(),gyro_gamma_new:0,gyro_beta_new:0,gyro_alpha_new:0,gyro_gamma_last:0,gyro_beta_last:0,gyro_alpha_last:Infinity,keyboard_downed_keys_cb:null,registered_accum_values:{},orientation_quat_cb:function(a){c.is_updated_gyro_quat||(l.gyro_angles_to_quat(a,c.gyro_quat),c.is_updated_gyro_quat=!0)},orientation_angles_cb:function(a){a=E.copy(a,
I);c.gyro_alpha_new=a[0];c.gyro_beta_new=a[1];c.gyro_gamma_new=a[2];Infinity==c.gyro_alpha_last&&(c.gyro_alpha_last=a[0],c.gyro_beta_last=a[1],c.gyro_gamma_last=a[2])},mouse_wheel_cb:function(a){c.wheel_delta+=a*e.mouse_wheel_notch_multiplier},mouse_down_which_cb:function(a){var b=l.get_device_by_type_element(l.DEVICE_MOUSE,c.element),b=l.get_vector_param(b,l.MOUSE_LOCATION,P);c.mouse_last_x=b[0];c.mouse_last_y=b[1];c.mouse_curr_x=b[0];c.mouse_curr_y=b[1];c.is_mouse_downed=!0;c.which=a},mouse_select_cb:function(a){a=
l.get_device_by_type_element(l.DEVICE_MOUSE,c.element);a=l.get_vector_param(a,l.MOUSE_LOCATION,P);a=m.client_to_canvas_coords(a[0],a[1],P);c.selected_obj=t.pick_object(a[0],a[1])},touch_select_cb:function(a){1==a.length&&(a=m.client_to_canvas_coords(a[0].clientX,a[0].clientY,P),c.selected_obj=t.pick_object(a[0],a[1]))},mouse_up_which_cb:function(a){c.is_mouse_downed=!1},mouse_location_cb:function(a){if(!n.ie11_edge_touchscreen_hack||c.is_mouse_downed)c.mouse_curr_x=a[0],c.mouse_curr_y=a[1]},keyboard_down_keys_cb:function(a){2!=
c.downed_keys[a]&&(c.downed_keys[a]=1,c.is_updated_keyboard=!1)},keyboard_up_keys_cb:function(a){1==c.downed_keys[a]?c.downed_keys[a]=0:(c.is_updated_keyboard&=0,c.downed_keys[a]=3)},touch_start_cb:function(a){c.is_touch_ended=!1;if(1==a.length)c.touches_last_x[0]=a[0].clientX,c.touches_last_x[1]=-1,c.touches_last_y[0]=a[0].clientY,c.touches_last_y[1]=-1;else if(1<a.length){var b=f(a);c.touch_zoom_curr_dist=c.touch_zoom_last_dist=b;c.touches_last_x[0]=a[0].clientX;c.touches_last_x[1]=a[1].clientX;
c.touches_last_y[0]=a[0].clientY;c.touches_last_y[1]=a[1].clientY;var b=c,e=a[0];a=a[1];a=Math.atan2(e.clientY-a.clientY,e.clientX-a.clientX);b.touch_start_rot=a}c.touches_curr_x.set(c.touches_last_x);c.touches_curr_y.set(c.touches_last_y)},touch_move_cb:function(a){1===a.length?(c.touches_curr_x[0]=a[0].clientX,c.touches_curr_x[1]=-1,c.touches_curr_y[0]=a[0].clientY,c.touches_curr_y[1]=-1):1<a.length&&(c.touches_curr_x[0]=a[0].clientX,c.touches_curr_x[1]=a[1].clientX,c.touches_curr_y[0]=a[0].clientY,
c.touches_curr_y[1]=a[1].clientY,a=f(a),c.touch_zoom_curr_dist=a)},touch_end_cb:function(a){0==a.length&&(c.is_touch_ended=!0)}};v.push(c);return c}function b(a,b){if(b in a.registered_accum_values&&0<a.registered_accum_values[b])a.registered_accum_values[b]+=1;else switch(a.registered_accum_values[b]=1,b){case "orientation_quat":var e=l.get_device_by_type_element(l.DEVICE_GYRO);e&&l.attach_param_cb(e,l.GYRO_ORIENTATION_ANGLES,a.orientation_quat_cb);break;case "orientation_angles":(e=l.get_device_by_type_element(l.DEVICE_GYRO))&&
l.attach_param_cb(e,l.GYRO_ORIENTATION_ANGLES,a.orientation_angles_cb);break;case "mouse_wheel":(e=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element))&&l.attach_param_cb(e,l.MOUSE_WHEEL,a.mouse_wheel_cb);break;case "mouse_down_which":(e=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element))&&l.attach_param_cb(e,l.MOUSE_DOWN_WHICH,a.mouse_down_which_cb);break;case "mouse_select":(e=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element))&&l.attach_param_cb(e,l.MOUSE_DOWN_WHICH,a.mouse_select_cb);
break;case "touch_select":(e=l.get_device_by_type_element(l.DEVICE_TOUCH,a.element))&&l.attach_param_cb(e,l.TOUCH_START,a.touch_select_cb);break;case "mouse_up_which":(e=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element))&&l.attach_param_cb(e,l.MOUSE_UP_WHICH,a.mouse_up_which_cb);break;case "mouse_location":(e=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element))&&l.attach_param_cb(e,l.MOUSE_LOCATION,a.mouse_location_cb);break;case "keyboard_downed_keys":if(e=l.get_device_by_type_element(l.DEVICE_KEYBOARD,
a.element))l.attach_param_cb(e,l.KEYBOARD_DOWN,a.keyboard_down_keys_cb),l.attach_param_cb(e,l.KEYBOARD_UP,a.keyboard_up_keys_cb);break;case "touch_start":(e=l.get_device_by_type_element(l.DEVICE_TOUCH,a.element))&&l.attach_param_cb(e,l.TOUCH_START,a.touch_start_cb);break;case "touch_move":(e=l.get_device_by_type_element(l.DEVICE_TOUCH,a.element))&&l.attach_param_cb(e,l.TOUCH_MOVE,a.touch_move_cb);break;case "touch_end":(e=l.get_device_by_type_element(l.DEVICE_TOUCH,a.element))&&l.attach_param_cb(e,
l.TOUCH_END,a.touch_end_cb)}}function h(a,b){if(!(!b in a.registered_accum_values)&&0<a.registered_accum_values[b]&&(--a.registered_accum_values[b],!a.registered_accum_values[b]))switch(b){case "orientation_quat":var e=l.get_device_by_type_element(l.DEVICE_GYRO);e&&l.detach_param_cb(e,l.GYRO_ORIENTATION_QUAT,a.orientation_quat_cb);break;case "orientation_angles":(e=l.get_device_by_type_element(l.DEVICE_GYRO))&&l.detach_param_cb(e,l.GYRO_ORIENTATION_ANGLES,a.orientation_angles_cb);break;case "mouse_wheel":(e=
l.get_device_by_type_element(l.DEVICE_MOUSE,a.element))&&l.detach_param_cb(e,l.MOUSE_WHEEL,a.mouse_wheel_cb);break;case "mouse_down_which":(e=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element))&&l.detach_param_cb(e,l.MOUSE_DOWN_WHICH,a.mouse_down_which_cb);break;case "mouse_select":(e=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element))&&l.detach_param_cb(e,l.MOUSE_DOWN_WHICH,a.mouse_select_cb);break;case "touch_select":(e=l.get_device_by_type_element(l.DEVICE_TOUCH,a.element))&&l.detach_param_cb(e,
l.TOUCH_START,a.touch_select_cb);break;case "mouse_up_which":(e=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element))&&l.detach_param_cb(e,l.MOUSE_UP_WHICH,a.mouse_up_which_cb);break;case "mouse_location":(e=l.get_device_by_type_element(l.DEVICE_MOUSE,a.element))&&l.detach_param_cb(e,l.MOUSE_LOCATION,a.mouse_location_cb);break;case "keyboard_downed_keys":if(e=l.get_device_by_type_element(l.DEVICE_KEYBOARD,a.element))l.detach_param_cb(e,l.KEYBOARD_DOWN,a.keyboard_down_keys_cb),l.detach_param_cb(e,
l.KEYBOARD_UP,a.keyboard_up_keys_cb);break;case "touch_start":(e=l.get_device_by_type_element(l.DEVICE_TOUCH,a.element))&&l.detach_param_cb(e,l.TOUCH_START,a.touch_start_cb);break;case "touch_move":(e=l.get_device_by_type_element(l.DEVICE_TOUCH,a.element))&&l.detach_param_cb(e,l.TOUCH_MOVE,a.touch_move_cb);break;case "touch_end":(e=l.get_device_by_type_element(l.DEVICE_TOUCH,a.element))&&l.detach_param_cb(e,l.TOUCH_END,a.touch_end_cb)}}function d(a,b){a.value=Number(b)}function q(a){for(var b=a.sensors,
e=a.sensor_values,c=0;c<b.length;c++)e[c]=b[c].value;return a.logic_fun(e)}function k(a,b){a=a||D;var e=a.sensor_manifolds;if(e){var c=a.sensor_manifolds_arr;if(b){var n=e[b];if(n){for(var d=n.sensors,f=0;f<d.length;f++){var B=d[f],g;g=Q;var l=G.indexOf(B);g=-1<l?g[l]:[];1==g.length?(p(B),B=G.indexOf(B),-1<B?(G.splice(B,1),Q.splice(B,1)):z.panic("Sensors cache is corrupted")):1<g.length&&g.splice(g.indexOf(n),1)}delete e[b];f=c.indexOf(n);-1<f?c.splice(f,1):z.panic("Incorrect manifolds array");Object.getOwnPropertyNames(e).length||
(e=M.indexOf(a),-1<e?M.splice(e,1):F.error("Wrong object"))}}else{c=[];for(b in e)c.push(b);for(f=0;f<c.length;f++)k(a,c[f])}K=!0}}function p(a){switch(a.type){case 90:H.remove_collision_test(a.collision_obj,a.collision_id,a.collision_cb);a.do_activation=!0;break;case 100:H.clear_collision_impulse_test(a.col_imp_obj);a.do_activation=!0;break;case 110:H.remove_ray_test(a.ray_test_id);a.do_activation=!0;break;case 140:a.do_activation=!0;break;case 20:var b=c(a.element);h(b,"keyboard_downed_keys");a.do_activation=
!0;break;case 30:b=c(a.element);h(b,"mouse_wheel");a.do_activation=!0;break;case 40:b=c(a.element);h(b,"mouse_down_which");h(b,"mouse_up_which");h(b,"mouse_location");a.do_activation=!0;break;case 50:b=c(a.element);h(b,"mouse_down_which");h(b,"mouse_up_which");a.do_activation=!0;break;case 60:b=c(a.element);h(b,"touch_start");h(b,"touch_move");h(b,"touch_end");a.do_activation=!0;break;case 70:b=c(a.element);h(b,"touch_start");h(b,"touch_move");a.do_activation=!0;break;case 75:b=c(a.element);h(b,"touch_start");
h(b,"touch_move");a.do_activation=!0;break;case 80:b=c(a.element);h(b,"touch_start");h(b,"touch_end");a.do_activation=!0;break;case 170:b=c(a.element);h(b,"mouse_select");h(b,"touch_select");h(b,"touch_start");h(b,"touch_end");h(b,"mouse_down_which");h(b,"mouse_up_which");a.do_activation=!0;break;case 180:case 190:b=c(a.element);h(b,"orientation_angles");a.do_activation=!0;break;case 200:b=c(a.element);h(b,"orientation_quat");a.do_activation=!0;break;case 210:case 220:a.do_activation=!0}}function f(a){var b=
a[0],e=a[1];a=b.clientX-e.clientX;b=b.clientY-e.clientY;return Math.sqrt(a*a+b*b)}function w(a){return 0==a?l.get_device_by_type_element(l.DEVICE_GAMEPAD0):1==a?l.get_device_by_type_element(l.DEVICE_GAMEPAD1):2==a?l.get_device_by_type_element(l.DEVICE_GAMEPAD2):l.get_device_by_type_element(l.DEVICE_GAMEPAD3)}var g=r("__config"),m=r("__container"),l=r("__input"),t=r("__objects"),F=r("__print"),H=r("__physics"),C=r("__quat"),x=r("__time"),y=r("__tsr"),z=r("__util"),E=r("__vec3");r("__vec4");var e=g.controls,
n=g.defaults,M=[],D={},G=[],Q=[],v=[],P=new Float32Array(2),S=new Float32Array(2),I=E.create();C.create();var K=!1,B=0;a.CT_POSITIVE=10;a.CT_CONTINUOUS=20;a.CT_TRIGGER=30;a.CT_SHOT=40;a.CT_LEVEL=50;a.CT_CHANGE=60;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.PL_MULTITOUCH_MOVE_ROTATE=3;a.update=function(b,e){for(var f=0;f<G.length;f++){var g=G[f],m=b,h=e;if(h)switch(g.type){case 120:var k=g.source_object,p=y.get_trans_view(k.render.world_tsr),k=y.get_quat_view(k.render.world_tsr),
I=E.dist(g.trans_last,p),t=g.quat_temp;C.invert(g.quat_last,t);C.multiply(k,t,t);C.normalize(t,t);t=Math.abs(2*Math.acos(t[3]));I/=h;g.avg_linear_vel=z.smooth(I,g.avg_linear_vel,h,.3);g.payload[0]=I;I=t/h;g.avg_angular_vel=z.smooth(I,g.avg_angular_vel,h,.3);g.payload[1]=I;g.avg_linear_vel>=g.threshold||g.avg_angular_vel>=g.rotation_threshold?d(g,1):d(g,0);E.copy(p,g.trans_last);C.copy(k,g.quat_last);g.time_last=m;break;case 130:k=g.source_object;p=y.get_trans_view(k.render.world_tsr);k=Math.abs(p[1]-
g.trans_last[1])/h;g.avg_vertical_vel=z.smooth(k,g.avg_vertical_vel,h,.3);g.payload=k;g.avg_vertical_vel>=g.threshold?d(g,1):d(g,0);E.copy(p,g.trans_last);g.time_last=m;break;case 140:!g.do_activation&&0<=g.period&&m-g.time_last>=g.period&&(d(g,1),g.repeat?g.time_last=m:g.period=-g.period);break;case 150:g.time_last||(g.time_last=m);d(g,m-g.time_last);g.time_last=m;break;case 160:d(g,m);break;case 180:h=c(g.element);g.payload[0]=h.gyro_gamma_new-h.gyro_gamma_last;g.payload[1]=h.gyro_beta_new-h.gyro_beta_last;
g.payload[2]=h.gyro_alpha_new-h.gyro_alpha_last;break;case 190:h=c(g.element);g.payload[0]=h.gyro_gamma_new;g.payload[1]=h.gyro_beta_new;g.payload[2]=h.gyro_alpha_new;break;case 200:h=c(g.element);C.copy(h.gyro_quat,g.payload);break;case 210:m=l.get_device_by_type_element(l.DEVICE_HMD);l.get_vector_param(m,l.HMD_ORIENTATION_QUAT,g.payload);break;case 220:m=l.get_device_by_type_element(l.DEVICE_HMD);l.get_vector_param(m,l.HMD_POSITION,g.payload);break;case 240:m=w(g.gamepad_id);g.value=l.get_gamepad_btn_value(m,
g.key);break;case 250:m=w(g.gamepad_id);g.value=l.get_gamepad_axis_value(m,g.key);break;case 230:d(g,g.callback());break;case 30:h=c(g.element);d(g,h.wheel_delta);break;case 40:h=c(g.element);if(!n.ie11_edge_touchscreen_hack||h.is_mouse_downed)switch(m=h.mouse_curr_x-h.mouse_last_x,p=h.mouse_curr_y-h.mouse_last_y,g.axis){case "X":d(g,m);g.payload=h.mouse_curr_x;break;case "Y":d(g,p);g.payload=h.mouse_curr_y;break;case "XY":k=Math.sqrt(m*m+p*p),d(g,k),g.payload[0]=h.mouse_curr_x,g.payload[1]=h.mouse_curr_y}break;
case 50:h=c(g.element);d(g,h.is_mouse_downed);g.payload=h.which;break;case 170:h=c(g.element);g.auto_release&&!h.is_mouse_downed&&h.is_touch_ended||h.selected_obj!=g.source_object?d(g,0):d(g,1);break;case 20:h=c(g.element);g.payload=h.downed_keys[g.key];1==g.payload||h.downed_keys[0]&&16==g.key?d(g,1):g.payload&&3!=g.payload||d(g,0);break;case 60:h=c(g.element);-1==h.touches_curr_x[1]&&-1==h.touches_curr_y[1]?(m=h.touches_curr_x[0]-h.touches_last_x[0],p=h.touches_curr_y[0]-h.touches_last_y[0],k=Math.sqrt(m*
m+p*p),-1!=h.touches_last_x[1]&&-1!=h.touches_last_y[1]&&(I=h.touches_curr_x[0]-h.touches_last_x[1],h=h.touches_curr_y[0]-h.touches_last_y[1],t=Math.sqrt(I*I+h*h),t<k&&(m=I,p=h,k=t)),g.payload=a.PL_SINGLE_TOUCH_MOVE):(p=P,p[0]=(h.touches_curr_x[0]+h.touches_curr_x[1])/2,p[1]=(h.touches_curr_y[0]+h.touches_curr_y[1])/2,k=S,k[0]=(h.touches_last_x[0]+h.touches_last_x[1])/2,k[1]=(h.touches_last_y[0]+h.touches_last_y[1])/2,m=p[0]-k[0],p=p[1]-k[1],k=Math.sqrt(m*m+p*p),g.payload=a.PL_MULTITOUCH_MOVE_PAN);
switch(g.axis){case "X":d(g,m);break;case "Y":d(g,p);break;case "XY":d(g,k)}break;case 70:h=c(g.element);m=h.touch_zoom_curr_dist-h.touch_zoom_last_dist;g.payload=a.PL_MULTITOUCH_MOVE_ZOOM;d(g,m);break;case 75:h=c(g.element);-1!=h.touches_curr_x[1]&&(m=Math.atan2(h.touches_curr_y[0]-h.touches_curr_y[1],h.touches_curr_x[0]-h.touches_curr_x[1]),g.payload=a.PL_MULTITOUCH_MOVE_ROTATE,d(g,m-h.touch_start_rot));break;case 80:h=c(g.element),h.is_touch_ended?d(g,0):d(g,1)}}for(f=0;f<M.length;f++)for(h=M[f],
g=h.sensor_manifolds_arr,m=0;m<g.length;m++)if(p=g[m],p.update_counter!=B){p.update_counter=B;t=p;k=0;switch(t.type){case a.CT_POSITIVE:k=(I=q(t))?1:0;break;case a.CT_CONTINUOUS:k=t.last_pulse;(I=q(t))?(k=1,t.last_pulse=1):1==k?(k=-1,t.last_pulse=-1):k=0;break;case a.CT_TRIGGER:k=t.last_pulse;(I=q(t))&&-1==k?(k=1,t.last_pulse=1):I||1!=k?k=0:(k=-1,t.last_pulse=-1);break;case a.CT_SHOT:k=t.last_pulse;(I=q(t))&&-1==k?(k=1,t.last_pulse=1):I||1!=k?k=0:(k=0,t.last_pulse=-1);break;case a.CT_LEVEL:I=q(t);
t.last_logic_result!=I?(k=1,t.last_logic_result=I):k=0;break;case a.CT_CHANGE:for(var I=t.sensors,t=t.last_sensor_values,x=0;x<I.length;x++){var Q=I[x].value;k||Q==t[x]||(k=1);t[x]=Q}break;default:z.panic("Wrong sensor manifold type: "+t.type)}if(k&&(I=h==D?null:h,K=!1,p.callback(I,p.id,k,p.callback_param),K)){f=-1;break}}for(f=0;f<M.length;f++)for(h=M[f],g=h.sensor_manifolds_arr,m=0;m<g.length;m++)for(p=g[m],h=p.sensors,p=0;p<h.length;p++)switch(k=h[p],k.type){case 30:d(k,0);break;case 40:d(k,0);
break;case 60:d(k,0);break;case 70:d(k,0);break;case 75:d(k,0);break;case 80:d(k,0);break;case 140:d(k,0)}for(f=0;f<v.length;f++){g=v[f];if(!g.is_updated_keyboard){for(m=0;m<g.downed_keys.length;m++)1==g.downed_keys[m]?g.downed_keys[m]=2:3==g.downed_keys[m]&&(g.downed_keys[m]=0);g.is_updated_keyboard=!0}g.wheel_delta=0;g.mouse_last_x=g.mouse_curr_x;g.mouse_last_y=g.mouse_curr_y;g.downed_keys[0]=!1;g.touches_last_x.set(g.touches_curr_x);g.touches_last_y.set(g.touches_curr_y);g.touch_zoom_last_dist=
g.touch_zoom_curr_dist;g.gyro_gamma_last=g.gyro_gamma_new;g.gyro_beta_last=g.gyro_beta_new;g.gyro_alpha_last=g.gyro_alpha_new;g.is_updated_gyro_quat=!1}B++};a.create_custom_sensor=function(a){var b=u(10);d(b,a);return b};a.create_keyboard_sensor=function(a){var b=u(20,document);b.key=a;b.do_activation=!0;return b};a.create_gamepad_btn_sensor=function(a,b){var e=u(240,document);b=b||l.get_first_gmpd_id();e.gamepad_id=b;e.key=a;e.do_activation=!0;return e};a.create_gamepad_axis_sensor=function(a,b){var e=
u(250,document);b=void 0==b?l.get_first_gmpd_id():b;e.gamepad_id=b;e.key=a;e.do_activation=!0;return e};a.create_collision_sensor=function(a,b,e){if(!a||!H.obj_has_physics(a))return F.error("Wrong collision object"),null;var c=u(90);c.collision_obj=a;c.collision_id=b;c.calc_pos_norm=e;c.payload={coll_obj:null,coll_pos:e?new Float32Array(3):null,coll_norm:e?new Float32Array(3):null,coll_dist:0};c.collision_cb=function(a,b,e,n,f){d(c,a);a=c.payload;a.coll_obj=b;c.calc_pos_norm&&(a.coll_pos.set(e),a.coll_norm.set(n),
a.coll_dist=f)};c.do_activation=!0;return c};a.create_collision_impulse_sensor=function(a){if(!a||!a.physics)return F.error("Wrong collision impulse object"),null;var b=u(100);b.col_imp_obj=a;b.col_imp_cb=function(a){d(b,a)};b.do_activation=!0;return b};a.create_ray_sensor=function(a,b,e,c,n,f,g){var B=u(110);B.source_object=a;B.from=b;B.to=e;B.collision_id=c;B.is_binary_value=n;B.calc_pos_norm=f;B.ign_src_rot=g;B.payload={hit_fract:0,obj_hit:null,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),
ray_test_id:0};B.ray_test_cb=function(a,b,e,c,n,f){B.is_binary_value?d(B,-1==b?0:1):d(B,b);B.payload.hit_fract=b;B.payload.obj_hit=e;B.payload.hit_time=c;B.calc_pos_norm&&(B.payload.hit_pos.set(n),B.payload.hit_norm.set(f))};B.do_activation=!0;return B};a.create_mouse_click_sensor=function(a){a=u(50,a);a.do_activation=!0;return a};a.create_mouse_wheel_sensor=function(a){a=u(30,a);a.do_activation=!0;return a};a.create_mouse_move_sensor=function(a,b){var e=u(40,b);e.axis=a||"XY";e.payload="XY"==e.axis?
new Float32Array(2):0;e.do_activation=!0;return e};a.create_touch_move_sensor=function(a,b){var e=u(60,b);e.axis=a||"XY";e.payload=0;e.do_activation=!0;return e};a.create_touch_zoom_sensor=function(a){a=u(70,a);a.payload=0;a.do_activation=!0;return a};a.create_touch_rotate_sensor=function(a){a=u(75,a);a.payload=0;a.do_activation=!0;return a};a.create_touch_click_sensor=function(a){a=u(80,a);a.payload=0;a.do_activation=!0;return a};a.create_motion_sensor=function(a,b,e){if(!a)return F.error("Wrong collision object"),
null;var c=u(120);c.source_object=a;var n=y.get_trans_view(a.render.world_tsr);a=y.get_quat_view(a.render.world_tsr);c.quat_temp=new Float32Array(4);c.trans_last=new Float32Array(n);c.quat_last=new Float32Array(a);c.avg_linear_vel=0;c.avg_angular_vel=0;c.threshold=b||.1;c.rotation_threshold=e||.1;c.time_last=0;c.payload=new Float32Array([0,0]);return c};a.create_vertical_velocity_sensor=function(a,b){if(!a)return F.error("Wrong collision object"),null;var e=u(130);e.source_object=a;var c=y.get_trans_view(a.render.world_tsr),
n=y.get_quat_view(a.render.world_tsr);e.trans_last=new Float32Array(c);e.quat_last=new Float32Array(n);e.avg_vertical_vel=0;e.threshold=b||1;e.time_last=0;e.payload=0;return e};a.create_timer_sensor=function(a,b){var e=u(140);e.period=a;e.repeat=b;e.do_activation=!0;return e};a.reset_timer_sensor=function(a,b,e,c){a=a||D;a=a.sensor_manifolds;if(!a||!a[b])return F.error("reset_timer_sensor(): wrong object"),null;b=a[b].sensors[e];if(!b)return F.error("reset_timer_sensor(): sensor not found"),null;
b.time_last=x.get_timeline();b.period=c};a.create_elapsed_sensor=function(){var a=u(150);a.time_last=0;return a};a.create_gyro_delta_sensor=function(){var a=u(180,window);a.payload=new Float32Array(3);l.get_device_by_type_element(l.DEVICE_GYRO)?d(a,1):d(a,0);a.do_activation=!0;return a};a.create_gyro_angles_sensor=function(){var a=u(190,window);a.payload=new Float32Array(3);l.get_device_by_type_element(l.DEVICE_GYRO)?d(a,1):d(a,0);a.do_activation=!0;return a};a.create_gyro_quat_sensor=function(){var a=
u(200,window);a.payload=C.create();l.get_device_by_type_element(l.DEVICE_GYRO)?d(a,1):d(a,0);a.do_activation=!0;return a};a.create_hmd_quat_sensor=function(){var a=u(210,window);a.payload=C.create();l.get_device_by_type_element(l.DEVICE_HMD)?d(a,1):d(a,0);a.do_activation=!0;return a};a.create_hmd_position_sensor=function(){var a=u(220,window);a.payload=E.create();l.get_device_by_type_element(l.DEVICE_HMD)?d(a,1):d(a,0);a.do_activation=!0;return a};a.create_timeline_sensor=function(){return u(160)};
a.create_selection_sensor=function(a,b){var e=u(170);e.source_object=a;e.auto_release=b;e.do_activation=!0;return e};a.create_callback_sensor=function(a,b){var e=u(230);e.callback=a;d(e,b);return e};a.sensor_set_value=d;a.get_sensor_value=function(a,b,e){a=a||D;a=a.sensor_manifolds;if(!a||!a[b])return F.error("get_sensor_value(): wrong object"),null;b=a[b].sensors[e];return b?b.value:(F.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=function(a,b,e){a=a||D;a=a.sensor_manifolds;
if(!a||!a[b])return F.error("get_sensor_payload(): wrong object"),null;b=a[b].sensors[e];return b?b.payload:(F.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){M=[];D={};for(var a=0;a<G.length;a++)p(G[a]);G.length=0;Q.length=0};a.check_sensor_manifold=function(a,b){a=a||D;if(!a.sensor_manifolds)return!1;if(b&&a.sensor_manifolds[b])return!0;if(!b)for(var e in a.sensor_manifolds)return!0;return!1};a.create_sensor_manifold=function(a,e,n,d,f,g,B){a=a||D;a.sensor_manifolds_arr=
a.sensor_manifolds_arr||[];a.sensor_manifolds=a.sensor_manifolds||{};var h=a.sensor_manifolds,m=a.sensor_manifolds_arr;h[e]&&k(a,e);n={id:e,type:n,sensors:d.slice(0),logic_fun:f,sensor_values:Array(d.length),callback:g,callback_param:B,last_pulse:-1,last_logic_result:0,last_sensor_values:Array(d.length),update_counter:-1};h[e]=n;m.push(n);-1==M.indexOf(a)&&M.push(a);d=n.sensors;for(a=0;a<d.length;a++){h=e=d[a];if(h.do_activation){switch(h.type){case 90:H.append_collision_test(h.collision_obj,h.collision_id,
h.collision_cb,h.calc_pos_norm);break;case 100:H.apply_collision_impulse_test(h.col_imp_obj,h.col_imp_cb);break;case 110:h.ray_test_id=H.append_ray_test(h.source_object,h.from,h.to,h.collision_id,h.ray_test_cb,!1,!1,h.calc_pos_norm,h.ign_src_rot);h.payload.ray_test_id=h.ray_test_id;break;case 140:h.time_last=x.get_timeline();0>h.period&&(h.period=-h.period);break;case 20:m=c(h.element);b(m,"keyboard_downed_keys");break;case 30:m=c(h.element);b(m,"mouse_wheel");break;case 40:m=c(h.element);b(m,"mouse_down_which");
b(m,"mouse_up_which");b(m,"mouse_location");break;case 50:m=c(h.element);b(m,"mouse_down_which");b(m,"mouse_up_which");break;case 60:m=c(h.element);b(m,"touch_start");b(m,"touch_move");b(m,"touch_end");break;case 70:m=c(h.element);b(m,"touch_start");b(m,"touch_move");break;case 75:m=c(h.element);b(m,"touch_start");b(m,"touch_move");break;case 80:m=c(h.element);b(m,"touch_start");b(m,"touch_end");break;case 170:m=c(h.element);b(m,"mouse_select");b(m,"touch_select");b(m,"touch_start");b(m,"touch_end");
b(m,"mouse_down_which");b(m,"mouse_up_which");break;case 180:case 190:m=c(h.element);b(m,"orientation_angles");break;case 200:m=c(h.element);b(m,"orientation_quat");break;case 240:0==h.gamepad_id?l.get_device_by_type_element(l.DEVICE_GAMEPAD0):1==h.gamepad_id?l.get_device_by_type_element(l.DEVICE_GAMEPAD1):2==h.gamepad_id?l.get_device_by_type_element(l.DEVICE_GAMEPAD2):l.get_device_by_type_element(l.DEVICE_GAMEPAD3)}h.do_activation=!1}h=G.indexOf(e);-1==h?(G.push(e),Q.push([n])):Q[h].push(n)}K=!0};
a.default_AND_logic_fun=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.default_OR_logic_fun=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.remove_sensor_manifold=k;a.reset=function(){for(var a=0;a<M.length;a++){var b=M[a],e=b.sensor_manifolds,b=b.sensor_manifolds_arr,c;for(c in e)delete e[c];b.length=0}for(a=0;a<G.length;a++)p(G[a]);M.length=0;G.length=0;Q.length=0};a.debug=function(){F.log(String(M.length)+" objects with manifolds",
M);F.log(String(G.length)+" sensors",G);for(var a=[],b=[],e=0;e<G.length;e++){var c=G[e];90==c.type&&a.push(c);110==c.type&&b.push(c)}F.log(String(a.length)+" collision sensors",a);F.log(String(b.length)+" ray sensors",b)}};b4w.module.__curve=function(a,r){function u(a,b,c,d,h){var l=d.length;h||(h=new Float32Array(l));for(var k=l+a,q=new Float32Array(k),H=1;H<=k-1;H++)q[H-1]=b>=c[H-1]&&b<c[H+1-1]?1:0;for(var C=2;C<=a;C++)for(H=1;H<=k-C;H++)q[H-1]=(0!=q[H-1]?(b-c[H-1])*q[H-1]/(c[H+C-1-1]-c[H-1]):0)+(0!=q[H+1-1]?(c[H+C-1]-b)*q[H+1-1]/(c[H+C-1]-c[H+1-1]):0);b==c[k-1]&&(q[l-1]=1);a=0;for(H=1;H<=l;H++)a+=q[H-1]*d[H-1];for(H=1;H<=l;H++)h[H-1]=0!=a?q[H-1]*d[H-1]/a:0;return h}function c(a){a=a.knot;return a[a.length-1]}function b(a){a=
a.cumulative_length;return a[a.length-1]}function h(a,b,c,g,m,l,k,q){var H=a+(b-a)/2,C=d(H,g,m,l,k)-c;q=q?q:.01;return Math.abs(C)<q?H:0<C?h(a,H,c,g,m,l,k,q):h(H,b,c,g,m,l,k,q)}function d(a,b,c,d,h){var l=1-a;return b*l*l*l+3*c*l*l*a+3*d*l*a*a+h*a*a*a}r("__print");var q=r("__util"),k=r("__vec3");a.create_spline=function(a){var b={},c=a.data;a=c.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var d=a.order_u;b.order=d;a=a.points;var h=a.length/5,l=[],k=h+d,h=h+2;l[0]=0;for(var q=2;q<=
k;q++)l[q-1]=q>d&&q<h?l[q-2]+1:l[q-2];b.knot=l;if("2D"==c.dimensions)b.is_3d=!1;else if("3D"==c.dimensions)b.is_3d=!0;else throw"Wrong curve dimensions";d=[];l=[];for(c=0;c<a.length;c+=5)d.push(a[c]),d.push(a[c+1]),d.push(a[c+2]),b.is_3d&&d.push(a[c+3]),l.push(a[c+4]);b.cpoints=d;b.weights=l;a=[];for(var c=b.cpoints,d=b.is_3d?4:3,l=b.weights,k=b.knot,h=b.order,q=c.length/d,H=q+h,C=0,x=k[H-1]/999,y=0;1E3>y;y++){5E-6>k[H-1]-C&&(C=k[H-1]);for(var z=u(h,C,k,l),E=0;E<d;E++)for(var e=a[d*y+E]=0;e<q;e++)a[d*
y+E]+=z[e]*c[d*e+E];C+=x}d=b.is_3d?4:3;l=new Float32Array(1E3);l[0]=0;for(c=1;1E3>c;c+=1)k=a[(c-1)*d],h=a[(c-1)*d+1],q=a[(c-1)*d+2],H=a[c*d],C=a[c*d+1],x=a[c*d+2],k=Math.sqrt((H-k)*(H-k)+(C-h)*(C-h)+(x-q)*(x-q)),l[c]=l[c-1]+k;b.cumulative_length=l;return b};a.spline_point=function(a,b,d){d||(d=[]);var g=b,h=Math.max(g,0),h=c(a);b=h=Math.min(g,h);var g=a.cpoints,h=a.is_3d?4:3,l=a.weights,k=a.knot,q=a.order;a=g.length/h;var H=a+q;5E-6>k[H-1]-b&&(b=k[H-1]);H=new Float32Array(a);u(q,b,k,l,H);for(b=0;b<
h;b++)for(l=d[b]=0;l<a;l++)d[b]+=H[l]*g[h*l+b];return d};a.spline_derivative=function(a,b,c){c||(c=[]);var d=a.cpoints,h=a.is_3d?4:3,l=a.weights,k=a.knot,q=a.order;a=d.length/h;var H=a+q;5E-6>k[H-1]-b&&(b=k[H-1]);var H=new Float32Array(a),C=b;b=H;var x=l.length;b||(b=new Float32Array(x));var y=new Float32Array(x),z=new Float32Array(x),E=y,e=z;E||(E=new Float32Array(x));e||(e=new Float32Array(x));for(var n=x+q,M=new Float32Array(n),D=new Float32Array(n),G=1;G<=n-1;G++)M[G-1]=C>=k[G-1]&&C<k[G+1-1]?
1:0;C==k[n-1]&&(M[x-1]=1);for(var Q=2;Q<=q;Q++)for(G=1;G<=n-Q;G++){var v=0!=M[G-1]?M[G-1]/(k[G+Q-1-1]-k[G-1]):0,P=0!=M[G+1-1]?-M[G+1-1]/(k[G+Q-1]-k[G+1-1]):0,S=0!=D[G-1]?(C-k[G-1])*D[G-1]/(k[G+Q-1-1]-k[G-1]):0,I=0!=D[G+1-1]?(k[G+Q-1]-C)*D[G+1-1]/(k[G+Q-1]-k[G+1-1]):0;M[G-1]=(0!=M[G-1]?(C-k[G-1])*M[G-1]/(k[G+Q-1-1]-k[G-1]):0)+(0!=M[G+1-1]?(k[G+Q-1]-C)*M[G+1-1]/(k[G+Q-1]-k[G+1-1]):0);D[G-1]=v+P+S+I}for(G=1;G<=x;G++)E[G-1]=M[G-1],e[G-1]=D[G-1];k=0;for(q=1;q<=x;q++)k+=y[q-1]*l[q-1];C=0;for(q=1;q<=x;q++)C+=
z[q-1]*l[q-1];for(q=1;q<=x;q++)b[q-1]=0!=k?z[q-1]*l[q-1]/k+y[q-1]*l[q-1]*C/(k*k):0;for(l=0;l<h;l++)for(k=c[l]=0;k<a;k++)c[l]+=H[k]*d[h*k+l];return c};a.spline_max_t=c;a.spline_length=b;a.spline_len_to_t=function(a,d){if(0>=d)return 0;var h=c(a);if(d>=b(a))return h;var g=a.cumulative_length,m=q.binary_search_max(g,d,0,g.length-1);return h*(m+(d-g[m])/(g[m+1]-g[m]))/1E3};a.linear_interpolation=function(a,b,c,d,h){return c+(h-d)*(a-c)/(b-d)};a.linear=function(a,b,c){var d=b[0];b=b[1];c=(c[1]-b)/(c[0]-
d);return c*a+(b-c*d)};a.bezier=function(a,b,c,g,m,k){a=h(0,1,a,b[0],c[0],g[0],m[0],k);return d(a,b[1],c[1],g[1],m[1])};a.calchandle_curvemap=function(a,b,c,d,h){var l=new Float32Array(3),t=new Float32Array(3),q=new Float32Array(3),H=new Float32Array(3),C=new Float32Array(3),x=new Float32Array(3);k.copy(a[1],t);null==b?(k.copy(c[1],q),l[0]=2*t[0]-q[0],l[1]=2*t[1]-q[1]):k.copy(b[1],l);null==c?(k.copy(b[1],l),q[0]=2*t[0]-l[0],q[1]=2*t[1]-l[1]):k.copy(c[1],q);k.subtract(t,l,H);k.subtract(q,t,C);b=k.length(H);
c=k.length(C);0==b&&(b=1);0==c&&(c=1);if("AUTO"==d||"AUTO"==h)x[0]=C[0]/c+H[0]/b,x[1]=C[1]/c+H[1]/b,l=2.5614*k.length(x),0!=l&&("AUTO"==d&&k.scaleAndAdd(t,x,-(b/l),a[0]),"AUTO"==h&&k.scaleAndAdd(t,x,c/l,a[2]));"VECTOR"==d&&k.scaleAndAdd(t,H,-1/3,a[0]);"VECTOR"==h&&k.scaleAndAdd(t,C,1/3,a[2])};a.correct_bezpart=function(a,b,c,d){var h=[],k=[],t,q,H;h[0]=a[0]-b[0];h[1]=a[1]-b[1];k[0]=d[0]-c[0];k[1]=d[1]-c[1];H=d[0]-a[0];t=Math.abs(h[0]);q=Math.abs(k[0]);0!=t+q&&t+q>H&&(t=H/(t+q),b[0]=a[0]-t*h[0],b[1]=
a[1]-t*h[1],c[0]=d[0]-t*k[0],c[1]=d[1]-t*k[1])}};b4w.module.__dds=function(a,r){function u(a,b,c,d){var f=new Uint16Array(4),h=new Uint16Array(c*d),k=0,p=0,q=0,y=p=k=0,z=0,E=0,e=0,n=c/4;d/=4;for(var M=0;M<d;M++)for(var D=0;D<n;D++)q=b+4*(M*n+D),f[0]=a[q],f[1]=a[q+1],k=f[0]&31,p=f[0]&2016,y=f[0]&63488,z=f[1]&31,E=f[1]&2016,e=f[1]&63488,f[2]=5*k+3*z>>3|5*p+3*E>>3&2016|5*y+3*e>>3&63488,f[3]=5*z+3*k>>3|5*E+3*p>>3&2016|5*e+3*y>>3&63488,k=a[q+2],p=4*M*c+4*D,h[p]=f[k&3],h[p+1]=f[k>>2&3],h[p+2]=f[k>>4&3],h[p+3]=f[k>>6&3],p+=c,h[p]=f[k>>8&3],h[p+1]=f[k>>
10&3],h[p+2]=f[k>>12&3],h[p+3]=f[k>>14],k=a[q+3],p+=c,h[p]=f[k&3],h[p+1]=f[k>>2&3],h[p+2]=f[k>>4&3],h[p+3]=f[k>>6&3],p+=c,h[p]=f[k>>8&3],h[p+1]=f[k>>10&3],h[p+2]=f[k>>12&3],h[p+3]=f[k>>14];return h}function c(a,b,c,h){var t=new Int32Array(c,0,31),F,H,C,x,y,z;if(542327876!=t[0])return q.error("Invalid magic number in DDS header"),0;if(!t[20]&4)return q.error("Unsupported format, must contain a FourCC code"),0;F=t[21];switch(F){case k:H=8;C=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case p:H=16;C=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case f:H=16;C=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return q.error("Unsupported FourCC code:",d(F)),null}z=1;t[2]&131072&&!1!==h&&(z=Math.max(1,t[7]));x=t[4];y=t[3];t=t[1]+4;if(b)for(F=0;F<z;++F)h=Math.max(4,x)/4*Math.max(4,y)/4*H,b=new Uint8Array(c,t,h),a.compressedTexImage2D(a.TEXTURE_2D,F,C,x,y,0,b),t+=h,x=Math.max(.5*x,1),y=Math.max(.5*y,1);else if(F==k)Math.max(4,x),Math.max(4,y),b=new Uint16Array(c),c=u(b,t/2,x,y),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,x,y,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,c),h&&a.generateMipmap(a.TEXTURE_2D);else return q.error("No manual decoder for",d(F),"and no native support"),0;return z}function b(a,b,d,f,h,k){var p=new XMLHttpRequest;p.open("GET",d,!0);p.responseType="arraybuffer";p.onload=function(){if(200==p.status){a.bindTexture(a.TEXTURE_2D,f);var d=c(a,b,p.response,h);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}k&&
k(f)};p.send(null);return f}function h(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function d(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var q=r("__print"),k=h("DXT1"),p=h("DXT3"),f=h("DXT5");a.dxt_to_rgb_565=u;a.upload_dds_levels=c;a.get_width_height=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.get_compress_ratio=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case k:b=6;break;case p:case f:b=
4;break;default:q.error("Unsupported FourCC code:",d(a))}return b};a.load_dds_texture_ex=b;a.load_dds_texture=function(a,c,d,f){var h=a.createTexture();b(a,c,d,h,!0,f);return h}};b4w.module.__debug=function(a,r){function u(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function c(a){for(var b=q.get_disjoint_timer_query(),c=a.debug_render_time_queries,d=0;d<c.length;d++){var f=c[d],h=b.getQueryObjectEXT(f,b.QUERY_RESULT_AVAILABLE_EXT),g=t.getParameter(b.GPU_DISJOINT_EXT);h&&!g&&(f=b.getQueryObjectEXT(f,b.QUERY_RESULT_EXT)/1E6,a.debug_render_time=a.debug_render_time?w.smooth(f,a.debug_render_time,1,10):f,c.splice(d,1),d--)}}function b(a,
b){typeof a!=typeof b&&w.panic("Structure assertion failed: incompatible types");if(null!==a&&null!==b&&"object"==typeof a){for(var c in a)c in b||w.panic("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||w.panic("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&w.panic("Structure assertion failed: incompatible types for key "+c)}}var h=r("__compat"),d=r("__config"),q=r("__extensions"),k=r("__print"),p=r("__textures"),
f=r("__time"),w=r("__util"),g=r("__graph"),m=d.defaults,l={},t=null,F={},H=[],C=-1,x=-1,y=null,z=!1;a.DV_NONE=0;a.DV_OPAQUE_WIREFRAME=1;a.DV_TRANSPARENT_WIREFRAME=2;a.DV_FRONT_BACK_VIEW=3;a.DV_DEBUG_SPHERES=4;a.DV_CLUSTERS_VIEW=5;a.DV_BATCHES_VIEW=6;a.setup_context=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(l[a[d]]=d)}t=a};a.check_gl=function(a){if(m.gl_debug){var b=t.getError();
b!=t.NO_ERROR&&(b in l?w.panic("GL Error: "+b+", gl."+l[b]+" ("+a+")"):w.panic("Unknown GL error: "+b+" ("+a+")"))}};a.check_bound_fb=function(){if(!m.gl_debug)return!0;switch(t.checkFramebufferStatus(t.FRAMEBUFFER)){case t.FRAMEBUFFER_COMPLETE:return!0;case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return k.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT"),!1;case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return k.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"),
!1;case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return k.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS"),!1;case t.FRAMEBUFFER_UNSUPPORTED:return k.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED"),!1;default:return k.error("FRAMEBUFFER CHECK FAILED"),!1}};a.check_depth_only_issue=function(){if(-1!=C)return C;var a=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,a);a=p.create_texture("DEBUG",p.TT_DEPTH);p.resize(a,1,1);t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,
a.w_target,a.w_texture,0);t.checkFramebufferStatus(t.FRAMEBUFFER)!=t.FRAMEBUFFER_COMPLETE?(C=!0,k.warn("depth-only issue was found")):C=!1;t.bindFramebuffer(t.FRAMEBUFFER,null);return C};a.check_multisample_issue=function(){if(-1!=x)return x;var a=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,a);t.renderbufferStorageMultisample(t.RENDERBUFFER,m.msaa_samples,t.RGBA8,1,1);a=t.getRenderbufferParameter(t.RENDERBUFFER,t.RENDERBUFFER_SAMPLES);a!=m.msaa_samples?(x=!0,k.warn("multisample issue was found: requested "+
m.msaa_samples+", got "+a),t.getError()==t.INVALID_OPERATION&&k.warn("the error from multisample issue detected, ignoring")):x=!1;t.bindRenderbuffer(t.RENDERBUFFER,null);return x};a.check_ff_cubemap_out_of_memory=function(){return h.check_user_agent("Firefox")&&t.getError()==t.OUT_OF_MEMORY?(k.warn("Firefox/old GPUs cubemap issue was found."),!0):!1};a.check_shader_compiling=function(a,b,c){if(m.gl_debug&&!t.getShaderParameter(a,t.COMPILE_STATUS)){var d=m.allow_shaders_debug_ext&&q.get_debug_shaders();
d&&(c=d.getTranslatedShaderSource(a));c=u(c);k.error("shader compilation failed:\n"+c+"\n"+t.getShaderInfoLog(a)+" ("+b+")");throw"Engine failed: see above for error messages";}};a.check_shader_linking=function(a,b,c,d,f,h){if(m.gl_debug&&!t.getProgramParameter(a,t.LINK_STATUS)){var g=m.allow_shaders_debug_ext&&q.get_debug_shaders();g&&(f=g.getTranslatedShaderSource(c),h=g.getTranslatedShaderSource(d));f=u(f);h=u(h);k.error("shader linking failed:\n"+f+"\n\n\n"+h+"\n"+t.getProgramInfoLog(a)+" ("+
b+")");throw"Engine failed: see above for error messages";}};a.render_time_start=function(a){if(m.show_hud_debug_info||"PERFORMANCE"==a.type){var b=q.get_disjoint_timer_query();if(b){var c=b.createQueryEXT();a.debug_render_time_queries.push(c);b.beginQueryEXT(b.TIME_ELAPSED_EXT,c)}else a.debug_render_time_queries.push(performance.now())}};a.render_time_stop=function(a){if(m.show_hud_debug_info||"PERFORMANCE"==a.type){var b=q.get_disjoint_timer_query();b?(b.endQueryEXT(b.TIME_ELAPSED_EXT),c(a)):(b=
a.debug_render_time_queries,b=performance.now()-b.pop(),a.debug_render_time=a.debug_render_time?w.smooth(b,a.debug_render_time,1,10):b)}};a.process_timer_queries=c;a.exec_count=function(a){F[a]=a in F?F[a]+1:1};a.update=function(){for(var a in F)k.log(a,F[a]),F[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(w.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}H.push(a)};a.msg=function(){for(var a=1,b=0;b<H.length;b++){var c=
H[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],w.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);H.push(c)};var E=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},d=Math.max(0,performance.now()-1E3*a),f=0;f<H.length;f++){var h=H[f];a=h[0];if(!(a<d)){var g=String(h[1]);c[g]||(c[g]=E[b++%E.length]);var m=c[g];a=["%c"+(a/1E3).toFixed(6),m,g];
for(g=2;g<h.length;g++)a.push(h[g]);k.log.apply(this,a)}}H.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-1E3*a),d=0;d<H.length;d++){var f=H[d];a=f[0];if(!(a<c))for(var h=2;h<f.length;h++){var g=String(f[1]);3<f.length&&(g+="_"+String(h-2));b[g]||(b[g]=g+"\n");b[g]+=String(a)+" "+f[h]+"\n"}}a="";for(g in b)a+=b[g]+"\n\n";k.log(a);H.splice(0)};a.check_browser=function(a){var b=navigator.userAgent.toLowerCase(),c=function(a){return-1<b.indexOf(a)?!0:!1};
switch(a.toLowerCase()){case "chrome":return c("mozilla")&&c("applewebkit")&&c("chrome");case "firefox":return c("mozilla")&&c("gecko")&&c("firefox");case "msie":return c("mozilla")&&c("trident")&&c("msie");case "opera":return c("opera")&&c("presto");case "safari":return c("mozilla")&&c("applewebkit")&&c("safari")&&!c("chrome");default:return!1}};a.check_finite=function(a){if(w.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};
a.assert_cons=function(a,b){a.constructor!=b&&w.panic("Type assertion failed: value <"+a+"> has type <"+a.constructor+">, required <"+b+">")};a.assert_structure=b;a.assert_structure_seq=function(a){z?b(a,y):z=!0;y=a};a.fake_load=function(a,b,c,d,g){(a=a||null)||w.panic("Stage load callback is undefined");b=b||5E3;c=c||0;d=d||100;100<d&&w.panic("Max percentage must be less than 100");0>c&&w.panic("Min percentage must be greater than 0");c>d&&w.panic("Max percentage must be greater than min percentage");
var h=f.animate(c,d,b,function(b){b=b.toFixed();a(b);100==b&&(f.clear_animation(h),g&&g())})};a.nodegraph_to_dot=function(a,b){if(b)var c=function(a,b){var e=b.type+"("+b.name+")",c=b.inputs,e=e+"\n\nINPUTS:";if(c.length)for(var d=0;d<c.length;d++)e+="\n"+c[d].identifier+": ",e=c[d].is_linked?e+"linked":e+c[d].default_value;else e+="\n---";c=b.outputs;e+="\n\nOUTPUTS:";if(c.length)for(d=0;d<c.length;d++)e+="\n"+c[d].identifier+": ",e=c[d].is_linked?e+("linked(default "+c[d].default_value+")"):e+"not used";
else e+="\n---";e+="\n\nDATA:";d="";switch(b.type){case "GEOMETRY_UV":d="\nuv_layer: "+b.data.value;break;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":d="\ntexture: "+b.data.value.name+"\n("+b.data.value.image.filepath+")"}""==d&&(d="\n---");return e+d},d=function(b,c,d){b=g.get_node_attr(a,b);c=g.get_node_attr(a,c);return b.outputs[d[0]].identifier+"\n==>\n"+c.inputs[d[1]].identifier};else c=function(a,b){return b.type},d=function(b,c,d){b=g.get_node_attr(a,b);c=g.get_node_attr(a,c);return b.outputs[d[0]].identifier+
"\n==>\n"+c.inputs[d[1]].identifier};return g.debug_dot(a,c,d)}};b4w.module.__extensions=function(a,r){function u(a){if(a in q)return q[a];var c=d.getExtension(a)||null;q[a]=c;b.log("%cGET EXTENSION","color: #"+(c?"0a0":"a00"),a);return c}var c=r("__config"),b=r("__print"),h=c.defaults,d=null,q={};a.setup_context=function(a){d=a};a.get_s3tc=function(){return u("WEBGL_compressed_texture_s3tc")||u("WEBKIT_WEBGL_compressed_texture_s3tc")||u("MOZ_WEBGL_compressed_texture_s3tc")};a.get_depth_texture=function(){return h.webgl2?{}:u("WEBGL_depth_texture")||u("WEBKIT_WEBGL_depth_texture")||
u("MOZ_WEBGL_depth_texture")};a.get_aniso=function(){return u("EXT_texture_filter_anisotropic")||u("WEBKIT_EXT_texture_filter_anisotropic")||u("MOZ_EXT_texture_filter_anisotropic")};a.get_debug_shaders=function(){return u("WEBGL_debug_shaders")};a.get_renderer_info=function(){return u("WEBGL_debug_renderer_info")};a.get_elem_index_uint=function(){return h.webgl2?{}:u("OES_element_index_uint")};a.get_standard_derivatives=function(){return h.webgl2?null:u("OES_standard_derivatives")};a.get_disjoint_timer_query=
function(){return u("EXT_disjoint_timer_query")};a.cleanup=function(){q={}}};b4w.module.__graph=function(a,r){function u(a,b,e){e||(e=null);if(c(a,b))throw"Graph already has node with given ID";a.nodes.push(b,e)}function c(a,b){for(var e=a.nodes,c=0;c<e.length;c+=2)if(e[c]==b)return!0;return!1}function b(a,b,e,d){d||(d=null);if(c(a,b)&&c(a,e))a.edges.push(b,e,d);else throw"Wrong node IDs";}function h(a,b){if(!c(a,b))throw"Node not found";for(var e=a.nodes,d=0;d<e.length;d+=2)e[d]==b&&(e.splice(d,2),d-=2)}function d(a,b,e,c){if(!M(a,b,e))throw"Edge not found";a=a.edges;for(var d=
0,n=0;n<a.length;n+=3)if(a[n]==b&&a[n+1]==e){if(-1==c)a.splice(n,3);else{if(c==d){a.splice(n,3);break}d++}n-=3}}function q(a){a=a.nodes;for(var b=-1,e=0;e<a.length;e+=2)b=Math.max(b,a[e]);return++b}function k(a,b){for(var e=a.nodes,c=0;c<e.length;c+=2)if(e[c+1]==b)return e[c];return-1}function p(a){var b=[],e={};f(a,e);for(var c=a.nodes,d=0;d<c.length;d+=2)0==E(a,c[d])&&w(a,c[d],e,b);return{nodes:b,edges:a.edges.slice(0)}}function f(a,b){for(var e=a.nodes,c=0;c<e.length;c+=2)b[e[c]]=!1}function w(a,
b,c,d){if(!c[b]){c[b]=!0;for(var n=0;n<z(a,b);n++){var f=e(a,b,n);w(a,f,c,d)}d.unshift(b,y(a,b))}}function g(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var f=0;f<z(a,b);f++){var h=e(a,b,f);g(a,h,c,d)}if(20==d||30==d)for(f=0;f<E(a,b);f++)h=n(a,b,f),g(a,h,c,d)}}function m(a){for(var b=a.edges,e=0;e<b.length;e+=3){var d=b[e+1];c(a,b[e])&&c(a,d)||(b.splice(e,3),e-=3)}}function l(a){for(var b=[],e=a.nodes,c=0;c<e.length;c+=2){var d=e[c];z(a,d)||b.push(d)}return b}function t(a){var b=a.nodes;a=a.edges;
for(var e=[],c=[],d=[],n=0;n<b.length;n++)d[b[2*n]]=n,e.push(n,b[2*n+1]);for(n=0;n<a.length;n+=3)c.push(d[a[n]],d[a[n+1]],a[n+2]);return{nodes:e,edges:c}}function F(a,b,c){if(c.core_len==c.n1){for(var d=0,f=0;d<c.n1;d++)-1!=c.core_1[d]&&(a[f]=d,b[f]=c.core_1[d],f++);return!0}if(c.n1>c.n2||c.t1both_len>c.t2both_len||c.t1out_len>c.t2out_len||c.t1in_len>c.t2in_len)return!1;for(var f=d=-1,h=!1;!h&&H(c,P,d,f);)if(d=P[0],f=P[1],C(c,d,f)){var g;g=c;h={};h.g1=g.g1;h.g2=g.g2;h.node_comp=g.node_comp;h.edge_comp=
g.edge_comp;h.n1=g.n1;h.n2=g.n2;h.order=g.order;h.core_len=h.orig_core_len=g.core_len;h.t1in_len=g.t1in_len;h.t1out_len=g.t1out_len;h.t1both_len=g.t1both_len;h.t2in_len=g.t2in_len;h.t2out_len=g.t2out_len;h.t2both_len=g.t2both_len;h.added_node1=-1;h.core_1=g.core_1;h.core_2=g.core_2;h.in_1=g.in_1;h.in_2=g.in_2;h.out_1=g.out_1;h.out_2=g.out_2;h.share_count=g.share_count;g.share_count[0]+=1;var h=g=h,k=d,m=f,l=h.g1,M=h.g2,D=h.n1,v=h.n2,p=h.core_1,q=h.core_2,G=h.in_1,t=h.in_2,W=h.out_1,A=h.out_2;x(k<
D);x(m<v);x(h.core_len<D);x(h.core_len<v);D=++h.core_len;h.added_node1=k;G[k]||(G[k]=D,h.t1in_len++,W[k]&&h.t1both_len++);W[k]||(W[k]=D,h.t1out_len++,G[k]&&h.t1both_len++);t[m]||(t[m]=D,h.t2in_len++,A[m]&&h.t2both_len++);A[m]||(A[m]=D,h.t2out_len++,t[m]&&h.t2both_len++);p[k]=m;q[m]=k;for(p=0;p<E(l,k);p++)q=n(l,k,p),G[q]||(G[q]=D,h.t1in_len++,W[q]&&h.t1both_len++);for(p=0;p<z(l,k);p++)q=e(l,k,p),W[q]||(W[q]=D,h.t1out_len++,G[q]&&h.t1both_len++);for(p=0;p<E(M,m);p++)q=n(M,m,p),t[q]||(t[q]=D,h.t2in_len++,
A[q]&&h.t2both_len++);for(p=0;p<z(M,m);p++)q=e(M,m,p),A[q]||(A[q]=D,h.t2out_len++,t[q]&&h.t2both_len++);h=F(a,b,g);x(1>=g.core_len-g.orig_core_len);x(-1!=g.added_node1);q=g.g1;k=g.g2;m=g.core_len;l=g.added_node1;M=g.core_1;G=g.core_2;D=g.in_1;t=g.in_2;v=g.out_1;W=g.out_2;if(g.orig_core_len<m){D[l]==m&&(D[l]=0);for(A=0;A<E(q,l);A++)p=n(q,l,A),D[p]==m&&(D[p]=0);v[l]==m&&(v[l]=0);for(A=0;A<z(q,l);A++)p=e(q,l,A),v[p]==m&&(v[p]=0);q=M[l];t[q]==m&&(t[q]=0);for(A=0;A<E(k,q);A++)p=n(k,q,A),t[p]==m&&(t[p]=
0);W[q]==m&&(W[q]=0);for(A=0;A<z(k,q);A++)p=e(k,q,A),W[p]==m&&(W[p]=0);M[l]=-1;G[q]=-1;g.core_len=g.orig_core_len;g.added_node1=-1}}return h}function H(a,b,e,c){-1==e&&(e=0);-1==c?c=0:c++;var d=a.t1both_len,n=a.t2both_len,h=a.t1out_len,f=a.t2out_len,g=a.t1in_len,k=a.t2in_len,m=a.core_len,l=a.n1,M=a.n2,D=a.core_1,v=a.core_2,p=a.in_1,q=a.in_2,G=a.out_1,A=a.out_2;if(d>m&&n>m)for(;e<l&&(-1!=D[e]||0==G[e]||0==p[e]);)e++,c=0;else if(h>m&&f>m)for(;e<l&&(-1!=D[e]||0==G[e]);)e++,c=0;else if(g>m&&k>m)for(;e<
l&&(-1!=D[e]||0==p[e]);)e++,c=0;else if(0==e&&0!=a.order){for(p=0;p<l&&-1!=D[e=a.order[p]];)p++;p==l&&(e=l)}else for(;e<l&&-1!=D[e];)e++,c=0;if(d>m&&n>m)for(;c<M&&(-1!=v[c]||0==A[c]||0==q[c]);)c++;else if(h>m&&f>m)for(;c<M&&(-1!=v[c]||0==A[c]);)c++;else if(g>m&&k>m)for(;c<M&&(-1!=v[c]||0==q[c]);)c++;else for(;c<M&&-1!=v[c];)c++;return e<l&&c<M?(b[0]=e,b[1]=c,!0):!1}function C(a,b,c){var d=a.g1,h=a.g2,f=a.n2,g=a.core_1,k=a.core_2,m=a.in_1,l=a.in_2,v=a.out_1,p=a.out_2;x(b<a.n1);x(c<f);x(-1==g[b]);x(-1==
k[c]);f=(0,a.node_comp)(y(d,b),y(h,c))?!0:!1;if(!f)return!1;for(var q=f=0,G=0,t=0,w=0,ka=0,W=0;W<z(d,b);W++){var A=e(d,b,W);if(-1!=g[A]){var P=g[A];if(!M(h,c,P)||!D(a.edge_comp,d,b,A,h,c,P))return!1}else m[A]&&G++,v[A]&&f++,m[A]||v[A]||w++}for(W=0;W<E(d,b);W++)if(A=n(d,b,W),-1!=g[A]){if(P=g[A],!M(h,P,c)||!D(a.edge_comp,d,A,b,h,P,c))return!1}else m[A]&&G++,v[A]&&f++,m[A]||v[A]||w++;for(W=0;W<z(h,c);W++)if(P=e(h,c,W),-1!=k[P]){if(A=k[P],!M(d,b,A))return!1}else l[P]&&t++,p[P]&&q++,l[P]||p[P]||ka++;for(W=
0;W<E(h,c);W++)if(P=n(h,c,W),-1!=k[P]){if(A=k[P],!M(d,A,b))return!1}else l[P]&&t++,p[P]&&q++,l[P]||p[P]||ka++;return G<=t&&f<=q&&w<=ka}function x(a){if(!a)throw"Assertion failed";}function y(a,b){for(var e=a.nodes,c=0;c<e.length;c+=2)if(e[c]==b)return e[c+1];return null}function z(a,b){for(var e=a.edges,c=0,d=0;d<e.length;d+=3)e[d]==b&&c++;return c}function E(a,b){for(var e=a.edges,c=0,d=0;d<e.length;d+=3)e[d+1]==b&&c++;return c}function e(a,b,e){a=a.edges;for(var c=0,d=0;d<a.length;d+=3)if(a[d]==
b){if(c==e)return a[d+1];c++}return-1}function n(a,b,e){a=a.edges;for(var c=0,d=0;d<a.length;d+=3)if(a[d+1]==b){if(c==e)return a[d];c++}return-1}function M(a,b,e){a=a.edges;for(var c=0;c<a.length;c+=3)if(a[c]==b&&a[c+1]==e)return!0;return!1}function D(a,b,e,c,d,n,h){for(var f=G(b,e,c),g=G(d,n,h),k=0;k<f;k++){for(var m=!1,l=0;l<g;l++)if(a(Q(b,e,c,k),Q(d,n,h,l))){m=!0;break}if(!m)return!1}return!0}function G(a,b,e){var c=0;a=a.edges;for(var d=0;d<a.length;d+=3)a[d]==b&&a[d+1]==e&&c++;return c}function Q(a,
b,e,c){a=a.edges;for(var d=0,n=0;n<a.length;n+=3)if(a[n]==b&&a[n+1]==e){if(d==c)return a[n+2];d++}return null}r("__print");var v=r("__util"),P=[-1,-1];a.NULL_NODE=-1;a.FORWARD_DIR=10;a.BACKWARD_DIR=20;a.TWO_WAY=30;a.create=function(){for(var a=arguments,b=[],e=[],c=0;c<a.length;c++){var d=a[c];switch(d.length){case 2:b.push(d[0],d[1]);break;case 3:e.push(d[0],d[1],d[2]);break;default:throw"Wrong graph constructor params";}}return{nodes:b,edges:e}};a.clone=function(a,b,e){if(b)for(var c=Array(a.nodes.length),
d=0;d<a.nodes.length;d+=2)c[d]=a.nodes[d],c[d+1]=b(a.nodes[d+1]);else c=v.clone_object_r(a.nodes);if(e)for(b=Array(a.edges.length),d=0;d<a.edges.length;d+=3)b[d]=a.edges[d],b[d+1]=a.edges[d+1],b[d+2]=e(a.edges[d+2]);else b=v.clone_object_r(a.edges);return a={nodes:c,edges:b}};a.create_node_edge_arr=function(a,b){for(var e=[],c=[],d=0;d<a.length;d++)e.push(a[d][0],a[d][1]);for(d=0;d<b.length;d++)c.push(b[d][0],b[d][1],b[d][2]);return{nodes:e,edges:c}};a.append_node=u;a.has_node=c;a.append_edge=b;a.remove_node=
h;a.remove_edge=d;a.remove_edge_by_attr=function(a,b,e,c){if(!M(a,b,e))throw"Edge not found";a=a.edges;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==e&&a[d+2][0]==c[0]&&a[d+2][1]==c[1]){a.splice(d,3);break}};a.append_node_attr=function(a,b){if(-1==k(a,b)){var e=q(a);u(a,e,b);return e}throw"Non-unique attribute";};a.replace_edge_attr=function(a,b,e,c,d){a=a.edges;for(var n=0;n<a.length;n+=3)a[n]==b&&a[n+1]==e&&a[n+2]==c&&(a[n+2]=d)};a.append_subgraph=function(a,e,c,d){c=c||[];d=d||[];for(var n={},
h=0;h<a.nodes.length;h+=2){var f=a.nodes[h],g=a.nodes[h+1],k=q(e);u(e,k,g);n[f]=k}for(h=0;h<a.edges.length;h+=3)g=n[a.edges[h]],k=n[a.edges[h+1]],f=a.edges[h+2],b(e,g,k,f);for(h=0;h<c.length;h+=3)g=n[c[h]],a=c[h+1],f=c[h+2],b(e,g,a,f);for(h=0;h<d.length;h+=3)c=d[h],k=n[d[h+1]],f=d[h+2],b(e,c,k,f)};a.gen_node_id=q;a.node_by_attr=k;a.append_edge_attr=function(a,e,c,d){e=k(a,e);c=k(a,c);if(-1!=e&&-1!=c)b(a,e,c,d);else throw"Attributes not found";};a.traverse=function(a,b){for(var e=a.nodes,c=0;c<e.length&&
!b(e[c],e[c+1]);c+=2);};a.traverse_edges=function(a,b){for(var e=a.edges,c=0;c<e.length&&!b(e[c],e[c+1],e[c+2]);c+=3);};a.traverse_inputs=function(a,b,e){for(var c=a.edges,d=0;d<c.length;d+=3)if(c[d+1]==b){var n=c[d];if(e(n,y(a,n),c[d+2]))break}};a.traverse_outputs=function(a,b,e){for(var c=a.edges,d=0;d<c.length;d+=3)if(c[d]==b){var n=c[d+1];if(e(n,y(a,n),c[d+2]))break}};a.topsort=p;a.topsort_attr=function(a){a=p(a).nodes;for(var b=[],e=0;e<a.length;e+=2)b.push(a[e+1]);return b};a.is_connected=function(a){};
a.subgraph_node_conn=function(a,b,e){if(!c(a,b))throw"No such node";var d={};f(a,d);g(a,b,d,e);b=[];for(var n in d)d[n]&&(n=Number(n),b.push(n,y(a,n)));a={nodes:b,edges:a.edges.slice(0)};m(a);return a};a.cleanup_loose_edges=m;a.get_source_nodes=function(a){for(var b=[],e=a.nodes,c=0;c<e.length;c+=2){var d=e[c];E(a,d)||b.push(d)}return b};a.get_sink_nodes=l;a.match=function(a,b,e,c){var d={};d.g1=t(a);d.g2=t(b);d.node_comp=e||function(a,b){return a==b};d.edge_comp=c||function(a,b){return a==b};c=a.nodes.length/
2;var n=b.nodes.length/2;d.n1=c;d.n2=n;d.order=0;d.core_len=d.orig_core_len=0;d.t1both_len=d.t1in_len=d.t1out_len=0;d.t2both_len=d.t2in_len=d.t2out_len=0;d.added_node1=-1;d.core_1=Array(c);d.core_2=Array(n);d.in_1=Array(c);d.in_2=Array(n);d.out_1=Array(c);d.out_2=Array(n);d.share_count=[1];for(e=0;e<c;e++)d.core_1[e]=-1,d.in_1[e]=0,d.out_1[e]=0;for(e=0;e<n;e++)d.core_2[e]=-1,d.in_2[e]=0,d.out_2[e]=0;n=Array(c);c=Array(c);if(F(n,c,d)){for(e=0;e<n.length;e++)n[e]=a.nodes[2*n[e]],c[e]=b.nodes[2*c[e]];
return[n,c]}return null};a.get_node_id=function(a,b){for(var e=a.nodes,c=1;c<e.length;c+=2)if(e[c]==b)return e[c-1];return null};a.get_node_attr=y;a.out_edge_count=z;a.in_edge_count=E;a.get_out_edge=e;a.get_in_edge=n;a.get_edge_count=G;a.get_edge_attr=Q;a.replace=function(a,b,e){for(var c=a.edges,d=q(a),n=0;n<b.length;n++){var f=b[n];h(a,f);for(var g=0;g<c.length;g+=3)c[g]==f&&(c[g]=d),c[g+1]==f&&(c[g+1]=d),c[g]==c[g+1]&&(c.splice(g,3),g-=3)}u(a,d,e)};a.reconnect_edges=function(a,b,e,c,d){if(!M(a,
b,e))throw"Edge not found";a=a.edges;for(var n=0;n<a.length;n+=3)a[n]==b&&a[n+1]==e&&(a[n]=c,a[n+1]=d)};a.enforce_acyclic=function(a,b){function e(a,b){if(-1!=g.indexOf(a)){var c=g.slice(g.indexOf(a));if(-1!=n[c[c.length-1]].indexOf(c[0])){k.push([a,c[c.length-1]]);return}}g.push(a);for(c=0;c<b.length;c++)b[c]in n&&e(b[c],n[b[c]])}b||(b=l(a)[0]);var c=a.edges;if(!c.length||-1==c.indexOf(b))return a;for(var n={},h=0,f=0;f<c.length;f+=3)c[f+1]in n?n[c[f+1]].push(c[f]):n[c[f+1]]=[c[f]],h++;var g=[],
k=[];e(b,n[b]);for(f=0;f<k.length;f++)for(var m=h=0;m<c.length;m+=3)k[f][1]==c[m+1]&&k[f][0]==c[m]&&d(a,c[m],c[m+1],h),h++;return a};a.debug_dot=function(a,b,e){var c=a.nodes;a=a.edges;var d;d="digraph debug {\n    node [shape=box];\n";for(var n=0;n<c.length;n+=2){var h=c[n],f=c[n+1],f=b?b(h,f):String(h);d+="    ";d+=String(h)+' [label="'+f.replace(/\"/g,'\\"')+'"];\n'}for(n=0;n<a.length;n+=3)b=a[n],c=a[n+1],f=a[n+2],d+="    ",d+=String(b)+" -> "+String(c),e&&(d+=' [label="'+e(b,c,f)+'"]'),d+=";\n";
return d+="}"}};b4w.module.__ipc=function(a,r){function u(a,b,c){for(var d=0;d<m.length;d+=2)m[d+1]==a&&(g[d+Number(!b)]=c)}function c(a){for(var b=0;b<a.length;b++){var c=a[b],d=0,h;for(h in c){var f=c[h];switch(f.constructor){case Float32Array:d+=f.length;break;case Number:d+=1}}--d;c.len=d}}var b=!0;a.IN_LOADED=0;var h=a.IN_COLLISION=1,d=a.IN_COLLISION_POS_NORM=2;a.IN_COLLISION_IMPULSE=3;a.IN_ERROR=4;a.IN_FBMSG=5;a.IN_FLOATER_BOB_TRANSFORM=6;a.IN_LOG=7;var q=a.IN_PROP_OFFSET=8,k=a.IN_RAY_HIT=9,p=a.IN_RAY_HIT_POS_NORM=
10;a.IN_REMOVE_RAY_TEST=11;var f=a.IN_TRANSFORM=12;a.IN_VEHICLE_SPEED=13;a.IN_PING=14;a.IN_FPS=15;a.IN_DEBUG_STATS=16;a.OUT_INIT=100;a.OUT_ACTIVATE=101;a.OUT_ADD_BOAT_BOB=102;a.OUT_ADD_CAR_WHEEL=103;a.OUT_ADD_FLOATER_BOB=104;a.OUT_APPEND_BOUNDING_BODY=105;a.OUT_APPEND_BOAT=106;a.OUT_APPEND_CAR=107;a.OUT_APPEND_CHARACTER=108;a.OUT_APPEND_COLLISION_TEST=109;a.OUT_APPEND_CONSTRAINT=110;a.OUT_APPEND_FLOATER=111;a.OUT_APPEND_GHOST_MESH_BODY=112;a.OUT_APPEND_STATIC_MESH_BODY=113;a.OUT_APPEND_WATER=114;
a.OUT_REMOVE_BODY=115;a.OUT_APPLY_CENTRAL_FORCE=116;a.OUT_APPLY_COLLISION_IMPULSE_TEST=117;a.OUT_APPLY_TORQUE=118;a.OUT_CHARACTER_JUMP=119;a.OUT_CHARACTER_ROTATION_INCREMENT=120;a.OUT_CLEAR_COLLISION_IMPULSE_TEST=121;a.OUT_DISABLE_SIMULATION=122;a.OUT_ENABLE_SIMULATION=123;a.OUT_PAUSE=124;a.OUT_APPEND_RAY_TEST=125;a.OUT_REMOVE_RAY_TEST=126;a.OUT_CHANGE_RAY_TEST_FROM_TO=127;a.OUT_REMOVE_COLLISION_TEST=128;a.OUT_REMOVE_CONSTRAINT=129;a.OUT_RESUME=130;a.OUT_SET_CHARACTER_FLY_VELOCITY=131;a.OUT_SET_CHARACTER_HOR_ROTATION=
132;a.OUT_SET_CHARACTER_MOVE_DIR=133;a.OUT_SET_CHARACTER_MOVE_TYPE=134;a.OUT_SET_CHARACTER_ROTATION=135;a.OUT_SET_CHARACTER_RUN_VELOCITY=136;a.OUT_SET_CHARACTER_VERT_ROTATION=137;a.OUT_SET_CHARACTER_WALK_VELOCITY=138;a.OUT_SET_GRAVITY=139;a.OUT_SET_LINEAR_VELOCITY=140;var w=a.OUT_SET_TRANSFORM=141;a.OUT_SET_WATER_TIME=142;a.OUT_ADD_WATER_WRAPPER=143;a.OUT_UPDATE_BOAT_CONTROLS=144;a.OUT_UPDATE_CAR_CONTROLS=145;a.OUT_PING=146;a.OUT_DEBUG=147;a.OUT_UPDATE_WORLD=148;var g=b4w.worker_listeners,m=b4w.worker_namespaces,
l={msg_id:f,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3),len:0},t={msg_id:q,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},F={msg_id:k,id:0,body_id_hit:0,hit_fract:0,hit_time:0,len:0},H={msg_id:p,id:0,body_id_hit:0,hit_fract:0,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),len:0},C={msg_id:h,body_id_a:0,body_id_b:0,result:0,len:0},x={msg_id:d,body_id_a:0,body_id_b:0,
result:0,coll_point:new Float32Array(3),coll_norm:new Float32Array(3),coll_dist:0,len:0},y={msg_id:w,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},z=[l,t,F,H,C,x,y];a.create_worker=function(a,e){var c={is_main:a?!0:!1,web_worker:null,buf_arr:[],fb_worker_ns:""};if(e)if(c.web_worker={addEventListener:function(a,b,e){"message"!=a&&panic("Wrong web worker event");u(c.fb_worker_ns,c.is_main,b)},removeEventListener:function(a,b,e){"message"!=a&&panic("Wrong web worker event");u(c.fb_worker_ns,
c.is_main,null)},postMessage:function(a,b){var e;a:{for(e=0;e<m.length;e+=2)if(m[e+1]==c.fb_worker_ns){e=g[e+Number(!!c.is_main)];break a}e=null}e({data:a})},terminate:function(){for(var a=0;a<m.length;a+=2)if(m[a+1]==c.fb_worker_ns){g.splice(a,2);m.splice(a,2);break}}},c.is_main){var d=r("__util"),h=r("__container"),f=b4w.get_namespace(r),d=d.unique_name(f+"_worker");m.push(f);m.push(d);g.push(null);g.push(null);c.fb_worker_ns=d;(h=h.find_script(a))?b?h.addEventListener("load",function(){b4w.require("__bindings",
c.fb_worker_ns)},!1):(b4w.cleanup("__bindings",c.fb_worker_ns),b4w.cleanup("__ipc",c.fb_worker_ns),b4w.require("__bindings",c.fb_worker_ns)):(h=document.createElement("script"),h.src=a,h.defer="defer",h.async="async",h.addEventListener("load",function(){b=!1;b4w.require("__bindings",c.fb_worker_ns)},!1),document.head.appendChild(h))}else c.fb_worker_ns=b4w.get_namespace(r);else c.web_worker=a?new Worker(a):self;return c};a.attach_handler=function(a,b){c(z);var n=function(c){if(c.constructor==ArrayBuffer)c=
new Float32Array(c);else if(c[0].constructor==ArrayBuffer){for(var g=0;g<c.length;g++)n(c[g]);return}g=c[0]|0;switch(g){case f:var m=l;m.body_id=c[1]|0;m.time=c[2];m.trans[0]=c[3];m.trans[1]=c[4];m.trans[2]=c[5];m.quat[0]=c[6];m.quat[1]=c[7];m.quat[2]=c[8];m.quat[3]=c[9];m.linvel[0]=c[10];m.linvel[1]=c[11];m.linvel[2]=c[12];m.angvel[0]=c[13];m.angvel[1]=c[14];m.angvel[2]=c[15];break;case q:m=t;m.chassis_hull_body_id=c[1]|0;m.prop_ind=c[2]|0;m.trans[0]=c[3];m.trans[1]=c[4];m.trans[2]=c[5];m.quat[0]=
c[6];m.quat[1]=c[7];m.quat[2]=c[8];m.quat[3]=c[9];break;case k:m=F;m.id=c[1]|0;m.body_id_hit=c[2]|0;m.hit_fract=c[3];m.hit_time=c[4];break;case p:m=H;m.id=c[1]|0;m.body_id_hit=c[2]|0;m.hit_fract=c[3];m.hit_time=c[4];m.hit_pos[0]=c[5];m.hit_pos[1]=c[6];m.hit_pos[2]=c[7];m.hit_norm[0]=c[8];m.hit_norm[1]=c[9];m.hit_norm[2]=c[10];break;case h:m=C;m.body_id_a=c[1]|0;m.body_id_b=c[2]|0;m.result=!!c[3];break;case d:m=x;m.body_id_a=c[1]|0;m.body_id_b=c[2]|0;m.result=!!c[3];m.coll_point[0]=c[4];m.coll_point[1]=
c[5];m.coll_point[2]=c[6];m.coll_norm[0]=c[7];m.coll_norm[1]=c[8];m.coll_norm[2]=c[9];m.coll_dist=c[10];break;case w:m=y;m.body_id=c[1]|0;m.trans[0]=c[2];m.trans[1]=c[3];m.trans[2]=c[4];m.quat[0]=c[5];m.quat[1]=c[6];m.quat[2]=c[7];m.quat[3]=c[8];break;default:m=c}b(a,g,m)};a.web_worker.addEventListener("message",function(a){n(a.data)},!1)};a.cleanup=function(){};a.post_msg=function(a,b){if(a)switch(b){case f:var c=l,g=new Float32Array(c.len);g[0]=c.msg_id;g[1]=c.body_id;g[2]=c.time;g[3]=c.trans[0];
g[4]=c.trans[1];g[5]=c.trans[2];g[6]=c.quat[0];g[7]=c.quat[1];g[8]=c.quat[2];g[9]=c.quat[3];g[10]=c.linvel[0];g[11]=c.linvel[1];g[12]=c.linvel[2];g[13]=c.angvel[0];g[14]=c.angvel[1];g[15]=c.angvel[2];a.buf_arr.push(g.buffer);break;case q:c=t;g=new Float32Array(c.len);g[0]=c.msg_id;g[1]=c.chassis_hull_body_id;g[2]=c.prop_ind;g[3]=c.trans[0];g[4]=c.trans[1];g[5]=c.trans[2];g[6]=c.quat[0];g[7]=c.quat[1];g[8]=c.quat[2];g[9]=c.quat[3];a.buf_arr.push(g.buffer);break;case k:c=F;g=new Float32Array(c.len);
g[0]=c.msg_id;g[1]=c.id;g[2]=c.body_id_hit;g[3]=c.hit_fract;g[4]=c.hit_time;a.buf_arr.push(g.buffer);break;case p:c=H;g=new Float32Array(c.len);g[0]=c.msg_id;g[1]=c.id;g[2]=c.body_id_hit;g[3]=c.hit_fract;g[4]=c.hit_time;g[5]=c.hit_pos[0];g[6]=c.hit_pos[1];g[7]=c.hit_pos[2];g[8]=c.hit_norm[0];g[9]=c.hit_norm[1];g[10]=c.hit_norm[2];a.buf_arr.push(g.buffer);break;case h:c=C;g=new Float32Array(c.len);g[0]=c.msg_id;g[1]=c.body_id_a;g[2]=c.body_id_b;g[3]=c.result;a.buf_arr.push(g.buffer);break;case d:c=
x;g=new Float32Array(c.len);g[0]=c.msg_id;g[1]=c.body_id_a;g[2]=c.body_id_b;g[3]=c.result;g[4]=c.coll_point[0];g[5]=c.coll_point[1];g[6]=c.coll_point[2];g[7]=c.coll_norm[0];g[8]=c.coll_norm[1];g[9]=c.coll_norm[2];g[10]=c.coll_dist;a.buf_arr.push(g.buffer);break;case w:c=y;g=new Float32Array(c.len);g[0]=c.msg_id;g[1]=c.body_id;g[2]=c.trans[0];g[3]=c.trans[1];g[4]=c.trans[2];g[5]=c.quat[0];g[6]=c.quat[1];g[7]=c.quat[2];g[8]=c.quat[3];a.buf_arr.push(g.buffer);break;default:g=[];for(c=1;c<arguments.length;c++)g.push(arguments[c]);
a.web_worker.postMessage(g)}};a.post_msg_arr=function(a){a&&a.buf_arr.length&&(a.web_worker.postMessage(a.buf_arr),a.buf_arr.length=0)};a.get_msg_cache=function(a){switch(a){case f:return l;case q:return t;case k:return F;case p:return H;case h:return C;case d:return x;case w:return y;default:return null}};a.terminate=function(a){a.web_worker.terminate();a.web_worker=null};a.is_active=function(a){return!!a.web_worker};a.is_fallback=function(a){return!!a.fb_worker_ns}};b4w.module.__hud=function(a,r){function u(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function c(a){b(' SCENE "'+a.name+'"');b(" Active        Subscene       Lamps      Size   RenderCalls  Time");if(a._render){var c=0,d=0,g=0;p.traverse(a._render.graph,function(a,h){if("SINK"!=h.type){var f=h.type,m=Math.round(h.camera.width)+"x"+Math.round(h.camera.height),k=h.bundles.length,p=h.debug_render_calls;if("MAIN_CUBE_REFLECT"==h.type||"MAIN_CUBE_REFLECT_BLEND"==
h.type)k*=6;var e=h.do_render,n=e?h.debug_render_time:0;h.enqueue||(h.debug_render_time=0);b(e?" (\u2713)":" (\u2715)",f,h.num_lights,m,p,"of",k,"  ",n.toFixed(3));h.debug_render_calls=0;e&&(c+=k,d+=p,g+=n)}});return[c,d,g]}b("No INFO")}function b(){for(var a=80+20*g[0],b=arguments[0],c=1;c<arguments.length;c++){for(var d=f[c]-String(arguments[c]).length,h="",k=0;k<d;k++)h+=" ";b+=h+arguments[c]}g[0]++;w.fillText(b,30,a)}function h(a,b,c,d,g){g.x=a;g.y=b;g.w=c;g.h=d;return g}function d(a,b,c){b*=
a.w;c.x=a.x+b;c.y=a.y;c.w=a.w-2*b;c.h=a.h;return c}function q(a){return a.x+a.w/2}function k(a){var b=w,c={x:0,y:0,w:0,h:0};h(0,0,b.canvas.width,b.canvas.height,c);d(c,.01,c);b=.02*c.h;c.x=c.x;c.y+=b;c.w=c.w;c.h-=2*b;b=c.w/8;c.x+=b*a;c.y=c.y;c.w=b;c.h=c.h;d(c,.02,c);return c}var p=r("__graph");r("__print");var f=[5,24,7,10,4,3,6],w=null,g=[0,0];a.init=function(a){a=a.getContext("2d");u(a);return w=a};a.update_dim=function(){w&&u(w)};a.reset=function(){var a=w;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),
a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),g[0]=0,g[1]=0)};a.show_debug_info=function(a,d){var h=w;if(h){h.textAlign="left";h.fillStyle="rgba(0,255,0,255)";b(" FPS",(1/d).toFixed(2));g[0]++;for(var f=h=0,k=0,p=0;p<a.length;p++){var q=c(a[p]),h=h+q[0],f=f+q[1],k=k+q[2];g[0]++}b(" -----------------------------------------------");b("    ","TOTAL ACTIVE","","",f,"of",h,"  ",k.toFixed(3))}};a.print=function(){var a=w;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",
b.apply(Math,arguments))};a.plot_array=function(a,b,c,d,g,h,f){var p=w;if(p){b=k(b);var z=b.h/5;b.x=b.x;b.y+=4*z;b.w=b.w;b.h=z;p.textAlign="center";p.fillStyle="#00FF00";w.fillText(a,q(b),b.y-10);p.strokeStyle="#00FF00";p.lineWidth=.5;p.beginPath();p.moveTo(b.x,b.y);p.lineTo(b.x+b.w,b.y);p.lineTo(b.x+b.w,b.y+b.h);p.lineTo(b.x,b.y+b.h);p.closePath();p.stroke();if(!h&&!f)for(h=1E6,f=-1E6,a=0;a<c.length;a++)h=Math.min(h,c[a]),f=Math.max(f,c[a]);p.textAlign="right";w.fillText(String(h),b.x-10,b.y+b.h);
w.fillText(String(f),b.x-10,b.y);p.textAlign="center";w.fillText(String(d),b.x,b.y+b.h+15);w.fillText(String(g),b.x+b.w,b.y+b.h+15);p.strokeStyle="#FF0000";p.lineWidth=1.5;p.beginPath();d=b.w/(c.length-1);f=b.h/(f-h);for(a=0;a<c.length;a++)g=b.x+d*a,z=b.y+b.h-(c[a]-h)*f,0==a?p.moveTo(g,z):p.lineTo(g,z);p.stroke()}};a.draw_mixer_strip=function(a,b,c,d,g,f,p){var y=w;if(y)for(y.textAlign="center",y.fillStyle="#00FF00",y.font="bold 12px Courier",c=k(c),w.fillText(b?"["+a+"]":a,q(c),c.y),0<=f&&w.fillText(f?
"[M]":"[ ]",q(c)-15,c.y+30),0<=p&&w.fillText(p?"[S]":"[ ]",q(c)+15,c.y+30),a={x:0,y:0,w:0,h:0},b=0;b<d.length;b++){var z=d[b];(p="VOLUME"==z[0])?h(c.x,c.y+350,c.w,250,a):h(c.x,c.y+10+50*b,c.w,c.h,a);f=y;var E=a,e=b==g,n=z[0],M=z[1],D=z[2],G=z[3],Q=z[5],z=(G-D)/z[4],z=1>z?Math.floor(1/z-1E-5).toFixed(0).length:0,Q=Q?Math.log(M/D)/Math.log(G/D):(M-D)/(G-D);f.textAlign="center";e?f.fillText("["+n+"]",q(E),E.y):f.fillText(n,q(E),E.y);f.strokeStyle="#00FF00";f.lineWidth=p?3:1;p?(f.textAlign="right",f.fillText(G.toFixed(z),
q(E)-10,E.y+15),f.textAlign="right",f.fillText(D.toFixed(z),q(E)-10,E.y+E.h-15)):(f.textAlign="right",f.fillText(D.toFixed(z),E.x+28,E.y+15),f.textAlign="left",f.fillText(G.toFixed(z),E.x+E.w-28,E.y+15));f.beginPath();if(p){var v=E.y+15+(E.h-30)*(1-Q);f.moveTo(q(E),E.y+15);f.lineTo(q(E),E.y+E.h-15);f.moveTo(q(E)-5,E.y+15);f.lineTo(q(E)+5,E.y+15);f.moveTo(q(E)-5,E.y+E.h-15);f.lineTo(q(E)+5,E.y+E.h-15);f.moveTo(q(E)-5,v);f.lineTo(q(E)+5,v)}else{var P=E.x+30+(E.w-60)*Q;f.moveTo(E.x+30,E.y+15);f.lineTo(E.x+
E.w-30,E.y+15);f.moveTo(E.x+30,E.y+15-5);f.lineTo(E.x+30,E.y+15+5);f.moveTo(E.x+E.w-30,E.y+15-5);f.lineTo(E.x+E.w-30,E.y+15+5);f.moveTo(P,E.y+15-5);f.lineTo(P,E.y+15+5)}f.stroke();"EQ_Q"==n?(e=M,e=1+1/(2*e*e)+Math.sqrt((2+1/(e*e))*(2+1/(e*e))/4-1),e=Math.log(e)/Math.log(2),p?(f.textAlign="left",f.fillText(M.toFixed(z),q(E)+10,v),f.textAlign="left",f.fillText("("+e.toFixed(z+1)+")",q(E)+10,v+10)):(f.textAlign="right",f.fillText(M.toFixed(z),P,E.y+30),f.textAlign="left",f.fillText("("+e.toFixed(z+1)+
")",P,E.y+30))):p?(f.textAlign="left",f.fillText(M.toFixed(z),q(E)+10,v)):(f.textAlign="center",f.fillText(M.toFixed(z),P,E.y+30))}}};b4w.module.__renderer=function(a,r){function u(a){for(var c=a.camera,g=a.bundles,f=0;f<g.length;f++){var k=g[f];if(k.do_render){var m=a,l=c,p=k.obj_render,q=k.batch,I=q.shader;x.useProgram(I.program);for(var k=q.bufs_data,K=q.attribute_setters,B=I.transient_uniform_setters,N=B.length;N--;){var J=B[N];J.fun(x,J.loc,m,p,q,l)}if(I.need_uniforms_update&&!I.no_permanent_uniforms){I.permanent_uniform_setters.length||d(I);B=I.permanent_uniform_setters;for(N=B.length;N--;)J=B[N],J.fun(x,J.loc,m,p,q,l);I.need_uniforms_update=
!1}x.depthMask(q.depth_mask);q.use_backface_culling?x.enable(x.CULL_FACE):x.disable(x.CULL_FACE);l=q.textures;for(q=0;q<l.length;q++)N=l[q],x.activeTexture(x.TEXTURE0+q),x.bindTexture(N.w_target,N.w_texture);if("SKY"==m.type){l=m;I=I.uniforms;q=l.camera.color_attachment.w_texture;N=l.cube_view_matrices;for(J=0;6>J;J++)if(B=h(J),E.clear_procedural_sky_hack?(x.bindTexture(x.TEXTURE_CUBE_MAP,q),x.texImage2D(B,0,x.RGBA,1,1,0,x.RGBA,x.UNSIGNED_BYTE,C)):(x.uniformMatrix4fv(I.u_cube_view_matrix,!1,N[J]),
x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,B,q,0),b(k,K,p.va_frame)),l.need_fog_update&&3!=J){var B=l,w=J,t=z;E.clear_procedural_sky_hack?t.set(C):(x.readPixels(191,191,1,1,x.RGBA,x.UNSIGNED_BYTE,t),255!=t[0]&&255!=t[1]&&255!=t[2]||x.readPixels(191,220,1,1,x.RGBA,x.UNSIGNED_BYTE,t));var y=t[0],F=t[1],t=t[2],y=y/255,F=F/255,t=t/255;2===w?(B.cube_fog[3]=y,B.cube_fog[7]=F,B.cube_fog[11]=t):2>w?(B.cube_fog[4*w]=y,B.cube_fog[4*w+1]=F,B.cube_fog[4*w+2]=t):(B.cube_fog[4*(w-2)]=y,B.cube_fog[4*
(w-2)+1]=F,B.cube_fog[4*(w-2)+2]=t)}m.debug_render_calls+=6}else b(k,K,p.va_frame),m.debug_render_calls++}}}function c(a){if(a){var b=(a.clear_color?x.COLOR_BUFFER_BIT:0)|(a.clear_depth?x.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "MAIN_GLOW":a=H;break;case "SHADOW_CAST":a=l;break;case "SHADOW_RECEIVE":a=t;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=F;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=H;break;
default:a=E.background_color}}else b=x.COLOR_BUFFER_BIT|x.DEPTH_BUFFER_BIT,a=E.background_color;x.colorMask(!0,!0,!0,!0);x.depthMask(!0);x.clearColor(a[0],a[1],a[2],a[3]);x.clear(b)}function b(a,b,c){x.bindBuffer(x.ARRAY_BUFFER,a.vbo);for(var d=0;d<b.length;d++){var g=b[d];x.enableVertexAttribArray(g.loc);x.vertexAttribPointer(g.loc,g.num_comp,x.FLOAT,!1,0,g.base_offset+g.frame_length*c)}a.ibo?(x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,a.ibo),x.drawElements(a.mode,a.count,a.ibo_type,0)):x.drawArrays(a.mode,
0,a.count);for(d=0;d<b.length;d++)g=b[d],x.disableVertexAttribArray(g.loc)}function h(a){switch(a){case 0:return x.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return x.TEXTURE_CUBE_MAP_NEGATIVE_X;case 2:return x.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return x.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return x.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return x.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function d(a){var b=a.uniforms,c=[],d=[],f={},h;for(h in b){var k=!1;switch(h){case "u_proj_matrix":var m=function(a,b,c,e,d,g){a.uniformMatrix4fv(b,
!1,g.proj_matrix)},k=!0;break;case "u_view_matrix":m=function(a,b,c,e,d,g){a.uniformMatrix4fv(b,!1,g.view_matrix)};k=!0;break;case "u_view_tsr":case "u_view_tsr_frag":m=function(a,b,c,e,d,g){g.reflection_plane?a.uniformMatrix3fv(b,!1,g.real_view_tsr):a.uniformMatrix3fv(b,!1,g.view_tsr)};k=!0;break;case "u_view_zup_tsr":m=function(a,b,c,e,d,g){g.reflection_plane?a.uniformMatrix3fv(b,!1,g.real_view_zup_tsr):a.uniformMatrix3fv(b,!1,g.view_zup_tsr)};k=!0;break;case "u_view_zup_tsr_inverse":m=function(a,
b,c,e,d,g){g.reflection_plane?a.uniformMatrix3fv(b,!1,g.real_view_inv_zup_tsr):a.uniformMatrix3fv(b,!1,g.view_inv_zup_tsr)};k=!0;break;case "u_shadow_cast_billboard_view_tsr":m=function(a,b,c,e,d,g){a.uniformMatrix3fv(b,!1,g.shadow_cast_billboard_view_tsr)};k=!0;break;case "u_view_proj_prev":m=function(a,b,c,e,d,g){a.uniformMatrix4fv(b,!1,g.prev_view_proj_matrix)};k=!0;break;case "u_view_proj_matrix":m=function(a,b,c,e,d,g){a.uniformMatrix4fv(b,!1,g.view_proj_matrix)};k=!0;break;case "u_view_proj_inverse":m=
function(a,b,c,e,d,g){a.uniformMatrix4fv(b,!1,g.view_proj_inv_matrix)};k=!0;break;case "u_sky_vp_inverse":m=function(a,b,c,e,d,g){a.uniformMatrix4fv(b,!1,g.sky_vp_inv_matrix)};k=!0;break;case "u_camera_eye":case "u_camera_eye_frag":m=function(a,b,c,e,d,f){a.uniform3fv(b,g.get_trans_value(f.world_tsr,y))};k=!0;break;case "u_camera_quat":m=function(a,b,c,e,d,f){a.uniform4fv(b,g.get_quat_view(f.world_tsr))};k=!0;break;case "u_view_max_depth":m=function(a,b,c,e,d,g){a.uniform1f(b,g.far)};k=!0;break;case "u_camera_range":m=
function(a,b,c,e,d,g){a.uniform2f(b,g.near,g.far)};break;case "u_csm_center_dists":m=function(a,b,c,e,d,g){a.uniform4fv(b,g.csm_center_dists)};break;case "u_cam_water_depth":m=function(a,b,c,e,d,g){a.uniform1f(b,c.cam_water_depth)};k=!0;break;case "u_waves_height":m=function(a,b,c,e,d,g){a.uniform1f(b,c.water_waves_height)};break;case "u_waves_length":m=function(a,b,c,e,d,g){a.uniform1f(b,c.water_waves_length)};break;case "u_fog_color_density":m=function(a,b,c,e,d,g){a.uniform4fv(b,c.fog_color_density)};
break;case "u_fog_params":m=function(a,b,c,e,d,g){a.uniform4fv(b,c.fog_params)};break;case "u_underwater_fog_color_density":m=function(a,b,c,e,d,g){a.uniform4fv(b,c.water_fog_color_density)};break;case "u_bloom_key":m=function(a,b,c,e,d,g){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":m=function(a,b,c,e,d,g){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":m=function(a,b,c,e,d,g){a.uniform1f(b,c.time)};k=!0;break;case "u_wind":m=function(a,b,c,e,d,g){a.uniform3fv(b,c.wind)};k=!0;break;
case "u_sky_tex_dvar":m=function(a,b,c,e,d,g){a.uniform1f(b,c.sky_tex_default_value)};break;case "u_sky_tex_fac":m=function(a,b,c,e,d,g){a.uniform4fv(b,c.sky_tex_fac)};break;case "u_sky_tex_color":m=function(a,b,c,e,d,g){a.uniform3fv(b,c.sky_tex_color)};break;case "u_horizon_color":m=function(a,b,c,e,d,g){a.uniform3fv(b,c.horizon_color)};break;case "u_zenith_color":m=function(a,b,c,e,d,g){a.uniform3fv(b,c.zenith_color)};break;case "u_environment_energy":m=function(a,b,c,e,d,g){a.uniform1f(b,c.environment_energy)};
break;case "u_sky_color":m=function(a,b,c,e,d,g){a.uniform3fv(b,c.sky_color)};break;case "u_rayleigh_brightness":m=function(a,b,c,e,d,g){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":m=function(a,b,c,e,d,g){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":m=function(a,b,c,e,d,g){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":m=function(a,b,c,e,d,g){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":m=function(a,b,c,e,d,g){a.uniform1f(b,
c.rayleigh_strength)};break;case "u_mie_strength":m=function(a,b,c,e,d,g){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":m=function(a,b,c,e,d,g){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":m=function(a,b,c,e,d,g){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":m=function(a,b,c,e,d,g){a.uniform1f(b,c.mie_distribution)};break;case "u_light_positions":m=function(a,b,c,e,d,g){a.uniform3fv(b,c.light_positions)};break;case "u_light_directions":m=
function(a,b,c,e,d,g){a.uniform3fv(b,c.light_directions)};break;case "u_light_color_intensities":m=function(a,b,c,e,d,g){a.uniform3fv(b,c.light_color_intensities)};break;case "u_light_factors":m=function(a,b,c,e,d,g){a.uniform4fv(b,c.light_factors)};break;case "u_sun_quaternion":m=function(a,b,c,e,d,g){a.uniform4fv(b,c.sun_quaternion)};break;case "u_sun_intensity":m=function(a,b,c,e,d,g){a.uniform3fv(b,c.sun_intensity)};break;case "u_sun_direction":m=function(a,b,c,e,d,g){a.uniform3fv(b,c.sun_direction)};
break;case "u_height":m=function(a,b,c,e,d,g){a.uniform1f(b,g.height)};k=!0;break;case "u_model_tsr":m=function(a,b,c,e,d,g){a.uniformMatrix3fv(b,!1,e.world_tsr)};k=!0;break;case "u_model_zup_tsr":m=function(a,b,c,e,d,g){a.uniformMatrix3fv(b,!1,e.world_zup_tsr)};k=!0;break;case "u_model_zup_tsr_inverse":m=function(a,b,c,e,d,g){a.uniformMatrix3fv(b,!1,e.world_inv_zup_tsr)};k=!0;break;case "u_transb":m=function(a,b,c,e,d,g){a.uniform4fv(b,e.trans_before)};k=!0;break;case "u_transa":m=function(a,b,c,
e,d,g){a.uniform4fv(b,e.trans_after)};k=!0;break;case "u_arm_rel_trans":m=function(a,b,c,e,d,g){a.uniform4fv(b,e.arm_rel_trans)};k=!0;break;case "u_arm_rel_quat":m=function(a,b,c,e,d,g){a.uniform4fv(b,e.arm_rel_quat)};k=!0;break;case "u_quat":m=function(a,b,c,e,d,f){c=g.get_quat_view(e.world_tsr);a.uniform4fv(b,c)};k=!0;break;case "u_quatsb":m=function(a,b,c,e,d,g){a.uniform4fv(b,e.quats_before)};k=!0;break;case "u_quatsa":m=function(a,b,c,e,d,g){a.uniform4fv(b,e.quats_after)};k=!0;break;case "u_frame_factor":m=
function(a,b,c,e,d,g){a.uniform1f(b,e.frame_factor)};k=!0;break;case "au_center_pos":m=function(a,b,c,e,d,g){};k=!0;break;case "au_wind_bending_amp":m=function(a,b,c,e,d,g){a.uniform1f(b,e.wind_bending_amp)};k=!0;break;case "au_wind_bending_freq":m=function(a,b,c,e,d,g){a.uniform1f(b,e.wind_bending_freq)};k=!0;break;case "au_detail_bending_freq":m=function(a,b,c,e,d,g){a.uniform1f(b,e.detail_bending_freq)};k=!0;break;case "au_detail_bending_amp":m=function(a,b,c,e,d,g){a.uniform1f(b,e.detail_bending_amp)};
k=!0;break;case "au_branch_bending_amp":m=function(a,b,c,e,d,g){a.uniform1f(b,e.branch_bending_amp)};k=!0;break;case "u_node_values":m=function(a,b,c,e,d,g){a.uniform1fv(b,d.node_values)};k=!0;break;case "u_node_rgbs":m=function(a,b,c,e,d,g){a.uniform3fv(b,d.node_rgbs)};k=!0;break;case "u_diffuse_color":m=function(a,b,c,e,d,g){a.uniform4fv(b,d.diffuse_color)};k=!0;break;case "u_diffuse_intensity":m=function(a,b,c,e,d,g){a.uniform1f(b,d.diffuse_intensity)};k=!0;break;case "u_diffuse_params":m=function(a,
b,c,e,d,g){a.uniform2fv(b,d.diffuse_params)};k=!0;break;case "u_emit":m=function(a,b,c,e,d,g){a.uniform1f(b,d.emit)};k=!0;break;case "u_ambient":m=function(a,b,c,e,d,g){a.uniform1f(b,d.ambient)};k=!0;break;case "u_specular_color":m=function(a,b,c,e,d,g){a.uniform3fv(b,d.specular_color)};k=!0;break;case "u_specular_alpha":m=function(a,b,c,e,d,g){a.uniform1f(b,d.specular_alpha)};k=!0;break;case "u_specular_params":m=function(a,b,c,e,d,g){a.uniform3fv(b,d.specular_params)};k=!0;break;case "u_reflect_factor":m=
function(a,b,c,e,d,g){a.uniform1f(b,d.reflect_factor)};k=!0;break;case "u_mirror_factor":m=function(a,b,c,e,d,g){a.uniform1f(b,d.mirror_factor)};k=!0;break;case "u_grass_map_dim":m=function(a,b,c,e,d,g){a.uniform3fv(b,d.grass_map_dim)};k=!0;break;case "u_grass_size":m=function(a,b,c,e,d,g){a.uniform1f(b,d.grass_size)};k=!0;break;case "u_scale_threshold":m=function(a,b,c,e,d,g){a.uniform1f(b,d.grass_scale_threshold)};k=!0;break;case "u_cube_fog":m=function(a,b,c,e,d,g){a.uniformMatrix4fv(b,!1,d.cube_fog)};
break;case "u_jitter_amp":m=function(a,b,c,e,d,g){a.uniform1f(b,d.jitter_amp)};k=!0;break;case "u_jitter_freq":m=function(a,b,c,e,d,g){a.uniform1f(b,d.jitter_freq)};k=!0;break;case "u_debug_view_mode":m=function(a,b,c,e,d,g){a.uniform1i(b,d.debug_view_mode)};break;case "u_debug_colors_seed":m=function(a,b,c,e,d,g){a.uniform1f(b,c.debug_colors_seed)};break;case "u_wireframe_edge_color":m=function(a,b,c,e,d,g){a.uniform3fv(b,d.wireframe_edge_color)};break;case "u_cluster_id":m=function(a,b,c,e,d,g){a.uniform1f(b,
d.cluster_id)};k=!0;break;case "u_batch_debug_id":m=function(a,b,c,e,d,g){a.uniform1f(b,d.debug_id)};k=!0;break;case "u_subpixel_jitter":m=function(a,b,c,e,d,g){a.uniform2fv(b,c.jitter_projection_space)};k=!0;break;case "u_subsample_indices":m=function(a,b,c,e,d,g){a.uniform4fv(b,c.jitter_subsample_ind)};k=!0;break;case "u_refr_bump":m=function(a,b,c,e,d,g){a.uniform1f(b,d.refr_bump)};k=!0;break;case "u_line_width":m=function(a,b,c,e,d,g){a.uniform1f(b,d.line_width)};k=!0;break;case "u_lamp_light_positions":m=
function(a,b,c,e,d,g){a.uniform3fv(b,d.lamp_light_positions)};break;case "u_lamp_light_directions":m=function(a,b,c,e,d,g){a.uniform3fv(b,d.lamp_light_directions)};break;case "u_lamp_light_color_intensities":m=function(a,b,c,e,d,g){a.uniform3fv(b,d.lamp_light_color_intensities)};break;case "u_lamp_light_factors":m=function(a,b,c,e,d,g){a.uniform4fv(b,d.lamp_light_factors)};break;case "u_halo_size":m=function(a,b,c,e,d,g){a.uniform1f(b,d.halo_size)};k=!0;break;case "u_halo_hardness":m=function(a,b,
c,e,d,g){a.uniform1f(b,d.halo_hardness)};k=!0;break;case "u_halo_rings_color":m=function(a,b,c,e,d,g){a.uniform3fv(b,d.halo_rings_color)};k=!0;break;case "u_halo_lines_color":m=function(a,b,c,e,d,g){a.uniform3fv(b,d.halo_lines_color)};k=!0;break;case "u_halo_stars_blend":m=function(a,b,c,e,d,g){a.uniform1f(b,d.halo_stars_blend)};k=!0;break;case "u_halo_stars_height":m=function(a,b,c,e,d,g){a.uniform1f(b,d.halo_stars_height)};k=!0;break;case "u_fresnel_params":m=function(a,b,c,e,d,g){a.uniform4fv(b,
d.fresnel_params)};k=!0;break;case "u_texture_scale":m=function(a,b,c,e,d,g){a.uniform3fv(b,d.texture_scale)};k=!0;break;case "u_parallax_scale":m=function(a,b,c,e,d,g){a.uniform1f(b,d.parallax_scale)};k=!0;break;case "u_color_id":m=function(a,b,c,e,d,g){a.uniform3fv(b,e.color_id)};k=!0;break;case "u_line_points":m=function(a,b,c,e,d,g){a.uniform3fv(b,d.line_points)};k=!0;break;case "u_diffuse_color_factor":m=function(a,b,c,e,d,g){a.uniform1f(b,d.diffuse_color_factor)};k=!0;break;case "u_alpha_factor":m=
function(a,b,c,e,d,g){a.uniform1f(b,d.alpha_factor)};k=!0;break;case "u_specular_color_factor":m=function(a,b,c,e,d,g){a.uniform1f(b,d.specular_color_factor)};k=!0;break;case "u_normal_factor":m=function(a,b,c,e,d,g){a.uniform1f(b,d.normal_factor)};k=!0;break;case "u_normalmap0_scale":m=function(a,b,c,e,d,g){a.uniform2fv(b,d.normalmap_scales[0])};k=!0;break;case "u_normalmap1_scale":m=function(a,b,c,e,d,g){a.uniform2fv(b,d.normalmap_scales[1])};k=!0;break;case "u_normalmap2_scale":m=function(a,b,
c,e,d,g){a.uniform2fv(b,d.normalmap_scales[2])};k=!0;break;case "u_normalmap3_scale":m=function(a,b,c,e,d,g){a.uniform2fv(b,d.normalmap_scales[3])};k=!0;break;case "u_foam_factor":m=function(a,b,c,e,d,g){a.uniform1f(b,d.foam_factor)};k=!0;break;case "u_foam_uv_freq":m=function(a,b,c,e,d,g){a.uniform2fv(b,d.foam_uv_freq)};k=!0;break;case "u_foam_mag":m=function(a,b,c,e,d,g){a.uniform2fv(b,d.foam_mag)};k=!0;break;case "u_foam_scale":m=function(a,b,c,e,d,g){a.uniform2fv(b,d.foam_scale)};k=!0;break;case "u_water_norm_uv_velocity":m=
function(a,b,c,e,d,g){a.uniform1f(b,d.water_norm_uv_velocity)};k=!0;break;case "u_shallow_water_col":m=function(a,b,c,e,d,g){a.uniform3fv(b,d.shallow_water_col)};k=!0;break;case "u_shore_water_col":m=function(a,b,c,e,d,g){a.uniform3fv(b,d.shore_water_col)};k=!0;break;case "u_water_shallow_col_fac":m=function(a,b,c,e,d,g){a.uniform1f(b,d.shallow_water_col_fac)};k=!0;break;case "u_water_shore_col_fac":m=function(a,b,c,e,d,g){a.uniform1f(b,d.shore_water_col_fac)};k=!0;break;case "u_p_length":m=function(a,
b,c,e,d,g){a.uniform1f(b,d.particles_data.time_length)};k=!0;break;case "u_p_cyclic":m=function(a,b,c,e,d,g){a.uniform1i(b,d.particles_data.cyclic)};k=!0;break;case "u_p_max_lifetime":m=function(a,b,c,e,d,g){a.uniform1f(b,d.particles_data.lifetime)};k=!0;break;case "u_p_fade_in":m=function(a,b,c,e,d,g){a.uniform1f(b,d.particles_data.fade_in)};k=!0;break;case "u_p_fade_out":m=function(a,b,c,e,d,g){a.uniform1f(b,d.particles_data.fade_out)};k=!0;break;case "u_p_size":m=function(a,b,c,e,d,g){a.uniform1f(b,
d.particles_data.size)};k=!0;break;case "u_p_alpha_start":m=function(a,b,c,e,d,g){a.uniform1f(b,d.particles_data.alpha_start)};k=!0;break;case "u_p_alpha_end":m=function(a,b,c,e,d,g){a.uniform1f(b,d.particles_data.alpha_end)};k=!0;break;case "u_p_nfactor":m=function(a,b,c,e,d,g){a.uniform1f(b,d.particles_data.nfactor)};k=!0;break;case "u_p_gravity":m=function(a,b,c,e,d,g){a.uniform1f(b,d.particles_data.gravity)};k=!0;break;case "u_p_mass":m=function(a,b,c,e,d,g){a.uniform1f(b,d.particles_data.mass)};
k=!0;break;case "u_p_color_ramp":m=function(a,b,c,e,d,g){a.uniform4fv(b,d.particles_data.color_ramp)};k=!0;break;case "u_p_wind_fac":m=function(a,b,c,e,d,g){a.uniform1f(b,d.particles_data.wind_factor)};k=!0;break;case "u_texel_size":m=function(a,b,c,e,d,g){a.uniform2fv(b,c.texel_size)};k=!0;break;case "u_p_time":m=function(a,b,c,e,d,g){a.uniform1f(b,d.particles_data.time)};k=!0;break;case "u_p_tilt":m=function(a,b,c,e,d,g){a.uniform1f(b,d.particles_data.tilt)};k=!0;break;case "u_p_tilt_rand":m=function(a,
b,c,e,d,g){a.uniform1f(b,d.particles_data.tilt_rand)};k=!0;break;case "u_position":m=function(a,b,c,e,d,g){a.uniform3fv(b,d.positions)};k=!0;break;case "u_va_frame_factor":m=function(a,b,c,e,d,g){a.uniform1f(b,e.va_frame_factor)};k=!0;break;case "u_normal_offset":m=function(a,b,c,e,d,g){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":m=function(a,b,c,e,d,g){a.uniform4fv(b,g.pcf_blur_radii)};break;case "u_v_light_ts":m=function(a,b,c,e,d,g){a.uniform4fv(b,c.v_light_ts)};k=
!0;break;case "u_v_light_r":m=function(a,b,c,e,d,g){a.uniform4fv(b,c.v_light_r)};k=!0;break;case "u_v_light_tsr":m=function(a,b,c,e,d,g){a.uniformMatrix3fv(b,!1,c.v_light_tsr)};k=!0;break;case "u_p_light_matrix0":m=function(a,b,c,e,d,g){a.uniformMatrix4fv(b,!1,c.p_light_matrix[0])};k=!0;break;case "u_p_light_matrix1":m=function(a,b,c,e,d,g){a.uniformMatrix4fv(b,!1,c.p_light_matrix[1])};k=!0;break;case "u_p_light_matrix2":m=function(a,b,c,e,d,g){a.uniformMatrix4fv(b,!1,c.p_light_matrix[2])};k=!0;break;
case "u_p_light_matrix3":m=function(a,b,c,e,d,g){a.uniformMatrix4fv(b,!1,c.p_light_matrix[3])};k=!0;break;case "u_motion_blur_exp":m=function(a,b,c,e,d,g){a.uniform1f(b,c.motion_blur_exp)};k=!0;break;case "u_motion_blur_decay_threshold":m=function(a,b,c,e,d,g){a.uniform1f(b,c.mb_decay_threshold)};k=!0;break;case "u_refl_plane":m=function(a,b,c,e,d,g){a.uniform4fv(b,e.reflection_plane)};k=!0;break;case "u_radial_blur_step":m=function(a,b,c,e,d,g){a.uniform1f(b,c.radial_blur_step)};break;case "u_god_rays_intensity":m=
function(a,b,c,e,d,g){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":m=function(a,b,c,e,d,g){a.uniform1f(b,c.ssao_radius_increase)};break;case "u_ssao_blur_discard_value":m=function(a,b,c,e,d,g){a.uniform1f(b,c.ssao_blur_discard_value)};k=!0;break;case "u_ssao_influence":m=function(a,b,c,e,d,g){a.uniform1f(b,c.ssao_influence)};break;case "u_ssao_dist_factor":m=function(a,b,c,e,d,g){a.uniform1f(b,c.ssao_dist_factor)};break;case "u_dof_dist":m=function(a,b,c,e,d,g){g.dof_on?
a.uniform1f(b,g.dof_distance):a.uniform1f(b,0)};k=!0;break;case "u_dof_front":m=function(a,b,c,e,d,g){a.uniform1f(b,g.dof_front)};k=!0;break;case "u_dof_rear":m=function(a,b,c,e,d,g){a.uniform1f(b,g.dof_rear)};k=!0;break;case "u_outline_intensity":m=function(a,b,c,e,d,g){a.uniform1f(b,e.outline_intensity)};k=!0;break;case "u_outline_color":m=function(a,b,c,e,d,g){a.uniform3fv(b,c.outline_color)};break;case "u_draw_outline":m=function(a,b,c,e,d,g){a.uniform1f(b,c.draw_outline_flag)};k=!0;break;case "u_glow_mask_small_coeff":m=
function(a,b,c,e,d,g){a.uniform1f(b,c.small_glow_mask_coeff)};k=!0;break;case "u_glow_mask_large_coeff":m=function(a,b,c,e,d,g){a.uniform1f(b,c.large_glow_mask_coeff)};k=!0;break;case "u_brightness":m=function(a,b,c,e,d,g){a.uniform1f(b,c.brightness)};break;case "u_contrast":m=function(a,b,c,e,d,g){a.uniform1f(b,c.contrast)};break;case "u_exposure":m=function(a,b,c,e,d,g){a.uniform1f(b,c.exposure)};break;case "u_saturation":m=function(a,b,c,e,d,g){a.uniform1f(b,c.saturation)};break;case "u_enable_hmd_stereo":m=
function(a,b,c,e,d,g){a.uniform1i(b,c.enable_hmd_stereo)};break;case "u_distortion_params":m=function(a,b,c,e,d,g){a.uniform4fv(b,c.distortion_params)};break;case "u_chromatic_aberration_coefs":m=function(a,b,c,e,d,g){a.uniform4fv(b,c.chromatic_aberration_coefs)};break;default:m=null}m&&(m={name:h,fun:m,loc:b[h]},k?c.push(m):(d.push(m),f[h]=m))}a.transient_uniform_setters=c;d.length?(a.permanent_uniform_setters=d,a.permanent_uniform_setters_table=f):a.no_permanent_uniforms=!0}var q=r("__batch"),k=
r("__camera"),p=r("__config"),f=r("__debug"),w=r("__textures"),g=r("__tsr"),m=r("__util"),l=[1,1,1,1],t=[1,1,1,1],F=[0,0,0,1],H=[0,0,0,0],C=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var x=null,y=new Float32Array(3),z=new Uint8Array(4);new Float32Array(9);new Float32Array(8);var E=p.defaults;a.setup_context=function(a){var b=E.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);
a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);x=a};a.draw=function(a){if(a.do_render)if("RESOLVE"==a.type){f.render_time_start(a);var b=a.camera;x.bindFramebuffer(x.READ_FRAMEBUFFER,b.framebuffer_prev);x.bindFramebuffer(x.DRAW_FRAMEBUFFER,b.framebuffer);var d=0;b.color_attachment&&(d|=x.COLOR_BUFFER_BIT);b.depth_attachment&&(d|=x.DEPTH_BUFFER_BIT);x.blitFramebuffer(0,0,b.width,b.height,
0,0,b.width,b.height,d,x.NEAREST);f.render_time_stop(a);f.check_gl("draw resolve")}else if("COPY"==a.type)f.render_time_start(a),b=a.camera,x.bindFramebuffer(x.FRAMEBUFFER,b.framebuffer_prev),x.bindTexture(x.TEXTURE_2D,b.color_attachment.w_texture),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,b.width,b.height,0),f.render_time_stop(a),f.check_gl("draw copy");else{f.render_time_start(a);b=a.camera;x.bindFramebuffer(x.FRAMEBUFFER,b.framebuffer);a.assign_texture&&(d=b.color_attachment,x.framebufferTexture2D(x.FRAMEBUFFER,
x.COLOR_ATTACHMENT0,d.w_target,d.w_texture,0));x.viewport(0,0,b.width,b.height);"MAIN_CUBE_REFLECT"!=a.type&&"MAIN_CUBE_REFLECT_BLEND"!=a.type&&c(a);a.blend?x.enable(x.BLEND):x.disable(x.BLEND);a.depth_test?x.enable(x.DEPTH_TEST):x.disable(x.DEPTH_TEST);switch(a.type){case "SHADOW_CAST":x.enable(x.POLYGON_OFFSET_FILL);x.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);x.cullFace(x.BACK);break;case "MAIN_PLANE_REFLECT":case "MAIN_PLANE_REFLECT_BLEND":x.disable(x.POLYGON_OFFSET_FILL);
x.cullFace(x.FRONT);break;case "MAIN_GLOW":if(1<E.msaa_samples){x.enable(x.POLYGON_OFFSET_FILL);x.polygonOffset(-2,-2);break}default:x.disable(x.POLYGON_OFFSET_FILL),x.cullFace(x.BACK)}if("MAIN_CUBE_REFLECT"==a.type||"MAIN_CUBE_REFLECT_BLEND"==a.type)for(var b=a.camera,d=b.color_attachment.w_texture,m=0;6>m;m++){var l=h(m);b.view_matrix=a.cube_view_matrices[m];g.from_mat4(b.view_matrix,b.view_tsr);k.calc_sky_vp_inverse(b);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,l,d,0);c(a);for(var l=
a.bundles,p=0;p<l.length;p++)l[p].do_render=l[p].do_render_cube[m];u(a)}else u(a);f.render_time_stop(a);f.check_gl("draw subscene: "+a.type);x.bindFramebuffer(x.FRAMEBUFFER,null)}};a.clear=function(a){x.bindFramebuffer(x.FRAMEBUFFER,a.camera.framebuffer);c(a)};a.assign_attribute_setters=function(a){var b=a.attribute_setters;b.length=0;var c=a.bufs_data;a=a.shader;c&&a||m.panic("Incomplete batch");c=c.pointers;a=a.attributes;for(var d in a){var g=c[d];b.push({loc:a[d],base_offset:4*g.offset,frame_length:1<
g.frames?4*g.length:0,num_comp:g.num_comp})}};a.assign_uniform_setters=d;a.assign_texture_uniforms=function(a){var b=a.shader,c=a.textures;a=a.texture_names;x.useProgram(b.program);for(var d=0;d<c.length;d++)x.uniform1i(b.uniforms[a[d]],d)};a.read_pixels=function(a,b,c,d,g,f){d||(d=1);g||(g=1);f||(f=new Uint8Array(4*d*g));f.length!=4*d*g&&m.panic("read_pixels(): Wrong storage");x.bindFramebuffer(x.FRAMEBUFFER,a);x.readPixels(b,c,d,g,x.RGBA,x.UNSIGNED_BYTE,f);x.bindFramebuffer(x.FRAMEBUFFER,null);
return f};a.update_batch_permanent_uniform=function(a,b){var c=a.shader;c.no_permanent_uniforms||(x.useProgram(c.program),c.permanent_uniform_setters.length||d(c),c=c.permanent_uniform_setters_table[b],c.fun(x,c.loc,null,null,a,null))};a.render_target_create=function(a,b){var c=x.createFramebuffer();x.bindFramebuffer(x.FRAMEBUFFER,c);if(w.is_renderbuffer(a)){var d=a.w_renderbuffer;x.framebufferRenderbuffer(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.RENDERBUFFER,d)}else if(w.is_texture(a)){var g=a,d=g.w_texture,
g=g.w_target==x.TEXTURE_CUBE_MAP?x.TEXTURE_CUBE_MAP_NEGATIVE_Z:g.w_target;x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,g,d,0)}w.is_renderbuffer(b)?(d=b.w_renderbuffer,x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.RENDERBUFFER,d)):w.is_texture(b)&&(g=b,d=g.w_texture,g=g.w_target,x.framebufferTexture2D(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,g,d,0));f.check_bound_fb();x.bindFramebuffer(x.FRAMEBUFFER,null);return c};a.render_target_cleanup=function(a,b,c,d,g){null==a?(x.bindFramebuffer(x.FRAMEBUFFER,
a),x.viewport(0,0,d,g),x.clear(x.COLOR_BUFFER_BIT|x.DEPTH_BUFFER_BIT)):(w.is_renderbuffer(b)?x.deleteRenderbuffer(b.w_renderbuffer):w.is_texture(b)&&x.deleteTexture(b.w_texture),w.is_renderbuffer(c)?x.deleteRenderbuffer(c.w_renderbuffer):w.is_texture(c)&&x.deleteTexture(c.w_texture),x.deleteFramebuffer(a))};a.increment_subpixel_index=function(){};a.draw_resized_cubemap_texture=function(a,c,d,g,f,h){a=a.w_texture;x.viewport(0,0,d,d);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,c,a,0);c=
q.create_postprocessing_batch("FLIP_CUBEMAP_COORDS");a=c.shader;x.activeTexture(x.TEXTURE0);x.bindTexture(x.TEXTURE_2D,f);var m=f=0;d!=g&&(f=1/(6*g),m=1/(4*g));x.uniform1i(a.uniforms.u_tex_number,h);x.uniform2fv(a.uniforms.u_delta,[f,m]);x.useProgram(a.program);b(c.bufs_data,c.attribute_setters,0);x.bindTexture(x.TEXTURE_2D,null)};a.draw_resized_texture=function(a,c,d,g,f,h){x.bindFramebuffer(x.FRAMEBUFFER,g);g=a.w_texture;a=a.w_target;x.bindTexture(a,g);x.viewport(0,0,c,d);x.texImage2D(a,0,x.RGBA,
c,d,0,x.RGBA,x.UNSIGNED_BYTE,null);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,a,g,0);c=q.create_postprocessing_batch(h);d=c.shader;x.bindTexture(a,null);x.activeTexture(x.TEXTURE0);x.bindTexture(a,f);x.useProgram(d.program);b(c.bufs_data,c.attribute_setters,0);x.bindFramebuffer(x.FRAMEBUFFER,null);x.bindTexture(a,null)};a.cleanup=function(){}};b4w.module.__shaders=function(a,r){function u(a,b,e){var d=a.directives;"string"==typeof e&&(a=c(a,e))&&(e=a[1]);for(a=0;a<d.length;a++)if(d[a][0]==b){d[a][1]=e;return}d.push([b,e])}function c(a,b){for(var c=a.directives,e=0;e<c.length;e++)if(c[e][0]==b)return c[e];return!1}function b(a,b){var c=a+b;if(x[c])return x[c];if(y){var e=y[b];if(!e)return null;e=r("__gpp_parser").parser.parse(e)}else if(e=r("shader_texts")[b],!e)return null;return x[c]=e}function h(a,c,e){function g(c){c=c.parts;for(var e=
0;e<c.length;e++){var l=c[e];switch(l.type){case "condition":a:for(var l=l.parts,D=0;D<l.length;D++){var B=l[D];switch(B.type){case "if":case "elif":if(f(B.expression)){g(B.group);break a}break;case "else":g(B.group);break a;case "ifdef":B.name in k&&g(B.group);break;case "ifndef":B.name in k||g(B.group)}}break;case "include":l=b(H.shaders_dir,H.shaders_include_dir+l.file);g(l);break;case "var":case "export":case "import":break;case "define":D=l.name;k[D]=l.tokens;l.params&&(p[D]=l.params);break;
case "error":throw"Shader error: #error "+l.tokens.join(" ");case "line":break;case "pragma":n.push("#pragma "+l.name+" "+l.tokens.join(" "));break;case "undef":l=l.name;delete k[l];delete p[l];break;case "warning":t.warn("Shader warning: #warning "+l.tokens.join(" "));break;case "extension":l=d(l.tokens,k,p,!1);n.push("#extension "+l.join(" "));break;case "#":break;case "node":q[l.name]=l;break;case "nodes_global":l=m;for(D=0;D<l.length;D++){var B=l[D],ka=q[B.id];if(ka)for(var W=0,A=0;A<ka.declarations.length;A++){var z=
ka.declarations[A];if("node_param"==z.type){var G;G=B;if("PARTICLE_INFO"==G.id&&z.is_optional)if(1==k.PARTICLE_BATCH){var F=!1;switch(W){case 0:F=w(G.dirs,"PART_INFO_IND")||w(G.dirs,"PART_INFO_AGE")||w(G.dirs,"PART_INFO_LT")||w(G.dirs,"PART_INFO_SIZE");break;case 1:F=w(G.dirs,"PART_INFO_LOC");break;case 2:F=w(G.dirs,"PART_INFO_VEL");break;case 3:F=w(G.dirs,"PART_INFO_A_VEL");break;case 4:F=w(G.dirs,"PART_INFO_IND")}G=F}else G=!1;else G=!0;G&&(z=z.qualifier.join(" ")+" ","vert"==a?z+=B.vparams[W]:
"frag"==a&&(z+=B.params[W],null!==B.param_values[W]&&(z+=" = "+B.param_values[W])),z+=";",n.push(z));W++}}}break;case "nodes_main":l=m;for(D=0;D<l.length;D++)if(B=l[D],ka=q[B.id]){W={};A={};for(z=0;z<B.dirs.length;z++)A[B.dirs[z][0]]=[B.dirs[z][1]];E=C=y=0;z=B;G=ka.declarations;for(var F=W,r=A,u=0;u<G.length;u++){var O=G[u];switch(O.type){case "node_in":var R=z.inputs[y];if(null!==z.input_values[y]){if(("MATERIAL_BEGIN"==z.id&&3===y||!r.MATERIAL_EXT&&("MATERIAL_BEGIN"==z.id&&4===y||"MATERIAL_END"==
z.id&&3===y||"MATERIAL_END"==z.id&&4===y||"MATERIAL_END"==z.id&&5===y)||"TEXTURE_COLOR"==z.id||"TEXTURE_NORMAL"==z.id)&&O.is_optional){F[O.name]=z.input_values[y];y++;continue}var V=O.qualifier.join(" ")+" ",V=V+R,V=V+(" = "+z.input_values[y]),V=V+";";n.push(V)}F[O.name]=R;y++;break;case "node_out":R=z.outputs[C];if(!O.is_optional||-1<x.indexOf(R))V=O.qualifier.join(" ")+" ",V+=R,V+=";",n.push(V),F[O.name]=R;-1<x.indexOf(R)&&(r["USE_OUT_"+O.name]=[1]);C++;break;case "node_param":"vert"==a?R=z.vparams[E]:
"frag"==a&&(R=z.params[E]),F[O.name]=R,E++}}n.push("{");h(B,ka.statements,W,A);n.push("}")}break;case "textline":l=d(l.tokens,k,p,!1);n.push(l.join(" "));break;default:throw"Unknown element type: "+l.type;}}}function f(a,b){var c;c=d(a,k,p,!0,b);for(var e=[],g=0;g<c.length;g++)if(c[g]instanceof Object)switch(c[g].type){case "conditional_expr":var h=e.pop(),m=e.pop();e.pop()?e.push(m):e.push(h);break;case "logical_or_expr":h=e.pop();for(m=0;m<c[g].places-1;m++)n=e.pop(),h=h||n;e.push(h);break;case "logical_and_expr":h=
e.pop();for(m=0;m<c[g].places-1;m++)n=e.pop(),h=h&&n;e.push(h);break;case "logical_bitor_expr":h=e.pop();for(m=0;m<c[g].places-1;m++)h|=e.pop();e.push(h);break;case "logical_bitxor_expr":h=e.pop();for(m=0;m<c[g].places-1;m++)h^=e.pop();e.push(h);break;case "logical_bitand_expr":h=e.pop();for(m=0;m<c[g].places-1;m++)h&=e.pop();e.push(h);break;case "equal_expr":h=e.pop();m=e.pop();e.push(m==h);break;case "non_equal_expr":h=e.pop();m=e.pop();e.push(m!=h);break;case "le_expr":h=e.pop();m=e.pop();e.push(m<=
h);break;case "ge_expr":h=e.pop();m=e.pop();e.push(m>=h);break;case "l_expr":h=e.pop();m=e.pop();e.push(m<h);break;case "g_expr":h=e.pop();m=e.pop();e.push(m>h);break;case "left_shift_expr":m=e.pop();h=e.pop();e.push(m<<h);break;case "right_shift_expr":m=e.pop();h=e.pop();e.push(m>>h);break;case "add_expr":m=e.pop();h=e.pop();e.push(m+h);break;case "sub_expr":m=e.pop();h=e.pop();e.push(m-h);break;case "mul_expr":m=e.pop();h=e.pop();e.push(m*h);break;case "div_expr":m=e.pop();h=e.pop();e.push(m/h);
break;case "mod_expr":m=e.pop();h=e.pop();e.push(m%h);break;case "pre_inc_expr":case "post_inc_expr":n=e.pop();e.push(++n);break;case "pre_dec_expr":case "post_dec_expr":n=e.pop();e.push(--n);break;case "positive_expr":n=e.pop();e.push(+n);break;case "negative_expr":n=e.pop();e.push(-n);break;case "one_compl_expr":n=e.pop();e.push(~n);break;case "logic_negative_expr":n=e.pop();e.push(!n);break;default:F.panic("Unknown operation type: "+c[g].type)}else{var n=c[g];/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(n)?
e.push(0):e.push(parseFloat(c[g]))}1==e.length?c=e[0]:(F.panic("Incorrect expression: "+c.join(" ")),c=void 0);return c}function h(a,b,c,e){for(var g=0;g<b.length;g++){var m=b[g];switch(m.type){case "node_condition":a:for(var l=a,m=m.parts,D=c,B=e,q=0;q<m.length;q++){var M=m[q];switch(M.type){case "node_if":case "node_elif":if(f(M.expression,B)){h(l,M.statements,D,B);break a}break;case "node_else":h(l,M.statements,D,B);break a;case "node_ifdef":(M.name in k||M.name in B)&&h(l,M.statements,D,B);break;
case "node_ifndef":M.name in k||M.name in B||h(l,M.statements,D,B)}}break;case "textline":l=[];for(D=0;D<m.tokens.length;D++)B=m.tokens[D],B in c?l.push(c[B]):l.push(B);l=d(l,k,p,!0,e);n.push(l.join(" "))}}}var m=e.node_elements;e=e.directives||[];for(var n=[],k={},l=0;l<e.length;l++)k[e[l][0]]=[e[l][1]];for(l=0;l<m.length;l++)k["USE_NODE_"+m[l].id]=[1];var p={},q={},x=[];for(l in m)for(var z in m[l].inputs)x.push(m[l].inputs[z]);g(c);var y=0,C=0,E=0;return n.join("\n")}function d(a,b,c,e,d){var g=
[];q(a,b,c,e,g,d);return g}function q(a,b,c,e,d,g){for(var h=0;h<a.length;h++){var f=a[h];f in b||g&&f in g?(f=g&&g[f]||b[f],0==f.length&&e?d.push(0):q(f,b,c,e,d,g)):d.push(f)}}function k(a,b,c,e,d){e=a.createShader(e);a.shaderSource(e,c);a.compileShader(e);l.check_shader_compiling(e,b,c);return e}function p(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return f(a);case 2:return"vec2("+f(a[0])+","+f(a[1])+")";case 3:return"vec3("+f(a[0])+","+f(a[1])+","+f(a[2])+")";case 4:return"vec4("+f(a[0])+
","+f(a[1])+","+f(a[2])+","+f(a[3])+")";case 9:return"mat3("+f(a[0])+","+f(a[1])+","+f(a[2])+","+f(a[3])+","+f(a[4])+","+f(a[5])+","+f(a[6])+","+f(a[7])+","+f(a[8])+")";case 16:return"mat4("+f(a[0])+","+f(a[1])+","+f(a[2])+","+f(a[3])+","+f(a[4])+","+f(a[5])+","+f(a[6])+","+f(a[7])+","+f(a[8])+","+f(a[9])+","+f(a[10])+","+f(a[11])+","+f(a[12])+","+f(a[13])+","+f(a[14])+","+f(a[15])+")";default:throw"Wrong glsl value dimension";}}function f(a){return a%1?String(a):String(a)+".0"}function w(a,b){for(var c=
0;c<a.length;c++)if(a[c][0]==b)return!0;return!1}var g=r("__assets"),m=r("__config"),l=r("__debug"),t=r("__print"),F=r("__util"),H=m.paths,C={},x={},y=null,z="anchors.glslf anchors.glslv color_id.glslf color_id.glslv shadow.glslf shadow.glslv grass_map.glslf grass_map.glslv halo.glslf halo.glslv line.glslf line.glslv main.glslf main.glslv main_stack.glslf particle_system.glslf particle_system_stack.glslf particle_system.glslv procedural_skydome.glslf procedural_skydome.glslv special_lens_flares.glslf special_lens_flares.glslv special_skydome.glslf special_skydome.glslv special_water.glslf special_water.glslv debug_view.glslf debug_view.glslv postprocessing/antialiasing.glslf postprocessing/bloom_combine.glslf postprocessing/compositing.glslf postprocessing/depth_pack.glslf postprocessing/dof.glslf postprocessing/glow.glslf postprocessing/bloom_blur.glslf postprocessing/god_rays.glslf postprocessing/god_rays.glslv postprocessing/god_rays_combine.glslf postprocessing/luminance.glslf postprocessing/luminance_av.glslf postprocessing/luminance_trunced.glslf postprocessing/luminance_trunced.glslv postprocessing/motion_blur.glslf postprocessing/outline.glslf postprocessing/performance.glslf postprocessing/postprocessing.glslf postprocessing/postprocessing.glslv postprocessing/smaa.glslf postprocessing/smaa.glslv postprocessing/ssao.glslf postprocessing/ssao_blur.glslf postprocessing/stereo.glslf include/blending.glslf include/caustics.glslf include/color_util.glslf include/depth_fetch.glslf include/dynamic_grass.glslv include/environment.glslf include/fog.glslf include/fxaa.glslf include/halo_color.glslf include/lighting_nodes.glslf include/math.glslv include/mirror.glslf include/nodes.glslf include/nodes.glslv include/pack.glslf include/particles.glslv include/particles_nodes.glslf include/particles_nodes.glslv include/precision_statement.glslf include/procedural.glslf include/refraction.glslf include/scale_texcoord.glslv include/shadow.glslf include/shadow.glslv include/skin.glslv include/std_enums.glsl include/to_world.glslv include/wind_bending.glslv".split(" "),
E=[],e=null,n=!1;a.setup_context=function(a){e=a};a.set_directive=u;a.get_directive=c;a.is_enabled=function(a,b){for(var c=a.directives,e=0;e<c.length;e++)if(c[e][0]==b&&1==c[e][1])return!0;return!1};a.set_default_directives=function(a){a.directives=[];for(var b="ALPHA ALPHA_CLIP ANAGLYPH BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_DISTORTION_CORRECTION DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG PROCEDURAL_SKYDOME REFLECTION REFLECTION_PASS REFLECTION_TYPE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA MTEX_NEGATIVE MTEX_RGBTOINT NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_USAGE POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT USE_FOG WEBGL2 WO_SKYBLEND WO_SKYPAPER WO_SKYREAL WO_SKYTEX WOMAP_BLEND WOMAP_HORIZ WOMAP_ZENUP WOMAP_ZENDOWN WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS NUM_CAST_LAMPS SUN_NUM MAC_OS_SHADOW_HACK USE_COLOR_RAMP HALO_PARTICLES PARTICLE_BATCH".split(" "),
c=0;c<b.length;c++){var e=b[c],d;switch(e){case "ALPHA":case "ALPHA_CLIP":case "ANAGLYPH":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_DISTORTION_CORRECTION":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "MTEX_NEGATIVE":case "MTEX_RGBTOINT":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "PROCEDURAL_SKYDOME":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTION_TYPE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "USE_FOG":case "WO_SKYBLEND":case "WO_SKYPAPER":case "WO_SKYREAL":case "WO_SKYTEX":case "WOMAP_BLEND":case "WOMAP_HORIZ":case "WOMAP_ZENUP":case "WOMAP_ZENDOWN":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":case "NUM_CAST_LAMPS":case "SUN_NUM":case "MAC_OS_SHADOW_HACK":case "USE_COLOR_RAMP":case "HALO_PARTICLES":case "PARTICLE_BATCH":d=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":d=1;break;case "WEBGL2":d=m.defaults.webgl2|0;break;case "EPSILON":d="highp"==m.defaults.precision?1E-6:1E-4;break;case "SHADOW_TEX_RES":d=p(2048);break;case "AA_METHOD":d="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":d="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":d="BILLBOARD_ALIGN_VIEW";break;
case "POST_EFFECT":d="POST_EFFECT_NONE";break;case "SHADOW_USAGE":d="NO_SHADOWS";break;case "SSAO_QUALITY":d="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":d="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":d="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":d=m.defaults.precision;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":d="u_va_frame_factor";break;default:t.error("Unknown directive ("+a.vert+", "+a.frag+"): "+e)}u(a,e,d)}};a.get_vname=function(a){return a.vert};a.get_fname=function(a){return a.frag};
a.inherit_directives=function(a,b){for(var e=b.directives,d=0;d<e.length;d++){var g=e[d][0],h=e[d][1];c(a,g)&&u(a,g,h)}};a.get_compiled_shader=function(a){var c=JSON.stringify(a),d=C[c];if(d)return d;var g=a.frag,d=b(H.shaders_dir,a.vert),g=b(H.shaders_dir,g);if(!d||!g)return null;var f=h("vert",d,a),m=h("frag",g,a),d=e,n=k(d,c,f,d.VERTEX_SHADER,a),p=k(d,c,m,d.FRAGMENT_SHADER,a),g=d.createProgram();d.attachShader(g,n);d.attachShader(g,p);d.linkProgram(g);d.validateProgram(g);d.getProgramParameter(g,
d.VALIDATE_STATUS)==d.FALSE&&t.error("shader program is not valid",c);l.check_shader_linking(g,c,n,p,f,m);a={vshader:n,fshader:p,program:g,attributes:{},uniforms:{},permanent_uniform_setters:[],permanent_uniform_setters_table:{},need_uniforms_update:!0,no_permanent_uniforms:!1,transient_uniform_setters:[],shaders_info:a};m=d.getProgramParameter(g,d.ACTIVE_ATTRIBUTES);for(f=0;f<m;f++)n=d.getActiveAttrib(g,f).name,p=d.getAttribLocation(g,n),a.attributes[n]=p;m=d.getProgramParameter(g,d.ACTIVE_UNIFORMS);
for(f=0;f<m;f++)n=d.getActiveUniform(g,f).name.split("[0]").join(""),p=d.getUniformLocation(g,n),a.uniforms[n]=p;return C[c]=d=a};a.load_shaders=function(){n=!1;if(b4w.module_check("shader_texts"))n=!0;else{for(var a=[],b=g.AT_TEXT,c=0;c<z.length;c++){var e=F.normpath_preserve_protocol(H.shaders_dir+z[c]);a.push({id:z[c],type:b,url:e})}b=function(a,b,c,e){y||(y={});y[b]=a};a.length?g.enqueue(a,b,function(){n=!0}):t.error("Shaders have not been found.")}};a.check_shaders_loaded=function(){return n};
a.debug_get_compilation_stats=function(){return E};a.get_compiled_shaders=function(){return C};a.cleanup=function(){for(var a in C){var b=C[a];e.deleteProgram(b.program);e.deleteShader(b.vshader);e.deleteShader(b.fshader);delete C[a]}for(var c in x)delete x[c];for(var d in E)delete E[d]};a.debug_shaders_info=function(a){var b=a.directives;t.log("Shader: "+a.vert+" "+a.frag+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)t.log("  "+b[a][0],b[a][1])};a.glsl_value=p;a.check_uniform=function(a,
b){return b in a.uniforms?!0:!1};a.get_varyings_count=function(a){return(e.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,r){function u(a,b){for(var c=1;c<a.shape_keys.length;c++){for(var e=a.shape_keys[c].geometry,d=e.a_position,g=e.a_normal,h=b.a_position,f=b.a_normal,m=d.length,n=a.shape_keys[c].init_value,k=0;k<m;k++)h[k]+=n*d[k],f[k]+=n*g[k];e=e.a_tangent;d=b.a_tangent;g=e.length;for(k=0;k<g;k++)d[k]+=n*e[k]}}function c(a){return 65536<a.base_length?e.get_elem_index_uint()?!1:!0:!1}function b(a){return 0<a.indices.length?!0:!1}function h(a,c,e){if(!b(a))return a;e||n.log('%cDEBUG max vertices exceeded for indexed submesh "'+
a.name+'": '+a.base_length*(c||1)+", will use drawArrays","color: #aa0");c=a.indices;e=a.base_length;var g=a.va_common,h=a.va_frames,f;for(f in g){var m=g[f],k=t(m,e);g[f]=d(c,m,k)}for(g=0;g<h.length;g++){var l=h[g];for(f in l)m=l[f],k=t(m,e),l[f]=d(c,m,k)}for(g=0;g<a.shape_keys.length;g++){f=a.shape_keys[g].geometry;for(var p in f)m=f[p],k=t(m,e),f[p]=d(c,m,k)}a.base_length=c.length;a.indices=new Uint16Array(0);return a}function d(a,b,c){if(0==b.length)return new Float32Array(0);for(var e=new Float32Array(a.length*
c),d=0;d<a.length;d++)for(var g=a[d],h=0;h<c;h++)e[c*d+h]=b[c*g+h];return e}function q(a,b){var c=a.vbo_array,e=a.pointers[b];if(e)return c.subarray(e.offset,e.offset+e.length);throw"extract_array() failed; invalid name: "+b;}function k(b,c){var e,d;switch(c){case a.DM_DEFAULT:case a.DM_TRIANGLES:e=I.TRIANGLES;d=I.STATIC_DRAW;break;case a.DM_POINTS:e=I.POINTS;d=I.STATIC_DRAW;break;case a.DM_DYNAMIC_TRIANGLES:e=I.TRIANGLES;d=I.DYNAMIC_DRAW;break;case a.DM_DYNAMIC_POINTS:e=I.POINTS;d=I.DYNAMIC_DRAW;
break;case a.DM_LINES:e=I.LINES;d=I.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=e;b.usage=d}function p(a){a.ibo_array?(a.ibo||(a.ibo=I.createBuffer()),I.bindBuffer(I.ELEMENT_ARRAY_BUFFER,a.ibo),I.bufferData(I.ELEMENT_ARRAY_BUFFER,a.ibo_array,a.usage),a.debug_ibo_bytes=a.ibo_array.byteLength):a.debug_ibo_bytes=0;a.vbo||(a.vbo=I.createBuffer());I.bindBuffer(I.ARRAY_BUFFER,a.vbo);I.bufferData(I.ARRAY_BUFFER,a.vbo_array,a.usage);a.debug_vbo_bytes=a.vbo_array.byteLength}function f(a){for(var b=
a[0],c=D.create_empty_submesh("JOIN_"+a.length+"_SUBMESHES"),e=0,d=0;d<a.length;d++)e+=a[d].indices.length;c.indices=new Uint32Array(e);var g=e=0,h=0;if(0<a[0].shape_keys.length)for(var f=0;f<a[0].shape_keys.length;f++){for(d=0;d<a.length;d++)e+=a[d].shape_keys[f].geometry.a_position.length,g+=a[d].shape_keys[f].geometry.a_normal.length,h+=a[d].shape_keys[f].geometry.a_tangent.length;d={a_position:new Float32Array(e),a_normal:new Float32Array(g),a_tangent:new Float32Array(h)};c.shape_keys.push({init_value:a[0].shape_keys[f].init_value,
geometry:d})}for(d=e=0;d<a.length;d++)e+=a[d].base_length;c.base_length=e;var g=a[0],m;for(m in g.va_common){for(d=e=0;d<a.length;d++)e+=a[d].va_common[m].length;c.va_common[m]=new Float32Array(e)}for(m in g.va_frames[0]){for(d=e=0;d<a.length;d++)e+=a[d].va_frames[0][m].length;for(d=0;d<g.va_frames.length;d++)c.va_frames[d]=c.va_frames[d]||{},c.va_frames[d][m]=new Float32Array(e)}d=c.submesh_bd;d.bb_world=D.clone_object_r(b.submesh_bd.bb_world);d.be_world=D.clone_object_r(b.submesh_bd.be_world);d.bb_local=
D.clone_object_r(b.submesh_bd.bb_local);d.be_local=D.clone_object_r(b.submesh_bd.be_local);g=e=0;h=[];for(b=0;b<a.length;b++){var f=a[b],n=f.indices,k=f.base_length,l=f.va_common;E.extract_bb_corners(f.submesh_bd.bb_world,S);E.expand_bounding_box(d.bb_world,f.submesh_bd.bb_world);for(m=0;m<S.length;m++)h.push(S[m]);for(m=0;m<n.length;m++)c.indices[e+m]=n[m]+g;var e=e+n.length,p;for(p in l){var n=l[p],q=g*t(n,k);c.va_common[p].set(n,q)}for(m=0;m<f.va_frames.length;m++){var l=f.va_frames[m],v=c.va_frames[m];
for(p in l)n=l[p],q=g*t(n,k),v[p].set(n,q)}g+=k}c.submesh_bd.be_world=E.create_bounding_ellipsoid_by_bb(h,!0);if(0<c.shape_keys.length)for(b=0;b<c.shape_keys.length;b++)for(p=c.shape_keys[b].geometry,m=g=e=d=0;m<a.length;m++)h=a[m].shape_keys[b].geometry,p.a_position.set(h.a_position,d),p.a_normal.set(h.a_normal,e),p.a_tangent.set(h.a_tangent,g),d+=h.a_position.length,e+=h.a_normal.length,g+=h.a_tangent.length;return c}function w(a,b,c,e,d,f){var k=a.submeshes[b],p=k.base_length,q=a.materials[b],
v=D.create_empty_submesh("SUBMESH_"+a.name+"_"+q.name);v.base_length=p;var M=!1;if(m(c,"a_texcoord")){var z=null,t=a.materials[b];b=a.submeshes[b];if(t.texture_slots.length)switch(t=t.texture_slots[0],t.texture_coords){case "UV":t=a.uv_textures.indexOf(t.uv_layer);0==t?z=new Float32Array(b.texcoord):1==t&&(z=new Float32Array(b.texcoord2));break;case "ORCO":for(var w=a.b4w_bounding_box_source,z=new Float32Array(2*b.base_length),t=(w.max_x+w.min_x)/2,ka=(w.max_z+w.min_z)/2,y=w.max_x-w.min_x,w=w.max_z-
w.min_z,A=0,G=0;G<b.position.length;G+=3)z[A++]=(b.position[G]-t)/y+.5,z[A++]=(ka-b.position[G+2])/w+.5}null===z&&(z=new Float32Array(2*b.base_length));b=z}else b=new Float32Array(0);if(m(c,"a_orco_tex_coord")){z=a.b4w_bounding_box_source;t=new Float32Array(3*k.base_length);ka=z.max_x-z.min_x;y=z.max_y-z.min_y;w=z.max_z-z.min_z;for(G=A=0;G<k.position.length;G+=3)0==ka?t[A++]=.5:t[A++]=D.clamp(parseFloat(((k.position[G]-z.min_x)/ka).toFixed(5)),0,1),0==w?t[A++]=.5:t[A++]=D.clamp(parseFloat(((z.max_z-
k.position[G+2])/w).toFixed(5)),0,1),0==y?t[A++]=.5:t[A++]=D.clamp(parseFloat(((k.position[G+1]-z.min_y)/y).toFixed(5)),0,1);z=t}else z=new Float32Array(0);var C,t=k.group;if(m(c,"a_influence")&&e){ka=new Float32Array(4*p);y=t.length/p;w=new Float32Array(y);for(A=0;A<y;A++)for(C in w[A]=-1,e)if(G=e[C],G.vgroup_index===A){w[A]=G.deform_bone_index;break}var F=3<y?y:4;e=new Float32Array(F);C=new Uint32Array(F);for(var A=new Float32Array(4),G=new Float32Array(F),F=new Uint32Array(F),Q=new Float32Array(4),
H=0;H<p;H++)e.set(G),C.set(F),A.set(Q),ka.set(l(t,y,H,p,w,e,C,A),4*H)}else ka=new Float32Array(0);C=ka;e=d?D.clone_object_r(d):{};e.a_color={generate_buffer:!0};m(c,"a_color")&&a.active_vcol_name?e.a_color.src=[{name:a.active_vcol_name,mask:7}]:e.a_color.src=[];d={a_texcoord:b,a_influence:C,a_orco_tex_coord:z};C=k.vertex_colors;b=k.color;z=a.name;t=[];for(ka=0;ka<C.length;ka++)t.push(C[ka].name);for(var r in e)if(ka=e[r].src,ka.length){for(w=y=0;w<ka.length;w++)y+=D.rgb_mask_get_channels_count(ka[w].mask);
d[r]=new Float32Array(y*p);for(w=A=0;w<ka.length;w++){var R=ka[w].name,G=ka[w].mask,F=D.rgb_mask_get_channels_presence(G),V=t.indexOf(R);-1==V&&D.panic('vertex color "'+R+'" for mesh "'+z+'" not found.');Q=C[V].mask;H=D.rgb_mask_get_channels_count(Q);(G&Q)!==G&&n.error("Wrong color extraction from "+R+" to "+r+".");for(var R=C,Z=p,u=0,I=0;I<V;I++)u+=D.rgb_mask_get_channels_count(R[I].mask);R=u*Z;for(V=0;V<p;V++)for(Z=0;3>Z;Z++)F[Z]&&(u=A+D.rgb_mask_get_channel_presence_index(G,Z),I=D.rgb_mask_get_channel_presence_index(Q,
Z),d[r][V*y+u]=b[R+V*H+I]);A+=H}}else d[r]=new Float32Array(0);r=a.uv_textures;e=k.texcoord;C=k.texcoord2;if(f)for(var P in f){b=r.indexOf(P);if(0==b)var S=new Float32Array(e);else 1==b&&(S=new Float32Array(C));d[f[P]]=S}v.va_common=d;v.indices=new Uint32Array(k.indices);f=k.position.length/p/3;S=(P=m(c,"a_normal")&&k.normal.length?!0:!1)&&m(c,"a_tangent")&&k.tangent.length?!0:!1;r=q.texture_slots[0];r=P&&q.texture_slots.length&&m(c,"a_tangent")&&"ORCO"==r.texture_coords&&r.use_map_normal?!0:!1;0<
a.b4w_shape_keys.length&&(M=!0);for(d=0;d<f;d++){q=g(v,k,c,p,P,S,r,d,a.name);if(M)if(e={},e.name=a.b4w_shape_keys[d].name,v.shape_keys.push(e),0!=d){e.geometry=q;e.init_value=a.b4w_shape_keys[d].value;continue}else e.geometry=g(v,k,c,p,P,S,r,d,a.name),e.init_value=1;v.va_frames.push(q)}if(1<f&&!M){a=v.va_frames[0];var q={},pa;for(pa in a)q[pa]=new Float32Array(a[pa]);v.va_frames.push(q)}m(c,"a_polyindex")&&(h(v,1,!0),v.va_common.a_polyindex=x(v));c=k.boundings;k=c.bounding_ellipsoid_axes;c={bb_local:{max_x:c.bounding_box.max_x,
max_y:c.bounding_box.max_y,max_z:c.bounding_box.max_z,min_x:c.bounding_box.min_x,min_y:c.bounding_box.min_y,min_z:c.bounding_box.min_z},be_local:E.create_bounding_ellipsoid([k[0],0,0],[0,k[1],0],[0,0,k[2]],c.bounding_ellipsoid_center,[0,0,0,1]),bb_world:null,be_world:null};v.submesh_bd=c;return v}function g(a,b,c,e,d,g,h,f,k){a={};var l=new Float32Array(3*e),p=new Float32Array(d?3*e:0),q=new Float32Array(g||h?4*e:0),z=f*e*3;l.set(b.position.subarray(z,z+3*e),0);d&&(z=f*e*3,p.set(b.normal.subarray(z,
z+3*e),0));if(g)z=f*e*4,q.set(b.tangent.subarray(z,z+4*e),0);else if(h)for(b=q,n.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+k+'". Please add a UV-map.'),k=0;k<e;k++)c=Q,d=v,c[0]=p[3*k],c[1]=p[3*k+1],c[2]=p[3*k+2],G.cross(c,D.AXIS_Z,d),0==G.length(d)&&G.cross(c,D.AXIS_X,d),G.normalize(d,d),b[4*k]=d[0],b[4*k+1]=d[1],b[4*k+2]=d[2],b[4*k+3]=1;else if(d&&m(c,"a_tangent"))for(q=new Float32Array(4*e),e=0;e<q.length;e++)q[e]=1;a.a_position=l;a.a_normal=
p;a.a_tangent=q;return a}function m(a,b){return-1<a.indexOf(b)?!0:!1}function l(b,c,e,d,g,f,h,m){for(var k=!0,n=0;n<c;n++){var l=b[n*d+e];if(-1!==l){var p=g[n];-1!==p&&(f[n]=l,h[n]=p,k=!1)}}if(k)return m;F(f,h,a.SORT_NUMERIC,!1);for(n=b=0;4>n;n++)b+=f[n];if(.01>b)return m;for(n=0;4>n;n++)f[n]/=b;if(.01>Math.abs(f[0]-1))m[0]=h[0]+1;else for(n=0;4>n;n++)m[n]=h[n]+f[n];return m}function t(a,b){if(0==b)return 0;var c=a.length,e=c/b;if(e!=Math.floor(e))throw"Array size mismatch during geometry calculation: array length="+
c+", base length="+b;return e}function F(b,c,e,d){for(var g=b.length,f=g,h=!1,m=d?-1:1;1<f||h;){1<f&&(f=Math.floor(f/1.247330950103979));for(var h=!1,n=0;f+n<g;n++)if(e==a.SORT_NUMERIC?0>m*(b[n]-b[n+f]):b[n]<b[n+f]&&d)h=b[n],b[n]=b[n+f],b[n+f]=h,h=c[n],c[n]=c[n+f],c[n+f]=h,h=!0}}function H(a,b,c){var e=[],d=[];G.subtract(b,a,e);G.subtract(c,a,d);G.normalize(e,e);G.normalize(d,d);return Math.acos(G.dot(e,d))}function C(a,c,e){c||(c=[]);e=e?a.va_frames[0].a_normal:a.va_frames[0].a_position;if(b(a)){a=
a.indices;for(var d=a.length/3,g=0;g<d;g++){var f=new Float32Array(9),h=a[3*g];f[0]=e[3*h];f[1]=e[3*h+1];f[2]=e[3*h+2];h=a[3*g+1];f[3]=e[3*h];f[4]=e[3*h+1];f[5]=e[3*h+2];h=a[3*g+2];f[6]=e[3*h];f[7]=e[3*h+1];f[8]=e[3*h+2];c[g]=f}}else for(g=0;g<e.length;g++)f=new Float32Array(9),f[0]=e[9*g],f[1]=e[9*g+1],f[2]=e[9*g+2],f[3]=e[9*g+3],f[4]=e[9*g+4],f[5]=e[9*g+5],f[6]=e[9*g+6],f[7]=e[9*g+7],f[8]=e[9*g+8],c[g]=f;return c}function x(a){for(var b=new Float32Array(a.base_length),c=0;c<a.base_length;c++)b[c]=
c%3;return b}function y(a,b,c){var e=G.dist(a,b);a=G.dist(a,c);b=G.dist(b,c);c=(e+a+b)/2;return c*(c-e)*(c-a)*(c-b)}function z(a,b,c,e,d){c-=b;for(var g=0;g<c;g+=e)g%e==d&&vec3.normalize(a.subarray(g+b-d,g+b+1),a.subarray(g+b-d,g+b+1))}var E=r("__boundings"),e=r("__extensions"),n=r("__print"),M=r("__tsr"),D=r("__util"),G=r("__vec3"),Q=new Float32Array(3),v=new Float32Array(3),P=new Float32Array(3),S=new Float32Array(24);a.DM_TRIANGLES=10;a.DM_POINTS=20;a.DM_DYNAMIC_TRIANGLES=30;a.DM_DYNAMIC_POINTS=
40;a.DM_LINES=50;a.SORT_NUMERIC=0;a.SORT_STRING=1;a.DM_DEFAULT=a.DM_TRIANGLES;var I=null;a.setup_context=function(a){I=a};a.delete_buffers=function(a){var b=_buffers[a];I.deleteBuffer(b.ibo);I.deleteBuffer(b.vbo);delete _buffers[a]};a.submesh_to_bufs_data=function(a,e,d,g){c(a)&&h(a);var f=a.indices,m=a.base_length,n=a.va_frames,l={},D;for(D in a.va_common)D in g&&!g[D].generate_buffer||(l[D]=a.va_common[D]);g={ibo_array:null,vbo_array:null,ibo_type:0,count:0,pointers:{},mode:0,usage:0,debug_ibo_bytes:0,
debug_vbo_bytes:0,vbo:null,ibo:null,info_for_z_sort_updates:null,shape_keys:null};0<a.shape_keys.length&&u(a,n[0]);if(f.length)if(D=f.length,65536>=m)var q=new Uint16Array(f),v=I.UNSIGNED_SHORT;else q=new Uint32Array(f),v=I.UNSIGNED_INT;else D=m,q=null;var z=0,M=n.length,w;for(w in n[0])var x=n[0][w],z=z+x.length*M;for(w in l)x=l[w],z+=x.length;w=new Float32Array(z);var z=0,M={},y;for(y in l){var A=l[y];if(x=A.length)w.set(A,z),M[y]={attribute_name:y,num_comp:t(A,m),offset:z,frames:1,length:x},z+=
x}l=n.length;for(y in n[0])if(A=n[0][y],x=A.length,A=t(A,m),x){M[y]={num_comp:A,offset:z,frames:l,length:x};1<l&&(M[y+"_next"]={num_comp:A,offset:z+x,frames:l,length:x});for(var G=0;G<l;G++)A=n[G][y],w.set(A,z),z+=x}g.count=D;g.ibo_array=q;g.vbo_array=w;g.ibo_type=v;g.pointers=M;k(g,d);p(g);e&&b(a)&&(g.info_for_z_sort_updates={median_cache:new Float32Array(f.length),median_world_cache:new Float32Array(f.length),dist_cache:new Float32Array(f.length/3),zsort_eye_last:new Float32Array(3),bb_min_side:E.calc_min_bb_side(a.submesh_bd.bb_local)});
g.shape_keys=a.shape_keys;return g};a.submesh_init_shape_keys=u;a.is_long_submesh=c;a.is_indexed=b;a.submesh_drop_indices=h;a.update_bufs_data_index_array=function(a,b,c){k(a,b);a.count=c.length;a.ibo_array=c;a.ibo_type=c instanceof Uint16Array?I.UNSIGNED_SHORT:I.UNSIGNED_INT;return a};a.update_bufs_data_array=function(a,b,c,e){var d=a.vbo_array,g=a.pointers,f=g[b];f?(c&&f.num_comp!=c&&D.panic('invalid num_comp for "'+b+'"'),d.set(e,f.offset)):(d=d.length,f=new Float32Array(d+e.length),f.set(a.vbo_array),
f.set(e,d),a.vbo_array=f,g[b]={num_comp:c,offset:d});p(a);return a};a.extract_array=q;a.make_static=function(a){a.usage=I.STATIC_DRAW};a.make_dynamic=function(a){a.usage=I.DYNAMIC_DRAW};a.update_gl_buffers=p;a.cleanup_bufs_data=function(a){a.ibo&&I.deleteBuffer(a.ibo);a.vbo&&I.deleteBuffer(a.vbo)};a.has_empty_submesh=function(a,b){return a.submeshes[b].base_length?!1:!0};a.submesh_apply_transform=function(a,b){for(var c=0;c<a.va_frames.length;c++){var e=a.va_frames[c].a_position;M.transform_vectors(e,
b,e,0);e=a.va_frames[c].a_normal;0<e.length&&M.transform_dir_vectors(e,b,e,0);e=a.va_frames[c].a_tangent;0<e.length&&M.transform_tangents(e,b,e,0)}(c=a.va_common.au_center_pos)&&c.length&&M.transform_vectors(c,b,c,0);return a};a.submesh_apply_particle_transform=function(a,b){var c=a.va_common.au_center_pos;if(c&&c.length){var e=new Float32Array(c);M.transform_vectors(e,b,e,0);for(var d=0;d<a.va_frames.length;d++)for(var g=0;g<e.length;g++)a.va_frames[d].a_position[g]+=e[g]-c[g];c.set(e)}else throw'Attribute "au_center_pos" is missing in particle submesh';
return a};a.submesh_apply_params=function(a,b){var c=a.base_length,e;for(e in b){var d=b[e].length;a.va_common[e]=new Float32Array(d*c);for(var g=0;g<c;g++)for(var f=0;f<d;f++)a.va_common[e][g*d+f]=b[e][f]}return a};a.submesh_list_join=f;a.make_clone_submesh=function(a,b,c,d){if(!a.base_length)return D.create_empty_submesh("EMPTY");var g=c.length;65536<a.base_length*g&&!e.get_elem_index_uint()&&h(a,g);var f=a.indices,m=a.base_length,n=a.va_common,k=a.va_frames,l;for(l in b){var p=b[l].length,q=p*
m;n[l]=new Float32Array(q);for(var v=0;v<m;v++)for(q=0;q<p;q++)n[l][v*p+q]=b[l][q]}b=D.create_empty_submesh("CLONE_"+g+"_SUBMESHES");b.base_length=m*g;b.indices=new Uint32Array(f.length*g);l=b.submesh_bd;p=E.zero_bounding_box();E.zero_bounding_sphere();for(var z=[],v=0;v<g;v++)for(p=f.length*v,l=m*v,q=0;q<f.length;q++)b.indices[p+q]=f[q]+l;for(var w in n)for(f=n[w],q=f.length*g,p=t(f,m),b.va_common[w]=new Float32Array(q),v=0;v<g;v++)l=m*p*v,b.va_common[w].set(f,l);for(w in k[0])for(v=0;v<k.length;v++)for(f=
k[v][w],q=f.length*g,p=t(f,m),b.va_frames[v]=b.va_frames[v]||{},b.va_frames[v][w]=new Float32Array(q),q=0;q<g;q++)switch(n=c[q],l=m*p*q,w){case "a_position":M.transform_vectors(f,n,b.va_frames[v][w],l);break;case "a_normal":M.transform_dir_vectors(f,n,b.va_frames[v][w],l);break;case "a_tangent":M.transform_tangents(f,n,b.va_frames[v][w],l);break;default:throw"Wrong attribute name: "+w;}l=b.submesh_bd;p=E.zero_bounding_box();z=[];for(v=0;v<g;v++)for(p=E.bounding_box_transform(a.submesh_bd.bb_local,
c[v],p),E.expand_bounding_box(l.bb_local,p),p=E.bounding_box_transform(p,d.render.world_tsr,p),E.expand_bounding_box(l.bb_world,p),E.extract_bb_corners(p,S),q=0;q<S.length;q++)z.push(S[q]);l.be_world=E.create_bounding_ellipsoid_by_bb(z,!0);l.be_local=E.calc_be_local_by_tsr(l.be_world,d.render.world_tsr);return b};a.extract_submesh=w;a.extract_halo_submesh=function(a){var b=a.base_length,c=a.va_frames[0].a_position,e=new Float32Array(12*b),d=new Float32Array(8*b);a=new Uint32Array(4*a.indices.length);
for(var g=new Float32Array(4*b),f=0;f<b;f++){e[12*f]=c[3*f];e[12*f+1]=c[3*f+1];e[12*f+2]=c[3*f+2];e[12*f+3]=c[3*f];e[12*f+4]=c[3*f+1];e[12*f+5]=c[3*f+2];e[12*f+6]=c[3*f];e[12*f+7]=c[3*f+1];e[12*f+8]=c[3*f+2];e[12*f+9]=c[3*f];e[12*f+10]=c[3*f+1];e[12*f+11]=c[3*f+2];d[8*f]=-.5;d[8*f+1]=-.5;d[8*f+2]=-.5;d[8*f+3]=.5;d[8*f+4]=.5;d[8*f+5]=.5;d[8*f+6]=.5;d[8*f+7]=-.5;a[6*f]=4*f+2;a[6*f+1]=4*f+1;a[6*f+2]=4*f;a[6*f+3]=4*f+2;a[6*f+4]=4*f;a[6*f+5]=4*f+3;var h=Math.random();g[4*f]=h;g[4*f+1]=h;g[4*f+2]=h;g[4*
f+3]=h}c=D.create_empty_submesh("HALO");c.va_frames=[];c.va_frames[0]={};c.base_length=4*b;c.va_frames[0].a_position=e;c.va_common.a_halo_bb_vertex=d;c.va_common.a_random_vals=g;c.indices=a;return c};a.has_attr=m;a.extract_submesh_all_mats=function(a,b,c,e){for(var d=[],g=0;g<a.submeshes.length;g++){var h=w(a,g,b,null,c,null);if(h.base_length){var m=h.submesh_bd;e&&(m.bb_world=E.bounding_box_transform(m.bb_local,e.world_tsr),m.be_world=E.bounding_ellipsoid_transform(m.be_local,e.world_tsr));d.push(h)}}return 0==
d.length?D.create_empty_submesh("EMPTY"):1==d.length?d[0]:f(d)};a.update_buffers_movable=function(a,b,c){for(var e=a.ibo_array,d=q(a,"a_position"),g=a.info_for_z_sort_updates,f=g.median_cache,h=g.median_world_cache,g=g.dist_cache,m=e,n=m.length/3,k=0;k<n;k++){var l=m[3*k],p=m[3*k+1],D=m[3*k+2],v=d[3*l+1],z=d[3*l+2],A=d[3*p+1],w=d[3*p+2],x=d[3*D+1],t=d[3*D+2];f[3*k]=(d[3*l]+d[3*p]+d[3*D])/3;f[3*k+1]=(v+A+x)/3;f[3*k+2]=(z+w+t)/3}M.transform_vectors(f,b,h);b=h.length/3;for(d=0;d<b;d++)f=h[3*d]-c[0],
m=h[3*d+1]-c[1],n=h[3*d+2]-c[2],g[d]=f*f+m*m+n*n;c=e;e=g.length;if(!(2>e))for(h=e,d=!1;1<h||d;)for(1<h&&(h=Math.floor(h/1.247330950103979)),d=!1,b=0;h+b<e;b++)0>g[b]-g[b+h]&&(d=g[b],g[b]=g[b+h],g[b+h]=d,d=c,f=b,m=b+h,n=d[3*f],k=d[3*f+1],l=d[3*f+2],d[3*f]=d[3*m],d[3*f+1]=d[3*m+1],d[3*f+2]=d[3*m+2],d[3*m]=n,d[3*m+1]=k,d[3*m+2]=l,d=!0);e=c;I.bindBuffer(I.ELEMENT_ARRAY_BUFFER,a.ibo);I.bufferData(I.ELEMENT_ARRAY_BUFFER,e,I.DYNAMIC_DRAW)};a.sort_two_arrays=F;a.calc_normals=function(a,b,c){for(var e=b.length/
3,d=a.length/3,g=[],f=Array(3),h=Array(3),m=Array(3),n=0;n<d;n++){for(var k=a[3*n],l=a[3*n+1],p=a[3*n+2],D=0;3>D;D++)f[D]=b[3*k+D],h[D]=b[3*l+D],m[D]=b[3*p+D];if(c)var D=H(f,h,m),q=H(h,m,f),v=Math.PI-D-q;else v=q=D=1;var A=g,z;z=f;var w=m,M=[],x=[],t=[];G.subtract(h,z,M);G.subtract(w,z,x);G.cross(M,x,t);G.normalize(t,t);z=t;for(w=0;3>w;w++)M=3*l+w,x=3*p+w,A[3*k+w]=D*z[w],A[M]=q*z[w],A[x]=v*z[w]}if(c)for(var y in c)for(n=c[y],a=0;3>a;a++){b=3*n[0]+a;for(d=1;d<n.length;d++)f=3*n[d]+a,g[b]+=g[f];for(d=
1;d<n.length;d++)f=3*n[d]+a,g[f]=g[b]}for(n=0;n<e;n++){c=n;y=g;a=new Float32Array(3);for(b=0;3>b;b++)d=3*c+b,a[b]=y[d];G.normalize(a,a);for(b=0;3>b;b++)d=3*c+b,y[d]=a[b]}return g};a.calc_shared_indices=function(a,b,c){for(var e={},d=b.length/3,g=0;g<d;g++){var f=String(b[3*g])+String(b[3*g+1])+String(b[3*g+2]);e[f]=[]}d=a.length;for(g=0;g<d;g++)b=a[g],f=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),f in e&&e[f].push(b);return e};a.geometry_random_points=function(a,b,c,e){var d=C(a,null,!1);if(c)var g=
C(a,null,!0);var f=d.length,h=new Float32Array(f),m=Q,n=v;for(a=0;a<f;a++){var k=d[a];m.set(k.subarray(0,3));n.set(k.subarray(3,6));P.set(k.subarray(6));h[a]=Math.sqrt(y(m,n,P))}m=new Float32Array(f);m[0]=h[0];for(a=1;a<f;a++)m[a]=m[a-1]+h[a];f=m[h.length-1];h=[];for(a=0;a<b;a++){var n=f*D.rand_r(e),n=D.binary_search_max(m,n,0,m.length-1),k=c?g[n]:d[n],n=a,l=k,p=e,k=void 0,k=new Float32Array(3),q=l[0],z=l[1],w=l[2],A=l[3],M=l[4],x=l[5],t=l[6],G=l[7],F=l[8],l=D.rand_r(p),p=D.rand_r(p);1<l+p&&(l=1-
l,p=1-p);var r=1-l-p,z=r*z+l*M+p*G,w=r*w+l*x+p*F;k[0]=r*q+l*A+p*t;k[1]=z;k[2]=w;h[n]=k}return h};a.extract_triangles=C;a.extract_polyindices=x;a.triangle_area_squared=y;a.scale_submesh_xyz=function(a,b,c){a=a.va_frames[0].a_position;for(var e=0;e<a.length;e+=3)a[e]=(a[e]-c[0])*b[0]+c[0],a[e+1]=(a[e+1]-c[1])*b[1]+c[1],a[e+2]=(a[e+2]-c[2])*b[2]+c[2]};a.apply_shape_key=function(a,b,c){var e=a.scenes_data[0].batches;a=a.render.shape_keys_values;for(var d=1;d<a.length;d++)a[d].name==b&&(a[d].value=c);
for(d=0;d<e.length;d++)if(!e[d].forked_batch&&e[d].use_shape_keys&&!e[d].debug_sphere){c=e[d].bufs_data.pointers;b=e[d].bufs_data.vbo_array;I.bindBuffer(I.ARRAY_BUFFER,e[d].bufs_data.vbo);var g=c.a_position,f=e[d],h=b,m=a;if(g){for(var n=g.offset,g=g.length+n,k=f.bufs_data.shape_keys[0].geometry.a_position,l=n;l<g;l++)h[l]=k[l-n];for(l=1;l<f.bufs_data.shape_keys.length;l++){var k=f.bufs_data.shape_keys[l].geometry.a_position,p=m[l].value;if(p)for(var D=n;D<g;D++)h[D]+=p*k[D-n]}I.bufferSubData(I.ARRAY_BUFFER,
4*n,h.subarray(n))}g=c.a_normal;f=e[d];h=b;m=a;if(g){n=g.offset;g=g.length+n;k=f.bufs_data.shape_keys[0].geometry.a_normal;for(l=n;l<g;l++)h[l]=k[l-n];for(l=1;l<f.bufs_data.shape_keys.length;l++)if(k=f.bufs_data.shape_keys[l].geometry.a_normal,p=m[l].value)for(D=n;D<g;D++)h[D]+=p*k[D-n];z(h,n,g,3,2);I.bufferSubData(I.ARRAY_BUFFER,4*n,h.subarray(n))}m=c.a_tangent;c=e[d];f=a;if(m){h=m.offset;m=m.length+h;g=c.bufs_data.shape_keys[0].geometry.a_tangent;for(n=h;n<m;n++)b[n]=g[n-h];for(n=1;n<c.bufs_data.shape_keys.length;n++)if(g=
c.bufs_data.shape_keys[n].geometry.a_tangent,l=f[n].value)for(k=h;k<m;k++)b[k]+=l*g[k-h];z(b,h,m,4,3);I.bufferSubData(I.ARRAY_BUFFER,4*h,b.subarray(h))}}};a.check_shape_keys=function(a){return a.render.use_shape_keys};a.get_shape_keys_names=function(a){var b=[];if(a.render)for(var c=1;c<a.render.shape_keys_values.length;c++)b.push(a.render.shape_keys_values[c].name);return b};a.get_shape_key_value=function(a,b){if(a.render)for(var c=1;c<a.render.shape_keys_values.length;c++)if(b==a.render.shape_keys_values[c].name)return a.render.shape_keys_values[c].value;
return 0};a.has_shape_key=function(a,b){var c=a.render.shape_keys_values;if(c)for(var e=1;e<c.length;e++)if(c[e].name==b)return!0;return!1};a.has_dyn_geom=function(a){return a&&a.render&&a.render.dynamic_geometry?!0:!1};a.draw_line=function(b,c,e){var d=b.bufs_data;if(d){for(var g=e?c.length/3/2:c.length/3-1,f=new Float32Array(12*g),h=new Float32Array(12*g),m=new Uint16Array(6*g),n=0;n<g;n++){if(e)var k=6*n,l=6*n+3;else k=3*n,l=3*(n+1);var D=c[k],q=c[k+1],k=c[k+2],v=c[l],z=c[l+1],l=c[l+2],w=v-D,A=
z-q,M=l-k;f[12*n]=D;f[12*n+1]=q;f[12*n+2]=k;h[12*n]=w;h[12*n+1]=A;h[12*n+2]=M;f[12*n+3]=v;f[12*n+4]=z;f[12*n+5]=l;h[12*n+3]=-w;h[12*n+4]=-A;h[12*n+5]=-M;f[12*n+6]=D;f[12*n+7]=q;f[12*n+8]=k;h[12*n+6]=-w;h[12*n+7]=-A;h[12*n+8]=-M;f[12*n+9]=v;f[12*n+10]=z;f[12*n+11]=l;h[12*n+9]=w;h[12*n+10]=A;h[12*n+11]=M;m[6*n]=4*n;m[6*n+1]=4*n+1;m[6*n+2]=4*n+2;m[6*n+3]=4*n;m[6*n+4]=4*n+3;m[6*n+5]=4*n+1}e=0;for(var x in d.pointers)c=d.pointers[x],e+=f.length/3*c.num_comp;d.vbo_array=new Float32Array(e);e=d.vbo_array;
a.update_bufs_data_index_array(d,b.draw_mode,m);b=0;for(x in d.pointers)switch(c=d.pointers[x],x){case "a_position":e.set(f,b);c.offset=b;c.length=f.length;b+=c.length;break;case "a_direction":e.set(h,b);c.offset=b;c.length=h.length;b+=c.length;break;default:c.offset=b,c.length=f.length/3*c.num_comp,m=new Float32Array(c.length),e.set(m,b),b+=c.length}p(d)}}};b4w.module.__objects=function(a,r){function u(a){var b=a.scenes_data;a=a.render;for(var c=0;c<b.length;c++){var e=b[c].scene;e._render.outline&&a.outline_intensity&&G.request_outline(e)}}function c(a){a.render.outline_intensity=0;a=ia.indexOf(a);-1!=a&&ia.splice(a,1)}function b(a){if(a.field)for(var b=a.scenes_data,c=0;c<b.length;c++)G.update_force_scene(b[c].scene,a)}function h(a,b){for(var c=a.scenes_data,e=b.scenes_data,g=0;g<c.length;g++){for(var f=!1,h=0;h<e.length;h++)if(c[g].scene==e[h].scene){f=
!0;break}f||d(b,c[g].scene)&&z.append_scene_data(b,c[g].scene)}}function d(a,b){return!b._is_main&&"SPEAKER"==a.type||!b._is_primary_thread&&("LAMP"==a.type||"CAMERA"==a.type)?!1:!0}function q(a,b){if(a.dg_parent&&a.dg_parent._is_dynamic||a.parent&&a.parent._is_dynamic)return!0;switch(a.type){case "MESH":var c=g.bpy_obj_is_animatable(a,b),e=a.b4w_do_not_batch,d=a.b4w_collision,f=a.b4w_vehicle,h=a.b4w_floating,n=a.b4w_character,m=E.has_dynamic_grass_particles(a),k=y.bpy_obj_has_nla(a),l=0<a.data.b4w_shape_keys.length,
p=a.b4w_dynamic_geometry;if(!(c=c||e||d||f||l||h||m||n||k||p))a:{c=a.data;for(e=0;e<c.materials.length;e++){d=c.materials[e];if("LENS_FLARES"==d.name){c=!0;break a}b:{if(d=d.node_tree)for(d=d.nodes,f=0;f<d.length;f++)if(h=d[f],"VECT_TRANSFORM"==h.type&&(n=h.convert_from,m=h.convert_to,!(!h.outputs[0].is_linked||"WORLD"==n&&"CAMERA"==m||"CAMERA"==n&&"WORLD"==m||"OBJECT"==n&&"OBJECT"==m))){d=!0;break b}d=!1}if(d){c=!0;break a}}c=!1}return c;case "EMPTY":return c=g.bpy_obj_is_animatable(a,b),e=y.bpy_obj_has_nla(a),
d=a.b4w_do_not_batch,f=Boolean(a.b4w_anchor),c||e||d||f;default:return!0}}function k(a,b){var c=a.animation_data,e=a.data?a.data.animation_data:null;c&&c.action&&(c=c.action,(c._render.type==g.AT_OBJECT||c._render.type==g.AT_ARMATURE&&"ARMATURE"==b.type||c._render.type==g.AT_LIGHT&&"LAMP"==b.type||c._render.type==g.AT_ENVIRONMENT&&"WORLD"==b.type)&&b.actions.push(c));e&&e.action&&("SPEAKER"==b.type||"LAMP"==b.type)&&b.actions.push(e.action);"MESH"==b.type&&b.actions.push.apply(b.actions,g.get_bpy_material_actions(a))}
function p(a,b,c){b=O[b]||[];for(var e=[],d=0;d<b.length;d++){var g=b[d];if(g.render.data_id==c||-1==c)for(var f=g.scenes_data,h=0;h<f.length;h++)f[h].scene==a&&e.push(g)}return e}function f(a,b,c,e){for(var d=null,g=0;g<b.length;g++){var f=b[g];if((c?f.origin_name:f.name)==a&&(f.render.data_id==e||-1==e)&&(d=f,!z.get_dg_parent(d)))break}return d}function w(a){O.ALL.push(a);O[a.type]||(O[a.type]=[]);O[a.type].push(a);var b=a.render.plane_reflection_id;if(null!=b)for(var c=0;c<aa.length;c++){var e=
aa[c];e.render.plane_reflection_id==b&&e.reflective_objs.push(a)}}var g=r("__animation"),m=r("__batch"),l=r("__boundings"),t=r("__camera"),F=r("__config"),H=r("__constraints"),C=r("__geometry"),x=r("__lights"),y=r("__nla"),z=r("__obj_util"),E=r("__particles"),e=r("__physics"),n=r("__print"),M=r("__primitives"),D=r("__quat"),G=r("__scenes"),Q=r("__sfx"),v=r("__transform"),P=r("__textures"),S=r("__tsr"),I=r("__util"),K=r("__vec3"),B=r("__armature"),N=r("__anchors"),J=F.defaults,X=F.outlining,O={ALL:[]},
ba=new Float32Array(24),ca=0,ga=0,aa=[],ia=[],da=new Float32Array(3),ta=new Float32Array(4);a.GET_OBJECT_BY_NAME=0;a.GET_OBJECT_BY_DUPLI_NAME=1;a.GET_OBJECT_BY_DUPLI_NAME_LIST=2;a.DATA_ID_ALL=-1;a.update=function(a,b){for(var e=O.ARMATURE,d=0;d<ia.length;d++){var g=ia[d];var f=g,h=a,n=0,m=f.outline_animation;0==m.time_start&&(m.time_start=h);h-=m.time_start;if(m.relapses&&h/m.period>=m.relapses)c(f);else{h%=m.period;if(h<m.outline_time)switch(m=h/(m.outline_time/5),h=Math.floor(m),h){case 0:n=(m-
h)/2;break;case 1:n=(m-h)/2+.5;break;case 2:n=1;break;case 3:n=1-(m-h)/2;break;case 4:n=.5-(m-h)/2}f.render.outline_intensity=n}g.render.outline_intensity&&u(g)}if(e)for(d=0;d<e.length;d++)g=e[d],g.need_update_transform&&(v.update_transform(g),g.need_update_transform=!1)};a.set_outline_intensity=function(a,b){a.render.outline_intensity=b;u(a)};a.apply_outline_anim=function(a,b,c,e){var d=a.outline_animation;d.time_start=0;d.outline_time=b;d.period=c;d.relapses=e;-1==ia.indexOf(a)&&ia.push(a)};a.clear_outline_anim=
c;a.update_object=function(a,b){b.uuid=a.uuid;b.bpy_origin=!0;k(a,b);a._is_dynamic=b.is_dynamic=q(a,b);a._is_updated=!0;b.is_vehicle=a.b4w_vehicle;b.is_character=a.b4w_character;b.is_floating=a.b4w_floating;b.use_obj_physics=a.b4w_collision;b.collision_id=a.b4w_collision_id;b.correct_bounding_offset=a.b4w_correct_bounding_offset;var c=a.game;b.physics_settings={physics_type:c.physics_type,use_ghost:c.use_ghost,use_sleep:c.use_sleep,mass:c.mass,velocity_min:c.velocity_min,velocity_max:c.velocity_max,
damping:c.damping,rotation_damping:c.rotation_damping,lock_location_x:c.lock_location_x,lock_location_y:c.lock_location_y,lock_location_z:c.lock_location_z,lock_rotation_x:c.lock_rotation_x,lock_rotation_y:c.lock_rotation_y,lock_rotation_z:c.lock_rotation_z,collision_margin:c.collision_margin,collision_group:c.collision_group,collision_mask:c.collision_mask,use_collision_bounds:c.use_collision_bounds,collision_bounds_type:c.collision_bounds_type,use_collision_compound:c.use_collision_compound};if(c=
a.b4w_vehicle_settings)b.vehicle_settings={name:c.name,part:c.part,suspension_rest_length:c.suspension_rest_length,suspension_compression:c.suspension_compression,suspension_stiffness:c.suspension_stiffness,suspension_damping:c.suspension_damping,wheel_friction:c.wheel_friction,roll_influence:c.roll_influence,max_suspension_travel_cm:c.max_suspension_travel_cm,force_max:c.force_max,brake_max:c.brake_max,steering_max:c.steering_max,max_speed_angle:c.max_speed_angle,delta_tach_angle:c.delta_tach_angle,
speed_ratio:c.speed_ratio,steering_ratio:c.steering_ratio,inverse_control:c.inverse_control,floating_factor:c.floating_factor,water_lin_damp:c.water_lin_damp,water_rot_damp:c.water_rot_damp,synchronize_position:c.synchronize_position};if(c=a.b4w_floating_settings)b.floating_settings={name:c.name,part:c.part,floating_factor:c.floating_factor,water_lin_damp:c.water_lin_damp,water_rot_damp:c.water_rot_damp,synchronize_position:c.synchronize_position};if(c=a.b4w_character_settings)b.character_settings=
{walk_speed:c.walk_speed,run_speed:c.run_speed,step_height:c.step_height,jump_strength:c.jump_strength,waterline:c.waterline};for(c=0;c<a.constraints.length;c++){var e=a.constraints[c];"RIGID_BODY_JOINT"==e.type&&b.physics_constraints.push({target:e.target._object,pivot_type:e.pivot_type,pivot_x:e.pivot_x,pivot_y:e.pivot_y,pivot_z:e.pivot_z,axis_x:e.axis_x,axis_y:e.axis_y,axis_z:e.axis_z,use_limit_x:e.use_limit_x,use_limit_y:e.use_limit_y,use_limit_z:e.use_limit_z,use_angular_limit_x:e.use_angular_limit_x,
use_angular_limit_y:e.use_angular_limit_y,use_angular_limit_z:e.use_angular_limit_z,limit_max_x:e.limit_max_x,limit_max_y:e.limit_max_y,limit_max_z:e.limit_max_z,limit_min_x:e.limit_min_x,limit_min_y:e.limit_min_y,limit_min_z:e.limit_min_z,limit_angle_max_x:e.limit_angle_max_x,limit_angle_max_y:e.limit_angle_max_y,limit_angle_max_z:e.limit_angle_max_z,limit_angle_min_x:e.limit_angle_min_x,limit_angle_min_y:e.limit_angle_min_y,limit_angle_min_z:e.limit_angle_min_z})}c=b.render=z.create_render("MESH"===
b.type?b.is_dynamic?"DYNAMIC":"STATIC":b.type);a.parent?(b.parent=a.parent._object,"BONE"==a.parent_type&&"ARMATURE"==a.parent.type&&(b.parent_bone=a.parent_bone),a.pinverse_tsr&&(b.pinverse_tsr=S.create(),S.copy(a.pinverse_tsr,b.pinverse_tsr))):a.dg_parent&&(b.parent=a.dg_parent._object,b.parent_is_dupli=!0);var e=a.location,d=a.scale[0];I.quat_bpy_b4w(a.rotation_quaternion,ta);v.set_translation(b,e);v.set_rotation(b,ta);v.set_scale(b,d);b.use_default_animation=a.b4w_use_default_animation;b.anim_behavior_def=
g.anim_behavior_bpy_b4w(a.b4w_anim_behavior);a.b4w_object_tags&&(b.metatags={title:a.b4w_object_tags.title,description:a.b4w_object_tags.description,category:a.b4w_object_tags.category});a.b4w_viewport_alignment&&(b.viewport_alignment={alignment:a.b4w_viewport_alignment.alignment,distance:a.b4w_viewport_alignment.distance});switch(a.type){case "ARMATURE":B.update_object(a,b);e=c.bone_pointers;d=g.calc_pose_data(e);a.b4w_animation_mixing?(c.quats_before=new Float32Array(d.quats),c.quats_after=new Float32Array(d.quats),
c.trans_before=new Float32Array(d.trans),c.trans_after=new Float32Array(d.trans)):(c.quats_before=d.quats,c.quats_after=d.quats,c.trans_before=d.trans,c.trans_after=d.trans);for(var f in e){var h=e[f];1==h.chain.length&&B.update_bone_tsr_r(h,!0,d.trans,d.quats)}c.pose_data=d;c.frame_factor=0;c.anim_mixing=a.b4w_animation_mixing;break;case "MESH":c.do_not_render=a.b4w_do_not_render;c.bb_original=m.bb_bpy_to_b4w(a.data.b4w_bounding_box);c.selectable=X.outlining_overview_mode||a.b4w_selectable;c.origin_selectable=
a.b4w_selectable;c.outlining=X.outlining_overview_mode||a.b4w_outlining;c.origin_outlining=a.b4w_outlining;c.outline_on_select=X.outlining_overview_mode||a.b4w_outline_on_select;c.billboard=a.b4w_billboard;c.billboard_pres_glob_orientation=a.b4w_pres_glob_orientation;c.billboard_type="BASIC";c.billboard_spherical="SPHERICAL"==a.b4w_billboard_geometry;f=c.outline_anim_settings_default;f.outline_duration=a.b4w_outline_settings.outline_duration;f.outline_period=a.b4w_outline_settings.outline_period;
f.outline_relapses=a.b4w_outline_settings.outline_relapses;c.selectable&&(c.color_id=I.gen_color_id(ca),ca++);for(f=0;f<a.data.b4w_vertex_anim.length;f++)e=a.data.b4w_vertex_anim[f],b.vertex_anim.push({name:e.name,frame_start:e.frame_start,frame_end:e.frame_end,averaging:e.averaging,averaging_interval:e.averaging_interval,allow_nla:e.allow_nla});b.render.vertex_anim=b.vertex_anim.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;f=b.render;if(a.data.b4w_shape_keys.length)for(f.use_shape_keys=
!0,e=0;e<a.data.b4w_shape_keys.length;e++)d={},d.value=a.data.b4w_shape_keys[e].value,d.name=a.data.b4w_shape_keys[e].name,f.shape_keys_values.push(d);else f.use_shape_keys=!1;c.shadow_cast=a.b4w_shadow_cast;c.shadow_receive=a.b4w_shadow_receive;c.shadow_cast_only=a.b4w_shadow_cast_only&&c.shadow_cast;c.reflexible=a.b4w_reflexible;c.reflexible_only=a.b4w_reflexible_only&&c.reflexible;c.reflective=a.b4w_reflective;c.reflection_type=a.b4w_reflection_type;c.caustics=a.b4w_caustics;c.wind_bending=a.b4w_wind_bending;
c.wind_bending_angle=a.b4w_wind_bending_angle;f=m.wb_angle_to_amp(a.b4w_wind_bending_angle,c.bb_original,a.scale[0]);c.wind_bending_amp=f;c.wind_bending_freq=a.b4w_wind_bending_freq;c.detail_bending_freq=a.b4w_detail_bending_freq;c.detail_bending_amp=a.b4w_detail_bending_amp;c.branch_bending_amp=a.b4w_branch_bending_amp;c.hide=!1;c.main_bend_col=a.b4w_main_bend_stiffness_col;f=a.b4w_detail_bend_colors;c.detail_bend_col={};c.detail_bend_col.leaves_stiffness=f.leaves_stiffness_col;c.detail_bend_col.leaves_phase=
f.leaves_phase_col;c.detail_bend_col.overall_stiffness=f.overall_stiffness_col;c.do_not_cull=a.b4w_do_not_cull;c.disable_fogging=a.b4w_disable_fogging;c.dynamic_geometry=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";f=a.data.materials[0];c.friction=f.physics.friction;c.elasticity=f.physics.elasticity;c.lod_dist_min=0;c.lod_dist_max=1E6;c.lod_transition_ratio=a.b4w_lod_transition;c.last_lod=!0;break;case "LINE":c.do_not_cull=!0;c.bb_local=l.zero_bounding_box();c.bs_local=l.zero_bounding_sphere();
c.be_local=l.zero_bounding_ellipsoid();c.bb_world=l.zero_bounding_box();c.bs_world=l.zero_bounding_sphere();c.be_world=l.zero_bounding_ellipsoid();break;case "CAMERA":t.camera_object_to_camera(a,b);t.assign_boundings(b);break;case "LAMP":x.lamp_to_light(a,b);break;case "SPEAKER":b.sfx=Q.create_sfx();c=!1;for(f=0;f<b.scenes_data.length;f++)if(b.scenes_data[f].scene.b4w_enable_audio){c=!0;break}c&&Q.update_object(a,b);break;case "EMPTY":f=l.zero_bounding_box(),c.bb_local=f,f=l.zero_bounding_sphere(),
c.bs_local=f,a.field&&(b.field={type:a.field.type,strength:a.field.strength}),a.b4w_anchor&&(b.anchor={type:a.b4w_anchor.type,detect_visibility:a.b4w_anchor.detect_visibility,element_id:a.b4w_anchor.element_id,max_width:a.b4w_anchor.max_width})}w(b)};a.update_world=function(a,b){b.uuid=a.uuid;b.bpy_origin=!0;k(a,b);a._is_dynamic=b.is_dynamic=q(a,b);a._is_updated=!0;b.render=z.create_render(b.type);b.use_default_animation=a.b4w_use_default_animation;b.anim_behavior_def=g.anim_behavior_bpy_b4w(a.b4w_anim_behavior);
w(b)};a.update_object_relations=function(a,b){var c=b.render;if(b.parent){!b.parent_is_dupli&&b.physics_settings.use_collision_compound&&b.parent.physics_settings.use_collision_compound&&(b.use_obj_physics=!1);for(var d=!1,f=0;f<b.scenes_data.length;f++)if(b.scenes_data[f].scene._physics){d=!0;break}if(f=d)f=b.physics_settings,f=b.is_vehicle||b.is_floating||e.is_character(b)||b.use_obj_physics&&!f.use_ghost&&0<f.mass&&("DYNAMIC"==f.physics_type||"RIGID_BODY"==f.physics_type);if(f)f=b.parent_is_dupli?
S.copy(c.world_tsr,S.create()):c.world_tsr,S.multiply(b.parent.render.world_tsr,f,c.world_tsr),v.set_translation(b,S.get_trans_view(c.world_tsr)),v.set_scale(b,S.get_scale(c.world_tsr)),v.set_rotation(b,S.get_quat_view(c.world_tsr));else if(b.parent_is_dupli||!b.parent_bone)if(f=S.copy(c.world_tsr,S.create()),b.viewport_alignment&&"CAMERA"==b.parent.type){f={distance:b.viewport_alignment.distance,rotation:S.get_quat_view(f)};switch(b.viewport_alignment.alignment){case "TOP_LEFT":f.top=0;f.left=0;
break;case "TOP":f.top=0;f.left=.5;break;case "TOP_RIGHT":f.top=0;f.right=0;break;case "LEFT":f.top=.5;f.left=0;break;case "CENTER":f.top=.5;f.left=.5;break;case "RIGHT":f.top=.5;f.right=0;break;case "BOTTOM_LEFT":f.bottom=0;f.left=0;break;case "BOTTOM":f.bottom=0;f.left=.5;break;case "BOTTOM_RIGHT":f.bottom=0,f.right=0}H.append_stiff_viewport(b,b.parent,f)}else H.append_child_of(b,b.parent,f);else f=S.copy(c.world_tsr,S.create()),H.append_child_of_bone(b,b.parent,b.parent_bone,f)}if("ARMATURE"==
b.type)for(d=a.pose.bones,f=0;f<d.length;f++){var m=d[f],k=m.constraints;if(k)for(var l=0;l<k.length;l++){var p=k[l];"COPY_TRANSFORMS"!=p.type||p.subtarget||p.mute||H.append_stiff_bone_to_obj(b,p.target._object,m.name,I.VEC3_IDENT,I.QUAT4_IDENT,1)}}if("MESH"==b.type)var q=g.get_bpy_armobj(a);if(q){k=q._object;f=k.render.pose_data;d=b.render;m=a.data;b.armobj=k;m=m.vertex_groups;if(m.length){var k=k.render.bone_pointers,l=0,p={},R;for(R in k){var M=I.keysearch("name",R,m);M&&(p[R]={vgroup_index:M.index,
bone_index:k[R].bone_index,deform_bone_index:l++})}d.bone_skinning_info=p;R=l;m=g.get_max_bones();d.max_bones=R;R>2*m?(d.is_skinning=!1,n.error('too many bones for "'+a.name+'" / '+d.max_bones+" bones (max "+m+" with blending, "+2*m+" without blending). Skinning will be disabled.")):d.is_skinning=!0}R=g.extract_skinned_pose_data(f.trans,f.quats,c.bone_skinning_info);q.b4w_animation_mixing?(c.quats_before=new Float32Array(R.quats),c.quats_after=new Float32Array(R.quats),c.trans_before=new Float32Array(R.trans),
c.trans_after=new Float32Array(R.trans)):(c.quats_before=R.quats,c.quats_after=R.quats,c.trans_before=R.trans,c.trans_after=R.trans);c.arm_rel_trans=new Float32Array(4);c.arm_rel_quat=D.create();c.pose_data=R;c.frame_factor=0}if(c.reflective)if(c=b.render,"CUBE"==c.reflection_type)c.cube_reflection_id=ga++;else if("PLANE"==c.reflection_type){a:{q=a.constraints;for(R=0;R<q.length;R++)if(f=q[R],"LOCKED_TRACK"==f.type&&"REFLECTION PLANE"==f.name){if(f.target._object){q=f.target._object;break a}n.warn('Reflection plane target "'+
f.target.name+'" for object: "'+b.name+"\" is not present on the scene. Using object's Z-axis.")}q=null}q||(q=I.unique_name("%reflection%"),q=z.create_object(q,"EMPTY"),R=z.create_render("EMPTY"),q.render=R,h(b,q),H.append_stiff_obj(q,b,[0,0,0],null,1),w(q));R=null;for(f=0;f<aa.length;f++)if(aa[f]==q){R=f;break}null==R&&(R=aa.length,aa.push(q));q.render.plane_reflection_id=R;c.plane_reflection_id=R;q.reflective_objs.push(b)}};a.update_force=b;a.copy_scene_data=h;a.check_bpy_obj_scene_compatibility=
d;a.update_objects_dynamics=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.render||"DYNAMIC"!=c.render.type&&"CAMERA"!=c.render.type||v.update_transform(c);c.use_default_animation&&g.obj_is_animatable(c)&&(g.apply_def(c),c.anim_slots.length&&g.play(c,null,g.SLOT_ALL))}};a.get_meta_tags=function(a){return I.clone_object_r(a.metatags)};a.cleanup=function(){ga=ca=0;aa.length=0;ia.length=0;O={ALL:[]}};a.copy=function(a,b,c){var e=b,d=z.get_dg_parent(a);b=d?z.gen_dupli_name(d.name,b):b;if(f(b,O.ALL,
!1,-1)){for(var d=1,g;;){g="."+(3>String(d).length?("000"+String(d)).slice(-3):String(d));if(!f(b+g,O.ALL,!1,-1))break;d++}n.error('Object "'+b+'" already exists. Name was replaced by "'+b+g+'".');e+=g;b+=g}e=z.create_object(b,a.type,e);e.bpy_origin=a.bpy_origin;e.is_dynamic=a.is_dynamic;e.is_hair_dupli=a.is_hair_dupli;e.use_default_animation=a.use_default_animation;e.render=z.copy_object_props_by_value(a.render);e.metatags=z.copy_object_props_by_value(a.metatags);h(a,e);e.action_anim_cache=z.copy_bpy_object_props_by_link(a.action_anim_cache);
e.parent=z.copy_bpy_object_props_by_link(a.parent);e.parent_is_dupli=a.parent_is_dupli;e.parent_bone=a.parent_bone;e.vertex_anim=z.copy_bpy_object_props_by_link(a.vertex_anim);e.anim_behavior_def=a.anim_behavior_def;!a.physics||a.is_vehicle||a.is_character||a.is_floating||(e.use_obj_physics=a.use_obj_physics,e.physics=null);e.collision_id=a.collision_id;e.correct_bounding_offset=a.correct_bounding_offset;e.physics_settings=z.copy_object_props_by_value(a.physics_settings);b=[];for(d=0;d<a.scenes_data.length;d++){var k=
e.scenes_data[d];g=a.scenes_data[d].batches;if(c){for(var k=k.batches,l=0;l<g.length;l++)if(!g[l].forked_batch){var p=z.copy_object_props_by_value(g[l]);k.push(p);b.push(g[l].bufs_data)}for(l=0;l<g.length;l++)if(g[l].forked_batch){p=z.copy_object_props_by_value(g[l]);k.push(p);for(var D=0;D<b.length;D++)b[D]==g[l].bufs_data&&(p.bufs_data=k[D].bufs_data)}for(l=0;l<k.length;l++)k[l].bufs_data&&C.update_gl_buffers(k[l].bufs_data),k[l].odd_id_prop=e.uuid,m.update_batch_id(k[l],m.calculate_render_id(e.render));
P.share_batch_canvas_textures(k)}else k.batches=z.copy_batches_props_by_link_nr(g)}z.scene_data_set_active(e,!1);w(e);e.render.is_copied=!0;e.render.color_id=I.gen_color_id(ca);ca++;return e};a.update_boundings=function(a){for(var b=a.render,c=a.scenes_data[0].batches,e,d,g,f,h,n,k,p,D,q,z,w,x=[],t=0;t<c.length;t++){var y=c[t];if("MAIN"==y.type){var B=c[0].bufs_data.vbo_array,G=c[0].bufs_data.pointers.a_position.offset;e=f=B[G];d=h=B[G+1];g=n=B[G+2]}}for(t=0;t<c.length;t++)if(y=c[t],y.bufs_data&&
y.be_world&&y.bb_world){var B=y.bufs_data.vbo_array,G=y.bufs_data.pointers.a_position.offset,F=y.bufs_data.pointers.a_position.length+G;k=q=B[G];p=z=B[G+1];D=w=B[G+2];for(var Q=G;Q<F;Q+=3){var G=B[Q],r=B[Q+1],E=B[Q+2];k=Math.max(G,k);p=Math.max(r,p);D=Math.max(E,D);q=Math.min(G,q);z=Math.min(r,z);w=Math.min(E,w)}y.bb_local.max_x=k.toFixed(3);y.bb_local.max_y=p.toFixed(3);y.bb_local.max_z=D.toFixed(3);y.bb_local.min_x=q.toFixed(3);y.bb_local.min_y=z.toFixed(3);y.bb_local.min_z=w.toFixed(3);l.bounding_box_transform(y.bb_local,
b.world_tsr,y.bb_world);l.extract_bb_corners(y.bb_world,ba);for(B=x.length=0;B<ba.length;B++)x.push(ba[B]);y.be_world=l.create_bounding_ellipsoid_by_bb(x,!0);y.be_local=l.calc_be_local_by_tsr(y.be_world,b.world_tsr);"MAIN"==y.type&&(e=Math.max(k,e),d=Math.max(p,d),g=Math.max(D,g),f=Math.min(q,f),h=Math.min(z,h),n=Math.min(w,n))}k={max_x:parseFloat(e.toFixed(3)),max_y:parseFloat(d.toFixed(3)),max_z:parseFloat(g.toFixed(3)),min_x:parseFloat(f.toFixed(3)),min_y:parseFloat(h.toFixed(3)),min_z:parseFloat(n.toFixed(3))};
z=e-f;D=d-h;p=g-n;f=.5*(e+f);q=.5*(d+h);w=.5*(g+n);var H=f,ea=w;h=Math.max(z,Math.max(D,p))/2;n=Math.max(z,p)/2;var u=[f/(z?z:1),q/(D?D:1),w/(p?p:1)],x=.5;if(b.billboard)G=Math.max(Math.abs(k.max_x),Math.abs(k.min_x)),r=Math.max(Math.abs(k.max_y),Math.abs(k.min_y)),E=Math.max(Math.abs(k.max_z),Math.abs(k.min_z)),g=Math.sqrt(G*G+r*r+E*E),t=Math.sqrt(G*G+r*r),k.max_x=k.max_y=k.max_z=g,k.min_x=k.min_y=k.min_z=-g,n=t,h=g,G=new Float32Array([0,0,0]),e=new Float32Array([h,h,h]),g=new Float32Array([0,0,
0]);else{for(t=0;t<c.length;t++)if(y=c[t],"MAIN"==y.type)for(B=y.bufs_data.vbo_array,F=c[t].bufs_data.pointers,G=F.a_position.offset,F=F.a_position.length+G,Q=G;Q<F;Q+=3){var G=B[Q],r=B[Q+1],E=B[Q+2],Ia=Math.sqrt((f-G)*(f-G)+(q-r)*(q-r)+(w-E)*(w-E));if(Ia>h){var y=f-h*(G-f)/Ia,ra=q-h*(r-q)/Ia,Ia=w-h*(E-w)/Ia;f=(y+G)/2;q=(ra+r)/2;w=(Ia+E)/2;h=Math.sqrt((f-G)*(f-G)+(q-r)*(q-r)+(w-E)*(w-E))}ra=Math.sqrt((H-G)*(H-G)+(ea-E)*(ea-E));ra>n&&(y=H-n*(G-H)/ra,Ia=ea-n*(E-ea)/ra,H=(y+G)/2,ea=(Ia+E)/2,n=Math.sqrt((H-
G)*(H-G)+(ea-E)*(ea-E)));G/=z?z:1;r/=D?D:1;E/=p?p:1;Ia=Math.sqrt((u[0]-G)*(u[0]-G)+(u[1]-r)*(u[1]-r)+(u[2]-E)*(u[2]-E));Ia>x&&(y=u[0]-x*(G-u[0])/Ia,ra=u[1]-x*(r-u[1])/Ia,Ia=u[2]-x*(E-u[2])/Ia,u[0]=(y+G)/2,u[1]=(ra+r)/2,u[2]=(Ia+E)/2,x=Math.sqrt((u[0]-G)*(u[0]-G)+(u[1]-r)*(u[1]-r)+(u[2]-E)*(u[2]-E)))}t=z?z*u[0]:e;d=D?D*u[1]:d;g=p?p*u[2]:g;e=x*z;B=x*D;F=x*p;G=new Float32Array([f,q,w]);e=new Float32Array([e,B,F]);g=new Float32Array([t,d,g]);n=parseFloat(n.toFixed(3))}b.bb_local=k;m.set_local_cylinder_capsule(b,
n,n,k);k=l.create_bounding_sphere(h,G);b.bs_local=k;k=l.create_bounding_ellipsoid([e[0],0,0],[0,e[1],0],[0,0,e[2]],g);b.be_local=k;v.update_transform(a);if(J.debug_view)for(t=0;t<c.length;t++)if("DEBUG_VIEW"===c[t].type&&c[t].debug_sphere){a=M.generate_uv_sphere(16,8,1,k.center,!1,!1);C.scale_submesh_xyz(a,[k.axis_x[0],k.axis_y[1],k.axis_z[2]],k.center);C.submesh_drop_indices(a,1,!0);a.va_common.a_polyindex=C.extract_polyindices(a);m.update_batch_geometry(c[t],a);break}};a.get_scene_objs=p;a.get_scene_objs_derived=
function(a,b,c){b=O[b]||[];for(var e=[],d=0;d<b.length;d++){var g=b[d];if((g.render.data_id==c||-1==c)&&g.bpy_origin)for(var f=g.scenes_data,h=0;h<f.length;h++)f[h].scene==a&&e.push(g)}return e};a.get_all_objects=function(a){var b=O.ALL;if(-1==a)return b;for(var c=[],e=0;e<b.length;e++){var d=b[e];d.render.data_id==a&&c.push(d)}return c};a.sort_lamps=function(a){var b=p(a,"LAMP",-1);if(b.length==a._render.num_lamps_added){for(var c=[],e=0;e<b.length;e++){var d=b[e],d=z.get_scene_data(d,a);c[d.light_index]=
e}for(e=0;e<c.length-1;e++)for(d=e+1;d<c.length;d++){var g;g=b[c[e]].light;var f=b[c[d]].light;g=!f.use_diffuse||!f.use_specular||g.use_diffuse&&g.use_specular?!g.use_diffuse&&(f.use_diffuse||!g.use_specular&&f.use_specular)?!0:!1:!0;g&&(g=c[e],c[e]=c[d],c[d]=g)}for(e=0;e<c.length;e++)d=b[c[e]],z.get_scene_data(d,a).light_index=e,G.update_lamp_scene(b[c[e]],a)}};a.update_all_mesh_shaders=function(a){for(var b=p(a,"LAMP",-1),c=p(a,"MESH",-1),e=0;e<c.length;e++)for(var d=z.get_scene_data(c[e],a).batches,
g=0;g<d.length;g++){var f=d[g];"MAIN"==f.type&&(m.update_batch_lights(f,b,a),m.update_shader(f))}};a.get_selectable_objects=function(){for(var a=[],b=O.MESH,c=0;c<b.length;c++){var e=b[c];e.render.selectable&&e.bpy_origin&&a.push(e)}return a};a.get_outlining_objects=function(){for(var a=[],b=O.MESH,c=0;c<b.length;c++){var e=b[c];e.render.outlining&&e.bpy_origin&&a.push(e)}return a};a.get_object=function(b,c,e,d){var g=null,h=O.ALL;switch(b){case a.GET_OBJECT_BY_NAME:g=f(c,h,!0,e);break;case a.GET_OBJECT_BY_DUPLI_NAME:a:{for(b=
0;b<h.length;b++)if(g=h[b],g.origin_name==e&&(g.render.data_id==d||-1==d)){var n=z.get_dg_parent(g);if(n&&n.origin_name==c)break a}g=null}break;case a.GET_OBJECT_BY_DUPLI_NAME_LIST:a:{for(d=0;d<h.length;d++){b=h[d];for(var g=c.length-1,n=b,m=!0;0<=g&&m;)m=n&&n.origin_name==c[g]&&(n.render.data_id==e||-1==e),n&&(n=z.get_dg_parent(n)),g--;if(m&&!n){g=b;break a}}g=null}}return g};a.get_world_by_name=function(a,b){return f("%meta_world%"+a,O.WORLD,!0,b)};a.pick_object=function(b,c){var e=G.get_main();
if(!e)return n.error("No active scene"),null;var d=N.pick_anchor(b,c);if(d)return d;d=G.pick_color(e,b,c);if(!d)return null;for(var e=p(e,"MESH",-1),g=0;g<e.length;g++){var f=e[g].render,h=f.color_id;if(h&&3>Math.abs(255*h[0]-d[0])&&3>Math.abs(255*h[1]-d[1])&&3>Math.abs(255*h[2]-d[2]))return f.outlining&&f.outline_on_select&&(X.outlining_overview_mode?a.apply_outline_anim(e[g],X.outline_duration,X.outline_period,X.outline_relapses):(d=f.outline_anim_settings_default,a.apply_outline_anim(e[g],d.outline_duration,
d.outline_period,d.outline_relapses))),e[g]}return null};a.set_wind_params=function(a,c){for(var e=p(a,"EMPTY",-1),d=0;d<e.length;d++){var g=e[d];if(g.field&&"WIND"===g.field.type)var f=g}if(!f)return n.error("There is no wind on the scene"),0;"number"==typeof c.wind_dir&&(e=I.deg_to_rad(c.wind_dir),K.set(Math.sin(e),0,Math.cos(e),da),I.dir_to_quat(da,I.AXIS_Y,ta),v.set_rotation(f,ta));"number"==typeof c.wind_strength&&(f.field.strength=c.wind_strength);b(f)};a.remove_object=function(a){H.check_constraint(a)&&
H.remove(a);var b=O.ALL,c=O[a.type],e=b.indexOf(a);a=c.indexOf(a);-1!=e&&b.splice(e,1);-1!=a&&c.splice(a,1)};a.objects_storage_add=w;a.objects_storage_check=function(a){return O[a.type]&&-1<O[a.type].indexOf(a)}};b4w.module.__obj_util=function(a,r){function u(a){if(!(a instanceof Object))return a;var b=null,c=null,d=null;a.textures&&(b=a.textures,a.textures=null);a.texture_names&&(c=a.texture_names,a.texture_names=null);a.shape_keys&&(d=a.shape_keys,a.shape_keys=null);var h;h=a.constructor;switch(h){case Int8Array:case Uint8Array:case Int16Array:case Uint16Array:case Int32Array:case Uint32Array:case Float32Array:case Float64Array:h=new h(a);break;case Array:h=new h(a.length);for(var k=0;k<a.length;k++)h[k]=
u(a[k]);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:h=a;break;case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:h=null;break;case Function:h=a;break;default:for(k in h=new h,a)h[k]=u(a[k])}b&&(h.textures=b,a.textures=b);c&&(h.texture_names=c,a.texture_names=c);d&&(h.shape_keys=d,a.shape_keys=d);return h}function c(a,b){for(var c=a.scenes_data,d=0;d<c.length;d++){var h=c[d];if(h.scene==b)return h}return null}function b(a){return a.parent_is_dupli?a.parent:a.parent?b(a.parent):
null}var h=r("__tsr"),d=r("__util"),q=r("__vec3"),k=r("__vec4"),p=r("__config").defaults;new Float32Array(4);new Float32Array(4);new Float32Array(4);h.create();h.create();a.create_render=function(a){a={id:0,type:a,data_id:0,world_tsr:h.create_ext(),world_zup_tsr:h.create_ext(),world_inv_zup_tsr:h.create_ext(),pivot:new Float32Array(3),hover_pivot:new Float32Array(3),init_dist:0,init_top:0,is_copied:!1,color_id:null,outline_intensity:0,target_cam_upside_down:!1,vertical_axis:q.create(),use_panning:!1,
move_style:0,velocity_trans:1,velocity_rot:1,velocity_zoom:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,dof_object:null,underwater:!1,horizontal_limits:null,vertical_limits:null,distance_limits:null,hover_vert_trans_limits:null,hover_horiz_trans_limits:null,pivot_limits:null,enable_hover_hor_rotation:!0,outline_anim_settings_default:{outline_duration:1,outline_period:1,outline_relapses:0},cube_reflection_id:null,plane_reflection_id:null,reflection_plane:new Float32Array(4),friction:0,elasticity:0,
lod_dist_min:0,lod_transition_ratio:0,do_not_render:!1,shadow_cast:!1,shadow_receive:!1,shadow_cast_only:!1,reflexible:!1,reflexible_only:!1,reflective:!1,reflection_type:"",caustics:!1,wind_bending:!1,disable_fogging:!1,dynamic_geometry:!1,dynamic_grass:!1,do_not_cull:!1,hide:!1,last_lod:!1,selectable:!1,origin_selectable:!1,outlining:!1,origin_outlining:!1,outline_on_select:!1,is_hair_particles:!1,is_visible:!1,force_zsort:!1,wind_bending_angle:0,wind_bending_amp:0,wind_bending_freq:0,detail_bending_freq:0,
detail_bending_amp:0,branch_bending_amp:0,main_bend_col:"",detail_bend_col:null,bend_center_only:!1,billboard:!1,billboard_pres_glob_orientation:!1,billboard_type:"",billboard_spherical:!1,frame_factor:0,time:0,va_frame:0,va_frame_factor:0,max_bones:0,frames_blending:!1,vertex_anim:!1,use_shape_keys:!1,shape_keys_values:[],is_skinning:!1,anim_mixing:!1,anim_mix_factor:1,anim_mix_factor_change_speed:0,anim_destination_mix_factor:1,two_last_skeletal_slots:new Int8Array([-1,-1]),skinned_renders:[],mesh_to_arm_bone_maps:[],
skinning_data_cache:[],quats_before:null,quats_after:null,trans_before:null,trans_after:null,bone_pointers:null,bone_skinning_info:null,pose_data:null,arm_rel_trans:null,arm_rel_quat:null,bb_original:null,bb_local:null,bcyl_local:null,bcap_local:null,bcon_local:null,bs_local:null,be_local:null,lod_dist_max:1E4};q.copy(d.AXIS_Y,a.vertical_axis);return a};a.create_object=function(a,b,c){c||(c=a);return{name:a,uuid:d.gen_uuid(),origin_name:c,type:b,bpy_origin:!1,is_dynamic:!1,is_hair_dupli:!1,use_default_animation:!1,
render:null,constraint:null,sfx:null,light:null,armobj:null,anchor:null,field:null,metatags:null,scenes_data:[],vertex_anim:[],cons_descends:[],cons_armat_bone_descends:[],anim_slots:[],reflective_objs:[],nla_events:[],action_anim_cache:[],sensor_manifolds:null,sensor_manifolds_arr:[],parent:null,parent_is_dupli:!1,parent_bone:"",viewport_alignment:null,pinverse_tsr:null,use_obj_physics:!1,collision_id:"",correct_bounding_offset:"AUTO",is_vehicle:!1,is_character:!1,is_floating:!1,physics:null,vehicle:null,
floater:null,vehicle_settings:null,floating_settings:null,character_settings:null,physics_constraints:[],physics_settings:{physics_type:"NO_COLLISION",use_ghost:!1,use_sleep:!1,mass:0,velocity_min:0,velocity_max:0,damping:0,rotation_damping:0,lock_location_x:!1,lock_location_y:!1,lock_location_z:!1,lock_rotation_x:!1,lock_rotation_y:!1,lock_rotation_z:!1,collision_margin:0,collision_group:0,collision_mask:0,use_collision_bounds:!1,collision_bounds_type:"BOX",use_collision_compound:!1},outline_animation:{time_start:0,
outline_time:0,period:0,relapses:0},anim_behavior_def:0,actions:[],need_update_transform:!1,need_inv_zup_tsr:!1,meta_objects:[]}};a.copy_bpy_object_props_by_link=function(a){return a instanceof Array?a.slice():a};a.copy_batches_props_by_link_nr=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],h={},k;for(k in d)d[k]==d.bb_world?h.bb_world=u(d.bb_world):d[k]==d.be_world?h.be_world=u(d.be_world):h[k]=d[k];b.push(h)}return b};a.copy_object_props_by_value=u;a.is_dynamic=function(a){return a.is_dynamic};
a.is_dynamic_mesh=function(a){return"MESH"==a.type&&a.is_dynamic};a.append_scene_data=function(a,b){a.scenes_data.push({scene:b,is_active:!1,batches:[],plane_refl_subs:[],cube_refl_subs:null,shadow_subscenes:[],light_index:0,obj_has_nla_on_scene:!1,cameras:[],shadow_cameras:[]})};a.append_batch=function(a,b,d){c(a,b).batches.push(d)};a.remove_scene_data=function(a,b){for(var c=a.scenes_data,d=0;d<c.length;d++)if(c[d].scene==b){c.splice(d,1);break}};a.get_scene_data=c;a.update_refl_objects=function(a,
b){for(var c=0;c<a.length;c++)k.copy(b,a[c].render.reflection_plane)};a.scene_data_set_active=function(a,b,c){for(var d=0;d<a.scenes_data.length;d++){var h=a.scenes_data[d];c&&h.scene!=c||(h.is_active=b)}};a.get_shadow_lamps=function(a,b){for(var c=[],d=b?p.max_cast_lamps-1:p.max_cast_lamps,h=0;h<a.length;h++){var k=a[h];k.light.generate_shadows&&c.length<d&&c.push(k)}return c.length?c:a[0]?[a[0]]:[]};a.check_obj_soft_particles_accessibility=function(a,b){if(b.b4w_enable_soft_particles&&0<b.b4w_particles_softness){var c=
b.material-1,d=a.data.materials;if(0<=c&&c<d.length&&("ADD"==d[c].game_settings.alpha_blend||"ALPHA"==d[c].game_settings.alpha_blend||"ALPHA_SORT"==d[c].game_settings.alpha_blend))return!0}return!1};a.check_inv_zup_tsr_is_needed=function(a){a=a.scenes_data;for(var b=0;b<a.length;b++)for(var c=a[b].batches,d=0;d<c.length;d++)for(var h=c[d].shaders_info.directives,k=0;k<h.length;k++){var p=h[k];if("USE_ZUP_MODEL_MATRIX_INVERSE"==p[0]&&"1"==p[1])return!0}return!1};a.gen_dupli_name=function(a,b){return a+
"*"+b};a.get_parent=function(a){return a.parent_is_dupli?null:a.parent};a.get_dg_parent=b;a.get_dg_objects=function(a,c){for(var d=[],h=0;h<c.length;h++){var k=c[h];b(k)==a&&d.push(k)}return d};a.is_mesh=function(a){return"MESH"===a.type};a.is_armature=function(a){return"ARMATURE"===a.type};a.is_speaker=function(a){return"SPEAKER"===a.type};a.is_camera=function(a){return"CAMERA"===a.type};a.is_lamp=function(a){return"LAMP"===a.type};a.is_empty=function(a){return"EMPTY"===a.type};a.is_line=function(a){return"LINE"===
a.type};a.is_world=function(a){return"WORLD"===a.type}};b4w.module.__particles=function(a,r){function u(a,b,c,d,g,f){var e=a.delay_attrs,h=a.emitter_tsr_snapshots,k=a.time;a=a.prev_time;for(var D=0;D<e.length;D+=4){var q=e[D];if(k>a&&k>=q&&q>a||k<a&&(q>a||k>=q))for(q=0;8>q;q++)h[8*D+q]=d[q],m[q]=d[q];else for(q=0;8>q;q++)m[q]=h[8*D+q];q=l;q[0]=b[3*D];q[1]=b[3*D+1];q[2]=b[3*D+2];p.transform_vec3(q,m,q);g[3*D]=q[0];g[3*D+1]=q[1];g[3*D+2]=q[2];var w=l;w[0]=c[3*D];w[1]=c[3*D+1];w[2]=c[3*D+2];p.transform_dir_vec3(w,m,w);f[3*D]=w[0];f[3*D+1]=w[1];f[3*D+2]=w[2];
for(q=1;4>q;q++)g[3*(D+q)]=g[3*D],g[3*(D+q)+1]=g[3*D+1],g[3*(D+q)+2]=g[3*D+2],f[3*(D+q)]=w[0],f[3*(D+q)+1]=w[1],f[3*(D+q)+2]=w[2]}}function c(a){a?(f.srand(a),F=function(){return f.rand()}):F=function(){return Math.random()}}var b=r("__config"),h=r("__batch"),d=r("__geometry"),q=r("__textures"),k=r("__time"),p=r("__tsr"),f=r("__util"),w=r("__vec3"),g=b.defaults,m=new Float32Array(8),l=new Float32Array(3),t=[],F=function(){throw"_rand() undefined";};a.update=function(){for(var a=0;a<t.length;a++)for(var b=
t[a],c=b.scenes_data,d=0;d<c.length;d++)for(var g=b,f=c[d].batches,e=0;e<f.length;e++){var h=f[e],k=h.particles_data;k&&k.use_world_space&&!h.forked_batch&&(u(k,k.positions,k.normals,g.render.world_tsr,k.positions_cache,k.normals_cache),k.need_buffers_update=!0)}};a.obj_has_particles=function(a){a=a.scenes_data;for(var b=0;b<a.length;b++)for(var c=a[b].batches,d=0;d<c.length;d++)if(c[d].particles_data)return!0;return!1};a.obj_has_anim_particles=function(a){a=a.scenes_data;for(var b=0;b<a.length;b++)for(var c=
a[b].batches,d=0;d<c.length;d++){var g=c[d].particles_data;if(g&&"EMITTER"==g.p_type)return!0}return!1};a.bpy_obj_has_particles=function(a){return 0<a.particle_systems.length};a.bpy_obj_has_anim_particles=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;return!1};a.has_dynamic_grass_particles=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};
a.init_particles_data=function(a,b,c){var d=a.particles_data={name:b.name,p_type:b.settings.type,time:0,prev_time:-1,use_world_space:!1,frame_start:0,frame_end:0,time_length:0,lifetime_frames:0,lifetime:0,cyclic:!1,mass:0,nfactor:0,gravity:0,fade_in:0,fade_out:0,wind_factor:0,size:0,alpha_start:0,alpha_end:0,color_ramp_length:0,color_ramp:new Float32Array(16),positions:null,positions_cache:null,normals:null,normals_cache:null,delay_attrs:null,delay_attrs_masked:null,emitter_tsr_snapshots:null,p_data:null,
tilt:0,tilt_rand:0};d.frame_start=b.settings.frame_start;d.frame_end=b.settings.frame_end;d.time_length=(d.frame_end-d.frame_start)/k.get_framerate();d.lifetime_frames=b.settings.lifetime;d.lifetime=d.lifetime_frames/k.get_framerate();d.cyclic=b.settings.b4w_cyclic?1:0;d.mass=b.settings.mass;d.nfactor=b.settings.normal_factor;d.gravity=9.81*b.settings.effector_weights.gravity;d.fade_in=b.settings.b4w_fade_in/k.get_framerate();d.fade_out=b.settings.b4w_fade_out/k.get_framerate();d.wind_factor=b.settings.effector_weights.wind;
d.use_world_space="WORLD"==b.settings.b4w_coordinate_system?!0:!1;var m,l,e;a.halo_particles?(m=c.halo.size,l=c.halo.hardness,30>l?(l=.5,e=.9):40>l?(l=.1,e=1):50>l?(l=0,e=.8):(l=0,e=.5)):(m=b.settings.particle_size,e=l=1);d.size=m;d.alpha_start=l;d.alpha_end=e;c.use_nodes&&"BILLBOARD"==b.settings.render_type&&(h.set_batch_directive(a,"NODES",1),h.set_batch_directive(a,"PARTICLE_BATCH",1),a.use_nodes=!0,a.has_nodes=!0);b=b.settings.texture_slots;b[0]&&b[0].use_map_size&&b[0].texture&&"BLEND"==b[0].texture.type&&
b[0].texture.use_color_ramp&&g.allow_vertex_textures&&(m=[],q.calc_color_ramp_data(b[0].texture.color_ramp,q.PART_COLORRAMP_TEXT_SIZE,m),m=new Uint8Array(m.map(function(a){return f.clamp(255*a,0,255)})),h.append_texture_to_batch(a,m,"u_color_ramp_tex",q.PART_COLORRAMP_TEXT_SIZE),h.set_batch_directive(a,"USE_COLOR_RAMP",1));c=c.texture_slots;a=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(c[0]&&"STRAND"==c[0].texture_coords&&c[0].texture&&"BLEND"==c[0].texture.type&&c[0].texture.use_color_ramp){c=c[0].texture.color_ramp.elements;
b=Math.min(4*c.length,a.length);for(m=0;m<b;m+=4)l=c[m/4],a[m]=l.position,a[m+1]=l.color[0],a[m+2]=l.color[1],a[m+3]=l.color[2];d.color_ramp_length=c.length}d.color_ramp.set(a)};a.generate_emitter_particles_submesh=function(a,b,g,h){var m=a.particles_data,l=h.world_tsr,e=g.settings.count,n=g.settings.frame_start/k.get_framerate(),p=g.settings.frame_end/k.get_framerate(),D=g.settings.lifetime/k.get_framerate(),q=g.settings.lifetime_random,t=g.settings.emit_from,v=g.settings.factor_random,r=g.settings.angular_velocity_mode,
S=g.settings.angular_velocity_factor,I=g.settings.b4w_randomize_emission,K=g.settings.b4w_cyclic;m.tilt=g.settings.billboard_tilt;m.tilt_rand=g.settings.billboard_tilt_random;c(g.seed);b=d.extract_submesh_all_mats(b,["a_position","a_normal"],null,h);switch(t){case "VERT":g=b.va_frames[0].a_position;b=b.va_frames[0].a_normal;h=g.length/3;for(var t=[],B=0;B<e;B++){var N=Math.round((h-1)*F());t.push(N);t.push(N);t.push(N);t.push(N)}h=[];for(B=0;B<t.length;B++)h.push(g[3*t[B]]),h.push(g[3*t[B]+1]),h.push(g[3*
t[B]+2]);g=new Float32Array(h);h=[];for(B=0;B<t.length;B++)h.push(b[3*t[B]]),h.push(b[3*t[B]+1]),h.push(b[3*t[B]+2]);t=new Float32Array(h);break;case "FACE":g=[];t=[];B=[];f.init_rand_r_seed(0,B);h=d.geometry_random_points(b,e,!1,B);f.init_rand_r_seed(0,B);b=d.geometry_random_points(b,e,!0,B);for(B=0;B<h.length;B++)g.push(h[B][0],h[B][1],h[B][2]),g.push(h[B][0],h[B][1],h[B][2]),g.push(h[B][0],h[B][1],h[B][2]),g.push(h[B][0],h[B][1],h[B][2]),t.push(b[B][0],b[B][1],b[B][2]),t.push(b[B][0],b[B][1],b[B][2]),
t.push(b[B][0],b[B][1],b[B][2]),t.push(b[B][0],b[B][1],b[B][2]);g=new Float32Array(g);t=new Float32Array(t);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}t=[g,t];b=t[0];t=t[1];m.positions=new Float32Array(b);m.normals=new Float32Array(t);m.positions_cache=new Float32Array(b.length);m.normals_cache=new Float32Array(t.length);g=[];p=(p-n)/e;for(h=0;h<e;h++)B=I?p*h+10*p*(.5-F()):p*h,K||(B+=n),g.push(B),g.push(B),g.push(B),g.push(B);n=
new Float32Array(g);m.delay_attrs=new Float32Array(n);m.delay_attrs_masked=new Float32Array(n);if(m.use_world_space){m.emitter_tsr_snapshots=new Float32Array(8*n.length);for(I=0;I<8*n.length;I++)for(K=0;8>K;K++)m.emitter_tsr_snapshots[8*I+K]=l[K];u(m,b,t,l,b,t)}l=f.create_empty_submesh("EMITTER_PARTICLES");I=f.create_empty_va_frame();I.a_position=b;I.a_normal=t;l.va_frames[0]=I;a.draw_mode=d.DM_DYNAMIC_TRIANGLES;a=[];for(I=0;I<e;I++)a.push(4*I,4*I+2,4*I+1,4*I,4*I+3,4*I+2);a=new Uint16Array(a);l.indices=
a;a=l.va_common;I=[];for(K=0;K<e;K++)I.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);I=new Float32Array(I);a.a_p_bb_vertex=I;l.base_length=b.length/3;a=[];q*=D;for(I=0;I<e;I++)K=q*F(),a.push(D-K),a.push(D-K),a.push(D-K),a.push(D-K);D=l.va_common;q=[];for(I=0;I<e;I++)K=Math.random(),q.push(a[4*I],n[4*I],K),q.push(a[4*I+1],n[4*I+1],K),q.push(a[4*I+2],n[4*I+2],K),q.push(a[4*I+3],n[4*I+3],K);q=new Float32Array(q);D.a_p_data=q;D=l.va_common;q=[];for(a=0;a<e;a++){n=[F()-.5,F()-.5,F()-.5];w.normalize(n,n);q.push(v*
n[0]);q.push(v*n[1]);q.push(v*n[2]);switch(r){case "NONE":q.push(0);break;case "SPIN":case "VELOCITY":q.push(S);break;case "RAND":q.push(2*S*(F()-.5));break;default:throw"Undefined velocity factor";}n=q.slice(-4);for(I=0;12>I;I++)q.push(n[I%4])}e=new Float32Array(q);D.a_p_vels=e;m.p_data=new Float32Array(l.va_common.a_p_data);return l};a.set_time=function(a,b,c){a=a.scenes_data;for(var d=0;d<a.length;d++)for(var g=a[d].batches,f=0;f<g.length;f++){var e=g[f].particles_data;e&&e.name==b&&!g[f].forked_batch&&
(e.prev_time=e.time,e.time=c)}};a.prepare_lens_flares=function(a){for(var b=a.base_length,c=a.va_frames[0].a_position,d=a.va_common.a_texcoord,g=[],f=[],e=0;e<b;e++)f.push(c[3*e]),f.push(c[3*e+1]),g.push(c[3*e+2]);g=new Float32Array(g);f=new Float32Array(f);a.va_common.a_lf_dist=g;a.va_common.a_lf_bb_vertex=f;a.va_common.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.scenes_data;for(var d=0;d<a.length;d++)for(var g=a[d].batches,f=0;f<g.length;f++){var e=g[f].particles_data;e&&e.name==b&&(e.size=
c)}};a.set_normal_factor=function(a,b,c){a=a.scenes_data;for(var d=0;d<a.length;d++)for(var g=a[d].batches,f=0;f<g.length;f++){var e=g[f].particles_data;e&&e.name==b&&(e.nfactor=c)}};a.set_factor=function(a,b,c){a=a.scenes_data;for(var g=0;g<a.length;g++)for(var f=a[g].batches,h=0;h<f.length;h++){var e=f[h],n=e.particles_data;if(n&&n.name==b){var m=n.delay_attrs;if(1==c)var k=m;else if(0==c)for(var k=n.delay_attrs_masked,l=0;l<k.length;l+=4)k[l]=1E4,k[l+1]=k[l],k[l+2]=k[l],k[l+3]=k[l];else for(var p=
4/c,k=n.delay_attrs_masked,q=0,l=0;l<k.length;l+=4)l>=q?(k[l]=m[l],q+=p):k[l]=1E4,k[l+1]=k[l],k[l+2]=k[l],k[l+3]=k[l];e=e.bufs_data;if(e.pointers.a_p_data){n=n.p_data;for(l=0;l<n.length;l+=3)n[l+1]=k[Math.round(l/3)];d.update_bufs_data_array(e,"a_p_data",3,n)}}}};a.update_start_pos=function(a,b,c){a=a.scenes_data;for(var d=0;d<a.length;d++)for(var g=a[d].batches,f=0;f<g.length;f++){var e=g[f].particles_data;if(e&&e.use_world_space)for(var h=0;h<8*e.delay_attrs.length;h++)e.emitter_tsr_snapshots[8*
h]=b[0],e.emitter_tsr_snapshots[8*h+1]=b[1],e.emitter_tsr_snapshots[8*h+2]=b[2],e.emitter_tsr_snapshots[8*h+3]=b[3],e.emitter_tsr_snapshots[8*h+4]=c[0],e.emitter_tsr_snapshots[8*h+5]=c[1],e.emitter_tsr_snapshots[8*h+6]=c[2],e.emitter_tsr_snapshots[8*h+7]=c[3]}};a.update_particles_submesh=function(a,b,c,d){if(b.part_use_tangent){d=[];for(var g=0;g<c;g++)d.push(1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1);a.va_common.a_tangent=new Float32Array(d)}if(b.part_node_data){d=[];for(g=0;g<c;g++)d.push(g,g,g,g);a.va_common[b.part_node_data.name]=
new Float32Array(d)}};a.update_particles_objs_cache=function(a){-1==t.indexOf(a)&&t.push(a)};a.remove_obj_from_cache=function(a){a=t.indexOf(a);-1!=a&&t.splice(a,1)};a.cleanup=function(){t.length=0}};b4w.module.__primitives=function(a,r){function u(a,b,c,d){for(var h=[],p=[],q=[],r=[],u=2*c/(a-1),x=2*d/(b-1),y=0;y<a;y++)for(var z=-c+y*u,E=0;E<b;E++)if(p.push(z,0,-d+E*x),q.push(0,1,0),r.push(y/(a-1),E/(b-1)),y&&E){var e=y*b+E,n=e-1,M=(y-1)*b+E,D=M-1;h.push(e,n,M);h.push(n,D,M)}a=k.create_empty_va_frame();a.a_position=new Float32Array(p);a.a_normal=new Float32Array(q);q=k.create_empty_submesh("GRID_PLANE");q.va_frames[0]=a;q.va_common.a_texcoord=new Float32Array(r);q.indices=new Uint32Array(h);
q.base_length=p.length/3;return q}function c(a){var b=a.length;if(b%4)throw"Wrong array";for(var c=[],d=[],l=0;l<b;l+=4){var p=a[l+1],q=a[l+2],r=a[l+3];h(a[l],d);h(p,d);h(q,d);h(r,d);c.push(l,l+1,l+2);c.push(l,l+2,l+3)}a=k.create_empty_va_frame();a.a_position=new Float32Array(d);b=k.create_empty_submesh("FROM_QUADS");b.va_frames[0]=a;b.indices=new Uint32Array(c);b.base_length=d.length/3;return b}function b(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function h(a,b){b.push(a[0],a[1],a[2])}var d=r("__config"),
q=r("__geometry");r("__print");var k=r("__util"),p=d.defaults;a.generate_line=function(){var a=k.create_empty_submesh("LINE"),b=k.create_empty_va_frame();b.a_position=new Float32Array(3);b.a_direction=new Float32Array(3);a.va_frames[0]=b;a.indices=new Uint32Array(1);a.base_length=1;return a};a.generate_plane=function(a,b){var c=u(2,2,a,b);c.name="PLANE";return c};a.generate_grid=u;a.generate_multigrid=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==r-1)||1==b%2&&(0==a||a==F-1)?!0:!1}var h=
c/=Math.pow(2,a-1),t=c,F=b+1,r=b+1;b=[];c=[];for(var u=[],x=[],y=0,z=0,E=-1,e=[],n=0;n<a;n++){for(var M=2*h/(F-1),D=2*t/(r-1),G=[],Q=[],v=0,P=0;P<F;P++){for(var S=-h+P*M,I=[],K=0;K<r;K++){var B=-t+K*D;if(S>-y&&S<y&&B>-z&&B<z)I.push(-1),v++;else{for(var N=null,J=0;J<e.length;J+=3)if(S==e[J]&&B==e[J+1]){N=e[J+2];break}J=null!==N?N:E+1;d(P,K)?(I.push(-2),v++):(null==N&&(0==K||K==r-1||0==P||P==F-1?(N=n==a-1?M:2*M,G.push(S,B,J)):N=M,c.push(S,N,B),x.push(0,1,0),u.push(1,0,0),E++),I.push(J));if(P&&K)if(1==
P)if(d(P-1,K)){if(1<K){var B=J-1,N=Q[P-1][K+1],X=N-1;b.push(J,B,X)}else N=Q[P-1][K+1],X=N-1;b.push(J,X,N)}else d(P,K)||(B=J-1,N=Q[P-1][K],b.push(J,B,N));else if(P==F-1){if(!d(P,K))if(K==r-1)B=J-1,N=Q[P-1][K-1],X=Q[P-2][K],b.push(J,B,N),b.push(J,N,X);else{var B=J-1,N=Q[P-1][K],X=N-1,O=N+1;b.push(J,B,X);b.push(J,X,N);b.push(J,N,O);2==K&&(O=Q[P-2][K-2],b.push(B,O,X))}}else 1==K?d(P,K-1)?(B=Q[P-1][K],N=Q[P-1][K-1],b.push(J,N,B)):(B=I[K-1],N=Q[P-1][K],X=Q[P-2][K-1],b.push(J,B,N),b.push(B,X,N)):K==r-1?
d(P,K)||(B=I[K-1],N=Q[P-1][K-1],X=Q[P-2][K],b.push(J,B,N),b.push(J,N,X)):-1!=Q[P-1][K]&&-1!=Q[P-1][K-1]&&-1!=I[K-1]?(B=I[K-1],N=Q[P-1][K],X=Q[P-1][K-1],b.push(J,B,N),b.push(B,X,N),K==r-2&&d(P,K+1)&&(O=Q[P-1][K+1],b.push(J,N,O))):K==r-2&&d(P,K+1)&&(N=Q[P-1][K],O=Q[P-1][K+1],b.push(J,N,O))}}Q.push(I)}e=G;y=h;z=t;h*=2;t*=2}if(2E4>y)for(a=-(2*y)/(F-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-y,a,-z),c.push(-y,a,z),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(y,a,-z),c.push(y,a,z),J=E+1,b.push(J+
3,J+2,J+1,J+2,J+0,J+1,J+6,J+4,J+2,J+4,J+0,J+2,J+5,J+7,J+1,J+7,J+3,J+1,J+5,J+4,J+7,J+7,J+4,J+6),P=0;8>P;P++)x.push(0,1,0),u.push(1,0,0);a=k.create_empty_va_frame();a.a_position=new Float32Array(c);a.a_tangent=new Float32Array(u);a.a_normal=new Float32Array(x);h=k.create_empty_submesh("multigrid_plane");h.va_frames[0]=a;h.indices=new Uint32Array(b);h.base_length=c.length/3;p.water_wireframe_debug&&(q.submesh_drop_indices(h,1,!0),a.a_polyindex=q.extract_polyindices(h));return h};a.generate_from_triangles=
function(a){var b=a.length;if(b%3)throw"Wrong array";for(var c=[],d=[],l=0;l<b;l+=3){var p=a[l+1],q=a[l+2];h(a[l],d);h(p,d);h(q,d);c.push(l,l+1,l+2)}a=k.create_empty_va_frame();a.a_position=new Float32Array(d);b=k.create_empty_submesh("FROM_TRIANGLES");b.va_frames[0]=a;b.indices=new Uint32Array(c);b.base_length=d.length/3;return b};a.generate_from_quads=c;a.generate_frustum=function(a){a=k.vectorize(a,[]);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);
b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=c(b);a.name="FRUSTUM";return a};a.generate_fullscreen_tri=function(){var a=k.create_empty_submesh("FULLSCREEN_TRI"),b=k.create_empty_va_frame();b.a_position=new Float32Array([0,0,1,0,0,1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,1,2]);a.base_length=3;return a};a.generate_fullscreen_quad=function(){var a=k.create_empty_submesh("FULLSCREEN_QUAD"),b=k.create_empty_va_frame();b.a_position=new Float32Array([-1,
1,1,1,-1,-1,1,-1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,1,2,3]);a.base_length=4;return a};a.generate_billboard=function(){var a=k.create_empty_submesh("BILLBOARD"),b=k.create_empty_va_frame();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,0,3,2]);a.base_length=4;return a};a.generate_cube=function(){var a=k.create_empty_submesh("CUBEMAP_BOARD"),b=k.create_empty_va_frame();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);
a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,0,3,2]);a.base_length=4;return a};a.generate_uv_sphere=function(a,c,d,m,l,p){var F=k.create_empty_submesh("UV_SPHERE"),r,u,x=[],y=[],z=[];for(u=0;u<=c;u++)for(r=0;r<=a;r++){var E=r/a,e=u/c,n=-d*Math.cos(2*E*Math.PI)*Math.sin(e*Math.PI),M=d*Math.cos(e*Math.PI),E=d*Math.sin(2*E*Math.PI)*Math.sin(e*Math.PI);l&&(n=1E-5>Math.abs(n)?0:n,M=1E-5>Math.abs(M)?0:M,E=1E-5>Math.abs(E)?0:E);y.push(n+m[0],M+m[1],E+m[2])}for(u=l=0;u<c;u++)for(r=0;r<a;r++)n=b(y,(a+
1)*u+r+1),M=b(y,(a+1)*u+r),E=b(y,(a+1)*(u+1)+r),e=b(y,(a+1)*(u+1)+r+1),Math.abs(n[1])==d+m[1]?(h(n,x),h(E,x),h(e,x),p?z.push(l,l+1,l+1,l+2,l+2,l):z.push(l,l+1,l+2),l+=3):Math.abs(E[1])==d+m[1]?(h(n,x),h(M,x),h(E,x),p?z.push(l,l+1,l+1,l+2,l+2,l):z.push(l,l+1,l+2),l+=3):(h(n,x),h(M,x),h(E,x),h(e,x),p?(z.push(l,l+1),z.push(l+1,l+2),z.push(l+2,l+3),z.push(l+3,l)):(z.push(l,l+1,l+2),z.push(l,l+2,l+3)),l+=4);a={};a.a_position=x;p?a.a_normal=[]:(p=q.calc_shared_indices(z,y,x),a.a_normal=q.calc_normals(z,
x,p));a.a_tangent=[];F.va_common.a_influence=[];F.va_common.a_color=[];F.va_common.a_texcoord=[];F.va_frames[0]=a;F.indices=z;F.base_length=x.length/3;return F};a.generate_index=function(a){var b=k.create_empty_submesh("INDEX"),c=k.create_empty_va_frame();c.a_index=new Float32Array(a);for(var d=0;d<a;d++)c.a_index[d]=d;b.va_frames[0]=c;b.indices=new Uint16Array(0);b.base_length=a;return b}};b4w.module.__prerender=function(a,r){function u(a,b){var c=a.obj_render,d=a.batch;c.is_visible=!1;if(c.hide)return!1;var g=b.camera,f="SHADOW_CAST"==b.type?g.lod_eye:k.get_trans_value(g.world_tsr,m);var q=c.bs_world.center,z=c.lod_dist_min,w=c.lod_dist_max,f=Math.sqrt((q[0]-f[0])*(q[0]-f[0])+(q[1]-f[1])*(q[1]-f[1])+(q[2]-f[2])*(q[2]-f[2])),q=c.lod_transition_ratio*c.bs_world.radius;if(!(f>=z&&f<w+q))return!1;c.is_visible=!0;if("OUTLINE_MASK"==b.type&&!Boolean(c.outline_intensity))return!1;c.do_not_cull?
g=!1:(c=d.be_world,g=p.ellipsoid_is_out_of_frustum(c.center,g.frustum_planes,c.axis_x,c.axis_y,c.axis_z));return g?!1:"DEBUG_VIEW"==b.type?a.batch.debug_view_mode==h.DV_DEBUG_SPHERES?a.batch.debug_sphere:!a.batch.debug_sphere:!0}function c(a){var b=a.particles_data;if(b&&b.need_buffers_update){a=a.bufs_data;d.make_dynamic(a);var c=a.vbo_array,g=a.pointers,h=g.a_normal;c.set(b.positions_cache,g.a_position.offset);c.set(b.normals_cache,h.offset);d.update_gl_buffers(a)}}var b=r("__config"),h=r("__debug"),
d=r("__geometry"),q=r("__renderer"),k=r("__tsr"),p=r("__util"),f=r("__vec3"),w=b.defaults,g="MAIN_OPAQUE MAIN_BLEND MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_PLANE_REFLECT_BLEND MAIN_CUBE_REFLECT_BLEND MAIN_GLOW SHADOW_CAST SHADOW_RECEIVE OUTLINE_MASK DEBUG_VIEW COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" "),m=new Float32Array(3);a.prerender_subs=function(a){if(-1<g.indexOf(a.type)){for(var b=!1,h=a.bundles,p=0;p<h.length;p++){var r=h[p],x=r.batch;if("MAIN_CUBE_REFLECT"==a.type||"MAIN_CUBE_REFLECT_BLEND"==
a.type)for(var y=0;6>y;y++)a.camera.frustum_planes=a.cube_cam_frustums[y],r.do_render_cube[y]=u(r,a),r.do_render_cube[y]&&(b=!0,c(x));else r.do_render=u(r,a),r.do_render&&(b=!0,c(x));a.need_perm_uniforms_update&&(x.shader.need_uniforms_update=!0)}a.need_perm_uniforms_update=!1;switch(a.type){case "DEBUG_VIEW":break;default:"MAIN_OPAQUE"===a.type||"SHADOW_RECEIVE"===a.type||"MAIN_GLOW"===a.type||"MAIN_PLANE_REFLECT"===a.type||"MAIN_CUBE_REFLECT"===a.type||b?a.do_render=!0:(a.do_render&&q.clear(a),
a.do_render=!1)}}else if(a.need_perm_uniforms_update){h=a.bundles;for(p=0;p<h.length;p++)a.need_perm_uniforms_update&&(h[p].batch.shader.need_uniforms_update=!0);a.need_perm_uniforms_update=!1}if("MAIN_BLEND"==a.type&&w.alpha_sort&&a.bundles)for(b=k.get_trans_value(a.camera.world_tsr,m),h=0;h<a.bundles.length;h++)if(r=a.bundles[h],r.do_render){p=r.obj_render;if((r=r.batch)&&r.z_sort){r=r.bufs_data;if(!r)continue;var x=r.info_for_z_sort_updates,y=f.dist(b,x.zsort_eye_last),z=w.alpha_sort_threshold*
Math.min(x.bb_min_side,1);if(!(y>z||p.force_zsort))continue;d.update_buffers_movable(r,p.world_tsr,b);f.copy(b,x.zsort_eye_last)}p.force_zsort=!1}}};b4w.module.__print=function(a,r){function u(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var d=1;d<a.length;d++)c.push(a[d]);return c}function c(){q++;var a=u(arguments,"B4W ERROR");console.error.apply(console,a)}function b(a){a in p||(p[a]=a,c([a]))}function h(a,c){b(a+"() is deprecated, use "+c+"() instead.")}var d=!1,q=0,k=0,p={};a.set_verbose=function(a){d=a};a.log_raw=function(){console.log.apply(console,arguments)};a.log=function(){if(d){var a=
u(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=c;a.error_once=b;a.error_deprecated=h;a.error_deprecated_arr=function(a,c){switch(1<c.length){case !0:b(a+"() is deprecated, use "+c.slice(0,-1).join("(), ")+"() or "+c[c.length-1]+"() instead.");break;case !1:h(a,c[0])}};a.error_deprecated_cfg=function(a,c){b('Config option "'+a+'" is deprecated, use "'+c+'" instead.')};a.warn=function(){k++;var a=u(arguments,"B4W WARN");console.warn.apply(console,a)};a.info=function(){var a=u(arguments,
"B4W INFO");console.info.apply(console,a)};a.export_error=function(){q++;var a=u(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.export_warn=function(){k++;var a=u(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){d&&console.time.apply(console,arguments)};a.timeEnd=function(){d&&console.timeEnd.apply(console,arguments)};a.group=function(){d&&console.group.apply(console,arguments)};a.groupCollapsed=function(){d&&console.groupCollapsed.apply(console,arguments)};
a.groupEnd=function(){d&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.get_warning_count=function(){return k};a.get_error_count=function(){return q};a.clear_errors_warnings=function(){q=k=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,r){function u(a){switch(a.type){case "VALTORGB":a.color_ramp||(a.color_ramp={elements:[{position:.5,color:[1,1,1,1]}]},b("node Color Ramp",a,"color_ramp"));break;case "CURVE_RGB":a.curve_mapping||(a.curve_mapping={curves_data:[[[0,0],[1,1]],[[0,0],[1,1]],[[0,0],[1,1]],[[0,0],[1,1]]],curves_handle_types:["EXTRAPOLATED","EXTRAPOLATED","EXTRAPOLATED","EXTRAPOLATED"],curve_extend:[["AUTO","AUTO"],["AUTO","AUTO"],["AUTO","AUTO"],["AUTO","AUTO"]]},b("node RGB Curves",a,
"curve_mapping"));break;case "CURVE_VEC":a.curve_mapping||(a.curve_mapping={curves_data:[[[0,0],[1,1]],[[0,0],[1,1]],[[0,0],[1,1]]],curves_handle_types:["EXTRAPOLATED","EXTRAPOLATED","EXTRAPOLATED"],curve_extend:[["AUTO","AUTO"],["AUTO","AUTO"],["AUTO","AUTO"]]},b("node Vector Curves",a,"curve_mapping"));break;case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"alpha"in a||(a.alpha=1,b("node material",a,"alpha"));"darkness"in
a||(a.darkness=1,b("node material",a,"darkness"));"diffuse_toon_size"in a||(a.diffuse_toon_size=.5,b("node material",a,"diffuse_toon_size"));"diffuse_toon_smooth"in a||(a.diffuse_toon_smooth=.1,b("node material",a,"diffuse_toon_smooth"));"diffuse_intensity"in a||(a.diffuse_intensity=1,b("node material",a,"diffuse_intensity"));"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_ior"in a||(a.specular_ior=4,b("node material",a,"specular_ior"));"specular_hardness"in
a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=.5,b("node material",a,"specular_toon_size"));"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",
a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in a||(a.diffuse_fresnel_factor=.5,b("node material",a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,"");switch(a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name=
"B4W_"+a.node_tree_name}break;case "VECT_TRANSFORM":"convert_from"in a||(a.convert_from="WORLD",b("node "+a.type,a,"convert_from")),"convert_to"in a||(a.convert_to="WORLD",b("node "+a.type,a,"convert_to")),"vector_type"in a||(a.vector_type="POINT",b("node "+a.type,a,"vector_type"))}}function c(a){if(a=a.nla_tracks)for(var c=0;c<a.length;c++)for(var d=a[c],g=0;g<d.strips.length;g++){var e=d.strips[g];"action"in e||(e.action=null,b("strip",e,"action"));"action_frame_start"in e||(e.action_frame_start=
0,b("strip",e,"action_frame_start"));"action_frame_end"in e||(e.action_frame_end=e.frame_end-e.frame_start,b("strip",e,"action_frame_end"));"repeat"in e||(e.repeat=1,b("strip",e,"repeat"));"use_reverse"in e||(e.use_reverse=!1,b("strip",e,"use_reverse"));"scale"in e||(e.scale=1,b("strip",e,"scale"))}}function b(a,b,c){c=c+">>"+a;c in C||(C[c]={storage:[],report_type:"undefined",type:a});C[c].storage.push(b.name)}function h(a,b,c){c=c+">>"+a;c in C||(C[c]={storage:[],report_type:"deprecated",type:a});
C[c].storage.push(b.name)}function d(a){w.warn(a)}function q(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=m.clone_object_json(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var g=m.clone_object_nr(d[c]);e.submeshes.push(g)}return e}var k=r("__boundings"),p=r("__curve"),f=r("__mat4"),w=r("__print"),g=r("__quat"),m=r("__util"),l=r("__vec3"),t=r("__vec4"),F=r("__logic_nodes"),H=[5,4],
C={};a.check_particles_bin_format=function(a){return-1!=m.version_cmp(a,H)};a.check_bpy_data=function(a){C={};var g=a.worlds;if(0==g.length){w.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var f={name:"DEFAULT",horizon_color:new Float32Array([0,0,0]),zenith_color:new Float32Array([0,0,0]),light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},fog_settings:{use_fog:!1,intensity:0,depth:25,start:5,height:0,falloff:"INVERSE_QUADRATIC",
use_custom_color:!0,color:[.5,.5,.5]},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,texture_slots:[]};g.push(f)}for(var g=a.worlds,k=0;k<g.length;k++){f=g[k];"use_sky_blend"in f||(b("world",f,"use_sky_blend"),f.use_sky_blend=!1);"use_sky_paper"in f||(b("world",f,"use_sky_paper"),f.use_sky_paper=!1);"use_sky_real"in f||(b("world",f,"use_sky_real"),f.use_sky_real=!1);"b4w_sky_settings"in f&&"rayleigh_brightness"in f.b4w_sky_settings||(b("world",f,"rayleigh_brightness"),f.b4w_sky_settings={render_sky:!1,
procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"fog_settings"in f||(b("world",f,"fog_settings"),f.fog_settings={use_fog:!1,intensity:0,depth:25,start:0,height:0,falloff:"QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},"b4w_fog_color"in f&&(f.fog_settings.use_custom_color=!0,f.fog_settings.color=
f.b4w_fog_color),"b4w_fog_density"in f&&0<f.b4w_fog_density&&(f.fog_settings.depth=1/f.b4w_fog_density));"render_sky"in f.b4w_sky_settings||(b("world",f,"render_sky"),f.b4w_sky_settings.render_sky=!1);for(var e=f.texture_slots,n=0;n<e.length;n++){var l=e[n];"blend_type"in l||(l.blend_type="MIX",b("world_texture_slot",l,"blend_type"));"use_map_blend"in l||(l.use_map_blend=!1,b("world_texture_slot",l,"use_map_blend"));"use_map_horizon"in l||(l.use_map_horizon=!0,b("world_texture_slot",l,"use_map_horizon"));
"use_map_zenith_up"in l||(l.use_map_zenith_up=!1,b("world_texture_slot",l,"use_map_zenith_up"));"use_rgb_to_intensity"in l||(l.use_rgb_to_intensity=!1,b("world_texture_slot",l,"use_rgb_to_intensity"));"invert"in l||(l.invert=!1,b("world_texture_slot",l,"invert"));"color"in l||(l.color=[1,0,1],b("world_texture_slot",l,"color"));"blend_factor"in l||(l.blend_factor=0,b("world_texture_slot",l,"blend_factor"));"horizon_factor"in l||(l.horizon_factor=1,b("world_texture_slot",l,"horizon_factor"));"zenith_up_factor"in
l||(l.zenith_up_factor=0,b("world_texture_slot",l,"zenith_up_factor"));"zenith_down_factor"in l||(l.zenith_down_factor=0,b("world_texture_slot",l,"zenith_down_factor"));"default_value"in l||(l.default_value=1,b("world_texture_slot",l,"default_value"))}"b4w_use_default_animation"in f||(b("world",f,"b4w_use_default_animation"),f.b4w_use_default_animation=!1);"b4w_anim_behavior"in f||(b("world",f,"b4w_anim_behavior"),f.b4w_anim_behavior="CYCLIC")}n=a.scenes;for(k=0;k<n.length;k++)e=n[k],l=e.world,"timeline_markers"in
e||(e.timeline_markers=null,b("scene",e,"timeline_markers")),"b4w_reflection_quality"in e||(e.b4w_reflection_quality="MEDIUM",b("scene",e,"b4w_reflection_quality")),"b4w_use_nla"in e||(e.b4w_use_nla=!1,b("scene",e,"b4w_use_nla")),"fps"in e||(e.fps=24,b("scene",e,"fps")),"b4w_nla_cyclic"in e||(e.b4w_nla_cyclic=!1,b("scene",e,"b4w_nla_cyclic")),"b4w_logic_nodes"in e||(e.b4w_logic_nodes=[],b("scene",e,"b4w_logic_nodes")),"b4w_detect_collisions"in e&&(h("scene",e,"b4w_detect_collisions"),delete e.b4w_detect_collisions),
"audio_doppler_speed"in e||(e.audio_doppler_speed=343.3),"audio_doppler_factor"in e||(e.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in e||(e.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",e,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in e||(e.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in e||(e.b4w_enable_bloom=!1,b("scene",e,"b4w_enable_bloom")),"b4w_enable_motion_blur"in e||(e.b4w_enable_motion_blur=
!1,b("scene",e,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in e||(e.b4w_enable_color_correction=!1,b("scene",e,"b4w_enable_color_correction")),"b4w_antialiasing_quality"in e||(e.b4w_antialiasing_quality="MEDIUM",b("scene",e,"b4w_antialiasing_quality")),"b4w_tags"in e||(e.b4w_tags={title:"",description:""},b("scene",e,"b4w_tags")),"b4w_enable_object_selection"in e||(e.b4w_enable_object_selection="AUTO",b("scene",e,"b4w_enable_object_selection")),"b4w_enable_outlining"in e||(e.b4w_enable_outlining=
"AUTO",b("scene",e,"b4w_enable_outlining")),"b4w_enable_glow_materials"in e||(e.b4w_enable_glow_materials="AUTO",b("scene",e,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in e||(e.b4w_enable_anchors_visibility="AUTO",b("scene",e,"b4w_enable_anchors_visibility")),"b4w_outline_color"in e||(e.b4w_outline_color=[1,1,1],b("scene",e,"b4w_outline_color")),"b4w_outline_factor"in e||(e.b4w_outline_factor="b4w_glow_factor"in e?e.b4w_glow_factor:1,b("scene",e,"b4w_outline_factor")),"b4w_shadow_settings"in
e||(b("scene",e,"b4w_shadow_settings"),g=l.b4w_shadow_settings,e.b4w_shadow_settings=g?g:{csm_resolution:2048,self_shadow_polygon_offset:1,b4w_enable_csm:!1,csm_num:1,csm_first_cascade_border:10,first_cascade_blur_radius:3,csm_last_cascade_border:100,last_cascade_blur_radius:1.5,fade_last_cascade:!0,blend_between_cascades:!0}),g=e.b4w_shadow_settings,"csm_resolution"in g||(b("scene",e,"b4w_shadow_settings.csm_resolution"),g.csm_resolution=2048),"self_shadow_polygon_offset"in g||(b("scene",e,"b4w_shadow_settings.self_shadow_polygon_offset"),
g.self_shadow_polygon_offset=1),"self_shadow_normal_offset"in g||(b("scene",e,"b4w_shadow_settings.self_shadow_normal_offset"),g.self_shadow_normal_offset=.01),"b4w_enable_csm"in g||(b("scene",e,"b4w_shadow_settings.b4w_enable_csm"),g.b4w_enable_csm=!1),"csm_num"in g||(b("scene",e,"b4w_shadow_settings.csm_num"),g.csm_num=1),"csm_first_cascade_border"in g||(b("scene",e,"b4w_shadow_settings.csm_first_cascade_border"),g.csm_first_cascade_border=10),"first_cascade_blur_radius"in g||(b("scene",e,"b4w_shadow_settings.first_cascade_blur_radius"),
g.first_cascade_blur_radius=3),"csm_last_cascade_border"in g||(b("scene",e,"b4w_shadow_settings.csm_last_cascade_border"),g.csm_last_cascade_border=100),"last_cascade_blur_radius"in g||(b("scene",e,"b4w_shadow_settings.last_cascade_blur_radius"),g.last_cascade_blur_radius=1.5),"fade_last_cascade"in g||(b("scene",e,"b4w_shadow_settings.fade_last_cascade"),g.fade_last_cascade=!0),"blend_between_cascades"in g||(b("scene",e,"b4w_shadow_settings.blend_between_cascades"),g.blend_between_cascades=!0),"b4w_ssao_settings"in
e||(b("scene",e,"b4w_ssao_settings"),g=l.b4w_ssao_settings,e.b4w_ssao_settings=g?g:{dist_factor:0,samples:16,hemisphere:!1,blur_depth:!1,blur_discard_value:1}),g=e.b4w_ssao_settings,"dist_factor"in g||(b("scene",e,"b4w_ssao_settings.dist_factor"),g.dist_factor=0),"samples"in g||(b("scene",e,"b4w_ssao_settings.samples"),g.samples=16),"hemisphere"in g||(b("scene",e,"b4w_ssao_settings.hemisphere"),g.hemisphere=!1),"blur_depth"in g||(b("scene",e,"b4w_ssao_settings.blur_depth"),g.blur_depth=!1),"blur_discard_value"in
g||(b("scene",e,"b4w_ssao_settings.blur_discard_value"),g.blur_discard_value=1),"b4w_bloom_settings"in e||(b("scene",e,"b4w_bloom_settings"),g=l.b4w_bloom_settings,e.b4w_bloom_settings=g?g:{key:.2,blur:4,edge_lum:1}),"key"in e.b4w_bloom_settings||(b("scene",e,"b4w_bloom_settings.key"),e.b4w_bloom_settings.key=.2),"blur"in e.b4w_bloom_settings||(b("scene",e,"b4w_bloom_settings.blur"),e.b4w_bloom_settings.blur=4),"edge_lum"in e.b4w_bloom_settings||(b("scene",e,"b4w_bloom_settings.edge_lum"),e.b4w_bloom_settings.edge_lum=
1),"b4w_motion_blur_settings"in e||(b("scene",e,"b4w_motion_blur_settings"),g=l.b4w_motion_blur_settings,e.b4w_motion_blur_settings=g?g:{motion_blur_factor:.01,motion_blur_decay_threshold:.01}),"motion_blur_factor"in e.b4w_motion_blur_settings||(b("scene",e,"b4w_motion_blur_settings.motion_blur_factor"),e.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in e.b4w_motion_blur_settings||(b("scene",e,"b4w_motion_blur_settings.motion_blur_decay_threshold"),e.b4w_motion_blur_settings.motion_blur_decay_threshold=
.01),"b4w_color_correction_settings"in e||(b("scene",e,"b4w_color_correction_settings"),g=l.b4w_color_correction_settings,e.b4w_color_correction_settings=g?g:{brightness:0,contrast:0,exposure:1,saturation:1}),"b4w_god_rays_settings"in e||(b("scene",e,"b4w_god_rays_settings"),g=l.b4w_god_rays_settings,e.b4w_god_rays_settings=g?g:{intensity:.7,max_ray_length:1,steps_per_pass:10}),"steps_per_pass"in e.b4w_god_rays_settings||(b("scene",e,"b4w_god_rays_settings.steps_per_pass"),e.b4w_god_rays_settings.steps_per_pass=
10),"b4w_glow_settings"in e||(b("scene",e,"b4w_glow_settings"),e.b4w_glow_settings={render_glow_over_blend:!1,small_glow_mask_coeff:2,large_glow_mask_coeff:2,small_glow_mask_width:2,large_glow_mask_width:6},g=e.b4w_glow_settings,"b4w_render_glow_over_blend"in l&&(g.render_glow_over_blend=l.b4w_render_glow_over_blend),"b4w_small_glow_mask_coeff"in l&&(g.small_glow_mask_coeff=l.b4w_small_glow_mask_coeff),"b4w_large_glow_mask_coeff"in l&&(g.large_glow_mask_coeff=l.b4w_large_glow_mask_coeff),"b4w_small_glow_mask_width"in
l&&(g.small_glow_mask_width=l.b4w_small_glow_mask_width),"b4w_large_glow_mask_width"in l&&(g.large_glow_mask_width=l.b4w_large_glow_mask_width)),l=e.b4w_render_shadows,"AUTO"!=l&&"OFF"!=l&&"ON"!=l&&(e.b4w_render_shadows=l?"ON":"OFF"),l=e.b4w_render_reflections,"OFF"!=l&&"ON"!=l&&(e.b4w_render_reflections=l?"ON":"OFF"),l=e.b4w_render_refractions,"AUTO"!=l&&"OFF"!=l&&"ON"!=l&&(e.b4w_render_refractions=l?"ON":"OFF"),"b4w_render_dynamic_grass"in e||(b("scene",e,"b4w_render_dynamic_grass"),e.b4w_render_dynamic_grass=
"AUTO"),e.b4w_nla_script&&h("scene",e,"b4w_nla_script");e=a.meshes;for(k=0;k<e.length;k++){l=e[k];l.b4w_bounding_box||(b("mesh",l,"b4w_bounding_box"),l.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});l.b4w_bounding_box_source||(b("mesh",l,"b4w_bounding_box_source"),l.b4w_bounding_box_source=l.b4w_bounding_box);l.uv_textures||(b("mesh",l,"uv_textures"),l.uv_textures=[]);l.b4w_bounding_sphere_center||(l.b4w_bounding_sphere_center=[0,0,0]);l.b4w_bounding_cylinder_center||(l.b4w_bounding_cylinder_center=
[0,0,0]);l.b4w_bounding_ellipsoid_center||(l.b4w_bounding_ellipsoid_center=[0,0,0]);l.b4w_bounding_ellipsoid_axes||(n=l.b4w_bounding_box,l.b4w_bounding_ellipsoid_axes=[(n.max_x-n.min_x)/2,(n.max_y-n.min_y)/2,(n.max_z-n.min_z)/2]);"b4w_shape_keys"in l||(l.b4w_shape_keys=[],b("mesh",l,"b4w_shape_keys"));n=!0;for(g=0;g<l.submeshes.length;g++)f=l.submeshes[g],"boundings"in f||(n=!1,f.boundings={bounding_ellipsoid_axes:l.b4w_bounding_ellipsoid_axes,bounding_ellipsoid_center:l.b4w_bounding_ellipsoid_center,
bounding_box:{max_x:l.b4w_bounding_box.max_x,max_y:l.b4w_bounding_box.max_y,max_z:l.b4w_bounding_box.max_z,min_x:l.b4w_bounding_box.min_x,min_y:l.b4w_bounding_box.min_y,min_z:l.b4w_bounding_box.min_z}});n||b("mesh",l,"submesh_bd");for(var n=l,g=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],f=null,p=0;p<g.length;p++)n[g[p]]&&(f?(n[g[p]]=!1,w.warn('WARNING property "'+g[p]+'" of object "'+n.name+'" has been set to "false". Foreground property "'+
f+'" already exists.')):f=g[p]);for(n=0;n<l.b4w_vertex_anim.length;n++)g=l.b4w_vertex_anim[n],"allow_nla"in g||(b('mesh["b4w_vertex_anim"]',l,"allow_nla"),g.allow_nla=!0)}n=a.cameras;for(k=0;k<n.length;k++)e=n[k],e.type||(e.type="PERSP",b("camera",e,"type")),"b4w_eye_target_dist"in e&&(delete e.b4w_eye_target_dist,h("camera",e,"b4w_eye_target_dist")),"b4w_hover_zero_level"in e||(e.b4w_hover_zero_level=0,b("camera",e,"b4w_hover_zero_level")),"b4w_trans_velocity"in e||(e.b4w_trans_velocity=1,b("camera",
e,"b4w_trans_velocity")),"b4w_rot_velocity"in e||(e.b4w_rot_velocity=1,b("camera",e,"b4w_rot_velocity")),"b4w_zoom_velocity"in e||(e.b4w_zoom_velocity=.1,b("camera",e,"b4w_zoom_velocity")),"b4w_use_target_distance_limits"in e||(e.b4w_use_target_distance_limits=e.b4w_use_distance_limits||!1,b("camera",e,"b4w_use_target_distance_limits")),"b4w_use_zooming"in e||(e.b4w_use_zooming=e.b4w_use_distance_limits||!1,b("camera",e,"b4w_use_zooming")),"b4w_distance_min"in e||(e.b4w_distance_min=1,b("camera",
e,"b4w_distance_min")),"b4w_distance_max"in e||(e.b4w_distance_max=100,b("camera",e,"b4w_distance_max")),"b4w_horizontal_translation_min"in e||(e.b4w_horizontal_translation_min=-100,b("camera",e,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in e||(e.b4w_horizontal_translation_max=100,b("camera",e,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in e||(e.b4w_vertical_translation_min=-100,b("camera",e,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in
e||(e.b4w_vertical_translation_max=100,b("camera",e,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in e||(e.b4w_use_horizontal_clamping=!1,b("camera",e,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in e||(e.b4w_rotation_left_limit=-Math.PI,b("camera",e,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in e||(e.b4w_rotation_right_limit=Math.PI,b("camera",e,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in e||(e.b4w_horizontal_clamping_type="LOCAL",b("camera",
e,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in e||(e.b4w_use_vertical_clamping=!1,b("camera",e,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in e||(e.b4w_rotation_down_limit=-Math.PI/2,b("camera",e,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in e||(e.b4w_rotation_up_limit=Math.PI/2,b("camera",e,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in e||(e.b4w_vertical_clamping_type="LOCAL",b("camera",e,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in e||(e.b4w_hover_angle_min=
Math.PI/6,b("camera",e,"b4w_hover_angle_min")),"b4w_hover_angle_max"in e||(e.b4w_hover_angle_max=Math.PI/6,b("camera",e,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in e||(e.b4w_enable_hover_hor_rotation=!0,b("camera",e,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in e||(e.b4w_use_panning=!0,b("camera",e,"b4w_use_panning")),"b4w_use_pivot_limits"in e||(e.b4w_use_pivot_limits=!1,e.b4w_pivot_z_min=0,e.b4w_pivot_z_max=10,b("camera",e,"b4w_use_pivot_limits"));n=a.lamps;for(k=0;k<n.length;k++)e=
n[k],"b4w_generate_shadows"in e||(e.b4w_generate_shadows=!1,b("lamp",e,"b4w_generate_shadows")),"b4w_dynamic_intensity"in e||(e.b4w_dynamic_intensity=!1,b("lamp",e,"b4w_dynamic_intensity")),"use_diffuse"in e||(e.use_diffuse=!0,b("lamp",e,"use_diffuse")),"use_specular"in e||(e.use_specular=!0,b("lamp",e,"use_specular"));n=a.speakers;for(k=0;k<n.length;k++)e=n[k],"b4w_behavior"in e||(e.b4w_behavior=e.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in e||(e.b4w_disable_doppler=
!1),"b4w_delay"in e||(e.b4w_delay=0),"b4w_delay_random"in e||(e.b4w_delay_random=0),"b4w_volume_random"in e||(e.b4w_volume_random=0),"b4w_pitch_random"in e||(e.b4w_pitch_random=0),"b4w_fade_in"in e||(e.b4w_fade_in=0),"b4w_fade_out"in e||(e.b4w_fade_out=0),"b4w_loop"in e||(e.b4w_loop=!1),"b4w_loop_count"in e||(e.b4w_loop_count=0),"b4w_loop_count_random"in e||(e.b4w_loop_count_random=0),"b4w_playlist_id"in e||(e.b4w_playlist_id=""),e.animation_data&&c(e.animation_data);n=a.textures;for(k=0;k<n.length;k++)e=
n[k],"b4w_anisotropic_filtering"in e||(e.b4w_anisotropic_filtering="OFF",b("texture",e,"b4w_anisotropic_filtering")),"b4w_water_foam"in e||(e.b4w_water_foam=!1,b("texture",e,"b4w_water_foam")),"b4w_foam_uv_freq"in e||(e.b4w_foam_uv_freq=[1,1],b("texture",e,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in e||(e.b4w_foam_uv_magnitude=[1,1],b("texture",e,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in e||(e.b4w_parallax_steps=5,b("material",e,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in e||(e.b4w_parallax_lod_dist=
10,b("material",e,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in e||(e.b4w_shore_dist_map=!1,b("texture",e,"b4w_shore_dist_map")),"b4w_shore_boundings"in e||(e.b4w_shore_boundings=new Float32Array(4),e.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",e,"b4w_shore_boundings")),"b4w_max_shore_dist"in e||(e.b4w_max_shore_dist=100,b("texture",e,"b4w_max_shore_dist")),"b4w_disable_compression"in e||(e.b4w_disable_compression=!1,b("texture",e,"b4w_disable_compression")),"b4w_source_type"in e||(e.b4w_source_type=
"",b("texture",e,"b4w_source_type")),"b4w_source_id"in e||(e.b4w_source_id="",b("texture",e,"b4w_source_id")),"b4w_source_size"in e||(e.b4w_source_size=1024,b("texture",e,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in e||(e.b4w_enable_canvas_mipmapping=!0,b("texture",e,"b4w_enable_canvas_mipmapping")),"b4w_nla_video"in e||(e.b4w_nla_video=!1,b("texture",e,"b4w_nla_video"));g=a.materials;for(k=0;k<g.length;k++){f=g[k];"ALPHA_ANTIALIASING"==f.game_settings.alpha_blend&&(f.game_settings.alpha_blend=
"CLIP");"b4w_node_mat_type"in f&&h("material",f,"b4w_node_mat_type");"b4w_skydome"in f&&h("material",f,"b4w_skydome");"b4w_procedural_skydome"in f&&h("material",f,"b4w_procedural_skydome");f.b4w_water&&("b4w_water_shore_smoothing"in f||(f.b4w_water_shore_smoothing=!1,b("material",f,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in f||(f.b4w_water_dynamic=!1,b("material",f,"b4w_water_dynamic")),"b4w_waves_height"in f||(f.b4w_waves_height=1,b("material",f,"b4w_waves_height")),"b4w_waves_length"in
f||(f.b4w_waves_length=1,b("material",f,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in f||(f.b4w_water_dst_noise_scale0=.05,b("material",f,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in f||(f.b4w_water_dst_noise_scale1=.03,b("material",f,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in f||(f.b4w_water_dst_noise_freq0=1.3,b("material",f,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in f||(f.b4w_water_dst_noise_freq1=1,b("material",f,"b4w_water_dst_noise_freq1")),
"b4w_water_dir_min_shore_fac"in f||(f.b4w_water_dir_min_shore_fac=.4,b("material",f,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in f||(f.b4w_water_dir_freq=.5,b("material",f,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in f||(f.b4w_water_dir_noise_scale=.05,b("material",f,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in f||(f.b4w_water_dir_noise_freq=.07,b("material",f,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in f||(f.b4w_water_dir_min_noise_fac=.5,b("material",
f,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in f||(f.b4w_water_dst_min_fac=.2,b("material",f,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in f||(f.b4w_water_waves_hor_fac=5,b("material",f,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in f||(f.b4w_water_absorb_factor=6,b("material",f,"b4w_water_absorb_factor")),"b4w_water_fog_color"in f||(f.b4w_water_fog_color=new Float32Array(3),f.b4w_water_fog_color=[.5,.7,.7],b("material",f,"b4w_water_fog_color")),"b4w_foam_factor"in f||
(f.b4w_foam_factor=5,b("material",f,"b4w_foam_factor")),"b4w_generated_mesh"in f||(f.b4w_generated_mesh=!1,b("material",f,"b4w_generated_mesh")),"b4w_water_num_cascads"in f||(f.b4w_water_num_cascads=5,b("material",f,"b4w_water_num_cascads")),"b4w_water_subdivs"in f||(f.b4w_water_subdivs=64,b("material",f,"b4w_water_subdivs")),"b4w_water_detailed_dist"in f||(f.b4w_water_detailed_dist=1E3,b("material",f,"b4w_water_detailed_dist")),"b4w_water_enable_caust"in f||(f.b4w_water_enable_caust=!1,b("material",
f,"b4w_water_enable_caust")),"b4w_water_caust_scale"in f||(f.b4w_water_caust_scale=.25,b("material",f,"b4w_water_caust_scale")),"b4w_water_caust_brightness"in f||(f.b4w_water_caust_brightness=.5,b("material",f,"b4w_water_caust_brightness")));"b4w_dynamic_grass_size"in f||(f.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in f||(f.b4w_dynamic_grass_color="");"diffuse_intensity"in f||(f.diffuse_intensity=1,b("material",f,"diffuse_intensity"));"b4w_use_ghost"in f||(f.b4w_use_ghost=!1);"b4w_collision_margin"in
f||(f.b4w_collision_margin=.04,b("material",f,"b4w_collision_margin"));"b4w_collision_group"in f||(f.b4w_collision_group=128,b("material",f,"b4w_collision_group"));"b4w_collision_mask"in f||(f.b4w_collision_mask=127,b("material",f,"b4w_collision_mask"));"b4w_do_not_render"in f||(f.b4w_do_not_render=!1,b("material",f,"b4w_do_not_render"));"HALO"!=f.type||"b4w_halo_sky_stars"in f||(f.b4w_halo_sky_stars=!1,b("material",f,"b4w_halo_sky_stars"));"HALO"!=f.type||"b4w_halo_stars_blend_height"in f||(f.b4w_halo_stars_blend_height=
10,b("material",f,"b4w_halo_stars_blend_height"));"HALO"!=f.type||"b4w_halo_stars_min_height"in f||(f.b4w_halo_stars_min_height=0,b("material",f,"b4w_halo_stars_min_height"));"specular_shader"in f||(f.specular_shader="COOKTORR",b("material",f,"specular_shader"));"diffuse_shader"in f||(f.diffuse_shader="LAMBERT",b("material",f,"diffuse_shader"));"roughness"in f||(f.roughness=.5,b("material",f,"roughness"));"diffuse_fresnel"in f||(f.diffuse_fresnel=.1,b("material",f,"diffuse_fresnel"));"diffuse_fresnel_factor"in
f||(f.diffuse_fresnel_factor=.5,b("material",f,"diffuse_fresnel_factor"));"specular_slope"in f||(f.specular_slope=.2,b("material",f,"specular_slope"));"specular_toon_size"in f||(f.specular_toon_size=.5,b("material",f,"specular_toon_size"));"specular_toon_smooth"in f||(f.specular_toon_smooth=.1,b("material",f,"specular_toon_smooth"));"specular_alpha"in f||(f.specular_alpha=1,b("material",f,"specular_alpha"));"b4w_wettable"in f||(f.b4w_wettable=!1,b("material",f,"b4w_wettable"));"b4w_refractive"in f||
(f.b4w_refractive=!1,b("material",f,"b4w_refractive"));"b4w_refr_bump"in f||(f.b4w_refr_bump=0,b("material",f,"b4w_refr_bump"));"b4w_shallow_water_col"in f||(f.b4w_shallow_water_col=[0,.8,.3],b("material",f,"b4w_shallow_water_col"));"b4w_shore_water_col"in f||(f.b4w_shore_water_col=[0,.9,.2],b("material",f,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in f||(f.b4w_shallow_water_col_fac=1,b("material",f,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in f||(f.b4w_shore_water_col_fac=.5,
b("material",f,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in f||(f.b4w_water_sss_strength=5.9,b("material",f,"b4w_water_sss_strength"));"b4w_water_sss_width"in f||(f.b4w_water_sss_width=.45,b("material",f,"b4w_water_sss_width"));"b4w_render_above_all"in f||(f.b4w_render_above_all=!1,b("material",f,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in f||(f.b4w_water_norm_uv_velocity=.05,b("material",f,"b4w_water_norm_uv_velocity"));"specular_ior"in f||(f.specular_ior=1,b("material",f,"specular_ior"));
"darkness"in f||(f.darkness=0,b("material",f,"darkness"));"diffuse_toon_size"in f||(f.diffuse_toon_size=0,b("material",f,"diffuse_toon_size"));"diffuse_toon_smooth"in f||(f.diffuse_toon_smooth=0,b("material",f,"diffuse_toon_smooth"));e=f.texture_slots;for(n=0;n<e.length;n++)l=e[n],"blend_type"in l||(l.blend_type="MIX",b("texture_slot",l,"blend_type"));if(f.node_tree){e=f.node_tree.nodes;for(n=0;n<e.length;n++)u(e[n]);f.node_tree.animation_data&&c(f.node_tree.animation_data)}}l=a.node_groups;for(k=
0;k<l.length;k++)for(e=l[k].node_tree.nodes,n=0;n<e.length;n++)u(e[n]);e=a.objects;for(k=0;k<e.length;k++){l=e[k];switch(l.type){case "MESH":"b4w_dynamic_geometry"in l||(l.b4w_dynamic_geometry=!1);"b4w_reflexible"in l||(l.b4w_reflexible=!1);"b4w_reflexible_only"in l||(l.b4w_reflexible_only=!1);"b4w_reflective"in l||(l.b4w_reflective=!1);"b4w_reflection_type"in l||(l.b4w_reflection_type="PLANE",b("object",l,"b4w_reflection_type"));"b4w_wind_bending"in l||(l.b4w_wind_bending=!1,b("object",l,"b4w_wind_bending"));
"b4w_wind_bending_angle"in l||(l.b4w_wind_bending_angle=10,l.b4w_wind_bending_freq=.25,b("object",l,"wind bending params"));"b4w_detail_bending_amp"in l||(l.b4w_detail_bending_amp=.1,l.b4w_branch_bending_amp=.3,b("object",l,"detail bending params"));"b4w_detail_bending_freq"in l||(l.b4w_detail_bending_freq=1,b("object",l,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in l||(l.b4w_main_bend_stiffness_col="",b("object",l,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in l||(l.b4w_detail_bend_colors=
{leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",l,"b4w_detail_bend_colors"));"b4w_caustics"in l||(l.b4w_caustics=!1);"vertex_groups"in l&&l.vertex_groups.length&&l.data&&0==l.data.vertex_groups.length&&(l.data.vertex_groups=l.vertex_groups,delete l.vertex_groups,b("object",l,"vertex_groups"));"b4w_vertex_anim"in l&&l.b4w_vertex_anim.length&&l.data&&0==l.data.b4w_vertex_anim.length&&(l.data.b4w_vertex_anim=l.b4w_vertex_anim,delete l.b4w_vertex_anim,b("object",l,"b4w_vertex_anim"));
"b4w_do_not_render"in l||(l.b4w_do_not_render=!1);"use_ghost"in l.game||(l.game.use_ghost=!1);"use_sleep"in l.game||(l.game.use_sleep=!1);"velocity_min"in l.game||(l.game.velocity_min=0);"velocity_max"in l.game||(l.game.velocity_max=0);"collision_group"in l.game||(l.game.collision_group=1);"collision_mask"in l.game||(l.game.collision_mask=255);"b4w_vehicle_settings"in l?l.b4w_vehicle_settings&&("steering_ratio"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.steering_ratio=10),"steering_max"in l.b4w_vehicle_settings||
(l.b4w_vehicle_settings.steering_max=1),"inverse_control"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.inverse_control=!1),"force_max"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.force_max=1500),"brake_max"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.brake_max=100),"speed_ratio"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in l.b4w_vehicle_settings||
(l.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.roll_influence=
.1),"max_suspension_travel_cm"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.floating_factor=3),"floating_factor"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.water_rot_damp=.9)):(l.b4w_vehicle_settings=null,b("object",l,"b4w_vehicle_settings"));
"b4w_floating_settings"in l?l.b4w_floating_settings&&("floating_factor"in l.b4w_floating_settings||(l.b4w_floating_settings.floating_factor=3),"water_lin_damp"in l.b4w_floating_settings||(l.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in l.b4w_floating_settings||(l.b4w_floating_settings.water_rot_damp=.8)):(l.b4w_floating_settings=null,b("object",l,"b4w_floating_settings"));"b4w_character_settings"in l?l.b4w_character_settings&&("walk_speed"in l.b4w_character_settings||(l.b4w_character_settings.walk_speed=
4),"run_speed"in l.b4w_character_settings||(l.b4w_character_settings.run_speed=8),"step_height"in l.b4w_character_settings||(l.b4w_character_settings.step_height=.25),"jump_strength"in l.b4w_character_settings||(l.b4w_character_settings.jump_strength=5),"waterline"in l.b4w_character_settings||(l.b4w_character_settings.waterline=0)):(l.b4w_character_settings=null,b("object",l,"b4w_character_settings"));"b4w_selectable"in l||(l.b4w_selectable=!1,b("object",l,"b4w_selectable"));"b4w_outlining"in l||
(l.b4w_outlining=!1,b("object",l,"b4w_outlining"));"b4w_outline_on_select"in l||(l.b4w_outline_on_select=!1,b("object",l,"b4w_outline_on_select"));"b4w_billboard"in l||(l.b4w_billboard=!1,b("object",l,"b4w_billboard"));"b4w_billboard_geometry"in l||(l.b4w_billboard_geometry="SPHERICAL",b("object",l,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in l||(l.b4w_pres_glob_orientation=!1,b("object",l,"b4w_pres_glob_orientation"));"b4w_outline_settings"in l||("b4w_glow_settings"in l?l.b4w_outline_settings=
l.b4w_glow_settings:(l.b4w_outline_settings={},l.b4w_outline_settings.outline_duration=1,l.b4w_outline_settings.outline_period=1,l.b4w_outline_settings.outline_relapses=0),b("object",l,"b4w_outline_settings"));"b4w_lod_transition"in l||(l.b4w_lod_transition=.01,b("object",l,"b4w_lod_transition"));"lod_levels"in l||(l.lod_levels=[],b("object",l,"lod_levels"));"b4w_animation_mixing"in l||(l.b4w_animation_mixing=!1,b("object",l,"b4w_animation_mixing"));break;case "EMPTY":"b4w_anchor"in l||(l.b4w_anchor=
null,b("object",l,"b4w_anchor")),!l.b4w_anchor||"max_width"in l.b4w_anchor||(l.b4w_anchor.max_width=250)}"collision_margin"in l.game||(l.game.collision_margin=.04,b("object",l,"collision_margin"));"b4w_anim_behavior"in l||(l.b4w_anim_behavior=l.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",l,"b4w_anim_behavior"));if(!("rotation_quaternion"in l)){n=[0,0,0,1];m.euler_to_quat(l.rotation_euler,n);var g=n,f=n[0],p=n[1],q=n[2];g[0]=n[3];g[1]=f;g[2]=p;g[3]=q;l.rotation_quaternion=n;b("object",l,
"rotation_quaternion")}"webgl_do_not_batch"in l&&(l.b4w_do_not_batch=l.webgl_do_not_batch)&&h("object",l,"webgl_do_not_batch");"b4w_shadow_cast_only"in l||(l.b4w_shadow_cast_only=!1,b("object",l,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in l||(l.b4w_correct_bounding_offset="AUTO",b("object",l,"b4w_correct_bounding_offset"));g=l.particle_systems;for(n=0;n<g.length;n++)f=g[n],p=f.settings,"use_rotation_dupli"in p||(p.use_rotation_dupli=!1,b("particle_settings",p,"use_rotation_dupli")),"use_whole_group"in
p||(p.use_whole_group=!1,b("particle_settings",p,"use_whole_group")),f.transforms||(f.transforms=new Float32Array,b("particle_system",f,"transforms")),"b4w_billboard_align"in p||(p.b4w_billboard_align="VIEW",b("particle_settings",p,"b4w_billboard_align")),"b4w_dynamic_grass"in p||(p.b4w_dynamic_grass=!1,b("object",p,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in p||(p.b4w_dynamic_grass_scale_threshold=.01,b("object",p,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in
p||(p.b4w_initial_rand_rotation=!1,b("particle_settings",p,"b4w_initial_rand_rotation")),"b4w_rotation_type"in p||(p.b4w_rotation_type="Z",b("particle_settings",p,"b4w_rotation_type")),"b4w_rand_rotation_strength"in p||(p.b4w_rand_rotation_strength=1,b("particle_settings",p,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in p||(p.b4w_hair_billboard=!1,b("particle_settings",p,"b4w_hair_billboard")),"b4w_hair_billboard_type"in p||(p.b4w_hair_billboard_type="BASIC",b("particle_settings",p,"b4w_hair_billboard_type")),
"b4w_hair_billboard_jitter_amp"in p||(p.b4w_hair_billboard_jitter_amp=0,b("particle_settings",p,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in p||(p.b4w_hair_billboard_jitter_freq=0,b("particle_settings",p,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in p||(p.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",p,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in p||(p.b4w_wind_bend_inheritance="PARENT",b("particle_settings",p,"b4w_wind_bend_inheritance")),
"b4w_shadow_inheritance"in p||(p.b4w_shadow_inheritance="PARENT",b("particle_settings",p,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in p||(p.b4w_reflection_inheritance="PARENT",b("particle_settings",p,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in p||(p.b4w_vcol_from_name="",b("particle_settings",p,"b4w_vcol_from_name")),"b4w_vcol_to_name"in p||(p.b4w_vcol_to_name="",b("particle_settings",p,"b4w_vcol_to_name")),"b4w_coordinate_system"in p||(p.b4w_coordinate_system="LOCAL",b("particle_settings",
p,"b4w_coordinate_system")),"b4w_allow_nla"in p||(p.b4w_allow_nla=!0,b("particle_settings",p,"b4w_allow_nla")),"b4w_enable_soft_particles"in p||(p.b4w_enable_soft_particles=!1,b("particle_settings",p,"b4w_enable_soft_particles")),"b4w_particles_softness"in p||(p.b4w_particles_softness=1,b("particle_settings",p,"b4w_particles_softness")),"billboard_tilt"in p||(p.billboard_tilt=0,b("particle_settings",p,"billboard_tilt")),"billboard_tilt_random"in p||(p.billboard_tilt_random=0,b("particle_settings",
p,"billboard_tilt_random"));"constraints"in l||(l.constraints=[],b("object",l,"constraints"));g=l.modifiers;for(n=0;n<g.length;n++){a:{f=g[n];switch(f.type){case "ARRAY":if(!("fit_type"in f)){w.error("WARNING Incomplete modifier "+String(f.type)+' for "'+l.name+'", reexport "'+a.b4w_filepath_blend+'" scene');f=!1;break a}}f=!0}f||(g.splice(n,1),n--)}"animation_data"in l||(l.animation_data={action:null,nla_tracks:[]},b("object",l,"animation_data"));l.animation_data&&("action"in l.animation_data||(l.animation_data.action=
null,d("no action in animation data "+l.name)),"nla_tracks"in l.animation_data||(l.animation_data.nla_tracks=[],d("no NLA in animation data "+l.name)),c(l.animation_data));"b4w_collision_id"in l||(l.b4w_collision_id="",b("object",l,"b4w_collision_id"));"b4w_viewport_alignment"in l||(l.b4w_viewport_alignment=null,b("object",l,"b4w_viewport_alignment"));"pinverse_tsr"in l||(l.pinverse_tsr=null,b("object",l,"pinverse_tsr"));"b4w_cluster_data"in l||(l.b4w_cluster_data={cluster_id:-1},b("object",l,"b4w_cluster_data"));
(0>l.scale[0]||0>l.scale[1]||0>l.scale[2])&&d('negative scale for object "'+l.name+'", can lead to some errors');g=l.scale;0==g[0]&&0==g[1]&&0==g[2]?n=!0:(n=Math.abs((g[0]-g[1])/g[0]),g=Math.abs((g[1]-g[2])/g[1]),n=.005>n&&.005>g);n||d("non-uniform scale for object "+l.name)}for(var t in C)k=C[t],n=t.match(/.*?(?=>>|$)/i)[0],w.warn('Property "'+String(n)+'" is '+k.report_type+' for "'+k.type+'". To fix this, reexport '+a.b4w_filepath_blend)};a.check_anim_fcurve_completeness=function(a,b){"num_channels"in
a||(a.num_channels=1,d('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport scene'))};a.apply_mesh_modifiers=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var d=b[c].type;if("ARRAY"==d||"CURVE"==d){b=!0;break a}}b=!1}if(!b)return null;b=q(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var e=a[c];switch(e.type){case "ARRAY":for(var d=b,h=e,w=0,D=0,G=0,r=new Float32Array(16),e=[],v=1;v<h.count;v++){h.use_constant_offset&&(w+=h.constant_offset_displace[0],
D+=h.constant_offset_displace[1],G+=h.constant_offset_displace[2]);if(h.use_relative_offset)var F=d.b4w_bounding_box,w=w+(F.max_x-F.min_x)*h.relative_offset_displace[0],D=D+(F.max_y-F.min_y)*h.relative_offset_displace[1],G=G+(F.max_z-F.min_z)*h.relative_offset_displace[2];m.trans_matrix(w,D,G,r);for(var u=F=q(d),I=r,C=0;C<u.submeshes.length;C++){var B=u.submeshes[C];m.positions_multiply_matrix(B.position,I,B.position,0);m.vectors_multiply_matrix(B.normal,I,B.normal,0);m.tangents_multiply_matrix(B.tangent,
I,B.tangent,0)}e.push(F)}for(v=0;v<e.length;v++)for(h=d,w=e[v],D=0;D<h.submeshes.length;D++){G=h.submeshes[D];r=w.submeshes[D];F=G.base_length;u=G.indices.length;G.base_length+=r.base_length;for(var N in G)if("base_length"!=N&&"boundings"!=N)if("indices"==N)for(G[N]=m.uint32_concat(G[N],r[N]),I=u;I<G.indices.length;I++)G.indices[I]+=F;else"vertex_colors"!=N&&(G[N]=m.float32_concat(G[N],r[N]))}break;case "CURVE":for(var d=b,v=p.create_spline(e.object),h=new Float32Array(16),D=v.is_3d?4:3,w=new Float32Array(D),
D=new Float32Array(D),G=new Float32Array(3),r=new Float32Array(4),F=new Float32Array(4),u=new Float32Array(3),I=new Float32Array(3),C=new Float32Array(3),B=new Float32Array(4),J=new Float32Array(4),H=0;H<d.submeshes.length;H++){var O=d.submeshes[H],ba=O.position,ca=O.normal,O=O.tangent,ga;a:switch(ga=e.deform_axis,ga){case "POS_X":case "NEG_X":ga=0;break a;case "POS_Y":case "NEG_Y":ga=1;break a;case "POS_Z":case "NEG_Z":ga=2;break a;default:throw"Wrong deform axis value "+ga;}u[0]=0;u[1]=0;u[2]=0;
u[ga]=1;for(var aa=p.spline_length(v),ia=0;ia<ba.length/3;ia++){C[0]=ba[3*ia];C[1]=ba[3*ia+1];C[2]=ba[3*ia+2];var da=C[ga],ta=p.spline_len_to_t(v,da);p.spline_point(v,ta,w);G[0]=w[0];G[1]=w[1];G[2]=w[2];p.spline_derivative(v,ta,D);I[0]=D[0];I[1]=0;I[2]=D[2];l.normalize(I,I);g.rotationTo(u,I,r);0>da?(w[0]=I[0],w[1]=I[1],w[2]=I[2],l.scale(w,da,w),l.add(G,w,G)):da>aa&&(w[0]=I[0],w[1]=I[1],w[2]=I[2],l.scale(w,da-aa,w),l.add(G,w,G));f.fromRotationTranslation(r,G,h);v.is_3d&&(g.setAxisAngle(u,w[3],F),l.transformQuat(C,
F,C));C[ga]=0;l.transformMat4(C,h,C);ba[3*ia]=C[0];ba[3*ia+1]=C[1];ba[3*ia+2]=C[2];ca.length&&(B[0]=ca[3*ia],B[1]=ca[3*ia+1],B[2]=ca[3*ia+2],B[3]=0,t.transformMat4(B,h,B),ca[3*ia]=B[0],ca[3*ia+1]=B[1],ca[3*ia+2]=B[2]);O.length&&(J[0]=O[3*ia],J[1]=O[3*ia+1],J[2]=O[3*ia+2],J[3]=0,t.transformMat4(J,h,J),O[3*ia]=J[0],O[3*ia+1]=J[1],O[3*ia+2]=J[2])}}}k.recalculate_mesh_boundings(b)}return b};a.create_material=function(a){return{name:a,uuid:m.gen_uuid(),use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,
.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,
b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},
node_tree:null,texture_slots:[]}};a.assign_logic_nodes_object_params=function(a,b,c){function g(b,c){for(var e in b){var d=b[e],f=d[0];if(1<d.length)for(var h=1;h<d.length;h++)f+="*"+d[h];for(h=0;h<a.length;h++)if(d=a[h],d.name==f)for(var k in c)d[k]=c[k]}}b=c.b4w_logic_nodes;for(var e=0;e<b.length;e++)for(var f=b[e],h=0;h<f.length;h++){var k=f[h],l={register1:"variable1",register2:"variable2",registerd:"variabled"},m;for(m in l)m in k&&(k[l[m]]=k[m]);for(var p in k.variables)"boolean"!=typeof k.variables[p][0]&&
(k.variables[p]=[!1,k.variables[p]]);0<=["MATH","CONDJUMP","PAGEPARAM","REGSTORE"].indexOf(k.type)&&("variable1"in k&&(k.variables.v1=[!1,k.variable1]),"variable2"in k&&(k.variables.v2=[!1,k.variable2]),"variabled"in k&&(k.variables.vd=[!1,k.variabled]));switch(k.type){case "SELECT":for(var q=0;q<a.length;q++)l=a[q],l.name==k.object&&(l.b4w_selectable=!0);k.bools||(k.bools={});k.bools.not_wait||(k.bools.not_wait=!1);d('Logic nodes type "SELECT" is deprecated');break;case "SWITCH_SELECT":g(k.objects_paths,
{b4w_selectable:!0});if(k.links instanceof Array){d('Format of a "SWITCH_SELECT" node is outdated. It is recommended to reexport the scene "'+c.name+'"');var l={},t=0;for(q in k.objects_paths)l[q]=k.links[t],t++;k.links=l}break;case "SELECT_PLAY":d('Logic nodes type "SELECT_PLAY" is deprecated, node will be muted. To fix this, reexport the scene "'+c.name+'"');k.mute=!0;break;case "SELECT_PLAY_ANIM":d('Logic nodes type "SELECT_PLAY_ANIM" is deprecated');break;case "SHOW":case "HIDE":case "SET_SHADER_NODE_PARAM":case "INHERIT_MAT":g(k.objects_paths,
{b4w_do_not_batch:!0});break;case "PLAY":c.b4w_use_nla=!0;break;case "MOVE_TO":g(k.objects_paths,{b4w_do_not_batch:!0});break;case "TRANSFORM_OBJECT":g(k.objects_paths,{b4w_do_not_batch:!0});break;case "OUTLINE":g(k.objects_paths,{b4w_outlining:!0});break;case "CONDJUMP":k.condition&&(k.common_usage_names.condition=k.condition);if("cnd"in k.floats)k.common_usage_names.condition=k.floats.cnd;else switch(k.common_usage_names.condition){case "GEQUAL":k.common_usage_names.condition=F.NC_GEQUAL;break;
case "LEQUAL":k.common_usage_names.condition=F.NC_LEQUAL;break;case "GREATER":k.common_usage_names.condition=F.NC_GREATER;break;case "LESS":k.common_usage_names.condition=F.NC_LESS;break;case "NOTEQUAL":k.common_usage_names.condition=F.NC_NOTEQUAL;break;case "EQUAL":k.common_usage_names.condition=F.NC_EQUAL}void 0!=k.number1&&(k.input1=k.number1);void 0!=k.number2&&(k.input2=k.number2);k.bools||(k.bools={});void 0===k.bools.str&&(k.bools.str=!1,k.floats.inp1=k.input1,k.floats.inp2=k.input2);break;
case "SEND_REQ":k.bools||(k.bools={});k.strings||(k.strings={});void 0===k.bools.ct&&(k.bools.ct=!1);void 0!=k.url&&(k.bools.url=!1,k.strings.url=k.url);break;case "MATH":void 0!=k.number1&&(k.input1=k.number1);void 0!=k.number2&&(k.input2=k.number2);void 0!=k.input1&&(k.floats.inp1=k.input1);void 0!=k.input2&&(k.floats.inp2=k.input2);break;case "REGSTORE":k.floats||(k.floats={});k.strings||(k.strings={});void 0!=k.number1&&(k.input1=k.number1);if(void 0!=k.input1)switch(typeof k.input1){case "number":k.floats.inp1=
k.input1;k.common_usage_names.variable_type="NUMBER";break;default:k.strings.inp1=k.input1,k.common_usage_names.variable_type="STRING"}switch(k.common_usage_names.variable_type){case "NUMBER":k.common_usage_names.variable_type=F.NT_NUMBER;break;case "STRING":k.common_usage_names.variable_type=F.NT_STRING}break;case "PAGEPARAM":k.bools||(k.bools={});void 0===k.bools.hsh&&(k.bools.hsh=!1);k.floats||(k.floats={});void 0===k.floats.ptp&&(k.floats.ptp=0);break;case "PLAY_ANIM":g(k.objects_paths,{b4w_do_not_batch:!0});
k.bools||(k.bools={});void 0===k.bools.env&&(k.bools.env=!1);break;case "STOP_ANIM":k.bools||(k.bools={});void 0===k.bools.env&&(k.bools.env=!1);break;case "STRING":if("cnd"in k.floats)k.common_usage_names.condition=k.floats.cnd;else switch(k.common_usage_names.condition){case "GEQUAL":k.common_usage_names.condition=F.NC_GEQUAL;break;case "LEQUAL":k.common_usage_names.condition=F.NC_LEQUAL;break;case "GREATER":k.common_usage_names.condition=F.NC_GREATER;break;case "LESS":k.common_usage_names.condition=
F.NC_LESS;break;case "NOTEQUAL":k.common_usage_names.condition=F.NC_NOTEQUAL;break;case "EQUAL":k.common_usage_names.condition=F.NC_EQUAL}break;case "REDIRECT":void 0!=k.url&&(k.bools.url=!1,k.strings.url=k.url);break;case "ENTRYPOINT":k.bools||(k.bools={});void 0===k.bools.js&&(k.bools.js=!1);k.bools.js&&(k.mute=!0);break;case "JS_CALLBACK":for(m in k=k.common_usage_names.js_cb_params,k)switch(k[m]){case "OBJECT":k[m]=F.NCPT_OBJECT;break;case "VARIABLE":k[m]=F.NCPT_VARIABLE}}}}};b4w.module.__scenegraph=function(a,r){function u(a){var b=a.dof_object;a.dof_object=null;var c=wa.clone_object_r(a);c.dof_object=b;a.dof_object=b;c.framebuffer=null;c.color_attachment=null;c.depth_attachment=null;return c}function c(a,c){var d=[];L.traverse_edges(a,function(b,c,g){-1<d.indexOf(g)?L.replace_edge_attr(a,b,c,g,e(g)):d.push(g)});L.traverse(a,function(b,g){for(var f=0;f<g.slinks_internal.length;f++){var h=g.slinks_internal[f];c||"MAIN_PLANE_REFLECT"!=g.type&&"MAIN_CUBE_REFLECT"!=g.type&&
"MAIN_XRAY"!=g.type||(h.use_renderbuffer=!0);-1<d.indexOf(h)?g.slinks_internal[f]=e(h):d.push(h)}"ANTIALIASING"==g.type&&L.traverse_inputs(a,b,function(a,b,c){if("MOTION_BLUR"==b.type)for(a=0;a<b.slinks_internal.length;a++)c=b.slinks_internal[a],c.min_filter=Y.TF_LINEAR,c.mag_filter=Y.TF_LINEAR});c||L.traverse_inputs(a,b,function(a,b,c){"DEPTH"==c.from&&(c.use_renderbuffer=!0)})});L.traverse(a,function(c,e){var d={};b(a,c,d);for(var g in d){for(var f=d[g],h=f[0],k=0;k<f.length;k++)if(f[k].min_filter==
Y.TF_LINEAR){h=f[k];break}for(var l=f[0],k=0;k<f.length;k++)if(f[k].mag_filter==Y.TF_LINEAR){l=f[k];break}for(var n=f[0],k=0;k<f.length;k++)if(!f[k].use_renderbuffer){n=f[k];break}for(k=0;k<f.length;k++)f[k].min_filter=h.min_filter,f[k].mag_filter=l.mag_filter,f[k].use_renderbuffer=n.use_renderbuffer}})}function b(a,c,e){L.traverse_inputs(a,c,function(c,d,g){g.active&&g.from==g.to&&(e[g.from]=e[g.from]||[],-1==e[g.from].indexOf(g)&&e[g.from].push(g),b(a,c,e))});L.traverse_outputs(a,c,function(a,b,
c){c.active&&(e[c.from]=e[c.from]||[],-1==e[c.from].indexOf(c)&&e[c.from].push(c))});c=L.get_node_attr(a,c);if("MOTION_BLUR"==c.type)for(var d=0;d<c.slinks_internal.length;d++){var g=c.slinks_internal[d];e[g.from].push(g)}}function h(a){var b=["MOTION_BLUR","SMAA_RESOLVE","SMAA_NEIGHBORHOOD_BLENDING","MAIN_PLANE_REFLECT","MAIN_CUBE_REFLECT"],c=L.topsort(a),e=[];L.traverse(c,function(a,g){for(var h=0;h<g.slinks_internal.length;h++){var l=g.slinks_internal[h];-1<b.indexOf(g.type)&&(l.unique_texture=
!0);var n=f(e,l,d(l));l.texture=n;g.textures_internal[h]=n}for(h=0;h<g.textures_internal.length;h++)n=g.textures_internal[h],p(e,n);L.traverse_outputs(c,a,function(h,l,n){-1<b.indexOf(g.type)&&(n.unique_texture=!0);n.texture||((h=q(c,a,n.from))&&n.active&&!n.texture?k(e,h):h=f(e,n,d(n)),n.texture=h)});L.traverse_inputs(c,a,function(a,b,c){p(e,c.texture)});L.traverse_outputs(c,a,function(a,b,c){c.texture&&"NONE"==c.to&&p(e,c.texture)})})}function d(a){a=wa.clone_object_json(a);delete a.to;delete a.active;
delete a.texture;return JSON.stringify(a)}function q(a,b,c){var e=null;L.traverse_inputs(a,b,function(a,b,d){if(d.active&&d.from==d.to&&d.from==c&&d.texture)return e=d.texture,!0});L.traverse_outputs(a,b,function(a,b,d){if(d.active&&d.from==c&&d.texture)return e=d.texture,!0});return e}function k(a,b){for(var c=0;c<a.length;c++){var e=a[c];e.tex===b&&e.ref++}}function p(a,b){for(var c=0;c<a.length;c++){var e=a[c];e.tex===b&&e.ref&&e.ref--}}function f(a,b,c){if(b.parent_slink)return k(a,b.parent_slink.texture),
b.parent_slink.texture;if(b.unique_texture)return w(b);for(var e=null,d=0;d<a.length;d++){var g=a[d];if(g.id==c&&0===g.ref){e=g;break}}if(e&&!Ea.macos_tex_reuse_hack)return e.ref++,e.tex;b=w(b);a.push({id:c,ref:1,tex:b});return b}function w(a){var b=a.size_mult_x*a.size,c=a.size_mult_y*a.size;switch(a.from){case "COLOR":if(a.use_renderbuffer){var e=Y.create_texture("COLOR_RB",a.multisample?Y.TT_RB_RGBA_MS:Y.TT_RB_RGBA);Y.resize(e,b,c)}else e=Y.create_texture("COLOR",Y.TT_RGBA_INT),Y.resize(e,b,c),
Y.set_filters(e,a.min_filter,a.mag_filter);return e;case "DEPTH":return a.use_renderbuffer?(e=Y.create_texture("DEPTH_RB",a.multisample?Y.TT_RB_DEPTH_MS:Y.TT_RB_DEPTH),Y.resize(e,b,c)):(e=Y.create_texture("DEPTH_TEX",Y.TT_DEPTH),Y.resize(e,b,c),Y.set_filters(e,a.min_filter,a.mag_filter)),e;case "CUBEMAP":return e=Y.create_cubemap_texture("CUBEMAP",b);case "SCREEN":case "NONE":return null;default:throw"Wrong slink param: "+a.from;}}function g(a,b){var c=!1;L.traverse_edges(a,function(e,d,g){if(g&&
(e=L.get_node_attr(a,e),d=L.get_node_attr(a,d),b(g,!1,e,d)))return c=!0});c||L.traverse(a,function(a,c){for(var e=0;e<c.slinks_internal.length;e++)if(b(c.slinks_internal[e],!0,c,null))return!0})}function m(a){L.traverse(a,function(b,c){if("SINK"!=c.type){var e=c.camera;L.traverse_outputs(a,b,function(a,b,c){c.active&&c.texture&&(U.set_attachment(e,c.from,c.texture),c.from==c.to&&b.camera&&U.set_attachment(b.camera,c.from,c.texture))});for(var d=0;d<c.slinks_internal.length;d++){var g=c.slinks_internal[d];
g.active&&g.from==g.to&&U.set_attachment(e,g.from,c.textures_internal[d])}!e.color_attachment&&!e.depth_attachment||e.framebuffer||(e.framebuffer=ma.render_target_create(e.color_attachment,e.depth_attachment))}});L.traverse(a,function(b,c){if("RESOLVE"==c.type||"COPY"==c.type){var e=V(a,c);c.camera.framebuffer_prev=e[0].camera.framebuffer}})}function l(a){var b=null,c=0;L.traverse(a,function(a,e){if(e.type==xa.subs_type){if(c==xa.subs_number)return b=e,!0;c++}});return b}function t(a,b){var c=L.node_by_attr(a,
b),e=M("NONE"),d=L.append_node_attr(a,e),g=L.get_sink_nodes(a)[0];L.traverse_edges(a,function(b,c,e){c==g&&L.reconnect_edges(a,b,g,b,d)});L.traverse_edges(a,function(d,g,f){if(d==c)return L.append_edge_attr(a,b,e,E(xa.slink_type,"u_color",f.size,f.size_mult_x,f.size_mult_y,f.update_dim)),!0});L.append_edge(a,d,g,E("SCREEN","NONE",.5,.5,.5,!0))}function F(a,b,c){var d=c.cameras,g=b.antialiasing,f=b.hmd_stereo_use,h=b.reflection_params.plane_refl_subs,k=b.reflection_params.plane_refl_subs_blend,n,l,
m;f&&g?L.traverse(a,function(b,c){if("ANTIALIASING"==c.type){var e=R(a,c,"COMPOSITING");n=e?L.get_node_id(a,e):b}else"COMPOSITING"==c.type&&(n=b)}):n=L.get_sink_nodes(a)[0];L.traverse_inputs(a,n,function(b,c,e){if(Ha(a,c,"MAIN_OPAQUE"))return l=b,m=c,!0});for(var g=L.subgraph_node_conn(a,l,L.BACKWARD_DIR),p=[],q=[],v=[],g=L.clone(g,function(b){var e;if(-1<Ta.indexOf(b.type))q.push(b),e=b;else{e=z(b);if("MAIN_PLANE_REFLECT"==e.type)for(var g=0;g<h.length;g++)if(h[g][0]==b){h[g]=[b,e];e.camera.reflection_plane=
b.camera.reflection_plane;c.cameras.push(e.camera);break}if("MAIN_PLANE_REFLECT_BLEND"==b.type)for(g=0;g<h.length;g++){if(k[g][0]==b){k[g]=[b,e];e.camera=h[g][1].camera;break}}else-1<d.indexOf(b.camera)&&(f?(U.make_stereo(b.camera,U.TYPE_HMD_LEFT),U.make_stereo(e.camera,U.TYPE_HMD_RIGHT)):(U.make_stereo(b.camera,U.TYPE_STEREO_LEFT),U.make_stereo(e.camera,U.TYPE_STEREO_RIGHT)),d.push(e.camera));var n=L.node_by_attr(a,b);L.traverse_inputs(a,n,function(a,b,c){-1<Ta.indexOf(b.type)&&p.push([b,e,c])});
for(g=0;g<b.slinks_internal.length;g++)e.slinks_internal[g].parent_slink=b.slinks_internal[g];b=!0;for(g=0;g<L.in_edge_count(a,n);g++){var l=L.get_in_edge(a,n,g),l=L.get_node_attr(a,l);-1==Ta.indexOf(l.type)&&(b=!1)}b&&v.push(e)}return e},function(a){var b=e(a,!0);b.parent_slink=a;return b}),D=0;D<q.length;D++)L.remove_node(g,L.node_by_attr(g,q[D]));L.cleanup_loose_edges(g);var t=W(f),D=L.append_node_attr(a,t);L.reconnect_edges(a,l,n,D,n);b=ka();L.append_node_attr(a,b);var V=E("COLOR","COPY",1,1,
1,!0);L.append_edge_attr(a,m,b,V);var w=E("COLOR","u_sampler_left",1,1,1,!0);w.unique_texture=!0;w.min_filter=Y.TF_LINEAR;w.mag_filter=Y.TF_LINEAR;L.append_edge_attr(a,b,t,w);t=E("COLOR","u_sampler_right",1,1,1,!0);t.min_filter=Y.TF_LINEAR;t.mag_filter=Y.TF_LINEAR;t.parent_slink=V;L.append_subgraph(g,a,[L.get_sink_nodes(g)[0],D,t]);for(D=0;D<p.length;D++)L.append_edge_attr(a,p[D][0],p[D][1],p[D][2]);g=E("SCREEN","NONE",0,0,0,!1);for(D=0;D<v.length;D++)L.append_edge_attr(a,b,v[D],g);f&&H(a,.5,1)}function H(a,
b,c){var e=[];L.traverse(a,function(b,c){if(-1==Ta.indexOf(c.type)&&c.slinks_internal.length&&T(a,c,"STEREO"))for(var d=0;d<c.slinks_internal.length;d++){var g=c.slinks_internal[d];-1==e.indexOf(g)&&e.push(g)}});L.traverse_edges(a,function(b,c,d){b=L.get_node_attr(a,b);c=L.get_node_attr(a,c);-1==Ta.indexOf(b.type)&&T(a,c,"STEREO")&&-1==e.indexOf(d)&&e.push(d)});for(var d=0;d<e.length;d++)e[d].size_mult_x*=b,e[d].size_mult_y*=c}function C(a,b){a.num_lights=b;a.light_directions=new Float32Array(3*b);
a.light_positions=new Float32Array(3*b);a.light_color_intensities=new Float32Array(3*b);a.light_factors=new Float32Array(0==b%2?2*b:2*b+2)}function x(a,b,c,e){var d=y("SHADOW_CAST");d.csm_index=a;d.self_shadow_polygon_offset=c.self_shadow_polygon_offset;d.shadow_lamp_index=b;switch(c.lamp_types[b]){case "SPOT":case "POINT":d.camera=U.create_camera(U.TYPE_PERSP);a=wa.rad_to_deg(c.spot_sizes[b]);U.set_frustum(d.camera,a,.1,2*c.distances[b]);break;default:d.camera=U.create_camera(U.TYPE_ORTHO_ASYMMETRIC)}C(d,
e);return d}function y(a){a={type:a,subtype:"",blend:!1,pack:!1,assign_texture:!1,need_fog_update:!1,debug_render_calls:0,debug_render_time:0,debug_render_time_queries:[],time:0,camera:null,cube_view_matrices:null,cube_cam_frustums:[],bundles:[],slinks_internal:[],textures_internal:[],wind:new Float32Array(3),grass_map_dim:new Float32Array(3),fog_color_density:new Float32Array(4),fog_params:new Float32Array(4),cube_fog:new Float32Array(16),sky_tex_default_value:0,environment_energy:0,num_lights:0,
light_directions:null,light_positions:null,light_color_intensities:null,light_factors:null,horizon_color:new Float32Array(3),zenith_color:new Float32Array(3),sky_tex_fac:new Float32Array(4),sun_intensity:new Float32Array([0,0,0]),sun_direction:new Float32Array(3),sun_quaternion:new Float32Array(4),sky_tex_color:new Float32Array(3),outline_factor:0,draw_outline_flag:0,is_for_outline:!1,outline_color:new Float32Array(3),water:0,cam_water_depth:0,water_fog_color_density:null,water_waves_height:0,water_waves_length:0,
water_level:0,caustics:!1,caust_scale:0,caust_speed:new Float32Array(2),caust_brightness:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,sky_color:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,ssao_radius_increase:0,ssao_influence:0,ssao_dist_factor:0,ssao_samples:0,ssao_only:0,
ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,max_ray_length:0,radial_blur_step:0,steps_per_pass:0,csm_index:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,v_light_ts:null,v_light_r:null,v_light_tsr:null,p_light_matrix:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,blur_texel_size_mult:0,ext_texel_size_mult:0,mb_decay_threshold:0,mb_factor:0,motion_blur_exp:0,pp_effect:"",jitter_projection_space:new Float32Array(2),small_glow_mask_width:0,large_glow_mask_width:0,
small_glow_mask_coeff:0,large_glow_mask_coeff:0,texel_size:new Float32Array(2),texel_mask:new Float32Array(2),distortion_params:new Float32Array(4),chromatic_aberration_coefs:new Float32Array(4),enable_hmd_stereo:!1,shadow_lamp_index:0,debug_colors_seed:0,do_render:!0,enqueue:!0,clear_color:!0,clear_depth:!0,depth_test:!0,need_perm_uniforms_update:!0,texel_size_multiplier:1};a.texel_mask[0]=1;a.texel_mask[1]=1;a.distortion_params[2]=.5;a.distortion_params[3]=0;return a}function z(a){var b=a.camera;
a.camera=null;var c=wa.clone_object_r(a);a.camera=b;c.camera=u(b);return c}function E(a,b,c,e,d,g){return{from:a,to:b,size:c,size_mult_x:e,size_mult_y:d,update_dim:g,active:!0,texture:null,multisample:!1,use_renderbuffer:!1,min_filter:Y.TF_NEAREST,mag_filter:Y.TF_NEAREST,unique_texture:!1}}function e(a,b){if(b){var c=a.texture;a.texture=null}a.texture&&wa.panic("Failed to clone slink with attached texture");var e=wa.clone_object_json(a);b&&(a.texture=c,e.texture=c);return e}function n(){var a=y("GRASS_MAP");
a.camera=U.create_camera(U.TYPE_ORTHO_ASPECT);return a}function M(a){var b=y("POSTPROCESSING");b.clear_color=!1;b.clear_depth=!1;b.depth_test=!1;b.camera=U.create_camera(U.TYPE_NONE);b.pp_effect=a;switch(a){case "NONE":b.texel_mask[0]=1;b.texel_mask[1]=1;break;case "GRAYSCALE":b.texel_mask[0]=1;b.texel_mask[1]=1;break;case "X_BLUR":b.texel_mask[0]=1;b.texel_mask[1]=0;break;case "Y_BLUR":b.texel_mask[0]=0;b.texel_mask[1]=1;break;case "X_GLOW_BLUR":b.texel_mask[0]=1;b.texel_mask[1]=0;break;case "Y_GLOW_BLUR":b.texel_mask[0]=
0;b.texel_mask[1]=1;break;case "X_EXTEND":b.texel_mask[0]=1;b.texel_mask[1]=0;break;case "Y_EXTEND":b.texel_mask[0]=0;b.texel_mask[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}return b}function D(a,b,c){a=y("BLOOM_BLUR");a.clear_color=!1;a.clear_depth=!1;a.depth_test=!1;a.camera=U.create_camera(U.TYPE_NONE);a.pp_effect=c;switch(c){case "X_BLUR":a.texel_mask[0]=1;a.texel_mask[1]=0;break;case "Y_BLUR":a.texel_mask[0]=0;a.texel_mask[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+
c;}return a}function G(a,b){var c=y("GLOW_COMBINE");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.small_glow_mask_coeff=b.glow_params.small_glow_mask_coeff;c.large_glow_mask_coeff=b.glow_params.large_glow_mask_coeff;c.small_glow_mask_width=b.glow_params.small_glow_mask_width;c.large_glow_mask_width=b.glow_params.large_glow_mask_width;c.camera=a;return c}function Q(a,b,c,e,d,g,f,h,k){var n=y("MAIN_"+a);if("OPAQUE"===a)n.clear_color=!0,n.clear_depth=c,n.blend=!1;else if("BLEND"===a)n.clear_color=
!1,n.clear_depth=!1,n.blend=!0;else if("XRAY"===a)n.clear_color=!1,n.clear_depth=!0,n.blend=!0;else if("PLANE_REFLECT"===a||"CUBE_REFLECT"===a)n.clear_color=!0,n.clear_depth=!0,n.blend=!1;else if("PLANE_REFLECT_BLEND"===a||"CUBE_REFLECT_BLEND"===a)n.clear_color=!1,n.clear_depth=!1,n.blend=!0;else if("GLOW"===a)n.clear_color=!0,n.clear_depth=!1,n.blend=!0;else throw"wrong main subscene type";n.blend&&h&&(n.self_shadow_normal_offset=h.self_shadow_normal_offset);n.camera=b;if(a=f.sky_texture_param)n.sky_tex_fac.set([a.blend_factor,
a.horizon_factor,a.zenith_up_factor,a.zenith_down_factor]),n.sky_tex_color.set(a.color),n.sky_tex_default_value=a.default_value;n.horizon_color.set(f.horizon_color);n.zenith_color.set(f.zenith_color);n.environment_energy=f.environment_energy;n.fog_color_density=g.fog_color_density;n.fog_params=g.fog_params;e&&(n.water_params=e,e.fog_color_density&&(n.water_fog_color_density=new Float32Array(e.fog_color_density)),n.water_waves_height=e.waves_height,n.water_waves_length=e.waves_length,n.water_level=
e.water_level,e.caustics&&k&&(n.caustics=!0,n.caust_scale=e.caustic_scale,n.caust_brightness=e.caustic_brightness,n.caust_speed.set(e.caustic_speed)));C(n,d);return n}function v(){var a=y("RESOLVE");a.camera=U.create_camera(U.TYPE_NONE);return a}function P(a,b,c){var e=y("COLOR_PICKING");b&&(e.type+="_XRAY",e.clear_color=!1,e.clear_depth=!0);e.enqueue=!1;e.camera=a;C(e,c);return e}function S(a){var b=y("DEBUG_VIEW");b.do_render=!1;b.clear_color=!1;b.clear_depth=!1;b.camera=a;return b}function I(a){var b=
y("ANCHOR_VISIBILITY");b.clear_color=!0;b.clear_depth=!1;b.camera=a;return b}function K(a,b,c){a=y("SHADOW_RECEIVE");a.camera=b;C(a,c);return a}function B(a){var b=y("DEPTH_PACK");b.clear_color=!1;b.clear_depth=!1;b.camera=a;return b}function N(a,b,c){var e=y("SSAO");e.clear_color=!1;e.clear_depth=!1;e.depth_test=!1;e.camera=a;e.fog_color_density=b.fog_color_density;e.water_fog_color_density=new Float32Array(b.fog_color_density);e.ssao_radius_increase=c.radius_increase;e.ssao_hemisphere=c.hemisphere;
e.ssao_influence=c.influence;e.ssao_dist_factor=c.dist_factor;e.ssao_samples=c.samples;return e}function J(a,b){var c=y("SSAO_BLUR");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.camera=a;c.ssao_blur_depth=b.blur_depth;c.ssao_blur_discard_value=b.blur_discard_value;return c}function X(a){var b=y("ANTIALIASING");b.clear_color=!1;b.clear_depth=!1;b.depth_test=!1;b.texel_size_multiplier=1/a.resolution_factor;b.fxaa_quality=a.aa_quality;b.camera=U.create_camera(U.TYPE_NONE);return b}function O(a,
b){var c=y(a);c.clear_color="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;c.clear_depth=!1;c.depth_test=!1;c.texel_size_multiplier=1/b.resolution_factor;c.camera=U.create_camera(U.TYPE_NONE);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(c.jitter_subsample_ind=new Float32Array(4));return c}function ba(a,b,c,e){var d=y("COMPOSITING");d.clear_color=!1;d.clear_depth=!1;d.depth_test=!1;d.camera=U.create_camera(U.TYPE_NONE);d.brightness=a;d.contrast=b;d.exposure=c;d.saturation=e;return d}
function ca(a,b){var c=y("MOTION_BLUR");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.camera=U.create_camera(U.TYPE_NONE);c.assign_texture=!0;c.mb_decay_threshold=a;c.mb_factor=b;return c}function ga(a){var b=y("DOF");b.clear_color=!1;b.clear_depth=!1;b.depth_test=!1;b.camera=a;b.texel_size_multiplier=b.camera.dof_power;return b}function aa(a,b){var c=y("OUTLINE_MASK");c.depth_test=!1;c.camera=a;C(c,b);return c}function ia(a){var b=y("OUTLINE");za.outlining_overview_mode?b.outline_color.set(za.outline_color):
b.outline_color.set(a.outline_color);b.outline_factor=a.outline_factor;b.ext_texel_size_mult=5;b.blur_texel_size_mult=3;b.depth_test=!1;b.camera=U.create_camera(U.TYPE_NONE);return b}function da(a,b,c,e,d,g,f){var h=y("GOD_RAYS");h.clear_color=!1;h.clear_depth=!1;h.depth_test=!1;h.horizon_color=new Float32Array([1,1,1]);h.zenith_color=new Float32Array([1,1,1]);h.environment_energy=1;h.pack=e;h.water=b;h.radial_blur_step=d;h.max_ray_length=c;h.steps_per_pass=f;h.camera=a;C(h,g);return h}function ta(a,
b){var c=y("GOD_RAYS_COMBINE");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.camera=U.create_camera(U.TYPE_NONE);c.god_rays_intensity=a;C(c,b);return c}function fa(a,b){var c=y("SKY");c.enqueue=!1;c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;var e=U.create_camera(U.TYPE_NONE);e.width=ea.cubemap_tex_size;e.height=ea.cubemap_tex_size;c.camera=e;c.cube_view_matrices=wa.generate_cubemap_matrices();C(c,a);c.horizon_color=new Float32Array([1,1,1]);c.zenith_color=new Float32Array([1,1,1]);c.environment_energy=
1;c.sky_color.set(b.sky_color);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}
function ka(){var a=y("COPY");a.clear_color=!1;a.clear_depth=!1;a.camera=U.create_camera(U.TYPE_NONE);return a}function W(a){var b=y("STEREO");b.clear_color=!1;b.clear_depth=!1;b.subtype=a?"HMD":"ANAGLYPH";b.camera=U.create_camera(U.TYPE_NONE);return b}function A(){var a=y("LUMINANCE");a.clear_color=!1;a.clear_depth=!1;a.camera=U.create_camera(U.TYPE_NONE);return a}function la(){var a=y("AVERAGE_LUMINANCE");a.clear_color=!1;a.clear_depth=!1;a.camera=U.create_camera(U.TYPE_NONE);return a}function ja(a,
b,c,e){var d=y("LUMINANCE_TRUNCED");d.clear_color=!1;d.clear_depth=!1;d.bloom_key=a;d.bloom_edge_lum=b;d.camera=e;C(d,c);return d}function ha(a){var b=y("BLOOM");b.clear_color=!1;b.clear_depth=!1;b.camera=U.create_camera(U.TYPE_NONE);b.bloom_blur=a;return b}function sa(){var a=y("SINK");a.enqueue=!1;return a}function T(a,b,c){if(b.type===c)return!0;b=Z(a,b);for(var e=0;e<b.length;e++)if(T(a,b[e],c))return!0;return!1}function Ha(a,b,c){if(b.type===c)return!0;b=V(a,b);for(var e=0;e<b.length;e++)if(Ha(a,
b[e],c))return!0;return!1}function R(a,b,c){if(b.type===c)return b;b=V(a,b);for(var e=0;e<b.length;e++){var d=R(a,b[e],c);if(d)return d}return null}function V(a,b){var c=L.node_by_attr(a,b);if(c==L.NULL_NODE)throw"Subscene not in graph";for(var e=[],d=L.in_edge_count(a,c),g=0;g<d;g++){var f=L.get_in_edge(a,c,g);f!=c&&e.push(L.get_node_attr(a,f))}return e}function Z(a,b){var c=L.node_by_attr(a,b);if(c==L.NULL_NODE)throw"Subscene not in graph";for(var e=[],d=L.out_edge_count(a,c),g=0;g<d;g++){var f=
L.get_out_edge(a,c,g);f!=c&&e.push(L.get_node_attr(a,f))}return e}function qa(a){var b=[],c=[];g(a,function(a,e,d,g){a.texture&&-1==b.indexOf(a.texture)&&(b.push(a.texture),c.push(a.texture,b.length-1))});return c}function Aa(a,b,c,e){b=""+(a.from+"\\n");b+="NONE"!=a.to?a.to+"\\n":"";b+="(";if(a.update_dim){c=a.size_mult_x;var d=a.size_mult_y;Math.round(c)!=c&&(c=c.toFixed(2));Math.round(d)!=d&&(d=d.toFixed(2));b+=(1==c?"":c)+"Sx"+((1==d?"":d)+"S")}else c=a.size_mult_x,d=a.size_mult_y,b+=a.size*c+
"x"+a.size*d;if("SCREEN"!=a.from){b+=" ";if(a.use_renderbuffer)b+="RR";else{c=a.min_filter;var d=a.mag_filter,g="";c==Y.TF_LINEAR?g+="L":c==Y.TF_NEAREST&&(g+="N");d==Y.TF_LINEAR?g+="L":d==Y.TF_NEAREST&&(g+="N");b+=g}for(c=0;c<e.length;c+=2)e[c]==a.texture&&(b+=" "+e[c+1])}return b+")\\n"}var U=r("__camera"),oa=r("__config"),pa=r("__debug"),L=r("__graph"),ma=r("__renderer");r("__scenes");var Y=r("__textures"),wa=r("__util"),xa=oa.debug_subs,Ea=oa.defaults,za=oa.outlining,ea=oa.scenes,Ta=["GRASS_MAP",
"SHADOW_CAST","MAIN_CUBE_REFLECT","MAIN_CUBE_REFLECT_BLEND"];a.check_slink_tex_conn=function(a){switch(a.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":case "NONE":return!1;default:return!0}};a.traverse_slinks=g;a.create_rendering_graph=function(a,b,d,g){var f=L.create(),k=[],p=[],R=[],q=[],w=[],r=[],y=[],z=[],za=a.lamps_number,C=a.water_params,qa=a.shore_smoothing,H=a.soft_particles,W=a.ssao,Ta=a.god_rays,Aa=a.reflection_params,T=a.materials_params,
oa=a.bloom_params,Pb=a.motion_blur,Ac=a.compositing,Ha=a.antialiasing,hc=a.world_light_set,ob=a.world_fog_set,Ja=a.shadow_params,Qb=a.mb_params,Mc=a.cc_params,Bc=a.god_rays_params,ma=a.outline_params,vd=a.dof,Sc=a.depth_tex,kd=a.refractions,zb=Boolean(g.length),Rb=1<Ea.msaa_samples,Wb=E("COLOR","COLOR",1,1,1,!0),rb=E("DEPTH","DEPTH",1,1,1,!0);if(Rb){e(rb);var tc=e(rb);Wb.multisample=!0;Wb.use_renderbuffer=!0;rb.multisample=!0;rb.use_renderbuffer=!0}var bb=b.cameras[0];if(Ja){U.update_camera_shadows(bb,
Ja);for(var Za=0;Za<Ja.lamp_types.length;Za++)for(var wd=Ja.csm_num,Ra=0;Ra<wd;Ra++){var Hc=x(Ra,Za,Ja,za);L.append_node_attr(f,Hc);R.push(Hc);var nc=Ja.csm_resolution,Ma=Hc.camera;b.shadow_cameras.push(Ma);Ma.width=nc;Ma.height=nc;Hc.clear_color=!1;q.push(E("DEPTH","u_shadow_map"+(0<Za?Za:Ra),nc,1,1,!1));(pa.check_depth_only_issue()||Ea.firefox_shadows_slink_hack)&&Hc.slinks_internal.push(E("COLOR","COLOR",nc,1,1,!1))}}if(Aa&&Aa.num_cube_refl&&!zb)for(Ra=0;Ra<Aa.num_cube_refl;Ra++){Ma=U.create_camera(U.TYPE_PERSP);
Ma.width=a.cubemap_refl_size;Ma.height=a.cubemap_refl_size;U.set_frustum(Ma,90,.1,100);U.set_projection(Ma,Ma.aspect);var Ua=Q("CUBE_REFLECT",Ma,!1,C,za,ob,hc,null,a.sun_exist);Ua.cube_view_matrices=wa.generate_inv_cubemap_matrices();for(Za=0;6>Za;Za++)Ua.cube_cam_frustums.push(U.create_frustum_planes());L.append_node_attr(f,Ua);var Ic=E("CUBEMAP","u_cube_reflection",a.cubemap_refl_size,1,1,!1);Ic.min_filter=Y.TF_LINEAR;Ic.mag_filter=Y.TF_LINEAR;z.push(Ic);if(Aa.has_blend_reflexible){var Xb=Q("CUBE_REFLECT_BLEND",
Ma,!1,C,za,ob,hc,null,a.sun_exist);Xb.cube_view_matrices=Ua.cube_view_matrices;Xb.cube_cam_frustums=Ua.cube_cam_frustums;L.append_node_attr(f,Xb);var pd=E("DEPTH","DEPTH",a.cubemap_refl_size,1,1,!1),Cc=E("COLOR","COLOR",a.cubemap_refl_size,1,1,!1);L.append_edge_attr(f,Ua,Xb,pd);L.append_edge_attr(f,Ua,Xb,Cc);y.push(Xb);Aa.cube_refl_subs_blend.push(Xb)}else{var qd=E("DEPTH","DEPTH",a.cubemap_refl_size,1,1,!1);Ua.slinks_internal.push(qd);y.push(Ua)}Aa.cube_refl_subs.push(Ua)}if(Aa&&0<Aa.refl_plane_objs.length&&
!zb)for(Za=0;Za<Aa.refl_plane_objs.length;Za++)Ma=u(bb),Ma.reflection_plane=new Float32Array(4),b.cameras.push(Ma),Ua=Q("PLANE_REFLECT",Ma,!1,C,za,ob,hc,null,a.sun_exist),L.append_node_attr(f,Ua),Ic=E("COLOR","u_plane_reflection",a.plane_refl_size,1,1,!0),Ic.min_filter=Y.TF_LINEAR,Ic.mag_filter=Y.TF_LINEAR,r.push(Ic),Aa.has_blend_reflexible?(Xb=Q("PLANE_REFLECT_BLEND",Ma,!1,C,za,ob,hc,null,a.sun_exist),L.append_node_attr(f,Xb),pd=E("DEPTH","DEPTH",a.plane_refl_size,1,1,!0),Cc=E("COLOR","COLOR",a.plane_refl_size,
1,1,!0),Cc.min_filter=Y.TF_NEAREST,Cc.mag_filter=Y.TF_NEAREST,L.append_edge_attr(f,Ua,Xb,pd),L.append_edge_attr(f,Ua,Xb,Cc),Aa.plane_refl_subs_blend.push([Xb]),w.push(Xb)):(qd=E("DEPTH","DEPTH",a.plane_refl_size,1,1,!0),Ua.slinks_internal.push(qd),w.push(Ua)),Aa.plane_refl_subs.push([Ua]);if(a.dynamic_grass){var Gb=n();L.append_node_attr(f,Gb);nc=ea.grass_tex_size;Gb.camera.width=nc;Gb.camera.height=nc;var Jc=E("DEPTH","u_grass_map_depth",nc,1,1,!1);Jc.min_filter=Y.TF_LINEAR;Jc.mag_filter=Y.TF_LINEAR;
var Nc=E("COLOR","u_grass_map_color",nc,1,1,!1);Nc.min_filter=Y.TF_LINEAR;Nc.mag_filter=Y.TF_LINEAR}else Nc=Jc=Gb=null;if(Sc&&Ja){var xd=u(bb);b.cameras.push(xd);var Yb=K(f,xd,za);L.append_node_attr(f,Yb);Yb.self_shadow_normal_offset=Ja.self_shadow_normal_offset;for(Ra=0;Ra<R.length;Ra++)Hc=R[Ra],L.append_edge_attr(f,Hc,Yb,q[Ra]);var yd=E("COLOR","u_color",1,1,1,!0),zd=E("DEPTH","u_depth",1,1,1,!0);if(W){var Kc=u(bb);b.cameras.push(Kc);var Jb=a.ssao_params,Ab=N(Kc,ob,Jb);L.append_node_attr(f,Ab);
var oc=E("COLOR","u_ssao_mask",1,1,1,!0);L.append_edge_attr(f,Yb,Ab,yd);L.append_edge_attr(f,Yb,Ab,zd);var gb=u(bb);b.cameras.push(gb);var ic=J(gb,Jb);L.append_node_attr(f,ic);var ld=E("COLOR","u_shadow_mask",1,1,1,!0);L.append_edge_attr(f,Ab,ic,oc);L.append_edge_attr(f,Yb,ic,zd)}Rb?Yb.slinks_internal.push(E("DEPTH","DEPTH",1,1,1,!0)):Yb.slinks_internal.push(rb);Gb&&(L.append_edge_attr(f,Gb,Yb,Jc),L.append_edge_attr(f,Gb,Yb,Nc))}else Yb=null;var hb=Q("OPAQUE",bb,!0,C,za,ob,hc,null,a.sun_exist);L.append_node_attr(f,
hb);if(Rb){var ub=v();L.append_node_attr(f,ub);p.push(ub);var cc=E("COLOR","RESOLVE",1,1,1,!0);cc.multisample=!0;cc.use_renderbuffer=!0;var Dc=E("DEPTH","RESOLVE",1,1,1,!0);Dc.multisample=!0;Dc.use_renderbuffer=!0;L.append_edge_attr(f,hb,ub,cc);L.append_edge_attr(f,hb,ub,Dc)}else p.push(hb);Yb&&(oc?L.append_edge_attr(f,ic,hb,ld):Ja?L.append_edge_attr(f,Yb,hb,E("COLOR","u_shadow_mask",1,1,1,!0)):wa.panic("Internal error"));Gb&&(L.append_edge_attr(f,Gb,hb,Jc),L.append_edge_attr(f,Gb,hb,Nc));if(w.length)for(var uc=
w.length,Za=0;Za<uc;Za++)L.append_edge_attr(f,w[Za],hb,r[Za]);if(y.length)for(Za=0;Za<y.length;Za++)L.append_edge_attr(f,y[Za],hb,z[Za]);k=p;p=[];if(!zb&&a.color_picking){Ma=u(bb);b.cameras.push(Ma);var Bb=P(Ma,!1,za);L.append_node_attr(f,Bb);if(a.xray){Ma=u(bb);b.cameras.push(Ma);var pc=P(Ma,!0,za);L.append_node_attr(f,pc);var Kb=E("COLOR","COLOR",1,1,1,!0);L.append_edge_attr(f,Bb,pc,Kb);var Ec=E("DEPTH","DEPTH",1,1,1,!0);L.append_edge_attr(f,Bb,pc,Ec)}}else Bb=null;if(!T.refractions&&!kd||zb)Lb=
null;else{if(Rb)Lb=ub;else{var Lb=ka();L.append_node_attr(f,Lb);var $a=E("COLOR","COPY",1,1,1,!0);L.append_edge_attr(f,k[0],Lb,$a)}var ib=E("COLOR","u_refractmap",1,1,1,!0)}if(Sc&&(kd||qa||H)){var pb=u(bb);b.cameras.push(pb);var Oa=B(pb);L.append_node_attr(f,Oa);var eb=E("DEPTH","u_depth",1,1,1,!0);L.append_edge_attr(f,Rb?ub:hb,Oa,eb);var Mb=E("COLOR","u_scene_depth",1,1,1,!0);Mb.min_filter=Y.TF_NEAREST;Mb.mag_filter=Y.TF_NEAREST}else Oa=null;var vc=function(c){var e=u(bb);b.cameras.push(e);e=Q(c,
e,!1,C,za,ob,hc,Ja,a.sun_exist);L.append_node_attr(f,e);"XRAY"==c?(c=E("COLOR","COLOR",1,1,1,!0),L.append_edge_attr(f,k[0],e,c),c=E("DEPTH","DEPTH",1,1,1,!0),e.slinks_internal.push(c)):(c=Rb&&"RESOLVE"==k[0].type?hb:k[0],L.append_edge_attr(f,c,e,rb),L.append_edge_attr(f,c,e,Wb));Gb&&(L.append_edge_attr(f,Gb,e,Jc),L.append_edge_attr(f,Gb,e,Nc));for(c=0;c<R.length;c++)L.append_edge_attr(f,R[c],e,q[c]);Oa&&L.append_edge_attr(f,Oa,e,Mb);if(w.length){var d=w.length;for(c=0;c<d;c++)L.append_edge_attr(f,
w[c],e,r[c])}if(y.length)for(c=0;c<y.length;c++)L.append_edge_attr(f,y[c],e,z[c]);Lb&&L.append_edge_attr(f,Lb,e,ib);return e};if(a.glow_over_blend){var Zb=vc("BLEND");p.push(Zb);k=p;p=[]}if(a.glow_materials){var Hb=u(bb);b.cameras.push(Hb);var jc=Q("GLOW",Hb,!1,C,za,ob,hc);L.append_node_attr(f,jc);Oa&&L.append_edge_attr(f,Oa,jc,Mb);Lb&&L.append_edge_attr(f,Lb,jc,ib);L.append_edge_attr(f,Rb?ub:hb,jc,Rb?tc:rb);var ab=M("X_GLOW_BLUR");ab.subtype="GLOW_MASK_SMALL";ab.texel_size_multiplier=a.glow_params.small_glow_mask_width;
var Cb=E("COLOR","u_color",1,1,1,!0);Cb.min_filter=Y.TF_LINEAR;Cb.mag_filter=Y.TF_LINEAR;L.append_node_attr(f,ab);L.append_edge_attr(f,jc,ab,Cb);var vb=M("Y_GLOW_BLUR");vb.subtype="GLOW_MASK_SMALL";vb.texel_size_multiplier=a.glow_params.small_glow_mask_width;var kc=E("COLOR","u_color",1,.5,.5,!0);kc.min_filter=Y.TF_LINEAR;kc.mag_filter=Y.TF_LINEAR;L.append_node_attr(f,vb);L.append_edge_attr(f,ab,vb,kc);var wc=M("X_GLOW_BLUR");wc.subtype="GLOW_MASK_LARGE";wc.texel_size_multiplier=a.glow_params.large_glow_mask_width;
var Sb=E("COLOR","u_color",1,.5,.5,!0);Sb.min_filter=Y.TF_LINEAR;Sb.mag_filter=Y.TF_LINEAR;L.append_node_attr(f,wc);L.append_edge_attr(f,vb,wc,Sb);var Xa=M("Y_GLOW_BLUR");Xa.subtype="GLOW_MASK_LARGE";Xa.texel_size_multiplier=a.glow_params.large_glow_mask_width;var sb=E("COLOR","u_color",1,.25,.25,!0);sb.min_filter=Y.TF_LINEAR;sb.mag_filter=Y.TF_LINEAR;L.append_node_attr(f,Xa);L.append_edge_attr(f,wc,Xa,sb);var Ca=u(bb);b.cameras.push(Ca);var qb=G(Ca,a);L.append_node_attr(f,qb);var wb=E("COLOR","u_src_color",
1,1,1,!0);if(a.glow_over_blend)if(Rb){var Nb=v();L.append_node_attr(f,Nb);L.append_edge_attr(f,Zb,Nb,cc);L.append_edge_attr(f,Zb,Nb,Dc);L.append_edge_attr(f,Nb,qb,wb)}else L.append_edge_attr(f,Zb,qb,wb);else L.append_edge_attr(f,Rb?ub:hb,qb,wb);L.append_edge_attr(f,a.glow_over_blend?Zb:hb,qb,rb);var Va=E("COLOR","u_glow_mask_small",1,.5,.5,!0);Va.min_filter=Y.TF_LINEAR;Va.mag_filter=Y.TF_LINEAR;L.append_edge_attr(f,vb,qb,Va);var Ob=E("COLOR","u_glow_mask_large",1,.25,.25,!0);Ob.min_filter=Y.TF_LINEAR;
Ob.mag_filter=Y.TF_LINEAR;L.append_edge_attr(f,Xa,qb,Ob);k=[qb];p=[]}a.glow_over_blend||(Zb=vc("BLEND"),p.push(Zb),k=p,p=[]);if(Ea.debug_view){Ma=u(bb);b.cameras.push(Ma);var Tb=S(Ma);p.push(Tb);L.append_node_attr(f,Tb);L.append_edge_attr(f,k[0],Tb,Wb);L.append_edge_attr(f,k[0],Tb,rb);Gb&&(L.append_edge_attr(f,Gb,Tb,Jc),L.append_edge_attr(f,Gb,Tb,Nc));k=p;p=[]}if(Rb){var tb=v();L.append_node_attr(f,tb);p.push(tb);L.append_edge_attr(f,k[0],tb,cc);L.append_edge_attr(f,k[0],tb,Dc);k=p;p=[]}var fb=k.slice(0);
if(!zb&&a.anchor_visibility){Ma=u(bb);b.cameras.push(Ma);var Db=I(Ma);L.append_node_attr(f,Db);L.append_edge_attr(f,k[0],Db,Rb?tc:rb)}if(Ta&&Sc&&!zb){var cb=Bc.max_ray_length,jb=Bc.intensity,Eb=Bc.steps_per_pass,Ya=k[0],kb=C?!0:!1,dc=E("DEPTH","u_input",1,1,1,!0);dc.min_filter=Y.TF_LINEAR;dc.mag_filter=Y.TF_LINEAR;var lb=E("COLOR","u_input",1,.25,.25,!0);lb.min_filter=Y.TF_LINEAR;lb.mag_filter=Y.TF_LINEAR;var mb=cb/Eb,db=u(bb);b.cameras.push(db);var lc=da(db,kb,cb,!0,mb,za,Eb);L.append_node_attr(f,
lc);L.append_edge_attr(f,Ya,lc,dc);var mb=cb/Eb*.5,qc=u(bb);b.cameras.push(qc);var xc=da(qc,kb,cb,!1,mb,za,Eb);L.append_node_attr(f,xc);L.append_edge_attr(f,lc,xc,lb);var mb=cb/Eb*.25,Qa=u(bb);b.cameras.push(Qa);var Sa=da(Qa,kb,cb,!1,mb,za,Eb);L.append_node_attr(f,Sa);L.append_edge_attr(f,xc,Sa,lb);var Fc=ta(jb,za);p.push(Fc);L.append_node_attr(f,Fc);L.append_edge_attr(f,Ya,Fc,E("COLOR","u_main",1,1,1,!0));L.append_edge_attr(f,Sa,Fc,E("COLOR","u_god_rays",1,1,1,!0));k=p;p=[]}if(oa&&!zb){var Ya=k[0],
$b=A();L.append_node_attr(f,$b);L.append_edge_attr(f,Ya,$b,E("COLOR","u_input",1,1,1,!0));var Fb=la();L.append_node_attr(f,Fb);Fb.camera.width=Ea.edge_min_tex_size_hack?2:1;Fb.camera.height=Ea.edge_min_tex_size_hack?2:1;var ad=E("COLOR","u_input",1,.25,.25,!0);ad.min_filter=Y.TF_LINEAR;ad.mag_filter=Y.TF_LINEAR;var bd=E("COLOR","u_luminance",1,.25,.25,!0);bd.min_filter=Y.TF_LINEAR;bd.mag_filter=Y.TF_LINEAR;L.append_edge_attr(f,$b,Fb,ad);var Tc=oa.key,ec=oa.edge_lum,rc=u(bb);b.cameras.push(rc);var Gc=
ja(Tc,ec,za,rc);L.append_node_attr(f,Gc);L.append_edge_attr(f,Ya,Gc,E("COLOR","u_main",1,1,1,!0));L.append_edge_attr(f,$b,Gc,bd);L.append_edge_attr(f,Fb,Gc,E("COLOR","u_average_lum",1,1,1,!1));var fc=E("COLOR","u_color",1,.25,.25,!0);fc.min_filter=Y.TF_LINEAR;fc.mag_filter=Y.TF_LINEAR;ab=D(f,$b,"X_BLUR",!0);L.append_node_attr(f,ab);L.append_edge_attr(f,Gc,ab,fc);vb=D(f,ab,"Y_BLUR",!0);L.append_node_attr(f,vb);L.append_edge_attr(f,ab,vb,fc);var yc=ha(oa.blur);L.append_node_attr(f,yc);var Ub=E("COLOR",
"u_bloom",1,.25,.25,!0);Ub.min_filter=Y.TF_LINEAR;Ub.mag_filter=Y.TF_LINEAR;L.append_edge_attr(f,vb,yc,Ub);L.append_edge_attr(f,Ya,yc,E("COLOR","u_main",1,1,1,!0));p.push(yc);k=p;p=[]}if(vd&&Sc&&!zb){var Ya=k[0],Vb=u(bb);b.cameras.push(Vb);fc=E("COLOR","u_color",1,1,1,!0);fc.min_filter=Y.TF_LINEAR;fc.mag_filter=Y.TF_LINEAR;var mc=M("X_BLUR");L.append_node_attr(f,mc);L.append_edge_attr(f,Ya,mc,fc);var ac=M("Y_BLUR");L.append_node_attr(f,ac);L.append_edge_attr(f,mc,ac,fc);var Ad=fb[0],Oc=ga(Vb);Vb.dof_distance=
d.dof_distance;Vb.dof_object=d.dof_object;Vb.dof_front=d.dof_front;Vb.dof_rear=d.dof_rear;Vb.dof_power=d.dof_power;Vb.dof_on=!0;p.push(Oc);L.append_node_attr(f,Oc);L.append_edge_attr(f,Ya,Oc,E("COLOR","u_sharp",1,1,1,!0));L.append_edge_attr(f,ac,Oc,E("COLOR","u_blurred",1,1,1,!0));L.append_edge_attr(f,Ad,Oc,E("DEPTH","u_depth",1,1,1,!0));k=p;p=[]}if(a.xray){var cd=vc("XRAY");p.push(cd);k=p;p=[]}if(Pb&&!zb){var dd=k[0],ed=ca(Qb.mb_decay_threshold,Qb.mb_factor);p.push(ed);L.append_node_attr(f,ed);var rd=
E("COLOR","u_mb_tex_curr",1,1,1,!0);L.append_edge_attr(f,dd,ed,rd);var Bd=E("COLOR","u_mb_tex_accum",1,1,1,!0);ed.slinks_internal.push(Bd);k=p;p=[]}if(!zb&&a.outline){var Ya=k[0],md=u(bb);b.cameras.push(md);var xb=aa(md,za);L.append_node_attr(f,xb);var fd=M("X_EXTEND"),Pc=E("COLOR","u_color",1,1,1,!0),Cd=E("COLOR","u_outline_mask",1,1,1,!0);fd.is_for_outline=!0;L.append_node_attr(f,fd);L.append_edge_attr(f,xb,fd,Pc);var Uc=E("COLOR","u_color",1,.5,.5,!0);Uc.min_filter=Y.TF_LINEAR;Uc.mag_filter=Y.TF_LINEAR;
var Vc=M("Y_EXTEND");Vc.is_for_outline=!0;L.append_node_attr(f,Vc);L.append_edge_attr(f,fd,Vc,Uc);mc=M("X_BLUR");mc.is_for_outline=!0;L.append_node_attr(f,mc);L.append_edge_attr(f,Vc,mc,Uc);var Lc=E("COLOR","u_color",1,.25,.25,!0);Lc.min_filter=Y.TF_LINEAR;Lc.mag_filter=Y.TF_LINEAR;var nd=E("COLOR","u_outline_mask_blurred",1,.25,.25,!0);nd.min_filter=Y.TF_LINEAR;nd.mag_filter=Y.TF_LINEAR;ac=M("Y_BLUR");ac.is_for_outline=!0;L.append_node_attr(f,ac);L.append_edge_attr(f,mc,ac,Lc);var Wc=ia(ma);L.append_node_attr(f,
Wc);L.append_edge_attr(f,Ya,Wc,E("COLOR","u_outline_src",1,1,1,!0));L.append_edge_attr(f,xb,Wc,Cd);L.append_edge_attr(f,ac,Wc,nd);p.push(Wc);k=p;p=[]}if(Ac&&!zb){var Ya=k[0],gd=ba(Mc.brightness,Mc.contrast,Mc.exposure,Mc.saturation);L.append_node_attr(f,gd);L.append_edge_attr(f,Ya,gd,E("COLOR","u_color",1,1,1,!0));p.push(gd);k=p;p=[]}if(Ha){Ya=k[0];if(Ea.smaa){var Xc=E("COLOR","u_color",1,1,1,!0);Xc.min_filter=Y.TF_LINEAR;Xc.mag_filter=Y.TF_LINEAR;var hd=O("SMAA_EDGE_DETECTION",a);L.append_node_attr(f,
hd);L.append_edge_attr(f,Ya,hd,Xc);var Qc=O("SMAA_BLENDING_WEIGHT_CALCULATION",a);L.append_node_attr(f,Qc);L.append_edge_attr(f,hd,Qc,Xc);var od=E("COLOR","u_search_tex",1,1,1,!1),jd=E("COLOR","u_area_tex",1,1,1,!1);od.min_filter=Y.TF_LINEAR;od.mag_filter=Y.TF_LINEAR;jd.min_filter=Y.TF_LINEAR;jd.mag_filter=Y.TF_LINEAR;Qc.slinks_internal.push(od);Qc.slinks_internal.push(jd);var Yc=O("SMAA_NEIGHBORHOOD_BLENDING",a);L.append_node_attr(f,Yc);L.append_edge_attr(f,Ya,Yc,Xc);var Zc=E("COLOR","u_blend",1,
1,1,!0);Zc.min_filter=Y.TF_LINEAR;Zc.mag_filter=Y.TF_LINEAR;L.append_edge_attr(f,Qc,Yc,Zc);p.push(Yc)}else{var sd=X(a);L.append_node_attr(f,sd);var Ed=E("COLOR","u_color",1,1,1,!0);Ed.min_filter=Y.TF_LINEAR;Ed.mag_filter=Y.TF_LINEAR;L.append_edge_attr(f,Ya,sd,Ed);p.push(sd)}k=p;p=[]}p.push(k[0]);var Nd=L.node_by_attr(f,k[0]);if("MOTION_BLUR"==k[0].type||"RESOLVE"==k[0].type)var Fd=!0;else Fd=!1,L.traverse_inputs(f,Nd,function(a,b,c){if(c.from==c.to)return Fd=!0});if(Fd){var Gd=M("NONE");L.append_node_attr(f,
Gd);L.append_edge_attr(f,k[0],Gd,E("COLOR","u_color",1,1,1,!0));k=p;p=[];p.push(Gd)}Bb&&(pc?p.push(pc):p.push(Bb));Db&&p.push(Db);if(!zb&&a.sky_params.procedural_skydome){var Id=fa(za,a.sky_params);L.append_node_attr(f,Id);p.push(Id)}var $c=sa();L.append_node_attr(f,$c);for(Ra=0;Ra<p.length;Ra++){var td=p[Ra];switch(td.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":L.append_edge_attr(f,td,$c,E("COLOR","NONE",1,1,1,!0));L.append_edge_attr(f,td,$c,E("DEPTH","NONE",1,1,1,!0));break;case "SKY":var Od=
E("CUBEMAP","u_sky",ea.cubemap_tex_size,1,1,!1);L.append_edge_attr(f,td,$c,Od);break;case "ANCHOR_VISIBILITY":var Pd=E("COLOR","NONE",1,1,1,!0);L.append_edge_attr(f,td,$c,Pd);break;default:if(zb){var Jd=g[0]._render,ud=E("COLOR","OFFSCREEN",1,1,1,!0);ud.texture=Jd;L.append_edge_attr(f,p[Ra],$c,ud);for(Za=1;Za<g.length;Za++){var Kd=g[Za]._render,Hd=M("NONE");L.append_node_attr(f,Hd);var Qd=E("COLOR","SCALE",1,1,1,!0);L.append_edge_attr(f,p[Ra],Hd,Qd);var Ld=Kd.source_size/Jd.source_size,ud=E("COLOR",
"OFFSCREEN",1,Ld,Ld,!0);ud.texture=Kd;L.append_edge_attr(f,Hd,$c,ud)}}else L.append_edge_attr(f,p[Ra],$c,E("SCREEN","NONE",1,1,1,!0))}}ub&&!Z(f,ub).length&&(L.remove_node(f,L.node_by_attr(f,ub)),L.cleanup_loose_edges(f));c(f,Sc);!a.anaglyph_use&&!a.hmd_stereo_use||zb||F(f,a,b);if(xa.enabled){var Md=l(f);Md&&t(f,Md)}h(f);m(f);Ja&&L.traverse(f,function(a,b){if("SHADOW_RECEIVE"==b.type||"MAIN_BLEND"==b.type||"MAIN_XRAY"==b.type){for(var c=0,e=V(f,b),d=0,g=0;g<e.length;g++){var h=e[g];"SHADOW_CAST"==
h.type&&(d++,b.p_light_matrix=b.p_light_matrix||[],b.p_light_matrix[0<h.shadow_lamp_index?h.shadow_lamp_index:c]=h.camera.proj_matrix,c++)}b.v_light_ts&&b.v_light_r||(Ea.mac_os_shadow_hack?b.v_light_tsr=new Float32Array(9*d):(b.v_light_ts=new Float32Array(4*d),b.v_light_r=new Float32Array(4*d)))}});return f};a.multiply_size_mult_by_graph=H;a.init_subs=y;a.set_texel_size=function(a,b,c){var e=a.texel_size_multiplier;a.texel_size[0]=b*a.texel_mask[0]*e;a.texel_size[1]=c*a.texel_mask[1]*e};a.set_texel_size_mult=
function(a,b){a.texel_size_multiplier=b};a.create_performance_graph=function(){var a=L.create(),b;b=y("PERFORMANCE");var c=U.create_camera(U.TYPE_NONE);c.width=1024;c.height=1024;b.camera=c;L.append_node_attr(a,b);c=sa();L.append_node_attr(a,c);L.append_edge_attr(a,b,c,E("COLOR","NONE",1024,1,1,!1));h(a);m(a);return a};a.find_on_screen=function(a){var b=null;L.traverse(a,function(a,c){return c.camera&&null===c.camera.framebuffer?(b=c,!0):!1});return b};a.find_input=function(a,b,c){a=V(a,b);for(b=
0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.has_lower_subs=T;a.has_upper_subs=Ha;a.get_inputs=V;a.get_outputs=Z;a.find_subs=function(a,b){var c=null;L.traverse(a,function(a,e){return e.type==b?(c=e,!0):!1});return c};a.debug_convert_to_dot=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=qa(a);L.traverse(a,function(a,e){var d=b+="    ",g="",g=e.type.replace(/_/g,
" ");"POSTPROCESSING"==e.type&&(g+=" ("+e.pp_effect.replace(/_/g," ")+")");if(e.camera){for(var g=g+"\\n",f=0;f<c.length;f+=2){var h=e.camera.color_attachment;c[f]==h&&(g=Y.is_renderbuffer(h)?g+("CR"+c[f+1]+" "):g+("C"+c[f+1]+" "))}for(f=0;f<c.length;f+=2)h=e.camera.depth_attachment,c[f]==h&&(g=Y.is_renderbuffer(h)?g+("DR"+c[f+1]):g+("D"+c[f+1]))}e.slinks_internal.length&&(g+="\\n-----\\n");for(f=0;f<e.slinks_internal.length;f++)g+=Aa(e.slinks_internal[f],a,null,c);f="SINK"==e.type?"dotted":e.enqueue?
"solid":"dashed";b=d+(String(a)+' [label="'+g+'" color="black" style="'+(f+",bold")+'"];\n')});L.traverse_edges(a,function(a,e,d){var g=b+="    ",f=Aa(d,a,e,c);b=g+(String(a)+" -> "+String(e)+' [label="'+f+'" style="'+(d.active?"solid":"dotted")+'"];\n')});return b+="}"};a.create_rendering_queue=function(a){a=L.topsort_attr(a);for(var b=[],c=0;c<a.length;c++){var e=a[c];e.enqueue&&b.push(e)}return b}};b4w.module.__textures=function(a,r){function u(){return{name:"",type:0,source:"",source_id:"",width:0,height:0,compress_ratio:1,allow_node_dds:!0,source_size:1024,enable_canvas_mipmapping:!1,canvas_context:null,w_target:0,w_texture:null,w_renderbuffer:null,is_movie:!1,vtex_data_id:-1,video_file:null,movie_length:0,fps:0,frame_start:0,frame_offset:0,frame_duration:0,need_resize:!1,scale_fac:1,seq_video:null,seq_movie_length:0,seq_fps:0,seq_cur_frame:-1,seq_video_played:!1,seq_last_discrete_mark:-1,
video_was_stopped:!1,use_auto_refresh:!1,use_cyclic:!1,use_nla:!1,repeat:!0}}function c(c,e,d,g){var f=c.type,h=new Uint8Array([204,204,204,255]),k=u();switch(f){case "DATA_TEX2D":case "IMAGE":var n=A.createTexture(),l=A.TEXTURE_2D;A.bindTexture(l,n);A.texImage2D(l,0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,h);c.image&&"MOVIE"==c.image.source&&(k.is_movie=!0,k.frame_start=c.frame_start,k.frame_offset=c.frame_offset,k.frame_duration=c.frame_duration,k.use_auto_refresh=c.use_auto_refresh,k.use_cyclic=c.use_cyclic,
k.movie_length=c.movie_length,k.use_nla=c.b4w_nla_video,0!=k.frame_offset&&N.warn('Frame offset for texture "'+c.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":n=A.createTexture();l=A.TEXTURE_2D;A.bindTexture(l,n);if("NONE"==c.b4w_source_type)return null;if("SCENE"==c.b4w_source_type)if(c.b4w_source_id&&(d=X.keysearch("name",c.b4w_source_id,d)))k.source_size=c.b4w_source_size,d._render_to_textures=d._render_to_textures||[],d._render_to_textures.push(c),
A.texImage2D(l,0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,h);else return null;break;case "ENVIRONMENT_MAP":n=A.createTexture();l=A.TEXTURE_CUBE_MAP;A.bindTexture(l,n);d="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var m=0;6>m;m++)A.texImage2D(A["TEXTURE_CUBE_MAP_"+d[m]],0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,h);break;case "BLEND":return null;case "NODE_TEX":n=A.createTexture();l=A.TEXTURE_2D;A.bindTexture(l,n);A.texImage2D(l,0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,h);
break;default:return N.error('texture "'+c.name+'" has unsupported type "'+f+'"'),null}"NONE"==f&&(!c.b4w_enable_canvas_mipmapping||"CANVAS"!=c.b4w_source_type)||"DATA_TEX2D"==f||"IMAGE"==f&&"MOVIE"==c.image.source||"NODE_TEX"==f?A.texParameteri(l,A.TEXTURE_MIN_FILTER,A.LINEAR):A.texParameteri(l,A.TEXTURE_MIN_FILTER,la[aa.texture_min_filter]);A.texParameteri(l,A.TEXTURE_MAG_FILTER,A.LINEAR);h=l;d=c.b4w_anisotropic_filtering;"DEFAULT"===d&&(d=e);"OFF"!==d&&aa.anisotropic_filtering&&(e=B.get_aniso())&&
(d=parseFloat(d.split("x")[0]),A.texParameterf(h,e.TEXTURE_MAX_ANISOTROPY_EXT,d));"REPEAT"!=c.extension||c.b4w_shore_dist_map?(k.repeat=!1,A.texParameteri(l,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(l,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE)):(A.texParameteri(l,A.TEXTURE_WRAP_S,A.REPEAT),A.texParameteri(l,A.TEXTURE_WRAP_T,A.REPEAT));k.type=a.TT_RGBA_INT;k.width=1;k.height=1;k.w_texture=n;k.w_target=l;"CANVAS"==c.b4w_source_type&&"NONE"==f?(f=c.b4w_source_id,n=c.b4w_source_size,k.enable_canvas_mipmapping=
c.b4w_enable_canvas_mipmapping,k.source_id=f,k.source="CANVAS",l=document.createElement("canvas"),l.width=n,l.height=n,k.canvas_context=l.getContext("2d"),g in ka||(ka[g]={}),ka[g][f]=k,b(k)):"SCENE"==c.b4w_source_type&&"NONE"==f?(k.source_id=c.b4w_source_id,k.source="SCENE"):(k.source=f,A.generateMipmap(l),A.bindTexture(l,null));k.name=c.name;return c._render=k}function b(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.w_target;A.bindTexture(b,a.w_texture);var c=l(a),e=t(a),d=F(a),g=a.canvas_context.canvas;
A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!0);A.texImage2D(b,0,e,c,d,g);A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!1);a.enable_canvas_mipmapping&&A.generateMipmap(b);A.bindTexture(b,null);a.width=g.width;a.height=g.height}function h(a){var b=a.w_target;A.bindTexture(b,a.w_texture);A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!0);4!=a.video_file.length?a.need_resize?k(a,a.video_file,a.width*a.scale_fac,a.height*a.scale_fac,!1):A.texImage2D(b,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,a.video_file):A.texImage2D(b,0,A.RGBA,1,1,0,A.RGBA,
A.UNSIGNED_BYTE,a.video_file);A.bindTexture(b,null)}function d(a){var b=a.w_target;A.bindTexture(b,a.w_texture);A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!0);a.need_resize?k(a,a.seq_video[a.seq_cur_frame],a.width*a.scale_fac,a.height*a.scale_fac,!1):A.texImage2D(b,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,a.seq_video[a.seq_cur_frame]);A.bindTexture(b,null)}function q(){da||(da=document.createElement("canvas"));return da}function k(a,b,c,e,d){d||(f(A.TEXTURE_2D),A.texImage2D(A.TEXTURE_2D,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,
b));A.bindTexture(A.TEXTURE_2D,null);O.draw_resized_texture(a,c,e,fa,ta,"NONE")}function p(a,b,c,e,d){for(a=0;6>a;a++){var g=d[a],f=q();f.width=e;f.height=e;var h=f.getContext("2d");"POSITIVE_Y"==g[0]||"NEGATIVE_Y"==g[0]?(h.translate(0,e),h.scale(1,-1)):(h.translate(e,0),h.scale(-1,1));h.drawImage(b,g[1]*c,g[2]*c,c,c,0,0,e,e);A.texImage2D(A["TEXTURE_CUBE_MAP_"+g[0]],0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,f)}}function f(a){fa||(fa=A.createFramebuffer());A.bindTexture(a,null);ta||(ta=A.createTexture());A.bindTexture(a,
ta);A.texParameteri(a,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE);A.texParameteri(a,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE);A.texParameteri(a,A.TEXTURE_MAG_FILTER,A.LINEAR);A.texParameteri(a,A.TEXTURE_MIN_FILTER,A.LINEAR)}function w(a,b,c,e,d){var h=a.source,n=a.w_texture,l=a.w_target,v=1,D=1;A.bindTexture(l,n);if(4==b.length){var t=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==h)if(t)A.texImage2D(l,0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){D=I.get_width_height(b);
t=X.check_npot(D.width)||X.check_npot(D.height);if(D.width>aa.max_texture_size||D.height>aa.max_texture_size){N.error('Texture "'+e+'" has unsupported size: '+D.width+"x"+D.height+". Max available: "+aa.max_texture_size+"x"+aa.max_texture_size+".");return}v=D.width;D=D.height;t&&(a.need_resize=!0,f(l),v=m(v*a.scale_fac),D=m(D*a.scale_fac));I.upload_dds_levels(A,B.get_s3tc(),b,!0);a.need_resize&&(k(a,null,v,D,!0),A.bindTexture(l,n),A.generateMipmap(l));a.width=v;a.height=D;a.compress_ratio=I.get_compress_ratio(b)}else{A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,
!0);a.is_movie?aa.seq_video_fallback?(v=b[0].width,D=b[0].height):(v=b.videoWidth,D=b.videoHeight):(v=b.width,D=b.height);a.width=v;a.height=D;if(v>aa.max_texture_size||v>aa.max_texture_size)N.warn('Texture "'+e+'" has unsupported size: '+v+"x"+D+". Max available: "+aa.max_texture_size+"x"+aa.max_texture_size+". Reduced image size will be used."),a.scale_fac=Math.min(aa.max_texture_size/v,aa.max_texture_size/D),a.need_resize=!0;a.is_movie&&(aa.seq_video_fallback?(d in W||(W[d]={}),W[d][a.name]=a,
a.seq_video=b,a.seq_movie_length=b.length,a.fps=a.seq_fps*a.movie_length/b.length,b=b[0]):(d in W||(W[d]={}),W[d][a.name]=a,a.video_file=b,a.video_file.loop=a.use_cyclic,a.fps=b.duration?a.movie_length/b.duration:J.get_framerate(),ia.disable_playback_rate_hack||(b.playbackRate=J.get_framerate()/a.fps,ia.clamp_playback_rate_hack&&2<b.playbackRate&&(b.playbackRate=2)),g(a)));v=m(a.width*a.scale_fac);D=m(a.height*a.scale_fac);a.need_resize?(e=q(),n=e.getContext("2d"),e.width=v,e.height=D,n.drawImage(b,
0,0,a.width,a.height,0,0,v,D),A.texImage2D(l,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,e)):X.check_npot(a.width)||X.check_npot(a.height)?(k(a,b,v,D,!1),a.need_resize=!0):A.texImage2D(l,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,b);n=a.w_texture;A.bindTexture(l,n);a.is_movie||A.generateMipmap(l);A.bindTexture(l,null);a.width=v;a.height=D}else if("ENVIRONMENT_MAP"==h)if(v=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],t){for(e=0;6>e;e++)A.texImage2D(A["TEXTURE_CUBE_MAP_"+
v[e][0]],0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!1);if(b.width%3||b.height%2){N.error('Cubemap texture "'+e+'" has unsupported size: '+b.width+"x"+b.height+". The width must be multiple of three and the height - multiple of two.");return}D=b.width/3;if(D>aa.max_cube_map_size)N.warn('Cubemap texture "'+e+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+3*aa.max_cube_map_size+"x"+2*aa.max_cube_map_size+". Reduced image size will be used."),
e=m(aa.max_cube_map_size/D*D),a.need_resize=!0;else if(e=m(D),3*e>aa.max_texture_size||2*e>aa.max_texture_size)a.need_resize=!0;if(a.need_resize||aa.resize_cubemap_canvas_hack)p(a,b,D,e,v);else{t=b;n=e;f(A.TEXTURE_2D);A.texImage2D(A.TEXTURE_2D,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,t);A.bindTexture(A.TEXTURE_2D,null);for(t=0;6>t;t++)A.texImage2D(A.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,A.RGBA,n,n,0,A.RGBA,A.UNSIGNED_BYTE,null);A.bindTexture(a.w_target,null);A.bindFramebuffer(A.FRAMEBUFFER,fa);for(t=0;6>t;t++)O.draw_resized_cubemap_texture(a,
A.TEXTURE_CUBE_MAP_POSITIVE_X+t,n,D,ta,t);A.bindFramebuffer(A.FRAMEBUFFER,null);A.bindTexture(a.w_target,a.w_texture);A.texParameteri(a.w_target,A.TEXTURE_MIN_FILTER,la[aa.texture_min_filter]);A.texParameteri(a.w_target,A.TEXTURE_MAG_FILTER,A.LINEAR)}K.check_ff_cubemap_out_of_memory()&&(N.warn("Firefox detected, setting max cubemap size to 256, use canvas for resizing."),p(a,b,D,P.NVIDIA_OLD_GPU_CUBEMAP_MAX_SIZE,v));a.width=3*e;a.height=2*e;A.generateMipmap(l)}else if("DATA_TEX2D"==h||"NODE_TEX"==
h)A.texImage2D(l,0,A.RGBA,b.width,b.height,0,A.RGBA,A.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height;A.bindTexture(l,null)}function g(a){a.video_file.oncanplay=function(){h(a)}}function m(a){return X.check_npot(a)?(a=Math.pow(2,parseInt(a).toString(2).length),X.clamp(a,2,aa.max_texture_size)):a}function l(b){switch(b.type){case a.TT_RGBA_INT:b=A.RGBA;break;case a.TT_RGB_INT:b=A.RGB;break;case a.TT_RGBA_FLOAT:b=A.RGBA;break;case a.TT_RGB_FLOAT:b=A.RGB;break;case a.TT_DEPTH:b=A.DEPTH_COMPONENT;
break;default:throw"Wrong texture type";}return b}function t(b){switch(b.type){case a.TT_RGBA_INT:b=aa.webgl2?A.RGBA8:A.RGBA;break;case a.TT_RGB_INT:b=aa.webgl2?A.RGB8:A.RGB;break;case a.TT_RGBA_FLOAT:b=aa.webgl2?A.RGBA8:A.RGBA;break;case a.TT_RGB_FLOAT:b=aa.webgl2?A.RGB8:A.RGB;break;case a.TT_DEPTH:b=aa.webgl2?A.DEPTH_COMPONENT24:A.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function F(b){switch(b.type){case a.TT_RGBA_INT:b=A.UNSIGNED_BYTE;break;case a.TT_RGB_INT:b=A.UNSIGNED_BYTE;
break;case a.TT_RGBA_FLOAT:b=A.FLOAT;break;case a.TT_RGB_FLOAT:b=A.FLOAT;break;case a.TT_DEPTH:b=A.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function H(a){return a&&a.name&&a.w_renderbuffer?!0:!1}function C(a,b,e){var d=null;switch(a){case "SSAO_TEXTURE":d={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};c(d,null,b,0);d.image={filepath:null};break;case "NODE_TEX":d={name:e,type:"NODE_TEX",extension:"CLIP",b4w_anisotropic_filtering:"OFF"},
c(d,null,b,0),d.image={filepath:null}}return d}function x(a,b){if(b in W&&a in W[b]){var c=W[b][a];c.video_file?c.video_file.play():c.seq_video&&(c.seq_video_played=!0);return!0}return!1}function y(a,b){if(b in W&&a in W[b]){var c=W[b][a];c.video_file?c.video_file.pause():c.seq_video&&(c.seq_video_played=!1);return!0}return!1}function z(a,b){if(b in W&&a in W[b]){var c=W[b][a];c.video_file?c.video_file.currentTime=c.frame_offset/c.fps:c.seq_video&&(c.seq_cur_frame=e(c,c.frame_offset),d(c));return!0}return!1}
function E(a){return a.video_file?!a.video_file.paused:a.seq_video?a.seq_video_played:!1}function e(a,b){return Math.round(b*a.seq_movie_length/a.movie_length)}function n(a,b){if(ba.is_dynamic(a))return M(a,b);for(var c=a.meta_objects,e=0;e<c.length;e++){var d=M(c[e],b);if(d)return d}return null}function M(a,b){for(var c=null,e=a.scenes_data,d=0;d<e.length;d++)for(var g=e[d].batches,f=0;f<g.length;f++)for(var h=g[f],k=0;k<h.textures.length;k++)if(h.textures[k].name==b){c=h.textures[k];break}return c}
function D(a,b,c){var e=a.elements;a=a.interpolation;for(var d=0;d<b;d++){var g=d/(b-1),f=G(e,g,!0),h=Q(e,g,!0);if(f&&h)if("CONSTANT"==a)c.push.apply(c,f.color);else{var k=c,n=f,l=h;if(n==l)k.push.apply(k,n.color);else{var m=ca.linear_interpolation(l.color[0],l.position,n.color[0],n.position,g);k.push(m);m=ca.linear_interpolation(l.color[1],l.position,n.color[1],n.position,g);k.push(m);m=ca.linear_interpolation(l.color[2],l.position,n.color[2],n.position,g);k.push(m);n=ca.linear_interpolation(l.color[3],
l.position,n.color[3],n.position,g);k.push(n)}}h&&!f&&c.push.apply(c,h.color);f&&!h&&c.push.apply(c,f.color)}}function G(a,b,c){for(var e=null,d=0;d<a.length;d++){var g=c?b-a[d].position:b-a[d][1][0];0<=g&&(e?g<=(c?b-e.position:b-a[d][1][0])&&(e=a[d]):e=a[d])}return e}function Q(a,b,c){for(var e=null,d=0;d<a.length;d++){var g=c?a[d].position-b:a[d][1][0]-b;0<=g&&(e?g<=(c?e.position-b:e[1][0]-b)&&(e=a[d]):e=a[d])}return e}function v(a,b){var c=a.texture,e=c._render,c=c.image;e&&b&&c&&w(e,b,c._is_dds,
c.filepath);return e}var P=r("__compat"),S=r("__config"),I=r("__dds"),K=r("__debug"),B=r("__extensions"),N=r("__print"),J=r("__time"),X=r("__util"),O=r("__renderer"),ba=r("__obj_util"),ca=r("__curve"),ga=r("__vec3"),aa=S.defaults,ia=S.sfx,da=null,ta=null,fa=null;a.TF_NEAREST=0;a.TF_LINEAR=0;a.TF_NEAREST_MIPMAP_NEAREST=0;a.TF_LINEAR_MIPMAP_NEAREST=0;a.TF_NEAREST_MIPMAP_LINEAR=0;a.TF_LINEAR_MIPMAP_LINEAR=0;a.TT_RGBA_INT=10;a.TT_RGB_INT=20;a.TT_RGBA_FLOAT=30;a.TT_RGB_FLOAT=40;a.TT_DEPTH=50;a.TT_RB_RGBA=
60;a.TT_RB_DEPTH=70;a.TT_RB_RGBA_MS=80;a.TT_RB_DEPTH_MS=90;a.CURVE_NODES_TEXT_SIZE=128;a.COLORRAMP_TEXT_SIZE=128;a.PART_COLORRAMP_TEXT_SIZE=128;var ka={},W={},A=null,la;a.setup_context=function(b){la=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.TF_NEAREST=b.NEAREST;a.TF_LINEAR=b.LINEAR;a.TF_NEAREST_MIPMAP_NEAREST=b.NEAREST_MIPMAP_NEAREST;a.TF_LINEAR_MIPMAP_NEAREST=b.LINEAR_MIPMAP_NEAREST;a.TF_NEAREST_MIPMAP_LINEAR=b.NEAREST_MIPMAP_LINEAR;a.TF_LINEAR_MIPMAP_LINEAR=
b.LINEAR_MIPMAP_LINEAR;A=b};a.get_canvas_context=function(a,b){return b in ka&&a in ka[b]?ka[b][a].canvas_context:null};a.update_canvas_context=function(a,c){return c in ka&&a in ka[c]?(b(ka[c][a]),!0):!1};a.create_texture=function(b,c){var e=u();e.name=b;e.type=c;e.source="NONE";if(c==a.TT_RB_RGBA||c==a.TT_RB_DEPTH||c==a.TT_RB_RGBA_MS||c==a.TT_RB_DEPTH_MS)e.w_renderbuffer=A.createRenderbuffer();else{var d=A.TEXTURE_2D,g=A.createTexture();A.bindTexture(d,g);A.texParameteri(d,A.TEXTURE_MAG_FILTER,
A.LINEAR);A.texParameteri(d,A.TEXTURE_MIN_FILTER,A.LINEAR);A.texParameteri(d,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE);A.texParameteri(d,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE);A.bindTexture(d,null);e.w_target=d;e.w_texture=g}return e};a.create_cubemap_texture=function(b,c){var e=A.createTexture(),d=A.TEXTURE_CUBE_MAP;A.bindTexture(d,e);A.texParameteri(d,A.TEXTURE_MAG_FILTER,A.LINEAR);A.texParameteri(d,A.TEXTURE_MIN_FILTER,A.LINEAR);A.texParameteri(d,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE);A.texParameteri(d,A.TEXTURE_WRAP_T,
A.CLAMP_TO_EDGE);for(var g="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),f=0;6>f;f++)A.texImage2D(A[g[f]],0,A.RGBA,c,c,0,A.RGBA,A.UNSIGNED_BYTE,null);A.bindTexture(d,null);d=u();d.name=b;d.type=a.TT_RGBA_INT;d.source="NONE";d.width=3*c;d.height=2*c;d.compress_ratio=1;d.w_texture=e;d.w_target=A.TEXTURE_CUBE_MAP;return d};a.set_filters=function(a,b,c){if(!H(a)){var e=
a.w_target;A.bindTexture(e,a.w_texture);b&&A.texParameteri(e,A.TEXTURE_MIN_FILTER,b);c&&A.texParameteri(e,A.TEXTURE_MAG_FILTER,c);A.bindTexture(e,null)}};a.get_filters=function(b){if(H(b))return{min:a.TF_NEAREST,mag:a.TF_NEAREST};var c=b.w_target;A.bindTexture(c,b.w_texture);b=A.getTexParameter(c,A.TEXTURE_MIN_FILTER);var e=A.getTexParameter(c,A.TEXTURE_MAG_FILTER);A.bindTexture(c,null);return{min:b,mag:e}};a.resize=function(b,c,e){c=Math.max(c,aa.edge_min_tex_size_hack?2:1);e=Math.max(e,aa.edge_min_tex_size_hack?
2:1);if(b.width!=c||b.height!=e){switch(b.type){case a.TT_RB_RGBA:A.bindRenderbuffer(A.RENDERBUFFER,b.w_renderbuffer);A.renderbufferStorage(A.RENDERBUFFER,A.RGB565,c,e);A.bindRenderbuffer(A.RENDERBUFFER,null);break;case a.TT_RB_DEPTH:A.bindRenderbuffer(A.RENDERBUFFER,b.w_renderbuffer);A.renderbufferStorage(A.RENDERBUFFER,A.DEPTH_COMPONENT16,c,e);A.bindRenderbuffer(A.RENDERBUFFER,null);break;case a.TT_RB_RGBA_MS:A.bindRenderbuffer(A.RENDERBUFFER,b.w_renderbuffer);A.renderbufferStorageMultisample(A.RENDERBUFFER,
aa.msaa_samples,A.RGBA8,c,e);A.bindRenderbuffer(A.RENDERBUFFER,null);break;case a.TT_RB_DEPTH_MS:A.bindRenderbuffer(A.RENDERBUFFER,b.w_renderbuffer);A.renderbufferStorageMultisample(A.RENDERBUFFER,aa.msaa_samples,A.DEPTH_COMPONENT24,c,e);A.bindRenderbuffer(A.RENDERBUFFER,null);break;default:var d=b.w_target;A.bindTexture(d,b.w_texture);var g=l(b),f=t(b),h=F(b);A.texImage2D(d,0,f,c,e,0,g,h,null);A.bindTexture(d,null)}c>aa.max_texture_size||e>aa.max_texture_size?N.error('Slink texture "'+b.name+'" has unsupported size: '+
c+"x"+e+". Max available: "+aa.max_texture_size+"x"+aa.max_texture_size+"."):(b.width=c,b.height=e)}};a.create_texture_bpy=c;a.update_video_texture=h;a.update_seq_video_texture=d;a.update_texture=w;a.delete_texture=function(a){A.deleteTexture(a)};a.is_texture=function(a){return a&&a.name&&(a.w_texture||a.w_renderbuffer)?!0:!1};a.is_renderbuffer=H;a.is_float=function(b){return b.type==a.TT_RGBA_FLOAT||b.type==a.TT_RGB_FLOAT?!0:!1};a.get_texture_texel_size=function(b){var c=0;switch(b.type){case a.TT_RGBA_INT:case a.TT_RGB_INT:c=
4;break;case a.TT_RGBA_FLOAT:case a.TT_RGB_FLOAT:c=16;break;case a.TT_DEPTH:c=3;break;case a.TT_RB_RGBA:case a.TT_RB_DEPTH:c=2;break;case a.TT_RB_RGBA_MS:c=4*aa.msaa_samples;break;case a.TT_RB_DEPTH_MS:c=3*aa.msaa_samples}return c};a.generate_texture=C;a.cleanup=function(){if(!aa.seq_video_fallback)for(var a in W)for(var b in W[a])W[a][b].video_file.pause(),W[a][b].video_file.src="",W[a][b].video_file.load();ka={};W={}};a.pause=function(){for(var a in W)for(var b in W[a]){var c=W[a][b];E(c)&&(y(b,
a),c.video_was_stopped=!0)}};a.reset=function(){for(var a in W)for(var b in W[a])z(b,a),W[a][b].video_was_stopped=!1};a.play=function(a){for(var b in W)for(var c in W[b]){var e=W[b][c];if(!a||e.video_was_stopped)x(c,b),e.video_was_stopped=!1}};a.video_allow_nla=function(a,b){return b in W&&a in W[b]?W[b][a].use_nla:!1};a.play_video=x;a.pause_video=y;a.reset_video=z;a.set_frame_video=function(a,b,c){return c in W&&a in W[c]?(a=W[c][a],a.video_file?a.video_file.currentTime=b/a.fps:a.seq_video&&(a.seq_cur_frame=
b,d(a)),!0):!1};a.video_is_played=E;a.video_update_is_available=function(a){return a.video_file||a.seq_video?a.video_file?2<=a.video_file.readyState:!0:0};a.video_get_current_frame=function(a){return a.video_file||a.seq_video?a.video_file?Math.round(a.video_file.currentTime*a.fps):a.seq_cur_frame:0};a.video_get_start_frame=function(a){return a.video_file||a.seq_video?a.video_file?a.frame_offset:e(a,a.frame_offset):0};a.video_get_end_frame=function(a){if(!a.video_file&&!a.seq_video)return 0;var b=
Math.min(a.frame_duration,a.movie_length-a.frame_offset);return a.video_file?a.frame_offset+b:e(a,a.frame_offset+b)};a.seq_video_get_discrete_timemark=function(a,b){return Math.round(b*a.seq_fps*(J.get_framerate()/a.fps))};a.video_get_duration=function(a){return Math.min(a.frame_duration,a.movie_length-a.frame_offset)};a.video_frame_to_seq_frame=e;a.get_canvas_context_by_object=function(a,b){var c=n(a,b);return c&&"CANVAS"==c.source?c.canvas_context:null};a.update_canvas_context_by_object=function(a,
c){var e=n(a,c);return e&&"CANVAS"==e.source?(b(e),!0):!1};a.share_batch_canvas_textures=function(a){for(var c={},e=0;e<a.length;e++){for(var d=a[e].textures,g=[],f=0;f<d.length;f++){var h=d[f];if("CANVAS"==h.source)if(h.name in c)h=c[h.name];else{var k=d[f],h=u();h.name=k.name;h.source="CANVAS";h.width=k.width;h.height=k.height;h.enable_canvas_mipmapping=k.enable_canvas_mipmapping;h.type=k.type;k=document.createElement("canvas");k.width=h.width;k.height=h.height;h.canvas_context=k.getContext("2d");
h.w_target=A.TEXTURE_2D;h.w_texture=A.createTexture();A.bindTexture(A.TEXTURE_2D,h.w_texture);h.enable_canvas_mipmapping?A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,la[aa.texture_min_filter]):A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR);A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR);A.bindTexture(A.TEXTURE_2D,null);k=h;k.canvas_context.drawImage(d[f].canvas_context.canvas,0,0);b(k);c[h.name]=h}g.push(h)}a[e].textures=g}};a.create_color_ramp_texture=function(a,b){for(var c=
[],e=0;e<a.length;e++)D(a[e].data.value.color_ramp,b,c);return new Uint8Array(c.map(function(a){return X.clamp(255*a,0,255)}))};a.calc_color_ramp_data=D;a.create_vec_curve_texture=function(a,b){for(var c=new Float32Array(3),e=new Float32Array(3),d=[],g=0;g<a.length;g++){for(var f=a[g].data.value,h=[],k=f.curve_mapping.curves_data,n=f.curve_mapping.curve_extend,l=f.curve_mapping.curves_handle_types,f=0;f<k.length;f++){for(var m=n[f],p=k[f],q=[],v=l[f],D=0;D<p.length;D++)q.push([new Float32Array(3),
new Float32Array(p[D].concat(0)),new Float32Array(3)]);ca.calchandle_curvemap(q[0],null,q[1],v[0],v[0]);for(D=1;D<q.length-1;D++)ca.calchandle_curvemap(q[D],q[D-1],q[D+1],v[D],v[D]);ca.calchandle_curvemap(q[q.length-1],q[q.length-2],null,v[q.length-1],v[q.length-1]);if(2<q.length){if("AUTO"==v[0]){ga.subtract(q[0][2],q[0][1],c);D=ga.length(c);ga.copy(q[1][0],e);e[0]<q[0][1][0]&&(e[0]=q[0][1][0]);ga.subtract(e,q[0][1],e);var t=ga.length(e);1E-8<t&&(ga.scale(e,D/t,e),ga.add(q[0][1],e,q[0][2]),ga.subtract(q[0][1],
e,q[0][0]))}p=q.length-1;"AUTO"==v[0]&&(ga.subtract(q[p][0],q[p][1],c),D=ga.length(c),ga.copy(q[p-1][2],e),e[0]>q[p][1][0]&&(e[0]=q[p][1][0]),ga.subtract(e,q[p][1],e),t=ga.length(e),1E-8<t&&(ga.scale(e,D/t,e),ga.add(q[p][1],e,q[p][0]),ga.subtract(q[p][1],e,q[p][2])))}for(p=0;p<q.length-1;p++)ca.correct_bezpart(q[p][1],q[p][2],q[p+1][0],q[p+1][1]);p=[];3>=k.length?(D=Math.round(-b/2),v=Math.round(b/2)):(D=0,v=b);for(;D<v;D++){var t=D/(v-1),w=G(q,t,!1),B=Q(q,t,!1);w&&B?p.push(ca.bezier(t,w[1],w[2],
B[0],B[1],.001)):B&&!w?"EXTRAPOLATED"==m?p.push(ca.linear(t,B[1],B[2])):p.push(B[1][1]):w&&!B&&("EXTRAPOLATED"==m?p.push(ca.linear(t,w[0],w[1])):p.push(w[1][1]))}h.push(p)}d.push(h)}c=[];for(D=0;D<d.length;D++)for(h=d[D],f=0;f<h[0].length;f++)3>=h.length?(e=X.clamp(127.5*(h[0][f]+1),0,255),g=X.clamp(127.5*(h[1][f]+1),0,255),k=X.clamp(127.5*(h[2][f]+1),0,255),p=255):(e=X.clamp(255*h[0][f],0,255),g=X.clamp(255*h[1][f],0,255),k=X.clamp(255*h[2][f],0,255),p=X.clamp(255*h[3][f],0,255)),c.push(e,g,k,p);
return new Uint8Array(c)};a.change_image=function(a,b,c){return(a=n(a,b))?(w(a,c,!1,c.src,0),!0):!1};a.get_batch_texture=v;a.generate_batch_texure=function(a,b){var c={texture:C("NODE_TEX",null)};return v(c,{width:b,height:a.length/(4*b),data:a})}};b4w.module.__assets=function(a,r){function u(){return t.is_built_in_data()?r(t.paths.built_in_data_module).data:null}function c(){var a={_source_url:null,_parse_response:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,e=new Int8Array(c),d=0;d<c;d++)e[d]=b.charCodeAt(d);return e.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},
open:function(b,c,e){a._source_url=c;a.readyState=1},send:function(){a.status=404;a.readyState=4;var b=u();b&&a._source_url in b&&(a.status=200,b[a._source_url]&&(a.response=a._parse_response(b[a._source_url])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function b(b){for(var c=0,e=0;e<b.length;e++){var g=b[e];20===g.state&&c++;if(c>=E.max_requests)break;if(10===g.state)switch(g.state=20,c++,g.type){case a.AT_ARRAYBUFFER:h(g,"arraybuffer");break;
case a.AT_JSON:h(g,"json");break;case a.AT_TEXT:h(g,"text");break;case a.AT_AUDIOBUFFER:d(g);break;case a.AT_IMAGE_ELEMENT:q(g);break;case a.AT_AUDIO_ELEMENT:k(g);break;case a.AT_VIDEO_ELEMENT:p(g);break;case a.AT_SEQ_VIDEO_ELEMENT:f(g);break;default:x.panic("Wrong asset type: "+g.type)}}}function h(b,e){var d=u(),g=d&&b.url in d?new c:new XMLHttpRequest,d=null;if("GET"==b.request)g.open("GET",b.url,!0);else if("POST"==b.request)switch(g.open("POST",b.url,!0),b.post_type){case a.APT_TEXT:d="text/plain";
break;case a.APT_JSON:d="application/json"}if(b.overwrite_header)for(var f in b.overwrite_header)"Content-Type"==f?d=b.overwrite_header[f]:g.setRequestHeader(f,b.overwrite_header[f]);d&&g.setRequestHeader("Content-Type",d);"text"==e?(g.overrideMimeType("text/plain"),g.responseType="text"):"json"==e?(g.overrideMimeType("application/json"),g.responseType="text"):g.responseType=e;g.onreadystatechange=function(){if(40!=b.state&&4==g.readyState){if(200==g.status||0==g.status){var a=g.response;if(a){if("json"==
e&&"string"==typeof a)try{a=JSON.parse(a,b.json_reviver)}catch(c){H.error(c+" (parsing JSON "+b.url+")");b.asset_cb(null,b.id,b.type,b.url,b.param);return}b.asset_cb(a,b.id,b.type,b.url,b.param)}else H.error("empty responce when trying to get "+b.url),b.asset_cb(null,b.id,b.type,b.url,b.param)}else H.error(g.status+" when trying to get "+b.url),b.asset_cb(null,b.id,b.type,b.url,b.param);b.state=30}};g.addEventListener("progress",function(a){a.lengthComputable&&b.progress_cb(a.loaded/a.total)},!1);
g.send(b.post_data)}function d(a){"GET"!=a.request&&x.panic("Unsupported request type for audio buffer");var b=u(),e=b&&a.url in b?new c:new XMLHttpRequest;e.open("GET",a.url,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?C.decode_audio_data(b,function(b){a.asset_cb(b,a.id,a.type,a.url,a.param);a.state=30},function(){a.asset_cb(null,a.id,a.type,a.url,a.param);H.error("failed to decode "+a.url);a.state=
30}):(a.asset_cb(null,a.id,a.type,a.url,a.param),H.error("empty responce when trying to get "+a.url),a.state=30)}else a.asset_cb(null,a.id,a.type,a.url,a.param),H.error(e.status+" when trying to get "+a.url),a.state=30};e.send(a.post_data)}function q(a){"GET"!=a.request&&x.panic("Unsupported request type for image element");var b=document.createElement("img");z.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.asset_cb(b,a.id,a.type,a.url,a.param),a.state=30)};b.addEventListener("error",
function(){40!=a.state&&(a.asset_cb(null,a.id,a.type,a.url,a.param),H.error("could not load image: "+a.url),a.state=30)},!1);var c=u();if(c&&a.url in c)if(c[a.url]){var e=g(a.url);b.src="data:"+e+";base64,"+c[a.url]}else F.is_ie11()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.url}function k(a){"GET"!=a.request&&x.panic("Unsupported request type for audio element");var b=document.createElement("audio");z.allow_cors&&
(b.crossOrigin="Anonymous");b.addEventListener("loadeddata",function(){40!=a.state&&(a.asset_cb(b,a.id,a.type,a.url,a.param),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.asset_cb(null,a.id,a.type,a.url,a.param),H.error("could not load sound: "+a.url),a.state=30)},!1);b.addEventListener("stalled",function(){40!=a.state&&(a.asset_cb(null,a.id,a.type,a.url,a.param),H.error("could not load sound: "+a.url),a.state=30)},!1);var c=u();if(c&&a.url in c)if(c[a.url]){var e=m(a.url);
b.src="data:"+e+";base64,"+c[a.url];40!=a.state&&(a.asset_cb(b,a.id,a.type,a.url,a.param),a.state=30)}else F.is_ie11()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.url,z.is_mobile_device&&b.load();z.mobile_firefox_media_hack&&(b.autoplay=!0,b.pause());setTimeout(function(){b.some_prop_to_prevent_gc=1},5E3)}function p(a){function b(c){40!=a.state&&(a.asset_cb(null,a.id,a.type,a.url),H.error("could not load video: "+
a.url,a.param),a.state=30)}"GET"!=a.request&&x.panic("Unsupported request type for video element");var c=document.createElement("video");c.muted=!0;if(z.allow_cors||z.is_mobile_device)c.crossOrigin="Anonymous";c.addEventListener("loadeddata",function(){c.removeEventListener("error",b,!1);40!=a.state&&(a.asset_cb(c,a.id,a.type,a.url,a.param),a.state=30)},!1);c.addEventListener("error",b,!1);var e=u();if(e&&a.url in e)if(e[a.url]){var d=l(a.url);c.src="data:"+d+";base64,"+e[a.url];40!=a.state&&c.addEventListener("loadeddata",
function(){a.asset_cb(c,a.id,a.type,a.url,a.param);a.state=30},!1)}else F.is_ie11()?(e=document.createEvent("CustomEvent"),e.initCustomEvent("error",!1,!1,null)):e=new CustomEvent("error"),c.dispatchEvent(e);else c.src=a.url,z.is_mobile_device&&c.load();z.mobile_firefox_media_hack&&(c.autoplay=!0,c.pause());setTimeout(function(){c.some_prop_to_prevent_gc=1},1E4)}function f(b){function e(a){b.asset_cb(a,b.id,b.type,b.url,b.param);b.state=30}"GET"!=b.request&&x.panic("Unsupported request type for seq video element");
var d=u(),g=d&&b.url in d?new c:new XMLHttpRequest;if(null==b.post_type&&null==b.post_data)g.open("GET",b.url,!0);else switch(g.open("POST",b.url,!0),b.post_type){case a.APT_TEXT:g.setRequestHeader("Content-type","text/plain");break;case a.APT_JSON:g.setRequestHeader("Content-type","application/json")}g.responseType="arraybuffer";g.onreadystatechange=function(){if(40!=b.state&&4==g.readyState)if(200==g.status||0==g.status){var a=g.response;a?w(a,e):(b.asset_cb(null,b.id,b.type,b.url,b.param),H.error("empty responce when trying to get "+
b.url),b.state=30)}else b.asset_cb(null,b.id,b.type,b.url,b.param),H.error(g.status+" when trying to get "+b.url),b.state=30};g.addEventListener("progress",function(a){a.lengthComputable&&b.progress_cb(a.loaded/a.total)},!1);g.send(b.post_data)}function w(a,b){for(var c=new Int32Array(a),e=new Int8Array(a),d=c[3],g={images:[],blobs:[],fps:c[4]},f=20,h=0;h<d;h++){var k=c[f/4],n=e.subarray(f+4,f+4+k),n=new Blob([n],{type:"image/jpg"}),l=document.createElement("img");l.src=window.URL.createObjectURL(n);
g.images.push(l);g.blobs.push(n);f+=k+8-k%4}l.onload=function(){for(var a=0;a<g.images.length;a++)window.URL.revokeObjectURL(g.images[a].src);delete g.blobs;b(g)}}function g(a){var b="image";switch(x.get_file_extension(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function m(a){var b="audio";switch(x.get_file_extension(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}
function l(a){var b="video";switch(x.get_file_extension(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var t=r("__config"),F=r("__compat"),H=r("__print"),C=r("__sfx"),x=r("__util"),y=r("__version"),z=t.defaults,E=t.assets;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.AT_VIDEO_ELEMENT=70;a.AT_SEQ_VIDEO_ELEMENT=80;a.APT_JSON=a.AT_JSON;a.APT_TEXT=a.AT_TEXT;var e=[],n=0,M={};a.split_extension=
function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.get_text_sync=function(a){if(M[a])return M[a];var b=E.prevent_caching?a+y.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return M[a]=b;x.panic("Error XHR: responce is empty, GET "+a)}else x.panic("Error XHR: "+c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<e.length;a++)e[a].state=
40;e=[];n=0;M={}};a.enqueue=function(a,c,d,g,f){for(var h=0;h<a.length;h++){var k=a[h],k={id:k.id,type:k.type,url:k.url,request:k.request?k.request:"GET",post_type:k.post_type?k.post_type:null,overwrite_header:k.overwrite_header?k.overwrite_header:null,post_data:k.post_data?k.post_data:null,param:k.param?k.param:null,state:10,asset_cb:c||function(){},pack_cb:d||function(){},progress_cb:g||function(){},json_reviver:f||null,pack_index:n};if(E.prevent_caching){var l=u();l&&k.url in l||(k.url+=y.timestamp())}e.push(k)}b(e);
n++};a.update=function(){b(e);for(var a=e,c=0,d=!0,g=0;g<a.length;g++){var f=a[g];f.pack_index===a[c].pack_index?30!==f.state&&(d=!1):(d&&(a[g-1].pack_cb(),d=g-c,a.splice(c,d),g-=d),c=g,d=30===a[g].state?!0:!1);g===a.length-1&&d&&(a[g].pack_cb(),a.splice(c))}}};b4w.module.__loader=function(a,r){function u(b,d,g,e){var f=x,h=F.create(),k;for(k in d){var l=c(d[k]);(e&&l.is_resource||!b&&l.primary_only)&&m(l);F.append_node_attr(h,l)}for(k in d)for(l=d[k],l.name=k,b=0;b<l.inputs.length;b++)F.append_edge_attr(h,d[l.inputs[b]],l,null);d=c({name:"out",priority:a.FINISH_PRIORITY,cb_before:function(a,b,c,e,d,g){b.is_primary&&(f.start_secondary_threads=!0);t(b)||(b.status=2);b.loaded_cb(b.id,!0);d(b,c);H.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},relative_size:5});
if(g)g=F.get_sink_nodes(h);else{k=F.clone(h);do{g=F.get_sink_nodes(k);l=[];for(b=0;b<g.length;b++){e=g[b];var p=F.get_node_attr(k,e);p.background_loading&&l.push(e)}for(b=0;b<l.length;b++)F.remove_node(k,l[b]);l.length&&F.cleanup_loose_edges(k)}while(l.length)}F.append_node_attr(h,d);for(b=0;b<g.length;b++)e=g[b],p=F.get_node_attr(h,e),d.inputs.push(p.name),F.append_edge_attr(h,p,d,null);return h}function c(a){a.background_loading=a.background_loading||!1;a.priority||0===a.priority||(a.priority=a.SYNC_PRIORITY);
a.inputs=a.inputs||[];a.is_finished=a.is_finished||!1;a.skip=a.skip||!1;a.relative_size=a.relative_size||0;a.is_resource=a.is_resource||!1;a.primary_only=a.primary_only||!1;a.status=0;a.loop_index=0;a.load_rate=0;a.cb_param=a.cb_param||null;return a}function b(a,b,c){b.complete_load_cb(c,b);b.status=3;a.active_threads--;b.stageload_cb=null;b.complete_load_cb=null;b.stage_graph=null;b.stages_queue=null}function h(a,b){for(var c=[],e=[],d=0;d<b.length;d++){var g=b[d];F.get_node_attr(a.stage_graph,g).is_finished&&
(F.traverse_outputs(a.stage_graph,g,function(e,d,g){var f=!0;F.traverse_inputs(a.stage_graph,e,function(a,b,c){if(!b.is_finished)return f=!1,1});f&&-1==c.indexOf(e)&&-1==b.indexOf(e)&&c.push(e)}),e.push(d))}for(d=e.length-1;0<=d;d--)b.splice(e[d],1);return c}function d(a){var b=[],c=a.stages_queue,e=!1;do{var d=h(a,c);b.push.apply(b,c);0<d.length&&(e=!0);c=d}while(0<d.length);c=function(b,c){var e=F.get_node_attr(a.stage_graph,b),d=F.get_node_attr(a.stage_graph,c),g=d.priority-e.priority;0==g&&(g=
e.background_loading-d.background_loading);return g};e&&b.sort(c);a.stages_queue=b;return a.stages_queue.length}function q(a,b,c){if(b.skip)return b.is_finished=!0,p(a,b),!1;if(!b.cb_before&&!b.cb_loop&&!b.cb_after)return p(a,b),!1;if(0==b.status&&(b.status++,b.cb_before))return b.cb_before(c,a,b,b.cb_param,p,f),!0;if(1==b.status){if(b.cb_loop)return b.cb_loop(c,a,b,b.cb_param,p,f),!0;b.status++}return 2==b.status&&(b.status++,b.cb_after)?(b.cb_after(c,a,b,b.cb_param,p,f),!0):!1}function k(a){if(0==
a.stages_size_total)return 100;var b=0;F.traverse(a.stage_graph,function(c,e){a.do_not_load_resources&&e.is_resource||(b+=e.load_rate*e.relative_size)});return C.trunc(100*b/a.stages_size_total)}function p(a,b){b.is_finished=!0;b.status=3;w(a,b,1)}function f(a,b,c){1>c?w(a,b,c):b.status++}function w(a,b,c){var e=x;if(b.cb_before||b.cb_loop||b.cb_after)if(b.load_rate=c,b=k(a),a.curr_percents!=b||1==c)a.stageload_cb(b,performance.now()-a.time_load_start),a.curr_percents=b,e.make_idle_iteration=!0}function g(a,
b){var c=null;F.traverse(a.stage_graph,function(a,d){if(d.name==b)return c=d,1});return c}function m(a){a.skip=!0;a.load_rate=1}function l(){return 0==x.active_threads}function t(a){return a&&(3==a.status||4==a.status)}var F=r("__graph"),H=r("__print"),C=r("__util");a.SYNC_PRIORITY=0;a.ASYNC_PRIORITY=1;a.FINISH_PRIORITY=2;var x=null;a.get_scheduler=function(){return x};a.create_scheduler=function(){var a={threads:[],current_thread_index:0,active_threads:0,start_secondary_threads:!1,make_idle_iteration:!1};
return x=a};a.create_thread=function(a,b,c,e,d,g,f,h){var k=x,l=k.threads.length,m={id:l,is_primary:0==l,status:0,filepath:b,binary_name:"",loaded_cb:c||function(){},load_hidden:h||!1,wait_complete_loading:g,time_load_start:0,curr_percents:0,stages_size_total:0,reset_time_cycle:!1,stageload_cb:e||function(){},complete_load_cb:d||function(){},stage_graph:null,stages_queue:null,has_video_textures:!1,has_background_music:!1,init_wa_context:!1};a=u(m.is_primary,a,g,f);m.stage_graph=a;b=[];c=F.get_source_nodes(a);
for(e=0;e<c.length;e++)b.push(c[e]);m.stages_queue=b;F.traverse(a,function(a,b){if(b.cb_before||b.cb_loop||b.cb_after)m.do_not_load_resources&&b.is_resource||(m.stages_size_total+=b.relative_size)});k.threads.push(m);k.active_threads++;return m.id};a.update_scheduler=function(c){var g=x;if(g&&!l(g))if(g.make_idle_iteration)g.make_idle_iteration=!1;else{var f=performance.now();do{var e=g.threads[g.current_thread_index],h=c[e.id];if(!t(e))if(0==e.status&&(e.status=1,e.time_load_start=performance.now(),
e.stageload_cb(0,0)),d(e)){var k=e,m=k.stages_queue.length;do{var p=F.get_node_attr(k.stage_graph,k.stages_queue[0]),w=q(k,p,h);p.priority==a.ASYNC_PRIORITY&&(k.reset_time_cycle=!0);p=k.stages_queue.shift();k.stages_queue.push(p);m--}while(!w&&0!=m)}else b(g,e,h);g.start_secondary_threads&&(g.current_thread_index=(g.current_thread_index+1)%g.threads.length);if(e.reset_time_cycle){e.reset_time_cycle=!1;break}}while(16>performance.now()-f)}};a.abort_thread=function(a){var c=x;b(c,a,null);a.status=4;
a.is_primary&&(c.start_secondary_threads=!0);a.loaded_cb(a.id,!1)};a.stage_part_finish_cb=f;a.skip_stage_by_name=function(a,b){var c=g(a,b);null!==c&&m(c)};a.is_finished=l;a.thread_is_finished=t;a.is_primary_loaded=function(a){var b=x;if(!b)return!1;a|=0;return b.threads[a]&&(3==b.threads[a].status||2==b.threads[a].status)};a.graph_to_dot=function(a){H.error("Debug mode isn't enabled. Can not retrieve the graph.")};a.cleanup=function(){x=null}};b4w.module.__logic_nodes=function(a,r){function u(a,b,c){return a[0]?b[a[1]]:c[a[1]]}function c(a,b,c,e){a[0]?b[a[1]]=e:c[a[1]]=e}function b(a,b,c,e,d,g){switch(b.state){case 2:c.curr_node=a.slot_idx_order}}function h(a,b,c,e,d,f){switch(b.state){case 1:g.error("Unknown node type: "+a.type);break;case 2:c.curr_node=a.slot_idx_order}}function d(a){return f.get_object(f.GET_OBJECT_BY_DUPLI_NAME_LIST,a.dupli_name_list||[],0)}function q(a,b){var c=a.b4w_logic_nodes,e=b.logic_threads;b.state=1;for(var d=
0;d<c.length;d++){var g={nodes:[],thread_state:{scene:a,curr_node:0,in_progress:!1,thread_index:d,variables:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}}};e.push(g);for(var f=e[e.length-1],k=c[d],l=0;l<k.length;l++){var n=k[l],n={name:n.name,type:n.type,label:n.label,slot_idx_order:n.slot_idx_order,slot_idx_jump:n.slot_idx_jump,frame_start:n.frame_range[0],frame_end:n.frame_range[1],frame_start_mask:n.frame_range_mask?n.frame_range_mask[0]:!0,frame_end_mask:n.frame_range_mask?n.frame_range_mask[1]:!0,
state:-1,sel_objs_len:-1,sel_obj_idx:-1,param_name:n.param_name,op:n.operation,mute:n.mute,dupli_name_list:n.object,obj:null,objects:{},anim_name:n.anim_name,parse_json_vars:n.parse_json_vars,parse_json_paths:n.parse_json_paths,objects_paths:n.objects_paths,nodes_paths:n.nodes_paths,floats:n.floats,bools:n.bools,vars:n.variables,strings:n.strings,materials_names:n.materials_names,shader_nd_type:n.shader_nd_type,common_usage_names:n.common_usage_names,encode_json_vars:n.encode_json_vars,encode_json_paths:n.encode_json_paths,
thread:f,process_node:ba[n.type]?ba[n.type]:h,processed:!1,timer:0,tmp1:0,camera_state:null,sel_obj_idxs:null,links_dict:n.links,links_idxs:[]};f.nodes.push(n)}for(k=0;k<f.nodes.length;k++)n=f.nodes[k],n.process_node(n,b,g.thread_state,0,0)}var c=a.timeline_markers,m;for(m in c)b.sorted_markers_values.push(c[m]);b.sorted_markers_values.sort(function(a,b){return a-b});b.state=2;S.push(b)}function k(a,b){switch(b){case 0:return Boolean(Number(a))?Number(a):0;case 1:return String(a);default:return null}}
function p(a){switch(typeof a){case "string":return k(a,1);case "number":return k(a,0);default:return k(a,1)}}var f=r("__objects"),w=r("__scenes"),g=r("__print"),m=r("__nla"),l=r("__config"),t=r("__controls"),F=r("__util"),H=r("__animation"),C=r("__assets"),x=r("__batch"),y=r("__geometry"),z=r("__time"),E=r("__camera"),e=r("__vec3"),n=r("__physics"),M=r("__transform"),D=r("__sfx"),G=r("__mat3"),Q=r("__mat4"),v=r("__tsr"),P=r("__quat"),S=[],I={},K=new Float32Array(4);new Float32Array(4);var B=new Float32Array(3),
N=new Float32Array(3),J=new Float32Array(2),X=new Float32Array(9),O=new Float32Array(16);a.NT_NUMBER=0;a.NT_STRING=1;a.NC_GEQUAL=0;a.NC_LEQUAL=1;a.NC_GREATER=2;a.NC_LESS=3;a.NC_NOTEQUAL=4;a.NC_EQUAL=5;a.NCPT_OBJECT=0;a.NCPT_VARIABLE=1;var ba={ENTRYPOINT:function(a,b,c,e,d,g){switch(b.state){case 2:c.curr_node=a.slot_idx_order}},HIDE:function(a,b,c,e,g,f){switch(b.state){case 1:a.obj=d(a);break;case 2:w.change_visibility(a.obj,!0),c.curr_node=a.slot_idx_order}},SHOW:function(a,b,c,e,g,f){switch(b.state){case 1:a.obj=
d(a);break;case 2:w.change_visibility(a.obj,!1),c.curr_node=a.slot_idx_order}},PAGEPARAM:function(a,b,e,d,g,f){switch(b.state){case 2:d=a.vars.vd;b=b.variables;g=e.variables;a:{f=a.param_name;var h=a.floats.ptp,n=a.bools.hsh,m=l.get("url_params");if(m&&f in m)f=Number(m[f]);else{if(n=n?location.hash:location.search)for(n=n.slice(1).split("&"),m=0;m<n.length;m++){var p=n[m].split("=");if(1<p.length&&p[0]==f){f=k(p[1],h);break a}}f=0}}c(d,b,g,f);e.curr_node=a.slot_idx_order}},SWITCH_SELECT:function(a,
b,c,e,d,h){switch(b.state){case 1:a:{c=b.logic_threads[c.thread_index];e=f.get_selectable_objects();a.sel_obj_idxs=[];a.links_idxs=[];for(var k in a.objects_paths){var n=f.get_object(f.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths[k],0);d=e.indexOf(n);if(-1==d){g.error("logic script error: non-selectable object:",a.objects_paths[k][a.objects_paths[k].length-1]);break a}a.sel_obj_idxs.push(d);a.links_idxs.push(a.links_dict[k])}a.state=-1;a.sel_objs_len=e.length;k=[];for(d=0;d<e.length;d++)k.push(t.create_selection_sensor(e[d],
!0));e=ga();t.create_sensor_manifold(n,"LOGIC_NODES_SWITCH_SELECT_"+a.label,t.CT_SHOT,k,t.default_OR_logic_fun,e,[a,b,c])}break;case 2:if(-1==a.state){b=b.logic_threads[c.thread_index].nodes;for(n=0;n<b.length;n++)k=b[n],"SWITCH_SELECT"==k.type&&(k.state=-1);a.state=-2}-1<a.state&&(c.curr_node=a.state?a.slot_idx_jump:a.slot_idx_order,a.state=-1)}},SELECT:function(a,b,c,e,h,k){switch(b.state){case 1:c=b.logic_threads[c.thread_index];e=d(a);h=f.get_selectable_objects();k=h.indexOf(e);if(-1==k)g.error("logic script error: non-selectable object:",
a.dupli_name_list[a.dupli_name_list.length-1]);else{a.state=-1;a.sel_objs_len=h.length;a.sel_obj_idx=k;k=[];for(var n=0;n<h.length;n++)k.push(t.create_selection_sensor(h[n],!0));h=ca();t.create_sensor_manifold(e,"LOGIC_NODES_SELECT_"+a.label,t.CT_SHOT,k,t.default_OR_logic_fun,h,[a,b,c])}break;case 2:if(-1<a.state){c.curr_node=a.state?a.slot_idx_jump:a.slot_idx_order;a.state=-1;break}a.bools.not_wait&&(c.curr_node=a.slot_idx_order)}},PLAY:function(a,b,c,e,d,g){switch(b.state){case 1:m.stop_nla();a.state=
-1;a.bools.not_wait||(a.bools.not_wait=!1);break;case 2:switch(a.state){case -1:if(m.is_play(b._nla))if(b.curr_thread==b.nla_thread&&c.in_progress)break;else if(d=b.nla_thread)for(d.thread_state.curr_node=d.nodes[d.thread_state.curr_node].slot_idx_order,d.nodes[d.thread_state.curr_node].state=-1,d=b.nla_thread.nodes,g=0;g<d.length;g++){var f=d[g];"PLAY"==f.type&&(f.state=-1)}c.in_progress=!a.bools.not_wait;b.nla_thread=b.curr_thread;a.state=0;a.frame_start_mask&&(m.set_range_start(a.frame_start),
m.set_offset_from_range_start(e));if(a.frame_end_mask)m.set_range_end(a.frame_end);else{e=m.get_frame(e);d=-1;for(var h in b.sorted_markers_values)if(e<b.sorted_markers_values[h]){d=h;break}0<=d?m.set_range_end(b.sorted_markers_values[d]):m.set_range_end(m.get_frame_end())}m.play_nla(null);a.bools.not_wait&&(c.curr_node=a.slot_idx_order,a.state=-1,c.in_progress=!1);break;case 0:m.is_play()||(c.curr_node=a.slot_idx_order,a.state=-1,c.in_progress=!1);break;case 1:c.curr_node=a.slot_idx_order;a.state=
-1;b.nla_thread=null;c.in_progress=!1;break;default:F.panic("Unknown state of "+a.name),a.state=-1}}},REDIRECT:function(a,b,c,e,d,g){switch(b.state){case 2:a=a.bools.url?k(u(a.vars.url,b.variables,c.variables),1):a.strings.url,window.location.href=a,b.state=3}},MATH:function(a,b,e,d,g,f){switch(b.state){case 2:d=-1==a.vars.v1[1]?a.floats.inp1:k(u(a.vars.v1,b.variables,e.variables),0);g=-1==a.vars.v2[1]?a.floats.inp2:k(u(a.vars.v2,b.variables,e.variables),0);f=0;switch(a.op){case "ADD":f=d+g;break;
case "MUL":f=d*g;break;case "SUB":f=d-g;break;case "DIV":0==g&&F.panic("Division by zero in Logic script");f=d/g;break;case "RAND":f=Math.random()*(g-d)+d}c(a.vars.vd,b.variables,e.variables,f);e.curr_node=a.slot_idx_order}},CONDJUMP:function(a,b,c,e,d,g){switch(b.state){case 2:d=a.bools.str?1:0;g=a.bools.str?a.strings:a.floats;e=-1==a.vars.v1[1]?g.inp1:k(u(a.vars.v1,b.variables,c.variables),d);b=-1==a.vars.v2[1]?g.inp2:k(u(a.vars.v2,b.variables,c.variables),d);d=!1;switch(a.common_usage_names.condition){case 5:e==
b&&(d=!0);break;case 4:e!=b&&(d=!0);break;case 3:e<b&&(d=!0);break;case 2:e>b&&(d=!0);break;case 1:e<=b&&(d=!0);break;case 0:e>=b&&(d=!0)}c.curr_node=d?a.slot_idx_jump:a.slot_idx_order}},REGSTORE:function(a,b,e,d,g,f){switch(b.state){case 2:c([a.bools.gl||a.vars.vd[0],a.vars.vd[1]],b.variables,e.variables,(1==a.common_usage_names.variable_type?a.strings:a.floats).inp1),e.curr_node=a.slot_idx_order}},PLAY_ANIM:function(a,b,c,e,g,h){e=H.SLOT_ALL;""==!a.anim_name&&(e=H.SLOT_0);switch(b.state){case 1:a.obj=
a.bools.env?f.get_world_by_name(a.dupli_name_list[0],0):d(a);(c=a.common_usage_names.param_anim_behavior)||(c="FINISH_STOP");a.tmp1=H.anim_behavior_bpy_b4w(c);break;case 2:switch(H.is_play(a.obj,e)||0!=a.state||(a.state=1),a.state){case -1:for(var k in b.logic_threads)g=b.logic_threads[k].thread_state.curr_node,-1!=g&&(g=b.logic_threads[k].nodes[g],"PLAY_ANIM"==g.type&&g!=a&&0==g.state&&g.obj==a.obj&&(g.state=1));if(""==a.anim_name)H.apply_def(a.obj),H.set_behavior(a.obj,a.tmp1,e);else{a:{for(k=b=
0;8>k;k++)if((g=a.obj.anim_slots[k])&&g.animation_name&&g.animation_name==a.anim_name)if(0==b)b=1;else{b=!1;break a}b=1==b?!0:!1}b||(H.apply(a.obj,a.anim_name,e),H.set_behavior(a.obj,a.tmp1,e))}a.bools.not_wait||(c.in_progress=!0);H.play(a.obj,null,e);a.state=0;a.bools.not_wait&&(c.curr_node=a.slot_idx_order,a.state=-1);break;case 0:break;case 1:a.bools.not_wait||(c.in_progress=!1);c.curr_node=a.slot_idx_order;a.state=-1;break;default:F.panic("Unknown state of "+a.name),a.state=-1}}},SELECT_PLAY:b,
SEND_REQ:function(a,b,e,d,g,f){function h(a,d,g,f,k){a=JSON.stringify(a);c(k[0].vars.dst,b.variables,e.variables,a);k[0].state=1}switch(b.state){case 2:switch(a.state){case -1:a.state=0;d=a.bools.url?k(u(a.vars.url,b.variables,e.variables),1):a.strings.url;g={};a.bools.ct&&(g["Content-Type"]=a.strings.ct);"GET"==a.common_usage_names.request_type?C.enqueue([{id:d,type:C.AT_JSON,url:d,overwrite_header:g,param:[a,e.variables]}],h,null,null,null):"POST"==a.common_usage_names.request_type&&(f=k(u(a.vars.dst1,
b.variables,e.variables),1),C.enqueue([{id:d,type:C.AT_JSON,url:d,overwrite_header:g,request:"POST",post_type:C.AT_JSON,post_data:f,param:[a,e.variables]}],h,null,null,null));break;case 1:a.state=-1,e.curr_node=a.slot_idx_order}}},INHERIT_MAT:function(a,b,c,e,d,g){switch(b.state){case 1:for(b=0;2>b;b++)a.objects["id"+b]=f.get_object(f.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths["id"+b],0);break;case 2:x.inherit_material(a.objects.id0,a.materials_names.id0,a.objects.id1,a.materials_names.id1),c.curr_node=
a.slot_idx_order}},SET_SHADER_NODE_PARAM:function(a,b,c,e,d,g){switch(b.state){case 1:a.objects_paths.id0&&(a.objects.id0=f.get_object(f.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0),a.nodes_paths.id0.unshift(a.materials_names.id0));break;case 2:"ShaderNodeRGB"==a.shader_nd_type&&x.set_nodemat_rgb(a.objects.id0,a.nodes_paths.id0,a.bools.id0?k(u(a.vars.id0,b.variables,c.variables),0):a.floats.id0,a.bools.id1?k(u(a.vars.id1,b.variables,c.variables),0):a.floats.id1,a.bools.id2?k(u(a.vars.id2,
b.variables,c.variables),0):a.floats.id2),"ShaderNodeValue"==a.shader_nd_type&&x.set_nodemat_value(a.objects.id0,a.nodes_paths.id0,a.bools.id0?k(u(a.vars.id0,b.variables,c.variables),0):a.floats.id0),c.curr_node=a.slot_idx_order}},DELAY:function(a,b,c,e,d,g){switch(b.state){case 2:-1==a.state?(a.state=0,a.timer=0,c.in_progress=!0):0==a.state&&(a.timer+=d,(a.bools.dl?k(u(a.vars.dl,b.variables,c.variables),0):a.floats.dl)<a.timer&&(a.state=-1,c.curr_node=a.slot_idx_order,c.in_progress=!1))}},APPLY_SHAPE_KEY:function(a,
b,c,e,d,h){switch(b.state){case 1:b=a.objects.id0=f.get_object(f.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);c=a.common_usage_names.sk;y.check_shape_keys(b)?y.has_shape_key(b,c)||(g.error("Wrong key name:",c),a.mute=!0):(g.error("No shape keys in object:",b.name),a.mute=!0);break;case 2:y.apply_shape_key(a.objects.id0,a.common_usage_names.sk,a.bools.skv?k(u(a.vars.skv,b.variables,c.variables),0):a.floats.skv),c.curr_node=a.slot_idx_order}},OUTLINE:function(a,b,c,e,d,h){switch(b.state){case 1:e=
a.objects.id0=f.get_object(f.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);e&&e.render&&e.render.outlining||(g.error("Can't evaluate 'Outline' logic node: wrong object"),a.mute=!0);break;case 2:e=a.objects.id0;switch(a.common_usage_names.outline_operation){case "PLAY":b=e.render.outline_anim_settings_default;f.apply_outline_anim(e,b.outline_duration,b.outline_period,b.outline_relapses);break;case "STOP":f.clear_outline_anim(e);break;case "INTENSITY":e.render.outline_intensity=a.bools["in"]?
k(u(a.vars["in"],b.variables,c.variables),0):a.floats["in"]}c.curr_node=a.slot_idx_order}},MOVE_CAMERA:function(a,b,c,d,g,h){function l(a,b,c,d){switch(E.get_move_style(a)){case E.MS_TARGET_CONTROLS:E.set_trans_pivot(a,b,c);break;case E.MS_EYE_CONTROLS:case E.MS_STATIC:M.set_tsr(a,d);break;case E.MS_HOVER_CONTROLS:e.sub(c,b,B),e.normalize(B,B),E.set_hover_pivot(a,c),c=b=0,N[0]=B[0],N[1]=0,N[2]=B[2],b=e.dot(N,B),c=Math.acos(b/(e.length(N)*e.length(B))),b=B[2]?Math.atan(B[0]/B[2]):0<B[0]?0:Math.PI,
0<B[2]&&0<B[0]?J[1]=-(Math.PI+J[1]):0<B[2]&&0>B[0]?J[1]=-(Math.PI+J[1]):0>B[2]&&0>B[0]?(J[0]+=Math.PI,b=-(Math.PI-b)):0>B[2]&&0<B[0]&&(J[0]+=Math.PI,b-=Math.PI),E.rotate_hover_camera(a,b+Math.PI,-c,!0,!0)}M.update_transform(a);n.sync_transform(a)}function m(a,b,c,e){Q.lookAt(b,c,F.AXIS_Y,O);Q.invert(O,O);Q.rotateX(O,Math.PI/2,O);G.fromMat4(O,X);P.fromMat3(X,K);P.normalize(K,K);a=v.get_scale(a.render.world_tsr);v.set_sep(b,a,K,e)}switch(b.state){case 1:a.objects.ca=f.get_object(f.GET_OBJECT_BY_DUPLI_NAME_LIST,
a.objects_paths.id0,0);a.objects.tr=f.get_object(f.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id1,0);a.objects.ta=f.get_object(f.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id2,0);a.state=-1;a.camera_state={trans_start:new Float32Array(3),trans_end:new Float32Array(3),interp_trans:new Float32Array(3),target_start:new Float32Array(3),target_end:new Float32Array(3),interp_target:new Float32Array(3),tsr_start:new Float32Array(8),tsr_end:new Float32Array(8),interp_tsr:new Float32Array(8)};break;
case 2:var p=a.objects.ca;d=v.get_trans_view(a.objects.tr.render.world_tsr);g=v.get_trans_view(a.objects.ta.render.world_tsr);switch(a.state){case -1:b=a.bools.dur?k(u(a.vars.dur,b.variables,c.variables),0):a.floats.dur;if(0==b){m(p,d,g,a.camera_state.tsr_end);l(p,d,g,a.camera_state.tsr_end);c.curr_node=a.slot_idx_order;break}c=v.get_trans_view(p.render.world_tsr);e.copy(c,a.camera_state.trans_start);var q=E.get_move_style(p);q==E.MS_HOVER_CONTROLS?e.copy(p.render.hover_pivot,a.camera_state.target_start):
q==E.MS_STATIC||q==E.MS_EYE_CONTROLS?(v.copy(p.render.world_tsr,a.camera_state.tsr_start),m(p,d,g,a.camera_state.tsr_end)):e.copy(p.render.pivot,a.camera_state.target_start);e.copy(d,a.camera_state.trans_end);e.copy(g,a.camera_state.target_end);a.state=0;var t=z.animate(0,1,1E3*b,function(b){w.check_active()&&(q==E.MS_STATIC||q==E.MS_EYE_CONTROLS?v.interpolate(a.camera_state.tsr_start,a.camera_state.tsr_end,F.smooth_step(b),a.camera_state.interp_tsr):(a.camera_state.interp_target=e.lerp(a.camera_state.target_start,
a.camera_state.target_end,F.smooth_step(b),a.camera_state.interp_target),a.camera_state.interp_trans=e.lerp(a.camera_state.trans_start,a.camera_state.trans_end,F.smooth_step(b),a.camera_state.interp_trans)),l(p,a.camera_state.interp_trans,a.camera_state.interp_target,a.camera_state.interp_tsr),1==b&&(a.state=1))});break;case 1:z.clear_animation(t),a.state=-1,c.curr_node=a.slot_idx_order}}},SET_CAMERA_MOVE_STYLE:function(a,b,c,e,d,g){switch(b.state){case 1:a.tmp1=E.move_style_bpy_to_b4w(a.common_usage_names.camera_move_style);
break;case 2:b=w.get_camera(c.scene),M.update_transform(b),n.sync_transform(b),c.curr_node=a.slot_idx_order}},MOVE_TO:function(a,b,c,e,d,g){function h(a,b){M.set_tsr(a,b);M.update_transform(a);n.sync_transform(a)}switch(b.state){case 1:a.objects.ob=f.get_object(f.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);a.objects.de=f.get_object(f.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id1,0);a.state=-1;a.obj_state={dest_tsr_start:new Float32Array(8),dest_tsr_end:new Float32Array(8),interp_tsr_dest:new Float32Array(8)};
break;case 2:var l=a.objects.ob;v.copy(a.objects.ob.render.world_tsr,a.obj_state.dest_tsr_start);v.copy(a.objects.de.render.world_tsr,a.obj_state.dest_tsr_end);switch(a.state){case -1:b=a.bools.dur?k(u(a.vars.dur,b.variables,c.variables),0):a.floats.dur;if(0==b){h(l,a.obj_state.dest_tsr_end);c.curr_node=a.slot_idx_order;break}a.state=0;var m=z.animate(0,1,1E3*b,function(b){w.check_active()&&(a.obj_state.interp_dest=v.interpolate(a.obj_state.dest_tsr_start,a.obj_state.dest_tsr_end,F.smooth_step(b),
a.obj_state.interp_tsr_dest),h(l,a.obj_state.interp_tsr_dest),1==b&&(a.state=1))});break;case 1:z.clear_animation(m),a.state=-1,c.curr_node=a.slot_idx_order}}},TRANSFORM_OBJECT:function(a,b,c,e,d,g){function h(a,b,c){0==c?M.set_tsr(a,b):M.set_tsr_rel(a,b);M.update_transform(a);n.sync_transform(a)}switch(b.state){case 1:a.objects.ob=f.get_object(f.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);a.state=-1;a.obj_state={space:0,tsr_start:new Float32Array(8),tsr_end:new Float32Array(8),interp_tsr:new Float32Array(8)};
break;case 2:var l=a.objects.ob;switch(a.state){case -1:N[0]=a.bools.trx?k(u(a.vars.trx,b.variables,c.variables),0):a.floats.trx;N[1]=a.bools["try"]?k(u(a.vars["try"],b.variables,c.variables),0):a.floats["try"];N[2]=a.bools.trz?k(u(a.vars.trz,b.variables,c.variables),0):a.floats.trz;B[0]=a.bools.rox?k(u(a.vars.rox,b.variables,c.variables),0):a.floats.rox;B[1]=a.bools.roy?k(u(a.vars.roy,b.variables,c.variables),0):a.floats.roy;B[2]=a.bools.roz?k(u(a.vars.roz,b.variables,c.variables),0):a.floats.roz;
e=a.bools.sc?u(a.vars.sc,b.variables,c.variables):a.floats.sc;if(a.bools["try"]||a.bools.trz)J[1]=-N[1],N[1]=N[2],N[2]=J[1];if(a.bools.roy||a.bools.roz)J[1]=-B[1],B[1]=B[2],B[2]=J[1];F.euler_to_quat(B,K);v.set_sep(N,e,K,a.obj_state.tsr_end);a.obj_state.space=a.common_usage_names.space_type;switch(a.obj_state.space){case 0:M.get_tsr(l,a.obj_state.tsr_start);break;case 1:M.get_tsr_rel(l,a.obj_state.tsr_start);break;case 2:M.get_tsr_rel(l,a.obj_state.tsr_start),v.multiply(a.obj_state.tsr_start,a.obj_state.tsr_end,
a.obj_state.tsr_end)}b=a.bools.dur?k(u(a.vars.dur,b.variables,c.variables),0):a.floats.dur;if(0==b){h(l,a.obj_state.tsr_end,a.obj_state.space);c.curr_node=a.slot_idx_order;break}a.state=0;var m=z.animate(0,1,1E3*b,function(b){w.check_active()&&(v.interpolate(a.obj_state.tsr_start,a.obj_state.tsr_end,F.smooth_step(b),a.obj_state.interp_tsr),h(l,a.obj_state.interp_tsr,a.obj_state.space),1==b&&(a.state=1))});break;case 1:z.clear_animation(m),a.state=-1,c.curr_node=a.slot_idx_order}}},SPEAKER_PLAY:function(a,
b,c,e,d,g){switch(b.state){case 1:a.obj=f.get_object(f.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);void 0==a.bools.not_wait&&(a.bools.not_wait=!0);break;case 2:switch(D.is_playing(a.obj)||0!=a.state||(a.state=1),a.state){case -1:for(var h in b.logic_threads)e=b.logic_threads[h].thread_state.curr_node,-1!=e&&(e=b.logic_threads[h].nodes[e],"SPEAKER_PLAY"==e.type&&e!=a&&0==e.state&&e.obj==a.obj&&(e.state=1));a.bools.not_wait||(c.in_progress=!0);D.play_def(a.obj);a.state=0;break;case 0:a.bools.not_wait&&
(c.curr_node=a.slot_idx_order,a.state=-1);break;case 1:a.bools.not_wait||(c.in_progress=!1);c.curr_node=a.slot_idx_order;a.state=-1;break;default:F.panic("Unknown state of "+a.name),a.state=-1}}},SPEAKER_STOP:function(a,b,c,e,d,g){switch(b.state){case 1:a.obj=f.get_object(f.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);break;case 2:D.stop(a.obj),c.curr_node=a.slot_idx_order}},STOP_ANIM:function(a,b,c,e,g,h){switch(b.state){case 1:a.obj=a.bools.env?f.get_world_by_name(a.dupli_name_list[0],0):
d(a);break;case 2:H.stop(a.obj,H.SLOT_ALL),a.bools.rst&&H.set_first_frame(a.obj,H.SLOT_ALL),c.curr_node=a.slot_idx_order}},STOP_TIMELINE:function(a,b,c,e,d,g){switch(b.state){case 2:a.bools.rst&&m.set_offset_from_range_start(e),m.stop_nla(),c.curr_node=a.slot_idx_order}},CONSOLE_PRINT:function(a,b,c,e,d,f){switch(b.state){case 2:e={};for(var h in a.vars)e[a.vars[h][1]]=u(a.vars[h],b.variables,c.variables);g.log(a.common_usage_names.msg,JSON.stringify(e));c.curr_node=a.slot_idx_order}},STRING:function(a,
b,e,d,g,f){switch(b.state){case 2:d=a.bools.id0?k(u(a.vars.id0,b.variables,e.variables),1):a.strings.id0;g=a.bools.id1?k(u(a.vars.id1,b.variables,e.variables),1):a.strings.id1;f=0;switch(a.floats.sop){case 0:f=d+g;break;case 1:f=d.indexOf(g);break;case 2:f=a.bools.id2?k(u(a.vars.id2,b.variables,e.variables),1):a.strings.id2;f=d.replace(g,f);break;case 3:f=d.substring(0,d.indexOf(g));c(a.vars.dst1,b.variables,e.variables,d.substring(d.indexOf(g)+1,d.length));""==u(vars.dst,b.variables,e.variables)&&
(f=u(vars.dst1,b.variables,e.variables),c(vars.dst1,b.variables,e.variables,""));break;case 4:switch(a.common_usage_names.condition){case 5:f=d==g?1:0;break;case 4:f=d!=g?1:0;break;case 3:f=d<g?1:0;break;case 2:f=d>g?1:0;break;case 1:f=d<=g?1:0;break;case 0:f=d>=g?1:0}}c(a.vars.dst,b.variables,e.variables,f);e.curr_node=a.slot_idx_order}},GET_TIMELINE:function(a,b,e,d,g,f){switch(b.state){case 2:d=a.bools.nla?k(m.get_frame(d),0):k(z.get_frame(d),0),c(a.vars.vd,b.variables,e.variables,d),e.curr_node=
a.slot_idx_order}},JSON:function(a,b,e,d,f,h){function n(a,b,c,e){for(var d=0;d<b.length;d++){for(var g=b[d].split("."),f=a,h=c[d],k=0;k<g.length&&(f=f[g[k]],void 0!==f&&null!==f);k++);f=p(f);e[h]=f}}function l(a,b,c,e){e||(e={});for(var d=0;d<b.length;d++){var g=b[d].split("."),f=e,h=c[d];if(!(!h in a)){for(var k=0;k<g.length-1;k++)void 0===f[g[k]]&&(isNaN(g[k+1])?f[g[k]]={}:f[g[k]]=[]),f=f[g[k]];f[g[g.length-1]]=p(a[h])}}}switch(b.state){case 2:switch(a.common_usage_names.json_operation){case "PARSE":try{var m=
k(u(a.vars.jsn,b.variables,e.variables),1),q=JSON.parse(m);n(q,a.parse_json_paths,a.parse_json_vars,e.variables)}catch(v){g.error("logic script error: non valid JSON string")}break;case "ENCODE":d={},l(e.variables,a.encode_json_paths,a.encode_json_vars,d),d=k(JSON.stringify(d),1),c(a.vars.jsn,b.variables,e.variables,d)}e.curr_node=a.slot_idx_order}},JS_CALLBACK:function(a,b,e,d,g,h){switch(b.state){case 2:d=a.bools.cb?k(u(a.vars.cb,b.variables,e.variables),1):a.strings.cb;g=[];h=0;for(var n="id"+
h,l=a.common_usage_names.js_cb_params;n in l;)n=0==l[n]?f.get_object(f.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths[n],0):u(a.vars[n],b.variables,e.variables),g.push(n),h++,n="id"+h;l=[];h=0;for(n="out"+h;n in a.vars;)n=u(a.vars[n],b.variables,e.variables),l.push(n),h++,n="out"+h;I[d](g,l);for(d=0;d<l.length;d++)n="out"+d,n in a.vars&&c(a.vars[n],b.variables,e.variables,p(l[d]));e.curr_node=a.slot_idx_order}},EMPTY:b};a.init_logic=function(a,b){var c={data_id:b,scene_name:a.name,state:0,nla_thread:null,
scene:a,curr_thread:null,logic_threads:[],sorted_markers_values:[],variables:{}};a._logic=c;q(a,c)};a.update=function(a,b){var c=m.get_start_time();if(!(0>=c))for(var e=0;e<S.length;e++)for(var d=e,g=a,f=b,h=c,k=S[d],n=0;n<S[d].logic_threads.length;n++){k.curr_thread=S[d].logic_threads[n];var l=S[d].logic_threads[n],p=k,q=g,v=f,R=h,t=l.nodes;if(t.length){for(var w=0;w<t.length;w++)t[w].processed=!1;for(w=0;w<t.length;w++){if(0<=l.thread_state.curr_node)var B=t[l.thread_state.curr_node];else break;
if(B.processed)break;if(B.mute)if("ENTRYPOINT"==B.type)break;else l.thread_state.curr_node=B.slot_idx_order,B.processed=!0;else B.process_node(B,p,l.thread_state,q,v,R),B.processed=!0}}}};a.append_custom_cb=function(a,b){I[a]=b};a.remove_custom_cb=function(a){delete I[a]};a.run_ep=function(a,b){for(var c=0;c<S.length;c++)if(S[c].scene_name==a){for(var c=S[c],e=0;e<c.logic_threads.length;e++){var d=c.logic_threads[e].nodes[0];if(d.name==b){d.bools.js&&(d.mute=!1);c.logic_threads[e].thread_state.curr_node=
0;break}}break}};var ca=function(){return function(a,b,c,e){c=e[0];var d=e[1];e=e[2];for(var g=0;g<c.sel_objs_len;g++)if(t.get_sensor_value(a,b,g)&&g==c.sel_obj_idx){if(m.is_play(d._nla)&&d.nla_thread==c.thread)c.state=-1;else if(!e.thread_state.in_progress||c.bools.no_wait)c.state=1;return}c.state=0}},ga=function(){return function(a,b,c,e){c=e[0];var d=e[1];e=e[2];if(-2==c.state){for(var g=0;g<c.sel_objs_len;g++)if(t.get_sensor_value(a,b,g))for(var f=0;f<c.sel_obj_idxs.length;f++)if(c.sel_obj_idxs[f]==
g){d.nla_thread==c.thread?(m.is_play(d._nla)&&(c.state=-1),e.thread_state.in_progress||(c.state=1,c.slot_idx_jump=c.links_idxs[f])):(c.state=1,c.slot_idx_jump=c.links_idxs[f]);return}c.state=0}}};a.cleanup=function(){S.length=0;I={}}};b4w.module.__math=function(a,r){function u(a,b){for(var c=a[1],d=1,f=2;f<a.length;f++)4!=f&&8!=f&&Math.abs(a[f])>Math.abs(c)&&(c=a[f],d=f);for(var h=Math.floor(d/3),d=d%3,c=.5*Math.atan(2*c/(a[3*h+h]-a[3*d+d])),f=0;f<b.length;f++)b[f]=0==f||4==f||8==f?1:0;b[d+3*h]=-Math.sin(c);b[h+3*d]=Math.sin(c);b[h+3*h]=Math.cos(c);b[d+3*d]=Math.cos(c);return b}function c(a){return Math.sqrt(a[1]*a[1]+a[2]*a[2]+a[5]*a[5])}var b=r("__vec3"),h=r("__mat3"),d=new Float32Array(3),q=new Float32Array(9),k=new Float32Array(9),
p=new Float32Array(9),f=new Float32Array(9);a.get_pline_directional_vec=function(a,b){b=b||new Float32Array(3);b[0]=a[3];b[1]=a[4];b[2]=a[5];return b};a.get_pline_initial_point=function(a,c){c=c||new Float32Array(3);return b.copy(a,c)};a.set_pline_initial_point=function(a,c){b.copy(c,a)};a.set_pline_directional_vec=function(a,c){b.normalize(c,d);a[3]=d[0];a[4]=d[1];a[5]=d[2]};a.calc_pline_point=function(a,b,c){c=c||new Float32Array(3);c[0]=a[0]+a[3]*b;c[1]=a[1]+a[4]*b;c[2]=a[2]+a[5]*b};a.calk_average_position=
function(a,c){for(var d=0;d<a.length;d+=3)c[0]+=a[d],c[1]+=a[d+1],c[2]+=a[d+2];return b.scale(c,3/a.length,c)};a.calc_covariance_matrix=function(a,b,c){for(var d=0;d<c.length;d++)c[d]=0;for(d=0;d<a.length;d+=3){var f=a[d]-b[0],h=a[d+1]-b[1],k=a[d+2]-b[2];c[0]+=f*f;c[1]+=f*h;c[2]+=f*k;c[4]+=h*h;c[5]+=h*k;c[8]+=k*k}c[3]=c[1];c[6]=c[2];c[7]=c[5];for(d=0;d<c.length;d++)c[d]*=3/a.length;return c};a.find_eigenvectors=function(a,b,d){a=h.copy(a,q);if(c(a)<b)return h.identity(d);var l=u(a,k),t=h.transpose(l,
p);h.multiply(a,t,f);h.multiply(l,f,a);d=h.copy(l,d);for(var r=1;b<=c(a)&&100>r;)l=u(a,k),t=h.transpose(l,p),h.multiply(a,t,f),h.multiply(l,f,a),h.multiply(l,d,d),r++;return d};a.point_plane_dist=function(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}};b4w.module.__nla=function(a,r){function u(){return{type:"CLIP",frame_start:0,frame_end:0,scheduled:!1,paused:!1,anim_name:"",anim_uuid:"",anim_slot:0,action_frame_start:0,action_frame_end:0,ext_frame_start:0,ext_frame_end:0,use_reverse:!1,scale:1,repeat:1,action_frame_final:0}}function c(a,b){if(a.animation_data){var d=a.animation_data.nla_tracks;if(d)for(var g=0;g<d.length;g++)b.push(d[g])}d=a.nodes;for(g=0;g<d.length;g++){var f=d[g];f.node_group&&(f=f.node_group.node_tree)&&c(f,b)}}function b(a,
b){var c=Math.round(a)-b.frame_start;b.use_cyclic&&(c%=b.frame_duration,0>c&&(c+=b.frame_duration));return b.frame_offset+c}function h(a,b){var c=(b-E)*x.get_framerate()+a.frame_offset;c>a.frame_start?(c-=a.frame_start,a.cyclic&&(c%=a.frame_end-a.frame_start+1),c+=a.frame_start):c=a.frame_start;return c}function d(a,b){a=y.clamp(a,b.frame_start,b.frame_end);var c=a==b.frame_end?b.action_frame_final:b.action_frame_start+(a-b.frame_start)/b.scale%(b.action_frame_end-b.action_frame_start);b.use_reverse&&
(c=b.action_frame_end-c+b.action_frame_start);return c}function q(a,b){for(var c=[],d=0;d<a.length;d++){var g=a[d].strips;if(g)for(var f=0;f<g.length;f++){var h=g[f],k=u();k.type=h.type;k.frame_start=h.frame_start;k.frame_end=h.frame_end;k.anim_slot=b;k.action_frame_start=h.action_frame_start;k.action_frame_end=h.action_frame_end;k.use_reverse=h.use_reverse;k.scale=h.scale;k.repeat=h.repeat;h.action&&(k.anim_name=h.action.name,k.anim_uuid=h.action.uuid);c.push(k)}}return c}function k(a){return("SPEAKER"==
a.type||"LAMP"==a.type)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}function p(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&f(d))return!0}return!1}function f(a,b){if(a.animation_data){var c=a.animation_data.nla_tracks;if(c&&c.length)return!0}for(var c=a.nodes,d=0;d<c.length;d++){var g=c[d];g.node_group&&(g=g.node_group.node_tree)&&f(g,b)}return!1}function w(a,b){var c=F.get_active();
if(c._nla){var d=h(c._nla,b);c._nla.frame_offset-=d-a;c._nla.force_update=!0}}var g=r("__animation");r("__config");var m=r("__objects"),l=r("__obj_util"),t=r("__print"),F=r("__scenes"),H=r("__sfx"),C=r("__textures"),x=r("__time"),y=r("__util"),z=[],E=-1;a.update_object=function(a,b){var d;d=null;for(var f=b.scenes_data.length-1;0<=f;f--){var h=b.scenes_data[f];if(h.scene.b4w_use_nla&&(d=h,h.scene._is_main))break}if(d){d.obj_has_nla_on_scene=!0;var m=0;if((f=a.animation_data)&&f.nla_tracks.length){var p=
f.nla_tracks;if(l.is_armature(b)||l.is_camera(b)||l.is_mesh(b)||l.is_empty(b)||l.is_lamp(b)||l.is_speaker(b)||l.is_world(b))p=q(p,m),p.length&&(b.nla_events=b.nla_events.concat(p),m++)}k(a)&&(p=a.data.animation_data.nla_tracks,p=q(p,m),p.length&&(b.nla_events=b.nla_events.concat(p),m++));if(l.is_mesh(b))for(h=a.data.materials,f=0;f<h.length;f++){var t=h[f];if(t.use_nodes&&t.node_tree&&(p=[],c(t.node_tree,p),p=q(p,m),p.length)){for(var t=m,w=p,r=g.get_all_actions(),x=[],B=0,F=0;F<w.length;F++){var C=
w[F];""!=C.anim_uuid?C=y.keysearch("uuid",C.anim_uuid,r):(C=C.anim_name,C=y.keysearch("name",C,r)||y.keysearch("name",C+"_B4W_BAKED",r));if(C){var C=C.fcurves,z=[],E;for(E in C)z.push(E);x.push(z)}}for(F=0;F<x.length;F++){r=!1;for(C=0;C<F;C++)if(y.arrays_have_common(x[F],x[C])){w[F].anim_slot=w[C].anim_slot;r=!0;break}r||(w[F].anim_slot=m+B++)}m=t+B;b.nla_events=b.nla_events.concat(p)}}if(!l.is_world(b)){for(f=0;f<a.particle_systems.length;f++)h=a.particle_systems[f],E=h.settings,"EMITTER"==E.type&&
E.b4w_allow_nla&&(E=u(),E.type="CLIP",E.frame_start=d.scene.frame_start,E.frame_end=d.scene.frame_end+1,E.anim_name=h.name,E.anim_slot=m,E.action_frame_start=E.frame_start,E.action_frame_end=E.frame_end,b.nla_events.push(E),m++);h=m+1;for(f=0;f<b.vertex_anim.length;f++)p=b.vertex_anim[f],p.allow_nla&&(m=h,E=u(),E.type="CLIP",E.frame_start=d.scene.frame_start,E.frame_end=d.scene.frame_end+1,E.anim_name=p.name,E.anim_slot=m,E.action_frame_start=E.frame_start,E.action_frame_end=E.frame_end,b.nla_events.push(E))}}};
a.update_scene=function(a,b,c){a._nla||(a._nla={frame_start:a.frame_start,frame_end:a.frame_end,frame_offset:0,last_frame:-1,range_end:a.frame_end,range_start:a.frame_start,user_callback:null,cyclic:b,objects:[],textures:[],scene_name:a.name,is_stopped:!1,force_update:!1,rewinded_to_start:!0},z.push(a._nla));b=a._nla;for(var d=m.get_scene_objs_derived(a,"ALL",c),g=0;g<d.length;g++){var f=d[g];if(f.nla_events.length){for(var h=0;h<f.scenes_data.length;h++){var k=f.scenes_data[h];k.scene==a&&k.obj_has_nla_on_scene&&
b.objects.push(f)}for(var h=f.nla_events,k=b,l=f.name,p=0;p<h.length;p++){var q=h[p];k.frame_start>q.frame_end||k.frame_end<q.frame_start?(t.warn("NLA: Strip is out of scene range: "+(l+" ["+q.frame_start+":"+q.frame_end+"]")),h.splice(p,1),p--):q.anim_name||"CLIP"!=q.type||(t.warn('NLA: no action in strip for object "'+l+'".'),h.splice(p,1),p--)}f=f.nla_events;h=b;for(k=0;k<f.length;k++){for(var l=f[k],p=h.frame_start,q=h.frame_end+1,B=0;B<f.length;B++){var w=f[B];l.anim_slot==w.anim_slot&&(w.frame_end<=
l.frame_start&&(p=l.frame_start),w.frame_start>=l.frame_end&&(q=Math.min(q,w.frame_start)))}l.ext_frame_start=p;l.ext_frame_end=q;l.action_frame_final=0===l.repeat%1?l.action_frame_end:l.action_frame_start+l.repeat%1*(l.action_frame_end-l.action_frame_start)}}}a=a._render.video_textures;for(g=0;g<a.length;g++)d=a[g]._render,d.use_nla&&(d.video_file||d.seq_video)&&d.vtex_data_id==c&&(f=u(),f.type="VIDEO",d.use_cyclic?(f.frame_start=0,f.frame_end=b.frame_end):(f.frame_start=y.clamp(d.frame_start,0,
b.frame_end),f.frame_end=y.clamp(d.frame_start+d.frame_duration,0,b.frame_end)),f.anim_name=a[g].name,b.textures.push(d))};a.start=function(){E=0};a.get_start_time=function(){return E};a.get_frame_offset=function(a){return a._nla?a._nla.frame_offset:null};a.set_frame_offset=function(a,b){return a._nla?(a._nla.frame_offset=b,!0):!1};a.update=function(a,c){if(!(0>E)){0==E&&(E=a);for(var f=0;f<z.length;f++){var k=z[f];k.is_stopped&&(k.frame_offset-=x.get_framerate()*c);var l=h(k,a);if((!k.is_stopped||
k.force_update)&&l>=k.range_end)if(k.cyclic){var l=k,m=a;l.user_callback&&l.user_callback();w(l.range_start,m);l.rewinded_to_start=!0;l=h(l,m)}else{var m=k,p=l;m.is_stopped=!0;m.frame_offset-=p-m.range_end;m.user_callback&&m.user_callback()}if(!k.is_stopped||k.force_update){for(var m=k,p=l,q=0;q<m.objects.length;q++){for(var t=m.objects[q],r=t.nla_events,F=0;F<r.length;F++){var B=r[F];"SOUND"==B.type&&p<m.last_frame-1E-6&&(B.scheduled=!1)}for(F=0;F<r.length;F++)switch(B=r[F],B.type){case "CLIP":if(B.ext_frame_start<=
p&&p<B.ext_frame_end&&!B.scheduled){var u=t,J=B;""!=J.anim_uuid?g.apply_by_uuid(u,J.anim_uuid,J.anim_slot):g.apply(u,J.anim_name,J.anim_slot);g.set_behavior(u,g.AB_FINISH_STOP,J.anim_slot);var X=d(J.frame_start,J);g.set_frame(u,X,J.anim_slot);for(u=0;u<r.length;u++)r[u]!=B&&r[u].anim_slot==B.anim_slot&&(r[u].scheduled=!1);B.scheduled=!0}B.scheduled&&(u=t,J=d(p,B),X=g.get_current_frame_float(u,B.anim_slot),1E-6<Math.abs(J-X)&&g.set_frame(u,J,B.anim_slot));break;case "SOUND":(p<m.last_frame-1E-6||m.last_frame<
B.frame_start)&&B.frame_start<=p&&p<B.frame_end&&!B.scheduled&&(u=t,X=B,J=(X.frame_start-p)/x.get_framerate(),X=(X.frame_end-X.frame_start)/x.get_framerate(),H.play(u,J,X),B.scheduled=!0),m.last_frame<B.frame_end&&B.frame_end<=p&&B.scheduled&&(B.scheduled=!1)}}m=a;p=k;q=l;for(t=0;t<p.textures.length;t++)if(r=p.textures[t],r.video_file||r.seq_video){F=C.video_get_current_frame(r);B=r;u=b(q,B);u=y.clamp(u,B.frame_offset,B.frame_offset+C.video_get_duration(B)-1);B.seq_video&&(u=C.video_frame_to_seq_frame(B,
u),u==B.seq_movie_length&&u--);B=u;u=C.video_get_start_frame(r);X=J=!1;if(p.force_update||p.rewinded_to_start)X=!0;if(!p.is_stopped){var O;O=r;var ba=b(q,O);O=O.frame_offset<=ba&&ba<=O.frame_offset+C.video_get_duration(O);ba=C.video_is_played(r);r.use_cyclic&&B==u&&(X=!0);ba||F==B||(X=!0);O&&!ba?C.play_video(r.name,r.vtex_data_id):O&&ba?J=!0:!O&&ba&&(r.video_file&&F<B?J=!0:C.pause_video(r.name,r.vtex_data_id))}X?(C.set_frame_video(r.name,B,r.vtex_data_id),r.seq_video&&(r.seq_last_discrete_mark=C.seq_video_get_discrete_timemark(r,
m))):J&&C.video_update_is_available(r)&&(r.video_file?C.update_video_texture(r):(F=C.seq_video_get_discrete_timemark(r,m),F!=r.seq_last_discrete_mark&&(r.seq_cur_frame=B,C.update_seq_video_texture(r)),r.seq_last_discrete_mark=F))}k.last_frame=l}k.force_update=!1;k.rewinded_to_start=!1}}};a.cleanup=function(){z.length=0;E=-1};a.bpy_obj_has_nla=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||k(a)||p(a)?!0:!1};a.set_frame=w;a.get_frame=function(a){var b=F.get_active();return b._nla?
h(b._nla,a):-1};a.stop_nla=function(){var a=F.get_active();a._nla&&(a._nla.is_stopped=!0);for(var a=a._nla.textures,b=0;b<a.length;b++){var c=a[b];C.pause_video(c.name,c.vtex_data_id)}};a.play_nla=function(a){var b=F.get_active();b._nla&&(b._nla.is_stopped=!1,b._nla.user_callback=a?a:null)};a.get_frame_start=function(){var a=F.get_active();return a._nla?a._nla.frame_start:-1};a.get_frame_end=function(){var a=F.get_active();return a._nla?a._nla.frame_end:-1};a.is_play=function(){var a=F.get_active();
return a._nla?!a._nla.is_stopped:!1};a.check_nla=function(){var a=F.get_active();return a._nla?a.b4w_use_nla:!1};a.check_logic_nodes=function(){var a=F.get_active();return a._nla?0<a.b4w_logic_nodes.length:!1};a.set_range=function(a,b){var c=F.get_active();if(c._nla)c._nla.range_start=a,c._nla.range_end=b;else return!1};a.set_range_end=function(a){var b=F.get_active();if(b._nla)b._nla.range_end=a;else return!1};a.set_range_start=function(a){var b=F.get_active();if(b._nla)b._nla.range_start=a;else return!1};
a.reset_range=function(){var a=F.get_active();if(a._nla)a=a._nla,a.range_start=a.frame_start,a.range_end=a.frame_end;else return!1};a.set_cyclic=function(a){var b=F.get_active();if(b._nla)b._nla.cyclic=a;else return!1};a.clear_callback=function(){var a=F.get_active();a._nla&&(a._nla.user_callback=null)};a.set_offset_from_range_start=function(a){var b=F.get_active()._nla;b&&(b.frame_offset=-(a-E)*x.get_framerate()+b.range_start,b.force_update=!0)};a.get_frame_end=function(){var a=F.get_active()._nla;
return a?a.frame_end:null}};b4w.module.__camera=function(a,r){function u(a,b,c,d,e){Ha.set_translation(a,b);c&&H(a,b,c);z(a,d);E(a,e)}function c(a,b,c,d,e,g,f,h){var k=a.render;Ha.set_translation(a,b);k.pivot.set(c);H(a,b,c);z(a,d);E(a,e);D(a,g);G(a,f);k.use_panning=h}function b(a,b,c,d,g,f,h,k){var l=a.render;Ha.set_translation(a,b);l.hover_pivot.set(c);H(a,b,c);M(a,d);e(a,g);Q(a,f);v(a,h);l.enable_hover_hor_rotation=k}function h(a,b,c){var d=a.render,e=R.get_trans_view(d.world_tsr),g=R.get_quat_view(d.world_tsr),d=xa;d.set(V.AXIS_Y);
d[3]=0;a=w(a,U)[1];g=V.quat_to_dir(g,V.AXIS_MY,pa);la.set_pline_initial_point(Ta,e);la.set_pline_directional_vec(Ta,g);if(!V.line_plane_intersect(d,-b,Ta,c)||Math.abs(a)<Aa)ha.warn("Active hover camera view vector and the supporting plane are parallel to each other. Hover pivot will be set based on the camera position."),c[0]=e[0],c[1]=0,c[2]=e[2];return c}function d(b){for(var c=b.render,d=0;d<b.scenes_data.length;d++){var e=b.scenes_data[d].cameras[0];if(e.type==a.TYPE_ORTHO)switch(c.move_style){case a.MS_TARGET_CONTROLS:var g=
R.get_trans_view(c.world_tsr);c.init_dist=Z.dist(g,c.pivot);c.init_top=e.top;break;case a.MS_HOVER_CONTROLS:g=R.get_trans_view(c.world_tsr),c.init_dist=Z.dist(g,c.hover_pivot),c.init_top=e.top}}}function q(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),near:new Float32Array([0,0,0,0]),far:new Float32Array([0,0,0,0])}}function k(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;
case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function p(b){var c={type:b,name:"",size_mult:1,width:0,height:0,framebuffer:null,framebuffer_prev:null,color_attachment:null,depth_attachment:null,aspect:0,fov:0,near:0,far:0,left:0,right:0,top:0,bottom:0,hmd_fov:qa.create(),world_tsr:new Float32Array(9),view_matrix:new Float32Array(16),proj_matrix:new Float32Array(16),view_proj_matrix:new Float32Array(16),view_proj_inv_matrix:new Float32Array(16),
prev_view_proj_matrix:new Float32Array(16),sky_vp_inv_matrix:new Float32Array(16),view_tsr:R.create_ext(),view_zup_tsr:R.create_ext(),view_inv_zup_tsr:R.create_ext(),real_view_tsr:R.create_ext(),real_view_zup_tsr:R.create_ext(),real_view_inv_zup_tsr:R.create_ext(),shadow_cast_billboard_view_tsr:R.create_ext(),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,dof_object:null,dof_on:!1,lod_eye:new Float32Array(3),frustum_planes:q(),stereo_conv_dist:0,stereo_eye_dist:0,reflection_plane:null,csm_centers:null,
csm_radii:null,csm_center_dists:new Float32Array(4),pcf_blur_radii:new Float32Array(4)};c.hmd_fov[0]=c.hmd_fov[2]=45;c.hmd_fov[1]=c.hmd_fov[3]=55;if(b==a.TYPE_NONE)return c;switch(b){case a.TYPE_PERSP:m(c,40,.1,1E3);break;case a.TYPE_ORTHO:m(c,2.5,.1,1E3);break;case a.TYPE_PERSP_ASPECT:break;case a.TYPE_ORTHO_ASPECT:break;case a.TYPE_ORTHO_ASYMMETRIC:break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:throw"Stereo camera may only be created from perspective one";
default:throw"Unknown camera type";}return c}function f(b,c,d){if(b.type!=a.TYPE_STEREO_LEFT&&b.type!=a.TYPE_STEREO_RIGHT&&b.type!=a.TYPE_HMD_LEFT&&b.type!=a.TYPE_HMD_RIGHT)throw"set_stereo_params(): wrong camera type";if(b.type==a.TYPE_STEREO_LEFT||b.type==a.TYPE_STEREO_RIGHT)b.stereo_conv_dist=c;b.stereo_eye_dist=d;X(b,b.aspect);if(T.check_active()&&(c=T.get_active(),b=c._render.shadow_params))for(c=ja.get_scene_data(T.get_camera(c),c).cameras,d=0;d<c.length;d++)aa(c[d],b)}function w(a,b){var c=
R.get_quat_view(a.render.world_tsr);return g(c,b)}function g(a,b){var c=V.quat_to_dir(a,V.AXIS_Y,pa),d=V.quat_to_dir(a,V.AXIS_Z,L),e=-Math.asin(c[1]/Z.length(c)),c=Math.abs(e)>Math.PI/4?Z.scale(d,-V.sign(e),ma):Z.scale(c,-V.sign(d[1]),ma),g=Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(e=V.sign(e)*Math.PI-e);d=g;0>c[2]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=e;return b}function m(b,c,d,e,g){switch(b.type){case a.TYPE_PERSP:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:b.fov=c;b.aspect=1;break;
case a.TYPE_ORTHO:b.top=c;b.aspect=1;break;case a.TYPE_PERSP_ASPECT:delete b.fov;b.fov=c;b.aspect=g/c;break;case a.TYPE_ORTHO_ASPECT:b.top=c;b.aspect=g/c;break;case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:break;default:ha.error("set_frustum(): Unsupported camera type: "+b.type)}b.near=d;b.far=e}function l(b,c){var d=R.get_trans_view(c.render.world_tsr),e=R.get_quat_view(c.render.world_tsr),d=A.fromRotationTranslation(e,d,za);A.rotateX(d,-Math.PI/2,d);A.invert(d,b.view_matrix);if(T.check_active())var g=
T.get_active(),g=T.get_subs(g,"STEREO");if(b.type==a.TYPE_STEREO_LEFT||g&&g.enable_hmd_stereo&&b.type==a.TYPE_HMD_LEFT)b.view_matrix[12]+=b.stereo_eye_dist/2;else if(b.type==a.TYPE_STEREO_RIGHT||g&&g.enable_hmd_stereo&&b.type==a.TYPE_HMD_RIGHT)b.view_matrix[12]-=b.stereo_eye_dist/2;if(b.reflection_plane){R.from_mat4(b.view_matrix,b.real_view_tsr);R.to_zup_view(b.real_view_tsr,b.real_view_zup_tsr);R.invert(b.real_view_zup_tsr,b.real_view_inv_zup_tsr);var g=b.reflection_plane[0],d=b.reflection_plane[1],
e=b.reflection_plane[2],f=b.reflection_plane[3],h=za;h[0]=1-2*g*g;h[1]=-2*g*d;h[2]=-2*g*e;h[3]=0;h[4]=-2*g*d;h[5]=1-2*d*d;h[6]=-2*d*e;h[7]=0;h[8]=-2*g*e;h[9]=-2*d*e;h[10]=1-2*e*e;h[11]=0;h[12]=-2*g*f;h[13]=-2*d*f;h[14]=-2*e*f;h[15]=1;A.multiply(b.view_matrix,h,b.view_matrix);X(b,b.aspect,!0);g=xa;d=za;A.invert(b.view_matrix,d);A.transpose(d,d);qa.transformMat4(b.reflection_plane,d,g);d=Ea;d[0]=(V.sign(g[0])+b.proj_matrix[8])/b.proj_matrix[0];d[1]=(V.sign(g[1])+b.proj_matrix[9])/b.proj_matrix[5];d[2]=
-1;d[3]=(1+b.proj_matrix[10])/b.proj_matrix[14];qa.scale(g,2/(g[0]*d[0]+g[1]*d[1]+g[2]*d[2]+g[3]*d[3]),g);b.proj_matrix[2]=g[0];b.proj_matrix[6]=g[1];b.proj_matrix[10]=g[2]+1;b.proj_matrix[14]=g[3]}R.from_mat4(b.view_matrix,b.view_tsr);R.to_zup_view(b.view_tsr,b.view_zup_tsr);R.invert(b.view_zup_tsr,b.view_inv_zup_tsr);ba(b);O(b);R.copy(c.render.world_tsr,b.world_tsr)}function t(b,c,d,e){A.lookAt(c,d,e,b.view_matrix);d=T.get_active();d=T.get_subs(d,"STEREO");T.check_active()&&(d=T.get_active(),d=
T.get_subs(d,"STEREO"));if(b.type==a.TYPE_STEREO_LEFT||d&&d.enable_hmd_stereo&&b.type==a.TYPE_HMD_LEFT)b.view_matrix[12]+=b.stereo_eye_dist/2;else if(b.type==a.TYPE_STEREO_RIGHT||d&&d.enable_hmd_stereo&&b.type==a.TYPE_HMD_RIGHT)b.view_matrix[12]-=b.stereo_eye_dist/2;R.from_mat4(b.view_matrix,b.view_tsr);ba(b);O(b);R.set_trans(c,b.world_tsr)}function F(a,b,c){c=Z.subtract(c,b,pa);Z.length(c)&&(Z.normalize(c,c),c=V.rotation_to_stable(V.AXIS_MY,c,Y),Ha.set_rotation(a,c));Ha.set_translation(a,b)}function H(a,
b,c){var d=a.render,e=y(a);F(a,b,c);e?(b=Z.copy(d.vertical_axis,pa),Z.negate(b,b),ka.correct_up(a,b,!0)):ka.correct_up(a,d.vertical_axis,!0)}function C(a,b){var c=a.render,d=b.cameras;if(!d)throw"Wrong object";for(var e=b.shadow_cameras,g=0;g<e.length;g++){var f=e[g];Z.copy(R.get_trans_view(c.world_tsr),f.lod_eye)}for(g=0;g<d.length;g++)if(f=d[g],l(f,a),V.extract_frustum_planes(f.view_proj_matrix,f.frustum_planes),f.dof_object&&f.dof_on){var e=R.get_trans_view(c.world_tsr),h=Ha.get_translation(f.dof_object,
pa),e=Z.dist(e,h);f.dof_distance=e}}function x(b){var c=b.render;c.move_style==a.MS_TARGET_CONTROLS&&(c.target_cam_upside_down=y(b))}function y(a){a=R.get_quat_view(a.render.world_tsr);return 0<V.quat_to_dir(a,V.AXIS_Z,pa)[1]}function z(b,c){var d=b.render;if(c){d.horizontal_limits=d.horizontal_limits||{};d.horizontal_limits.left=c.left;d.horizontal_limits.right=c.right;d.horizontal_limits.left_local=c.left;d.horizontal_limits.right_local=c.right;d.horizontal_limits.camera_space=Boolean(c.camera_space);
var e=b.render;!(d=e.horizontal_limits)||e.move_style!=a.MS_EYE_CONTROLS&&e.move_style!=a.MS_TARGET_CONTROLS||(e=w(b,U),d.camera_space?(d.left+=e[0],d.right+=e[0]):(d.left_local-=e[0],d.right_local-=e[0]),d.left=V.angle_wrap_0_2pi(d.left),d.right=V.angle_wrap_0_2pi(d.right),d.left_local=V.angle_wrap_0_2pi(d.left_local),d.right_local=V.angle_wrap_0_2pi(d.right_local))}else d.horizontal_limits=null}function E(a,b){var c=a.render;b?(c.vertical_limits=c.vertical_limits||{},c.vertical_limits.down=b.down,
c.vertical_limits.up=b.up,c.vertical_limits.down_local=b.down,c.vertical_limits.up_local=b.up,c.vertical_limits.camera_space=Boolean(b.camera_space),n(a)):c.vertical_limits=null}function e(a,b){var c=a.render;if(!b){var d=w(a,U);b={down:d[1],up:d[1]}}c.vertical_limits=c.vertical_limits||{};c.vertical_limits.down=b.down;c.vertical_limits.up=b.up;n(a);c.distance_limits&&c.vertical_limits&&J(a)}function n(b){var c=b.render,d=c.vertical_limits;if(d)switch(c.move_style){case a.MS_EYE_CONTROLS:case a.MS_TARGET_CONTROLS:b=
w(b,U);d.camera_space?(d.up+=b[1],d.down+=b[1]):(d.up_local-=b[1],d.down_local-=b[1]);d.up=V.angle_wrap_periodic(d.up,-Math.PI,Math.PI);d.down=V.angle_wrap_periodic(d.down,-Math.PI,Math.PI);d.up_local=V.angle_wrap_periodic(d.up_local,-Math.PI,Math.PI);d.down_local=V.angle_wrap_periodic(d.down_local,-Math.PI,Math.PI);break;case a.MS_HOVER_CONTROLS:d.up=V.angle_wrap_periodic(d.up,-Math.PI,Math.PI),d.down=V.angle_wrap_periodic(d.down,-Math.PI,Math.PI),d.up=V.clamp(d.up,-Math.PI/2,0),d.down=V.clamp(d.down,
-Math.PI/2,0)}}function M(a,b){var c=a.render;if(!b){var d=Ha.obj_point_distance(a,c.hover_pivot);b={min:d,max:d}}c.distance_limits=c.distance_limits||{};c.distance_limits.min=b.min;c.distance_limits.max=b.max;c.distance_limits&&c.vertical_limits&&J(a)}function D(a,b){var c=a.render;b?(c.distance_limits=c.distance_limits||{},c.distance_limits.min=b.min,c.distance_limits.max=b.max):c.distance_limits=null}function G(a,b){var c=a.render;b?(c.pivot_limits=c.pivot_limits||{},c.pivot_limits.min_y=b.min_y,
c.pivot_limits.max_y=b.max_y):c.pivot_limits=null}function Q(a,b){var c=a.render;b?(c.hover_horiz_trans_limits=c.hover_horiz_trans_limits||{},c.hover_horiz_trans_limits.min=b.min,c.hover_horiz_trans_limits.max=b.max):c.hover_horiz_trans_limits=null}function v(a,b){var c=a.render;b?(c.hover_vert_trans_limits=c.hover_vert_trans_limits||{},c.hover_vert_trans_limits.min=b.min,c.hover_vert_trans_limits.max=b.max):c.hover_vert_trans_limits=null}function P(b){var c=b.render;if(ja.is_camera(b))for(var d=
b.scenes_data,e=0;e<d.length;e++){var g=d[e].cameras;if(g[0].type===a.TYPE_ORTHO){switch(c.move_style){case a.MS_TARGET_CONTROLS:var f=R.get_trans_view(c.world_tsr),f=Z.dist(f,c.pivot),f=f/c.init_dist*c.init_top;break;case a.MS_HOVER_CONTROLS:f=R.get_trans_view(c.world_tsr);f=Z.distance(f,c.hover_pivot);f=f/c.init_dist*c.init_top;break;default:f=g[0].top}for(var h=0;h<g.length;h++){var k=g[h];k.top=f;X(k,k.aspect)}C(b,d[e])}}}function S(b){var c=b.render,d=c.move_style;if(d===a.MS_TARGET_CONTROLS||
d===a.MS_EYE_CONTROLS){if(c.horizontal_limits){var e=c.horizontal_limits.left,g=c.horizontal_limits.right,f=w(b,U);(f=d==a.MS_TARGET_CONTROLS?V.calc_returning_angle(f[0],e,g):V.calc_returning_angle(f[0],g,e))&&(d==a.MS_TARGET_CONTROLS?K(b,f,0):I(b,f,0))}c.vertical_limits&&(e=c.vertical_limits.down,g=c.vertical_limits.up,f=w(b,U),(f=d==a.MS_TARGET_CONTROLS?V.calc_returning_angle(f[1],g,e):V.calc_returning_angle(f[1],e,g))&&(d==a.MS_TARGET_CONTROLS?K(b,0,f):I(b,0,f)));if(d===a.MS_TARGET_CONTROLS&&c.distance_limits){var f=
b.render,e=R.get_trans_view(f.world_tsr),g=Z.subtract(e,f.pivot,pa),h=Z.length(g);h>f.distance_limits.max?(Z.scale(g,f.distance_limits.max/h,g),Z.add(f.pivot,g,e)):h<f.distance_limits.min&&(h=R.get_quat_view(f.world_tsr),h=V.quat_to_dir(h,V.AXIS_MY,L),Z.scale(h,100*f.distance_limits.min,h),Z.add(g,h,g),Z.scale(g,-f.distance_limits.min/Z.length(g),g),Z.add(f.pivot,g,e))}}d===a.MS_TARGET_CONTROLS&&c.pivot_limits&&(c=b.render,f=c.pivot[1],e=V.clamp(c.pivot[1],c.pivot_limits.min_y,c.pivot_limits.max_y),
e!=f&&(f=Z.set(0,e-f,0,pa),Z.add(c.pivot,f,c.pivot),c=R.get_trans_view(c.world_tsr),Z.add(c,f,c)));d===a.MS_HOVER_CONTROLS&&(d=b.render,d.hover_horiz_trans_limits&&(f=V.clamp(d.hover_pivot[0],d.hover_horiz_trans_limits.min,d.hover_horiz_trans_limits.max)-d.hover_pivot[0],d.hover_pivot[0]+=f,c=R.get_trans_view(d.world_tsr),c[0]+=f),d.hover_vert_trans_limits&&(f=V.clamp(d.hover_pivot[2],d.hover_vert_trans_limits.min,d.hover_vert_trans_limits.max)-d.hover_pivot[2],d.hover_pivot[2]+=f,c=R.get_trans_view(d.world_tsr),
c[2]+=f),d=b.render,c=w(b,U)[1],(d=V.calc_returning_angle(c,d.vertical_limits.up,d.vertical_limits.down))&&B(b,0,d))}function I(a,b,c,d,e){var g=a.render,f=b,h=c;if(d||e)a=w(a,oa),d&&(f=b-a[0]),e&&(h=c-a[1]);if(f||h)b=sa.identity(Y),f&&(f=sa.setAxisAngle(g.vertical_axis,f,wa),sa.multiply(b,f,b)),g=R.get_quat_view(g.world_tsr),h&&(f=V.quat_to_dir(g,V.AXIS_X,pa),h=sa.setAxisAngle(f,h,wa),sa.normalize(h,h),sa.multiply(b,h,b)),sa.multiply(b,g,g)}function K(a,b,c,d,e){var g=a.render,f=b,h=c;if(d||e){var k=
w(a,oa);d&&(f=b-k[0]);e&&(h=c-k[1])}N(a,a.render.pivot,f,h);a=w(a,oa);a=V.angle_wrap_periodic(a[1],-Math.PI,Math.PI);g.target_cam_upside_down=Math.abs(a)>Math.PI/2}function B(a,b,c,d,e){var g=a.render,f=b,h=c;if(d||e){var k=w(a,oa);d&&(f=b-k[0]);e&&(h=c-k[1])}g.enable_hover_hor_rotation||(f=0);N(a,g.hover_pivot,f,h);h&&J(a)}function N(a,b,c,d){var e=a.render;if(c||d){var g=sa.identity(Y);c&&(c=sa.setAxisAngle(V.AXIS_Y,c,wa),sa.multiply(g,c,g));ga(a);a=R.get_quat_view(e.world_tsr);d&&(c=V.quat_to_dir(a,
V.AXIS_X,pa),d=sa.setAxisAngle(c,d,wa),sa.normalize(d,d),sa.multiply(g,d,g));e=R.get_trans_view(e.world_tsr);V.rotate_point_pivot(e,b,g,e);sa.multiply(g,a,a)}}function J(a){var b=a.render,c=w(a,U)[1],d=a.render;a=d.vertical_limits;d=d.distance_limits;a.down-a.up?(c=(a.down-c)/(a.down-a.up),c=Math.max(c,0)):c=0;c=c*(d.max-d.min)+d.min;a=R.get_trans_view(b.world_tsr);d=R.get_quat_view(b.world_tsr);d=V.quat_to_dir(d,V.AXIS_MY,pa);Z.normalize(d,d);Z.scale(d,c,d);Z.subtract(b.hover_pivot,d,a)}function X(b,
c,d){switch(b.type){case a.TYPE_PERSP:if(!c)throw"No aspect ratio";b.aspect=c;case a.TYPE_PERSP_ASPECT:A.perspective(V.deg_to_rad(b.fov),b.aspect,b.near,b.far,b.proj_matrix);break;case a.TYPE_ORTHO:if(!c)throw"No aspect ratio";b.aspect=c;case a.TYPE_ORTHO_ASPECT:c=b.top*b.aspect;A.ortho(-c,c,-b.top,b.top,b.near,b.far,b.proj_matrix);break;case a.TYPE_ORTHO_ASYMMETRIC:A.ortho(b.left,b.right,b.bottom,b.top,b.near,b.far,b.proj_matrix);break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:if(!c)throw"No aspect ratio";
b.aspect=c;var e=Math.tan(b.fov*Math.PI/360);c=b.near*e;var g=b.aspect*b.stereo_conv_dist*e;b.type==a.TYPE_STEREO_LEFT?(e=g-b.stereo_eye_dist/2,g+=b.stereo_eye_dist/2):(e=g+b.stereo_eye_dist/2,g-=b.stereo_eye_dist/2);e=-(b.near/b.stereo_conv_dist*e);g*=b.near/b.stereo_conv_dist;A.frustum(e,g,-c,c,b.near,b.far,b.proj_matrix);b.left=e;b.right=g;break;case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:if(T.check_active())if(e=T.get_active(),(e=T.get_subs(e,"STEREO"))&&e.enable_hmd_stereo){c=Math.tan(V.deg_to_rad(b.hmd_fov[0])/
2);var e=Math.tan(V.deg_to_rad(b.hmd_fov[1])/2),g=Math.tan(V.deg_to_rad(b.hmd_fov[2])/2),f=Math.tan(V.deg_to_rad(b.hmd_fov[3])/2);b.top=b.near*c;b.right=b.near*e;b.bottom=-b.near*g;b.left=-b.near*f;A.frustum(b.left,b.right,b.bottom,b.top,b.near,b.far,b.proj_matrix)}else c||(c=b.aspect),A.perspective(V.deg_to_rad(b.fov),c,b.near,b.far,b.proj_matrix);break;case a.TYPE_NONE:return;default:throw"Wrong camera type: "+b.type;}d||(ba(b),O(b))}function O(a){A.copy(a.view_matrix,a.sky_vp_inv_matrix);a.sky_vp_inv_matrix[12]=
0;a.sky_vp_inv_matrix[13]=0;a.sky_vp_inv_matrix[14]=0;a.sky_vp_inv_matrix[15]=1;A.multiply(a.proj_matrix,a.sky_vp_inv_matrix,a.sky_vp_inv_matrix);A.invert(a.sky_vp_inv_matrix,a.sky_vp_inv_matrix)}function ba(a){A.copy(a.view_matrix,a.view_proj_matrix);A.multiply(a.proj_matrix,a.view_proj_matrix,a.view_proj_matrix);A.invert(a.view_proj_matrix,a.view_proj_inv_matrix)}function ca(b,c,d,e,g){e||(e=new Float32Array(24));c||(c=b.near);d||(d=b.far);var f,h,k,l,n,m,p,q;switch(b.type){case a.TYPE_NONE:throw"Extraction from NONE camera is not possible";
case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:f=c*Math.tan(b.fov*Math.PI/360);l=-f;h=f*b.aspect;k=-h;n=d/c*f;q=-n;m=n*b.aspect;p=-m;break;case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:k=b.top*b.aspect;f=n=b.top;h=m=k;l=q=-b.top;k=p=-k;break;case a.TYPE_ORTHO_ASYMMETRIC:f=n=b.top;h=m=b.right;l=q=b.bottom;k=p=b.left;break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:n=c/b.near;f=c*Math.tan(b.fov*Math.PI/360);l=-f;h=b.right*n;k=b.left*n;p=d/c;n=f*p;q=-n;m=h*p;p*=k;break;case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:n=
c/b.near;f=b.top*n;l=b.bottom*n;h=b.right*n;k=b.left*n;p=d/c;n=f*p;q=l*p;m=h*p;p*=k;break;default:throw"Wrong camera type: "+b.type;}e[0]=k;e[1]=l;e[2]=-c;e[3]=h;e[4]=l;e[5]=-c;e[6]=h;e[7]=f;e[8]=-c;e[9]=k;e[10]=f;e[11]=-c;e[12]=p;e[13]=q;e[14]=-d;e[15]=p;e[16]=n;e[17]=-d;e[18]=m;e[19]=n;e[20]=-d;e[21]=m;e[22]=q;e[23]=-d;g&&(c=za,A.invert(b.view_matrix,c),V.positions_multiply_matrix(e,c,e,0));return e}function ga(b){return ja.is_camera(b)&&b.render&&b.render.move_style==a.MS_HOVER_CONTROLS}function aa(a,
b){if(b.enable_csm){var c=b.csm_num;if(!a.csm_centers){var d=b.csm_num;a.csm_centers=Array(d);for(var e=0;e<d;e++)a.csm_centers[e]=new Float32Array(3);a.csm_radii=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.near:ia(b,a,d-1),g=ia(b,a,d),e=ca(a,e,g,ea),e=fa.get_frustum_mec(e);a.csm_centers[d].set(e.center);a.csm_radii[d]=e.radius;a.csm_center_dists[d]=Z.length(e.center);a.pcf_blur_radii[d]=da(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.pcf_blur_radii[0]=b.first_cascade_blur_radius}
function ia(a,b,c){var d=a.csm_num,e=V.clamp(a.csm_first_cascade_border,b.near,b.far);a=V.clamp(a.csm_last_cascade_border,b.near,b.far);c=da(e,a,d,c);return V.clamp(c,b.near,b.far)}function da(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}function ta(a,b){b||(b=new Float32Array(3));var c=R.get_trans_view(a.render.world_tsr);Z.copy(c,b);return b}var fa=r("__boundings");r("__config");var ka=r("__constraints"),W=r("__container"),A=r("__mat4"),la=
r("__math"),ja=r("__obj_util"),ha=r("__print"),sa=r("__quat"),T=r("__scenes"),Ha=r("__transform"),R=r("__tsr"),V=r("__util"),Z=r("__vec3"),qa=r("__vec4");a.TYPE_NONE=10;a.TYPE_PERSP=20;a.TYPE_ORTHO=30;a.TYPE_PERSP_ASPECT=40;a.TYPE_ORTHO_ASPECT=50;a.TYPE_ORTHO_ASYMMETRIC=60;a.TYPE_STEREO_LEFT=70;a.TYPE_STEREO_RIGHT=80;a.TYPE_HMD_LEFT=90;a.TYPE_HMD_RIGHT=100;a.MS_STATIC=0;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var Aa=V.deg_to_rad(.5),U=new Float32Array(2),oa=new Float32Array(2),
pa=new Float32Array(3),L=new Float32Array(3),ma=new Float32Array(3),Y=new Float32Array(4),wa=new Float32Array(4),xa=new Float32Array(4),Ea=new Float32Array(4),za=new Float32Array(16),ea=new Float32Array(24),Ta=new Float32Array(6);a.camera_object_to_camera=function(e,g){var f=g.render,l=e.data;switch(l.type){case "PERSP":var n=p(a.TYPE_PERSP);if(l.angle_y)var q=V.rad_to_deg(l.angle_y);m(n,q,l.clip_start,l.clip_end);break;case "ORTHO":n=p(a.TYPE_ORTHO),m(n,l.ortho_scale/2,l.clip_start,l.clip_end)}n.name=
g.name;q=g.scenes_data;q[0].cameras.push(n);for(var t=1;t<q.length;t++){var v=V.clone_object_r(n);q[t].cameras.push(v)}f.underwater=!1;f.move_style=k(l.b4w_move_style);f.dof_distance=l.dof_distance;n=l.dof_object;f.dof_object=n?n._object:null;f.dof_front=l.b4w_dof_front;f.dof_rear=l.b4w_dof_rear;f.dof_power=l.b4w_dof_power;f.velocity_trans=l.b4w_trans_velocity;f.velocity_rot=l.b4w_rot_velocity;f.velocity_zoom=l.b4w_zoom_velocity;n=g.render.move_style;q=e.data;t=null;n!=a.MS_TARGET_CONTROLS&&n!=a.MS_EYE_CONTROLS||
!q.b4w_use_horizontal_clamping||(t={left:q.b4w_rotation_left_limit,right:q.b4w_rotation_right_limit,camera_space:"LOCAL"==q.b4w_horizontal_clamping_type},n==a.MS_EYE_CONTROLS&&(t.left*=-1,t.right*=-1));n=t;q=g.render.move_style;t=e.data;v=null;q!=a.MS_TARGET_CONTROLS&&q!=a.MS_EYE_CONTROLS||!t.b4w_use_vertical_clamping?q==a.MS_HOVER_CONTROLS&&t.b4w_use_zooming&&(t.b4w_hover_angle_min<=t.b4w_hover_angle_max?(v={down:t.b4w_hover_angle_min,up:t.b4w_hover_angle_max},v.down*=-1,v.up*=-1):ha.error("Wrong angle limits for the HOVER camera. Disabling angle limits.")):
(v={down:t.b4w_rotation_down_limit,up:t.b4w_rotation_up_limit,camera_space:"LOCAL"==t.b4w_vertical_clamping_type},q==a.MS_TARGET_CONTROLS&&(v.down*=-1,v.up*=-1));var q=v,t=g.render.move_style,v=e.data,w=null;t==a.MS_TARGET_CONTROLS&&v.b4w_use_target_distance_limits&&v.b4w_distance_min<=v.b4w_distance_max?w={min:v.b4w_distance_min,max:v.b4w_distance_max}:t===a.MS_HOVER_CONTROLS&&v.b4w_use_zooming&&(v.b4w_distance_min<=v.b4w_distance_max?w={min:v.b4w_distance_min,max:v.b4w_distance_max}:ha.error("Wrong distance limits for the HOVER camera. Disabling distance limits."));
t=w;v=e.data;w=null;g.render.move_style==a.MS_HOVER_CONTROLS&&v.b4w_use_horizontal_clamping&&v.b4w_horizontal_translation_min<=v.b4w_horizontal_translation_max&&(w={min:v.b4w_horizontal_translation_min,max:v.b4w_horizontal_translation_max});var v=w,B=e.data,w=null;g.render.move_style==a.MS_HOVER_CONTROLS&&B.b4w_use_vertical_clamping&&B.b4w_vertical_translation_min<=B.b4w_vertical_translation_max&&(w={min:B.b4w_vertical_translation_min,max:B.b4w_vertical_translation_max},B=-w.min,w.min=-w.max,w.max=
B);var B=e.data,r=null;g.render.move_style==a.MS_TARGET_CONTROLS&&B.b4w_use_pivot_limits&&(r={min_y:B.b4w_pivot_z_min,max_y:B.b4w_pivot_z_max});B=r;switch(f.move_style){case a.MS_EYE_CONTROLS:f=R.get_trans_view(g.render.world_tsr);u(g,f,null,n,q);break;case a.MS_TARGET_CONTROLS:f=R.get_trans_view(g.render.world_tsr);c(g,f,l.b4w_target,n,q,t,B,l.b4w_use_panning);break;case a.MS_HOVER_CONTROLS:f=R.get_trans_view(g.render.world_tsr),n=h(g,e.data.b4w_hover_zero_level,L),b(g,f,n,t,q,v,w,l.b4w_enable_hover_hor_rotation)}S(g);
d(g)};a.setup_eye_model=u;a.setup_target_model=c;a.setup_hover_model=b;a.init_ortho_props=d;a.create_frustum_planes=q;a.move_style_bpy_to_b4w=k;a.create_camera=p;a.check_attachment=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.color_attachment);case "DEPTH":return Boolean(a.depth_attachment);case "SCREEN":return!Boolean(a.color_attachment)&&!Boolean(a.depth_attachment);default:throw"Wrong attachment type: "+b;}};a.set_attachment=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.color_attachment=
c;break;case "DEPTH":a.depth_attachment=c;break;case "SCREEN":a.color_attachment=null;a.depth_attachment=null;break;default:throw"Wrong attachment type: "+b;}};a.get_attachment=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.color_attachment;case "DEPTH":return a.depth_attachment;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.make_stereo=function(b,c){if(b.type!=a.TYPE_PERSP||c!=a.TYPE_STEREO_LEFT&&c!=a.TYPE_STEREO_RIGHT&&c!=a.TYPE_HMD_LEFT&&c!=a.TYPE_HMD_RIGHT)throw"make_stereo(): wrong camera type";
b.type=c;f(b,6,.065)};a.set_stereo_params=f;a.get_camera_angles=w;a.get_camera_angles_from_quat=g;a.get_camera_angles_char=function(a,b){w(a,b);b[0]=V.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.set_frustum=m;a.set_frustum_asymmetric=function(b,c,d,e,g,f,h){switch(b.type){case a.TYPE_ORTHO_ASYMMETRIC:b.left=c;b.right=d;b.bottom=e;b.top=g;b.near=f;b.far=h;break;default:ha.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.render.move_style};
a.set_view=l;a.set_view_eye_target_up=t;a.set_view_trans_quat=function(a,b,c){var d=pa;d[0]=0;d[1]=-1;d[2]=0;Z.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=L;e[0]=0;e[1]=0;e[2]=-1;Z.transformQuat(e,c,e);t(a,b,d,e)};a.set_look_at=F;a.set_look_at_corrected=H;a.update_camera_transform=C;a.update_camera=function(b){var c=b.render;S(b);P(b);switch(c.move_style){case a.MS_TARGET_CONTROLS:var d=R.get_trans_view(c.world_tsr),e=R.get_quat_view(c.world_tsr);ka.rotate_to(d,e,c.pivot);for(e=0;e<
b.scenes_data.length;e++)for(var g=b.scenes_data[e].cameras,h=0;h<g.length;h++){var k=g[h];k.type!=a.TYPE_STEREO_LEFT&&k.type!=a.TYPE_STEREO_RIGHT||f(k,Z.dist(d,c.pivot),k.stereo_eye_dist)}ka.correct_up(b,c.vertical_axis);break;case a.MS_EYE_CONTROLS:b.constraint||ka.correct_up(b,c.vertical_axis)}x(b)};a.update_camera_upside_down=x;a.set_horizontal_rot_limits=z;a.set_vertical_rot_limits=E;a.hover_set_vertical_limits=e;a.hover_set_distance_limits=M;a.set_distance_limits=D;a.set_pivot_limits=G;a.set_hor_trans_limits=
Q;a.set_vert_trans_limits=v;a.update_ortho_scale=P;a.rotate_eye_camera=I;a.rotate_target_camera=K;a.rotate_hover_camera=B;a.is_float_aspect=function(b){switch(b.type){case a.TYPE_PERSP:case a.TYPE_ORTHO:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:return!0;default:return!1}};a.get_angular_diameter=function(b){switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:return V.deg_to_rad(b.fov);default:return ha.error("get_angular_diameter(): Unsupported camera type: "+
b.type),0}};a.set_projection=X;a.calc_sky_vp_inverse=O;a.calc_view_proj_inverse=ba;a.extract_frustum_corners=ca;a.assign_boundings=function(a){a=a.render;var b=fa.zero_bounding_box();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.bb_local=b;var c=fa.create_bounding_sphere(1,[0,0,0]);a.bs_local=c;a.bcap_local=fa.create_bounding_capsule(1,b);a.bcyl_local=fa.create_bounding_cylinder(1,b);a.bcon_local=fa.create_bounding_cone(1,b)};a.is_static_camera=function(b){return ja.is_camera(b)&&
b.render&&b.render.move_style==a.MS_STATIC};a.is_target_camera=function(b){return ja.is_camera(b)&&b.render&&b.render.move_style==a.MS_TARGET_CONTROLS};a.is_eye_camera=function(b){return ja.is_camera(b)&&b.render&&b.render.move_style==a.MS_EYE_CONTROLS};a.is_hover_camera=ga;a.is_ortho_camera=function(b){return ja.is_camera(b)&&b.render&&b.scenes_data[0].cameras[0].type==a.TYPE_ORTHO};a.update_camera_shadows=aa;a.csm_far_plane=ia;a.project_point=function(b,c,d){b=b.scenes_data[0].cameras[0];switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:var e=
xa;e.set(c);e[3]=1;qa.transformMat4(e,b.view_proj_matrix,e);c=-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;W.viewport_to_canvas_coords(d[0],d[1],d,b);2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+1)/2);return d;default:return ha.error("Non-compatible camera"),d}};a.get_first_cam=function(a){return a.scenes_data[0].cameras[0]};a.get_edge=function(b,c){switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:var d=Math.tan(V.deg_to_rad(b.fov)/
2);switch(c){case "LEFT":return-d*b.aspect;case "RIGHT":return d*b.aspect;case "TOP":return d;case "BOTTOM":return-d}break;case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:switch(c){case "LEFT":return-b.top*b.aspect;case "RIGHT":return b.top*b.aspect;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.TYPE_ORTHO_ASYMMETRIC:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:switch(c){case "LEFT":return Math.tan(V.deg_to_rad(b.hmd_fov[3])/
2);case "RIGHT":return Math.tan(V.deg_to_rad(b.hmd_fov[1])/2);case "TOP":return Math.tan(V.deg_to_rad(b.hmd_fov[0])/2);case "BOTTOM":return Math.tan(V.deg_to_rad(b.hmd_fov[2])/2)}break;default:V.panic("Unknown camera type")}};a.is_ortho=function(b){switch(b.type){case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:case a.TYPE_ORTHO_ASYMMETRIC:return!0;default:return!1}};a.get_fov=function(b,c){switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:var d=
V.deg_to_rad(b.fov);return c?d*b.aspect:d;default:return 0}};a.set_trans_pivot=function(a,b,c){a=a.render;R.set_trans(b,a.world_tsr);Z.copy(c,a.pivot)};a.set_hover_pivot=function(a,b){var c=a.render,d=Z.subtract(b,c.hover_pivot,pa),e=R.get_trans_view(c.world_tsr),d=Z.add(d,e,d);Ha.set_translation(a,d);Z.copy(b,c.hover_pivot)};a.set_target_pivot=function(a,b){var c=a.render,d=Z.subtract(b,c.pivot,pa),e=R.get_trans_view(c.world_tsr),d=Z.add(d,e,d);Ha.set_translation(a,d);Z.copy(b,c.pivot)};a.get_eye=
ta;a.set_move_style=function(c,e){c.render.move_style=e;c.render.horizontal_limits=null;c.render.vertical_limits=null;c.render.distance_limits=null;c.render.hover_horiz_trans_limits=null;c.render.hover_vert_trans_limits=null;d(c);switch(e){case a.MS_HOVER_CONTROLS:var g=R.get_trans_view(c.render.world_tsr),f=h(c,0,L);b(c,g,f,null,null,null,null,c.render.enable_hover_hor_rotation);break;case a.MS_TARGET_CONTROLS:g=ta(c,pa),f=R.get_quat_view(c.render.world_tsr),f=V.quat_to_dir(f,V.AXIS_MY,L),f=Z.scaleAndAdd(g,
f,10,f),Z.copy(f,c.render.pivot)}};a.wipe_move_style=function(a){a=a.render;a.move_style=0;Z.set(0,0,0,a.pivot);Z.set(0,0,0,a.hover_pivot);a.target_cam_upside_down=!1;a.use_panning=!1;a.horizontal_limits=null;a.vertical_limits=null;a.distance_limits=null;a.hover_horiz_trans_limits=null;a.hover_vert_trans_limits=null;a.pivot_limits=null;a.enable_hover_hor_rotation=!0};a.set_eye_distance=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];70!=d.type&&80!=d.type&&90!=d.type&&100!=d.type||f(d,d.stereo_conv_dist,
b)}};a.set_hmd_fov=function(a,b,c){var d=T.get_active();a=ja.get_scene_data(a,d).cameras;for(d=0;d<a.length;d++){var e=a[d];if(90==e.type||100==e.type)90==e.type&&qa.copy(b,e.hmd_fov),100==e.type&&qa.copy(c,e.hmd_fov),e.reflection_plane||X(e),ba(e),O(e)}}};b4w.module.__lights=function(a,r){function u(a){h.scale(a.color,a.energy,a.color_intensity)}r("__print");var c=r("__tsr"),b=r("__util"),h=r("__vec3"),d=new Float32Array(3);new Float32Array(3);a.lamp_to_light=function(a,k){var p=a.data,f={name:"",type:p.type,prev_direction:new Float32Array(3),direction:new Float32Array(3),color:new Float32Array(3),color_intensity:new Float32Array(3),default_energy:0,spot_size:0,spot_blend:0,generate_shadows:!1,need_sun_fog_update:!1,dynamic_intensity:!1,use_diffuse:!0,
use_specular:!0,energy:1,distance:25,falloff_type:"INVERSE_SQUARE"},f=k.light=f;f.name=k.name;f.use_diffuse=p.use_diffuse;f.use_specular=p.use_specular;var w=c.get_quat_view(k.render.world_tsr),w=b.quat_to_dir(w,b.AXIS_Y,d);h.normalize(w,w);f.direction.set(w);f.color[0]=p.color[0];f.color[1]=p.color[1];f.color[2]=p.color[2];f.energy=f.default_energy=p.energy;u(f);f.distance=p.distance;if("POINT"===f.type||"SPOT"===f.type)f.distance=p.distance;"SPOT"===f.type?(f.spot_blend=p.spot_blend,f.spot_size=
p.spot_size):"POINT"===f.type&&(f.spot_size=Math.PI/2);f.generate_shadows=p.b4w_generate_shadows;f.dynamic_intensity=p.b4w_dynamic_intensity};a.set_light_color=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];u(a)};a.set_light_spot_blend=function(a,b){a.spot_blend=b};a.set_light_distance=function(a,b){a.distance=b};a.set_light_spot_size=function(a,b){a.spot_size=b};a.set_light_energy=function(a,b){a.energy=b;u(a)};a.update_light_transform=function(a){if("LAMP"!=a.type)throw"Wrong light object";
var d=a.light;if(d){a=c.get_quat_view(a.render.world_tsr);b.quat_to_dir(a,b.AXIS_Y,d.direction);h.normalize(d.direction,d.direction);if("SUN"==d.type){a=Math.acos(h.dot(d.prev_direction,b.VEC3_UNIT));var p=Math.acos(h.dot(d.direction,b.VEC3_UNIT));d.need_sun_fog_update=Math.floor(a/.025)!=Math.floor(p/.025)?!0:!1}h.copy(d.direction,d.prev_direction)}}};b4w.module.__scenes=function(a,r){function u(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c._render_to_textures||!c._render_to_textures.length)return c}return null}function c(){if(!ob)throw"No active scene available";return ob}function b(a,b,c){if(!ya.depth_tex_available||!h(a,b,c))return null;c=a.b4w_shadow_settings;var d={};c.csm_resolution>ya.max_texture_size?(d.csm_resolution=ya.max_texture_size,La.error("Shadow map texture has unsupported size. Changed to "+ya.max_texture_size+".")):d.csm_resolution=
c.csm_resolution;a=Da.get_shadow_lamps(b,ya.ssao&&a.b4w_enable_ssao);d.self_shadow_polygon_offset=c.self_shadow_polygon_offset;d.self_shadow_normal_offset=c.self_shadow_normal_offset;d.enable_csm=c.b4w_enable_csm&&1==a.length;d.lamp_types=[];d.spot_sizes=[];d.distances=[];for(b=0;b<a.length;b++)d.lamp_types.push(a[b].light.type),d.spot_sizes.push(a[b].light.spot_size),d.distances.push(a[b].light.distance),"SPOT"!=d.lamp_types[b]&&"POINT"!=d.lamp_types[b]||!d.enable_csm||(La.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),
d.enable_csm=!1);d.enable_csm?(d.csm_num=c.csm_num,d.csm_first_cascade_border=c.csm_first_cascade_border,d.first_cascade_blur_radius=c.first_cascade_blur_radius,d.csm_last_cascade_border=c.csm_last_cascade_border,d.last_cascade_blur_radius=c.last_cascade_blur_radius,d.fade_last_cascade=c.fade_last_cascade,d.blend_between_cascades=c.blend_between_cascades):(d.csm_num=1,d.csm_first_cascade_border=c.csm_first_cascade_border,d.first_cascade_blur_radius=c.first_cascade_blur_radius,d.csm_last_cascade_border=
c.csm_last_cascade_border,d.last_cascade_blur_radius=c.last_cascade_blur_radius,d.fade_last_cascade=!1,d.blend_between_cascades=!1);return d}function h(a,b,c){if(0!=b.length&&ya.shadows)switch(a.b4w_render_shadows){case "OFF":return!1;case "ON":return!0}else return!1;var d=!1,e=!1;a=ya.ssao&&a.b4w_enable_ssao;if(0==b.length&&!a)return!1;for(b=0;b<c.length;b++){var g=c[b];g.b4w_shadow_cast&&(d=!0);g.b4w_shadow_receive&&(e=!0);if((a||d)&&e)return!0}return!1}function d(a){for(var b=0;b<a.length;b++)if("SUN"==
a[b].light.type)return!0;return!1}function q(a){if(!ya.shore_smoothing)return!1;a=A(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}function k(a){for(var b=0;b<a.length;b++)for(var c=a[b].particle_systems,d=0;d<c.length;d++)if(Da.check_obj_soft_particles_accessibility(a[b],c[d].settings))return!0;return!1}function p(a){for(var b=A(a),c=[],d=0;d<b.length;d++){var e=b[d];if(e.b4w_water){for(var g={},f=0;f<a.length;f++)for(var h=a[f],k=h.data.materials,
l=0;l<k.length;l++)k[l]==e&&(g.water_level=h.location[1]);g.fog_color_density=e.b4w_water_fog_color.slice(0);g.fog_color_density.push(e.b4w_water_fog_density);e.b4w_water_dynamic?(g.dynamic=!0,g.waves_height=e.b4w_waves_height,g.waves_length=e.b4w_waves_length,g.dst_noise_scale0=e.b4w_water_dst_noise_scale0,g.dst_noise_scale1=e.b4w_water_dst_noise_scale1,g.dst_noise_freq0=e.b4w_water_dst_noise_freq0,g.dst_noise_freq1=e.b4w_water_dst_noise_freq1,g.dir_min_shore_fac=e.b4w_water_dir_min_shore_fac,g.dir_freq=
e.b4w_water_dir_freq,g.dir_noise_scale=e.b4w_water_dir_noise_scale,g.dir_noise_freq=e.b4w_water_dir_noise_freq,g.dir_min_noise_fac=e.b4w_water_dir_min_noise_fac,g.dst_min_fac=e.b4w_water_dst_min_fac,g.waves_hor_fac=e.b4w_water_waves_hor_fac):(g.dynamic=!1,g.waves_height=0,g.waves_length=0);g.caustics=e.b4w_water_enable_caust;g.caustic_scale=e.b4w_water_caust_scale;g.caustic_brightness=e.b4w_water_caust_brightness;g.caustic_speed=new Float32Array([.3,.7]);g.shoremap_image=null;e=e.texture_slots;for(f=
0;f<e.length;f++)h=e[f].texture,!0===h.b4w_shore_dist_map&&"FILE"==h.image.source&&(g.shoremap_image=h.image,g.shoremap_tex_size=h.image.size[0],g.max_shore_dist=h.b4w_max_shore_dist,h=h.b4w_shore_boundings,g.shoremap_center=[(h[0]+h[1])/2,(h[2]+h[3])/2],g.shoremap_size=[h[0]-h[1],h[2]-h[3]]);c.push(g)}}if(0<c.length){g=c[0];if(!g.dynamic)for(d=0;d<c.length;d++)c[d].dynamic&&(g=c[d]);return g}return null}function f(a){var b={refractions:!1};a=A(a);for(var c=function(a){if(a){a=a.nodes;for(var d=0;d<
a.length;d++){var e=a[d];"GROUP"==e.type&&e.node_group&&c(e.node_group.node_tree);"GROUP"==e.type&&"B4W_REFRACTION"==e.node_tree_name&&(b.refractions=!0)}}},d=0;d<a.length;d++){var e=a[d];e.b4w_refractive&&(b.refractions=!0);e.node_tree&&c(e.node_tree)}return b}function w(a,b,c){if(ya.reflections)switch(a.b4w_render_reflections){case "OFF":return!1}else return!1;a=[];for(var d=0,e=!1,g=0;g<b.length;g++){var f=b[g];f.render.reflective&&"CUBE"==f.render.reflection_type&&d++;if(f.reflective_objs.length){for(var h=
null,k=0;k<a.length;k++)if(a[k]==f){h=k;break}null==h&&a.push(f)}}for(g=0;g<c.length;g++){a:if(b=c[g],b.b4w_reflexible){b=b.data.materials;for(f=0;f<b.length;f++)if(h=b[f].game_settings.alpha_blend,"OPAQUE"!=h&&"CLIP"!=h){b=!0;break a}b=!1}else b=void 0;b&&(e=!0)}return{refl_plane_objs:a,num_cube_refl:d,cube_refl_subs:[],cube_refl_subs_blend:[],plane_refl_subs:[],plane_refl_subs_blend:[],has_blend_reflexible:e}}function g(a,b){var c=a.b4w_sky_settings,d={};d.render_sky=c.render_sky;d.procedural_skydome=
c.procedural_skydome&&b;d.use_as_environment_lighting=c.use_as_environment_lighting;d.sky_color=c.color;d.rayleigh_brightness=c.rayleigh_brightness;d.mie_brightness=c.mie_brightness;d.spot_brightness=c.spot_brightness;d.scatter_strength=c.scatter_strength;d.rayleigh_strength=c.rayleigh_strength;d.mie_strength=c.mie_strength;d.rayleigh_collection_power=c.rayleigh_collection_power;d.mie_collection_power=c.mie_collection_power;d.mie_distribution=c.mie_distribution;d.reflexible=c.reflexible;d.reflexible_only=
c.reflexible_only;!b&&c.procedural_skydome&&La.warn("There is no sun on the scene. Procedural sky won't be rendered");return d}function m(a){var b={};a=a.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.hemisphere=a.hemisphere;b.blur_depth=a.blur_depth;b.blur_discard_value=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;b.samples=a.samples;return b}function l(a){if(!(ya.bloom&&a.b4w_enable_bloom&&a._render.sun_exist))return null;var b={};a=a.b4w_bloom_settings;b.blur=
a.blur;b.edge_lum=a.edge_lum;b.key=a.key;return b}function t(a){var b={};a=a.b4w_motion_blur_settings;b.mb_decay_threshold=a.motion_blur_decay_threshold;b.mb_factor=a.motion_blur_factor;return b}function F(a){var b={};a=a.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}function H(a){var b={};a=a.b4w_god_rays_settings;b.intensity=a.intensity;b.max_ray_length=a.max_ray_length;b.steps_per_pass=a.steps_per_pass;return b}
function C(a){var b={};b.outline_color=a.b4w_outline_color;b.outline_factor=a.b4w_outline_factor;return b}function x(a){var b={};a=a.b4w_glow_settings;b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b}function y(a,b){var c=a.light_settings,d={};d.environment_energy=c.environment_energy;d.use_environment_light=c.use_environment_light;d.environment_color=
c.environment_color;d.horizon_color=a.horizon_color.slice(0);d.zenith_color=a.zenith_color.slice(0);d.use_sky_paper=a.use_sky_paper;d.use_sky_blend=a.use_sky_blend;d.use_sky_real=a.use_sky_real;d.sky_texture_slot=null;d.sky_texture_param=null;d.environment_texture_slot=null;if(d.use_environment_light&&"SKY_TEXTURE"==d.environment_color&&(!b.procedural_skydome||!b.use_as_environment_lighting)){for(var c=null,e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_environment_lighting){c=
a.texture_slots[e];break}c?d.environment_texture_slot=c:(La.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),d.use_environment_light=!1)}for(e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_skydome){c=a.texture_slots[e];d.sky_texture_slot=c;d.sky_texture_param={blend_factor:c.blend_factor,horizon_factor:c.horizon_factor,zenith_up_factor:c.zenith_up_factor,zenith_down_factor:c.zenith_down_factor,
color:c.color,default_value:c.default_value,invert:c.invert,use_rgb_to_intensity:c.use_rgb_to_intensity,blend_type:c.blend_type,use_map_blend:c.use_map_blend,use_map_horizon:c.use_map_horizon,use_map_zenith_up:c.use_map_zenith_up,use_map_zenith_down:c.use_map_zenith_down};break}return d}function z(a){var b=a.fog_settings,c={};c.use_fog=b.use_fog;c.intensity=b.intensity;c.depth=b.depth;c.start=b.start;c.height=b.height;c.falloff=b.falloff;c.color=b.use_custom_color?b.color.slice(0):a.horizon_color.slice(0);
a=c.color;c.fog_color_density=new Float32Array([a[0],a[1],a[2],1/c.depth]);c.fog_params=new Float32Array([c.intensity,c.depth,c.start,c.height]);return c}function E(a,b){if(!ya.dynamic_grass)return!1;switch(a.b4w_render_dynamic_grass){case "OFF":return!1;case "ON":return!0}for(var c=!1,d=!1,e=0;e<b.length;e++){for(var g=b[e],f=g.data.materials,h=0;h<f.length;h++)f[h].b4w_terrain&&(c=!0);g=g.particle_systems;for(h=0;h<g.length;h++)f=g[h].settings,"HAIR"==f.type&&f.b4w_dynamic_grass&&(d=!0);if(c&&d)return!0}return!1}
function e(a,b){if(bc.outlining_overview_mode)return!0;if(ya.enable_selectable)switch(a.b4w_enable_object_selection){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c]._object.render.selectable)return!0;return!1}else return!1}function n(a,b){if(bc.outlining_overview_mode)return!0;if(ya.enable_outlining)switch(a.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c]._object.render.outlining)return!0;return!1}else return!1}
function M(a,b){if(ya.glow_materials)switch(a.b4w_enable_glow_materials){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,e=0;e<d.length;e++)if(ra.check_material_glow_output(d[e]))return!0;return!1}else return!1}function D(a,b){if(ya.refractions)switch(a.b4w_render_refractions){case "OFF":return!1;case "ON":return!0;case "AUTO":return b.refractions}else return!1}function G(a){for(var b=0;b<a.length;b++)for(var c=a[b].data.materials,d=0;d<
c.length;d++){var e=c[d],g=e.game_settings.alpha_blend;if(e.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g)return!0}return!1}function Q(a,b){switch(a.b4w_enable_anchors_visibility){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++){var d=b[c]._object;if(d.anchor&&d.anchor.detect_visibility)return!0}return!1}}function v(a,b,c){var d=ea.node_by_attr(a,b);ea.traverse_inputs(a,d,function(a,b,d){if(d.active){switch(d.from){case "COLOR":case "CUBEMAP":a=b.camera.color_attachment;
break;case "DEPTH":a=b.camera.depth_attachment;break;case "SCREEN":a=null;break;case "MAIN_CUBE_REFLECT":return;default:throw"Wrong slink";}switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":case "u_cube_reflection":case "u_plane_reflection":break;default:if(!a)throw"Connection of SCREEN is forbidden";if(a.w_renderbuffer)throw"Batch texture can't use renderbuffer";ua.check_uniform(c.shader,d.to)&&L.append_texture(c,a,d.to)}}});
for(a=0;a<b.slinks_internal.length;a++){var d=b.slinks_internal[a],e=b.textures_internal[a];switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":break;default:if(e.w_renderbuffer)throw"Batch texture can't use renderbuffer";ua.check_uniform(c.shader,d.to)&&L.append_texture(c,e,d.to)}}}function P(a,b){return{do_render:!0,do_render_cube:[!0,!0,!0,!0,!0,!0],obj_render:a,batch:b}}function S(a,b,c,d,e,g){for(var f=b.render,h=Da.get_scene_data(b,
e).batches,k=0;k<h.length;k++){var l=h[k];if(!(l.shadow_cast_only||l.reflexible_only||"MAIN"!=l.type&&"NODES_GLOW"!=l.type&&"PARTICLES"!=l.type&&"LINE"!=l.type)&&("OPAQUE"==l.subtype&&"OPAQUE"==d||"BLEND"==l.subtype&&"BLEND"==d||"XRAY"==l.subtype&&"XRAY"==d||"NODES_GLOW"==l.type&&"GLOW"==d)){g||(I(l,a,b,c,d,e),L.update_shader(l),K(l));var n=P(f,l);a.bundles.push(n);v(c,a,l);B(l)}}var m=function(a,b){return a==b?0:a>b?1:-1};a.bundles.sort(function(a,b){return a.batch&&b.batch?-m(a.batch.blend,b.batch.blend)||
-m(a.batch.alpha_clip,b.batch.alpha_clip)||m(a.batch.offset_z,b.batch.offset_z):0})}function I(a,b,c,d,e,g){var f=c.render,h=g._render,k=Da.get_scene_data(c,g),l="NO_SHADOWS";c=ja(g,["SHADOW_CAST"]);if(c.length&&a.shadow_receive){switch(e){case "OPAQUE":l="SHADOW_MAPPING_OPAQUE";break;case "BLEND":case "XRAY":l="SHADOW_MAPPING_BLEND";break;case "COLOR_ID":case "REFLECT":case "GLOW":l="NO_SHADOWS";break;case "SHADOW":l="SHADOW_MASK_GENERATION";break;default:throw"Wrong subscene type";}for(var n=0;n<
c.length;n++)L.assign_shadow_receive_dirs(a,g._render.shadow_params,c[n])}c=a.shaders_info;ua.set_directive(c,"SHADOW_USAGE",l);a.dynamic_grass&&(n=na.find_subs(d,"GRASS_MAP"))&&N(a,n,f);if("SHADOW"!=a.type&&"COLOR_ID"!=e||a.has_nodes){n=b.num_lights;ua.set_directive(c,"NUM_LIGHTS",n);ua.set_directive(c,"NUM_LFACTORS",0==n%2?n/2:Math.floor(n/2)+1);ua.set_directive(c,"REFLECTION_PASS",0);ua.set_directive(c,"SSAO_ONLY",0);ua.set_directive(c,"INVERT_FRONTFACING",0);(h=h.water_params)&&b.water_fog_color_density?
ua.set_directive(c,"WATER_EFFECTS",1):ua.set_directive(c,"WATER_EFFECTS",0);if(h&&b.caustics&&f.caustics){ua.set_directive(c,"CAUSTICS",1);if(n=g._render.shadow_params){f=n.lamp_types;for(n=e=0;n<f.length;n++)"SUN"==f[n]&&(e=n);ua.set_directive(c,"SUN_NUM",e)}ua.set_directive(c,"CAUST_SCALE",ua.glsl_value(b.caust_scale));ua.set_directive(c,"CAUST_SPEED",ua.glsl_value(b.caust_speed,2));ua.set_directive(c,"CAUST_BRIGHT",ua.glsl_value(b.caust_brightness))}else ua.set_directive(c,"CAUSTICS",0);h&&(ua.set_directive(c,
"WAVES_HEIGHT",ua.glsl_value(h.waves_height)),ua.set_directive(c,"WAVES_LENGTH",ua.glsl_value(h.waves_length)),ua.set_directive(c,"WATER_LEVEL",ua.glsl_value(h.water_level)));b=k.cube_refl_subs;k=k.plane_refl_subs;if(-1!==a.texture_names.indexOf("u_mirrormap"))ua.set_directive(c,"REFLECTION_TYPE","REFL_MIRRORMAP");else if(a.reflective&&b)b=b.camera.color_attachment,L.append_texture(a,b,"u_cube_reflection"),ua.set_directive(c,"REFLECTION_TYPE","REFL_CUBE");else if(a.reflective&&k)for(n=0;n<k.length;n++)b=
k[n].camera.color_attachment,L.append_texture(a,b,"u_plane_reflection"),ua.set_directive(c,"REFLECTION_TYPE","REFL_PLANE");else ua.set_directive(c,"REFLECTION_TYPE","REFL_NONE");(k=na.find_subs(d,"SKY"))?a.procedural_sky?(b=k.camera.color_attachment,L.append_texture(a,b,"u_sky")):ya.procedural_fog?(a.cube_fog=k.cube_fog,ua.set_directive(c,"PROCEDURAL_FOG",1)):ua.set_directive(c,"PROCEDURAL_FOG",0):ua.set_directive(c,"PROCEDURAL_FOG",0);b=g._render.world_light_set;b.use_environment_light&&(ua.set_directive(c,
"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==b.environment_color?(b=b.environment_texture_slot?Ga.get_batch_texture(b.environment_texture_slot,!1):k.camera.color_attachment,ua.set_directive(c,"SKY_TEXTURE",1),L.append_texture(a,b,"u_sky_texture")):"SKY_COLOR"==b.environment_color&&ua.set_directive(c,"SKY_COLOR",1));b=g._render.world_fog_set;b.use_fog&&(ua.set_directive(c,"USE_FOG",1),ua.set_directive(c,"FOG_TYPE",b.falloff));a.refractive&&a.blend?(ya.depth_tex_available&&ua.set_directive(c,"USE_REFRACTION_CORRECTION",
1),"MAIN"==a.type&&a.has_nodes||"NODES_GLOW"==a.type?(ua.set_directive(c,"REFRACTIVE",1),g._render.refractions?ua.set_directive(c,"USE_REFRACTION",1):ua.set_directive(c,"USE_REFRACTION",0)):g._render.refractions?ua.set_directive(c,"REFRACTIVE",1):ua.set_directive(c,"REFRACTIVE",0)):(ua.set_directive(c,"REFRACTIVE",0),ua.set_directive(c,"USE_REFRACTION",0),ua.set_directive(c,"USE_REFRACTION_CORRECTION",0));a.water&&(ya.shore_smoothing&&a.water_shore_smoothing&&na.find_subs(d,"DEPTH_PACK")?ua.set_directive(c,
"SHORE_SMOOTHING",1):ua.set_directive(c,"SHORE_SMOOTHING",0),a.water_dynamic&&h&&h.waves_height?ua.set_directive(c,"DYNAMIC",1):ua.set_directive(c,"DYNAMIC",0));"PARTICLES"==a.type&&(ua.set_directive(c,"SIZE_RAMP_LENGTH",a.particles_data.size_ramp_length),ua.set_directive(c,"COLOR_RAMP_LENGTH",a.particles_data.color_ramp_length));if(!a.forked_batch)for(a=a.textures,d=0;d<a.length;d++)if(b=a[d],"SCENE"==b.source)for(c=0;c<Ja.length;c++)for(k=Ja[c],h=Ja[c]._render_to_textures,n=0;n<h.length;n++)h[n]._render==
b&&ea.append_edge_attr(Qb,k,g,null)}}function K(a){var b=a.shader.attributes,c=a.bufs_data.pointers,d;for(d in b)c[d]||Ka.panic('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES_GLOW"==a.type)if(b=ua.get_varyings_count(a.shader.vshader),10<b&&("MAIN"==a.type&&La.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.material_names.join(", ")+'"'),"MAIN"==a.type&&a.has_nodes||"NODES_GLOW"==a.type))d=c=0,a.uv_maps_usage&&(c=Ka.get_dict_length(a.uv_maps_usage)),a.vertex_colors_usage&&
(d=Ka.get_dict_length(a.vertex_colors_usage)),La.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.material_names.join(", ")+'"')}function B(a){8<a.textures.length&&La.warn(a.type,"too many textures used - "+a.textures.length+' (max 8), materials "'+a.material_names.join(", ")+'"')}function N(a,b,c){a.grass_map_dim=b.grass_map_dim;var d=b.grass_map_dim[0],e=b.grass_map_dim[1],g=b.grass_map_dim[2];c=c.bb_local;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);g=
0==g?c:Math.max(g,c);b.grass_map_dim[2]=g;b=b.camera;Y.set_frustum(b,g/2,-e,-d,g/2);Y.set_projection(b);d=a.grass_size||0;d=0==d?c:Math.max(d,c);a.grass_size=d}function J(a,b,c,d,e,g){for(var f=b.render,h=Da.get_scene_data(b,e).batches,k=0;k<h.length;k++){var l=h[k];if(("MAIN"==l.type||"PARTICLES"==l.type||"LINE"==l.type)&&"REFLECT"==l.subtype&&l.blend==d){if("MAIN_PLANE_REFLECT"==a.type||"MAIN_PLANE_REFLECT_BLEND"==a.type){var n;a:{var m=e._render.reflection_params.plane_refl_subs;for(n=0;n<m.length;n++)for(var p=
0;p<m[n].length;p++)if(m[n][p]==a)break a;m=e._render.reflection_params.plane_refl_subs_blend;for(n=0;n<m.length;n++)for(p=0;p<m[n].length;p++)if(m[n][p]==a)break a;n=null}if(n==f.plane_reflection_id)continue}else if(n=pa(e,a),n==f.cube_reflection_id)continue;g||(I(l,a,b,c,"REFLECT",e),n=l.shaders_info,ua.set_directive(n,"WATER_EFFECTS",0),ua.set_directive(n,"REFLECTION_PASS",1),ua.set_directive(n,"TEXTURE_NORM",0),"MAIN_PLANE_REFLECT"==a.type&&ua.set_directive(n,"INVERT_FRONTFACING",1),L.update_shader(l),
K(l));l=P(f,l);a.bundles.push(l)}}}function X(a){ka(a);var b=ha(a,"MAIN_OPAQUE"),c=!0,d=a._render.shadow_params;ea.traverse(a._render.graph,function(e,g){"SHADOW_CAST"===g.type&&(ba(g,a,b.camera,g.bundles,d,c),c=!1)})}function O(a){ea.traverse(a._render.graph,function(a,b){"OUTLINE"===b.type&&(b.draw_outline_flag=1)})}function ba(a,b,c,d,e,g){if(0!=d.length){var f=a.camera,h=Na.get_trans_value(c.world_tsr,Rc);Na.set_trans(h,f.world_tsr);Na.copy(c.view_tsr,f.shadow_cast_billboard_view_tsr);if("SUN"===
e.lamp_types[a.shadow_lamp_index]||"HEMI"===e.lamp_types[a.shadow_lamp_index]){h=Wb;ma.zero_bounding_box(h);for(var k=0;k<d.length;k++){var l=d[k].obj_render;0==k?ma.copy_bb(l.bb_world,h):ma.expand_bounding_box(h,l.bb_world)}d=ma.extract_bb_corners(h,zb);Ka.positions_multiply_matrix(d,f.view_matrix,d);if(e.enable_csm){b=Pa.copy(c.csm_centers[a.csm_index],Rc);e=Ia.invert(c.view_matrix,kd);Ka.positions_multiply_matrix(b,e,b);Ka.positions_multiply_matrix(b,f.view_matrix,b);a=c.csm_radii[a.csm_index];
if(g)for(tc=0,bb=-Infinity,g=2;g<d.length;g+=3)tc=Math.min(tc,d[g]),bb=Math.max(bb,d[g]);g=Wb;g.max_x=b[0]+a;g.max_y=b[1]+a;g.max_z=bb;g.min_x=b[0]-a;g.min_y=b[1]-a;g.min_z=tc}else{c=g=Wb;e=Rb;e.set(d);d=Mc/9;h=Ia.identity(kd);Ia.rotate(h,d,Ka.AXIS_MZ,h);for(var l=k=-1,n=0;10>n;n++){var m=ma.bb_from_coords(e,rb),p=(m.max_x-m.min_x)*(m.max_y-m.min_y);if(-1==k||p<k)k=p,l=n,ma.copy_bb(m,c);Ka.positions_multiply_matrix(e,h,e)}c=l*d;0<c&&(d=Ia.identity(kd),Ia.rotate(d,c,Ka.AXIS_MZ,d),Ia.multiply(d,f.view_matrix,
f.view_matrix),Na.from_mat4(f.view_matrix,f.view_tsr));c=g.max_x-g.min_x;d=g.max_y-g.min_y;c&&d&&(e=Math.abs(c-d)/2,2<c/d?(g.max_y+=e,g.min_y-=e):2<d/c&&(g.max_x+=e,g.min_x-=e));g.max_x+=.005;g.max_y+=.005;g.max_z+=.005;g.min_x-=.005;g.min_y-=.005;g.min_z-=.005;ca(a,b._render.graph)}Y.set_frustum_asymmetric(f,g.min_x,g.max_x,g.min_y,g.max_y,-g.max_z,-g.min_z);Y.set_projection(f);Ka.extract_frustum_planes(f.view_proj_matrix,f.frustum_planes)}else"SPOT"!==e.lamp_types[a.shadow_lamp_index]&&"POINT"!==
e.lamp_types[a.shadow_lamp_index]||Y.set_projection(f,f.aspect)}}function ca(a,b){for(var c=a.camera,d=na.get_outputs(b,a),e=0;e<d.length;e++){var g=d[e];if("MAIN_OPAQUE"==g.type||"SHADOW_RECEIVE"==g.type||"MAIN_BLEND"==g.type||"MAIN_XRAY"==g.type)if(ya.mac_os_shadow_hack)g.v_light_tsr.set(c.view_tsr,9*a.shadow_lamp_index);else{var f=Na.get_trans_view(c.view_tsr),h=Na.get_scale(c.view_tsr),k=Na.get_quat_view(c.view_tsr);Wa.set(f[0],f[1],f[2],h,Sc);g.v_light_ts.set(Sc,4*a.shadow_lamp_index);g.v_light_r.set(k,
4*a.shadow_lamp_index)}}}function ga(a,b,c,d,e){for(var g=b.render,f=Da.get_scene_data(b,d).batches,h=0;h<f.length;h++){var k=f[h];"COLOR_ID"==k.type&&(e||(I(k,a,b,c,"COLOR_ID",d),L.update_shader(k),K(k)),"COLOR_PICKING"==a.type&&"COLOR_ID"==k.subtype||"COLOR_PICKING_XRAY"==a.type&&"COLOR_ID_XRAY"==k.subtype)&&(e||(L.set_batch_directive(k,"USE_OUTLINE",0),L.update_shader(k),K(k)),k=P(g,k),a.bundles.push(k))}}function aa(a,b,c,d,e){d||(e.dynamic_grass&&(d=na.find_subs(c,"GRASS_MAP"))&&N(e,d,b),L.update_shader(e),
K(e));b=P(b,e);a.bundles.push(b);v(c,a,e);B(e)}function ia(a,b){da(a,b);for(var c=0;c<a.cons_descends.length;c++)a.cons_descends[c].parent==a&&ia(a.cons_descends[c],b)}function da(a,b){a.render.hide=b;if(Da.is_lamp(a))for(var c=0;c<a.scenes_data.length;c++)for(var d=a.scenes_data[c],e=ja(d.scene,gc),g=0;g<e.length;g++)fa(a,d,e[g])}function ta(a,b){for(var c=ja(b,gc),d=a.light,e=a.render,g=Da.get_scene_data(a,b),f=g.light_index,h=Na.get_trans_view(e.world_tsr),e=Na.get_quat_view(e.world_tsr),k=0;k<
c.length;k++){var l=c[k];l.light_positions.set(h,3*f);l.light_directions.set(d.direction,3*f);l.light_color_intensities.set(d.color_intensity,3*f);switch(d.type){case "SUN":l.sun_quaternion.set(e);l.sun_intensity=d.color_intensity;"SKY"===l.type?(l.need_fog_update=d.need_sun_fog_update,Pa.copy(d.direction,l.sun_direction),W(b,l)):Pa.copy(d.direction,l.sun_direction);break;case "HEMI":case "POINT":case "SPOT":break;default:La.error("Unknown light type: "+d.type+'".')}fa(a,g,l);for(var n=0;n<l.bundles.length;n++){var m=
l.bundles[n].batch;m.lamp_uuid_indexes&&L.set_lamp_data(m,a)}}c=ha(b,"MAIN_OPAQUE").camera;g=g.shadow_subscenes;d=b._render.shadow_params;for(k=0;k<g.length;k++)l=g[k],Y.set_view_trans_quat(l.camera,h,e),ba(l,b,c,l.bundles,d,!0),ca(l,b._render.graph)}function fa(a,b,c){var d=a.render;a=a.light;b=b.light_index;var e=Bc;e[0]=a.use_diffuse&&!d.hide?1:0;e[1]=a.use_specular&&!d.hide?1:0;c.light_factors.set(e,2*b);c.need_perm_uniforms_update=!0}function ka(a){var b=Fa.get_scene_objs(a,"LAMP",Fa.DATA_ID_ALL),
b=Da.get_shadow_lamps(b,ya.ssao&&a.b4w_enable_ssao);if(b.length)for(var c=0;c<b.length;c++)for(var d=b[c],e=d.render,g=Na.get_trans_value(e.world_tsr,Rc),e=Na.get_quat_value(e.world_tsr,vd),f=0;f<d.scenes_data.length;f++){var h=d.scenes_data[f],k=h.shadow_subscenes;if(h.scene==a)for(h=0;h<k.length;h++)Y.set_view_trans_quat(k[h].camera,g,e)}}function W(a,b){va.prerender_subs(b);nb.draw(b);if(b.need_fog_update)for(var c=ja(a,Pb),d=0;d<c.length;d++)for(var e=c[d].bundles,g=0;g<e.length;g++){var f=e[g];
f.do_render&&(f=f.batch,L.check_batch_perm_uniform(f,"u_cube_fog")&&nb.update_batch_permanent_uniform(f,"u_cube_fog"))}}function A(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].data,e=0;e<d.materials.length;e++){var g=d.materials[e];-1==b.indexOf(g)&&b.push(g)}return b}function la(a,b,c){for(var d=a._render,e=Da.get_scene_data(a._camera,a).cameras,g=0;g<e.length;g++){var f=e[g];Y.set_projection(f,b/c);d.shadow_params&&Y.update_camera_shadows(f,d.shadow_params)}d.shadow_params&&(d.need_shadow_update=
!0,ha(a,"SHADOW_RECEIVE").need_perm_uniforms_update=!0,ha(a,"MAIN_BLEND").need_perm_uniforms_update=!0);var h=d.graph;na.traverse_slinks(h,function(d,e,g,f){if(d.update_dim){f=d.size_mult_x*b;var k=d.size_mult_y*c;if(e)for(e=0;e<g.slinks_internal.length;e++)g.slinks_internal[e]==d&&Ga.resize(d.texture,f,k);else switch(Ga.is_texture(d.texture)&&Ga.resize(d.texture,f,k),d=g.camera,d.width=f,d.height=k,g.type){case "DOF":sa(a,{dof_power:g.camera.dof_power,dof_on:g.camera.dof_on});break;case "GLOW_COMBINE":Ha(a,
{small_glow_mask_width:g.small_glow_mask_width,large_glow_mask_width:g.large_glow_mask_width});break;case "BLOOM":T(a,{bloom_blur:g.bloom_blur});break;case "OUTLINE":g=na.find_input(h,g,"POSTPROCESSING");d=na.find_input(h,g,"POSTPROCESSING");f=na.find_input(h,d,"POSTPROCESSING");k=na.find_input(h,f,"POSTPROCESSING");na.set_texel_size(g,1/b,1/c);na.set_texel_size(d,1/b,1/c);na.set_texel_size(f,1/b,1/c);na.set_texel_size(k,1/b,1/c);break;default:na.set_texel_size(g,1/b,1/c)}}})}function ja(a,b){for(var c=
[],d=0;d<b.length;d++){var e=b[d];ea.traverse(a._render.graph,function(a,b){b.type==e&&c.push(b)})}return c}function ha(a,b){return na.find_subs(a._render.graph,b)}function sa(a,b){var c=ha(a,"DOF");if(!c)return La.error("DOF is not enabled on the scene. Check camera settings"),0;var d=a._render.graph;"boolean"==typeof b.dof_on&&(c.camera.dof_on=b.dof_on);"number"==typeof b.dof_distance&&(c.camera.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.camera.dof_front=b.dof_front);"number"==
typeof b.dof_rear&&(c.camera.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.camera.dof_power=b.dof_power;var e=na.find_input(d,c,"POSTPROCESSING"),d=na.find_input(d,e,"POSTPROCESSING");na.set_texel_size_mult(e,c.camera.dof_power);na.set_texel_size(e,1/c.camera.width,1/c.camera.height);na.set_texel_size_mult(d,c.camera.dof_power);na.set_texel_size(d,1/c.camera.width,1/c.camera.height)}}function T(a,b){var c=ha(a,"LUMINANCE_TRUNCED"),d=ha(a,"BLOOM");if(!c||!d)return La.error("Bloom is not enabled on the scene"),
0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.need_perm_uniforms_update=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.need_perm_uniforms_update=!0);if("number"==typeof b.bloom_blur){var e=a._render.graph,c=na.find_input(e,d,"BLOOM_BLUR"),e=na.find_input(e,c,"BLOOM_BLUR");d.bloom_blur=b.bloom_blur;na.set_texel_size_mult(c,b.bloom_blur);na.set_texel_size(c,1/d.camera.width,1/d.camera.height);na.set_texel_size_mult(e,b.bloom_blur);na.set_texel_size(e,1/d.camera.width,
1/d.camera.height)}}function Ha(a,b){var c=ha(a,"GLOW_COMBINE");if(!c)return La.error("Glow is not enabled on the scene"),null;for(var d=a._render.graph,e=na.get_inputs(d,c),g=0;g<e.length;++g){var f=e[g];if("POSTPROCESSING"===f.type&&"GLOW_MASK_LARGE"===f.subtype)var h=f;if("POSTPROCESSING"===f.type&&"GLOW_MASK_SMALL"===f.subtype)var k=f}e=na.find_input(d,h,"POSTPROCESSING");d=na.find_input(d,k,"POSTPROCESSING");"number"==typeof b.small_glow_mask_coeff&&(c.small_glow_mask_coeff=b.small_glow_mask_coeff,
c.need_perm_uniforms_update=!0);"number"==typeof b.large_glow_mask_coeff&&(c.large_glow_mask_coeff=b.large_glow_mask_coeff,c.need_perm_uniforms_update=!0);"number"==typeof b.small_glow_mask_width&&(c.small_glow_mask_width=b.small_glow_mask_width,na.set_texel_size_mult(k,b.small_glow_mask_width),na.set_texel_size(k,1/c.camera.width,1/c.camera.height),k.need_perm_uniforms_update=!0,na.set_texel_size_mult(d,b.small_glow_mask_width),na.set_texel_size(d,1/c.camera.width,1/c.camera.height),d.need_perm_uniforms_update=
!0);"number"==typeof b.large_glow_mask_width&&(c.large_glow_mask_width=b.large_glow_mask_width,na.set_texel_size_mult(h,b.large_glow_mask_width),na.set_texel_size(h,1/c.camera.width,1/c.camera.height),h.need_perm_uniforms_update=!0,na.set_texel_size_mult(e,b.large_glow_mask_width),na.set_texel_size(e,1/c.camera.width,1/c.camera.height),e.need_perm_uniforms_update=!0)}function R(a,b,c){var d=a._render,e=d.water_params;if(!e.dynamic)return e.water_level;var g=e.waves_height,f=e.waves_length,h=e.water_level,
k=Pa.length(d.wind);a=ha(a,"MAIN_OPAQUE").time;k&&(a*=k);var l=Bc;l[0]=20/f*(b-.25*a);l[1]=20/f*(c-.25*a);k=Ka.cellular2x2(l);l[0]=17/f*(c+.1*a);l[1]=17/f*(b+.1*a);var l=Ka.cellular2x2(l),k=k+l-1,n=e.dst_noise_scale0,l=e.dst_noise_scale1,m=e.dst_noise_freq0,p=e.dst_noise_freq1,q=Bc;q[0]=n*(b+m*a);q[1]=n*(c+m*a);n=Ka.snoise(q);q[0]=l*(c-p*a);q[1]=l*(b-p*a);l=Ka.snoise(q);l*=g*n;if(e.shoremap_image)if(p=(b-e.shoremap_center[0])/e.shoremap_size[0],q=(e.shoremap_center[1]+c)/e.shoremap_size[1],p+=.5,
q+=.5,1<p||0>p||1<q||0>q)g=l;else{var d=Ka.get_array_smooth_value(d.shore_distances,e.shoremap_tex_size,p,q),q=e.dir_min_shore_fac,n=e.dir_freq,R=e.dir_noise_scale,Ba=e.dir_noise_freq,m=e.dir_min_noise_fac,p=e.dst_min_fac,e=f/e.max_shore_dist/Math.PI;c=[R/f*(b+Ba*a),R/f*(c+Ba*a)];b=Math.sqrt(d);g=g*Math.max(d,q)*Math.sin(b/e+n*a)*Math.max(Ka.snoise(c),m);a=Math.max(b,p);g=g*(1-a)+l*a;k*=d}else g=l;return h+(g+.05*k)}function V(a,b,c){b.is_for_outline&&"POSTPROCESSING"==b.type&&c.do_render!=b.do_render&&
(b.do_render=c.do_render);c.do_render||"OUTLINE"!=b.type||(b.draw_outline_flag=0)}function Z(a,b,c,d){var e=ea.get_node_attr(a,b);Y.set_attachment(e.camera,c,d);e.assign_texture=!0;ea.traverse_outputs(a,b,function(b,e,g){g.active&&g.from==c&&na.check_slink_tex_conn(g)&&qa(a,b,g.to,d)});ea.traverse_inputs(a,b,function(b,e,g){g.active&&g.from==c&&g.from==g.to&&Z(a,b,c,d)})}function qa(a,b,c,d){a=ea.get_node_attr(a,b).bundles;for(b=0;b<a.length;b++)L.replace_texture(a[b].batch,d,c)}function Aa(a){var b=
ha(a,"GRASS_MAP");if(b){var c=b.camera,d=a._camera.render;a=Na.get_trans_view(d.world_tsr);var e=Rc;e[0]=0;e[1]=-b.grass_map_dim[2]/2;e[2]=0;b=Na.get_quat_view(d.world_tsr);Pa.transformQuat(e,b,e);e[0]+=a[0];e[1]=0;e[2]+=a[2];b=vd;b[0]=0;b[1]=0;b[2]=0;b[3]=1;Y.set_view_trans_quat(c,e,b)}}function U(a,b){ea.traverse(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.slinks_internal[0]||!d.textures_internal[0])throw"Wrong MOTION_BLUR subscene";var e=d.slinks_internal[0],g=d.textures_internal[0];d.textures_internal[0]=
d.camera.color_attachment;ea.traverse_outputs(a,c,function(b,c,d){d.active&&qa(a,b,d.to,g)});Z(a,c,e.from,g);qa(a,c,e.to,d.textures_internal[0]);d.motion_blur_exp=Math.exp(-b/d.mb_factor)}})}function oa(a){return a._render.wind}function pa(a,b){if(!a._render.reflection_params)return null;for(var c=a._render.reflection_params.cube_refl_subs,d=0;d<c.length;d++)if(c[d]==b)return d;c=a._render.reflection_params.cube_refl_subs_blend;for(d=0;d<c.length;d++)if(c[d]==b)return d;return null}var L=r("__batch"),
ma=r("__boundings"),Y=r("__camera"),wa=r("__config"),xa=r("__container"),Ea=r("__debug"),za=r("__geometry"),ea=r("__graph"),Ta=r("__hud");r("__lights");var Ia=r("__mat4"),ra=r("__nodemat"),Fa=r("__objects"),Da=r("__obj_util"),Ba=r("__physics"),va=r("__prerender"),zc=r("__primitives"),La=r("__print"),nb=r("__renderer"),na=r("__scenegraph"),yb=r("__sfx"),ua=r("__shaders"),Ga=r("__textures"),Na=r("__tsr"),Ka=r("__util"),Pa=r("__vec3"),Wa=r("__vec4"),ya=wa.defaults,bc=wa.outlining,Ib=wa.scenes,sc="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_PLANE_REFLECT_BLEND MAIN_CUBE_REFLECT_BLEND COLOR_PICKING COLOR_PICKING_XRAY SHADOW_RECEIVE OUTLINE_MASK DEBUG_VIEW".split(" ");
a.OBJECT_SUBSCENE_TYPES=sc;var gc="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY MAIN_PLANE_REFLECT_BLEND MAIN_CUBE_REFLECT_BLEND LUMINANCE_TRUNCED SHADOW_RECEIVE SHADOW_CAST COLOR_PICKING COLOR_PICKING_XRAY OUTLINE_MASK".split(" "),Pb="MAIN_OPAQUE SSAO MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_PLANE_REFLECT_BLEND MAIN_CUBE_REFLECT_BLEND".split(" "),Ac="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_PLANE_REFLECT_BLEND MAIN_CUBE_REFLECT_BLEND COLOR_PICKING COLOR_PICKING_XRAY SHADOW_RECEIVE GOD_RAYS OUTLINE_MASK DEBUG_VIEW".split(" "),
Dd="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_PLANE_REFLECT_BLEND MAIN_CUBE_REFLECT_BLEND".split(" "),hc=null,ob=null,Ja=[],Qb=null,Mc=Math.PI/2,Bc=new Float32Array(2),Rc=new Float32Array(3),vd=new Float32Array(4),Sc=new Float32Array(4),kd=new Float32Array(16),zb=new Float32Array(24),Rb=new Float32Array(24),Wb=ma.zero_bounding_box(),rb=ma.zero_bounding_box(),tc=0,bb=-Infinity;a.create_scene_render=function(){return{}};a.set_active=function(a){ob=a;yb.set_active_scene(a)};
a.prepare_rendering=function(a,b){var c=a._render,d=na.create_rendering_queue(c.graph);if(a==b){la(a,xa.get_viewport_width(),xa.get_viewport_height());for(var e=0;e<d.length;e++)a._render.queue.push(d[e])}else for(e=a._render_to_textures[0],la(a,e._render.source_size,e._render.source_size),e=0;e<d.length;e++)b._render.queue.push(d[e]);d=ja(a,Ac);for(e=0;e<d.length;e++)d[e].wind.set(c.wind);for(e=0;e<c.queue.length;e++)"SHADOW_CAST"==c.queue[e].type&&nb.draw(c.queue[e])};a.get_main=function(){hc||
(hc=u(Ja));return hc};a.find_main_scene=u;a.get_active=c;a.check_active=function(){return ob?!0:!1};a.get_camera=function(a){return a._camera};a.get_all_scenes=function(){return Ja};a.get_rendered_scenes=function(){if(1==Ja.length)return Ja;for(var a=0;a<Ja.length;a++){var b=Ja[a]._render.graph;ea.traverse(b,function(b,c){for(var d=0;d<c.bundles.length;d++){for(var e=c.bundles[d].batch.textures,g=null,f=0;f<e.length;f++)if("SCENE"==e[f].source&&e[f].source_id==Ja[a].name&&"COPY"!=c.type){La.error('Texture-scene loop detected. A scene is rendered to texture "'+
e[f].name+'" yet this texture belongs to the same scene.');ea.node_by_attr(Qb,Ja[a]);g=c.bundles[d].batch;break}g&&(g.textures=[],g.texture_names=[],L.update_batch_material_error(g,null),L.update_shader(g))}})}for(var c=[],a=0;a<Ja.length;a++)if(b=Ja[a],!b._render_to_textures.length){b=ea.node_by_attr(Qb,b);ea.enforce_acyclic(Qb,b);b=ea.subgraph_node_conn(Qb,b,ea.BACKWARD_DIR);b=ea.topsort(b);ea.traverse(b,function(a,b){c.push(b)});break}return c};a.append_scene=function(a,c,h,R,Ba){a._render_to_textures=
a._render_to_textures||[];a._nla=null;var v=a._render,B=Da.get_scene_data(a._camera,a),r=a._camera.render;v.video_textures=[];var V=a.world;v.lamps_number=h.length;v.sun_exist=d(h);v.sky_params=g(V,v.sun_exist);v.world_light_set=y(V,v.sky_params);v.world_fog_set=z(V);v.anchor_visibility=Q(a,Ba);if(Ba=!a._render_to_textures.length)B.cameras[0].type!=Y.TYPE_PERSP&&"HMD"==ya.stereo?(La.warn("Head-mounted display stereo is disabled for the non-perspective camera"),Ba=!1):Ba="HMD"==ya.stereo;v.hmd_stereo_use=
Ba;if(Ba=!a._render_to_textures.length)B.cameras[0].type!=Y.TYPE_PERSP&&"ANAGLYPH"==ya.stereo?(La.warn("Anaglyph stereo is disabled for the non-perspective camera"),Ba=!1):Ba="ANAGLYPH"==ya.stereo;v.anaglyph_use=Ba;v.reflection_params=w(a,c,R);v.bloom_params=l(a);v.mb_params=t(a);v.cc_params=F(a);v.god_rays_params=H(a);v.outline_params=C(a);v.glow_params=x(a);v.dof=ya.dof&&(0<r.dof_distance||r.dof_object);v.motion_blur=ya.motion_blur&&a.b4w_enable_motion_blur;v.compositing=ya.compositing&&a.b4w_enable_color_correction;
v.antialiasing=ya.antialiasing&&1==ya.msaa_samples&&"NONE"!=a.b4w_antialiasing_quality;v.ssao=ya.ssao&&a.b4w_enable_ssao;v.god_rays=ya.god_rays&&a.b4w_enable_god_rays&&v.sun_exist;v.depth_tex=ya.depth_tex_available;v.glow_over_blend=a.b4w_glow_settings.render_glow_over_blend;v.ssao_params=m(a);Ba=f(R);v.materials_params=Ba;v.refractions=D(a,Ba);v.shadow_params=b(a,h,R);v.water_params=p(R);v.xray=G(R);v.soft_particles=k(R);v.shore_smoothing=q(R);v.dynamic_grass=E(a,R);v.color_picking=e(a,R);v.outline=
n(a,R);v.glow_materials=M(a,R);switch(a.b4w_reflection_quality){case "LOW":v.cubemap_refl_size=Ib.cube_reflect_low;v.plane_refl_size=Ib.plane_reflect_low;break;case "MEDIUM":v.cubemap_refl_size=Ib.cube_reflect_medium;v.plane_refl_size=Ib.plane_reflect_medium;break;case "HIGH":v.cubemap_refl_size=Ib.cube_reflect_high;v.plane_refl_size=Ib.plane_reflect_high;break;default:v.cubemap_refl_size=Ib.cube_reflect_low,v.plane_refl_size=Ib.plane_reflect_low}if(xa.is_hidpi())La.log("%cENABLE HIDPI MODE","color: #00a"),
v.aa_quality="AA_QUALITY_LOW",v.resolution_factor=1,ya.msaa_samples=1;else if(1<ya.msaa_samples)La.log("%cENABLE MSAA RENDERING: "+ya.msaa_samples+"x","color: #00a"),v.resolution_factor=1;else{v.aa_quality="AA_QUALITY_"+a.b4w_antialiasing_quality;switch(a.b4w_antialiasing_quality){case "LOW":v.antialiasing&&(v.resolution_factor=1);break;case "MEDIUM":ya.quality==wa.P_LOW||ya.quality==wa.P_HIGH?v.resolution_factor=1:ya.quality==wa.P_ULTRA&&(v.resolution_factor=1.33);break;case "HIGH":ya.quality==wa.P_LOW?
v.resolution_factor=1:ya.quality==wa.P_HIGH?v.resolution_factor=1.33:ya.quality==wa.P_ULTRA&&(v.resolution_factor=2);break;case "NONE":ya.quality==wa.P_LOW||ya.quality==wa.P_HIGH?v.resolution_factor=1:ya.quality==wa.P_ULTRA&&(v.resolution_factor=2)}ya.quality==wa.P_CUSTOM&&(v.resolution_factor=1)}h=a._render_to_textures.sort(function(a,b){return b._render.source_size-a._render.source_size});v.graph=na.create_rendering_graph(v,B,r,h);v.queue=[];v.need_shadow_update=!1;v.need_grass_map_update=!1;v.need_outline=
!1;v.wind=new Float32Array(3);Ja.push(a);Qb||(Qb=ea.create());ea.append_node_attr(Qb,a);for(v=0;v<c.length;v++)Da.scene_data_set_active(c[v],!0,a);a=xa.get_container();xa.resize(a.clientWidth,a.clientHeight,!0)};a.append_scene_vtex=function(a,b,c){for(var d=0;d<b.length;d++)b[d]._render&&b[d]._render.is_movie&&(b[d]._render.vtex_data_id=c,a._render.video_textures.push(b[d]))};a.get_graph=function(a){return a._render.graph};a.generate_auxiliary_batches=function(a){ea.traverse(a,function(b,c){var d=
null;switch(c.type){case "POSTPROCESSING":d=L.create_postprocessing_batch(c.pp_effect);break;case "SSAO":d=L.create_ssao_batch(c);break;case "SSAO_BLUR":d=L.create_ssao_blur_batch(c);break;case "DEPTH_PACK":d=L.create_depth_pack_batch();break;case "GOD_RAYS":d=na.find_input(a,c,"RESOLVE")||na.find_input(a,c,"DEBUG_VIEW")||na.find_input(a,c,"MAIN_BLEND")||na.find_input(a,c,"GOD_RAYS");d=L.create_god_rays_batch(d.camera.color_attachment,c.pack,c.water,c.steps_per_pass);break;case "GOD_RAYS_COMBINE":var d=
na.find_input(a,c,"RESOLVE")||na.find_input(a,c,"DEBUG_VIEW")||na.find_input(a,c,"MAIN_BLEND"),e=na.find_input(a,c,"GOD_RAYS"),d=L.create_god_rays_combine_batch(d.camera.color_attachment,e.camera.color_attachment);break;case "MOTION_BLUR":d=L.create_motion_blur_batch(c.mb_decay_threshold);break;case "DOF":var d=L.create_dof_batch(),e=na.find_input(a,c,"POSTPROCESSING"),g=na.find_input(a,e,"POSTPROCESSING");na.set_texel_size_mult(e,c.camera.dof_power);na.set_texel_size_mult(g,c.camera.dof_power);break;
case "OUTLINE":var d=L.create_outline_batch(),e=na.find_input(a,c,"POSTPROCESSING"),g=na.find_input(a,e,"POSTPROCESSING"),f=na.find_input(a,g,"POSTPROCESSING"),h=na.find_input(a,f,"POSTPROCESSING");na.set_texel_size_mult(g,c.blur_texel_size_mult);na.set_texel_size_mult(e,c.blur_texel_size_mult);na.set_texel_size_mult(h,c.ext_texel_size_mult*c.outline_factor);na.set_texel_size_mult(f,c.ext_texel_size_mult*c.outline_factor);break;case "GLOW_COMBINE":d=L.create_glow_combine_batch();break;case "COMPOSITING":d=
L.create_compositing_batch();break;case "ANTIALIASING":d=L.create_antialiasing_batch(c);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=L.create_smaa_batch(c.type);break;case "STEREO":d=L.create_stereo_batch(c.subtype);break;case "SKY":d=L.create_procedural_sky_batch();break;case "LUMINANCE":d=L.create_luminance_batch();break;case "AVERAGE_LUMINANCE":d=L.create_average_luminance_batch();break;case "LUMINANCE_TRUNCED":d=
L.create_luminance_trunced_batch();break;case "BLOOM_BLUR":d=L.create_bloom_blur_batch();break;case "BLOOM":d=na.find_input(a,c,"BLOOM_BLUR");e=na.find_input(a,d,"BLOOM_BLUR");na.set_texel_size_mult(d,c.bloom_blur);na.set_texel_size_mult(e,c.bloom_blur);d=L.create_bloom_combine_batch();break;case "VELOCITY":d=L.create_velocity_batch();break;case "ANCHOR_VISIBILITY":d=L.create_anchor_visibility_batch();break;case "PERFORMANCE":d=L.create_performance_batch()}d&&(e=P(Da.create_render("NONE"),d),K(d),
c.bundles.push(e),v(a,c,d),B(d))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":case "LINE":case "WORLD":var d=a._render.graph,e=b.render;!na.find_subs(d,"SHADOW_CAST")&&e.shadow_receive&&(e.shadow_receive=!1);e=ja(a,sc);c&&b.use_obj_physics&&Ba.append_object(b,a);for(var g=0;g<e.length;g++){var f=e[g],h=b,k=d,l=a,n=c;switch(f.type){case "MAIN_OPAQUE":S(f,h,k,"OPAQUE",l,n);break;case "MAIN_BLEND":S(f,h,k,"BLEND",l,n);break;case "MAIN_XRAY":S(f,h,k,"XRAY",l,n);break;case "MAIN_GLOW":S(f,
h,k,"GLOW",l,n);break;case "MAIN_PLANE_REFLECT":case "MAIN_CUBE_REFLECT":J(f,h,k,!1,l,n);break;case "MAIN_PLANE_REFLECT_BLEND":case "MAIN_CUBE_REFLECT_BLEND":J(f,h,k,!0,l,n);break;case "SHADOW_RECEIVE":for(var m=Da.get_scene_data(h,l).batches,p=0;p<m.length;p++){var q=m[p];if("SHADOW"==q.type&&"RECEIVE"==q.subtype){n||(I(q,f,h,k,"SHADOW",l),L.update_shader(q),K(q));var R=P(h.render,q);f.bundles.push(R);v(k,f,q);B(q)}}break;case "SHADOW_CAST":m=!1;p=h.render;h=Da.get_scene_data(h,l).batches;q=na.find_subs(k,
"GRASS_MAP");for(R=0;R<h.length;R++){var t=h[R];if("SHADOW"==t.type&&"CAST"==t.subtype){m=!0;if(!n){var w=f.num_lights;L.set_batch_directive(t,"NUM_LIGHTS",w);L.set_batch_directive(t,"NUM_LFACTORS",0==w%2?w/2:Math.floor(w/2)+1);ua.set_directive(t.shaders_info,"SHADOW_USAGE","SHADOW_CASTING");t.dynamic_grass&&q&&N(t,q,p);L.set_batch_directive(t,"SHADOW_TEX_RES",ua.glsl_value(l._render.shadow_params.csm_resolution));L.update_shader(t);K(t)}t=P(p,t);f.bundles.push(t)}}m&&(h=l._render.shadow_params,n=
na.find_subs(k,"MAIN_OPAQUE"),ba(f,l,n.camera,f.bundles,h,!0));break;case "COLOR_PICKING":ga(f,h,k,l,n);break;case "COLOR_PICKING_XRAY":ga(f,h,k,l,n);break;case "OUTLINE_MASK":k=h.render;h=Da.get_scene_data(h,l).batches;for(l=0;l<h.length;l++)m=h[l],"COLOR_ID"==m.type&&"OUTLINE"==m.subtype&&(n||(L.set_batch_directive(m,"USE_OUTLINE",1),L.update_shader(m),K(m)),m=P(k,m),f.bundles.push(m));break;case "GRASS_MAP":k=h.render;h=Da.get_scene_data(h,l).batches;for(l=0;l<h.length;l++)m=h[l],"GRASS_MAP"==
m.type&&(n||(L.update_shader(m),K(m)),m=P(k,m),f.bundles.push(m),m=f.camera,t=k.bb_world,p=f.grass_map_dim[0],q=f.grass_map_dim[1],R=f.grass_map_dim[2],0==p&&0==q?(p=t.min_y,q=t.max_y):(p=Math.min(p,t.min_y),q=Math.max(q,t.max_y)),t=1E-4*(q-p),p-=t,q+=t,f.grass_map_dim[0]=p,f.grass_map_dim[1]=q,Y.set_frustum(m,R/2,-q,-p,R/2),Y.set_projection(m));break;case "DEBUG_VIEW":for(m=h.render,h=Da.get_scene_data(h,l).batches,l=0;l<h.length;l++)p=h[l],"DEBUG_VIEW"==p.type&&aa(f,m,k,n,p)}}break;case "LAMP":ta(b,
a),Fa.sort_lamps(a)}Da.scene_data_set_active(b,!0,a)};a.schedule_shadow_update=function(a){a._render.need_shadow_update=!0};a.update_shadow_billboard_view=function(a,b){ea.traverse(b,function(b,c){if("SHADOW_CAST"===c.type){var d=Na.get_trans_view(a.world_tsr);Na.set_trans(d,c.camera.world_tsr);Na.copy(a.view_tsr,c.camera.shadow_cast_billboard_view_tsr)}})};a.update_shadow_receive_subs=ca;a.get_csm_borders=function(a,b){for(var c=a._render.shadow_params,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=
Y.csm_far_plane(c,b,e);return d};a.append_debug_view_batch=aa;a.change_visibility_rec=ia;a.change_visibility=da;a.is_hidden=function(a){return a.render.hide};a.remove_object_bundles=function(a,b,c){b=b.render;a=ja(a,sc);for(var d=0;d<a.length;d++)for(var e=a[d].bundles,g=e.length-1;0<=g;g--){var f=e[g];f.obj_render==b&&(f.batch&&c&&za.cleanup_bufs_data(f.batch.bufs_data),e.splice(g,1))}};a.update_lamp_scene_color_intensity=function(a,b){for(var c=a.light,d=Da.get_scene_data(a,b).light_index,e=ja(b,
gc),g=0;g<e.length;g++){var f=e[g];f.light_color_intensities.set(c.color_intensity,3*d);f.need_perm_uniforms_update=!0}};a.update_lamp_scene=ta;a.cleanup=function(){for(var a=0;a<Ja.length;a++){var b=Ja[a];ea.traverse(b._render.graph,function(a,b){if("SINK"!=b.type){var c=b.camera;nb.render_target_cleanup(c.framebuffer,c.color_attachment,c.depth_attachment,c.width,c.height);for(var c=b.bundles,d=0;d<c.length;d++){var e=c[d].batch;e&&L.clear_batch(e)}}});b._render.graph=[];b._render.queue=[]}ob=hc=
null;Ja.length=0;Qb=null};a.make_frustum_shot=function(a,b,c){a=Y.extract_frustum_corners(a,a.near,a.far,null,!0);var d=zc.generate_frustum(a);a=Da.create_render("DYNAMIC");a.bb_world=a.bb_local=ma.big_bounding_box();a.bs_world=a.bs_local=ma.big_bounding_sphere();var e=a.bs_world.radius;a.be_world=a.be_local=ma.create_bounding_ellipsoid([e,0,0],[0,e,0],[0,0,e],a.bs_world.center);c=L.create_shadeless_batch(d,c,.5);c=P(a,c);b.bundles.push(c)};a.get_scene_timeline=function(a){return[a.frame_start,a.frame_end]};
a.setup_dim=function(a,b,c){xa.setup_viewport_dim(a,b,c);ob&&la(ob,a,b)};a.setup_scene_dim=la;a.subs_array=ja;a.get_subs=ha;a.get_environment_colors=function(a){a=ha(a,"MAIN_OPAQUE");var b=a.horizon_color,c=a.zenith_color,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.environment_energy,d,e]};a.set_environment_colors=function(a,b,c,d){a=ja(a,gc);for(var e=0;e<a.length;e++){var g=a[e];g.horizon_color.set(c);g.zenith_color.set(d);g.environment_energy=b;g.need_perm_uniforms_update=
!0}};a.get_sky_params=function(a){if(a=ha(a,"SKY")){var b={};b.color=Array(3);Pa.copy(a.sky_color,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=
a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=ha(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.sky_color.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&
(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=
b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.need_perm_uniforms_update=!0,c.need_fog_update=!0,W(a,c))};a.get_fog_intensity=function(a){return ja(a,Pb)[0].fog_params[0]};a.get_fog_depth=function(a){return ja(a,Pb)[0].fog_params[1]};a.get_fog_start=function(a){return ja(a,Pb)[0].fog_params[2]};a.get_fog_height=function(a){return ja(a,Pb)[0].fog_params[3]};a.set_fog_intensity=function(a,b){for(var c=ja(a,Pb),d=0;d<c.length;d++){var e=c[d];e.fog_params[0]=
b;e.need_perm_uniforms_update=!0}};a.set_fog_depth=function(a,b){for(var c=ja(a,Pb),d=0;d<c.length;d++){var e=c[d];e.fog_params[1]=b;e.need_perm_uniforms_update=!0}};a.set_fog_start=function(a,b){for(var c=ja(a,Pb),d=0;d<c.length;d++){var e=c[d];e.fog_params[2]=b;e.need_perm_uniforms_update=!0}};a.set_fog_height=function(a,b){for(var c=ja(a,Pb),d=0;d<c.length;d++){var e=c[d];e.fog_params[3]=b;e.need_perm_uniforms_update=!0}};a.get_fog_color_density=function(a,b){var c=b||[],d=ja(a,Pb)[0].fog_color_density;
c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=ja(a,Pb),d=0;d<c.length;d++){var e=c[d];e.fog_color_density.set(b);e.need_perm_uniforms_update=!0}};a.get_ssao_params=function(a){var b=ha(a,"SSAO");a=ha(a,"SSAO_BLUR");if(!b)return null;var c=b.bundles[0].batch,d={};d.ssao_quality=L.get_batch_directive(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.blur_discard_value=a.ssao_blur_discard_value;d.radius_increase=
b.ssao_radius_increase;d.influence=b.ssao_influence;d.dist_factor=b.ssao_dist_factor;d.ssao_only=b.ssao_only;d.ssao_white=L.get_batch_directive(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=ha(a,"SSAO"),d=ha(a,"SSAO_BLUR");if(!c)return La.error("SSAO is not enabled on the scene"),0;if("string"==typeof b.ssao_quality){var e=c.bundles[0].batch;L.set_batch_directive(e,"SSAO_QUALITY",b.ssao_quality);L.update_shader(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.bundles[0].batch,L.set_batch_directive(e,
"SSAO_HEMISPHERE",b.ssao_hemisphere),L.update_shader(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.bundles[0].batch,L.set_batch_directive(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),L.update_shader(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.ssao_radius_increase&&(c.ssao_radius_increase=b.ssao_radius_increase);"number"==typeof b.ssao_influence&&(c.ssao_influence=b.ssao_influence);"number"==typeof b.ssao_dist_factor&&(c.ssao_dist_factor=
b.ssao_dist_factor);if("number"==typeof b.ssao_only){c=ha(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var g=0;g<c.bundles.length;g++)e=c.bundles[g].batch,L.set_batch_directive(e,"SSAO_ONLY",b.ssao_only),L.update_shader(e,!0)}"number"==typeof b.ssao_white&&(e=c.bundles[0].batch,L.set_batch_directive(e,"SSAO_WHITE",b.ssao_white),L.update_shader(e,!0));c.need_perm_uniforms_update=!0;d.need_perm_uniforms_update=!0};a.get_dof_params=function(a){a=ha(a,"DOF");if(!a)return null;var b={};b.dof_distance=
a.camera.dof_distance;b.dof_front=a.camera.dof_front;b.dof_rear=a.camera.dof_rear;b.dof_power=a.camera.dof_power;b.dof_object=a.camera.dof_object;return b};a.set_dof_params=sa;a.get_god_rays_params=function(a){var b=ja(a,["GOD_RAYS"]);a=ha(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].max_ray_length;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=L.get_batch_directive(b[0].bundles[0].batch,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,
b){var c=ja(a,["GOD_RAYS"]),d=ha(a,"GOD_RAYS_COMBINE");if(!c||!d)return La.error("God Rays are not enabled on the scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,g=0;g<c.length;g++)c[g].max_ray_length=e,c[g].radial_blur_step=e/c[g].steps_per_pass/(g+1),c[g].need_perm_uniforms_update=!0;if("number"==typeof b.god_rays_steps)for(var f=ua.glsl_value(b.god_rays_steps,1),e=c[0].max_ray_length,
g=0;g<c.length;g++){c[g].steps_per_pass=f;c[g].radial_blur_step=e/f/(g+1);c[g].need_perm_uniforms_update=!0;var h=c[g].bundles[0].batch;L.set_batch_directive(h,"STEPS_PER_PASS",f);L.update_shader(h,!0)}d.need_perm_uniforms_update=!0};a.get_bloom_params=function(a){var b=ha(a,"LUMINANCE_TRUNCED");a=ha(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=T;a.get_glow_material_params=function(a){a=ha(a,
"GLOW_COMBINE");if(!a)return null;var b={};b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b};a.set_glow_material_params=Ha;a.get_wind_params=function(a){var b=oa(a);a=Pa.length(b);if(0==a)return null;var b=Ka.rad_to_deg(Math.atan2(b[0],b[2])),c={};c.wind_dir=b;c.wind_strength=a;return c};a.schedule_grass_map_update=function(a){a._render.need_grass_map_update=
!0};a.get_water_surface_level=R;a.get_water_mat_params=function(a,b){var c=a._render.water_params,d=ha(a,"MAIN_OPAQUE");d&&c&&(b.waves_height=c.waves_height,b.waves_length=c.waves_length,d.water_fog_color_density&&(b.water_fog_density=d.water_fog_color_density[3],c=b.water_fog_color=[],c[0]=d.water_fog_color_density[0],c[1]=d.water_fog_color_density[1],c[2]=d.water_fog_color_density[2]))};a.set_water_params=function(a,b){var c=a._render.water_params;if(!c)return La.error("set_water_params() - no water parameters on the scene"),
null;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);
"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.dynamic=b.water_dynamic);for(var d=ja(a,Dd),e=0;e<d.length;e++){var g=d[e];"number"==typeof b.water_fog_density&&c.fog_color_density&&(g.water_fog_color_density[3]=b.water_fog_density);
"object"==typeof b.water_fog_color&&c.fog_color_density&&g.water_fog_color_density.set(b.water_fog_color);"number"==typeof b.waves_height&&(g.water_waves_height=b.waves_height);"number"==typeof b.waves_length&&(g.water_waves_length=b.waves_length);g.need_perm_uniforms_update=!0}};a.get_shore_dist=function(a,b,c){var d=a._render.water_params;if(!d.shoremap_image)return 100;var e=d.max_shore_dist;a=d.water_level;var g=(b[0]-d.shoremap_center[0])/d.shoremap_size[0],f=(d.shoremap_center[1]+b[2])/d.shoremap_size[1],
g=g+.5,f=f+.5;if(1<g||0>g||1<f||0>f)b=1;else return d=e*Ka.get_array_smooth_value(ob._render.shore_distances,d.shoremap_tex_size,g,f),b=(a-b[1])*c,b=Math.sqrt(d*d+b*b)};a.update=function(a,b){for(var d=c()._camera.render,e=0;e<Ja.length;e++){var g=Ja[e],f=g._render.graph,h=g._render;if(h.water_params)var k=Na.get_trans_view(d.world_tsr),l=k[1]-R(g,k[0],k[2]);for(k=0;k<h.video_textures.length;k++){var n=h.video_textures[k]._render,m=n.video_file,p=n.seq_video;if(!(g.b4w_use_nla&&n.use_nla||!m&&!p)&&
Ga.video_is_played(n)){var q=Ga.video_get_current_frame(n),Ba=Ga.video_get_start_frame(n);m&&ya.is_mobile_device&&(Ba-=5);var v=Ga.video_get_end_frame(n);q>=v&&n.use_cyclic||q<Ba?(Ga.reset_video(n.name,n.vtex_data_id),p&&(n.seq_last_discrete_mark=Ga.seq_video_get_discrete_timemark(n,a))):q>=v&&!n.use_cyclic?Ga.pause_video(n.name,n.vtex_data_id):Ga.video_update_is_available(n)&&(m?Ga.update_video_texture(n):(m=Ga.seq_video_get_discrete_timemark(n,a),m!=n.seq_last_discrete_mark&&(Ga.update_seq_video_texture(n),
n.seq_cur_frame++),n.seq_last_discrete_mark=m))}}ea.traverse(f,function(b,c){-1<Ac.indexOf(c.type)&&(c.time=a);h.water_params&&(c.cam_water_depth=l)})}for(e=0;e<Ja.length;e++)if(g=Ja[e],h=g._render,f=h.graph,d=h.queue,d.length)for(h.need_shadow_update&&(X(g),h.need_shadow_update=!1),h.need_grass_map_update&&(Aa(g),h.need_grass_map_update=!1),h.need_outline&&(O(g),h.need_outline=!1),h.motion_blur&&U(f,b),g=na.find_subs(f,"OUTLINE_MASK"),k=0;k<d.length;k++)n=d[k],va.prerender_subs(n),g&&V(f,n,g),nb.draw(n);
ya.show_hud_debug_info&&Ta.show_debug_info(Ja,b)};a.request_outline=function(a){a._render.need_outline=!0};a.get_all_subscenes=function(a){var b=[];ea.traverse(a._render.graph,function(a,c){b.push(c)});return b};a.get_cam_water_depth=function(){var a=ha(ob,"MAIN_BLEND"),b=ob;return a||b._render.water_params?a.cam_water_depth:null};a.get_object_data_id=function(a){return a.render.data_id};a.update_scene_permanent_uniforms=function(a){ea.traverse(a._render.graph,function(a,b){b.need_perm_uniforms_update=
!0})};a.set_debug_view_mode=function(a,b){a.do_render=b!=Ea.DV_NONE;for(var c=0;c<a.bundles.length;c++)a.bundles[c].batch.debug_view_mode=b;a.blend=b==Ea.DV_TRANSPARENT_WIREFRAME;a.need_perm_uniforms_update=!0};a.set_debug_colors_seed=function(a,b){a.debug_colors_seed=b;a.need_perm_uniforms_update=!0};a.set_wireframe_edge_color=function(a,b){for(var c=0;c<a.bundles.length;c++)a.bundles[c].batch.wireframe_edge_color=b,a.need_perm_uniforms_update=!0};a.update_force_scene=function(a,b){var c=b.field,
d=a._render.wind;if(c&&"WIND"==c.type&&d){var e=Na.get_quat_view(b.render.world_tsr);Ka.quat_to_dir(e,Ka.AXIS_Y,d);Pa.normalize(d,d);Pa.scale(d,c.strength,d);c=ja(a,Ac);for(e=0;e<c.length;e++)c[e].wind.set(d)}};a.pick_color=function(a,b,c){var d=ha(a,"COLOR_PICKING");if(d)return b=xa.canvas_to_viewport_coords(b,c,Bc,d.camera),va.prerender_subs(d,d.camera),nb.draw(d,d.bundles),(a=ha(a,"COLOR_PICKING_XRAY"))?(va.prerender_subs(a,a.camera),nb.draw(a,a.bundles),d=a.camera):d=d.camera,b[1]=d.height-b[1],
nb.read_pixels(d.framebuffer,b[0],b[1]);La.error("Object Selection is not available on the scene");return null};a.set_outline_color=function(a){var b=c();if(b=ha(b,"OUTLINE"))b.outline_color.set(a),b.need_perm_uniforms_update=!0};a.get_wind=oa;a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};a.update_cube_reflect_subs=function(a,b){var c=Rc;Pa.negate(b,c);for(var d=0;6>d;d++){var e=a.cube_view_matrices[d],
g=a.cube_cam_frustums[d],f=a.camera;Ia.translate(Ka.INV_CUBE_VIEW_MATRS[d],c,e);Ia.multiply(f.proj_matrix,e,f.view_proj_matrix);Ka.extract_frustum_planes(f.view_proj_matrix,g)}};a.update_plane_reflect_subs=function(a,b,c){Ka.trans_quat_to_plane(b,c,Ka.AXIS_Y,a.camera.reflection_plane)};a.assign_scene_data_subs=function(a,b,c){var d=a._render.shadow_params,e=a._render.reflection_params;c=Da.get_shadow_lamps(c,ya.ssao&&a.b4w_enable_ssao);if(e)for(var g=0;g<b.length;g++){var f=b[g],h=Da.get_scene_data(f,
a);if(null!=f.render.plane_reflection_id){var k=e.plane_refl_subs,l=e.plane_refl_subs_blend,f=f.render.plane_reflection_id;l.length?h.plane_refl_subs=l[f]:k.length&&(h.plane_refl_subs=k[f])}else null!=f.render.cube_reflection_id&&(k=e.cube_refl_subs,l=e.cube_refl_subs_blend,f=f.render.cube_reflection_id,l.length?h.cube_refl_subs=l[f]:k.length&&(h.cube_refl_subs=k[f]))}for(g=0;g<c.length;g++)if(h=Da.get_scene_data(c[g],a),d)for(b=ja(a,["SHADOW_CAST"]),e=0;e<b.length;e++)g==b[e].shadow_lamp_index&&
h.shadow_subscenes.push(b[e])};a.marker_frame=function(a,b){return a.timeline_markers[b]};a.set_hmd_params=function(a){var b=c();if(b=ha(b,"STEREO"))a.distortion_coefs&&(b.distortion_params[0]=a.distortion_coefs[0],b.distortion_params[1]=a.distortion_coefs[1],b.need_perm_uniforms_update=!0),a.chromatic_aberration_coefs&&(b.chromatic_aberration_coefs[0]=a.chromatic_aberration_coefs[0],b.chromatic_aberration_coefs[1]=a.chromatic_aberration_coefs[1],b.chromatic_aberration_coefs[2]=a.chromatic_aberration_coefs[2],
b.chromatic_aberration_coefs[3]=a.chromatic_aberration_coefs[3],b.need_perm_uniforms_update=!0),a.base_line_factor&&(b.distortion_params[2]=a.base_line_factor,b.need_perm_uniforms_update=!0),a.inter_lens_factor&&(b.distortion_params[3]=a.inter_lens_factor,b.need_perm_uniforms_update=!0),a.enable_hmd_stereo&&(b.enable_hmd_stereo=a.enable_hmd_stereo,b.need_perm_uniforms_update=!0)};a.multiply_size_mult=function(b,c){for(var d=Ja,e=0;e<d.length;e++){var g=a.get_graph(d[e]);na.multiply_size_mult_by_graph(g,
b,c)}}};b4w.module.__physics=function(a,r){function u(a,b){for(var c=a.cons_descends,d=0;d<c.length;d++)c[d].physics_settings.use_collision_compound&&b.push(c[d]),u(c[d],b);return null}function c(a,b,c){for(var d=a._physics.bundles,e=0;e<d.length;e++)for(var g=d[e].physics,f=0;f<g.collision_tests.length;f++){var h=g.collision_tests[f];"ANY"!=h.collision_id&&c!=h.collision_id||y(h,a,b)}}function b(a,b,c){if(I.is_active(a))switch(b){case I.IN_LOADED:var g=h(a);g._physics.worker_loaded=!0;c=Date.now()-performance.now();
I.post_msg(a,I.OUT_INIT,c,aa.max_fps,aa.calc_fps?ia.fps_measurement_interval:0);break;case I.IN_LOG:B.log_raw("URANIUM:",c.slice(1));break;case I.IN_ERROR:B.error(c);break;case I.IN_FBMSG:S.fbmsg.apply(this,c.slice(1));break;case I.IN_TRANSFORM:var f=d(c.body_id);if(f){a=c.trans;g=c.quat;b=c.linvel;var k=c.angvel,f=f.physics;f.curr_time=c.time;O.set_sep(a,1,g,f.curr_tsr);ca.copy(b,f.linvel);ca.copy(k,f.angvel)}break;case I.IN_PROP_OFFSET:(a=d(c.chassis_hull_body_id))&&O.set_sep(c.trans,1,c.quat,a.vehicle.prop_offsets[c.prop_ind]);
break;case I.IN_FLOATER_BOB_TRANSFORM:if(g=d(c[1]))a=c[4],g=g.floater.bobs[c[2]],X.set_translation(g,c[3]),X.set_rotation(g,a),X.update_transform(g);break;case I.IN_VEHICLE_SPEED:if(f=d(c[1]))f.vehicle.speed=c[2];break;case I.IN_COLLISION:g=h(a);q(g,c.body_id_a,c.body_id_b,c.result,null,null,0);break;case I.IN_COLLISION_POS_NORM:g=h(a);q(g,c.body_id_a,c.body_id_b,c.result,c.coll_point,c.coll_norm,c.coll_dist);break;case I.IN_COLLISION_IMPULSE:if(f=d(c[1]))a=f.physics,a.col_imp_test_cb&&a.col_imp_test_cb(c[2]);
break;case I.IN_RAY_HIT:case I.IN_RAY_HIT_POS_NORM:g=h(a);if(a=g._physics.ray_tests[c.id])if(g=d(c.body_id_hit),b==I.IN_RAY_HIT)b=a.callback,b(a.id,c.hit_fract,g,c.hit_time);else{b=c.hit_fract;var k=c.hit_time,f=c.hit_pos,l=a.callback;f?l(a.id,b,g,k,f,c.hit_norm):l(a.id,b,g,k)}break;case I.IN_REMOVE_RAY_TEST:e(id);break;case I.IN_PING:a=fa.indexOf(a);g=(c[2]-c[1]).toFixed(3);b=(performance.now()-c[2]).toFixed(3);c=(performance.now()-c[1]).toFixed(3);console.log("Physics #"+a+" Ping: OUT "+g+" ms, IN "+
b+" ms, ALL "+c+" ms");break;case I.IN_FPS:ta=c[1];break;case I.IN_DEBUG_STATS:a=fa.indexOf(a);console.log("Worker: #"+String(a));console.log(c[1]);break;default:B.error("Wrong message: "+b)}}function h(a){for(var b=0;b<fa.length;b++)if(fa[b]==a)return ka[b]}function d(a){return W[a]||null}function q(a,b,c,e,g,f,h){a=a._physics.bundles;for(var l=0;l<a.length;l++)for(var n=a[l].physics,m=0;m<n.collision_tests.length;m++){for(var p=n.collision_tests[m],q=p.pairs,v=!1,t=0;t<q.length;t++){var w=q[t];
if(w[0]===b&&w[1]===c){p.pair_results[t]=e;v=!0;break}}v&&(q=k(p),g&&p.body_id_src!=b&&(v=g,t=f,w=h,v[0]+=t[0]*w,v[1]+=t[1]*w,v[2]+=t[2]*w,t[0]*=-1,t[1]*=-1,t[2]*=-1),v=q?p.body_id_src==b?d(c):d(b):null,p.callback(q,v,g,f,h))}}function k(a){a=a.pair_results;for(var b=!1,c=0;c<a.length;c++)b=b||a[c];return b}function p(){ja.body++;return ja.body}function f(a){var b=la.indexOf(a);return-1==b?(la.push(a),la.length-1):b}function w(a,b){return{body_id:a,type:b,mass:0,is_ghost:!1,simulated:!0,is_vehicle:!1,
is_character:!1,is_floater:!1,cons_id:null,collision_id:"",collision_id_num:0,collision_callbacks:{},collision_tests:[],col_imp_test_cb:null,curr_time:0,curr_tsr:new Float32Array([0,0,0,1,0,0,0,1]),linvel:new Float32Array(3),angvel:new Float32Array(3),cached_trans:new Float32Array(3),cached_quat:new Float32Array(4)}}function g(a,b){switch(a){case "BOX":var c=b.bb_local;break;case "CYLINDER":c=b.bcyl_local;break;case "CONE":c=b.bcon_local;break;case "SPHERE":c=b.bs_local;break;case "CAPSULE":c=b.bcap_local}return c}
function m(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.center&&(b.center=a.center);"number"===typeof a.radius&&(b.radius=a.radius);"number"===typeof a.height&&(b.height=a.height);return b}function l(a,b,c,d,e){var g=O.get_trans_view(a.render.world_tsr),
f=O.invert(b.render.world_tsr,T),h=new Float32Array(3);O.transform_vec3(g,f,h);switch(b.vehicle.type){case 10:b=b.vehicle_settings;a=a.render.bb_local;I.post_msg(e,I.OUT_ADD_CAR_WHEEL,c,h,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:I.post_msg(e,I.OUT_ADD_BOAT_BOB,c,h,a.synchronize_pos)}}function t(a){return a.physics&&a.physics.cons_id}function F(a,b,c,d,e,g,f,h,k,l){var n;ja.constraint++;n=ja.constraint.toString(16);var m=b.physics.body_id;e=e.physics.body_id;var p=
H(m);I.post_msg(p,I.OUT_APPEND_CONSTRAINT,n,a,h,m,c,d,e,g,f,k,l);b.physics.cons_id=n}function H(a){for(var b=0;b<ka.length;b++)for(var c=ka[b]._physics.bundles,d=0;d<c.length;d++)if(c[d].physics.body_id==a)return fa[b];return null}function C(a){var b;if(b=(b=a.physics)?0===b.mass?!0:!0===b.is_ghost?!0:!1===b.simulated?!0:"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type?!0:!1:!1){b=O.get_trans_view(a.render.world_tsr);var c=O.get_quat_view(a.render.world_tsr);b=b[0]!=a.physics.cached_trans[0]||b[1]!=a.physics.cached_trans[1]||
b[2]!=a.physics.cached_trans[2]||c[0]!=a.physics.cached_quat[0]||c[1]!=a.physics.cached_quat[1]||c[2]!=a.physics.cached_quat[2]||c[3]!=a.physics.cached_quat[3]}if(b){b=a.physics;var d=a.render,c=O.get_trans_view(d.world_tsr),d=O.get_quat_view(d.world_tsr);ca.copy(c,b.cached_trans);N.copy(d,b.cached_quat);var e=I.get_msg_cache(I.OUT_SET_TRANSFORM);e.body_id=b.body_id;e.trans=c;"DYNAMIC"==b.type?N.identity(e.quat):e.quat=d;b=H(b.body_id);I.post_msg(b,I.OUT_SET_TRANSFORM)}a=a.cons_descends;for(b=0;b<
a.length;b++)C(a[b])}function x(a,b,c,d,e){e=e||new Float32Array(3);a=O.get_quat_view(a.render.world_tsr);e[0]=b;e[1]=c;e[2]=d;return ca.transformQuat(e,a,e)}function y(a,b,c){var d=a.pairs,e=a.pair_results,g=a.body_id_src,f=[],h=a.collision_id;if(!f)throw"At least one destination required";for(var k=0;k<b._physics.bundles.length;k++){var l=b._physics.bundles[k];if("ANY"==h||l.physics.collision_id==h)l=l.physics.body_id,f&&-1==f.indexOf(l)&&f.push(l)}for(b=0;b<f.length;b++)h=f[b],g<h&&!z(d,g,h)?(d.push([g,
h]),e.push(!1)):g>h&&!z(d,h,g)&&(d.push([h,g]),e.push(!1));I.post_msg(c,I.OUT_ACTIVATE,g);I.post_msg(c,I.OUT_APPEND_COLLISION_TEST,d,a.calc_pos_norm)}function z(a,b,c){for(var d=0;d<a.length;d++)if(a[d][0]==b&&a[d][1]==c)return!0;return!1}function E(a){if(a.physics&&a.physics.col_imp_test_cb){a=a.physics;var b=H(a.body_id);I.post_msg(b,I.OUT_CLEAR_COLLISION_IMPULSE_TEST,a.body_id);a.col_imp_test_cb=null}}function e(a){var b=n(a),c=M(a),b=b._physics;b.ray_tests[a]&&(delete b.ray_tests[a],b.ray_tests_arr.splice(b.ray_tests_arr.indexOf,
1),I.post_msg(c,I.OUT_REMOVE_RAY_TEST,a))}function n(a){for(var b=0;b<ka.length;b++){var c=ka[b];if(c._physics.ray_tests[a])return c}return null}function M(a){for(var b=0;b<ka.length;b++)if(ka[b]._physics.ray_tests[a])return fa[b];return null}function D(a,b,c){if(b.steering_wheel){a=a.physics.body_id;var d=b.engine_force*b.force_max,e=b.brake_force*b.brake_max,g=-b.steering*b.steering_max*2*Math.PI/b.steering_ratio;b.inverse_control&&(g*=-1);switch(b.type){case 10:I.post_msg(c,I.OUT_UPDATE_CAR_CONTROLS,
a,d,e,g);break;case 20:I.post_msg(c,I.OUT_UPDATE_BOAT_CONTROLS,a,d,e,g)}}}function G(a){return a.is_vehicle&&"CHASSIS"==a.vehicle_settings.part}function Q(a){return a.is_vehicle&&"HULL"==a.vehicle_settings.part}function v(a){return a.is_floating&&"MAIN_BODY"==a.floating_settings.part}var P=r("__config"),S=r("__debug"),I=r("__ipc"),K=r("__obj_util"),B=r("__print"),N=r("__quat"),J=r("__scenes"),X=r("__transform"),O=r("__tsr"),ba=r("__util"),ca=r("__vec3"),ga=r("__version"),aa=P.physics,ia=P.defaults,
da=P.assets,ta=0,fa=[],ka=[],W={},A=[],la=["ANY"],ja={body:0,constraint:0,ray_test:0},ha=new Float32Array(3);new Float32Array(4);var sa=new Float32Array(4);new Float32Array(16);var T=O.create(),Ha=O.create();a.init_scene_physics=function(a){a._physics={worker_loaded:!1,bundles:[],ray_tests:{},ray_tests_arr:[]};var c=aa.uranium_path;da.prevent_caching&&(c+=ga.timestamp());B.log("%cLOAD PHYSICS","color: #0a0",aa.use_workers?"Using Separate Worker Thread,":"Using Same Thread,","Max FPS: "+aa.max_fps);
B.log("%cPHYSICS PATH","color: #0a0",c);var d=I.create_worker(c,!aa.use_workers);I.attach_handler(d,b);fa.push(d);ka.push(a);aa.ping&&setInterval(function(){I.post_msg(d,I.OUT_PING,performance.now())},1E3)};a.check_worker_loaded=function(a){return a._physics?a._physics.worker_loaded:!0};a.cleanup=function(){for(var a=0;a<fa.length;a++)I.terminate(fa[a]);fa.length=0;ka.length=0;W={};A.length=0;la.length=0;for(var b in ja)ja[b]=0};a.append_object=function(a,b){if(!a.render)throw"No object render: "+
a.name;var d=a.physics_settings,e;a:{for(var h=0;h<ka.length;h++)if(ka[h]==b){e=fa[h];break a}e=void 0}var k=[];d.use_collision_compound&&u(a,k);var n=b._physics.bundles;if(G(a)||Q(a)||a.is_character||v(a)||a.use_obj_physics){var q,r=a,x=e,C=r.render,y=r.physics_settings,J=y.physics_type,z=p();if("CAMERA"==r.type)var za=y.use_collision_bounds?y.collision_bounds_type:"BOX",ea=g(za,C),E=C.friction,H=C.elasticity,E=.5,H=0;else if("EMPTY"==r.type)za="EMPTY",ea=null,H=E=0;else{var za=y.use_collision_bounds?
y.collision_bounds_type:"BOX",ea=g(za,C),P=O.get_scale(C.world_tsr);if(1!=P){var M=ea;switch(za){case "BOX":M.min_x*=P;M.max_x*=P;M.min_y*=P;M.max_y*=P;M.min_z*=P;M.max_z*=P;break;case "CYLINDER":case "CONE":case "CAPSULE":M.height*=P;M.radius*=P;break;case "SPHERE":M.radius*=P}}E=C.friction;H=C.elasticity}var S=O.get_trans_view(C.world_tsr),Ba=O.get_quat_view(C.world_tsr),va=y.use_ghost,zc=y.use_sleep,La=y.mass,nb=y.velocity_min,na=y.velocity_max,X=y.damping,ua=y.rotation_damping,Ga=r.collision_id,
la=f(Ga),Ka=y.collision_margin,ha=y.collision_group,Wa=y.collision_mask,ja=C.bs_local.radius,ca=m(ea),da=r.correct_bounding_offset,sc;var ga=za;if(k.length){var Pb=[],Ac={};Ac.quat=new Float32Array([0,0,0,1]);Ac.trans=new Float32Array(3);Ac.worker_bounding=ca;Ac.bounding_type=ga;Pb.push(Ac);var Dd=O.invert(C.world_tsr,T),hc=O.get_quat_view(C.world_tsr);N.invert(hc,sa);for(var ob=0;ob<k.length;ob++){var Ja={},Qb=k[ob],Mc=Qb.physics_settings.collision_bounds_type,Bc=new Float32Array(4),Rc=new Float32Array(3),
aa=O.get_trans_view(Qb.render.world_tsr),ia=O.get_quat_view(Qb.render.world_tsr);O.transform_vec3(aa,Dd,Rc);N.multiply(sa,ia,Bc);Ja.trans=Rc;Ja.quat=Bc;Ja.bounding_type=Mc;Ja.worker_bounding=m(g(Mc,Qb.render));Pb.push(Ja)}sc=Pb}else sc=[];I.post_msg(x,I.OUT_APPEND_BOUNDING_BODY,z,S,Ba,J,va,zc,La,nb,na,X,ua,la,Ka,ha,Wa,za,ca,ja,E,H,sc,da);W[z]=r;A.push(r);var ta=w(z,"BOUNDING");ta.type=J;ta.mass=La;ta.is_ghost=va;ta.collision_id=Ga;ta.collision_id_num=la;q=ta;a.physics=q;var zb={batch:null,physics:q};
n.push(zb);c(b,e,q.collision_id)}else for(var Rb=K.get_scene_data(a,b).batches,Wb=0;Wb<Rb.length;Wb++){var rb=Rb[Wb],tc;if(!(tc="PHYSICS"!=rb.type))a:{for(var bb=b._physics.bundles,Za=0;Za<bb.length;Za++){var wd=bb[Za].batch;if(wd&&wd.id==rb.id){tc=!0;break a}}tc=!1}if(!tc)if(rb.submesh.base_length)if(rb.water&&b._render.water_params){var Ra=rb,Hc=b,nc=e,Ma=Hc._render.water_params;I.post_msg(nc,I.OUT_APPEND_WATER,Ma.water_level);if(Ra.water_dynamics){var Ua={};Ua.dst_noise_scale0=Ra.dst_noise_scale0;
Ua.dst_noise_scale1=Ra.dst_noise_scale1;Ua.dst_noise_freq0=Ra.dst_noise_freq0;Ua.dst_noise_freq1=Ra.dst_noise_freq1;Ua.dir_min_shore_fac=Ra.dir_min_shore_fac;Ua.dir_freq=Ra.dir_freq;Ua.dir_noise_scale=Ra.dir_noise_scale;Ua.dir_noise_freq=Ra.dir_noise_freq;Ua.dir_min_noise_fac=Ra.dir_min_noise_fac;Ua.dst_min_fac=Ra.dst_min_fac;Ua.waves_hor_fac=Ra.waves_hor_fac;var Ic=Ma.waves_height,Xb=Ma.waves_length;Ma.shoremap_image?I.post_msg(nc,I.OUT_ADD_WATER_WRAPPER,Ua,Ma.shoremap_size[0],Ma.shoremap_size[1],
Ma.shoremap_center[0],Ma.shoremap_center[1],Ma.max_shore_dist,Ic,Xb,Ma.shoremap_tex_size,Hc._render.shore_distances):I.post_msg(nc,I.OUT_ADD_WATER_WRAPPER,Ua,0,0,0,0,0,Ic,Xb,0,null)}}else{if(rb.use_ghost){var pd=a,Cc=rb,qd=e,Gb=p(),Jc=Cc.submesh,Nc=Jc.va_frames[0].a_position,xd=Jc.indices||null,Yb=Cc.collision_id,yd=f(Yb),zd=Cc.collision_margin,Kc=Cc.collision_group,Jb=Cc.collision_mask,Ab=O.get_trans_view(pd.render.world_tsr);I.post_msg(qd,I.OUT_APPEND_GHOST_MESH_BODY,Gb,Nc,xd,Ab,yd,zd,Kc,Jb);var oc=
w(Gb,"STATIC_MESH");oc.is_ghost=!0;oc.collision_id=Yb;oc.collision_id_num=yd;q=oc}else{var gb=a,ic=rb,ld=e,hb=p(),ub=ic.submesh,cc=ub.va_frames[0].a_position,Dc=ub.indices||null,uc=O.get_trans_view(gb.render.world_tsr),Bb=ic.friction,pc=ic.elasticity,Kb=ic.collision_id,Ec=f(Kb);I.post_msg(ld,I.OUT_APPEND_STATIC_MESH_BODY,hb,cc,Dc,uc,Bb,pc,Ec,ic.collision_margin,ic.collision_group,ic.collision_mask);var Lb=w(hb,"STATIC_MESH");Lb.collision_id=Kb;Lb.collision_id_num=Ec;q=Lb}a.physics=q;zb={batch:rb,
physics:q};n.push(zb);c(b,e,q.collision_id)}else B.error("Object "+a.name+" has collision material with no assigned vertices")}if(G(a)||Q(a)){var $a=a,ib=e,pb=$a.physics.body_id;G($a)?($a.vehicle.type=10,I.post_msg(ib,I.OUT_APPEND_CAR,pb,$a.vehicle.suspension_compression,$a.vehicle.suspension_stiffness,$a.vehicle.suspension_damping,$a.vehicle.wheel_friction,$a.vehicle.max_suspension_travel_cm)):Q($a)&&($a.vehicle.type=20,I.post_msg(ib,I.OUT_APPEND_BOAT,pb,$a.vehicle.floating_factor,$a.vehicle.water_lin_damp,
$a.vehicle.water_rot_damp));if($a.vehicle.props){var Oa=$a.vehicle.props;switch($a.vehicle.type){case 10:l(Oa[1],$a,pb,!0,ib);l(Oa[0],$a,pb,!0,ib);l(Oa[3],$a,pb,!1,ib);l(Oa[2],$a,pb,!1,ib);break;case 20:for(var eb=0;eb<Oa.length;eb++)l(Oa[eb],$a,pb,!1,ib)}}D(a,a.vehicle,e)}else if(a.is_character){var Mb=e,vc=a.render,Zb=a.physics,Hb=vc.bb_local.max_y-vc.bb_local.min_y,jc=Zb.body_id,ab=a.character_settings,Cb=ab.walk_speed,vb=ab.run_speed,kc=ab.step_height,wc=ab.jump_strength,Sb=ab.waterline,Xa=ba.dir_ground_proj_angle(a);
I.post_msg(Mb,I.OUT_APPEND_CHARACTER,jc,Xa,Hb,Cb,vb,kc,wc,Sb);Zb.is_character=!0}else if(v(a)){var sb=a,Ca=e,qb=sb.physics.body_id;I.post_msg(Ca,I.OUT_APPEND_FLOATER,qb,sb.floater.floating_factor,sb.floater.water_lin_damp,sb.floater.water_rot_damp);if(sb.floater.bobs)for(var wb=sb.floater.bobs,Nb=0;Nb<wb.length;Nb++){var Va=wb[Nb],Ob=O.get_trans_view(Va.render.world_tsr),Tb=O.invert(sb.render.world_tsr,T),tb=new Float32Array(3);O.transform_vec3(Ob,Tb,tb);I.post_msg(Ca,I.OUT_ADD_FLOATER_BOB,qb,tb,
Va.bob_synchronize_pos)}sb.physics.is_floater=!0}for(Wb=0;Wb<A.length;Wb++)if(a=A[Wb],a.physics){var fb=a;if(!t(fb))for(var Db=0;Db<fb.physics_constraints.length;Db++){var cb=fb.physics_constraints[Db],jb=cb.target,Eb=cb.pivot_type;if(jb.physics){var Ya=new Float32Array([cb.pivot_x,cb.pivot_y,cb.pivot_z]),kb,dc=new Float32Array([cb.axis_x,cb.axis_y,cb.axis_z]);kb=ba.euler_to_quat(dc,new Float32Array(4));var lb=O.identity(T),lb=O.set_trans(Ya,lb),lb=O.set_quat(kb,lb),mb=O.multiply(fb.render.world_tsr,
lb,T),db=O.invert(jb.render.world_tsr,Ha),lc=O.multiply(db,mb,db),qc=O.get_trans_view(lc),xc=O.get_quat_view(lc),Qa=cb,Sa={};Sa.use_limit_x=Qa.use_limit_x;Sa.use_limit_y=Qa.use_limit_y;Sa.use_limit_z=Qa.use_limit_z;Sa.use_angular_limit_x=Qa.use_angular_limit_x;Sa.use_angular_limit_y=Qa.use_angular_limit_y;Sa.use_angular_limit_z=Qa.use_angular_limit_z;Sa.limit_max_x=Qa.limit_max_x;Sa.limit_min_x=Qa.limit_min_x;Sa.limit_max_y=Qa.limit_max_y;Sa.limit_min_y=Qa.limit_min_y;Sa.limit_max_z=Qa.limit_max_z;
Sa.limit_min_z=Qa.limit_min_z;Sa.limit_angle_max_x=Qa.limit_angle_max_x;Sa.limit_angle_min_x=Qa.limit_angle_min_x;Sa.limit_angle_max_y=Qa.limit_angle_max_y;Sa.limit_angle_min_y=Qa.limit_angle_min_y;Sa.limit_angle_max_z=Qa.limit_angle_max_z;Sa.limit_angle_min_z=Qa.limit_angle_min_z;F(Eb,fb,Ya,kb,jb,qc,xc,Sa,null,null)}}}};a.find_obj_by_body_id=d;a.update=function(a,b){for(var c=0;c<fa.length;c++){var d=fa[c],e=a,g=b;d&&I.is_fallback(d)&&I.post_msg(d,I.OUT_UPDATE_WORLD,e,g);for(g=0;g<A.length;g++){var f=
A[g],h=f.physics;if(h.simulated&&h.curr_time){var k=I.is_fallback(d)?e-h.curr_time:performance.now()/1E3-h.curr_time,k=Math.min(k,10/aa.max_fps),k=k-1/aa.max_fps;ia.no_phy_interp_hack&&(k=0);var l=T;O.integrate(h.curr_tsr,k,h.linvel,h.angvel,T);X.set_tsr(f,l);X.update_transform(f);C(f);if(f.vehicle)for(var h=f,k=h.vehicle.props,l=h.render.world_tsr,n=T,m=0;m<k.length;m++){var p=k[m];O.multiply(l,h.vehicle.prop_offsets[m],n);X.set_tsr(p,n);X.update_transform(p)}f.vehicle&&f.vehicle.steering_wheel&&
(n=f,k=n.vehicle,h=k.steering_wheel)&&(m=n.vehicle.steering_wheel_axis,O.multiply(n.render.world_tsr,n.vehicle.steering_wheel_tsr,h.render.world_tsr),l=ha,O.transform_dir_vec3(m,n.render.world_tsr,l),n=sa,N.setAxisAngle(l,-k.steering*k.steering_max*2*Math.PI,n),k=O.get_quat_view(h.render.world_tsr),N.multiply(n,k,k),X.update_transform(h));f.vehicle&&f.vehicle.speedometer&&(n=f,k=n.vehicle,h=k.speedometer)&&(m=n.vehicle.speedometer_axis,O.multiply(n.render.world_tsr,n.vehicle.speedometer_tsr,h.render.world_tsr),
l=ha,O.transform_dir_vec3(m,n.render.world_tsr,l),n=sa,m=Math.abs(k.speed)*k.speed_ratio,m>k.max_speed_angle&&(m=k.max_speed_angle),N.setAxisAngle(l,-m,n),k=O.get_quat_view(h.render.world_tsr),N.multiply(n,k,k),N.normalize(k,k),X.update_transform(h));f.vehicle&&f.vehicle.tachometer&&(l=f,h=l.vehicle,f=h.tachometer)&&(n=l.vehicle.tachometer_axis,O.multiply(l.render.world_tsr,l.vehicle.tachometer_tsr,f.render.world_tsr),k=ha,O.transform_dir_vec3(n,l.render.world_tsr,k),l=sa,N.setAxisAngle(k,-Math.abs(h.engine_force)*
h.delta_tach_angle,l),h=O.get_quat_view(f.render.world_tsr),N.multiply(l,h,h),N.normalize(h,h),X.update_transform(f))}}I.post_msg_arr(d);d=ka[c];(e=d._render.water_params)&&0<e.waves_height&&(d=J.get_subs(d,"MAIN_OPAQUE"),e=ca.length(d.wind),I.post_msg(fa[c],I.OUT_SET_WATER_TIME,d.time*e))}};a.get_active_scene=function(){return ka[0]};a.pause=function(){for(var a=0;a<fa.length;a++)I.post_msg(fa[a],I.OUT_PAUSE)};a.resume=function(){for(var a=0;a<fa.length;a++)I.post_msg(fa[a],I.OUT_RESUME)};a.enable_simulation=
function(a){a=a.physics;if(!a)throw"No object physics";if(!a.simulated){var b=a.body_id,c=H(b);a.simulated=!0;I.post_msg(c,I.OUT_ENABLE_SIMULATION,b)}};a.disable_simulation=function(a){a=a.physics;if(!a)throw"No object physics";if(a.simulated){var b=a.body_id,c=H(b);a.simulated=!1;I.post_msg(c,I.OUT_DISABLE_SIMULATION,b)}};a.scene_has_physics=function(a){return Boolean(a._physics)};a.obj_has_physics=function(a){return Boolean(a.physics)};a.has_dynamic_physics=function(a){return(a=a.physics)&&a.simulated&&
("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.mass&&0==a.is_ghost?!0:!1};a.has_simulated_physics=function(a){return(a=a.physics)&&a.simulated?!0:!1};a.set_gravity=function(a,b){var c=a.physics.body_id,d=H(c);I.post_msg(d,I.OUT_SET_GRAVITY,c,b)};a.has_constraint=t;a.apply_constraint=F;a.clear_constraint=function(a){a=a.physics;var b=a.cons_id,c=H(body_a);I.post_msg(c,I.OUT_REMOVE_CONSTRAINT,b);a.cons_id=null};a.pull_to_constraint_pivot=function(b,c,d,e,g,f){c=O.set_sep(c,1,d,T);g=O.set_sep(g,1,f,
Ha);O.invert(c,c);O.multiply(g,c,c);X.get_tsr(e,g);O.multiply(g,c,c);X.set_tsr(b,c);X.update_transform(b);e=O.get_trans_view(b.render.world_tsr);g=O.get_quat_view(b.render.world_tsr);a.set_transform(b,e,g)};a.set_transform=function(a,b,c){var d=a.physics,e=O.get_trans_view(a.render.world_tsr);a=O.get_quat_view(a.render.world_tsr);O.set_sep(e,1,a,d.curr_tsr);e=I.get_msg_cache(I.OUT_SET_TRANSFORM);e.body_id=d.body_id;e.trans=b;e.quat=c;b=H(d.body_id);I.post_msg(b,I.OUT_SET_TRANSFORM)};a.sync_transform=
C;a.apply_velocity=function(a,b,c,d){x(a,b,c,d,ha);a=a.physics.body_id;b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(ha[0]),g=Math.abs(ha[1]),f=Math.abs(ha[2]);ha[0]=e?ha[0]/e*Math.max(e,b):0;ha[1]=g?ha[1]/g*Math.max(g,c):0;ha[2]=f?ha[2]/f*Math.max(f,d):0;b=H(a);I.post_msg(b,I.OUT_SET_LINEAR_VELOCITY,a,ha[0],ha[1],ha[2])};a.apply_velocity_world=function(a,b,c,d){a=a.physics.body_id;var e=H(a);I.post_msg(e,I.OUT_SET_LINEAR_VELOCITY,a,b,c,d)};a.apply_force=function(a,b,c,d,e){e?(ha[0]=b,
ha[1]=c,ha[2]=d):x(a,b,c,d,ha);a=a.physics.body_id;b=H(a);I.post_msg(b,I.OUT_APPLY_CENTRAL_FORCE,a,ha[0],ha[1],ha[2])};a.apply_torque=function(a,b,c,d){x(a,b,c,d,ha);a=a.physics.body_id;b=H(a);I.post_msg(b,I.OUT_APPLY_TORQUE,a,ha[0],ha[1],ha[2])};a.set_character_move_dir=function(a,b,c){a=a.physics.body_id;var d=H(a);I.post_msg(d,I.OUT_SET_CHARACTER_MOVE_DIR,a,b,c)};a.set_character_move_type=function(a,b){var c=a.physics.body_id,d=H(c);I.post_msg(d,I.OUT_SET_CHARACTER_MOVE_TYPE,c,b)};a.set_character_walk_velocity=
function(a,b){var c=a.physics.body_id,d=H(c);I.post_msg(d,I.OUT_SET_CHARACTER_WALK_VELOCITY,c,b)};a.set_character_run_velocity=function(a,b){var c=a.physics.body_id,d=H(c);I.post_msg(d,I.OUT_SET_CHARACTER_RUN_VELOCITY,c,b)};a.set_character_fly_velocity=function(a,b){var c=a.physics.body_id,d=H(c);I.post_msg(d,I.OUT_SET_CHARACTER_FLY_VELOCITY,c,b)};a.character_jump=function(a){a=a.physics.body_id;var b=H(a);I.post_msg(b,I.OUT_CHARACTER_JUMP,a)};a.character_rotation_inc=function(a,b,c){a=a.physics.body_id;
var d=H(a);I.post_msg(d,I.OUT_CHARACTER_ROTATION_INCREMENT,a,b,c)};a.set_character_rotation=function(a,b,c){a=a.physics.body_id;var d=H(a);I.post_msg(d,I.OUT_SET_CHARACTER_ROTATION,a,b,c)};a.set_character_rotation_h=function(a,b){var c=a.physics.body_id,d=H(c);I.post_msg(d,I.OUT_SET_CHARACTER_HOR_ROTATION,c,b)};a.set_character_rotation_v=function(a,b){var c=a.physics.body_id,d=H(c);I.post_msg(d,I.OUT_SET_CHARACTER_VERT_ROTATION,c,b)};a.append_collision_test=function(a,b,c,d){var e=a.physics,g=e.body_id;
b=b||"ANY";for(var f=0;f<e.collision_tests.length;f++)if(a=e.collision_tests[f],a.collision_id==b&&a.callback==c)return;a={body_id_src:g,calc_pos_norm:d||!1,collision_id:b,callback:c,pairs:[],pair_results:[]};e.collision_tests.push(a);b=H(g);c=h(b);y(a,c,b)};a.remove_collision_test=function(a,b,c){a=a.physics;for(var d=H(a.body_id),e=h(d),g=0;g<a.collision_tests.length;g++){var f=a.collision_tests[g];if(f.collision_id==b&&f.callback==c){if(k(f)){var l=ca.set(0,0,0,ha);f.callback(!1,null,l,l,0)}a.collision_tests.splice(g,
1);g--;for(var l=d,n=e._physics.bundles,f=f.pairs,m=0;m<n.length;m++)for(var p=n[m].physics,q=0;q<p.collision_tests.length;q++)for(var v=p.collision_tests[q],t=0;t<v.pairs.length;t++)for(var w=v.pairs[t],B=0;B<f.length;B++){var r=f[B];w[0]==r[0]&&w[1]==r[1]&&(f.splice(B,1),B--)}f.length&&I.post_msg(l,I.OUT_REMOVE_COLLISION_TEST,f)}}};a.apply_collision_impulse_test=function(a,b){a.physics&&a.physics.col_imp_test_cb&&E(a);var c=a.physics,d=H(c.body_id);I.post_msg(d,I.OUT_APPLY_COLLISION_IMPULSE_TEST,
c.body_id);c.col_imp_test_cb=b};a.clear_collision_impulse_test=E;a.append_ray_test=function(a,b,c,d,e,g,k,l,n){var m;ja.ray_test++;m=ja.ray_test;d=d||"ANY";a={id:m,body_id:a?a.physics.body_id:0,from:new Float32Array(b),to:new Float32Array(c),collision_id:d,collision_id_num:f(d),autoremove:g,calc_all_hits:k,calc_pos_norm:l,ign_src_rot:n,callback:e};b=H(a.body_id)||fa[0];c=h(b)._physics;m=a.id;c.ray_tests[m]=a;c.ray_tests_arr.push(a);I.post_msg(b,I.OUT_APPEND_RAY_TEST,a.id,a.body_id,a.from,a.to,a.collision_id_num,
a.autoremove,a.calc_all_hits,a.calc_pos_norm,a.ign_src_rot);return m};a.remove_ray_test=e;a.change_ray_test_from_to=function(a,b,c){var d=n(a),e=M(a);(d=d._physics.ray_tests[a])&&!d.autoremove&&(d.from.set(b),d.to.set(c),I.post_msg(e,I.OUT_CHANGE_RAY_TEST_FROM_TO,a,b,c))};a.is_ray_test=function(a){return n(a)._physics.ray_tests[a]?!0:!1};a.vehicle_throttle=function(a,b){var c=a.vehicle;c.engine_force=b;var d=H(a.physics.body_id);D(a,c,d)};a.vehicle_steer=function(a,b){var c=a.vehicle;c.steering=b;
var d=H(a.physics.body_id);D(a,c,d)};a.vehicle_brake=function(a,b){var c=a.vehicle;c.brake_force=b;var d=H(a.physics.body_id);D(a,c,d)};a.is_vehicle_chassis=G;a.is_vehicle_hull=Q;a.is_car_wheel=function(a){if(!a.is_vehicle)return!1;a=a.vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.is_boat_bob=function(a){return a.is_vehicle?"BOB"==a.vehicle_settings.part?!0:!1:!1};a.is_floater_bob=function(a){return a.is_floating?"BOB"==
a.floating_settings.part?!0:!1:!1};a.is_vehicle_steering_wheel=function(a){return a.is_vehicle&&"STEERING_WHEEL"==a.vehicle_settings.part?!0:!1};a.is_vehicle_speedometer=function(a){return a.is_vehicle&&"SPEEDOMETER"==a.vehicle_settings.part?!0:!1};a.is_vehicle_tachometer=function(a){return a.is_vehicle&&"TACHOMETER"==a.vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.vehicle.speed};a.wheel_index=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;
case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=function(a){return a.is_character};a.is_floater_main=v;a.get_fps=function(){return ta};a.debug_workers=function(){for(var a=0;a<fa.length;a++)I.post_msg(fa[a],I.OUT_DEBUG)};a.remove_object=function(a){if("BOUNDING"==a.physics.type){var b=A.indexOf(a);-1==b&&B.error("Object "+a.name+" doesn't have bounding physics");delete W[c];A.splice(b,1)}for(var c=a.physics.body_id,b=H(c),d=h(b),e=c,g=d._physics.bundles,f=[],l=0;l<
g.length;l++)for(var n=g[l].physics,m=0;m<n.collision_tests.length;m++)for(var p=n.collision_tests[m],q=0;q<p.pairs.length;q++){var v=p.pairs[q],t=p.pair_results[q];if(v[0]==e||v[1]==e)p.pairs.splice(q,1),p.pair_results.splice(q,1),q--,t&&!k(p)&&(t=ca.set(0,0,0,ha),p.callback(!1,null,t,t,0)),f.push(v)}f.length&&I.post_msg(b,I.OUT_REMOVE_COLLISION_TEST,f);a.physics&&a.physics.col_imp_test_cb&&E(a);a=d._physics.bundles;for(d=0;d<a.length;d++)a[d].physics.body_id==c&&(a.splice(d,1),d--);I.post_msg(b,
I.OUT_REMOVE_BODY,c)}};b4w.module.__data=function(a,r){function u(a,b){na[b.id]=null;yb[b.id]=null}function c(a,b,c){var d;a instanceof ArrayBuffer&&(a=sa.get_width_height(a));d=a.width;a=a.height;ma.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(ua)&&c&&ma.warn("image",b,"is not from app root.")}function b(a,b,c,d,e,g){d=b.filepath;if(!d)throw"Nothing requested";A.enqueue([{id:d,type:A.AT_JSON,url:d}],function(d,g,f,h){if(d){ma.log("%cLOAD METADATA","color: #616",
h);g=Fa.str_to_version(d.b4w_format_version);switch(Fa.version_cmp(g,Ba.min_format_version)){case -1:g[0]<Ba.min_format_version[0]?Fa.panic("JSON version is too old relative to B4W engine: "+Fa.version_to_str(g)+", required: "+Fa.version_to_str(Ba.min_format_version)+". Reexport scene with the latest B4W addon to fix it."):ma.warn("JSON version is a bit old relative to B4W engine: "+ +Fa.version_to_str(g)+", required: "+Fa.version_to_str(Ba.min_format_version)+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");
break;case 1:g[0]>Ba.min_format_version[0]?Fa.panic("B4W engine version is too old relative to JSON. Can't load the scene. Update your engine version to fix it."):ma.warn("B4W engine version is a bit old relative to JSON. Some compatibility issues can occur. Update your engine version to fix it.")}Ba.loaded_data_version=g;for(var k in d)a[k]=d[k];b.is_primary&&(Ga=xa.find_main_scene(a.scenes));(d=a.binaries[0].binfile)?b.binary_name=d:(R.skip_stage_by_name(b,"load_binaries"),R.skip_stage_by_name(b,
"prepare_bindata"));Ba.is_mobile_device||R.skip_stage_by_name(b,"mobile_media_start");Ba.antialiasing&&Ba.smaa||R.skip_stage_by_name(b,"load_smaa_textures");if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)k=a.b4w_export_errors[d],(b.is_primary&&"PRIMARY"==k.type||"ALL"==k.type)&&ma.export_error(k.text);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)k=a.b4w_export_warnings[d],(b.is_primary&&"PRIMARY"==k.type||"ALL"==k.type)&&ma.export_warn(k.text);e(b,c)}else R.abort_thread(b)},
null,function(a){g(b,c,a)})}function h(a,b,c,d,e,g){d=da(b.filepath)+b.binary_name;if(!d)throw"Binary data is missing";A.enqueue([{id:d,type:A.AT_ARRAYBUFFER,url:d}],function(d,g,f,h){d?(ma.log("%cLOAD BINARY","color: #616",h),a.bin_data=d,d=k(d),g=Fa.str_to_version(a.b4w_format_version),d[0]!=g[0]&&Fa.panic("BIN version does not match to JSON version: "+Fa.version_to_str(d)+", required: "+Fa.version_to_str(Ba.min_format_version)+". Couldn't load the scene. Reexport scene to fix it."),d[1]!=g[1]&&
ma.warn("BIN version does not match to JSON version: "+ +Fa.version_to_str(d)+", required: "+Fa.version_to_str(Ba.min_format_version)+". Some compatibility issues can occur. Reexport scene to fix it."),e(b,c)):R.abort_thread(b)},null,function(a){g(b,c,a)})}function d(a,b,c,d,e,g){za.check_shaders_loaded()&&e(b,c)}function q(a,b,c,d,e,g){d=a.bin_data;g=a.binaries[0];var f=a.objects,h=a.meshes;a=a.actions;for(var l=Fa.check_endians(),n=k(d),n=5<=n[0]&&4<n[1]?12:0,m=["indices"],q=["normal","tangent"],
Ba=["color","group"],v=["position","texcoord","texcoord2"],t=0;t<h.length;t++)for(var w=h[t].submeshes,B=0;B<w.length;B++)for(var r in w[B]){var R=w[B][r][1];if(-1!=m.indexOf(r)){var va=4*w[B][r][0]+g["int"]+n,ea=w[B],A=r,x=d;if(l)var u=new Uint32Array(x,va,R);else for(var u=new Uint32Array(R),x=new DataView(x),F=0;F<R;F++)u[F]=x.getUint32(va+4*F,!0);ea[A]=u}else if(-1!=v.indexOf(r))va=4*w[B][r][0]+g["float"]+n,w[B][r]=p(d,va,R,l);else if(-1!=q.indexOf(r)){va=2*w[B][r][0]+g["short"]+n;ea=w[B];A=r;
x=d;u=new Float32Array(R);x=new DataView(x);for(F=0;F<R;F++)u[F]=x.getInt16(va+2*F,!0)/32767;ea[A]=u}else if(-1!=Ba.indexOf(r)){va=2*w[B][r][0]+g.ushort+n;ea=w[B];A=r;x=d;u=new Float32Array(R);x=new DataView(x);for(F=0;F<R;F++)u[F]=x.getUint16(va+2*F,!0)/65535;ea[A]=u}}for(r=0;r<f.length;r++)for(h=f[r].particle_systems,m=0;m<h.length;m++)q=h[m],q.transforms=p(d,4*q.transforms[0]+g["float"]+n,q.transforms[1],l);for(f=0;f<a.length;f++){r=a[f];h=r.fcurves;m=r.frame_range;Ba=m[0];v=m[1];t=W.get_approx_curve_length(Ba,
v);m=null;0>t&&(t=0);var B=w=!1,D;for(D in h)w|=-1<D.indexOf("rotation_euler"),B|=-1<D.indexOf("rotation_quaternion");q=[];for(D in h)if(w&&B&&-1<D.indexOf("rotation_euler"))delete h[D];else{var R=h[D],C;for(C in R)va=R[C],ea=p(d,g["float"]+4*va.bin_data_pos[0]+n,va.bin_data_pos[1],l),A=new Float32Array(t),null===m&&(m=new Int8Array(t)),W.approximate_curve(va,ea,A,m,Ba,v),va._pierced_points=A;-1<D.indexOf("rotation_euler")&&(W.fcurve_replace_euler_by_quat(h[D]),q.push(D))}for(Ba=0;Ba<q.length;Ba++)v=
q[Ba],t=v.replace("euler","quaternion"),h[t]=h[v],delete h[v];r._bflags=m}e(b,c)}function k(a){var b=new Uint8Array(a,0,4),c=(new Uint32Array(a,4,1))[0];a=(new Uint32Array(a,8,1))[0];for(var d=0;d<b.length;d++)if("B4WB"[d]!=String.fromCharCode(b[d])){c=5;a=4;break}return[c,a]}function p(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function f(a,b,c,d,e,g){var f=a.cameras,h=a.groups,k=a.materials,l=a.meshes,
n=a.node_groups,p=a.objects,q=a.particles,Ba=a.scenes,v=a.speakers,t=a.lamps,B=a.textures,r=a.worlds;n||(ma.warn('"node_groups" datablock undefined. reexport main scene.'),n=a.node_groups=[]);for(var R="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),va={},A=0;A<R.length;A++)for(var x=a[R[A]],u=0;u<x.length;u++){var F=x[u];va[F.uuid]=F}for(var D=0;D<Ba.length;D++){for(var C=Ba[D],za=C.objects,G=
0;G<za.length;G++)z(za,G,va);C.camera&&z(C,"camera",va);C.world&&z(C,"world",va)}for(D=0;D<h.length;D++)for(var Z=h[D].objects,G=0;G<Z.length;G++)z(Z,G,va);for(D=0;D<p.length;D++){var J=p[D];J.dupli_group&&z(J,"dupli_group",va);J.parent&&z(J,"parent",va);J.dg_parent&&z(J,"dg_parent",va);if(J.animation_data){var N=J.animation_data;N.action&&z(N,"action",va);if(N.nla_tracks)for(G=0;G<N.nla_tracks.length;G++)for(var V=N.nla_tracks[G],E=0;E<V.strips.length;E++)V.strips[E].action&&z(V.strips[E],"action",
va)}switch(J.type){case "MESH":if(!J.data)throw"mesh not found for object "+J.name;z(J,"data",va);for(var P=!1,H=J.modifiers,G=0;G<H.length;G++){var ka=H[G];"ARMATURE"==ka.type?(P&&ma.warn('Object "'+J.name+'" has more than one armature modifiers. Only the first one will be used.'),P=!0,z(ka,"object",va)):"CURVE"==ka.type&&z(ka,"object",va)}var M=J.particle_systems;if(M)for(G=0;G<M.length;G++)z(M[G],"settings",va);break;case "ARMATURE":z(J,"data",va);for(var Q=J.pose.bones,K=J.data.bones,G=0;G<Q.length;G++){var S=
Q[G];S.bone=K[S.bone];var ua=S.constraints;if(ua)for(E=0;E<ua.length;E++){var La=ua[E];La.target&&z(La,"target",va)}for(var U=S.parent_recursive,E=0;E<U.length;E++)U[E]=Q[U[E]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":z(J,"data",va)}if(ua=J.constraints)for(G=0;G<ua.length;G++)La=ua[G],La.target&&z(La,"target",va);var na=J.lod_levels;if(na)for(G=0;G<na.length;G++){var qa=na[G];qa.object&&z(qa,"object",va)}}for(D=0;D<l.length;D++)for(var Ia=l[D].materials,G=0;G<Ia.length;G++)z(Ia,
G,va);for(D=0;D<k.length;D++){for(var O=k[D],Da=O.texture_slots,G=0;G<Da.length;G++)z(Da[G],"texture",va);var ra=O.node_tree;ra&&y(ra,va)}for(D=0;D<n.length;D++)(ra=n[D].node_tree)&&y(ra,va);for(D=0;D<B.length;D++){var nb=B[D],X=nb.type;"IMAGE"!=X&&"ENVIRONMENT_MAP"!=X||z(nb,"image",va)}for(D=0;D<f.length;D++){var Aa=f[D];Aa.dof_object&&z(Aa,"dof_object",va)}for(D=0;D<v.length;D++){var T=v[D];T.sound&&z(T,"sound",va);if(T.animation_data&&(N=T.animation_data,N.action&&z(N,"action",va),N.nla_tracks))for(G=
0;G<N.nla_tracks.length;G++)for(V=N.nla_tracks[G],E=0;E<V.strips.length;E++)V.strips[E].action&&z(V.strips[E],"action",va)}for(D=0;D<q.length;D++){for(var la=q[D],Da=la.texture_slots,G=0;G<Da.length;G++)z(Da[G],"texture",va);la.dupli_group&&z(la,"dupli_group",va);la.dupli_object&&z(la,"dupli_object",va)}for(D=0;D<t.length;D++){var Ka=t[D];if(Ka.animation_data&&(N=Ka.animation_data,N.action&&z(N,"action",va),N.nla_tracks))for(G=0;G<N.nla_tracks.length;G++)for(V=N.nla_tracks[G],E=0;E<V.strips.length;E++)V.strips[E].action&&
z(V.strips[E],"action",va)}for(D=0;D<r.length;D++){var ha=r[D];if(Da=ha.texture_slots)for(G=0;G<Da.length;G++)z(Da[G],"texture",va);if(ha.animation_data&&(N=ha.animation_data,N.action&&z(N,"action",va),N.nla_tracks))for(G=0;G<N.nla_tracks.length;G++)for(V=N.nla_tracks[G],E=0;E<V.strips.length;E++)V.strips[E].action&&z(V.strips[E],"action",va)}Y.check_bpy_data(a);for(var Na=a.textures,sc=b.is_primary?a.scenes[0].b4w_anisotropic_filtering:Ga.b4w_anisotropic_filtering,Wa=0;Wa<Na.length;Wa++)b.is_primary||
"SCENE"!=Na[Wa].b4w_source_type||(Na[Wa].b4w_source_id=""),ea.create_texture_bpy(Na[Wa],sc,a.scenes,b.id);for(var ja={},pa=a.objects,ba=0;ba<pa.length;ba++){var ca=pa[ba];if("MESH"===ca.type&&!ca.particle_systems.length)for(var da=ca.data,sa=da.name,ga=da.submeshes,aa=da.materials,ya=0;ya<ga.length;ya++)0!==ga[ya].base_length||ja[sa]||(aa[ya]&&ma.warn('material "'+aa[ya].name+'" is not assigned to any face (object "'+ca.name+'").'),ja[sa]=!0)}for(var fa=a.meshes,ia=0;ia<fa.length;ia++){var Ha=fa[ia];
Ha.materials.length||Ha.uv_textures.length&&ma.warn('mesh "'+Ha.name+'" has a UV map but has no exported material.')}var ta=a.materials,bc=Y.create_material("DEFAULT");ta.push(bc);for(var Pa=a.meshes,gc=Fa.keysearch("name","DEFAULT",a.materials),wa=0;wa<Pa.length;wa++){var Nb=Pa[wa];0==Nb.materials.length&&Nb.materials.push(gc)}for(var Va=a.actions,Ob=b.id,Tb=0;Tb<Va.length;Tb++){var tb=Va[Tb];tb._data_id=Ob;W.append_action(tb)}for(var fb=a.scenes,Db=0;Db<fb.length;Db++){for(var cb=fb[Db],jb=[],Eb=
[],Ya=fb[Db].objects,kb=0;kb<Ya.length;kb++){var dc=Ya[kb];I(Ya,dc,null,jb,Eb);var lb=dc.dupli_group;if(lb)for(var mb=lb.objects,db=0;db<mb.length;db++)I(mb,mb[db],dc,jb,Eb)}for(kb=0;kb<Eb.length;kb++)for(var lc=Eb[kb],qc=[cb],xc=0;xc<qc.length;xc++){for(var Qa=qc[xc].objects,Sa=0;Sa<Qa.length;Sa++){var Fc=Qa[Sa].dupli_group;if(Fc){var $b=Fc.objects,Fb=$b.indexOf(lc);-1<Fb&&$b.splice(Fb,1)}}var Fb=Qa.indexOf(lc);-1<Fb&&Qa.splice(Fb,1)}for(kb=0;kb<jb.length;kb++)Fa.append_unique(jb[kb][0],jb[kb][1])}!b.is_primary&&
1<a.scenes.length&&(a.scenes=[xa.find_main_scene(a.scenes)],ma.warn("loading data contains multiple scenes.","Only the first one will be loaded."));var ad=b.is_primary?Ga:xa.find_main_scene(a.scenes);Ta.set_framerate(Ga.fps);if(1<a.scenes.length){var bd=a.scenes.indexOf(Ga);a.scenes.splice(bd,1);a.scenes.unshift(Ga)}for(var Tc=0;Tc<a.scenes.length;Tc++){var ec=a.scenes[Tc];ec._render=xa.create_scene_render();ec._is_main=ec==ad;ec._is_primary_thread=b.is_primary;zc.enabled&&ec.b4w_enable_physics&&
(b.is_primary||!L.scene_has_physics(Ga)&&ec==xa.find_main_scene(a))&&L.init_scene_physics(ec);b.is_primary?ec.b4w_enable_audio&&Ea.attach_scene_sfx(ec):ec.b4w_enable_audio&&!Ga._sfx&&Ea.attach_scene_sfx(Ga)}for(var rc=0;rc<a.scenes.length;rc++){for(var Gc=a.scenes[rc],fc=w(Gc,"ALL"),yc=0;yc<fc.length;yc++){var Ub=fc[yc];oa.check_bpy_obj_scene_compatibility(Ub,Gc,a)&&(Ub._scenes||(Ub._scenes=[]),Ub._scenes.push(b.is_primary?Gc:Ga))}for(var Vb=fc,mc=0;mc<Vb.length;mc++){var ac=Vb[mc];if(ac._scenes&&
"WORLD"!=ac.type)for(var Ad=ac.particle_systems,Oc=0;Oc<Ad.length;Oc++){var cd=Ad[Oc].settings;if("HAIR"==cd.type)if("OBJECT"==cd.render_type){var dd=cd.dupli_object;dd._scenes||(dd._scenes=ac._scenes.slice())}else if("GROUP"==cd.render_type)for(var ed=cd.dupli_group,rd=0;rd<ed.objects.length;rd++)dd=ed.objects[rd],dd._scenes||(dd._scenes=ac._scenes.slice())}}}for(var Bd=a.scenes,md=[],xb=0;xb<Bd.length;xb++)m(Bd[xb].objects,0,b.is_primary,md);yb[b.id]=[];for(xb=0;xb<md.length;xb++)for(var fd=md[xb],
Pc=0;Pc<fd.length;Pc++)for(var Cd=fd[Pc],Uc=0;Uc<Cd.length;Uc++)yb[b.id].push(Cd[Uc]);for(var Vc=a.particles,xb=0;xb<Vc.length;xb++){var Lc=Vc[xb].dupli_object;Lc&&(Lc._is_hair_dupli=!0,yb[b.id].push(Lc));var nd=Vc[xb].dupli_group;if(nd)for(var Wc=nd.objects,Pc=0;Pc<Wc.length;Pc++)Lc=Wc[Pc],Lc._is_hair_dupli=!0,yb[b.id].push(Lc)}for(var gd=yb[b.id],xb=gd.length-1;0<=xb;xb--)gd[xb]._scenes||gd.splice(xb,1);for(var Xc=yb[b.id],rc=0;rc<Xc.length;rc++)if(Ub=Xc[rc],!b.is_primary&&Ub.parent&&-1<Ib.indexOf(Ub.parent.type)&&
(Ub.parent=""),"MESH"==Ub.type){var hd=Y.apply_mesh_modifiers(Ub);hd&&(a.meshes.push(hd),Ub.data=hd)}for(var Qc=0;Qc<a.scenes.length;Qc++){var od=a.scenes[Qc],jd=od.world;jd._scenes||(jd._scenes=[]);jd._scenes.push(b.is_primary?od:Ga)}for(var Yc=0;Yc<a.scenes.length;Yc++){var Zc=a.scenes[Yc];if(Zc.b4w_use_logic_editor){var sd=w(Zc,"ALL");Y.assign_logic_nodes_object_params(sd,Zc.world,Zc)}}e(b,c)}function w(a,b){b||(b="ALL");var c=[];g(a.objects,b,c);return c}function g(a,b,c){for(var d=0;d<a.length;d++){var e=
a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&g(e.objects,b,c)}}function m(a,b,c,d){d[b]=d[b]||[];for(var e=d[b],g=0;g<a.length;g++){var f=a[g],h=fa(f);e[h]=e[h]||[];(c||-1==Ib.indexOf(f.type))&&-1==e[h].indexOf(f)&&e[h].push(f);(f=f.dupli_group)&&m(f.objects,b+1,c,d)}}function l(a,b,c){var d=[];a=yb[a];for(var e=0;e<a.length;e++){var g=a[e];if(g.type==c||"ALL"==c)for(var f=0;f<g._scenes.length;f++)b==g._scenes[f]&&d.push(g)}return d}function t(a,b,c,d,e,g){g=yb[b.id];var f=a.worlds;d=b.id;
for(var h=0;h<g.length;h++){for(var k=g[h],l=pa.create_object(k.name,k.type,k.origin_name),n=0;n<k._scenes.length;n++)pa.append_scene_data(l,k._scenes[n]);k._object=l;oa.update_object(k,l);l.render.data_id=d;l.is_hair_dupli=k._is_hair_dupli||!1}for(d=0;d<f.length;d++){h=f[d];k="%meta_world%"+h.name;k=pa.create_object(k,"WORLD",k);for(l=0;l<h._scenes.length;l++)pa.append_scene_data(k,h._scenes[l]);h._object=k;oa.update_world(h,k)}d=oa.get_all_objects(b.id);for(h=0;h<g.length;h++)k=g[h],l=k._object,
Z.update_object(k,l);for(h=0;h<f.length;h++)k=f[h],Z.update_object(k,k._object);if(b.is_primary)for(f=b.id,h=0;h<a.scenes.length;h++)for(var k=a.scenes[h],l=0,n=oa.get_scene_objs(k,"LAMP",f),m=0;m<n.length;m++)pa.get_scene_data(n[m],k).light_index=l++;for(h=0;h<g.length;h++)k=g[h],l=k._object,l.is_hair_dupli||(oa.update_object_relations(k,l),Ia.update_transform(l));for(a=0;a<g.length;a++)if(f=g[a],h=f._object,pa.is_mesh(h)&&(k=f.lod_levels.length))for(l=h,n=0;n<k;n++)if(m=f.lod_levels[n].object){m=
m._object;m.render.lod_transition_ratio=h.render.lod_transition_ratio;l.render.lod_dist_max=f.lod_levels[n].distance;m.render.lod_dist_min=f.lod_levels[n].distance;if(f.lod_levels[n+1])m.render.lod_dist_max=f.lod_levels[n+1].distance;else{m.render.last_lod=!0;m.render.lod_dist_max=1E6;break}l.render.last_lod=!1;l=m}else{l.render.last_lod=!0;l.render.lod_dist_max=f.lod_levels[n].distance;break}for(g=0;g<d.length;g++)if(a=d[g],"MESH"==a.type&&(f=a.armobj)){var f=f.render,h=a.render.bone_skinning_info,
k=[],p;for(p in h)l=h[p],k.push(4*l.deform_bone_index,4*l.bone_index);f.mesh_to_arm_bone_maps.push(k);f.skinned_renders.push(a.render)}g=p=-1;a=W.get_max_bones();for(f=0;f<d.length;f++)h=d[f],k=h.render,pa.is_mesh(h)&&k.is_skinning&&(h=k.max_bones,h>p&&(p=h),a>=h&&h>g&&(g=h));for(f=0;f<d.length;f++)h=d[f],k=h.render,pa.is_mesh(h)&&k.is_skinning&&(k.frames_blending=!0,p<a?k.max_bones=p:k.max_bones<=a?k.max_bones=g:(ma.warn('too many bones for "'+h.name+'" / '+k.max_bones+" bones (max "+a+" with blending, "+
2*a+" without blending). Blending between frames will be disabled."),k.max_bones=p,k.frames_blending=!1),k.frames_blending=k.frames_blending&&!La.frames_blending_hack);for(p=0;p<d.length;p++)if(g=d[p],g.is_vehicle)if(a=g.vehicle_settings,"CHASSIS"==a.part){g.vehicle={};g.vehicle.force_max=a.force_max;g.vehicle.brake_max=a.brake_max;g.vehicle.suspension_compression=a.suspension_compression;g.vehicle.suspension_stiffness=a.suspension_stiffness;g.vehicle.suspension_damping=a.suspension_damping;g.vehicle.wheel_friction=
a.wheel_friction;g.vehicle.roll_influence=a.roll_influence;g.vehicle.max_suspension_travel_cm=a.max_suspension_travel_cm;g.vehicle.engine_force=0;g.vehicle.brake_force=1;g.vehicle.steering=0;g.vehicle.speed=0;g.vehicle.props=[];g.vehicle.prop_offsets=[];g.vehicle.steering_wheel=null;h=(f=pa.get_dg_parent(g))?pa.get_dg_objects(f,d):d;for(f=0;f<h.length;f++)k=h[f],k.is_vehicle&&(l=k.vehicle_settings,L.is_car_wheel(k)&&a.name==l.name?(l=L.wheel_index(k.vehicle_settings.part),g.vehicle.props[l]=k,g.vehicle.prop_offsets[l]=
new Float32Array(8)):L.is_vehicle_steering_wheel(k)&&a.name==l.name?(g.vehicle.steering_wheel=k,g.vehicle.steering_max=l.steering_max,g.vehicle.steering_ratio=l.steering_ratio,g.vehicle.inverse_control=l.inverse_control,l=ra.invert(g.render.world_tsr,ra.create()),k=ra.multiply(l,k.render.world_tsr,l),g.vehicle.steering_wheel_tsr=k,l=new Float32Array([1,0,0]),ra.transform_dir_vec3(l,k,l),g.vehicle.steering_wheel_axis=l):L.is_vehicle_speedometer(k)&&a.name==l.name?(g.vehicle.speedometer=k,g.vehicle.speed_ratio=
l.speed_ratio,g.vehicle.max_speed_angle=l.max_speed_angle,l=ra.invert(g.render.world_tsr,ra.create()),k=ra.multiply(l,k.render.world_tsr,l),g.vehicle.speedometer_tsr=k,l=new Float32Array([1,0,0]),ra.transform_dir_vec3(l,k,l),g.vehicle.speedometer_axis=l):L.is_vehicle_tachometer(k)&&a.name==l.name&&(g.vehicle.tachometer=k,g.vehicle.delta_tach_angle=l.delta_tach_angle,l=ra.invert(g.render.world_tsr,ra.create()),k=ra.multiply(l,k.render.world_tsr,l),g.vehicle.tachometer_tsr=k,l=new Float32Array([1,0,
0]),ra.transform_dir_vec3(l,k,l),g.vehicle.tachometer_axis=l));if(4!=g.vehicle.props.length)throw"Not enough wheels for chassis "+g.name;}else if("HULL"==a.part)for(g.vehicle={},g.vehicle.props=[],g.vehicle.prop_offsets=[],g.vehicle.force_max=a.force_max,g.vehicle.brake_max=a.brake_max,g.vehicle.floating_factor=a.floating_factor,g.vehicle.water_lin_damp=a.water_lin_damp,g.vehicle.water_rot_damp=a.water_rot_damp,g.vehicle.engine_force=0,g.vehicle.brake_force=1,g.vehicle.steering=0,g.vehicle.speed=
0,g.vehicle.steering_wheel=null,h=(f=pa.get_dg_parent(g))?pa.get_dg_objects(f,d):d,f=0;f<h.length;f++)k=h[f],k.is_vehicle&&(l=k.vehicle_settings,L.is_boat_bob(k)&&a.name==l.name?(g.vehicle.props.push(k),g.vehicle.prop_offsets.push(new Float32Array(8))):L.is_vehicle_steering_wheel(k)&&a.name==l.name?(g.vehicle.steering_wheel=k,g.vehicle.steering_max=l.steering_max,g.vehicle.steering_ratio=l.steering_ratio,g.vehicle.inverse_control=l.inverse_control,l=ra.invert(g.render.world_tsr,ra.create()),k=ra.multiply(l,
k.render.world_tsr,l),g.vehicle.steering_wheel_tsr=k,l=new Float32Array([1,0,0]),ra.transform_dir_vec3(l,k,l),g.vehicle.steering_wheel_axis=l):L.is_vehicle_speedometer(k)&&a.name==l.name?(g.vehicle.speedometer=k,g.vehicle.speed_ratio=l.speed_ratio,g.vehicle.max_speed_angle=l.max_speed_angle,l=ra.invert(g.render.world_tsr,ra.create()),k=ra.multiply(l,k.render.world_tsr,l),g.vehicle.speedometer_tsr=k,l=new Float32Array([1,0,0]),ra.transform_dir_vec3(l,k,l),g.vehicle.speedometer_axis=l):L.is_vehicle_tachometer(k)&&
a.name==l.name&&(g.vehicle.tachometer=k,g.vehicle.delta_tach_angle=l.delta_tach_angle,l=ra.invert(g.render.world_tsr,ra.create()),k=ra.multiply(l,k.render.world_tsr,l),g.vehicle.tachometer_tsr=k,l=new Float32Array([1,0,0]),ra.transform_dir_vec3(l,k,l),g.vehicle.tachometer_axis=l));for(p=0;p<d.length;p++)if(g=d[p],g.is_floating&&(a=g.floating_settings,"MAIN_BODY"==a.part))for(g.floater={},g.floater.floating_factor=a.floating_factor,g.floater.water_lin_damp=a.water_lin_damp,g.floater.water_rot_damp=
a.water_rot_damp,g.floater.bobs=[],f=(f=pa.get_dg_parent(g))?pa.get_dg_objects(f,d):d,h=0;h<f.length;h++)k=f[h],k.is_floating&&(l=k.floating_settings,L.is_floater_bob(k)&&a.name==l.name&&(g.floater.bobs.push(k),k.bob_synchronize_pos=k.floating_settings.synchronize_position));e(b,c)}function F(a,b,c,d,e,g){for(d=0;d<a.scenes.length;d++)g=a.scenes[d],g._camera=g.camera._object;for(d=0;d<a.scenes.length;d++){g=b.is_primary?a.scenes[d]:Ga;var f=b.is_primary?oa.get_scene_objs(g,"LAMP",b.id):oa.get_scene_objs(g,
"LAMP",0),h=oa.get_scene_objs(g,"ALL",b.id),k=l(b.id,g,"MESH"),n=l(b.id,g,"EMPTY");l(b.id,g,"WORLD");b.is_primary&&xa.append_scene(g,h,f,k,n);for(var m=0;m<n.length;m++)oa.update_force(n[m]._object);h=[];xa.set_active(g);la.generate_main_batches(g,k,f,h);m=l(b.id,g,"LINE");la.generate_line_batches(g,m);n=xa.get_graph(g);if(b.is_primary){m=g._render.sky_params;if(m.render_sky||m.procedural_skydome){var p=g.world._object;la.append_sky_batch_to_world(g,m,p);la.create_forked_batches(p,n,g)}xa.generate_auxiliary_batches(n)}for(m=
0;m<k.length;m++)la.create_forked_batches(k[m]._object,n,g);for(m=0;m<h.length;m++)la.create_forked_batches(h[m],n,g),oa.objects_storage_add(h[m]);h=oa.get_scene_objs(g,"ALL",b.id);xa.assign_scene_data_subs(g,h,f);for(m=0;m<h.length;m++)g=h[m],g.render.use_shape_keys&&oa.update_boundings(g),pa.check_inv_zup_tsr_is_needed(g)&&(g.need_inv_zup_tsr=!0)}xa.append_scene_vtex(Ga,a.textures,b.id);b.is_primary&&Ga._render.video_textures.length&&(b.has_video_textures=!0);d=a.materials;if(va.dds_available&&
Ba.use_dds)for(a=0;a<d.length;a++){k=d[a];m=k.texture_slots;for(g=0;g<m.length;g++)if(h=m[g],n=h.texture,"IMAGE"==n.type||"ENVIRONMENT_MAP"==n.type)f=n.image,f._is_dds||(-1<f.filepath.indexOf(".dds")?f._is_dds=!0:(f._is_dds=!n.b4w_disable_compression&&!h.use_map_normal&&"ENVIRONMENT_MAP"!=n.type&&!n.b4w_shore_dist_map&&"MOVIE"!=f.source,f._is_dds&&(f.filepath+=".dds")));if(g=k.node_tree)for(k=g.nodes,g=0;g<k.length;g++)f=k[g],"TEXTURE"==f.type&&(m=f.texture)&&(f=m.image)&&!f._is_dds&&(f._is_dds=m._render.allow_node_dds&&
!m.b4w_disable_compression&&"MOVIE"!=f.source&&"ENVIRONMENT_MAP"!=m.type,f._is_dds&&(f.filepath+=".dds"))}else for(a=a.images,d=0;d<a.length;d++)g=a[d],f=Boolean("FILE"==g.source&&-1<g.filepath.indexOf(".dds")),g._is_dds=f;e(b,c)}function H(a,b,c,d,e,g){d=a.groups;g=a.objects;for(var f={},h={},k={},l={},n=0;n<d.length;n++){var m=d[n];f[m.uuid]=m;k[m.uuid]=m}for(n=0;n<g.length;n++)m=g[n],h[m.uuid]=m,l[m.uuid]=m;a=a.scenes;for(n=0;n<a.length;n++)C(a[n].objects,null,l,k,null);for(var p in k)p in f||
d.push(k[p]);for(p in l)p in h||g.push(l[p]);e(b,c)}function C(a,b,c,d,e){for(var g=[],f=0;f<a.length;f++){var h=a[f],k=c[h.uuid];if(h=k.proxy){b&&-1==g.indexOf(h.uuid)&&g.push(h.uuid);for(var l=c[h.uuid],n=l.constraints,h=0;h<n.length;h++){var m=Fa.clone_object_json(n[h]);m.name+="_CLONE";k.constraints.push(m)}"b4w_proxy_inherit_anim"in k&&!k.b4w_proxy_inherit_anim||(k.animation_data&&(l.animation_data=Fa.clone_object_json(k.animation_data)),l.b4w_use_default_animation=k.b4w_use_default_animation,
l.b4w_auto_skel_anim=k.b4w_auto_skel_anim,l.b4w_anim_behavior=k.b4w_anim_behavior,l.b4w_cyclic_animation=k.b4w_cyclic_animation)}}for(f=0;f<g.length;f++)k=Fa.get_index_for_key_value(a,"uuid",g[f]),-1<k&&a.splice(k,1);g={};if(b)for(f=0;f<a.length;f++)h=a[f],k=c[h.uuid],n=Fa.clone_object_json(k),l="origin_name"in k?k.origin_name:k.name,n.name=pa.gen_dupli_name(b.name,l),n.origin_name=l,n.dg_parent={uuid:b.uuid},x(n),c[n.uuid]=n,g[h.uuid]=n.uuid,h.uuid=n.uuid,e&&e[k.uuid]&&(n.b4w_cluster_data=e[k.uuid]);
for(f=0;f<a.length;f++)h=a[f],k=c[h.uuid],k.dupli_group&&(h=k.dupli_group,e=d[h.uuid],n=Fa.clone_object_json(e),n.name=Fa.unique_name(e.name+"_CLONE"),n.uuid=V.hexdigest("Group"+n.name),d[n.uuid]=n,h.uuid=n.uuid,C(n.objects,k,c,d,k.b4w_cluster_data));if(b)for(f=0;f<a.length;f++){h=a[f];k=c[h.uuid];k.parent&&k.parent.uuid in g?k.parent.uuid=g[k.parent.uuid]:k.parent&&(ma.warn("Object's \""+k.name+'" parent is not in dupli group. Disabling parenting.'),k.parent=null);n=k.constraints;for(h=0;h<n.length;h++)b=
n[h],b.target&&b.target.uuid in g&&(b.target.uuid=g[b.target.uuid]);if(b=k.pose)for(d=b.bones,h=0;h<d.length;h++)if(e=d[h].constraints)for(n=0;n<e.length;n++)b=e[n],b.target&&b.target.uuid in g&&(b.target.uuid=g[b.target.uuid]);b=k.modifiers;for(h=0;h<b.length;h++)d=b[h],d.object&&d.object.uuid in g&&(d.object.uuid=g[d.object.uuid]);if((k=k.lod_levels)&&k.length)for(h=0;h<k.length;h++)b=k[h],b.object&&b.object.uuid in g&&(b.object.uuid=g[b.object.uuid])}for(var p in g)Na[p]=g[p]}function x(a){a.uuid=
V.hexdigest("Object"+a.name)}function y(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var g=c[d];"TEXTURE"==g.type&&g.texture&&z(g,"texture",b);"LAMP"==g.type&&g.lamp&&(g.lamp.uuid in Na&&(g.lamp.uuid=Na[g.lamp.uuid]),b[g.lamp.uuid]||(g.lamp=null));"GROUP"==g.type&&g.node_group&&z(g,"node_group",b)}g=a.links;for(d=0;d<g.length;d++){var f=g[d];E(f,"from_node",c);E(f,"to_node",c);e(f,"from_socket",f.from_node.outputs);e(f,"to_socket",f.to_node.inputs)}if(c=a.animation_data)if(c.action&&z(c,"action",b),
c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(g=c.nla_tracks[d],f=0;f<g.strips.length;f++)g.strips[f].action&&z(g.strips[f],"action",b)}function z(a,b,c){(c=c[a[b].uuid])||ma.error("Dangling link found:",b,a);a[b]=c}function E(a,b,c){c=Fa.keysearch("name",a[b].name,c);a[b]=c}function e(a,b,c){c=Fa.keysearch("identifier",a[b].identifier,c);a[b]=c}function n(a,b,d,e,g,f){e=da(b.filepath);for(var h=a.images,k={},l=[],n=0;n<h.length;n++){var m=h[n],p=m.uuid;if("FILE"===m.source||"MOVIE"===m.source){var q=
D(m,a.textures);if(!q.length)ma.warn("image ",m.name," has no users.");else if(!q[0].b4w_shore_dist_map){q=Fa.normpath_preserve_protocol(e+m.filepath);if("FILE"===m.source){var v=m._is_dds?A.AT_ARRAYBUFFER:A.AT_IMAGE_ELEMENT;va.min50_available&&Ba.use_min50&&(q=A.split_extension(q),"dds"==q[1]?(q=A.split_extension(q[0]),q=q[0]+".min50."+q[1]+".dds"):q=q[0]+".min50."+q[1])}else"MOVIE"===m.source&&(Ba.seq_video_fallback?(q=A.split_extension(q),q=q[0]+".altconv.seq",v=A.AT_SEQ_VIDEO_ELEMENT):(q=A.split_extension(q),
v=Ea.detect_video_container(q[1]),q=v!=q[1]?q[0]+".altconv."+v:q[0]+"."+v,v=A.AT_VIDEO_ELEMENT));l.push({id:p,type:v,url:q});k[p]=m}}}if(l.length){var t=0;A.enqueue(l,function(e,g,h,n){if(e){if(h==A.AT_VIDEO_ELEMENT||h==A.AT_SEQ_VIDEO_ELEMENT){if(h==A.AT_VIDEO_ELEMENT)var m=e.videoWidth,p=e.videoHeight;else m=e.images[0].width,p=e.images[0].height;ma.log("%cLOAD VIDEO "+m+"x"+p,"color: #"+(2048<m||2048<p?"a00":1024<m||1024<p?"aa0":"0a0"),n);-1==n.indexOf(ua)&&ma.warn("video",n,"is not from app root.")}else c(e,
n,!0);g=k[g];n=D(g,a.textures);for(m=0;m<n.length;m++){var p=n[m],q=p.image.filepath;h==A.AT_SEQ_VIDEO_ELEMENT?(p._render.seq_fps=e.fps,ea.update_texture(p._render,e.images,g._is_dds,q,b.id)):ea.update_texture(p._render,e,g._is_dds,q,b.id)}}e=++t/l.length;f(b,d,e)},function(){ma.log("%cLOADED ALL IMAGES","color: #0a0");g(b,d)})}else g(b,d)}function M(a,b,c,d,e,g){a=xa.get_rendered_scenes();for(d=0;d<a.length;d++)if(g=a[d],g.b4w_use_nla){var f=g.b4w_nla_cyclic;g.b4w_use_logic_editor&&(f=!1);Z.update_scene(g,
f,b.id)}e(b,c)}function D(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function G(a,b,c,d,e,g){a=da(b.filepath);var f=[],h={};d=oa.get_all_objects(b.id);for(var k=0;k<d.length;k++){var l=d[k];if(Q(l)){var n=l.sfx.uuid;"BACKGROUND_MUSIC"==Ea.get_spk_behavior(l)?(n=Fa.gen_uuid(),b.has_background_music=!0):"NONE"!=Ea.get_spk_behavior(l)&&Ba.init_wa_context_hack&&(b.init_wa_context=!0);if(!(n in h)){h[n]=[];var m=Fa.normpath_preserve_protocol(a+l.sfx.filepath);switch(Ea.source_type(l)){case Ea.AST_ARRAY_BUFFER:var p=
A.AT_AUDIOBUFFER;break;case Ea.AST_HTML_ELEMENT:p=A.AT_AUDIO_ELEMENT}var m=A.split_extension(m),q=Ea.detect_audio_container(m[1]),m=q!=m[1]?m[0]+".altconv."+q:m[0]+"."+q;f.push({id:n,type:p,url:m})}h[n].push(l)}}if(f.length){var v=0;A.enqueue(f,function(a,d,e,k){if(a)for(ma.log("%cLOAD SOUND","color: #0aa",k),-1==k.indexOf(ua)&&ma.warn("sound",k,"is not from app root."),d=h[d],e=0;e<d.length;e++)Ea.update_spkobj(d[e],a);a=++v/f.length;g(b,c,a)},function(){ma.log("%cLOADED ALL SOUNDS","color: #0aa");
e(b,c)})}else e(b,c)}function Q(a){return pa.is_speaker(a)&&Ea.source_type(a)!=Ea.AST_NONE}function v(a,b,c){a=oa.get_scene_objs(a,"SPEAKER",b);for(b=0;b<a.length;b++){var d=a[b];pa.is_speaker(d)&&(Ea.is_cyclic(d)||c)&&Ea.play_def(d)}}function P(a,b){for(var c=a._render.video_textures,d=0;d<c.length;d++){var e=c[d]._render;a.b4w_use_nla&&c[d].b4w_nla_video||!c[d].use_auto_refresh||b!=e.vtex_data_id||(ea.reset_video(e.name,b),ea.play_video(e.name,b))}}function S(a,b,c,d,e,g){Z.start();ma.log("%cSTART NLA",
"color: #0a0");e(b,c)}function I(a,b,c,d,e){if(b.lod_levels&&b.lod_levels.length)for(var g=b.lod_levels.length,f=0;f<g;f++){var h=b.lod_levels[f],k=h.object;if(k){var l=Fa.clone_object_nr(k);l.name=b.name+"_LOD_"+String(f+1);l.b4w_cluster_data=b.b4w_cluster_data;x(l);l.lod_levels=[];c&&(l.dg_parent=c);d.push([a,l]);e.push(k);h.object=l}}}function K(a,b,c,d,e,g){d=!0;for(g=0;g<a.scenes.length;g++)if(!L.check_worker_loaded(a.scenes[g])){d=!1;break}d&&(e(b,c),ma.log("%cPHYSICS READY","color: #0a0"))}
function B(a,b,c,d,e,g){for(d=0;d<a.scenes.length;d++){g=a.scenes[d];if(b.is_primary)var f=L.scene_has_physics(g);else f=L.scene_has_physics(Ga)||L.scene_has_physics(g),g=Ga;if(zc.enabled&&f)for(f=0;f<sc.length;f++)for(var h=oa.get_scene_objs(g,sc[f],b.id),k=0;k<h.length;k++){var l=h[k];l.render.data_id==b.id&&(L.append_object(l,g),b.load_hidden&&L.obj_has_physics(l)&&L.disable_simulation(l))}}e(b,c)}function N(a,b,d,e,g,f){var h={};e=[];var k=a.scenes;for(f=0;f<a.scenes.length;f++){var l=k[f];if(l._render.water_params&&
(l=l._render.water_params.shoremap_image)&&"FILE"===l.source){var n=l.uuid,m=da(b.filepath),m=Fa.normpath_preserve_protocol(m+l.filepath);e.push({id:n,type:l._is_dds?A.AT_ARRAYBUFFER:A.AT_IMAGE_ELEMENT,url:m});h[n]=l}}e.length?A.enqueue(e,function(d,e,g,f){if(d){c(d,f,!0);e=h[e];f=D(e,a.textures);for(g=0;g<f.length;g++){var l=f[g];ea.update_texture(l._render,d,e._is_dds,l.image.filepath,b.id)}for(g=0;g<k.length;g++)if(f=k[g],f._render.water_params&&(l=f._render.water_params.shoremap_image,l===e)){var n=
d,m=e,p=document.createElement("canvas"),l=m.size[0],m=m.size[1];p.width=l;p.height=m;p=p.getContext("2d");p.drawImage(n,0,0);n=p.getImageData(0,0,l,m).data;p=new Float32Array(4);p[0]=1/16581375;p[1]=1/65025;p[2]=1/255;p[3]=1;for(var l=l*m,m=new Float32Array(l),q=0;q<l;q++)m[q]=p[1]*n[4*q+2]+p[2]*n[4*q+3];f._render.shore_distances=m}}else for(e=h[e],g=0;g<k.length;g++)f=k[g],l=f._render.water_params.shoremap_image,l===e&&(f._render.water_params.shoremap_image=null,ma.warn("image",l.filepath," was not found. Disabling water shore effects."))},
function(){g(b,d)}):g(b,d)}function J(a,b,d,e,g,f){e=a.scenes[0];a=[];var h=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"];for(f=0;f<h.length;f++){var k=xa.get_subs(e,h[f]);k&&a.push(k)}if(a.length){e=[];da(b.filepath);f=A.AT_IMAGE_ELEMENT;e.push({id:"SEARCH_TEXTURE",type:f,filepath:ja.paths.smaa_search_texture_path});e.push({id:"AREA_TEXTURE",type:f,url:ja.paths.smaa_area_texture_path});for(f=0;f<a.length;f++)if(h=a[f],"SMAA_BLENDING_WEIGHT_CALCULATION"==
h.type){a=h.slinks_internal;for(f=0;f<a.length;f++)if(h=a[f],"u_search_tex"==h.to)var l=h.texture;else if("u_area_tex"==h.to)var n=h.texture;break}e.length?A.enqueue(e,function(a,d,e,g){a&&(c(a,g,!1),d="SEARCH_TEXTURE"==d?l:n,d.source="IMAGE",d.auxilary_texture=!0,e=-1!=g.indexOf(".dds")?1:0,ea.update_texture(d,a,e,g,b.id),ea.set_filters(d,ea.TF_LINEAR,ea.TF_LINEAR))},function(){g(b,d)}):g(b,d)}else g(b,d)}function X(a,b,c,d,e,g){for(c=0;c<a.scenes.length;c++){e=a.scenes[c];b.is_primary||(e=Ga);var f=
oa.get_scene_objs(e,"LAMP",b.id);for(g=0;g<f.length;g++){var h=f[g];h.render.data_id==b.id&&d.added_objects.push({scene:e,obj:h})}f=oa.get_scene_objs(e,"ALL",b.id);for(g=0;g<f.length;g++)h=f[g],"LAMP"!=h.type&&h.render.data_id==b.id&&(b.load_hidden&&pa.is_mesh(h)&&xa.change_visibility(h,!0),d.added_objects.push({scene:e,obj:h}))}}function O(a,b,c,d,e,g){var f=d.added_objects;e=d.obj_counter;if(f.length){a=f[e].obj;var h=f[e].scene;e=pa.get_scene_data(a,h);xa.append_object(h,a,!1);a.anchor&&ka.append(a);
d=++d.obj_counter/f.length;f=e.cube_refl_subs;if(null!=a.render.cube_reflection_id&&f){var k=Da.copy(a.render.bs_world.center,Ka);xa.update_cube_reflect_subs(f,k)}f=a.reflective_objs;if(f.length&&h._render.reflection_params)for(h=ra.get_trans_view(a.render.world_tsr),a=ra.get_quat_view(a.render.world_tsr),e=e.plane_refl_subs,k=0;k<e.length;k++)xa.update_plane_reflect_subs(e[k],h,a),pa.update_refl_objects(f,e[k].camera.reflection_plane)}else d=1;g(b,c,d)}function ba(a,b,c,d,e,g){if(b.is_primary){d=
xa.get_main();g=xa.get_rendered_scenes();for(a=0;a<g.length;a++){var f=g[a];xa.prepare_rendering(f,d);f.b4w_use_logic_editor&&qa.init_logic(f,b.id)}xa.set_active(d)}else xa.update_scene_permanent_uniforms(Ga);d=oa.get_all_objects(b.id);oa.update_objects_dynamics(d);for(g=0;g<d.length;g++)for(f=d[g],a=0;a<f.scenes_data.length;a++)for(var h=f.scenes_data[a].batches,k=0;k<h.length;k++)null==h[k].shader&&h.splice(k--,1);e(b,c)}function ca(a,b,c,d,e,g){if(b.is_primary)for(d=0;d<a.scenes.length;d++)P(a.scenes[d],
b.id),v(a.scenes[d],b.id);else P(Ga,b.id),v(Ga,b.id);e(b,c)}function ga(a,b,c,d,e,g){for(d=0;d<a.scenes.length;d++)a.scenes[d].camera=null;Ba.media_auto_activation&&(b.has_video_textures||b.has_background_music||b.init_wa_context)?Pa||aa(a,e,b,c):e(b,c)}function aa(a,b,c,d){function e(){if(!k){k=!0;c.has_video_textures&&(ea.play(),ea.pause(),ea.reset());if(c.has_background_music){if(c.is_primary)for(var g=0;g<a.scenes.length;g++)v(a.scenes[g],c.id,!0);else v(Ga,c.id,!0);Ea.pause()}c.init_wa_context&&
Ea.play_empty_sound();ia();b(c,d)}}var g=gc.parentElement;ya=g.style.zIndex;g.style.zIndex="999";Pa=document.createElement("div");Pa.style.position="relative";Pa.style.height="88px";Pa.style.width="88px";var f=Math.round(gc.offsetHeight/2-44),h=Math.round(gc.offsetWidth/2-44);Pa.style.top=f.toString()+"px";Pa.style.left=h.toString()+"px";Pa.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC')";
Pa.style.backgroundSize="88px";Wa=document.createElement("div");Wa.style.position="relative";Wa.style.height=gc.offsetHeight.toString()+"px";Wa.style.width=gc.offsetWidth.toString()+"px";Wa.style.background="rgba(0, 0, 0, 0.5)";Wa.style.zIndex="999";g.appendChild(Wa);Wa.appendChild(Pa);Pa.addEventListener("touchstart",e,!1);Pa.addEventListener("click",e,!1);var k=!1}function ia(){if(Pa){var a=gc.parentElement;a.style.zIndex=ya;Wa.removeChild(Pa);a.removeChild(Wa);Pa=Wa=null;ya=0}}function da(a){(a=
a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function ta(a,b,c){W.is_animated(b)&&W.remove(b);Aa.remove_obj_from_cache(b);oa.clear_outline_anim(b);ha.check_sensor_manifold(b)&&ha.remove_sensor_manifold(b);L.obj_has_physics(b)&&L.remove_object(b);xa.remove_object_bundles(a,b,c);pa.is_speaker(b)&&Ea.speaker_remove(b);ka.is_anchor(b)&&ka.remove(b)}function fa(a){var b=W.get_bpy_armobj(a);a=b&&b.parent==a?null:a.parent||b;return a?1+fa(a):0}var ka=r("__anchors"),W=r("__animation"),A=r("__assets"),
la=r("__batch"),ja=r("__config"),ha=r("__controls"),sa=r("__dds"),T=r("__extensions"),Ha=r("__input"),R=r("__loader"),V=r("__md5"),Z=r("__nla"),qa=r("__logic_nodes"),Aa=r("__particles"),U=r("__nodemat"),oa=r("__objects"),pa=r("__obj_util"),L=r("__physics"),ma=r("__print"),Y=r("__reformer"),wa=r("__renderer"),xa=r("__scenes"),Ea=r("__sfx"),za=r("__shaders"),ea=r("__textures"),Ta=r("__time"),Ia=r("__transform"),ra=r("__tsr"),Fa=r("__util"),Da=r("__vec3"),Ba=ja.defaults,va=ja.assets,zc=ja.physics,La=
ja.animation,nb=ja.sfx,na=null,yb=null,ua="",Ga=null,Na={},Ka=new Float32Array(3),Pa=null,Wa=null,ya=0,bc=!1,Ib=["LAMP","CAMERA"],sc=["MESH","CAMERA","EMPTY"],gc=null;a.is_primary_loaded=function(a){return R.is_primary_loaded(a)};a.update=function(){R.update_scheduler(na)};a.setup_canvas=function(a){gc=a};a.update_media_controls=function(a,b){if(Pa){Wa.style.height=b.toString()+"px";Wa.style.width=a.toString()+"px";var c=Math.round(b/2-44),d=Math.round(a/2-44);Pa.style.top=c.toString()+"px";Pa.style.left=
d.toString()+"px"}};a.load=function(a,c,e,g,k){var l={load_main:{priority:R.ASYNC_PRIORITY,background_loading:!1,inputs:[],is_resource:!1,relative_size:500,primary_only:!1,cb_before:b},duplicate_objects:{priority:R.SYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:H},load_binaries:{priority:R.ASYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:500,primary_only:!1,cb_before:h},wait_for_shaders:{priority:R.SYNC_PRIORITY,
background_loading:!1,inputs:[],is_resource:!1,relative_size:50,primary_only:!0,cb_loop:d},prepare_bindata:{priority:R.SYNC_PRIORITY,background_loading:!1,inputs:["duplicate_objects","load_binaries"],is_resource:!1,relative_size:100,primary_only:!1,cb_before:q},prepare_bpy_data:{priority:R.SYNC_PRIORITY,background_loading:!1,inputs:["duplicate_objects","prepare_bindata"],is_resource:!1,relative_size:100,primary_only:!1,cb_before:f},process_objects:{priority:R.SYNC_PRIORITY,background_loading:!1,inputs:["prepare_bpy_data"],
is_resource:!1,relative_size:150,primary_only:!1,cb_before:t},process_scenes:{priority:R.SYNC_PRIORITY,background_loading:!1,inputs:["process_objects","wait_for_shaders"],is_resource:!1,relative_size:300,primary_only:!1,cb_before:F},load_smaa_textures:{priority:R.ASYNC_PRIORITY,background_loading:!1,inputs:["process_scenes"],is_resource:!1,relative_size:30,primary_only:!0,cb_before:J},load_shoremap:{priority:R.ASYNC_PRIORITY,background_loading:!1,inputs:["process_scenes"],is_resource:!1,relative_size:30,
primary_only:!0,cb_before:N},load_textures:{priority:R.ASYNC_PRIORITY,background_loading:!0,inputs:["process_scenes"],is_resource:!0,relative_size:500,primary_only:!1,cb_before:n},update_scenes_nla:{priority:R.SYNC_PRIORITY,background_loading:!1,inputs:["process_scenes","load_textures"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:M},wait_physics_workers:{priority:R.SYNC_PRIORITY,background_loading:!1,inputs:["load_shoremap"],is_resource:!1,relative_size:20,primary_only:!1,cb_loop:K},
add_physics_objects:{priority:R.SYNC_PRIORITY,background_loading:!1,inputs:["wait_physics_workers"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:B},add_objects:{priority:R.SYNC_PRIORITY,background_loading:!1,inputs:["add_physics_objects"],is_resource:!1,relative_size:600,primary_only:!1,cb_before:X,cb_loop:O,cb_after:ba,cb_param:{added_objects:[],obj_counter:0}},load_speakers:{priority:R.ASYNC_PRIORITY,background_loading:!0,inputs:["add_objects"],is_resource:!0,relative_size:100,primary_only:!1,
cb_before:G},mobile_media_start:{priority:R.SYNC_PRIORITY,background_loading:!1,inputs:["load_textures","update_scenes_nla","load_speakers"],is_resource:!0,relative_size:5,primary_only:!1,cb_before:ga,cb_loop:ga},synchronize_media:{priority:R.SYNC_PRIORITY,background_loading:!0,inputs:["mobile_media_start"],is_resource:!0,relative_size:50,primary_only:!1,cb_before:ca},start_nla:{priority:R.SYNC_PRIORITY,background_loading:!0,inputs:["mobile_media_start"],is_resource:!1,relative_size:5,primary_only:!0,
cb_before:S}},m=R.get_scheduler();m||(m=R.create_scheduler(),na={},yb={},Na={});na[m.threads.length]={};return R.create_thread(l,a,c,e,u,g||nb.audio_loading_hack,Ba.do_not_load_resources,k)};a.unload=function(a){var b=R.get_scheduler();if(!b||!b.threads.length||a&&!R.thread_is_finished(b.threads[a]))ma.error("Unable to unload data!");else{if(0==a)ma.log("%cUNLOAD ALL","color: #00a"),ka.cleanup(),W.cleanup(),Ea.cleanup(),Z.cleanup(),xa.cleanup(),R.cleanup(),ha.cleanup(),L.cleanup(),oa.cleanup(),Fa.cleanup(),
wa.cleanup(),U.cleanup(),za.cleanup(),T.cleanup(),A.cleanup(),ea.cleanup(),qa.cleanup(),Aa.cleanup(),Ha.cleanup(),yb=null,Na={},na=Ga=null,bc=!1;else{ma.log("%cUNLOAD DATA "+a,"color: #00a");W.remove_actions(a);for(var b=xa.get_all_scenes(),c=0;c<b.length;c++)for(var d=b[c],e=oa.get_scene_objs(d,"ALL",a),g=e.length-1;0<=g;g--){var f=e[g];ta(d,f,!0);oa.remove_object(f)}}ia()}};a.prepare_object_unloading=ta;a.set_debug_resources_root=function(a){ua=a};a.activate_media=function(){bc||Ba.media_auto_activation||
(ea.play(),ea.pause(),ea.reset(),v(Ga,oa.DATA_ID_ALL,!0),Ea.pause(),Ba.init_wa_context_hack&&Ea.play_empty_sound(),bc=!0)}};b4w.module.__batch=function(a,r){function u(a){a={type:a,subtype:"",id:0,render_id:0,cluster_id:-1,debug_id:-1,odd_id_prop:"",textures:[],texture_names:[],material_names:[],common_attributes:[],uv_maps_usage:null,vertex_colors_usage:{},shader:null,shaders_info:{vert:null,frag:null,directives:[],node_elements:[]},attribute_setters:[],particle_system:null,bufs_data:null,use_shape_keys:!1,debug_sphere:!1,debug_sphere_dynamic:!1,debug_view_mode:0,num_vertices:0,num_triangles:0,jitter_amp:0,jitter_freq:0,
grass_scale_threshold:0,grass_size:0,grass_map_dim:new Float32Array(3),cube_fog:new Float32Array(16),alpha_clip:!1,blend:!1,color_mask:!1,depth_mask:!1,xray:!1,use_backface_culling:!1,use_shadeless:!1,dynamic_geometry:!1,shadow_cast:!1,shadow_cast_only:!1,shadow_receive:!1,reflexible:!1,reflexible_only:!1,reflective:!1,dynamic_grass:!1,procedural_sky:!1,draw_mode:W.DM_DEFAULT,z_sort:!1,can_fork_outline:!1,forked_batch:!1,psys_name:"",shadow_source:"",halo:!1,halo_size:0,halo_hardness:0,halo_stars_blend:0,
halo_stars_height:0,halo_rings_color:new Float32Array(3),halo_lines_color:new Float32Array(3),halo_particles:!1,ambient:0,emit:0,diffuse_intensity:1,reflect_factor:0,specular_color_factor:0,specular_alpha:1,parallax_scale:0,diffuse_color_factor:0,alpha_factor:1,normal_factor:0,mirror_factor:0,offset_z:0,refr_bump:0,diffuse_params:Array(2),specular_params:new Float32Array(3),texture_scale:new Float32Array(3),specular_color:new Float32Array(3),diffuse_color:new Float32Array(4),fresnel_params:new Float32Array(4),
lamp_uuid_indexes:null,lamp_light_positions:null,lamp_light_directions:null,lamp_light_color_intensities:null,lamp_light_factors:null,has_nodes:!1,water:!1,water_dynamic:!1,water_shore_smoothing:!1,water_generated_mesh:!1,water_num_cascads:0,water_subdivs:0,water_detailed_dist:0,water_norm_uv_velocity:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,foam_uv_freq:new Float32Array(2),foam_mag:new Float32Array(2),foam_scale:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
normalmap_scales:null,refractive:!1,particles_data:null,line_width:0,part_use_tangent:!1,part_node_data:null,node_values:null,node_value_inds:null,node_anim_inds:null,node_rgbs:null,node_rgb_inds:null,node_rgb_anim_inds:null,bb_local:null,be_local:null,bb_world:null,be_world:null};a.diffuse_color[3]=1;a.color_mask=!0;a.depth_mask=!0;a.line_width=1;return a}function c(a){switch(a.type){case "MAIN":case "PARTICLES":case "LINE":a.subtype=a.blend?a.xray?"XRAY":"BLEND":"OPAQUE";break;case "SHADOW":a.subtype=
a.shadow_cast_only?"CAST":"RECEIVE";break;case "COLOR_ID":a.subtype=a.xray?"COLOR_ID_XRAY":"COLOR_ID"}}function b(a){var b=a.bufs_data;a.bufs_data=null;var c=ja.copy_object_props_by_value(a);a.bufs_data=b;c.bufs_data=b;return c}function h(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],g=e._object.render,f=da.zero_bounding_box();da.copy_bb(g.bb_original,f);var h=e.data.b4w_bounding_cylinder_radius,l=e.data.b4w_bounding_sphere_radius,n=e.data.b4w_bounding_sphere_center,m=e.data.b4w_bounding_ellipsoid_axes,
p=e.data.b4w_bounding_ellipsoid_center;if(g.billboard){var h=Math.max(Math.abs(f.max_x),Math.abs(f.min_x)),l=Math.max(Math.abs(f.max_y),Math.abs(f.min_y)),v=Math.max(Math.abs(f.max_z),Math.abs(f.min_z)),v=Math.sqrt(h*h+l*l+v*v),h=Math.sqrt(h*h+l*l);f.max_x=f.max_y=f.max_z=v;f.min_x=f.min_y=f.min_z=-v;l=v;n[0]=n[1]=n[2]=0;m[0]=m[1]=m[2]=v;p[0]=p[1]=p[2]=0}g.bb_local=f;v=da.bounding_box_transform(f,g.world_tsr);g.bb_world=v;k(g,h,h,f);f=da.create_bounding_sphere(l,n);g.bs_local=f;f=da.bounding_sphere_transform(f,
g.world_tsr);g.bs_world=f;m=da.create_bounding_ellipsoid([m[0],0,0],[0,m[1],0],[0,0,m[2]],p);g.be_local=m;m=da.bounding_ellipsoid_transform(m,g.world_tsr);g.be_world=m;c=c.concat(q(e,g,b))}return c}function d(a,b){for(var c=[],d=[],e={},g=0;g<a.length;g++){var f=a[g],h=f._object.render,k=da.zero_bounding_box();da.copy_bb(h.bb_original,k);var l=da.bounding_box_transform(k,h.world_tsr),n=da.create_bounding_sphere(f.data.b4w_bounding_sphere_radius,f.data.b4w_bounding_sphere_center),m=da.bounding_sphere_transform(n,
h.world_tsr),p=f.data.b4w_bounding_ellipsoid_axes,p=da.create_bounding_ellipsoid([p[0],0,0],[0,p[1],0],[0,0,p[2]],f.data.b4w_bounding_ellipsoid_center),v=da.bounding_ellipsoid_transform(p,h.world_tsr);h.bb_local=k;h.bb_world=l;h.bs_local=n;h.bs_world=m;h.be_local=p;h.be_world=v;k={};k.shadow_cast=h.shadow_cast;k.shadow_cast_only=h.shadow_cast_only;k.shadow_receive=h.shadow_receive;k.selectable=h.selectable;k.origin_selectable=h.origin_selectable;k.outlining=h.outlining;k.origin_outlining=h.origin_outlining;
k.outline_anim_settings_default=h.outline_anim_settings_default;k.reflexible=h.reflexible;k.reflexible_only=h.reflexible_only;k.reflective=h.reflective;k.cube_reflection_id=h.cube_reflection_id;k.plane_reflection_id=h.plane_reflection_id;k.reflection_type=h.reflection_type;k.caustics=h.caustics;k.wind_bending=h.wind_bending;k.main_bend_col=h.main_bend_col;k.detail_bend_col=h.detail_bend_col;k.billboard=h.billboard;k.billboard_type=h.billboard_type;k.billboard_spherical=h.billboard_spherical;k.dynamic_grass=
h.dynamic_grass;k.do_not_cull=h.do_not_cull;k.disable_fogging=h.disable_fogging;k.dynamic_geometry=h.dynamic_geometry;k.cluster_id=f.b4w_cluster_data.cluster_id;k.lod_dist_max=h.lod_dist_max;k.lod_dist_min=h.lod_dist_min;k.lod_transition_ratio=h.lod_transition_ratio;k.do_not_render=h.do_not_render;h=JSON.stringify(k);e[h]=e[h]||[];e[h].push(f)}for(var t in e){k=JSON.parse(t);delete k.cluster_id;var f=e[t],h=ja.create_render("STATIC"),w;for(w in k)h[w]=k[w];h.data_id=a[0]._object.render.data_id;h.wind_bending_amp=
0;h.wind_bending_freq=0;h.detail_bending_freq=0;h.detail_bending_amp=0;h.branch_bending_amp=0;h.hide=!1;for(g=0;g<f.length;g++)k=f[g]._object,0==g?(h.bb_world=U.clone_object_r(k.render.bb_world),h.bs_world=U.clone_object_r(k.render.bs_world)):(da.expand_bounding_box(h.bb_world,k.render.bb_world),da.expand_bounding_sphere(h.bs_world,k.render.bs_world));h.be_world=da.zero_bounding_ellipsoid();h.be_local=da.zero_bounding_ellipsoid();h.bb_local=U.clone_object_r(h.bb_world);h.bs_local=U.clone_object_r(h.bs_world);
d.push({render:h,bpy_objects:f})}for(e=0;e<d.length;e++)for(g=d[e].render,t=d[e].bpy_objects,w=0;w<t.length;w++){f=t[w];h=f._object.render;k=q(f,g,b);l=Aa.create();h.billboard&&!h.billboard_pres_glob_orientation?(n=Aa.get_trans_view(h.world_tsr),Aa.set_trans(n,l)):Aa.copy(h.world_tsr,l);n={};if(g.wind_bending||g.billboard)n.au_center_pos=[l[0],l[1],l[2]];g.wind_bending&&(n.au_wind_bending_amp=[h.wind_bending_amp],n.au_wind_bending_freq=[f.b4w_wind_bending_freq],n.au_detail_bending_amp=[f.b4w_detail_bending_amp],
n.au_detail_bending_freq=[f.b4w_detail_bending_freq],n.au_branch_bending_amp=[f.b4w_branch_bending_amp]);for(m=0;m<k.length;m++){var r=k[m].render,p=k[m].submesh,v=k[m].batch;r.is_hair_particles?r.billboard?W.submesh_apply_particle_transform(p,l):W.submesh_apply_transform(p,l):("COLOR_ID"==v.type&&(k[m].render=h,v.odd_id_prop=f.uuid,M(v,h),r=B(h),K(v,r,0)),p=W.submesh_apply_transform(p,l),W.submesh_apply_params(p,n))}c=c.concat(k)}return c}function q(a,b,c){var d=[],e=p(c,b,!b.do_not_render,!1),g=
B(b),h=a.data,k=h.materials,l=Array(k.length),n=Array(k.length),m=V.find_subs(c,"MAIN_OPAQUE"),q=!1;m&&(q=m.light_positions.length?!0:!1);for(var t=0;t<e.length;t++)for(var w=e[t],r=0;r<k.length;r++){var R=k[r];if(("LENS_FLARES"!=R.name||q)&&!W.has_empty_submesh(h,r)){var ea=u(w);"COLOR_ID"==w&&(ea.can_fork_outline=!(a.b4w_do_not_render||R.b4w_do_not_render));"MAIN"==w?l[r]=ea:"DEBUG_VIEW"==w&&(n[r]=ea);ea.cluster_id=a.b4w_cluster_data.cluster_id;if(I(ea,R)){"SHADOW"==w&&l[r]&&(ea.use_shadeless=l[r].use_shadeless);
ea.draw_mode=b.use_shape_keys||b.dynamic_geometry?W.DM_DYNAMIC_TRIANGLES:W.DM_DEFAULT;M(ea,b);for(var A=ea,D=a.particle_systems,x=0;x<D.length;x++){var F=D[x].settings.b4w_vcol_from_name,G=D[x].settings.b4w_vcol_to_name;""!==F&&""!==G&&(A.vertex_colors_usage[F]={generate_buffer:!1,src:[{name:F,mask:7}]})}"DYNAMIC"==b.type&&(ea.odd_id_prop=a.uuid);K(ea,g);var C=W.extract_submesh(h,r,ea.common_attributes,b.bone_skinning_info,ea.vertex_colors_usage,ea.uv_maps_usage),za=C.submesh_bd;za.bb_world=da.bounding_box_transform(za.bb_local,
a._object.render.world_tsr);za.be_world=da.bounding_ellipsoid_transform(za.be_local,a._object.render.world_tsr);"LENS_FLARES"==R.name&&(C=ha.prepare_lens_flares(C));d.push({batch:ea,submesh:C,mat_names:[R.name],render:b,rel_bpy_objects:[a]})}}}for(t=0;t<n.length;t++)n[t]&&(n[t].debug_id=l[t].id,K(n[t],n[t].render_id));var y=a.particle_systems;if(0<y.length&&d.length){for(var J=!1,N=!1,t=0;t<y.length;t++){var E=y[t],z=E.settings;z.use_render_emitter&&(J=!0);"HAIR"!=z.type||"OBJECT"!=z.render_type&&
"GROUP"!=z.render_type&&E.transforms.length||(N=!0);if(J&&N)break}var P=d[0].batch.vertex_colors_usage;if(N)if(1<k.length){for(var ka,H=a._object.render,Q={},Ta=0;Ta<y.length;Ta++){var qa=y[Ta].settings;if("HAIR"==qa.type&&("OBJECT"==qa.render_type||"GROUP"==qa.render_type)){var Ia=qa.b4w_vcol_from_name,O=qa.b4w_vcol_to_name;""!==Ia&&""!==O&&(Q[Ia]=U.clone_object_r(P[Ia]))}}"a_bending_col_main"in P&&(Q.a_bending_col_main=U.clone_object_r(P.a_bending_col_main));"a_bending_col_detail"in P&&(Q.a_bending_col_detail=
U.clone_object_r(P.a_bending_col_detail));ka=W.extract_submesh_all_mats(h,[],Q,H)}else ka=d[0].submesh;else ka=null;for(var L,Da=ka,ra=a._object,Ea=[],X=a.particle_systems,Fa=a.data,T=0;T<X.length;T++){var la=X[T],oa=la.settings;if(oa.count)if("EMITTER"==oa.type){if("DYNAMIC"==b.type){var ba=u("PARTICLES");ba.bb_local=b.bb_local;ba.be_local=b.be_local;ba.bb_world=b.bb_world;ba.be_world=b.be_world;var ca,sa=Fa.materials,ga=la.settings.material-1;ga>=sa.length&&(fa.warn('Wrong material used for rendering particle system "'+
la.name+'"'),ga=0);ca=sa[ga];"HALO"===la.settings.render_type&&"HALO"===ca.type&&(ba.halo_particles=!0);f(ba,ca);var aa=ba,ma=a,ia=la.settings;switch(ia.b4w_billboard_align){case "VIEW":v(aa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":v(aa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":v(aa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":v(aa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}v(aa,"BILLBOARD",0);var ta=ia.b4w_enable_soft_particles&&
ja.check_obj_soft_particles_accessibility(ma,ia);v(aa,"SOFT_PARTICLES",0<ia.b4w_particles_softness&&ta&&Y.depth_tex_available?1:0);v(aa,"SOFT_STRENGTH",Z.glsl_value(ia.b4w_particles_softness));Z.set_directive(aa.shaders_info,"WORLD_SPACE","WORLD"==ia.b4w_coordinate_system?1:0);ba.dynamic_geometry=!0;ba.odd_id_prop=ra.name+"_"+oa.uuid;ba.psys_name=la.name;K(ba,g);ha.init_particles_data(ba,la,ca);var xa=ha.generate_emitter_particles_submesh(ba,Fa,la,ra.render);ha.update_particles_submesh(xa,ba,oa.count,
ca);ha.update_particles_objs_cache(ra);M(ba,ra.render);Ea.push({batch:ba,submesh:xa,mat_names:[ca.name],render:b,rel_bpy_objects:[a]})}}else if("HAIR"==oa.type){var wa=U.init_rand_r_seed(la.seed);oa.b4w_dynamic_grass&&(b.do_not_cull=!0);var Kc=Ha.check_particles_bin_format(Y.loaded_data_version)&&!oa.b4w_initial_rand_rotation&&!oa.b4w_hair_billboard,Jb=4;Kc&&(Jb=8);if(la.transforms.length)var Ab=la.transforms;else for(var oc=W.geometry_random_points(Da,oa.count,!1,wa),Ab=new Float32Array(oc.length*
Jb),gb=0;gb<oc.length;gb++){var ic=.75+.5*U.rand_r(wa);Ab[gb*Jb]=oc[gb][0];Ab[gb*Jb+1]=oc[gb][1];Ab[gb*Jb+2]=oc[gb][2];Ab[gb*Jb+3]=ic;Kc&&(Ab[gb*Jb+4]=1,Ab[gb*Jb+5]=0,Ab[gb*Jb+6]=0,Ab[gb*Jb+7]=0)}var ld=V.find_subs(c,"GRASS_MAP")?!0:!1;if("OBJECT"==oa.render_type)var hb=[p(c,oa.dupli_object._object.render,!b.do_not_render,!0)],ub=S(a,b,P,Da,[oa.dupli_object],hb,[Ab],oa,la,ld,wa,!1),Ea=Ea.concat(ub);else if("GROUP"==oa.render_type){for(var cc=oa.dupli_group.objects,hb=[],gb=0;gb<cc.length;gb++){var Dc=
p(c,cc[gb]._object.render,!b.do_not_render,!0);hb.push(Dc)}for(var uc=!1,Bb=[],gb=0;gb<cc.length;gb++)Bb.push(cc[gb]._object);if(oa.use_whole_group){for(var pc,Kb=Ab,Ec=Bb,Lb=Kc,$a=Jb,ib={},pb=new Float32Array([0,0,0,1]),Oa=0;Oa<Kb.length;Oa+=$a)for(var eb=0;eb<Ec.length;eb++){var Mb=pa.create(),vc=Aa.get_scale(Ec[eb].render.world_tsr),Zb=Aa.get_trans_view(Ec[eb].render.world_tsr);pa.scale(Zb,vc,Mb);var Hb=pa.clone([Kb[Oa],Kb[Oa+1],Kb[Oa+2]]);ib[eb]||(ib[eb]=new Float32Array(Kb.length));Lb&&(ib[eb][Oa+
4]=pb[0]=Kb[Oa+4],ib[eb][Oa+5]=pb[1]=Kb[Oa+5],ib[eb][Oa+6]=pb[2]=Kb[Oa+6],ib[eb][Oa+7]=pb[3]=Kb[Oa+7],U.quat_bpy_b4w(pb,pb),U.transformQuatFast(Mb,pb,Mb));pa.add(Hb,Mb,Hb);ib[eb][Oa]=Hb[0];ib[eb][Oa+1]=Hb[1];ib[eb][Oa+2]=Hb[2];ib[eb][Oa+3]=Kb[Oa+3]}pc=ib;uc=!0}else{var jc;if(oa.use_group_count){for(var ab=Ab,Cb=Bb,vb=oa.dupli_weights,kc=wa,wc=Kc,Sb=Jb,Xa={},sb=[],Ca=0;Ca<Cb.length;Ca++)for(var qb=Cb[Ca],wb=qb.origin_name||qb.name,Nb=0;Nb<vb.length;Nb++){var Va=vb[Nb];wb==Va.name&&sb.push(Va)}vb.length!=
sb.length&&fa.error("dupli weights match failed");for(Ca=0;Ca<ab.length;Ca+=Sb){for(var Ob,Tb=sb,tb=[0],fb=0;fb<Tb.length;fb++)tb[fb+1]=tb[fb]+Tb[fb].count;for(var Db=tb[tb.length-1]*U.rand_r(kc),cb=0,fb=0;fb<tb.length;fb++)if(Db>=tb[fb]&&Db<tb[fb+1]){cb=fb;break}Ob=cb;Xa[Ob]=Xa[Ob]||[];Xa[Ob].push(ab[Ca],ab[Ca+1],ab[Ca+2],ab[Ca+3]);wc&&Xa[Ob].push(ab[Ca+4],ab[Ca+5],ab[Ca+6],ab[Ca+7])}for(Ob in Xa)Xa[Ob]=new Float32Array(Xa[Ob]);jc=Xa}else{for(var jb=Ab,Eb=wa,Ya=Kc,kb=Jb,dc=Bb.length,lb={},mb=0;mb<
jb.length;mb+=kb){var db=Math.floor(dc*U.rand_r(Eb));lb[db]=lb[db]||[];lb[db].push(jb[mb],jb[mb+1],jb[mb+2],jb[mb+3]);Ya&&lb[db].push(jb[mb+4],jb[mb+5],jb[mb+6],jb[mb+7])}for(db in lb)lb[db]=new Float32Array(lb[db]);jc=lb}pc=jc}ub=S(a,b,P,Da,cc,hb,pc,oa,la,ld,wa,uc);Ea=Ea.concat(ub)}"INSTANCE"==oa.b4w_wind_bend_inheritance&&ra.render.wind_bending&&fa.warn('Emitter object "'+ra.name+"\" has a particle system with wind bending inheritance from the particle instance. Wind bending on the emitter isn't disabled. Expect unforeseen behavior.")}else throw"Unknown particle settings type";
}L=Ea;d=J?d.concat(L):L}return d}function k(a,b,c,d){a.bcyl_local=da.create_bounding_cylinder(b,d);a.bcap_local=da.create_bounding_capsule(c,d);a.bcon_local=da.create_bounding_cone(b,d)}function p(a,b,c,d){var e=[];d||(b.selectable&&V.find_subs(a,"COLOR_PICKING")||b.outlining&&V.find_subs(a,"OUTLINE_MASK"))&&e.push("COLOR_ID");c&&(e.push("MAIN"),e.push("NODES_GLOW"),V.find_subs(a,"DEBUG_VIEW")&&e.push("DEBUG_VIEW"),V.find_subs(a,"SHADOW_RECEIVE")&&e.push("SHADOW"),V.find_subs(a,"GRASS_MAP")&&e.push("GRASS_MAP"));
e.push("PHYSICS");if(b.shadow_cast_only||b.reflexible_only)for(a=null,b.shadow_cast_only&&(a=["MAIN","NODES_GLOW","COLOR_ID","PHYSICS","DEBUG_VIEW"]),b.reflexible_only&&(b=["COLOR_ID","PHYSICS","SHADOW","DEBUG_VIEW"],a=null!==a?U.array_intersect(a,b):b),b=a,a=0;a<b.length;a++)c=e.indexOf(b[a]),-1!==c&&e.splice(c,1);return e}function f(a,b,c){switch(a.type){case "MAIN":if(b.b4w_do_not_render)a=!1;else{if(b.use_nodes&&"HALO"!=b.type)C(a,b,"MAIN");else{m(a,b);var d=b.game_settings.alpha_blend;a.xray=
b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;a.offset_z=b.offset_z;a.texture_scale.set([1,1,1]);var e=b.texture_slots;L.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);switch(b.name){case "LENS_FLARES":J(a,"special_lens_flares.glslv","special_lens_flares.glslf");Q(a,"a_position");Q(a,"a_texcoord");var f=c?[1,1,1,0]:null,f=qa.get_batch_texture(e[0],f);X(a,f);break;default:J(a,"main.glslv","main_stack.glslf");b.use_shadeless||(d=la.create_lighting_graph(b.uuid,
b.name,{use_shadeless:b.use_shadeless,diffuse_shader:b.diffuse_shader,specular_shader:b.specular_shader}),a.shaders_info.node_elements=la.compose_node_elements(d));var h=l("use_map_color_diffuse",!0,e),k=l("use_map_color_spec",!0,e),n=l("use_map_normal",!0,e),p=l("use_map_mirror",!0,e),q=l("use_stencil",!0,e),d=h[0],k=k[0],n=n[0],p=p[0],h=h[1],e=q[0]&&l("use_rgb_to_intensity",!0,e)[0];if(d){switch(d.blend_type){case "MIX":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":v(a,
"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}f="IMAGE"==d.texture._render.source&&c?[a.diffuse_color[0],a.diffuse_color[1],a.diffuse_color[2],1]:"ENVIRONMENT_MAP"==d.texture._render.source&&c?[.8,.8,.8,1]:null;f=qa.get_batch_texture(d,f);X(a,f,"u_colormap0");a.diffuse_color_factor=d.diffuse_color_factor;a.alpha_factor=d.use_map_alpha?d.alpha_factor:0;a.texture_scale.set(d.scale)}q=d&&d==k;k&&(q||(f=c?[.5,.5,.5,1]:null,f=qa.get_batch_texture(k,f),X(a,f,"u_specmap0")),a.specular_color_factor=
k.specular_color_factor);if(n&&(Q(a,"a_normal"),Q(a,"a_tangent"),a.part_use_tangent=!0,f=c?[.5,.5,1,1]:null,f=qa.get_batch_texture(n,f),X(a,f,"u_normalmap0"),a.normal_factor=n.normal_factor,f=n.texture,f.b4w_use_map_parallax&&Y.parallax)){var B=Z.glsl_value(f.b4w_parallax_steps),r=Z.glsl_value(f.b4w_parallax_lod_dist);v(a,"PARALLAX",1);v(a,"PARALLAX_STEPS",B);v(a,"PARALLAX_LOD_DIST",r);a.parallax_scale=f.b4w_parallax_scale}p&&(f=c?[0,0,.5,1]:null,f=qa.get_batch_texture(p,f),X(a,f,"u_mirrormap"),a.mirror_factor=
p.mirror_factor);if(p=d&&h&&e?1:0)f=c?[.8,.8,.8,1]:null,f=qa.get_batch_texture(h,f),X(a,f,"u_colormap1"),f=c?[.5,.5,.5,1]:null,f=qa.get_batch_texture(e,f),X(a,f,"u_stencil0");(c=d||k||n)&&a.texture_scale.set(c.scale);v(a,"TEXTURE_SPEC",void 0==k?0:1);v(a,"ALPHA_AS_SPEC",q?1:0);v(a,"TEXTURE_STENCIL_ALPHA_MASK",p);Q(a,"a_position");Q(a,"a_normal");(d||k||n)&&Q(a,"a_texcoord");if(b.b4w_water){a.water=!0;a.water_dynamic=b.b4w_water_dynamic;b.b4w_water_shore_smoothing&&!a.blend?(fa.warn('Material: "'+
b.name+'" is opaque.',"Disabling shore smoothing."),a.water_shore_smoothing=!1):a.water_shore_smoothing=b.b4w_water_shore_smoothing;J(a,"special_water.glslv","special_water.glslf");c=la.create_lighting_graph(b.uuid,b.name,{use_shadeless:!1,diffuse_shader:b.diffuse_shader,specular_shader:b.specular_shader});a.shaders_info.node_elements=la.compose_node_elements(c);Q(a,"a_position");Y.water_wireframe_debug?(Q(a,"a_polyindex"),a.depth_mask=!0,a.wireframe_edge_color=[0,0,0],ka.get_standard_derivatives()?
v(a,"DEBUG_WIREFRAME",1):v(a,"DEBUG_WIREFRAME",2)):v(a,"DEBUG_WIREFRAME",0);p=b.texture_slots;c=l("use_map_normal",!0,p);q=l("use_map_mirror",!0,p)[0];c.length&&(f=qa.get_batch_texture(c[0]),X(a,f,"u_normalmap0"),a.water_norm_uv_velocity=b.b4w_water_norm_uv_velocity);v(a,"NUM_NORMALMAPS",c.length);a.normalmap_scales=Array(c.length);for(f=0;f<c.length;f++)a.normalmap_scales[f]=new Float32Array(2),a.normalmap_scales[f].set([c[f].scale[0],c[f].scale[1]]);q&&(f=qa.get_batch_texture(q),X(a,f,"u_mirrormap"),
a.mirror_factor=q.mirror_factor);q=null;if(Y.foam)for(f=0;f<p.length;f++){var R=p[f];if(!0===R.texture.b4w_water_foam){q=R;break}}q?(v(a,"FOAM",1),f=qa.get_batch_texture(q),X(a,f,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.foam_uv_freq.set(q.texture.b4w_foam_uv_freq),a.foam_mag.set(q.texture.b4w_foam_uv_magnitude),a.foam_scale[0]=q.scale[0],a.foam_scale[1]=q.scale[1]):v(a,"FOAM",0);for(f=0;f<p.length;f++)if(R=p[f],!0===R.texture.b4w_shore_dist_map){var ea=R;break}ea&&Y.allow_vertex_textures?(ea=qa.get_batch_texture(ea),
X(a,ea,"u_shore_dist_map"),v(a,"SHORE_PARAMS",1),ea=R.texture.b4w_shore_boundings,v(a,"MAX_SHORE_DIST",Z.glsl_value(R.texture.b4w_max_shore_dist)),v(a,"SHORE_MAP_SIZE_X",Z.glsl_value(ea[0]-ea[1])),v(a,"SHORE_MAP_SIZE_Y",Z.glsl_value(ea[2]-ea[3])),v(a,"SHORE_MAP_CENTER_X",Z.glsl_value((ea[0]+ea[1])/2)),v(a,"SHORE_MAP_CENTER_Y",Z.glsl_value((ea[2]+ea[3])/2))):v(a,"SHORE_PARAMS",0);if(b.b4w_generated_mesh)v(a,"GENERATED_MESH",1),a.water_generated_mesh=!0,a.water_num_cascads=b.b4w_water_num_cascads,a.water_subdivs=
b.b4w_water_subdivs,a.water_detailed_dist=b.b4w_water_detailed_dist;else{Q(a,"a_normal");if(q||c.length)Q(a,"a_texcoord"),Q(a,"a_tangent"),a.part_use_tangent=!0;v(a,"GENERATED_MESH",0)}if(b.b4w_water_dynamic){R=Z.glsl_value(b.b4w_water_dst_noise_scale0);ea=Z.glsl_value(b.b4w_water_dst_noise_scale1);c=Z.glsl_value(b.b4w_water_dst_noise_freq0);var p=Z.glsl_value(b.b4w_water_dst_noise_freq1),q=Z.glsl_value(b.b4w_water_dir_min_shore_fac),f=Z.glsl_value(b.b4w_water_dir_freq),B=Z.glsl_value(b.b4w_water_dir_noise_scale),
r=Z.glsl_value(b.b4w_water_dir_noise_freq),D=Z.glsl_value(b.b4w_water_dir_min_noise_fac),A=Z.glsl_value(b.b4w_water_dst_min_fac),x=Z.glsl_value(b.b4w_water_waves_hor_fac);v(a,"DST_NOISE_SCALE_0",R);v(a,"DST_NOISE_SCALE_1",ea);v(a,"DST_NOISE_FREQ_0",c);v(a,"DST_NOISE_FREQ_1",p);v(a,"DIR_MIN_SHR_FAC",q);v(a,"DIR_FREQ",f);v(a,"DIR_NOISE_SCALE",B);v(a,"DIR_NOISE_FREQ",r);v(a,"DIR_MIN_NOISE_FAC",D);v(a,"DST_MIN_FAC",A);v(a,"WAVES_HOR_FAC",x)}F(a,b);H(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);
a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;v(a,"ABSORB",Z.glsl_value(b.b4w_water_absorb_factor));v(a,"SSS_STRENGTH",Z.glsl_value(b.b4w_water_sss_strength));v(a,"SSS_WIDTH",Z.glsl_value(b.b4w_water_sss_width))}"HALO"===b.type&&(J(a,"halo.glslv","halo.glslf"),w(a,b),a.common_attributes=["a_position"]);v(a,"TEXCOORD",0);v(a,"NORMAL_TEXCOORD",0);d&&g(a,d,"TEXTURE_COLOR0_CO");h&&g(a,h,"TEXTURE_COLOR1_CO");
e&&g(a,e,"TEXTURE_STENCIL_ALPHA_MASK_CO");k&&g(a,k,"TEXTURE_SPEC_CO");n&&g(a,n,"TEXTURE_NORM_CO");v(a,"SHADELESS",b.use_shadeless?1:0);a.use_shadeless=b.use_shadeless}d=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===d?0:1);v(a,"ALPHA_CLIP","CLIP"===d?1:0);v(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(v(a,"VERTEX_COLOR",1),Q(a,"a_color")):v(a,"VERTEX_COLOR",0);a.ambient=b.ambient;a.diffuse_intensity=b.diffuse_intensity;a.emit=b.emit;a.specular_color.set(b.specular_color);
a.specular_alpha=b.specular_alpha;F(a,b);H(a,b);b.b4w_wettable?v(a,"WETTABLE",1):v(a,"WETTABLE",0);t(a,b);b.b4w_refractive&&!a.blend?(fa.warn('Material "'+b.name+'" is not blend. Disabling refractions.'),a.refractive=!1):a.refractive=b.b4w_refractive;a.refr_bump=b.b4w_refr_bump}a=!0}break;case "NODES_GLOW":a=C(a,b,"GLOW");break;case "SHADOW":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)a=!1;else if(m(a,b),a.blend)a=!1;else{d=b.game_settings.alpha_blend;b.use_nodes&&
"CLIP"==d?C(a,b,"SHADOW"):(J(a,"shadow.glslv","shadow.glslf"),L.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color));Q(a,"a_position");Q(a,"a_normal");v(a,"ALPHA","OPAQUE"===d?0:1);a.texture_scale.set([1,1,1]);if((b=l("use_map_color_diffuse",!0,b.texture_slots)[0])&&"CLIP"===d){switch(b.blend_type){case "MIX":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.texture_scale.set(b.scale);
v(a,"TEXTURE_COLOR",1);Q(a,"a_texcoord");if("IMAGE"==b.texture._render.source||"ENVIRONMENT_MAP"==b.texture._render.source||"CANVAS"==b.texture._render.source)d=qa.get_batch_texture(b),X(a,d,"u_colormap0");"NONE"==b.texture._render.source&&(d=qa.get_batch_texture(b),X(a,d,"u_colormap0"))}else v(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.use_ghost=b.b4w_use_ghost,a.collision_id=b.b4w_collision_id,a.collision_margin=b.b4w_collision_margin,a.collision_group=b.b4w_collision_group,
a.collision_mask=b.b4w_collision_mask,a.friction=b.physics.friction,a.elasticity=b.physics.elasticity,a=!0):b.b4w_water?(a.water=!0,a.water_dynamics=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=
b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||"HALO"===b.type)a=!1;else{m(a,b);a.z_sort=!1;a.depth_mask=!0;a.blend=!1;d=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;b.use_nodes&&"CLIP"==d?C(a,b,"COLOR_ID"):(J(a,"color_id.glslv","color_id.glslf"),L.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],
b.alpha,a.diffuse_color));Q(a,"a_position");v(a,"ALPHA","OPAQUE"===d?0:1);a.texture_scale.set([1,1,1]);if((b=l("use_map_color_diffuse",!0,b.texture_slots)[0])&&"CLIP"===d){switch(b.blend_type){case "MIX":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.texture_scale.set(b.scale);v(a,"TEXTURE_COLOR",1);Q(a,"a_texcoord");if("IMAGE"==b.texture._render.source||"ENVIRONMENT_MAP"==b.texture._render.source)d=qa.get_batch_texture(b),
X(a,d,"u_colormap0");"NONE"==b.texture._render.source&&(d=qa.get_batch_texture(b),X(a,d,"u_colormap0"))}else v(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?a=!1:(m(a,b),a.blend=!1,a.z_sort=!1,a.depth_mask=!0,J(a,"grass_map.glslv","grass_map.glslf"),Q(a,"a_position"),d=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.vertex_colors_usage.a_grass_size={generate_buffer:!0,src:[]},d?(a.vertex_colors_usage.a_grass_size.src.push({name:d,
mask:4}),v(a,"DYNAMIC_GRASS_SIZE",1)):v(a,"DYNAMIC_GRASS_SIZE",0),a.vertex_colors_usage.a_grass_color={generate_buffer:!0,src:[]},b?(a.vertex_colors_usage.a_grass_color.src.push({name:b,mask:7}),v(a,"DYNAMIC_GRASS_COLOR",1)):v(a,"DYNAMIC_GRASS_COLOR",0),a=!0);break;case "DEBUG_VIEW":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?a=!1:(J(a,"debug_view.glslv","debug_view.glslf"),Q(a,"a_position"),Q(a,"a_normal"),Q(a,"a_polyindex"),a.depth_mask=!0,a.debug_view_mode=0,a.wireframe_edge_color=
[0,0,0],a=!0);break;case "PARTICLES":a:if(b.b4w_do_not_render)a=!1;else{d=b.texture_slots;if(a.halo_particles)J(a,"particle_system.glslv","particle_system_stack.glslf"),v(a,"HALO_PARTICLES",1),w(a,b);else{k={use_shadeless:!1,diffuse_shader:b.diffuse_shader,specular_shader:b.specular_shader};if(b.use_nodes){J(a,"particle_system.glslv","particle_system.glslf");C(a,b,"PARTICLES");a=!0;break a}else J(a,"particle_system.glslv","particle_system_stack.glslf"),k=la.create_lighting_graph(b.uuid,b.name,k),
a.shaders_info.node_elements=la.compose_node_elements(k);if(d=l("use_map_color_diffuse",!0,d)[0]){v(a,"TEXTURE_COLOR",1);switch(d.blend_type){case "MIX":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.diffuse_color_factor=d.diffuse_color_factor;a.alpha_factor=d.use_map_alpha?d.alpha_factor:0;d=qa.get_batch_texture(d);X(a,d)}}L.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);a.ambient=
b.ambient;a.diffuse_intensity=b.diffuse_intensity;a.emit=b.emit;a.specular_color.set(b.specular_color);a.specular_alpha=b.specular_alpha;Q(a,"a_position");Q(a,"a_normal");d=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===d?0:1);v(a,"ALPHA_CLIP","CLIP"===d?1:0);v(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);F(a,b);H(a,b);m(a,b);d=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;a.offset_z=b.offset_z;a=!0}break;default:throw"Wrong batch type: "+a.type;}return a}function w(a,
b){var c=b.halo;v(a,"NUM_RINGS",c.ring_count);v(a,"NUM_LINES",c.line_count);v(a,"NUM_STARS",c.star_tip_count);v(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0);a.halo_size=c.size;a.halo_hardness=c.hardness/20;a.halo_rings_color.set(c.b4w_halo_rings_color);a.halo_lines_color.set(c.b4w_halo_lines_color);a.halo_stars_blend=1/b.b4w_halo_stars_blend_height;a.halo_stars_height=b.b4w_halo_stars_min_height;a.halo=!0}function g(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":v(a,c,"TEXTURE_COORDS_UV_ORCO");
v(a,"TEXCOORD",1);break;case "NORMAL":v(a,c,"TEXTURE_COORDS_NORMAL");v(a,"NORMAL_TEXCOORD",1);break;default:v(a,c,0)}}function m(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.blend=!0;a.z_sort=!0;a.depth_mask=!0;a.alpha_clip=!1;break;case "ALPHA":a.blend=!0;a.z_sort=!1;a.depth_mask=!0;a.alpha_clip=!1;break;case "CLIP":a.blend=!1;a.z_sort=!1;a.depth_mask=!0;a.alpha_clip=!0;break;case "ADD":a.blend=!0;a.z_sort=!1;a.depth_mask=!1;a.alpha_clip=!1;break;case "OPAQUE":a.blend=
!1;a.z_sort=!1;a.depth_mask=!0;a.alpha_clip=!1;break;default:throw Error("Unknown alpha blend mode: "+d);}a.use_backface_culling=c.use_backface_culling}function l(a,b,c){for(var d=[],e=c.length,g=0;g<e;g++){var f=c[g];f[a]==b&&f.texture&&f.texture._render&&d.push(f)}return d}function t(a,b){var c=b.raytrace_transparency;a.fresnel_params[0]=c.fresnel;a.fresnel_params[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.reflect_factor=c.reflect_factor;a.fresnel_params[2]=c.fresnel;a.fresnel_params[3]=1-c.fresnel_factor/
5}function F(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":c=b.specular_hardness;break;case "WARDISO":c=b.specular_slope;break;case "TOON":c=b.specular_toon_size;d=b.specular_toon_smooth;break;case "BLINN":c=b.specular_ior;d=b.specular_hardness;break;default:fa.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.specular_params[0]=b.specular_intensity;a.specular_params[1]=c;a.specular_params[2]=d}function H(a,b){switch(b.diffuse_shader){case "LAMBERT":a.diffuse_params[0]=
0;a.diffuse_params[1]=0;break;case "OREN_NAYAR":a.diffuse_params[0]=b.roughness;a.diffuse_params[1]=0;break;case "FRESNEL":a.diffuse_params[0]=b.diffuse_fresnel;a.diffuse_params[1]=b.diffuse_fresnel_factor;break;case "MINNAERT":a.diffuse_params[0]=b.darkness;a.diffuse_params[1]=0;break;case "TOON":a.diffuse_params[0]=b.diffuse_toon_size;a.diffuse_params[1]=b.diffuse_toon_smooth;break;default:fa.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.diffuse_params[0]=0,
a.diffuse_params[1]=0}}function C(a,b,c){if(!b.use_nodes||b.b4w_do_not_render)return!1;var d;switch(c){case "MAIN":J(a,"main.glslv","main.glslf");d=!1;break;case "GLOW":J(a,"main.glslv","main.glslf");d=!0;break;case "SHADOW":J(a,"shadow.glslv","shadow.glslf");d=!1;break;case "COLOR_ID":J(a,"color_id.glslv","color_id.glslf"),d=!1}var e=b.node_tree;c=la.compose_nmat_graph(e,b.uuid,!1,b.name,c);if(!c)return fa.error('Failed to create node graph for material "'+b.name+'", disable nodes'),n(a,b),!0;a.has_nodes=
!0;v(a,"NODES",1);v(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);Q(a,"a_position");b.use_orco_tex_coord&&Q(a,"a_orco_tex_coord");m(a,b);a.offset_z=b.offset_z;var g=b.game_settings.alpha_blend;d?(v(a,"ALPHA",1),v(a,"ALPHA_CLIP",0)):(v(a,"ALPHA","OPAQUE"===g?0:1),v(a,"ALPHA_CLIP","CLIP"===g?1:0));a.xray=b.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g;L.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);a.emit=b.emit;a.ambient=b.ambient;t(a,b);b.b4w_wettable?
v(a,"WETTABLE",1):v(a,"WETTABLE",0);var f=null,h=!1;A.traverse(c,function(c,d){switch(d.type){case "UVMAP":case "TEX_COORD_UV":case "GEOMETRY_UV":case "UV_MERGED":var e=d.data.name,g=d.data.value;a.uv_maps_usage||(a.uv_maps_usage={});a.uv_maps_usage[g]=e;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":e=d.data.name;a.vertex_colors_usage[e]={generate_buffer:!0,src:[{name:d.data.value}]};g=0;if("GEOMETRY_VC"==d.type)g=7;else for(var k=0;k<d.outputs.length;k++){var l=
"RGB".indexOf(d.outputs[k].identifier);-1<l&&(g|=1<<2-l)}a.vertex_colors_usage[e].src[0].mask=g;break;case "TEX_COORD_NO":case "GEOMETRY_NO":Q(a,"a_normal");break;case "MATERIAL_BEGIN":Q(a,"a_normal");h=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":e=d.data.name;g=d.data.value;if(!g._render){fa.warn('Wrong texture "'+d.data.value.name+'" in material "'+b.name+'".');n(a,b);break}!1!==g._render.allow_node_dds&&(g._render.allow_node_dds="TEXTURE_ENVIRONMENT"!=d.type?!0:!1);X(a,g._render,e);
break;case "TEXTURE_NORMAL":case "B4W_PARALLAX":v(a,"CALC_TBN_SPACE",1);Q(a,"a_normal");Q(a,"a_tangent");a.part_use_tangent=!0;e=d.data.name;g=d.data.value;g._render.allow_node_dds=!1;X(a,g._render,e);break;case "LAMP":d.data&&(a.lamp_uuid_indexes=d.data);break;case "B4W_REFRACTION":a.blend?a.refractive=!0:(a.refractive=!0,fa.warn('Material "'+b.name+'" is not blend. Disabling refractions.'));break;case "VALTORGB":case "CURVE_VEC":case "CURVE_RGB":f||(f=d.data.texture);break;case "PARTICLE_INFO":"PARTICLES"==
a.type&&d.data&&(a.part_node_data=d.data);break;case "VECT_TRANSFORM":switch(Number(d.dirs[1][1])){case la.VT_WORLD_TO_OBJECT:v(a,"USE_ZUP_MODEL_MATRIX_INVERSE",1);break;case la.VT_WORLD_TO_CAMERA:v(a,"USE_ZUP_VIEW_MATRIX",1);break;case la.VT_OBJECT_TO_WORLD:v(a,"USE_ZUP_MODEL_MATRIX",1);break;case la.VT_OBJECT_TO_CAMERA:v(a,"USE_ZUP_MODEL_MATRIX",1);v(a,"USE_ZUP_VIEW_MATRIX",1);break;case la.VT_CAMERA_TO_WORLD:v(a,"USE_ZUP_VIEW_MATRIX_INVERSE",1);break;case la.VT_CAMERA_TO_OBJECT:v(a,"USE_ZUP_MODEL_MATRIX_INVERSE",
1),v(a,"USE_ZUP_VIEW_MATRIX_INVERSE",1)}}});f&&X(a,f,"u_nodes_texture");h||(a.use_shadeless=!0);d=a.shaders_info.node_elements=la.compose_node_elements(c);x(e,a,b.name);e=a.node_value_inds;c=a.node_rgb_inds;for(g=0;g<d.length;g++){var k=d[g];switch(k.id){case "VALUE":var l=k.param_values[0];if(l)for(var p=0;p<e.length;p+=2)if(e[p]==l){k.dirs.push(["VALUE_IND",e[p+1]]);break}break;case "RGB":if(l=k.param_values[0])for(p=0;p<c.length;p+=2)if(c[p]==l){k.dirs.push(["RGB_IND",c[p+1]]);break}}}v(a,"NUM_VALUES",
a.node_values.length);v(a,"NUM_RGBS",a.node_rgbs.length);return!0}function x(a,b,c){var d=[],e=[],g=[],f=[],h=[],k=[];y(a,c,a.animation_data,d,e,g,f,h,k);b.node_values=d;b.node_value_inds=e;b.node_anim_inds=g;b.node_rgbs=f;b.node_rgb_inds=h;b.node_rgb_anim_inds=k}function y(a,b,c,d,e,g,f,h,k){for(var l=0;l<a.nodes.length;l++){var n=a.nodes[l];if("VALUE"==n.type){var m=E(b,n.name);d.push(n.outputs[0].default_value);e.push(m,e.length/2)}else if("RGB"==n.type)m=E(b,n.name),n=n.outputs[0].default_value.slice(0,
3),f.push(n[0],n[1],n[2]),h.push(m,h.length/2);else if("GROUP"==n.type){var m=n.node_group.node_tree,p=m.animation_data,n=E(b,n.name);y(m,n,p,d,e,g,f,h,k)}}if(c)for((a=c.action)&&a._render.type==oa.AT_MATERIAL&&z(a,b,g,e,k,h),c=c.nla_tracks,d=0;d<c.length;d++)for(f=c[d].strips,l=0;l<c[d].strips.length;l++)(a=f[l].action)&&a._render.type==oa.AT_MATERIAL&&z(a,b,g,e,k,h)}function z(a,b,c,d,g,f){var h=a._render.params,k;for(k in h){var l=E(b,k.match(/"(.*?)"/)[1]),h=e(d,l);null!=h?(l=E(a.name,k),c.push(l,
h)):(h=e(f,l),null!=h&&(l=E(a.name,k),g.push(l,h)))}}function E(a,b){return a+"%join%"+b}function e(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function n(a,b){switch(a.type){case "SHADOW":J(a,"shadow.glslv","shadow.glslf");break;case "COLOR_ID":J(a,"color_id.glslv","color_id.glslf");break;default:J(a,"main.glslv","main_stack.glslf")}v(a,"SHADELESS",1);Q(a,"a_position");Q(a,"a_normal");L.set(1,0,1,1,a.diffuse_color);if(b){var c=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===
c?0:1);v(a,"ALPHA_CLIP","CLIP"===c?1:0);v(a,"VERTEX_COLOR",0);a.offset_z=b.offset_z;m(a,b)}return!0}function M(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.is_hair_particles?v(a,"AU_QUALIFIER","attribute"):v(a,"AU_QUALIFIER","uniform"),v(a,"STATIC_BATCH",0)):(v(a,"AU_QUALIFIER","attribute"),v(a,"STATIC_BATCH",1));"DEBUG_VIEW"==a.type&&(ka.get_standard_derivatives()?v(a,"WIREFRAME_QUALITY",1):v(a,"WIREFRAME_QUALITY",0),a.debug_sphere?(v(a,"DEBUG_SPHERE",1),a.debug_sphere_dynamic?v(a,"DEBUG_SPHERE_DYNAMIC",
1):v(a,"DEBUG_SPHERE_DYNAMIC",0)):v(a,"DEBUG_SPHERE",0),v(a,"ALPHA",1));b.use_shape_keys&&(a.use_shape_keys=b.use_shape_keys);b.wind_bending?(""!==b.main_bend_col?(a.vertex_colors_usage.a_bending_col_main={generate_buffer:!0,src:[{name:b.main_bend_col,mask:4}]},Q(a,"a_bending_col_main"),""!==b.detail_bend_col.leaves_stiffness&&""!==b.detail_bend_col.leaves_phase&&""!==b.detail_bend_col.overall_stiffness?(a.vertex_colors_usage.a_bending_col_detail={generate_buffer:!0,src:[{name:b.detail_bend_col.leaves_stiffness,
mask:4},{name:b.detail_bend_col.leaves_phase,mask:2},{name:b.detail_bend_col.overall_stiffness,mask:1}]},Q(a,"a_bending_col_detail"),Q(a,"a_normal"),v(a,"DETAIL_BEND",1)):v(a,"DETAIL_BEND",0),v(a,"MAIN_BEND_COL",1)):v(a,"MAIN_BEND_COL",0),v(a,"WIND_BEND",1)):v(a,"WIND_BEND",0);b.bend_center_only?v(a,"BEND_CENTER_ONLY",1):v(a,"BEND_CENTER_ONLY",0);v(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.billboard_pres_glob_orientation|0);b.billboard?v(a,"BILLBOARD",1):v(a,"BILLBOARD",0);b.billboard&&b.is_hair_particles?
v(a,"HAIR_BILLBOARD",1):v(a,"HAIR_BILLBOARD",0);b.billboard_spherical?v(a,"BILLBOARD_SPHERICAL",1):v(a,"BILLBOARD_SPHERICAL",0);switch(b.billboard_type){case "RANDOM":v(a,"BILLBOARD_RANDOM",1);v(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":v(a,"BILLBOARD_RANDOM",0);v(a,"BILLBOARD_JITTERED",1);break;default:v(a,"BILLBOARD_RANDOM",0),v(a,"BILLBOARD_JITTERED",0)}b.dynamic_grass&&Y.allow_vertex_textures?v(a,"DYNAMIC_GRASS",1):v(a,"DYNAMIC_GRASS",0);a.dynamic_grass=b.dynamic_grass;"PARTICLES"!=a.type&&
(a.dynamic_geometry=b.dynamic_geometry);a.shadow_cast=b.shadow_cast;a.shadow_cast_only=b.shadow_cast_only;a.shadow_receive=b.shadow_receive&&!a.use_shadeless&&!(a.blend&&Y.disable_blend_shadows_hack);a.reflexible=b.reflexible;a.reflexible_only=b.reflexible_only;a.reflective=b.reflective;b.is_skinning?(Q(a,"a_influence"),v(a,"SKINNED",1),Y.amd_skinning_hack?(v(a,"DISABLE_TANGENT_SKINNING",1),v(a,"FRAMES_BLENDING",0)):(v(a,"DISABLE_TANGENT_SKINNING",0),b.frames_blending?v(a,"FRAMES_BLENDING",1):v(a,
"FRAMES_BLENDING",0)),v(a,"MAX_BONES",b.max_bones)):(v(a,"SKINNED",0),v(a,"FRAMES_BLENDING",0),v(a,"DISABLE_TANGENT_SKINNING",0));b.vertex_anim?(v(a,"VERTEX_ANIM",1),Y.vert_anim_mix_normals_hack?v(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):v(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):v(a,"VERTEX_ANIM",0);if(b.is_skinning&&b.vertex_anim)throw"Skinning and vertex animation are mutually exlusive";b.disable_fogging?v(a,"DISABLE_FOG",1):v(a,"DISABLE_FOG",0)}}function D(a,b,c){if(b.length){for(var d=
ja.get_shadow_lamps(b,Y.ssao&&c.b4w_enable_ssao),e=a.shaders_info,g=0,f=0;f<a.shaders_info.node_elements.length;f++){var h=a.shaders_info.node_elements[f];if("LIGHTING_LAMP"==h.id){var k=b[g++%b.length],l=k.light;"AREA"==l.type&&(k=b[g++%b.length],l=k.light);var n=ja.get_scene_data(k,c);if("SPOT"==l.type||"POINT"==l.type)var m=Math.cos(l.spot_size/2);if("SPOT"==l.type)var p=l.spot_blend*(1-m);var n=n.light_index,q=Math.floor(n/2),v=0==n%2?"rg":"ba",k=d.indexOf(k);h.dirs=[["LAMP_TYPE",l.type],["LAMP_IND",
n],["LAMP_LIGHT_FACT_IND",q],["LAMP_FAC_CHANNELS",v],["LAMP_SPOT_SIZE",Z.glsl_value(m||.01)],["LAMP_SPOT_BLEND",Z.glsl_value(p||.01)],["LAMP_LIGHT_DIST",Z.glsl_value(l.distance)],["LAMP_SHADOW_MAP_IND",k]]}}if(a.lamp_uuid_indexes){c=0;for(var t in a.lamp_uuid_indexes)c++;a.lamp_light_positions=new Float32Array(3*c);a.lamp_light_directions=new Float32Array(3*c);a.lamp_light_color_intensities=new Float32Array(3*c);a.lamp_light_factors=new Float32Array(4*c);Z.set_directive(e,"NUM_LAMP_LIGHTS",c);for(f=
0;f<b.length;f++)G(a,b[f])}}}function G(a,b){if(b.uuid in a.lamp_uuid_indexes){var c=a.lamp_uuid_indexes[b.uuid],d=Aa.get_trans_view(b.render.world_tsr);a.lamp_light_positions.set(d,3*c);a.lamp_light_directions.set(b.light.direction,3*c);a.lamp_light_color_intensities.set(b.light.color_intensity,3*c);var d=Ta,e=b.light;d[0]=-1;d[1]=-1;d[2]=-1;d[3]=e.use_specular?1:0;switch(e.type){case "POINT":d[2]=e.distance;break;case "SPOT":d[2]=e.distance;var g=d[0]=Math.cos(e.spot_size/2);d[1]=e.spot_blend*(1-
g)}a.lamp_light_factors.set(d,4*c)}}function Q(a,b){var c=a.common_attributes;-1==c.indexOf(b)&&c.push(b)}function v(a,b,c){Z.set_directive(a.shaders_info,b,c)}function P(a,b){if("PHYSICS"==a.type)0<b.shape_keys.length&&W.submesh_init_shape_keys(b,b.va_frames[0]),a.submesh=b;else{var c=a.z_sort,d=a.draw_mode;a.halo&&"PARTICLES"!=a.type&&(b=W.extract_halo_submesh(b));a.water_generated_mesh&&(b=sa.generate_multigrid(a.water_num_cascads,a.water_subdivs,a.water_detailed_dist));c=W.submesh_to_bufs_data(b,
c,d,a.vertex_colors_usage);a.bufs_data=c;a.dynamic_geometry||c.info_for_z_sort_updates||a.use_shape_keys||(c.ibo_array=null,c.vbo_array=null);c=b.va_frames.length;a.num_vertices=b.base_length*c;a:switch(a.draw_mode){case W.DM_DEFAULT:case W.DM_TRIANGLES:case W.DM_DYNAMIC_TRIANGLES:d=!0;break a;default:d=!1}d?W.is_indexed(b)?a.num_triangles=b.indices.length/3*c:a.num_triangles=b.base_length/3*c:a.num_triangles=0}}function S(a,b,c,d,e,g,f,h,k,l,n,m){var p=a._object,q=[],v=h.b4w_dynamic_grass;if(!l&&
v)return q;for(var t="INSTANCE"==h.b4w_wind_bend_inheritance,w="INSTANCE"==h.b4w_shadow_inheritance,r="INSTANCE"==h.b4w_reflection_inheritance,R=[],ea=[],D=0;D<e.length;D++){var A=e[D]._object.render,x=U.clone_object_nr(b);x.billboard=h.b4w_hair_billboard;x.billboard_type=h.b4w_hair_billboard_type;x.billboard_spherical="SPHERICAL"==h.b4w_hair_billboard_geometry;x.dynamic_grass=v;x.is_hair_particles=!0;t?(x.wind_bending=A.wind_bending,x.wind_bending_angle=A.wind_bending_angle,x.wind_bending_freq=A.wind_bending_freq,
x.detail_bending_freq=A.detail_bending_freq,x.main_bend_col=A.main_bend_col,x.detail_bending_amp=A.detail_bending_amp,x.branch_bending_amp=A.branch_bending_amp,x.wind_bending_amp=A.wind_bending_amp,x.detail_bend_col=A.detail_bend_col,x.bend_center_only=!1):(x.wind_bending=p.render.wind_bending,x.wind_bending_angle=p.render.wind_bending_angle,x.wind_bending_freq=p.render.wind_bending_freq,x.detail_bending_freq=p.render.detail_bending_freq,x.main_bend_col=p.render.main_bend_col,x.detail_bending_amp=
p.render.detail_bending_amp,x.branch_bending_amp=p.render.branch_bending_amp,x.wind_bending_amp=p.render.wind_bending_amp,x.detail_bend_col=p.render.detail_bend_col,x.bend_center_only=!0);w?(x.shadow_cast=A.shadow_cast,x.shadow_cast_only=A.shadow_cast_only,x.shadow_receive=A.shadow_receive):(x.shadow_cast=p.render.shadow_cast,x.shadow_cast_only=p.render.shadow_cast_only,x.shadow_receive=p.render.shadow_receive);r?(x.reflexible=A.reflexible,x.reflexible_only=A.reflexible_only,x.reflective=A.reflective,
x.cube_reflection_id=A.cube_reflection_id,x.plane_reflection_id=A.plane_reflection_id,x.reflection_type=A.reflection_type):(x.reflexible=p.render.reflexible,x.reflexible_only=p.render.reflexible_only,x.reflective=p.render.reflective,x.cube_reflection_id=p.render.cube_reflection_id,x.plane_reflection_id=p.render.plane_reflection_id,x.reflection_type=p.render.reflection_type);R.push(x);var F=f[D];F||(F=new Float32Array);m&&U.init_rand_r_seed(k.seed,n);var G=new Float32Array(3),C=new Float32Array([0,
0,0,1]),za=[],y=Ha.check_particles_bin_format(Y.loaded_data_version)&&!h.b4w_initial_rand_rotation&&!h.b4w_hair_billboard,J=4;y&&(J=8);for(var N=0;N<F.length;N+=J){G[0]=F[N];G[1]=F[N+1];G[2]=F[N+2];var Z=F[N+3]*Aa.get_scale(A.world_tsr);if(h.b4w_initial_rand_rotation){switch(h.b4w_rotation_type){case "XYZ":var E=new Float32Array([U.rand_r(n),U.rand_r(n),U.rand_r(n)]);pa.normalize(E,E);break;case "Z":E=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+h.b4w_rotation_type;
}T.setAxisAngle(E,h.b4w_rand_rotation_strength*(2*Math.PI*U.rand_r(n)-Math.PI),C)}else if(y&&(C.set(F.subarray(N+4,N+8)),U.quat_bpy_b4w(C,C),!h.use_whole_group))if(h.use_rotation_dupli){var V=Aa.get_quat_view(A.world_tsr);T.multiply(C,V,C)}else T.multiply(C,xa,C);var z=Aa.set_sep(G,Z,C,Aa.create());za.push(z)}ea.push(za)}for(var P={},D=0;D<e.length;D++){var ka=e[D],H=g[D],x=R[D],Q={};x.wind_bending&&(Q.au_wind_bending_amp=[x.wind_bending_amp],Q.au_wind_bending_freq=[x.wind_bending_freq],Q.au_detail_bending_freq=
[x.detail_bending_freq],Q.au_detail_bending_amp=[x.detail_bending_amp],Q.au_branch_bending_amp=[x.branch_bending_amp],x.wind_bending_amp=0,x.wind_bending_freq=0,x.detail_bending_freq=0,x.detail_bending_amp=0,x.branch_bending_amp=0);var S=B(x),za=ea[D];if(za.length){for(var Ta=ka.data,qa=Ta.materials,Ia=Array(qa.length),O=Array(qa.length),N=0;N<qa.length;N++)if(!W.has_empty_submesh(Ta,N))for(var L=0;L<H.length;L++){var Da=H[L],ra=u(Da),Ea=qa[N];"COLOR_ID"==Da&&(ra.can_fork_outline=!(ka.b4w_do_not_render||
Ea.b4w_do_not_render));"MAIN"==Da?Ia[N]=ra:"DEBUG_VIEW"==Da&&(O[N]=ra);ra.cluster_id=a.b4w_cluster_data.cluster_id;if(I(ra,Ea)){"SHADOW"==Da&&Ia[N]&&(ra.use_shadeless=Ia[N].use_shadeless);ra.draw_mode=W.DM_DEFAULT;M(ra,x);ra.odd_id_prop=h.uuid;"JITTERED"==h.b4w_hair_billboard_type&&(ra.jitter_amp=h.b4w_hair_billboard_jitter_amp,ra.jitter_freq=h.b4w_hair_billboard_jitter_freq);v&&(ra.grass_scale_threshold=h.b4w_dynamic_grass_scale_threshold);t||(delete ra.vertex_colors_usage.a_bending_col_main,delete ra.vertex_colors_usage.a_bending_col_detail);
K(ra,S);var X=W.extract_submesh(Ta,N,ra.common_attributes,b.bone_skinning_info,ra.vertex_colors_usage,ra.uv_maps_usage),Fa=W.make_clone_submesh(X,Q,za,p),la=Fa,oa=za;la.va_common.au_center_pos=new Float32Array(3*la.base_length);for(var ha=oa.length,ja=la.base_length/ha,ba=0;ba<ha;ba++)for(var ca=oa[ba],aa=3*ja*ba,ga=0;ga<ja;ga++)la.va_common.au_center_pos[aa+3*ga]=ca[0],la.va_common.au_center_pos[aa+3*ga+1]=ca[1],la.va_common.au_center_pos[aa+3*ga+2]=ca[2];Fa=la;if(x.wind_bending&&x.bend_center_only){var sa=
Fa,da=p.render.world_tsr;sa.va_common.a_emitter_center=new Float32Array(3*sa.base_length);var ia=pa.fromValues(0,0,0);Aa.transform_vec3(ia,da,ia);for(var ma=0;ma<sa.base_length;ma++)sa.va_common.a_emitter_center[3*ma]=ia[0],sa.va_common.a_emitter_center[3*ma+1]=ia[1],sa.va_common.a_emitter_center[3*ma+2]=ia[2];Fa=sa}var ta=h.b4w_vcol_from_name,wa=h.b4w_vcol_to_name,hb=ra,ub=c,cc=!t,Dc=Ta,uc=[];if(""!==ta&&""!==wa){var Bb,pc=wa,Kb=hb.vertex_colors_usage,Ec=[],Lb=void 0;for(Lb in Kb)for(var $a=Kb[Lb].src,
ib=0,pb=0;pb<$a.length;pb++){var Oa=$a[pb].mask;pc==$a[pb].name&&Ec.push(Lb,Oa,ib);ib+=U.rgb_mask_get_channels_count(Oa)}Bb=Ec;if(0<Bb.length)for(var eb=0;eb<Bb.length;eb+=3)uc.push({emitter_attr:ta,emitter_mask:7,particle_attr:Bb[eb],particle_mask:Bb[eb+1],dst_channel_offset:Bb[eb+2]});else W.has_attr(hb.common_attributes,"a_color")&&wa==Dc.active_vcol_name&&uc.push({emitter_attr:ta,emitter_mask:7,particle_attr:"a_color",particle_mask:7,dst_channel_offset:0})}cc&&("a_bending_col_main"in ub&&uc.push({emitter_attr:"a_bending_col_main",
emitter_mask:4,particle_attr:"a_bending_col_main",particle_mask:4,dst_channel_offset:0}),"a_bending_col_detail"in ub&&uc.push({emitter_attr:"a_bending_col_detail",emitter_mask:7,particle_attr:"a_bending_col_detail",particle_mask:7,dst_channel_offset:0}));for(var Mb=Fa,vc=za,Zb=d,Hb=uc,jc=ra.vertex_colors_usage,ab=!1,Cb=0;Cb<Hb.length;Cb++){var vb=Hb[Cb].emitter_attr,kc=Zb.va_common[vb];if(kc&&0<kc.length){ab=!0;break}}if(ab){var wc,Sb=p.render.bb_local,Xa=Zb.va_frames[0].a_position,sb=vc,Ca=P,qb=
new Float32Array(3),wb=new Float32Array(3),Nb=new Uint32Array(sb.length);if(!("verts_indices"in Ca)){Ca.cell_size=new Float32Array(3);Ca.base_point=new Float32Array(3);Ca.verts_indices=new Uint32Array(Xa.length/3);Ca.octs_indices=new Uint32Array(Xa.length/3);Ca.cell_size[0]=(Sb.max_x-Sb.min_x)/20;Ca.cell_size[1]=(Sb.max_y-Sb.min_y)/20;Ca.cell_size[2]=(Sb.max_z-Sb.min_z)/20;Ca.base_point[0]=Sb.min_x;Ca.base_point[1]=Sb.min_y;Ca.base_point[2]=Sb.min_z;for(var Va=0;Va<Xa.length/3;Va++){var Ob=Xa[3*Va+
1],Tb=Xa[3*Va+2],tb=U.trunc((Xa[3*Va]-Ca.base_point[0])/Ca.cell_size[0]),fb=U.trunc((Ob-Ca.base_point[1])/Ca.cell_size[1]),Db=U.trunc((Tb-Ca.base_point[2])/Ca.cell_size[2]),tb=U.clamp(tb,0,19),fb=U.clamp(fb,0,19),Db=U.clamp(Db,0,19);Ca.verts_indices[Va]=Va;Ca.octs_indices[Va]=Db*Math.pow(20,2)+20*fb+tb}W.sort_two_arrays(Ca.octs_indices,Ca.verts_indices,W.SORT_NUMERIC,!0);Ca.verts_offsets=new Uint32Array(Math.pow(20,3));for(Va=0;Va<Ca.octs_indices.length;Va++)Ca.verts_offsets[Ca.octs_indices[Va]]++;
delete Ca.octs_indices;for(Va=1;Va<Ca.verts_offsets.length;Va++)Ca.verts_offsets[Va]+=Ca.verts_offsets[Va-1]}for(var cb=0;cb<sb.length;cb++){qb[0]=sb[cb][0];qb[1]=sb[cb][1];qb[2]=sb[cb][2];for(var jb=1E10,Eb=-1,Ya=U.trunc((qb[0]-Ca.base_point[0])/Ca.cell_size[0]),kb=U.trunc((qb[1]-Ca.base_point[1])/Ca.cell_size[1]),dc=U.trunc((qb[2]-Ca.base_point[2])/Ca.cell_size[2]),Ya=U.clamp(Ya,0,19),kb=U.clamp(kb,0,19),dc=U.clamp(dc,0,19),lb=dc*Math.pow(20,2)+20*kb+Ya,mb=Ca.verts_offsets[lb],db=0==lb?0:Ca.verts_offsets[lb-
1];db<mb;db++){var lc=Ca.verts_indices[db];wb[0]=Xa[3*lc];wb[1]=Xa[3*lc+1];wb[2]=Xa[3*lc+2];pa.sub(wb,qb,wb);var qc=pa.sqrLen(wb);qc<=jb&&(jb=qc,Eb=lc)}if(-1==Eb)for(db=0;db<Xa.length/3;db++)wb[0]=Xa[3*db],wb[1]=Xa[3*db+1],wb[2]=Xa[3*db+2],pa.sub(wb,qb,wb),qc=pa.sqrLen(wb),qc<=jb&&(jb=qc,Eb=db);Nb[cb]=Eb}wc=Nb;for(var xc=Mb.base_length/vc.length,Cb=0;Cb<Hb.length;Cb++){var Qa=Hb[Cb].particle_attr,Sa=Hb[Cb].particle_mask,vb=Hb[Cb].emitter_attr,Fc=Hb[Cb].emitter_mask,kc=Zb.va_common[vb];switch(Qa){case "a_bending_col_main":var $b=
1;break;case "a_bending_col_detail":$b=3;break;case "a_color":$b=3;break;default:for(var Fb=$b=0;Fb<jc[Qa].src.length;Fb++)$b+=U.rgb_mask_get_channels_count(jc[Qa].src[Fb].mask)}if(kc&&0<kc.length){var ad=U.rgb_mask_get_channels_count(Fc),bd=U.rgb_mask_get_channels_count(Sa),Tc=Fc&Sa,ec=U.rgb_mask_get_channels_presence(Tc);Tc!=Sa&&fa.error("Wrong color extraction from "+vb+" to "+Qa+".");if("a_bending_col_main"==Qa||"a_bending_col_detail"==Qa)Mb.va_common[Qa]=new Float32Array(Mb.base_length*bd);for(Fb=
0;Fb<vc.length;Fb++){var rc=wc[Fb],Gc=rc*ad,fc=Fb*xc*$b;if(-1!=rc)for(var yc=0;yc<xc;yc++)for(var Ub=yc*$b,Vb=0;Vb<ec.length;Vb++)if(ec[Vb]){var mc=U.rgb_mask_get_channel_presence_index(Fc,Vb),ac=Hb[Cb].dst_channel_offset+U.rgb_mask_get_channel_presence_index(Sa,Vb);Mb.va_common[Qa][fc+Ub+ac]=kc[Gc+mc]}}}else Mb.va_common[Qa]=new Float32Array(0)}}Fa=Mb;q.push({batch:ra,submesh:Fa,mat_names:[Ea.name],render:x,rel_bpy_objects:[a]})}}for(N=0;N<O.length;N++)O[N]&&(O[N].debug_id=Ia[N].id,K(O[N],O[N].render_id))}}return q}
function I(a,b){var c=!0;"NODES_GLOW"==a.type&&(c=la.check_material_glow_output(b));return c=c&&f(a,b)}function K(a,b){var c=null,d=null,e=a.bb_local,g=a.be_local,f=a.bb_world,h=a.be_world;a.bb_local=null;a.be_local=null;a.bb_world=null;a.be_world=null;for(var k=0;k<a.textures.length;k++){var l=a.textures[k].canvas_context;l&&(c||(c={}),c[k]=l,a.textures[k].canvas_context=null);if(l=a.textures[k].video_file)d||(d={}),d[k]=l,a.textures[k].video_file=null}a.id=0;a.render_id=b;a.id=U.calc_variable_id(a,
b);a.bb_local=e;a.be_local=g;a.bb_world=f;a.be_world=h;if(c)for(var n in c)a.textures[n].canvas_context=c[n];if(d)for(n in d)a.textures[n].video_file=d[n]}function B(a){var b=a.bone_pointers;a.bone_pointers=null;var c=U.calc_variable_id(a,0);a.bone_pointers=b;return c}function N(a,b,c,d,e,g){var f=u("DEBUG_VIEW");J(f,"debug_view.glslv","debug_view.glslf");f.debug_view_mode=0;f.debug_sphere=!0;f.depth_mask=!0;f.odd_id_prop=c;e&&(f.debug_sphere_dynamic=!0);M(f,b);b=B(b);K(f,b);d?(b=e?a.center:[0,0,
0],d=sa.generate_uv_sphere(16,8,1,b,!1,!1),c=[pa.length(a.axis_x),pa.length(a.axis_y),pa.length(a.axis_z)],W.scale_submesh_xyz(d,c,b),e||(Aa.set_trans(a.center,Ia),e=pa.normalize(a.axis_x,Ea),b=pa.normalize(a.axis_y,za),a=pa.normalize(a.axis_z,ea),a=U.ellipsoid_axes_to_mat3(e,b,a,Fa),ma.invert(a,a),a=T.fromMat3(a,Ta),Aa.set_quat(a,Ia),Aa.set_scale(1,Ia),W.submesh_apply_transform(d,Ia))):d=sa.generate_uv_sphere(16,8,a.radius,a.center,!1,!1);f.bb_local=U.clone_object_r(g.bb_local);f.be_local=U.clone_object_r(g.be_local);
f.bb_world=U.clone_object_r(g.bb_world);f.be_world=U.clone_object_r(g.be_world);W.submesh_drop_indices(d,1,!0);d.va_common.a_polyindex=W.extract_polyindices(d);P(f,d);return f}function J(a,b,c){a.shaders_info.vert=b;a.shaders_info.frag=c;Z.set_default_directives(a.shaders_info)}function X(a,b,c){1==a.textures.length&&0==a.texture_names.length&&a.texture_names.push("default0");c=c||"default"+String(a.textures.length);-1==a.texture_names.indexOf(c)&&(a.textures.push(b),a.texture_names.push(c));a.shader&&
R.assign_texture_uniforms(a)}function O(a){if(!a.shaders_info)throw"No shaders info for batch "+a.name;a.shader=Z.get_compiled_shader(a.shaders_info);R.assign_uniform_setters(a.shader);R.assign_attribute_setters(a);R.assign_texture_uniforms(a)}function ba(a,b,c){a=a.scenes_data[0].batches;for(var d=0;d<a.length;d++)if(a[d].type==c&&!a[d].forked_batch&&-1!=a[d].material_names.indexOf(b))return a[d];return null}function ca(a,b,c){a=a.scenes_data[0].batches;for(var d=0;d<a.length;d++)if(a[d].type==c&&
a[d].forked_batch&&-1!=a[d].material_names.indexOf(b))return a[d];return null}function ga(a,b){a.diffuse_color.set(b.diffuse_color);a.diffuse_intensity=b.diffuse_intensity;a.specular_color.set(b.specular_color);a.specular_color_factor=b.specular_color_factor;a.specular_params.set(b.specular_params);a.emit=b.emit;a.ambient=b.ambient;a.diffuse_color_factor=b.diffuse_color_factor;a.alpha_factor=b.alpha_factor;a.reflect_factor=b.reflect_factor;a.fresnel_params.set(b.fresnel_params);a.parallax_scale=b.parallax_scale;
a.shallow_water_col.set(b.shallow_water_col);a.shallow_water_col_fac=b.shallow_water_col_fac;a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.water_norm_uv_velocity=b.water_norm_uv_velocity}function aa(a,b){for(var c=a.node_value_inds,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function ia(a,b){for(var c=a.node_rgb_inds,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}var da=r("__boundings"),ta=r("__config"),fa=
r("__print"),ka=r("__extensions"),W=r("__geometry"),A=r("__graph"),la=r("__nodemat"),ja=r("__obj_util"),ha=r("__particles"),sa=r("__primitives"),T=r("__quat"),Ha=r("__reformer"),R=r("__renderer"),V=r("__scenegraph"),Z=r("__shaders"),qa=r("__textures"),Aa=r("__tsr"),U=r("__util"),oa=r("__animation"),pa=r("__vec3"),L=r("__vec4"),ma=r("__mat3"),Y=ta.defaults,wa=["MAIN"],xa=new Float32Array([0,-Math.sqrt(.5),0,Math.sqrt(.5)]),Ea=new Float32Array(3),za=new Float32Array(3),ea=new Float32Array(3),Ta=new Float32Array(4),
Ia=Aa.create(),ra=new Float32Array(24),Fa=ma.create();a.BATCH_INHERITED_TEXTURES=Da;var Da="u_colormap0 u_colormap1 u_stencil0 u_specmap0 u_normalmap0 u_mirrormap".split(" ");a.init_batch=u;a.generate_main_batches=function(a,b,e,g){for(var f=[],k=[],l=0;l<b.length;l++){var n=b[l],m=n._object;m.is_hair_dupli||(ja.is_dynamic(m)?f.push(n):k.push(n))}for(var l=[],l=l.concat(h(f,a._render.graph)),m=l=l.concat(d(k,a._render.graph)),f=[],k=[],p={},l=0;l<m.length;l++){var q=m[l].batch,v=m[l].render,t=null;
if(q.id in p){var w=p[q.id],B=k[w].batch,r=k[w].render,R=null,x=null,ea=q.bb_local,A=q.be_local,F=q.bb_world,u=q.be_world;q.bb_local=null;q.be_local=null;q.bb_world=null;q.be_world=null;var G=B.bb_local,C=B.be_local,za=B.bb_world,y=B.be_world;B.bb_local=null;B.be_local=null;B.bb_world=null;B.be_world=null;for(n=0;n<q.textures.length;n++){var J=q.textures[n].canvas_context;J&&(R||(R={}),R[n]=J,q.textures[n].canvas_context=null);if(J=q.textures[n].video_file)x||(x={}),x[n]=J,q.textures[n].video_file=
null}U.strict_objs_is_equal(q,B,!0)&&U.strict_objs_is_equal(v,r,!0)&&(t=k[w]);q.bb_local=ea;q.be_local=A;q.bb_world=F;q.be_world=u;B.bb_local=G;B.be_local=C;B.bb_world=za;B.be_world=y;if(R)for(n in R)q.textures[n].canvas_context=R[n];if(x)for(n in x)q.textures[n].video_file=x[n];if(!t){do q.id++;while(p[q.id])}}t||(t={batch:q,render:m[l].render,rel_bpy_objects:[],submeshes:[],mat_names:[]},p[q.id]=k.length,k.push(t));t.rel_bpy_objects=t.rel_bpy_objects.concat(m[l].rel_bpy_objects);m[l].submesh&&m[l].submesh.base_length&&
t.submeshes.push(m[l].submesh);if(t.mat_names.length)for(n=0;n<m[l].mat_names.length;n++)q=m[l].mat_names[n],-1==t.mat_names.indexOf(q)&&t.mat_names.push(q);else t.mat_names=m[l].mat_names;W.sort_two_arrays(t.mat_names,t.submeshes,W.SORT_STRING,!1)}for(l=0;l<k.length;l++){m=k[l].submeshes;if(0==m.length)n=U.create_empty_submesh(U.unique_name("%empty"));else if(1==m.length)n=m[0];else{p=[];for(n=0;n<m.length;n++)W.is_long_submesh(m[n])||p.push(n);if(p.length<m.length)for(n=0;n<p.length;n++)W.submesh_drop_indices(m[p[n]]);
n=W.submesh_list_join(m)}"PARTICLES"!=k[l].batch.type&&(m=n.submesh_bd,k[l].batch.bb_local=U.clone_object_r(m.bb_local),k[l].batch.be_local=U.clone_object_r(m.be_local),k[l].batch.bb_world=U.clone_object_r(m.bb_world),k[l].batch.be_world=U.clone_object_r(m.be_world));f.push({batch:k[l].batch,render:k[l].render,submesh:n,mat_names:k[l].mat_names,rel_bpy_objects:k[l].rel_bpy_objects})}for(k=0;k<f.length;k++)if(m=f[k].batch,m.material_names=f[k].mat_names,P(m,f[k].submesh),D(m,e,a),"STATIC"==f[k].render.type&&
"COLOR_ID"!=m.type){l=U.unique_name("%meta%"+m.type+"%"+m.material_names.join("%")+"%");p=ja.create_object(l,"MESH");p.render=U.clone_object_r(f[k].render);ja.append_scene_data(p,a);ja.append_batch(p,a,m);g.push(p);t=[];for(n=0;n<f[k].rel_bpy_objects.length;n++){l=f[k].rel_bpy_objects[n];l=l._object;da.extract_bb_corners(l.render.bb_world,ra);for(q=0;q<ra.length;q++)t.push(ra[q]);"MAIN"==m.type&&l.meta_objects.push(p)}p.render.be_world=da.create_bounding_ellipsoid_by_bb(t,!0);p.render.be_local=da.calc_be_local_by_tsr(p.render.be_world,
p.render.world_tsr)}else for(p=[],n=0;n<f[k].rel_bpy_objects.length;n++)l=f[k].rel_bpy_objects[n],l=l._object,-1==p.indexOf(l.name)&&(ja.append_batch(l,a,m),p.push(l.name));if(Y.debug_view){for(k=0;k<f.length;k++)if(e=f[k].render,"DYNAMIC"==e.type&&(l=f[k].rel_bpy_objects[0]._object,-1<wa.indexOf(f[k].batch.type))){n=ja.get_scene_data(l,a);m=n.batches;p=!1;for(n=0;n<m.length;n++)m[n].debug_sphere&&(p=!0);p||(e=N(e.be_local,e,l.name,!0,!0,e),ja.append_batch(l,a,e))}for(k=0;k<g.length;k++)l=g[k],e=
l.render,n=ja.get_scene_data(l,a),m=n.batches,-1<wa.indexOf(m[0].type)&&(e=N(m[0].be_world,e,l.name,!0,!1,m[0]),ja.append_batch(l,a,e));for(k=0;k<f.length;k++)f[k].batch.debug_id=k}for(k=0;k<b.length;k++)for(n=ja.get_scene_data(b[k]._object,a),m=n.batches,n=0;n<m.length;n++)c(m[n]);for(k=0;k<g.length;k++)for(n=ja.get_scene_data(g[k],a),m=n.batches,n=0;n<m.length;n++)c(m[n])};a.append_sky_batch_to_world=function(a,b,d){var e=a._render.world_light_set,g=u("MAIN");J(g,"special_skydome.glslv","special_skydome.glslf");
if(b.procedural_skydome)v(g,"PROCEDURAL_SKYDOME",1),g.procedural_sky=!0;else{var f=e.sky_texture_param;if(f){v(g,"WO_SKYTEX",1);var h=qa.get_batch_texture(e.sky_texture_slot,null);X(g,h,"u_sky");f.invert&&v(g,"MTEX_NEGATIVE",1);f.use_rgb_to_intensity&&v(g,"MTEX_RGBTOINT",1);v(g,"BLENDTYPE",f.blend_type);f.use_map_blend&&v(g,"WOMAP_BLEND",1);f.use_map_horizon&&v(g,"WOMAP_HORIZ",1);f.use_map_zenith_up&&v(g,"WOMAP_ZENUP",1);f.use_map_zenith_down&&v(g,"WOMAP_ZENDOWN",1)}e.use_sky_blend&&v(g,"WO_SKYBLEND",
1);e.use_sky_paper&&v(g,"WO_SKYPAPER",1);e.use_sky_real&&v(g,"WO_SKYREAL",1)}b.reflexible&&(g.reflexible=!0,b.reflexible_only&&(g.reflexible_only=!0));g.offset_z=99999;Q(g,"a_position");b=sa.generate_fullscreen_quad();P(g,b);c(g);a=ja.get_scene_data(d,a);d.render.do_not_cull=!0;d.render.bb_local=da.zero_bounding_box();d.render.bs_local=da.zero_bounding_sphere();d.render.bb_world=da.zero_bounding_box();d.render.bs_world=da.zero_bounding_sphere();d.render.be_local=da.zero_bounding_ellipsoid();d.render.be_world=
da.zero_bounding_ellipsoid();g.be_local=da.zero_bounding_ellipsoid();g.be_world=da.zero_bounding_ellipsoid();g.bb_local=da.zero_bounding_box();g.bb_world=da.zero_bounding_box();a.batches.push(g)};a.create_forked_batches=function(a,c,d){d=ja.get_scene_data(a,d).batches;var e=[];V.find_subs(c,"SHADOW_CAST");var g=V.find_subs(c,"MAIN_PLANE_REFLECT"),f=V.find_subs(c,"MAIN_CUBE_REFLECT"),h=V.find_subs(c,"OUTLINE_MASK");c=V.find_subs(c,"COLOR_PICKING");for(var k=0;k<d.length;k++){var l=d[k],n=null;"SHADOW"==
l.type&&"RECEIVE"==l.subtype&&l.shadow_cast&&(n=b(l),n.subtype="CAST");"MAIN"!=l.type&&"PARTICLES"!=l.type||!g&&!f||!l.reflexible||(n=b(l),n.subtype="REFLECT",n.particles_data=l.particles_data,n.z_sort&&(n.z_sort=!1,n.depth_mask=!1));"COLOR_ID"==l.type&&l.can_fork_outline&&h&&a.render.outlining&&(c&&a.render.selectable?(n=b(l),n.subtype="OUTLINE"):l.subtype="OUTLINE");n&&(n.forked_batch=!0,K(n,a.render.id),e.push(n))}d.push.apply(d,e)};a.set_local_cylinder_capsule=k;a.wb_angle_to_amp=function(a,b,
c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";if(0==b)return 0;a=b*Math.tan(U.deg_to_rad(a));return.5*(Math.sqrt(2*Math.sqrt(4*a+1)+2)/2-1)/b};a.bb_bpy_to_b4w=function(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}};a.append_texture_to_batch=function(a,b,c,d){b=qa.generate_batch_texure(b,d);X(a,b,c)};a.update_batch_material_error=n;a.update_batch_lights=D;a.set_lamp_data=G;a.assign_shadow_receive_dirs=function(a,b,c){v(a,"CSM_SECTION0",
0);v(a,"CSM_SECTION1",0);v(a,"CSM_SECTION2",0);v(a,"CSM_SECTION3",0);v(a,"NUM_CAST_LAMPS",0);if(b){v(a,"NUM_CAST_LAMPS",b.lamp_types.length);Y.mac_os_shadow_hack&&v(a,"MAC_OS_SHADOW_HACK",1);for(c=0;c<b.csm_num;c++)v(a,"CSM_SECTION"+String(c),1);v(a,"SHADOW_TEX_RES",Z.glsl_value(b.csm_resolution));v(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);v(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)}else v(a,"SHADOW_TEX_RES",0),v(a,"CSM_FADE_LAST_CASCADE",0),v(a,"CSM_BLEND_BETWEEN_CASCADES",
0)};a.set_batch_directive=v;a.get_batch_directive=function(a,b){return Z.get_directive(a.shaders_info,b)};a.update_batch_geometry=P;a.update_batch_id=K;a.calculate_render_id=B;a.create_bounding_ellipsoid_batch=N;a.append_texture=X;a.replace_texture=function(a,b,c){c=a.texture_names.indexOf(c);-1<c&&(a.textures[c]=b)};a.create_shadeless_batch=function(a,b,c){var d=u("MAIN");1>c&&(d.blend=!0);L.set(b[0],b[1],b[2],c,d.diffuse_color);d.draw_mode=W.DM_TRIANGLES;P(d,a);J(d,"main.glslv","main_stack.glslf");
v(d,"SHADELESS",1);O(d);return d};a.update_shader=O;a.generate_line_batches=function(a,b){for(var d=0;d<b.length;d++){var e=b[d]._object,g=u("LINE");J(g,"line.glslv","line.glslf");g.blend=!0;var f=sa.generate_line();P(g,f);c(g);g.bb_local=da.zero_bounding_box();g.bb_world=da.zero_bounding_box();g.be_local=da.zero_bounding_ellipsoid();g.be_world=da.zero_bounding_ellipsoid();ja.append_scene_data(e,a);ja.get_scene_data(e,a).batches.push(g);O(g)}};a.check_batch_perm_uniform=function(a,b){return a.shader.permanent_uniform_setters.length?
a.shader.permanent_uniform_setters_table[b]?!0:!1:!1};a.create_depth_pack_batch=function(a){a=u("DEPTH_PACK");a.use_backface_culling=!0;a.depth_mask=!1;var b=sa.generate_fullscreen_tri();P(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");O(a);return a};a.create_postprocessing_batch=function(a){var b=u("POSTPROCESSING");J(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":v(b,"POST_EFFECT","POST_EFFECT_NONE");break;
case "GRAYSCALE":v(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");break;case "X_BLUR":v(b,"POST_EFFECT","POST_EFFECT_X_BLUR");break;case "Y_BLUR":v(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");break;case "X_GLOW_BLUR":v(b,"POST_EFFECT","POST_EFFECT_X_GLOW_BLUR");break;case "Y_GLOW_BLUR":v(b,"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR");break;case "X_EXTEND":v(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");break;case "Y_EXTEND":v(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");break;case "FLIP_CUBEMAP_COORDS":v(b,"POST_EFFECT","FLIP_CUBEMAP_COORDS");
break;default:throw"Wrong postprocessing effect: "+a;}b.use_backface_culling=!0;b.depth_mask=!1;a=sa.generate_fullscreen_tri();P(b,a);O(b);return b};a.create_ssao_batch=function(a){var b=u("SSAO");b.depth_mask=!1;b.use_backface_culling=!0;var c=sa.generate_fullscreen_tri();P(b,c);J(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");v(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.ssao_samples);v(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:qa.generate_texture("SSAO_TEXTURE",a)};c={width:4,
height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=qa.get_batch_texture(a,c);X(b,a,"u_ssao_special_tex");O(b);return b};a.create_ssao_blur_batch=function(a){var b=u("SSAO_BLUR");b.depth_mask=!1;b.use_backface_culling=!0;var c=sa.generate_fullscreen_tri();P(b,c);J(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");
v(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);O(b);return b};a.create_dof_batch=function(a){a=u("DOF");a.depth_mask=!1;a.use_backface_culling=!0;var b=sa.generate_fullscreen_tri();P(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");v(a,"DEPTH_RGBA",1);O(a);return a};a.create_outline_batch=function(){var a=u("OUTLINE");a.depth_mask=!1;a.use_backface_culling=!0;var b=sa.generate_fullscreen_tri();P(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/outline.glslf");
O(a);return a};a.create_glow_combine_batch=function(){var a=u("GLOW_COMBINE");a.depth_mask=!1;a.use_backface_culling=!0;var b=sa.generate_fullscreen_tri();P(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");O(a);return a};a.create_god_rays_batch=function(a,b,c,d){a=u("GOD_RAYS");a.depth_mask=!1;a.use_backface_culling=!0;var e=sa.generate_billboard();P(a,e);J(a,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");v(a,"DEPTH_RGBA",b?1:0);v(a,"WATER_EFFECTS",c?1:
0);v(a,"STEPS_PER_PASS",Z.glsl_value(d,1));O(a);return a};a.create_god_rays_combine_batch=function(a,b){var c=u("GOD_RAYS_COM");c.depth_mask=!1;c.use_backface_culling=!0;var d=sa.generate_fullscreen_tri();P(c,d);J(c,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");v(c,"SAFARI_CANVAS_ALPHA_HACK",Y.safari_canvas_alpha_hack?1:0);O(c);return c};a.create_procedural_sky_batch=function(){var a=u("SKY");a.depth_mask=!1;a.use_backface_culling=!0;var b=sa.generate_cube();P(a,b);
J(a,"procedural_skydome.glslv","procedural_skydome.glslf");v(a,"WATER_EFFECTS",1);O(a);return a};a.create_antialiasing_batch=function(a){var b=u("ANTIALIASING");b.depth_mask=!1;b.use_backface_culling=!0;var c=sa.generate_fullscreen_tri();P(b,c);J(b,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");Y.quality_aa_method?(v(b,"AA_METHOD","AA_METHOD_FXAA_QUALITY"),v(b,"AA_QUALITY",a.fxaa_quality)):v(b,"AA_METHOD","AA_METHOD_FXAA_LIGHT");O(b);return b};a.create_smaa_batch=function(a){var b=
u("SMAA"),c=sa.generate_fullscreen_tri();P(b,c);J(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");v(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");v(b,"SMAA_PASS",a);v(b,"SMAA_PREDICATION",0);v(b,"SMAA_REPROJECTION",0);O(b);b.depth_mask=!1;b.use_backface_culling=!0;return b};a.create_compositing_batch=function(){var a=u("COMPOSITING");a.depth_mask=!1;a.use_backface_culling=!0;var b=sa.generate_fullscreen_tri();P(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");O(a);
return a};a.create_motion_blur_batch=function(a){a=u("MOTION_BLUR");a.use_backface_culling=!0;a.depth_mask=!1;var b=sa.generate_fullscreen_tri();P(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");O(a);return a};a.create_stereo_batch=function(a){var b=u("STEREO");b.use_backface_culling=!0;b.depth_mask=!1;var c=sa.generate_fullscreen_tri();P(b,c);J(b,"postprocessing/postprocessing.glslv","postprocessing/stereo.glslf");v(b,"ANAGLYPH","ANAGLYPH"===a?1:0);v(b,"DISABLE_DISTORTION_CORRECTION",
0);O(b);return b};a.create_luminance_batch=function(){var a=u("LUMINANCE");a.depth_mask=!1;a.use_backface_culling=!0;var b=sa.generate_fullscreen_tri();P(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");O(a);return a};a.create_average_luminance_batch=function(){var a=u("LUMINANCE");a.depth_mask=!1;a.use_backface_culling=!0;var b=sa.generate_fullscreen_tri();P(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");O(a);return a};a.create_luminance_trunced_batch=
function(){var a=u("LUMINANCE_X_BLUR");a.depth_mask=!1;a.use_backface_culling=!0;var b=sa.generate_fullscreen_tri();P(a,b);J(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");O(a);return a};a.create_bloom_blur_batch=function(){var a=u("POSTPROCESSING");a.use_backface_culling=!0;a.depth_mask=!1;var b=sa.generate_fullscreen_tri();P(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");O(a);return a};a.create_bloom_combine_batch=function(){var a=
u("BLOOM");a.depth_mask=!1;a.use_backface_culling=!0;var b=sa.generate_fullscreen_tri();P(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");O(a);return a};a.create_velocity_batch=function(){var a=u("VELOCITY");a.depth_mask=!1;a.use_backface_culling=!0;var b=sa.generate_fullscreen_tri();P(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");O(a);return a};a.create_anchor_visibility_batch=function(){var a=u("ANCHOR_VISIBILITY");a.depth_mask=
!0;a.use_backface_culling=!0;a.draw_mode=W.DM_POINTS;J(a,"anchors.glslv","anchors.glslf");var b=sa.generate_index(1);P(a,b);v(a,"ANCHOR_NUM",1);O(a);a.positions=new Float32Array([0,0,0]);return a};a.create_performance_batch=function(){var a=u("PERFORMANCE");a.depth_mask=!1;a.use_backface_culling=!0;var b=sa.generate_fullscreen_tri();P(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/performance.glslf");v(a,"POST_EFFECT","POST_EFFECT_X_BLUR");O(a);return a};a.update_anchor_visibility_batch=
function(a,b){var c=b.length/3;if(c!=a.positions.length/3){var d=sa.generate_index(c);P(a,d);v(a,"ANCHOR_NUM",c);O(a)}a.positions=b};a.get_first_batch=function(a){if(!a.scenes_data.length)return null;a=a.scenes_data[0];return a.batches.length?a.batches[0]:null};a.find_batch_material=ba;a.find_batch_material_forked=ca;a.set_material_props=ga;a.check_batch_type=function(a,b){for(var c=a.scenes_data[0].batches,d=0;d<c.length;d++)if(c[d].type==b)return!0;return!1};a.clear_batch=function(a){for(var b=
a.textures,c=0;c<b.length;c++)qa.delete_texture(b[c].w_texture);W.cleanup_bufs_data(a.bufs_data)};a.inherit_material=function(a,b,c,d){for(var e=["MAIN","SHADOW","COLOR_ID"],g=!1,f=0;f<e.length;f++){var h=e[f],k=ba(a,b,h),l=ba(c,d,h);if(k&&l){var g=!0,n=ca(c,d,h);"MAIN"==h&&(ga(l,k),n&&ga(n,k));for(h=0;h<l.texture_names.length;h++){var m=l.texture_names[h];if(-1!==Da.indexOf(m)){var p=k.texture_names.indexOf(m);-1!==p&&(l.textures[h]=k.textures[p],n&&(m=n.texture_names.indexOf(m),-1!==m&&(n.textures[m]=
k.textures[p])))}}}}g||fa.error("Wrong objects for inheriting material!")};a.set_nodemat_value=function(a,b,c){var d=b[0],e=ba(a,d,"MAIN");if(null===e)fa.error('Material "'+d+'" was not found in the object "'+a.name+'".');else if(b=b.join("%join%"),e=aa(e,b),null!==e)for(b=0;b<a.scenes_data.length;b++)for(var g=a.scenes_data[b].batches,f=0;f<g.length;f++){var h=g[f];-1!=h.material_names.indexOf(d)&&h.node_values&&(h.node_values[e]=c)}else fa.error('Value node "'+b+'" was not found in the object "'+
a.name+'".')};a.set_nodemat_rgb=function(a,b,c,d,e){var g=b[0],f=b.join("%join%");b=ba(a,g,"MAIN");b=ia(b,f);if(null!=b)for(f=0;f<a.scenes_data.length;f++)for(var h=a.scenes_data[f].batches,k=0;k<h.length;k++){var l=h[k];-1!=l.material_names.indexOf(g)&&l.node_rgbs&&(l.node_rgbs[3*b]=c,l.node_rgbs[3*b+1]=d,l.node_rgbs[3*b+2]=e)}else fa.error('RGB node "'+f+'" was not found in the object "'+a.name+'".')};a.get_nodemat_value=function(a,b){var c=b[0],d=b.join("%join%"),c=ba(a,c,"MAIN"),e=aa(c,d);if(null!=
e)return c.node_values[e];fa.error('Value node "'+d+'" was not found in the object "'+a.name+'".');return null};a.get_nodemat_rgb=function(a,b,c){var d=b[0];b=b.join("%join%");var d=ba(a,d,"MAIN"),e=ia(d,b);if(null!=e)return c[0]=d.node_rgbs[3*e],c[1]=d.node_rgbs[3*e+1],c[2]=d.node_rgbs[3*e+2],c;fa.error('RGB node "'+b+'" was not found in the object "'+a.name+'".');return null}};b4w.module.__nodemat=function(a,r){function u(a,b,f,h,v){var t=Aa.get_active(),t=d(b,v,t.uuid);if(t in ma)return ma[t];if("SHADOW"!=v&&"COLOR_ID"!=v){b=T.create();for(var B=a.nodes,r=0;r<B.length;r++)if(null==D(b,B[r],0,h,v))return ma[t]=null;if(f&&-1==n(a,b,"GROUP_OUTPUT","group"))return null;r=da(b);B=f?a.links:a.links.slice();if(!ta(b,B,r))return null;if(f)return b;for(r=0;r<B.length;r++){f=B[r];for(var R=m(f.from_node,b),x=m(f.to_node,b),A=0;A<R.length;A++)for(var G=0;G<x.length;G++){var C=R[A],
N=x[G],y=T.get_node_attr(b,C),J=T.get_node_attr(b,N);if(!aa(b,C,N,y,J,f))return ma[t]=null}}g(b);a="GLOW"==v?n(a,b,"B4W_GLOW_OUTPUT","material",!0):n(a,b,"OUTPUT","material",!1,!0);-1==a&&(b=k(),a=0);l(b);a=T.subgraph_node_conn(b,a,T.BACKWARD_DIR);c(a,h,v);p(a);F(a);e(a);w(a,h,v);ja(a)}else h=u(a,b,f,h,"MAIN"),h=T.clone(h,function(a){var b=U.clone_object_nr(a);b.inputs=U.clone_object_r(a.inputs);b.outputs=U.clone_object_r(a.outputs);return b}),a=n(a,h,"OUTPUT","material",!1,!0),q(h,a),a=T.subgraph_node_conn(h,
a,T.BACKWARD_DIR),p(a);return ma[t]=a}function c(a,c,d){var e=[];T.traverse(a,function(a,b){"MATERIAL"!=b.type&&"MATERIAL_EXT"!=b.type||e.push({node_id:a,node:b})});for(d=0;d<e.length;++d){var g=e[d].node_id,f=e[d].node,h=T.gen_node_id(a);T.append_node(a,h,f.data.material_begin);var k=T.gen_node_id(a);T.append_node(a,k,f.data.material_end);T.append_edge(a,h,k,[4,2]);for(var l={5:["LIGHTING_APPLY",10],6:["LIGHTING_APPLY",6],7:["MATERIAL_END",3],8:["MATERIAL_END",4],9:["MATERIAL_END",5]},n=T.in_edge_count(a,
g),m=[],p=[],q=[],v={},t=0;t<n;t++){var B=T.get_in_edge(a,g,t);B in v||(v[B]=0);var w=T.get_edge_attr(a,B,g,v[B]++);m.push([B,g,w]);var r=l[w[1]];if(r)switch(r[0]){case "MATERIAL_END":p.push([B,k,[w[0],r[1]]]);break;case "LIGHTING_APPLY":q.push([B,[w[0],r[1]]])}else p.push([B,h,w])}b(a,f.data.value,h,k,q,c);for(t=0;t<m.length;t++)T.remove_edge_by_attr(a,m[t][0],m[t][1],m[t][2]);for(t=0;t<p.length;t++)T.append_edge(a,p[t][0],p[t][1],p[t][2]);f=T.out_edge_count(a,g);h=[];l=[];n={};for(t=0;t<f;t++)m=
T.get_out_edge(a,g,t),m in n||(n[m]=0),w=T.get_edge_attr(a,g,m,n[m]++),h.push([g,m,w]),l.push([k,m,w]);for(t=0;t<h.length;t++)T.remove_edge_by_attr(a,h[t][0],h[t][1],h[t][2]);for(t=0;t<l.length;t++)T.append_edge(a,l[t][0],l[t][1],l[t][2]);T.remove_node(a,g)}}function b(a,b,c,d,e,g){var f={name:"LIGHTING_AMBIENT",type:"LIGHTING_AMBIENT"},k=D(a,f,0,g,null),l=k;h(a,c,k,"E");h(a,c,k,"A");h(a,c,k,"D");k=Aa.get_active();k=V.get_scene_objs(k,"LAMP",V.DATA_ID_ALL);if(!b.use_shadeless)for(var n,m,p=0;p<k.length;p++){var q=
k[p].light,f={name:"LIGHTING_LAMP",type:"LIGHTING_LAMP"};n=D(a,f,0,g,null);f={name:"LIGHTING_APPLY",type:"LIGHTING_APPLY"};m=D(a,f,0,g,null);h(a,l,m,"color");h(a,l,m,"specular");h(a,n,m,"ldir");h(a,c,m,"normal");h(a,c,m,"D");h(a,c,m,"S");h(a,n,m,"lcolorint");h(a,c,n,"shadow_factor");l="COOKTORR"==b.specular_shader?"SPECULAR_PHONG":"SPECULAR_"+b.specular_shader;f={name:l,type:l};f=D(a,f,0,g,null);h(a,n,f,"ldir");h(a,n,f,"lfac");h(a,c,f,"normal");h(a,f,m,"sfactor");"SPECULAR_PHONG"!=l&&"SPECULAR_BLINN"!=
l||h(a,n,f,"norm_fac");h(a,c,f,"sp_params");l="HEMI"==q.type?"DIFFUSE_LAMBERT":"DIFFUSE_"+b.diffuse_shader;f={name:l,type:l};f=D(a,f,0,g,null);h(a,n,f,"ldir");h(a,n,f,"lfac");h(a,c,f,"normal");h(a,n,f,"norm_fac");h(a,f,m,"lfactor");"DIFFUSE_LAMBERT"!=l&&h(a,c,f,"dif_params");for(n=0;n<e.length;n++)T.append_edge(a,e[n][0],m,e[n][1]);l=m}h(a,l,d,"color");h(a,l,d,"specular")}function h(a,b,c,d){for(var e=T.get_node_attr(a,b),g=T.get_node_attr(a,c),f,h=0;h<g.inputs.length;h++)if(d==g.inputs[h].identifier){f=
h;break}for(var k,h=0;h<e.outputs.length;h++)if(d==e.outputs[h].identifier){k=h;break}void 0!=f&&void 0!=k&&T.append_edge(a,b,c,[k,f])}function d(a,b,c){switch(b){case "GLOW":return a+c+"11";case "COLOR_ID":case "SHADOW":return a+c+"00";default:return a+c+"10"}}function q(a,b){T.traverse_edges(a,function(c,d,e){var g=T.get_node_attr(a,d);d==b&&"Color"==g.inputs[e[1]].identifier&&T.remove_edge_by_attr(a,c,d,e)})}function k(){var a=T.create(),b={data:null,dirs:[],params:[],inputs:[{default_value:new Float32Array([0,
0,0]),identifier:"Color",is_linked:!1,name:"Color"},{default_value:1,identifier:"Alpha",is_linked:!1,name:"Alpha"}],outputs:[],type:"OUTPUT",vparams:[]};T.append_node(a,0,b);return a}function p(a){T.traverse(a,function(b,c){for(var d=c.inputs,e=c.outputs,g=0;g<d.length;g++)f(a,d[g],b,g,1);for(g=0;g<e.length;g++)f(a,e[g],b,g,0)})}function f(a,b,c,d,e){if(b.is_linked){var g=!0;T.traverse_edges(a,function(a,b,f){if(!e&&a==c&&f[0]==d||e&&b==c&&f[1]==d)g=!1});g&&(b.is_linked=!1)}}function w(a,b,c){var d=
[];T.traverse_edges(a,function(e,g,f){var h=T.get_node_attr(a,e),k=T.get_node_attr(a,g),h=U.is_vector(h.outputs[f[0]].default_value),k=U.is_vector(k.inputs[f[1]].default_value);if(h!=k){var l,n={default_value:[0,0,0],identifier:"Vector",is_linked:!0,name:"Vector"},m={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};h&&!k?l=M("vector_to_scalar","B4W_VECTOSCAL",[n],[m]):!h&&k&&(l=M("scalar_to_vector","B4W_SCALTOVEC",[m],[n]));D(a,l,0,b,c);d.push([e,g,a.nodes[a.nodes.length-2],f])}});for(var e=
0;e<d.length;++e)T.remove_edge_by_attr(a,d[e][0],d[e][1],d[e][3]),T.append_edge(a,d[e][0],d[e][2],[d[e][3][0],0]),T.append_edge(a,d[e][2],d[e][1],[0,d[e][3][1]])}function g(a){var b=[];T.traverse(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":T.traverse_edges(a,function(a,e,g){a==c&&"Translucency"==d.outputs[g[0]].name&&b.push(a,e,[g[0]+1,g[1]+1])})}});for(var c=0;c<b.length;c+=3)T.append_edge(a,b[c],b[c+1],b[c+2])}function m(a,b){var c=[];T.traverse(b,function(b,d){d.name==a.name&&c.push(b)});
if(c.length)return c;throw"Node not found";}function l(a){var b=[];T.traverse(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var g=t(a,d,1);if(-1!=g){var f=T.get_in_edge(a,g,0);T.remove_edge(a,g,d,-1);-1!=f&&T.remove_edge(a,f,g,-1);d=T.get_node_attr(a,g);e.data=d.data;e.params[0]=d.params[0];T.remove_node(a,g)}e.inputs.splice(1,1)}else if("REROUTE"==e.type){for(var e=T.get_in_edge(a,d,0),h=T.out_edge_count(a,
d),g=[],f=[],k=[],l=0;l<h;l++){var n=T.get_out_edge(a,d,l),m=f.indexOf(n);-1!=m?k[m]+=1:(f.push(n),k.push(1),g.push(d,n))}if(-1!=e)for(h=T.get_edge_attr(a,e,d,0)[0],l=0;l<f.length;l++)for(n=0;n<k[l];n++)m=T.get_edge_attr(a,d,f[l],n)[1],T.append_edge(a,e,f[l],[h,m]);for(l=0;l<g.length;l+=2)T.remove_edge(a,g[l],g[l+1],-1)}}}function t(a,b,c){a=a.edges;for(var d=0;d<a.length;d+=3)if(a[d+1]==b&&a[d+2][1]==c)return a[d];return-1}function F(a){C(a);y(a);H(a)}function H(a,b){var c=[],d="",e="",g={};T.traverse(a,
function(a,b){if("GEOMETRY_UV"==b.type||"UVMAP"==b.type||"TEX_COORD_UV"==b.type){c.push(a,b);var f=b.data.value;d?d==f||e||(e=f,g[e]=0):(d=f,g[d]=0);g[f]++}});for(var f in g)if(2>g[f]){for(var h=0;h<c.length;h+=2)c[h+1].data.value==f&&c.splice(h,2);delete g[f];d==f&&(d=e,e="");e==f&&(e="")}if(!(3>c.length)){var h={default_value:[0,0,0],identifier:"UV_geom",is_linked:!1,name:"UV_geom"},k={default_value:[0,0,0],identifier:"UV_cycles",is_linked:!1,name:"UV_cycles"};f=M("merged_uv","UV_MERGED",[],[h,
k]);f.uv_layer=d;D(a,f,0,"",b);var l=a.nodes[a.nodes.length-2];f=a.nodes[a.nodes.length-1];if(e){k=M("merged_uv","UV_MERGED",[],[h,k]);k.uv_layer=e;D(a,k,0,"",b);var n=a.nodes[a.nodes.length-2],k=a.nodes[a.nodes.length-1]}else k=null;for(var m=-1,p=null,h=0;h<c.length;h+=2){var q=c[h],t=c[h+1];E(t,c[1])?(m=l,p=f):k&&(m=n,p=k);for(var v=[],B=T.out_edge_count(a,q),w={},r=0;r<B;r++){var R=T.get_out_edge(a,q,r);R in w||(w[R]=0);var x=T.get_edge_attr(a,q,R,w[R]++);v.push(q,R,x);x=x.splice(0,x.length);
switch(t.type){case "GEOMETRY_UV":x[0]=0;p.outputs[0].is_linked=!0;break;case "UVMAP":case "TEX_COORD_UV":x[0]=1,p.outputs[1].is_linked=!0}T.append_edge(a,m,R,x)}for(var r=0;r<v.length;r+=3)T.remove_edge(a,v[r],v[r+1],0);T.remove_node(a,q)}}}function C(a){var b=[];T.traverse(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type&&"GEOMETRY_LO"!=c.type&&"GEOMETRY_OR"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=
b[d],g=b[d+1],f=!0,h=0;h<c.length;h++){var k=c[h];if(z(g,k.attr)){f=[];h=T.out_edge_count(a,e);for(m=0;m<h;m++){var l=T.get_out_edge(a,e,m),n=T.get_edge_attr(a,e,l,0);f.push(e,l,n);T.append_edge(a,k.id,l,n)}for(var m=0;m<f.length;m+=3)T.remove_edge(a,f[m],f[m+1],0);T.remove_node(a,e);f=!1;break}}f&&(k={id:e,attr:g},c.push(k))}}function x(a){for(var b={},c=0;c<a.nodes.length;c+=2)b[a.nodes[c]]=[];for(c=0;c<a.edges.length;c+=3){var d=a.edges[c],e=a.edges[c+1];a:for(var g=b[e],f=d,h=0;h<=g.length;h++){if(h>=
g.length||g[h]>f)g.splice(h,0,f);else if(g[h]!=f)continue;break a}for(var e=b[e],d=b[d],f=g=0,h=e.length+d.length,k=[],l=0;l<h;l++)g>e.length||e[g]>d[f]?k.push(d[f++]):k.push(e[g++])}return b}function y(a){var b=[];T.traverse(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=x(a),d=[],e=0;e<b.length;e+=2){for(var g=b[e],f=b[e+1],h=!0,k=0;k<d.length;k++){var l=d[k];if(!(3<=l.merged_nodes.length||!z(f,l.attr)||-1<c[g].indexOf(l.id)||-1<c[l.id].indexOf(g))){for(var n=
!1,m=0;m<l.merged_nodes.length;m++){var p=l.merged_nodes[m].id;if(-1<c[g].indexOf(p)||-1<c[p].indexOf(g)){n=!0;break}}if(!n){for(var k=[],p=T.in_edge_count(a,g),q={},m=0;m<p;m++)n=T.get_in_edge(a,g,m),n in q||(q[n]=0),h=T.get_edge_attr(a,n,g,q[n]++),k.push(n,g,h);for(var p=[],q=T.out_edge_count(a,g),t={},m=0;m<q;m++)n=T.get_out_edge(a,g,m),n in t||(t[n]=0),h=T.get_edge_attr(a,g,n,t[n]++),p.push(g,n,h);h=k.concat(p);for(m=0;m<h.length;m+=3)T.remove_edge(a,h[m],h[m+1],0);T.remove_node(a,g);m={id:g,
attr:f,edges_in:k,edges_out:p};l.merged_nodes.push(m);h=!1;break}}}h&&(l={id:g,attr:f,merged_nodes:[]},d.push(l))}for(e=0;e<d.length;e++){l=d[e];c=l.merged_nodes.length;for(k=0;k<c;k++){f=l.merged_nodes[k];m=f.attr;g=f.edges_in;f=f.edges_out;l.attr.inputs[k+1].is_linked=m.inputs[0].is_linked;l.attr.inputs[k+1].default_value=m.inputs[0].default_value;l.attr.outputs[2*(k+1)].is_linked=m.outputs[0].is_linked;l.attr.outputs[2*(k+1)].default_value=m.outputs[0].default_value;l.attr.outputs[2*(k+1)+1].is_linked=
m.outputs[1].is_linked;l.attr.outputs[2*(k+1)+1].default_value=m.outputs[1].default_value;for(m=0;m<g.length;m+=3)n=g[m],h=g[m+2],h[1]+=k+1,T.append_edge(a,n,l.id,h);for(m=0;m<f.length;m+=3)n=f[m+1],h=f[m+2],h[0]+=2*(k+1),T.append_edge(a,l.id,n,h);l.attr.dirs.push(["USE_uv"+(k+2),1])}T.remove_node(a,l.id);T.append_node(a,l.id,l.attr)}}}function z(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":case "GEOMETRY_LO":case "GEOMETRY_OR":return!0;
case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value.uuid==b.data.value.uuid;default:return!1}}function E(a,b){var c=["GEOMETRY_UV","TEX_COORD_UV","UVMAP"];return-1!=c.indexOf(a.type)&&-1!=c.indexOf(b.type)?a.data.value==b.data.value:!1}function e(a){var b=[];T.traverse(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],g=!1,f=[],h=[],k=[[],[],[]],l=T.out_edge_count(a,d),n=0;n<l;n++){var m=T.get_out_edge(a,d,n);if("SEPRGB"!=T.get_node_attr(a,
m).type){g=!1;break}f.push(d,m);for(var p={},q=T.out_edge_count(a,m),g=0;g<q;g++){var t=T.get_out_edge(a,m,g);t in p||(p[t]=0);var v=T.get_edge_attr(a,m,t,p[t]++);f.push(m,t);k[v[0]].push(d,t,v)}h.push(m);g=!0}if(g){for(n=d=l=0;n<k.length;n++)k[n].length&&(l++,d|=1<<2-n);if(l){e.type+=l;e.outputs=[];for(n=0;n<k.length;n++)if(k[n].length)for(e.outputs.push({default_value:0,identifier:"RGB"[n],is_linked:!0,name:"RGB"[n]}),g=0;g<k[n].length;g+=3)k[n][g+2][0]=U.rgb_mask_get_channel_presence_index(d,n);
for(n=0;n<f.length;n+=2)T.remove_edge(a,f[n],f[n+1],0);for(n=0;n<h.length;n++)T.remove_node(a,h[n]);for(n=0;n<k.length;n++)for(g=0;g<k[n].length;g+=3)T.append_edge(a,k[n][g],k[n][g+1],k[n][g+2])}}}}function n(a,b,c,d,e,g){a=a.nodes;for(var f=null,h=0;h<a.length;h++){var k=a[h];e?"GROUP"==k.type&&k.node_tree_name==c&&(f=k):k.type==c&&(f=k)}return f?m(f,b)[0]:(g||Z.error('No "'+c+'" node in node '+d),-1)}function M(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function D(a,b,c,d,e){var g=b.name,
f=b.type,h=[],k=[],l=[],n=[],m=null,p=[];switch(f){case "BSDF_ANISOTROPIC":case "BSDF_DIFFUSE":case "BSDF_GLOSSY":case "BSDF_GLASS":case "BSDF_HAIR":case "BSDF_TRANSPARENT":case "BSDF_TRANSLUCENT":case "BSDF_REFRACTION":case "BSDF_TOON":case "BSDF_VELVET":case "SUBSURFACE_SCATTERING":case "EMISSION":case "AMBIENT_OCCLUSION":case "VOLUME_ABSORPTION":case "VOLUME_SCATTER":case "BUMP":case "NORMAL_MAP":case "BLACKBODY":case "WAVELENGTH":case "SEPXYZ":case "COMBXYZ":case "LIGHT_FALLOFF":case "TEX_IMAGE":case "TEX_ENVIRONMENT":case "TEX_SKY":case "TEX_NOISE":case "TEX_WAVE":case "TEX_MUSGRAVE":case "TEX_GRADIENT":case "TEX_MAGIC":case "TEX_CHECKER":case "TEX_BRICK":case "WIREFRAME":case "LAYER_WEIGHT":case "TANGENT":case "LIGHT_PATH":case "ATTRIBUTE":case "HOLDOUT":case "HAIR_INFO":case "OBJECT_INFO":case "SCRIPT":case "NEW_GEOMETRY":k=
ba(b);l=ca(b);Z.warn(f+" node is not fully supported.");break;case "BRIGHTCONTRAST":case "ADD_SHADER":case "MIX_SHADER":k=ba(b);l=ca(b);break;case "UVMAP":var q=b.uv_layer;q||(f="EMPTY_UV");if("EMPTY_UV"!=f){var m=P("param_"+f+"_a"),t=P("param_"+f+"_v");h.push(ga(m));h.push(ga(t));n.push(ga(t));m={name:m,value:q}}l=ca(b);break;case "UV_MERGED":m=P("param_UV_MERGED_a");t=P("param_UV_MERGED_v");h.push(ga(m));h.push(ga(t));l.push(J(b,"UV_geom"));l.push(J(b,"UV_cycles"));n.push(ga(t));m={name:m,value:b.uv_layer};
break;case "CAMERA":k=[];l=ca(b);break;case "COMBRGB":case "COMBHSV":k=ba(b);l=ca(b);break;case "CURVE_RGB":case "CURVE_VEC":"CURVE_RGB"==f?(ha(b,0,0,1)&&p.push(["READ_R",1]),ha(b,1,0,1)&&p.push(["READ_G",1]),ha(b,2,0,1)&&p.push(["READ_B",1]),ha(b,3,0,1)&&p.push(["READ_A",1])):(ha(b,0,-1,1)&&p.push(["READ_R",1]),ha(b,1,-1,1)&&p.push(["READ_G",1]),ha(b,2,-1,1)&&p.push(["READ_B",1]));k=ba(b);l=ca(b);m={value:b};break;case "PARTICLE_INFO":k=ba(b);l=ca(b);for(t=0;t<b.outputs.length;t++){var v=b.outputs[t],
w=v.identifier,r=ga("v_param_PART_INFO_"+w.replace(" ",""));if(v.is_linked)switch(w){case "Size":p.push(["PART_INFO_SIZE",qa.glsl_value(1)]);break;case "Age":p.push(["PART_INFO_AGE",qa.glsl_value(1)]);break;case "Lifetime":p.push(["PART_INFO_LT",qa.glsl_value(1)]);break;case "Location":p.push(["PART_INFO_LOC",qa.glsl_value(1)]);break;case "Index":m=q=ga("a_param_PART_INFO_"+v.identifier.replace(" ",""));p.push(["PART_INFO_IND",qa.glsl_value(1)]);break;case "Velocity":p.push(["PART_INFO_VEL",qa.glsl_value(1)]);
break;case "Angular Velocity":p.push(["PART_INFO_A_VEL",qa.glsl_value(1)])}"Age"!=w&&"Lifetime"!=w&&"Size"!=w&&(h.push(r),n.push(r))}q&&h.push(q);break;case "GEOMETRY":if(!S(b))return!0;f=I(b,c);if(!f)return Z.error("Geometry output is not supported"),null;switch(f){case "GEOMETRY_UV":(q=b.uv_layer)||(f="EMPTY_UV");"EMPTY_UV"!=f&&(m=P("param_GEOMETRY_UV_a"),t=P("param_GEOMETRY_UV_v"),h.push(ga(m)),h.push(ga(t)),n.push(ga(t)),m={name:m,value:q});l.push(J(b,"UV"));break;case "GEOMETRY_VC":(q=b.color_layer)||
(f="EMPTY_VC");"EMPTY_VC"!=f&&(m=P("param_GEOMETRY_VC_a"),t=P("param_GEOMETRY_VC_v"),h.push(ga(m)),h.push(ga(t)),n.push(ga(t)),m={name:m,value:q});l.push(J(b,"Vertex Color"));break;case "GEOMETRY_NO":l.push(J(b,"Normal"));break;case "GEOMETRY_FB":l.push(J(b,"Front/Back"));break;case "GEOMETRY_VW":l.push(J(b,"View"));break;case "GEOMETRY_GL":l.push(J(b,"Global"));break;case "GEOMETRY_LO":l.push(J(b,"Local"));break;case "GEOMETRY_OR":q=P("param_GEOMETRY_OR_v"),h.push(ga(q)),l.push(J(b,"Orco")),n.push(ga(q))}break;
case "TEX_COORD":if(!S(b))return!0;f=K(b,c);if(!f)return Z.error("Texture coordinate output is not supported"),null;switch(f){case "TEX_COORD_UV":(q=b.uv_layer)||(f="EMPTY_UV");"EMPTY_UV"!=f&&(m=P("param_TEX_COORD_UV_a"),t=P("param_TEX_COORD_UV_v"),h.push(ga(m)),h.push(ga(t)),n.push(ga(t)),m={name:m,value:b.uv_layer});l.push(J(b,"UV"));break;case "TEX_COORD_NO":l.push(J(b,"Normal"));break;case "TEX_COORD_GE":q=P("param_TEX_COORD_GE_v");h.push(ga(q));l.push(J(b,"Generated"));n.push(ga(q));break;case "TEX_COORD_OB":l.push(J(b,
"Object"));Z.warn('Output "Object" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_CA":l.push(J(b,"Camera"));break;case "TEX_COORD_WI":l.push(J(b,"Window"));Z.warn('Output "Window" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_RE":l.push(J(b,"Reflection")),Z.warn('Output "Reflection" of node "Texture Coordinate" doesn\'t supported fully.')}break;case "GROUP":q=b.node_tree_name;switch(q){case "B4W_LINEAR_TO_SRGB":if(!G(b,[1],[1])){m=Q(b,
d,e);break}f="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!G(b,[1],[1])){m=Q(b,d,e);break}f="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!G(b,[1],[1])){m=Q(b,d,e);break}f="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!G(b,[1,1],[1])){m=Q(b,d,e);break}f="B4W_REFLECT";break;case "B4W_REFRACTION":if(!G(b,[1,0],[1])){m=Q(b,d,e);break}f="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!G(b,[1,1,0,0,0],[1])){m=Q(b,d,e);break}f="B4W_PARALLAX";t=P("temp_texture");n.push(ga(t));
break;case "B4W_CLAMP":if(!G(b,[1],[1])){m=Q(b,d,e);break}f="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!G(b,[0,0,0,0,0],[0])){m=Q(b,d,e);break}f="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!G(b,[],[0])){m=Q(b,d,e);break}f="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!G(b,[0,0,0],[0])){m=Q(b,d,e);break}f="B4W_SMOOTHSTEP";break;case "B4W_GLOW_OUTPUT":f="B4W_GLOW_OUTPUT";break;default:m=Q(b,d,e)}k=ba(b);l=ca(b);"B4W_TRANSLUCENCY"==q&&(q=O("TranslucencyParams","TranslucencyParams",[0,0,0,0]),q.is_linked=
l[0].is_linked,l.push(q));break;case "LAMP":m=b.lamp;if(!m)return Z.error("There is no lamp in node: "+b.name),null;l.push(J(b,"Color"));l.push(J(b,"Light Vector"));l.push(J(b,"Distance"));l.push(J(b,"Visibility Factor"));m.uuid in wa?p.push(["LAMP_INDEX",String(wa[m.uuid])]):(wa[m.uuid]=xa,p.push(["LAMP_INDEX",String(xa++)]));m=wa;break;case "LIGHTING_AMBIENT":k=[O("E","E",[0,0,0],!0),O("A","A",[0,0,0],!0),O("D","D",[0,0,0],!0)];l=[O("color","color",[0,0,0],!0),O("specular","specular",[0,0,0],!0)];
break;case "LIGHTING_BEGIN":l=[O("E","E",[0,0,0],!0),O("A","A",[0,0,0],!0),O("D","D",[0,0,0],!0),O("S","S",[0,0,0],!0),O("normal","normal",[0,0,0],!0),O("dif_params","dif_params",[0,0],!0),O("sp_params","sp_params",[0,0],!0),O("shadow_factor","shadow_factor",0,!0),O("translucency_color","translucency_color",0,!0),O("translucency_params","translucency_params",[0,0,0,0],!0)];break;case "LIGHTING_END":k=[O("color","color",[0,0,0],!0),O("specular","specular",[0,0,0],!0)];break;case "LIGHTING_LAMP":k=
[O("shadow_factor","shadow_factor",0,!0)];l=[O("ldir","ldir",[0,0,0],!0),O("lfac","lfac",[0,0],!0),O("lcolorint","lcolorint",[0,0,0],!0),O("norm_fac","norm_fac",0,!0)];break;case "DIFFUSE_LAMBERT":k=[O("ldir","ldir",[0,0,0],!0),O("lfac","lfac",[0,0],!0),O("normal","normal",[0,0,0],!0),O("norm_fac","norm_fac",0,!0)];l=[O("lfactor","lfactor",0,!0)];break;case "DIFFUSE_FRESNEL":case "DIFFUSE_MINNAERT":case "DIFFUSE_OREN_NAYAR":case "DIFFUSE_TOON":k=[O("ldir","ldir",[0,0,0],!0),O("lfac","lfac",[0,0],
!0),O("normal","normal",[0,0,0],!0),O("norm_fac","norm_fac",0,!0),O("dif_params","dif_params",[0,0],!0)];l=[O("lfactor","lfactor",0,!0)];break;case "SPECULAR_BLINN":case "SPECULAR_PHONG":k=[O("ldir","ldir",[0,0,0],!0),O("lfac","lfac",[0,0],!0),O("normal","normal",[0,0,0],!0),O("norm_fac","norm_fac",0,!0),O("sp_params","sp_params",[0,0],!0)];l=[O("sfactor","sfactor",0,!0)];break;case "SPECULAR_TOON":case "SPECULAR_WARDISO":k=[O("ldir","ldir",[0,0,0],!0),O("lfac","lfac",[0,0],!0),O("normal","normal",
[0,0,0],!0),O("sp_params","sp_params",[0,0],!0)];l=[O("sfactor","sfactor",0,!0)];break;case "LIGHTING_APPLY":k=[O("color","color",[0,0,0,0],!0),O("specular","specular",[0,0,0],!0),O("lfactor","lfactor",0,!0),O("sfactor","sfactor",0,!0),O("ldir","ldir",[0,0,0],!0),O("normal","normal",[0,0,0],!0),O("translucency_params","translucency_params",[0,0,0,0],!0),O("D","D",[0,0,0],!0),O("S","S",[0,0,0],!0),O("lcolorint","lcolorint",[0,0,0],!0),O("translucency_color","translucency_color",0,!0)];l=[O("color",
"color",[0,0,0,0],!0),O("specular","specular",[0,0,0],!0)];break;case "NORMAL":k=ba(b);l=ca(b);q=J(b,"Normal");n.push(ga(P("param_NORMAL_Normal"),q.default_value,3));break;case "MAPPING":q=b.vector_type;f="MAPPING";k.push(N(b,"Vector"));l.push(J(b,"Vector"));var t=b.rotation,v=b.scale,w=b.translation,r=Ha.create(),x=U.euler_to_rotation_matrix(t);"TEXTURE"==q&&(v[0]=v[0]||1,v[1]=v[1]||1,v[2]=v[2]||1);var A=new Float32Array([v[0],0,0,0,v[1],0,0,0,v[2]]);Ha.multiply(x,A,r);r=U.mat3_to_mat4(r,R.create());
switch(q){case "POINT":r[12]=w[0];r[13]=w[1];r[14]=w[2];break;case "TEXTURE":r[12]=w[0];r[13]=w[1];r[14]=w[2];r=R.invert(r,r);break;case "NORMAL":R.invert(r,r),R.transpose(r,r)}switch(q){case "NORMAL":p.push(["MAPPING_IS_NORMAL",1]);case "TEXTURE":p.push(["MAPPING_TRS_MATRIX",qa.glsl_value(r,16)]);break;case "POINT":0!==oa.length(t)?p.push(["MAPPING_TRS_MATRIX",qa.glsl_value(r,16)]):(0!==oa.length(v)&&p.push(["MAPPING_SCALE",qa.glsl_value(v,3)]),0!==oa.length(w)&&p.push(["MAPPING_TRANSLATION",qa.glsl_value(w,
3)]));break;case "VECTOR":0!==oa.length(t)?p.push(["MAPPING_TRS_MATRIX",qa.glsl_value(r,16)]):0!==oa.length(v)&&p.push(["MAPPING_SCALE",qa.glsl_value(v,3)])}b.use_min&&p.push(["MAPPING_MIN_CLIP",qa.glsl_value(b.min,3)]);b.use_max&&p.push(["MAPPING_MAX_CLIP",qa.glsl_value(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":m=[];q=[];t=[];v=[O("E","E",[0,0,0],!0),O("A","A",[0,0,0],!0),O("D","D",[0,0,0],!0),O("S","S",[0,0,0],!0),O("normal","normal",[0,0,0],!0),O("dif_params","dif_params",[0,0],!0),
O("sp_params","sp_params",[0,0],!0),O("shadow_factor","shadow_factor",0,!0)];w=[O("color","color",[0,0,0],!0),O("specular","specular",[0,0,0],!0),O("normal","normal",[0,0,0],!0)];r=[J(b,"Color"),J(b,"Alpha"),J(b,"Normal")];x=[];A=N(b,"Color");A.default_value.splice(3);t.push(A);k.push(A);A=N(b,"Spec");A.default_value.splice(3);t.push(A);k.push(A);t.push(O("DiffuseIntensity","DiffuseIntensity",b.diffuse_intensity));k.push(A);var F=N(b,"Normal");F.default_value.splice(3);t.push(F);k.push(F);"MATERIAL_EXT"==
f?((A=N(b,"Emit"))||(A=O("Emit","Emit",0)),t.push(A),k.push(A),(A=N(b,"Translucency"))?(A.default_value=0,A.name="Translucency",A.identifier="Translucency"):A=O("Translucency","Translucency",0),k.push(A),(A=N(b,"Translucency"))?(A.default_value=[0,0,0,0],A.name="TranslucencyParams",A.identifier="TranslucencyParams"):A=O("TranslucencyParams","TranslucencyParams",[0,0,0,0]),k.push(A),l=N(b,"Reflectivity"),A=N(b,"Ray Mirror"),l?(A=l,l="Reflectivity"):A?l="Ray Mirror":(A=l,l="Reflectivity"),A||(A=O(l,
l,0)),k.push(A),w.push(A),(A=N(b,"SpecTra"))||(A=O("SpecTra","SpecTra",0)),k.push(A),w.push(A),(A=N(b,"Alpha"))||(A=O("Alpha","Alpha",b.alpha)),k.push(A),w.push(A),r.push(J(b,"Diffuse")),r.push(J(b,"Spec")),m.push(["MATERIAL_EXT",1]),q.push(["MATERIAL_EXT",1])):(t.push(O("emit_intensity","emit_intensity",0)),w.push(O("reflect_factor","reflect_factor",0)),w.push(O("specular_alpha","specular_alpha",0)),w.push(O("alpha_in","alpha_in",0)),r.push(O("diffuse_out","diffuse_out",0)),r.push(O("spec_out","spec_out",
0)),m.push(["MATERIAL_EXT",0]),q.push(["MATERIAL_EXT",0]));x.push(ga(P("param_MATERIAL_alpha"),b.alpha));x.push(ga(P("param_MATERIAL_spec_alpha"),b.specular_alpha));l=r;F.is_linked&&m.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&(m.push(["USE_MATERIAL_DIFFUSE",1]),q.push(["USE_MATERIAL_DIFFUSE",1]));b.use_specular&&q.push(["USE_MATERIAL_SPECULAR",1]);var A=[],u=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":F=b.specular_hardness;break;case "WARDISO":F=b.specular_slope;break;case "TOON":F=
b.specular_toon_size;u=b.specular_toon_smooth;break;case "BLINN":F=b.specular_ior;u=b.specular_hardness;break;default:Z.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.material_name+'")'),F=b.specular_hardness}var C,y;switch(b.diffuse_shader){case "LAMBERT":y=C=0;break;case "OREN_NAYAR":C=b.roughness;y=0;break;case "FRESNEL":C=b.diffuse_fresnel;y=b.diffuse_fresnel_factor;break;case "MINNAERT":C=b.darkness;y=0;break;case "TOON":C=b.diffuse_toon_size;y=b.diffuse_toon_smooth;
break;default:Z.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),y=C=0}A.push(ga(P("param_MATERIAL_diffuse"),[C,y],2));A.push(ga(P("param_MATERIAL_spec"),[b.specular_intensity,F,u],3));m.push(["SHADELESS_MAT",b.use_shadeless?1:0]);F={name:b.name,value:{specular_shader:b.specular_shader,diffuse_shader:b.diffuse_shader,use_shadeless:b.use_shadeless}};m={name:b.name,value:{specular_shader:b.specular_shader,diffuse_shader:b.diffuse_shader,use_shadeless:b.use_shadeless},
material_begin:{name:"material_begin",type:"MATERIAL_BEGIN",inputs:t,outputs:v,params:A,data:F,dirs:m,vparams:[]},material_end:{name:"material_end",type:"MATERIAL_END",inputs:w,outputs:r,params:x,data:F,dirs:q,vparams:[]}};break;case "MATH":switch(b.operation){case "ADD":f="MATH_ADD";break;case "SUBTRACT":f="MATH_SUBTRACT";break;case "MULTIPLY":f="MATH_MULTIPLY";break;case "DIVIDE":f="MATH_DIVIDE";break;case "SINE":f="MATH_SINE";break;case "COSINE":f="MATH_COSINE";break;case "TANGENT":f="MATH_TANGENT";
break;case "ARCSINE":f="MATH_ARCSINE";break;case "ARCCOSINE":f="MATH_ARCCOSINE";break;case "ARCTANGENT":f="MATH_ARCTANGENT";break;case "POWER":f="MATH_POWER";break;case "LOGARITHM":f="MATH_LOGARITHM";break;case "MINIMUM":f="MATH_MINIMUM";break;case "MAXIMUM":f="MATH_MAXIMUM";break;case "ROUND":f="MATH_ROUND";break;case "LESS_THAN":f="MATH_LESS_THAN";break;case "GREATER_THAN":f="MATH_GREATER_THAN";break;case "MODULO":f="MATH_MODULO";break;case "ABSOLUTE":f="MATH_ABSOLUTE";break;default:return Z.error("Unsupported MATH operation: "+
b.operation),null}p.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);k=ba(b);l=ca(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":f="MIX_RGB_MIX";break;case "ADD":f="MIX_RGB_ADD";break;case "MULTIPLY":f="MIX_RGB_MULTIPLY";break;case "SUBTRACT":f="MIX_RGB_SUBTRACT";break;case "SCREEN":f="MIX_RGB_SCREEN";break;case "DIVIDE":f="MIX_RGB_DIVIDE";break;case "DIFFERENCE":f="MIX_RGB_DIFFERENCE";break;case "DARKEN":f="MIX_RGB_DARKEN";break;case "LIGHTEN":f="MIX_RGB_LIGHTEN";break;case "OVERLAY":f="MIX_RGB_OVERLAY";
break;case "DODGE":f="MIX_RGB_DODGE";break;case "BURN":f="MIX_RGB_BURN";break;case "HUE":f="MIX_RGB_HUE";break;case "SATURATION":f="MIX_RGB_SATURATION";break;case "VALUE":f="MIX_RGB_VALUE";break;case "COLOR":f="MIX_RGB_COLOR";break;case "SOFT_LIGHT":f="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":f="MIX_RGB_LINEAR_LIGHT";break;default:return Z.error("Unsupported MIX_RGB blend type: "+b.blend_type),null}p.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);k=ba(b);l=ca(b);break;case "OUTPUT":k=ba(b);
l=[];break;case "RGB":q=d+"%join%"+b.name;q={name:"-1",value:q};n.push(q);l.push(J(b,"Color"));break;case "SEPRGB":case "SEPHSV":k=ba(b);l=ca(b);break;case "TEXTURE":f=B(b);if("TEXTURE_EMPTY"==f)l.push(J(b,"Color")),l.push(J(b,"Normal")),l.push(J(b,"Value"));else if("TEXTURE_ENVIRONMENT"==f)k.push(N(b,"Vector")),l.push(J(b,"Color")),l.push(J(b,"Value"));else{if("TEXTURE_NORMAL"==f&&"ENVIRONMENT_MAP"==b.texture.type)return Z.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),null;for(m=0;4>
m;++m)m?(A=O("Vector"+m,"Vector"+m,[0,0,0]),"TEXTURE_COLOR"==f&&(t=O("Color"+m,"Color"+m,[0,0,0]),v=O("Value"+m,"Value"+m,0)),"TEXTURE_NORMAL"==f&&(t=O("Normal"+m,"Normal"+m,[0,0,0]),v=O("Value"+m,"Value"+m,0))):(A=N(b,"Vector"),"TEXTURE_COLOR"==f&&(t=J(b,"Color"),v=J(b,"Value")),"TEXTURE_NORMAL"==f&&(t=J(b,"Normal"),v=J(b,"Value"))),k.push(A),l.push(t),l.push(v)}t=P("param_TEXTURE_texture");n.push(ga(t));m={name:t,value:b.texture};break;case "VALTORGB":k=ba(b);l=ca(b);m={value:b};q=b.color_ramp.interpolation;
"CONSTANT"!=q&&"LINEAR"!=q&&Z.warn("Color Ramp node is not fully supported.");break;case "VALUE":f="VALUE";q=d+"%join%"+b.name;q={name:"-1",value:q};n.push(q);l.push(J(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":f="VECT_MATH_ADD";break;case "SUBTRACT":f="VECT_MATH_SUBTRACT";break;case "AVERAGE":f="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":f="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":f="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":f="VECT_MATH_NORMALIZE";break;default:return Z.error("Unsupported VECT_MATH operation: "+
b.operation),null}k=ba(b);l=ca(b);break;case "VECT_TRANSFORM":switch(b.vector_type){case "POINT":p.push(["VECTOR_TYPE",qa.glsl_value(0)]);break;case "VECTOR":p.push(["VECTOR_TYPE",qa.glsl_value(1)]);break;case "NORMAL":p.push(["VECTOR_TYPE",qa.glsl_value(2)]);break;default:return Z.error("Unsupported VECT_TRANSFORM vector_type: "+b.vector_type),null}k=b.convert_from;l=b.convert_to;if("WORLD"==k)if("WORLD"==l)k=0;else if("OBJECT"==l)k=1;else if("CAMERA"==l)k=2;else return Z.error("Unsupported VECT_TRANSFORM convert_to: "+
b.convert_to),null;else if("OBJECT"==k)if("WORLD"==l)k=3;else if("OBJECT"==l)k=4;else if("CAMERA"==l)k=5;else return Z.error("Unsupported VECT_TRANSFORM convert_to: "+b.convert_to),null;else if("CAMERA"==k)if("WORLD"==l)k=6;else if("OBJECT"==l)k=7;else if("CAMERA"==l)k=8;else return Z.error("Unsupported VECT_TRANSFORM convert_to: "+b.convert_to),null;else return Z.error("Unsupported VECT_TRANSFORM convert_from: "+b.convert_from),null;p.push(["CONVERT_TYPE",qa.glsl_value(k)]);k=ba(b);l=ca(b);break;
default:k=ba(b),l=ca(b)}f={name:g,type:f,vparams:h,inputs:k,outputs:l,params:n,data:m,dirs:p};g=T.gen_node_id(a);T.append_node(a,T.gen_node_id(a),f);if(f="GEOMETRY"==b.type||"TEX_COORD"==b.type)a:{f=b.outputs;for(n=h=0;n<f.length;n++)if(f[n].is_linked&&h++>c){f=!0;break a}f=!1}return f&&null==D(a,b,++c,d,e)?null:g}function G(a,b,c){for(var d=a.inputs,e=a.outputs,g=a.node_tree_name,f=0;f<b.length;f++){var h=d[f],k=b[f];if(!h||h.default_value instanceof Array!=k)return Z.warn('Wrong inputs for custom node group "'+
a.name+'" of type: "',g,'".Processing as general node group.'),!1}for(f=0;f<c.length;f++)if(b=e[f],d=c[f],!b||b.default_value instanceof Array!=d)return Z.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',g,'".Processing as general node group.'),!1;return!0}function Q(a,b,c){var d=a.node_group.node_tree,e={},g;for(g in d)if("links"==g||"nodes"==g){e[g]=[];for(var f=0;f<d[g].length;f++){e[g][f]={};for(var h in d[g][f])if("links"==g){e[g][f][h]={};for(var k in d[g][f][h])e[g][f][h][k]=
v(d[g][f][h][k])}else e[g][f][h]=v(d[g][f][h])}}else e[g]=v(d[g]);d=a.node_tree_name;if("B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==d)g=M("Group input","GROUP_INPUT",[],a.inputs),f=M("Group output","GROUP_OUTPUT",a.outputs,[]),h=null,h="B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==d&&(Ea.quality==sa.P_LOW||Ea.force_low_quality_nodes)?{from_node:g,from_socket:g.outputs[1],to_node:f,to_socket:f.inputs[0]}:{from_node:g,from_socket:g.outputs[0],to_node:f,to_socket:f.inputs[0]},e.nodes=[g,f],e.links=[h];d=
a.name;g=e.nodes;f=e.links;for(h=0;h<g.length;h++)g[h].name=ia(g[h].type,d,g[h].name);for(h=0;h<f.length;h++)f[h].from_node.name=ia(f[h].from_node.type,d,f[h].from_node.name),f[h].to_node.name=ia(f[h].to_node.type,d,f[h].to_node.name);return{node_group_graph:u(e,a.node_group.uuid,!0,b,c),node_group_links:e.links}}function v(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?U.clone_object_nr(a):a}function P(a){L[a]||(L[a]=0);var b=a+"_"+L[a],b=b.replace(/ /g,"_").replace(/\//g,"_");
L[a]++;return b}function S(a){a=a.outputs;for(var b=0;b<a.length;b++)if(a[b].is_linked)return!0;return!1}function I(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var g=c[e];if(g.is_linked&&!(d++<b))switch(g.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";case "Local":return"GEOMETRY_LO";case "Orco":return"GEOMETRY_OR";default:return null}}}
function K(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var g=c[e];if(g.is_linked&&!(d++<b))switch(g.identifier){case "Camera":return"TEX_COORD_CA";case "Generated":return"TEX_COORD_GE";case "Normal":return"TEX_COORD_NO";case "Object":return"TEX_COORD_OB";case "Reflection":return"TEX_COORD_RE";case "UV":return"TEX_COORD_UV";case "Window":return"TEX_COORD_WI";default:return null}}}function B(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,e=!1,g=0;g<b.length;g++){var f=b[g];
if(f.is_linked)switch(f.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":e=!0;break;default:throw"Unknown texture output";}}if(c)return d&&Z.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(e)return"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function N(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==
b)return X(e)}return null}function J(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return X(e)}return null}function X(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=U.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,is_linked:d,default_value:a}}function O(a,b,c,d){return{name:a,identifier:b,is_linked:d||!1,default_value:c}}function ba(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=X(a.inputs[c]);d.default_value.length&&d.default_value.splice(3);
b.push(d)}return b}function ca(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=X(a.outputs[c]);b.push(d)}return b}function ga(a,b,c){b=null===b||void 0===b?null:qa.glsl_value(b,c);return{name:a,value:b}}function aa(a,b,c,d,e,g){var f=[],h=g.from_socket.identifier;g=g.to_socket.identifier;var k=d.outputs;for(d=0;d<k.length;d++)if(k[d].identifier==h){f.push(d);break}e=e.inputs;for(d=0;d<e.length;d++)if(e[d].identifier==g){f.push(d);break}2==f.length&&T.append_edge(a,b,c,f);return!0}function ia(a,
b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function da(a){var b=[];T.traverse(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function ta(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.node_group_graph,g=c[d].data.node_group_links;if(!e)return!1;T.traverse(e,function(b,c){T.append_node(a,T.gen_node_id(a),c)});for(e=0;e<g.length;e++)b.push(g[e]);la(c[d],b,a)}return!0}function fa(a,b,c,d,e,g){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+
"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||g.push(c)}}function ka(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var g=c[e],f=null,h=0;h<b.length;h++)if(g.from_socket.identifier==b[h].to_socket.identifier){f=b[h];break}f?(g.from_node=f.from_node,g.from_socket=f.from_socket):d.push(g)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function W(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function A(a,b,c,
d){for(var e=0;e<d.length;e++){for(var g=d[e],f,h=0;h<c.inputs.length;h++)if(g.from_socket.identifier==c.inputs[h].identifier){f=c.inputs[h].default_value;break}for(var h=g,k=b,l=f,n=m(h.to_node,k),p=0;p<n.length;p++)for(var q=T.get_node_attr(k,n[p]),t=0;t<q.inputs.length;t++){var v=q.inputs[t];if(v.identifier==h.to_socket.identifier){q=v.default_value instanceof Object?0:1;if((l instanceof Object?0:1)==q)v.default_value=l;else switch(q){case 0:v=v.default_value;v[0]=v[1]=v[2]=l;break;case 1:v.default_value=
(l[0]+l[1]+l[2])/3}break}}g=a.indexOf(g);-1!=g&&a.splice(g,1)}}function la(a,b,c){for(var d=a.name,e=[],g=[],f=[],h=[],k=0;k<b.length;k++){var l=b[k];fa(l.from_node,d,l,e,f,h);fa(l.to_node,d,l,g,f,h)}g=ka(b,g,f);e=ka(b,h,e);W(b,g);A(b,c,a,g);if(e.length){var n;T.traverse(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(n=b)});A(b,c,n,e)}}function ja(a){var b=[],c=[];T.traverse(a,function(a,d){switch(d.type){case "VALTORGB":b.push(d);break;case "CURVE_VEC":case "CURVE_RGB":c.push(d)}});
var d=0,e=a=null,g=b.length+c.length;if(b.length){a=pa.create_color_ramp_texture(b,pa.COLORRAMP_TEXT_SIZE);for(var f=0;f<b.length;f++)b[f].dirs.push(["NODE_TEX_ROW",qa.glsl_value((d+.5)/g)]),d++}if(c.length)for(e=pa.create_vec_curve_texture(c,pa.CURVE_NODES_TEXT_SIZE),f=0;f<c.length;f++)c[f].dirs.push(["NODE_TEX_ROW",qa.glsl_value((d+.5)/g)]),d++;f=null;a&&e?(f=new Uint8Array(a.length+e.length),f.set(a),f.set(e,a.length)):f=a?a:e;a=f?pa.generate_batch_texure(f,pa.CURVE_NODES_TEXT_SIZE):null;for(f=
0;f<b.length;f++)b[f].data.texture=a;for(f=0;f<c.length;f++)c[f].data.texture=a}function ha(a,b,c,d){a=a.curve_mapping.curves_data[b];return 2==a.length&&a[0][0]<c+.01&&a[0][1]<c+.01&&a[1][0]>d-.01&&a[1][1]>d-.01?!1:!0}var sa=r("__config");r("__debug");var T=r("__graph"),Ha=r("__mat3"),R=r("__mat4"),V=r("__objects"),Z=r("__print"),qa=r("__shaders"),Aa=r("__scenes"),U=r("__util"),oa=r("__vec3"),pa=r("__textures"),L={},ma={},Y={},wa={},xa=0;new Float32Array(4);var Ea=sa.defaults;a.VT_WORLD_TO_WORLD=
0;a.VT_WORLD_TO_OBJECT=1;a.VT_WORLD_TO_CAMERA=2;a.VT_OBJECT_TO_WORLD=3;a.VT_OBJECT_TO_OBJECT=4;a.VT_OBJECT_TO_CAMERA=5;a.VT_CAMERA_TO_WORLD=6;a.VT_CAMERA_TO_OBJECT=7;a.VT_CAMERA_TO_CAMERA=8;a.compose_nmat_graph=u;a.create_lighting_graph=function(a,c,e){var g=Aa.get_active();a=d(a,"MAIN",g.uuid);if(a in Y)return Y[a];var g=T.create(),f={name:"LIGHTING_BEGIN",type:"LIGHTING_BEGIN"},h=D(g,f,0,c,null),f={name:"LIGHTING_END",type:"LIGHTING_END"},f=D(g,f,0,c,null);b(g,e,h,f,[[h,[8,10]],[h,[9,6]]],c);p(g);
return Y[a]=g};a.compose_node_elements=function(a){var b=[],c={};L={};var d=T.topsort(a);T.traverse(d,function(a,d){var e;e=[];for(var g=[],f=[],h=[],k=[],l=[],n=0;n<d.inputs.length;n++){var m=d.inputs[n];if(m.is_linked)e.push(null),g.push(null);else{e.push(P("in_"+d.type+"_"+m.identifier));var p=qa.glsl_value(m.default_value,0);Ea.shader_constants_hack&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==m.identifier||"Color2"==m.identifier||"Fac"==m.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==m.identifier||
"Value_001"==m.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==m.identifier||0<=d.type.indexOf("LIGHTING_APPLY")||0<=d.type.indexOf("MATERIAL_END")||0<=d.type.indexOf("MATERIAL_BEGIN"))&&(m=p,m=m.replace(/(,)/g,"$1 "),m=m.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),m=m.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),p=m=m.replace(/\s+/g,""));g.push(p)}}for(n=0;n<d.outputs.length;n++)m=d.outputs[n],m.is_linked?f.push(null):f.push(P("out_"+d.type+
"_"+m.identifier));for(n=0;n<d.params.length;n++)m=d.params[n],h.push(m.name),k.push(m.value);for(n=0;n<d.vparams.length;n++)l.push(d.vparams[n].name);e={id:d.type,inputs:e,input_values:g,outputs:f,params:h,param_values:k,vparams:l,dirs:JSON.parse(JSON.stringify(d.dirs))};b.push(e);c[a]=e});T.traverse_edges(d,function(a,b,e){var g=T.get_node_attr(d,a);T.get_node_attr(d,b);var f=g.outputs[e[0]];a=c[a].outputs;b=c[b].inputs;g=a[e[0]]||P("out_"+g.type+"_"+f.identifier);a[e[0]]=g;b[e[1]]=g});return b};
a.check_material_glow_output=function(a){if(a.node_tree)for(var b=0;b<a.node_tree.nodes.length;b++){var c=a.node_tree.nodes[b];if("GROUP"==c.type&&"B4W_GLOW_OUTPUT"==c.node_tree_name)return!0}return!1};a.cleanup=function(){for(var a in ma)delete ma[a];for(a in Y)delete Y[a];for(var b in wa)delete wa[b];xa=0}};b4w.module.__animation=function(a,r){function u(a,b){var c=a.anim_slots[b];c&&c.finish_callback&&c.exec_finish_callback&&(c.exec_finish_callback=!1,c.finish_callback(a,b))}function c(a,b,c){c=a.anim_slots[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.current_frame_float=d;c.animation_name=b.name;for(e=d=0;e<a.vertex_anim.length;e++){var g=a.vertex_anim[e];if(g==b)break;else d+=g.frame_end-g.frame_start+1}c.va_frame_offset=d}function b(a,b,c){b.type=50;b.animation_name=
c.name;b.start=c.frame_start;b.length=c.frame_end-b.start;c.cyclic||(b.length+=c.lifetime_frames)}function h(a){return a.replace(/_B4W_BAKED$/,"")}function d(a,b){if(a.animation_data){var c=a.animation_data.action;c&&c._render.type==V&&b.push(c)}for(var c=a.nodes,e=0;e<c.length;e++){var g=c[e];g.node_group&&(g=g.node_group.node_tree)&&d(g,b)}}function q(a){return J.is_mesh(a)&&a.render.vertex_anim?!0:!1}function k(a,b,c){var d=a.anim_slots;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.current_frame_float=
b,f(a,0,c,!0))}else if(e=d[c])e.current_frame_float=b,f(a,0,c,!0)}function p(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function f(a,b,c,d){H(a,b,c,d);u(a,c);a.render.anim_mixing&&(y(a,b),x(a,b))}function w(a,b,c){var d=b.frame_range;if(d[0]>d[1])return ba.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;var e=b._render,f=a.anim_slots[c];f.animation_name=b.name;f.action_frame_range=d;f.action_step=e.pierce_step;f.action_bflags=e.bflags;
f.channels_mask.set(e.channels_mask);f.start=d[0];f.length=d[1]-d[0];f.current_frame_float=d[0];switch(e.type){case T:if(J.is_armature(a)){f.type=10;var h=g(a,b);if(!h){for(var h=a.render.bone_pointers,d=[],k=[],n=b._render.num_pierced,p=0;p<n;p++){for(var q in h){var v=h[q],w=v.tsr_basis,B=b._render.bones[q];B?ta.copy(B.subarray(8*p,8*p+8),w):ta.identity(w);v.tsr_channel_cache_valid=!1}v=z(h);d.push(v.trans);k.push(v.quats)}h={trans:d,quats:k};a.action_anim_cache.push(b,h)}f.trans=h.trans;f.quats=
h.quats;f=h;h=a.render;q=h.skinned_renders;k=a.anim_slots[c];d=k.skinning_data;a:{n=h.skinning_data_cache;for(p=0;p<n.length;p+=2)if(b==n[p]){n=n[p+1];break a}n=null}if(n)k.skinning_data=n;else{for(k=0;k<q.length;k++){for(var n=q[k].bone_skinning_info,p=[],v=[],w=f.trans,B=f.quats,r=0;r<w.length;r++){var x=E(w[r],B[r],n);p.push(x.trans);v.push(x.quats)}d.push({trans:p,quats:v})}h.skinning_data_cache.push(b,d)}h.anim_mixing&&(b=h.two_last_skeletal_slots,c>b[1]?(f=b[1],b[1]=c,b[0]=f):c>b[0]&&c<b[1]&&
(b[0]=c),m(a))}break;case Ha:J.is_speaker(a)&&(f.volume=e.params.volume||null,f.pitch=e.params.pitch||null,f.type=40);break;case Z:J.is_lamp(a)&&(f.color=e.params.color||null,f.energy=e.params.energy||null,f.type=70);break;case V:if("MESH"==a.type){f.type=60;q=g(a,b);if(!q){q=[];d=[];k=[];n=[];p=[];v=b._render;for(h in v.params)for(w=b.name+"%join%"+h,B=0;B<a.scenes_data.length;B++)for(r=a.scenes_data[B].batches,x=0;x<r.length;x++){var A=r[x],D=A.node_anim_inds,F=A.node_rgb_anim_inds;D&&(D=t(h,w,
v,d,q,D),F=t(h,w,v,n,k,F),(D||F)&&p.push(A))}q={val_inds:q,values:d,rgb_inds:k,rgbs:n,node_batches:p};a.action_anim_cache.push(b,q)}f.node_value_inds=q.val_inds;f.nodemat_values=q.values;f.node_rgb_inds=q.rgb_inds;f.nodemat_rgbs=q.rgbs;f.node_batches=q.node_batches}break;case R:if(h=e.params.tsr){f.type=20;q=g(a,b);if(!q){q=b._render.num_pierced;d=[];k=[];for(n=0;n<q;n++)d.push(h.subarray(8*n,8*n+4)),k.push(h.subarray(8*n+4,8*n+8));q={trans:d,quats:k};a.action_anim_cache.push(b,q)}f.trans=q.trans;
f.quats=q.quats;X.obj_has_particles(a)&&X.update_start_pos(a,f.trans[0],f.quats[0])}else return ba.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;break;case qa:J.is_world(a)&&(f.energy=e.params["light_settings.environment_energy"]||null,f.horizon_color=e.params.horizon_color||null,f.zenith_color=e.params.zenith_color||null,f.fog_intensity=e.params["mist_settings.intensity"]||null,f.fog_depth=e.params["mist_settings.depth"]||null,f.fog_start=e.params["mist_settings.start"]||
null,f.fog_height=e.params["mist_settings.height"]||null,f.fog_color=e.params.b4w_fog_color||null,f.type=80)}J.is_armature(a)&&e.type!=T&&l(a,c);return!0}function g(a,b){for(var c=a.action_anim_cache,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function m(a){var b=a.render.two_last_skeletal_slots;if(-1!=b[0]&&-1!=b[1]){var c=a.anim_slots;a=c[b[1]].current_frame_float;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.current_frame_float;d=Math.floor(a);b.current_frame_float=d+e}}function l(a,b){var c=
a.render.two_last_skeletal_slots,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.anim_slots;0<=d;d--){var g=e[d];if(g&&10==g.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function t(a,b,c,d,e,g){for(var f=!1,h=0;h<g.length;h+=2)b==g[h]&&(e.push(g[h+1]),d.push(new Float32Array(c.params[a])),f=!0);return f}function F(a){a=a._render;for(var b in a.params)if(-1!=b.indexOf("nodes"))return!0;return!1}function H(a,b,c,d){if((c=a.anim_slots[c])&&null!=c.type&&(c.play||d)){var e=a.render,g=c.current_frame_float,
f=c.start,h=c.length,g=g+c.speed*b*ia.get_framerate(),k=c.type,l=c.speed;if(0<=l&&g>=f+h||0>l&&g<f)switch(d||(c.exec_finish_callback=!0),c.behavior){case 10:g=0<=l?(g-f)%h+f:f+h-1E-6;break;case 20:g=0<=l?f:f+h-1E-6;c.play=!1;break;case 30:g=0<=l?f+h-1E-6:f,c.play=!1}c.current_frame_float=g;switch(k){case 10:if(!e.anim_mixing){d=C(c);b=d[0];var n=d[1];d=d[2];e.quats_before=c.quats[b];e.quats_after=c.quats[n];e.trans_before=c.trans[b];e.trans_after=c.trans[n];e.frame_factor=d;d=e.skinned_renders;c=
c.skinning_data;for(var m=0;m<d.length;m++){var p=d[m],q=c[m];p.quats_before=q.quats[b];p.quats_after=q.quats[n];p.trans_before=q.trans[b];p.trans_after=q.trans[n];p.frame_factor=e.frame_factor}da.update_transform(a)}break;case 20:d=C(c);var e=U,n=d[0],m=d[1],p=d[2],q=c.trans,t=q[n][1],g=q[n][2],f=q[m][1],h=q[m][2];e[0]=(1-p)*q[n][0]+p*q[m][0];e[1]=(1-p)*t+p*f;e[2]=(1-p)*g+p*h;n=pa;g=d[0];m=d[1];p=d[2];q=c.quats;t=L;t[0]=q[g][0];t[1]=q[g][1];t[2]=q[g][2];t[3]=q[g][3];g=ma;g[0]=q[m][0];g[1]=q[m][1];
g[2]=q[m][2];g[3]=q[m][3];ca.slerp(t,g,p,n);m=d[2];p=c.trans;d=(1-m)*p[d[0]][3]+m*p[d[1]][3];a.parent&&a.pinverse_tsr&&(m=Y,ta.set_sep(e,d,n,m),ta.multiply(a.pinverse_tsr,m,m),ta.get_trans_value(m,e),ta.get_quat_value(m,n),d=ta.get_scale(m));c.trans_smooth_period&&(m=oa,da.get_translation(a,m),fa.smooth_v(e,m,b,c.trans_smooth_period,e));c.quat_smooth_period&&(m=L,da.get_rotation(a,m),fa.smooth_q(n,m,b,c.quat_smooth_period,n));g=c.channels_mask;g[0]&&da.set_translation_rel(a,e);g[1]&&da.set_rotation_rel(a,
n);g[2]&&da.set_scale_rel(a,d);da.update_transform(a);O.sync_transform(a);break;case 30:d=c.current_frame_float-c.start;0>d&&(d=0);d>=c.length&&(d=c.length);a=Math.floor(d);b=a+1;d-=a;10!=c.behavior&&b==c.length&&(b=--a,d=1);c=c.va_frame_offset;Aa[0]=a+c;Aa[1]=b+c;Aa[2]=d;d=Aa;e.va_frame=d[0];e.va_frame_factor=d[2];break;case 40:d=C(c);b=d[0];e=d[1];d=d[2];c.volume&&aa.set_volume(a,(1-d)*c.volume[b]+d*c.volume[e]);c.pitch&&aa.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[e]);break;case 50:b=10==c.behavior?
(g-f)/ia.get_framerate():g/ia.get_framerate();X.set_time(a,c.animation_name,b);break;case 60:d=C(c);b=d[0];e=d[1];d=d[2];q=c.nodemat_values;t=c.node_value_inds;a=c.nodemat_rgbs;n=c.node_rgb_inds;m=c.node_batches;for(c=0;c<t.length;c++)for(g=q[c],p=t[c],f=(1-d)*g[b]+d*g[e],g=0;g<m.length;g++)m[g].node_values[p]=f;for(c=0;c<n.length;c++)for(t=a[c],p=n[c],q=t.subarray(3*b,3*b+3),t=t.subarray(3*e,3*e+3),q=ka.lerp(q,t,d,U),g=0;g<m.length;g++)m[g].node_rgbs[3*p]=q[0],m[g].node_rgbs[3*p+1]=q[1],m[g].node_rgbs[3*
p+2]=q[2];break;case 70:d=C(c);b=d[0];e=d[1];d=d[2];g=c.channels_mask;(h=c.energy)&&g[0]&&A.set_light_energy(a.light,(1-d)*h[b]+d*h[e]);(c=c.color)&&g[1]&&(U[0]=(1-d)*c[3*b]+d*c[3*e],U[1]=(1-d)*c[3*b+1]+d*c[3*e+1],U[2]=(1-d)*c[3*b+2]+d*c[3*e+2],A.set_light_color(a.light,U));f=a.scenes_data;for(c=0;c<f.length;c++)la.update_lamp_scene_color_intensity(a,f[c].scene);break;case 80:d=C(c);b=d[0];e=d[1];d=d[2];g=c.channels_mask;f=a.scenes_data;l=la.get_subs(f[0].scene,"MAIN_OPAQUE");h=c.energy;h=g[0]?(1-
d)*h[b]+d*h[e]:l.energy;k=c.horizon_color;g[1]?(U[0]=(1-d)*k[3*b]+d*k[3*e],U[1]=(1-d)*k[3*b+1]+d*k[3*e+1],U[2]=(1-d)*k[3*b+2]+d*k[3*e+2],k=U):k=l.horizon_color;var v=c.zenith_color;g[2]?(oa[0]=(1-d)*v[3*b]+d*v[3*e],oa[1]=(1-d)*v[3*b+1]+d*v[3*e+1],oa[2]=(1-d)*v[3*b+2]+d*v[3*e+2],l=oa):l=l.zenith_color;v=c.fog_intensity;g[3]&&(n=(1-d)*v[b]+d*v[e]);v=c.fog_depth;g[4]&&(m=(1-d)*v[b]+d*v[e]);v=c.fog_start;g[5]&&(p=(1-d)*v[b]+d*v[e]);v=c.fog_height;g[6]&&(q=(1-d)*v[b]+d*v[e]);c=c.fog_color;g[7]&&(pa[0]=
(1-d)*c[3*b]+d*c[3*e],pa[1]=(1-d)*c[3*b+1]+d*c[3*e+1],pa[2]=(1-d)*c[3*b+2]+d*c[3*e+2],t=pa);for(c=0;c<f.length;c++)b=a.scenes_data[c].scene,(g[0]||g[1]||g[2])&&la.set_environment_colors(b,h,k,l),g[3]&&la.set_fog_intensity(b,n),g[4]&&la.set_fog_depth(b,m),g[5]&&la.set_fog_start(b,p),g[6]&&la.set_fog_height(b,q),g[7]&&la.set_fog_color_density(b,t);break;default:fa.panic("Unknown animation type:"+k)}}}function C(a){var b=a.action_frame_range[0],c=a.action_frame_range[1]-b,b=a.current_frame_float-b;0>
b&&(b=0);b>=c&&(b=c);b/=a.action_step;c=Math.floor(b);a=a.action_bflags[c]?b-c:0;b=Math.ceil(c+a);Aa[0]=c;Aa[1]=b;Aa[2]=a;return Aa}function x(a,b){var c=a.render,d=c.anim_mix_factor,e=c.two_last_skeletal_slots,g=e[0],e=e[1];if(-1!=e){if(-1!=g){var f=a.anim_slots[g];if(f.play||0==b){var h=C(f),k=h[0],l=h[1];c.frame_factor=h[2];var h=f.quats[k],n=f.quats[l],k=f.trans[k],l=f.trans[l]}else d=1}else d=1;e=a.anim_slots[e];if(e.play||0==b){var g=C(e),m=g[0],p=g[1];c.frame_factor=g[2]}else if(-1!=g&&f.play)d=
0;else return;g=e.quats[m];f=e.quats[p];m=e.trans[m];p=e.trans[p];if(1==d)c.quats_before.set(g),c.quats_after.set(f),c.trans_before.set(m),c.trans_after.set(p);else if(0==d)c.quats_before.set(h),c.quats_after.set(n),c.trans_before.set(k),c.trans_after.set(l);else{for(e=0;e<h.length;e+=4){for(var q=pa,t=L,v=0;4>v;v++)q[v]=h[e+v],t[v]=g[e+v];ca.slerp(q,t,d,q);for(v=0;4>v;v++)c.quats_before[e+v]=q[v];for(v=0;4>v;v++)q[v]=n[e+v],t[v]=f[e+v];ca.slerp(q,t,d,q);for(v=0;4>v;v++)c.quats_after[e+v]=q[v]}fa.blend_arrays(k,
m,d,c.trans_before);fa.blend_arrays(l,p,d,c.trans_after)}da.update_transform(a);W.update_skinned_renders(a)}}function y(a,b){var c=a.render,d=c.anim_mix_factor,e=c.anim_mix_factor_change_speed;if(0!=e){var d=c.anim_destination_mix_factor-d,g=e*b;fa.sign(d)==fa.sign(e)&&Math.abs(g)<Math.abs(d)?c.anim_mix_factor+=g:(c.anim_mix_factor=c.anim_destination_mix_factor,c.anim_mix_factor_change_speed=0)}}function z(a){var b=[],c=[],d=new Float32Array(4),e=new Float32Array(4),g;for(g in a){var f=a[g],h=d,k=
e,l=f.chain,n=l[l.length-1],m=n.tsr_channel_cache;n.tsr_channel_cache_valid||ta.identity(m);for(n=l.length-1;0<=n;n--){var p=l[n],q=p.tsr_channel_cache;if(p.tsr_channel_cache_valid)m=q;else{var t=p.tsr_local_rest,v=p.tsr_basis;ta.invert(t,Y);ta.multiply(v,Y,Y);ta.multiply(t,Y,Y);ta.multiply(m,Y,q);m=q;p.tsr_channel_cache_valid=!0}}l=p.tsr_channel_cache;h[0]=l[0];h[1]=l[1];h[2]=l[2];h[3]=l[3];k[0]=l[4];k[1]=l[5];k[2]=l[6];k[3]=l[7];ca.normalize(k,k);f=f.bone_index;for(h=0;4>h;h++)k=4*f+h,b[k]=d[h],
c[k]=e[h]}return{trans:b,quats:c}}function E(a,b,c){var d=[],e=[];new Float32Array(4);new Float32Array(4);for(var g in c)for(var f=c[g],h=f.bone_index,f=f.deform_bone_index,k=0;4>k;k++){var l=4*f+k,n=4*h+k;d[l]=a[n];e[l]=b[n]}d=new Float32Array(d);e=new Float32Array(e);return{trans:d,quats:e}}function e(a){var b=a._render;if(b.bones)b.type=T;else if(b.params)if("volume"in b.params||"pitch"in b.params)b.type=Ha;else if(F(a))b.type=V;else{var c;a:{if(a._render.params){c=a.fcurves;for(var d in c)if("color"==
d&&!c[d][3]){c=!0;break a}if("energy"==d){c=!0;break a}}c=!1}if(c)b.type=Z;else if(c=a._render.params,"light_settings.environment_energy"in c||"horizon_color"in c||"zenith_color"in c||"mist_settings.intensity"in c||"mist_settings.depth"in c||"mist_settings.start"in c||"mist_settings.height"in c||"b4w_fog_color"in c)b.type=qa;else{var e;a:{if(a._render.params)for(e in a=a.fcurves,a)if("location"==e||"rotation_quaternion"==e||"scale"==e){e=!0;break a}e=!1}b.type=e?R:sa}}else b.type=sa}function F(a){if(a=
a._render.params)for(var b in a)if(-1!=b.indexOf("nodes"))return!0;return!1}function n(a,b){b[0]=b[1]=b[2]=0;for(var c in a)"location"==c?b[0]=1:"rotation_quaternion"==c?b[1]=1:"scale"==c&&(b[2]=1)}function M(a,b){b[0]=b[1]=0;for(var c in a)"energy"==c?b[0]=1:"color"==c&&(b[1]=1)}function D(a,b){b[0]=b[1]=b[2]=0;b[3]=b[4]=b[5]=0;b[6]=b[7]=0;for(var c in a)"light_settings.environment_energy"==c?b[0]=1:"horizon_color"==c?b[1]=1:"zenith_color"==c?b[2]=1:"mist_settings.intensity"==c?b[3]=1:"mist_settings.depth"==
c?b[4]=1:"mist_settings.start"==c?b[5]=1:"mist_settings.height"==c?b[6]=1:"b4w_fog_color"==c&&(b[7]=1)}function G(a,b,c,d,e,g,f){var h=a+(b-a)/2,k=Q(h,d,e,g,f)-c;return.02>Math.abs(k)?h:0<k?G(a,h,c,d,e,g,f):G(h,b,c,d,e,g,f)}function Q(a,b,c,d,e){var g=1-a;return b*g*g*g+3*c*g*g*a+3*d*g*a*a+e*a*a*a}function v(a,b){var c={type:null,animation_name:null,action_frame_range:null,action_step:0,action_bflags:null,channels_mask:new Int8Array(8),quats:null,trans:null,skinning_data:[],play:!1,behavior:20,current_frame_float:0,
start:0,length:0,trans_smooth_period:0,quat_smooth_period:0,exec_finish_callback:!1,va_frame_offset:null,speed:1,volume:null,pitch:null,color:null,energy:null,zenith_color:null,horizon_color:null,fog_intensity:null,fog_depth:null,fog_start:null,fog_height:null,fog_color:null,nodemat_values:[],node_value_inds:[],nodemat_rgbs:[],node_rgb_inds:[],node_batches:null};if(!a.anim_slots.length)for(var d=0;8>d;d++)a.anim_slots.push(null);a.anim_slots[b]=c;-1==wa.indexOf(a)&&wa.push(a)}function P(a,b){da.update_transform(a);
O.sync_transform(a);f(a,0,b,!0)}function S(a,d,e){e=e||0;if(J.is_mesh(a)){var g=I(a,d);if(g)return v(a,e),c(a,g,e),P(a,e),!0;if((g=K(a,d))&&"EMITTER"==g.p_type){v(a,e);d=g.name;for(var g=e,f=a.scenes_data,h=0;h<f.length;h++)for(var k=f[h].batches,l=0;l<k.length;l++){var n=k[l].particles_data;n&&n.name==d&&b(k[l],a.anim_slots[g],n)}P(a,e);return!0}}if(g=fa.keysearch("name",d,xa)||fa.keysearch("name",d+"_B4W_BAKED",xa)){v(a,e);if(w(a,g,e))return P(a,e),!0;a.anim_slots[e]=null}ba.error('Unsupported object: "'+
a.name+'" or animation name: "'+d+'"');return!1}function I(a,b){for(var c=0;c<a.vertex_anim.length;c++){var d=a.vertex_anim[c];if(d.name===b)return d}return null}function K(a,b){for(var c=a.scenes_data,d=0;d<c.length;d++)for(var e=c[d].batches,g=0;g<e.length;g++){var f=e[g].particles_data;if(f&&f.name===b)return f}return null}function B(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}var N=r("__config"),J=r("__obj_util"),X=r("__particles"),
O=r("__physics"),ba=r("__print"),ca=r("__quat"),ga=r("__reformer"),aa=r("__sfx"),ia=r("__time"),da=r("__transform"),ta=r("__tsr"),fa=r("__util"),ka=r("__vec3"),W=r("__armature"),A=r("__lights"),la=r("__scenes"),ja=N.animation,ha=N.defaults;a.LAST_FRAME_EPSILON=1E-6;a.OBJ_ANIM_TYPE_NONE=0;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.OBJ_ANIM_TYPE_LIGHT=70;a.OBJ_ANIM_TYPE_ENVIRONMENT=
80;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var sa=a.AT_NONE=0,T=a.AT_ARMATURE=1,Ha=a.AT_SPEAKER=2,R=a.AT_OBJECT=3,V=a.AT_MATERIAL=4,Z=a.AT_LIGHT=5,qa=a.AT_ENVIRONMENT=6,Aa=Array(3),U=new Float32Array(3),oa=new Float32Array(3),pa=new Float32Array(4),L=new Float32Array(4),ma=new Float32Array(4),Y=ta.create();new Float32Array(16);var wa=[],xa=[];a.get_max_bones=function(){return fa.trunc((ha.max_vertex_uniform_vectors-
50)/4)};a.frame_to_sec=function(a){return a/ia.get_framerate()};a.update=function(a){for(var b=0;b<wa.length;b++){for(var c=wa[b],d=0;8>d;d++)H(c,a,d);c.render.anim_mixing&&(y(c,a),x(c,a))}for(b=0;b<wa.length;b++)for(c=wa[b],d=0;8>d&&c.anim_slots.length;d++)u(c,d)};a.get_all_actions=function(){return xa};a.get_anim_names=function(a){var b=[];if(q(a))for(var c=0;c<a.vertex_anim.length;c++)b.push(a.vertex_anim[c].name);for(var d=[],c=0;c<xa.length;c++){var e=xa[c],g=e._render;g.type==R?d.push(e):g.type==
T&&"ARMATURE"==a.type?d.push(e):g.type==Ha&&"SPEAKER"==a.type?d.push(e):g.type==qa&&"WORLD"==a.type&&d.push(e)}if("MESH"==a.type)for(c=0;c<a.actions.length;c++)e=a.actions[c],e._render.type==V&&d.push(e);for(c=0;c<d.length;c++)b.push(h(d[c].name));if(X.obj_has_particles(a)&&X.obj_has_anim_particles(a))for(a=a.scenes_data,c=0;c<a.length;c++)for(d=a[c].batches,e=0;e<d.length;e++)(g=d[e].particles_data)&&b.push(g.name);return b};a.strip_baked_suffix=h;a.get_anim_type=function(a,b){var c=a.anim_slots[b];
return c?c.type:0};a.apply_def=function(a){for(var d=0,e=a.scenes_data,g=0;g<e.length;g++)for(var f=e[g].batches,h=0;h<f.length;h++){var k=f[h].particles_data;k&&"EMITTER"==k.p_type&&!f[h].forked_batch&&(v(a,d),b(f[h],a.anim_slots[d],k),P(a,d),a.anim_slots[d].behavior=k.cyclic?10:a.anim_behavior_def,d++)}e=a.actions.slice();for(g=0;g<e.length;g++)f=e[g],v(a,d),w(a,f,d)?(P(a,d),a.anim_slots[d].behavior=a.anim_behavior_def,d++):a.anim_slots[d]=null;q(a)&&(v(a,d),c(a,a.vertex_anim[0],d),P(a,d),a.anim_slots[d].behavior=
a.anim_behavior_def)};a.anim_behavior_bpy_b4w=function(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:fa.panic("Wrong animation behavior")}};a.get_bpy_material_actions=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var e=a[c].node_tree;e&&d(e,b)}return b};a.play=function(a,b,c){p(a.anim_slots,c,function(a){a.play=!0;a.finish_callback=b?b:null;a.exec_finish_callback=!1});a.render.anim_mixing&&m(a)};a.stop=function(a,b){p(a.anim_slots,
b,function(a){a.play=!1;a.finish_callback=null;a.exec_finish_callback=!1})};a.is_play=function(a,b){var c=a.anim_slots;if(-1==b)for(var d=0;8>d;d++){if(c[d]&&c[d].play)return!0}else if(c=c[b])return c.play;return!1};a.set_frame=k;a.set_first_frame=function(a,b){b=b||0;p(a.anim_slots,b,function(c){k(a,c.start,b)})};a.get_current_frame_float=function(a,b){var c=a.anim_slots[b];return c&&c.current_frame_float?c.current_frame_float:0};a.is_cyclic=function(a,b){var c=a.anim_slots[b];return c&&10==c.behavior};
a.set_behavior=function(a,b,c){p(a.anim_slots,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.anim_slots[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){p(a.anim_slots,d,function(a){a.trans_smooth_period=b||0;a.quat_smooth_period=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.anim_slots[c]=null;else a.anim_slots[b]=null;a.render.anim_mixing&&l(a,b)};a.update_object_animation=f;a.obj_is_animatable=function(a){if("ARMATURE"==a.type||a.armobj||
"WORLD"==a.type)return!0;for(var b=0;b<a.actions.length;b++){var c=a.actions[b]._render.type;if(c==R||c==T||c==Ha&&"SPEAKER"==a.type||c==Z&&"LAMP"==a.type||c==V&&"MESH"==a.type)return!0}return X.obj_has_particles(a)&&X.obj_has_anim_particles(a)||"MESH"==a.type&&a.vertex_anim.length?!0:!1};a.bpy_obj_is_animatable=function(a,b){if("ARMATURE"==b.type||B(a)||"WORLD"==b.type)return!0;for(var c=0;c<b.actions.length;c++){var d=b.actions[c]._render.type;if(d==R||d==T||d==Ha&&"SPEAKER"==b.type||d==V&&"MESH"==
b.type)return!0}return X.bpy_obj_has_particles(a)&&X.bpy_obj_has_anim_particles(a)||"MESH"==b.type&&a.data.b4w_vertex_anim.length?!0:!1};a.is_animated=function(a){return Boolean(a.anim_slots.length)};a.calc_pose_data=z;a.extract_skinned_pose_data=E;a.append_action=function(a){var b=new RegExp(/pose.bones\[\".+\"\]/g),c=ta.create(),d=function(a,d,e,g,f){if(-1<e.search(b)){a=d;e=e.split('"')[1];var h=c}else 8==f?(e="tsr",h=c):h=1<f?new Float32Array(f):0;if(!a[e]){f=a;d=e;if("object"==typeof h&&h.length)for(var k=
h.length,l=new Float32Array(g*k),n=0;n<g;n++)for(var m=0;m<k;m++)l[n*k+m]=h[m];else if("number"==typeof h)for(l=new Float32Array(g),n=0;n<g;n++)l[n]=h;else fa.panic("Wrong storage default value");f[d]=l}return a[e]},g=function(a,b){if(-1<a.indexOf("location"))var c=0,d=b;else-1<a.indexOf("rotation_quaternion")?(c=4,d=0==b?3:b-1):-1<a.indexOf("scale")?(c=3,d=0):(c=0,d=b);return c+d},f=function(a,b){for(var c=0;c<b;c++){var d=a.subarray(8*c+4,8*c+8);ca.normalize(d,d)}},h=a._render={type:sa,num_pierced:0,
pierce_step:0,params:null,bones:null,bflags:null,channels_mask:new Int8Array(8)};h.pierce_step=1/ja.frame_steps;var k=a.fcurves,l={},m={},p=0,q;for(q in k){var t=k[q],v;for(v in t){var w=t[v],B=w._pierced_points;ga.check_anim_fcurve_completeness(w,a);w=w.num_channels;p||(p=B.length);for(var w=d(l,m,q,p,w),r=w.length/p,R=g(q,v|0),x=0;x<p;x++)w[x*r+R]=B[x]}}if(fa.get_dict_length(l)){for(var A in l)"tsr"==A&&f(l[A],p);h.params=l}if(fa.get_dict_length(m)){for(var F in m)f(m[F],p);h.bones=m}h.num_pierced=
p;h.bflags=a._bflags;"tsr"in l&&n(k,h.channels_mask);("color"in l||"energy"in l)&&M(k,h.channels_mask);("light_settings.environment_energy"in l||"horizon_color"in l||"zenith_color"in l||"mist_settings.intensity"in l||"mist_settings.depth"in l||"mist_settings.start"in l||"mist_settings.height"in l||"b4w_fog_color"in l)&&D(k,h.channels_mask);e(a);xa.push(a)};a.get_approx_curve_length=function(a,b){return(b-a)*ja.frame_steps+1};a.approximate_curve=function(a,b,c,d,e,g){var f=new Float32Array(2),h=new Float32Array(2),
k=new Float32Array(2),l=new Float32Array(2),n=b[1],m=b[2],p=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var q=0,t=0,v=null;e<=g;e++)if(e<n)for(var w=0;w<ja.frame_steps;w++)c[q++]=m;else if(e>p)for(w=0;w<ja.frame_steps;w++)c[q++]=a;else{var B=b[t],r=3;0===B&&(r+=2);0===v&&(r+=2);var R=2===B?0:1;if(b[t+1]==b[t+r+1])v=B,t+=r;else{w=0;e==b[t+1]&&(R&&(d[q]=1),c[q]=b[t+2],q++,w++);if(e==p)for(;w<ja.frame_steps;w++)c[q++]=a;else for(f[0]=b[t+1],f[1]=b[t+2],0!==B?(h[0]=0,h[1]=0):0===v?(h[0]=b[t+
5],h[1]=b[t+6]):(h[0]=b[t+3],h[1]=b[t+4]),0!==B?(k[0]=0,k[1]=0):(k[0]=b[t+r+3],k[1]=b[t+r+4]),l[0]=b[t+r+1],l[1]=b[t+r+2];w<ja.frame_steps;w++){var x=e+w/ja.frame_steps;switch(B){case 0:var A=f,D=h,F=k,u=l,C=[],N=[],y=void 0,J=void 0,Z=void 0,y=void 0;C[0]=A[0]-D[0];C[1]=A[1]-D[1];N[0]=u[0]-F[0];N[1]=u[1]-F[1];Z=u[0]-A[0];y=Math.abs(C[0]);J=Math.abs(N[0]);0!=y+J&&y+J>Z&&(y=Z/(y+J),D[0]=A[0]-y*C[0],D[1]=A[1]-y*C[1],F[0]=u[0]-y*N[0],F[1]=u[1]-y*N[1]);R&&(d[q]=1);A=q;D=f;F=h;u=k;C=l;x=G(0,1,x,D[0],F[0],
u[0],C[0]);x=Q(x,D[1],F[1],u[1],C[1]);c[A]=x;q++;break;case 1:R&&(d[q]=1);A=f[0];D=f[1];F=(l[1]-D)/(l[0]-A);c[q]=F*x+(D-F*A);q++;break;case 2:R&&(d[q]=1);c[q]=b[t+2];q++;break;default:fa.panic("Unknown keyframe interpolation mode: "+B)}}e+1==b[t+r+1]&&(v=B,t+=r)}}};a.apply=S;a.apply_by_uuid=function(a,b,c){c=c||0;var d=fa.keysearch("uuid",b,xa);if(d){v(a,c);if(w(a,d,c))return P(a,c),!0;a.anim_slots[c]=null}ba.error('Unsupported object: "'+a.name+'" or animation uuid: "'+b+'"');return!1};a.validate_action_by_name=
function(a,b){var c=fa.keysearch("name",b,xa)||fa.keysearch("name",b+"_B4W_BAKED",xa);if(c){if(c._render.type==sa)return!1}else if(!(K(a,b)||J.is_mesh(a)&&I(a,b)))return!1;return!0};a.get_slot_num_by_anim=function(a,b){for(var c=a.anim_slots,d=0;d<c.length;d++){var e=c[d];if(e&&h(e.animation_name)==h(b))return d}return-1};a.get_anim_by_slot_num=function(a,b){var c=a.anim_slots[b];return c&&c.animation_name?h(c.animation_name):null};a.remove=function(a){a.anim_slots.length=0;a=wa.indexOf(a);-1!=a&&
wa.splice(a,1)};a.remove_actions=function(a){for(var b=xa.length-1;0<=b;b--)xa[b]._data_id==a&&xa.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.anim_slots.length)return S(a,b,0)?0:-1;for(var c=0;c<a.anim_slots.length;c++)if(!a.anim_slots[c])return S(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.render.anim_mix_factor_change_speed=(b-a.render.anim_mix_factor)/c;a.render.anim_destination_mix_factor=b};a.set_speed=function(a,b,c){p(a.anim_slots,c,function(a){a.speed=b})};a.get_speed=
function(a,b){return a.anim_slots[b].speed};a.get_anim_start_frame=function(a,b){return a.anim_slots[b].start};a.get_anim_length=function(a,b){return a.anim_slots[b].length};a.cleanup=function(){wa.length=0;xa.length=0};a.fcurve_replace_euler_by_quat=function(a){var b=(a[0]||a[1]||a[2])._pierced_points.length,c=pa,d=U,e=Boolean(a[0]);e||(a[0]={_pierced_points:new Float32Array(b),num_channels:8});var g=Boolean(a[1]);g||(a[1]={_pierced_points:new Float32Array(b),num_channels:8});var f=Boolean(a[2]);
f||(a[2]={_pierced_points:new Float32Array(b),num_channels:8});a[3]={_pierced_points:new Float32Array(b),num_channels:8};for(var h=0;h<b;h++)d[0]=e?a[0]._pierced_points[h]:0,d[1]=g?a[1]._pierced_points[h]:0,d[2]=f?a[2]._pierced_points[h]:0,fa.euler_to_quat(d,c),a[0]._pierced_points[h]=c[3],a[1]._pierced_points[h]=c[0],a[2]._pierced_points[h]=c[1],a[3]._pierced_points[h]=c[2]};a.get_bpy_armobj=B};b4w.module.__time=function(a,r){function u(){return-1!==c.animation.framerate?c.animation.framerate:f}var c=r("__config");r("__print");var b=0,h=0,d=[],q=0,k=0,p=[],f=-1;a.set_timeline=function(a){b=a;h=performance.now();for(a=0;a<d.length;a++){var c=d[a];b>c.expire_time&&(d.splice(a,1),a--,c.callback())}for(a=0;a<p.length;a++){var c=p[a],f=1-(c.expire_time-b)/c.duration,f=Math.min(f,1);c.callback(c.from+f*(c.to-c.from));1==f&&(p.splice(a,1),a--)}};a.get_timeline=function(){return b};a.set_timeout=
function(a,c){var f;q++;f=q;var k={id:f,callback:a,expire_time:b+(performance.now()-h+c)/1E3};d.push(k);return f};a.clear_timeout=function(a){for(var b=0;b<d.length;b++)if(d[b].id==a){d.splice(b,1);break}};a.clear_animation=function(a){for(var b=p.length;b--;)if(p[b].id==a){p.splice(b,1);break}};a.animate=function(a,c,d,f){d/=1E3;var h;k++;h=k;p.push({id:h,callback:f,from:a,to:c,expire_time:b+d,duration:d});f(a);return h};a.reset=function(a){h=b=0;d.length=0;k=q=p.length=0};a.get_framerate=u;a.set_framerate=
function(a){f=a};a.get_frame=function(a){return a*u()}};b4w.module.__transform=function(a,r){function u(a,b){if(f.has_child_of(a)){var c=f.get_child_of_offset(a);t.set_trans(b,c)}else t.set_trans(b,a.render.world_tsr)}function c(a,b){var c=a.render;if(f.has_child_of(a)){t.set_quat(b,c.world_tsr);var d=f.get_child_of_parent_tsr(a),d=t.invert(d,e),g=f.get_child_of_offset(a);t.multiply(d,c.world_tsr,g)}else t.set_quat(b,c.world_tsr)}function b(a,b){if(f.has_child_of(a)){var c=f.get_child_of_offset(a);t.set_quat(b,c)}else t.set_quat(b,a.render.world_tsr)}
function h(a,b){if(f.has_child_of(a)){var c=f.get_child_of_offset(a);t.copy(b,c)}else t.copy(b,a.render.world_tsr)}function d(a,b){if(f.has_child_of(a)){var c=f.get_child_of_offset(a);t.copy(c,b)}else t.copy(a.render.world_tsr,b);return b}function q(a){var b=a.render,c=a.scenes_data,d=a.type;"CAMERA"==d&&p.update_camera_upside_down(a);f.update_constraint(a,M);"CAMERA"==d&&p.update_camera(a);var h=t.get_trans_value(b.world_tsr,z),n=t.get_quat_value(b.world_tsr,E);b.bb_local&&b.bb_world&&(k.bounding_box_transform(b.bb_local,
b.world_tsr,b.bb_world),k.bounding_sphere_transform(b.bs_local,b.world_tsr,b.bs_world),k.bounding_ellipsoid_transform(b.be_local,b.world_tsr,b.be_world));for(var r=0;r<a.scenes_data.length;r++)for(var x=a.scenes_data[r].batches,B=0;B<x.length;B++){var u=x[B];k.bounding_box_transform(u.bb_local,b.world_tsr,u.bb_world);k.bounding_ellipsoid_transform(u.be_local,b.world_tsr,u.be_world)}switch(d){case "SPEAKER":l.speaker_update_transform(a,M);break;case "CAMERA":for(r=0;r<c.length;r++)p.update_camera_transform(a,
c[r]);break;case "MESH":t.to_zup_model(a.render.world_tsr,a.render.world_zup_tsr);a.need_inv_zup_tsr&&t.invert(a.render.world_zup_tsr,a.render.world_inv_zup_tsr);if(x=a.armobj)t.invert(x.render.world_tsr,e),t.multiply(e,b.world_tsr,e),y.set(e[0],e[1],e[2],e[3],b.arm_rel_trans),g.set(e[4],e[5],e[6],e[7],b.arm_rel_quat);b.force_zsort=!0;break;case "LAMP":w.update_light_transform(a)}for(r=0;r<c.length;r++)if(B=c[r],B.is_active){x=B.scene;u=x._render;switch(d){case "LAMP":m.update_lamp_scene(a,x);break;
case "CAMERA":m.schedule_grass_map_update(x);if(u.shadow_params){u.shadow_params.enable_csm&&m.schedule_shadow_update(x);var J=H.get_scene_data(a,x).cameras[0];m.update_shadow_billboard_view(J,u.graph)}m.get_active()==x&&l.listener_update_transform(x,h,n,M);break;case "MESH":b.bb_local&&b.bb_world&&(b.shadow_cast&&m.schedule_shadow_update(x),u=B.cube_refl_subs,null!=b.cube_reflection_id&&u&&m.update_cube_reflect_subs(u,h));break;case "EMPTY":F.update_force(a)}u=B.plane_refl_subs;J=a.reflective_objs;
if(J.length)for(B=0;B<u.length;B++){var X=u[B].camera;m.update_plane_reflect_subs(u[B],h,n);H.update_refl_objects(J,X.reflection_plane);p.set_view(X,m.get_camera(x));C.extract_frustum_planes(X.view_proj_matrix,X.frustum_planes)}}b=a.cons_descends;for(r=0;r<b.length;r++)q(b[r]);a=a.cons_armat_bone_descends;for(r=0;r<a.length;r++)b=a[r],x=b[0],f.update_bone_constraint(x,b[1])}var k=r("__boundings"),p=r("__camera"),f=r("__constraints"),w=r("__lights"),g=r("__quat"),m=r("__scenes"),l=r("__sfx"),t=r("__tsr"),
F=r("__objects"),H=r("__obj_util"),C=r("__util"),x=r("__vec3"),y=r("__vec4"),z=new Float32Array(3),E=new Float32Array(4);new Float32Array(9);var e=t.create(),n=t.create(),M=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){M=a};a.set_translation=function(a,b){var c=a.render;if(f.has_child_of(a)){t.set_trans(b,c.world_tsr);var d=f.get_child_of_parent_tsr(a),d=t.invert(d,e),g=f.get_child_of_offset(a);t.multiply(d,c.world_tsr,g)}else t.set_trans(b,c.world_tsr)};a.set_translation_rel=u;a.get_translation=
function(a,b){var c=t.get_trans_view(a.render.world_tsr);x.copy(c,b);return b};a.get_translation_rel=function(a,b){if(f.has_child_of(a)){var c=f.get_child_of_offset(a);x.copy(t.get_trans_view(c),b)}else c=t.get_trans_view(a.render.world_tsr),x.copy(c,b);return b};a.set_rotation=c;a.set_rotation_rel=b;a.get_rotation=function(a,b){var c=t.get_quat_view(a.render.world_tsr);g.copy(c,b);return b};a.get_rotation_rel=function(a,b){if(f.has_child_of(a)){var c=f.get_child_of_offset(a);g.copy(t.get_quat_view(c),
b)}else c=t.get_quat_view(a.render.world_tsr),g.copy(c,b);return b};a.set_rotation_euler=function(a,b){var d=C.euler_to_quat(b,E);c(a,d)};a.set_rotation_euler_rel=function(a,c){var d=C.euler_to_quat(c,E);b(a,d)};a.set_scale=function(a,b){var c=a.render;if(f.has_child_of(a)){var c=f.get_child_of_offset(a),d=t.get_scale(f.get_child_of_parent_tsr(a));t.set_scale(b/d,c)}else t.set_scale(b,c.world_tsr)};a.set_scale_rel=function(a,b){var c=a.render;f.has_child_of(a)?(c=f.get_child_of_offset(a),t.set_scale(b,
c)):t.set_scale(b,c.world_tsr)};a.get_scale=function(a){return t.get_scale(a.render.world_tsr)};a.get_scale_rel=function(a){return f.has_child_of(a)?(a=f.get_child_of_offset(a),t.get_scale(a)):t.get_scale(a.render.world_tsr)};a.set_tsr=function(a,b){t.copy(b,a.render.world_tsr);if(f.has_child_of(a)){var c=f.get_child_of_parent_tsr(a),c=t.invert(c,e),d=f.get_child_of_offset(a);t.multiply(c,a.render.world_tsr,d)}};a.set_tsr_rel=h;a.get_tsr=function(a,b){return t.copy(a.render.world_tsr,b)};a.get_tsr_rel=
d;a.get_object_size=function(a){var b=a.render;a=b.bb_original;var c=t.get_scale(b.world_tsr),b=c*(a.max_x-a.min_x),d=c*(a.max_y-a.min_y);a=c*(a.max_z-a.min_z);return.5*Math.sqrt(b*b+d*d+a*a)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(a=a.render,x.copy(a.bs_world.center,c)):(a=a.render,b=a.bb_original,c[0]=(b.max_x+b.min_x)/2,c[1]=(b.max_y+b.min_y)/2,c[2]=(b.max_z+b.min_z)/2,t.transform_vec3(c,a.world_tsr,c));return c};a.move_local=function(a,b,c,g){var f=d(a,e),h=z;h[0]=b;
h[1]=c;h[2]=g;t.transform_vec3(h,f,h);u(a,h)};a.rotate_local=function(a,b){var c=d(a,e),g=t.set_quat(b,t.identity(n));t.multiply(c,g,g);h(a,g)};a.update_transform=q;a.distance=function(a,b){var c=t.get_trans_view(a.render.world_tsr),d=t.get_trans_view(b.render.world_tsr);return x.dist(c,d)};a.obj_point_distance=function(a,b){var c=t.get_trans_view(a.render.world_tsr);return x.dist(c,b)};a.get_object_bounding_box=function(a){return{max_x:a.render.bb_world.max_x,min_x:a.render.bb_world.min_x,max_y:a.render.bb_world.max_y,
min_y:a.render.bb_world.min_y,max_z:a.render.bb_world.max_z,min_z:a.render.bb_world.min_z}}};b4w.module.__tsr=function(a,r){function u(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a}function c(){var a=new Float32Array(9);a[3]=1;a[7]=1;return a}function b(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3];return d}function h(a,b,c){var d=b[0],g=b[1],f=b[2],h=b[3],k=b[4],e=b[5],l=b[6];b=b[7];var m=a[0]*h,p=a[1]*h,q=a[2]*h;a=b*m+e*q-l*p;var h=b*p+l*m-k*q,w=b*q+k*p-e*m,m=-k*m-e*p-l*q;c[0]=a*b+m*-k+h*-l-w*-e;c[1]=h*b+m*-e+w*-k-a*-l;c[2]=w*b+m*-l+a*-e-h*-k;
c[0]+=d;c[1]+=g;c[2]+=f;return c}var d=r("__mat4"),q=r("__quat"),k=r("__util"),p=r("__vec3"),f=Math.sin(-Math.PI/4),w=-f,g=new Float32Array(3),m=new Float32Array(4),l=new Float32Array(16);a.create=u;a.from_values=function(a,b,c,d,g,f,h,k){var e=u();e[0]=a;e[1]=b;e[2]=c;e[3]=d;e[4]=g;e[5]=f;e[6]=h;e[7]=k;return e};a.create_ext=c;a.from_values_ext=function(a,b,d,g,f,h,k,l){var e=c();e[0]=a;e[1]=b;e[2]=d;e[3]=g;e[4]=f;e[5]=h;e[6]=k;e[7]=l;return e};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];
b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];return b};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.set_sep=b;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set_scale=function(a,b){b[3]=a;return b};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set_quat=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3];return b};a.get_trans_view=function(a){return a.subarray(0,3)};a.get_trans_value=function(a,
b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.get_scale=function(a){return a[3]};a.get_quat_view=function(a){return a.subarray(4,8)};a.get_quat_value=function(a,b){b[0]=a[4];b[1]=a[5];b[2]=a[6];b[3]=a[7];return b};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],g=a[1],f=a[2];m[0]=a[4];m[1]=a[5];m[2]=a[6];m[3]=a[7];q.invert(m,m);var h=m[0],k=m[1],e=m[2],l=m[3],d=d*c,g=g*c,p=f*c,f=l*d+k*p-e*g,w=l*g+e*d-h*p,r=l*p+h*g-k*d,d=-h*d-k*g-e*p;b[0]=-(f*l+d*-h+w*-e-r*-k);b[1]=-(w*l+d*-k+r*-h-
f*-e);b[2]=-(r*l+d*-e+f*-k-w*-h);b[3]=c;b[4]=h;b[5]=k;b[6]=e;b[7]=l;return b};a.to_mat4=function(a,b){var c=a.subarray(0,3),g=a[3],f=a.subarray(4,8);d.fromRotationTranslation(f,c,b);for(c=0;12>c;c++)b[c]*=g;return b};a.from_mat4=function(a,c){var d=k.matrix_to_trans(a,g),f=k.matrix_to_scale(a),h=k.matrix_to_quat(a,m);b(d,f,h,c);return c};a.multiply=function(a,b,c){h(b,a,c);c[3]=a[3]*b[3];var d=a[4],g=a[5],f=a[6];a=a[7];var k=b[4],l=b[5],e=b[6];b=b[7];c[4]=d*b+a*k+g*e-f*l;c[5]=g*b+a*l+f*k-d*e;c[6]=
f*b+a*e+d*l-g*k;c[7]=a*b-d*k-g*l-f*e;return c};a.transform_mat4=function(a,b,c){var g=b.subarray(0,3),f=b[3];b=b.subarray(4,8);g=d.fromRotationTranslation(b,g,l);for(b=0;12>b;b++)g[b]*=f;d.multiply(g,a,c);return c};a.transform_vec3=h;a.transform_vec3_inv=function(a,b,c){var d=b[3],g=a[0]-b[0],f=a[1]-b[1],h=a[2]-b[2];a=b[4];var k=b[5],e=b[6];b=b[7];var l=a*a+k*k+e*e+b*b,l=l?1/l:0;a=-a*l;k=-k*l;e=-e*l;b*=l;var l=b*g+k*h-e*f,m=b*f+e*g-a*h,p=b*h+a*f-k*g,g=-a*g-k*f-e*h;c[0]=l*b+g*-a+m*-e-p*-k;c[1]=m*b+
g*-k+p*-a-l*-e;c[2]=p*b+g*-e+l*-k-m*-a;c[0]/=d;c[1]/=d;c[2]/=d;return c};a.transform_vectors=function(a,b,c,d){d||(d=0);var g=a.length,f=b[0],h=b[1],k=b[2],e=b[3],l=b[4],m=b[5],p=b[6];b=b[7];for(var q=0;q<g;q+=3){var w=a[q]*e,v=a[q+1]*e,r=a[q+2]*e,u=b*w+m*r-p*v,I=b*v+p*w-l*r,K=b*r+l*v-m*w,w=-l*w-m*v-p*r;c[d+q]=u*b+w*-l+I*-p-K*-m;c[d+q+1]=I*b+w*-m+K*-l-u*-p;c[d+q+2]=K*b+w*-p+u*-m-I*-l;c[d+q]+=f;c[d+q+1]+=h;c[d+q+2]+=k}return c};a.transform_dir_vectors=function(a,b,c,d){d||(d=0);var g=a.length,f=b[3],
h=b[4],k=b[5],e=b[6];b=b[7];for(var l=0;l<g;l+=3){var m=a[l]*f,p=a[l+1]*f,q=a[l+2]*f,w=b*m+k*q-e*p,v=b*p+e*m-h*q,r=b*q+h*p-k*m,m=-h*m-k*p-e*q;c[d+l]=w*b+m*-h+v*-e-r*-k;c[d+l+1]=v*b+m*-k+r*-h-w*-e;c[d+l+2]=r*b+m*-e+w*-k-v*-h}return c};a.transform_dir_vec3=function(a,b,c){var d=b[3],g=b[4],f=b[5],h=b[6];b=b[7];var k=a[0]*d,e=a[1]*d,l=a[2]*d;a=b*k+f*l-h*e;var d=b*e+h*k-g*l,m=b*l+g*e-f*k,k=-g*k-f*e-h*l;c[0]=a*b+k*-g+d*-h-m*-f;c[1]=d*b+k*-f+m*-g-a*-h;c[2]=m*b+k*-h+a*-f-d*-g;return c};a.transform_tangents=
function(a,b,c,d){d||(d=0);var g=a.length,f=b[3],h=b[4],k=b[5],e=b[6];b=b[7];for(var l=0;l<g;l+=4){var m=a[l]*f,p=a[l+1]*f,q=a[l+2]*f,w=b*m+k*q-e*p,v=b*p+e*m-h*q,r=b*q+h*p-k*m,m=-h*m-k*p-e*q;c[d+l]=w*b+m*-h+v*-e-r*-k;c[d+l+1]=v*b+m*-k+r*-h-w*-e;c[d+l+2]=r*b+m*-e+w*-k-v*-h;c[d+l+3]=a[l+3]}return c};a.translate=function(a,b,c){var d=a[3],g=a[4],f=a[5],h=a[6],k=a[7],e=b[0]*d,l=b[1]*d,m=b[2]*d;b=k*e+f*m-h*l;var d=k*l+h*e-g*m,p=k*m+g*l-f*e,e=-g*e-f*l-h*m;c[0]=a[0]+b*k+e*-g+d*-h-p*-f;c[1]=a[1]+d*k+e*-f+
p*-g-b*-h;c[2]=a[2]+p*k+e*-h+b*-f-d*-g;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,d){var g=a.subarray(0,3),f=b.subarray(0,3),h=d.subarray(0,3);p.lerp(g,f,c,h);g=a[3];d[3]=g+c*(b[3]-g);a=a.subarray(4,8);b=b.subarray(4,8);g=d.subarray(4,8);q.slerp(a,b,c,g);return d};a.extrapolate=function(a,b,c,d){var g=a.subarray(0,3),f=b.subarray(0,3),h=d.subarray(0,3);h[0]=f[0]*(c+1)-g[0]*c;h[1]=f[1]*(c+1)-g[1]*c;h[2]=f[2]*(c+1)-g[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4,
8);b=b.subarray(4,8);g=d.subarray(4,8);g[0]=b[0]*(c+1)-a[0]*c;g[1]=b[1]*(c+1)-a[1]*c;g[2]=b[2]*(c+1)-a[2]*c;g[3]=b[3]*(c+1)-a[3]*c;q.normalize(g,g);return d};a.integrate=function(a,b,c,d,g){g[0]=a[0]+b*c[0];g[1]=a[1]+b*c[1];g[2]=a[2]+b*c[2];g[3]=a[3];c=d[0];var f=d[1];d=d[2];var h=a[4],k=a[5],e=a[6],l=a[7];g[4]=.5*(c*l+f*e-d*k);g[5]=.5*(f*l+d*h-c*e);g[6]=.5*(d*l+c*k-f*h);g[7]=.5*(-c*h-f*k-d*e);g[4]=a[4]+g[4]*b;g[5]=a[5]+g[5]*b;g[6]=a[6]+g[6]*b;g[7]=a[7]+g[7]*b;a=g[4];b=g[5];c=g[6];f=g[7];a=a*a+b*
b+c*c+f*f;0<a&&(a=1/Math.sqrt(a),g[4]*=a,g[5]*=a,g[6]*=a,g[7]*=a)};a.to_zup_view=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];var c=a[4],d=a[5],g=a[6],h=a[7];b[4]=c*w+h*f;b[5]=d*w+g*f;b[6]=g*w-d*f;b[7]=h*w-c*f};a.to_zup_model=function(a,b){b[0]=a[0];b[1]=-a[2];b[2]=a[1];b[3]=a[3];b[4]=a[4];b[5]=-a[6];b[6]=a[5];b[7]=a[7]}};b4w.module.__util=function(a,r){function u(a){return 0<a?1:0>a?-1:0}function c(a){var b=a[0],c=a[1],d=a[2],e=a[3],g=Math.sqrt(b*b+c*c+d*d),g=1/g;a[0]=b*g;a[1]=c*g;a[2]=d*g;a[3]=e*g}function b(a,c){var e=c;switch(typeof a){case "number":return h(a,e);case "string":return d(a,e);case "boolean":return h(a|0,e);case "function":case "undefined":return h(0,e);case "object":if(a){switch(a.constructor){case WebGLUniformLocation:case WebGLProgram:case WebGLShader:case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:return h(0,
e)}if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(var g=0;g<a.length;g++)e=h(a[g],e);else if(a instanceof Array)for(g=0;g<a.length;g++)e=b(a[g],e);else for(g in a)e=b(a[g],e)}else e=h(0,e)}return e}function h(a,b){var c=b;J[0]=a;c=(c<<5)-c+X[0];c&=c;c=(c<<5)-c+X[1];return c&c}function d(a,b){for(var c=b,d=0;d<a.length;d++)var e=a.charCodeAt(d),c=(c<<5)-c+e,c=c&c;return c}function q(a){return(34*a+1)*a%289}function k(a){return a-Math.floor(a)}function p(a){return f((34*a+5)*a)}
function f(a){return a-289*Math.floor(a/289)}function w(a){return a-7*Math.floor(a/7)}function g(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function m(a){return g(a,0,2*Math.PI)}function l(a,b){if(a&&b){var c=a instanceof Array;if(c!=b instanceof Array)return!1;var d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength;if(d!=(b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength))return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!t(a[c],b[c]))return!1}else if(d){if(a.length!=
b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{switch(a.constructor){case WebGLUniformLocation:case WebGLProgram:case WebGLShader:case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:return a==b}for(var e in a)if(!t(a[e],b[e]))return!1;for(e in b)if(!(e in a))return!1}return!0}return!(a||b)}function t(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return l(a,b);default:return!0}}function F(a){if(""==
a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}var H=r("__boundings"),C=r("__mat3"),x=r("__mat4"),y=r("__math"),z=r("__print"),E=r("__tsr"),e=r("__quat"),n=r("__vec3"),M=r("__vec4"),D=0,G={},Q=[W,A,la,ja,ha],v=new Float32Array(3),P=new Float32Array(3),
S=new Float32Array(4),I=new Float32Array(4),K=new Float32Array(9),B=new Float32Array(16),N=new Float32Array(16),J=new Float64Array(1),X=new Uint32Array(J.buffer),O=new Float32Array([0,0,0]),ba=new Float32Array([0,0,0,1]),ca=new Float32Array([0,0,0,1,0,0,0,1]),ga=new Float32Array([1,1,1]),aa=new Float32Array([1,0,0]),ia=new Float32Array([0,1,0]),da=new Float32Array([0,0,1]),ta=new Float32Array([-1,0,0]),fa=new Float32Array([0,-1,0]),ka=new Float32Array([0,0,-1]),W=0,A=1,la=2,ja=4,ha=5,sa=Math.floor(44488.07041494893),
T=[new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])];a.VEC3_IDENT=O;a.QUAT4_IDENT=ba;a.TSR8_IDENT=ca;a.VEC3_UNIT=ga;a.AXIS_X=aa;a.AXIS_Y=ia;a.AXIS_Z=da;a.AXIS_MX=ta;a.AXIS_MY=fa;a.AXIS_MZ=ka;a.XYX=W;a.YZY=A;a.ZXZ=la;a.XZX=3;a.YXY=
ja;a.ZYZ=ha;a.XYZ=6;a.YZX=7;a.ZXY=8;a.XZY=9;a.YXZ=10;a.ZYX=11;a.INV_CUBE_VIEW_MATRS=T;a.isdef=function(a){return"undefined"!=typeof a};a.keyfind=function(a,b,c){for(var d=[],e=c.length,g=0;g<e;g++){var f=c[g];f[a]==b&&d.push(f)}return d};a.float32_concat=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.uint32_concat=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.check_endians=function(){var a=new Uint16Array([255]);
return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.array_intersect=function(a,b){var c=[],d={},e=b.length,g,f;for(g=0;g<e;g++)d[b[g]]=!0;e=a.length;for(g=0;g<e;g++)f=a[g],f in d&&c.push(f);return c};a.sign=u;a.keycheck=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.key2search=function(a,b,c,d,e){for(var g=0;g<e.length;g++){var f=e[g];if(f[a]==b&&f[c]==d)return f}return null};
a.get_index_for_key_value=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.append_unique=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.check_uniqueness=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.trans_matrix=function(a,b,c,d){d||(d=new Float32Array(16));x.identity(d);d[12]=a;d[13]=b;d[14]=c;return d};var Ha=1;a.rand=function(){Ha=(69069*Ha+5)%Math.pow(2,32);return Math.round(Ha/
65536)%32768/32767};a.srand=function(a){Ha=a};a.rand_r=function(a){var b=a[0]%sa*48271-3399*Math.floor(a[0]/sa);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.init_rand_r_seed=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),g=Math.sin(a[1]/2),f=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=c*d*h+g*f*e;b[1]=g*d*e+c*f*h;b[2]=c*f*e-g*d*h;b[3]=c*d*e-g*f*h;return b};a.ordered_angles_to_quat=
function(a,b,c){var d=a[0],e=a[1];a=a[2];var g=Math.cos(d/2),f=Math.cos(e/2),h=Math.cos(a/2),k=Math.sin(d/2),e=Math.sin(e/2),l=Math.sin(a/2);if(-1<Q.indexOf(b))var n=Math.cos((d+a)/2),m=Math.sin((d+a)/2),p=Math.cos((d-a)/2),q=Math.sin((d-a)/2),v=Math.cos((a-d)/2),t=Math.sin((a-d)/2);switch(b){case W:c[0]=f*m;c[1]=e*p;c[2]=e*q;c[3]=f*n;break;case A:c[0]=e*q;c[1]=f*m;c[2]=e*p;c[3]=f*n;break;case la:c[0]=e*p;c[1]=e*q;c[2]=f*m;c[3]=f*n;break;case 3:c[0]=f*m;c[1]=e*t;c[2]=e*v;c[3]=f*n;break;case ja:c[0]=
e*v;c[1]=f*m;c[2]=e*t;c[3]=f*n;break;case ha:c[0]=e*t;c[1]=e*v;c[2]=f*m;c[3]=f*n;break;case 6:c[0]=k*f*h+g*e*l;c[1]=g*e*h-k*f*l;c[2]=g*f*l+k*e*h;c[3]=g*f*h-k*e*l;break;case 7:c[0]=g*f*l+k*e*h;c[1]=k*f*h+g*e*l;c[2]=g*e*h-k*f*l;c[3]=g*f*h-k*e*l;break;case 8:c[0]=g*e*h-k*f*l;c[1]=g*f*l+k*e*h;c[2]=k*f*h+g*e*l;c[3]=g*f*h-k*e*l;break;case 9:c[0]=k*f*h-g*e*l;c[1]=g*f*l-k*e*h;c[2]=g*e*h+k*f*l;c[3]=g*f*h+k*e*l;break;case 10:c[0]=g*e*h+k*f*l;c[1]=k*f*h-g*e*l;c[2]=g*f*l-k*e*h;c[3]=g*f*h+k*e*l;break;case 11:c[0]=
g*f*l-k*e*h,c[1]=g*e*h+k*f*l,c[2]=k*f*h-g*e*l,c[3]=g*f*h+k*e*l}return c};a.quat_to_ordered_angles=function(a,b,c){var d=a[0],e=a[1],g=a[2];a=a[3];switch(b){case W:c[0]=Math.atan2(d*e+g*a,e*a-d*g);c[1]=Math.acos(1-2*(e*e+g*g));c[2]=Math.atan2(d*e-g*a,d*g+e*a);break;case A:c[0]=Math.atan2(d*a+e*g,g*a-d*e);c[1]=Math.acos(1-2*(d*d+g*g));c[2]=Math.atan2(e*g-d*a,d*e+g*a);break;case la:c[0]=Math.atan2(d*g+e*a,d*a-e*g);c[1]=Math.acos(1-2*(d*d+e*e));c[2]=Math.atan2(d*g-e*a,d*a+e*g);break;case 3:c[0]=Math.atan2(d*
g-e*a,d*e+g*a);c[1]=Math.acos(1-2*(e*e+g*g));c[2]=Math.atan2(d*g+e*a,g*a-d*e);break;case ja:c[0]=Math.atan2(d*e-g*a,d*a+e*g);c[1]=Math.acos(1-2*(d*d+g*g));c[2]=Math.atan2(d*e+g*a,d*a-e*g);break;case ha:c[0]=Math.atan2(e*g-d*a,d*g+e*a);c[1]=Math.acos(1-2*(d*d+e*e));c[2]=Math.atan2(d*a+e*g,e*a-d*g);break;case 6:c[0]=Math.atan2(2*(d*a-e*g),1-2*(d*d+e*e));c[1]=Math.asin(2*(d*g+e*a));c[2]=Math.atan2(2*(g*a-d*e),1-2*(e*e+g*g));break;case 7:c[0]=Math.atan2(2*(e*a-d*g),1-2*(e*e+g*g));c[1]=Math.asin(2*(d*
e+g*a));c[2]=Math.atan2(2*(d*a-e*g),1-2*(d*d+g*g));break;case 8:c[0]=Math.atan2(2*(g*a-d*e),1-2*(d*d+g*g));c[1]=Math.asin(2*(d*a+e*g));c[2]=Math.atan2(2*(e*a-d*g),1-2*(d*d+e*e));break;case 9:c[0]=Math.atan2(2*(d*a+e*g),1-2*(d*d+g*g));c[1]=Math.asin(2*(g*a-d*e));c[2]=Math.atan2(2*(d*g+e*a),1-2*(e*e+g*g));break;case 10:c[0]=Math.atan2(2*(d*g+e*a),1-2*(d*d+e*e));c[1]=Math.asin(2*(d*a-e*g));c[2]=Math.atan2(2*(d*e+g*a),1-2*(d*d+g*g));break;case 11:c[0]=Math.atan2(2*(d*e+g*a),1-2*(e*e+g*g)),c[1]=Math.asin(2*
(e*a-d*g)),c[2]=Math.atan2(2*(d*a+e*g),1-2*(d*d+e*e))}return c};a.euler_to_rotation_matrix=function(a){var b=C.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),g=Math.sin(a[0]),f=Math.sin(a[1]);a=Math.sin(a[2]);var h=c*e,k=c*a,l=g*e,n=g*a;b[0]=d*e;b[1]=d*a;b[2]=-f;b[3]=f*l-k;b[4]=f*n+h;b[5]=d*g;b[6]=f*h+n;b[7]=f*k-l;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],g=a[3],f=c*c,h=d*d,k=e*e,l=c*d+e*g;.499999<l?(b[0]=0,b[1]=2*Math.atan2(c,g),b[2]=Math.PI/2):-.499999>
l?(b[0]=0,b[1]=-2*Math.atan2(c,g),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*g-2*d*e,1-2*f-2*k),b[1]=Math.atan2(2*d*g-2*c*e,1-2*h-2*k),b[2]=Math.asin(2*c*d+2*e*g));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));n.transformQuat(b,a,c);return c};a.dir_to_quat=function(a,b,c){c||(c=new Float32Array(4));a=n.normalize(a,v);var d=n.dot(b,a);a=n.cross(b,a,P);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.trans_quat_to_plane=
function(a,b,c,d){d||(d=new Float32Array(4));n.transformQuat(c,b,d);d[3]=-n.dot(a,d);return d};a.dir_ground_proj_angle=function(a){var b=E.get_quat_view(a.render.world_tsr);switch(a.type){case "CAMERA":v[0]=0;v[1]=-1;v[2]=0;n.transformQuat(v,b,v);P[0]=0;P[1]=0;P[2]=-1;break;case "MESH":v[0]=0;v[1]=0;v[2]=1;n.transformQuat(v,b,v);P[0]=0;P[1]=0;P[2]=1;break;case "EMPTY":v[0]=0,v[1]=1,v[2]=0,n.transformQuat(v,b,v),P[0]=0,P[1]=1,P[2]=0}v[1]=0;n.normalize(v,v);a=n.dot(v,P);b=0<-v[0]*P[2]?-1:1;return Math.acos(a)*
b};a.blend_arrays=function(a,b,c,d){if(0==c)return a;d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e];return d};a.unique_id=function(){D++;return D.toString(16)};a.unique_name=function(a){G[a]||(G[a]=0);var b=a+G[a];G[a]++;return b};a.create_empty_va_frame=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.create_empty_submesh=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};
return{name:a,base_length:0,indices:null,va_frames:[],va_common:b,shape_keys:[],submesh_bd:{bb_world:H.zero_bounding_box(),be_world:H.zero_bounding_ellipsoid(),bb_local:H.zero_bounding_box(),be_local:H.zero_bounding_ellipsoid()}}};a.clone_object_json=function(a){return JSON.parse(JSON.stringify(a))};a.clone_object_r=function(b){if(!(b instanceof Object))return b;var c;c=b.constructor;switch(c){case Int8Array:case Uint8Array:case Int16Array:case Uint16Array:case Int32Array:case Uint32Array:case Float32Array:case Float64Array:c=
new c(b);break;case Array:c=new c(b.length);for(var d=0;d<b.length;d++)c[d]=a.clone_object_r(b[d]);break;default:for(d in c=new c,b)c[d]=a.clone_object_r(b[d])}return c};a.clone_object_nr=function(a){var b=a instanceof Array?[]:{},c;for(c in a)if(a[c]instanceof Object){var d=a[c].constructor;switch(d){case Int8Array:case Uint8Array:case Int16Array:case Uint16Array:case Int32Array:case Uint32Array:case Float32Array:case Float64Array:b[c]=new d(a[c]);break;case Array:b[c]=a[c].slice(0);break;default:b[c]=
a[c]}}else b[c]=a[c];return b};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));C.fromMat4(a,K);var c=K[0],d=K[3],g=K[6],f=K[1],h=K[4],k=K[7],l=K[2],n=K[5],m=K[8],c=Math.sqrt(c*c+d*d+g*g)||1,f=Math.sqrt(f*f+h*h+k*k)||1,l=Math.sqrt(l*l+n*n+m*m)||1;K[0]/=c;K[3]/=c;K[6]/=c;K[1]/=f;K[4]/=f;K[7]/=f;K[2]/=l;K[5]/=l;K[8]/=l;e.fromMat3(K,b);e.normalize(b,b);return b};a.matrix_to_trans=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.matrix_to_scale=function(a){S[0]=
.577350269189626;S[1]=.577350269189626;S[2]=.577350269189626;S[3]=0;M.transformMat4(S,a,S);return M.length(S)};a.extract_frustum_planes=function(a,b){var d=b.left,e=b.right,g=b.top,f=b.bottom,h=b.near,k=b.far;d[0]=a[3]+a[0];d[1]=a[7]+a[4];d[2]=a[11]+a[8];d[3]=a[15]+a[12];e[0]=a[3]-a[0];e[1]=a[7]-a[4];e[2]=a[11]-a[8];e[3]=a[15]-a[12];g[0]=a[3]-a[1];g[1]=a[7]-a[5];g[2]=a[11]-a[9];g[3]=a[15]-a[13];f[0]=a[3]+a[1];f[1]=a[7]+a[5];f[2]=a[11]+a[9];f[3]=a[15]+a[13];h[0]=a[3]+a[2];h[1]=a[7]+a[6];h[2]=a[11]+
a[10];h[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];c(d);c(e);c(g);c(f);c(h);c(k);return b};a.sphere_is_out_of_frustum=function(a,b,c){return c<-y.point_plane_dist(a,b.left)||c<-y.point_plane_dist(a,b.right)||c<-y.point_plane_dist(a,b.top)||c<-y.point_plane_dist(a,b.bottom)||c<-y.point_plane_dist(a,b.near)||c<-y.point_plane_dist(a,b.far)?!0:!1};a.ellipsoid_is_out_of_frustum=function(a,b,c,d,e){g=n.dot(c,b.far);f=n.dot(d,b.far);h=n.dot(e,b.far);g=Math.sqrt(g*g+f*
f+h*h);if(g<-y.point_plane_dist(a,b.near)||g<-y.point_plane_dist(a,b.far))return!0;var g=n.dot(c,b.left),f=n.dot(d,b.left),h=n.dot(e,b.left);if(Math.sqrt(g*g+f*f+h*h)<-y.point_plane_dist(a,b.left))return!0;g=n.dot(c,b.right);f=n.dot(d,b.right);h=n.dot(e,b.right);if(Math.sqrt(g*g+f*f+h*h)<-y.point_plane_dist(a,b.right))return!0;g=n.dot(c,b.top);f=n.dot(d,b.top);h=n.dot(e,b.top);if(Math.sqrt(g*g+f*f+h*h)<-y.point_plane_dist(a,b.top))return!0;g=n.dot(c,b.bottom);f=n.dot(d,b.bottom);h=n.dot(e,b.bottom);
return Math.sqrt(g*g+f*f+h*h)<-y.point_plane_dist(a,b.bottom)?!0:!1};a.positions_multiply_matrix=function(a,b,c,d){d||(d=0);for(var e=a.length,g=0;g<e;g+=3){var f=a[g],h=a[g+1],k=a[g+2];c[d+g]=b[0]*f+b[4]*h+b[8]*k+b[12];c[d+g+1]=b[1]*f+b[5]*h+b[9]*k+b[13];c[d+g+2]=b[2]*f+b[6]*h+b[10]*k+b[14]}return c};a.vectors_multiply_matrix=function(a,b,c,d){d||(d=0);for(var e=a.length,g=0;g<e;g+=3){var f=a[g],h=a[g+1],k=a[g+2];c[d+g]=b[0]*f+b[4]*h+b[8]*k;c[d+g+1]=b[1]*f+b[5]*h+b[9]*k;c[d+g+2]=b[2]*f+b[6]*h+b[10]*
k}return c};a.tangents_multiply_matrix=function(a,b,c,d){d||(d=0);for(var e=a.length,g=0;g<e;g+=4){var f=a[g],h=a[g+1],k=a[g+2];c[d+g]=b[0]*f+b[4]*h+b[8]*k;c[d+g+1]=b[1]*f+b[5]*h+b[9]*k;c[d+g+2]=b[2]*f+b[6]*h+b[10]*k;c[d+g+3]=a[g+3]}return c};a.vecdir_multiply_matrix=function(a,b,c){c||(c=new Float32Array(3));S[0]=a[0];S[1]=a[1];S[2]=a[2];S[3]=0;M.transformMat4(S,b,S);c[0]=S[0];c[1]=S[1];c[2]=S[2]};a.flatten=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;
if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var g=0;g<d;g++)b[e*d+g]=a[e][g];return b};a.vectorize=function(a,b){b||(b=[]);for(var c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.binary_search_max=function(b,c,d,e){if(e<d)return d;var g=d+Math.floor((e-d)/2);return b[g]>c?a.binary_search_max(b,c,d,g-1):b[g]<c?a.binary_search_max(b,c,g+1,e):g};a.cmp_arr=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=
b[c])return!1;return!0};a.cmp_arr_float=function(a,b,c){for(var d=0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;return!0};a.scale_mat4=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.transform_mat4=function(a,b,c,d,e){e||(e=new Float32Array(16));b=x.fromRotationTranslation(c,d,B);x.multiply(b,a,e);return e};a.transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));c=x.fromRotationTranslation(c,d,B);
1!==b&&(d=x.identity(N),b=n.set(b,b,b,v),x.scale(d,b,d),x.multiply(c,d,c));n.transformMat4(a,c,e);return e};a.transform_vec4=function(a,b,c,d,e){e||(e=new Float32Array(4));b=x.fromRotationTranslation(c,d,B);M.transformMat4(a,b,e);return e};a.inverse_transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));b=x.fromRotationTranslation(c,d,B);x.invert(b,b);n.transformMat4(a,b,e);return e};a.transcale_quat_to_matrix=function(a,b,c){c||(c=new Float32Array(16));x.fromRotationTranslation(b,a,c);a=a[3];
for(b=0;12>b;b++)c[b]*=a;return c};a.matrix_to_transcale_quat=function(b,c,d){a.matrix_to_trans(b,c);c[3]=a.matrix_to_scale(b);a.matrix_to_quat(b,d)};a.array_stringify=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.rotate_point_pivot=function(a,b,c,d){d||(d=new Float32Array(3));n.subtract(b,a,v);n.transformQuat(v,c,v);n.subtract(b,v,d)};a.generate_cubemap_matrices=function(){v[0]=0;v[1]=0;v[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),
d=new Float32Array(16),e=new Float32Array(16),g=new Float32Array(16);x.lookAt(v,[-1,0,0],[0,-1,0],a);x.scale(a,[-1,1,1],a);x.scale(a,[-1,1,-1],b);x.lookAt(v,[0,-1,0],[0,0,-1],c);x.scale(c,[1,1,-1],c);x.scale(c,[1,-1,-1],d);x.lookAt(v,[0,0,-1],[0,-1,0],e);x.scale(e,[-1,1,1],e);x.scale(e,[-1,1,-1],g);return[a,b,c,d,e,g]};a.generate_inv_cubemap_matrices=function(){v[0]=0;v[1]=0;v[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),
g=new Float32Array(16);x.lookAt(v,[1,0,0],[0,-1,0],a);x.scale(a,[-1,1,-1],b);x.lookAt(v,[0,1,0],[0,0,1],c);x.scale(c,[1,-1,-1],d);x.lookAt(v,[0,0,1],[0,-1,0],e);x.scale(e,[-1,1,-1],g);return[a,b,c,d,e,g]};a.calc_variable_id=function(a,c){return b(a,c)};a.hash_code=b;a.hash_code_string=d;a.mat3_to_mat4=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,
b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.deg_to_rad=function(a){return a*Math.PI/180};a.rad_to_deg=function(a){return 180*a/Math.PI};a.snoise=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-
d+e;var g=b>a?1:0,f=1-g,e=b+.211324865405187-g,h=a+.211324865405187-f,l=b+-.577350269189626,n=a+-.577350269189626,c=c%289,d=d%289,m=q(q(d)+c),f=q(q(d+f)+c+g),p=q(q(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+h*h),0),g=Math.max(.5-(l*l+n*n),0),c=c*c*c*c,d=d*d*d*d,g=g*g*g*g,v=2*k(.024390243902439*m)-1,t=2*k(.024390243902439*f)-1,w=2*k(.024390243902439*p)-1,m=Math.abs(v)-.5,f=Math.abs(t)-.5,p=Math.abs(w)-.5,v=v-Math.floor(v+.5),t=t-Math.floor(t+.5),w=w-Math.floor(w+.5);return 130*(c*(1.79284291400159-
.85373472095314*(v*v+m*m))*(v*b+m*a)+d*(1.79284291400159-.85373472095314*(t*t+f*f))*(t*e+f*h)+g*(1.79284291400159-.85373472095314*(w*w+p*p))*(w*l+p*n))};a.cellular2x2=function(a){var b=1/7,c=b/2,d=f(Math.floor(a[0])),e=f(Math.floor(a[1])),g=k(a[0]);a=k(a[1]);var h=g-.5,l=g-1.5,g=a-.5;a-=1.5;var n=p(d),d=p(d+1),m=n,q=d,n=p(n+e),d=p(d+e),m=p(m+e+1),q=p(q+e+1),v=w(n)*b+c,t=w(d)*b+c,B=w(m)*b+c,e=w(q)*b+c,n=w(Math.floor(n*b))*b+c,d=w(Math.floor(d*b))*b+c,m=w(Math.floor(m*b))*b+c,b=w(Math.floor(q*b))*b+
c,c=h+.7*v,t=l+.7*t,h=h+.7*B,l=l+.7*e,e=g+.7*n,g=g+.7*d,n=a+.7*m;a+=.7*b;return Math.min(c*c+e*e,t*t+g*g,h*h+n*n,l*l+a*a)};a.quat_project=function(a,b,c,d,g){g||(g=new Float32Array(4));a=n.transformQuat(b,a,v);b=c[0];var f=c[1];c=c[2];K[0]=f*f+c*c;K[1]=-f*b;K[2]=-c*b;K[3]=-b*f;K[4]=b*b+c*c;K[5]=-c*f;K[6]=-b*c;K[7]=-f*c;K[8]=b*b+f*f;n.transformMat3(a,K,a);n.normalize(a,a);e.rotationTo(d,a,g);return g};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=S,d=I,c=e.setAxisAngle([0,
1,0],Math.PI,e.create()),d=e.setAxisAngle([1,0,0],Math.PI/2,e.create());e.multiply(c,d,c);e.multiply(a,c,b);return b};a.cleanup=function(){D=0;G={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.smooth_q=function(a,b,c,d,g){g||(g=new Float32Array(a.length));c=Math.exp(-c/d);e.slerp(a,b,
c,g);return g};a.is_arr_buf_view=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=C.fromQuat(a,K);P[0]=0;P[1]=1;P[2]=0;v[0]=c[3];v[1]=c[4];v[2]=c[5];var d=n.cross(P,v,v);n.normalize(d,d);var g=c[7];!b&&0<g&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);P[0]=c[0];P[1]=c[1];P[2]=c[2];n.normalize(P,P);e.rotationTo(P,
d,I);e.multiply(I,a,a)};a.get_array_smooth_value=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var g=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),f=b-1,h=a[e*b+c],k=a[e*b+Math.min(c+1,f)],l=a[Math.min(e+1,f)*b+c];a=a[Math.min(e+1,f)*b+Math.min(c+1,f)];return(h*(1-d)+k*d)*(1-g)+(l*(1-d)+a*d)*g};a.rgb_mask_get_channels_count=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.rgb_mask_get_channels_presence=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=
1);return b};a.rgb_mask_get_channel_presence_index=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.gen_uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.get_dict_length=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,
b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];n.normalize(c,c)};a.transformQuatFast=function(a,b,c){var d=a[0],e=a[1];a=a[2];var g=b[0],f=b[1],h=b[2];b=b[3];var k=f*a-h*e,l=h*d-g*a,n=g*e-f*d,m=f*n-h*l,h=h*k-g*n,g=g*l-f*k;c[0]=d+2*k*b+2*m;c[1]=e+2*l*b+2*h;c[2]=a+2*n*b+2*g;return c};a.assert=function(a){if(!a)throw Error("Assertion failed");};a.panic=function(a){a&&z.error.apply(z,arguments);throw"engine panic:\nThe engine tried to perform an invalid operation and halted.\nPlease copy the console contents above and submit it to the Blend4Web forum at\nhttps://www.blend4web.com/en/forums/forum/17/";
};a.angle_wrap_periodic=g;a.angle_wrap_0_2pi=m;a.get_file_extension=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.strict_objs_is_equal=function(a,b){for(var c in a){var d=!0,e=a[c],g=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==g;break;case "object":d=l(e,g)}if(!d)return!1}return!0};a.quat_bpy_b4w=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c;return b};a.gen_color_id=function(a){a+=1;132651<a&&z.error("Color ID pool depleted");var b=Math.floor(a/
2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d){S.set(a);S[3]=b;v[0]=c[3];v[1]=c[4];v[2]=c[5];I.set(v);I[3]=0;a=M.dot(S,I);if(0==a)return null;n.copy(c,v);I.set(v);I[3]=1;a=-M.dot(S,I)/a;d[0]=c[0]+a*c[3];d[1]=c[1]+a*c[4];d[2]=c[2]+a*c[5];return d};a.get_plane_normal=function(a,b,c,d){var e=b[0]-a[0],g=c[0]-a[0],f=b[1]-a[1],h=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=f*a-b*h;d[1]=g*b-e*a;d[2]=e*h-f*g;return d};a.copy_array=function(a,
b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.rotation_to_stable=function(a,b,c){var d=n.dot(a,b);-.9999999>d?(n.cross(aa,a,v),1E-6>n.length(v)&&n.cross(ia,a,v),n.normalize(v,v),e.setAxisAngle(v,Math.PI,c)):(n.cross(a,b,v),c.set(v),c[3]=1+d,e.normalize(c,c));return c};a.calc_returning_angle=function(a,b,c){if(b==c)return c-a;a=m(a);b=m(b);c=m(c);b=2*Math.PI-b;c=m(c+b);a=m(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a,b,c){isFinite(b)&&isFinite(c)&&(a=clamp(a,b,c));
return a*a*(3-2*a)};a.lerp=function(a,b,c){return b+a*(c-b)};a.arrays_have_common=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(b[d]==a[c])return!0;return!1};a.create_zero_array=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=0;return b};a.version_cmp=function(a,b){for(var c=Math.max(a.length,b.length),d=0;d<c;d++){var e=u((d>=a.length?0:a[d])-(d>=b.length?0:b[d]));if(e)return e}return 0};a.version_to_str=function(a){return a.join(".")};a.str_to_version=function(a){return a.split(".").map(function(a){return a|
0})};a.srgb_to_lin=function(a,b){b[0]=Math.pow(a[0],2.2);b[1]=Math.pow(a[1],2.2);b[2]=Math.pow(a[2],2.2);return b};a.lin_to_srgb=function(a,b){b[0]=Math.pow(a[0],1/2.2);b[1]=Math.pow(a[1],1/2.2);b[2]=Math.pow(a[2],1/2.2);return b};a.normpath_preserve_protocol=function(a){var b=a.split("://",2);return 1<b.length?(b[1]=F(b[1]),b.join("://")):F(a)};a.check_npot=function(a){return 0!=parseInt(a.toString(2).substr(1),2)};a.ellipsoid_axes_to_mat3=function(a,b,c,d){d[0]=a[0];d[1]=b[0];d[2]=c[0];d[3]=a[1];
d[4]=b[1];d[5]=c[1];d[6]=a[2];d[7]=b[2];d[8]=c[2];return d}};b4w.module.__sfx=function(a,r){function u(){var a=window.AudioContext||window.webkitAudioContext;if(a){try{var b=new a}catch(c){return H.error('Unable to initialize AudioContext: "'+c+'". The audio is disabled.'),null}if(b.createGain)return b;H.warn("deprecated WebAudio implementation");return null}H.warn("WebAudio is not supported");return null}function c(a,c,e){var g=a.sfx;if("NONE"!=g.behavior){var f=g.loop,h=g.pitch;if(g.src&&(f||0<=e)){g.base_seed=Math.floor(5E4*Math.random());var l=v.currentTime+
c,l=Math.max(0,l);g.start_time=l;g.state=20;b(a);"POSITIONAL"==g.behavior||"BACKGROUND_SOUND"==g.behavior?(c=v.createBufferSource(),c.buffer=g.src,c.playbackRate.value=h,y.isdef(c.onended)&&(c.onended=function(){g.state=50}),f?(g.source_node&&g.source_node.disconnect(),c.loop=!0,c.start(l),g.duration=0):(f=c.buffer?c.buffer.duration:0,e>f?(f=l+e+g.fade_out,c.loop=!0,c.start(l),c.stop(f),g.duration=e):(c.loop=!1,c.start(l),g.duration=f)),c.connect(g.proc_chain_in),g.source_node=c,d(g),q(g)):"BACKGROUND_MUSIC"==
g.behavior&&(C.clear_timeout(g.bgm_start_timeout),C.clear_timeout(g.bgm_stop_timeout),e=function(){var b=a.sfx,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.source_node=b.source_node||v.createMediaElementSource(c),b.source_node.connect(b.proc_chain_in),20==b.state&&(c.currentTime&&(c.currentTime=0),c.play()))},0==c?e():g.bgm_start_timeout=C.set_timeout(e,1E3*c),f?g.duration=0:(e=t(a),g.duration=e));k(g,l)}}}function b(a){var b=a.sfx;if(!b.proc_chain_in){var c=x.get_trans_view(a.render.world_tsr);a=x.get_quat_view(a.render.world_tsr);
if(e.mix_mode){var d=v.createBiquadFilter();d.type="peaking"}else d=null;var g=v.createGain();switch(b.behavior){case "POSITIONAL":var f=v.createPanner();"string"!=typeof f.panningModel?(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],c[1],c[2]);z.copy(c,b.last_position);c=n;y.quat_to_dir(a,y.AXIS_MY,c);f.setOrientation(c[0],c[1],c[2]);z.copy(c,b.direction);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;
f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.cone_angle_inner;f.coneOuterAngle=b.cone_angle_outer;f.coneOuterGain=b.cone_volume_outer;var h=v.createGain();h.gain.value=l(b);d?(f.connect(d),d.connect(h)):f.connect(h);h.connect(g);b.proc_chain_in=f;if(b.volume_random){var k=v.createGain();g.connect(k);k.connect(v?P._sfx.proc_chain_in:null)}else k=null,g.connect(v?P._sfx.proc_chain_in:null);break;case "BACKGROUND_SOUND":f=null;h=v.createGain();h.gain.value=l(b);d?(b.proc_chain_in=d,d.connect(h)):
b.proc_chain_in=h;h.connect(g);b.volume_random?(k=v.createGain(),g.connect(k),k.connect(v?P._sfx.proc_chain_in:null)):(k=null,g.connect(v?P._sfx.proc_chain_in:null));break;case "BACKGROUND_MUSIC":k=f=null,h=v.createGain(),h.gain.value=l(b),d?(b.proc_chain_in=d,d.connect(h)):b.proc_chain_in=h,h.connect(g),g.connect(v?P._sfx.proc_chain_in:null)}b.panner_node=f;b.filter_node=d;b.gain_node=h;b.fade_gain_node=g;b.rand_gain_node=k}}function h(a){var b=a.sfx,d=b.duration,b=b.delay+b.delay_random*Math.random();
c(a,b,d)}function d(a){a.volume_random&&a.rand_gain_node.gain.cancelScheduledValues(a.start_time);a.pitch_random&&a.source_node.playbackRate.cancelScheduledValues(a.start_time);a.vp_rand_end_time=a.start_time}function q(a){if(a.volume_random||a.pitch_random){var b=a.rand_gain_node,c=a.source_node,d=c.buffer?c.buffer.duration:0;if(d){var e=a.start_time;I[0]=a.base_seed;for(var g=0;5>g;){var f=a.pitch+a.pitch_random*y.rand_r(I);if(e>=a.vp_rand_end_time){if(a.volume_random){var h=1-y.clamp(a.volume_random,
0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.pitch_random&&c.playbackRate.setValueAtTime(f,e);g++}e+=d/f}a.vp_rand_end_time=e-.001}}}function k(a,b){if(a.fade_in||a.fade_out){var c=a.fade_gain_node;c.gain.cancelScheduledValues(b);a.fade_in?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.fade_in)):c.gain.setValueAtTime(1,b);a.fade_out&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.fade_out))}}function p(a){if("SPEAKER"!=a.type)throw"Wrong object type";
var b=a.sfx;if(50==b.state)b.state=30;else if(20==b.state||40==b.state){var c=b.fade_gain_node,d=v.currentTime;b.fade_out&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.fade_out));"BACKGROUND_MUSIC"==b.behavior?b.src&&(C.clear_timeout(b.bgm_start_timeout),C.clear_timeout(b.bgm_stop_timeout),b.bgm_stop_timeout=C.set_timeout(function(){var b=a.sfx.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.fade_out)):(c=b.source_node,b.duration<c.buffer.duration?b.fade_out&&
20==b.state?c.stop(d+b.fade_out):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),b.start_time=0,b.pause_time=0,b.buf_offset=0);b.state=30}}function f(a){a=a.sfx;if(20==a.state){var b=v.currentTime;a.pause_time=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.start_time){I[0]=a.base_seed;for(var e=a.source_node.buffer.duration,g=a.start_time;g<b;)c=a.pitch+a.pitch_random*y.rand_r(I),g+=e/c;a.buf_offset=(e/c-(g-b))*c}else a.buf_offset=0;a.source_node.stop(0);a.source_node.disconnect();
d(a)}a.state=40}}function w(a){var b=a.sfx;if(40==b.state){var c=v.currentTime;b.start_time+=c-b.pause_time;"BACKGROUND_MUSIC"==b.behavior?b.src.play():(g(a),b.vp_rand_end_time=c,a=b.source_node,y.isdef(a.onended)&&(a.onended=function(){b.state=50}),a.start(b.start_time,b.buf_offset),q(b));k(b,b.start_time);b.state=20}}function g(a){a=a.sfx;var b=v.createBufferSource();b.loop=a.source_node.loop;b.buffer=a.source_node.buffer;b.playbackRate.value=a.source_node.playbackRate.value;a.panner_node?b.connect(a.panner_node):
b.connect(a.gain_node);a.source_node=b}function m(a){a=a.sfx;return!a||20!=a.state&&40!=a.state&&30!=a.state&&50!=a.state?!1:!0}function l(a){return a.muted?0:a.volume}function t(a){a=a.sfx;return(a=a.src)?a.duration:0}var F=r("__config"),H=r("__print"),C=r("__time"),x=r("__tsr"),y=r("__util"),z=r("__vec3"),E=F.defaults,e=F.sfx;a.AST_NONE=10;a.AST_ARRAY_BUFFER=20;a.AST_HTML_ELEMENT=30;var n=new Float32Array(3),M=new Float32Array(3),D=new Float32Array(3),G=[],Q=[],v=null,P=null,S=[],I=[1],K=null;a.create_sfx=
function(){return{uuid:-1,filepath:"",behavior:"NONE",disable_doppler:!1,muted:!1,volume:1,pitch:1,attenuation:1,dist_ref:1,dist_max:1E4,cone_angle_inner:360,cone_angle_outer:360,cone_volume_outer:1,cyclic:!1,loop:!1,delay:0,delay_random:0,volume_random:0,pitch_random:0,fade_in:0,fade_out:0,start_time:0,pause_time:0,buf_offset:0,duration:0,vp_rand_end_time:0,base_seed:1,src:null,state:10,last_position:new Float32Array(3),direction:new Float32Array(3),speed_avg:new Float32Array(3),bgm_start_timeout:-1,
bgm_stop_timeout:-1,duck_time:0}};a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(G.push("ogg"),G.push("ogv")),""!=a.canPlayType("audio/mpeg")&&G.push("mp3"),""!=a.canPlayType("audio/mp4")&&(G.push("mp4"),G.push("m4v")),""!=a.canPlayType("audio/webm")&&G.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&Q.push("ogv"),""!=b.canPlayType("video/mp4")&&Q.push("m4v"),""!=b.canPlayType("video/webm")&&
Q.push("webm"));(v=e.webaudio?u():null)&&H.log("%cINIT WEBAUDIO: "+v.sampleRate+"Hz","color: #00a")};a.attach_scene_sfx=function(a){var b={listener_last_eye:new Float32Array(3),listener_direction:new Float32Array(3),listener_speed_avg:new Float32Array(3)};a._sfx=b;if(v){var c=v.createGain(),d=v.createGain();b.gain_node=c;b.fade_gain_node=d;c.connect(d);d.connect(v.destination);if(a.b4w_enable_dynamic_compressor){var d=v.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=
e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.compressor_node=d;b.proc_chain_in=d}else b.compressor_node=null,b.proc_chain_in=c;c=v.listener;b.disable_doppler=E.disable_doppler_hack;b.disable_doppler||(c.dopplerFactor=a.audio_doppler_factor,c.speedOfSound=a.audio_doppler_speed);b.muted=!1;b.volume=1;b.duck_time=0}};a.set_active_scene=function(a){P=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<G.indexOf(a)?a:"ogg"==
a&&-1<G.indexOf("mp4")?"mp4":"mp3"==a&&-1<G.indexOf("ogg")?"ogg":"mp4"==a&&-1<G.indexOf("ogg")?"ogg":"ogv"==a&&-1<G.indexOf("m4v")?"m4v":"webm"==a&&-1<G.indexOf("m4v")?"m4v":"m4v"==a&&-1<G.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<Q.indexOf(a)?a:"ogv"==a&&-1<Q.indexOf("m4v")?"m4v":"webm"==a&&-1<Q.indexOf("m4v")?"m4v":"m4v"==a&&-1<Q.indexOf("webm")?"webm":""};a.update_object=function(a,b){var c=a.data,d=b.sfx;d.uuid=a.data.sound.uuid;d.filepath=a.data.sound.filepath;
switch(c.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":d.behavior=v?c.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var e;v?(window.MediaElementAudioSourceNode?e=!0:(H.warn("MediaElementAudioSourceNode not found"),e=!1),e=e&&!E.chrome_html_bkg_music_hack?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):e="NONE";d.behavior=e;break;default:throw"Wrong speaker behavior";}c.sound||(d.behavior="NONE");d.disable_doppler=c.b4w_disable_doppler||E.disable_doppler_hack;d.muted=c.muted;d.volume=c.volume;
d.pitch=c.pitch;d.attenuation=c.attenuation;d.dist_ref=c.distance_reference;d.dist_max=c.distance_max||1E4;d.cone_angle_inner=c.cone_angle_inner;d.cone_angle_outer=c.cone_angle_outer;d.cone_volume_outer=c.cone_volume_outer;d.cyclic=c.b4w_cyclic_play;d.loop=c.b4w_loop;d.delay=c.b4w_delay;d.delay_random=c.b4w_delay_random;d.volume_random=c.b4w_volume_random;d.pitch_random=c.b4w_pitch_random;d.fade_in=c.b4w_fade_in;d.fade_out=c.b4w_fade_out;S.push(b)};a.source_type=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";
switch(b.sfx.behavior){case "POSITIONAL":return a.AST_ARRAY_BUFFER;case "BACKGROUND_SOUND":return a.AST_ARRAY_BUFFER;case "BACKGROUND_MUSIC":return a.AST_HTML_ELEMENT;case "NONE":return a.AST_NONE;default:throw"Wrong speaker behavior";}};a.update_spkobj=function(a,b){var c=a.sfx;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.play_empty_sound=function(){var a=v.createBufferSource();a.buffer=
v.createBuffer(1,22050,22050);a.connect(v.destination);a.start(0)};a.decode_audio_data=function(a,b,c){v?v.decodeAudioData(a,b,c):c()};a.speaker_remove=function(a){p(a);a.sfx=null;S.splice(S.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<S.length;a++){var b=S[a].sfx;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.source_node&&b.source_node.disconnect()}P&&P._sfx&&(a=P._sfx,a.listener_last_eye[0]=0,a.listener_last_eye[1]=0,a.listener_last_eye[2]=0,a.listener_speed_avg[0]=0,a.listener_speed_avg[1]=
0,a.listener_speed_avg[2]=0);P=null;S.splice(0);K=null};a.update=function(a,b){if(v&&0!=S.length){for(var c=0;c<S.length;c++){var d=S[c],e=d.sfx,g=e.source_node,f=v.currentTime;!e.loop&&20==e.state&&e.duration&&e.start_time+e.duration<f&&("BACKGROUND_MUSIC"==e.behavior||g&&!y.isdef(g.onended))&&(e.state=50);e.cyclic&&50==e.state&&h(d);20==e.state&&3>e.vp_rand_end_time-f&&q(e)}K&&K.speakers.length&&(-1==K.active||a>K.active_start_time+K.durations[K.active])&&(c=K,-1<c.active&&p(c.speakers[c.active]),
-1==c.active&&c.random?d=Math.round(Math.random()*(c.speakers.length-1)):c.random?(d=1+Math.round(Math.random()*(c.speakers.length-2)),d=(c.active+d)%c.speakers.length):d=(c.active+1)%c.speakers.length,h(c.speakers[d]),c.active=d,c.active_start_time=a)}};a.play=c;a.play_def=h;a.stop=p;a.is_playing=function(a){return 20==a.sfx.state};a.speaker_pause=f;a.speaker_resume=w;a.playrate=function(a,b){var c=a.sfx;c.pitch=b;!m(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.source_node.playbackRate.value=
b,d(c),q(c))};a.get_playrate=function(a){return a.sfx.pitch};a.cyclic=function(a,b){a.sfx.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.sfx.cyclic};a.listener_update_transform=function(a,b,c,d){if(v&&a._sfx){var e=n;e[0]=0;e[1]=-1;e[2]=0;z.transformQuat(e,c,e);M[0]=0;M[1]=0;M[2]=-1;z.transformQuat(M,c,M);c=v.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],M[0],M[1],M[2]);z.copy(e,a._sfx.listener_direction);!a._sfx.disable_doppler&&d&&(D[0]=(b[0]-a._sfx.listener_last_eye[0])/
d,D[1]=(b[1]-a._sfx.listener_last_eye[1])/d,D[2]=(b[2]-a._sfx.listener_last_eye[2])/d,y.smooth_v(D,a._sfx.listener_speed_avg,d,.3,D),c.setVelocity(D[0],D[1],D[2]),z.copy(D,a._sfx.listener_speed_avg));z.copy(b,a._sfx.listener_last_eye)}};a.listener_reset_speed=function(a,b){if(v&&P._sfx&&!P._sfx.disable_doppler){var c=n;b?z.copy(b,c):z.copy(P._sfx.listener_direction,c);z.scale(c,a,c);v.listener.setVelocity(c[0],c[1],c[2]);z.copy(c,P._sfx.listener_speed_avg)}};a.speaker_update_transform=function(a,
b){var c=a.sfx;if(m(a)&&"POSITIONAL"==c.behavior){var d=x.get_trans_view(a.render.world_tsr),e=x.get_quat_view(a.render.world_tsr),g=c.panner_node;g.setPosition(d[0],d[1],d[2]);var f=n;y.quat_to_dir(e,y.AXIS_MY,f);g.setOrientation(f[0],f[1],f[2]);e=c.last_position;!c.disable_doppler&&b&&(M[0]=(d[0]-e[0])/b,M[1]=(d[1]-e[1])/b,M[2]=(d[2]-e[2])/b,y.smooth_v(M,c.speed_avg,b,.3,M),g.setVelocity(M[0],M[1],M[2]),z.copy(M,c.speed_avg));z.copy(d,e)}};a.speaker_reset_speed=function(a,b,c){var d=a.sfx;if(m(a)&&
"POSITIONAL"==d.behavior&&!d.disable_doppler){var e=n;c?z.copy(c,e):z.copy(d.direction,e);z.scale(e,b,e);d.panner_node.setVelocity(e[0],e[1],e[2]);z.copy(e,d.speed_avg);a=x.get_trans_view(a.render.world_tsr);z.copy(a,d.last_position)}};a.get_spk_behavior=function(a){return a.sfx.behavior};a.check_active_speakers=function(){for(var a=0;a<S.length;a++)if(m(S[a]))return!0;return!1};a.set_master_volume=function(a){var b=P._sfx;b&&(b.volume=a,v&&(b.gain_node.gain.value=l(b)))};a.get_master_volume=function(){var a=
P._sfx;return a?a.volume:0};a.set_volume=function(a,b){var c=a.sfx;c.volume=b;m(a)&&(c.gain_node.gain.value=l(c))};a.get_volume=function(a){return a.sfx.volume};a.mute=function(a,b){a.sfx.muted=Boolean(b);m(a)&&(a.sfx.gain_node.gain.value=l(a.sfx))};a.is_muted=function(a){return a.sfx.muted};a.mute_master=function(a){var b=P._sfx;b&&(b.muted=Boolean(a),v&&(b.gain_node.gain.value=l(b)))};a.is_master_muted=function(){var a=P._sfx;return a?a.muted:!1};a.get_speaker_objects=function(){return S};a.pause=
function(){for(var a=0;a<S.length;a++)f(S[a])};a.resume=function(){for(var a=0;a<S.length;a++)w(S[a])};a.set_compressor_params=function(a,b){if(a._sfx&&a._sfx.compressor_node){var c=a._sfx.compressor_node;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a._sfx||!a._sfx.compressor_node)return null;a=a._sfx.compressor_node;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,
attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(m(a)){a=a.sfx;var d=a.fade_gain_node,e=v.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.duck_time=c}};a.unduck=function(a){if(m(a)){a=a.sfx;var b=a.fade_gain_node,c=v.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.duck_time);a.duck_time=0}};a.duck_master=function(a,b){if(v){var c=P._sfx,d=c.fade_gain_node,e=v.currentTime;d.gain.setValueAtTime(d.gain.value,
e);d.gain.linearRampToValueAtTime(a,e+b);c.duck_time=b}};a.unduck_master=function(){if(v){var a=P._sfx,b=a.fade_gain_node,c=v.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.duck_time);a.duck_time=0}};a.apply_playlist=function(a,b,c){K={active:-1,active_start_time:0,random:c,speakers:[],durations:[]};for(c=0;c<a.length;c++){var d=a[c],e=t(d);0==e?H.warn("Ignoring speaker with zero duration: "+d.name):(p(d),d.sfx.cyclic=!1,K.speakers.push(d),K.durations.push(e+
b))}};a.get_duration=t;a.clear_playlist=function(){if(K)for(var a=K.speakers,b=0;b<a.length;b++)p(a[b]);K=null};a.get_positional_params=function(a){return(a=a.sfx)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.sfx;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.panner_node;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=
c.attenuation)}};a.set_filter_params=function(a,b){var c=a.sfx;c&&c.filter_node&&(c.filter_node.frequency.value=b.freq,c.filter_node.Q.value=b.Q,c.filter_node.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.sfx)&&a.filter_node?{freq:a.filter_node.frequency.value,Q:a.filter_node.Q.value,gain:a.filter_node.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.sfx;if(!a||!a.filter_node)return null;a.filter_node.getFrequencyResponse(b,c,d)}};b4w.module.__input=function(a,r){function u(a){return(20!=a||navigator.getVRDevices||O.is_mobile_device)&&(10!=a||O.is_mobile_device&&window.DeviceOrientationEvent)?!0:!1}function c(a,b){if(!u(a))return null;var c={type:a,registered:!1,orientation_quat_cb_list:[],orientation_angles_cb_list:[],mouse_down_which_cb_list:[],mouse_location_cb_list:[],mouse_up_which_cb_list:[],mouse_wheel_cb_list:[],keyboard_down_cb_list:[],keyboard_up_cb_list:[],touch_start_cb_list:[],touch_move_cb_list:[],touch_end_cb_list:[],
element:b,prevent_default:!0,registered_event_listeners:[],mouse_location:new Float32Array(2),mouse_which:0,distortion_coefs:new Float32Array(2),chromatic_aberration_coefs:new Float32Array(4),webvr_hmd_device:null,webvr_sensor_devices:null,fov_left:new Float32Array(4),fov_right:new Float32Array(4),inter_lens_dist:0,base_line_dist:0,screen_to_lens_dist:0,width_dist:0,height_dist:0,bevel_size:0,gamepad_btns:[],gamepad_axes:[0,0,0,0,0,0,0,0,0,0,0,0],gamepad_prev_axes:[0,0,0,0,0,0,0,0,0,0,0,0],gamepad_mapping:[]};
c.fov_left[0]=c.fov_left[1]=c.fov_left[2]=c.fov_left[3]=45;c.fov_right[0]=c.fov_right[1]=c.fov_right[2]=c.fov_right[3]=45;30==a||40==a||50==a?(c.registered=Boolean(b),50==a?document.addEventListener("touchstart",function(){}):40==a&&(c.prevent_default=!1)):10==a?c.registered=!0:20==a&&(navigator.getVRDevices&&!O.is_mobile_device?d(c,ba.webvr):(h(c),c.registered=!0));return c}function b(b,d){10==b||20==b?d=window:d||(d=S.get_container());for(var e=0;e<fa.length;e++)if(fa[e].type==b&&fa[e].element==
d)return fa[e];e=c(b,d);60!=b&&70!=b&&80!=b&&90!=b||e.gamepad_mapping.push(a.GMPD_BUTTON_0,a.GMPD_BUTTON_1,a.GMPD_BUTTON_2,a.GMPD_BUTTON_3,a.GMPD_BUTTON_4,a.GMPD_BUTTON_5,a.GMPD_BUTTON_6,a.GMPD_BUTTON_7,a.GMPD_BUTTON_8,a.GMPD_BUTTON_9,a.GMPD_BUTTON_10,a.GMPD_BUTTON_11,a.GMPD_BUTTON_12,a.GMPD_BUTTON_13,a.GMPD_BUTTON_14,a.GMPD_BUTTON_15,a.GMPD_BUTTON_16,a.GMPD_BUTTON_17,a.GMPD_BUTTON_18,a.GMPD_BUTTON_19,a.GMPD_BUTTON_20,a.GMPD_BUTTON_21,a.GMPD_BUTTON_22,a.GMPD_BUTTON_23,a.GMPD_BUTTON_24,a.GMPD_BUTTON_25,
a.GMPD_AXIS_0,a.GMPD_AXIS_1,a.GMPD_AXIS_2,a.GMPD_AXIS_3,a.GMPD_AXIS_4,a.GMPD_AXIS_5,a.GMPD_AXIS_6,a.GMPD_AXIS_7,a.GMPD_AXIS_8,a.GMPD_AXIS_9,a.GMPD_AXIS_10,a.GMPD_AXIS_11);e&&fa.push(e);return e}function h(a){var b=ba.nonwebvr;a.width_dist=b.width_dist;a.height_dist=b.height_dist;a.bevel_size=b.bevel_size;d(a,b);a.inter_lens_dist=b.inter_lens_dist;a.base_line_dist=b.base_line_dist;a.screen_to_lens_dist=b.screen_to_lens_dist;k(a)}function d(a,b){a.distortion_coefs[0]=b.distortion_coefs[0];a.distortion_coefs[1]=
b.distortion_coefs[1];a.chromatic_aberration_coefs[0]=b.chromatic_aberration_coefs[0];a.chromatic_aberration_coefs[1]=b.chromatic_aberration_coefs[1];a.chromatic_aberration_coefs[2]=b.chromatic_aberration_coefs[2];a.chromatic_aberration_coefs[3]=b.chromatic_aberration_coefs[3]}function q(a,b){var c=b*b;return b*(1+a[0]*c+a[1]*c*c)}function k(a){var b=a.base_line_dist-a.bevel_size,c=a.height_dist-b,d=a.distortion_coefs,b=q(d,b/a.screen_to_lens_dist),b=N.rad_to_deg(Math.atan(b)),e=q(d,c/a.screen_to_lens_dist),
e=N.rad_to_deg(Math.atan(e)),g=q(d,c/a.screen_to_lens_dist),g=N.rad_to_deg(Math.atan(g)),c=q(d,c/a.screen_to_lens_dist),c=N.rad_to_deg(Math.atan(c));e&&(a.fov_left[0]=a.fov_right[0]=Math.min(e,60));g&&(a.fov_left[1]=a.fov_right[3]=Math.min(g,60));b&&(a.fov_left[2]=a.fov_right[2]=Math.min(b,60));c&&(a.fov_left[3]=a.fov_right[1]=Math.min(c,60))}function p(a,b){var c=b.filter(function(a){return a instanceof HMDVRDevice}),d=null;c.length&&(d=c[0]);c=null;d&&(c=b.filter(function(a){return-1!==a.deviceName.toLowerCase().indexOf("oculus")&&
a.hardwareUnitId==d.hardwareUnitId&&a instanceof PositionSensorVRDevice}));a.webvr_hmd_device=d;a.webvr_sensor_devices=c}function f(a,b,c){switch(a.type){case 20:if(a.webvr_hmd_device){if((b=a.webvr_hmd_device.getEyeParameters(b))&&b.currentFieldOfView){var d=a.distortion_coefs;a=q(d,Math.tan(N.deg_to_rad(b.currentFieldOfView.downDegrees)));a=N.rad_to_deg(Math.atan(a));var e=q(d,Math.tan(N.deg_to_rad(b.currentFieldOfView.upDegrees))),e=N.rad_to_deg(Math.atan(e)),g=q(d,Math.tan(N.deg_to_rad(b.currentFieldOfView.leftDegrees))),
g=N.rad_to_deg(Math.atan(g));b=q(d,Math.tan(N.deg_to_rad(b.currentFieldOfView.rightDegrees)));b=N.rad_to_deg(Math.atan(b));c[0]=e;c[1]=b;c[2]=a;c[3]=g;break}}else X.copy("left"==b?a.fov_left:a.fov_right,c);break;default:K.error("fov is undefined for device: ",a.type)}return c}function w(a){navigator.getVRDevices&&navigator.getVRDevices().then(function(b){p(a,b);b.length&&(a.registered=!0)},function(b){K.error_once("WebVR devices are not found.");a.registered=!1})}function g(a,b){if(a){for(var c=0;c<
a.buttons.length;c++)b.gamepad_btns[c]=a.buttons[c].pressed;if(a.axes&&12>=a.axes.length)for(c=0;c<a.axes.length;c++)b.gamepad_axes[c]=a.axes[c]}}function m(a){for(var b=0;b<a.gamepad_btns;b++)a.gamepad_btns[b]=!1;for(b=0;b<a.gamepad_axes.length;b++)a.gamepad_prev_axes[b]=a.gamepad_axes[b],a.gamepad_axes[b]=0}function l(a,b){var c=a.indexOf(b);0<=c&&(a[c]=null)}function t(a){return null===a}function F(a,b,c,d){switch(b){case 120:c&&l(a.orientation_quat_cb_list,c);if(d||a.orientation_angles_cb_list.every(t)&&
a.orientation_quat_cb_list.every(t))a.orientation_quat_cb_list.length=0,a.orientation_angles_cb_list.length=0,b=a.registered_event_listeners.indexOf(131),0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("deviceorientation",C,!1));break;case 130:c&&l(a.orientation_angles_cb_list,c);if(d||a.orientation_angles_cb_list.every(t)&&a.orientation_quat_cb_list.every(t))a.orientation_quat_cb_list.length=0,a.orientation_angles_cb_list.length=0,b=a.registered_event_listeners.indexOf(131),
0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("deviceorientation",C,!1));break;case 40:c&&l(a.mouse_down_which_cb_list,c);if(d||a.mouse_down_which_cb_list.every(t))a.mouse_down_which_cb_list.length=0,b=a.registered_event_listeners.indexOf(b),0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("mousedown",z,!1));break;case 30:c&&l(a.mouse_location_cb_list,c);if(d||a.mouse_location_cb_list.every(t))a.mouse_location_cb_list.length=0,b=a.registered_event_listeners.indexOf(b),
0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("mousemove",y,!1));break;case 50:c&&l(a.mouse_up_which_cb_list,c);if(d||a.mouse_up_which_cb_list.every(t)){a.mouse_up_which_cb_list.length=0;b=a.registered_event_listeners.indexOf(b);0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("mouseout",E,!1),a.element.removeEventListener("mouseup",e,!1));break}break;case 60:c&&l(a.mouse_wheel_cb_list,c);if(d||a.mouse_wheel_cb_list.every(t))a.mouse_wheel_cb_list.length=
0,b=a.registered_event_listeners.indexOf(b),0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("wheel",n,!1));break;case 80:c&&l(a.keyboard_down_cb_list,c);if(d||a.keyboard_down_cb_list.every(t))a.keyboard_down_cb_list.length=0,b=a.registered_event_listeners.indexOf(b),0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("keydown",M,!1));break;case 70:c&&l(a.keyboard_up_cb_list,c);if(d||a.keyboard_up_cb_list.every(t))a.keyboard_up_cb_list.length=
0,b=a.registered_event_listeners.indexOf(b),0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("keyup",D,!1));break;case 90:c&&l(a.touch_start_cb_list,c);if(d||a.touch_start_cb_list.every(t))a.touch_start_cb_list.length=0,b=a.registered_event_listeners.indexOf(b),0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("touchstart",G,!1));break;case 100:c&&l(a.touch_move_cb_list,c);if(d||a.touch_move_cb_list.every(t))a.touch_move_cb_list.length=0,b=
a.registered_event_listeners.indexOf(b),0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("touchmove",Q,!1));break;case 110:if(c&&l(a.touch_end_cb_list,c),d||a.touch_end_cb_list.every(t))a.touch_end_cb_list.length=0,b=a.registered_event_listeners.indexOf(b),0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("touchend",v,!1))}}function H(a,b){N.ordered_angles_to_quat(a,N.ZXY,b);var c="orientation"in window?N.deg_to_rad(window.orientation):"orientation"in
window.screen?N.deg_to_rad(window.screen.orientation.angle):0,c=B.setAxisAngle(N.AXIS_Z,-c,ga);B.multiply(b,c,b);c=B.setAxisAngle(N.AXIS_X,-Math.PI/2,ga);B.multiply(c,b,b);c=B.setAxisAngle(N.AXIS_X,Math.PI/2,ga);B.multiply(b,c,b);return b}function C(a){var c=aa;null===a.alpha||null===a.beta||null===a.gamma?c[0]=c[1]=c[2]=0:(c[0]=N.deg_to_rad(a.alpha),c[1]=N.deg_to_rad(a.beta),c[2]=N.deg_to_rad(a.gamma));a=b(10,a.currentTarget);for(var d=0;d<a.orientation_angles_cb_list.length;d++){var e=a.orientation_angles_cb_list[d];
e&&(J.copy(c,da),e(da))}if(a.orientation_quat_cb_list.length)for(c=H(c,ca),d=0;d<a.orientation_quat_cb_list.length;d++)if(e=a.orientation_quat_cb_list[d])B.copy(c,ta),e(ta);for(d=0;d<a.orientation_quat_cb_list.length;d++)a.orientation_quat_cb_list[d]||a.orientation_quat_cb_list.splice(d,1);for(d=0;d<a.orientation_angles_cb_list.length;d++)a.orientation_angles_cb_list[d]||a.orientation_angles_cb_list.splice(d,1)}function x(a,b){switch(a.type){case 30:a.mouse_location[0]=b.clientX,a.mouse_location[1]=
b.clientY,a.mouse_which=b.which}}function y(a){var c=b(30,a.currentTarget);x(c,a);for(var d=0;d<c.mouse_location_cb_list.length;d++){var e=c.mouse_location_cb_list[d];e&&(ia[0]=a.clientX,ia[1]=a.clientY,e(ia))}c.prevent_default&&a.preventDefault();for(d=0;d<c.mouse_location_cb_list.length;d++)c.mouse_location_cb_list[d]||c.mouse_location_cb_list.splice(d,1)}function z(a){var c=b(30,a.currentTarget);x(c,a);for(var d=0;d<c.mouse_down_which_cb_list.length;d++){var e=c.mouse_down_which_cb_list[d];e&&
e(a.which)}c.prevent_default&&a.preventDefault();for(d=0;d<c.mouse_down_which_cb_list.length;d++)c.mouse_down_which_cb_list[d]||c.mouse_down_which_cb_list.splice(d,1)}function E(a){S.is_child(a.relatedTarget)||e(a)}function e(a){var c=b(30,a.currentTarget);x(c,a);for(var d=0;d<c.mouse_up_which_cb_list.length;d++){var e=c.mouse_up_which_cb_list[d];e&&e(a.which)}c.prevent_default&&a.preventDefault();for(d=0;d<c.mouse_up_which_cb_list.length;d++)c.mouse_up_which_cb_list[d]||c.mouse_up_which_cb_list.splice(d,
1)}function n(a){for(var c=b(30,a.currentTarget),d=0;d<c.mouse_wheel_cb_list.length;d++){var e=c.mouse_wheel_cb_list[d];e&&e(-a.deltaY)}c.prevent_default&&a.preventDefault();for(d=0;d<c.mouse_wheel_cb_list.length;d++)c.mouse_wheel_cb_list[d]||c.mouse_wheel_cb_list.splice(d,1)}function M(a){for(var c=b(40,a.currentTarget),d=0;d<c.keyboard_down_cb_list.length;d++){var e=c.keyboard_down_cb_list[d];e&&e(a.keyCode)}c.prevent_default&&a.preventDefault();for(d=0;d<c.keyboard_down_cb_list.length;d++)c.keyboard_down_cb_list[d]||
c.keyboard_down_cb_list.splice(d,1)}function D(a){for(var c=b(40,a.currentTarget),d=0;d<c.keyboard_up_cb_list.length;d++){var e=c.keyboard_up_cb_list[d];e&&e(a.keyCode)}c.prevent_default&&a.preventDefault();for(d=0;d<c.keyboard_up_cb_list.length;d++)c.keyboard_up_cb_list[d]||c.keyboard_up_cb_list.splice(d,1)}function G(a){for(var c=b(50,a.currentTarget),d=0;d<c.touch_start_cb_list.length;d++){var e=c.touch_start_cb_list[d];e&&e(a.targetTouches)}for(d=0;d<c.touch_start_cb_list.length;d++)c.touch_start_cb_list[d]||
c.touch_start_cb_list.splice(d,1)}function Q(a){for(var c=b(50,a.currentTarget),d=0;d<c.touch_move_cb_list.length;d++){var e=c.touch_move_cb_list[d];e&&e(a.targetTouches)}c.prevent_default&&a.preventDefault();for(d=0;d<c.touch_move_cb_list.length;d++)c.touch_move_cb_list[d]||c.touch_move_cb_list.splice(d,1)}function v(a){for(var c=b(50,a.currentTarget),d=0;d<c.touch_end_cb_list.length;d++){var e=c.touch_end_cb_list[d];e&&e(a.targetTouches)}for(d=0;d<c.touch_end_cb_list.length;d++)c.touch_end_cb_list[d]||
c.touch_end_cb_list.splice(d,1)}function P(a){switch(a){case 0:a=60;break;case 1:a=70;break;case 2:a=80;break;case 3:a=90;break;default:a=60}return a}var S=r("__container"),I=r("__config"),K=r("__print"),B=r("__quat"),N=r("__util"),J=r("__vec3"),X=r("__vec4"),O=I.defaults,ba=I.hmd_params;a.DEVICE_GYRO=10;a.DEVICE_HMD=20;a.DEVICE_MOUSE=30;a.DEVICE_KEYBOARD=40;a.DEVICE_TOUCH=50;a.DEVICE_GAMEPAD0=60;a.DEVICE_GAMEPAD1=70;a.DEVICE_GAMEPAD2=80;a.DEVICE_GAMEPAD3=90;a.HMD_WEBVR_DESKTOP=0;a.HMD_WEBVR_MOBILE=
1;a.HMD_NON_WEBVR=2;a.HMD_WEBVR_TYPE=0;a.HMD_ORIENTATION_QUAT=10;a.HMD_POSITION=20;a.HMD_FOV_LEFT=21;a.HMD_FOV_RIGHT=22;a.HMD_EYE_DISTANCE=23;a.HMD_DISTORTION=24;a.HMD_BASELINE_DIST=25;a.HMD_SCREEN_LENSE_DIST=26;a.HMD_SCREEN_WIDTH=27;a.HMD_SCREEN_HEIGHT=28;a.HMD_BEVEL_SIZE=29;a.MOUSE_LOCATION=30;a.MOUSE_DOWN_WHICH=40;a.MOUSE_UP_WHICH=50;a.MOUSE_WHEEL=60;a.KEYBOARD_UP=70;a.KEYBOARD_DOWN=80;a.TOUCH_START=90;a.TOUCH_MOVE=100;a.TOUCH_END=110;a.GYRO_ORIENTATION_QUAT=120;a.GYRO_ORIENTATION_ANGLES=130;a.GMPD_BUTTON_0=
0;a.GMPD_BUTTON_1=1;a.GMPD_BUTTON_2=2;a.GMPD_BUTTON_3=3;a.GMPD_BUTTON_4=4;a.GMPD_BUTTON_5=5;a.GMPD_BUTTON_6=6;a.GMPD_BUTTON_7=7;a.GMPD_BUTTON_8=8;a.GMPD_BUTTON_9=9;a.GMPD_BUTTON_10=10;a.GMPD_BUTTON_11=11;a.GMPD_BUTTON_12=12;a.GMPD_BUTTON_13=13;a.GMPD_BUTTON_14=14;a.GMPD_BUTTON_15=15;a.GMPD_BUTTON_16=16;a.GMPD_BUTTON_17=17;a.GMPD_BUTTON_18=18;a.GMPD_BUTTON_19=19;a.GMPD_BUTTON_20=20;a.GMPD_BUTTON_21=21;a.GMPD_BUTTON_22=22;a.GMPD_BUTTON_23=23;a.GMPD_BUTTON_24=24;a.GMPD_BUTTON_25=25;a.GMPD_AXIS_0=26;
a.GMPD_AXIS_1=27;a.GMPD_AXIS_2=28;a.GMPD_AXIS_3=29;a.GMPD_AXIS_4=30;a.GMPD_AXIS_5=31;a.GMPD_AXIS_6=32;a.GMPD_AXIS_7=33;a.GMPD_AXIS_8=34;a.GMPD_AXIS_9=35;a.GMPD_AXIS_10=36;a.GMPD_AXIS_11=37;var ca=B.create(),ga=B.create(),aa=J.create(),ia=new Float32Array(2);J.create();var da=J.create(),ta=B.create(),fa=[];a.can_use_device=u;a.get_device_by_type_element=b;a.switch_prevent_default=function(a,b){a.prevent_default=b};a.reset_device=function(a){switch(a.type){case 20:if(a.registered&&a.webvr_sensor_devices)for(var b=
0;b<a.webvr_sensor_devices.length;b++)a.webvr_sensor_devices[b].resetSensor();break;default:K.error("reset_device() is undefined for device: ",a.type)}};a.get_vector_param=function(a,b,c){switch(b){case 10:a:switch(a.type){case 20:J.copy(N.VEC3_UNIT,c);if(a.webvr_sensor_devices)for(b=0;b<a.webvr_sensor_devices.length;b++){var d=a.webvr_sensor_devices[b],d=d.getState&&d.getState()||d.getImmediateState&&d.getImmediateState();d.orientation&&(c[0]=d.orientation.x,c[1]=d.orientation.y,c[2]=d.orientation.z,
c[3]=d.orientation.w)}B.normalize(c,c);a=B.setAxisAngle(N.AXIS_X,Math.PI/2,ca);B.multiply(c,a,c);break a;default:K.error("orientation_quat is undefined for device: ",a.type)}return c;case 20:a:switch(a.type){case 20:if(a.webvr_sensor_devices)for(b=0;b<a.webvr_sensor_devices.length;b++)d=a.webvr_sensor_devices[b],d=d.getState&&d.getState()||d.getImmediateState&&d.getImmediateState(),d.position&&(c[0]=d.position.x,c[1]=d.position.y,c[2]=d.position.z);break a;default:K.error("position is undefined for device: ",
a.type)}return c;case 21:return f(a,"left",c);case 22:return f(a,"right",c);case 30:return c[0]=a.mouse_location[0],c[1]=a.mouse_location[1],c}};a.get_value_param=function(a,b){switch(b){case 0:return 20==a.type&&navigator.getVRDevices?O.is_mobile_device?1:0:2;case 23:if(a.webvr_hmd_device){var c=a.webvr_hmd_device.getEyeParameters("left");return a.webvr_hmd_device.getEyeParameters("right").eyeTranslation.x-c.eyeTranslation.x}return a.inter_lens_dist}};a.set_config=function(a,b,c){switch(a.type){case 20:switch(b){case 24:a.distortion_coefs[0]=
c[0];a.distortion_coefs[1]=c[1];break;case 23:a.inter_lens_dist=c;k(a);break;case 25:a.base_line_dist=c;k(a);break;case 26:a.screen_to_lens_dist=c;k(a);break;case 27:a.width_dist=c;k(a);break;case 28:a.height_dist=c;k(a);break;case 29:a.bevel_size=c;k(a);break}case 60:case 70:case 80:case 90:a.gamepad_mapping[b]=c}};a.get_gamepad_btn_value=function(a,b){return b<a.gamepad_btns.length?a.gamepad_btns[a.gamepad_mapping[b]]:!1};a.get_gamepad_axis_value=function(a,b){return b-26<a.gamepad_axes.length?
a.gamepad_axes[a.gamepad_mapping[b]-26]:0};a.update=function(){for(var a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],b=0;b<fa.length;b++){var c=fa[b];switch(c.type){case 60:m(c);g(a[0],c);break;case 70:m(c);g(a[1],c);break;case 80:m(c);g(a[2],c);break;case 90:m(c);g(a[3],c);break;case 20:w(c)}}};a.attach_param_cb=function(a,b,c){switch(b){case 120:a.orientation_quat_cb_list.push(c);b=131;break;case 130:a.orientation_angles_cb_list.push(c);
b=131;break;case 40:a.mouse_down_which_cb_list.push(c);break;case 30:a.mouse_location_cb_list.push(c);break;case 50:a.mouse_up_which_cb_list.push(c);break;case 60:a.mouse_wheel_cb_list.push(c);break;case 80:a.keyboard_down_cb_list.push(c);break;case 70:a.keyboard_up_cb_list.push(c);break;case 90:a.touch_start_cb_list.push(c);break;case 100:a.touch_move_cb_list.push(c);break;case 110:a.touch_end_cb_list.push(c)}if(-1==a.registered_event_listeners.indexOf(b)&&(a.registered_event_listeners.push(b),a.registered))switch(b){case 40:a.element.addEventListener("mousedown",
z,!1);break;case 30:a.element.addEventListener("mousemove",y,!1);break;case 50:a.element!=window&&a.element.addEventListener("mouseout",e,!1);a.element.addEventListener("mouseup",e,!1);break;case 60:a.element.addEventListener("wheel",n,!1);break;case 80:a.element.addEventListener("keydown",M,!1);break;case 70:a.element.addEventListener("keyup",D,!1);break;case 90:a.element.addEventListener("touchstart",G,!1);break;case 100:a.element.addEventListener("touchmove",Q,!1);break;case 110:a.element.addEventListener("touchend",
v,!1);break;case 131:a.element.addEventListener("deviceorientation",C,!1)}};a.detach_param_cb=function(a,b,c){F(a,b,c,!1,!1)};a.gyro_angles_to_quat=H;a.cleanup=function(){for(var a=0;a<fa.length;a++)for(var b=fa[a],c=0;c<b.registered_event_listeners.length;c++)F(b,b.registered_event_listeners[c],null,!0);fa.length=0};a.get_pressed_gmpd_btn=function(a){a=P(a);a=b(a);for(var c=0;c<a.gamepad_btns.length;c++)if(a.gamepad_btns[c])return c;return-1};a.get_moved_gmpd_axis=function(a){a=P(a);a=b(a);for(var c=
0;c<a.gamepad_axes.length;c++)if(a.gamepad_prev_axes[c]-a.gamepad_axes[c])return c+26;return-1};a.get_first_gmpd_id=function(){for(var a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],b=0;b<a.length;b++)if(a[b])return b;return 0}};b4w.module.__vec3=function(a,r){var u="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new u(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var c=new u(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.fromValues=function(a,c,d){var q=new u(3);q[0]=a;q[1]=c;q[2]=d;return q};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.set=function(a,c,d,q){q[0]=a;q[1]=c;q[2]=d;return q};a.add=function(a,c,d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];
return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],
c[2]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;return d};a.scaleAndAdd=function(a,c,d,q){q[0]=a[0]+c[0]*d;q[1]=a[1]+c[1]*d;q[2]=a[2]+c[2]*d;return q};a.distance=function(a,c){var d=c[0]-a[0],q=c[1]-a[1],k=c[2]-a[2];return Math.sqrt(d*d+q*q+k*k)};a.dist=a.distance;a.squaredDistance=function(a,c){var d=c[0]-a[0],q=c[1]-a[1],k=c[2]-a[2];return d*d+q*q+k*k};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1];a=a[2];return Math.sqrt(c*c+d*d+a*a)};a.len=a.length;
a.squaredLength=function(a){var c=a[0],d=a[1];a=a[2];return c*c+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];return c};a.normalize=function(a,c){var d=a[0],q=a[1],k=a[2],d=d*d+q*q+k*k;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};a.cross=function(a,c,d){var q=a[0],k=a[1];a=a[2];var p=c[0],f=c[1];c=c[2];
d[0]=k*c-a*f;d[1]=a*p-q*c;d[2]=q*f-k*p;return d};a.lerp=function(a,c,d,q){var k=a[0],p=a[1];a=a[2];q[0]=k+d*(c[0]-k);q[1]=p+d*(c[1]-p);q[2]=a+d*(c[2]-a);return q};a.hermite=function(a,c,d,q,k,p){var f=k*k,w=f*(2*k-3)+1,g=f*(k-2)+k,m=f*(k-1);k=f*(3-2*k);p[0]=a[0]*w+c[0]*g+d[0]*m+q[0]*k;p[1]=a[1]*w+c[1]*g+d[1]*m+q[1]*k;p[2]=a[2]*w+c[2]*g+d[2]*m+q[2]*k;return p};a.bezier=function(a,c,d,q,k,p){var f=1-k,w=f*f,g=k*k,m=w*f,w=3*k*w,f=3*g*f;k*=g;p[0]=a[0]*m+c[0]*w+d[0]*f+q[0]*k;p[1]=a[1]*m+c[1]*w+d[1]*f+
q[1]*k;p[2]=a[2]*m+c[2]*w+d[2]*f+q[2]*k;return p};a.random=function(a,h){a=a||1;var d=2*c()*Math.PI,q=2*c()-1,k=Math.sqrt(1-q*q)*a;h[0]=Math.cos(d)*k;h[1]=Math.sin(d)*k;h[2]=q*a;return h};a.transformMat4=function(a,c,d){var q=a[0],k=a[1];a=a[2];var p=c[3]*q+c[7]*k+c[11]*a+c[15],p=p||1;d[0]=(c[0]*q+c[4]*k+c[8]*a+c[12])/p;d[1]=(c[1]*q+c[5]*k+c[9]*a+c[13])/p;d[2]=(c[2]*q+c[6]*k+c[10]*a+c[14])/p;return d};a.transformMat3=function(a,c,d){var q=a[0],k=a[1];a=a[2];d[0]=q*c[0]+k*c[3]+a*c[6];d[1]=q*c[1]+k*
c[4]+a*c[7];d[2]=q*c[2]+k*c[5]+a*c[8];return d};a.transformQuat=function(a,c,d){var q=a[0],k=a[1],p=a[2];a=c[0];var f=c[1],w=c[2];c=c[3];var g=c*q+f*p-w*k,m=c*k+w*q-a*p,l=c*p+a*k-f*q,q=-a*q-f*k-w*p;d[0]=g*c+q*-a+m*-w-l*-f;d[1]=m*c+q*-f+l*-a-g*-w;d[2]=l*c+q*-w+g*-f-m*-a;return d};a.rotateX=function(a,c,d,q){var k=[],p=[];k[0]=a[0]-c[0];k[1]=a[1]-c[1];k[2]=a[2]-c[2];p[0]=k[0];p[1]=k[1]*Math.cos(d)-k[2]*Math.sin(d);p[2]=k[1]*Math.sin(d)+k[2]*Math.cos(d);q[0]=p[0]+c[0];q[1]=p[1]+c[1];q[2]=p[2]+c[2];return q};
a.rotateY=function(a,c,d,q){var k=[],p=[];k[0]=a[0]-c[0];k[1]=a[1]-c[1];k[2]=a[2]-c[2];p[0]=k[2]*Math.sin(d)+k[0]*Math.cos(d);p[1]=k[1];p[2]=k[2]*Math.cos(d)-k[0]*Math.sin(d);q[0]=p[0]+c[0];q[1]=p[1]+c[1];q[2]=p[2]+c[2];return q};a.rotateZ=function(a,c,d,q){var k=[],p=[];k[0]=a[0]-c[0];k[1]=a[1]-c[1];k[2]=a[2]-c[2];p[0]=k[0]*Math.cos(d)-k[1]*Math.sin(d);p[1]=k[0]*Math.sin(d)+k[1]*Math.cos(d);p[2]=k[2];q[0]=p[0]+c[0];q[1]=p[1]+c[1];q[2]=p[2]+c[2];return q};a.forEach=function(){var b=a.create();return function(a,
c,q,k,p,f){c||(c=3);q||(q=0);for(k=k?Math.min(k*c+q,a.length):a.length;q<k;q+=c)b[0]=a[q],b[1]=a[q+1],b[2]=a[q+2],p(b,f,b),a[q]=b[0],a[q+1]=b[1],a[q+2]=b[2];return a}}();a.angle=function(b,c){var d=a.fromValues(b[0],b[1],b[2]),q=a.fromValues(c[0],c[1],c[2]);a.normalize(d,d);a.normalize(q,q);d=a.dot(d,q);return 1<d?0:Math.acos(d)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"}};b4w.module.vec3=b4w.module.__vec3;
b4w.module.__vec4=function(a,r){var u="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new u(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var c=new u(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.fromValues=function(a,c,d,q){var k=new u(4);k[0]=a;k[1]=c;k[2]=d;k[3]=q;return k};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.set=function(a,c,d,q,k){k[0]=a;k[1]=c;k[2]=d;k[3]=q;return k};a.add=function(a,c,
d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3]+c[3];return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];d[3]=a[3]-c[3];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];d[3]=a[3]*c[3];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];d[3]=a[3]/c[3];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],
c[2]);d[3]=Math.min(a[3],c[3]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);d[3]=Math.max(a[3],c[3]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;d[3]=a[3]*c;return d};a.scaleAndAdd=function(a,c,d,q){q[0]=a[0]+c[0]*d;q[1]=a[1]+c[1]*d;q[2]=a[2]+c[2]*d;q[3]=a[3]+c[3]*d;return q};a.distance=function(a,c){var d=c[0]-a[0],q=c[1]-a[1],k=c[2]-a[2],p=c[3]-a[3];return Math.sqrt(d*d+q*q+k*k+p*p)};a.dist=a.distance;a.squaredDistance=
function(a,c){var d=c[0]-a[0],q=c[1]-a[1],k=c[2]-a[2],p=c[3]-a[3];return d*d+q*q+k*k+p*p};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1],q=a[2];a=a[3];return Math.sqrt(c*c+d*d+q*q+a*a)};a.len=a.length;a.squaredLength=function(a){var c=a[0],d=a[1],q=a[2];a=a[3];return c*c+d*d+q*q+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];c[3]=1/a[3];return c};a.normalize=
function(a,c){var d=a[0],q=a[1],k=a[2],p=a[3],f=d*d+q*q+k*k+p*p;0<f&&(f=1/Math.sqrt(f),c[0]=d*f,c[1]=q*f,c[2]=k*f,c[3]=p*f);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};a.lerp=function(a,c,d,q){var k=a[0],p=a[1],f=a[2];a=a[3];q[0]=k+d*(c[0]-k);q[1]=p+d*(c[1]-p);q[2]=f+d*(c[2]-f);q[3]=a+d*(c[3]-a);return q};a.random=function(b,h){b=b||1;h[0]=c();h[1]=c();h[2]=c();h[3]=c();a.normalize(h,h);a.scale(h,b,h);return h};a.transformMat4=function(a,c,d){var q=a[0],k=a[1],p=
a[2];a=a[3];d[0]=c[0]*q+c[4]*k+c[8]*p+c[12]*a;d[1]=c[1]*q+c[5]*k+c[9]*p+c[13]*a;d[2]=c[2]*q+c[6]*k+c[10]*p+c[14]*a;d[3]=c[3]*q+c[7]*k+c[11]*p+c[15]*a;return d};a.transformQuat=function(a,c,d){var q=a[0],k=a[1],p=a[2],f=c[0],w=c[1],g=c[2];c=c[3];var m=c*q+w*p-g*k,l=c*k+g*q-f*p,t=c*p+f*k-w*q,q=-f*q-w*k-g*p;d[0]=m*c+q*-f+l*-g-t*-w;d[1]=l*c+q*-w+t*-f-m*-g;d[2]=t*c+q*-g+m*-w-l*-f;d[3]=a[3];return d};a.forEach=function(){var b=a.create();return function(a,c,q,k,p,f){c||(c=4);q||(q=0);for(k=k?Math.min(k*
c+q,a.length):a.length;q<k;q+=c)b[0]=a[q],b[1]=a[q+1],b[2]=a[q+2],b[3]=a[q+3],p(b,f,b),a[q]=b[0],a[q+1]=b[1],a[q+2]=b[2],a[q+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"}};b4w.module.vec4=b4w.module.__vec4;
b4w.module.__quat=function(a,r){var u=r("__vec3"),c=r("__vec4"),b=r("__mat3"),h="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new h(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=u.create(),c=u.fromValues(1,0,0),k=u.fromValues(0,1,0);return function(h,f,w){var g=u.dot(h,f);if(-.9999999>g)return u.cross(c,h,b),1E-6>u.length(b)&&u.cross(k,h,b),u.normalize(b,b),a.setAxisAngle(b,Math.PI,w),w;if(.9999999<g)return w[0]=0,w[1]=0,w[2]=0,w[3]=1,w;u.cross(h,
f,b);w[0]=b[0];w[1]=b[1];w[2]=b[2];w[3]=1+g;return a.normalize(w,w)}}();a.setAxes=function(){var c=b.create();return function(b,k,h,f){c[0]=k[0];c[3]=k[1];c[6]=k[2];c[1]=h[0];c[4]=h[1];c[7]=h[2];c[2]=-b[0];c[5]=-b[1];c[8]=-b[2];return a.normalize(a.fromMat3(c,f),f)}}();a.clone=c.clone;a.fromValues=c.fromValues;a.copy=c.copy;a.set=c.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var h=Math.sin(b);c[0]=h*a[0];c[1]=h*a[1];c[2]=h*a[2];c[3]=Math.cos(b);
return c};a.add=c.add;a.multiply=function(a,b,c){var h=a[0],f=a[1],w=a[2];a=a[3];var g=b[0],m=b[1],l=b[2];b=b[3];c[0]=h*b+a*g+f*l-w*m;c[1]=f*b+a*m+w*g-h*l;c[2]=w*b+a*l+h*m-f*g;c[3]=a*b-h*g-f*m-w*l;return c};a.mul=a.multiply;a.scale=c.scale;a.rotateX=function(a,b,c){b*=.5;var h=a[0],f=a[1],w=a[2];a=a[3];var g=Math.sin(b);b=Math.cos(b);c[0]=h*b+a*g;c[1]=f*b+w*g;c[2]=w*b-f*g;c[3]=a*b-h*g;return c};a.rotateY=function(a,b,c){b*=.5;var h=a[0],f=a[1],w=a[2];a=a[3];var g=Math.sin(b);b=Math.cos(b);c[0]=h*
b-w*g;c[1]=f*b+a*g;c[2]=w*b+h*g;c[3]=a*b-f*g;return c};a.rotateZ=function(a,b,c){b*=.5;var h=a[0],f=a[1],w=a[2];a=a[3];var g=Math.sin(b);b=Math.cos(b);c[0]=h*b+f*g;c[1]=f*b-h*g;c[2]=w*b+a*g;c[3]=a*b-w*g;return c};a.calculateW=function(a,b){var c=a[0],h=a[1],f=a[2];b[0]=c;b[1]=h;b[2]=f;b[3]=Math.sqrt(Math.abs(1-c*c-h*h-f*f));return b};a.dot=c.dot;a.lerp=c.lerp;a.slerp=function(a,b,c,h){var f=a[0],w=a[1],g=a[2];a=a[3];var m=b[0],l=b[1],t=b[2];b=b[3];var r,u,C;u=f*m+w*l+g*t+a*b;0>u&&(u=-u,m=-m,l=-l,
t=-t,b=-b);1E-6<1-u?(r=Math.acos(u),C=Math.sin(r),u=Math.sin((1-c)*r)/C,c=Math.sin(c*r)/C):u=1-c;h[0]=u*f+c*m;h[1]=u*w+c*l;h[2]=u*g+c*t;h[3]=u*a+c*b;return h};a.sqlerp=function(){var b=a.create(),c=a.create();return function(h,p,f,w,g,m){a.slerp(h,w,g,b);a.slerp(p,f,g,c);a.slerp(b,c,2*g*(1-g),m);return m}}();a.invert=function(a,b){var c=a[0],h=a[1],f=a[2],w=a[3],g=c*c+h*h+f*f+w*w,g=g?1/g:0;b[0]=-c*g;b[1]=-h*g;b[2]=-f*g;b[3]=w*g;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];
b[3]=a[3];return b};a.length=c.length;a.len=a.length;a.squaredLength=c.squaredLength;a.sqrLen=a.squaredLength;a.normalize=c.normalize;a.fromMat3=function(a,b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var h=0;a[4]>a[0]&&(h=1);a[8]>a[3*h+h]&&(h=2);var f=(h+1)%3,w=(h+2)%3,c=Math.sqrt(a[3*h+h]-a[3*f+f]-a[3*w+w]+1);b[h]=.5*c;c=.5/c;b[3]=(a[3*f+w]-a[3*w+f])*c;b[f]=(a[3*f+h]+a[3*h+f])*c;b[w]=(a[3*w+h]+a[3*h+w])*c}return b};
a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"}};b4w.module.quat=b4w.module.__quat;
b4w.module.__mat3=function(a,r){var u="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new u(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new u(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];
b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var h=a[1],d=a[2],q=a[5];b[1]=a[3];b[2]=a[6];b[3]=h;b[5]=a[7];b[6]=d;b[7]=q}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var h=a[0],d=a[1],q=a[2],k=a[3],p=a[4],f=a[5],w=a[6],g=a[7],m=a[8],l=m*p-f*g,t=-m*k+f*
w,r=g*k-p*w,u=h*l+d*t+q*r;if(!u)return null;u=1/u;b[0]=l*u;b[1]=(-m*d+q*g)*u;b[2]=(f*d-q*p)*u;b[3]=t*u;b[4]=(m*h-q*w)*u;b[5]=(-f*h+q*k)*u;b[6]=r*u;b[7]=(-g*h+d*w)*u;b[8]=(p*h-d*k)*u;return b};a.adjoint=function(a,b){var h=a[0],d=a[1],q=a[2],k=a[3],p=a[4],f=a[5],w=a[6],g=a[7],m=a[8];b[0]=p*m-f*g;b[1]=q*g-d*m;b[2]=d*f-q*p;b[3]=f*w-k*m;b[4]=h*m-q*w;b[5]=q*k-h*f;b[6]=k*g-p*w;b[7]=d*w-h*g;b[8]=h*p-d*k;return b};a.determinant=function(a){var b=a[3],h=a[4],d=a[5],q=a[6],k=a[7],p=a[8];return a[0]*(p*h-d*
k)+a[1]*(-p*b+d*q)+a[2]*(k*b-h*q)};a.multiply=function(a,b,h){var d=a[0],q=a[1],k=a[2],p=a[3],f=a[4],w=a[5],g=a[6],m=a[7];a=a[8];var l=b[0],t=b[1],r=b[2],u=b[3],C=b[4],x=b[5],y=b[6],z=b[7];b=b[8];h[0]=l*d+t*p+r*g;h[1]=l*q+t*f+r*m;h[2]=l*k+t*w+r*a;h[3]=u*d+C*p+x*g;h[4]=u*q+C*f+x*m;h[5]=u*k+C*w+x*a;h[6]=y*d+z*p+b*g;h[7]=y*q+z*f+b*m;h[8]=y*k+z*w+b*a;return h};a.mul=a.multiply;a.translate=function(a,b,h){var d=a[0],q=a[1],k=a[2],p=a[3],f=a[4],w=a[5],g=a[6],m=a[7];a=a[8];var l=b[0];b=b[1];h[0]=d;h[1]=
q;h[2]=k;h[3]=p;h[4]=f;h[5]=w;h[6]=l*d+b*p+g;h[7]=l*q+b*f+m;h[8]=l*k+b*w+a;return h};a.rotate=function(a,b,h){var d=a[0],q=a[1],k=a[2],p=a[3],f=a[4],w=a[5],g=a[6],m=a[7];a=a[8];var l=Math.sin(b);b=Math.cos(b);h[0]=b*d+l*p;h[1]=b*q+l*f;h[2]=b*k+l*w;h[3]=b*p-l*d;h[4]=b*f-l*q;h[5]=b*w-l*k;h[6]=g;h[7]=m;h[8]=a;return h};a.scale=function(a,b,h){var d=b[0];b=b[1];h[0]=d*a[0];h[1]=d*a[1];h[2]=d*a[2];h[3]=b*a[3];h[4]=b*a[4];h[5]=b*a[5];h[6]=a[6];h[7]=a[7];h[8]=a[8];return h};a.fromTranslation=function(a,
b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.fromRotation=function(a,b){var h=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=h;b[2]=0;b[3]=-h;b[4]=d;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromScaling=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var h=a[0],d=a[1],q=a[2],k=a[3],p=h+
h,f=d+d,w=q+q,h=h*p,g=d*p,d=d*f,m=q*p,l=q*f,q=q*w,p=k*p,f=k*f,k=k*w;b[0]=1-d-q;b[3]=g-k;b[6]=m+f;b[1]=g+k;b[4]=1-h-q;b[7]=l-p;b[2]=m-f;b[5]=l+p;b[8]=1-h-d;return b};a.normalFromMat4=function(a,b){var h=a[0],d=a[1],q=a[2],k=a[3],p=a[4],f=a[5],w=a[6],g=a[7],m=a[8],l=a[9],t=a[10],r=a[11],u=a[12],C=a[13],x=a[14],y=a[15],z=h*f-d*p,E=h*w-q*p,e=h*g-k*p,n=d*w-q*f,M=d*g-k*f,D=q*g-k*w,G=m*C-l*u,Q=m*x-t*u,m=m*y-r*u,v=l*x-t*C,l=l*y-r*C,t=t*y-r*x,r=z*t-E*l+e*v+n*m-M*Q+D*G;if(!r)return null;r=1/r;b[0]=(f*t-w*l+
g*v)*r;b[1]=(w*m-p*t-g*Q)*r;b[2]=(p*l-f*m+g*G)*r;b[3]=(q*l-d*t-k*v)*r;b[4]=(h*t-q*m+k*Q)*r;b[5]=(d*m-h*l-k*G)*r;b[6]=(C*D-x*M+y*n)*r;b[7]=(x*e-u*D-y*E)*r;b[8]=(u*M-C*e+y*z)*r;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))}};
b4w.module.mat3=b4w.module.__mat3;
b4w.module.__mat4=function(a,r){var u="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new u(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new u(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];
b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var h=a[1],d=a[2],q=a[3],k=a[6],p=a[7],f=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=h;b[6]=a[9];b[7]=a[13];b[8]=d;b[9]=k;b[11]=a[14];b[12]=q;b[13]=
p;b[14]=f}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var h=a[0],d=a[1],q=a[2],k=a[3],p=a[4],f=a[5],w=a[6],g=a[7],m=a[8],l=a[9],t=a[10],r=a[11],u=a[12],C=a[13],x=a[14],y=a[15],z=h*f-d*p,E=h*w-q*p,e=h*g-k*p,n=d*w-q*f,M=d*g-k*f,D=q*g-k*w,G=m*C-l*u,Q=m*x-t*u,v=m*y-r*u,P=l*x-t*C,S=l*y-r*C,I=t*y-r*x,K=z*I-E*S+e*P+n*v-M*Q+D*G;if(!K)return null;
K=1/K;b[0]=(f*I-w*S+g*P)*K;b[1]=(q*S-d*I-k*P)*K;b[2]=(C*D-x*M+y*n)*K;b[3]=(t*M-l*D-r*n)*K;b[4]=(w*v-p*I-g*Q)*K;b[5]=(h*I-q*v+k*Q)*K;b[6]=(x*e-u*D-y*E)*K;b[7]=(m*D-t*e+r*E)*K;b[8]=(p*S-f*v+g*G)*K;b[9]=(d*v-h*S-k*G)*K;b[10]=(u*M-C*e+y*z)*K;b[11]=(l*e-m*M-r*z)*K;b[12]=(f*Q-p*P-w*G)*K;b[13]=(h*P-d*Q+q*G)*K;b[14]=(C*E-u*n-x*z)*K;b[15]=(m*n-l*E+t*z)*K;return b};a.adjoint=function(a,b){var h=a[0],d=a[1],q=a[2],k=a[3],p=a[4],f=a[5],w=a[6],g=a[7],m=a[8],l=a[9],t=a[10],r=a[11],u=a[12],C=a[13],x=a[14],y=a[15];
b[0]=f*(t*y-r*x)-l*(w*y-g*x)+C*(w*r-g*t);b[1]=-(d*(t*y-r*x)-l*(q*y-k*x)+C*(q*r-k*t));b[2]=d*(w*y-g*x)-f*(q*y-k*x)+C*(q*g-k*w);b[3]=-(d*(w*r-g*t)-f*(q*r-k*t)+l*(q*g-k*w));b[4]=-(p*(t*y-r*x)-m*(w*y-g*x)+u*(w*r-g*t));b[5]=h*(t*y-r*x)-m*(q*y-k*x)+u*(q*r-k*t);b[6]=-(h*(w*y-g*x)-p*(q*y-k*x)+u*(q*g-k*w));b[7]=h*(w*r-g*t)-p*(q*r-k*t)+m*(q*g-k*w);b[8]=p*(l*y-r*C)-m*(f*y-g*C)+u*(f*r-g*l);b[9]=-(h*(l*y-r*C)-m*(d*y-k*C)+u*(d*r-k*l));b[10]=h*(f*y-g*C)-p*(d*y-k*C)+u*(d*g-k*f);b[11]=-(h*(f*r-g*l)-p*(d*r-k*l)+m*
(d*g-k*f));b[12]=-(p*(l*x-t*C)-m*(f*x-w*C)+u*(f*t-w*l));b[13]=h*(l*x-t*C)-m*(d*x-q*C)+u*(d*t-q*l);b[14]=-(h*(f*x-w*C)-p*(d*x-q*C)+u*(d*w-q*f));b[15]=h*(f*t-w*l)-p*(d*t-q*l)+m*(d*w-q*f);return b};a.determinant=function(a){var b=a[0],h=a[1],d=a[2],q=a[3],k=a[4],p=a[5],f=a[6],r=a[7],g=a[8],m=a[9],l=a[10],t=a[11],u=a[12],H=a[13],C=a[14];a=a[15];return(b*p-h*k)*(l*a-t*C)-(b*f-d*k)*(m*a-t*H)+(b*r-q*k)*(m*C-l*H)+(h*f-d*p)*(g*a-t*u)-(h*r-q*p)*(g*C-l*u)+(d*r-q*f)*(g*H-m*u)};a.multiply=function(a,b,h){var d=
a[0],q=a[1],k=a[2],p=a[3],f=a[4],r=a[5],g=a[6],m=a[7],l=a[8],t=a[9],u=a[10],H=a[11],C=a[12],x=a[13],y=a[14];a=a[15];var z=b[0],E=b[1],e=b[2],n=b[3];h[0]=z*d+E*f+e*l+n*C;h[1]=z*q+E*r+e*t+n*x;h[2]=z*k+E*g+e*u+n*y;h[3]=z*p+E*m+e*H+n*a;z=b[4];E=b[5];e=b[6];n=b[7];h[4]=z*d+E*f+e*l+n*C;h[5]=z*q+E*r+e*t+n*x;h[6]=z*k+E*g+e*u+n*y;h[7]=z*p+E*m+e*H+n*a;z=b[8];E=b[9];e=b[10];n=b[11];h[8]=z*d+E*f+e*l+n*C;h[9]=z*q+E*r+e*t+n*x;h[10]=z*k+E*g+e*u+n*y;h[11]=z*p+E*m+e*H+n*a;z=b[12];E=b[13];e=b[14];n=b[15];h[12]=z*d+
E*f+e*l+n*C;h[13]=z*q+E*r+e*t+n*x;h[14]=z*k+E*g+e*u+n*y;h[15]=z*p+E*m+e*H+n*a;return h};a.mul=a.multiply;a.translate=function(a,b,h){var d=b[0],q=b[1];b=b[2];var k,p,f,r,g,m,l,t,u,H,C,x;a===h?(h[12]=a[0]*d+a[4]*q+a[8]*b+a[12],h[13]=a[1]*d+a[5]*q+a[9]*b+a[13],h[14]=a[2]*d+a[6]*q+a[10]*b+a[14],h[15]=a[3]*d+a[7]*q+a[11]*b+a[15]):(k=a[0],p=a[1],f=a[2],r=a[3],g=a[4],m=a[5],l=a[6],t=a[7],u=a[8],H=a[9],C=a[10],x=a[11],h[0]=k,h[1]=p,h[2]=f,h[3]=r,h[4]=g,h[5]=m,h[6]=l,h[7]=t,h[8]=u,h[9]=H,h[10]=C,h[11]=x,
h[12]=k*d+g*q+u*b+a[12],h[13]=p*d+m*q+H*b+a[13],h[14]=f*d+l*q+C*b+a[14],h[15]=r*d+t*q+x*b+a[15]);return h};a.scale=function(a,b,h){var d=b[0],q=b[1];b=b[2];h[0]=a[0]*d;h[1]=a[1]*d;h[2]=a[2]*d;h[3]=a[3]*d;h[4]=a[4]*q;h[5]=a[5]*q;h[6]=a[6]*q;h[7]=a[7]*q;h[8]=a[8]*b;h[9]=a[9]*b;h[10]=a[10]*b;h[11]=a[11]*b;h[12]=a[12];h[13]=a[13];h[14]=a[14];h[15]=a[15];return h};a.rotate=function(a,b,h,d){var q=h[0],k=h[1];h=h[2];var p=Math.sqrt(q*q+k*k+h*h),f,r,g,m,l,t,u,H,C,x,y,z,E,e,n,M,D,G,Q,v;if(1E-7>Math.abs(p))return null;
p=1/p;q*=p;k*=p;h*=p;f=Math.sin(b);r=Math.cos(b);g=1-r;b=a[0];p=a[1];m=a[2];l=a[3];t=a[4];u=a[5];H=a[6];C=a[7];x=a[8];y=a[9];z=a[10];E=a[11];e=q*q*g+r;n=k*q*g+h*f;M=h*q*g-k*f;D=q*k*g-h*f;G=k*k*g+r;Q=h*k*g+q*f;v=q*h*g+k*f;q=k*h*g-q*f;k=h*h*g+r;d[0]=b*e+t*n+x*M;d[1]=p*e+u*n+y*M;d[2]=m*e+H*n+z*M;d[3]=l*e+C*n+E*M;d[4]=b*D+t*G+x*Q;d[5]=p*D+u*G+y*Q;d[6]=m*D+H*G+z*Q;d[7]=l*D+C*G+E*Q;d[8]=b*v+t*q+x*k;d[9]=p*v+u*q+y*k;d[10]=m*v+H*q+z*k;d[11]=l*v+C*q+E*k;a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);
return d};a.rotateX=function(a,b,h){var d=Math.sin(b);b=Math.cos(b);var q=a[4],k=a[5],p=a[6],f=a[7],r=a[8],g=a[9],m=a[10],l=a[11];a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);h[4]=q*b+r*d;h[5]=k*b+g*d;h[6]=p*b+m*d;h[7]=f*b+l*d;h[8]=r*b-q*d;h[9]=g*b-k*d;h[10]=m*b-p*d;h[11]=l*b-f*d;return h};a.rotateY=function(a,b,h){var d=Math.sin(b);b=Math.cos(b);var q=a[0],k=a[1],p=a[2],f=a[3],r=a[8],g=a[9],m=a[10],l=a[11];a!==h&&(h[4]=a[4],h[5]=a[5],h[6]=a[6],
h[7]=a[7],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);h[0]=q*b-r*d;h[1]=k*b-g*d;h[2]=p*b-m*d;h[3]=f*b-l*d;h[8]=q*d+r*b;h[9]=k*d+g*b;h[10]=p*d+m*b;h[11]=f*d+l*b;return h};a.rotateZ=function(a,b,h){var d=Math.sin(b);b=Math.cos(b);var q=a[0],k=a[1],p=a[2],f=a[3],r=a[4],g=a[5],m=a[6],l=a[7];a!==h&&(h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);h[0]=q*b+r*d;h[1]=k*b+g*d;h[2]=p*b+m*d;h[3]=f*b+l*d;h[4]=r*b-q*d;h[5]=g*b-k*d;h[6]=m*b-p*d;h[7]=l*b-f*d;return h};
a.fromTranslation=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.fromScaling=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotation=function(a,b,h){var d=b[0],q=b[1];b=b[2];var k=Math.sqrt(d*d+q*q+b*b),p;if(1E-7>Math.abs(k))return null;k=1/k;d*=k;q*=k;b*=k;k=Math.sin(a);a=Math.cos(a);
p=1-a;h[0]=d*d*p+a;h[1]=q*d*p+b*k;h[2]=b*d*p-q*k;h[3]=0;h[4]=d*q*p-b*k;h[5]=q*q*p+a;h[6]=b*q*p+d*k;h[7]=0;h[8]=d*b*p+q*k;h[9]=q*b*p-d*k;h[10]=b*b*p+a;h[11]=0;h[12]=0;h[13]=0;h[14]=0;h[15]=1;return h};a.fromXRotation=function(a,b){var h=Math.sin(a),d=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=d;b[6]=h;b[7]=0;b[8]=0;b[9]=-h;b[10]=d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromYRotation=function(a,b){var h=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=0;b[2]=-h;b[3]=0;b[4]=0;b[5]=1;b[6]=
0;b[7]=0;b[8]=h;b[9]=0;b[10]=d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromZRotation=function(a,b){var h=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=h;b[2]=0;b[3]=0;b[4]=-h;b[5]=d;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,h){var d=a[0],q=a[1],k=a[2],p=a[3],f=d+d,r=q+q,g=k+k;a=d*f;var m=d*r,d=d*g,l=q*r,q=q*g,k=k*g,f=p*f,r=p*r,p=p*g;h[0]=1-(l+k);h[1]=m+p;h[2]=d-r;h[3]=0;h[4]=m-p;h[5]=1-(a+k);h[6]=q+f;h[7]=0;h[8]=
d+r;h[9]=q-f;h[10]=1-(a+l);h[11]=0;h[12]=b[0];h[13]=b[1];h[14]=b[2];h[15]=1;return h};a.fromRotationTranslationScale=function(a,b,h,d){var q=a[0],k=a[1],p=a[2],f=a[3],r=q+q,g=k+k,m=p+p;a=q*r;var l=q*g,q=q*m,t=k*g,k=k*m,p=p*m,r=f*r,g=f*g,f=f*m,m=h[0],u=h[1];h=h[2];d[0]=(1-(t+p))*m;d[1]=(l+f)*m;d[2]=(q-g)*m;d[3]=0;d[4]=(l-f)*u;d[5]=(1-(a+p))*u;d[6]=(k+r)*u;d[7]=0;d[8]=(q+g)*h;d[9]=(k-r)*h;d[10]=(1-(a+t))*h;d[11]=0;d[12]=b[0];d[13]=b[1];d[14]=b[2];d[15]=1;return d};a.fromRotationTranslationScaleOrigin=
function(a,b,h,d,q){var k=a[0],p=a[1],f=a[2],r=a[3],g=k+k,m=p+p,l=f+f;a=k*g;var t=k*m,k=k*l,u=p*m,p=p*l,f=f*l,g=r*g,m=r*m,r=r*l,l=h[0],H=h[1];h=h[2];var C=d[0],x=d[1];d=d[2];q[0]=(1-(u+f))*l;q[1]=(t+r)*l;q[2]=(k-m)*l;q[3]=0;q[4]=(t-r)*H;q[5]=(1-(a+f))*H;q[6]=(p+g)*H;q[7]=0;q[8]=(k+m)*h;q[9]=(p-g)*h;q[10]=(1-(a+u))*h;q[11]=0;q[12]=b[0]+C-(q[0]*C+q[4]*x+q[8]*d);q[13]=b[1]+x-(q[1]*C+q[5]*x+q[9]*d);q[14]=b[2]+d-(q[2]*C+q[6]*x+q[10]*d);q[15]=1;return q};a.fromQuat=function(a,b){var h=a[0],d=a[1],q=a[2],
k=a[3],p=h+h,f=d+d,r=q+q,h=h*p,g=d*p,d=d*f,m=q*p,l=q*f,q=q*r,p=k*p,f=k*f,k=k*r;b[0]=1-d-q;b[1]=g+k;b[2]=m-f;b[3]=0;b[4]=g-k;b[5]=1-h-q;b[6]=l+p;b[7]=0;b[8]=m+f;b[9]=l-p;b[10]=1-h-d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,h,d,q,k,p){var f=1/(b-a),r=1/(d-h),g=1/(q-k);p[0]=2*q*f;p[1]=0;p[2]=0;p[3]=0;p[4]=0;p[5]=2*q*r;p[6]=0;p[7]=0;p[8]=(b+a)*f;p[9]=(d+h)*r;p[10]=(k+q)*g;p[11]=-1;p[12]=0;p[13]=0;p[14]=k*q*2*g;p[15]=0;return p};a.perspective=function(a,b,h,d,q){a=1/Math.tan(a/
2);var k=1/(h-d);q[0]=a/b;q[1]=0;q[2]=0;q[3]=0;q[4]=0;q[5]=a;q[6]=0;q[7]=0;q[8]=0;q[9]=0;q[10]=(d+h)*k;q[11]=-1;q[12]=0;q[13]=0;q[14]=2*d*h*k;q[15]=0;return q};a.perspectiveFromFieldOfView=function(a,b,h,d){var q=Math.tan(a.upDegrees*Math.PI/180),k=Math.tan(a.downDegrees*Math.PI/180),p=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);var f=2/(p+a),r=2/(q+k);d[0]=f;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=r;d[6]=0;d[7]=0;d[8]=-((p-a)*f*.5);d[9]=(q-k)*r*.5;d[10]=h/(b-h);d[11]=-1;d[12]=
0;d[13]=0;d[14]=h*b/(b-h);d[15]=0;return d};a.ortho=function(a,b,h,d,q,k,p){var f=1/(a-b),r=1/(h-d),g=1/(q-k);p[0]=-2*f;p[1]=0;p[2]=0;p[3]=0;p[4]=0;p[5]=-2*r;p[6]=0;p[7]=0;p[8]=0;p[9]=0;p[10]=2*g;p[11]=0;p[12]=(a+b)*f;p[13]=(d+h)*r;p[14]=(k+q)*g;p[15]=1;return p};a.lookAt=function(c,b,h,d){var q,k,p,f,r,g,m,l,t=c[0],u=c[1];c=c[2];p=h[0];f=h[1];k=h[2];m=b[0];h=b[1];q=b[2];if(1E-7>Math.abs(t-m)&&1E-7>Math.abs(u-h)&&1E-7>Math.abs(c-q))return a.identity(d);b=t-m;h=u-h;m=c-q;l=1/Math.sqrt(b*b+h*h+m*m);
b*=l;h*=l;m*=l;q=f*m-k*h;k=k*b-p*m;p=p*h-f*b;(l=Math.sqrt(q*q+k*k+p*p))?(l=1/l,q*=l,k*=l,p*=l):p=k=q=0;f=h*p-m*k;r=m*q-b*p;g=b*k-h*q;(l=Math.sqrt(f*f+r*r+g*g))?(l=1/l,f*=l,r*=l,g*=l):g=r=f=0;d[0]=q;d[1]=f;d[2]=b;d[3]=0;d[4]=k;d[5]=r;d[6]=h;d[7]=0;d[8]=p;d[9]=g;d[10]=m;d[11]=0;d[12]=-(q*t+k*u+p*c);d[13]=-(f*t+r*u+g*c);d[14]=-(b*t+h*u+m*c);d[15]=1;return d};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+
a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))}};b4w.module.mat4=b4w.module.__mat4;b4w.module.__md5=function(a,r){function u(a,p){var f=a[0],q=a[1],g=a[2],m=a[3],f=b(f,q,g,m,p[0],7,-680876936),m=b(m,f,q,g,p[1],12,-389564586),g=b(g,m,f,q,p[2],17,606105819),q=b(q,g,m,f,p[3],22,-1044525330),f=b(f,q,g,m,p[4],7,-176418897),m=b(m,f,q,g,p[5],12,1200080426),g=b(g,m,f,q,p[6],17,-1473231341),q=b(q,g,m,f,p[7],22,-45705983),f=b(f,q,g,m,p[8],7,1770035416),m=b(m,f,q,g,p[9],12,-1958414417),g=b(g,m,f,q,p[10],17,-42063),q=b(q,g,m,f,p[11],22,-1990404162),f=b(f,q,g,m,p[12],7,1804603682),m=b(m,f,q,
g,p[13],12,-40341101),g=b(g,m,f,q,p[14],17,-1502002290),q=b(q,g,m,f,p[15],22,1236535329),f=h(f,q,g,m,p[1],5,-165796510),m=h(m,f,q,g,p[6],9,-1069501632),g=h(g,m,f,q,p[11],14,643717713),q=h(q,g,m,f,p[0],20,-373897302),f=h(f,q,g,m,p[5],5,-701558691),m=h(m,f,q,g,p[10],9,38016083),g=h(g,m,f,q,p[15],14,-660478335),q=h(q,g,m,f,p[4],20,-405537848),f=h(f,q,g,m,p[9],5,568446438),m=h(m,f,q,g,p[14],9,-1019803690),g=h(g,m,f,q,p[3],14,-187363961),q=h(q,g,m,f,p[8],20,1163531501),f=h(f,q,g,m,p[13],5,-1444681467),
m=h(m,f,q,g,p[2],9,-51403784),g=h(g,m,f,q,p[7],14,1735328473),q=h(q,g,m,f,p[12],20,-1926607734),f=c(q^g^m,f,q,p[5],4,-378558),m=c(f^q^g,m,f,p[8],11,-2022574463),g=c(m^f^q,g,m,p[11],16,1839030562),q=c(g^m^f,q,g,p[14],23,-35309556),f=c(q^g^m,f,q,p[1],4,-1530992060),m=c(f^q^g,m,f,p[4],11,1272893353),g=c(m^f^q,g,m,p[7],16,-155497632),q=c(g^m^f,q,g,p[10],23,-1094730640),f=c(q^g^m,f,q,p[13],4,681279174),m=c(f^q^g,m,f,p[0],11,-358537222),g=c(m^f^q,g,m,p[3],16,-722521979),q=c(g^m^f,q,g,p[6],23,76029189),
f=c(q^g^m,f,q,p[9],4,-640364487),m=c(f^q^g,m,f,p[12],11,-421815835),g=c(m^f^q,g,m,p[15],16,530742520),q=c(g^m^f,q,g,p[2],23,-995338651),f=d(f,q,g,m,p[0],6,-198630844),m=d(m,f,q,g,p[7],10,1126891415),g=d(g,m,f,q,p[14],15,-1416354905),q=d(q,g,m,f,p[5],21,-57434055),f=d(f,q,g,m,p[12],6,1700485571),m=d(m,f,q,g,p[3],10,-1894986606),g=d(g,m,f,q,p[10],15,-1051523),q=d(q,g,m,f,p[1],21,-2054922799),f=d(f,q,g,m,p[8],6,1873313359),m=d(m,f,q,g,p[15],10,-30611744),g=d(g,m,f,q,p[6],15,-1560198380),q=d(q,g,m,f,
p[13],21,1309151649),f=d(f,q,g,m,p[4],6,-145523070),m=d(m,f,q,g,p[11],10,-1120210379),g=d(g,m,f,q,p[2],15,718787259),q=d(q,g,m,f,p[9],21,-343485551);a[0]=f+a[0]&4294967295;a[1]=q+a[1]&4294967295;a[2]=g+a[2]&4294967295;a[3]=m+a[3]&4294967295}function c(a,b,c,d,g,h){b=(b+a&4294967295)+(d+h&4294967295)&4294967295;return(b<<g|b>>>32-g)+c&4294967295}function b(a,b,d,h,g,m,l){return c(b&d|~b&h,a,b,g,m,l)}function h(a,b,d,h,g,m,l){return c(b&h|d&~h,a,b,g,m,l)}function d(a,b,d,h,g,m,l){return c(d^(b|~h),
a,b,g,m,l)}var q="0123456789abcdef".split("");a.hexdigest=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var g=b.substring(d-64,d),h=[],l=void 0,l=0;64>l;l+=4)h[l>>2]=g.charCodeAt(l)+(g.charCodeAt(l+1)<<8)+(g.charCodeAt(l+2)<<16)+(g.charCodeAt(l+3)<<24);u(a,h)}b=b.substring(d-64);g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)g[d>>2]|=b.charCodeAt(d)<<(d%4<<3);g[d>>2]|=128<<(d%4<<3);if(55<d)for(u(a,g),d=0;16>d;d++)g[d]=
0;g[14]=8*c;u(a,g);for(b=0;b<a.length;b++){c=a;d=b;g=a[b];h="";for(l=0;4>l;l++)h+=q[g>>8*l+4&15]+q[g>>8*l&15];c[d]=h}return a.join("")}};b4w.module.shader_texts=function(a,r){a["anchors.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",parts:[{type:"var",name:"ANCHOR_NUM",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"textline",tokens:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_proj_matrix ; void main ( ) { gl_Position = u_view_proj_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"var",name:"NUM_VALUES",tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",tokens:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",
tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",tokens:["0.0"]},{type:"var",name:"RGB_IND",tokens:["0"]},{type:"var",name:"VALUE_IND",tokens:["0"]},{type:"var",name:"LAMP_INDEX",tokens:["0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},
{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"std_enums.glsl"},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"pack.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",
parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_zup_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX_INVERSE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_zup_tsr_inverse",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX"],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_zup_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX_INVERSE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_zup_tsr_inverse",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},
{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"uniform sampler2D u_sampler ; uniform float u_alpha_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_OUTLINE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_color_id",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE",
"REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},
{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_refl_plane",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_LAMP"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_VALUE"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_RGB"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_OUTLINE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec3 bC ; varying vec4 bD ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},
"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"varying vec4 bI ; varying vec4 bJ ; varying vec4 bK ; varying vec4 bL ; uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ; uniform sampler2D u_shadow_map1 ; uniform sampler2D u_shadow_map2 ; uniform sampler2D u_shadow_map3 ; uniform sampler2D u_shadow_mask ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"vec2","bM",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},
{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { mat4 qR , qS , qT , qU , qV ; float qW , qX ; vec4 qY ; vec3 qZ , q_ , ra , rb ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"textline",tokens:"qZ = u_camera_eye_frag - bC ; qZ = normalize ( qZ ) ; qR = mat4 ( 0.0 ) ; qS = mat4 ( 0.0 ) ; qT = mat4 ( 0.0 ) ; qU = mat4 ( 0.0 ) ; qV = mat4 ( 0.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"qR = O ( u_view_tsr_frag ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX"],group:{type:"group",parts:[{type:"textline",tokens:"qS = O ( u_view_zup_tsr ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX_INVERSE"],
group:{type:"group",parts:[{type:"textline",tokens:"qT = O ( u_view_zup_tsr_inverse ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX"],group:{type:"group",parts:[{type:"textline",tokens:"qU = O ( u_model_zup_tsr ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX_INVERSE"],group:{type:"group",parts:[{type:"textline",tokens:"qV = O ( u_model_zup_tsr_inverse ) ;".split(" ")}]}}]},{type:"textline",tokens:"qQ ( qZ , qR , qS , qT , qU , qV , q_ , ra , rb , qY , qW ) ; qW = qW ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"qW = ( texture2D ( u_sampler , bM ) ) . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"qX = u_alpha_factor * qW ; qX += ( 1.0 - step ( 0.0 , qX ) ) ; qW = mix ( qX , 1.0 , u_diffuse_color . a ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"qW = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["ALPHA_CLIP"],group:{type:"group",parts:[{type:"textline",tokens:"if ( qW < 0.5 ) discard ; qW = 1.0 ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_OUTLINE"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["color_id.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",tokens:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"include",file:"scale_texcoord.glslv"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",
expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute",
"vec3","a_position_next",";"]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal_next",";"]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",
tokens:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",
expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},
{type:"textline",tokens:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec3 bC ; varying vec4 bD ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",
parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"float","bH",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec4 tz ; float tA , tB , tC ; vec3 tD , tE , tF , tG , tH , tI ; mat4 tJ , tK , tL ; tJ = O ( u_view_tsr ) ; tD = a_position ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA","CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5},{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["tE","=","a_normal",";"]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"tF = vec3 ( a_tangent ) ; tG = a_tangent [ 3 ] * cross ( tE , tF ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tF = vec3 ( 0.0 ) ; tG = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tE = vec3 ( 0.0 ) ; tF = vec3 ( 0.0 ) ; tG = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"tD = mix ( tD , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",
"ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"tE = mix ( tE , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"tH = vec3 ( a_tangent ) ; tI = a_tangent_next [ 3 ] * cross ( a_normal_next , tH ) ; tF = mix ( tF , tH , u_va_frame_factor ) ; tG = mix ( tG , tI , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"sF ( tD , tF , tG , tE ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["tG","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tG = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"tK = O ( u_model_tsr ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"tF = ( tK * vec4 ( tG , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"tL = ry ( u_camera_eye , tF , tJ , tK ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"tL = rs ( u_camera_eye , tF , tJ ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"tL = tL * rk ( u_wind , u_time , u_jitter_amp , u_jitter_freq , tF ) ;".split(" ")}]}}]},{type:"textline",tokens:"c tM = rF ( tD - tG , tG , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tL ) ; tM . b = tF ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"c tM = rF ( tD , tG , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tK ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"tt ( tM . a , tM . b , tE ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL","DETAIL_BEND",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["tE","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tE = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"tt ( tM . a , tM . b , tE ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],
group:{type:"group",parts:[{type:"textline",tokens:"bM = rI ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bC = tM . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",
places:5}],group:{type:"group",parts:[{type:"textline",tokens:"bE = tM . e ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"tA = ( dot ( cross ( tM . e , tM . c ) , tM . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( tM . c , tA ) ;".split(" ")}]}}]},{type:"textline",tokens:"bD = tJ * vec4 ( tM . a , 1.0 ) ; tz = u_proj_matrix * bD ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",
parts:[{type:"textline",tokens:"tz . xy += u_subpixel_jitter * tz . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"tA = tz . x ; tB = tz . y ; tC = tz . w ; bG . x = ( tA + tC ) / 2.0 ; bG . y = ( tB + tC ) / 2.0 ; bG . z = tC ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION",
"REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bH = - bD . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:["ty","(",")",";"]}]}}]},{type:"textline",tokens:"gl_Position = u_proj_matrix * tJ * vec4 ( tM . a , 1.0 ) ; }".split(" ")}]};a["debug_view.glslf"]={type:"group",parts:[{type:"define",name:"DV_NONE",tokens:["0"]},{type:"define",name:"DV_OPAQUE_WIREFRAME",tokens:["1"]},{type:"define",name:"DV_TRANSPARENT_WIREFRAME",tokens:["2"]},
{type:"define",name:"DV_FRONT_BACK_VIEW",tokens:["3"]},{type:"define",name:"DV_DEBUG_SPHERES",tokens:["4"]},{type:"define",name:"DV_CLUSTERS_VIEW",tokens:["5"]},{type:"define",name:"DV_BATCHES_VIEW",tokens:["6"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"uniform int u_debug_view_mode ; uniform float u_cluster_id ; uniform float u_batch_debug_id ; uniform float u_debug_colors_seed ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",tokens:"varying vec3 tz ; const float tA = 1.0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"const vec3 tB = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"const vec3 tB = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"const vec3 tC = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 tD = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 tE = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"float tH ( ) { vec3 tF ; float tG ; tG = 1.0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WIREFRAME_QUALITY",0,{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"tF = sign ( tz - vec3 ( 0.02 * tA ) ) ; if ( tF . x < 0.0 || tF . y < 0.0 || tF . z < 0.0 ) tG = 0.0 ;".split(" ")}]}},{type:"elif",expression:["WIREFRAME_QUALITY",1,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"extension",tokens:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",tokens:"tF = fwidth ( tz ) ; tF = smoothstep ( vec3 ( 0.0 ) , tF * tA , tz ) ; tG = min ( min ( tF . x , tF . y ) , tF . z ) ; tG = clamp ( tG , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:["return","tG",";","}"]}]}}]},{type:"textline",tokens:"void main ( ) { float tI , tJ ; vec3 tK , tL ; tK = vec3 ( 0.0 ) ; tI = 0.0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"tL = sign ( tz - vec3 ( 0.02 * tA ) ) ; if ( tL . x < 0.0 || tL . y < 0.0 || tL . z < 0.0 ) { tK = tB ; tI = 1.0 ; } else discard ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"if ( u_debug_view_mode == DV_OPAQUE_WIREFRAME ) { tJ = tH ( ) ; tK = vec3 ( mix ( u_wireframe_edge_color , tE , tJ ) ) ; tI = 1.0 ; } else if ( u_debug_view_mode == DV_TRANSPARENT_WIREFRAME ) { tJ = tH ( ) ; tK = u_wireframe_edge_color ; tI = mix ( 1.0 , 0.0 , tJ ) ; } else if ( u_debug_view_mode == DV_FRONT_BACK_VIEW ) { tJ = tH ( ) ; if ( gl_FrontFacing ) tK = mix ( u_wireframe_edge_color , tC , tJ ) ; else tK = mix ( u_wireframe_edge_color , tD , tJ ) ; tI = 1.0 ; } else if ( u_debug_view_mode == DV_CLUSTERS_VIEW ) { tJ = u_cluster_id + u_debug_colors_seed + 2.0 ; tK = vec3 ( fract ( tJ * 19.73 ) , fract ( tJ * 6.34 ) , fract ( tJ * 1.56 ) ) ; tI = 1.0 ; } else if ( u_debug_view_mode == DV_BATCHES_VIEW ) { tJ = u_batch_debug_id + u_debug_colors_seed ; tK = vec3 ( fract ( tJ * 19.73 ) , fract ( tJ * 6.34 ) , fract ( tJ * 1.56 ) ) ; tI = 1.0 ; }".split(" ")}]}}]},
{type:"textline",tokens:["bu","(","tK",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"textline",tokens:"bx ( tK , tI ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( tK , tI ) ; }".split(" ")}]};a["debug_view.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"include",
file:"to_world.glslv"},{type:"textline",tokens:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",
";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],
group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},
{type:"textline",tokens:["varying","vec3","tz",";"]},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec3 uf , ug , uh , ui , uj ; mat4 uk , ul , um ; uk = O ( u_view_tsr ) ; ul = O ( u_model_tsr ) ; if ( a_polyindex == 0.0 ) tz = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) tz = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) tz = vec3 ( 0.0 , 0.0 , 1.0 ) ; uf = a_position ; ug = a_normal ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"c un = rF ( uf , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ul ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"uf = mix ( uf , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],
group:{type:"group",parts:[{type:"textline",tokens:"uh = vec3 ( 0.0 ) ; ui = vec3 ( 0.0 ) ; sF ( uf , uh , ui , ug ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["ui","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ui = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],
group:{type:"group",parts:[{type:"textline",tokens:"c un = ue ( uf , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ui , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , uk ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"uh = ( ul * vec4 ( ui , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION",
"STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"um = ry ( u_camera_eye , uh , uk , ul ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"um = rs ( u_camera_eye , uh , uk ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uj = ( ul * vec4 ( ui , 1.0 ) ) . xyz ; um = um * rk ( u_wind , u_time , u_jitter_amp , u_jitter_freq , uj ) ;".split(" ")}]}}]},
{type:"textline",tokens:"c un = rF ( uf - ui , ui , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , um ) ; un . b = uh ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"c un = rF ( uf , ui , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ul ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"tt ( un . a , un . b , ug ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"gl_Position = u_proj_matrix * uk * vec4 ( un . a , 1.0 ) ; }".split(" ")}]};
a["grass_map.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","uf",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["varying","float","uf",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",
parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","uf",";"]}]}}]}]}}]},{type:"textline",tokens:["void","main","(",")","{"]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["gl_FragColor","=","uf",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"gl_FragColor = vec4 ( uf , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 , uf ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["}"]}]};a["grass_map.glslv"]={type:"group",parts:[{type:"include",file:"math.glslv"},
{type:"include",file:"to_world.glslv"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],
group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",
";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",
tokens:["varying","vec4","uf",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["varying","float","uf",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","uf",";"]}]}}]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 ug ; vec3 uh ; mat4 ui , uj , uk ; ui = O ( u_view_tsr ) ; uj = O ( u_model_tsr ) ;".split(" ")},{type:"condition",
parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"uh = ( uj * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; uk = rs ( u_camera_eye , uh , ui ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uk = uk * rk ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"c ul = rF ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , uk ) ; ul . b = uh ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"c ul = rF ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , uj ) ;".split(" ")}]}}]},{type:"textline",tokens:"ug = u_proj_matrix * ui * vec4 ( ul . a , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"uf = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uf","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["uf","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",tokens:["gl_Position","=","ug",";","}"]}]};a["halo.glslf"]={type:"group",parts:[{type:"var",name:"NUM_LINES",tokens:["0"]},{type:"var",name:"NUM_RINGS",tokens:["0"]},{type:"var",
name:"NUM_STARS",tokens:["0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",parts:[{type:"if",
expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 ug ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"varying vec2 bM ; varying float uh ;".split(" ")},{type:"include",file:"color_util.glslf"},{type:"include",file:"halo_color.glslf"},{type:"textline",tokens:"void main ( ) { float uT ; vec3 uU ; vec4 uV ; uV = uS ( ) ; uU = uV . rgb ; uT = uV . a ; bu ( uU ) ; bx ( uU , uT ) ; gl_FragColor = vec4 ( uU , uT ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",tokens:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; attribute float a_random_vals ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform PRECISION float u_halo_size ; varying vec2 bM ; varying float uh ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",
parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","ug",";"]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 uT , uU ; vec3 uV ; mat4 uW , uX , uY ; uW = O ( u_view_tsr ) ; uX = O ( u_model_tsr ) ; uV = ( uX * vec4 ( a_position , 1.0 ) ) . xyz ; bM = a_halo_bb_vertex * 2.0 ; uh = a_random_vals ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],group:{type:"group",parts:[{type:"textline",tokens:"uX = qX ( uV , uW ) ; uY = uW ; uY [ 3 ] [ 0 ] = 0.0 ; uY [ 3 ] [ 1 ] = 0.0 ; uY [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uX = qX ( uV , uW ) ;".split(" ")}]}}]},{type:"textline",tokens:"uT = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; uT = uX * uT ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],
group:{type:"group",parts:[{type:"textline",tokens:"uU = u_proj_matrix * uY * uT ; uU . z = 0.99999 * uU . w ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["ug","=","uT",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uU = u_proj_matrix * uW * uT ;".split(" ")}]}}]},{type:"textline",tokens:["gl_Position",
"=","uU",";","}"]}]};a["line.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; void main ( ) { float uT ; vec3 uU ; uU = u_diffuse_color . xyz ; uT = u_diffuse_color . a ; bu ( uU ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"textline",tokens:"bx ( uU , uT ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( uU , uT ) ; }".split(" ")}]};
a["line.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",tokens:"attribute vec3 a_position ; attribute vec3 a_direction ; uniform mat3 u_model_tsr ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_line_width ;".split(" ")},{type:"define",name:"M_PI",
tokens:["3.14159265359"]},{type:"textline",tokens:"void main ( ) { mat2 uT ; float uU ; vec2 uV , uW ; vec4 uX ; mat4 uY , uZ ; uY = O ( u_view_tsr ) ; uZ = O ( u_model_tsr ) ; c u_ = rF ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , normalize ( a_direction ) , uZ ) ; uX = u_proj_matrix * uY * vec4 ( u_ . a , 1.0 ) ; uX . xyz /= uX . w ; uV = ( u_proj_matrix * uY * vec4 ( u_ . e , 0.0 ) ) . xy ; uU = M_PI / 2.0 ; uT = mat2 ( cos ( uU ) , sin ( uU ) , - sin ( uU ) , cos ( uU ) ) ; uV = uT * normalize ( uV ) ; uW = ( u_line_width / u_height ) * vec2 ( u_proj_matrix [ 0 ] [ 0 ] / u_proj_matrix [ 1 ] [ 1 ] , 1.0 ) ; gl_Position = vec4 ( uX . xy + uV . xy * uW / 2.0 , uX . z , 1.0 ) ; gl_Position *= uX . w ; }".split(" ")}]};
a["main.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"var",name:"NUM_VALUES",tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"PARALLAX_STEPS",tokens:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},
{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},
{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"procedural.glslf"},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"textline",tokens:["uniform","float","u_time",";"]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT",
"SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",
{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","CAUSTICS",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"textline",tokens:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_VECTOR_VIEW",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_zup_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX_INVERSE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_zup_tsr_inverse",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_zup_tsr",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX_INVERSE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_zup_tsr_inverse",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE",
"REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"sampler2D","u_shadow_mask",";"]}]}},{type:"elif",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION","REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_LAMP"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_VALUE"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_RGB"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{type:"logical_or_expr",places:3}],group:{type:"group",
parts:[{type:"textline",tokens:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},{type:"textline",tokens:["varying","vec3","bC",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO",
"CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bI",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",
parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"float","bH",";"]}]}}]},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"nodes.glslf"},
{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { vec2 vz ; mat4 vA , vB , vC , vD , vE ; vec4 vF ; vec3 vG , vH , vI , vJ , vK ; float vL , vM , vN ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS",
"CAUSTICS",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"vL = length ( bD ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"vM = bC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["vG","=","u_sun_intensity",";"]}]}}]},{type:"textline",tokens:"vH = normalize ( u_camera_eye_frag - bC ) ; vA = mat4 ( 0.0 ) ; vB = mat4 ( 0.0 ) ; vC = mat4 ( 0.0 ) ; vD = mat4 ( 0.0 ) ; vE = mat4 ( 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW",
"REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vA = O ( u_view_tsr_frag ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX"],group:{type:"group",parts:[{type:"textline",tokens:"vB = O ( u_view_zup_tsr ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX_INVERSE"],group:{type:"group",parts:[{type:"textline",tokens:"vC = O ( u_view_zup_tsr_inverse ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX"],group:{type:"group",parts:[{type:"textline",tokens:"vD = O ( u_model_zup_tsr ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX_INVERSE"],group:{type:"group",parts:[{type:"textline",tokens:"vE = O ( u_model_zup_tsr_inverse ) ;".split(" ")}]}}]},{type:"textline",tokens:"qQ ( vH , vA , vB , vC , vD , vE , vI , vJ , vK , vF , vN ) ; vI = vI ; vN = vN ; vK = vK ; vF = vF ;".split(" ")},{type:"condition",
parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WETTABLE"],group:{type:"group",parts:[{type:"textline",tokens:"vI = max ( vI - sqrt ( 0.01 * - min ( vM , 0.0 ) ) , 0.5 * vI ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"textline",tokens:"bp ( vI , vM , u_time , vF , vK , u_sun_direction , vG , u_sun_quaternion , bC , vL ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["ALPHA_CLIP"],group:{type:"group",parts:[{type:"textline",tokens:"if ( vN < 0.5 ) discard ; vN = 1.0 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["vN","=","1.0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",
expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"vy ( vI , length ( bD ) , vH , vM ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vy ( vI , length ( bD ) , vH , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vz = texture2DProj ( u_shadow_mask , bG ) . rg ; vM = vz . g ; vI = vec3 ( vM ) ;".split(" ")}]}}]},
{type:"textline",tokens:["bu","(","vI",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bx ( vI , vN ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( vI , vN ) ; }".split(" ")}]};a["main.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"var",name:"NUM_CAST_LAMPS",
tokens:["0"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",tokens:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO",
"CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:7}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",
parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",
"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal_next",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",
parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform mat4 u_view_matrix ; uniform mat3 u_view_tsr ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",tokens:["uniform","mat4","u_proj_matrix",";"]},{type:"condition",parts:[{type:"if",
expression:["NODES",{type:"logic_negative_expr",places:1},"BILLBOARD","DYNAMIC_GRASS",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"float","u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_normal_offset",";"]},{type:"condition",parts:[{type:"if",expression:["MAC_OS_SHADOW_HACK"],
group:{type:"group",parts:[{type:"textline",tokens:"uniform mat3 u_v_light_tsr [ NUM_CAST_LAMPS ] ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_v_light_ts [ NUM_CAST_LAMPS ] ; uniform vec4 u_v_light_r [ NUM_CAST_LAMPS ] ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","mat4","u_p_light_matrix0",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",tokens:["varying","vec3","bC",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO",
"CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:7}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",
{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","vz",";"]},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","vA",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE",
"SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bI",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE",
"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","NODES",{type:"logic_negative_expr",places:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},
{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec4 vN , vO ; float vP ; vec3 vQ , vR , vS , vT , vU , vV , vW ; mat4 vX , vY , vZ , v_ ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["vX","=","u_view_matrix",";"]},{type:"condition",
parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"vY = O ( u_view_tsr ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"vX = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",tokens:"vZ = O ( u_model_tsr ) ; vQ = a_position ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"NODES",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["vR","=","a_normal",
";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vR = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vS = vec3 ( a_tangent ) ; vT = a_tangent [ 3 ] * cross ( vR , vS ) ;".split(" ")}]}},
{type:"elif",expression:["NODES",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vU = ( vZ * vec4 ( a_position , 1.0 ) ) . xyz ; vV = normalize ( ( vZ * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vU = vU - u_camera_eye ; vT = cross ( vU , vV ) ; vS = cross ( vV , vT ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vS = vec3 ( 0.0 ) ; vT = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"vQ = mix ( vQ , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:"vR = mix ( vR , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:"vV = vec3 ( a_tangent ) ; vU = a_tangent_next [ 3 ] * cross ( a_normal_next , vV ) ; vS = mix ( vS , vV , u_va_frame_factor ) ; vT = mix ( vT , vU , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"sF ( vQ , vS , vT , vR ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["vU","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vU = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"c wa = ue ( vQ , vS , vT , vR , vU , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , vX ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"vV = ( vZ * vec4 ( vU , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"v_ = ry ( u_camera_eye , vV , vX , vZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"v_ = rs ( u_camera_eye , vV , vX ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vW = ( vZ * vec4 ( vU , 1.0 ) ) . xyz ; v_ = v_ * rk ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vW ) ;".split(" ")}]}}]},{type:"textline",tokens:"c wa = rF ( vQ - vU , vU , vS , vT , vR , v_ ) ; wa . b = vV ;".split(" ")}]}},{type:"else",
group:{type:"group",parts:[{type:"textline",tokens:"c wa = rF ( vQ , vU , vS , vT , vR , vZ ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vP = ( dot ( cross ( wa . e , wa . c ) , wa . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( wa . c , vP ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",
tokens:"tt ( wa . a , wa . b , vR ) ;".split(" ")}]}}]},{type:"textline",tokens:"bC = wa . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"bE = wa . e ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"vz = u_camera_eye - wa . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"bM = rI ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"vA = wa . f ;".split(" ")}]}},{type:"elif",expression:["VERTEX_COLOR"],
group:{type:"group",parts:[{type:"textline",tokens:["vA","=","a_color",";"]}]}}]}]}}]},{type:"textline",tokens:"vN = vX * vec4 ( wa . a , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",
places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:"vO = vY * vec4 ( wa . a , 1.0 ) ; bD = vO ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["bD","=","vN",";"]}]}}]}]}}]},{type:"textline",tokens:"vO = u_proj_matrix * vN ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",
tokens:"vO . xy += u_subpixel_jitter * vO . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"bG = L ( vO ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vM ( wa . a , wa . e ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","NODES",{type:"logic_negative_expr",places:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bH = - vN . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"textline",
tokens:["ty","(",")",";"]}]}}]},{type:"textline",tokens:["gl_Position","=","vO",";","}"]}]};a["main_stack.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"var",name:"NUM_VALUES",tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"PARALLAX_STEPS",tokens:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},
{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",
file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"procedural.glslf"},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"textline",
tokens:["uniform","float","u_time",";"]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",
tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS",
"CAUSTICS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR0_CO"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_SPEC","ALPHA_AS_SPEC",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",parts:[{type:"textline",tokens:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",
";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",
parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR0_CO"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_SPEC"],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"float","u_specular_color_factor",";"]}]}}]},{type:"textline",tokens:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_refr_bump",
";"]}]}}]},{type:"textline",tokens:"varying vec3 bC ; varying vec3 bE ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:6}],group:{type:"group",
parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"textline",tokens:["varying","vec3","vz",";"]},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","vA",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bI",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"vec4","bL",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",
file:"lighting_nodes.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { vec4 xS , xT , xU , xV ; mat4 xW ; mat3 xX ; vec2 xY , xZ , x_ , ya ; vec3 yb , yc , yd , ye , yf , yg , yh , yi , yj ; float yk , yl , ym , yn , yo ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",
places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"yk = length ( bD ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",
tokens:"yl = bC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["yb","=","u_sun_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["xY","=","bM",";"]}]}}]},{type:"textline",
tokens:"yc = normalize ( bE ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["INVERT_FRONTFACING"],group:{type:"group",parts:[{type:"textline",tokens:["if","(","!","gl_FrontFacing",")"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["if","(","gl_FrontFacing",")"]}]}}]},{type:"textline",tokens:"yc = yc ; else yc = - yc ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:"yd = cross ( yc , bF . xyz ) * bF . w ; xX = mat3 ( bF . xyz , yd , yc ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD","REFRACTIVE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xW = O ( u_view_tsr_frag ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"xZ = normalize ( xW * vec4 ( bE , 0.0 ) ) . st ; xZ = xZ * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( yk < PARALLAX_LOD_DIST ) { ym = clamp ( 0.5 * ( PARALLAX_LOD_DIST - yk ) , 0.0 , 1.0 ) ; ym = u_parallax_scale * ym ; yd = normalize ( vz * xX ) ; yn = 1.0 / PARALLAX_STEPS ; x_ = yd . xy * ym / ( PARALLAX_STEPS * yd . z ) ; ym = 1.0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["ya","=","xZ",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["ya","=","xY",";"]}]}}]},{type:"textline",tokens:"yo = texture2D ( u_normalmap0 , ya ) . a ; for ( float yp = 1.0 ; yp <= PARALLAX_STEPS ; yp ++ ) { if ( yo < ym ) { ym -= yn ; ya -= x_ ; yo = texture2D ( u_normalmap0 , ya ) . a ; } } x_ = ya + x_ ; yn = texture2D ( u_normalmap0 , x_ ) . a - ( ym + yn ) ; ym = yo - ym ; yn = ym / ( ym - yn ) ; ya = yn * x_ + ( 1.0 - yn ) * ya ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"xY += ya - xZ ;".split(" ")}]}}]},{type:"textline",tokens:["xZ","=","ya",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"xZ += ya - xY ;".split(" ")}]}}]},
{type:"textline",tokens:["xY","=","ya",";"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:[";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xS = texture2D ( u_normalmap0 , xZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xS = texture2D ( u_normalmap0 , xY ) ;".split(" ")}]}}]},
{type:"textline",tokens:"yd = xS . rgb - 0.5 ; yd = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , yd , u_normal_factor ) ; yd = xX * yd ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["yd","=","yc",";"]}]}}]},{type:"textline",tokens:"yd = normalize ( yd ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"xZ = normalize ( xW * vec4 ( yd , 0.0 ) ) . st ; xZ = xZ * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"textline",tokens:"yc = normalize ( vz ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ye = vA ; br ( ye ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xS = vec4 ( ye , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:["xS","=","u_diffuse_color",";"]}]}}]},{type:"textline",tokens:["yn","=","1.0",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xT = texture2D ( u_colormap0 , xZ ) ;".split(" ")}]}},{type:"elif",expression:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xT = texture2D ( u_colormap0 , xY ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR0_CO"],group:{type:"group",parts:[{type:"textline",tokens:"br ( xT . rgb ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",parts:[{type:"textline",tokens:[";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR1_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xU = texture2D ( u_colormap1 , xZ ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xU = texture2D ( u_colormap1 , xY ) ;".split(" ")}]}}]},{type:"textline",tokens:"br ( xU . rgb ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_STENCIL_ALPHA_MASK_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xV = texture2D ( u_stencil0 , xZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xV = texture2D ( u_stencil0 , xY ) ;".split(" ")}]}}]},
{type:"textline",tokens:"xT = mix ( xT , xU , xV . r ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xS . rgb = mix ( xS . rgb , xT . rgb , u_diffuse_color_factor ) ; ym = u_alpha_factor * xT . a ; ym += ( 1.0 - step ( 0.0 , ym ) ) ; xS . a = mix ( ym , 1.0 , u_diffuse_color . a ) ; yn = xT . a ;".split(" ")}]}},{type:"elif",expression:["TEXTURE_BLEND_TYPE",
"TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xS . rgb *= mix ( vec3 ( 1.0 ) , xT . rgb , u_diffuse_color_factor ) ; xS . a = xT . a ; yn = xT . a ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADELESS"],group:{type:"group",parts:[{type:"textline",tokens:"ye = xS . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"yf = u_diffuse_intensity * xS . rgb ; yg = u_environment_energy * dS ( yd ) ; yg = u_ambient * yg ; xT = du ( yf ) ; yh = u_emit * xS . rgb ; yi = u_specular_color ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_SPEC"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["ALPHA_AS_SPEC"],group:{type:"group",parts:[{type:"textline",tokens:"yj = vec3 ( yn ) ;".split(" ")}]}},{type:"elif",expression:["TEXTURE_SPEC_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"yj = texture2D ( u_specmap0 , xZ ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"yj = texture2D ( u_specmap0 , xY ) . rgb ;".split(" ")}]}}]},{type:"textline",tokens:"br ( yj . rgb ) ; yi = mix ( yi , yj , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",tokens:"yn = u_specular_params [ 0 ] ; xY = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; yi = yn * yi ; xR ( yh , yg , yf , yi , bC , yd , yc , xY , u_diffuse_params , xT , 0.0 , vec4 ( 0.0 ) , ye , yj ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"dP ( ye , yc , yd , u_reflect_factor , xW ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dP ( ye , yc , yd , u_reflect_factor , mat4 ( 0.0 ) ) ;".split(" ")}]}}]}]}},{type:"elif",expression:["REFLECTION_TYPE",
"REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"dP ( ye , yc , yd , 0.0 , xW ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dP ( ye , yc , yd , 0.0 , mat4 ( 0.0 ) ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",
tokens:["ye","+=","yj",";"]}]}}]},{type:"textline",tokens:"yn = xS . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WETTABLE"],group:{type:"group",parts:[{type:"textline",tokens:"ye = max ( ye - sqrt ( 0.01 * - min ( yl , 0.0 ) ) , 0.5 * ye ) ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"textline",tokens:"bp ( ye , yl , u_time , xT , yd , u_sun_direction , yb , u_sun_quaternion , bC , yk ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["ALPHA_CLIP"],group:{type:"group",parts:[{type:"textline",tokens:"if ( yn < 0.5 ) discard ; yn = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",
parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"ym = max ( max ( yj . r , yj . g ) , yj . b ) * u_specular_alpha ; yn = xS . a * ( 1.0 - ym ) + ym ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["yn","=","1.0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"xY = - ( xW * vec4 ( yd , 0.0 ) ) . xy ; ye = mix ( ef ( bG , xY * u_refr_bump ) , ye , yn ) ; yn = 1.0 ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"vy ( ye , yk , yc , yl ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vy ( ye , yk , yc , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["bu","(","ye",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA",
"ALPHA_CLIP",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bx ( ye , yn ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( ye , yn ) ; }".split(" ")}]};a["particle_system.glslf"]={type:"group",parts:[{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",
tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"var",name:"NUM_VALUES",tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",
parts:[{type:"if",expression:["SOFT_PARTICLES","NODES",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"PARTICLES_SHADELESS",tokens:["0"]},{type:"var",name:"SOFT_STRENGTH",tokens:["1.0"]},{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform float u_time ; uniform vec3 u_camera_eye_frag ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_LAMP"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_VALUE"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_RGB"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_VECTOR_VIEW",
{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_zup_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX_INVERSE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_zup_tsr_inverse",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_zup_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX_INVERSE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_zup_tsr_inverse",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"vec4","bF",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR","USE_NODE_TEX_COORD_UV","USE_NODE_UV_MERGED","USE_NODE_UVMAP","USE_NODE_GEOMETRY_UV","USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:7}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"textline",tokens:["varying","vec3","bC",";"]},
{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"NODES",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"textline",tokens:["varying","vec3","bE",";"]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"include",file:"environment.glslf"},
{type:"include",file:"math.glslv"},{type:"include",file:"particles_nodes.glslf"},{type:"textline",tokens:"void main ( ) { mat4 Kr , Ks , Kt , Ku , Kv ; float Kw , Kx , Ky ; vec4 Kz ; vec3 KA , KB , KC , KD ; KA = normalize ( u_camera_eye_frag - bC ) ; Kr = mat4 ( 0.0 ) ; Ks = mat4 ( 0.0 ) ; Kt = mat4 ( 0.0 ) ; Ku = mat4 ( 0.0 ) ; Kv = mat4 ( 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Kr = O ( u_view_tsr_frag ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX"],group:{type:"group",parts:[{type:"textline",tokens:"Ks = O ( u_view_zup_tsr ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX_INVERSE"],group:{type:"group",parts:[{type:"textline",tokens:"Kt = O ( u_view_zup_tsr_inverse ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX"],
group:{type:"group",parts:[{type:"textline",tokens:"Ku = O ( u_model_zup_tsr ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX_INVERSE"],group:{type:"group",parts:[{type:"textline",tokens:"Kv = O ( u_model_zup_tsr_inverse ) ;".split(" ")}]}}]},{type:"textline",tokens:"Kq ( KA , Kr , Ks , Kt , Ku , Kv , KB , KC , KD , Kz , Kw ) ; KB = KB ; Kw = Kw ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",
parts:[{type:"if",expression:["ALPHA_CLIP"],group:{type:"group",parts:[{type:"textline",tokens:"if ( Kw < 0.5 ) discard ; Kw = 1.0 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Kw","=","1.0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"vy ( KB , length ( bD ) , KA , 1.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],
group:{type:"group",parts:[{type:"textline",tokens:"Kx = - bD . z / u_view_max_depth ; Kz = texture2DProj ( u_scene_depth , bG ) ; Ky = Z ( Kz ) ; Kx = Ky - Kx ; Kx = u_view_max_depth / SOFT_STRENGTH * Kx ; Kw = Kw * min ( Kx , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["bu","(","KB",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bx ( KB , Kw ) ;".split(" ")}]}}]},
{type:"textline",tokens:"gl_FragColor = vec4 ( KB , Kw ) ; }".split(" ")}]};a["particle_system.glslv"]={type:"group",parts:[{type:"var",name:"BILLBOARD_ALIGN",tokens:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",tokens:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",tokens:["0"]},{type:"define",name:"BILLBOARD_ALIGN_VIEW",tokens:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",tokens:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",tokens:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",tokens:["4"]},{type:"define",
name:"M_PI",tokens:["3.14159265359"]},{type:"textline",tokens:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute vec3 a_p_data ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent",";"]}]}}]},{type:"textline",tokens:["attribute","vec2","a_p_bb_vertex",";"]},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",
0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",tokens:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ; uniform float u_p_tilt ; uniform float u_p_tilt_rand ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat4 u_proj_matrix ; uniform vec3 u_wind ; uniform float u_p_size ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WORLD_SPACE",{type:"logic_negative_expr",places:1},
"NODES","HALO_PARTICLES",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_COLOR_RAMP"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_color_ramp_tex",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["HALO_PARTICLES",
{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","Kr",";"]}]}}]},{type:"textline",tokens:["varying","vec3","vA",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR","HALO_PARTICLES","USE_NODE_TEX_COORD_UV","USE_NODE_UV_MERGED",
"USE_NODE_UVMAP","USE_NODE_GEOMETRY_UV","USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:8}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"textline",tokens:["varying","vec3","bC",";"]},{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1},"DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"vec3","vz",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"NODES",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"textline",
tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["HALO_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","uh",";"]}]}}]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"particles.glslv"},{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"particles_nodes.glslv"}]}}]},{type:"textline",tokens:"float Le ( vec2 Lc , vec2 Ld ) { return ( atan ( Ld . y , Ld . x ) - atan ( Lc . y , Lc . x ) ) ; } void main ( ) { vec3 Lf , Lg ; vec4 Lh , Li , Lj ; float Lk , Ll , Lm ; mat4 Ln , Lo ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["Ln","=","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ln = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",tokens:"Ks Lp ; Lp = KU ( ) ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { Lk = Lp . e ; Lo = qX ( Lp . b , Ln ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { Lk = Lp . e ; Lo = w ( ) ; Lo [ 3 ] = vec4 ( Lp . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { Lk = Lp . e ; Lo = A ( radians ( 90.0 ) ) ; Lo [ 3 ] = vec4 ( Lp . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { Lk = Le ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + Lp . e ; Lo = y ( radians ( - 90.0 ) ) ; Lo [ 3 ] = vec4 ( Lp . b , 1.0 ) ; } Lh = vec4 ( a_p_bb_vertex * 2.0 * Lp . a * u_p_size , 0.0 , 1.0 ) ; Ll = a_p_data [ 2 ] ; Lm = u_p_tilt * u_p_tilt_rand * ( 2.0 * Ll - 1.0 ) ; Lm = ( Lm + u_p_tilt ) * M_PI ; Lh = Lo * C ( Lm + Lk ) * Lh ; Li = Ln * Lh ; Lj = u_proj_matrix * Li ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["HALO_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:["uh","=","Ll",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"Lf = vec3 ( a_tangent ) ; Lg = a_tangent [ 3 ] * cross ( a_normal , Lf ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Lf = vec3 ( 0.0 ) ; Lg = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"c Lq = rF ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , Lf , Lg , vec3 ( 0.0 ) , Lo * C ( Lk ) ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"Lk = ( dot ( cross ( a_normal , Lq . c ) , Lq . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( Lq . c , Lk ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["bE","=","a_normal",";"]}]}}]},{type:"textline",
tokens:"Lb ( Lp . b , Lp . f , Lp . g , Lp . h , Lp . a , a_p_bb_vertex , a_p_data [ 0 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"bM = a_p_bb_vertex + 0.5 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["HALO_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"bM = a_p_bb_vertex * 2.0 ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"Kr = Lp . c ;".split(" ")}]}}]},{type:"textline",tokens:"vA = Lp . d ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"Lk = Lj . x ; Ll = Lj . y ; Lm = Lj . w ; bG . x = ( Lk + Lm ) / 2.0 ; bG . y = ( Ll + Lm ) / 2.0 ; bG . z = Lm ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"NODES",{type:"logical_or_expr",
places:3}],group:{type:"group",parts:[{type:"textline",tokens:["bD","=","Li",";"]}]}}]},{type:"textline",tokens:"gl_Position = Lj ; bC = Lh . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1},"DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vz = u_camera_eye - Lh . xyz ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["particle_system_stack.glslf"]=
{type:"group",parts:[{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"var",name:"NUM_VALUES",tokens:["0"]},
{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES","NODES",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"PARTICLES_SHADELESS",tokens:["0"]},{type:"var",name:"SOFT_STRENGTH",tokens:["1.0"]},{type:"condition",
parts:[{type:"if",expression:["HALO_PARTICLES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_halo_size ; uniform vec3 u_halo_rings_color ; uniform float u_halo_hardness ; uniform vec3 u_halo_lines_color ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_sun_intensity ; uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ;".split(" ")}]}}]},{type:"textline",tokens:"uniform float u_p_alpha_start ; uniform float u_p_alpha_end ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"vec4","u_fog_color_density",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"textline",tokens:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["TEXTURE_COLOR","HALO_PARTICLES","USE_NODE_TEX_COORD_UV","USE_NODE_UV_MERGED","USE_NODE_UVMAP","USE_NODE_GEOMETRY_UV","USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:8}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"textline",tokens:["varying","vec3","bC",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",
parts:[{type:"if",expression:["HALO_PARTICLES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","Kr",";"]}]}}]},{type:"textline",tokens:["varying","vec3","vA",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1},"DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","vz",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"NODES",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["HALO_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","uh",";"]},{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"vec4","ug",";"]}]}}]}]}}]},{type:"include",file:"lighting_nodes.glslf"},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["HALO_PARTICLES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"environment.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["HALO_PARTICLES"],group:{type:"group",
parts:[{type:"include",file:"halo_color.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { vec2 Lc ; float Ld , Le , Lf ; vec4 Lg , Lh ; vec3 Li , Lj , Lk , Ll , Lm , Ln , Lo , Lp ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1},"DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Li = normalize ( vz ) ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["HALO_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"Lg = uS ( ) ; Lj = Lg . rgb * vA ; Ld = 0.9 * length ( bM ) ; Ld = smoothstep ( u_p_alpha_start , u_p_alpha_end , Ld ) ; Ld = Lg . a * ( 1.0 - Ld ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Lg","=","u_diffuse_color",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"Lh = texture2D ( u_sampler , bM ) ; br ( Lh . rgb ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Lg . rgb = mix ( Lg . rgb , Lh . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},{type:"elif",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Lg . rgb *= mix ( vec3 ( 1.0 ) , Lh . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},
{type:"textline",tokens:"Lg . a = Lh . a ;".split(" ")}]}}]},{type:"textline",tokens:"Lg . rgb *= vA ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"Lk = u_diffuse_intensity * Lg . rgb ; Ll = u_emit * Lg . rgb ; Lm = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logic_negative_expr",places:1},
"SKY_COLOR",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"Ln = u_environment_energy * dS ( vec3 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ln = u_environment_energy * dS ( Lm ) ;".split(" ")}]}}]},{type:"textline",tokens:"Ln = u_ambient * Ln ; Le = u_specular_params [ 0 ] ; Lc = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; Lo = Le * u_specular_color ; xR ( Ll , Ln , Lk , Lo , bC , Lm , Li , Lc , u_diffuse_params , vec4 ( 1.0 ) , 0.0 , vec4 ( 0.0 ) , Lj , Lp ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Lj = Lg . rgb ;".split(" ")}]}}]},{type:"textline",tokens:"Ld = Lg . a * Kr ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"vy ( Lj , length ( bD ) , Li , 1.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"Le = - bD . z / u_view_max_depth ; Lg = texture2DProj ( u_scene_depth , bG ) ; Lf = Z ( Lg ) ; Le = Lf - Le ; Le = u_view_max_depth / SOFT_STRENGTH * Le ; Ld = Ld * min ( Le , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:["bu","(","Lj",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bx ( Lj , Ld ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( Lj , Ld ) ; }".split(" ")}]};a["procedural_skydome.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",
tokens:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 Lc ; const float Ld = 0.99 ; const float Le = 1.8 ; const int Lf = 8 ; float Ll ( vec3 Lg , vec3 Lh ) { float Li , Lj , Lk ; Li = dot ( Lh , Lh ) ; Lj = 2.0 * dot ( Lh , Lg ) ; Lk = dot ( Lg , Lg ) - 1.0 ; Li = Lj * Lj - 4.0 * Li * Lk ; Li = sqrt ( Li ) ; Li = ( - Lj - Li ) / 2.0 ; Li = Lk / Li ; return Li ; } float Ls ( float Lm , float Ln ) { float Lo , Lp , Lq , Lr ; Lo = 3.0 * ( 1.0 - Ln * Ln ) ; Lp = 2.0 * ( 2.0 + Ln * Ln ) ; Lq = 1.0 + Lm * Lm ; Lr = pow ( 1.0 + Ln * Ln - 2.0 * Ln * Lm , 1.5 ) ; Lr = max ( Lr , 0.00001 ) ; return ( Lo / Lp ) * ( Lq / Lr ) ; } float Ly ( vec3 Lt , vec3 Lu , float Lv ) { vec3 Lw ; float Lx ; Lx = dot ( Lu , - Lt ) ; if ( Lx < 0.0 ) { return 1.0 ; } Lw = Lt + Lx * Lu ; if ( length ( Lw ) < Lv ) { return 0.0 ; } else if ( length ( Lw ) >= Lv ) { Lw = normalize ( Lw ) * Lv - Lt ; Lx = acos ( dot ( normalize ( Lw ) , Lu ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( Lx * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 LC ( float Lz , vec3 LA , float LB ) { return LA - LA * pow ( u_sky_color , vec3 ( LB / Lz ) ) ; } void main ( ) { float LD , LE , LF , LG , LH , LI , LJ , LK , LL ; vec3 LM , LN , LO , LP , LQ , LR , LS ; LM = normalize ( Lc ) ; LN = u_sun_direction ; LD = dot ( LM , LN ) ; LE = Ls ( LD , - 0.01 ) * u_rayleigh_brightness * LN . y ; LF = Ls ( LD - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - LN . y ) ; LD = smoothstep ( 0.0 , 100.0 , Ls ( LD , 0.9995 ) ) * u_spot_brightness ; LO = vec3 ( 0.0 , Ld , 0.0 ) ; LG = Ll ( LO , LM ) ; LH = LG / float ( Lf ) ; LI = Ly ( LO , LM , Ld - 0.3 ) ; LP = vec3 ( 0.0 , 0.0 , 0.0 ) ; LQ = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int LT = 0 ; LT < Lf ; LT ++ ) { LJ = LH * float ( LT ) ; LR = LO + LM * LJ ; LK = Ly ( LR , LN , Ld - 0.2 ) ; LL = Ll ( LR , LN ) ; LS = LC ( LL , vec3 ( Le ) , u_scatter_strength ) * LK ; LP += LC ( sqrt ( LJ ) , u_sky_color * LS , u_rayleigh_strength ) ; LQ += LC ( LJ , LS , u_mie_strength ) ; } LP = LP * LI * pow ( LG , u_rayleigh_collection_power ) / float ( Lf ) ; LQ = ( LQ * LI * pow ( LG , u_mie_collection_power ) ) / float ( Lf ) ; LP = vec3 ( LD * LQ + LF * LQ + LE * LP ) ; bu ( LP ) ; gl_FragColor = vec4 ( LP , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 Lc ; void main ( ) { vec4 Ld , Le ; Ld = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; Le = u_cube_view_matrix * Ld ; Lc = Le . xyz ; gl_Position = Ld ; }".split(" ")}]};a["shadow.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},
{type:"var",name:"NUM_VALUES",tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",tokens:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",tokens:["0.0"]},{type:"var",name:"RGB_IND",
tokens:["0"]},{type:"var",name:"VALUE_IND",tokens:["0"]},{type:"var",name:"LAMP_INDEX",tokens:["0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",
name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1},"NODES","ALPHA",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"include",file:"procedural.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",
"ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"pack.glslf"},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW",
"REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_zup_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX_INVERSE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"mat3","u_view_zup_tsr_inverse",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_zup_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX_INVERSE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_zup_tsr_inverse",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_LAMP"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_VALUE"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_RGB"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",
tokens:"uniform sampler2D u_colormap0 ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","vec4","u_diffuse_color",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1",
"NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3",
"NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",
parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bC",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",
parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bI",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",
";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1},"NODES","ALPHA",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"mirror.glslf"},
{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { mat4 Ld , Le , Lf , Lg , Lh ; float Li , Lj ; vec4 Lk ; vec3 Ll , Lm , Ln , Lo ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["ALPHA"],
group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"textline",tokens:"Ll = u_camera_eye_frag - bC ; Ll = normalize ( Ll ) ; Ld = mat4 ( 0.0 ) ; Le = mat4 ( 0.0 ) ; Lf = mat4 ( 0.0 ) ; Lg = mat4 ( 0.0 ) ; Lh = mat4 ( 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"Ld = O ( u_view_tsr_frag ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX"],group:{type:"group",parts:[{type:"textline",tokens:"Le = O ( u_view_zup_tsr ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_VIEW_MATRIX_INVERSE"],group:{type:"group",parts:[{type:"textline",tokens:"Lf = O ( u_view_zup_tsr_inverse ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX"],group:{type:"group",
parts:[{type:"textline",tokens:"Lg = O ( u_model_zup_tsr ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ZUP_MODEL_MATRIX_INVERSE"],group:{type:"group",parts:[{type:"textline",tokens:"Lh = O ( u_model_zup_tsr_inverse ) ;".split(" ")}]}}]},{type:"textline",tokens:"qQ ( Ll , Ld , Le , Lf , Lg , Lh , Lm , Ln , Lo , Lk , Li ) ; Li = Li ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",
parts:[{type:"textline",tokens:"Li = ( texture2D ( u_colormap0 , bM ) ) . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Lj = u_alpha_factor * Li ; Lj += ( 1.0 - step ( 0.0 , Lj ) ) ; Li = mix ( Lj , 1.0 , u_diffuse_color . a ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Li = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},
{type:"textline",tokens:"if ( Li < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","NO_SHADOWS",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}},{type:"elif",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"gl_FragColor = dr ( bD . z ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor . a *= clamp ( bF . r , 0.999999999 , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["}"]}]};a["shadow.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},
{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"var",name:"NUM_CAST_LAMPS",tokens:["0"]},{type:"var",name:"SHADOW_TEX_RES",tokens:["0.0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",tokens:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",
parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",places:3}],group:{type:"group",
parts:[{type:"textline",tokens:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],
group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",
tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",
places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal_next",";"]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",
expression:["NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logic_negative_expr",places:1},"TEXTURE_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",tokens:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD","SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_shadow_cast_billboard_view_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float",
"u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logic_negative_expr",places:1},"TEXTURE_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float",
"u_normal_offset",";"]},{type:"condition",parts:[{type:"if",expression:["MAC_OS_SHADOW_HACK"],group:{type:"group",parts:[{type:"textline",tokens:"uniform mat3 u_v_light_tsr [ NUM_CAST_LAMPS ] ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_v_light_ts [ NUM_CAST_LAMPS ] ; uniform vec4 u_v_light_r [ NUM_CAST_LAMPS ] ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","mat4","u_p_light_matrix0",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1",
"NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",
3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"vec3","bC",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]}]}},{type:"else",
group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bI",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",
file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec2 Ld ; vec4 Le , Lf ; float Lg ; vec3 Lh , Li , Lj , Lk , Ll , Lm ; mat4 Ln , Lo , Lp , Lq ; Ln = O ( u_view_tsr ) ; Lh = a_position ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",
{type:"equal_expr",places:2},"CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["Li","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Li = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",
places:3}],group:{type:"group",parts:[{type:"textline",tokens:"Lj = vec3 ( a_tangent ) ; Lk = a_tangent [ 3 ] * cross ( Li , Lj ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Lj = vec3 ( 0.0 ) ; Lk = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"Lh = mix ( Lh , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",
"ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"Li = mix ( Li , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"Ll = vec3 ( a_tangent ) ; Lm = a_tangent_next [ 3 ] * cross ( a_normal_next , Ll ) ; Lj = mix ( Lj , Ll , u_va_frame_factor ) ; Lk = mix ( Lk , Lm , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"sF ( Lh , Lj , Lk , Li ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["Lk","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Lk = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"c Lr = ue ( Lh , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Li , Lk , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , Ln ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Lo = O ( u_model_tsr ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"Lj = ( Lo * vec4 ( Lk , 1.0 ) ) . xyz ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["HAIR_BILLBOARD",{type:"logic_negative_expr",places:1},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Lp = O ( u_shadow_cast_billboard_view_tsr ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Lp","=","Ln",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",
{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Lq = ry ( u_camera_eye , Lj , Lp , Lo ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Lq = rs ( u_camera_eye , Lj , Lp ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Lq = Lq * rk ( u_wind , u_time , u_jitter_amp , u_jitter_freq , Lj ) ;".split(" ")}]}}]},
{type:"textline",tokens:"c Lr = rF ( Lh - Lk , Lk , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Li , Lq ) ; Lr . b = Lj ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"c Lr = rF ( Lh , Lk , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Li , Lo ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["Li","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Li = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"tt ( Lr . a , Lr . b , Li ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bC = Lr . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",
"WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:"bE = Lr . e ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"Lg = ( dot ( cross ( Lr . e , Lr . c ) , Lr . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( Lr . c , Lg ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"Le = Ln * vec4 ( Lr . a , 1.0 ) ; Lf = u_proj_matrix * Le ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:"Lf . xy += u_subpixel_jitter * Lf . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"bG = L ( Lf ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bH = - bD . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:["ty","(",")",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"bM = rI ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vM ( Lr . a , Lr . e ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["bD","=","Le",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ld = ( u_proj_matrix * Ln [ 3 ] ) . xy ; Lg = SHADOW_TEX_RES / 2.0 ; Ld = floor ( Ld * Lg + 0.5 ) / Lg - Ld ; Lf . xy += Ld ;".split(" ")}]}}]},{type:"textline",tokens:["gl_Position","=","Lf",";","}"]}]};a["special_lens_flares.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",
tokens:"uniform sampler2D u_sampler ; varying vec2 bM ; void main ( ) { vec4 Ld ; Ld = texture2D ( u_sampler , bM ) ; bu ( Ld . rgb ) ; bx ( Ld . rgb , Ld . a ) ; gl_FragColor = Ld ; }".split(" ")}]};a["special_lens_flares.glslv"]={type:"group",parts:[{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"define",name:"LIGHT_INDEX",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"textline",tokens:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 bM ; void main ( ) { vec2 Ld ; float Le ; vec4 Lf ; vec3 Lg ; mat4 Lh ; Lh = O ( u_view_tsr ) ; bM = a_texcoord ; Lg = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; Lf = u_proj_matrix * Lh * vec4 ( Lg , 0.0 ) ; Lf . x /= Lf . w ; Lf . y /= Lf . w ; Lf += 99999.0 * step ( Lf . z , 0.0 ) ; Lf += 100.0 * ( step ( 1.0 , abs ( Lf . x ) ) + step ( 1.0 , abs ( Lf . y ) ) ) ; Lf . x = - a_lf_dist * Lf . x ; Lf . y = - a_lf_dist * Lf . y ; Le = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; Ld = vec2 ( a_lf_bb_vertex . x / Le , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float Li = 1.9 ; Ld *= ( 1.0 + Li * length ( Lf . xy ) ) ; } gl_Position = vec4 ( Lf . xy + Ld , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"define",name:"INV_PI",tokens:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",parts:[{type:"if",expression:["WO_SKYTEX","PROCEDURAL_SKYDOME",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",
{type:"logic_negative_expr",places:1},"WO_SKYTEX",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"blending.glslf"},{type:"textline",tokens:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ; vec3 Nh ( vec3 Nc , vec3 Nd , float Ne , float Nf ) { float Ng ; Ng = Ne * Nf ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BLENDTYPE","MIX",{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"return Lr ( Nd , Nc , Ng ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","ADD",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Lv ( Nc , Nd , Ng ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SUBTRACT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Lz ( Nc , Nd , Ng ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"return LE ( Nc , Nd , Ng ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SCREEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return LJ ( Nc , Nd , Ng ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","OVERLAY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return LO ( Nc , Nd , Ng ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"return LS ( Nc , Nd , Ng ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DIVIDE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return LW ( Nc , Nd , Ng ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DARKEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return L_ ( Nc , Nd , Ng ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LIGHTEN",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Md ( Nc , Nd , Ng ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","HUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Mj ( Nd , Nc , Ng ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SATURATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Mp ( Nd , Nc , Ng ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","VALUE",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Mv ( Nd , Nc , Ng ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","COLOR",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return MB ( Nd , Nc , Ng ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return MG ( Nd , Nc , Ng ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LINEAR_LIGHT",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return MK ( Nd , Nc , Ng ) ;".split(" ")}]}}]},{type:"textline",tokens:"return vec3 ( 1.0 , 0.0 , 1.0 ) ; } float Np ( float Ni , float Nj , float Nk , float Nl ) { float Nm ; vec3 Nn , No ; Nn = vec3 ( Ni ) , No = vec3 ( Nj ) ; Nm = Nk * Nl ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BLENDTYPE","MIX",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Lr ( No , Nn , Nm ) . x ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","ADD",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Lv ( Nn , No , Nm ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SUBTRACT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Lz ( Nn , No , Nm ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return MQ ( Ni , Nj , Nm , Nl ) ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","SCREEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return MW ( Ni , Nj , Nm , Nl ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","OVERLAY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Nb ( Ni , Nj , Nm , Nl ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return LS ( Nn , No , Nm ) . x ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","DIVIDE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return LW ( Nn , No , Nm ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DARKEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return L_ ( Nn , No , Nm ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LIGHTEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Md ( Nn , No , Nm ) . x ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return MG ( No , Nn , Nm ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return MK ( No , Nn , Nm ) . x ;".split(" ")}]}}]},{type:"textline",tokens:["return","0.0",";","}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"REFLECTION_PASS",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_camera_eye_frag ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},{type:"textline",
tokens:["varying","vec3","Lc",";"]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",places:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 Nq ; float Nr , Ns , Nt ; vec3 Nu , Nv , Nw , Nx , Ny ; Nv = normalize ( Lc ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME"],
group:{type:"group",parts:[{type:"textline",tokens:"Nu = textureCube ( u_sky , Nv ) . rgb ;".split(" ")}]}},{type:"elif",expression:["WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"Nu = u_horizon_color ; bu ( Nu ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:[";"]},{type:"condition",parts:[{type:"if",expression:["WO_SKYPAPER"],group:{type:"group",parts:[{type:"textline",
tokens:"Nw = vec3 ( bM , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Nw = vec3 ( Lc . xy , 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["Nr","=","0.0",";"]},{type:"condition",parts:[{type:"if",expression:["WO_SKYBLEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WO_SKYPAPER"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WO_SKYREAL"],group:{type:"group",parts:[{type:"textline",tokens:"Nr = abs ( bM . y ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Nr = ( bM . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ns = acos ( Nv . y ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WO_SKYREAL"],group:{type:"group",parts:[{type:"textline",tokens:"Nr = abs ( Ns * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Nr = 1.0 - Ns * INV_PI ;".split(" ")}]}}]}]}}]}]}}]},
{type:"textline",tokens:"Nx = u_horizon_color ; Ny = u_zenith_color ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WO_SKYTEX"],group:{type:"group",parts:[{type:"textline",tokens:"Ns = 1.0 ; Nq = textureCube ( u_sky , Nv ) ; br ( Nq . rgb ) ; Ns = Nq . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["MTEX_RGBTOINT"],group:{type:"group",parts:[{type:"textline",tokens:"Ns = bB ( Nq ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["MTEX_NEGATIVE"],
group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MTEX_RGBTOINT",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"Nq = vec4 ( vec3 ( 1.0 ) - Nq . rgb , Nq . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ns = 1.0 - Ns ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WOMAP_HORIZ","WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"condition",
parts:[{type:"if",expression:["MTEX_RGBTOINT"],group:{type:"group",parts:[{type:"textline",tokens:"Nq = vec4 ( u_sky_tex_color , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ns = Nq . a ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WOMAP_HORIZ"],group:{type:"group",parts:[{type:"textline",tokens:"Nx = Nh ( Nq . rgb , Nx , Ns , u_sky_tex_fac [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WOMAP_ZENUP","WOMAP_ZENDOWN",
{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["Nt","=","0.0",";"]},{type:"condition",parts:[{type:"if",expression:["WO_SKYREAL"],group:{type:"group",parts:[{type:"textline",tokens:"if ( dot ( Nw , vec3 ( 0.0 , 1.0 , 0.0 ) ) >= 0.0 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["WOMAP_ZENUP"],group:{type:"group",parts:[{type:"textline",tokens:"Nt = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:[";"]}]}}]},{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["WOMAP_ZENDOWN"],group:{type:"group",parts:[{type:"textline",tokens:"else Nt = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WOMAP_ZENUP"],group:{type:"group",parts:[{type:"textline",tokens:"Nt = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"elif",expression:["WOMAP_ZENDOWN"],group:{type:"group",parts:[{type:"textline",
tokens:"Nt = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"if ( Nt != 0.0 ) Ny = Nh ( Nq . rgb , Ny , Ns , Nt ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WOMAP_BLEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MTEX_RGBTOINT",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"Ns = dot ( Nq . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},{type:"textline",
tokens:"Nr = Np ( u_sky_tex_dvar , Nr , Ns , u_sky_tex_fac [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WO_SKYBLEND"],group:{type:"group",parts:[{type:"textline",tokens:"Nu = mix ( Nx , Ny , Nr ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Nu","=","Nx",";"]}]}}]},{type:"textline",tokens:["bu","(","Nu",")",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"bu ( Nx ) ; bu ( Ny ) ;".split(" ")},{type:"condition",
parts:[{type:"if",expression:["WO_SKYBLEND"],group:{type:"group",parts:[{type:"textline",tokens:"Nu = mix ( Nx , Ny , Nr ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Nu","=","Nx",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"REFLECTION_PASS",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"br ( Nu ) ; Nr = WATER_LEVEL - u_camera_eye_frag . y ; Nx = vec3 ( 0.0 ) ; Nx = mix ( u_underwater_fog_color_density . rgb , Nx , min ( - Nv . y , 1.0 ) ) ; Nx *= min ( 1.0 - min ( 0.03 * Nr , 0.8 ) , 1.0 ) ; Nr = clamp ( sign ( 0.01 * Nr - Nv . y ) , 0.0 , 1.0 ) ; Nu = mix ( Nu , Nx , Nr ) ; bu ( Nu ) ;".split(" ")}]}}]},
{type:"textline",tokens:"gl_FragColor = vec4 ( Nu , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 Lc ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",places:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"vec2","bM",";"]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 Nc , Nd ; Nc = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; Nd = u_sky_vp_inverse * Nc ; Lc = Nd . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",places:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bM = a_position . xy ;".split(" ")}]}}]},{type:"textline",tokens:["gl_Position",
"=","Nc",";","}"]}]};a["special_water.glslf"]={type:"group",parts:[{type:"var",name:"ABSORB",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"SSS_STRENGTH",tokens:["6.0"]},{type:"var",name:"SSS_WIDTH",tokens:["0.0"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",
tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",tokens:["0.001"]},
{type:"define",name:"REFR_BUMP",tokens:["0.0005"]},{type:"textline",tokens:["uniform","float","u_time",";"]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHORE_SMOOTHING","WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",
0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"vec2","u_normalmap2_scale",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",
tokens:"const float Nc = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",tokens:"varying vec3 vz ; varying vec3 bC ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2},"GENERATED_MESH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec3 bF ; varying vec3 Nd ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",
places:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","Ne",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","Nf",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:3}],group:{type:"group",
parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"vec3","tz",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","SHORE_SMOOTHING","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",tokens:"vec3 Nr ( in vec2 Ng , in vec3 Nh , in vec3 Ni , in vec3 Nj , out float Nk ) { float Nl , Nm , Nn ; vec2 No ; vec3 Np , Nq ; Nk = 0.0 ; Np = reflect ( - Ni , Nh ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"No = Ng . xy + Nh . xz * REFL_BUMP / bH ; Nk = u_reflect_factor ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},"WATER_EFFECTS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Nq = u_underwater_fog_color_density . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Nq = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",tokens:"} else { Nq = texture2D ( u_plane_reflection , No ) . rgb ; br ( Nq ) ; }".split(" ")}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Nk = u_mirror_factor ; Nq = Nj * textureCube ( u_mirrormap , Np ) . rgb ; br ( Nq ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"Nk = u_reflect_factor ; Nq = Nj * vec3 ( 0.3 , 0.5 , 1.0 ) ; br ( Nq ) ;".split(" ")}]}}]},{type:"textline",tokens:"Np = normalize ( Np + Ni ) ; Nl = 1.0 - dot ( Ni , Np ) ; Nm = u_fresnel_params [ 3 ] ; Nn = u_fresnel_params [ 2 ] ; Nn = Nm + ( 1.0 - Nm ) * pow ( Nl , Nn ) ; Nk = min ( Nk * Nn , 1.0 ) ; return Nq ; }".split(" ")},{type:"include",file:"lighting_nodes.glslf"},{type:"textline",tokens:"void main ( ) { vec4 Ns ; vec2 Nt , Nu , Nv ; float Nw , Nx , Ny , Nz , NA ; vec3 NB , NC , ND , NE , NF , NG , NH , NI , NJ ; mat3 NK ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"NK = mat3 ( bF , Nd , bE ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"NB = normalize ( bE ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"NB = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC",
"FOAM",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Nw = bC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"Nt = vec2 ( Ne . x , - Ne . z ) + 0.5 ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Nt = vec2 ( bC . x , - bC . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Nt","=","bM",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"NC = vec3 ( 0.0 ) ; ND = texture2D ( u_normalmap0 , Nt * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; NC += ND ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"NE = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NORM_FOAM0"],group:{type:"group",parts:[{type:"textline",tokens:["NE","+=","ND",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ND = texture2D ( u_normalmap0 , Nt * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; NC += ND ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORM_FOAM1"],group:{type:"group",parts:[{type:"textline",tokens:["NE","+=","ND",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ND = texture2D ( u_normalmap0 , Nt * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; NC += ND ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORM_FOAM2"],group:{type:"group",parts:[{type:"textline",tokens:["NE","+=","ND",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ND = texture2D ( u_normalmap0 , Nt * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; NC += ND ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORM_FOAM3"],group:{type:"group",parts:[{type:"textline",tokens:["NE","+=","ND",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"NE = NK * NE ; if ( ! f ( NE , vec3 ( 0.0 ) ) ) NE = normalize ( NE ) ; NE = mix ( NB , NE , 0.2 ) ; NE = normalize ( NE ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"NB = mix ( NB , normalize ( NK * NC ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"NB = mix ( NB , normalize ( NK * NC ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",tokens:"NB = normalize ( NB ) ;".split(" ")}]}}]},{type:"textline",tokens:"NC = normalize ( vz ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Nu = bG . xy / bG . z ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"Nv = Nu + NB . xz * u_refr_bump / bH ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING"],group:{type:"group",parts:[{type:"textline",tokens:"Nx = u_diffuse_color . a ; Ns = texture2DProj ( u_scene_depth , bG ) ; Ny = Z ( Ns ) ; Nz = max ( Ny - bH , 0.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"Ny = dY ( Ny , Nv , Nu ) ; Ny = max ( Ny - bH , 0.0 ) ; Ny = u_view_max_depth / ABSORB * Ny ; Ny = min ( Nx * Ny , 1.0 ) ; Nx = min ( 15.0 * Nx * u_view_max_depth * Nz , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"NA = u_view_max_depth / ABSORB * Nz ; if ( u_cam_water_depth > 0.0 ) Nx = min ( Nx * NA , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",
group:{type:"group",parts:[{type:"textline",tokens:"Nx = u_diffuse_color . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["Ny","=","Nx",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"if ( u_cam_water_depth < 0.0 ) Ny = 0.0 ; ND = texture2D ( u_refractmap , Nv ) . rgb ; br ( ND ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"NA = pow ( min ( Nf . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; NF = mix ( u_shallow_water_col , u_diffuse_color . rgb , NA ) ; NA = pow ( min ( Nf . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; NF = mix ( u_shore_water_col , NF , NA ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"NF = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["FOAM"],
group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING"],group:{type:"group",parts:[{type:"textline",tokens:"Nz = max ( 1.0 - u_view_max_depth * Nz , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Nz = 1.0 - Nx ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"Nw = max ( Nw / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"NG = normalize ( vec3 ( Nf . r , 0.0 , Nf . g ) ) ; NG = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , NG , 0.8 ) ) ; NA = 1.25 * max ( dot ( NE , NG ) - 0.2 , 0.0 ) ; NA += max ( dot ( NE , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; Nz += NA * ( 1.0 - Nf . b ) ; Nw *= ( 1.0 - 0.95 * pow ( Nf . b , 0.1 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"Nz += Nw ; Nz = min ( u_foam_factor * Nz , 1.0 ) ;".split(" ")}]}}]},{type:"textline",
tokens:"Ns = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + Nt * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",tokens:"Nw = u_specular_params [ 0 ] ; Nt = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; NE = Nw * u_specular_color ; NG = u_environment_energy * dS ( NB ) ; NG = u_ambient * NG ; NG = NG + u_sun_intensity ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"NH = Nr ( Nu , NB , NC , NG , Nw ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"NH = Nr ( vec2 ( 0.0 ) , NB , NC , NG , Nw ) ;".split(" ")}]}}]},{type:"textline",tokens:"NF = u_diffuse_intensity * NF ; xR ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , NF , NE , bC , NB , NC , Nt , u_diffuse_params , vec4 ( 1.0 ) , 0.0 , vec4 ( 0.0 ) , NI , NJ ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",
tokens:"NA = max ( dot ( u_sun_direction , - bE ) + SSS_WIDTH , 0.0 ) * max ( dot ( - NC , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; NA = clamp ( SSS_STRENGTH * NA , 0.0 , 1.0 ) ; NI = mix ( NI , u_shallow_water_col , NA ) ; NI = mix ( NI , u_shore_water_col , NA ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"NI = mix ( ND , NI , Ny ) ;".split(" ")}]}}]},{type:"textline",
tokens:"NI = mix ( NI , NH , Nw ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"Nw = mix ( Ns . g , Ns . r , max ( 4.0 * ( Nz - 0.75 ) , 0.0 ) ) ; Nw = mix ( Ns . b , Nw , max ( 2.0 * Nz - 1.0 , 0.0 ) ) ; Nw = mix ( 0.0 , Nw , Nz ) ; NI = mix ( NI , NG , Nw ) ;".split(" ")}]}}]},{type:"textline",tokens:["NI","+=","NJ",";"]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],
group:{type:"group",parts:[{type:"textline",tokens:"Nz = bH * u_view_max_depth ; Ny = 1.0 ; if ( u_cam_water_depth > 1.0 ) Ny = 2.0 ; vy ( NI , Nz , NC , Ny ) ;".split(" ")}]}}]},{type:"textline",tokens:["bu","(","NI",")",";"]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"Nx = max ( Nx , NJ . r ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",
tokens:["Nx","+=","Nw",";"]}]}}]}]}},{type:"elif",expression:["SHORE_SMOOTHING",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["Nx","=","1.0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"textline",tokens:"bx ( NI , Nx ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME",1,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"extension",tokens:["GL_OES_standard_derivatives",
":","enable"]},{type:"textline",tokens:"NJ = fwidth ( tz ) ; NJ = smoothstep ( vec3 ( 0.0 ) , NJ * Nc , tz ) ; Nw = min ( min ( NJ . x , NJ . y ) , NJ . z ) ; Nw = clamp ( Nw , 0.0 , 1.0 ) ; NI = mix ( u_wireframe_edge_color , NI , Nw ) ; Nx = mix ( 1.0 , Nx , Nw ) ;".split(" ")}]}},{type:"elif",expression:["DEBUG_WIREFRAME",2,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"NJ = sign ( tz - vec3 ( 0.02 * Nc ) ) ; Nw = 1.0 ; if ( NJ . x < 0.0 || NJ . y < 0.0 || NJ . z < 0.0 ) Nw = 0.0 ; NI = mix ( u_wireframe_edge_color , NI , Nw ) ; Nx = mix ( 1.0 , Nx , Nw ) ;".split(" ")}]}}]},
{type:"textline",tokens:"gl_FragColor = vec4 ( NI , Nx ) ; }".split(" ")}]};a["special_water.glslv"]={type:"group",parts:[{type:"var",name:"DIR_MIN_SHR_FAC",tokens:["0.0"]},{type:"var",name:"DIR_FREQ",tokens:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",tokens:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",tokens:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",tokens:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",tokens:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",tokens:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",
tokens:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",tokens:["0.0"]},{type:"var",name:"DST_MIN_FAC",tokens:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",tokens:["0.0"]},{type:"var",name:"PRECISION",tokens:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",tokens:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",tokens:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",tokens:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",tokens:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",
tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"WAVES_LENGTH",tokens:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"DYNAMIC",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_normal ; attribute vec3 a_tangent ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH",{type:"logic_negative_expr",places:1},"NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],
group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",
";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",tokens:"varying vec3 vz ; varying vec3 bC ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2},"GENERATED_MESH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["varying","vec2","bM",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec3 bF ; varying vec3 Nd ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",
0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","Ne",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","Nf",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",
{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",
parts:[{type:"textline",tokens:["varying","vec3","tz",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Nk ( in vec2 Nc ) { float Ng ; vec4 Nh ; vec2 Ni ; Ni = 0.5 + vec2 ( ( Nc . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( Nc . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; Nh = texture2D ( u_shore_dist_map , Ni ) ; const vec2 Nj = vec2 ( 1.0 / 255.0 , 1.0 ) ; Ng = dot ( Nh . ba , Nj ) ; Ni = normalize ( Nh . rg * 2.0 - 1.0 ) ; return vec3 ( Ni , Ng ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"define",name:"SMALL_WAVES_FAC",tokens:["0.3"]},{type:"textline",tokens:"void Nw ( inout vec3 Nl , in float Nm , in vec3 Nn ) { vec2 No , Np , Nq ; float Nr , Ns , Nt , Nu , Nv ; Nr = aU ( DST_NOISE_SCALE_0 * ( Nl . xz + DST_NOISE_FREQ_0 * Nm ) ) * aU ( DST_NOISE_SCALE_1 * ( Nl . zx - DST_NOISE_FREQ_1 * Nm ) ) ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"Ns = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; Nt = Nn . b ; Nu = sqrt ( Nt ) ; Ns = max ( Nt , DIR_MIN_SHR_FAC ) * sin ( Nu / Ns + DIR_FREQ * Nm ) ; Nv = max ( aU ( DIR_NOISE_SCALE * ( Nl . xz + DIR_NOISE_FREQ * Nm ) ) , DIR_MIN_NOISE_FAC ) ; Ns *= Nv ; Nu = WAVES_HEIGHT * mix ( Ns , Nr , max ( Nu , DST_MIN_FAC ) ) ; No = Nn . rg ; Ns = WAVES_HOR_FAC * Ns * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - Nt ) , 0.0 ) ; No = Ns * No ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Nu = WAVES_HEIGHT * Nr ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],group:{type:"group",parts:[{type:"textline",tokens:"Np = 2.0 * ( Nl . xz - 0.1 * Nm ) ; Nq = 1.3 * ( Nl . zx + 0.03 * Nm ) ; Nr = ay ( 0.5 * ( Np + Nq ) ) . x - 0.5 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"Nl . xz += No ; Nr *= Nt ;".split(" ")}]}}]},
{type:"textline",tokens:"Nu += SMALL_WAVES_FAC * Nr ;".split(" ")}]}}]},{type:"textline",tokens:"Nl . y += Nu ; }".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { vec4 Nx , Ny ; vec2 Nz ; float NA , NB , NC ; vec3 ND , NE , NF , NG , NH ; mat4 NI , NJ ; NI = O ( u_view_tsr ) ; NJ = O ( u_model_tsr ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",tokens:"if ( a_polyindex == 0.0 ) tz = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) tz = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) tz = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],group:{type:"group",parts:[{type:"textline",tokens:"ND = a_position ; NA = abs ( ND . y ) ; Nz = u_camera_eye . xz - mod ( u_camera_eye . xz , NA ) ; ND . y = WATER_LEVEL ; ND . xz += Nz ; ND = ND ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["bM",
"=","a_texcoord",";"]}]}}]},{type:"textline",tokens:"c NK = rF ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , NJ ) ; ND = NK . a ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"Nf = Nk ( ND . xz ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"NB = length ( u_wind ) ; NC = u_time ; NC *= NB ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],group:{type:"group",parts:[{type:"textline",tokens:"NA = NA ; NE = ND + vec3 ( NA , 0.0 , 0.0 ) ; NF = ND + vec3 ( 0.0 , 0.0 , NA ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["Ne","=","ND",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"NE = ND + vec3 ( 0.05 , 0.0 , 0.0 ) ; NF = ND + vec3 ( 0.0 , 0.0 , 0.05 ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"NG = Nk ( NE . xz ) ; NH = Nk ( NF . xz ) ; Nw ( NE , NC , NG ) ; Nw ( NF , NC , NH ) ; Nw ( ND , NC , Nf ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Nw ( NE , NC , vec3 ( 0.0 ) ) ; Nw ( NF , NC , vec3 ( 0.0 ) ) ; Nw ( ND , NC , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],group:{type:"group",
parts:[{type:"textline",tokens:"if ( a_position . y < 0.0 ) { ND . y = WATER_LEVEL - 1.0 ; NE . y = ND . y ; NF . y = ND . y ; }".split(" ")}]}}]},{type:"textline",tokens:"NE = normalize ( NE - ND ) ; NF = normalize ( NF - ND ) ; bE = normalize ( cross ( NF , NE ) ) ; NC = dot ( bE , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; NC = clamp ( 0.8 - NC , 0.0 , 1.0 ) ; bE = mix ( bE , vec3 ( 0.0 , 1.0 , 0.0 ) , NC ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",
places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"NF = a_tangent ; bE = a_normal ;".split(" ")}]}}]},{type:"textline",tokens:"bF = NF ; Nd = cross ( bE , bF ) ;".split(" ")}]}}]},{type:"textline",tokens:"bC = ND ; vz = u_camera_eye - ND ; Nx = NI * vec4 ( ND , 1.0 ) ; Ny = u_proj_matrix * Nx ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING",
"REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"NC = Ny . x ; NA = Ny . y ; NB = Ny . w ; bG . x = ( NC + NB ) / 2.0 ; bG . y = ( NA + NB ) / 2.0 ; bG . z = NB ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",
places:4}],group:{type:"group",parts:[{type:"textline",tokens:"bH = - Nx . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:["gl_Position","=","Ny",";","}"]}]};a["postprocessing/antialiasing.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",tokens:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"define",name:"AA_METHOD_FXAA_LIGHT",tokens:["1"]},{type:"define",
name:"AA_METHOD_FXAA_QUALITY",tokens:["2"]},{type:"define",name:"AA_QUALITY_LOW",tokens:["0"]},{type:"define",name:"AA_QUALITY_MEDIUM",tokens:["1"]},{type:"define",name:"AA_QUALITY_HIGH",tokens:["2"]},{type:"condition",parts:[{type:"if",expression:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_REDUCE_MIN",tokens:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",tokens:["(","1.0","/","8.0",")"]},{type:"define",
name:"FXAA_SPAN_MAX",tokens:["8.0"]},{type:"textline",tokens:"vec4 Ni ( float Nc , float Ng ) { vec2 Nh ; Nh = bM + vec2 ( Nc , Ng ) * u_texel_size ; return texture2D ( u_color , Nh ) ; } vec4 Nv ( ) { vec2 Nj ; float Nk , Nl , Nm , Nn , No , Np ; vec4 Nq , Nr , Ns , Nt , Nu ; Nq = Ni ( - 1.0 , - 1.0 ) ; Nr = Ni ( 1.0 , - 1.0 ) ; Ns = Ni ( - 1.0 , 1.0 ) ; Nt = Ni ( 1.0 , 1.0 ) ; Nu = Ni ( 0.0 , 0.0 ) ; Nk = bB ( Nu ) ; Nl = bB ( Nq ) ; Nm = bB ( Nr ) ; Nn = bB ( Ns ) ; No = bB ( Nt ) ; Np = min ( Nk , min ( min ( Nl , Nm ) , min ( Nn , No ) ) ) ; Nk = max ( Nk , max ( max ( Nl , Nm ) , max ( Nn , No ) ) ) ; Nj . x = - ( ( Nl + Nm ) - ( Nn + No ) ) ; Nj . y = ( ( Nl + Nn ) - ( Nm + No ) ) ; No = max ( ( Nl + Nm + Nn + No ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; No = 1.0 / ( min ( abs ( Nj . x ) , abs ( Nj . y ) ) + No ) ; Nj = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , Nj * No ) ) * u_texel_size ; Nt = 0.5 * ( texture2D ( u_color , bM + Nj * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , bM + Nj * ( 2.0 / 3.0 - 0.5 ) ) ) ; Ns = Nt * 0.5 + 0.25 * ( texture2D ( u_color , bM + Nj * - 0.5 ) + texture2D ( u_color , bM + Nj * 0.5 ) ) ; No = bB ( Ns ) ; if ( ( No < Np ) || ( No > Nk ) ) return Nt ; else return Ns ; }".split(" ")}]}},
{type:"elif",expression:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_GREEN_AS_LUMA",tokens:["1"]},{type:"define",name:"FXAA_BLEND4WEB",tokens:["1"]},{type:"include",file:"fxaa.glslf"},{type:"condition",parts:[{type:"if",expression:["AA_QUALITY","AA_QUALITY_HIGH",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PRESET",tokens:["39"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",tokens:["1.00"]},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",tokens:["0.063"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",tokens:["0.0312"]}]}},{type:"elif",expression:["AA_QUALITY","AA_QUALITY_MEDIUM",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PRESET",tokens:["20"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",tokens:["0.65"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",tokens:["0.166"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",tokens:["0.0625"]}]}},
{type:"elif",expression:["AA_QUALITY","AA_QUALITY_LOW",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PRESET",tokens:["12"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",tokens:["0.50"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",tokens:["0.166"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",tokens:["0.0833"]}]}}]}]}}]},{type:"textline",tokens:"void main ( ) { vec2 Om ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["AA_METHOD",
"AA_METHOD_FXAA_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = Nv ( ) ;".split(" ")}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Om = u_texel_size ; gl_FragColor = Ol ( bM , u_color , Om , FXAA_QUALITY_SUBPIX , FXAA_QUALITY_EDGE_THRESHOLD , FXAA_QUALITY_EDGE_THRESHOLD_MIN ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["postprocessing/bloom_blur.glslf"]=
{type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 bM ; void main ( ) { vec4 Nc ; vec2 Ng , Nh ; Ng = vec2 ( 0.0 , 0.0 ) ; Nh = u_texel_size ; Nc = texture2D ( u_color , bM ) ; gl_FragColor = Nc * 0.0875447373698 ; Ng += Nh ; gl_FragColor += texture2D ( u_color , bM + Ng ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , bM - Ng ) * 0.0858112354248 ; Ng += Nh ; gl_FragColor += texture2D ( u_color , bM + Ng ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , bM - Ng ) * 0.0808139781061 ; Ng += Nh ; gl_FragColor += texture2D ( u_color , bM + Ng ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , bM - Ng ) * 0.0731235112908 ; Ng += Nh ; gl_FragColor += texture2D ( u_color , bM + Ng ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , bM - Ng ) * 0.0635705267419 ; Ng += Nh ; gl_FragColor += texture2D ( u_color , bM + Ng ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , bM - Ng ) * 0.0530985673112 ; Ng += Nh ; gl_FragColor += texture2D ( u_color , bM + Ng ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , bM - Ng ) * 0.0426125984122 ; Ng += Nh ; gl_FragColor += texture2D ( u_color , bM + Ng ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , bM - Ng ) * 0.0328565115809 ; Ng += Nh ; gl_FragColor += texture2D ( u_color , bM + Ng ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , bM - Ng ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * Nc , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 bM ; void main ( ) { vec4 Nc , Ng ; Nc = texture2D ( u_main , bM ) ; Ng = texture2D ( u_bloom , bM ) ; Nc = Nc ; Nc += Ng ; gl_FragColor = vec4 ( Nc . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"color_util.glslf"},{type:"define",name:"PI_4",tokens:["0.785398163"]},{type:"textline",tokens:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 bM ; void main ( ) { float Nc ; vec3 Ng ; vec4 Nh ; Nh = texture2D ( u_color , bM ) ; Ng = Nh . rgb ; if ( u_brightness < 0.0 ) Ng = Ng * ( 1.0 + u_brightness ) ; else Ng = Ng + ( ( 1.0 - Ng ) * u_brightness ) ; Ng = ( Ng - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; Ng *= u_exposure ; Nc = bB ( vec4 ( Ng , 0.0 ) ) ; Ng = mix ( vec3 ( Nc ) , Ng , u_saturation ) ; gl_FragColor = vec4 ( Ng , Nh . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",tokens:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 bM ; void main ( ) { gl_FragColor = V ( clamp ( Os ( u_depth , bM , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};
a["postprocessing/dof.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",tokens:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 bM ; void main ( ) { float Nc , Ng ; vec4 Nh , Ni ; Nh = texture2D ( u_sharp , bM ) ; if ( u_dof_dist > 0.0 ) { Nc = Os ( u_depth , bM , u_camera_range ) ; Nc *= u_view_max_depth ; if ( Nc < u_dof_dist ) Ng = ( u_dof_dist - Nc ) / u_dof_front ; else Ng = ( Nc - u_dof_dist ) / u_dof_rear ; Ng = clamp ( Ng , 0.0 , 1.0 ) ; Ni = texture2D ( u_blurred , bM ) ; gl_FragColor = mix ( Nh , Ni , Ng ) ; } else gl_FragColor = Nh ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_src_color ; uniform sampler2D u_glow_mask_small ; uniform sampler2D u_glow_mask_large ; uniform float u_glow_mask_small_coeff ; uniform float u_glow_mask_large_coeff ; varying vec2 bM ; void main ( ) { float Nc ; vec4 Ng , Nh , Ni ; Ng = texture2D ( u_src_color , bM ) ; Nh = texture2D ( u_glow_mask_small , bM ) ; Ni = texture2D ( u_glow_mask_large , bM ) ; gl_FragColor = Ng ; if ( Ni . a != 0.0 ) { Nc = u_glow_mask_large_coeff * Ni . a ; Nc = clamp ( Nc , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , Ni . rgb / Ni . a , Nc ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , Nc ) ; } if ( Nh . a != 0.0 ) { Nc = u_glow_mask_small_coeff * Nh . a ; Nc = clamp ( Nc , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , Nh . rgb / Nh . a , Nc ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , Nc ) ; } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",tokens:["0.0"]},{type:"textline",tokens:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_camera_range",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"varying float Ot ; varying vec2 Ou ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"varying vec2 bM ; varying vec4 Ov ; void main ( ) { vec4 Ow ; int Ox ; float Oy , Oz , OA , OB ; vec2 OC , OD , OE ; OC = ( Ov . xy - bM ) ; Oy = length ( OC ) ; OC = u_radial_blur_step * OC / Oy ; Oz = Oy / u_radial_blur_step ; OC *= min ( Oz , STEPS_PER_PASS ) / STEPS_PER_PASS ; Oz = max ( Oz , STEPS_PER_PASS ) ; OD = bM ; OA = 0.0 ; const int OF = int ( STEPS_PER_PASS ) ; Ox = int ( Oz + 0.5 ) ; for ( int OG = 0 ; OG < OF ; OG += 1 ) { if ( OG <= Ox ) {".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA"],group:{type:"group",parts:[{type:"textline",tokens:"Oz = Os ( u_input , OD , u_camera_range ) ; OA += max ( ( 1.0 - pow ( Oy , 0.3 ) ) * step ( 0.9 , Oz ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ow = texture2D ( u_input , OD ) ; OA += Z ( Ow ) ;".split(" ")}]}}]},{type:"textline",tokens:"} OD += OC ; }".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA","WATER_EFFECTS",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"OE = bM + Ou ; OB = ay ( vec2 ( 2.5 * ( OE . x ) , 2.5 * ( OE . y ) + 1.0 * u_time ) ) . x + 0.75 * ay ( vec2 ( 5.0 * ( OE . x ) - 0.66 * u_time , 5.0 * ( OE . y ) + 0.66 * u_time ) ) . x + 0.5 * aU ( vec2 ( 7.5 * ( OE . x ) + 0.33 * u_time , 7.5 * ( OE . y ) - 0.33 * u_time ) ) ; OB *= clamp ( 1.2 - sqrt ( 0.2 * Oy ) , 0.0 , 1.0 ) * Ot ; OA = max ( OB , OA ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = V ( OA / STEPS_PER_PASS ) ; }".split(" ")}]};
a["postprocessing/god_rays.glslv"]={type:"group",parts:[{type:"include",file:"math.glslv"},{type:"textline",tokens:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float Ot ; varying vec2 Ou ;".split(" ")}]}}]}]}}]},
{type:"textline",tokens:"varying vec2 bM ; varying vec4 Ov ; void main ( ) { float Nc , Ng ; vec3 Nh ; bM = a_bb_vertex + 0.5 ; Nh = normalize ( u_sun_direction ) ; Ov = u_view_proj_matrix * vec4 ( Nh , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( u_cam_water_depth < 0.0 ) { Ot = 1.0 ; Nh = vec3 ( 0.0 , 1.0 , 0.0 ) ; Nh = i ( u_camera_quat , Nh ) ; Nh = normalize ( Nh ) ; Nc = dot ( Nh , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; Ng = atan ( Nh . x , Nh . z ) ; Ou = vec2 ( - Ng , acos ( Nc ) ) ; } else { Ot = 0.0 ; }".split(" ")}]}}]},
{type:"textline",tokens:"Ov . xy = 0.5 * ( Ov . xy / Ov . w + 1.0 ) ; Ov += 99999.0 * step ( Ov . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/god_rays_combine.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",tokens:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 bM ; void main ( ) { float Nc ; vec3 Ng ; vec4 Nh ; Nh = texture2D ( u_main , bM ) ; Ng = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; br ( Nh . rgb ) ; Nc = Z ( texture2D ( u_god_rays , bM ) ) ; Ng = Nh . rgb + u_god_rays_intensity * vec3 ( Nc ) * Ng ; bu ( Ng ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SAFARI_CANVAS_ALPHA_HACK"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( Ng , max ( 0.01 , Nh . a ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( Ng , Nh . a ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["postprocessing/luminance.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_input ; varying vec2 bM ; void main ( ) { float Nc ; vec4 Ng ; Ng = texture2D ( u_input , bM ) ; Nc = dot ( Ng . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( Nc ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_av.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_input ; void main ( ) { float Nc , Ng , Nh , Ni ; Ng = 0.0 ; Nh = 0.025 ; Ni = 0.025 ; for ( int Nj = 0 ; Nj < 20 ; Nj += 1 ) { Ni = 0.025 ; for ( int Nk = 0 ; Nk < 20 ; Nk += 1 ) { Nc = max ( texture2D ( u_input , vec2 ( Nh , Ni ) ) . r , 0.01 ) ; Ng += log ( Nc ) ; Ni += 0.05 ; } Nh += 0.05 ; } Ng = exp ( Ng / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( Ng ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 bM ; varying float Ow ; void main ( ) { vec4 Ox ; float Oy , Oz ; Oy = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; Oz = texture2D ( u_luminance , bM ) . r ; Ox = texture2D ( u_main , bM ) ; Oy = Oz / Oy ; Oz = u_bloom_edge_lum ; gl_FragColor = Ox * max ( Oy - Oz , 0.0 ) * Ow ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 bM ; varying float Ow ; const vec3 Nc = vec3 ( 0.0 , 1.0 , 0.0 ) ; void Nn ( in vec4 Ng , in vec3 Nh , out vec3 Ni ) { float Nj , Nk , Nl , Nm ; Nj = Ng . w * Nh . x + Ng . y * Nh . z - Ng . z * Nh . y ; Nk = Ng . w * Nh . y + Ng . z * Nh . x - Ng . x * Nh . z ; Nl = Ng . w * Nh . z + Ng . x * Nh . y - Ng . y * Nh . x ; Nm = - Ng . x * Nh . x - Ng . y * Nh . y - Ng . z * Nh . z ; Ni . x = Nj * Ng . w - Nm * Ng . x - Nk * Ng . z + Nl * Ng . y ; Ni . y = Nk * Ng . w - Nm * Ng . y - Nl * Ng . x + Nj * Ng . z ; Ni . z = Nl * Ng . w - Nm * Ng . z - Nj * Ng . y + Nk * Ng . x ; } void main ( ) { vec3 No ; bM = 2.0 * a_position ; Nn ( u_camera_quat , Nc , No ) ; Ow = dot ( - No , u_sun_direction ) * u_bloom_key ; Ow *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; uniform float u_motion_blur_decay_threshold ; varying vec2 bM ; float Nc = 0.0042 ; void main ( ) { vec4 Ng , Nh , Ni , Nj ; Ng = texture2D ( u_mb_tex_curr , bM ) ; Nh = texture2D ( u_mb_tex_accum , bM ) ; if ( length ( Ng - Nh ) > u_motion_blur_decay_threshold ) { Ni = ( 1.0 - u_motion_blur_exp ) * Ng + u_motion_blur_exp * Nh ; Ni = Ni - Nh ; Nj = Ng - Nh ; Ni = min ( max ( abs ( Ni ) , vec4 ( Nc ) ) , abs ( Nj ) ) * sign ( Ni ) ; gl_FragColor = Nh + Ni ; } else { gl_FragColor = Ng ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",tokens:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 bM ; void main ( ) { vec3 Nc ; float Ng ; vec4 Nh , Ni , Nj ; Nh = texture2D ( u_outline_src , bM ) ; gl_FragColor = Nh ; if ( u_draw_outline != 0.0 ) { Ni = texture2D ( u_outline_mask , bM ) ; Nj = texture2D ( u_outline_mask_blurred , bM ) ; Ng = Nj . a - Ni . a ; if ( Ng != 0.0 ) { Ng = smoothstep ( 0.0 , 1.0 , Nj . a ) ; if ( Ni . a == 0.0 ) { Nc = u_outline_color ; bu ( Nc ) ; Ni = vec4 ( clamp ( Nc , 0.0 , 1.0 ) , 1.0 ) ; gl_FragColor = mix ( Nh , Ni , Ng ) ; } } } }".split(" ")}]};
a["postprocessing/performance.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_color ; varying vec2 bM ; void main ( ) { vec4 Nc ; Nc = vec4 ( 0.0 ) ; for ( int Ng = 0 ; Ng < 100 ; Ng ++ ) Nc += 0.001 * texture2D ( u_color , bM + vec2 ( 0.001 * vec2 ( Ng ) ) ) ; gl_FragColor = Nc ; }".split(" ")}]};a["postprocessing/postprocessing.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"define",
name:"POST_EFFECT_NONE",tokens:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",tokens:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",tokens:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",tokens:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",tokens:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",tokens:["6"]},{type:"define",name:"FLIP_CUBEMAP_COORDS",tokens:["7"]},{type:"textline",tokens:"uniform vec2 u_texel_size ; uniform sampler2D u_color ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform int u_tex_number ; uniform vec2 u_delta ;".split(" ")}]}}]},{type:"textline",tokens:"varying vec2 bM ; void main ( ) { float Nc , Ng , Nh , Ni ; vec2 Nj , Nk ; vec4 Nl ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["POST_EFFECT","POST_EFFECT_NONE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = texture2D ( u_color , bM ) ;".split(" ")}]}},
{type:"elif",expression:["POST_EFFECT","POST_EFFECT_GRAYSCALE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Nl = texture2D ( u_color , bM ) ; gl_FragColor . rgb = vec3 ( ( Nl . r + Nl . g + Nl . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",expression:["POST_EFFECT","POST_EFFECT_X_BLUR",{type:"equal_expr",places:2},"POST_EFFECT","POST_EFFECT_Y_BLUR",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"Nj = vec2 ( 0.0 , 0.0 ) ; Nk = u_texel_size ; Nl = texture2D ( u_color , bM ) ; gl_FragColor = Nl * 0.2270270270 ; Nj += Nk ; Nl = texture2D ( u_color , bM + Nj ) ; gl_FragColor += Nl * 0.1945945946 ; Nl = texture2D ( u_color , bM - Nj ) ; gl_FragColor += Nl * 0.1945945946 ; Nj += Nk ; Nl = texture2D ( u_color , bM + Nj ) ; gl_FragColor += Nl * 0.1216216216 ; Nl = texture2D ( u_color , bM - Nj ) ; gl_FragColor += Nl * 0.1216216216 ; Nj += Nk ; Nl = texture2D ( u_color , bM + Nj ) ; gl_FragColor += Nl * 0.0540540541 ; Nl = texture2D ( u_color , bM - Nj ) ; gl_FragColor += Nl * 0.0540540541 ; Nj += Nk ; Nl = texture2D ( u_color , bM + Nj ) ; gl_FragColor += Nl * 0.0162162162 ; Nl = texture2D ( u_color , bM - Nj ) ; gl_FragColor += Nl * 0.0162162162 ;".split(" ")}]}},
{type:"elif",expression:["POST_EFFECT","POST_EFFECT_X_GLOW_BLUR",{type:"equal_expr",places:2},"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Nj = vec2 ( 0.0 , 0.0 ) ; Nk = u_texel_size ; Nl = texture2D ( u_color , bM ) ; gl_FragColor = Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.152507 ; Nj += Nk ; Nl = texture2D ( u_color , bM + Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.141763 ; Nl = texture2D ( u_color , bM - Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.141763 ; Nj += Nk ; Nl = texture2D ( u_color , bM + Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.113861 ; Nl = texture2D ( u_color , bM - Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.113861 ; Nj += Nk ; Nl = texture2D ( u_color , bM + Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.079019 ; Nl = texture2D ( u_color , bM - Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.079019 ; Nj += Nk ; Nl = texture2D ( u_color , bM + Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.047383 ; Nl = texture2D ( u_color , bM - Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.047383 ; Nj += Nk ; Nl = texture2D ( u_color , bM + Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.024549 ; Nl = texture2D ( u_color , bM - Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.024549 ; Nj += Nk ; Nl = texture2D ( u_color , bM + Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.01099 ; Nl = texture2D ( u_color , bM - Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.01099 ; Nj += Nk ; Nl = texture2D ( u_color , bM + Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.00425 ; Nl = texture2D ( u_color , bM - Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.00425 ; Nj += Nk ; Nl = texture2D ( u_color , bM + Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.00142 ; Nl = texture2D ( u_color , bM - Nj ) ; gl_FragColor += Nl * ( 1.0 - step ( 0.0 , - Nl . a ) ) * 0.00142 ; gl_FragColor = clamp ( gl_FragColor , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",expression:["POST_EFFECT","POST_EFFECT_X_EXTEND",{type:"equal_expr",places:2},"POST_EFFECT","POST_EFFECT_Y_EXTEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Nk = u_texel_size ; Nl = texture2D ( u_color , bM ) ; gl_FragColor = Nl ; if ( Nl . a == 0.0 ) { Nl = texture2D ( u_color , bM + Nk ) ; if ( Nl . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Nl . a ) ; else { Nl = texture2D ( u_color , bM - Nk ) ; if ( Nl . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Nl . a ) ; } }".split(" ")}]}},
{type:"elif",expression:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Nc = u_delta [ 0 ] ; Ng = u_delta [ 1 ] ; Nh = 1.0 / 3.0 ; Ni = 0.5 ; Nk = vec2 ( Nh , Ni ) ; if ( u_tex_number == 0 ) { Nj = bM * Nk + vec2 ( 2.0 * Nh , 0.0 ) ; Nj [ 0 ] = min ( Nj [ 0 ] , 1.0 - Nc ) ; Nj [ 1 ] = min ( Nj [ 1 ] , 0.5 - Ng ) ; gl_FragColor = texture2D ( u_color , vec2 ( 5.0 * Nh - Nj [ 0 ] , Nj [ 1 ] ) ) ; } else if ( u_tex_number == 1 ) { Nj = bM * Nk ; Nj [ 0 ] = max ( Nj [ 0 ] , Nc ) ; Nj [ 1 ] = min ( Nj [ 1 ] , 0.5 - Ng ) ; gl_FragColor = texture2D ( u_color , vec2 ( Nh - Nj [ 0 ] , Nj [ 1 ] ) ) ; } else if ( u_tex_number == 2 ) { Nj = bM * Nk + vec2 ( Nh , Ni ) ; Nj [ 0 ] = max ( Nj [ 0 ] , Nh + Nc ) ; Nj [ 0 ] = min ( Nj [ 0 ] , 2.0 * Nh - Nc ) ; Nj [ 1 ] = min ( Nj [ 1 ] , 1.0 - Ng ) ; gl_FragColor = texture2D ( u_color , vec2 ( Nj [ 0 ] , 3.0 * Ni - Nj [ 1 ] ) ) ; } else if ( u_tex_number == 3 ) { Nj = bM * Nk + vec2 ( 0.0 , Ni ) ; Nj [ 0 ] = min ( Nj [ 0 ] , Nh - Nc ) ; Nj [ 1 ] = min ( Nj [ 1 ] , 1.0 - Ng ) ; gl_FragColor = texture2D ( u_color , vec2 ( Nj [ 0 ] , 3.0 * Ni - Nj [ 1 ] ) ) ; } else if ( u_tex_number == 4 ) { Nj = bM * Nk + vec2 ( Nh , 0.0 ) ; Nj [ 0 ] = max ( Nj [ 0 ] , Nh + Nc ) ; Nj [ 0 ] = min ( Nj [ 0 ] , 2.0 * Nh - Nc ) ; Nj [ 1 ] = min ( Nj [ 1 ] , 0.5 - Ng ) ; gl_FragColor = texture2D ( u_color , vec2 ( 1.0 - Nj [ 0 ] , Nj [ 1 ] ) ) ; } else { Nk = bM * Nk + vec2 ( 2.0 * Nh , Ni ) ; Nk [ 0 ] = min ( Nk [ 0 ] , 1.0 - Nc ) ; Nk [ 1 ] = max ( Nk [ 1 ] , 0.5 + Ng ) ; gl_FragColor = texture2D ( u_color , vec2 ( 5.0 * Nh - Nk [ 0 ] , Nk [ 1 ] ) ) ; }".split(" ")}]}}]},
{type:"textline",tokens:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec2 a_position ; varying vec2 bM ; void main ( ) { bM = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",
tokens:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",tokens:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",tokens:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",tokens:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",tokens:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",tokens:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",tokens:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",tokens:["4"]},{type:"textline",tokens:["uniform","sampler2D","u_color",";"]},{type:"condition",
parts:[{type:"if",expression:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2},"SMAA_PREDICATION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},
{type:"textline",tokens:"uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","Ox",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"varying vec4 Oy ; varying vec4 Oz ; varying vec4 OA ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","OB",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",tokens:["1"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",tokens:["1"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",
tokens:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",tokens:["25"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",tokens:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",tokens:["25"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.1"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",parts:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",tokens:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",tokens:["8"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",
parts:[{type:"define",name:"SMAA_CORNER_ROUNDING",tokens:["25"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",parts:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",tokens:["2.0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",parts:[{type:"define",name:"SMAA_PREDICATION",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",
parts:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",tokens:["0.01"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",parts:[{type:"define",name:"SMAA_PREDICATION_SCALE",tokens:["2.0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",parts:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",tokens:["0.4"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",parts:[{type:"define",
name:"SMAA_REPROJECTION",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",parts:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",tokens:["30.0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",tokens:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",tokens:["20"]},
{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",tokens:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",tokens:["(","1.0","/","7.0",")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",tokens:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",tokens:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",tokens:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 OH ( vec2 OC , sampler2D OD ) { float OE , OF , OG ; OE = texture2D ( OD , OC ) . r ; OF = texture2D ( OD , Oy . xy ) . r ; OG = texture2D ( OD , Oy . zw ) . r ; return vec3 ( OE , OF , OG ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"vec2 OM ( vec2 OI , sampler2D OJ ) { vec2 OK ; vec3 OL ; OL = OH ( OI , OJ ) ; OK = abs ( OL . xx - OL . yz ) ; OK = step ( SMAA_PREDICATION_THRESHOLD , OK ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * OK ) ; }".split(" ")}]}}]},{type:"textline",tokens:"void OQ ( bvec2 ON , inout vec2 OO , vec2 OP ) { if ( ON . x ) OO . x = OP . x ; if ( ON . y ) OO . y = OP . y ; } void OQ ( bvec4 OR , inout vec4 OS , vec4 OT ) { OQ ( OR . xy , OS . xy , OT . xy ) ; OQ ( OR . zw , OS . zw , OT . zw ) ; } vec2 OV ( vec2 OU ) { return sign ( OU ) * floor ( abs ( OU ) + .5 ) ; } vec4 OV ( vec4 OW ) { return sign ( OW ) * floor ( abs ( OW ) + .5 ) ; }".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 Pi ( vec2 OX , sampler2D OY".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PREDICATION"],group:{type:"group",parts:[{type:"textline",tokens:[",","sampler2D","OZ"]}]}}]},{type:"textline",tokens:") { vec4 O_ ; float Pa , Pb , Pc , Pd , Pe ; vec3 Pf ; vec2 Pg , Ph ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SMAA_PREDICATION"],group:{type:"group",parts:[{type:"textline",tokens:"Pg = OM ( OX , OZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Pg = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",tokens:"Pf = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; Pa = dot ( texture2D ( OY , OX ) . rgb , Pf ) ; Pb = dot ( texture2D ( OY , Oy . xy ) . rgb , Pf ) ; Pc = dot ( texture2D ( OY , Oy . zw ) . rgb , Pf ) ; O_ . xy = abs ( Pa - vec2 ( Pb , Pc ) ) ; Pg = step ( Pg , O_ . xy ) ; if ( dot ( Pg , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; Pd = dot ( texture2D ( OY , Oz . xy ) . rgb , Pf ) ; Pe = dot ( texture2D ( OY , Oz . zw ) . rgb , Pf ) ; O_ . zw = abs ( Pa - vec2 ( Pd , Pe ) ) ; Ph = max ( O_ . xy , O_ . zw ) ; Pe = dot ( texture2D ( OY , OA . xy ) . rgb , Pf ) ; Pd = dot ( texture2D ( OY , OA . zw ) . rgb , Pf ) ; O_ . zw = abs ( vec2 ( Pb , Pc ) - vec2 ( Pe , Pd ) ) ; Ph = max ( Ph . xy , O_ . zw ) ; Pd = max ( Ph . x , Ph . y ) ; Pg . xy *= step ( Pd , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * O_ . xy ) ; return Pg ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 Pk ( vec2 Pj ) { Pj . r = Pj . r * abs ( 5.0 * Pj . r - 5.0 * 0.75 ) ; return OV ( Pj ) ; } vec4 Pk ( vec4 Pl ) { Pl . rb = Pl . rb * abs ( 5.0 * Pl . rb - 5.0 * 0.75 ) ; return OV ( Pl ) ; } vec2 Pt ( sampler2D Pm , vec2 Pn , vec2 Po , out vec2 Pp ) { vec3 Pq ; vec4 Pr ; Pr = vec4 ( Pn , - 1.0 , 1.0 ) ; Pq = vec3 ( u_texel_size , 1.0 ) ; for ( int Ps = 0 ; Ps < SMAA_MAX_SEARCH_STEPS_DIAG ; Ps ++ ) { if ( Pr . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Pr . w > 0.9 ) { Pr . xyz += Pq * vec3 ( Po , 1.0 ) ; Pp = texture2D ( Pm , Pr . xy , 0.0 ) . rg ; Pr . w = dot ( Pp , vec2 ( 0.5 , 0.5 ) ) ; } } return Pr . zw ; } vec2 PB ( sampler2D Pu , vec2 Pv , vec2 Pw , out vec2 Px ) { vec3 Py ; vec4 Pz ; Pz = vec4 ( Pv , - 1.0 , 1.0 ) ; Pz . x += 0.25 * u_texel_size . x ; Py = vec3 ( u_texel_size , 1.0 ) ; for ( int PA = 0 ; PA < SMAA_MAX_SEARCH_STEPS_DIAG ; PA ++ ) { if ( Pz . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Pz . w > 0.9 ) { Pz . xyz = Py * vec3 ( Pw , 1.0 ) + Pz . xyz ; Px = texture2D ( Pu , Pz . xy , 0.0 ) . rg ; Px = Pk ( Px ) ; Pz . w = dot ( Px , vec2 ( 0.5 , 0.5 ) ) ; } } return Pz . zw ; } vec2 PH ( sampler2D PC , vec2 PD , vec2 PE , float PF ) { vec2 PG ; PG = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * PE + PD ; PG = SMAA_AREATEX_PIXEL_SIZE * PG + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; PG . x += 0.5 ; PG . y += SMAA_AREATEX_SUBTEX_SIZE * PF ; return texture2D ( PC , PG , 0.0 ) . rg ; } vec2 PT ( sampler2D PI , sampler2D PJ , vec2 PK , vec2 PL , vec4 PM ) { vec4 PN , PO , PP ; vec2 PQ , PR , PS ; PQ = vec2 ( 0.0 , 0.0 ) ; if ( PL . r > 0.0 ) { PN . xz = Pt ( PI , PK , vec2 ( - 1.0 , 1.0 ) , PR ) ; PN . x += float ( PR . y > 0.9 ) ; } else PN . xz = vec2 ( 0.0 , 0.0 ) ; PN . yw = Pt ( PI , PK , vec2 ( 1.0 , - 1.0 ) , PR ) ; if ( PN . x + PN . y > 2.0 ) { PO = vec4 ( - PN . x + 0.25 , PN . x , PN . y , - PN . y - 0.25 ) * u_texel_size . xyxy + PK . xyxy ; PP . xy = texture2D ( PI , PO . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; PP . zw = texture2D ( PI , PO . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; PP . yxwz = Pk ( PP . xyzw ) ; PS = vec2 ( 2.0 , 2.0 ) * PP . xz + PP . yw ; OQ ( bvec2 ( step ( 0.9 , PN . zw ) ) , PS , vec2 ( 0.0 , 0.0 ) ) ; PQ += PH ( PJ , PN . xy , PS , PM . z ) ; } PN . xz = PB ( PI , PK , vec2 ( - 1 , - 1 ) , PR ) ; if ( texture2D ( PI , PK + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { PN . yw = PB ( PI , PK , vec2 ( 1 , 1 ) , PR ) ; PN . y += float ( PR . y > 0.9 ) ; } else PN . yw = vec2 ( 0.0 , 0.0 ) ; if ( PN . x + PN . y > 2.0 ) { PP = vec4 ( - PN . x , - PN . x , PN . y , PN . y ) * u_texel_size . xyxy + PK . xyxy ; PO . x = texture2D ( PI , PP . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; PO . y = texture2D ( PI , PP . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; PO . zw = texture2D ( PI , PP . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; PR = vec2 ( 2.0 , 2.0 ) * PO . xz + PO . yw ; OQ ( bvec2 ( step ( 0.9 , PN . zw ) ) , PR , vec2 ( 0 , 0 ) ) ; PQ += PH ( PJ , PN . xy , PR , PM . w ) . gr ; } return PQ ; }".split(" ")}]}}]},
{type:"textline",tokens:"float PZ ( sampler2D PU , vec2 PV , float PW ) { vec2 PX , PY ; PX = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; PY = SMAA_SEARCHTEX_SIZE * vec2 ( PW , 1.0 ) ; PX += vec2 ( - 1.0 , 1.0 ) ; PY += vec2 ( 0.5 , - 0.5 ) ; PX *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; PY *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( PU , PX * PV + PY , 0.0 ) . r ; } float Qg ( sampler2D P_ , sampler2D Qa , vec2 Qb , float Qc ) { float Qd ; vec2 Qe ; Qe = vec2 ( 0.0 , 1.0 ) ; for ( int Qf = 0 ; Qf < SMAA_MAX_SEARCH_STEPS ; Qf ++ ) { if ( Qb . x > Qc && Qe . g > 0.8281 && Qe . r == 0.0 ) { Qe = texture2D ( P_ , Qb , 0.0 ) . rg ; Qb = - vec2 ( 2.0 , 0.0 ) * u_texel_size + Qb ; } } Qd = - ( 255.0 / 127.0 ) * PZ ( Qa , Qe , 0.0 ) + 3.25 ; return u_texel_size . x * Qd + Qb . x ; } float Qo ( sampler2D Qh , sampler2D Qi , vec2 Qj , float Qk ) { float Ql ; vec2 Qm ; Qm = vec2 ( 0.0 , 1.0 ) ; for ( int Qn = 0 ; Qn < SMAA_MAX_SEARCH_STEPS ; Qn ++ ) { if ( Qj . x < Qk && Qm . g > 0.8281 && Qm . r == 0.0 ) { Qm = texture2D ( Qh , Qj , 0.0 ) . rg ; Qj = vec2 ( 2.0 , 0.0 ) * u_texel_size + Qj ; } } Ql = - ( 255.0 / 127.0 ) * PZ ( Qi , Qm , 0.5 ) + 3.25 ; return - u_texel_size . x * Ql + Qj . x ; } float Qw ( sampler2D Qp , sampler2D Qq , vec2 Qr , float Qs ) { float Qt ; vec2 Qu ; Qu = vec2 ( 1.0 , 0.0 ) ; for ( int Qv = 0 ; Qv < SMAA_MAX_SEARCH_STEPS ; Qv ++ ) { if ( Qr . y > Qs && Qu . r > 0.8281 && Qu . g == 0.0 ) { Qu = texture2D ( Qp , Qr , 0.0 ) . rg ; Qr = - vec2 ( 0.0 , 2.0 ) * u_texel_size + Qr ; } } Qt = - ( 255.0 / 127.0 ) * PZ ( Qq , Qu . gr , 0.0 ) + 3.25 ; return u_texel_size . y * Qt + Qr . y ; } float QE ( sampler2D Qx , sampler2D Qy , vec2 Qz , float QA ) { float QB ; vec2 QC ; QC = vec2 ( 1.0 , 0.0 ) ; for ( int QD = 0 ; QD < SMAA_MAX_SEARCH_STEPS ; QD ++ ) { if ( Qz . y < QA && QC . r > 0.8281 && QC . g == 0.0 ) { QC = texture2D ( Qx , Qz , 0.0 ) . rg ; Qz = vec2 ( 0.0 , 2.0 ) * u_texel_size + Qz ; } } QB = - ( 255.0 / 127.0 ) * PZ ( Qy , QC . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * QB + Qz . y ; } vec2 QL ( sampler2D QF , vec2 QG , float QH , float QI , float QJ ) { vec2 QK ; QK = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * OV ( 4.0 * vec2 ( QH , QI ) ) + QG ; QK = SMAA_AREATEX_PIXEL_SIZE * QK + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; QK . y = SMAA_AREATEX_SUBTEX_SIZE * QJ + QK . y ; return texture2D ( QF , QK , 0.0 ) . rg ; } void QS ( sampler2D QM , inout vec2 QN , vec4 QO , vec2 QP ) { vec2 QQ , QR ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"QQ = step ( QP . xy , QP . yx ) ; QR = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * QQ ; QR /= QQ . x + QQ . y ; QQ = vec2 ( 1.0 , 1.0 ) ; QQ . x -= QR . x * texture2D ( QM , QO . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; QQ . x -= QR . y * texture2D ( QM , QO . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; QQ . y -= QR . x * texture2D ( QM , QO . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; QQ . y -= QR . y * texture2D ( QM , QO . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; QN *= clamp ( QQ , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:"} void QZ ( sampler2D QT , inout vec2 QU , vec4 QV , vec2 QW ) { vec2 QX , QY ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"QX = step ( QW . xy , QW . yx ) ; QY = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * QX ; QY /= QX . x + QX . y ; QX = vec2 ( 1.0 , 1.0 ) ; QX . x -= QY . x * texture2D ( QT , QV . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; QX . x -= QY . y * texture2D ( QT , QV . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; QX . y -= QY . x * texture2D ( QT , QV . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; QX . y -= QY . y * texture2D ( QT , QV . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; QU *= clamp ( QX , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Rm ( vec2 Q_ , vec2 Ra , sampler2D Rb , sampler2D Rc , sampler2D Rd , vec4 Re ) { float Rf , Rg ; vec3 Rh ; vec2 Ri , Rj , Rk ; vec4 Rl ; Rl = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; Ri = texture2D ( Rb , Q_ ) . rg ; if ( Ri . g > 0.0 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_DIAG_DETECTION",
{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"Rl . rg = PT ( Rb , Rc , Q_ , Ri , Re ) ; if ( Rl . r == - Rl . g ) {".split(" ")}]}}]},{type:"textline",tokens:"; Rh . x = Qg ( Rb , Rd , Oy . xy , OA . x ) ; Rh . y = Oz . y ; Rj . x = Rh . x ; Rf = texture2D ( Rb , Rh . xy , 0.0 ) . r ; Rh . z = Qo ( Rb , Rd , Oy . zw , OA . y ) ; Rj . y = Rh . z ; Rj = abs ( OV ( Rj / u_texel_size . xx - Ra . xx ) ) ; Rk = sqrt ( Rj ) ; Rg = texture2D ( Rb , Rh . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; Rl . rg = QL ( Rc , Rk , Rf , Rg , Re . y ) ; Rh . y = Q_ . y ; QS ( Rb , Rl . rg , Rh . xyzy , Rj ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"} else Ri . r = 0.0 ;".split(" ")}]}}]},{type:"textline",tokens:"} if ( Ri . r > 0.0 ) { ; Rh . y = Qw ( Rb , Rd , Oz . xy , OA . z ) ; Rh . x = Oy . x ; Ri . x = Rh . y ; Rg = texture2D ( Rb , Rh . xy , 0.0 ) . g ; Rh . z = QE ( Rb , Rd , Oz . zw , OA . w ) ; Ri . y = Rh . z ; Ri = abs ( OV ( Ri / u_texel_size . yy - Ra . yy ) ) ; Rj = sqrt ( Ri ) ; Rf = texture2D ( Rb , Rh . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; Rl . ba = QL ( Rc , Rj , Rg , Rf , Re . x ) ; Rh . x = Q_ . x ; QZ ( Rb , Rl . ba , Rh . xyxz , Ri ) ; } return Rl ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Ry ( vec2 Rn , sampler2D Ro , sampler2D Rp".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","sampler2D","Rq"]}]}}]},{type:"textline",tokens:") { bool Rr ; vec2 Rs , Rt , Ru ; vec4 Rv , Rw , Rx ; Rv . x = texture2D ( Rp , Ox . xy ) . a ; Rv . y = texture2D ( Rp , Ox . zw ) . g ; Rv . wz = texture2D ( Rp , Rn ) . xz ; if ( dot ( Rv , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { Rw = texture2D ( Ro , Rn , 0.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:"Rx = texture2D ( Rq , bM ) ; Rs = 2.0 * ag ( Rx ) - 1.0 ; Rw . a = sqrt ( 2.0 * length ( Rs ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"return Rw ; } else { Rr = max ( Rv . x , Rv . z ) > max ( Rv . y , Rv . w ) ; Rw = vec4 ( 0.0 , Rv . y , 0.0 , Rv . w ) ; Rs = Rv . yw ; OQ ( bvec4 ( Rr , Rr , Rr , Rr ) , Rw , vec4 ( Rv . x , 0.0 , Rv . z , 0.0 ) ) ; OQ ( bvec2 ( Rr , Rr ) , Rs , Rv . xz ) ; Rs /= dot ( Rs , vec2 ( 1.0 , 1.0 ) ) ; Rw = Rw * vec4 ( u_texel_size , - u_texel_size ) + Rn . xyxy ; Rv = Rs . x * texture2D ( Ro , Rw . xy , 0.0 ) ; Rv += Rs . y * texture2D ( Ro , Rw . zw , 0.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:"Rx = texture2D ( Rq , Rw . xy ) ; Rt = 2.0 * ag ( Rx ) - 1.0 ; Ru = Rs . x * Rt ; Rx = texture2D ( Rq , Rw . zw ) ; Rt = 2.0 * ag ( Rx ) - 1.0 ; Ru += Rs . y * Rt ; Rv . a = sqrt ( 2.0 * length ( Ru ) ) ;".split(" ")}]}}]},{type:"textline",tokens:["return","Rv",";","}","}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"vec4 RI ( vec2 Rz , sampler2D RA , sampler2D RB".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","sampler2D","RC"]}]}}]},{type:"textline",tokens:") { float RD ; vec2 RE ; vec4 RF , RG , RH ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:"RF = texture2D ( RC , bM ) ; RE = 2.0 * ag ( RF ) - 1.0 ; RF = texture2D ( RA , Rz ) ; RG = texture2D ( RB , Rz - RE ) ; RD = abs ( RF . a * RF . a - RG . a * RG . a ) / 2.0 ; RD = 0.5 * clamp ( 1.0 - sqrt ( RD ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; RH = mix ( RF , RG , RD ) ; RH . a = 1.0 ; return RH ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"RF = texture2D ( RA , Rz ) ; RG = texture2D ( RB , Rz ) ; return mix ( RF , RG , 0.5 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 RJ ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"RJ = vec4 ( Pi ( bM , u_color".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SMAA_PREDICATION"],group:{type:"group",parts:[{type:"textline",tokens:[",","u_predication_tex"]}]}}]},{type:"textline",tokens:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"RJ = Rm ( bM , OB , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"RJ = Ry ( bM , u_color , u_blend".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","u_velocity_tex"]}]}}]},{type:"textline",tokens:[")",";"]}]}},{type:"elif",expression:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"RJ = vec4 ( RI ( bM , u_color , u_color_prev".split(" ")},{type:"condition",
parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","u_velocity_tex"]}]}}]},{type:"textline",tokens:[")",")",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"RJ = texture2D ( u_color , bM ) ;".split(" ")}]}}]},{type:"textline",tokens:["gl_FragColor","=","RJ",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",parts:[{type:"define",name:"SMAA_EDGE_DETECTION",tokens:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",
tokens:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",tokens:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",tokens:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",tokens:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",tokens:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",tokens:["4"]},{type:"textline",tokens:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","Ox",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"varying vec4 Oy ; varying vec4 Oz ; varying vec4 OA ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","OB",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["AA_METHOD",
"AA_METHOD_SMAA_LOW",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["4"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["8"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["16"]}]}},{type:"elif",
expression:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["32"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["16"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void Ng ( vec2 Nc ) { Oy = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + Nc . xyxy ; Oz = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + Nc . xyxy ; OA = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + Nc . xyxy ; }".split(" ")}]}},
{type:"elif",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void Nj ( vec2 Nh , out vec2 Ni ) { Ni = Nh / u_texel_size ; Oy = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + Nh . xyxy ; Oz = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + Nh . xyxy ; OA = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( Oy . xz , Oz . yw ) ; }".split(" ")}]}},
{type:"elif",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void Nl ( vec2 Nk ) { Ox = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + Nk . xyxy ; }".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { bM = 2.0 * a_position ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["Ng",
"(","bM",")",";"]}]}},{type:"elif",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Nj ( bM , OB ) ;".split(" ")}]}},{type:"elif",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["Nl","(","bM",")",";"]}]}}]},{type:"textline",tokens:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]=
{type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",tokens:["1"]},{type:"define",name:"SSAO_QUALITY_16",tokens:["2"]},{type:"define",name:"SSAO_QUALITY_24",tokens:["3"]},{type:"define",name:"SSAO_QUALITY_32",tokens:["4"]},{type:"textline",tokens:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 bM ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float Ng ( in vec2 Nc ) { return Os ( u_depth , Nc , u_camera_range ) ; } void main ( ) { float Nh , Ni , Nj , Nk , Nl , Nm ; vec3 Nn , No , Np , Nq ; Nn = texture2D ( u_color , bM ) . rgb ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SSAO_WHITE"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( Nn , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",tokens:"No = normalize ( 2.0 * texture2D ( u_ssao_special_tex , bM * 0.25 / u_texel_size ) . rgb - 1.0 ) ; Nh = Ng ( bM ) ; Ni = Nh * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_QUALITY","SSAO_QUALITY_8",{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"const float Nr = 8.0 ; const int Ns = 1 ;".split(" ")}]}},{type:"elif",expression:["SSAO_QUALITY","SSAO_QUALITY_16",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float Nr = 16.0 ; const int Ns = 2 ;".split(" ")}]}},{type:"elif",expression:["SSAO_QUALITY","SSAO_QUALITY_24",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float Nr = 24.0 ; const int Ns = 3 ;".split(" ")}]}},{type:"elif",
expression:["SSAO_QUALITY","SSAO_QUALITY_32",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float Nr = 32.0 ; const int Ns = 4 ;".split(" ")}]}}]},{type:"textline",tokens:"Nj = u_ssao_radius_increase * 0.001 ; const float Nt = 1.0 + 2.4 / Nr ; Nk = 0.0 ; for ( int Nu = 0 ; Nu < Ns ; Nu ++ ) for ( int Nv = - 1 ; Nv <= 1 ; Nv += 2 ) for ( int OC = - 1 ; OC <= 1 ; OC += 2 ) for ( int OD = - 1 ; OD <= 1 ; OD += 2 ) { Np = reflect ( normalize ( vec3 ( Nv , OC , OD ) ) , No ) * ( Nj *= Nt ) ; Nq = vec3 ( bM , Ni ) ; Nq += vec3 ( Np . xy , Np . z * Ni * 2.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SSAO_HEMISPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"Nq . z -= 1.4 * ( Nq . z - Ni ) * step ( Ni , Nq . z ) ;".split(" ")}]}}]},{type:"textline",tokens:"Nl = Ng ( Nq . xy ) * ( u_camera_range . y - u_camera_range . x ) ; Nm = clamp ( ( Ni - Nl ) / Nl , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_HEMISPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"Nk += mix ( 1.0 , Nm , step ( Nl , Nq . z ) ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Nk += mix ( step ( Nq . z , Nl ) , 0.5 , Nm ) ;".split(" ")}]}}]},{type:"textline",tokens:"} Nk = Nk / Nr ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_HEMISPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"Nk = clamp ( Nk * Nk + 0.6 * Nk , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Nk = clamp ( Nk * Nk + Nk , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",
tokens:"Nh = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * Nh ) ; Nk = mix ( 1.0 , Nk , Nh ) ; gl_FragColor = vec4 ( Nn , Nk ) ; }".split(" ")}]};a["postprocessing/ssao_blur.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"include",file:"depth_fetch.glslf"}]}}]},
{type:"textline",tokens:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"textline",tokens:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float Ng ( in vec2 Nc ) { return Os ( u_depth , Nc , u_camera_range ) ; }".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { vec2 Nh , Ni ; float Nj , Nk , Nl , Nm , Nn , No , Np ; Nj = 0.0 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"textline",tokens:"Nk = Ng ( bM ) ; Nl = 0.0 ; Nm = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",tokens:"Nh = vec2 ( - 2.0 ) ; for ( int Nq = 0 ; Nq < 4 ; ++ Nq ) { for ( int Nr = 0 ; Nr < 4 ; ++ Nr ) { Ni = ( Nh + vec2 ( float ( Nq ) , float ( Nr ) ) ) * u_texel_size ; Nn = texture2D ( u_ssao_mask , bM + Ni ) . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],
group:{type:"group",parts:[{type:"textline",tokens:"No = Ng ( bM + Ni ) ; Np = 1.0 - clamp ( abs ( No - Nk ) * Nm , 0.0 , 1.0 ) ; Nj += Nn * Np ; Nl += Np ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Nj","+=","Nn",";"]}]}}]},{type:"textline",tokens:["}","}"]},{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bM ) . rgb , Nj / Nl ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bM ) . rgb , Nj / 16.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["postprocessing/stereo.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",tokens:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 bM ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["ANAGLYPH",
{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","int","u_enable_hmd_stereo",";"]},{type:"condition",parts:[{type:"if",expression:["DISABLE_DISTORTION_CORRECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_distortion_params ; uniform vec4 u_chromatic_aberration_coefs ; void Np ( vec2 Nc , vec2 Ng , float Nh , sampler2D Ni ) { vec4 Nj ; float Nk ; vec2 Nl , Nm , Nn , No ; Nl = ( Nc - Ng ) * 2.0 ; Nl /= Nh ; Nk = Nl . x * Nl . x + Nl . y * Nl . y ; Nl = Nl * ( 1.0 + u_distortion_params [ 0 ] * Nk + u_distortion_params [ 1 ] * Nk * Nk ) ; Nl = Nl * 0.5 / ( 1.0 + u_distortion_params [ 0 ] + u_distortion_params [ 1 ] ) ; if ( length ( u_chromatic_aberration_coefs ) > 0.0 ) { Nm = Nl * ( 1.0 + u_chromatic_aberration_coefs [ 0 ] + Nk * u_chromatic_aberration_coefs [ 1 ] ) + Ng ; Nn = Nl + Ng ; No = Nl * ( 1.0 + u_chromatic_aberration_coefs [ 2 ] + Nk * u_chromatic_aberration_coefs [ 3 ] ) + Ng ; if ( clamp ( No , 0.0 , 1.0 ) != No ) { gl_FragColor = vec4 ( 0.0 ) ; } else { Nj = texture2D ( Ni , Nn ) ; gl_FragColor [ 0 ] = texture2D ( Ni , Nm ) . x ; gl_FragColor [ 1 ] = Nj . y ; gl_FragColor [ 2 ] = texture2D ( Ni , No ) . z ; gl_FragColor [ 3 ] = Nj . w ; } } else { Nl = Nl * Nh + Ng ; if ( clamp ( Nl , 0.0 , 1.0 ) != Nl ) { gl_FragColor = vec4 ( 0.0 ) ; } else { gl_FragColor = texture2D ( Ni , Nl ) ; } } }".split(" ")}]}}]}]}}]},
{type:"textline",tokens:"void main ( ) { float Nq ; vec2 Nr , Ns ; mat3 Nt , Nu ; vec3 Nv , OC ; vec4 OD , OE ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["ANAGLYPH"],group:{type:"group",parts:[{type:"textline",tokens:"OD = texture2D ( u_sampler_left , bM ) ; OE = texture2D ( u_sampler_right , bM ) ; Nv = vec3 ( OD [ 0 ] , OD [ 1 ] , OD [ 2 ] ) ; br ( Nv ) ; OC = vec3 ( OE [ 0 ] , OE [ 1 ] , OE [ 2 ] ) ; br ( OC ) ; Nt = mat3 ( 0.437 , - 0.062 , - 0.048 , 0.449 , - 0.062 , - 0.050 , 0.164 , - 0.024 , - 0.017 ) ; Nu = mat3 ( - 0.011 , 0.377 , - 0.026 , - 0.032 , 0.761 , - 0.093 , - 0.007 , 0.009 , 1.234 ) ; OC = clamp ( Nt * Nv , 0.0 , 1.0 ) + clamp ( Nu * OC , 0.0 , 1.0 ) ; bu ( OC ) ; gl_FragColor = vec4 ( OC , OD [ 3 ] + OE [ 3 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"if ( u_enable_hmd_stereo != 0 ) { if ( bM [ 0 ] < 0.5 ) { Nr = vec2 ( 2.0 * bM [ 0 ] , bM [ 1 ] ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_DISTORTION_CORRECTION"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = texture2D ( u_sampler_left , Nr ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ns = vec2 ( 0.5 - ( u_distortion_params [ 3 ] - 0.5 ) / 2.0 , u_distortion_params [ 2 ] ) ; Nq = 2.0 * u_distortion_params [ 3 ] ; Np ( Nr , Ns , Nq , u_sampler_left ) ;".split(" ")}]}}]},
{type:"textline",tokens:"} else { Ns = vec2 ( 2.0 * ( bM [ 0 ] - 0.5 ) , bM [ 1 ] ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_DISTORTION_CORRECTION"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = texture2D ( u_sampler_right , Ns ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Nr = vec2 ( 0.5 + ( u_distortion_params [ 3 ] - 0.5 ) / 2.0 , u_distortion_params [ 2 ] ) ; Nq = 2.0 * u_distortion_params [ 3 ] ; Np ( Ns , Nr , Nq , u_sampler_right ) ;".split(" ")}]}}]},
{type:"textline",tokens:"} } else { gl_FragColor = texture2D ( u_sampler_left , bM ) ; }".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",tokens:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 bM ; void main ( ) { vec2 Nc ; vec4 Ng , Nh ; float Ni ; Ni = texture2D ( u_depth , bM ) . x ; Ng = vec4 ( bM * 2.0 - 1.0 , 2.0 * Ni - 1.0 , 1.0 ) ; Nh = u_view_proj_inverse * Ng ; Nh = Nh / Nh . w ; Nh = u_view_proj_prev * Nh ; Nh /= Nh . w ; Nc = ( Ng . xy - Nh . xy ) / 4.0 + 0.5 ; Nc = clamp ( Nc , 0.0 , 1.0 ) ; gl_FragColor = V ( Nc ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",parts:[{type:"var",name:"EPSILON",tokens:["0.0001"]},{type:"textline",tokens:"float a = 0.0 ; float b = 1.0 ; struct c { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool f ( vec3 d , vec3 e ) { return any ( lessThan ( abs ( d - e ) , vec3 ( EPSILON ) ) ) ; } vec3 i ( in vec4 g , in vec3 h ) { return h + 2.0 * cross ( g . xyz , cross ( g . xyz , h ) + g . w * h ) ; } vec4 k ( in vec4 j ) { return vec4 ( - j . xyz , j . w ) / dot ( j , j ) ; } vec3 p ( vec4 l , vec4 m , vec4 n ) { vec3 o ; o = n . xyz * l . w ; o = i ( m , o ) ; o += l . xyz * n . w ; return o ; } vec3 v ( vec4 q , vec4 r , vec4 s ) { vec4 t ; vec3 u ; u = s . xyz - q . xyz * s . w ; t = k ( r ) ; u = i ( t , u ) ; u /= q . w ; return u ; } mat4 w ( ) { return mat4 ( b , a , a , a , a , b , a , a , a , a , b , a , a , a , a , b ) ; } mat4 y ( float x ) { return mat4 ( b , a , a , a , a , cos ( x ) , sin ( x ) , a , a , - sin ( x ) , cos ( x ) , a , a , a , a , b ) ; } mat4 A ( float z ) { return mat4 ( cos ( z ) , a , - sin ( z ) , a , a , b , a , a , sin ( z ) , a , cos ( z ) , a , a , a , a , b ) ; } mat4 C ( float B ) { return mat4 ( cos ( B ) , sin ( B ) , a , a , - sin ( B ) , cos ( B ) , a , a , a , a , b , a , a , a , a , b ) ; } c E ( in c D ) { return c ( D . a , D . b , normalize ( D . c ) , normalize ( D . d ) , normalize ( D . e ) , D . f ) ; }".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 L ( vec4 F ) { vec3 G ; float H , I , J ; H = F . x ; I = F . y ; J = F . w ; G . x = ( H + J ) / 2.0 ; G . y = ( I + J ) / 2.0 ; G . z = J ; return G ; }".split(" ")}]}}]},{type:"textline",tokens:"mat4 O ( mat3 M ) { mat4 N ; N [ 0 ] [ 0 ] = ( b - ( M [ 1 ] [ 2 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) + M [ 2 ] [ 0 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 1 ] = ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) + M [ 2 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 2 ] = ( M [ 1 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) - M [ 2 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 3 ] = a ; N [ 1 ] [ 0 ] = ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) - M [ 2 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 1 ] = ( b - ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) + M [ 2 ] [ 0 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 2 ] = ( M [ 1 ] [ 2 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) + M [ 2 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 3 ] = a ; N [ 2 ] [ 0 ] = ( M [ 1 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) + M [ 2 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 1 ] = ( M [ 1 ] [ 2 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) - M [ 2 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 2 ] = ( b - ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) + M [ 1 ] [ 2 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 3 ] = a ; N [ 3 ] [ 0 ] = M [ 0 ] [ 0 ] ; N [ 3 ] [ 1 ] = M [ 0 ] [ 1 ] ; N [ 3 ] [ 2 ] = M [ 0 ] [ 2 ] ; N [ 3 ] [ 3 ] = 1.0 ; return N ; }".split(" ")}]};
a["include/std_enums.glsl"]={type:"group",parts:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",tokens:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",tokens:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",tokens:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",tokens:["2"]},{type:"define",name:"SHADOW_SRC_NONE",tokens:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",tokens:["2"]},{type:"define",name:"SHADOW_SRC_MASK",tokens:["3"]},{type:"define",name:"SHADOW_DST_NONE",tokens:["1"]},{type:"define",
name:"SHADOW_DST_DEPTH",tokens:["2"]},{type:"define",name:"SHADOW_DST_MASK",tokens:["3"]},{type:"define",name:"NO_SHADOWS",tokens:["1"]},{type:"define",name:"SHADOW_CASTING",tokens:["2"]},{type:"define",name:"SHADOW_MASK_GENERATION",tokens:["3"]},{type:"define",name:"SHADOW_MAPPING_OPAQUE",tokens:["4"]},{type:"define",name:"SHADOW_MAPPING_BLEND",tokens:["5"]},{type:"define",name:"SPECULAR_PHONG",tokens:["1"]},{type:"define",name:"SPECULAR_COOKTORR",tokens:["2"]},{type:"define",name:"SPECULAR_WARDISO",
tokens:["3"]},{type:"define",name:"SPECULAR_BLINN",tokens:["4"]},{type:"define",name:"SPECULAR_TOON",tokens:["5"]},{type:"define",name:"DIFFUSE_LAMBERT",tokens:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",tokens:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",tokens:["3"]},{type:"define",name:"DIFFUSE_MINNAERT",tokens:["4"]},{type:"define",name:"DIFFUSE_TOON",tokens:["5"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",tokens:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",tokens:["1.0"]},{type:"define",
name:"MAPPING_TYPE_VECTOR",tokens:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",tokens:["3.0"]},{type:"define",name:"MIX",tokens:["0"]},{type:"define",name:"ADD",tokens:["1"]},{type:"define",name:"SUBTRACT",tokens:["2"]},{type:"define",name:"MULTIPLY",tokens:["3"]},{type:"define",name:"SCREEN",tokens:["4"]},{type:"define",name:"OVERLAY",tokens:["5"]},{type:"define",name:"DIFFERENCE",tokens:["6"]},{type:"define",name:"DIVIDE",tokens:["7"]},{type:"define",name:"DARKEN",tokens:["8"]},{type:"define",
name:"LIGHTEN",tokens:["9"]},{type:"define",name:"HUE",tokens:["10"]},{type:"define",name:"SATURATION",tokens:["11"]},{type:"define",name:"VALUE",tokens:["12"]},{type:"define",name:"COLOR",tokens:["13"]},{type:"define",name:"SOFT_LIGHT",tokens:["14"]},{type:"define",name:"LINEAR_LIGHT",tokens:["15"]},{type:"define",name:"REFL_NONE",tokens:["0"]},{type:"define",name:"REFL_MIRRORMAP",tokens:["1"]},{type:"define",name:"REFL_PLANE",tokens:["2"]},{type:"define",name:"REFL_CUBE",tokens:["3"]},{type:"define",
name:"INVERSE_QUADRATIC",tokens:["0"]},{type:"define",name:"LINEAR",tokens:["1"]},{type:"define",name:"QUADRATIC",tokens:["2"]},{type:"define",name:"HEMI",tokens:["1"]},{type:"define",name:"SPOT",tokens:["2"]},{type:"define",name:"POINT",tokens:["3"]},{type:"define",name:"SUN",tokens:["4"]},{type:"define",name:"VT_WORLD_TO_WORLD",tokens:["0"]},{type:"define",name:"VT_WORLD_TO_OBJECT",tokens:["1"]},{type:"define",name:"VT_WORLD_TO_CAMERA",tokens:["2"]},{type:"define",name:"VT_OBJECT_TO_WORLD",tokens:["3"]},
{type:"define",name:"VT_OBJECT_TO_OBJECT",tokens:["4"]},{type:"define",name:"VT_OBJECT_TO_CAMERA",tokens:["5"]},{type:"define",name:"VT_CAMERA_TO_WORLD",tokens:["6"]},{type:"define",name:"VT_CAMERA_TO_OBJECT",tokens:["7"]},{type:"define",name:"VT_CAMERA_TO_CAMERA",tokens:["8"]},{type:"define",name:"VT_POINT",tokens:["0"]},{type:"define",name:"VT_VECTOR",tokens:["1"]},{type:"define",name:"VT_NORMAL",tokens:["2"]}]};a["include/pack.glslf"]={type:"group",parts:[{type:"textline",tokens:"float P = 255.0 ; float Q = 0.0 ; float R = 1.0 ; vec4 V ( const in float S ) { vec4 T , U ; T = vec4 ( P * P * P , P * P , P , R ) ; U = vec4 ( Q , R / P , R / P , R / P ) ; T = fract ( S * T ) ; T -= T . xxyz * U ; return T ; } float Z ( const in vec4 W ) { vec4 X ; float Y ; X = vec4 ( R / ( P * P * P ) , R / ( P * P ) , R / P , R ) ; Y = dot ( W , X ) ; return Y ; } vec4 V ( const in vec2 _ ) { vec4 aa ; vec2 ab , ac ; ab = vec2 ( P , R ) ; ac = vec2 ( Q , R / P ) ; aa = fract ( _ . xxyy * ab . xyxy ) ; aa -= aa . xxzz * ac . xyxy ; if ( _ . r == R ) aa . rg = vec2 ( Q , R ) ; if ( _ . g == R ) aa . ba = vec2 ( Q , R ) ; return aa ; } vec2 ag ( const in vec4 ad ) { vec2 ae , af ; af = vec2 ( R / P , R ) ; ae . r = dot ( ad . rg , af ) ; ae . g = dot ( ad . ba , af ) ; return ae ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",parts:[{type:"textline",tokens:"float ah = 0.0 ; float ai = 1.0 ; vec4 ak ( vec4 aj ) { return aj - floor ( aj * ( ai / 289.0 ) ) * 289.0 ; } vec3 ak ( vec3 al ) { return al - floor ( al * ( ai / 289.0 ) ) * 289.0 ; } vec2 ak ( vec2 am ) { return am - floor ( am * ( ai / 289.0 ) ) * 289.0 ; } vec4 ao ( vec4 an ) { return an - floor ( an * ( ai / 7.0 ) ) * 7.0 ; } vec4 aq ( vec4 ap ) { return ak ( ( 34.0 * ap + 5.0 ) * ap ) ; }".split(" ")},{type:"define",
name:"K",tokens:["0.142857142857"]},{type:"define",name:"K2",tokens:["0.0714285714285"]},{type:"define",name:"JITTER",tokens:["0.7"]},{type:"textline",tokens:"vec2 ay ( vec2 ar ) { vec4 as , at , au , av ; vec2 aw , ax ; aw = ak ( floor ( ar ) ) ; ax = fract ( ar ) ; as = ax . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; at = ax . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; au = aq ( aw . x + vec4 ( ah , ai , ah , ai ) ) ; au = aq ( au + aw . y + vec4 ( ah , ah , ai , ai ) ) ; av = ao ( au ) * K + K2 ; au = ao ( floor ( au * K ) ) * K + K2 ; av = as + JITTER * av ; au = at + JITTER * au ; au = av * av + au * au ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:[1],group:{type:"group",parts:[{type:"textline",tokens:"au . xy = min ( au . xy , au . zw ) ; au . x = min ( au . x , au . y ) ; return au . xx ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"au . xy = ( au . x < au . y ) ? au . xy : au . yx ; au . xz = ( au . x < au . z ) ? au . xz : au . zx ; au . xw = ( au . x < au . w ) ? au . xw : au . wx ; au . y = min ( au . y , au . z ) ; au . y = min ( au . y , au . w ) ; return sqrt ( au . xy ) ;".split(" ")}]}}]},
{type:"textline",tokens:"} vec3 aH ( vec2 az , float aA ) { vec4 aB , aC , aD , aE ; vec2 aF , aG ; aF = ak ( floor ( az ) ) ; aG = fract ( az ) ; aB = aG . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; aC = aG . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; aD = aq ( aF . x + vec4 ( ah , ai , ah , ai ) ) ; aD = aq ( aD + aF . y + vec4 ( ah , ah , ai , ai ) ) ; aE = ao ( aD ) * K + K2 ; aD = ao ( floor ( aD * K ) ) * K + K2 ; aE = aB + JITTER * aE ; aD = aC + JITTER * aD ; aC = aE * aE + aD * aD ; aE += aA ; aD += aA ; aB = aE * aE + aD * aD ; aE += aA ; aD += aA ; aD = aE * aE + aD * aD ; aC . xy = min ( aC . xy , aC . zw ) ; aC . x = min ( aC . x , aC . y ) ; aB . xy = min ( aB . xy , aB . zw ) ; aB . x = min ( aB . x , aB . y ) ; aD . xy = min ( aD . xy , aD . zw ) ; aD . x = min ( aD . x , aD . y ) ; return vec3 ( aC . x , aB . x , aD . x ) ; } vec3 aJ ( vec3 aI ) { return ak ( ( ( aI * 34.0 ) + ai ) * aI ) ; } float aU ( vec2 aK ) { vec3 aL , aM , aN , aO ; vec4 aP ; vec2 aQ , aR , aS ; const vec4 aT = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; aQ = floor ( aK + dot ( aK , aT . yy ) ) ; aR = aK - aQ + dot ( aQ , aT . xx ) ; aS = ( aR . x > aR . y ) ? vec2 ( ai , ah ) : vec2 ( ah , ai ) ; aP = aR . xyxy + aT . xxzz ; aP . xy -= aS ; aQ = ak ( aQ ) ; aL = aJ ( aJ ( aQ . y + vec3 ( ah , aS . y , ai ) ) + aQ . x + vec3 ( ah , aS . x , ai ) ) ; aM = max ( 0.5 - vec3 ( dot ( aR , aR ) , dot ( aP . xy , aP . xy ) , dot ( aP . zw , aP . zw ) ) , ah ) ; aM = aM * aM ; aM = aM * aM ; aL = 2.0 * fract ( aL * aT . www ) - ai ; aN = abs ( aL ) - 0.5 ; aO = floor ( aL + 0.5 ) ; aO = aL - aO ; aM *= 1.79284291400159 - 0.85373472095314 * ( aO * aO + aN * aN ) ; aL . x = aO . x * aR . x + aN . x * aR . y ; aL . yz = aO . yz * aP . xz + aN . yz * aP . yw ; return 130.0 * dot ( aM , aL ) ; } vec2 aY ( vec2 aV ) { float aW , aX ; aW = dot ( aV , vec2 ( 12.9898 , 78.233 ) ) ; aX = dot ( aV , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; aW = fract ( sin ( aW ) * 43758.5453 ) * 2.0 - ai ; aX = fract ( sin ( aX ) * 43758.5453 ) * 2.0 - ai ; return vec2 ( aW , aX ) ; }".split(" ")}]};
a["include/caustics.glslf"]={type:"group",parts:[{type:"var",name:"CAUST_SPEED",tokens:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",tokens:["0.0"]},{type:"var",name:"CAUST_BRIGHT",tokens:["0.0"]},{type:"var",name:"SUN_NUM",tokens:["0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",tokens:["100.0"]},{type:"textline",tokens:"void bp ( inout vec3 aZ , float a_ , float ba , vec4 bb , vec3 bc , vec3 bd , vec3 be , vec4 bf , vec3 bg , float bh ) { float bi , bj , bk ; vec2 bl , bm ; vec3 bn ; vec4 bo ; if ( bh > CAUSTICS_VIEW_DISTANCE ) return ; bo = bf ; bn = bg + bc ; bn . xz = 10.0 * sin ( 0.1 * bn . xz ) ; bn = bn + 2.0 * cross ( - bo . xyz , cross ( - bo . xyz , bn ) + bo . w * bn ) ; bl = bn . xz ; bn = bd ; bi = max ( dot ( bc , bn ) , 0.0 ) ; bj = 0.025 ; bm = CAUST_SPEED * ba ; bl . s += 0.25 * sin ( dot ( bg + ba , vec3 ( 1.0 ) ) ) ; bl . t += 0.35 * ( - sin ( dot ( bg - ba , vec3 ( - 0.7 ) ) ) ) ; bl . st += 0.15 * cos ( 4.0 * a_ - bm . x ) + 1.5 * sin ( a_ - 0.3 * bm . y ) ; bk = CAUST_SCALE * ( 1.0 + max ( 0.1 * a_ , 0.0 ) ) ; bn = aH ( ( bl / bk ) , bj ) ; bn *= CAUST_BRIGHT ; bn *= bn ; bj = min ( 0.25 * a_ , - a_ ) + 1.0 ; bj = max ( bj , 0.0 ) ; bi = bb [ SUN_NUM ] * bi ; bk = max ( sign ( a_ ) , 0.0 ) ; bi = bi + max ( 0.5 * sign ( - bc . y ) * bk , 0.0 ) ; bi = min ( bi , 1.0 ) ; aZ += be * bn * bj * bi ; }".split(" ")}]};
a["include/color_util.glslf"]={type:"group",parts:[{type:"define",name:"GAMMA",tokens:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",tokens:["1"]},{type:"textline",tokens:"void br ( inout vec3 bq ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["GAMMA"],group:{type:"group",parts:[{type:"textline",tokens:"bq = max ( vec3 ( 0.0 ) , bq ) ; bq = pow ( bq , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"} void br ( inout float bs ) {".split(" ")},{type:"condition",parts:[{type:"if",
expression:["GAMMA"],group:{type:"group",parts:[{type:"textline",tokens:"bs = pow ( max ( 0.0 , bs ) , 2.2 ) ;".split(" ")}]}}]},{type:"textline",tokens:"} void bu ( inout vec3 bt ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["GAMMA"],group:{type:"group",parts:[{type:"textline",tokens:"bt = max ( vec3 ( 0.0 ) , bt ) ; bt = pow ( bt , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"} void bx ( inout vec3 bv , in float bw ) {".split(" ")},{type:"condition",parts:[{type:"if",
expression:["PREMULTIPLY_ALPHA"],group:{type:"group",parts:[{type:"textline",tokens:"bv = bv * bw ;".split(" ")}]}}]},{type:"textline",tokens:"} float bB ( vec4 by ) { float bz ; vec3 bA ; bA = vec3 ( 0.299 , 0.587 , 0.114 ) ; bz = dot ( by . rgb , bA ) ; return bz ; }".split(" ")}]};a["include/shadow.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",tokens:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",tokens:["1.0"]},{type:"var",
name:"SHADOW_TEX_RES",tokens:["0.0"]},{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float bN = 0.1 ; const float bO = 0.1 ; const float bP = - 0.01 ; const float bQ = 0.05 ; vec4 bR = vec4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 ) ; vec4 bS = vec4 ( 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 ) ; vec4 bT = vec4 ( - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 ) ; vec4 bU = vec4 ( - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; vec4 bV = vec4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 ) ; vec4 bW = vec4 ( - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 ) ; vec4 bX = vec4 ( - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 ) ; vec4 bY = vec4 ( - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ; bool ca ( vec2 bZ , float b_ ) { return all ( lessThanEqual ( bZ , vec2 ( 1.0 + b_ ) ) ) && all ( greaterThanEqual ( bZ , vec2 ( 0.0 - b_ ) ) ) ; } float cj ( float cb , float cc , mat2 cd , vec3 ce , float cf , PRECISION sampler2D cg ) { vec2 ch , ci ; ci . x = cb ; ci . y = cc ; ci = cd * ci ; ch = ce . xy + ci * cf / SHADOW_TEX_RES ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"if ( ! ca ( ch , bP ) ) return 1.0 ; else".split(" ")}]}}]},{type:"textline",tokens:"return step ( ce . z , texture2D ( cg , ch ) . r ) ; } float cs ( vec3 ck , PRECISION sampler2D cl , float cm ) { mat2 cn ; float co , cp , cq ; co = 0.0 ; ck . z = clamp ( ck . z , 0.0 , 1.0 ) ; cp = aY ( ck . xy ) . x * M_PI ; cq = cos ( cp ) ; cp = sin ( cp ) ; cn = mat2 ( cq , cp , - cp , cq ) ; for ( int cr = 0 ; cr < 4 ; cr ++ ) { co += cj ( bR [ cr ] , bV [ cr ] , cn , ck , cm , cl ) ; co += cj ( bS [ cr ] , bW [ cr ] , cn , ck , cm , cl ) ; co += cj ( bT [ cr ] , bX [ cr ] , cn , ck , cm , cl ) ; co += cj ( bU [ cr ] , bY [ cr ] , cn , ck , cm , cl ) ; } return clamp ( co / 16.0 , 0.0 , 1.0 ) ; } float cH ( vec3 ct , PRECISION sampler2D cu , vec3 cv , PRECISION sampler2D cw , float cx , float cy , float cz ) { mat2 cA ; float cB , cC , cD , cE ; ct . z = clamp ( ct . z , 0.0 , 1.0 ) ; cv . z = clamp ( cv . z , 0.0 , 1.0 ) ; cB = 0.0 ; cC = 0.0 ; cD = aY ( ct . xy ) . x * M_PI ; cE = cos ( cD ) ; cD = sin ( cD ) ; cA = mat2 ( cE , cD , - cD , cE ) ; for ( int cF = 0 ; cF < 4 ; cF ++ ) { cB += cj ( bR [ cF ] , bV [ cF ] , cA , ct , cx , cu ) ; cB += cj ( bS [ cF ] , bW [ cF ] , cA , ct , cx , cu ) ; cB += cj ( bT [ cF ] , bX [ cF ] , cA , ct , cx , cu ) ; cB += cj ( bU [ cF ] , bY [ cF ] , cA , ct , cx , cu ) ; } for ( int cG = 0 ; cG < 4 ; cG ++ ) { cC += cj ( bR [ cG ] , bV [ cG ] , cA , cv , cy , cw ) ; cC += cj ( bS [ cG ] , bW [ cG ] , cA , cv , cy , cw ) ; cC += cj ( bT [ cG ] , bX [ cG ] , cA , cv , cy , cw ) ; cC += cj ( bU [ cG ] , bY [ cG ] , cA , cv , cy , cw ) ; } cB = mix ( cB , cC , cz ) ; cB /= 16.0 ; return clamp ( cB , 0.0 , 1.0 ) ; } float cL ( vec2 cI ) { float cJ , cK ; cJ = min ( cI . x , cI . y ) ; cK = min ( 1.0 - cI . x , 1.0 - cI . y ) ; return min ( cJ , cK ) ; } float cO ( float cM , float cN ) { if ( cN >= 0.0 && cN <= bO ) cM = ( cM - 1.0 ) / bO * cN + 1.0 ; return cM ; } float cZ ( vec3 cP , vec3 cQ , PRECISION sampler2D cR , PRECISION sampler2D cS , float cT , float cU , float cV , float cW ) { float cX , cY ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",parts:[{type:"textline",tokens:"cY = cL ( cP . xy ) ; if ( - cW > cV && cY >= 0.0 && cY <= bN && ca ( cQ . xy , 0.0 ) ) { cY = 1.0 - cY / bN ; cX = cH ( cP , cR , cQ , cS , cT , cU , cY ) ; } else".split(" ")}]}}]},{type:"textline",tokens:"cX = cs ( cP , cR , cT ) ; return cX ; } float dg ( vec3 c_ , PRECISION sampler2D da , float db , float dc , float dd ) { float de , df ; de = cs ( c_ , da , db ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_FADE_LAST_CASCADE"],group:{type:"group",parts:[{type:"textline",tokens:"if ( - dd > dc ) { df = cL ( c_ . xy ) ; de = cO ( de , df ) ; }".split(" ")}]}}]},{type:"textline",tokens:"return de ; } vec4 dr ( float dh ) { vec3 di , dj , dk , dl ; float dm , dn , dp , dq ; dm = 1.0 ; di = bI . xyz / bI . w ; if ( bI . w < 0.0 ) di . z = 0.0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",
places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dj = bJ . xyz / bJ . w ; if ( bJ . w < 0.0 ) dj . z = 0.0 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dk = bK . xyz / bK . w ; if ( bK . w < 0.0 ) dk . z = 0.0 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3",
"NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dl = bL . xyz / bL . w ; if ( bL . w < 0.0 ) dl . z = 0.0 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:"if ( ca ( di . xy , 0.0 ) ) { dm = cZ ( di , dj , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , dh ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"if ( ca ( di . xy , bQ ) ) { dm = dg ( di , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , dh ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:"else { if ( ca ( dj . xy , 0.0 ) ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:"dm = cZ ( dj , dk , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , dh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dm = dg ( dj , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , dh ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:"else { if ( ca ( dk . xy , 0.0 ) ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:"dm = cZ ( dk , dl , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , dh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dm = dg ( dk , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , dh ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:"else { if ( ca ( dl . xy , 0.0 ) ) dm = dg ( dl , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , dh ) ; }".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]},
{type:"textline",tokens:["}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_CAST_LAMPS",1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dn = cs ( dj , u_shadow_map1 , u_pcf_blur_radii [ 0 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["dn","=","0.0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_CAST_LAMPS",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dp = cs ( dk , u_shadow_map2 , u_pcf_blur_radii [ 0 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["dp","=","0.0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_CAST_LAMPS",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dq = cs ( dl , u_shadow_map3 , u_pcf_blur_radii [ 0 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["dq","=","1.0",";"]}]}}]},{type:"textline",tokens:"return vec4 ( dm , dn , dp , dq ) ; }".split(" ")}]}}]},{type:"textline",tokens:"vec4 du ( inout vec3 ds ) { vec4 dt ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dt = texture2DProj ( u_shadow_mask , bG ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_CAST_LAMPS",3,{type:"l_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ds *= dt . a ;".split(" ")}]}}]},{type:"textline",tokens:["return","dt",";"]}]}},{type:"elif",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",
{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dt = dr ( bD . z ) ; return dt ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return vec4 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["include/mirror.glslf"]={type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",
places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"define",name:"REFL_BUMP",tokens:["0.1"]},{type:"textline",tokens:"float dB ( in vec3 dv , vec3 dw , float dx , float dy ) { float dz ; vec3 dA ; dA = normalize ( dw + dv ) ; dz = 1.0 - dot ( dv , dA ) ; dz = dy + ( 1.0 - dy ) * pow ( dz , dx ) ; return dz ; } void dP ( inout vec3 dC , vec3 dD , vec3 dE , float dF , mat4 dG ) { vec2 dH , dI ; float dJ , dK , dL ; vec3 dM , dN , dO ; dM = reflect ( - dD , dE ) ; dJ = u_fresnel_params [ 2 ] ; dK = u_fresnel_params [ 3 ] ; dL = 1.0 ; if ( dJ != 0.0 ) dL = dB ( dD , dM , dJ , dK ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dN = textureCube ( u_cube_reflection , dM ) . xyz ;".split(" ")}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"dO = u_refl_plane . xyz * dot ( dE , u_refl_plane . xyz ) ; dO = dE - dO ; dH = ( dG * vec4 ( dO , 0.0 ) ) . xy ; dI = bG . xy / bG . z ; dI += dH * REFL_BUMP ; dN = texture2D ( u_plane_reflection , dI ) . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dN = vec3 ( 1.0 ) ; dF = 0.0 ;".split(" ")}]}}]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dN = textureCube ( u_mirrormap , dM ) . xyz ; dF = u_mirror_factor ;".split(" ")}]}}]},{type:"textline",tokens:"br ( dN . rgb ) ; dC = mix ( dC , dN , dF * dL ) ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",parts:[{type:"textline",
tokens:"vec3 dS ( vec3 dQ ) { float dR ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["SKY_TEXTURE"],group:{type:"group",parts:[{type:"textline",tokens:"return textureCube ( u_sky_texture , dQ ) . rgb ;".split(" ")}]}},{type:"elif",expression:["SKY_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"dR = 0.5 * dQ . y + 0.5 ; return mix ( u_horizon_color , u_zenith_color , dR ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["include/refraction.glslf"]={type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION_CORRECTION"],group:{type:"group",parts:[{type:"textline",
tokens:"float dY ( in float dT , inout vec2 dU , in vec2 dV ) { float dW ; vec4 dX ; dX = texture2D ( u_scene_depth , dU ) ; dW = Z ( dX ) ; if ( dW < bH ) { dU = dV ; return dT ; } else { return dW ; } return dT ; }".split(" ")}]}}]},{type:"textline",tokens:"vec3 ef ( in vec3 dZ , in vec2 d_ ) { vec3 ea ; float eb ; vec4 ec ; vec2 ed , ee ; ed = dZ . xy / dZ . z ; ee = ed + d_ ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION_CORRECTION"],group:{type:"group",parts:[{type:"textline",
tokens:"ec = texture2DProj ( u_scene_depth , dZ ) ; eb = Z ( ec ) ; dY ( eb , ee , ed ) ;".split(" ")}]}}]},{type:"textline",tokens:"ea = texture2D ( u_refractmap , ee ) . rgb ; br ( ea ) ; return ea ; }".split(" ")}]}}]}]};a["include/nodes.glslf"]={type:"group",parts:[{type:"var",name:"MAPPING_TRS_MATRIX",tokens:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",
tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",tokens:["0.0"]},{type:"var",name:"RGB_IND",tokens:["0"]},{type:"var",name:"VALUE_IND",tokens:["0"]},{type:"var",name:"LAMP_INDEX",tokens:["0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},
{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NODE_TEX_ROW",tokens:["0.0"]},{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","eg",";"]}]}}]},{type:"textline",tokens:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float eh = 0.5 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 el ( in vec3 ei , in float ej ) { vec3 ek ; ek = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:"ek = ef ( bG , ei . xy * ej ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ek = texture2D ( u_refractmap , bG . xy / bG . z ) . rgb ; br ( ek ) ;".split(" ")}]}}]},
{type:"textline",tokens:["return","ek",";","}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 eq ( vec3 em ) { float en , eo ; vec4 ep ; ep = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; ep = mix ( vec4 ( em . bg , ep . wz ) , vec4 ( em . gb , ep . xy ) , step ( em . b , em . g ) ) ; ep = mix ( vec4 ( ep . xyw , em . r ) , vec4 ( em . r , ep . yzx ) , step ( ep . x , em . r ) ) ; en = ep . x - min ( ep . w , ep . y ) ; eo = 1.0e-10 ; return vec3 ( abs ( ep . z + ( ep . w - ep . y ) / ( 6.0 * en + eo ) ) , en / ( ep . x + eo ) , ep . x ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 eu ( vec3 er ) { vec3 es ; vec4 et ; et = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; es = abs ( fract ( vec3 ( er . r , er . r , er . r ) + et . xyz ) * 6.0 - et . www ) ; return er . b * mix ( et . xxx , clamp ( es - et . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , er . g ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 ew ( vec2 ev ) { return vec3 ( ev * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{type:"logical_or_expr",places:3}],group:{type:"group",
parts:[{type:"textline",tokens:"vec2 ey ( vec3 ex ) { return vec2 ( ex . xy * eh + vec2 ( eh , eh ) ) ; }".split(" ")}]}}]},{type:"node",name:"CAMERA",declarations:[{type:"node_out",name:"fq",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"fr",qualifier:["float"],is_optional:!0},{type:"node_out",name:"fs",qualifier:["float"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_fq"],statements:[{type:"textline",tokens:"fq = normalize ( fh . xyz ) ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_fr"],statements:[{type:"textline",tokens:"fr = abs ( fh . z ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_fs"],statements:[{type:"textline",tokens:"fs = length ( fh . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",declarations:[{type:"node_in",name:"ft",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fu",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fv",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"fw",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fw = vec3 ( ft , fu , fv ) ;".split(" ")}]},{type:"node",name:"COMBHSV",declarations:[{type:"node_in",name:"fx",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fy",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fz",qualifier:["float"],is_optional:!1},{type:"node_out",name:"fA",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fA = eu ( vec3 ( fx , fy , fz ) ) ;".split(" ")}]},
{type:"node",name:"EMPTY_UV",declarations:[{type:"node_out",name:"fB",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fB = vec3 ( - UNITY_VALUE_NODES , - UNITY_VALUE_NODES , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"EMPTY_VC",declarations:[{type:"node_out",name:"fC",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fC = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",declarations:[{type:"node_out",name:"fD",qualifier:["vec3"],
is_optional:!1},{type:"node_param",name:"ez",qualifier:["varying","vec2"],is_optional:!1}],statements:[{type:"textline",tokens:"fD = ew ( ez ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_OR",declarations:[{type:"node_out",name:"fE",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fE = 2.0 * eg - vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC",declarations:[{type:"node_out",name:"fF",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"eA",
qualifier:["varying","vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fF = eA ; br ( fF ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC1",declarations:[{type:"node_out",name:"fG",qualifier:["float"],is_optional:!1},{type:"node_param",name:"eB",qualifier:["varying","float"],is_optional:!1}],statements:[{type:"textline",tokens:"fG = eB ; br ( fG ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC2",declarations:[{type:"node_out",name:"fH",qualifier:["float"],is_optional:!1},{type:"node_out",
name:"fI",qualifier:["float"],is_optional:!1},{type:"node_param",name:"eC",qualifier:["varying","vec2"],is_optional:!1}],statements:[{type:"textline",tokens:"fH = eC [ 0 ] ; fI = eC [ 1 ] ; br ( fH ) ; br ( fI ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",declarations:[{type:"node_out",name:"fJ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"fK",qualifier:["float"],is_optional:!1},{type:"node_out",name:"fL",qualifier:["float"],is_optional:!1},{type:"node_param",name:"eD",qualifier:["varying",
"vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fJ = eD [ 0 ] ; fK = eD [ 1 ] ; fL = eD [ 2 ] ; br ( fJ ) ; br ( fK ) ; br ( fL ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_NO",declarations:[{type:"node_out",name:"fM",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["fM","=","fk",";"]}]},{type:"node",name:"GEOMETRY_FB",declarations:[{type:"node_out",name:"fN",qualifier:["float"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["INVERT_FRONTFACING"],
statements:[{type:"textline",tokens:"fN = ( gl_FrontFacing ) ? ZERO_VALUE_NODES : UNITY_VALUE_NODES ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"fN = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}]}]},{type:"node",name:"GEOMETRY_VW",declarations:[{type:"node_out",name:"fO",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["fO","=","eM",";"]}]},{type:"node",name:"GEOMETRY_LO",declarations:[{type:"node_out",name:"fP",qualifier:["vec3"],
is_optional:!1}],statements:[{type:"textline",tokens:"fP [ 0 ] = fh [ 0 ] ; fP [ 1 ] = fh [ 1 ] ; fP [ 2 ] = fh [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_GL",declarations:[{type:"node_out",name:"fQ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fQ = vec3 ( fl . r , - fl . b , fl . g ) ;".split(" ")}]},{type:"node",name:"NEW_GEOMETRY",declarations:[{type:"node_out",name:"fR",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"fS",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"fT",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"fU",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"fV",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"fW",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"fX",qualifier:["float"],is_optional:!1},{type:"node_out",name:"fY",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"fR = vec3 ( ZERO_VALUE_NODES ) ; fS = vec3 ( ZERO_VALUE_NODES ) ; fT = vec3 ( ZERO_VALUE_NODES ) ; fU = vec3 ( ZERO_VALUE_NODES ) ; fV = vec3 ( ZERO_VALUE_NODES ) ; fW = vec3 ( ZERO_VALUE_NODES ) ; fX = ZERO_VALUE_NODES ; fY = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"HUE_SAT",declarations:[{type:"node_in",name:"fZ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"f_",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ga",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gb",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gc",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gd",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fn = eq ( gc ) ; fn [ 0 ] += ( fZ - eh ) ; if ( fn [ 0 ] > UNITY_VALUE_NODES ) fn [ 0 ] -= UNITY_VALUE_NODES ; else if ( fn [ 0 ] < ZERO_VALUE_NODES ) fn [ 0 ] += UNITY_VALUE_NODES ; fn *= vec3 ( UNITY_VALUE_NODES , f_ , ga ) ; fn = mix ( vec3 ( UNITY_VALUE_NODES ) , mix ( vec3 ( ZERO_VALUE_NODES ) , fn , step ( vec3 ( ZERO_VALUE_NODES ) , fn ) ) , step ( fn , vec3 ( UNITY_VALUE_NODES ) ) ) ; gd = mix ( gc , eu ( fn ) , gb ) ;".split(" ")}]},
{type:"node",name:"INVERT",declarations:[{type:"node_in",name:"ge",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gf",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gg",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"gg = mix ( gf , vec3 ( UNITY_VALUE_NODES ) - gf , ge ) ;".split(" ")}]},{type:"node",name:"LAMP",declarations:[{type:"node_out",name:"gh",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"gi",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"gj",qualifier:["float"],is_optional:!1},{type:"node_out",name:"gk",qualifier:["float"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gh"],statements:[{type:"textline",tokens:"gh = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",tokens:"fi = u_lamp_light_factors [ LAMP_INDEX ] ; fn = u_lamp_light_directions [ LAMP_INDEX ] ; fo = u_lamp_light_positions [ LAMP_INDEX ] ; fa = fi . z ; if ( fa != - UNITY_VALUE_NODES ) {".split(" ")},
{type:"textline",tokens:"gi = fo - bC ; gj = length ( gi ) ; gi = normalize ( gi ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gk"],statements:[{type:"textline",tokens:"gk = fa / ( fa + gj * gj ) ; fa = fi . x ; fb = fi . y ; if ( fa > - UNITY_VALUE_NODES ) { fc = dot ( gi , fn ) ; fc *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( fc - fa ) / fb ) ; gk *= fc ; }".split(" ")}]}]},{type:"textline",tokens:["}","else","{"]},{type:"node_condition",parts:[{type:"node_if",
expression:["USE_OUT_gi"],statements:[{type:"textline",tokens:["gi","=","fn",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gj"],statements:[{type:"textline",tokens:"gj = length ( fo - bC ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gk"],statements:[{type:"textline",tokens:["gk","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",tokens:["}"]}]},{type:"node",name:"NORMAL",declarations:[{type:"node_in",name:"gl",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"gm",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"gn",qualifier:["float"],is_optional:!0},{type:"node_param",name:"eE",qualifier:["vec3"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gm"],statements:[{type:"textline",tokens:["gm","=","eE",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gn"],statements:[{type:"textline",tokens:"gn = - dot ( gl , eE ) ;".split(" ")}]}]}]},
{type:"node",name:"B4W_VECTOR_VIEW",declarations:[{type:"node_in",name:"go",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gp",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"gp = - ( eN * vec4 ( go , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"BSDF_ANISOTROPIC",declarations:[{type:"node_in",name:"gq",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gr",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gs",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"gt",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gu",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gv",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gw",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gw","=","gq",";"]},{type:"textline",tokens:"gr ; gs ; gt ; gu ; gv ;".split(" ")}]},{type:"node",name:"BSDF_DIFFUSE",declarations:[{type:"node_in",name:"gx",qualifier:["vec3"],is_optional:!1},{type:"node_in",
name:"gy",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gz",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gA",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gA","=","gx",";"]},{type:"textline",tokens:["gy",";","gz",";"]}]},{type:"node",name:"BSDF_GLASS",declarations:[{type:"node_in",name:"gB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gD",qualifier:["float"],is_optional:!1},
{type:"node_in",name:"gE",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gF",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gF","=","gB",";"]},{type:"textline",tokens:"gC ; gD ; gE ;".split(" ")}]},{type:"node",name:"BSDF_GLOSSY",declarations:[{type:"node_in",name:"gG",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gI",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gJ",qualifier:["vec3"],
is_optional:!1}],statements:[{type:"textline",tokens:["gJ","=","gG",";"]},{type:"textline",tokens:["gH",";","gI",";"]}]},{type:"node",name:"BSDF_HAIR",declarations:[{type:"node_in",name:"gK",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gL",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gM",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gN",qualifier:["float"],is_optional:!1},{type:"node_out",name:"gO",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:["gO","=","gK",";"]},{type:"textline",tokens:"gL ; gM ; gN ;".split(" ")}]},{type:"node",name:"BSDF_TRANSPARENT",declarations:[{type:"node_in",name:"gP",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gQ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gQ","=","gP",";"]}]},{type:"node",name:"BSDF_TRANSLUCENT",declarations:[{type:"node_in",name:"gR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gS",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"gT",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gT","=","gR",";"]},{type:"textline",tokens:["gS",";"]}]},{type:"node",name:"BSDF_REFRACTION",declarations:[{type:"node_in",name:"gU",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gV",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gW",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gX",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gY",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"gY [ 0 ] = gY [ 1 ] = gY [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"gU ; gV ; gW ; gX ;".split(" ")}]},{type:"node",name:"BSDF_TOON",declarations:[{type:"node_in",name:"gZ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"g_",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ha",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hb",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hc",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:["hc","=","gZ",";"]},{type:"textline",tokens:"g_ ; ha ; hb ;".split(" ")}]},{type:"node",name:"BSDF_VELVET",declarations:[{type:"node_in",name:"hd",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"he",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hf",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hg",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hg","=","hd",";"]},{type:"textline",tokens:["he",";","hf",";"]}]},{type:"node",name:"SUBSURFACE_SCATTERING",
declarations:[{type:"node_in",name:"hh",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hi",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hj",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hk",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hl",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hm",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hn",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hn [ 0 ] = hn [ 1 ] = hn [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",tokens:"hh ; hj ; hk ; hl ; hm ; hi ;".split(" ")}]},{type:"node",name:"EMISSION",declarations:[{type:"node_in",name:"ho",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hp",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hq",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hq","=","ho",";"]},{type:"textline",tokens:["hp",";"]}]},{type:"node",name:"AMBIENT_OCCLUSION",declarations:[{type:"node_in",name:"hr",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"hs",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hs [ 0 ] = hs [ 1 ] = hs [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hr",";"]}]},{type:"node",name:"HOLDOUT",declarations:[{type:"node_out",name:"ht",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"ht [ 0 ] = ht [ 1 ] = ht [ 2 ] = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"VOLUME_ABSORPTION",declarations:[{type:"node_in",name:"hu",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"hv",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hw",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hw [ 0 ] = hw [ 1 ] = hw [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hu",";","hv",";"]}]},{type:"node",name:"VOLUME_SCATTER",declarations:[{type:"node_in",name:"hx",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hy",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hz",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"hA",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hA [ 0 ] = hA [ 1 ] = hA [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"hx ; hy ; hz ;".split(" ")}]},{type:"node",name:"BUMP",declarations:[{type:"node_in",name:"hB",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hD",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hE",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"hF",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hF","=","hE",";"]},{type:"textline",tokens:"hB ; hC ; hD ;".split(" ")}]},{type:"node",name:"NORMAL_MAP",declarations:[{type:"node_in",name:"hG",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hH",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hI",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hI","=","hH",";"]},{type:"textline",tokens:["hG",
";"]}]},{type:"node",name:"VECT_TRANSFORM",declarations:[{type:"node_in",name:"hJ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hK",qualifier:["vec3"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["CONVERT_TYPE","VT_WORLD_TO_WORLD",{type:"equal_expr",places:2},"CONVERT_TYPE","VT_OBJECT_TO_OBJECT",{type:"equal_expr",places:2},"CONVERT_TYPE","VT_CAMERA_TO_CAMERA",{type:"equal_expr",places:2},{type:"logical_or_expr",places:3}],statements:[{type:"textline",
tokens:["hK","=","hJ",";"]}]},{type:"node_else",statements:[{type:"node_condition",parts:[{type:"node_if",expression:["VECTOR_TYPE","VT_POINT",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"fi = vec4 ( hJ , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"fi = vec4 ( hJ , ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["CONVERT_TYPE","VT_WORLD_TO_CAMERA",{type:"equal_expr",places:2}],statements:[{type:"textline",
tokens:"hK = ( eO * fi ) . xyz ;".split(" ")}]},{type:"node_elif",expression:["CONVERT_TYPE","VT_WORLD_TO_OBJECT",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"hK = ( eR * fi ) . xyz ;".split(" ")}]},{type:"node_elif",expression:["CONVERT_TYPE","VT_OBJECT_TO_WORLD",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"hK = ( eQ * fi ) . xyz ;".split(" ")}]},{type:"node_elif",expression:["CONVERT_TYPE","VT_OBJECT_TO_CAMERA",{type:"equal_expr",places:2}],statements:[{type:"textline",
tokens:"hK = ( eO * eQ * fi ) . xyz ;".split(" ")}]},{type:"node_elif",expression:["CONVERT_TYPE","VT_CAMERA_TO_WORLD",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"hK = ( eP * fi ) . xyz ;".split(" ")}]},{type:"node_elif",expression:["CONVERT_TYPE","VT_CAMERA_TO_OBJECT",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"hK = ( eR * eP * fi ) . xyz ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["VECTOR_TYPE","VT_NORMAL",{type:"equal_expr",
places:2}],statements:[{type:"textline",tokens:"hK = normalize ( hK ) ;".split(" ")}]}]}]}]}]},{type:"node",name:"BLACKBODY",declarations:[{type:"node_in",name:"hL",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hM",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hM [ 0 ] = hM [ 1 ] = hM [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hL",";"]}]},{type:"node",name:"WAVELENGTH",declarations:[{type:"node_in",name:"hN",qualifier:["float"],is_optional:!1},
{type:"node_out",name:"hO",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hO [ 0 ] = hO [ 1 ] = hO [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hN",";"]}]},{type:"node",name:"SEPXYZ",declarations:[{type:"node_in",name:"hP",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hQ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hR",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hS",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",
tokens:"hQ = hP [ 0 ] ; hR = hP [ 1 ] ; hS = hP [ 2 ] ;".split(" ")}]},{type:"node",name:"COMBXYZ",declarations:[{type:"node_in",name:"hT",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hU",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hV",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hW",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hW [ 0 ] = hT ; hW [ 1 ] = hU ; hW [ 2 ] = hV ;".split(" ")}]},{type:"node",name:"BRIGHTCONTRAST",declarations:[{type:"node_in",
name:"hX",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hY",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hZ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"h_",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fc = hY - hZ * eh ; h_ = max ( ( UNITY_VALUE_NODES + hZ ) * hX + fc , vec3 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},{type:"node",name:"LIGHT_FALLOFF",declarations:[{type:"node_in",name:"ia",qualifier:["float"],is_optional:!1},{type:"node_in",
name:"ib",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ic",qualifier:["float"],is_optional:!1},{type:"node_out",name:"id",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ie",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ic = id = ie = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["ia",";","ib",";"]}]},{type:"node",name:"TEX_IMAGE",declarations:[{type:"node_in",name:"ig",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ih",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"ii",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ih [ 0 ] = ih [ 1 ] = ih [ 2 ] = ZERO_VALUE_NODES ; ii = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["ig",";"]}]},{type:"node",name:"TEX_ENVIRONMENT",declarations:[{type:"node_in",name:"ij",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ik",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"ik [ 0 ] = ik [ 1 ] = ik [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",tokens:["ij",";"]}]},{type:"node",name:"TEX_SKY",declarations:[{type:"node_in",name:"il",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"im",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"im [ 0 ] = im [ 1 ] = im [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["il",";"]}]},{type:"node",name:"TEX_NOISE",declarations:[{type:"node_in",name:"io",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ip",qualifier:["float"],is_optional:!1},
{type:"node_in",name:"iq",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ir",qualifier:["float"],is_optional:!1},{type:"node_out",name:"is",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"it",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"is [ 0 ] = is [ 1 ] = is [ 2 ] = ZERO_VALUE_NODES ; it = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"io ; ip ; iq ; ir ;".split(" ")}]},{type:"node",name:"TEX_WAVE",declarations:[{type:"node_in",name:"iu",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iv",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iw",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ix",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iy",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iz",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iA",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iz [ 0 ] = iz [ 1 ] = iz [ 2 ] = ZERO_VALUE_NODES ; iA = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",tokens:"iu ; iv ; iw ; ix ; iy ;".split(" ")}]},{type:"node",name:"TEX_VORONOI",declarations:[{type:"node_in",name:"iB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iC",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iD",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iE",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iD [ 0 ] = iD [ 1 ] = iD [ 2 ] = ZERO_VALUE_NODES ; iE = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",
tokens:["iB",";","iC",";"]}]},{type:"node",name:"TEX_MUSGRAVE",declarations:[{type:"node_in",name:"iF",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iG",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iI",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iJ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iK",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iL",qualifier:["float"],is_optional:!1},
{type:"node_out",name:"iM",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iN",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iM [ 0 ] = iM [ 1 ] = iM [ 2 ] = ZERO_VALUE_NODES ; iN = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"iF ; iG ; iH ; iI ; iJ ; iK ; iL ;".split(" ")}]},{type:"node",name:"TEX_GRADIENT",declarations:[{type:"node_in",name:"iO",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iP",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"iQ",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iP [ 0 ] = iP [ 1 ] = iP [ 2 ] = ZERO_VALUE_NODES ; iQ = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["iO",";"]}]},{type:"node",name:"TEX_MAGIC",declarations:[{type:"node_in",name:"iR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iS",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iT",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iU",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"iV",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iU [ 0 ] = iU [ 1 ] = iU [ 2 ] = ZERO_VALUE_NODES ; iV = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"iR ; iS ; iT ;".split(" ")}]},{type:"node",name:"TEX_CHECKER",declarations:[{type:"node_in",name:"iW",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iX",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iY",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iZ",
qualifier:["float"],is_optional:!1},{type:"node_out",name:"i_",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ja",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"i_ [ 0 ] = i_ [ 1 ] = i_ [ 2 ] = ZERO_VALUE_NODES ; ja = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"iW ; iX ; iY ; iZ ;".split(" ")}]},{type:"node",name:"TEX_BRICK",declarations:[{type:"node_in",name:"jb",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jc",qualifier:["vec3"],is_optional:!1},
{type:"node_in",name:"jd",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"je",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jf",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jg",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jh",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ji",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jj",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jk",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"jl",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jk [ 0 ] = jk [ 1 ] = jk [ 2 ] = ZERO_VALUE_NODES ; jl = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"jb ; jc ; jd ; je ; jf ; jg ; jh ; ji ; jj ;".split(" ")}]},{type:"node",name:"ADD_SHADER",declarations:[{type:"node_in",name:"jm",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jn",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jo",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"jo = clamp ( jm + jn , vec3 ( ZERO_VALUE_NODES ) , vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")}]},{type:"node",name:"MIX_SHADER",declarations:[{type:"node_in",name:"jp",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jq",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jr",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"js",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fc = clamp ( jp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; js = fc * jq + ( UNITY_VALUE_NODES - fc ) * jr ;".split(" ")}]},
{type:"node",name:"UV_MERGED",declarations:[{type:"node_out",name:"jt",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ju",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"eF",qualifier:["varying","vec2"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_jt"],statements:[{type:"textline",tokens:"jt = ew ( eF ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_ju"],statements:[{type:"textline",tokens:"ju = vec3 ( eF , ZERO_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"TEX_COORD_UV",declarations:[{type:"node_out",name:"jv",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"eG",qualifier:["varying","vec2"],is_optional:!1}],statements:[{type:"textline",tokens:"jv = vec3 ( eG , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_NO",declarations:[{type:"node_out",name:"jw",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["jw","=","fm",";"]}]},{type:"node",name:"TEX_COORD_GE",declarations:[{type:"node_out",
name:"jx",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["jx","=","eg",";"]}]},{type:"node",name:"TEX_COORD_OB",declarations:[{type:"node_out",name:"jy",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jy [ 0 ] = jy [ 1 ] = jy [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_CA",declarations:[{type:"node_out",name:"jz",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jz [ 0 ] = fh [ 0 ] ; jz [ 1 ] = fh [ 1 ] ; jz [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"TEX_COORD_WI",declarations:[{type:"node_out",name:"jA",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jA [ 0 ] = jA [ 1 ] = jA [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_RE",declarations:[{type:"node_out",name:"jB",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jB [ 0 ] = jB [ 1 ] = jB [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"UVMAP",declarations:[{type:"node_out",name:"jC",qualifier:["vec3"],
is_optional:!1},{type:"node_param",name:"eH",qualifier:["varying","vec2"],is_optional:!1}],statements:[{type:"textline",tokens:"jC = vec3 ( eH , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"PARTICLE_INFO",declarations:[{type:"node_out",name:"jD",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jE",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jF",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jG",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jH",
qualifier:["float"],is_optional:!1},{type:"node_out",name:"jI",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jJ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jD = ZERO_VALUE_NODES ; jE = ZERO_VALUE_NODES ; jF = ZERO_VALUE_NODES ; jG = vec3 ( ZERO_VALUE_NODES ) ; jH = ZERO_VALUE_NODES ; jI = jG ; jJ = jG ;".split(" ")}]},{type:"node",name:"HAIR_INFO",declarations:[{type:"node_out",name:"jK",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jL",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"jM",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jN",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jK = ZERO_VALUE_NODES ; jL = ZERO_VALUE_NODES ; jM = ZERO_VALUE_NODES ; jN = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"OBJECT_INFO",declarations:[{type:"node_out",name:"jO",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jP",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jQ",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"jR",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jP = ZERO_VALUE_NODES ; jQ = ZERO_VALUE_NODES ; jR = ZERO_VALUE_NODES ; jO = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"WIREFRAME",declarations:[{type:"node_in",name:"jS",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jT",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:["jT","=","jS",";"]}]},{type:"node",name:"TANGENT",declarations:[{type:"node_out",
name:"jU",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jU = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LAYER_WEIGHT",declarations:[{type:"node_in",name:"jV",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jW",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jX",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jY",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jX = jY = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",tokens:["jW",";","jV",";"]}]},{type:"node",name:"LIGHT_PATH",declarations:[{type:"node_out",name:"jZ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"j_",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ka",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kb",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kc",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kd",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ke",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"kf",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kg",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kh",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jZ = j_ = ka = ZERO_VALUE_NODES ; kb = kc = kd = ZERO_VALUE_NODES ; ke = ke = kg = kh = ZERO_VALUE_NODES ; kf = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"ATTRIBUTE",declarations:[{type:"node_out",name:"ki",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"kj",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kk",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ki = kj = vec3 ( ZERO_VALUE_NODES ) ; kk = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"SCRIPT",declarations:[],statements:[]},{type:"node",name:"CURVE_VEC",declarations:[{type:"node_in",name:"kl",qualifier:["float"],is_optional:!1},{type:"node_in",name:"km",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kn",qualifier:["vec3"],is_optional:!1}],
statements:[{type:"textline",tokens:["kn","=","km",";"]},{type:"node_condition",parts:[{type:"node_if",expression:["READ_R"],statements:[{type:"textline",tokens:"kn . r = ( texture2D ( u_nodes_texture , vec2 ( 0.5 * km . r + 0.5 , NODE_TEX_ROW ) ) . r - 0.5 ) * 2.0 ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["READ_G"],statements:[{type:"textline",tokens:"kn . g = ( texture2D ( u_nodes_texture , vec2 ( 0.5 * km . g + 0.5 , NODE_TEX_ROW ) ) . g - 0.5 ) * 2.0 ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["READ_B"],statements:[{type:"textline",tokens:"kn . b = ( texture2D ( u_nodes_texture , vec2 ( 0.5 * km . b + 0.5 , NODE_TEX_ROW ) ) . b - 0.5 ) * 2.0 ;".split(" ")}]}]},{type:"textline",tokens:"kn = mix ( km , kn , kl ) ;".split(" ")}]},{type:"node",name:"CURVE_RGB",declarations:[{type:"node_in",name:"ko",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kp",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kq",qualifier:["vec3"],
is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["READ_A"],statements:[{type:"textline",tokens:"fc = texture2D ( u_nodes_texture , vec2 ( kp . r , NODE_TEX_ROW ) ) . a ; fb = texture2D ( u_nodes_texture , vec2 ( kp . g , NODE_TEX_ROW ) ) . a ; fa = texture2D ( u_nodes_texture , vec2 ( kp . b , NODE_TEX_ROW ) ) . a ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"fc = kp . r ; fb = kp . g ; fa = kp . b ;".split(" ")}]}]},{type:"node_condition",
parts:[{type:"node_if",expression:["READ_R"],statements:[{type:"textline",tokens:"kq . r = texture2D ( u_nodes_texture , vec2 ( fc , NODE_TEX_ROW ) ) . r ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"kq . r = fc ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["READ_G"],statements:[{type:"textline",tokens:"kq . g = texture2D ( u_nodes_texture , vec2 ( fb , NODE_TEX_ROW ) ) . g ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"kq . g = fb ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["READ_B"],statements:[{type:"textline",tokens:"kq . b = texture2D ( u_nodes_texture , vec2 ( fa , NODE_TEX_ROW ) ) . b ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"kq . b = fa ;".split(" ")}]}]},{type:"textline",tokens:"kq = mix ( kp , kq , ko ) ;".split(" ")}]},{type:"node",name:"VALTORGB",declarations:[{type:"node_in",name:"kr",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ks",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"kt",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"fi = texture2D ( u_nodes_texture , vec2 ( kr , NODE_TEX_ROW ) ) ; ks = fi . rgb ; kt = fi . a ;".split(" ")}]},{type:"node",name:"MAPPING",declarations:[{type:"node_in",name:"ku",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kv",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["kv","=","ku",";"]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",
statements:[{type:"textline",tokens:"kv = ( MAPPING_TRS_MATRIX * vec4 ( kv , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_SCALE",statements:[{type:"textline",tokens:"kv = kv * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",statements:[{type:"textline",tokens:"kv = kv + MAPPING_TRANSLATION ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",
statements:[{type:"textline",tokens:"kv = max ( kv , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",statements:[{type:"textline",tokens:"kv = min ( kv , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["MAPPING_IS_NORMAL"],statements:[{type:"textline",tokens:"kv = normalize ( kv ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",declarations:[{type:"node_in",name:"kw",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"kx",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ky",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ky = kw + kx ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"ky = clamp ( ky , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",declarations:[{type:"node_in",name:"kz",qualifier:["float"],is_optional:!1},
{type:"node_in",name:"kA",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kB",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kB = kz - kA ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kB = clamp ( kB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MULTIPLY",declarations:[{type:"node_in",name:"kC",qualifier:["float"],is_optional:!1},{type:"node_in",
name:"kD",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kE",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kE = kC * kD ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kE = clamp ( kE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",declarations:[{type:"node_in",name:"kF",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kG",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"kH",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kH = ( kG != ZERO_VALUE_NODES ) ? kF / kG : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kH = clamp ( kH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SINE",declarations:[{type:"node_in",name:"kI",qualifier:["float"],is_optional:!1},{type:"node_in",
name:"kJ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kK",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kK = sin ( kI ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kK = clamp ( kK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["kJ",";"]}]},{type:"node",name:"MATH_COSINE",declarations:[{type:"node_in",name:"kL",qualifier:["float"],is_optional:!1},
{type:"node_in",name:"kM",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kN",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kN = cos ( kL ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kN = clamp ( kN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["kM",";"]}]},{type:"node",name:"MATH_TANGENT",declarations:[{type:"node_in",name:"kO",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"kP",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kQ",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kQ = tan ( kO ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kQ = clamp ( kQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["kP",";"]}]},{type:"node",name:"MATH_ARCSINE",declarations:[{type:"node_in",name:"kR",
qualifier:["float"],is_optional:!1},{type:"node_in",name:"kS",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kT",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kT = ( kR <= UNITY_VALUE_NODES && kR >= - UNITY_VALUE_NODES ) ? asin ( kR ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kT = clamp ( kT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",
tokens:["kS",";"]}]},{type:"node",name:"MATH_ARCCOSINE",declarations:[{type:"node_in",name:"kU",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kV",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kW",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kW = ( kU <= UNITY_VALUE_NODES && kU >= - UNITY_VALUE_NODES ) ? acos ( kU ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",
tokens:"kW = clamp ( kW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["kV",";"]}]},{type:"node",name:"MATH_ARCTANGENT",declarations:[{type:"node_in",name:"kX",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kY",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kZ",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kZ = atan ( kX ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],
statements:[{type:"textline",tokens:"kZ = clamp ( kZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["kY",";"]}]},{type:"node",name:"MATH_POWER",declarations:[{type:"node_in",name:"k_",qualifier:["float"],is_optional:!1},{type:"node_in",name:"la",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lb",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"if ( k_ < ZERO_VALUE_NODES && la != floor ( la ) ) lb = ZERO_VALUE_NODES ; else if ( la == ZERO_VALUE_NODES )".split(" ")},
{type:"textline",tokens:"lb = UNITY_VALUE_NODES ; else if ( k_ < ZERO_VALUE_NODES ) lb = mix ( UNITY_VALUE_NODES , - UNITY_VALUE_NODES , sign ( mod ( - la , 2.0 ) ) ) * pow ( - k_ , la ) ; else if ( k_ == ZERO_VALUE_NODES ) lb = ZERO_VALUE_NODES ; else lb = pow ( k_ , la ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lb = clamp ( lb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",
declarations:[{type:"node_in",name:"lc",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ld",qualifier:["float"],is_optional:!1},{type:"node_out",name:"le",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"le = ( lc > ZERO_VALUE_NODES && ld > ZERO_VALUE_NODES ) ? log2 ( lc ) / log2 ( ld ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"le = clamp ( le , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MINIMUM",declarations:[{type:"node_in",name:"lf",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lg",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lh",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lh = min ( lf , lg ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lh = clamp ( lh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_MAXIMUM",declarations:[{type:"node_in",name:"li",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lj",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lk",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lk = max ( li , lj ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lk = clamp ( lk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",
declarations:[{type:"node_in",name:"ll",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lm",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ln",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ln = floor ( ll + eh ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"ln = clamp ( ln , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["lm",";"]}]},
{type:"node",name:"MATH_LESS_THAN",declarations:[{type:"node_in",name:"lo",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lp",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lq",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lq = ( lo < lp ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lq = clamp ( lq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_GREATER_THAN",declarations:[{type:"node_in",name:"lr",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ls",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lt",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lt = ( lr > ls ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lt = clamp ( lt , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MODULO",declarations:[{type:"node_in",name:"lu",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lv",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lw",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lw = abs ( lv ) > 0.000001 ? mod ( lu , lv ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lw = clamp ( lw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_ABSOLUTE",declarations:[{type:"node_in",name:"lx",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ly",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lz",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lz = abs ( lx ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lz = clamp ( lz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",
tokens:["ly",";"]}]},{type:"node",name:"MIX_RGB_MIX",declarations:[{type:"node_in",name:"lA",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lC",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lD",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fa = clamp ( lA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lD = mix ( lB , lC , fa ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],
statements:[{type:"textline",tokens:"lD = clamp ( lD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_ADD",declarations:[{type:"node_in",name:"lE",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lF",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lG",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lH",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fa = clamp ( lE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lH = mix ( lF , lF + lG , fa ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lH = clamp ( lH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_MULTIPLY",declarations:[{type:"node_in",name:"lI",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lJ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lK",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lL",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"fa = clamp ( lI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lL = mix ( lJ , lJ * lK , fa ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lL = clamp ( lL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SUBTRACT",declarations:[{type:"node_in",name:"lM",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lN",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lO",
qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lP",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fa = clamp ( lM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lP = mix ( lN , lN - lO , fa ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lP = clamp ( lP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SCREEN",declarations:[{type:"node_in",name:"lQ",
qualifier:["float"],is_optional:!1},{type:"node_in",name:"lR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lS",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lT",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fa = clamp ( lQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fb = UNITY_VALUE_NODES - fa ; lT = vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( fb ) + fa * ( vec3 ( UNITY_VALUE_NODES ) - lS ) ) * ( vec3 ( UNITY_VALUE_NODES ) - lR ) ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lT = clamp ( lT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",declarations:[{type:"node_in",name:"lU",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lW",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lX",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fa = clamp ( lU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fb = UNITY_VALUE_NODES - fa ; lW += step ( lW , vec3 ( ZERO_VALUE_NODES ) ) ; lX = fb * lV + fa * lV / lW ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lX = clamp ( lX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",declarations:[{type:"node_in",name:"lY",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lZ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"l_",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ma",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"fa = clamp ( lY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ma = mix ( lZ , abs ( lZ - l_ ) , fa ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"ma = clamp ( ma , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",declarations:[{type:"node_in",name:"mb",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mc",qualifier:["vec3"],is_optional:!1},{type:"node_in",
name:"md",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"me",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fa = clamp ( mb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; me = min ( mc . rgb , md . rgb * fa ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"me = clamp ( me , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",declarations:[{type:"node_in",
name:"mf",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mg",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mh",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mi",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fa = clamp ( mf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mi = max ( mg . rgb , mh . rgb * fa ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mi = clamp ( mi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_OVERLAY",declarations:[{type:"node_in",name:"mj",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mk",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ml",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mm",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fa = clamp ( mj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fo = vec3 ( UNITY_VALUE_NODES - fa ) ; mm = mix ( mk * ( fo + 2.0 * fa * ml ) , vec3 ( UNITY_VALUE_NODES ) - ( fo + 2.0 * fa * ( vec3 ( UNITY_VALUE_NODES ) - ml ) ) * ( vec3 ( UNITY_VALUE_NODES ) - mk ) , step ( eh , mk ) ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mm = clamp ( mm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",declarations:[{type:"node_in",name:"mn",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mo",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mp",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mq",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"fa = clamp ( mn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fo = vec3 ( UNITY_VALUE_NODES ) - fa * mp ; fn = clamp ( mo / fo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mq = mix ( mix ( fn , vec3 ( UNITY_VALUE_NODES ) , step ( fo , vec3 ( ZERO_VALUE_NODES ) ) ) , mo , step ( mo , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mq = clamp ( mq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_BURN",declarations:[{type:"node_in",name:"mr",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ms",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mt",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mu",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fa = clamp ( mr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fo = vec3 ( UNITY_VALUE_NODES - fa ) ; fo = fo + fa * mt ; fn = clamp ( vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( UNITY_VALUE_NODES ) - ms ) / fo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mu = mix ( fn , vec3 ( ZERO_VALUE_NODES ) , step ( fo , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mu = clamp ( mu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",declarations:[{type:"node_in",name:"mv",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mw",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mx",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"my",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"fa = clamp ( mv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; my = mw ; fn = eq ( mx ) ; if ( fn . y != ZERO_VALUE_NODES ) { fo = eq ( my ) ; fo . x = fn . x ; fp = eu ( fo ) ; my = mix ( my , fp , fa ) ; }".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"my = clamp ( my , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",declarations:[{type:"node_in",name:"mz",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"mA",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mB",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mC",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fa = clamp ( mz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fb = UNITY_VALUE_NODES - fa ; mC = mA ; fp = eq ( mC ) ; if ( fp . y != ZERO_VALUE_NODES ) { fo = eq ( mB ) ; fp . y = fb * fp . y + fa * fo . y ; mC = eu ( fp ) ; }".split(" ")},{type:"node_condition",parts:[{type:"node_if",
expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mC = clamp ( mC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",declarations:[{type:"node_in",name:"mD",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mE",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mF",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mG",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fa = clamp ( mD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fb = UNITY_VALUE_NODES - fa ; fp = eq ( mE ) ; fo = eq ( mF ) ; fp . z = fb * fp . z + fa * fo . z ; mG = eu ( fp ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mG = clamp ( mG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",declarations:[{type:"node_in",name:"mH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mI",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mJ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mK",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"fa = clamp ( mH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mK = mI ; fo = eq ( mJ ) ; if ( fo . y != ZERO_VALUE_NODES ) { fp = eq ( mK ) ; fp . x = fo . x ; fp . y = fo . y ; fn = eu ( fp ) ; mK = mix ( mK , fn , fa ) ; }".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mK = clamp ( mK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",declarations:[{type:"node_in",
name:"mL",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mM",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mN",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mO",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fa = clamp ( mL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fb = UNITY_VALUE_NODES - fa ; fn = mN + mM - mN * mM ; mO = mM * ( vec3 ( fb ) + vec3 ( fa ) * ( ( vec3 ( UNITY_VALUE_NODES ) - mM ) * mN + fn ) ) ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mO = clamp ( mO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",declarations:[{type:"node_in",name:"mP",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mQ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mR",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mS",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"fa = clamp ( mP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mS = mQ + fa * ( 2.0 * mR - vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mS = clamp ( mS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",declarations:[{type:"node_in",name:"mT",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mU",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",
tokens:"eS = mT ; eW = mU ;".split(" ")}]},{type:"node",name:"MATERIAL_BEGIN",declarations:[{type:"node_in",name:"mV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mW",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mX",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mY",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"mZ",qualifier:["float"],is_optional:!0},{type:"node_out",name:"m_",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"na",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"nb",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nc",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nd",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ne",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nf",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"ng",qualifier:["vec4"],is_optional:!1},{type:"node_param",name:"eI",qualifier:["const","vec2"],is_optional:!1},{type:"node_param",name:"eJ",qualifier:["const",
"vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"nb = clamp ( mV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",tokens:"nc = eJ [ 0 ] * clamp ( mW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_NORMAL"],statements:[{type:"textline",tokens:"nd = normalize ( mY ) ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:["nd","=","fm",";"]}]}]},{type:"node_condition",
parts:[{type:"node_if",expression:["SHADELESS_MAT",{type:"logic_negative_expr",places:1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["MATERIAL_EXT"],statements:[{type:"textline",tokens:"m_ = mZ * nb ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"m_ = eZ * nb ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_DIFFUSE"],statements:[{type:"textline",tokens:["nb","*=","mX",";"]}]}]},{type:"textline",tokens:"na = e_ * u_environment_energy * dS ( nd ) ; ng = du ( nb ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],statements:[{type:"textline",tokens:"ne = vec2 ( eI [ 0 ] , eI [ 1 ] ) ;".split(" ")},{type:"textline",tokens:"nf = vec2 ( eJ [ 1 ] , eJ [ 2 ] ) ;".split(" ")}]}]},{type:"textline",tokens:["eV","=","ng",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:"m_ = vec3 ( ZERO_VALUE_NODES ) ; na = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATERIAL_END",declarations:[{type:"node_in",
name:"nh",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"ni",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nj",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nk",qualifier:["float"],is_optional:!0},{type:"node_in",name:"nl",qualifier:["float"],is_optional:!0},{type:"node_in",name:"nm",qualifier:["float"],is_optional:!0},{type:"node_out",name:"nn",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"no",qualifier:["float"],is_optional:!0},{type:"node_out",name:"np",
qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"nq",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"nr",qualifier:["vec3"],is_optional:!0},{type:"node_param",name:"eK",qualifier:["float"],is_optional:!1},{type:"node_param",name:"eL",qualifier:["float"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_nn"],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_DIFFUSE"],statements:[{type:"textline",tokens:"nn = nh . rgb ;".split(" ")}]},
{type:"node_else",statements:[{type:"textline",tokens:"nn = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["MATERIAL_EXT","REFLECTION_TYPE","REFL_NONE",{type:"non_equal_expr",places:2},{type:"logical_and_expr",places:2}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"dP ( nn , eM , nj , nk , eN ) ;".split(" ")}]},{type:"node_else",
statements:[{type:"textline",tokens:"dP ( nn , eM , nj , nk , mat4 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",tokens:["nn","+=","ni",";"]}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_np"],statements:[{type:"textline",tokens:["np","=","nj",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["MATERIAL_EXT"],statements:[{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_nq"],statements:[{type:"textline",tokens:"nq = nh . rgb ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_nr"],statements:[{type:"textline",tokens:["nr","=","ni",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_no"],statements:[{type:"textline",tokens:"no = clamp ( nm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],
statements:[{type:"textline",tokens:"fa = max ( max ( ni . r , ni . g ) , ni . b ) * nl ; no = clamp ( nm * ( UNITY_VALUE_NODES - fa ) + fa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]}]},{type:"node_else",statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_no"],statements:[{type:"textline",tokens:"no = clamp ( eK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",
tokens:"fa = max ( max ( ni . r , ni . g ) , ni . b ) * eL ; no = eK * ( UNITY_VALUE_NODES - fa ) + fa ;".split(" ")}]}]}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",tokens:["eT","=","ni",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:"eT = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["eU","=","nj",";"]}]},{type:"node",name:"LIGHTING_AMBIENT",declarations:[{type:"node_in",name:"ns",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nt",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nu",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nv",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"nw",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"nv = vec4 ( ns + nu * nt , ZERO_VALUE_NODES ) ; nw = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",declarations:[{type:"node_in",name:"nx",qualifier:["vec4"],
is_optional:!1},{type:"node_out",name:"ny",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nz",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nA",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nB",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"nz = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","HEMI",{type:"equal_expr",places:2}],statements:[{type:"textline",
tokens:["nB","=","eh",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:["nB","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",tokens:"nA = u_light_color_intensities [ LAMP_IND ] ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_SHADOW_MAP_IND",1,{type:"negative_expr",places:1},{type:"non_equal_expr",places:2}],statements:[{type:"textline",tokens:"nA *= nx [ LAMP_SHADOW_MAP_IND ] ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE",
"SPOT",{type:"equal_expr",places:2},"LAMP_TYPE","POINT",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],statements:[{type:"textline",tokens:"fn = u_light_positions [ LAMP_IND ] ; ny = fn - fl ;".split(" ")},{type:"textline",tokens:"fa = length ( ny ) ; nA *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + fa * fa ) ; ny = normalize ( ny ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","SPOT",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"fn = u_light_directions [ LAMP_IND ] ; fa = dot ( ny , fn ) ; fa *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( fa - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; nA *= fa ;".split(" ")}]}]}]},
{type:"node_else",statements:[{type:"textline",tokens:"ny = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",declarations:[{type:"node_in",name:"nC",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nD",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"nE",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nF",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nG",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nH",qualifier:["float"],
is_optional:!1}],statements:[{type:"textline",tokens:"nH = ZERO_VALUE_NODES ; if ( nD . r != ZERO_VALUE_NODES ) { fa = ( UNITY_VALUE_NODES - nF ) * dot ( nE , nC ) + nF ; if ( nG [ 0 ] == ZERO_VALUE_NODES ) { nH = UNITY_VALUE_NODES ; } else { fa = UNITY_VALUE_NODES + abs ( fa ) ; fa = nG [ 1 ] + ( UNITY_VALUE_NODES - nG [ 1 ] ) * pow ( fa , nG [ 0 ] ) ; nH = clamp ( fa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } nH = max ( nH , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",name:"DIFFUSE_LAMBERT",
declarations:[{type:"node_in",name:"nI",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nJ",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"nK",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nL",qualifier:["float"],is_optional:!1},{type:"node_out",name:"nM",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"nM = ZERO_VALUE_NODES ; if ( nJ . r != ZERO_VALUE_NODES ) { fa = ( UNITY_VALUE_NODES - nL ) * dot ( nK , nI ) + nL ; nM = max ( fa , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_OREN_NAYAR",declarations:[{type:"node_in",name:"nN",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nO",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"nP",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nQ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nR",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nS",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"nS = ZERO_VALUE_NODES ; if ( nO . r != ZERO_VALUE_NODES ) { fa = ( UNITY_VALUE_NODES - nQ ) * dot ( nP , nN ) + nQ ; if ( nR [ 0 ] > ZERO_VALUE_NODES ) { fb = max ( dot ( nP , eM ) , ZERO_VALUE_NODES ) ; fc = nR [ 0 ] * nR [ 0 ] ; fd = UNITY_VALUE_NODES - eh * ( fc / ( fc + 0.33 ) ) ; fn = nN - fa * nP ; fp = eM - fb * nP ;".split(" ")},
{type:"textline",tokens:"if ( length ( fn ) == ZERO_VALUE_NODES || length ( fp ) == ZERO_VALUE_NODES || abs ( fa ) > UNITY_VALUE_NODES || abs ( fb ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",tokens:"nS = fa * fd ; else { fe = acos ( fa ) ; fb = acos ( fb ) ; fn = normalize ( fn ) ; fp = normalize ( fp ) ; ff = max ( fe , fb ) ; fg = min ( fe , fb ) ; fg *= 0.95 ; fb = max ( dot ( fn , fp ) , ZERO_VALUE_NODES ) ; fc = 0.45 * ( fc / ( fc + 0.09 ) ) ; nS = fa * ( fd + ( fc * fb * sin ( ff ) * tan ( fg ) ) ) ; } } else nS = fa ; nS = max ( nS , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",declarations:[{type:"node_in",name:"nT",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nU",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"nV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nW",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nX",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nY",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"nY = ZERO_VALUE_NODES ; if ( nU . r != ZERO_VALUE_NODES ) { fa = ( UNITY_VALUE_NODES - nW ) * dot ( nV , nT ) + nW ; fg = max ( dot ( nV , eM ) , ZERO_VALUE_NODES ) ; if ( nX [ 0 ] <= UNITY_VALUE_NODES ) nY = fa * pow ( max ( fg * fa , 0.1 ) , nX [ 0 ] - UNITY_VALUE_NODES ) ; else nY = fa * pow ( 1.0001 - fg , nX [ 0 ] - UNITY_VALUE_NODES ) ; nY = max ( nY , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",declarations:[{type:"node_in",name:"nZ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"n_",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"oa",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ob",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oc",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"od",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"od = ZERO_VALUE_NODES ; if ( n_ . r != ZERO_VALUE_NODES ) { fg = ( UNITY_VALUE_NODES - ob ) * dot ( oa , nZ ) + ob ; fg = acos ( fg ) ; if ( fg < oc [ 0 ] ) od = UNITY_VALUE_NODES ; else if ( fg > ( oc [ 0 ] + oc [ 1 ] ) || oc [ 1 ] == ZERO_VALUE_NODES ) od = ZERO_VALUE_NODES ; else od = UNITY_VALUE_NODES - ( ( fg - oc [ 0 ] ) / oc [ 1 ] ) ; od = max ( od , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",declarations:[{type:"node_in",name:"oe",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"of",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"og",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oh",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oi",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"oj",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"oj = ZERO_VALUE_NODES ; if ( of . g == UNITY_VALUE_NODES ) { fp = normalize ( oe + eM ) ; oj = ( UNITY_VALUE_NODES - oh ) * max ( dot ( og , fp ) , ZERO_VALUE_NODES ) + oh ; oj = pow ( oj , oi [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",declarations:[{type:"node_in",name:"ok",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ol",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"om",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"on",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"oo",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"oo = ZERO_VALUE_NODES ; if ( ol . g == UNITY_VALUE_NODES ) { fp = normalize ( ok + eM ) ; fg = max ( dot ( om , fp ) , 0.001 ) ;".split(" ")},
{type:"textline",tokens:"fa = max ( dot ( om , eM ) , 0.01 ) ; ff = max ( dot ( om , ok ) , 0.01 ) ; fg = tan ( acos ( fg ) ) ; fb = max ( on [ 0 ] , 0.001 ) ; oo = ff * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * fb * fb ) ) * ( exp ( - ( fg * fg ) / ( fb * fb ) ) / ( sqrt ( fa * ff ) ) ) ; }".split(" ")}]},{type:"node",name:"SPECULAR_TOON",declarations:[{type:"node_in",name:"op",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oq",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"or",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"os",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"ot",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ot = ZERO_VALUE_NODES ; if ( oq . g == UNITY_VALUE_NODES ) { fp = normalize ( op + eM ) ; ff = acos ( dot ( fp , or ) ) ; if ( ff < os [ 0 ] ) ot = UNITY_VALUE_NODES ; else if ( ff >= os [ 0 ] + os [ 1 ] || os [ 1 ] == ZERO_VALUE_NODES ) ot = ZERO_VALUE_NODES ; else ot = UNITY_VALUE_NODES - ( ff - os [ 0 ] ) / os [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",declarations:[{type:"node_in",name:"ou",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ov",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"ow",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ox",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oy",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"oz",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"oz = ZERO_VALUE_NODES ; if ( ov . g == UNITY_VALUE_NODES ) { if ( oy [ 0 ] < UNITY_VALUE_NODES || oy [ 1 ] == ZERO_VALUE_NODES ) oz = ZERO_VALUE_NODES ; else { if ( oy [ 1 ] < 100.0 ) oy [ 1 ] = sqrt ( UNITY_VALUE_NODES / oy [ 1 ] ) ; else oy [ 1 ] = 10.0 / oy [ 1 ] ; fp = normalize ( eM + ou ) ; ff = ( UNITY_VALUE_NODES - ox ) * max ( dot ( ow , fp ) , ZERO_VALUE_NODES ) + ox ; if ( ff < ZERO_VALUE_NODES ) oz = ZERO_VALUE_NODES ; else { fa = max ( dot ( ow , eM ) , 0.01 ) ; fb = dot ( ow , ou ) ; if ( fb <= 0.01 ) oz = ZERO_VALUE_NODES ; else { fg = max ( dot ( eM , fp ) , 0.01 ) ; fc = UNITY_VALUE_NODES ; fa = ( 2.0 * ff * fa ) / fg ; fb = ( 2.0 * ff * fb ) / fg ; fb = min ( min ( fc , fa ) , fb ) ; fa = sqrt ( pow ( oy [ 0 ] , 2.0 ) + pow ( fg , 2.0 ) - UNITY_VALUE_NODES ) ; fg = pow ( fa - fg , 2.0 ) / pow ( fa + fg , 2.0 ) * ( UNITY_VALUE_NODES + pow ( fg * ( fa + fg ) - UNITY_VALUE_NODES , 2.0 ) / pow ( fg * ( fa - fg ) + UNITY_VALUE_NODES , 2.0 ) ) ; ff = acos ( ff ) ; oz = max ( fg * fb * exp ( - pow ( ff , 2.0 ) / ( 2.0 * pow ( oy [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",declarations:[{type:"node_in",name:"oA",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"oB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oD",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oE",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oF",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oG",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"oH",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oI",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oJ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oK",qualifier:["float"],is_optional:!1},{type:"node_out",name:"oL",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"oM",qualifier:["vec3"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_NODE_B4W_TRANSLUCENCY"],statements:[{type:"textline",tokens:"if ( dot ( oE , oF ) * dot ( eM , oF ) < ZERO_VALUE_NODES ) { ff = oG . x ; fb = oG . y ; fg = oG . z ; fa = oG . w ;".split(" ")},
{type:"textline",tokens:"fc = clamp ( abs ( dot ( oE , oF ) ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fd = clamp ( dot ( eM , - oE ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fb = pow ( fd , fb ) ;".split(" ")},{type:"textline",tokens:"oL = oA + oK * vec4 ( oJ * fc * pow ( oH , vec3 ( ff ) ) , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",tokens:"oL += fg * mix ( vec4 ( oH , UNITY_VALUE_NODES ) , vec4 ( UNITY_VALUE_NODES ) , fa ) * oK * vec4 ( oJ * fc * vec3 ( fb ) , UNITY_VALUE_NODES ) ; oM = oB ; } else {".split(" ")},
{type:"textline",tokens:"oM = oB + oJ * oI * oD ; oL = oA + vec4 ( oJ * oH * oC , oD ) ; }".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"oM = oB + oJ * oI * oD ; oL = oA + vec4 ( oJ * oH * oC , oD ) ;".split(" ")}]}]}]},{type:"node",name:"RGB",declarations:[{type:"node_out",name:"oN",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"oN = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",declarations:[{type:"node_in",name:"oO",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"oP",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"oP = dot ( oO , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{type:"node",name:"SEPRGB",declarations:[{type:"node_in",name:"oQ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"oR",qualifier:["float"],is_optional:!0},{type:"node_out",name:"oS",qualifier:["float"],is_optional:!0},{type:"node_out",name:"oT",qualifier:["float"],is_optional:!0}],statements:[{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_oR"],statements:[{type:"textline",tokens:"oR = oQ . r ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oS"],statements:[{type:"textline",tokens:"oS = oQ . g ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oT"],statements:[{type:"textline",tokens:"oT = oQ . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",declarations:[{type:"node_in",name:"oU",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"oV",qualifier:["float"],is_optional:!0},{type:"node_out",name:"oW",qualifier:["float"],is_optional:!0},{type:"node_out",name:"oX",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"fp = eq ( oU ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oV"],statements:[{type:"textline",tokens:"oV = fp . r ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oW"],statements:[{type:"textline",tokens:"oW = fp . g ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oX"],statements:[{type:"textline",tokens:"oX = fp . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",declarations:[{type:"node_in",name:"oY",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oZ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"o_",qualifier:["float"],is_optional:!1},{type:"node_out",name:"pa",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"pa = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( oY - o_ ) * oZ ) ) ;".split(" ")}]},
{type:"node",name:"GAMMA",declarations:[{type:"node_in",name:"pb",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pc",qualifier:["float"],is_optional:!1},{type:"node_out",name:"pd",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"pd = pb ; if ( pd . x > ZERO_VALUE_NODES ) pd . x = pow ( pb . x , pc ) ; if ( pd . y > ZERO_VALUE_NODES ) pd . y = pow ( pb . y , pc ) ; if ( pd . z > ZERO_VALUE_NODES ) pd . z = pow ( pb . z , pc ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",
declarations:[{type:"node_in",name:"pe",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pf",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"pf = max ( vec3 ( ZERO_VALUE_NODES ) , pe ) ; pf = pow ( pf , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",declarations:[{type:"node_in",name:"pg",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ph",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"ph = max ( vec3 ( ZERO_VALUE_NODES ) , pg ) ; ph = pow ( ph , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},
{type:"node",name:"TEXTURE_EMPTY",declarations:[{type:"node_out",name:"pi",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pj",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pk",qualifier:["float"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pi"],statements:[{type:"textline",tokens:"pi [ 2 ] = pi [ 1 ] = pi [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pj"],statements:[{type:"textline",
tokens:"pj [ 2 ] = pj [ 1 ] = pj [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pk"],statements:[{type:"textline",tokens:["pk","=","ZERO_VALUE_NODES",";"]}]}]}]},{type:"node",name:"TEXTURE_ENVIRONMENT",declarations:[{type:"node_in",name:"pl",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pm",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pn",qualifier:["float"],is_optional:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",
qualifier:["uniform","samplerCube"],is_optional:!1}],statements:[{type:"textline",tokens:"fi = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , pl ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pm"],statements:[{type:"textline",tokens:"pm = fi . xyz ; br ( pm ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pn"],statements:[{type:"textline",tokens:"pn = fi . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",declarations:[{type:"node_in",
name:"po",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"pp",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"pq",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"pr",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"ps",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pt",qualifier:["float"],is_optional:!0},{type:"node_out",name:"pu",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pv",qualifier:["float"],is_optional:!0},{type:"node_out",name:"pw",
qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"px",qualifier:["float"],is_optional:!0},{type:"node_out",name:"py",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pz",qualifier:["float"],is_optional:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"],is_optional:!1}],statements:[{type:"textline",tokens:"fi = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( po ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_ps"],
statements:[{type:"textline",tokens:"ps = fi . xyz ; br ( ps ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pt"],statements:[{type:"textline",tokens:"pt = fi . w ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv2"],statements:[{type:"textline",tokens:"fi = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pp ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pu"],statements:[{type:"textline",
tokens:"pu = fi . xyz ; br ( pu ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pv"],statements:[{type:"textline",tokens:"pv = fi . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv3"],statements:[{type:"textline",tokens:"fi = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pq ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pw"],statements:[{type:"textline",tokens:"pw = fi . xyz ; br ( pw ) ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_px"],statements:[{type:"textline",tokens:"px = fi . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv4"],statements:[{type:"textline",tokens:"fi = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pr ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_py"],statements:[{type:"textline",tokens:"py = fi . xyz ; br ( py ) ;".split(" ")}]}]},{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_pz"],statements:[{type:"textline",tokens:"pz = fi . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",declarations:[{type:"node_in",name:"pA",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"pB",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"pC",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"pD",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pE",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pF",
qualifier:["float"],is_optional:!0},{type:"node_out",name:"pG",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pH",qualifier:["float"],is_optional:!0},{type:"node_out",name:"pI",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pJ",qualifier:["float"],is_optional:!0},{type:"node_out",name:"pK",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pL",qualifier:["float"],is_optional:!0},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"],
is_optional:!1}],statements:[{type:"textline",tokens:"fi = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( pA ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pE"],statements:[{type:"textline",tokens:"pE = normalize ( fj * ( fi . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pF"],statements:[{type:"textline",tokens:"pF = fi . w ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv2"],
statements:[{type:"textline",tokens:"fi = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( pB ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pG"],statements:[{type:"textline",tokens:"pG = normalize ( fj * ( fi . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pH"],statements:[{type:"textline",tokens:"pH = fi . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv3"],statements:[{type:"textline",
tokens:"fi = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( pC ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pI"],statements:[{type:"textline",tokens:"pI = normalize ( fj * ( fi . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pJ"],statements:[{type:"textline",tokens:"pJ = fi . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv4"],statements:[{type:"textline",tokens:"fi = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( pD ) ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pK"],statements:[{type:"textline",tokens:"pK = normalize ( fj * ( fi . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pL"],statements:[{type:"textline",tokens:"pL = fi . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",declarations:[{type:"node_out",name:"pM",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"pM = u_node_values [ VALUE_IND ] ;".split(" ")}]},
{type:"node",name:"VECT_MATH_ADD",declarations:[{type:"node_in",name:"pN",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pO",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pP",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pQ",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"pP = pN + pO ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pQ"],statements:[{type:"textline",tokens:"pQ = ( abs ( pP [ 0 ] ) + abs ( pP [ 1 ] ) + abs ( pP [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_SUBTRACT",declarations:[{type:"node_in",name:"pR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pS",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pT",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pU",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"pT = pR - pS ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pU"],statements:[{type:"textline",tokens:"pU = ( abs ( pT [ 0 ] ) + abs ( pT [ 1 ] ) + abs ( pT [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_AVERAGE",declarations:[{type:"node_in",name:"pV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pW",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pX",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pY",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"pX = pV + pW ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pY"],statements:[{type:"textline",tokens:"pY = length ( pX ) ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pX"],statements:[{type:"textline",tokens:"pX = normalize ( pX ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",declarations:[{type:"node_in",name:"pZ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"p_",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qa",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qb",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"qa = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_qb"],statements:[{type:"textline",tokens:"qb = dot ( pZ , p_ ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",declarations:[{type:"node_in",name:"qc",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qd",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qe",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qf",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"qe = cross ( qc , qd ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_qf"],statements:[{type:"textline",tokens:"qf = length ( qe ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",declarations:[{type:"node_in",name:"qg",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qh",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qi",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qj",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"qi = normalize ( qg ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_qj"],statements:[{type:"textline",tokens:"qj = length ( qg ) ;".split(" ")}]}]},{type:"textline",tokens:["qh",";"]}]},{type:"node",name:"B4W_REFLECT",declarations:[{type:"node_in",name:"qk",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ql",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qm",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"qm = reflect ( - qk , ql ) ;".split(" ")}]},{type:"node",
name:"B4W_PARALLAX",declarations:[{type:"node_in",name:"qn",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qo",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qp",qualifier:["const","float"],is_optional:!1},{type:"node_in",name:"qq",qualifier:["const","float"],is_optional:!1},{type:"node_out",name:"qr",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"],is_optional:!1}],statements:[{type:"textline",tokens:"fb = length ( fh ) ; if ( fb < qq ) { eX = ey ( qn ) ; fb = clamp ( eh * ( qq - fb ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fb = qo * fb ;".split(" ")},
{type:"textline",tokens:"fp = normalize ( eM * fj ) ;".split(" ")},{type:"textline",tokens:"fc = UNITY_VALUE_NODES / qp ;".split(" ")},{type:"textline",tokens:"eY = fp . xy * fb / ( qp * fp . z ) ; fb = UNITY_VALUE_NODES ; fa = texture2D ( node_B4W_PARALLAX_var_texture , eX ) . a ;".split(" ")},{type:"textline",tokens:"for ( float qs = 1.0 ; qs <= qp ; qs ++ ) { if ( fa < fb ) { fb -= fc ; eX -= eY ; fa = texture2D ( node_B4W_PARALLAX_var_texture , eX ) . a ; } }".split(" ")},{type:"textline",tokens:"eY = eX + eY ; fc = texture2D ( node_B4W_PARALLAX_var_texture , eY ) . a - ( fb + fc ) ; fb = fa - fb ; fc = fb / ( fb - fc ) ;".split(" ")},
{type:"textline",tokens:"eX = fc * eY + ( UNITY_VALUE_NODES - fc ) * eX ; qr = ew ( eX ) ; } else qr = qn ;".split(" ")}]},{type:"node",name:"B4W_CLAMP",declarations:[{type:"node_in",name:"qt",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qu",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"qu = clamp ( qt , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",declarations:[{type:"node_in",name:"qv",qualifier:["vec3"],is_optional:!1},
{type:"node_in",name:"qw",qualifier:["float"],is_optional:!1},{type:"node_out",name:"qx",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"qx = el ( qv , qw ) ;".split(" ")}]},{type:"node",name:"B4W_TRANSLUCENCY",declarations:[{type:"node_in",name:"qy",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qz",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qA",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qB",qualifier:["float"],is_optional:!1},{type:"node_in",
name:"qC",qualifier:["float"],is_optional:!1},{type:"node_out",name:"qD",qualifier:["float"],is_optional:!0},{type:"node_out",name:"qE",qualifier:["vec4"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_qD"],statements:[{type:"textline",tokens:["qD","=","qy",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_qE"],statements:[{type:"textline",tokens:"qE = vec4 ( qz , qA , qB , qC ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",
declarations:[{type:"node_out",name:"qF",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:["qF","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",declarations:[{type:"node_in",name:"qG",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qI",qualifier:["float"],is_optional:!1},{type:"node_out",name:"qJ",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"qJ = smoothstep ( qH , qI , qG ) ;".split(" ")}]},
{type:"node",name:"B4W_GLOW_OUTPUT",declarations:[{type:"node_in",name:"qK",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qL",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"eS = qK ; eW = qL ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",declarations:[{type:"node_in",name:"qM",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qN",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"qN = ( qM . r + qM . g + qM . b ) / 3.0 ;".split(" ")}]},
{type:"node",name:"B4W_SCALTOVEC",declarations:[{type:"node_in",name:"qO",qualifier:["float"],is_optional:!1},{type:"node_out",name:"qP",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"qP [ 0 ] = qO ; qP [ 1 ] = qO ; qP [ 2 ] = qO ;".split(" ")}]},{type:"nodes_global"},{type:"textline",tokens:"void qQ ( in vec3 eM , in mat4 eN , in mat4 eO , in mat4 eP , in mat4 eQ , in mat4 eR , out vec3 eS , out vec3 eT , out vec3 eU , out vec4 eV , out float eW ) { vec2 eX , eY ; float eZ , e_ , fa , fb , fc , fd , fe , ff , fg ; vec4 fh , fi ; mat3 fj ; vec3 fk , fl , fm , fn , fo , fp ; eS = vec3 ( ZERO_VALUE_NODES ) ; eT = vec3 ( ZERO_VALUE_NODES ) ; eU = vec3 ( ZERO_VALUE_NODES ) ; eV = vec4 ( ZERO_VALUE_NODES ) ; eW = ZERO_VALUE_NODES ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:"fk = normalize ( bE ) ; fl = fk ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["INVERT_FRONTFACING"],
group:{type:"group",parts:[{type:"textline",tokens:["if","(","!","gl_FrontFacing",")"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["if","(","gl_FrontFacing",")"]}]}}]},{type:"textline",tokens:"fl = fl ; else fl = - fl ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",parts:[{type:"textline",tokens:["fm","=","fl",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["fm","=","fk",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_NO"],group:{type:"group",parts:[{type:"textline",tokens:["fk","=","fl",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"fn = cross ( fl , bF . xyz ) * bF . w ; fj = mat3 ( bF . xyz , fn , fl ) ; fj = fj ;".split(" ")}]}}]},{type:"textline",tokens:"fl = bC ; fh = bD ; eZ = u_emit ; e_ = u_ambient ;".split(" ")},{type:"nodes_main"},{type:"textline",
tokens:["}"]}]};a["include/to_world.glslv"]={type:"group",parts:[{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",tokens:["(","M_PI","/","4.0",")"]},{type:"textline",tokens:"const vec3 qR = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",places:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2},
{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"mat4 qX ( vec3 qS , mat4 qT ) { vec3 qU , qV , qW ; qU = vec3 ( qT [ 0 ] [ 0 ] , qT [ 1 ] [ 0 ] , qT [ 2 ] [ 0 ] ) ; qV = vec3 ( qT [ 0 ] [ 1 ] , qT [ 1 ] [ 1 ] , qT [ 2 ] [ 1 ] ) ; qW = vec3 ( qT [ 0 ] [ 2 ] , qT [ 1 ] [ 2 ] , qT [ 2 ] [ 2 ] ) ; qV = cross ( qW , qU ) ; return mat4 ( vec4 ( qU , 0.0 ) , vec4 ( qV , 0.0 ) , vec4 ( qW , 0.0 ) , vec4 ( qS , 1.0 ) ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"mat4 rc ( vec3 qY , vec3 qZ ) { vec3 q_ , ra , rb ; q_ = qY - qZ ; q_ . y = 0.0 ; q_ = normalize ( q_ ) ; ra = normalize ( cross ( qR , q_ ) ) ; rb = normalize ( cross ( q_ , ra ) ) ; return mat4 ( vec4 ( ra , 0.0 ) , vec4 ( rb , 0.0 ) , vec4 ( q_ , 0.0 ) , vec4 ( qZ , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"mat4 rk ( in vec3 rd , float re , float rf , float rg , vec3 rh ) { float ri , rj ; ri = fract ( length ( rh ) / 0.17 ) ; rj = rg + ri / 10.0 ; ri = ri ; if ( rg != 0.0 ) ri /= rg ; rd *= 1.0 + 0.5 * sin ( re ) ; ri = length ( rd ) * rf * sin ( 2.0 * 3.14 * re * rj + ri ) ; return C ( ri ) ; }".split(" ")}]}}]},
{type:"textline",tokens:"mat4 rs ( in vec3 rl , in vec3 rm , in mat4 rn ) { vec3 ro ; float rp , rq ; mat4 rr ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",places:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"rr = qX ( rm , rn ) ;".split(" ")}]}},{type:"elif",expression:["BILLBOARD_RANDOM"],
group:{type:"group",parts:[{type:"textline",tokens:"rp = fract ( ( rm . x * 1.43 + rm . y * 0.123 + rm . z * 6.1 ) ) ; rp = 2.0 * M_PI * rp ; ro = normalize ( vec3 ( rn [ 0 ] [ 2 ] , 0.0 , rn [ 2 ] [ 2 ] ) ) ; rq = acos ( ro [ 2 ] ) ; if ( ro [ 0 ] < 0.0 ) rq = 2.0 * M_PI - rq ; rq = rq - rp ; if ( rq < 0.0 ) rq = 2.0 * M_PI + rq ; rp = rp ; if ( rq <= MAX_BILLBOARD_ANGLE ) rp += rq ; else if ( rq <= M_PI - MAX_BILLBOARD_ANGLE ) rp += MAX_BILLBOARD_ANGLE * ( 2.0 * rq - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( rq <= M_PI + MAX_BILLBOARD_ANGLE ) rp += rq - M_PI ; else if ( rq <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) rp += MAX_BILLBOARD_ANGLE * ( 2.0 * rq - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else rp += rq - 2.0 * M_PI ; rr = A ( rp ) ; rr [ 3 ] = vec4 ( rm , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"rr = rc ( rl , rm ) ;".split(" ")}]}}]},{type:"textline",tokens:["return","rr",";","}"]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"mat4 ry ( in vec3 rt , in vec3 ru , in mat4 rv , mat4 rw ) { mat4 rx ; rx = rs ( rt , ru , rv ) ; rw [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; rx = rx * rw ; return rx ; }".split(" ")}]}}]},
{type:"textline",tokens:"c rF ( in vec3 rz , in vec3 rA , in vec3 rB , in vec3 rC , in vec3 rD , in mat4 rE ) { rz = ( rE * vec4 ( rz , 1.0 ) ) . xyz ; rA = ( rE * vec4 ( rA , 1.0 ) ) . xyz ; rB = ( rE * vec4 ( rB , 0.0 ) ) . xyz ; rC = ( rE * vec4 ( rC , 0.0 ) ) . xyz ; rD = ( rE * vec4 ( rD , 0.0 ) ) . xyz ; return E ( c ( rz , rA , rB , rC , rD , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]={type:"group",parts:[{type:"textline",tokens:"vec2 rI ( vec2 rG , vec3 rH ) { return ( rG + 0.5 ) * rH . xy - 0.5 ; }".split(" ")}]};
a["include/skin.glslv"]={type:"group",parts:[{type:"define",name:"SKIN_SLERP",tokens:["0"]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["SKIN_SLERP"],group:{type:"group",parts:[{type:"textline",tokens:"vec4 rP ( in vec4 rJ , in vec4 rK , in float rL ) { float rM , rN , rO ; rM = rJ [ 0 ] * rK [ 0 ] + rJ [ 1 ] * rK [ 1 ] + rJ [ 2 ] * rK [ 2 ] + rJ [ 3 ] * rK [ 3 ] ; if ( rM < 0.0 ) { rK *= - 1.0 ; rM = - rM ; } if ( abs ( rM ) >= 1.0 ) return rJ ; rN = acos ( rM ) ; rM = sqrt ( 1.0 - rM * rM ) ; if ( abs ( rM ) < 0.001 ) return vec4 ( rJ * 0.5 + rK * 0.5 ) ; rO = sin ( ( 1.0 - rL ) * rN ) / rM ; rM = sin ( rL * rN ) / rM ; return rJ * rO + rK * rM ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 sa ( in vec3 rQ , in vec4 rR , in vec4 rS , in vec4 rT , in vec4 rU , in float rV ) { vec4 rW , rX ; vec3 rY , rZ , r_ ; rY = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rQ , 1.0 ) ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SKIN_SLERP"],group:{type:"group",parts:[{type:"textline",tokens:"rW = rP ( rR , rS , rV ) ; rX = mix ( rT , rU , rV ) ; rZ = i ( rW , rY ) ; rZ = rZ * rX . w + rX . xyz ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"r_ = i ( rR , rY ) ; rY = i ( rS , rY ) ; r_ = r_ * rT . w + rT . xyz ; rY = rY * rU . w + rU . xyz ; rZ = mix ( r_ , rY , rV ) ;".split(" ")}]}}]},{type:"textline",tokens:"return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rZ , 1.0 ) ) ; } vec3 sj ( in vec3 sb , in vec4 sc , in vec4 sd , in float se ) { vec4 sf ; vec3 sg , sh , si ; sg = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sb , 0.0 ) ) ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SKIN_SLERP"],group:{type:"group",parts:[{type:"textline",tokens:"sf = rP ( sc , sd , se ) ; sh = i ( sf , sg ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"si = i ( sc , sg ) ; sg = i ( sd , sg ) ; sh = mix ( si , sg , se ) ;".split(" ")}]}}]},{type:"textline",tokens:"return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sh , 0.0 ) ) ; }".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 sa ( in vec3 sk , in vec4 sl , in vec4 sm ) { vec3 sn ; sn = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sk , 1.0 ) ) ; sn = i ( sl , sn ) ; sn = sn * sm . w + sm . xyz ; return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sn , 1.0 ) ) ; } vec3 sj ( in vec3 so , in vec4 sp ) { vec3 sq ; sq = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( so , 0.0 ) ) ; sq = i ( sp , sq ) ; return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sq , 0.0 ) ) ; }".split(" ")}]}}]},
{type:"textline",tokens:"void sF ( inout vec3 sr , inout vec3 ss , inout vec3 st , inout vec3 su ) { int sv , sw ; vec4 sx ; vec3 sy , sz , sA , sB ; float sC , sD ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:["sC","=","u_frame_factor",";"]}]}}]},{type:"textline",tokens:"if ( a_influence . y > 0.0 ) { sy = vec3 ( 0.0 , 0.0 , 0.0 ) ; sz = vec3 ( 0.0 , 0.0 , 0.0 ) ; sA = vec3 ( 0.0 , 0.0 , 0.0 ) ; sB = vec3 ( 0.0 , 0.0 , 0.0 ) ; sx = a_influence ; for ( int sE = 0 ; sE < 4 ; sE ++ ) { sv = int ( sx [ sE ] ) ; sD = fract ( sx [ sE ] ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"sy += sD * sa ( sr , u_quatsb [ sv ] , u_quatsa [ sv ] , u_transb [ sv ] , u_transa [ sv ] , sC ) ; sz += sD * sj ( ss , u_quatsb [ sv ] , u_quatsa [ sv ] , sC ) ; sA += sD * sj ( st , u_quatsb [ sv ] , u_quatsa [ sv ] , sC ) ; sB += sD * sj ( su , u_quatsb [ sv ] , u_quatsa [ sv ] , sC ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"sy += sD * sa ( sr , u_quatsb [ sv ] , u_transb [ sv ] ) ; sB += sD * sj ( su , u_quatsb [ sv ] ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"sz += sD * sj ( ss , u_quatsb [ sv ] ) ; sA += sD * sj ( st , u_quatsb [ sv ] ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"} sr = sy ; su = sB ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"ss = sz ; st = sA ;".split(" ")}]}}]},
{type:"textline",tokens:"} if ( ! ( a_influence . y > 0.0 ) ) { sw = int ( a_influence [ 0 ] - 1.0 ) ; if ( sw > - 1 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"sr = sa ( sr , u_quatsb [ sw ] , u_quatsa [ sw ] , u_transb [ sw ] , u_transa [ sw ] , sC ) ; ss = sj ( ss , u_quatsb [ sw ] , u_quatsa [ sw ] , sC ) ; st = sj ( st , u_quatsb [ sw ] , u_quatsa [ sw ] , sC ) ; su = sj ( su , u_quatsb [ sw ] , u_quatsa [ sw ] , sC ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"sr = sa ( sr , u_quatsb [ sw ] , u_transb [ sw ] ) ; su = sj ( su , u_quatsb [ sw ] ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"ss = sj ( ss , u_quatsb [ sw ] ) ; st = sj ( st , u_quatsb [ sw ] ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]=
{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"void sQ ( inout vec3 sG , in vec3 sH , in float sI , in float sJ , in float sK , in vec3 sL , in float sM ) { vec3 sN ; float sO , sP ; sO = length ( sH ) ; sP = sJ * ( 1.0 + 0.1 * fract ( sO ) ) ; sO = sI * sM * ( 1.0 + sin ( 2.0 * 3.14 * sK * sP + sO ) ) ; sP = ( sG . y - sH . y ) * abs ( sO ) ; sP += 1.0 ; sP *= sP ; sP = sP * sP - sP ; sN = sG ; sN . xz += sL . xz * sP * sign ( sO ) ; sN = sN - sH ; if ( all ( equal ( sN , vec3 ( 0.0 ) ) ) ) sG = sH ; else { sO = length ( sG - sH ) ; sG = sH + normalize ( sN ) * sO ; } }".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"vec4 sS ( vec4 sR ) { return sR * sR * ( 3.0 - 2.0 * sR ) ; } vec4 sU ( vec4 sT ) { return abs ( fract ( sT + 0.5 ) * 2.0 - 1.0 ) ; } vec4 sW ( vec4 sV ) { return sS ( sU ( sV ) ) ; } void tm ( inout vec3 sX , in float sY , in vec3 sZ , in vec3 s_ , in vec3 ta , in float tb , in float tc , in float td , in vec3 te ) { vec3 tf ; vec4 tg ; vec2 th , ti ; float tj , tk , tl ; tj = dot ( ta , vec3 ( 1.0 ) ) ; tk = tj + te . g ; tl = dot ( sX , vec3 ( te . g ) ) ; th = ( sY + vec2 ( tl , tk ) ) ; tg = ( ( fract ( ( th . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( s_ ) * tb ; tg = sW ( tg ) ; ti = tg . xz + tg . yw ; ti . y = 0.5 - ti . y ; tf = ti . xyx * te . rbr * vec3 ( tc * sZ . x , td , tc * sZ . z ) ; sX += tf ; }".split(" ")}]}}]},
{type:"textline",tokens:"void tt ( inout vec3 tn , inout vec3 to , in vec3 tp ) { vec3 tq , tr , ts ; tq = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:"tr = to ; ts = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tr = tn ; ts = to ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",
parts:[{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"tm ( tr , u_time , tp , tq , ts , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",tokens:"sQ ( tr , ts , au_wind_bending_amp , au_wind_bending_freq , u_time , tq , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"sQ ( tr , ts , au_wind_bending_amp , au_wind_bending_freq , u_time , tq , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:"tn += tr - to ; to = tr ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tn = tr ; to = ts ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]}]};a["include/nodes.glslv"]={type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:2},"PARTICLE_BATCH",{type:"logic_negative_expr",
places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_orco_tex_coord ; varying vec3 eg ;".split(" ")}]}}]},{type:"node",name:"TEX_COORD_UV",declarations:[{type:"node_param",name:"node_TEX_COORD_UV_var_a_uv",qualifier:["attribute","vec2"],is_optional:!1},{type:"node_param",name:"eG",qualifier:["varying","vec2"],is_optional:!1}],statements:[{type:"textline",tokens:["eG","=","node_TEX_COORD_UV_var_a_uv",";"]}]},{type:"node",name:"UV_MERGED",
declarations:[{type:"node_param",name:"node_UV_MERGED_var_a_uv",qualifier:["attribute","vec2"],is_optional:!1},{type:"node_param",name:"eF",qualifier:["varying","vec2"],is_optional:!1}],statements:[{type:"textline",tokens:["eF","=","node_UV_MERGED_var_a_uv",";"]}]},{type:"node",name:"UVMAP",declarations:[{type:"node_param",name:"node_UVMAP_var_a_uv",qualifier:["attribute","vec2"],is_optional:!1},{type:"node_param",name:"eH",qualifier:["varying","vec2"],is_optional:!1}],statements:[{type:"textline",
tokens:["eH","=","node_UVMAP_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_UV",declarations:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"],is_optional:!1},{type:"node_param",name:"ez",qualifier:["varying","vec2"],is_optional:!1}],statements:[{type:"textline",tokens:["ez","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",declarations:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"],is_optional:!1},
{type:"node_param",name:"tu",qualifier:["varying","vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["tu","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",declarations:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"],is_optional:!1},{type:"node_param",name:"tv",qualifier:["varying","float"],is_optional:!1}],statements:[{type:"textline",tokens:["tv","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",
name:"GEOMETRY_VC2",declarations:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"],is_optional:!1},{type:"node_param",name:"tw",qualifier:["varying","vec2"],is_optional:!1}],statements:[{type:"textline",tokens:["tw","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",declarations:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"],is_optional:!1},{type:"node_param",name:"tx",qualifier:["varying",
"vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["tx","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},{type:"nodes_global"},{type:"textline",tokens:["void","ty","(",")","{"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["eg","=","a_orco_tex_coord",";"]}]}}]},{type:"nodes_main"},{type:"textline",tokens:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",
parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"vec2 tE ( vec3 tA , float tB , vec2 tC ) { vec2 tD ; tD = vec2 ( ( tA . x - tC . x ) / tB , - ( tA . z - tC . y ) / tB ) ; return fract ( tD ) ; } vec2 tI ( vec2 tF , float tG , vec2 tH ) { return vec2 ( tF . x * tG , - tF . y * tG ) + tH ; } c tJ ( ) { return c ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } c ue ( vec3 tK , vec3 tL , vec3 tM , vec3 tN , vec3 tO , PRECISION sampler2D tP , sampler2D tQ , vec3 tR , float tS , vec3 tT , vec4 tU , mat4 tV ) { mat4 tW ; vec4 tX ; vec2 tY , tZ , t_ ; float ua , ub ; vec3 uc ; uc = i ( tU , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; ua = - uc . x ; ub = - uc . z ; tY = vec2 ( tT . x + tS * ( - 1.0 - ua ) / 2.0 , tT . z + tS * ( 1.0 - ub ) / 2.0 ) ; tZ = tE ( tO , tS , tY ) ; ub = tS / 2.0 ; t_ = abs ( tI ( tZ - vec2 ( 0.5 ) , tS , vec2 ( 0.0 ) ) ) ; ub = ub * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( t_ ) > ub ) return tJ ( ) ; ub = tS / tR . z ; t_ = ( tZ - vec2 ( 0.5 ) ) * ub + vec2 ( 0.5 ) ; uc = uc * ( tS / tR . z - 1.0 ) / 2.0 ; t_ . x += uc . x ; t_ . y -= uc . z ; tX = texture2D ( tQ , t_ ) ; ub = tX . r ; if ( ub < u_scale_threshold ) return tJ ( ) ; ua = tR . y - tR . x ; ua = tR . y - texture2D ( tP , t_ ) . r * ua ; t_ = tK . xz - tO . xz ; tO . xz = tI ( tZ , tS , tY ) ; tO . y = ua ; tK . xz = tO . xz + t_ ; tK . y *= ub ; tK . y += ua ; uc = tX . gba ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"tK -= tO ; tW = rs ( tT , tO , tV ) ; c ud = rF ( tK , tO , tL , tM , tN , tW ) ; ud . b = tO ; ud . f = uc ; return E ( ud ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return E ( c ( tK , tO , tL , tM , tN , uc ) ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]}]};a["include/halo_color.glslf"]={type:"group",parts:[{type:"var",name:"NUM_LINES",
tokens:["0"]},{type:"var",name:"NUM_RINGS",tokens:["0"]},{type:"var",name:"NUM_STARS",tokens:["0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"condition",parts:[{type:"if",expression:["NUM_RINGS","NUM_LINES",{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const int ui = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"const int ui = NUM_LINES ;".split(" ")}]}}]},{type:"textline",tokens:"float uk ( float uj ) { return uj - floor ( uj * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NUM_RINGS"],group:{type:"group",parts:[{type:"textline",tokens:"void ut ( inout float ul , in float um [ ui ] , in float un ) { float uo , up , uq , ur ; for ( int us = 0 ; us < NUM_RINGS ; us ++ ) { uo = 40.0 * um [ us ] ; up = 300.0 * ( uk ( uo ) - 0.005 ) ; uq = uo ; ur = abs ( uq * ( u_halo_size * up - un ) ) ; ul += 1.0 - min ( ur , 1.0 ) ; } }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_LINES"],group:{type:"group",parts:[{type:"textline",
tokens:"void uC ( inout float uu , in float uv [ ui ] , in float uw ) { float ux , uy , uz , uA ; for ( int uB = 0 ; uB < NUM_LINES ; uB ++ ) { ux = uv [ uB ] ; uy = ux ; uz = 1000.0 * ( uk ( ux ) - 0.005 ) ; uA = 20.0 * abs ( uy * bM . x + uz * bM . y ) ; uu += 1.0 - min ( uA , 1.0 ) ; } uu *= uw ; }".split(" ")}]}}]},{type:"textline",tokens:"void uJ ( inout float uD , in vec2 uE ) { float uF , uG , uH , uI ; uG = atan ( uE . y , uE . x ) ; uG *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; uH = cos ( uG ) ; uI = sin ( uG ) ; uG = ( uH * uE . x + uI * uE . y ) * ( uH * uE . y - uI * uE . x ) ; uF = abs ( uG ) ; if ( uF < 1.0 ) { uF = ( 0.01 * u_halo_size ) / ( uF ) ; uD *= sqrt ( min ( uF , 1.0 ) ) ; } } vec4 uS ( ) { vec4 uK ; vec3 uL ; float uM , uN , uO , uP ; uM = ( bM . x * bM . x + bM . y * bM . y ) ; uN = sqrt ( uM ) ; uM = max ( 1.0 - uM , 0.0 ) ; uM = pow ( uM , u_halo_hardness ) ; uO = u_diffuse_color . a ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NUM_RINGS","NUM_LINES",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"float uQ [ ui ] ; for ( int uR = 0 ; uR < ui ; uR ++ ) { uQ [ uR ] = fract ( uh / float ( uR + 1 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_RINGS"],group:{type:"group",parts:[{type:"textline",tokens:"uP = 0.0 ; ut ( uP , uQ , uN ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_LINES"],
group:{type:"group",parts:[{type:"textline",tokens:"uN = 0.0 ; uC ( uN , uQ , uM ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_STARS"],group:{type:"group",parts:[{type:"textline",tokens:"uJ ( uM , bM ) ;".split(" ")}]}}]},{type:"textline",tokens:"uM *= uO ; uL = u_diffuse_color . rgb ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_RINGS"],group:{type:"group",parts:[{type:"textline",tokens:"uP *= uM ; uL += u_halo_rings_color * uP ; uM += uP ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["NUM_LINES"],group:{type:"group",parts:[{type:"textline",tokens:"uN *= uO ; uL += u_halo_lines_color * uN ; uM += uN ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],group:{type:"group",parts:[{type:"textline",tokens:"uM *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uN = u_halo_stars_blend * ( ug . y - u_halo_stars_height ) ; uM *= clamp ( uN , 0.0 , 1.0 ) ; uM *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"uK = vec4 ( uL , uM ) ; return uK ; }".split(" ")}]};a["include/fog.glslf"]={type:"group",parts:[{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",
tokens:"void uZ ( inout vec3 uT , in float uU , in float uV , in vec4 uW ) { float uX , uY ; uX = clamp ( ( uU - u_fog_params . z ) / u_fog_params . y , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FOG_TYPE","QUADRATIC",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uX","*=","uX",";"]}]}},{type:"elif",expression:["FOG_TYPE","LINEAR",{type:"equal_expr",places:2}],group:{type:"group",parts:[]}},{type:"elif",expression:["FOG_TYPE","INVERSE_QUADRATIC",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uX = sqrt ( uX ) ;".split(" ")}]}}]},{type:"textline",tokens:"if ( u_fog_params . w > 0.0 ) { if ( uV > u_fog_params . w ) uX = 0.0 ; else { uY = ( u_fog_params . w - max ( uV , 0.0 ) ) / u_fog_params . w ; uX *= uY * uY ; } } uW . a = 1.0 - ( 1.0 - uX ) * ( 1.0 - u_fog_params . x ) ; uT = mix ( uT , uW . rgb , uW . a ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",
parts:[{type:"textline",tokens:"vec3 ve ( in mat4 u_ , in vec3 va ) { vec3 vb , vc , vd ; vb = mix ( u_ [ 0 ] . rgb , u_ [ 1 ] . rgb , max ( sign ( va . x ) , 0.0 ) ) ; vc = mix ( u_ [ 2 ] . rgb , u_ [ 3 ] . rgb , max ( sign ( va . z ) , 0.0 ) ) ; vd = vec3 ( u_ [ 0 ] . a , u_ [ 1 ] . a , u_ [ 2 ] . a ) ; vc = mix ( vb , vc , abs ( va . z ) ) ; vc = mix ( vc , vd , abs ( va . y ) ) ; br ( vc ) ; return vc ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",
parts:[{type:"textline",tokens:"void vg ( inout float vf ) { vf -= 0.5 ; vf = 4.0 * ( vf * vf * vf ) + 0.5 ; }".split(" ")},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"void vr ( inout vec3 vh , in float vi , in vec3 vj , in float vk , in vec4 vl , in float vm ) { vec3 vn , vo ; float vp , vq ; vp = max ( vj . y , 0.0 ) ; vq = max ( vi - max ( vk / vp , 0.0 ) , 0.0 ) ; vq = vl . w * vq ; vn = vec3 ( 0.0 , 0.02 , 0.05 ) ; vo = vl . rgb ; vq = min ( vq , 1.0 ) ; vg ( vq ) ; vq *= clamp ( 2.0 - vm , 0.0 , 1.0 ) ; vn = mix ( vo , vn , min ( vp , 1.0 ) ) ; vk = clamp ( - vk * 0.03 , 0.0 , 0.8 ) ; vn *= 1.0 - vk ; vh = mix ( vh , vn , vq ) ; }".split(" ")}]}}]}]}}]},
{type:"textline",tokens:"void vy ( inout vec3 vs , float vt , vec3 vu , float vv ) { vec4 vw ; vec3 vx ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:"vx = ve ( u_cube_fog , vu ) ; vw = vec4 ( vx , u_fog_color_density . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["vw","=","u_fog_color_density",
";"]}]}}]},{type:"textline",tokens:"uZ ( vs , vt , bC . y , vw ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"vr ( vs , vt , vu , u_cam_water_depth , u_underwater_fog_color_density , vv ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[]}}]},{type:"textline",tokens:["}"]}]};a["include/shadow.glslv"]={type:"group",parts:[{type:"var",name:"SHADOW_TEX_RES",tokens:["0.0"]},{type:"condition",parts:[{type:"if",
expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 vH ( mat4 vB , vec4 vC , mat4 vD ) { vec4 vE ; float vF ; vec2 vG ; vG = ( vB * vD [ 3 ] ) . xy ; vF = SHADOW_TEX_RES / 2.0 ; vG = floor ( vG * vF + 0.5 ) / vF - vG ; vE = vB * vC ; vE . xy += vG ; vE . xyz = 0.5 * ( vE . xyz + vE . w ) ; return vE ; } void vM ( vec3 vI , vec3 vJ ) { vec4 vK ; mat4 vL ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["MAC_OS_SHADOW_HACK"],group:{type:"group",parts:[{type:"textline",tokens:"vL = O ( u_v_light_tsr [ 0 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vL = O ( mat3 ( u_v_light_ts [ 0 ] , u_v_light_r [ 0 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"vK = vL * vec4 ( vI + u_normal_offset * vJ , 1.0 ) ; bI = vH ( u_p_light_matrix0 , vK , vL ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_CAST_LAMPS",
1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAC_OS_SHADOW_HACK"],group:{type:"group",parts:[{type:"textline",tokens:"vL = O ( u_v_light_tsr [ 1 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vL = O ( mat3 ( u_v_light_ts [ 1 ] , u_v_light_r [ 1 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"vK = vL * vec4 ( vI + u_normal_offset * vJ , 1.0 ) ; bJ = vH ( u_p_light_matrix1 , vK , vL ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["NUM_CAST_LAMPS",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAC_OS_SHADOW_HACK"],group:{type:"group",parts:[{type:"textline",tokens:"vL = O ( u_v_light_tsr [ 2 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vL = O ( mat3 ( u_v_light_ts [ 2 ] , u_v_light_r [ 2 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"vK = vL * vec4 ( vI + u_normal_offset * vJ , 1.0 ) ; bK = vH ( u_p_light_matrix2 , vK , vL ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["NUM_CAST_LAMPS",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAC_OS_SHADOW_HACK"],group:{type:"group",parts:[{type:"textline",tokens:"vL = O ( u_v_light_tsr [ 3 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vL = O ( mat3 ( u_v_light_ts [ 3 ] , u_v_light_r [ 3 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"vK = vL * vec4 ( vI + u_normal_offset * vJ , 1.0 ) ; bL = vH ( u_p_light_matrix3 , vK , vL ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:"bJ = vH ( u_p_light_matrix1 , vK , vL ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:"bK = vH ( u_p_light_matrix2 , vK , vL ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:"bL = vH ( u_p_light_matrix3 , vK , vL ) ;".split(" ")}]}}]},
{type:"textline",tokens:["}"]}]}}]}]};a["include/lighting_nodes.glslf"]={type:"group",parts:[{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"textline",
tokens:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float vN = 0.5 ;".split(" ")},{type:"node",name:"LIGHTING_BEGIN",declarations:[{type:"node_out",name:"wk",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"wl",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"wm",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"wn",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"wo",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"wp",qualifier:["vec2"],
is_optional:!0},{type:"node_out",name:"wq",qualifier:["vec2"],is_optional:!0},{type:"node_out",name:"wr",qualifier:["vec4"],is_optional:!0},{type:"node_out",name:"ws",qualifier:["float"],is_optional:!0},{type:"node_out",name:"wt",qualifier:["vec4"],is_optional:!0}],statements:[{type:"textline",tokens:"wk = vO ; wl = vP ; wm = vQ ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_wn"],statements:[{type:"textline",tokens:["wn","=","vR",";"]}]}]},{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_wo"],statements:[{type:"textline",tokens:["wo","=","vT",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_wq"],statements:[{type:"textline",tokens:["wq","=","vV",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_wp"],statements:[{type:"textline",tokens:["wp","=","vW",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_wr"],statements:[{type:"textline",tokens:["wr","=","vX",";"]}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_ws"],statements:[{type:"textline",tokens:["ws","=","vY",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_wt"],statements:[{type:"textline",tokens:["wt","=","vZ",";"]}]}]}]},{type:"node",name:"LIGHTING_AMBIENT",declarations:[{type:"node_in",name:"wu",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wv",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ww",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"wx",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"wy",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"wx = vec4 ( wu + ww * wv , ZERO_VALUE_NODES ) ; wy = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",declarations:[{type:"node_in",name:"wz",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"wA",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"wB",qualifier:["vec2"],is_optional:!1},{type:"node_out",
name:"wC",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"wD",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wB = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","HEMI",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:["wD","=","vN",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:["wD","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",
tokens:"wC = u_light_color_intensities [ LAMP_IND ] ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_SHADOW_MAP_IND",1,{type:"negative_expr",places:1},{type:"non_equal_expr",places:2}],statements:[{type:"textline",tokens:"wC *= wz [ LAMP_SHADOW_MAP_IND ] ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","SPOT",{type:"equal_expr",places:2},"LAMP_TYPE","POINT",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],statements:[{type:"textline",
tokens:"wi = u_light_positions [ LAMP_IND ] ; wA = wi - vS ;".split(" ")},{type:"textline",tokens:"wb = length ( wA ) ; wC *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + wb * wb ) ; wA = normalize ( wA ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","SPOT",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"wi = u_light_directions [ LAMP_IND ] ; wb = dot ( wA , wi ) ; wb *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( wb - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; wC *= wb ;".split(" ")}]}]}]},
{type:"node_else",statements:[{type:"textline",tokens:"wA = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",declarations:[{type:"node_in",name:"wE",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wF",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wG",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wI",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"wJ",qualifier:["float"],
is_optional:!1}],statements:[{type:"textline",tokens:"wJ = ZERO_VALUE_NODES ; if ( wF . r != ZERO_VALUE_NODES ) { wb = ( UNITY_VALUE_NODES - wH ) * dot ( wG , wE ) + wH ; if ( wI [ 0 ] == ZERO_VALUE_NODES ) { wJ = UNITY_VALUE_NODES ; } else { wb = UNITY_VALUE_NODES + abs ( wb ) ; wb = wI [ 1 ] + ( UNITY_VALUE_NODES - wI [ 1 ] ) * pow ( wb , wI [ 0 ] ) ; wJ = clamp ( wb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } wJ = max ( wJ , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",name:"DIFFUSE_LAMBERT",
declarations:[{type:"node_in",name:"wK",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wL",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wM",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wN",qualifier:["float"],is_optional:!1},{type:"node_out",name:"wO",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wO = ZERO_VALUE_NODES ; if ( wL . r != ZERO_VALUE_NODES ) { wb = ( UNITY_VALUE_NODES - wN ) * dot ( wM , wK ) + wN ; wO = max ( wb , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_OREN_NAYAR",declarations:[{type:"node_in",name:"wP",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wQ",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wS",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wT",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"wU",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wU = ZERO_VALUE_NODES ; if ( wQ . r != ZERO_VALUE_NODES ) { wb = ( UNITY_VALUE_NODES - wS ) * dot ( wR , wP ) + wS ; if ( wT [ 0 ] > ZERO_VALUE_NODES ) { wc = max ( dot ( wR , vU ) , ZERO_VALUE_NODES ) ; wd = wT [ 0 ] * wT [ 0 ] ; we = UNITY_VALUE_NODES - vN * ( wd / ( wd + 0.33 ) ) ; wi = wP - wb * wR ; wj = vU - wc * wR ;".split(" ")},
{type:"textline",tokens:"if ( length ( wi ) == ZERO_VALUE_NODES || length ( wj ) == ZERO_VALUE_NODES || abs ( wb ) > UNITY_VALUE_NODES || abs ( wc ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",tokens:"wU = wb * we ; else { wf = acos ( wb ) ; wc = acos ( wc ) ; wi = normalize ( wi ) ; wj = normalize ( wj ) ; wg = max ( wf , wc ) ; wh = min ( wf , wc ) ; wh *= 0.95 ; wc = max ( dot ( wi , wj ) , ZERO_VALUE_NODES ) ; wd = 0.45 * ( wd / ( wd + 0.09 ) ) ; wU = wb * ( we + ( wd * wc * sin ( wg ) * tan ( wh ) ) ) ; } } else wU = wb ; wU = max ( wU , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",declarations:[{type:"node_in",name:"wV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wW",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wX",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wY",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wZ",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"w_",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"w_ = ZERO_VALUE_NODES ; if ( wW . r != ZERO_VALUE_NODES ) { wb = ( UNITY_VALUE_NODES - wY ) * dot ( wX , wV ) + wY ; wh = max ( dot ( wX , vU ) , ZERO_VALUE_NODES ) ; if ( wZ [ 0 ] <= UNITY_VALUE_NODES ) w_ = wb * pow ( max ( wh * wb , 0.1 ) , wZ [ 0 ] - UNITY_VALUE_NODES ) ; else w_ = wb * pow ( 1.0001 - wh , wZ [ 0 ] - UNITY_VALUE_NODES ) ; w_ = max ( w_ , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",declarations:[{type:"node_in",name:"xa",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xb",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"xc",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xd",qualifier:["float"],is_optional:!1},{type:"node_in",name:"xe",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"xf",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"xf = ZERO_VALUE_NODES ; if ( xb . r != ZERO_VALUE_NODES ) { wh = ( UNITY_VALUE_NODES - xd ) * dot ( xc , xa ) + xd ; wh = acos ( wh ) ; if ( wh < xe [ 0 ] ) xf = UNITY_VALUE_NODES ; else if ( wh > ( xe [ 0 ] + xe [ 1 ] ) || xe [ 1 ] == ZERO_VALUE_NODES ) xf = ZERO_VALUE_NODES ; else xf = UNITY_VALUE_NODES - ( ( wh - xe [ 0 ] ) / xe [ 1 ] ) ; xf = max ( xf , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",declarations:[{type:"node_in",name:"xg",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xh",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"xi",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xj",qualifier:["float"],is_optional:!1},{type:"node_in",name:"xk",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"xl",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"xl = ZERO_VALUE_NODES ; if ( xh . g != ZERO_VALUE_NODES ) { wj = normalize ( xg + vU ) ; xl = ( UNITY_VALUE_NODES - xj ) * max ( dot ( xi , wj ) , ZERO_VALUE_NODES ) + xj ; xl = pow ( xl , xk [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",declarations:[{type:"node_in",name:"xm",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xn",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"xo",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xp",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"xq",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"xq = ZERO_VALUE_NODES ; if ( xn . g != ZERO_VALUE_NODES ) { wj = normalize ( xm + vU ) ; wh = max ( dot ( xo , wj ) , 0.001 ) ;".split(" ")},
{type:"textline",tokens:"wb = max ( dot ( xo , vU ) , 0.01 ) ; wg = max ( dot ( xo , xm ) , 0.01 ) ; wh = tan ( acos ( wh ) ) ; wc = max ( xp [ 0 ] , 0.001 ) ; xq = wg * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * wc * wc ) ) * ( exp ( - ( wh * wh ) / ( wc * wc ) ) / ( sqrt ( wb * wg ) ) ) ; }".split(" ")}]},{type:"node",name:"SPECULAR_TOON",declarations:[{type:"node_in",name:"xr",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xs",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"xt",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"xu",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"xv",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"xv = ZERO_VALUE_NODES ; if ( xs . g != ZERO_VALUE_NODES ) { wj = normalize ( xr + vU ) ; wg = acos ( dot ( wj , xt ) ) ; if ( wg < xu [ 0 ] ) xv = UNITY_VALUE_NODES ; else if ( wg >= xu [ 0 ] + xu [ 1 ] || xu [ 1 ] == ZERO_VALUE_NODES ) xv = ZERO_VALUE_NODES ; else xv = UNITY_VALUE_NODES - ( wg - xu [ 0 ] ) / xu [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",declarations:[{type:"node_in",name:"xw",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xx",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"xy",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xz",qualifier:["float"],is_optional:!1},{type:"node_in",name:"xA",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"xB",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"xB = ZERO_VALUE_NODES ; if ( xx . g != ZERO_VALUE_NODES ) { if ( xA [ 0 ] < 1.0 || xA [ 1 ] == ZERO_VALUE_NODES ) xB = ZERO_VALUE_NODES ; else { if ( xA [ 1 ] < 100.0 ) xA [ 1 ] = sqrt ( 1.0 / xA [ 1 ] ) ; else xA [ 1 ] = 10.0 / xA [ 1 ] ; wj = normalize ( vU + xw ) ; wg = ( UNITY_VALUE_NODES - xz ) * max ( dot ( xy , wj ) , ZERO_VALUE_NODES ) + xz ; if ( wg < ZERO_VALUE_NODES ) xB = ZERO_VALUE_NODES ; else { wb = max ( dot ( xy , vU ) , 0.01 ) ; wc = dot ( xy , xw ) ; if ( wc <= 0.01 ) xB = ZERO_VALUE_NODES ; else { wh = max ( dot ( vU , wj ) , 0.01 ) ; wd = UNITY_VALUE_NODES ; wb = ( 2.0 * wg * wb ) / wh ; wc = ( 2.0 * wg * wc ) / wh ; wc = min ( min ( wd , wb ) , wc ) ; wb = sqrt ( pow ( xA [ 0 ] , 2.0 ) + pow ( wh , 2.0 ) - UNITY_VALUE_NODES ) ; wh = pow ( wb - wh , 2.0 ) / pow ( wb + wh , 2.0 ) * ( UNITY_VALUE_NODES + pow ( wh * ( wb + wh ) - UNITY_VALUE_NODES , 2.0 ) / pow ( wh * ( wb - wh ) + UNITY_VALUE_NODES , 2.0 ) ) ; wg = acos ( wg ) ; xB = max ( wh * wc * exp ( - pow ( wg , 2.0 ) / ( 2.0 * pow ( xA [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",declarations:[{type:"node_in",name:"xC",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"xD",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xE",qualifier:["float"],is_optional:!1},{type:"node_in",name:"xF",qualifier:["float"],is_optional:!1},{type:"node_in",name:"xG",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xH",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xI",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"xJ",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xK",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xL",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xM",qualifier:["float"],is_optional:!1},{type:"node_out",name:"xN",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"xO",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"xO = xD + xL * xK * xF ; xN = xC + vec4 ( xL * xJ * xE , xF ) ;".split(" ")}]},{type:"node",name:"LIGHTING_END",declarations:[{type:"node_in",
name:"xP",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"xQ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"v_ = xP . rgb ; wa = xQ ;".split(" ")}]},{type:"nodes_global"},{type:"textline",tokens:"void xR ( vec3 vO , vec3 vP , vec3 vQ , vec3 vR , vec3 vS , vec3 vT , vec3 vU , vec2 vV , vec2 vW , vec4 vX , float vY , vec4 vZ , out vec3 v_ , out vec3 wa ) { float wb , wc , wd , we , wf , wg , wh ; vec3 wi , wj ;".split(" ")},{type:"nodes_main"},{type:"textline",tokens:["}"]}]};
a["include/particles_nodes.glslf"]={type:"group",parts:[{type:"var",name:"MAPPING_TRS_MATRIX",tokens:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",tokens:["0.0"]},{type:"var",name:"RGB_IND",tokens:["0"]},{type:"var",name:"VALUE_IND",
tokens:["0"]},{type:"var",name:"LAMP_INDEX",tokens:["0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NODE_TEX_ROW",tokens:["0.0"]},{type:"define",
name:"M_PI",tokens:["3.14159265359"]},{type:"textline",tokens:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float xS = 0.5 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 xX ( vec3 xT ) { float xU , xV ; vec4 xW ; xW = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; xW = mix ( vec4 ( xT . bg , xW . wz ) , vec4 ( xT . gb , xW . xy ) , step ( xT . b , xT . g ) ) ; xW = mix ( vec4 ( xW . xyw , xT . r ) , vec4 ( xT . r , xW . yzx ) , step ( xW . x , xT . r ) ) ; xU = xW . x - min ( xW . w , xW . y ) ; xV = 1.0e-10 ; return vec3 ( abs ( xW . z + ( xW . w - xW . y ) / ( 6.0 * xU + xV ) ) , xU / ( xW . x + xV ) , xW . x ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 ya ( vec3 xY ) { vec3 xZ ; vec4 x_ ; x_ = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; xZ = abs ( fract ( vec3 ( xY . r , xY . r , xY . r ) + x_ . xyz ) * 6.0 - x_ . www ) ; return xY . b * mix ( x_ . xxx , clamp ( xZ - x_ . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , xY . g ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 yc ( vec2 yb ) { return vec3 ( yb * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{type:"logical_or_expr",places:3}],group:{type:"group",
parts:[{type:"textline",tokens:"vec2 ye ( vec3 yd ) { return vec2 ( yd . xy * xS + vec2 ( xS , xS ) ) ; }".split(" ")}]}}]},{type:"node",name:"CAMERA",declarations:[{type:"node_out",name:"yT",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"yU",qualifier:["float"],is_optional:!0},{type:"node_out",name:"yV",qualifier:["float"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_yT"],statements:[{type:"textline",tokens:"yT = normalize ( yK . xyz ) ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_yU"],statements:[{type:"textline",tokens:"yU = abs ( yK . z ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_yV"],statements:[{type:"textline",tokens:"yV = length ( yK . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",declarations:[{type:"node_in",name:"yW",qualifier:["float"],is_optional:!1},{type:"node_in",name:"yX",qualifier:["float"],is_optional:!1},{type:"node_in",name:"yY",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"yZ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yZ = vec3 ( yW , yX , yY ) ;".split(" ")}]},{type:"node",name:"COMBHSV",declarations:[{type:"node_in",name:"y_",qualifier:["float"],is_optional:!1},{type:"node_in",name:"za",qualifier:["float"],is_optional:!1},{type:"node_in",name:"zb",qualifier:["float"],is_optional:!1},{type:"node_out",name:"zc",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"zc = ya ( vec3 ( y_ , za , zb ) ) ;".split(" ")}]},
{type:"node",name:"EMPTY_UV",declarations:[{type:"node_out",name:"zd",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"zd = vec3 ( - UNITY_VALUE_NODES , - UNITY_VALUE_NODES , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"EMPTY_VC",declarations:[{type:"node_out",name:"ze",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"ze = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",declarations:[{type:"node_out",name:"zf",qualifier:["vec3"],
is_optional:!1}],statements:[{type:"textline",tokens:"zf = yc ( bM ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_OR",declarations:[{type:"node_out",name:"zg",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"zg = 2.0 * vec3 ( bM , ZERO_VALUE_NODES ) - vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC",declarations:[{type:"node_out",name:"zh",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"zh = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC1",declarations:[{type:"node_out",name:"zi",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:["zi","=","UNITY_VALUE_NODES",";"]}]},{type:"node",name:"GEOMETRY_VC2",declarations:[{type:"node_out",name:"zj",qualifier:["float"],is_optional:!1},{type:"node_out",name:"zk",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"zj = UNITY_VALUE_NODES ; zk = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",declarations:[{type:"node_out",
name:"zl",qualifier:["float"],is_optional:!1},{type:"node_out",name:"zm",qualifier:["float"],is_optional:!1},{type:"node_out",name:"zn",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"zl = UNITY_VALUE_NODES ; zm = UNITY_VALUE_NODES ; zn = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_NO",declarations:[{type:"node_out",name:"zo",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["zo","=","yN",";"]}]},{type:"node",name:"GEOMETRY_FB",declarations:[{type:"node_out",
name:"zp",qualifier:["float"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["INVERT_FRONTFACING"],statements:[{type:"textline",tokens:"zp = ( gl_FrontFacing ) ? ZERO_VALUE_NODES : UNITY_VALUE_NODES ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"zp = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}]}]},{type:"node",name:"GEOMETRY_VW",declarations:[{type:"node_out",name:"zq",qualifier:["vec3"],is_optional:!1}],
statements:[{type:"textline",tokens:["zq","=","yo",";"]}]},{type:"node",name:"GEOMETRY_LO",declarations:[{type:"node_out",name:"zr",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"zr [ 0 ] = yK [ 0 ] ; zr [ 1 ] = yK [ 1 ] ; zr [ 2 ] = yK [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_GL",declarations:[{type:"node_out",name:"zs",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"zs = vec3 ( yO . r , - yO . b , yO . g ) ;".split(" ")}]},{type:"node",
name:"NEW_GEOMETRY",declarations:[{type:"node_out",name:"zt",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"zu",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"zv",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"zw",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"zx",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"zy",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"zz",qualifier:["float"],is_optional:!1},{type:"node_out",name:"zA",qualifier:["float"],
is_optional:!1}],statements:[{type:"textline",tokens:"zt = vec3 ( ZERO_VALUE_NODES ) ; zu = vec3 ( ZERO_VALUE_NODES ) ; zv = vec3 ( ZERO_VALUE_NODES ) ; zw = vec3 ( ZERO_VALUE_NODES ) ; zx = vec3 ( ZERO_VALUE_NODES ) ; zy = vec3 ( ZERO_VALUE_NODES ) ; zz = ZERO_VALUE_NODES ; zA = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"HUE_SAT",declarations:[{type:"node_in",name:"zB",qualifier:["float"],is_optional:!1},{type:"node_in",name:"zC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"zD",
qualifier:["float"],is_optional:!1},{type:"node_in",name:"zE",qualifier:["float"],is_optional:!1},{type:"node_in",name:"zF",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"zG",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yQ = xX ( zF ) ; yQ [ 0 ] += ( zB - xS ) ; if ( yQ [ 0 ] > UNITY_VALUE_NODES ) yQ [ 0 ] -= UNITY_VALUE_NODES ; else if ( yQ [ 0 ] < ZERO_VALUE_NODES ) yQ [ 0 ] += UNITY_VALUE_NODES ; yQ *= vec3 ( UNITY_VALUE_NODES , zC , zD ) ; yQ = mix ( vec3 ( UNITY_VALUE_NODES ) , mix ( vec3 ( ZERO_VALUE_NODES ) , yQ , step ( vec3 ( ZERO_VALUE_NODES ) , yQ ) ) , step ( yQ , vec3 ( UNITY_VALUE_NODES ) ) ) ; zG = mix ( zF , ya ( yQ ) , zE ) ;".split(" ")}]},
{type:"node",name:"INVERT",declarations:[{type:"node_in",name:"zH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"zI",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"zJ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"zJ = mix ( zI , vec3 ( UNITY_VALUE_NODES ) - zI , zH ) ;".split(" ")}]},{type:"node",name:"LAMP",declarations:[{type:"node_out",name:"zK",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"zL",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"zM",qualifier:["float"],is_optional:!1},{type:"node_out",name:"zN",qualifier:["float"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_zK"],statements:[{type:"textline",tokens:"zK = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",tokens:"yL = u_lamp_light_factors [ LAMP_INDEX ] ; yQ = u_lamp_light_directions [ LAMP_INDEX ] ; yR = u_lamp_light_positions [ LAMP_INDEX ] ; yD = yL . z ; if ( yD != - UNITY_VALUE_NODES ) {".split(" ")},
{type:"textline",tokens:"zL = yR - bC ; zM = length ( zL ) ; zL = normalize ( zL ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_zN"],statements:[{type:"textline",tokens:"zN = yD / ( yD + zM * zM ) ; yD = yL . x ; yE = yL . y ; if ( yD > - UNITY_VALUE_NODES ) { yF = dot ( zL , yQ ) ; yF *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( yF - yD ) / yE ) ; zN *= yF ; }".split(" ")}]}]},{type:"textline",tokens:["}","else","{"]},{type:"node_condition",parts:[{type:"node_if",
expression:["USE_OUT_zL"],statements:[{type:"textline",tokens:["zL","=","yQ",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_zM"],statements:[{type:"textline",tokens:"zM = length ( yR - bC ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_zN"],statements:[{type:"textline",tokens:["zN","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",tokens:["}"]}]},{type:"node",name:"NORMAL",declarations:[{type:"node_in",name:"zO",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"zP",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"zQ",qualifier:["float"],is_optional:!0},{type:"node_param",name:"yf",qualifier:["vec3"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_zP"],statements:[{type:"textline",tokens:["zP","=","yf",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_zQ"],statements:[{type:"textline",tokens:"zQ = - dot ( zO , yf ) ;".split(" ")}]}]}]},
{type:"node",name:"B4W_VECTOR_VIEW",declarations:[{type:"node_in",name:"zR",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"zS",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"zS = - ( yp * vec4 ( zR , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"BSDF_ANISOTROPIC",declarations:[{type:"node_in",name:"zT",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"zU",qualifier:["float"],is_optional:!1},{type:"node_in",name:"zV",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"zW",qualifier:["float"],is_optional:!1},{type:"node_in",name:"zX",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"zY",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"zZ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["zZ","=","zT",";"]},{type:"textline",tokens:"zU ; zV ; zW ; zX ; zY ;".split(" ")}]},{type:"node",name:"BSDF_DIFFUSE",declarations:[{type:"node_in",name:"z_",qualifier:["vec3"],is_optional:!1},{type:"node_in",
name:"Aa",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ab",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Ac",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["Ac","=","z_",";"]},{type:"textline",tokens:["Aa",";","Ab",";"]}]},{type:"node",name:"BSDF_GLASS",declarations:[{type:"node_in",name:"Ad",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Ae",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Af",qualifier:["float"],is_optional:!1},
{type:"node_in",name:"Ag",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Ah",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["Ah","=","Ad",";"]},{type:"textline",tokens:"Ae ; Af ; Ag ;".split(" ")}]},{type:"node",name:"BSDF_GLOSSY",declarations:[{type:"node_in",name:"Ai",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Aj",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ak",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Al",qualifier:["vec3"],
is_optional:!1}],statements:[{type:"textline",tokens:["Al","=","Ai",";"]},{type:"textline",tokens:["Aj",";","Ak",";"]}]},{type:"node",name:"BSDF_HAIR",declarations:[{type:"node_in",name:"Am",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"An",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ao",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ap",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Aq",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:["Aq","=","Am",";"]},{type:"textline",tokens:"An ; Ao ; Ap ;".split(" ")}]},{type:"node",name:"BSDF_TRANSPARENT",declarations:[{type:"node_in",name:"Ar",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"As",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["As","=","Ar",";"]}]},{type:"node",name:"BSDF_TRANSLUCENT",declarations:[{type:"node_in",name:"At",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Au",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"Av",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["Av","=","At",";"]},{type:"textline",tokens:["Au",";"]}]},{type:"node",name:"BSDF_REFRACTION",declarations:[{type:"node_in",name:"Aw",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Ax",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ay",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Az",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"AA",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"AA [ 0 ] = AA [ 1 ] = AA [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"Aw ; Ax ; Ay ; Az ;".split(" ")}]},{type:"node",name:"BSDF_TOON",declarations:[{type:"node_in",name:"AB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"AC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"AD",qualifier:["float"],is_optional:!1},{type:"node_in",name:"AE",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"AF",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:["AF","=","AB",";"]},{type:"textline",tokens:"AC ; AD ; AE ;".split(" ")}]},{type:"node",name:"BSDF_VELVET",declarations:[{type:"node_in",name:"AG",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"AH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"AI",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"AJ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["AJ","=","AG",";"]},{type:"textline",tokens:["AH",";","AI",";"]}]},{type:"node",name:"SUBSURFACE_SCATTERING",
declarations:[{type:"node_in",name:"AK",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"AL",qualifier:["float"],is_optional:!1},{type:"node_in",name:"AM",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"AN",qualifier:["float"],is_optional:!1},{type:"node_in",name:"AO",qualifier:["float"],is_optional:!1},{type:"node_in",name:"AP",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"AQ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"AQ [ 0 ] = AQ [ 1 ] = AQ [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",tokens:"AK ; AM ; AN ; AO ; AP ; AL ;".split(" ")}]},{type:"node",name:"EMISSION",declarations:[{type:"node_in",name:"AR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"AS",qualifier:["float"],is_optional:!1},{type:"node_out",name:"AT",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["AT","=","AR",";"]},{type:"textline",tokens:["AS",";"]}]},{type:"node",name:"AMBIENT_OCCLUSION",declarations:[{type:"node_in",name:"AU",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"AV",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"AV [ 0 ] = AV [ 1 ] = AV [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["AU",";"]}]},{type:"node",name:"HOLDOUT",declarations:[{type:"node_out",name:"AW",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"AW [ 0 ] = AW [ 1 ] = AW [ 2 ] = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"VOLUME_ABSORPTION",declarations:[{type:"node_in",name:"AX",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"AY",qualifier:["float"],is_optional:!1},{type:"node_out",name:"AZ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"AZ [ 0 ] = AZ [ 1 ] = AZ [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["AX",";","AY",";"]}]},{type:"node",name:"VOLUME_SCATTER",declarations:[{type:"node_in",name:"A_",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Ba",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Bb",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"Bc",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"Bc [ 0 ] = Bc [ 1 ] = Bc [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"A_ ; Ba ; Bb ;".split(" ")}]},{type:"node",name:"BUMP",declarations:[{type:"node_in",name:"Bd",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Be",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Bf",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Bg",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"Bh",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["Bh","=","Bg",";"]},{type:"textline",tokens:"Bd ; Be ; Bf ;".split(" ")}]},{type:"node",name:"NORMAL_MAP",declarations:[{type:"node_in",name:"Bi",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Bj",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Bk",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["Bk","=","Bj",";"]},{type:"textline",tokens:["Bi",
";"]}]},{type:"node",name:"VECT_TRANSFORM",declarations:[{type:"node_in",name:"Bl",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Bm",qualifier:["vec3"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["CONVERT_TYPE","WORLD_TO_WORLD",{type:"equal_expr",places:2},"CONVERT_TYPE","OBJECT_TO_OBJECT",{type:"equal_expr",places:2},"CONVERT_TYPE","CAMERA_TO_CAMERA",{type:"equal_expr",places:2},{type:"logical_or_expr",places:3}],statements:[{type:"textline",
tokens:["Bm","=","Bl",";"]}]},{type:"node_else",statements:[{type:"node_condition",parts:[{type:"node_if",expression:["VECTOR_TYPE","VT_POINT",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"yL = vec4 ( Bl , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"yL = vec4 ( Bl , ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["CONVERT_TYPE","VT_WORLD_TO_CAMERA",{type:"equal_expr",places:2}],statements:[{type:"textline",
tokens:"Bm = ( yq * yL ) . xyz ;".split(" ")}]},{type:"node_elif",expression:["CONVERT_TYPE","VT_WORLD_TO_OBJECT",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"Bm = ( yt * yL ) . xyz ;".split(" ")}]},{type:"node_elif",expression:["CONVERT_TYPE","VT_OBJECT_TO_WORLD",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"Bm = ( ys * yL ) . xyz ;".split(" ")}]},{type:"node_elif",expression:["CONVERT_TYPE","VT_OBJECT_TO_CAMERA",{type:"equal_expr",places:2}],statements:[{type:"textline",
tokens:"Bm = ( yq * ys * yL ) . xyz ;".split(" ")}]},{type:"node_elif",expression:["CONVERT_TYPE","VT_CAMERA_TO_WORLD",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"Bm = ( yr * yL ) . xyz ;".split(" ")}]},{type:"node_elif",expression:["CONVERT_TYPE","VT_CAMERA_TO_OBJECT",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"Bm = ( yt * yr * yL ) . xyz ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["VECTOR_TYPE","VT_NORMAL",{type:"equal_expr",
places:2}],statements:[{type:"textline",tokens:"Bm = normalize ( Bm ) ;".split(" ")}]}]}]}]}]},{type:"node",name:"BLACKBODY",declarations:[{type:"node_in",name:"Bn",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Bo",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"Bo [ 0 ] = Bo [ 1 ] = Bo [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["Bn",";"]}]},{type:"node",name:"WAVELENGTH",declarations:[{type:"node_in",name:"Bp",qualifier:["float"],is_optional:!1},
{type:"node_out",name:"Bq",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"Bq [ 0 ] = Bq [ 1 ] = Bq [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["Bp",";"]}]},{type:"node",name:"SEPXYZ",declarations:[{type:"node_in",name:"Br",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Bs",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Bt",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Bu",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",
tokens:"Bs = Br [ 0 ] ; Bt = Br [ 1 ] ; Bu = Br [ 2 ] ;".split(" ")}]},{type:"node",name:"COMBXYZ",declarations:[{type:"node_in",name:"Bv",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Bw",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Bx",qualifier:["float"],is_optional:!1},{type:"node_out",name:"By",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"By [ 0 ] = Bv ; By [ 1 ] = Bw ; By [ 2 ] = Bx ;".split(" ")}]},{type:"node",name:"BRIGHTCONTRAST",declarations:[{type:"node_in",
name:"Bz",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"BA",qualifier:["float"],is_optional:!1},{type:"node_in",name:"BB",qualifier:["float"],is_optional:!1},{type:"node_out",name:"BC",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yF = BA - BB * xS ; BC = max ( ( UNITY_VALUE_NODES + BB ) * Bz + yF , vec3 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},{type:"node",name:"LIGHT_FALLOFF",declarations:[{type:"node_in",name:"BD",qualifier:["float"],is_optional:!1},{type:"node_in",
name:"BE",qualifier:["float"],is_optional:!1},{type:"node_out",name:"BF",qualifier:["float"],is_optional:!1},{type:"node_out",name:"BG",qualifier:["float"],is_optional:!1},{type:"node_out",name:"BH",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"BF = BG = BH = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["BD",";","BE",";"]}]},{type:"node",name:"TEX_IMAGE",declarations:[{type:"node_in",name:"BI",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"BJ",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"BK",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"BJ [ 0 ] = BJ [ 1 ] = BJ [ 2 ] = ZERO_VALUE_NODES ; BK = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["BI",";"]}]},{type:"node",name:"TEX_ENVIRONMENT",declarations:[{type:"node_in",name:"BL",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"BM",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"BM [ 0 ] = BM [ 1 ] = BM [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",tokens:["BL",";"]}]},{type:"node",name:"TEX_SKY",declarations:[{type:"node_in",name:"BN",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"BO",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"BO [ 0 ] = BO [ 1 ] = BO [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["BN",";"]}]},{type:"node",name:"TEX_NOISE",declarations:[{type:"node_in",name:"BP",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"BQ",qualifier:["float"],is_optional:!1},
{type:"node_in",name:"BR",qualifier:["float"],is_optional:!1},{type:"node_in",name:"BS",qualifier:["float"],is_optional:!1},{type:"node_out",name:"BT",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"BU",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"BT [ 0 ] = BT [ 1 ] = BT [ 2 ] = ZERO_VALUE_NODES ; BU = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"BP ; BQ ; BR ; BS ;".split(" ")}]},{type:"node",name:"TEX_WAVE",declarations:[{type:"node_in",name:"BV",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"BW",qualifier:["float"],is_optional:!1},{type:"node_in",name:"BX",qualifier:["float"],is_optional:!1},{type:"node_in",name:"BY",qualifier:["float"],is_optional:!1},{type:"node_in",name:"BZ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"B_",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Ca",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"B_ [ 0 ] = B_ [ 1 ] = B_ [ 2 ] = ZERO_VALUE_NODES ; Ca = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",tokens:"BV ; BW ; BX ; BY ; BZ ;".split(" ")}]},{type:"node",name:"TEX_VORONOI",declarations:[{type:"node_in",name:"Cb",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Cc",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Cd",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Ce",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Cd [ 0 ] = Cd [ 1 ] = Cd [ 2 ] = ZERO_VALUE_NODES ; Ce = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",
tokens:["Cb",";","Cc",";"]}]},{type:"node",name:"TEX_MUSGRAVE",declarations:[{type:"node_in",name:"Cf",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Cg",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ch",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ci",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Cj",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ck",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Cl",qualifier:["float"],is_optional:!1},
{type:"node_out",name:"Cm",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Cn",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Cm [ 0 ] = Cm [ 1 ] = Cm [ 2 ] = ZERO_VALUE_NODES ; Cn = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"Cf ; Cg ; Ch ; Ci ; Cj ; Ck ; Cl ;".split(" ")}]},{type:"node",name:"TEX_GRADIENT",declarations:[{type:"node_in",name:"Co",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Cp",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"Cq",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Cp [ 0 ] = Cp [ 1 ] = Cp [ 2 ] = ZERO_VALUE_NODES ; Cq = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["Co",";"]}]},{type:"node",name:"TEX_MAGIC",declarations:[{type:"node_in",name:"Cr",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Cs",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ct",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Cu",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"Cv",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Cu [ 0 ] = Cu [ 1 ] = Cu [ 2 ] = ZERO_VALUE_NODES ; Cv = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"Cr ; Cs ; Ct ;".split(" ")}]},{type:"node",name:"TEX_CHECKER",declarations:[{type:"node_in",name:"Cw",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Cx",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Cy",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Cz",
qualifier:["float"],is_optional:!1},{type:"node_out",name:"CA",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"CB",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"CA [ 0 ] = CA [ 1 ] = CA [ 2 ] = ZERO_VALUE_NODES ; CB = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"Cw ; Cx ; Cy ; Cz ;".split(" ")}]},{type:"node",name:"TEX_BRICK",declarations:[{type:"node_in",name:"CC",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"CD",qualifier:["vec3"],is_optional:!1},
{type:"node_in",name:"CE",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"CF",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"CG",qualifier:["float"],is_optional:!1},{type:"node_in",name:"CH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"CI",qualifier:["float"],is_optional:!1},{type:"node_in",name:"CJ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"CK",qualifier:["float"],is_optional:!1},{type:"node_out",name:"CL",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"CM",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"CL [ 0 ] = CL [ 1 ] = CL [ 2 ] = ZERO_VALUE_NODES ; CM = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"CC ; CD ; CE ; CF ; CG ; CH ; CI ; CJ ; CK ;".split(" ")}]},{type:"node",name:"ADD_SHADER",declarations:[{type:"node_in",name:"CN",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"CO",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"CP",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"CP = clamp ( CN + CO , vec3 ( ZERO_VALUE_NODES ) , vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")}]},{type:"node",name:"MIX_SHADER",declarations:[{type:"node_in",name:"CQ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"CR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"CS",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"CT",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yF = clamp ( CQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; CT = yF * CR + ( UNITY_VALUE_NODES - yF ) * CS ;".split(" ")}]},
{type:"node",name:"UV_MERGED",declarations:[{type:"node_out",name:"CU",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"CV",qualifier:["vec3"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_CU"],statements:[{type:"textline",tokens:"CU = yc ( bM ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_CV"],statements:[{type:"textline",tokens:"CV = vec3 ( bM , ZERO_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"TEX_COORD_UV",declarations:[{type:"node_out",name:"CW",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"CW = vec3 ( bM , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_NO",declarations:[{type:"node_out",name:"CX",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["CX","=","yP",";"]}]},{type:"node",name:"TEX_COORD_GE",declarations:[{type:"node_out",name:"CY",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"CY = vec3 ( bM , ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"TEX_COORD_OB",declarations:[{type:"node_out",name:"CZ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"CZ [ 0 ] = CZ [ 1 ] = CZ [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_CA",declarations:[{type:"node_out",name:"C_",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"C_ [ 0 ] = yK [ 0 ] ; C_ [ 1 ] = yK [ 1 ] ; C_ [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_WI",declarations:[{type:"node_out",
name:"Da",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"Da [ 0 ] = Da [ 1 ] = Da [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_RE",declarations:[{type:"node_out",name:"Db",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"Db [ 0 ] = Db [ 1 ] = Db [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"UVMAP",declarations:[{type:"node_out",name:"Dc",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"Dc = vec3 ( bM , ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"PARTICLE_INFO",declarations:[{type:"node_out",name:"Dd",qualifier:["float"],is_optional:!1},{type:"node_out",name:"De",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Df",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Dg",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Dh",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Di",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Dj",qualifier:["vec3"],is_optional:!1},{type:"node_param",
name:"yg",qualifier:["varying","vec4"],is_optional:!0},{type:"node_param",name:"yh",qualifier:["varying","vec3"],is_optional:!0},{type:"node_param",name:"yi",qualifier:["varying","vec3"],is_optional:!0},{type:"node_param",name:"yj",qualifier:["varying","vec3"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["PARTICLE_BATCH"],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Dd"],statements:[{type:"textline",tokens:"Dd = yg [ 0 ] ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_De"],statements:[{type:"textline",tokens:"De = yg [ 1 ] ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Df"],statements:[{type:"textline",tokens:"Df = yg [ 2 ] ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Dg"],statements:[{type:"textline",tokens:"Dg = vec3 ( yh . r , - yh . b , yh . g ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Dh"],
statements:[{type:"textline",tokens:"Dh = yg [ 3 ] ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Di"],statements:[{type:"textline",tokens:"Di = vec3 ( yi . r , - yi . b , yi . g ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Dj"],statements:[{type:"textline",tokens:"Dj = vec3 ( yj . r , - yj . b , yj . g ) ;".split(" ")}]}]}]},{type:"node_else",statements:[{type:"textline",tokens:"Dd = ZERO_VALUE_NODES ; De = ZERO_VALUE_NODES ; Df = ZERO_VALUE_NODES ; Dg = vec3 ( ZERO_VALUE_NODES ) ; Dh = ZERO_VALUE_NODES ; Di = Dg ; Dj = Dg ;".split(" ")}]}]}]},
{type:"node",name:"HAIR_INFO",declarations:[{type:"node_out",name:"Dk",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Dl",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Dm",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Dn",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"Dk = ZERO_VALUE_NODES ; Dl = ZERO_VALUE_NODES ; Dm = ZERO_VALUE_NODES ; Dn = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"OBJECT_INFO",declarations:[{type:"node_out",
name:"Do",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Dp",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Dq",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Dr",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Dp = ZERO_VALUE_NODES ; Dq = ZERO_VALUE_NODES ; Dr = ZERO_VALUE_NODES ; Do = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"WIREFRAME",declarations:[{type:"node_in",name:"Ds",qualifier:["float"],is_optional:!1},{type:"node_out",
name:"Dt",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:["Dt","=","Ds",";"]}]},{type:"node",name:"TANGENT",declarations:[{type:"node_out",name:"Du",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"Du = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LAYER_WEIGHT",declarations:[{type:"node_in",name:"Dv",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Dw",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Dx",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"Dy",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Dx = Dy = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["Dw",";","Dv",";"]}]},{type:"node",name:"LIGHT_PATH",declarations:[{type:"node_out",name:"Dz",qualifier:["float"],is_optional:!1},{type:"node_out",name:"DA",qualifier:["float"],is_optional:!1},{type:"node_out",name:"DB",qualifier:["float"],is_optional:!1},{type:"node_out",name:"DC",qualifier:["float"],is_optional:!1},
{type:"node_out",name:"DD",qualifier:["float"],is_optional:!1},{type:"node_out",name:"DE",qualifier:["float"],is_optional:!1},{type:"node_out",name:"DF",qualifier:["float"],is_optional:!1},{type:"node_out",name:"DG",qualifier:["float"],is_optional:!1},{type:"node_out",name:"DH",qualifier:["float"],is_optional:!1},{type:"node_out",name:"DI",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Dz = DA = DB = ZERO_VALUE_NODES ; DC = DD = DE = ZERO_VALUE_NODES ; DF = DF = DH = DI = ZERO_VALUE_NODES ; DG = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"ATTRIBUTE",declarations:[{type:"node_out",name:"DJ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"DK",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"DL",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"DJ = DK = vec3 ( ZERO_VALUE_NODES ) ; DL = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"SCRIPT",declarations:[],statements:[]},{type:"node",name:"CURVE_VEC",declarations:[{type:"node_in",name:"DM",qualifier:["float"],is_optional:!1},
{type:"node_in",name:"DN",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"DO",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["DO","=","DN",";"]},{type:"node_condition",parts:[{type:"node_if",expression:["READ_R"],statements:[{type:"textline",tokens:"DO . r = ( texture2D ( u_nodes_texture , vec2 ( 0.5 * DN . r + 0.5 , NODE_TEX_ROW ) ) . r - 0.5 ) * 2.0 ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["READ_G"],statements:[{type:"textline",
tokens:"DO . g = ( texture2D ( u_nodes_texture , vec2 ( 0.5 * DN . g + 0.5 , NODE_TEX_ROW ) ) . g - 0.5 ) * 2.0 ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["READ_B"],statements:[{type:"textline",tokens:"DO . b = ( texture2D ( u_nodes_texture , vec2 ( 0.5 * DN . b + 0.5 , NODE_TEX_ROW ) ) . b - 0.5 ) * 2.0 ;".split(" ")}]}]},{type:"textline",tokens:"DO = mix ( DN , DO , DM ) ;".split(" ")}]},{type:"node",name:"CURVE_RGB",declarations:[{type:"node_in",name:"DP",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"DQ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"DR",qualifier:["vec3"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["READ_A"],statements:[{type:"textline",tokens:"yF = texture2D ( u_nodes_texture , vec2 ( DQ . r , NODE_TEX_ROW ) ) . a ; yE = texture2D ( u_nodes_texture , vec2 ( DQ . g , NODE_TEX_ROW ) ) . a ; yD = texture2D ( u_nodes_texture , vec2 ( DQ . b , NODE_TEX_ROW ) ) . a ;".split(" ")}]},{type:"node_else",
statements:[{type:"textline",tokens:"yF = DQ . r ; yE = DQ . g ; yD = DQ . b ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["READ_R"],statements:[{type:"textline",tokens:"DR . r = texture2D ( u_nodes_texture , vec2 ( yF , NODE_TEX_ROW ) ) . r ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"DR . r = yF ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["READ_G"],statements:[{type:"textline",tokens:"DR . g = texture2D ( u_nodes_texture , vec2 ( yE , NODE_TEX_ROW ) ) . g ;".split(" ")}]},
{type:"node_else",statements:[{type:"textline",tokens:"DR . g = yE ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["READ_B"],statements:[{type:"textline",tokens:"DR . b = texture2D ( u_nodes_texture , vec2 ( yD , NODE_TEX_ROW ) ) . b ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"DR . b = yD ;".split(" ")}]}]},{type:"textline",tokens:"DR = mix ( DQ , DR , DP ) ;".split(" ")}]},{type:"node",name:"VALTORGB",declarations:[{type:"node_in",name:"DS",
qualifier:["float"],is_optional:!1},{type:"node_out",name:"DT",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"DU",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"yL = texture2D ( u_nodes_texture , vec2 ( DS , NODE_TEX_ROW ) ) ; DT = yL . rgb ; DU = yL . a ;".split(" ")}]},{type:"node",name:"MAPPING",declarations:[{type:"node_in",name:"DV",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"DW",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:["DW","=","DV",";"]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",statements:[{type:"textline",tokens:"DW = ( MAPPING_TRS_MATRIX * vec4 ( DW , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_SCALE",statements:[{type:"textline",tokens:"DW = DW * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",statements:[{type:"textline",tokens:"DW = DW + MAPPING_TRANSLATION ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",statements:[{type:"textline",tokens:"DW = max ( DW , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",statements:[{type:"textline",tokens:"DW = min ( DW , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["MAPPING_IS_NORMAL"],statements:[{type:"textline",tokens:"DW = normalize ( DW ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",
declarations:[{type:"node_in",name:"DX",qualifier:["float"],is_optional:!1},{type:"node_in",name:"DY",qualifier:["float"],is_optional:!1},{type:"node_out",name:"DZ",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"DZ = DX + DY ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"DZ = clamp ( DZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",declarations:[{type:"node_in",
name:"D_",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ea",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Eb",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Eb = D_ - Ea ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"Eb = clamp ( Eb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MULTIPLY",declarations:[{type:"node_in",name:"Ec",
qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ed",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Ee",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Ee = Ec * Ed ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"Ee = clamp ( Ee , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",declarations:[{type:"node_in",name:"Ef",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"Eg",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Eh",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Eh = ( Eg != ZERO_VALUE_NODES ) ? Ef / Eg : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"Eh = clamp ( Eh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SINE",declarations:[{type:"node_in",
name:"Ei",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ej",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Ek",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Ek = sin ( Ei ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"Ek = clamp ( Ek , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["Ej",";"]}]},{type:"node",name:"MATH_COSINE",declarations:[{type:"node_in",
name:"El",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Em",qualifier:["float"],is_optional:!1},{type:"node_out",name:"En",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"En = cos ( El ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"En = clamp ( En , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["Em",";"]}]},{type:"node",name:"MATH_TANGENT",declarations:[{type:"node_in",
name:"Eo",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ep",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Eq",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Eq = tan ( Eo ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"Eq = clamp ( Eq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["Ep",";"]}]},{type:"node",name:"MATH_ARCSINE",declarations:[{type:"node_in",
name:"Er",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Es",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Et",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Et = ( Er <= UNITY_VALUE_NODES && Er >= - UNITY_VALUE_NODES ) ? asin ( Er ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"Et = clamp ( Et , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",tokens:["Es",";"]}]},{type:"node",name:"MATH_ARCCOSINE",declarations:[{type:"node_in",name:"Eu",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ev",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Ew",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Ew = ( Eu <= UNITY_VALUE_NODES && Eu >= - UNITY_VALUE_NODES ) ? acos ( Eu ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",
tokens:"Ew = clamp ( Ew , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["Ev",";"]}]},{type:"node",name:"MATH_ARCTANGENT",declarations:[{type:"node_in",name:"Ex",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ey",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Ez",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Ez = atan ( Ex ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],
statements:[{type:"textline",tokens:"Ez = clamp ( Ez , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["Ey",";"]}]},{type:"node",name:"MATH_POWER",declarations:[{type:"node_in",name:"EA",qualifier:["float"],is_optional:!1},{type:"node_in",name:"EB",qualifier:["float"],is_optional:!1},{type:"node_out",name:"EC",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"if ( EA < ZERO_VALUE_NODES && EB != floor ( EB ) ) EC = ZERO_VALUE_NODES ; else if ( EB == ZERO_VALUE_NODES )".split(" ")},
{type:"textline",tokens:"EC = UNITY_VALUE_NODES ; else if ( EA < ZERO_VALUE_NODES ) EC = mix ( UNITY_VALUE_NODES , - UNITY_VALUE_NODES , sign ( mod ( - EB , 2.0 ) ) ) * pow ( - EA , EB ) ; else if ( EA == ZERO_VALUE_NODES ) EC = ZERO_VALUE_NODES ; else EC = pow ( EA , EB ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"EC = clamp ( EC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",
declarations:[{type:"node_in",name:"ED",qualifier:["float"],is_optional:!1},{type:"node_in",name:"EE",qualifier:["float"],is_optional:!1},{type:"node_out",name:"EF",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"EF = ( ED > ZERO_VALUE_NODES && EE > ZERO_VALUE_NODES ) ? log2 ( ED ) / log2 ( EE ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"EF = clamp ( EF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MINIMUM",declarations:[{type:"node_in",name:"EG",qualifier:["float"],is_optional:!1},{type:"node_in",name:"EH",qualifier:["float"],is_optional:!1},{type:"node_out",name:"EI",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"EI = min ( EG , EH ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"EI = clamp ( EI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_MAXIMUM",declarations:[{type:"node_in",name:"EJ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"EK",qualifier:["float"],is_optional:!1},{type:"node_out",name:"EL",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"EL = max ( EJ , EK ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"EL = clamp ( EL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",
declarations:[{type:"node_in",name:"EM",qualifier:["float"],is_optional:!1},{type:"node_in",name:"EN",qualifier:["float"],is_optional:!1},{type:"node_out",name:"EO",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"EO = floor ( EM + xS ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"EO = clamp ( EO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["EN",";"]}]},
{type:"node",name:"MATH_LESS_THAN",declarations:[{type:"node_in",name:"EP",qualifier:["float"],is_optional:!1},{type:"node_in",name:"EQ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ER",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ER = ( EP < EQ ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"ER = clamp ( ER , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_GREATER_THAN",declarations:[{type:"node_in",name:"ES",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ET",qualifier:["float"],is_optional:!1},{type:"node_out",name:"EU",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"EU = ( ES > ET ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"EU = clamp ( EU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MODULO",declarations:[{type:"node_in",name:"EV",qualifier:["float"],is_optional:!1},{type:"node_in",name:"EW",qualifier:["float"],is_optional:!1},{type:"node_out",name:"EX",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"EX = abs ( EW ) > 0.000001 ? mod ( EV , EW ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"EX = clamp ( EX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_ABSOLUTE",declarations:[{type:"node_in",name:"EY",qualifier:["float"],is_optional:!1},{type:"node_in",name:"EZ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"E_",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"E_ = abs ( EY ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"E_ = clamp ( E_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",
tokens:["EZ",";"]}]},{type:"node",name:"MIX_RGB_MIX",declarations:[{type:"node_in",name:"Fa",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Fb",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Fc",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Fd",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yD = clamp ( Fa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; Fd = mix ( Fb , Fc , yD ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],
statements:[{type:"textline",tokens:"Fd = clamp ( Fd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_ADD",declarations:[{type:"node_in",name:"Fe",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ff",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Fg",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Fh",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yD = clamp ( Fe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; Fh = mix ( Ff , Ff + Fg , yD ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"Fh = clamp ( Fh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_MULTIPLY",declarations:[{type:"node_in",name:"Fi",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Fj",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Fk",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Fl",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"yD = clamp ( Fi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; Fl = mix ( Fj , Fj * Fk , yD ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"Fl = clamp ( Fl , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SUBTRACT",declarations:[{type:"node_in",name:"Fm",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Fn",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Fo",
qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Fp",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yD = clamp ( Fm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; Fp = mix ( Fn , Fn - Fo , yD ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"Fp = clamp ( Fp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SCREEN",declarations:[{type:"node_in",name:"Fq",
qualifier:["float"],is_optional:!1},{type:"node_in",name:"Fr",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Fs",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Ft",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yD = clamp ( Fq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yE = UNITY_VALUE_NODES - yD ; Ft = vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( yE ) + yD * ( vec3 ( UNITY_VALUE_NODES ) - Fs ) ) * ( vec3 ( UNITY_VALUE_NODES ) - Fr ) ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"Ft = clamp ( Ft , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",declarations:[{type:"node_in",name:"Fu",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Fv",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Fw",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Fx",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yD = clamp ( Fu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yE = UNITY_VALUE_NODES - yD ; Fw += step ( Fw , vec3 ( ZERO_VALUE_NODES ) ) ; Fx = yE * Fv + yD * Fv / Fw ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"Fx = clamp ( Fx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",declarations:[{type:"node_in",name:"Fy",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Fz",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"FA",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"FB",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"yD = clamp ( Fy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; FB = mix ( Fz , abs ( Fz - FA ) , yD ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"FB = clamp ( FB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",declarations:[{type:"node_in",name:"FC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"FD",qualifier:["vec3"],is_optional:!1},{type:"node_in",
name:"FE",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"FF",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yD = clamp ( FC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; FF = min ( FD . rgb , FE . rgb * yD ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"FF = clamp ( FF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",declarations:[{type:"node_in",
name:"FG",qualifier:["float"],is_optional:!1},{type:"node_in",name:"FH",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"FI",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"FJ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yD = clamp ( FG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; FJ = max ( FH . rgb , FI . rgb * yD ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"FJ = clamp ( FJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_OVERLAY",declarations:[{type:"node_in",name:"FK",qualifier:["float"],is_optional:!1},{type:"node_in",name:"FL",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"FM",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"FN",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yD = clamp ( FK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yR = vec3 ( UNITY_VALUE_NODES - yD ) ; FN = mix ( FL * ( yR + 2.0 * yD * FM ) , vec3 ( UNITY_VALUE_NODES ) - ( yR + 2.0 * yD * ( vec3 ( UNITY_VALUE_NODES ) - FM ) ) * ( vec3 ( UNITY_VALUE_NODES ) - FL ) , step ( xS , FL ) ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"FN = clamp ( FN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",declarations:[{type:"node_in",name:"FO",qualifier:["float"],is_optional:!1},{type:"node_in",name:"FP",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"FQ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"FR",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"yD = clamp ( FO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yR = vec3 ( UNITY_VALUE_NODES ) - yD * FQ ; yQ = clamp ( FP / yR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; FR = mix ( mix ( yQ , vec3 ( UNITY_VALUE_NODES ) , step ( yR , vec3 ( ZERO_VALUE_NODES ) ) ) , FP , step ( FP , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"FR = clamp ( FR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_BURN",declarations:[{type:"node_in",name:"FS",qualifier:["float"],is_optional:!1},{type:"node_in",name:"FT",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"FU",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"FV",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yD = clamp ( FS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yR = vec3 ( UNITY_VALUE_NODES - yD ) ; yR = yR + yD * FU ; yQ = clamp ( vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( UNITY_VALUE_NODES ) - FT ) / yR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; FV = mix ( yQ , vec3 ( ZERO_VALUE_NODES ) , step ( yR , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"FV = clamp ( FV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",declarations:[{type:"node_in",name:"FW",qualifier:["float"],is_optional:!1},{type:"node_in",name:"FX",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"FY",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"FZ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"yD = clamp ( FW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; FZ = FX ; yQ = xX ( FY ) ; if ( yQ . y != ZERO_VALUE_NODES ) { yR = xX ( FZ ) ; yR . x = yQ . x ; yS = ya ( yR ) ; FZ = mix ( FZ , yS , yD ) ; }".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"FZ = clamp ( FZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",declarations:[{type:"node_in",name:"F_",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"Ga",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Gb",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Gc",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yD = clamp ( F_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yE = UNITY_VALUE_NODES - yD ; Gc = Ga ; yS = xX ( Gc ) ; if ( yS . y != ZERO_VALUE_NODES ) { yR = xX ( Gb ) ; yS . y = yE * yS . y + yD * yR . y ; Gc = ya ( yS ) ; }".split(" ")},{type:"node_condition",parts:[{type:"node_if",
expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"Gc = clamp ( Gc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",declarations:[{type:"node_in",name:"Gd",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ge",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Gf",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Gg",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yD = clamp ( Gd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yE = UNITY_VALUE_NODES - yD ; yS = xX ( Ge ) ; yR = xX ( Gf ) ; yS . z = yE * yS . z + yD * yR . z ; Gg = ya ( yS ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"Gg = clamp ( Gg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",declarations:[{type:"node_in",name:"Gh",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Gi",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Gj",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Gk",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"yD = clamp ( Gh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; Gk = Gi ; yR = xX ( Gj ) ; if ( yR . y != ZERO_VALUE_NODES ) { yS = xX ( Gk ) ; yS . x = yR . x ; yS . y = yR . y ; yQ = ya ( yS ) ; Gk = mix ( Gk , yQ , yD ) ; }".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"Gk = clamp ( Gk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",declarations:[{type:"node_in",
name:"Gl",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Gm",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Gn",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Go",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yD = clamp ( Gl , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yE = UNITY_VALUE_NODES - yD ; yQ = Gn + Gm - Gn * Gm ; Go = Gm * ( vec3 ( yE ) + vec3 ( yD ) * ( ( vec3 ( UNITY_VALUE_NODES ) - Gm ) * Gn + yQ ) ) ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"Go = clamp ( Go , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",declarations:[{type:"node_in",name:"Gp",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Gq",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Gr",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Gs",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"yD = clamp ( Gp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; Gs = Gq + yD * ( 2.0 * Gr - vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"Gs = clamp ( Gs , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",declarations:[{type:"node_in",name:"Gt",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Gu",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",
tokens:"yu = Gt ; yy = Gu ;".split(" ")}]},{type:"node",name:"MATERIAL_BEGIN",declarations:[{type:"node_in",name:"Gv",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Gw",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Gx",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Gy",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"Gz",qualifier:["float"],is_optional:!0},{type:"node_out",name:"GA",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"GB",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"GC",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"GD",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"GE",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"GF",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"GG",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"GH",qualifier:["vec4"],is_optional:!1},{type:"node_param",name:"yk",qualifier:["const","vec2"],is_optional:!0},{type:"node_param",name:"yl",qualifier:["const",
"vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"GC = clamp ( Gv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",tokens:"GD = yl [ 0 ] * clamp ( Gw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_NORMAL"],statements:[{type:"textline",tokens:"GE = normalize ( Gy ) ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:["GE","=","yP",";"]}]}]},{type:"node_condition",
parts:[{type:"node_if",expression:["SHADELESS_MAT",{type:"logic_negative_expr",places:1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["MATERIAL_EXT"],statements:[{type:"textline",tokens:"GA = Gz * GC ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"GA = yB * GC ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_DIFFUSE"],statements:[{type:"textline",tokens:["GC","*=","Gx",";"]}]}]},{type:"textline",tokens:"GB = yC * u_environment_energy * dS ( GE ) ; GH = vec4 ( 1.0 ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],statements:[{type:"textline",tokens:"GF = vec2 ( yk [ 0 ] , yk [ 1 ] ) ;".split(" ")},{type:"textline",tokens:"GG = vec2 ( yl [ 1 ] , yl [ 2 ] ) ;".split(" ")}]}]},{type:"textline",tokens:["yx","=","GH",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:"GA = vec3 ( ZERO_VALUE_NODES ) ; GB = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATERIAL_END",declarations:[{type:"node_in",
name:"GI",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"GJ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"GK",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"GL",qualifier:["float"],is_optional:!0},{type:"node_in",name:"GM",qualifier:["float"],is_optional:!0},{type:"node_in",name:"GN",qualifier:["float"],is_optional:!0},{type:"node_out",name:"GO",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"GP",qualifier:["float"],is_optional:!0},{type:"node_out",name:"GQ",
qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"GR",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"GS",qualifier:["vec3"],is_optional:!0},{type:"node_param",name:"ym",qualifier:["float"],is_optional:!1},{type:"node_param",name:"yn",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:["GL",";"]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_GO"],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_DIFFUSE"],
statements:[{type:"textline",tokens:"GO = GI . rgb ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"GO = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",tokens:["GO","+=","GJ",";"]}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_GQ"],statements:[{type:"textline",tokens:["GQ","=","GK",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",
expression:["MATERIAL_EXT"],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_GR"],statements:[{type:"textline",tokens:"GR = GI . rgb ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_GS"],statements:[{type:"textline",tokens:["GS","=","GJ",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_GP"],statements:[{type:"textline",tokens:"GP = clamp ( GN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",tokens:"yD = max ( max ( GJ . r , GJ . g ) , GJ . b ) * GM ; GP = clamp ( GN * ( UNITY_VALUE_NODES - yD ) + yD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]}]},{type:"node_else",statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_GP"],statements:[{type:"textline",tokens:"GP = clamp ( ym , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",
expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",tokens:"yD = max ( max ( GJ . r , GJ . g ) , GJ . b ) * yn ; GP = ym * ( UNITY_VALUE_NODES - yD ) + yD ;".split(" ")}]}]}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",tokens:["yv","=","GJ",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:"yv = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["yw","=","GK",";"]}]},{type:"node",
name:"LIGHTING_AMBIENT",declarations:[{type:"node_in",name:"GT",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"GU",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"GV",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"GW",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"GX",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"GW = vec4 ( GT + GV * GU , ZERO_VALUE_NODES ) ; GX = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",
declarations:[{type:"node_in",name:"GY",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"GZ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"G_",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"Ha",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Hb",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"G_ = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE",
"HEMI",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:["Hb","=","xS",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:["Hb","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",tokens:"Ha = u_light_color_intensities [ LAMP_IND ] ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_SHADOW_MAP_IND",1,{type:"negative_expr",places:1},{type:"non_equal_expr",places:2}],statements:[{type:"textline",tokens:"Ha *= GY [ LAMP_SHADOW_MAP_IND ] ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","SPOT",{type:"equal_expr",places:2},"LAMP_TYPE","POINT",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],statements:[{type:"textline",tokens:"yQ = u_light_positions [ LAMP_IND ] ; GZ = yQ - yO ;".split(" ")},{type:"textline",tokens:"yD = length ( GZ ) ; Ha *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + yD * yD ) ; GZ = normalize ( GZ ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE",
"SPOT",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"yQ = u_light_directions [ LAMP_IND ] ; yD = dot ( GZ , yQ ) ; yD *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( yD - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; Ha *= yD ;".split(" ")}]}]}]},{type:"node_else",statements:[{type:"textline",tokens:"GZ = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",declarations:[{type:"node_in",name:"Hc",qualifier:["vec3"],is_optional:!1},{type:"node_in",
name:"Hd",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"He",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Hf",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Hg",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"Hh",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Hh = ZERO_VALUE_NODES ; if ( Hd . r != ZERO_VALUE_NODES ) { yD = ( UNITY_VALUE_NODES - Hf ) * dot ( He , Hc ) + Hf ; if ( Hg [ 0 ] == ZERO_VALUE_NODES ) { Hh = UNITY_VALUE_NODES ; } else { yD = UNITY_VALUE_NODES + abs ( yD ) ; yD = Hg [ 1 ] + ( UNITY_VALUE_NODES - Hg [ 1 ] ) * pow ( yD , Hg [ 0 ] ) ; Hh = clamp ( yD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } Hh = max ( Hh , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_LAMBERT",declarations:[{type:"node_in",name:"Hi",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Hj",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"Hk",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Hl",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Hm",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Hm = ZERO_VALUE_NODES ; if ( Hj . r != ZERO_VALUE_NODES ) { yD = ( UNITY_VALUE_NODES - Hl ) * dot ( Hk , Hi ) + Hl ; Hm = max ( yD , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_OREN_NAYAR",declarations:[{type:"node_in",name:"Hn",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Ho",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"Hp",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Hq",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Hr",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"Hs",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Hs = ZERO_VALUE_NODES ; if ( Ho . r != ZERO_VALUE_NODES ) { yD = ( UNITY_VALUE_NODES - Hq ) * dot ( Hp , Hn ) + Hq ; if ( Hr [ 0 ] > ZERO_VALUE_NODES ) { yE = max ( dot ( Hp , yo ) , ZERO_VALUE_NODES ) ; yF = Hr [ 0 ] * Hr [ 0 ] ; yG = UNITY_VALUE_NODES - xS * ( yF / ( yF + 0.33 ) ) ; yQ = Hn - yD * Hp ; yS = yo - yE * Hp ;".split(" ")},
{type:"textline",tokens:"if ( length ( yQ ) == ZERO_VALUE_NODES || length ( yS ) == ZERO_VALUE_NODES || abs ( yD ) > UNITY_VALUE_NODES || abs ( yE ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",tokens:"Hs = yD * yG ; else { yH = acos ( yD ) ; yE = acos ( yE ) ; yQ = normalize ( yQ ) ; yS = normalize ( yS ) ; yI = max ( yH , yE ) ; yJ = min ( yH , yE ) ; yJ *= 0.95 ; yE = max ( dot ( yQ , yS ) , ZERO_VALUE_NODES ) ; yF = 0.45 * ( yF / ( yF + 0.09 ) ) ; Hs = yD * ( yG + ( yF * yE * sin ( yI ) * tan ( yJ ) ) ) ; } } else Hs = yD ; Hs = max ( Hs , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",declarations:[{type:"node_in",name:"Ht",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Hu",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"Hv",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Hw",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Hx",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"Hy",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Hy = ZERO_VALUE_NODES ; if ( Hu . r != ZERO_VALUE_NODES ) { yD = ( UNITY_VALUE_NODES - Hw ) * dot ( Hv , Ht ) + Hw ; yJ = max ( dot ( Hv , yo ) , ZERO_VALUE_NODES ) ; if ( Hx [ 0 ] <= UNITY_VALUE_NODES ) Hy = yD * pow ( max ( yJ * yD , 0.1 ) , Hx [ 0 ] - UNITY_VALUE_NODES ) ; else Hy = yD * pow ( 1.0001 - yJ , Hx [ 0 ] - UNITY_VALUE_NODES ) ; Hy = max ( Hy , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",declarations:[{type:"node_in",name:"Hz",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"HA",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"HB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"HC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"HD",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"HE",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"HE = ZERO_VALUE_NODES ; if ( HA . r != ZERO_VALUE_NODES ) { yJ = ( UNITY_VALUE_NODES - HC ) * dot ( HB , Hz ) + HC ; yJ = acos ( yJ ) ; if ( yJ < HD [ 0 ] ) HE = UNITY_VALUE_NODES ; else if ( yJ > ( HD [ 0 ] + HD [ 1 ] ) || HD [ 1 ] == ZERO_VALUE_NODES ) HE = ZERO_VALUE_NODES ; else HE = UNITY_VALUE_NODES - ( ( yJ - HD [ 0 ] ) / HD [ 1 ] ) ; HE = max ( HE , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",declarations:[{type:"node_in",name:"HF",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"HG",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"HH",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"HI",qualifier:["float"],is_optional:!1},{type:"node_in",name:"HJ",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"HK",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"HK = ZERO_VALUE_NODES ; if ( HG . g == UNITY_VALUE_NODES ) { yS = normalize ( HF + yo ) ; HK = ( UNITY_VALUE_NODES - HI ) * max ( dot ( HH , yS ) , ZERO_VALUE_NODES ) + HI ; HK = pow ( HK , HJ [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",declarations:[{type:"node_in",name:"HL",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"HM",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"HN",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"HO",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"HP",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"HP = ZERO_VALUE_NODES ; if ( HM . g == UNITY_VALUE_NODES ) { yS = normalize ( HL + yo ) ; yJ = max ( dot ( HN , yS ) , 0.001 ) ;".split(" ")},
{type:"textline",tokens:"yD = max ( dot ( HN , yo ) , 0.01 ) ; yI = max ( dot ( HN , HL ) , 0.01 ) ; yJ = tan ( acos ( yJ ) ) ; yE = max ( HO [ 0 ] , 0.001 ) ; HP = yI * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * yE * yE ) ) * ( exp ( - ( yJ * yJ ) / ( yE * yE ) ) / ( sqrt ( yD * yI ) ) ) ; }".split(" ")}]},{type:"node",name:"SPECULAR_TOON",declarations:[{type:"node_in",name:"HQ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"HR",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"HS",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"HT",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"HU",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"HU = ZERO_VALUE_NODES ; if ( HR . g == UNITY_VALUE_NODES ) { yS = normalize ( HQ + yo ) ; yI = acos ( dot ( yS , HS ) ) ; if ( yI < HT [ 0 ] ) HU = UNITY_VALUE_NODES ; else if ( yI >= HT [ 0 ] + HT [ 1 ] || HT [ 1 ] == ZERO_VALUE_NODES ) HU = ZERO_VALUE_NODES ; else HU = UNITY_VALUE_NODES - ( yI - HT [ 0 ] ) / HT [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",declarations:[{type:"node_in",name:"HV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"HW",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"HX",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"HY",qualifier:["float"],is_optional:!1},{type:"node_in",name:"HZ",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"H_",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"H_ = ZERO_VALUE_NODES ; if ( HW . g == UNITY_VALUE_NODES ) { if ( HZ [ 0 ] < UNITY_VALUE_NODES || HZ [ 1 ] == ZERO_VALUE_NODES ) H_ = ZERO_VALUE_NODES ; else { if ( HZ [ 1 ] < 100.0 ) HZ [ 1 ] = sqrt ( UNITY_VALUE_NODES / HZ [ 1 ] ) ; else HZ [ 1 ] = 10.0 / HZ [ 1 ] ; yS = normalize ( yo + HV ) ; yI = ( UNITY_VALUE_NODES - HY ) * max ( dot ( HX , yS ) , ZERO_VALUE_NODES ) + HY ; if ( yI < ZERO_VALUE_NODES ) H_ = ZERO_VALUE_NODES ; else { yD = max ( dot ( HX , yo ) , 0.01 ) ; yE = dot ( HX , HV ) ; if ( yE <= 0.01 ) H_ = ZERO_VALUE_NODES ; else { yJ = max ( dot ( yo , yS ) , 0.01 ) ; yF = UNITY_VALUE_NODES ; yD = ( 2.0 * yI * yD ) / yJ ; yE = ( 2.0 * yI * yE ) / yJ ; yE = min ( min ( yF , yD ) , yE ) ; yD = sqrt ( pow ( HZ [ 0 ] , 2.0 ) + pow ( yJ , 2.0 ) - UNITY_VALUE_NODES ) ; yJ = pow ( yD - yJ , 2.0 ) / pow ( yD + yJ , 2.0 ) * ( UNITY_VALUE_NODES + pow ( yJ * ( yD + yJ ) - UNITY_VALUE_NODES , 2.0 ) / pow ( yJ * ( yD - yJ ) + UNITY_VALUE_NODES , 2.0 ) ) ; yI = acos ( yI ) ; H_ = max ( yJ * yE * exp ( - pow ( yI , 2.0 ) / ( 2.0 * pow ( HZ [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",declarations:[{type:"node_in",name:"Ia",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"Ib",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Ic",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Id",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ie",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"If",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Ig",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"Ih",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Ii",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Ij",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Ik",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Il",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"Im",qualifier:["vec3"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_NODE_B4W_TRANSLUCENCY"],statements:[{type:"textline",tokens:"if ( dot ( Ie , If ) * dot ( yo , If ) < ZERO_VALUE_NODES ) { yI = Ig . x ; yE = Ig . y ; yJ = Ig . z ; yD = Ig . w ;".split(" ")},
{type:"textline",tokens:"yF = clamp ( abs ( dot ( Ie , If ) ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yG = clamp ( dot ( yo , - Ie ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yE = pow ( yG , yE ) ;".split(" ")},{type:"textline",tokens:"Il = Ia + Ik * vec4 ( Ij * yF * pow ( Ih , vec3 ( yI ) ) , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",tokens:"Il += yJ * mix ( vec4 ( Ih , UNITY_VALUE_NODES ) , vec4 ( UNITY_VALUE_NODES ) , yD ) * Ik * vec4 ( Ij * yF * vec3 ( yE ) , UNITY_VALUE_NODES ) ; Im = Ib ; } else {".split(" ")},
{type:"textline",tokens:"Im = Ib + Ij * Ii * Id ; Il = Ia + vec4 ( Ij * Ih * Ic , Id ) ; }".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"Im = Ib + Ij * Ii * Id ; Il = Ia + vec4 ( Ij * Ih * Ic , Id ) ;".split(" ")}]}]}]},{type:"node",name:"RGB",declarations:[{type:"node_out",name:"In",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"In = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",declarations:[{type:"node_in",name:"Io",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"Ip",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Ip = dot ( Io , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{type:"node",name:"SEPRGB",declarations:[{type:"node_in",name:"Iq",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Ir",qualifier:["float"],is_optional:!0},{type:"node_out",name:"Is",qualifier:["float"],is_optional:!0},{type:"node_out",name:"It",qualifier:["float"],is_optional:!0}],statements:[{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_Ir"],statements:[{type:"textline",tokens:"Ir = Iq . r ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Is"],statements:[{type:"textline",tokens:"Is = Iq . g ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_It"],statements:[{type:"textline",tokens:"It = Iq . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",declarations:[{type:"node_in",name:"Iu",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"Iv",qualifier:["float"],is_optional:!0},{type:"node_out",name:"Iw",qualifier:["float"],is_optional:!0},{type:"node_out",name:"Ix",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"yS = xX ( Iu ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Iv"],statements:[{type:"textline",tokens:"Iv = yS . r ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Iw"],statements:[{type:"textline",tokens:"Iw = yS . g ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Ix"],statements:[{type:"textline",tokens:"Ix = yS . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",declarations:[{type:"node_in",name:"Iy",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Iz",qualifier:["float"],is_optional:!1},{type:"node_in",name:"IA",qualifier:["float"],is_optional:!1},{type:"node_out",name:"IB",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"IB = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( Iy - IA ) * Iz ) ) ;".split(" ")}]},
{type:"node",name:"GAMMA",declarations:[{type:"node_in",name:"IC",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ID",qualifier:["float"],is_optional:!1},{type:"node_out",name:"IE",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"IE = IC ; if ( IE . x > ZERO_VALUE_NODES ) IE . x = pow ( IC . x , ID ) ; if ( IE . y > ZERO_VALUE_NODES ) IE . y = pow ( IC . y , ID ) ; if ( IE . z > ZERO_VALUE_NODES ) IE . z = pow ( IC . z , ID ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",
declarations:[{type:"node_in",name:"IF",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"IG",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"IG = max ( vec3 ( ZERO_VALUE_NODES ) , IF ) ; IG = pow ( IG , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",declarations:[{type:"node_in",name:"IH",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"II",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"II = max ( vec3 ( ZERO_VALUE_NODES ) , IH ) ; II = pow ( II , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},
{type:"node",name:"TEXTURE_EMPTY",declarations:[{type:"node_out",name:"IJ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"IK",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"IL",qualifier:["float"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_IL"],statements:[{type:"textline",tokens:"IJ [ 2 ] = IJ [ 1 ] = IJ [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_IL"],statements:[{type:"textline",
tokens:"IK [ 2 ] = IK [ 1 ] = IK [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_IL"],statements:[{type:"textline",tokens:["IL","=","ZERO_VALUE_NODES",";"]}]}]}]},{type:"node",name:"TEXTURE_ENVIRONMENT",declarations:[{type:"node_in",name:"IM",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"IN",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"IO",qualifier:["float"],is_optional:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",
qualifier:["uniform","samplerCube"],is_optional:!1}],statements:[{type:"textline",tokens:"yL = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , IM ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_IN"],statements:[{type:"textline",tokens:"IN = yL . xyz ; br ( IN ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_IO"],statements:[{type:"textline",tokens:"IO = yL . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",declarations:[{type:"node_in",
name:"IP",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"IQ",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"IR",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"IS",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"IT",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"IU",qualifier:["float"],is_optional:!0},{type:"node_out",name:"IV",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"IW",qualifier:["float"],is_optional:!0},{type:"node_out",name:"IX",
qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"IY",qualifier:["float"],is_optional:!0},{type:"node_out",name:"IZ",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"I_",qualifier:["float"],is_optional:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"],is_optional:!1}],statements:[{type:"textline",tokens:"yL = texture2D ( node_TEXTURE_COLOR_var_texture , ye ( IP ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_IT"],
statements:[{type:"textline",tokens:"IT = yL . xyz ; br ( IT ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_IU"],statements:[{type:"textline",tokens:"IU = yL . w ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv2"],statements:[{type:"textline",tokens:"yL = texture2D ( node_TEXTURE_COLOR_var_texture , ye ( IQ ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_IV"],statements:[{type:"textline",
tokens:"IV = yL . xyz ; br ( IV ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_IW"],statements:[{type:"textline",tokens:"IW = yL . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv3"],statements:[{type:"textline",tokens:"yL = texture2D ( node_TEXTURE_COLOR_var_texture , ye ( IR ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_IX"],statements:[{type:"textline",tokens:"IX = yL . xyz ; br ( IX ) ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_IY"],statements:[{type:"textline",tokens:"IY = yL . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv4"],statements:[{type:"textline",tokens:"yL = texture2D ( node_TEXTURE_COLOR_var_texture , ye ( IS ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_IZ"],statements:[{type:"textline",tokens:"IZ = yL . xyz ; br ( IZ ) ;".split(" ")}]}]},{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_I_"],statements:[{type:"textline",tokens:"I_ = yL . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",declarations:[{type:"node_in",name:"Ja",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"Jb",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"Jc",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"Jd",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"Je",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"Jf",
qualifier:["float"],is_optional:!0},{type:"node_out",name:"Jg",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"Jh",qualifier:["float"],is_optional:!0},{type:"node_out",name:"Ji",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"Jj",qualifier:["float"],is_optional:!0},{type:"node_out",name:"Jk",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"Jl",qualifier:["float"],is_optional:!0},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"],
is_optional:!1}],statements:[{type:"textline",tokens:"yL = texture2D ( node_TEXTURE_NORMAL_var_texture , ye ( Ja ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Je"],statements:[{type:"textline",tokens:"Je = normalize ( yM * ( yL . xyz - xS ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Jf"],statements:[{type:"textline",tokens:"Jf = yL . w ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv2"],
statements:[{type:"textline",tokens:"yL = texture2D ( node_TEXTURE_NORMAL_var_texture , ye ( Jb ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Jg"],statements:[{type:"textline",tokens:"Jg = normalize ( yM * ( yL . xyz - xS ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Jh"],statements:[{type:"textline",tokens:"Jh = yL . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv3"],statements:[{type:"textline",
tokens:"yL = texture2D ( node_TEXTURE_NORMAL_var_texture , ye ( Jc ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Ji"],statements:[{type:"textline",tokens:"Ji = normalize ( yM * ( yL . xyz - xS ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Jj"],statements:[{type:"textline",tokens:"Jj = yL . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv4"],statements:[{type:"textline",tokens:"yL = texture2D ( node_TEXTURE_NORMAL_var_texture , ye ( Jd ) ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Jk"],statements:[{type:"textline",tokens:"Jk = normalize ( yM * ( yL . xyz - xS ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Jl"],statements:[{type:"textline",tokens:"Jl = yL . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",declarations:[{type:"node_out",name:"Jm",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Jm = u_node_values [ VALUE_IND ] ;".split(" ")}]},
{type:"node",name:"VECT_MATH_ADD",declarations:[{type:"node_in",name:"Jn",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Jo",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Jp",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Jq",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"Jp = Jn + Jo ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Jq"],statements:[{type:"textline",tokens:"Jq = ( abs ( Jp [ 0 ] ) + abs ( Jp [ 1 ] ) + abs ( Jp [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_SUBTRACT",declarations:[{type:"node_in",name:"Jr",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Js",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Jt",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Ju",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"Jt = Jr - Js ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Ju"],statements:[{type:"textline",tokens:"Ju = ( abs ( Jt [ 0 ] ) + abs ( Jt [ 1 ] ) + abs ( Jt [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_AVERAGE",declarations:[{type:"node_in",name:"Jv",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Jw",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Jx",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Jy",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"Jx = Jv + Jw ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Jy"],statements:[{type:"textline",tokens:"Jy = length ( Jx ) ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Jx"],statements:[{type:"textline",tokens:"Jx = normalize ( Jx ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",declarations:[{type:"node_in",name:"Jz",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"JA",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"JB",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"JC",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"JB = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_JC"],statements:[{type:"textline",tokens:"JC = dot ( Jz , JA ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",declarations:[{type:"node_in",name:"JD",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"JE",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"JF",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"JG",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"JF = cross ( JD , JE ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_JG"],statements:[{type:"textline",tokens:"JG = length ( JF ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",declarations:[{type:"node_in",name:"JH",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"JI",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"JJ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"JK",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"JJ = normalize ( JH ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_JK"],statements:[{type:"textline",tokens:"JK = length ( JH ) ;".split(" ")}]}]},{type:"textline",tokens:["JI",";"]}]},{type:"node",name:"B4W_REFLECT",declarations:[{type:"node_in",name:"JL",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"JM",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"JN",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"JN = reflect ( - JL , JM ) ;".split(" ")}]},{type:"node",
name:"B4W_PARALLAX",declarations:[{type:"node_in",name:"JO",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"JP",qualifier:["float"],is_optional:!1},{type:"node_in",name:"JQ",qualifier:["const","float"],is_optional:!1},{type:"node_in",name:"JR",qualifier:["const","float"],is_optional:!1},{type:"node_out",name:"JS",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"],is_optional:!1}],statements:[{type:"textline",tokens:"yE = length ( yK ) ; if ( yE < JR ) { yz = ye ( JO ) ; yE = clamp ( xS * ( JR - yE ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; yE = JP * yE ;".split(" ")},
{type:"textline",tokens:"yS = normalize ( yo * yM ) ;".split(" ")},{type:"textline",tokens:"yF = UNITY_VALUE_NODES / JQ ;".split(" ")},{type:"textline",tokens:"yA = yS . xy * yE / ( JQ * yS . z ) ; yE = UNITY_VALUE_NODES ; yD = texture2D ( node_B4W_PARALLAX_var_texture , yz ) . a ;".split(" ")},{type:"textline",tokens:"for ( float JT = 1.0 ; JT <= JQ ; JT ++ ) { if ( yD < yE ) { yE -= yF ; yz -= yA ; yD = texture2D ( node_B4W_PARALLAX_var_texture , yz ) . a ; } }".split(" ")},{type:"textline",tokens:"yA = yz + yA ; yF = texture2D ( node_B4W_PARALLAX_var_texture , yA ) . a - ( yE + yF ) ; yE = yD - yE ; yF = yE / ( yE - yF ) ;".split(" ")},
{type:"textline",tokens:"yz = yF * yA + ( UNITY_VALUE_NODES - yF ) * yz ; JS = yc ( yz ) ; } else JS = JO ;".split(" ")}]},{type:"node",name:"B4W_CLAMP",declarations:[{type:"node_in",name:"JU",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"JV",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"JV = clamp ( JU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",declarations:[{type:"node_in",name:"JW",qualifier:["vec3"],is_optional:!1},
{type:"node_in",name:"JX",qualifier:["float"],is_optional:!1},{type:"node_out",name:"JY",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"JY = JW ; JX ;".split(" ")}]},{type:"node",name:"B4W_TRANSLUCENCY",declarations:[{type:"node_in",name:"JZ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"J_",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ka",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Kb",qualifier:["float"],is_optional:!1},{type:"node_in",
name:"Kc",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Kd",qualifier:["float"],is_optional:!0},{type:"node_out",name:"Ke",qualifier:["vec4"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Kd"],statements:[{type:"textline",tokens:["Kd","=","JZ",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_Ke"],statements:[{type:"textline",tokens:"Ke = vec4 ( J_ , Ka , Kb , Kc ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",
declarations:[{type:"node_out",name:"Kf",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:["Kf","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",declarations:[{type:"node_in",name:"Kg",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Kh",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ki",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Kj",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Kj = smoothstep ( Kh , Ki , Kg ) ;".split(" ")}]},
{type:"node",name:"B4W_GLOW_OUTPUT",declarations:[{type:"node_in",name:"Kk",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Kl",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"yu = Kk ; yy = Kl ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",declarations:[{type:"node_in",name:"Km",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"Kn",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Kn = ( Km . r + Km . g + Km . b ) / 3.0 ;".split(" ")}]},
{type:"node",name:"B4W_SCALTOVEC",declarations:[{type:"node_in",name:"Ko",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Kp",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"Kp [ 0 ] = Ko ; Kp [ 1 ] = Ko ; Kp [ 2 ] = Ko ;".split(" ")}]},{type:"nodes_global"},{type:"textline",tokens:"void Kq ( in vec3 yo , in mat4 yp , in mat4 yq , in mat4 yr , in mat4 ys , in mat4 yt , out vec3 yu , out vec3 yv , out vec3 yw , out vec4 yx , out float yy ) { vec2 yz , yA ; float yB , yC , yD , yE , yF , yG , yH , yI , yJ ; vec4 yK , yL ; mat3 yM ; vec3 yN , yO , yP , yQ , yR , yS ; yu = vec3 ( ZERO_VALUE_NODES ) ; yv = vec3 ( ZERO_VALUE_NODES ) ; yw = vec3 ( ZERO_VALUE_NODES ) ; yx = vec4 ( ZERO_VALUE_NODES ) ; yy = ZERO_VALUE_NODES ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:"yN = normalize ( bE ) ; yO = yN ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["INVERT_FRONTFACING"],
group:{type:"group",parts:[{type:"textline",tokens:["if","(","!","gl_FrontFacing",")"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["if","(","gl_FrontFacing",")"]}]}}]},{type:"textline",tokens:"yO = yO ; else yO = - yO ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",parts:[{type:"textline",tokens:["yP","=","yO",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["yP","=","yN",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_NO"],group:{type:"group",parts:[{type:"textline",tokens:["yN","=","yO",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"yQ = cross ( yO , bF . xyz ) * bF . w ; yM = mat3 ( bF . xyz , yQ , yO ) ; yM = yM ;".split(" ")}]}}]},{type:"textline",tokens:"yO = bC ; yK = bD ; yB = u_emit ; yC = u_ambient ;".split(" ")},{type:"nodes_main"},{type:"textline",
tokens:["}"]}]};a["include/particles.glslv"]={type:"group",parts:[{type:"var",name:"EPSILON",tokens:["0.0001"]},{type:"textline",tokens:"struct Ks { float a ; vec3 b ; float c ; vec3 d ; float e ; vec3 f ; vec3 g ; float h ; } ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void Ky ( inout vec3 Kt , float Ku , vec4 Kv , vec4 Kw ) { float Kx ; Kx = Kw . x - Kv . x ; Kx = ( Ku - Kv . x ) / Kx ; Kt = mix ( Kt , Kw . yzw , clamp ( Kx , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 KE ( float Kz , float KA , vec4 KB [ COLOR_RAMP_LENGTH ] ) { vec3 KC ; float KD ; KD = Kz / KA ; KC = KB [ 0 ] . yzw ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ky ( KC , KD , KB [ 0 ] , KB [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ky ( KC , KD , KB [ 1 ] , KB [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ky ( KC , KD , KB [ 2 ] , KB [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",tokens:["return","KC",";","}"]}]}}]},{type:"textline",tokens:"float KM ( float KF , float KG , float KH , float KI ) { float KJ , KK , KL ; KJ = max ( 0.01 , min ( KG , KH ) ) ; KK = max ( 0.01 , min ( KG , KI ) ) ; KL = KG - KK ; KK = clamp ( KF / KJ , 0.0 , 1.0 ) - step ( KL , KF ) * ( KF - KL ) / KK ; return KK ; } Ks KU ( ) { mat4 KN ; vec3 KO , KP ; float KQ , KR , KS ; Ks KT ; KR = a_p_data [ 0 ] ; KS = a_p_data [ 1 ] ; if ( u_p_cyclic == 1 ) { KQ = mod ( u_p_time , u_p_length ) - KS ; if ( KQ < 0.0 ) KQ += u_p_length ; } if ( u_p_cyclic != 1 ) { KQ = u_p_time - KS ; } if ( KQ < 0.0 || KQ >= KR ) { KT . a = 0.0001 ; KT . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( KQ < 0.0 || KQ >= KR ) ) {".split(" ")},
{type:"condition",parts:[{type:"if",expression:["WORLD_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"KO = a_position ; KP = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"KN = O ( u_model_tsr ) ; KO = ( KN * vec4 ( a_position , 1.0 ) ) . xyz ; KP = ( KN * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",tokens:"KP = u_p_nfactor * KP ; KP += a_p_vels . xyz ; KP . y -= u_p_gravity * KQ / 2.0 ; KR = max ( u_p_mass , EPSILON ) ; KP += ( u_p_wind_fac * u_wind / KR ) * KQ / 2.0 ; KT . h = KQ ; KT . f = KP ; KT . g = a_normal * a_p_vels . w ; KT . b = KO + KP * KQ ; KT . e = a_p_vels . w * KQ ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_COLOR_RAMP"],group:{type:"group",parts:[{type:"textline",tokens:"KT . a = texture2D ( u_color_ramp_tex , vec2 ( KQ / u_p_max_lifetime , 0.5 ) ) . g ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"KT . a = 1.0 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"KT . d = KE ( KQ , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"KT . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"KT . c = KM ( KQ , a_p_data [ 0 ] , u_p_fade_in , u_p_fade_out ) ; } return KT ; }".split(" ")}]};a["include/particles_nodes.glslv"]={type:"group",parts:[{type:"node",name:"TEX_COORD_UV",declarations:[],statements:[{type:"textline",tokens:"bM = K_ + 0.5 ;".split(" ")}]},{type:"node",name:"UV_MERGED",declarations:[],statements:[{type:"textline",tokens:"bM = K_ + 0.5 ;".split(" ")}]},
{type:"node",name:"UVMAP",declarations:[],statements:[{type:"textline",tokens:"bM = K_ + 0.5 ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",declarations:[],statements:[{type:"textline",tokens:"bM = K_ + 0.5 ;".split(" ")}]},{type:"node",name:"PARTICLE_INFO",declarations:[{type:"node_param",name:"yg",qualifier:["varying","vec4"],is_optional:!0},{type:"node_param",name:"yh",qualifier:["varying","vec3"],is_optional:!0},{type:"node_param",name:"yi",qualifier:["varying","vec3"],is_optional:!0},{type:"node_param",
name:"yj",qualifier:["varying","vec3"],is_optional:!0},{type:"node_param",name:"node_PARTICLE_INFO_var_a_p_indices",qualifier:["attribute","float"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["PART_INFO_SIZE"],statements:[{type:"textline",tokens:"yg [ 3 ] = KZ ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["PART_INFO_AGE"],statements:[{type:"textline",tokens:"yg [ 1 ] = KY ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",
expression:["PART_INFO_LT"],statements:[{type:"textline",tokens:"yg [ 2 ] = La ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["PART_INFO_LOC"],statements:[{type:"textline",tokens:["yh","=","KV",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["PART_INFO_IND"],statements:[{type:"textline",tokens:"yg [ 0 ] = node_PARTICLE_INFO_var_a_p_indices ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["PART_INFO_VEL"],statements:[{type:"textline",
tokens:["yi","=","KW",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["PART_INFO_A_VEL"],statements:[{type:"textline",tokens:["yj","=","KX",";"]}]}]}]},{type:"nodes_global"},{type:"textline",tokens:"void Lb ( in vec3 KV , in vec3 KW , in vec3 KX , in float KY , in float KZ , in vec2 K_ , in float La ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"bM = K_ + 0.5 ;".split(" ")}]}}]},{type:"nodes_main"},{type:"textline",tokens:["}"]}]};a["include/blending.glslf"]={type:"group",parts:[{type:"textline",tokens:"float Ld = 0.0 ; float Le = 1.0 ; vec3 Lj ( vec3 Lf ) { float Lg , Lh ; vec4 Li ; Li = vec4 ( Ld , - Le / 3.0 , 2.0 / 3.0 , - Le ) ; Li = mix ( vec4 ( Lf . bg , Li . wz ) , vec4 ( Lf . gb , Li . xy ) , step ( Lf . b , Lf . g ) ) ; Li = mix ( vec4 ( Li . xyw , Lf . r ) , vec4 ( Lf . r , Li . yzx ) , step ( Li . x , Lf . r ) ) ; Lg = Li . x - min ( Li . w , Li . y ) ; Lh = 1.0e-10 ; return vec3 ( abs ( Li . z + ( Li . w - Li . y ) / ( 6.0 * Lg + Lh ) ) , Lg / ( Li . x + Lh ) , Li . x ) ; } vec3 Ln ( vec3 Lk ) { vec3 Ll ; vec4 Lm ; Lm = vec4 ( Le , 2.0 / 3.0 , Le / 3.0 , 3.0 ) ; Ll = abs ( fract ( vec3 ( Lk . r , Lk . r , Lk . r ) + Lm . xyz ) * 6.0 - Lm . www ) ; return Lk . b * mix ( Lm . xxx , clamp ( Ll - Lm . xxx , Ld , Le ) , Lk . g ) ; } vec3 Lr ( vec3 Lo , vec3 Lp , float Lq ) { return mix ( Lo , Lp , Lq ) ; } vec3 Lv ( vec3 Ls , vec3 Lt , float Lu ) { return Lu * Ls + Lt ; } vec3 Lz ( vec3 Lw , vec3 Lx , float Ly ) { return Lx - Ly * Lw ; } vec3 LE ( vec3 LA , vec3 LB , float LC ) { float LD ; LD = Le - LC ; return ( vec3 ( LD ) + LC * LA ) * LB ; } vec3 LJ ( vec3 LF , vec3 LG , float LH ) { vec3 LI ; LI = vec3 ( Le - LH ) ; return vec3 ( Le ) - ( LI + LH * ( vec3 ( Le ) - LF ) ) * ( vec3 ( Le ) - LG ) ; } vec3 LO ( vec3 LK , vec3 LL , float LM ) { vec3 LN ; LN = vec3 ( Le - LM ) ; return mix ( LL * ( LN + 2.0 * LM * LK ) , vec3 ( Le ) - ( LN + 2.0 * LM * ( vec3 ( Le ) - LK ) ) * ( vec3 ( Le ) - LL ) , step ( 0.5 , LL ) ) ; } vec3 LS ( vec3 LP , vec3 LQ , float LR ) { return mix ( LQ , abs ( LP - LQ ) , LR ) ; } vec3 LW ( vec3 LT , vec3 LU , float LV ) { return mix ( LU , LU / ( LT + step ( LT , vec3 ( Ld ) ) ) , LV ) ; } vec3 L_ ( vec3 LX , vec3 LY , float LZ ) { return mix ( LY , min ( LX , LY ) , LZ ) ; } vec3 Md ( vec3 Ma , vec3 Mb , float Mc ) { return max ( Mc * Ma , Mb ) ; } vec3 Mj ( vec3 Me , vec3 Mf , float Mg ) { vec3 Mh , Mi ; Mh = Lj ( Mf ) ; if ( Mh . y != Ld ) { Mi = Lj ( Me ) ; Mi = Ln ( vec3 ( Mh . x , Mi . yz ) ) ; return mix ( Me , Mi , Mg ) ; } return Me ; } vec3 Mp ( vec3 Mk , vec3 Ml , float Mm ) { vec3 Mn , Mo ; Mn = Lj ( Mk ) ; if ( Mn . y != Ld ) { Mo = Lj ( Ml ) ; return Ln ( vec3 ( Mn . x , mix ( Mn . y , Mo . y , Mm ) , Mn . z ) ) ; } return Mk ; } vec3 Mv ( vec3 Mq , vec3 Mr , float Ms ) { vec3 Mt , Mu ; Mt = Lj ( Mq ) ; Mu = Lj ( Mr ) ; return Ln ( vec3 ( Mt . xy , mix ( Mt . z , Mu . z , Ms ) ) ) ; } vec3 MB ( vec3 Mw , vec3 Mx , float My ) { vec3 Mz , MA ; Mz = Lj ( Mx ) ; if ( Mz . y != Ld ) { MA = Lj ( Mw ) ; MA = Ln ( vec3 ( Mz . xy , MA . z ) ) ; return mix ( Mw , MA , My ) ; } return Mw ; } vec3 MG ( vec3 MC , vec3 MD , float ME ) { vec3 MF ; MF = vec3 ( Le ) - ( vec3 ( Le ) - MD ) * ( vec3 ( Le ) - MC ) ; return mix ( MC , ( ( vec3 ( Le ) - MC ) * MD * MC ) + MC * MF , ME ) ; } vec3 MK ( vec3 MH , vec3 MI , float MJ ) { return MH + MJ * ( 2.0 * MI - Le ) ; } float MQ ( float ML , float MM , float MN , float MO ) { float MP ; MP = Le - MO ; return ( MP + MN * ML ) * MM ; } float MW ( float MR , float MS , float MT , float MU ) { float MV ; MV = Le - MU ; return Le - ( MV + MT * ( Le - MR ) ) * ( Le - MS ) ; } float Nb ( float MX , float MY , float MZ , float M_ ) { float Na ; Na = Le - M_ ; return mix ( MY * ( Na + 2.0 * MZ * MX ) , Le - ( Na + 2.0 * MZ * ( Le - MX ) ) * ( Le - MY ) , step ( 0.5 , MY ) ) ; }".split(" ")}]};
a["include/fxaa.glslf"]={type:"group",parts:[{type:"condition",parts:[{type:"ifndef",name:"FXAA_PS3",group:{type:"group",parts:[{type:"define",name:"FXAA_PS3",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_360",group:{type:"group",parts:[{type:"define",name:"FXAA_360",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_360_OPT",group:{type:"group",parts:[{type:"define",name:"FXAA_360_OPT",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_PC",
group:{type:"group",parts:[{type:"define",name:"FXAA_PC",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_PC_CONSOLE",group:{type:"group",parts:[{type:"define",name:"FXAA_PC_CONSOLE",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_GLSL_120",group:{type:"group",parts:[{type:"define",name:"FXAA_GLSL_120",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_GLSL_130",group:{type:"group",parts:[{type:"define",name:"FXAA_GLSL_130",tokens:["0"]}]}}]},
{type:"condition",parts:[{type:"ifndef",name:"FXAA_HLSL_3",group:{type:"group",parts:[{type:"define",name:"FXAA_HLSL_3",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_HLSL_4",group:{type:"group",parts:[{type:"define",name:"FXAA_HLSL_4",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_HLSL_5",group:{type:"group",parts:[{type:"define",name:"FXAA_HLSL_5",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_GREEN_AS_LUMA",group:{type:"group",
parts:[{type:"define",name:"FXAA_GREEN_AS_LUMA",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_EARLY_EXIT",group:{type:"group",parts:[{type:"define",name:"FXAA_EARLY_EXIT",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_DISCARD",group:{type:"group",parts:[{type:"define",name:"FXAA_DISCARD",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_FAST_PIXEL_OFFSET",group:{type:"group",parts:[{type:"condition",parts:[{type:"ifdef",name:"GL_EXT_gpu_shader4",
group:{type:"group",parts:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifdef",name:"GL_NV_gpu_shader5",group:{type:"group",parts:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifdef",name:"GL_ARB_gpu_shader5",group:{type:"group",parts:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_FAST_PIXEL_OFFSET",group:{type:"group",parts:[{type:"define",
name:"FXAA_FAST_PIXEL_OFFSET",tokens:["0"]}]}}]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_GATHER4_ALPHA",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["FXAA_HLSL_5",1,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_GATHER4_ALPHA",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifdef",name:"GL_ARB_gpu_shader5",group:{type:"group",parts:[{type:"define",name:"FXAA_GATHER4_ALPHA",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifdef",
name:"GL_NV_gpu_shader5",group:{type:"group",parts:[{type:"define",name:"FXAA_GATHER4_ALPHA",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_GATHER4_ALPHA",group:{type:"group",parts:[{type:"define",name:"FXAA_GATHER4_ALPHA",tokens:["0"]}]}}]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:[1],group:{type:"group",parts:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",
tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:[0],group:{type:"group",parts:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",tokens:["4.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:[0],group:{type:"group",parts:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",tokens:["2.0"]}]}}]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:[1],group:{type:"group",
parts:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",tokens:["0.125"]}]}},{type:"else",group:{type:"group",parts:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",tokens:["0.25"]}]}}]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_QUALITY_PRESET",group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PRESET",tokens:["12"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",10,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",
name:"FXAA_QUALITY_PS",tokens:["3"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["3.0"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",11,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["4"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",
name:"FXAA_QUALITY_P2",tokens:["3.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",12,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["5"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["4.0"]},{type:"define",
name:"FXAA_QUALITY_P4",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",13,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["6"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["4.0"]},{type:"define",
name:"FXAA_QUALITY_P5",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",14,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["7"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P5",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",15,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["8"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P7",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",20,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["3"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P2",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",21,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["4"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",
22,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["5"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",23,{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["6"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",24,{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["7"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["3.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",
25,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["8"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["4.0"]},{type:"define",
name:"FXAA_QUALITY_P7",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",26,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["9"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P8",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",27,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["10"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",
name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P9",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",28,{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["11"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",
tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P10",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",29,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["12"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",
tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P10",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P11",tokens:["8.0"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",39,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["12"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["1.5"]},
{type:"define",name:"FXAA_QUALITY_P6",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P10",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P11",tokens:["8.0"]}]}}]},{type:"var",name:"FXAA_QUALITY_P12",tokens:["0.0"]},{type:"textline",tokens:"float Nx ( float Nw ) { return clamp ( Nw , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",parts:[{type:"if",
expression:["FXAA_BLEND4WEB",1,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 NA ( sampler2D Ny , vec2 Nz ) { return texture2D ( Ny , Nz ) ; } vec4 NF ( sampler2D NB , vec2 NC , vec2 ND , vec2 NE ) { return texture2D ( NB , NC + ( ND * NE ) ) ; }".split(" ")}]}}]},{type:"textline",tokens:"vec4 Ol ( vec2 NG , sampler2D NH , vec2 NI , float NJ , float NK , float NL ) { bool NM , NN , NO , NP , NQ ; float NR , NS , NT , NU , NV , NW , NX , NY , NZ , N_ , Oa , Ob , Oc , Od , Oe ; vec4 Of ; vec2 Og , Oh , Oi , Oj , Ok ; Og . x = NG . x ; Og . y = NG . y ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_GATHER4_ALPHA",1,{type:"equal_expr",places:2}],group:{type:"group",parts:[]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Of = NA ( NH , Og ) ; NR = bB ( Of ) ; NS = bB ( NF ( NH , Og , vec2 ( 0 , 1 ) , NI . xy ) ) ; NT = bB ( NF ( NH , Og , vec2 ( 1 , 0 ) , NI . xy ) ) ; NU = bB ( NF ( NH , Og , vec2 ( 0 , - 1 ) , NI . xy ) ) ; NV = bB ( NF ( NH , Og , vec2 ( - 1 , 0 ) , NI . xy ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"NW = max ( NS , NR ) ; NX = min ( NS , NR ) ; NW = max ( NT , NW ) ; NX = min ( NT , NX ) ; NY = max ( NU , NV ) ; NZ = min ( NU , NV ) ; NW = max ( NY , NW ) ; NX = min ( NZ , NX ) ; NZ = NW * NK ; NX = NW - NX ; NZ = max ( NL , NZ ) ; NM = NX < NZ ; if ( NM ) return Of ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_GATHER4_ALPHA",0,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"NZ = bB ( NF ( NH , Og , vec2 ( - 1 , - 1 ) , NI . xy ) ) ; NW = bB ( NF ( NH , Og , vec2 ( 1 , 1 ) , NI . xy ) ) ; NY = bB ( NF ( NH , Og , vec2 ( 1 , - 1 ) , NI . xy ) ) ; N_ = bB ( NF ( NH , Og , vec2 ( - 1 , 1 ) , NI . xy ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[]}}]},{type:"textline",tokens:"Oa = NU + NS ; Ob = NV + NT ; NX = 1.0 / NX ; Oc = Oa + Ob ; Oa = ( - 2.0 * NR ) + Oa ; Ob = ( - 2.0 * NR ) + Ob ; Od = NY + NW ; NY = NZ + NY ; Oe = ( - 2.0 * NT ) + Od ; NY = ( - 2.0 * NU ) + NY ; NZ = NZ + N_ ; NW = N_ + NW ; Oe = ( abs ( Oa ) * 2.0 ) + abs ( Oe ) ; NY = ( abs ( Ob ) * 2.0 ) + abs ( NY ) ; Ob = ( - 2.0 * NV ) + NZ ; NW = ( - 2.0 * NS ) + NW ; Oe = abs ( Ob ) + Oe ; NY = abs ( NW ) + NY ; Od = NZ + Od ; NZ = NI . x ; NM = Oe >= NY ; Od = Oc * 2.0 + Od ; if ( ! NM ) NU = NV ; if ( ! NM ) NS = NT ; if ( NM ) NZ = NI . y ; Od = ( Od * ( 1.0 / 12.0 ) ) - NR ; NT = NU - NR ; NV = NS - NR ; NU = NU + NR ; NS = NS + NR ; NN = abs ( NT ) >= abs ( NV ) ; NV = max ( abs ( NT ) , abs ( NV ) ) ; if ( NN ) NZ = - NZ ; NX = Nx ( abs ( Od ) * NX ) ; Oh . x = Og . x ; Oh . y = Og . y ; Oi . x = ( ! NM ) ? 0.0 : NI . x ; Oi . y = ( NM ) ? 0.0 : NI . y ; if ( ! NM ) Oh . x += NZ * 0.5 ; if ( NM ) Oh . y += NZ * 0.5 ; Oj . x = Oh . x - Oi . x * FXAA_QUALITY_P0 ; Oj . y = Oh . y - Oi . y * FXAA_QUALITY_P0 ; Ok . x = Oh . x + Oi . x * FXAA_QUALITY_P0 ; Ok . y = Oh . y + Oi . y * FXAA_QUALITY_P0 ; Od = ( ( - 2.0 ) * NX ) + 3.0 ; NT = bB ( NA ( NH , Oj ) ) ; NX = NX * NX ; Oc = bB ( NA ( NH , Ok ) ) ; if ( ! NN ) NU = NS ; NV = NV * 1.0 / 4.0 ; NS = NR - NU * 0.5 ; NX = Od * NX ; NN = NS < 0.0 ; NT -= NU * 0.5 ; Oc -= NU * 0.5 ; NO = abs ( NT ) >= NV ; NP = abs ( Oc ) >= NV ; if ( ! NO ) Oj . x -= Oi . x * FXAA_QUALITY_P1 ; if ( ! NO ) Oj . y -= Oi . y * FXAA_QUALITY_P1 ; NQ = ( ! NO ) || ( ! NP ) ; if ( ! NP ) Ok . x += Oi . x * FXAA_QUALITY_P1 ; if ( ! NP ) Ok . y += Oi . y * FXAA_QUALITY_P1 ; if ( NQ ) { if ( ! NO ) NT = bB ( NA ( NH , Oj . xy ) ) ; if ( ! NP ) Oc = bB ( NA ( NH , Ok . xy ) ) ; if ( ! NO ) NT = NT - NU * 0.5 ; if ( ! NP ) Oc = Oc - NU * 0.5 ; NO = abs ( NT ) >= NV ; NP = abs ( Oc ) >= NV ; if ( ! NO ) Oj . x -= Oi . x * FXAA_QUALITY_P2 ; if ( ! NO ) Oj . y -= Oi . y * FXAA_QUALITY_P2 ; NQ = ( ! NO ) || ( ! NP ) ; if ( ! NP ) Ok . x += Oi . x * FXAA_QUALITY_P2 ; if ( ! NP ) Ok . y += Oi . y * FXAA_QUALITY_P2 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( NQ ) { if ( ! NO ) NT = bB ( NA ( NH , Oj . xy ) ) ; if ( ! NP ) Oc = bB ( NA ( NH , Ok . xy ) ) ; if ( ! NO ) NT = NT - NU * 0.5 ; if ( ! NP ) Oc = Oc - NU * 0.5 ; NO = abs ( NT ) >= NV ; NP = abs ( Oc ) >= NV ; if ( ! NO ) Oj . x -= Oi . x * FXAA_QUALITY_P3 ; if ( ! NO ) Oj . y -= Oi . y * FXAA_QUALITY_P3 ; NQ = ( ! NO ) || ( ! NP ) ; if ( ! NP ) Ok . x += Oi . x * FXAA_QUALITY_P3 ; if ( ! NP ) Ok . y += Oi . y * FXAA_QUALITY_P3 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",4,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( NQ ) { if ( ! NO ) NT = bB ( NA ( NH , Oj . xy ) ) ; if ( ! NP ) Oc = bB ( NA ( NH , Ok . xy ) ) ; if ( ! NO ) NT = NT - NU * 0.5 ; if ( ! NP ) Oc = Oc - NU * 0.5 ; NO = abs ( NT ) >= NV ; NP = abs ( Oc ) >= NV ; if ( ! NO ) Oj . x -= Oi . x * FXAA_QUALITY_P4 ; if ( ! NO ) Oj . y -= Oi . y * FXAA_QUALITY_P4 ; NQ = ( ! NO ) || ( ! NP ) ; if ( ! NP ) Ok . x += Oi . x * FXAA_QUALITY_P4 ; if ( ! NP ) Ok . y += Oi . y * FXAA_QUALITY_P4 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",5,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( NQ ) { if ( ! NO ) NT = bB ( NA ( NH , Oj . xy ) ) ; if ( ! NP ) Oc = bB ( NA ( NH , Ok . xy ) ) ; if ( ! NO ) NT = NT - NU * 0.5 ; if ( ! NP ) Oc = Oc - NU * 0.5 ; NO = abs ( NT ) >= NV ; NP = abs ( Oc ) >= NV ; if ( ! NO ) Oj . x -= Oi . x * FXAA_QUALITY_P5 ; if ( ! NO ) Oj . y -= Oi . y * FXAA_QUALITY_P5 ; NQ = ( ! NO ) || ( ! NP ) ; if ( ! NP ) Ok . x += Oi . x * FXAA_QUALITY_P5 ; if ( ! NP ) Ok . y += Oi . y * FXAA_QUALITY_P5 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",6,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( NQ ) { if ( ! NO ) NT = bB ( NA ( NH , Oj . xy ) ) ; if ( ! NP ) Oc = bB ( NA ( NH , Ok . xy ) ) ; if ( ! NO ) NT = NT - NU * 0.5 ; if ( ! NP ) Oc = Oc - NU * 0.5 ; NO = abs ( NT ) >= NV ; NP = abs ( Oc ) >= NV ; if ( ! NO ) Oj . x -= Oi . x * FXAA_QUALITY_P6 ; if ( ! NO ) Oj . y -= Oi . y * FXAA_QUALITY_P6 ; NQ = ( ! NO ) || ( ! NP ) ; if ( ! NP ) Ok . x += Oi . x * FXAA_QUALITY_P6 ; if ( ! NP ) Ok . y += Oi . y * FXAA_QUALITY_P6 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",7,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( NQ ) { if ( ! NO ) NT = bB ( NA ( NH , Oj . xy ) ) ; if ( ! NP ) Oc = bB ( NA ( NH , Ok . xy ) ) ; if ( ! NO ) NT = NT - NU * 0.5 ; if ( ! NP ) Oc = Oc - NU * 0.5 ; NO = abs ( NT ) >= NV ; NP = abs ( Oc ) >= NV ; if ( ! NO ) Oj . x -= Oi . x * FXAA_QUALITY_P7 ; if ( ! NO ) Oj . y -= Oi . y * FXAA_QUALITY_P7 ; NQ = ( ! NO ) || ( ! NP ) ; if ( ! NP ) Ok . x += Oi . x * FXAA_QUALITY_P7 ; if ( ! NP ) Ok . y += Oi . y * FXAA_QUALITY_P7 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",8,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( NQ ) { if ( ! NO ) NT = bB ( NA ( NH , Oj . xy ) ) ; if ( ! NP ) Oc = bB ( NA ( NH , Ok . xy ) ) ; if ( ! NO ) NT = NT - NU * 0.5 ; if ( ! NP ) Oc = Oc - NU * 0.5 ; NO = abs ( NT ) >= NV ; NP = abs ( Oc ) >= NV ; if ( ! NO ) Oj . x -= Oi . x * FXAA_QUALITY_P8 ; if ( ! NO ) Oj . y -= Oi . y * FXAA_QUALITY_P8 ; NQ = ( ! NO ) || ( ! NP ) ; if ( ! NP ) Ok . x += Oi . x * FXAA_QUALITY_P8 ; if ( ! NP ) Ok . y += Oi . y * FXAA_QUALITY_P8 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",9,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( NQ ) { if ( ! NO ) NT = bB ( NA ( NH , Oj . xy ) ) ; if ( ! NP ) Oc = bB ( NA ( NH , Ok . xy ) ) ; if ( ! NO ) NT = NT - NU * 0.5 ; if ( ! NP ) Oc = Oc - NU * 0.5 ; NO = abs ( NT ) >= NV ; NP = abs ( Oc ) >= NV ; if ( ! NO ) Oj . x -= Oi . x * FXAA_QUALITY_P9 ; if ( ! NO ) Oj . y -= Oi . y * FXAA_QUALITY_P9 ; NQ = ( ! NO ) || ( ! NP ) ; if ( ! NP ) Ok . x += Oi . x * FXAA_QUALITY_P9 ; if ( ! NP ) Ok . y += Oi . y * FXAA_QUALITY_P9 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",10,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( NQ ) { if ( ! NO ) NT = bB ( NA ( NH , Oj . xy ) ) ; if ( ! NP ) Oc = bB ( NA ( NH , Ok . xy ) ) ; if ( ! NO ) NT = NT - NU * 0.5 ; if ( ! NP ) Oc = Oc - NU * 0.5 ; NO = abs ( NT ) >= NV ; NP = abs ( Oc ) >= NV ; if ( ! NO ) Oj . x -= Oi . x * FXAA_QUALITY_P10 ; if ( ! NO ) Oj . y -= Oi . y * FXAA_QUALITY_P10 ; NQ = ( ! NO ) || ( ! NP ) ; if ( ! NP ) Ok . x += Oi . x * FXAA_QUALITY_P10 ; if ( ! NP ) Ok . y += Oi . y * FXAA_QUALITY_P10 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",11,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( NQ ) { if ( ! NO ) NT = bB ( NA ( NH , Oj . xy ) ) ; if ( ! NP ) Oc = bB ( NA ( NH , Ok . xy ) ) ; if ( ! NO ) NT = NT - NU * 0.5 ; if ( ! NP ) Oc = Oc - NU * 0.5 ; NO = abs ( NT ) >= NV ; NP = abs ( Oc ) >= NV ; if ( ! NO ) Oj . x -= Oi . x * FXAA_QUALITY_P11 ; if ( ! NO ) Oj . y -= Oi . y * FXAA_QUALITY_P11 ; NQ = ( ! NO ) || ( ! NP ) ; if ( ! NP ) Ok . x += Oi . x * FXAA_QUALITY_P11 ; if ( ! NP ) Ok . y += Oi . y * FXAA_QUALITY_P11 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",12,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( NQ ) { if ( ! NO ) NT = bB ( NA ( NH , Oj . xy ) ) ; if ( ! NP ) Oc = bB ( NA ( NH , Ok . xy ) ) ; if ( ! NO ) NT = NT - NU * 0.5 ; if ( ! NP ) Oc = Oc - NU * 0.5 ; NO = abs ( NT ) >= NV ; NP = abs ( Oc ) >= NV ; if ( ! NO ) Oj . x -= Oi . x * FXAA_QUALITY_P12 ; if ( ! NO ) Oj . y -= Oi . y * FXAA_QUALITY_P12 ; NQ = ( ! NO ) || ( ! NP ) ; if ( ! NP ) Ok . x += Oi . x * FXAA_QUALITY_P12 ; if ( ! NP ) Ok . y += Oi . y * FXAA_QUALITY_P12 ; }".split(" ")}]}}]},
{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:"} NV = Og . x - Oj . x ; NU = Ok . x - Og . x ; if ( ! NM ) NV = Og . y - Oj . y ; if ( ! NM ) NU = Ok . y - Og . y ; NP = ( NT < 0.0 ) != NN ; NT = ( NU + NV ) ; NN = ( Oc < 0.0 ) != NN ; NT = 1.0 / NT ; NO = NV < NU ; NU = min ( NV , NU ) ; NN = NO ? NP : NN ; NX = NX * NX ; NT = ( NU * ( - NT ) ) + 0.5 ; NX = NX * NJ ; NT = NN ? NT : 0.0 ; NX = max ( NT , NX ) ; if ( ! NM ) Og . x += NX * NZ ; if ( NM ) Og . y += NX * NZ ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_DISCARD",1,{type:"equal_expr",places:2},"FXAA_BLEND4WEB",1,{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return NA ( NH , Og ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return vec4 ( NA ( NH , Og ) . xyz , NR ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["include/depth_fetch.glslf"]={type:"group",parts:[{type:"textline",tokens:"float Os ( in sampler2D Om , in vec2 On , in vec2 Oo ) { float Op , Oq , Or ; Op = texture2D ( Om , On ) . r ; Oq = Oo . x ; Or = Oo . y ; Oq = 2.0 * Oq / ( Oq + Or - ( 2.0 * Op - 1.0 ) * ( Or - Oq ) ) ; return Oq ; }".split(" ")}]}};b4w.module.animation=function(a,r){var u=r("__animation"),c=r("__armature"),b=r("__obj_util"),h=r("__print"),d=r("__tsr");a.SLOT_0=u.SLOT_0;a.SLOT_1=u.SLOT_1;a.SLOT_2=u.SLOT_2;a.SLOT_3=u.SLOT_3;a.SLOT_4=u.SLOT_4;a.SLOT_5=u.SLOT_5;a.SLOT_6=u.SLOT_6;a.SLOT_7=u.SLOT_7;a.SLOT_ALL=u.SLOT_ALL;a.OBJ_ANIM_TYPE_NONE=u.OBJ_ANIM_TYPE_NONE;a.OBJ_ANIM_TYPE_ARMATURE=u.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=u.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=u.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=u.OBJ_ANIM_TYPE_SOUND;
a.OBJ_ANIM_TYPE_PARTICLES=u.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=u.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=u.AB_CYCLIC;a.AB_FINISH_RESET=u.AB_FINISH_RESET;a.AB_FINISH_STOP=u.AB_FINISH_STOP;var q=d.create();a.is_animated=function(a){return u.is_animated(a)};a.get_anim_names=function(a){return u.obj_is_animatable(a)?u.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!u.is_animated(a))return null;b=b||u.SLOT_0;return u.get_anim_by_slot_num(a,b)};a.apply=function(a,b,c){if(c>u.SLOT_7)h.error("Can't apply animation to slot "+
c+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{c=c||u.SLOT_0;if(u.is_animated(a)){var d=u.get_slot_num_by_anim(a,b);if(-1!=d&&d!=c){h.error('Animation "'+b+'" is already applied to object "'+a.name+'" (slot "'+d+'").');return}}u.validate_action_by_name(a,b)?u.apply(a,b,c):h.error('No fcurves in action "'+b+'"')}};a.remove=function(a){u.remove(a)};a.remove_slot_animation=function(a,b){u.is_animated(a)&&(b=b||u.SLOT_0,u.remove_slot_animation(a,b))};a.apply_def=function(a){u.apply_def(a)};
a.play=function(a,b,c){u.is_animated(a)?(c=c||u.SLOT_0,u.play(a,b,c),u.update_object_animation(a,0,c,!0)):h.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){u.is_animated(a)&&(b=b||u.SLOT_0,u.stop(a,b))};a.is_play=function(a,b){if(!u.is_animated(a))return!1;b=b||u.SLOT_0;return u.is_play(a,b)};a.set_frame=function(a,b,c){u.is_animated(a)&&(c=c||u.SLOT_0,u.set_frame(a,b,c))};a.set_first_frame=function(a,b){u.is_animated(a)&&u.set_first_frame(a,b)};a.set_last_frame=function(a,
b){if(u.is_animated(a)){b=b||u.SLOT_0;var c=u.get_anim_start_frame(a,b),d=u.get_anim_length(a,b);u.set_frame(a,c+d-u.LAST_FRAME_EPSILON,b)}};a.get_frame=function(a,b){if(!u.is_animated(a))return 0;b=b||u.SLOT_0;return u.get_current_frame_float(a,b)};a.set_speed=function(a,b,c){u.is_animated(a)&&(c=c||u.SLOT_0,u.set_speed(a,b||1,c))};a.get_speed=function(a,b){if(!u.is_animated(a))return 0;b=b||u.SLOT_0;return a.anim_slots[b]?u.get_speed(a,b):0};a.get_anim_start_frame=function(a,b){return u.is_animated(a)&&
(b=b||u.SLOT_0,a.anim_slots[b])?u.get_anim_start_frame(a,b):-1};a.get_anim_length=function(a,b){return u.is_animated(a)&&(b=b||u.SLOT_0,a.anim_slots[b])?u.get_anim_length(a,b):-1};a.set_behavior=function(a,b,c){u.is_animated(a)&&(c=c||u.SLOT_0,u.set_behavior(a,b,c))};a.get_behavior=function(a,b){if(!u.is_animated(a))return null;b=b||u.SLOT_0;return u.get_behavior(a,b)};a.apply_smoothing=function(a,b,c,d){d=d||u.SLOT_0;u.is_animated(a)&&u.apply_smoothing(a,b,c,d)};a.frame_to_sec=function(a){return u.frame_to_sec(a)};
a.get_bone_translation=function(a,d,f){h.error_deprecated("get_bone_translation","armature.get_bone_tsr");if(!b.is_armature(a))return null;if(!c.check_bone(a,d))return h.error('There is no bone: "',d,'" in "',a.name,'".'),null;f||(f=new Float32Array(3));c.get_bone_tsr(a,d,!1,!1,q);f[0]=q[0];f[1]=q[1];f[2]=q[2];return f};a.get_first_armature_object=function(a){h.error_once("get_first_armature_object() deprecated");return null};a.get_slot_num_by_anim=function(a,b){return u.is_animated(a)&&b?u.get_slot_num_by_anim(a,
b):null};a.get_anim_type=function(a,b){return u.is_animated(a)?u.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return u.apply_to_first_empty_slot(a,b)};a.get_skel_mix_factor=function(a){return a.render.anim_mix_factor};a.set_skel_mix_factor=function(a,c,d){b.is_armature(a)?(c=Math.min(Math.max(c,0),1),a.render.anim_mix_factor!=c&&u.set_skel_mix_factor(a,c,d||0)):h.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,r){var u=r("__anchors");r("__print");a.attach_move_cb=u.attach_move_cb;a.detach_move_cb=u.detach_move_cb;a.is_anchor=u.is_anchor;a.get_element_id=u.get_element_id};b4w.module.armature=function(a,r){var u=r("__armature"),c=r("__obj_util"),b=r("__transform"),h=r("__print");a.get_bone_tsr=function(a,b,k){if(!c.is_armature(a))return null;if(!u.check_bone(a,b))return h.error('There is no bone: "',b,'" in "',a.name,'".'),null;k||(k=new Float32Array(8));u.get_bone_tsr(a,b,!1,!1,k);return k};a.get_bone_tsr_rel=function(a,b,k){if(!c.is_armature(a))return null;if(!u.check_bone(a,b))return h.error('There is no bone: "',b,'" in "',a.name,'".'),null;k||(k=new Float32Array(8));
u.get_bone_tsr(a,b,!1,!0,k);return k};a.set_bone_tsr=function(a,q,k){c.is_armature(a)&&(u.check_bone(a,q)?(u.set_bone_tsr(a,q,k,!1),b.update_transform(a)):h.error('There is no bone: "',q,'" in "',a.name,'".'))};a.set_bone_tsr_rel=function(a,q,k){c.is_armature(a)&&(u.check_bone(a,q)?(u.set_bone_tsr(a,q,k,!0),b.update_transform(a)):h.error('There is no bone: "',q,'" in "',a.name,'".'))}};b4w.module.assets=function(a,r){var u=r("__assets");a.AT_ARRAYBUFFER=u.AT_ARRAYBUFFER;a.AT_JSON=u.AT_JSON;a.AT_TEXT=u.AT_TEXT;a.AT_AUDIOBUFFER=u.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=u.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=u.AT_AUDIO_ELEMENT;a.enqueue=function(a,b,h,d){if(a.length)if(a.id)u.enqueue(a,b,h,d);else{for(var q=[],k=0;k<a.length;k++){var p=a[k];q.push({id:p[0],type:p[1],url:p[2],request:p.request?p.request:"GET",post_type:null,post_data:null,param:p[3]})}u.enqueue(q,b,h,d)}}};b4w.module.camera=function(a,r){function u(a,b){f.error_deprecated("camera.set_pivot","camera.target_set_trans_pivot");c.is_target_camera(a)?(t.copy(b,a.render.pivot),g.update_transform(a),p.sync_transform(a)):f.error("set_pivot(): Wrong object or camera move style")}var c=r("__camera");r("__config");var b=r("__constraints"),h=r("__container"),d=r("__mat4"),q=r("__math"),k=r("__obj_util"),p=r("__physics"),f=r("__print"),w=r("__scenes"),g=r("__transform"),m=r("__tsr"),l=r("__util"),t=r("__vec3"),F=
r("__vec4"),H=new Float32Array(2),C=new Float32Array(3),x=new Float32Array(3),y=new Float32Array(4);new Float32Array(9);var z={},E={};a.MS_STATIC=c.MS_STATIC;a.MS_TARGET_CONTROLS=c.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=c.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=c.MS_HOVER_CONTROLS;a.static_setup=function(a,b){if(k.is_camera(a)){c.wipe_move_style(a);a.render.move_style=c.MS_STATIC;if(b){var d=b.pos||m.get_trans_view(a.render.world_tsr);b.look_at?c.set_look_at(a,d,b.look_at):g.set_translation(a,d)}g.update_transform(a);
p.sync_transform(a);c.init_ortho_props(a)}else f.error("static_setup(): Wrong camera object")};a.static_set_look_at=function(a,b,d){c.is_static_camera(a)?(b=b||m.get_trans_view(a.render.world_tsr),d?c.set_look_at(a,b,d):g.set_translation(a,b),g.update_transform(a),p.sync_transform(a)):f.error("static_set_look_at(): Wrong camera object or camera move style")};a.static_set_rotation=function(a,b){c.is_static_camera(a)?(g.set_rotation(a,b),g.update_transform(a),p.sync_transform(a)):f.error("static_set_rotation(): Wrong camera object or camera move style")};
a.static_get_rotation=function(a,b){if(!c.is_static_camera(a))return f.error("static_get_rotation(): Wrong camera object or camera move style"),null;b=b||new Float32Array(4);return g.get_rotation(a,b)};a.eye_setup=function(a,b){if(k.is_camera(a))if(b&&b.horiz_rot_lim&&("number"!=typeof b.horiz_rot_lim.left||"number"!=typeof b.horiz_rot_lim.right))f.error("eye_setup(): Wrong horizontal limits object.");else if(b&&b.vert_rot_lim&&("number"!=typeof b.vert_rot_lim.down||"number"!=typeof b.vert_rot_lim.up))f.error("eye_setup(): Wrong vertical limits object.");
else{c.wipe_move_style(a);a.render.move_style=c.MS_EYE_CONTROLS;if(b){var d=b.pos||m.get_trans_view(a.render.world_tsr);c.setup_eye_model(a,d,b.look_at,b.horiz_rot_lim,b.vert_rot_lim)}g.update_transform(a);p.sync_transform(a);c.init_ortho_props(a)}else f.error("eye_setup(): Wrong camera object")};a.eye_set_look_at=function(a,d,h){c.is_eye_camera(a)?(d=d||m.get_trans_view(a.render.world_tsr),h?c.set_look_at_corrected(a,d,h):g.set_translation(a,d),b.correct_up(a,a.render.vertical_axis,!0),g.update_transform(a),
p.sync_transform(a)):f.error("eye_set_look_at(): Wrong camera object or camera move style")};a.eye_rotate=function(a,b,d,h,k){c.is_eye_camera(a)?(c.rotate_eye_camera(a,b,d,h||!1,k||!1),g.update_transform(a),p.sync_transform(a)):f.error("eye_rotate(): Wrong camera object or camera move style")};a.eye_set_vertical_limits=function(a,b){c.is_eye_camera(a)?!b||"number"==typeof b.down&&"number"==typeof b.up?(c.set_vertical_rot_limits(a,b),g.update_transform(a),p.sync_transform(a)):f.error("eye_set_vertical_limits(): Incorrect limits object."):
f.error("eye_set_vertical_limits(): Wrong camera object or camera move style")};a.eye_get_vertical_limits=function(a,b,d){if(!c.is_eye_camera(a))return f.error("eye_get_vertical_limits(): Wrong camera object or camera move style"),null;a=a.render;return a.vertical_limits?(b=b||{},d?(b.down=a.vertical_limits.down_local,b.up=a.vertical_limits.up_local):(b.down=a.vertical_limits.down,b.up=a.vertical_limits.up),b.camera_space=d||!1,b):null};a.eye_set_horizontal_limits=function(a,b){c.is_eye_camera(a)?
!b||"number"==typeof b.left&&"number"==typeof b.right?(c.set_horizontal_rot_limits(a,b),g.update_transform(a),p.sync_transform(a)):f.error("eye_set_horizontal_limits(): Incorrect limits object."):f.error("eye_set_horizontal_limits(): Wrong camera object or camera move style")};a.eye_get_horizontal_limits=function(a,b,d){if(!c.is_eye_camera(a))return f.error("eye_get_horizontal_limits(): Wrong camera object or camera move style"),null;a=a.render;return a.horizontal_limits?(b=b||{},d?(b.left=a.horizontal_limits.left_local,
b.right=a.horizontal_limits.right_local):(b.left=a.horizontal_limits.left,b.right=a.horizontal_limits.right),b.camera_space=d||!1,b):null};a.target_setup=function(a,b){if(k.is_camera(a))if(!b.horiz_rot_lim||"number"==typeof b.horiz_rot_lim.left&&"number"==typeof b.horiz_rot_lim.right)if(!b.vert_rot_lim||"number"==typeof b.vert_rot_lim.down&&"number"==typeof b.vert_rot_lim.up){if(b.dist_lim){if("number"!=typeof b.dist_lim.min||"number"!=typeof b.dist_lim.max||b.dist_lim.min>b.dist_lim.max){f.error("target_setup(): Wrong distance limits object");
return}b.dist_lim.min=Math.max(b.dist_lim.min,0);b.dist_lim.max=Math.max(b.dist_lim.max,0)}if(b.pivot_lim&&("number"!=typeof b.pivot_lim.min_y||"number"!=typeof b.pivot_lim.max_y||b.pivot_lim.min_y>b.pivot_lim.max_y))f.error("target_setup(): Wrong pivot limits object");else{c.wipe_move_style(a);a.render.move_style=c.MS_TARGET_CONTROLS;var d=b.pos||m.get_trans_view(a.render.world_tsr);c.setup_target_model(a,d,b.pivot,b.horiz_rot_lim,b.vert_rot_lim,b.dist_lim,b.pivot_lim,b.use_panning||!1);g.update_transform(a);
p.sync_transform(a);c.init_ortho_props(a)}}else f.error("target_setup(): Wrong vertical limits object");else f.error("target_setup(): Wrong horizontal limits object");else f.error("target_setup(): Wrong camera object")};a.target_rotate=function(a,b,d,h,k){c.is_target_camera(a)?(c.rotate_target_camera(a,b,d,h||!1,k||!1),g.update_transform(a),p.sync_transform(a)):f.error("target_rotate(): Wrong camera object or camera move style")};a.target_set_trans_pivot=function(a,b,d){c.is_target_camera(a)?(b=b||
m.get_trans_view(a.render.world_tsr),d=d||a.render.pivot,c.set_trans_pivot(a,b,d),g.update_transform(a),p.sync_transform(a)):f.error("target_set_trans_pivot(): Wrong camera object or camera move style")};a.target_set_pivot_translation=function(a,b){c.is_target_camera(a)?(c.set_target_pivot(a,b),g.update_transform(a),p.sync_transform(a)):f.error("target_set_pivot_translation(): Wrong camera object or camera move style")};a.target_set_distance=function(a,b){if(c.is_target_camera(a)){var d=g.obj_point_distance(a,
a.render.pivot),h=Math.max(0,b);g.move_local(a,0,h-d,0);g.update_transform(a);p.sync_transform(a)}else f.error("target_set_distance(): Wrong camera object or camera move style")};a.target_get_distance=function(a){return c.is_target_camera(a)?g.obj_point_distance(a,a.render.pivot):(f.error("target_get_distance(): Wrong camera object or camera move style"),0)};a.target_zoom_object=function(a,b){if(c.is_target_camera(a)){var d=g.get_object_center(b,!1,C),h=g.get_object_size(b),l=w.get_active(),l=k.get_scene_data(a,
l).cameras[0],l=c.get_angular_diameter(l)/2,h=h/Math.sin(l),l=g.obj_point_distance(a,d);c.set_trans_pivot(a,m.get_trans_view(a.render.world_tsr),d);g.update_transform(a);g.move_local(a,0,h-l,0);g.update_transform(a);p.sync_transform(a)}else f.error("target_zoom_object(): Wrong camera object or camera move style")};a.target_get_pivot=function(a,b){if(!c.is_target_camera(a))return f.error("target_get_pivot(): Wrong camera object or camera move style"),null;b=b||new Float32Array(3);t.copy(a.render.pivot,
b);return b};a.target_set_distance_limits=function(a,b){if(c.is_target_camera(a)){if(b){if("number"!=typeof b.min||"number"!=typeof b.max||b.min>b.max){f.error("target_set_distance_limits(): Wrong limits object");return}b.min=Math.max(b.min,0);b.max=Math.max(b.max,0)}c.set_distance_limits(a,b);g.update_transform(a);p.sync_transform(a)}else f.error("target_set_distance_limits(): Wrong camera object or camera move style")};a.target_get_distance_limits=function(a,b){if(!c.is_target_camera(a))return f.error("target_get_distance_limits(): Wrong camera object or camera move style"),
null;var d=a.render;return d.distance_limits?(b=b||{},b.min=d.distance_limits.min,b.max=d.distance_limits.max,b):null};a.target_set_vertical_limits=function(a,b){c.is_target_camera(a)?!b||"number"==typeof b.down&&"number"==typeof b.up?(c.set_vertical_rot_limits(a,b),g.update_transform(a),p.sync_transform(a)):f.error("target_set_vertical_limits(): Wrong limits object"):f.error("target_set_vertical_limits(): Wrong camera object or camera move style")};a.target_get_vertical_limits=function(a,b,d){if(!c.is_target_camera(a))return f.error("target_get_vertical_limits(): Wrong camera object or camera move style"),
null;a=a.render;return a.vertical_limits?(b=b||{},d?(b.down=a.vertical_limits.down_local,b.up=a.vertical_limits.up_local):(b.down=a.vertical_limits.down,b.up=a.vertical_limits.up),b.camera_space=d||!1,b):null};a.target_set_horizontal_limits=function(a,b){c.is_target_camera(a)?!b||"number"==typeof b.left&&"number"==typeof b.right?(c.set_horizontal_rot_limits(a,b),g.update_transform(a),p.sync_transform(a)):f.error("target_set_horizontal_limits(): Wrong limits object"):f.error("target_set_horizontal_limits(): Wrong camera object or camera move style")};
a.target_get_horizontal_limits=function(a,b,d){if(!c.is_target_camera(a))return f.error("target_get_horizontal_limits(): Wrong camera object or camera move style"),null;a=a.render;return a.horizontal_limits?(b=b||{},d?(b.left=a.horizontal_limits.left_local,b.right=a.horizontal_limits.right_local):(b.left=a.horizontal_limits.left,b.right=a.horizontal_limits.right),b.camera_space=d||!1,b):null};a.target_set_pivot_limits=function(a,b){c.is_target_camera(a)?b&&("number"!=typeof b.min_y||"number"!=typeof b.max_y||
b.min_y>b.max_y)?f.error("target_set_pivot_limits(): Wrong limits object"):(c.set_pivot_limits(a,b),g.update_transform(a),p.sync_transform(a)):f.error("target_set_pivot_limits(): Wrong camera object or camera move style")};a.target_get_pivot_limits=function(a,b){if(!c.is_target_camera(a))return f.error("target_get_pivot_limits(): Wrong camera object or camera move style"),null;var d=a.render;return d.pivot_limits?(b=b||{},b.min_y=d.pivot_limits.min_y,b.max_y=d.pivot_limits.max_y,b):null};a.target_pan_pivot=
function(a,b,d){if(c.is_target_camera(a)){var h=a.render;h.use_panning&&(C[0]=b,C[1]=0,C[2]=d,m.transform_dir_vec3(C,h.world_tsr,C),t.add(h.pivot,C,h.pivot),b=m.get_trans_view(h.world_tsr),t.add(b,C,b),g.update_transform(a),p.sync_transform(a))}else f.error("target_pan_pivot(): wrong object")};a.target_switch_panning=function(a,b){if(!c.is_target_camera(a))return f.error("target_switch_panning(): Wrong camera object or camera move style"),null;a.render.use_panning=b};a.hover_setup_rel=function(b,
d){a.hover_setup(b,{pos:d.pos,pivot:d.pivot});var f="undefined"==typeof d.dist_interval?0:Math.max(d.dist_interval,0),h="undefined"==typeof d.angle_interval?0:Math.max(d.angle_interval,0),k="undefined"==typeof d.t?.5:l.clamp(d.t,0,1),m=a.hover_get_distance_limits(b,z);m.min=Math.max(m.min-k*f,0);m.max+=(1-k)*f;f=a.hover_get_vertical_limits(b,E);f.down=l.clamp(f.down+k*h,-Math.PI/2,0);f.up=l.clamp(f.up-(1-k)*h,-Math.PI/2,0);c.hover_set_distance_limits(b,m);c.hover_set_vertical_limits(b,f);g.update_transform(b);
p.sync_transform(b);c.init_ortho_props(b)};a.hover_setup=function(a,b){if(k.is_camera(a)){if(b.dist_lim){if("number"!=typeof b.dist_lim.min||"number"!=typeof b.dist_lim.max||b.dist_lim.min>b.dist_lim.max){f.error("hover_setup(): Wrong distance limits object");return}b.dist_lim.min=Math.max(b.dist_lim.min,0);b.dist_lim.max=Math.max(b.dist_lim.max,0)}if(b.hover_angle_lim&&("number"!=typeof b.hover_angle_lim.down||"number"!=typeof b.hover_angle_lim.up||b.hover_angle_lim.down<b.hover_angle_lim.up))f.error("hover_setup(): Wrong hover angle limits object");
else if(b.horiz_trans_lim&&("number"!=typeof b.horiz_trans_lim.min||"number"!=typeof b.horiz_trans_lim.max||b.horiz_trans_lim.min>b.horiz_trans_lim.max))f.error("hover_setup(): Wrong horizontal translation limits object");else if(b.vert_trans_lim&&("number"!=typeof b.vert_trans_lim.min||"number"!=typeof b.vert_trans_lim.max||b.vert_trans_lim.min>b.vert_trans_lim.max))f.error("hover_setup(): Wrong vertical translation limits object");else{c.wipe_move_style(a);a.render.move_style=c.MS_HOVER_CONTROLS;
var d=b.pos||m.get_trans_view(a.render.world_tsr);c.setup_hover_model(a,d,b.pivot,b.dist_lim,b.hover_angle_lim,b.horiz_trans_lim,b.vert_trans_lim,b.enable_horiz_rot||!1);g.update_transform(a);p.sync_transform(a);c.init_ortho_props(a)}}else f.error("hover_setup(): Wrong camera object")};a.hover_rotate=function(a,b,d,h,k){c.is_hover_camera(a)?(c.rotate_hover_camera(a,b,d,h||!1,k||!1),g.update_transform(a),p.sync_transform(a)):f.error("hover_rotate(): Wrong camera object or camera move style")};a.hover_set_pivot_translation=
function(a,b){c.is_hover_camera(a)?(c.set_hover_pivot(a,b),g.update_transform(a),p.sync_transform(a)):f.error("hover_set_pivot_translation(): Wrong camera object or camera move style")};a.hover_get_pivot=function(a,b){if(!c.is_hover_camera(a))return f.error("hover_get_pivot(): Wrong camera object or camera move style"),null;b=b||new Float32Array(3);t.copy(a.render.hover_pivot,b);return b};a.hover_get_distance=function(a){return c.is_hover_camera(a)?g.obj_point_distance(a,a.render.hover_pivot):(f.error("hover_get_distance(): Wrong camera object or camera move style"),
0)};a.hover_set_vertical_limits=function(a,b){c.is_hover_camera(a)?"number"!=typeof b.down||"number"!=typeof b.up||b.down<b.up?f.error("hover_set_vertical_limits(): Wrong limits object"):(c.hover_set_vertical_limits(a,b),g.update_transform(a),p.sync_transform(a)):f.error("hover_set_vertical_limits(): Wrong camera object or camera move style")};a.hover_get_vertical_limits=function(a,b){if(!c.is_hover_camera(a))return f.error("hover_get_vertical_limits(): Wrong camera object or camera move style"),
null;var d=a.render;b=b||{};b.down=d.vertical_limits.down;b.up=d.vertical_limits.up;return b};a.hover_set_distance_limits=function(a,b){c.is_hover_camera(a)?"number"!=typeof b.min||"number"!=typeof b.max||b.min>b.max?f.error("hover_set_distance_limits(): Wrong limits object"):(b.min=Math.max(b.min,0),b.max=Math.max(b.max,0),c.hover_set_distance_limits(a,b),g.update_transform(a),p.sync_transform(a)):f.error("hover_set_distance_limits(): Wrong camera object or camera move style")};a.hover_get_distance_limits=
function(a,b){if(!c.is_hover_camera(a))return f.error("hover_get_distance_limits(): Wrong camera object or camera move style"),null;var d=a.render;b=b||{};b.min=d.distance_limits.min;b.max=d.distance_limits.max;return b};a.hover_set_vert_trans_limits=function(a,b){c.is_hover_camera(a)?b&&("number"!=typeof b.min||"number"!=typeof b.max||b.min>b.max)?f.error("hover_set_vert_trans_limits(): Wrong limits object"):(c.set_vert_trans_limits(a,b),g.update_transform(a),p.sync_transform(a)):f.error("hover_set_vert_trans_limits(): Wrong camera object or camera move style")};
a.hover_get_vert_trans_limits=function(a,b){if(!c.is_hover_camera(a))return f.error("hover_get_vert_trans_limits(): Wrong camera object or camera move style"),null;var d=a.render;return d.hover_vert_trans_limits?(b=b||{},b.min=d.hover_vert_trans_limits.min,b.max=d.hover_vert_trans_limits.max,b):null};a.hover_set_horiz_trans_limits=function(a,b){c.is_hover_camera(a)?b&&("number"!=typeof b.min||"number"!=typeof b.max||b.min>b.max)?f.error("hover_set_horiz_trans_limits(): Wrong limits object"):(c.set_hor_trans_limits(a,
b),g.update_transform(a),p.sync_transform(a)):f.error("hover_set_horiz_trans_limits(): Wrong camera object or camera move style")};a.hover_get_horiz_trans_limits=function(a,b){if(!c.is_hover_camera(a))return f.error("hover_get_horiz_trans_limits(): Wrong camera object or camera move style"),null;var d=a.render;return d.hover_horiz_trans_limits?(b=b||{},b.min=d.hover_horiz_trans_limits.min,b.max=d.hover_horiz_trans_limits.max,b):null};a.hover_switch_horiz_rotation=function(a,b){if(!c.is_hover_camera(a))return f.error("hover_switch_horiz_rotation(): Wrong camera object or camera move style"),
null;a.render.enable_hover_hor_rotation=b};a.is_static_camera=c.is_static_camera;a.is_target_camera=c.is_target_camera;a.is_eye_camera=c.is_eye_camera;a.is_hover_camera=c.is_hover_camera;a.set_move_style=function(a,b){if(!k.is_camera(a))return f.error("set_move_style(): Wrong camera object"),!1;if(b!=c.MS_STATIC&&b!=c.MS_EYE_CONTROLS&&b!=c.MS_TARGET_CONTROLS&&b!=c.MS_HOVER_CONTROLS)return f.error("set_move_style(): Wrong move style"),!1;c.set_move_style(a,b);g.update_transform(a);p.sync_transform(a);
return!0};a.get_move_style=function(a){return k.is_camera(a)?c.get_move_style(a):(f.error("get_move_style(): Wrong camera object"),null)};a.set_translation=function(a,b){if(k.is_camera(a)){var d=a.render;if(c.is_target_camera(a)){var h=m.get_trans_view(d.world_tsr),h=t.subtract(b,h,C);t.add(h,d.pivot,d.pivot)}else c.is_hover_camera(a)&&(h=m.get_trans_view(d.world_tsr),h=t.subtract(b,h,C),t.add(h,d.hover_pivot,d.hover_pivot));g.set_translation(a,b);g.update_transform(a);p.sync_transform(a)}else f.error("set_translation(): Wrong camera object")};
a.get_translation=function(a,b){if(!k.is_camera(a))return f.error("get_translation(): Wrong camera object"),null;b=b||new Float32Array(3);return g.get_translation(a,b)};a.rotate_camera=function(a,b,d,h,l){k.is_camera(a)?(h=h||!1,l=l||!1,c.is_target_camera(a)?c.rotate_target_camera(a,b,d,h,l):c.is_eye_camera(a)?c.rotate_eye_camera(a,b,d,h,l):c.is_hover_camera(a)?c.rotate_hover_camera(a,b,d,h,l):c.is_static_camera(a)?f.warn("rotate_camera(): not supported for STATIC cameras"):f.error("rotate_camera(): Wrong camera move style"),
g.update_transform(a),p.sync_transform(a)):f.error("rotate_camera(): Wrong camera object")};a.set_velocities=function(a,b){if(k.is_camera(a)){var c=a.render;"number"==typeof b.trans&&(c.velocity_trans=l.clamp(b.trans,0,Infinity));"number"==typeof b.rot&&(c.velocity_rot=l.clamp(b.rot,0,Infinity));"number"==typeof b.zoom&&(c.velocity_zoom=l.clamp(b.zoom,0,.99))}else f.error("set_velocities(): Wrong camera object")};a.get_velocities=function(a,b){if(!k.is_camera(a))return f.error("get_velocities(): Wrong camera object"),
null;var c=a.render;b=b||{};b.trans=c.velocity_trans;b.rot=c.velocity_rot;b.zoom=c.velocity_zoom;return b};a.is_look_up=function(a){if(!k.is_camera(a))return f.error("is_look_up(): Wrong camera object"),!1;a=m.get_quat_view(a.render.world_tsr);return 0<=l.quat_to_dir(a,l.AXIS_MY,C)[1]};a.get_camera_angles=function(a,b){if(!k.is_camera(a))return f.error("get_camera_angles(): Wrong camera object"),null;b=b||new Float32Array(2);c.get_camera_angles(a,b);return b};a.get_camera_angles_char=function(a,b){if(!k.is_camera(a))return f.error("get_camera_angles_char(): Wrong camera object"),
null;b=b||new Float32Array(2);c.get_camera_angles_char(a,b);return b};a.set_stereo_distance=function(a,b){if(k.is_camera(a))for(var d=w.get_active(),d=k.get_scene_data(a,d).cameras,g=0;g<d.length;g++){var h=d[g];h.type!=c.TYPE_STEREO_LEFT&&h.type!=c.TYPE_STEREO_RIGHT||c.set_stereo_params(h,b,h.stereo_eye_dist)}else f.error("set_stereo_distance(): Wrong camera object")};a.get_stereo_distance=function(a){if(!k.is_camera(a))return f.error("get_stereo_distance(): Wrong camera object"),0;var b=w.get_active();
a=k.get_scene_data(a,b).cameras;for(b=0;b<a.length;b++){var d=a[b];if(d.type==c.TYPE_STEREO_LEFT||d.type==c.TYPE_STEREO_RIGHT)return d.stereo_conv_dist}return 0};a.set_eye_distance=function(a,b){if(k.is_camera(a)){var d=w.get_active(),d=k.get_scene_data(a,d).cameras;c.set_eye_distance(d,b)}else f.error("set_eye_distance(): Wrong camera object")};a.get_eye_distance=function(a){if(!k.is_camera(a))return f.error("get_eye_distance(): Wrong camera object"),0;var b=w.get_active();a=k.get_scene_data(a,b).cameras;
for(b=0;b<a.length;b++){var d=a[b];if(d.type==c.TYPE_STEREO_LEFT||d.type==c.TYPE_STEREO_RIGHT||d.type==c.TYPE_HMD_LEFT||d.type==c.TYPE_HMD_RIGHT)return d.stereo_eye_dist}return 0};a.set_vertical_axis=function(a,b){k.is_camera(a)?(t.copy(b,a.render.vertical_axis),g.update_transform(a),p.sync_transform(a)):f.error("set_vertical_axis(): Wrong camera object")};a.get_vertical_axis=function(a,b){if(k.is_camera(a))return b||(b=t.create()),t.copy(a.render.vertical_axis,b),b;f.error("get_vertical_axis(): Wrong camera object")};
a.translate_view=function(a,b,g,h){if(k.is_camera(a)){var l=w.get_active();a=k.get_scene_data(a,l).cameras;for(l=0;l<a.length;l++){var m=a[l];m.reflection_plane||c.set_projection(m,m.aspect);var p=C;p[0]=-b;p[1]=-g;p[2]=0;d.translate(m.proj_matrix,p,m.proj_matrix);d.rotateZ(m.proj_matrix,h,m.proj_matrix);c.calc_view_proj_inverse(m);c.calc_sky_vp_inverse(m)}}else f.error("translate_view(): Wrong camera object")};a.get_view_vector=function(a,b){if(!k.is_camera(a))return f.error("get_view_vector(): Wrong camera object"),
null;b=b||new Float32Array(3);var c=m.get_quat_view(a.render.world_tsr);l.quat_to_dir(c,l.AXIS_MY,b);return b};a.get_fov=function(a){if(!k.is_camera(a))return f.error("get_fov(): Wrong camera object"),0;var b=w.get_active();a=k.get_scene_data(a,b).cameras;return l.deg_to_rad(a[0].fov)};a.set_fov=function(a,b){if(k.is_camera(a))for(var d=w.get_active(),d=k.get_scene_data(a,d).cameras,g=0;g<d.length;g++){var h=d[g];h.fov=l.rad_to_deg(b);h.reflection_plane||c.set_projection(h,h.aspect);c.calc_view_proj_inverse(h);
c.calc_sky_vp_inverse(h)}else f.error("set_fov(): Wrong camera object")};a.set_hmd_fov=function(a,b,d){var g;if(g=!k.is_camera(a)){a:{if(k.is_camera(a)){g=w.get_active();g=k.get_scene_data(a,g).cameras;for(var h=0;h<g.length;h++){var l=g[h];if(l.type==c.TYPE_HMD_LEFT||l.type==c.TYPE_HMD_RIGHT){g=!0;break a}}}else f.error("is_hmd_camera(): Wrong camera object");g=!1}g=!g}g?f.error("set_hmd_fov(): Wrong camera object"):b&&d&&c.set_hmd_fov(a,b,d)};a.correct_up=function(a,c,d){k.is_camera(a)?(c=c||a.render.vertical_axis,
b.correct_up(a,c,d||!1),g.update_transform(a),p.sync_transform(a)):f.error("correct_up(): Wrong camera object")};a.set_ortho_scale=function(a,b){if(k.is_camera(a)&&c.is_ortho_camera(a)){var d=a.render;if(c.is_target_camera(a)){var g=m.get_trans_view(d.world_tsr),g=t.dist(g,d.pivot);d.init_top=b/2*d.init_dist/g}else c.is_hover_camera(a)?(g=m.get_trans_view(d.world_tsr),g=t.distance(g,d.hover_pivot),d.init_top=b/2*d.init_dist/g):(d=w.get_active(),k.get_scene_data(a,d).cameras[0].top=b/2);c.update_ortho_scale(a)}else f.error("set_ortho_scale(): Wrong camera object")};
a.get_ortho_scale=function(a){if(!k.is_camera(a)||!c.is_ortho_camera(a))return f.error("get_ortho_scale(): Wrong camera object"),0;var b=w.get_active();return 2*k.get_scene_data(a,b).cameras[0].top};a.is_ortho_camera=function(a){return k.is_camera(a)?c.is_ortho_camera(a):(f.error("is_ortho_camera(): Wrong camera object"),!1)};a.calc_ray=function(a,b,d,p){if(!k.is_camera(a))return f.error("calc_ray(): Wrong camera object"),null;var r=w.get_active(),u=k.get_scene_data(a,r).cameras[0];p&&3==p.length?
f.error_once('dest parameter in the function "calc_ray" should be type of parametric line.'):p=p||new Float32Array(6);switch(u.type){case c.TYPE_PERSP:case c.TYPE_PERSP_ASPECT:case c.TYPE_STEREO_LEFT:case c.TYPE_STEREO_RIGHT:var v=Math.tan(u.fov*Math.PI/360),E=v*u.aspect,r=C;b=h.canvas_to_viewport_coords(b,d,H,u);r[0]=(2*b[0]/u.width-1)*E;r[1]=-1;r[2]=(2*b[1]/u.height-1)*v;m.transform_dir_vec3(r,a.render.world_tsr,r);t.normalize(r,r);3==p.length?t.copy(r,p):(a=g.get_translation(a,x),q.set_pline_initial_point(p,
a),q.set_pline_directional_vec(p,r));return p;case c.TYPE_ORTHO:return r=C,b=h.canvas_to_viewport_coords(b,d,H,u),r[0]=(2*b[0]/u.width-1)*u.top*u.aspect,r[1]=0,r[2]=(2*b[1]/u.height-1)*u.top,m.transform_vec3(r,a.render.world_tsr,r),t.copy(r,p),a=m.get_quat_view(a.render.world_tsr,y),t.transformQuat(l.AXIS_MY,a,r),q.set_pline_directional_vec(p,r),p;default:return f.error("calc_ray(): Non-compatible camera"),p}};a.project_point=function(a,b,d){if(!k.is_camera(a))return f.error("project_point(): Wrong camera object"),
null;d=d||new Float32Array(2);return c.project_point(a,b,d)};a.has_distance_limits=function(a){return(c.is_target_camera(a)||c.is_hover_camera(a))&&null!==a.render.distance_limits};a.has_vertical_rot_limits=function(a){return(c.is_eye_camera(a)||c.is_target_camera(a)||c.is_hover_camera(a))&&null!==a.render.vertical_limits};a.has_vertical_limits=function(a){f.error_deprecated("has_vertical_limits","has_vertical_rot_limits");return c.is_target_camera(a)||c.is_eye_camera(a)?null!==a.render.vertical_limits:
(f.error("has_vertical_limits(): Wrong camera object"),!1)};a.has_horizontal_rot_limits=function(a){return(c.is_target_camera(a)||c.is_eye_camera(a))&&null!==a.render.horizontal_limits};a.has_horizontal_limits=function(a){f.error_deprecated("has_horizontal_limits","has_horizontal_rot_limits");return c.is_target_camera(a)||c.is_eye_camera(a)?null!==a.render.horizontal_limits:(f.error("has_horizontal_limits(): Wrong camera object"),!1)};a.has_vertical_trans_limits=function(a){return c.is_hover_camera(a)&&
null!==a.render.hover_vert_trans_limits};a.has_horizontal_trans_limits=function(a){return c.is_hover_camera(a)&&null!==a.render.hover_horiz_trans_limits};a.move_pivot=function(a,b,d){f.error_deprecated("move_pivot","target_pan_pivot");if(c.is_target_camera(a)){var h=a.render;if(h.use_panning){var k=m.get_trans_view(h.world_tsr),l=t.subtract(k,h.pivot,x);C[0]=b;C[1]=0;C[2]=d;t.scale(C,t.len(l),C);m.transform_dir_vec3(C,h.world_tsr,C);t.add(h.pivot,C,h.pivot);t.add(k,C,k);g.update_transform(a);p.sync_transform(a)}}else f.error("move_pivot(): wrong object")};
a.set_velocity_params=function(a,b){f.error_deprecated("set_velocity_params","set_velocities");if(k.is_camera(a)){var c=a.render;c.velocity_trans=l.clamp(b[0],0,Infinity);c.velocity_rot=l.clamp(b[1],0,Infinity);c.velocity_zoom=l.clamp(b[2],0,.99)}else f.error("set_velocity_params(): Wrong camera object")};a.get_velocity_params=function(a,b){f.error_deprecated("get_velocity_params","get_velocities");if(!k.is_camera(a))return f.error("get_velocity_params(): Wrong camera object"),null;b=b||new Float32Array(3);
var c=a.render;b[0]=c.velocity_trans;b[1]=c.velocity_rot;b[2]=c.velocity_zoom;return b};a.clear_horizontal_limits=function(a){f.error_once('camera.clear_horizontal_limits() deprecated, use camera.target_set_horizontal_limits(), camera.eye_set_horizontal_limits() or camera.hover_set_horiz_trans_limits() with passing null as the "limits" argument.');k.is_camera(a)?c.is_target_camera(a)||c.is_eye_camera(a)?a.render.horizontal_limits=null:c.is_hover_camera(a)&&(a.render.hover_horiz_trans_limits=null):
f.error("clear_horizontal_limits(): Wrong camera object")};a.clear_vertical_limits=function(a){f.error_once('camera.clear_vertical_limits() deprecated, use camera.target_set_vertical_limits(), camera.eye_set_vertical_limits() or camera.hover_set_vert_trans_limits() with passing null as the "limits" argument.');k.is_camera(a)?c.is_target_camera(a)||c.is_eye_camera(a)?a.render.vertical_limits=null:c.is_hover_camera(a)&&(a.render.hover_vert_trans_limits=null):f.error("clear_vertical_limits(): Wrong camera object")};
a.clear_hover_angle_limits=function(a){f.error_once("camera.clear_hover_angle_limits() deprecated, HOVER camera always has hover angle limits")};a.set_look_at=function(a,d,h,k){f.error_deprecated_arr("camera.set_look_at",["camera.static_set_look_at","camera.eye_set_look_at"]);k=k||a.render.vertical_axis;c.set_look_at(a,d,h);b.correct_up(a,k,!0);g.update_transform(a);p.sync_transform(a)};a.rotate_eye_camera=function(a,b,d,h,k){f.error_deprecated_arr("camera.rotate_eye_camera",["camera.eye_rotate",
"camera.rotate_camera"]);c.is_eye_camera(a)?(c.rotate_eye_camera(a,b,d,h,k),g.update_transform(a),p.sync_transform(a)):f.error("rotate_eye_camera(): wrong object")};a.rotate_target_camera=function(a,b,d,h,k){f.error_deprecated_arr("camera.rotate_target_camera",["camera.target_rotate","camera.rotate_camera"]);c.is_target_camera(a)?(c.rotate_target_camera(a,b,d,h,k),g.update_transform(a),p.sync_transform(a)):f.error("rotate_target_camera(): wrong object")};a.set_trans_pivot=function(a,b,d){f.error_deprecated("camera.set_trans_pivot",
"camera.target_set_trans_pivot");c.is_target_camera(a)?(c.set_trans_pivot(a,b,d),g.update_transform(a),p.sync_transform(a)):f.error("set_trans_pivot(): Wrong object or camera move style")};a.zoom_object=function(a,b){f.error_deprecated("camera.zoom_object","camera.target_zoom_object");if(c.is_target_camera(a)){g.get_object_center(b,!1,C);u(a,C);g.update_transform(a);var d=g.get_object_size(b),h=w.get_active(),h=k.get_scene_data(a,h).cameras[0],h=c.get_angular_diameter(h)/2,d=d/Math.sin(h),h=g.obj_point_distance(a,
C);g.move_local(a,0,d-h,0);g.update_transform(a);p.sync_transform(a)}else f.error("zoom_object(): wrong object")};a.set_pivot=u;a.rotate_hover_camera=function(a,b,d,h,k){f.error_deprecated("camera.rotate_hover_camera","camera.hover_rotate");c.is_hover_camera(a)?(c.rotate_hover_camera(a,b,d,h,k),g.update_transform(a),p.sync_transform(a)):f.error("rotate_hover_camera(): wrong object")};a.get_hover_cam_pivot=function(a,b){f.error_deprecated("camera.get_hover_cam_pivot","camera.hover_get_pivot");if(!c.is_hover_camera(a))return f.error("get_hover_cam_pivot(): wrong object"),
null;b||(b=new Float32Array(3));t.copy(a.render.hover_pivot,b);return b};a.get_eye=function(a,b){f.error_deprecated("camera.get_eye","camera.get_translation");return k.is_camera(a)?c.get_eye(a,b):(f.error("get_eye(): Wrong object"),null)};a.get_pivot=function(a,b){f.error_deprecated("camera.get_pivot","camera.target_get_pivot");if(!c.is_target_camera(a))return f.error("get_pivot(): Wrong object or camera move style"),null;b||(b=new Float32Array(3));t.copy(a.render.pivot,b);return b};a.hover_cam_set_translation=
function(a,b){f.error_deprecated("camera.hover_cam_set_translation","camera.set_translation");if(c.is_hover_camera(a)){var d=a.render,h=m.get_trans_view(d.world_tsr),h=t.subtract(b,h,C);t.add(h,d.hover_pivot,d.hover_pivot);g.set_translation(a,b);g.update_transform(a);p.sync_transform(a)}else f.error("hover_cam_set_translation(): wrong object")};a.set_hover_pivot=function(a,b){f.error_deprecated("camera.set_hover_pivot","camera.hover_set_pivot_translation");c.is_hover_camera(a)?(c.set_hover_pivot(a,
b),g.update_transform(a),p.sync_transform(a)):f.error("set_hover_pivot(): Wrong object or camera move style")};a.get_hover_angle_limits=function(a,b){f.error_deprecated("camera.get_hover_angle_limits","camera.hover_get_vertical_limits");if(!c.is_hover_camera(a))return f.error("get_hover_angle_limits(): wrong object"),null;b=b||new Float32Array(2);b[0]=a.render.vertical_limits.down;b[1]=a.render.vertical_limits.up;return b};a.get_cam_dist_limits=function(a,b){f.error_deprecated_arr("camera.get_cam_dist_limits",
["camera.hover_get_distance_limits","camera.target_get_distance_limits"]);if(!c.is_hover_camera(a)&&!c.is_target_camera(a))return f.error("get_cam_dist_limits(): wrong object"),null;if(a.render.distance_limits)b=b||new Float32Array(2),b[0]=a.render.distance_limits.max,b[1]=a.render.distance_limits.min;else return null;return b};a.apply_vertical_limits=function(b,d,h,k){f.error_deprecated_arr("camera.apply_vertical_limits",["camera.eye_set_vertical_limits","camera.target_set_vertical_limits","camera.hover_set_vert_trans_limits"]);
if(c.is_target_camera(b)){var l=z;l.down=d;l.up=h;l.camera_space=k==g.SPACE_LOCAL;a.target_set_vertical_limits(b,l)}else c.is_eye_camera(b)?(l=z,l.down=d,l.up=h,l.camera_space=k==g.SPACE_LOCAL,a.eye_set_vertical_limits(b,l)):c.is_hover_camera(b)?(l=z,l.min=d,l.max=h,a.hover_set_vert_trans_limits(b,l)):f.error("apply_vertical_limits(): wrong object")};a.apply_hover_angle_limits=function(b,c,d){f.error_deprecated("camera.apply_hover_angle_limits","camera.hover_set_vertical_limits");z.down=c;z.up=d;
a.hover_set_vertical_limits(b,z)};a.apply_distance_limits=function(b,d,g){f.error_deprecated_arr("camera.apply_distance_limits",["camera.target_set_distance_limits","camera.hover_set_distance_limits"]);if(c.is_target_camera(b)){var h=z;h.min=d;h.max=g;a.target_set_distance_limits(b,h)}else c.is_hover_camera(b)?(h=z,h.min=d,h.max=g,a.hover_set_distance_limits(b,h)):f.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(b){f.error_deprecated("camera.clear_distance_limits",
"camera.target_set_distance_limits");a.target_set_distance_limits(b,null)};a.get_vertical_limits=function(a,b){f.error_deprecated_arr("camera.get_vertical_limits",["camera.eye_get_vertical_limits","camera.target_get_vertical_limits","camera.hover_get_vert_trans_limits"]);if(!c.is_target_camera(a)&&!c.is_eye_camera(a)&&!c.is_hover_camera(a))return f.error("get_vertical_limits(): wrong object"),null;var d=a.render;b=b||new Float32Array(2);if(c.is_eye_camera(a)||c.is_target_camera(a)){if(d.vertical_limits)return b[0]=
d.vertical_limits.down,b[1]=d.vertical_limits.up,b}else if(c.is_hover_camera(a)&&d.hover_vert_trans_limits)return b[0]=d.hover_vert_trans_limits.min,b[1]=d.hover_vert_trans_limits.max,b;return null};a.apply_horizontal_limits=function(b,d,h,k){f.error_deprecated_arr("camera.apply_horizontal_limits",["camera.eye_set_horizontal_limits","camera.target_set_horizontal_limits","camera.hover_set_horiz_trans_limits"]);if(c.is_target_camera(b)){var l=z;l.left=d;l.right=h;l.camera_space=k==g.SPACE_LOCAL;a.target_set_horizontal_limits(b,
l)}else c.is_eye_camera(b)?(l=z,l.left=d,l.right=h,l.camera_space=k==g.SPACE_LOCAL,a.eye_set_horizontal_limits(b,l)):c.is_hover_camera(b)?(l=z,l.min=d,l.max=h,a.hover_set_horiz_trans_limits(b,l)):f.error("apply_horizontal_limits(): wrong object")};a.get_horizontal_limits=function(a,b){f.error_deprecated_arr("camera.get_horizontal_limits",["camera.eye_get_horizontal_limits","camera.target_get_horizontal_limits","camera.hover_get_horiz_trans_limits"]);if(!c.is_target_camera(a)&&!c.is_eye_camera(a)&&
!c.is_hover_camera(a))return f.error("get_horizontal_limits(): wrong object"),null;var d=a.render;b=b||new Float32Array(2);if(c.is_eye_camera(a)||c.is_target_camera(a)){if(d.horizontal_limits)return b[0]=d.horizontal_limits.left,b[1]=d.horizontal_limits.right,b}else if(c.is_hover_camera(a)&&d.hover_horiz_trans_limits)return b[0]=d.hover_horiz_trans_limits.min,b[1]=d.hover_horiz_trans_limits.max,b;return null};a.get_frustum_planes=function(a,b){if(!k.is_camera(a))return f.error("get_frustum_planes(): Wrong camera object"),
null;var c=w.get_active(),c=k.get_scene_data(a,c).cameras[0].frustum_planes;F.copy(c.left,b.left);F.copy(c.right,b.right);F.copy(c.top,b.top);F.copy(c.bottom,b.bottom);F.copy(c.near,b.near);F.copy(c.far,b.far);return b}};b4w.module.config=function(a,r){var u=r("__config");a.P_LOW=u.P_LOW;a.P_HIGH=u.P_HIGH;a.P_ULTRA=u.P_ULTRA;a.P_CUSTOM=u.P_CUSTOM;a.set=u.set;a.get=u.get;a.reset=u.reset;a.get_std_assets_path=u.get_std_assets_path};b4w.module.controls=function(a,r){var u=r("__controls"),c=r("__print");a.CT_POSITIVE=u.CT_POSITIVE;a.CT_CONTINUOUS=u.CT_CONTINUOUS;a.CT_TRIGGER=u.CT_TRIGGER;a.CT_SHOT=u.CT_SHOT;a.CT_LEVEL=u.CT_LEVEL;a.CT_CHANGE=u.CT_CHANGE;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;
a.KEY_8=56;a.KEY_9=57;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=
187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=u.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=u.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=u.PL_MULTITOUCH_MOVE_PAN;a.PL_MULTITOUCH_MOVE_ROTATE=u.PL_MULTITOUCH_MOVE_ROTATE;a.create_gamepad_btn_sensor=u.create_gamepad_btn_sensor;a.create_gamepad_axis_sensor=u.create_gamepad_axis_sensor;
a.create_custom_sensor=u.create_custom_sensor;a.create_keyboard_sensor=u.create_keyboard_sensor;a.create_collision_sensor=function(a,c,d){return u.create_collision_sensor(a,c||"ANY",d||!1)};a.create_collision_impulse_sensor=u.create_collision_impulse_sensor;a.create_ray_sensor=function(a,c,d,q,k,p,f){return u.create_ray_sensor(a,c,d,q||"ANY",k||!1,p||!1,f||!1)};a.create_mouse_click_sensor=u.create_mouse_click_sensor;a.create_mouse_wheel_sensor=u.create_mouse_wheel_sensor;a.create_mouse_move_sensor=
u.create_mouse_move_sensor;a.create_touch_move_sensor=u.create_touch_move_sensor;a.create_touch_zoom_sensor=u.create_touch_zoom_sensor;a.create_touch_rotate_sensor=u.create_touch_rotate_sensor;a.create_touch_click_sensor=u.create_touch_click_sensor;a.create_motion_sensor=u.create_motion_sensor;a.create_vertical_velocity_sensor=u.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=u.create_gyro_angles_sensor;a.create_gyro_quat_sensor=u.create_gyro_quat_sensor;a.create_gyro_delta_sensor=u.create_gyro_delta_sensor;
a.create_hmd_quat_sensor=u.create_hmd_quat_sensor;a.create_hmd_position_sensor=u.create_hmd_position_sensor;a.create_timer_sensor=function(a,c){return u.create_timer_sensor(a,c||!1)};a.reset_timer_sensor=u.reset_timer_sensor;a.create_elapsed_sensor=u.create_elapsed_sensor;a.create_timeline_sensor=u.create_timeline_sensor;a.create_selection_sensor=function(a,c){return u.create_selection_sensor(a,c||!1)};a.create_callback_sensor=function(a,c){return u.create_callback_sensor(a,c||0)};a.set_custom_sensor=
function(a,c){u.sensor_set_value(a,c)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=u.get_sensor_value;a.get_sensor_payload=u.get_sensor_payload;a.create_sensor_manifold=function(a,c,d,q,k,p,f){k=k||u.default_AND_logic_fun;u.create_sensor_manifold(a,c,d,q,k,p,void 0===f?null:f)};a.create_kb_sensor_manifold=function(a,c,d,q,k,p){q=u.create_keyboard_sensor(q);u.create_sensor_manifold(a,c,d,[q],u.default_AND_logic_fun,k,void 0===p?null:p)};a.check_sensor_manifolds=function(a){return u.check_sensor_manifold(a,
null)};a.check_sensor_manifold=u.check_sensor_manifold;a.remove_sensor_manifold=u.remove_sensor_manifold;a.reset=u.reset;a.register_keyboard_events=function(){c.error_once("controls.register_keyboard_events() deprecated")};a.register_mouse_events=function(){c.error_once("controls.register_mouse_events() deprecated")};a.register_wheel_events=function(){c.error_once("controls.register_wheel_events() deprecated")};a.register_touch_events=function(){c.error_once("controls.register_touch_events() deprecated")};
a.register_device_orientation=function(){c.error_once("controls.register_device_orientation() deprecated")};a.unregister_keyboard_events=function(){c.error_once("controls.unregister_keyboard_events() deprecated")};a.unregister_mouse_events=function(){c.error_once("controls.unregister_mouse_events() deprecated")};a.unregister_wheel_events=function(){c.error_once("controls.unregister_wheel_events() deprecated")};a.unregister_touch_events=function(){c.error_once("controls.unregister_touch_events() deprecated")};
a.unregister_device_orientation=function(){c.error_once("controls.unregister_device_orientation() deprecated")}};b4w.module.constraints=function(a,r){var u=r("__camera"),c=r("__constraints"),b=r("__obj_util"),h=r("__physics"),d=r("__print"),q=r("__transform");a.append_stiff=function(a,b,d,r,g){g=g||1;b instanceof Array&&2==b.length?c.append_stiff_bone(a,b[0],b[1],d,r,g):c.append_stiff_obj(a,b,d,r,g);q.update_transform(a);h.sync_transform(a)};a.append_semi_stiff=function(a,b,d,r){c.append_semi_stiff_obj(a,b,d,r);q.update_transform(a);h.sync_transform(a)};a.append_semi_stiff_cam=function(a,b,f,r,g,m,l,t){u.is_eye_camera(a)?
(g=g||-Math.PI/2,m=m||Math.PI/2,l=l||Math.PI/2,t=t||-Math.PI/2,c.append_semi_stiff_cam_obj(a,b,f,r,g,m,l,t),q.update_transform(a),h.sync_transform(a)):d.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented.")};a.append_semi_soft_cam=function(a,b,f,r){if(u.is_eye_camera(a)){if(!r||0>r)r=.25;c.append_semi_soft_cam_obj(a,b,f,r);q.update_transform(a);h.sync_transform(a)}else d.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented.")};
a.append_stiff_trans=function(a,b,d){c.append_stiff_trans_obj(a,b,d);q.update_transform(a);h.sync_transform(a)};a.append_copy_trans=function(a,b,d){c.append_copy_trans_obj(a,b,d);q.update_transform(a);h.sync_transform(a)};a.append_stiff_trans_rot=function(a,b,d,r){c.append_stiff_trans_rot_obj(a,b,d,r,1);q.update_transform(a);h.sync_transform(a)};a.append_track=function(a,b){3==b.length?c.append_track_point(a,b):c.append_track_obj(a,b);q.update_transform(a);h.sync_transform(a)};a.append_follow=function(a,
b,d,r){3==b.length?c.append_follow_point(a,b,d,r):c.append_follow_obj(a,b,d,r);q.update_transform(a);h.sync_transform(a)};a.append_stiff_viewport=function(a,b,d){c.append_stiff_viewport(a,b,d);q.update_transform(a);h.sync_transform(a)};a.remove=function(a){a.constraint&&c.remove(a)};a.get_parent=function(a){d.error_deprecated("constraints.get_parent","objects.get_parent");return b.get_parent(a)}};b4w.module.container=function(a,r){var u=r("__container"),c=r("__print");a.get_canvas=u.get_canvas;a.get_canvas_hud=u.get_canvas_hud;a.get_container=u.get_container;a.insert_to_container=function(a,h){2!=arguments.length?c.error("insert_to_container(): two arguments required"):a&&h&&u.insert_to_container(a,h)};a.set_canvas_offsets=u.set_canvas_offsets;a.update_canvas_offsets=u.update_canvas_offsets;a.client_to_canvas_coords=u.client_to_canvas_coords;a.force_offsets_updating=u.force_offsets_updating;
a.resize=function(a,h,d){a&&h||c.warn("Wrong canvas container dimensions: "+a+"x"+h+". Zero dimensions aren't allowed. Resized to: "+u.DEFAULT_CANVAS_W+"x"+u.DEFAULT_CANVAS_H+".");u.resize(a,h,d)}};b4w.module.data=function(a,r){var u=r("__data"),c=r("__loader");r("__print");a.load=u.load;a.unload=function(a){u.unload(a|0)};a.set_debug_resources_root=u.set_debug_resources_root;a.is_primary_loaded=u.is_primary_loaded;a.is_idle=c.is_finished;a.load_and_add_new=u.load;a.cleanup=a.unload;a.activate_media=u.activate_media};b4w.module.debug=function(a,r){function u(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function c(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);c.send(b);
if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function b(a){a.sort(function(a,b){return b.fstats.ALU_OPS-a.fstats.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.fstats,e=c.vstats,g=h(c.cshader),g=g?"\t\t("+g.join(", ")+")":"\t\t(NA)";F.groupCollapsed("FRAG --\x3e","ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",e.ALU_OPS,"TEX",e.TEX_OPS,g);F.groupCollapsed("directives");for(var g=c.shaders_info.directives,f=0;f<g.length;f++){var k=g[f];F.log(k[0],k[1])}F.groupEnd();
F.groupCollapsed("vert src");F.log(c.vsrc);F.groupEnd();F.groupCollapsed("vert stats");for(var l in e)"ALU_OPS"!=l&&"TEX_OPS"!=l&&F.log(l,e[l]);F.groupEnd();F.groupCollapsed("frag src");F.log(c.fsrc);F.groupEnd();F.groupCollapsed("frag stats");for(l in d)"ALU_OPS"!=l&&"TEX_OPS"!=l&&F.log(l,d[l]);F.groupEnd();F.groupEnd()}}function h(a){for(var b=C.get_all_scenes(),c=0;c<b.length;c++)for(var d=b[c],e=m.get_scene_objs(d,"MESH",m.DATA_ID_ALL),g=0;g<e.length;g++){var f=l.get_scene_data(e[g],d);if(f&&
f.batches.length)for(var f=f.batches,h=0;h<f.length;h++){var k=f[h];if(k.shader==a&&k.material_names.length)return k.material_names}}return null}function d(a,b){var c=function(){M.push(c);D=b;return a.apply(a,arguments)};return c}function q(a,b,c){if(typeof b!=typeof a)throw"Wrong expected data type.";if(a.length!=b.length)throw"Wrong expected vector length.";c=c?c:1E-6;for(var d=0;d<a.length;d++)if(b[d]>a[d]+c||b[d]<a[d]-c)throw"Wrong result.";}r("__config");var k=r("__controls"),p=r("__container"),
f=r("__debug"),w=r("__extensions"),g=r("__loader"),m=r("__objects"),l=r("__obj_util"),t=r("__physics"),F=r("__print"),H=r("__renderer"),C=r("__scenes"),x=r("__scenegraph"),y=r("__sfx"),z=r("__shaders"),E=r("__textures"),e=r("__util"),n=r("__vec3"),M=[],D="",G=!0,Q=new Float32Array(2);a.DV_NONE=f.DV_NONE;a.DV_OPAQUE_WIREFRAME=f.DV_OPAQUE_WIREFRAME;a.DV_TRANSPARENT_WIREFRAME=f.DV_TRANSPARENT_WIREFRAME;a.DV_FRONT_BACK_VIEW=f.DV_FRONT_BACK_VIEW;a.DV_DEBUG_SPHERES=f.DV_DEBUG_SPHERES;a.DV_CLUSTERS_VIEW=
f.DV_CLUSTERS_VIEW;a.DV_BATCHES_VIEW=f.DV_BATCHES_VIEW;a.physics_stats=function(){t.debug_workers()};a.physics_id=function(a){F.log("O",t.find_obj_by_body_id(a));for(var b=t.get_active_scene()._physics.bundles,c=0;c<b.length;c++){var d=b[c];d.physics.body_id==a&&F.log("B",d)}};a.visible_objects=function(){for(var a=C.get_active(),b=m.get_scene_objs(a,"MESH",m.DATA_ID_ALL),a=[C.get_subs(a,"MAIN_OPAQUE"),C.get_subs(a,"MAIN_BLEND"),C.get_subs(a,"MAIN_GLOW")],c=0;c<a.length;c++){var d=a[c],e=d.bundles;
if(e.length){F.group(d.type,"DYNAMIC");for(var g=0;g<b.length;g++){var f=b[g],h=f.render;if("DYNAMIC"==h.type)for(var k=0;k<e.length;k++){var l=e[k];if(l.do_render&&l.obj_render==h){F.log_raw(f.name,f);break}}}F.groupEnd();F.groupCollapsed(d.type,"STATIC");for(g=0;g<b.length;g++)if(f=b[g],h=f.render,"DYNAMIC"!=h.type)for(k=0;k<e.length;k++)if(l=e[k],l.do_render&&l.obj_render==h){F.log_raw(f.name,f);break}F.groupEnd()}}};a.object_info=function(a){for(var b=C.get_active(),c=m.get_scene_objs(b,"MESH",
m.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];if(e.name==a){F.log("Object",e);for(var g=C.get_all_subscenes(b),f=0;f<g.length;f++){for(var h=g[f],k=h.bundles,l=[],n=0;n<k.length;n++)k[n].obj_render==e.render&&l.push(k[n]);F.log("Subscene "+h.type,l)}}}};a.objects_stat=function(){var a=C.get_active();console.log("Armatures: "+m.get_scene_objs(a,"ARMATURE",m.DATA_ID_ALL).length);console.log("Cameras: "+m.get_scene_objs(a,"CAMERA",m.DATA_ID_ALL).length);console.log("Curves: "+m.get_scene_objs(a,"CURVE",
m.DATA_ID_ALL).length);console.log("Empties: "+m.get_scene_objs(a,"EMPTY",m.DATA_ID_ALL).length);console.log("Lamps: "+m.get_scene_objs(a,"LAMP",m.DATA_ID_ALL).length);console.log("Meshes: "+m.get_scene_objs(a,"MESH",m.DATA_ID_ALL).length);console.log("Speakers: "+m.get_scene_objs(a,"SPEAKER",m.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=C.get_active(),b=[C.get_subs(b,"MAIN_OPAQUE"),C.get_subs(b,"MAIN_BLEND"),C.get_subs(b,"MAIN_GLOW")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=
d.bundles,e=0;e<d.length;e++){var g=d[e].batch;g&&(a+=g.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=C.get_active(),b=[C.get_subs(b,"MAIN_OPAQUE"),C.get_subs(b,"MAIN_BLEND"),C.get_subs(b,"MAIN_GLOW")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.bundles,e=0;e<d.length;e++){var g=d[e].batch;g&&(a+=g.num_triangles)}}return a};a.num_draw_calls=function(){for(var a=C.get_active(),b=[C.get_subs(a,"MAIN_OPAQUE"),C.get_subs(a,"MAIN_BLEND"),C.get_subs(a,"MAIN_GLOW")],c=0,d=0;d<b.length;d++){var e=
b[d];e&&(c+=e.bundles.length)}a=C.subs_array(a,["MAIN_PLANE_REFLECT","MAIN_PLANE_REFLECT_BLEND","MAIN_CUBE_REFLECT","MAIN_CUBE_REFLECT_BLEND"]);for(d=0;d<a.length;d++)e=a[d],c="MAIN_PLANE_REFLECT"==e.type||"MAIN_PLANE_REFLECT_BLEND"==e.type?c+e.bundles.length:c+6*e.bundles.length;return c};a.num_shaders=function(){var a=z.get_compiled_shaders();return e.get_dict_length(a)};a.geometry_stats=function(){for(var a=C.get_active(),b=C.get_all_subscenes(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=
d.type&&"DEBUG_VIEW"!=d.type)for(var e=d.bundles,g=0;g<e.length;g++){var f=e[g].batch,h=e[g].obj_render;f&&("COLOR_PICKING"!=d.type&&"OUTLINE_MASK"!=d.type||h.origin_selectable||h.origin_outlining)&&(a[f.id]=f)}}var e=d=c=b=0,k;for(k in a)f=a[k],f=f.bufs_data,f.debug_ibo_bytes&&(d++,e+=f.debug_ibo_bytes/1048576),b++,c+=f.debug_vbo_bytes/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=C.get_active(),c=[C.get_subs(c,"MAIN_OPAQUE"),C.get_subs(c,
"MAIN_BLEND"),C.get_subs(c,"MAIN_GLOW")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=e.bundles,g=0;g<e.length;g++){var f=e[g].batch;if(f)for(var f=f.textures,h=0;h<f.length;h++){var k=f[h];if("IMAGE"===k.source||"ENVIRONMENT_MAP"===k.source){var l=k.w_texture;-1===a.indexOf(l)&&(a.push(l),k=k.width*k.height*4/1048576/k.compress_ratio,k*=1.3333,b+=k)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=C.get_active(),c=C.get_all_subscenes(c),d=0;d<c.length;d++){var e=
c[d];if("SINK"!=e.type){var g=e.camera,f=[g.color_attachment,g.depth_attachment];f.push.apply(f,e.textures_internal);for(e=0;e<f.length;e++){var h=f[e];E.is_texture(h)&&-1==a.indexOf(h)&&(a.push(h),b+=g.width*g.height*E.get_texture_texel_size(h))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=C.get_active();(a=C.get_subs(a,"MAIN_OPAQUE"))&&C.make_frustum_shot(a.camera,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=C.get_active(),b=C.get_subs(a,"MAIN_OPAQUE"),
a=C.subs_array(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}C.make_frustum_shot(d.camera,b,e)}};a.scenegraph_to_dot=function(){for(var a=C.get_all_scenes(),b=0;b<a.length;b++){var c=C.get_graph(a[b]);F.log("\n"+x.debug_convert_to_dot(c))}};a.scenes_to_dot=function(){};a.loading_graph_to_dot=function(a){F.log("\n"+g.graph_to_dot(a|0))};a.controls_info=k.debug;a.object_distance=function(a,
b){var c=m_tsr.get_trans_view(a.render.world_tsr),d=m_tsr.get_trans_view(b.render.world_tsr);return n.dist(c,d)};a.msg=f.msg;a.fbmsg=f.fbmsg;a.print_telemetry=f.print_telemetry;a.plot_telemetry=f.plot_telemetry;a.fbres=function(a,b){b||(b=16);var c=function(){f.fbmsg("FBRES",a());setTimeout(c,b)};c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),g=new Float32Array([0,0,1]),f=new Float32Array([-1,0,0]),
h=new Float32Array([0,-1,0]),k=new Float32Array([0,0,-1]);if(!e.cmp_arr(a,e.VEC3_IDENT))throw"Wrong VEC3_IDENT";if(!e.cmp_arr(b,e.QUAT4_IDENT))throw"Wrong QUAT4_IDENT";if(!e.cmp_arr(c,e.AXIS_X))throw"Wrong AXIS_X";if(!e.cmp_arr(d,e.AXIS_Y))throw"Wrong AXIS_Y";if(!e.cmp_arr(g,e.AXIS_Z))throw"Wrong AXIS_Z";if(!e.cmp_arr(f,e.AXIS_MX))throw"Wrong AXIS_MX";if(!e.cmp_arr(h,e.AXIS_MY))throw"Wrong AXIS_MY";if(!e.cmp_arr(k,e.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=y.get_speaker_objects(),
b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==y.get_spk_behavior(c)&&y.mute(c,!0)}};a.check_finite=function(a){f.check_finite(a)};a.set_debug_params=function(a){var b=C.get_active();if(b=C.get_subs(b,"DEBUG_VIEW")){if("number"==typeof a.debug_view_mode)switch(a.debug_view_mode){case f.DV_NONE:case f.DV_OPAQUE_WIREFRAME:case f.DV_TRANSPARENT_WIREFRAME:case f.DV_FRONT_BACK_VIEW:case f.DV_DEBUG_SPHERES:case f.DV_CLUSTERS_VIEW:case f.DV_BATCHES_VIEW:C.set_debug_view_mode(b,a.debug_view_mode);break;
default:F.error("set_debug_params(): Wrong debug view mode")}"number"==typeof a.debug_colors_seed&&C.set_debug_colors_seed(b,a.debug_colors_seed);"object"==typeof a.wireframe_edge_color&&C.set_wireframe_edge_color(b,a.wireframe_edge_color)}else throw"Debug view subscene not found.";};a.get_error_quantity=function(){return F.get_error_count()};a.get_warning_quantity=function(){return F.get_warning_count()};a.clear_errors_warnings=function(){return F.clear_errors_warnings()};a.analyze_shaders=function(a){var d=
z.get_compiled_shaders(),e=0,g;for(g in d)a&&-1===g.indexOf(a)||e++;var e="of "+e+" analyzing...",f={};for(g in d)if(!a||-1!==g.indexOf(a)){var h=d[g],k;var l=h.vshader;k=h.fshader;var m=w.get_debug_shaders();if(m){l=m.getTranslatedShaderSource(l);k=m.getTranslatedShaderSource(k);l=l.replace("#version","#version 400 //");k=k.replace("#version","#version 400 //");var m=c("/nvidia_vert",l),n=u(m),p=c("/nvidia_frag",k),q=u(p);k={vsrc:l,vout:m,vstats:n,fsrc:k,fout:p,fstats:q}}else F.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),
k=void 0;m=h.shaders_info;l=m.vert+" + "+m.frag;k.cshader=h;k.shaders_info=m;h=f[l]=f[l]||[];h.push(k);F.log(e)}for(l in f)F.group("%c"+l,"color: #800"),h=f[l],b(h),F.groupEnd()};a.fake_load=f.fake_load;a.test_performance=function(a){if(w.get_disjoint_timer_query()){var b=x.create_performance_graph();C.generate_auxiliary_batches(b);for(var c=x.find_subs(b,"PERFORMANCE"),b=0;10>b;b++)H.draw(c);window.setTimeout(function(){f.process_timer_queries(c);a(c.debug_render_time)},100)}else a(-1)};a.start_debug=
function(a){M=[];G=!0;a=r(a);for(var b in a)"function"===typeof a[b]&&(a[b]=d(a[b],b))};a.check_debug_result=function(){return G};a.test=function(a,b){try{return b(),!0}catch(c){return G=!1,console.error(a+" test was failed. ",c),!1}};a.pix=function(a){var b=p.get_viewport_width(),c=p.get_viewport_height(),d=b/2,g=c/2;p.resize(b,c,!1);b=C.get_active()._render.graph;(c=x.find_on_screen(b))||e.panic("Couldn't find onscreen subscene");b=c.camera;d=p.canvas_to_viewport_coords(d,g,Q,c.camera);d[1]=b.height-
d[1];d=H.read_pixels(b.framebuffer,d[0],d[1]);q(a,d)};a.eqs=function(a,b){if(JSON.stringify(a)!=JSON.stringify(b))throw"Wrong result. Function: "+D;};a.eqv=q;a.eqf=function(a,b,c){if("number"!=typeof b)throw"Wrong expected data type.";c=c?c:1E-6;if(b>a+c||b<a-c)throw"Wrong result.";};a.eq=function(a,b){if(a!==b)throw"Wrong result.";};a.stat=function(a){a=r(a);for(var b in a)-1==M.indexOf(a[b])&&console.warn(b+" function wasn't called.")};a.ok=function(a){if(!Boolean(a))throw"Wrong result. Function: "+
D;}};b4w.module.geometry=function(a,r){var u=r("__batch"),c=r("__geometry"),b=r("__print"),h=r("__renderer");a.extract_vertex_array=function(a,h,k){if(!c.has_dyn_geom(a))return b.error("Wrong object:",a.name),null;if(a=u.find_batch_material(a,h,"MAIN")){if((h=a.bufs_data)&&h.pointers&&h.pointers[k])return c.extract_array(h,k);b.error("Attribute not found:"+k);return null}b.error("Wrong material:",h);return null};a.extract_index_array=function(a,h){if(!c.has_dyn_geom(a))return b.error("Wrong object:",a.name),
null;var k=u.find_batch_material(a,h,"MAIN");if(k){if((k=k.bufs_data)&&k.pointers)return k.ibo_array;b.error("Buffer data not found");return null}b.error("Wrong material:",h);return null};a.update_vertex_array=function(a,h,k,p){var f=["MAIN","SHADOW","COLOR_ID"];if(c.has_dyn_geom(a))for(var r=0;r<f.length;r++){var g=u.find_batch_material(a,h,f[r]);g&&(g=g.bufs_data)&&g.pointers&&g.pointers[k]&&c.update_bufs_data_array(g,k,0,p)}else b.error("Wrong object:",a.name)};a.override_geometry=function(a,q,
k,p,f){var r=["MAIN","SHADOW","COLOR_ID"];if(c.has_dyn_geom(a))if(k instanceof Uint16Array||k instanceof Uint32Array)if(p instanceof Float32Array)for(var g=0;g<r.length;g++){var m=u.find_batch_material(a,q,r[g]);if(m){var l=m.bufs_data;if(l){c.update_bufs_data_index_array(l,m.draw_mode,k);var t=0,F;for(F in l.pointers)var H=l.pointers[F],t=t+p.length/3*H.num_comp;l.vbo_array=new Float32Array(t);var t=l.vbo_array,C=0;for(F in l.pointers)switch(H=l.pointers[F],F){case "a_position":t.set(p,C);H.offset=
C;H.length=p.length;C+=H.length;break;case "a_normal":var x;f&&(x=c.calc_shared_indices(k,p,p));var y=c.calc_normals(k,p,x);t.set(y,C);H.offset=C;H.length=p.length;C+=H.length;break;case "a_tangent":H.offset=C;H.length=p.length/3*H.num_comp;for(var y=new Float32Array(H.length),z=0;z<y.length;z+=4)y[z]=1,y[z+3]=1;t.set(y,C);C+=H.length;break;default:H.offset=C,H.length=p.length/3*H.num_comp,y=new Float32Array(H.length),t.set(y,C),C+=H.length}c.update_gl_buffers(l);h.assign_attribute_setters(m);(m=
u.find_batch_material_forked(a,m))&&m.bufs_data&&(m.bufs_data=l)}}}else b.error("Wrong positions_array type");else b.error("Wrong ibo_array type");else b.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,h,k){c.check_shape_keys(a)?c.has_shape_key(a,h)?(k=parseFloat(k),c.apply_shape_key(a,h,k)):b.error("Wrong key name:",h):b.error("Wrong object:",a.name)};a.check_shape_keys=function(a){return c.check_shape_keys(a)};a.get_shape_keys_names=function(a){return c.check_shape_keys(a)?c.get_shape_keys_names(a):
(b.error("Wrong object:",a.name),null)};a.get_shape_key_value=function(a,h){return c.check_shape_keys(a)?c.has_shape_key(a,h)?c.get_shape_key_value(a,h):(b.error("Wrong key name:",h),null):(b.error("Wrong object:",a.name),null)};a.draw_line=function(a,q,k){k=k||!1;if(q instanceof Float32Array){if(a=u.get_first_batch(a))c.draw_line(a,q,k),h.assign_attribute_setters(a)}else b.error("Wrong positions type")}};b4w.module.hud=function(a,r){var u=r("__hud");r("__print");a.draw_mixer_strip=u.draw_mixer_strip;a.plot_array=u.plot_array};b4w.module.input=function(a,r){function u(){for(var a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],b=[],c=0;c<a.length;c++)a[c]&&b.push(c);return b}var c=r("__input"),b=r("__camera"),h=r("__container"),d=r("__obj_util"),q=r("__print"),k=r("__scenes"),p=r("__vec4"),f=p.create(),w=p.create(),g=!1;a.GMPD_BUTTON_12=c.GMPD_BUTTON_12;a.GMPD_BUTTON_13=c.GMPD_BUTTON_13;a.GMPD_BUTTON_15=c.GMPD_BUTTON_15;a.GMPD_BUTTON_14=c.GMPD_BUTTON_14;a.GMPD_BUTTON_3=
c.GMPD_BUTTON_3;a.GMPD_BUTTON_0=c.GMPD_BUTTON_0;a.GMPD_BUTTON_1=c.GMPD_BUTTON_1;a.GMPD_BUTTON_2=c.GMPD_BUTTON_2;a.GMPD_BUTTON_5=c.GMPD_BUTTON_5;a.GMPD_BUTTON_7=c.GMPD_BUTTON_7;a.GMPD_BUTTON_4=c.GMPD_BUTTON_4;a.GMPD_BUTTON_6=c.GMPD_BUTTON_6;a.GMPD_BUTTON_8=c.GMPD_BUTTON_8;a.GMPD_BUTTON_9=c.GMPD_BUTTON_9;a.GMPD_BUTTON_10=c.GMPD_BUTTON_10;a.GMPD_BUTTON_11=c.GMPD_BUTTON_11;a.GMPD_BUTTON_16=c.GMPD_BUTTON_16;a.GMPD_BUTTON_17=c.GMPD_BUTTON_17;a.GMPD_BUTTON_18=c.GMPD_BUTTON_18;a.GMPD_BUTTON_19=c.GMPD_BUTTON_19;
a.GMPD_BUTTON_20=c.GMPD_BUTTON_20;a.GMPD_BUTTON_21=c.GMPD_BUTTON_21;a.GMPD_BUTTON_22=c.GMPD_BUTTON_22;a.GMPD_BUTTON_23=c.GMPD_BUTTON_23;a.GMPD_BUTTON_24=c.GMPD_BUTTON_24;a.GMPD_BUTTON_25=c.GMPD_BUTTON_25;a.GMPD_AXIS_0=c.GMPD_AXIS_0;a.GMPD_AXIS_1=c.GMPD_AXIS_1;a.GMPD_AXIS_2=c.GMPD_AXIS_2;a.GMPD_AXIS_3=c.GMPD_AXIS_3;a.GMPD_AXIS_4=c.GMPD_AXIS_4;a.GMPD_AXIS_5=c.GMPD_AXIS_5;a.GMPD_AXIS_6=c.GMPD_AXIS_6;a.GMPD_AXIS_7=c.GMPD_AXIS_7;a.GMPD_AXIS_8=c.GMPD_AXIS_8;a.GMPD_AXIS_9=c.GMPD_AXIS_9;a.GMPD_AXIS_10=c.GMPD_AXIS_10;
a.GMPD_AXIS_11=c.GMPD_AXIS_11;a.HMD_ORIENTATION_QUAT=c.HMD_ORIENTATION_QUAT;a.HMD_POSITION=c.HMD_POSITION;a.HMD_WEBVR_TYPE=c.HMD_WEBVR_TYPE;a.HMD_WEBVR_DESKTOP=c.HMD_WEBVR_DESKTOP;a.HMD_WEBVR_MOBILE=c.HMD_WEBVR_MOBILE;a.HMD_NON_WEBVR=c.HMD_NON_WEBVR;var m=c.HMD_EYE_DISTANCE;a.HMD_EYE_DISTANCE=m;a.HMD_DISTORTION=c.HMD_DISTORTION;a.HMD_BASELINE_DIST=c.HMD_BASELINE_DIST;a.HMD_SCREEN_LENSE_DIST=c.HMD_SCREEN_LENSE_DIST;a.HMD_SCREEN_WIDTH=c.HMD_SCREEN_WIDTH;a.HMD_SCREEN_HEIGHT=c.HMD_SCREEN_HEIGHT;a.HMD_BEVEL_SIZE=
c.HMD_BEVEL_SIZE;a.MOUSE_LOCATION=c.MOUSE_LOCATION;a.MOUSE_DOWN_WHICH=c.MOUSE_DOWN_WHICH;a.MOUSE_UP_WHICH=c.MOUSE_UP_WHICH;a.MOUSE_WHEEL=c.MOUSE_WHEEL;a.KEYBOARD_UP=c.KEYBOARD_UP;a.KEYBOARD_DOWN=c.KEYBOARD_DOWN;a.TOUCH_START=c.TOUCH_START;a.TOUCH_MOVE=c.TOUCH_MOVE;a.TOUCH_END=c.TOUCH_END;a.GYRO_ORIENTATION_QUAT=c.GYRO_ORIENTATION_QUAT;a.GYRO_ORIENTATION_ANGLES=c.GYRO_ORIENTATION_ANGLES;var l={};l[c.DEVICE_HMD]=[c.HMD_ORIENTATION_QUAT,c.HMD_POSITION];l[c.DEVICE_MOUSE]=[c.MOUSE_LOCATION];var t={};t[c.DEVICE_HMD]=
[c.HMD_WEBVR_TYPE];var F={};F[c.DEVICE_MOUSE]=[c.MOUSE_LOCATION,c.MOUSE_DOWN_WHICH,c.MOUSE_UP_WHICH,c.MOUSE_WHEEL];F[c.DEVICE_KEYBOARD]=[c.KEYBOARD_UP,c.KEYBOARD_DOWN];F[c.DEVICE_TOUCH]=[c.TOUCH_START,c.TOUCH_MOVE,c.TOUCH_END];F[c.DEVICE_GYRO]=[c.GYRO_ORIENTATION_QUAT,c.GYRO_ORIENTATION_ANGLES];var H={};H[c.DEVICE_HMD]=[c.HMD_DISTORTION,c.HMD_EYE_DISTANCE,c.HMD_BASELINE_DIST,c.HMD_SCREEN_LENSE_DIST,c.HMD_SCREEN_WIDTH,c.HMD_SCREEN_HEIGHT,c.HMD_BEVEL_SIZE];a.DEVICE_GYRO=c.DEVICE_GYRO;a.DEVICE_HMD=c.DEVICE_HMD;
a.DEVICE_MOUSE=c.DEVICE_MOUSE;a.DEVICE_KEYBOARD=c.DEVICE_KEYBOARD;a.DEVICE_TOUCH=c.DEVICE_TOUCH;a.can_use_device=c.can_use_device;a.get_device_by_type_element=c.get_device_by_type_element;a.switch_prevent_default=function(a,b){a&&c.switch_prevent_default(a,b)};a.register_device=function(){q.error_once("input.register_device() deprecated")};a.reset_device=function(a){a&&a.type==c.DEVICE_HMD?c.reset_device(a):q.error("reset_device is undefined for device.")};a.get_vector_param=function(a,b,d){if(a&&
a.type in l&&0<=l[a.type].indexOf(b))return c.get_vector_param(a,b,d);q.error("device hasn't param: ",b)};a.get_value_param=function(a,b){if(a&&a.type in t&&0<=t[a.type].indexOf(b))return c.get_value_param(a,b);q.error("device hasn't param: ",b)};a.attach_param_cb=function(a,b,d){if(a&&a.type in F&&0<=F[a.type].indexOf(b))return c.attach_param_cb(a,b,d);q.error("device hasn't param: ",b)};a.detach_param_cb=function(a,b,d){if(a&&a.type in F&&0<=F[a.type].indexOf(b))return c.detach_param_cb(a,b,d);
q.error("device hasn't param: ",b)};a.set_config=function(a,b,d){if(a&&a.type in H&&0<=H[a.type].indexOf(b))return c.set_config(a,b,d);q.error("device hasn't config: ",b)};a.enable_split_screen=function(a){var l=c.get_device_by_type_element(c.DEVICE_HMD);if(!l||!l.registered)return!1;var p=c.get_vector_param(l,c.HMD_FOV_LEFT,f),q=c.get_vector_param(l,c.HMD_FOV_RIGHT,w);p&&p&&b.set_hmd_fov(a,p,q);if(p=c.get_value_param(l,m))q=k.get_active(),a=d.get_scene_data(a,q).cameras,b.set_eye_distance(a,p);a=
{};a.distortion_coefs=[l.distortion_coefs[0],l.distortion_coefs[1]];a.chromatic_aberration_coefs=[l.chromatic_aberration_coefs[0],l.chromatic_aberration_coefs[1],l.chromatic_aberration_coefs[2],l.chromatic_aberration_coefs[3]];a.enable_hmd_stereo=!0;a.base_line_factor=.5;l.webvr_hmd_device||(l.base_line_dist&&l.height_dist&&l.bevel_size?a.base_line_factor=(l.base_line_dist-l.bevel_size)/l.height_dist:l.bevel_size||(a.base_line_factor=l.base_line_dist/l.height_dist));a.inter_lens_factor=.5;l.inter_lens_dist&&
l.width_dist&&!l.webvr_hmd_device&&(a.inter_lens_factor=l.inter_lens_dist/l.width_dist);k.set_hmd_params(a);a=1+l.distortion_coefs[0]+l.distortion_coefs[1];k.multiply_size_mult(a,a);a=h.get_container();h.resize(a.clientWidth,a.clientHeight,!0);c.reset_device(l);return g=!0};a.disable_split_screen=function(){var a=c.get_device_by_type_element(c.DEVICE_HMD);if(!(g||a&&a.registered))return!1;k.set_hmd_params({enable_hmd_stereo:!1});a=1/(1+a.distortion_coefs[0]+a.distortion_coefs[1]);k.multiply_size_mult(a,
a);a=h.get_container();h.resize(a.clientWidth,a.clientHeight,!0);return!0};a.set_gamepad_key=function(a,b,d){u();switch(a){case 0:a=c.DEVICE_GAMEPAD0;break;case 1:a=c.DEVICE_GAMEPAD1;break;case 2:a=c.DEVICE_GAMEPAD2;break;case 3:a=c.DEVICE_GAMEPAD3;break;default:a=c.DEVICE_GAMEPAD0}a=c.get_device_by_type_element(a);c.set_config(a,b,d)};a.get_pressed_gmpd_btn=c.get_pressed_gmpd_btn;a.get_moved_gmpd_axis=c.get_moved_gmpd_axis;a.check_enable_gamepad_indices=u};b4w.module.lights=function(a,r){function u(a){for(var c=k.get_active(),d=h.get_scene_objs(c,"LAMP",h.DATA_ID_ALL),l=0;l<d.length;l++){var r=d[l];if("SUN"==r.light.type){var e=r;break}}if(!e)q.error("There is no sun on the scene");else if("number"==typeof a.hor_position&&"number"==typeof a.vert_position){d=w.deg_to_rad(180-a.hor_position);a=w.deg_to_rad(90-a.vert_position);l=e.render;p.set_rotation_euler(e,[a,d,0]);d=new Float32Array(3);r=f.get_quat_view(l.world_tsr);w.quat_to_dir(r,w.AXIS_Y,d);l=
f.get_trans_view(l.world_tsr);l=g.length(l);g.copy(d,m);g.scale(m,l,m);p.set_translation(e,m);p.update_transform(e);d=e.light;if(d.dynamic_intensity){var n=c.world.light_settings.environment_energy,l=c.world.horizon_color,r=c.world.zenith_color,t=Math.cos(Math.abs(a));a=Math.max(Math.min(3*t,1),0)*d.default_energy;n*=Math.max(t,.1);b.set_light_energy(d,a);k.set_environment_colors(c,n,l,r)}k.update_lamp_scene(e,c)}}function c(a){if(d.is_lamp(a))return a.light.type;q.error("get_light_type(): Wrong object");
return!1}var b=r("__lights"),h=r("__objects"),d=r("__obj_util"),q=r("__print"),k=r("__scenes"),p=r("__transform"),f=r("__tsr"),w=r("__util"),g=r("__vec3"),m=new Float32Array(3),l,t,F,H=60;a.get_lamps=function(a){var b=k.get_active(),b=h.get_scene_objs(b,"LAMP",h.DATA_ID_ALL);if(!a)return b;for(var c=[],d=0;d<b.length;d++){var g=b[d];g.light.type===a&&c.push(g)}return c};a.get_sun_params=function(){for(var a=k.get_active(),a=h.get_scene_objs(a,"LAMP",h.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=
a[c];if("SUN"==d.light.type){b=d;break}}return b?(b=b.light.direction,a=w.rad_to_deg(Math.atan2(b[2],b[0]))+90,180<a&&(a-=360),b=w.rad_to_deg(Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))),c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=u;a.set_day_time=function(a){for(var b=k.get_active(),b=h.get_scene_objs(b,"LAMP",h.DATA_ID_ALL),c=0;c<b.length;c++){var d=b[c];if("SUN"==d.light.type){var g=d;break}}g?(g=12>a?15*a:15*(a-24),a=-Math.cos(a/12*Math.PI)*H,b={},b.hor_position=g,b.vert_position=
a,u(b)):q.error("There is no sun on the scene")};a.set_date=function(a){l=a.getDate();t=a.getMonth();F=a.getFullYear();if(l)if(1582==l&&10==a.m&&4<a.d&&15>a.d)q.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!");else{a=l;var b=t,c=F,d,g;2<b?(d=a,g=b+1):(d=a-1,g=b+13);g=Math.floor(Math.floor(365.25*d)+Math.floor(30.6001*g)+c+1720995);588829<=c+31*(b+12*a)&&(a=Math.floor(.01*d),g+=2-a+Math.floor(.25*a));a=1E5*g;b=Math.floor(a);.5<a-b&&++b}else q.error("There is no year 0 in the Julian system!")};
a.set_max_sun_angle=function(a){H=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(d.is_lamp(a))var b=a.light;else return q.error("get_light_params(): Wrong object"),null;if(a=c(a))switch(a){case "SPOT":var g={light_type:a,light_color:b.color,light_energy:b.energy,light_spot_blend:b.spot_blend,light_spot_size:b.spot_size,light_distance:b.distance};break;case "POINT":g={light_type:a,light_color:b.color,light_energy:b.energy,light_distance:b.distance};break;default:g={light_type:a,light_color:b.color,
light_energy:b.energy}}return g?g:null};a.get_light_type=c;a.set_light_params=function(a,c){if(d.is_lamp(a)){var g=a.light,f=k.get_active();"number"==typeof c.light_energy&&b.set_light_energy(g,c.light_energy);"object"==typeof c.light_color&&b.set_light_color(g,c.light_color);"number"==typeof c.light_spot_blend&&b.set_light_spot_blend(g,c.light_spot_blend);"number"==typeof c.light_spot_size&&b.set_light_spot_size(g,c.light_spot_size);"number"==typeof c.light_distance&&b.set_light_distance(g,c.light_distance);
k.update_lamp_scene(a,f);h.update_all_mesh_shaders(f)}else q.error("set_light_params(): Wrong object")}};b4w.module.logic_nodes=function(a,r){var u=r("__logic_nodes");a.append_custom_callback=function(a,b){u.append_custom_cb(a,b)};a.remove_custom_callback=function(a){u.remove_custom_cb(a)};a.run_entrypoint=function(a,b){u.run_ep(a,b)}};b4w.module.material=function(a,r){function u(a,b){for(var c=a.scenes_data[0].batches,d=0;d<c.length;d++){var f=c[d];if(-1<f.material_names.indexOf(b))return"MAIN"==f.type}return!1}function c(a,b){var c=h.find_batch_material(a,b,"MAIN");return Boolean(c&&c.specular_params[0])}function b(a,b){var c=h.find_batch_material(a,b,"MAIN");return Boolean(c&&c.specular_params[1])}var h=r("__batch"),d=r("__config"),q=r("__obj_util"),k=r("__print"),p=r("__shaders"),f=r("__util"),w=d.defaults;a.inherit_material=
function(a,b,c,d){q.is_dynamic_mesh(c)&&q.is_dynamic_mesh(a)?h.inherit_material(a,b,c,d):k.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.scenes_data;for(var c=0;c<a.length;c++)for(var d=a[c].batches,f=0;f<d.length;f++)for(var h=0;h<d[f].material_names.length;h++)-1==b.indexOf(d[f].material_names[h])&&b.push(d[f].material_names[h]);return b};a.set_diffuse_color=function(a,b,c){var d=h.find_batch_material(a,b,"MAIN");d?(d.diffuse_color.set(c),(a=h.find_batch_material_forked(a,
b,"MAIN"))&&a.diffuse_color.set(c)):k.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=h.find_batch_material(a,b,"MAIN");if(c){var d=new Float32Array(4);d.set(c.diffuse_color);return d}k.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,c){var d=h.find_batch_material(a,b,"MAIN");if(d){if(d.diffuse_intensity=c,a=h.find_batch_material_forked(a,b,"MAIN"))a.diffuse_intensity=c}else k.error('Couldn\'t set property "diffuse_color"!')};
a.get_diffuse_intensity=function(a,b){var c=h.find_batch_material(a,b,"MAIN");if(c)return c.diffuse_intensity;k.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var d=h.find_batch_material(a,b,"MAIN");d?(d.specular_color.set(c),(a=h.find_batch_material_forked(a,b,"MAIN"))&&a.specular_color.set(c)):k.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=h.find_batch_material(a,b,"MAIN");if(c){var d=Array(3);d[0]=c.specular_color[0];
d[1]=c.specular_color[1];d[2]=c.specular_color[2];return d}k.error('Couldn\'t get property "specular_color"!')};a.set_specular_color_factor=function(a,b,c){var d=h.find_batch_material(a,b,"MAIN");if(d){if(d.specular_color_factor=c,a=h.find_batch_material_forked(a,b,"MAIN"))a.specular_color_factor=c}else k.error('Couldn\'t set property "specular_color_factor"!')};a.get_specular_color_factor=function(a,b){var c=h.find_batch_material(a,b,"MAIN");if(c)return c.specular_color_factor;k.error('Couldn\'t get property "specular_color_factor"!')};
a.set_specular_intensity=function(a,b,d){c(a,b)||k.error('Property "specular_intensity" is missing!');h.find_batch_material(a,b,"MAIN").specular_params[0]=d;(a=h.find_batch_material_forked(a,b,"MAIN"))&&(a.specular_params[0]=d)};a.get_specular_intensity=function(a,b){c(a,b)||k.error('Property "specular_intensity" is missing!');return h.find_batch_material(a,b,"MAIN").specular_params[0]};a.check_specular_intensity=c;a.set_specular_hardness=function(a,c,d){b(a,c)||k.error('Property "specular_hardness" is missing!');
h.find_batch_material(a,c,"MAIN").specular_params[1]=d;(a=h.find_batch_material_forked(a,c,"MAIN"))&&(a.specular_params[1]=d)};a.get_specular_hardness=function(a,c){b(a,c)||k.error('Property "specular_hardness" is missing!');return h.find_batch_material(a,c,"MAIN").specular_params[1]};a.check_specular_hardness=b;a.set_emit_factor=function(a,b,c){var d=h.find_batch_material(a,b,"MAIN");if(d){if(d.emit=c,a=h.find_batch_material_forked(a,b,"MAIN"))a.emit=c}else k.error('Couldn\'t set property "emit_factor"!')};
a.get_emit_factor=function(a,b){var c=h.find_batch_material(a,b,"MAIN");if(c)return c.emit;k.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,b,c){var d=h.find_batch_material(a,b,"MAIN");if(d){if(d.ambient=c,a=h.find_batch_material_forked(a,b,"MAIN"))a.ambient=c}else k.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=h.find_batch_material(a,b,"MAIN");if(c)return c.ambient;k.error('Couldn\'t get property "ambient_factor"!')};
a.set_diffuse_color_factor=function(a,b,c){var d=h.find_batch_material(a,b,"MAIN");if(d){if(d.diffuse_color_factor=c,a=h.find_batch_material_forked(a,b,"MAIN"))a.diffuse_color_factor=c}else k.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=h.find_batch_material(a,b,"MAIN");if(c)return c.diffuse_color_factor;k.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var d=h.find_batch_material(a,b,"MAIN");if(d){if(d.alpha_factor=
c,a=h.find_batch_material_forked(a,b,"MAIN"))a.alpha_factor=c}else k.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=h.find_batch_material(a,b,"MAIN");if(c)return c.alpha_factor;k.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return k.error("missing arguments in get_material_params"),null;if(!u(a,b))return null;var c=h.find_batch_material(a,b,"MAIN");if(!c)return null;var d={};"MAIN"==c.type&&(d.reflect_factor=
c.reflect_factor,d.fresnel=c.fresnel_params[2],d.fresnel_factor=5*(1-c.fresnel_params[3]),d.parallax_scale=c.parallax_scale,d.parallax_steps=h.get_batch_directive(c,"PARALLAX_STEPS")[1]);return d};a.get_water_material_params=function(a,b){if(!a||!b)return k.error("missing arguments in get_water_material_params"),null;if(!u(a,b))return null;var c=h.find_batch_material(a,b,"MAIN");if(!c||!c.water)return null;if(!c)return k.error("material not found"),null;var d={};if("MAIN"==c.type){if(w.shore_distance){var f=
d.shallow_water_col=Array(3);f[0]=c.shallow_water_col[0];f[1]=c.shallow_water_col[1];f[2]=c.shallow_water_col[2];f=d.shore_water_col=Array(3);f[0]=c.shore_water_col[0];f[1]=c.shore_water_col[1];f[2]=c.shore_water_col[2];d.shallow_water_col_fac=c.shallow_water_col_fac;d.shore_water_col_fac=c.shore_water_col_fac}d.foam_factor=c.foam_factor;d.norm_uv_velocity=c.water_norm_uv_velocity;d.absorb_factor=h.get_batch_directive(c,"ABSORB")[1];d.sss_strength=h.get_batch_directive(c,"SSS_STRENGTH")[1];d.sss_width=
h.get_batch_directive(c,"SSS_WIDTH")[1];d.dst_noise_scale0=h.get_batch_directive(c,"DST_NOISE_SCALE_0")[1];d.dst_noise_scale1=h.get_batch_directive(c,"DST_NOISE_SCALE_1")[1];d.dst_noise_freq0=h.get_batch_directive(c,"DST_NOISE_FREQ_0")[1];d.dst_noise_freq1=h.get_batch_directive(c,"DST_NOISE_FREQ_1")[1];d.dir_min_shore_fac=h.get_batch_directive(c,"DIR_MIN_SHR_FAC")[1];d.dir_freq=h.get_batch_directive(c,"DIR_FREQ")[1];d.dir_noise_scale=h.get_batch_directive(c,"DIR_NOISE_SCALE")[1];d.dir_noise_freq=
h.get_batch_directive(c,"DIR_NOISE_FREQ")[1];d.dir_min_noise_fac=h.get_batch_directive(c,"DIR_MIN_NOISE_FAC")[1];d.dst_min_fac=h.get_batch_directive(c,"DST_MIN_FAC")[1];d.waves_hor_fac=h.get_batch_directive(c,"WAVES_HOR_FAC")[1]}return d};a.set_material_extended_params=function(a,b,c){if(a&&b&&c)if(u(a,b)){var d=h.find_batch_material(a,b,"MAIN");if(d){var f=[d];(d=h.find_batch_material_forked(a,b,"MAIN"))&&f.push(d);for(a=0;a<f.length;a++)d=f[a],"number"==typeof c.material_reflectivity&&(d.reflect_factor=
c.material_reflectivity),"number"==typeof c.material_fresnel&&(d.fresnel_params[2]=c.material_fresnel),"number"==typeof c.material_fresnel_factor&&(d.fresnel_params[3]=1-c.material_fresnel_factor/5),"number"==typeof c.material_parallax_scale&&(d.parallax_scale=c.material_parallax_scale),"number"==typeof c.material_parallax_steps&&(b=p.glsl_value(parseFloat(c.material_parallax_steps)),h.set_batch_directive(d,"PARALLAX_STEPS",b),h.update_shader(d,!0))}else k.error("material not found")}else k.error("setting material params is not possible");
else k.error("missing arguments in set_material_params")};a.set_water_material_params=function(a,b,c){if(a&&b&&c)if(u(a,b)){var d=h.find_batch_material(a,b,"MAIN");if(d){var f=[d];(d=h.find_batch_material_forked(a,b,"MAIN"))&&f.push(d);for(a=0;a<f.length;a++)d=f[a],w.shore_distance&&("object"==typeof c.shallow_water_col&&d.shallow_water_col.set(c.shallow_water_col),"number"==typeof c.shallow_water_col_fac&&(d.shallow_water_col_fac=c.shallow_water_col_fac),"object"==typeof c.shore_water_col&&d.shore_water_col.set(c.shore_water_col),
"number"==typeof c.shore_water_col_fac&&(d.shore_water_col_fac=c.shore_water_col_fac)),w.shore_smoothing&&d.water_shore_smoothing&&("boolean"==typeof c.shore_smoothing&&(c.shore_smoothing?h.set_batch_directive(d,"SHORE_SMOOTHING",1):h.set_batch_directive(d,"SHORE_SMOOTHING",0)),"number"==typeof c.absorb_factor&&(b=p.glsl_value(parseFloat(c.absorb_factor)),h.set_batch_directive(d,"ABSORB",b))),"number"==typeof c.foam_factor&&w.foam&&(d.foam_factor=c.foam_factor),"number"==typeof c.norm_uv_velocity&&
(d.water_norm_uv_velocity=c.norm_uv_velocity),w.water_dynamic&&d.water_dynamic&&("boolean"==typeof c.water_dynamic&&(c.water_dynamic?h.set_batch_directive(d,"DYNAMIC",1):h.set_batch_directive(d,"DYNAMIC",0)),"number"==typeof c.waves_height&&(b=p.glsl_value(parseFloat(c.waves_height)),h.set_batch_directive(d,"WAVES_HEIGHT",b)),"number"==typeof c.waves_length&&(b=p.glsl_value(parseFloat(c.waves_length)),h.set_batch_directive(d,"WAVES_LENGTH",b)),"number"==typeof c.sss_strength&&(b=p.glsl_value(parseFloat(c.sss_strength)),
h.set_batch_directive(d,"SSS_STRENGTH",b)),"number"==typeof c.sss_width&&(b=p.glsl_value(parseFloat(c.sss_width)),h.set_batch_directive(d,"SSS_WIDTH",b)),"number"==typeof c.dst_noise_scale0&&(b=p.glsl_value(parseFloat(c.dst_noise_scale0)),h.set_batch_directive(d,"DST_NOISE_SCALE_0",b)),"number"==typeof c.dst_noise_scale1&&(b=p.glsl_value(parseFloat(c.dst_noise_scale1)),h.set_batch_directive(d,"DST_NOISE_SCALE_1",b)),"number"==typeof c.dst_noise_freq0&&(b=p.glsl_value(parseFloat(c.dst_noise_freq0)),
h.set_batch_directive(d,"DST_NOISE_FREQ_0",b)),"number"==typeof c.dst_noise_freq1&&(b=p.glsl_value(parseFloat(c.dst_noise_freq1)),h.set_batch_directive(d,"DST_NOISE_FREQ_1",b)),"number"==typeof c.dir_min_shore_fac&&(b=p.glsl_value(parseFloat(c.dir_min_shore_fac)),h.set_batch_directive(d,"DIR_MIN_SHR_FAC",b)),"number"==typeof c.dir_freq&&(b=p.glsl_value(parseFloat(c.dir_freq)),h.set_batch_directive(d,"DIR_FREQ",b)),"number"==typeof c.dir_noise_scale&&(b=p.glsl_value(parseFloat(c.dir_noise_scale)),
h.set_batch_directive(d,"DIR_NOISE_SCALE",b)),"number"==typeof c.dir_noise_freq&&(b=p.glsl_value(parseFloat(c.dir_noise_freq)),h.set_batch_directive(d,"DIR_NOISE_FREQ",b)),"number"==typeof c.dir_min_noise_fac&&(b=p.glsl_value(parseFloat(c.dir_min_noise_fac)),h.set_batch_directive(d,"DIR_MIN_NOISE_FAC",b)),"number"==typeof c.dst_min_fac&&(b=p.glsl_value(parseFloat(c.dst_min_fac)),h.set_batch_directive(d,"DST_MIN_FAC",b)),"number"==typeof c.waves_hor_fac&&(b=p.glsl_value(parseFloat(c.waves_hor_fac)),
h.set_batch_directive(d,"WAVES_HOR_FAC",b))),h.update_shader(d,!0)}else k.error("material not found")}else k.error("setting water material params is not possible");else k.error("missing arguments in set_water_material_params")};a.set_line_params=function(a,b){var c=h.get_first_batch(a);c?(f.isdef(b.color)&&c.diffuse_color.set(b.color),f.isdef(b.width)&&(c.line_width=b.width)):k.error("Couldn't set line params!")};a.get_line_params=function(a){if(a=h.get_first_batch(a))return{color:new Float32Array(a.diffuse_color),
width:a.line_width};k.error("Couldn't get line params");return null}};b4w.module.math=function(a,r){var u=r("__vec3"),c=r("__util"),b=r("__math"),h=new Float32Array(3);a.create_pline_from_points=function(a,c){var k=new Float32Array(6);b.set_pline_point(k,a);u.subtract(c,a,h);b.set_pline_directional_vec(k,h);return k};a.create_pline_from_point_vec=function(a,c){var h=new Float32Array(6);b.set_pline_point(h,a);b.set_pline_directional_vec(h,c);return h};a.create_pline=function(){return new Float32Array(6)};a.get_pline_directional_vec=b.get_pline_directional_vec;a.get_pline_initial_point=
b.get_pline_initial_point;a.set_pline_initial_point=b.set_pline_initial_point;a.set_pline_directional_vec=b.set_pline_directional_vec;a.line_plane_intersect=c.line_plane_intersect;a.calc_pline_point=b.calc_pline_point;a.point_plane_dist=b.point_plane_dist};b4w.module.particles=function(a,r){var u=r("__particles"),c=r("__print");a.set_size=function(a,h,d){u.obj_has_particles(a)?u.set_size(a,h,d):c.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,h,d){u.obj_has_particles(a)?u.set_normal_factor(a,h,d):c.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,h,d){u.obj_has_particles(a)?(d=Math.min(d,1),d=Math.max(d,0),u.set_factor(a,h,d)):c.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,r){r("__config");var u=r("__ipc"),c=r("__physics"),b=r("__print"),h=r("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){c.obj_has_physics(a)?c.enable_simulation(a):b.error("No physics for object "+a.name)};a.disable_simulation=function(a){c.obj_has_physics(a)?c.disable_simulation(a):b.error("No physics for object "+a.name)};a.has_physics=function(a){return c.obj_has_physics(a)};a.has_simulated_physics=function(a){return c.has_simulated_physics(a)};
a.has_dynamic_physics=function(a){return c.has_dynamic_physics(a)};a.set_gravity=function(a,h){c.obj_has_physics(a)?c.set_gravity(a,h):b.error("No physics for object "+a.name)};a.set_damping=function(a,h,k){c.obj_has_physics(a)?c.post_msg("set_damping",a.physics.body_id,h,k):b.error("No physics for object "+a.name)};a.reset_damping=function(a){if(c.obj_has_physics(a)){var h=a.physics_settings;c.post_msg("set_damping",a.physics.body_id,h.damping,h.rotation_damping)}else b.error("No physics for object "+
a.name)};a.set_transform=function(a,h,k){c.obj_has_physics(a)?c.set_transform(a,h,k):b.error("No physics for object "+a.name)};a.sync_transform=function(a){c.obj_has_physics(a)?c.sync_transform(a):b.error("No physics for object "+a.name)};a.apply_velocity=function(a,h,k,p){c.obj_has_physics(a)?c.apply_velocity(a,h,k,p):b.error("No physics for object "+a.name)};a.apply_velocity_world=function(a,h,k,p){c.obj_has_physics(a)?c.apply_velocity_world(a,h,k,p):b.error("No physics for object "+a.name)};a.apply_force=
function(a,h,k,p){c.obj_has_physics(a)?c.apply_force(a,h,k,p,!1):b.error("No physics for object "+a.name)};a.apply_force_world=function(a,h,k,p){c.obj_has_physics(a)?c.apply_force(a,h,k,p,!0):b.error("No physics for object "+a.name)};a.apply_torque=function(a,h,k,p){c.obj_has_physics(a)?c.apply_torque(a,h,k,p):b.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,q){c.obj_has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_throttle(a,
h.clamp(q,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,q,k){if(c.obj_has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");q=h.clamp(q,0,1);var p=a.vehicle.engine_force;-1==k||1==k?p=Math.max(-1,Math.min(p+k*q,1)):0==k&&0<=p?(p-=q,p=Math.max(0,p)):0==k&&0>p?(p+=q,p=Math.min(0,p)):b.error("Wrong steering direction");c.vehicle_throttle(a,h.clamp(p,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_steer=function(a,
q){c.obj_has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_steer(a,h.clamp(q,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,q,k){if(c.obj_has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");q=h.clamp(q,0,1);var p=a.vehicle.steering;-1==k||1==k?p=Math.max(-1,Math.min(p+k*q,1)):0==k&&0<=p?(p-=q,p=Math.max(0,p)):0==k&&0>p?(p+=q,p=Math.min(0,p)):b.error("Wrong steering direction");c.vehicle_steer(a,
h.clamp(p,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_brake=function(a,q){c.obj_has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_brake(a,h.clamp(q,0,1))):b.error("No physics for object "+a.name)};a.vehicle_brake_inc=function(a,q){if(c.obj_has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");q=h.clamp(q,-1,1);var k=a.vehicle.brake_force;c.vehicle_brake(a,h.clamp(k+k*q,0,1))}else b.error("No physics for object "+
a.name)};a.is_vehicle_chassis=function(a){return c.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return c.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!c.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.vehicle_settings.name;b.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!c.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.vehicle.engine_force;
b.error("Wrong object");return null};a.get_vehicle_steering=function(a){if(!c.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.vehicle.steering;b.error("Wrong object")};a.get_vehicle_brake=function(a){if(!c.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.vehicle.brake_force;b.error("Wrong object")};a.get_vehicle_speed=function(a){if(!c.obj_has_physics(a))return b.error("No physics for object "+
a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return c.get_vehicle_speed(a);b.error("Wrong object")};a.is_character=function(a){return c.is_character(a)};a.set_character_move_dir=function(a,h,k){c.obj_has_physics(a)?c.set_character_move_dir(a,h,k):b.error("No physics for object "+a.name)};a.set_character_move_type=function(a,h){c.obj_has_physics(a)?c.set_character_move_type(a,h):b.error("No physics for object "+a.name)};a.set_character_walk_velocity=function(a,h){c.obj_has_physics(a)?
c.set_character_walk_velocity(a,h):b.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,h){c.obj_has_physics(a)?c.set_character_run_velocity(a,h):b.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,h){c.obj_has_physics(a)?c.set_character_fly_velocity(a,h):b.error("No physics for object "+a.name)};a.character_jump=function(a){c.obj_has_physics(a)?c.character_jump(a):b.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,
h,k){c.obj_has_physics(a)?c.character_rotation_inc(a,h,k):b.error("No physics for object "+a.name)};a.set_character_rotation=function(a,h,k){c.obj_has_physics(a)?c.set_character_rotation(a,h,k):b.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,h){c.obj_has_physics(a)?c.set_character_rotation_v(a,h):b.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,h){c.obj_has_physics(a)?c.set_character_rotation_h(a,h):b.error("No physics for object "+a.name)};
a.append_collision_test=function(a,h,k,p){c.obj_has_physics(a)?c.append_collision_test(a,h,k,p||!1):b.error("No physics for object "+a.name)};a.remove_collision_test=function(a,h,k){c.obj_has_physics(a)?c.remove_collision_test(a,h||"ANY",k):b.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,h){c.obj_has_physics(a)?c.apply_collision_impulse_test(a,h):b.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){c.obj_has_physics(a)?c.clear_collision_impulse_test(a):
b.error("No physics for object "+a.name)};a.append_ray_test=function(a,h,k,p,f,r){a=a||null;if(null==a||c.obj_has_physics(a))return c.append_ray_test(a,h,k,p,f,r||!1,!1,!1,!1);b.error("No physics for object "+a.name)};a.append_ray_test_ext=function(a,h,k,p,f,r,g,m,l){a=a||null;if(null==a||c.obj_has_physics(a))return c.append_ray_test(a,h,k,p,f,r||!1,g||!1,m||!1,l||!1);b.error("No physics for object "+a.name)};a.remove_ray_test=function(a){c.is_ray_test(a)?c.remove_ray_test(a):b.error("Wrong ray test ID")};
a.change_ray_test_from_to=function(a,h,k){c.is_ray_test(a)?c.change_ray_test_from_to(a,h,k):b.error("Wrong ray test ID")};a.apply_constraint=function(a,h,k,p,f,r,g,m,l,t){c.obj_has_physics(h)&&c.obj_has_physics(f)?c.apply_constraint(a,h,k,p,f,r,g,m,l,t):b.error("Wrong objects")};a.clear_constraint=function(a){c.obj_has_physics(a)&&c.has_constraint(a)?c.clear_constraint(a):b.error("Wrong object")};a.pull_to_constraint_pivot=function(a,h,k,p,f,r){c.obj_has_physics(a)&&c.obj_has_physics(p)?c.pull_to_constraint_pivot(a,
h,k,p,f,r):b.error("Wrong objects")};a.get_worker_listeners=u.get_worker_listeners};b4w.module.rgb=function(a,r){r("__print");var u=r("__util"),c=new Float32Array(3);a.create=function(){return new Float32Array(3)};a.from_values=function(a,c,d){var q=new Float32Array(3);q[0]=a;q[1]=c;q[2]=d;return q};a.set=function(a,c,d,q){q[0]=a;q[1]=c;q[2]=d;return q};a.css_to_rgb=function(a,c,d,q){q=q||new Float32Array(3);q[0]=a/255;q[1]=c/255;q[2]=d/255;u.srgb_to_lin(q,q);return q};a.rgb_to_css=function(a){a=u.lin_to_srgb(a,c);return[Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])]};
a.rgb_to_css_hex=function(a){var h=function(a){a=Math.round(255*a).toString(16);return 1==a.length?"0"+a:a};a=u.lin_to_srgb(a,c);return"#"+h(a[0])+h(a[1])+h(a[2])}};
b4w.module.rgba=function(a,r){r("__print");var u=r("__util"),c=new Float32Array(3);a.create=function(){var a=new Float32Array(4);a[3]=1;return a};a.from_values=function(a,c,d,q){var k=new Float32Array(4);k[0]=a;k[1]=c;k[2]=d;k[3]=q;return k};a.set=function(a,c,d,q,k){k[0]=a;k[1]=c;k[2]=d;k[3]=q;return k};a.css_to_rgba=function(a,c,d,q,k){k=k||new Float32Array(4);k[0]=a/255;k[1]=c/255;k[2]=d/255;k[3]=q;u.srgb_to_lin(k,k);return k};a.rgba_to_css=function(a){var h=u.lin_to_srgb(a,c);return[Math.round(255*
h[0]),Math.round(255*h[1]),Math.round(255*h[2]),a[3]]}};b4w.module.scenes=function(a,r){var u=r("__batch"),c=r("__camera"),b=r("__data"),h=r("__graph"),d=r("__objects"),q=r("__obj_util"),k=r("__physics"),p=r("__print"),f=r("__scenes"),w=r("__util");a.DATA_ID_ALL=d.DATA_ID_ALL;a.set_active=function(a){var b=f.get_all_scenes();f.set_active(w.keysearch("name",a,b))};a.get_active=function(){return f.check_active()?f.get_active().name:""};a.get_scenes=function(){for(var a=f.get_all_scenes(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=
function(){if(f.check_active())return f.get_camera(f.get_active());p.error("No active scene");return!1};a.get_object_by_name=function(a,b){var c=d.get_object(d.GET_OBJECT_BY_NAME,a,b|0);if(c)return c;p.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,c){if(a=d.get_object(d.GET_OBJECT_BY_DUPLI_NAME,a,b,c|0))return a;p.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var c=d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,a,b|0);if(c)return c;
p.error("get object "+a+": not found")};a.get_world_by_name=function(a,b){var c=d.get_world_by_name(a,b|0);if(c)return c;p.error("get object "+a+": not found")};a.get_object_data_id=function(a){return f.get_object_data_id(a)};a.pick_object=d.pick_object;a.outlining_is_enabled=function(a){return a&&a.render&&a.render.outlining};a.set_outline_intensity=function(a,b){a&&a.render&&a.render.outlining?d.set_outline_intensity(a,b):p.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=
function(a){if(a&&a.render&&a.render.outlining)return a.render.outline_intensity;p.error("get_outline_intensity(): wrong object")};a.apply_outline_anim=function(a,b,c,f){a&&a.render&&a.render.outlining?d.apply_outline_anim(a,b,c,f):p.error("apply_outline_anim(): wrong object")};a.apply_outline_anim_def=function(a){if(a&&a.render&&a.render.outlining){var b=a.render.outline_anim_settings_default;d.apply_outline_anim(a,b.outline_duration,b.outline_period,b.outline_relapses)}else p.error("apply_outline_anim_def(): wrong object")};
a.clear_outline_anim=function(a){a&&a.render&&a.render.outlining?d.clear_outline_anim(a):p.error("clear_outline_anim(): wrong object")};a.set_outline_color=f.set_outline_color;a.get_outline_color=function(a){var b=f.get_active();if(b=f.get_subs(b,"OUTLINE"))return a=a||new Float32Array(3),a.set(b.outline_color),a};a.set_hmd_params=function(a){f.check_active()?a&&(!a.distortion_coefs||a.distortion_coefs instanceof Array||(a.distortion_coefs=null),!a.chromatic_aberration_coefs||a.chromatic_aberration_coefs instanceof
Array||(a.chromatic_aberration_coefs=null),"number"!=typeof a.base_line_factor&&(a.base_line_factor=null),"number"!=typeof a.inter_lens_factor&&(a.inter_lens_factor=null),"boolean"!=typeof a.enable_hmd_stereo&&(a.enable_hmd_stereo=null),f.set_hmd_params(a)):p.error("No active scene")};a.get_shadow_params=function(){if(!f.check_active())return p.error("No active scene"),!1;var a=f.get_active(),b=f.get_subs(a,"SHADOW_CAST");if(!b)return null;var c=a._render.shadow_params,d=f.get_subs(a,"MAIN_OPAQUE"),
h=f.get_subs(a,"SHADOW_RECEIVE"),k={};k.csm_resolution=c.csm_resolution;k.self_shadow_polygon_offset=b.self_shadow_polygon_offset;h&&(k.self_shadow_normal_offset=h.self_shadow_normal_offset);k.enable_csm=c.enable_csm;k.csm_num=c.csm_num;k.csm_first_cascade_border=c.csm_first_cascade_border;k.first_cascade_blur_radius=c.first_cascade_blur_radius;k.csm_last_cascade_border=c.csm_last_cascade_border;k.last_cascade_blur_radius=c.last_cascade_blur_radius;k.fade_last_cascade=c.fade_last_cascade;k.blend_between_cascades=
c.blend_between_cascades;c.enable_csm?(k.csm_borders=f.get_csm_borders(a,d.camera),k.blur_radii=new Float32Array(c.csm_num),k.blur_radii.set(d.camera.pcf_blur_radii.subarray(0,c.csm_num))):(k.csm_borders=null,k.blur_radii=null);return k};a.set_shadow_params=function(a){if(f.check_active()){var b=f.get_active();"number"==typeof a.self_shadow_polygon_offset&&h.traverse(b._render.graph,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var d=f.get_subs(b,
"SHADOW_RECEIVE");d&&("number"==typeof a.self_shadow_normal_offset&&(d.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(d.pcf_blur_radius=a.pcf_blur_radius));var k=f.get_subs(b,"MAIN_BLEND");k&&("number"==typeof a.self_shadow_normal_offset&&(k.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(k.pcf_blur_radius=a.pcf_blur_radius),k.need_perm_uniforms_update=!0);k=b._render.shadow_params;"number"==typeof a.csm_first_cascade_border&&
(k.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(k.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(k.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(k.last_cascade_blur_radius=a.last_cascade_blur_radius);if(d){for(var r=d.bundles,w=0;w<r.length;w++){var C=r[w];C.obj_render.shadow_receive&&(C=C.batch,u.assign_shadow_receive_dirs(C,k),u.update_shader(C))}d.need_perm_uniforms_update=
!0}d=q.get_scene_data(b._camera,b).cameras;for(w=0;w<d.length;w++)c.update_camera_shadows(d[w],k);f.schedule_shadow_update(b)}else p.error("No active scene")};a.get_environment_colors=function(){if(!f.check_active())return p.error("No active scene"),!1;var a=f.get_active();return f.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(f.check_active()){var d=f.get_active(),h=f.get_subs(d,"MAIN_OPAQUE");a=a||0==a?parseFloat(a):h.environment_energy;f.set_environment_colors(d,a,b||0==
b?b:h.horizon_color,c||0==c?c:h.zenith_color)}else p.error("No active scene")};a.get_fog_color_density=function(a){if(!f.check_active())return p.error("No active scene"),!1;var b=f.get_active();return f.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(f.check_active()){var b=f.get_active();f.set_fog_color_density(b,a)}else p.error("No active scene")};a.get_ssao_params=function(){if(!f.check_active())return p.error("No active scene"),!1;var a=f.get_active();return f.get_ssao_params(a)};
a.set_ssao_params=function(a){if(f.check_active()){var b=f.get_active();f.set_ssao_params(b,a)}else p.error("No active scene")};a.get_color_correction_params=function(){if(!f.check_active())return p.error("No active scene"),null;var a=f.get_active(),a=f.get_subs(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(f.check_active()){var b=f.get_active();if(b=
f.get_subs(b,"COMPOSITING"))"number"==typeof a.brightness&&(b.brightness=a.brightness),"number"==typeof a.contrast&&(b.contrast=a.contrast),"number"==typeof a.exposure&&(b.exposure=a.exposure),"number"==typeof a.saturation&&(b.saturation=a.saturation),b.need_perm_uniforms_update=!0}else p.error("No active scene")};a.get_sky_params=function(){if(!f.check_active())return p.error("No active scene"),!1;var a=f.get_active();return f.get_sky_params(a)};a.set_sky_params=function(a){if(f.check_active()){var b=
f.get_active();f.set_sky_params(b,a)}else p.error("No active scene")};a.get_dof_params=function(){if(!f.check_active())return p.error("No active scene"),!1;var a=f.get_active();return f.get_subs(a,"DOF")?f.get_dof_params(a):null};a.set_dof_params=function(a){if(f.check_active()){var b=f.get_active();f.set_dof_params(b,a)}else p.error("No active scene")};a.get_god_rays_params=function(){if(!f.check_active())return p.error("No active scene"),!1;var a=f.get_active();return f.get_subs(a,"GOD_RAYS")?f.get_god_rays_params(a):
null};a.set_god_rays_params=function(a){if(f.check_active()){var b=f.get_active();f.set_god_rays_params(b,a)}else p.error("No active scene")};a.get_bloom_params=function(){if(!f.check_active())return p.error("No active scene"),!1;var a=f.get_active();return f.get_subs(a,"BLOOM")?f.get_bloom_params(a):null};a.set_bloom_params=function(a){if(f.check_active()){var b=f.get_active();f.set_bloom_params(b,a)}else p.error("No active scene")};a.get_glow_material_params=function(){if(!f.check_active())return p.error("No active scene"),
!1;var a=f.get_active();return f.get_subs(a,"GLOW_COMBINE")?f.get_glow_material_params(a):null};a.set_glow_material_params=function(a){if(f.check_active()){var b=f.get_active();f.set_glow_material_params(b,a)}else p.error("No active scene")};a.get_wind_params=function(){if(!f.check_active())return p.error("No active scene"),!1;var a=f.get_active();return f.get_wind_params(a)};a.set_wind_params=function(a){if(f.check_active()){var b=f.get_active();d.set_wind_params(b,a)}else p.error("No active scene")};
a.get_water_surface_level=function(a,b){if(!f.check_active())return p.error("No active scene"),0;var c=f.get_active();return c._render.water_params?f.get_water_surface_level(c,a,b):(p.error("No water parameters on the active scene"),0)};a.set_water_params=function(a){if(f.check_active()){var b=f.get_active();f.set_water_params(b,a)}else p.error("No active scene")};a.get_water_mat_params=function(a){if(f.check_active()){var b=f.get_active();f.get_water_mat_params(b,a)}else p.error("No active scene")};
a.update_scene_materials_params=function(){if(f.check_active()){var a=f.get_active();f.update_scene_permanent_uniforms(a)}else p.error("No active scene")};a.hide_object=function(a,b){b=b||!1;!q.is_mesh(a)&&!q.is_empty(a)||q.is_dynamic(a)?b?f.change_visibility(a,!0):f.change_visibility_rec(a,!0):p.error("show/hide is only supported for dynamic objects.")};a.show_object=function(a,b){b=b||!1;!q.is_mesh(a)&&!q.is_empty(a)||q.is_dynamic(a)?b?f.change_visibility(a,!1):f.change_visibility_rec(a,!1):p.error("show/hide is only supported for dynamic objects.")};
a.is_hidden=function(a){if(q.is_dynamic_mesh(a)||q.is_empty(a)||q.is_lamp(a))return f.is_hidden(a);p.error("show/hide is only supported for dynamic meshes/empties and lamps");return!1};a.is_visible=function(a){return a.render.is_visible};a.check_object=function(a){p.error_deprecated("scenes.check_object","scenes.check_object_by_name");return f.check_active()?d.objects_storage_check(a,f.get_active()):(p.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return d.get_object(d.GET_OBJECT_BY_NAME,
a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,c){return d.get_object(d.GET_OBJECT_BY_DUPLI_NAME,a,b,c|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,a,b|0)?!0:!1};a.get_all_objects=function(a,b){var c=f.get_active();a||(a="ALL");b||0===b||(b=d.DATA_ID_ALL);return d.get_scene_objs(c,a,b)};a.get_object_name=function(a){return a?a.origin_name:(p.error("Wrong object name"),"")};a.get_object_name_hierarchy=function(a){if(!a)return p.error("Wrong object name"),
null;for(var b=[];a;)b.push(a.origin_name),a=q.get_dg_parent(a);return b.reverse()};a.get_object_type=function(a){return a&&a.type?a.type:(p.error("Wrong object"),"UNDEFINED")};a.get_object_dg_parent=function(a){p.error_deprecated("scenes.get_object_dg_parent","objects.get_dg_parent");return q.get_dg_parent(a)};a.get_object_children=function(a){return a.cons_descends.slice(0)};a.get_first_character=function(){for(var a=d.get_scene_objs(f.get_active(),"MESH",d.DATA_ID_ALL),b=0;b<a.length;b++){var c=
a[b];if(k.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);if(!f.check_active())return p.error("No active scene"),!1;var c=f.get_active();return f.get_shore_dist(c,a,b)};a.get_cam_water_depth=function(){return f.get_cam_water_depth()};a.get_type_mesh_object=function(a){return q.is_mesh(a)?a.render.type:null};a.get_meta_tags=function(){if(!f.check_active())return p.error("No active scene"),!1;var a=f.get_active();return f.get_meta_tags(a)};a.append_object=function(a,
b){if(a.render.is_copied){if(b)var c=f.get_all_scenes(),c=w.keysearch("name",b,c);else c=f.get_active();f.append_object(c,a,!0)}else p.error('object "'+a.name+'" has been created not by coping.')};a.remove_object=function(a){if((q.is_mesh(a)||q.is_empty(a))&&q.is_dynamic(a)){for(var c=a.scenes_data,f=0;f<c.length;f++)b.prepare_object_unloading(c[f].scene,a,!1);d.remove_object(a)}else p.error("Can't remove object \""+a.name+'". It must be dynamic and type of MESH or EMPTY.')};a.marker_frame=function(a){var b=
f.get_active();if(b.timeline_markers&&a in b.timeline_markers)return f.marker_frame(b,a);p.error('"'+a+'" marker not found.');return 0};a.get_mb_params=function(){var a=f.get_active();return(a=f.get_subs(a,"MOTION_BLUR"))?{mb_factor:a.mb_factor,mb_decay_threshold:a.mb_decay_threshold}:null};a.set_mb_params=function(a){var b=f.get_active();(b=f.get_subs(b,"MOTION_BLUR"))?("number"==typeof a.mb_decay_threshold&&(b.mb_decay_threshold=a.mb_decay_threshold),"number"==typeof a.mb_factor&&(b.mb_factor=a.mb_factor)):
p.error("The motion blur subscene doesn't exist.")};a.can_select_objects=function(){var a=f.get_active();return Boolean(f.get_subs(a,"COLOR_PICKING"))}};b4w.module.sfx=function(a,r){var u=r("__obj_util"),c=r("__scenes"),b=r("__sfx"),h=r("__print");a.play=function(a,c,h){b.play(a,c||0,h||0)};a.play_def=function(a){b.play_def(a)};a.is_play=function(a){return b.is_playing(a)};a.is_playing=function(a){return b.is_playing(a)};a.stop=function(a){b.stop(a)};a.pause=function(a){b.speaker_pause(a)};a.resume=function(a){b.speaker_resume(a)};a.playrate=function(a,c){b.playrate(a,c)};a.get_playrate=function(a){return b.get_playrate(a)};a.cyclic=function(a,c){b.cyclic(a,
c)};a.is_cyclic=function(a){return b.is_cyclic(a)};a.listener_reset_speed=function(a,c){b.listener_reset_speed(a,c)};a.speaker_reset_speed=function(a,c,h){b.speaker_reset_speed(a,c,h)};a.get_volume=function(a){return a&&"object"===typeof a?b.get_volume(a):b.get_master_volume()};a.set_volume=function(a,c){a&&"object"===typeof a?b.set_volume(a,c):b.set_master_volume(c)};a.mute=function(a,c){a&&"object"===typeof a?b.mute(a,c):b.mute_master(c)};a.is_muted=function(a){return a&&"object"===typeof a?b.is_muted(a):
b.is_master_muted()};a.get_speaker_objects=function(){return b.get_speaker_objects().slice(0)};a.check_active_speakers=b.check_active_speakers;a.set_compressor_params=function(a){b.set_compressor_params(c.get_active(),a)};a.get_compressor_params=function(){return b.get_compressor_params(c.get_active())};a.duck=function(a,c,h){a&&"object"===typeof a?b.duck(a,c,h):b.duck_master(c,h)};a.unduck=function(a){a&&"object"===typeof a?b.unduck(a):b.unduck_master()};a.apply_playlist=b.apply_playlist;a.clear_playlist=
b.clear_playlist;a.detect_audio_container=b.detect_audio_container;a.detect_video_container=b.detect_video_container;a.set_positional_params=b.set_positional_params;a.get_positional_params=b.get_positional_params;a.set_filter_params=b.set_filter_params;a.get_filter_params=b.get_filter_params;a.get_filter_freq_response=b.get_filter_freq_response;a.get_duration=function(a){if(a&&u.is_speaker(a))return b.get_duration(a);h.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.textures=function(a,r){var u=r("__print"),c=r("__scenes"),b=r("__textures"),h=r("__obj_util"),d=r("__assets");a.get_canvas_texture_context=function(a,c){u.error_deprecated("get_canvas_texture_context","get_canvas_ctx");c||(c=0);var d=b.get_canvas_context(a,c);if(d)return d;u.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a,c){u.error_deprecated("update_canvas_texture_context","update_canvas_ctx");c||(c=0);b.update_canvas_context(a,c)||u.error('Canvas texture with ID "'+
a+'" not found!')};a.play_video=function(a,d){d||(d=0);c.get_active().b4w_use_nla&&b.video_allow_nla(a,d)?u.error("NLA texture can't be controlled directly through API."):b.play_video(a,d)||u.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a,d){d||(d=0);c.get_active().b4w_use_nla&&b.video_allow_nla(a,d)?u.error("NLA texture can't be controlled directly through API."):b.pause_video(a,d)||u.error('Texture with name "'+a+'" not found!')};a.reset_video=function(a,d){d||(d=0);c.get_active().b4w_use_nla&&
b.video_allow_nla(a,d)?u.error("NLA texture can't be controlled directly through API."):b.reset_video(a,d)||u.error('Texture with name "'+a+'" not found!')};a.get_canvas_ctx=function(a,c){if(h.is_mesh(a)){var d=b.get_canvas_context_by_object(a,c);if(d)return d;u.error("Couldn't find canvas texture with this name: "+c)}else u.error("Object must be type of mesh.");return null};a.update_canvas_ctx=function(a,c){if(h.is_mesh(a)){if(b.update_canvas_context_by_object(a,c))return!0;u.error("Couldn't find canvas texture with this name: "+
c)}else u.error("Object must be type of mesh.");return!1};a.change_image=function(a,c,h,f){f=f||function(){};d.enqueue([{id:h,type:d.AT_IMAGE_ELEMENT,url:h,request:"GET",post_type:null,post_data:null,optional_param:null}],function(d,g,h,l,p){d&&(b.change_image(a,c,d)?f():u.error("Couldn't find texture with this name: "+c))},null,null)}};b4w.module.time=function(a,r){var u=r("__time");a.set_timeout=u.set_timeout;a.clear_timeout=u.clear_timeout;a.get_timeline=u.get_timeline;a.animate=u.animate;a.clear_animation=u.clear_animation};b4w.module.transform=function(a,r){var u=r("__obj_util"),c=r("__physics"),b=r("__print"),h=r("__quat"),d=r("__transform"),q=r("__tsr"),k=r("__util"),p=new Float32Array(4),f=new Float32Array(3),w=new Float32Array(4);a.SPACE_LOCAL=d.SPACE_LOCAL;a.SPACE_WORLD=d.SPACE_WORLD;a.set_translation=function(a,h,k,p){u.is_dynamic(a)?(f[0]=h,f[1]=k,f[2]=p,d.set_translation(a,f),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel=function(a,h,
k,p){u.is_dynamic(a)?(f[0]=h,f[1]=k,f[2]=p,d.set_translation_rel(a,f),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,f){u.is_dynamic(a)?(d.set_translation(a,f),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel_v=function(a,f){u.is_dynamic(a)?(d.set_translation_rel(a,f),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.set_translation_obj_rel=function(a,h,l,p,r){u.is_dynamic(a)?(f[0]=h,f[1]=l,f[2]=p,h=q.get_trans_view(r.render.world_tsr),r=q.get_quat_view(r.render.world_tsr),k.transform_vec3(f,1,r,h,f),d.set_translation(a,f),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,b){b||(b=new Float32Array(3));d.get_translation(a,b);return b};a.get_translation_rel=function(a,b){b||(b=new Float32Array(3));d.get_translation_rel(a,b);return b};
a.set_rotation=function(a,f,h,k,p){u.is_dynamic(a)?(w[0]=f,w[1]=h,w[2]=k,w[3]=p,d.set_rotation(a,w),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel=function(a,f,h,k,p){u.is_dynamic(a)?(w[0]=f,w[1]=h,w[2]=k,w[3]=p,d.set_rotation_rel(a,w),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_v=function(a,f){u.is_dynamic(a)?(d.set_rotation(a,f),d.update_transform(a),c.sync_transform(a)):
b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel_v=function(a,f){u.is_dynamic(a)?(d.set_rotation_rel(a,f),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_rotation=function(a,b){b||(b=new Float32Array(4));d.get_rotation(a,b);return b};a.get_rotation_rel=function(a,b){b||(b=new Float32Array(4));d.get_rotation_rel(a,b);return b};a.set_rotation_euler=function(a,h,k,p){u.is_dynamic(a)?(f[0]=h,f[1]=k,f[2]=p,d.set_rotation_euler(a,
f),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel=function(a,h,k,p){u.is_dynamic(a)?(f[0]=h,f[1]=k,f[2]=p,d.set_rotation_euler_rel(a,f),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,f){u.is_dynamic(a)?(d.set_rotation_euler(a,f),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel_v=
function(a,f){u.is_dynamic(a)?(d.set_rotation_euler_rel(a,f),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,c){u.is_dynamic(a)?(d.set_scale(a,c),d.update_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale_rel=function(a,c){u.is_dynamic(a)?(d.set_scale_rel(a,c),d.update_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_scale=function(a){return d.get_scale(a)};a.get_scale_rel=
function(a){return d.get_scale_rel(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)b.error("Wrong object: "+a.name);else{for(var f=0;f<a.cons_descends.length;f++)if(!u.is_dynamic(a.cons_descends[f])){b.error('Wrong object: "'+a.cons_descends[f].name+'" is not dynamic.');return}d.set_translation(a,[0,0,0]);d.set_rotation(a,[0,0,0,1]);d.set_scale(a,1);d.update_transform(a);c.sync_transform(a)}};a.get_object_size=function(a){return u.is_mesh(a)?d.get_object_size(a):(b.error("Wrong object: "+
a.name),0)};a.get_object_center=function(a,c,f){return u.is_mesh(a)?d.get_object_center(a,c,f):(b.error("Wrong object: "+a.name),null)};a.move_local=function(a,f,h,k){u.is_dynamic(a)?(d.move_local(a,f,h,k),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_x_local=function(a,f){if(u.is_dynamic(a)){var l=h.setAxisAngle(k.AXIS_X,f,w);d.rotate_local(a,l);d.update_transform(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.rotate_y_local=function(a,f){if(u.is_dynamic(a)){var l=h.setAxisAngle(k.AXIS_Y,f,w);d.rotate_local(a,l);d.update_transform(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_z_local=function(a,f){if(u.is_dynamic(a)){var l=h.setAxisAngle(k.AXIS_Z,f,w);d.rotate_local(a,l);d.update_transform(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return d.get_object_bounding_box(a)};a.set_tsr=
function(a,f){u.is_dynamic(a)?(d.set_tsr(a,f),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr_rel=function(a,f){u.is_dynamic(a)?(d.set_tsr_rel(a,f),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_tsr=function(a,b){b||(b=new Float32Array(8));d.get_tsr(a,b);return b};a.get_tsr_rel=function(a,b){b||(b=new Float32Array(8));d.get_tsr_rel(a,b);return b};a.distance=function(a,b){return d.distance(a,
b)};a.set_matrix=function(a,f){u.is_dynamic(a)?(q.from_mat4(f,p),d.set_tsr(a,p),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_matrix_rel=function(a,f){u.is_dynamic(a)?(q.from_mat4(f,p),d.set_tsr_rel(a,p),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_matrix=function(a,b){b||(b=new Float32Array(16));d.get_tsr(a,p);q.to_mat4(p,b);return b};a.get_matrix_rel=function(a,b){b||(b=new Float32Array(16));
d.get_tsr_rel(a,p);q.to_mat4(p,b);return b}};b4w.module.tsr=function(a,r){function u(a,b,c,p){p||(p=h.create());u(a,b,c,p);return p}var c=r("__mat4"),b=r("__print"),h=r("__tsr");a.create=h.create;a.from_values=h.from_values;a.copy=h.copy;a.identity=h.identity;a.create_sep=function(a,c,h,p){b.error_deprecated("create_sep","set_sep");return u(a,c,h,p)};a.set_sep=h.set_sep;a.set_trans=h.set_trans;a.set_scale=h.set_scale;a.set_transcale=h.set_transcale;a.set_quat=h.set_quat;a.get_trans_view=h.get_trans_view;a.get_scale=h.get_scale;a.get_quat_view=
h.get_quat_view;a.invert=h.invert;a.to_mat4=function(a,b){b||(b=c.create());h.to_mat4(a,b);return b};a.from_mat4=h.from_mat4;a.multiply=h.multiply;a.transform_vec3=h.transform_vec3;a.transform_vec3_inv=h.transform_vec3_inv;a.transform_vectors=h.transform_vectors;a.transform_dir_vectors=h.transform_dir_vectors;a.transform_dir_vec3=h.transform_dir_vec3;a.transform_tangents=h.transform_tangents;a.translate=h.translate;a.interpolate=function(a,b,c,p){p||(p=h.create());h.interpolate(a,b,c,p);return p}};b4w.module.util=function(a,r){var u=r("__compat"),c=r("__obj_util"),b=r("__print"),h=r("__quat"),d=r("__util"),q=r("__vec3"),k=new Float32Array(6);a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.XYX=d.XYX;a.YZY=d.YZY;a.ZXZ=d.ZXZ;a.XZX=d.XZX;a.YXY=d.YXY;a.ZYZ=d.ZYZ;a.XYZ=d.XYZ;a.YZX=d.YZX;a.ZXY=d.ZXY;a.XZY=d.XZY;a.YXZ=d.YXZ;a.ZYX=
d.ZYX;a.f32=function(a){return new Float32Array(a||0)};a.assert=d.assert;a.keyfind=d.keyfind;a.keysearch=d.keysearch;a.matrix_to_quat=function(a){return d.matrix_to_quat(a)};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));return d.euler_to_quat(a,b)};a.ordered_angles_to_quat=function(a,b,c){c||(c=h.create());return d.ordered_angles_to_quat(a,b,c)};a.quat_to_ordered_angles=function(a,b,c){c||(c=q.create());return d.quat_to_ordered_angles(a,b,c)};a.quat_to_euler=function(a,b){b||(b=new Float32Array(3));
return d.quat_to_euler(a,b)};a.sign=d.sign;a.clamp=d.clamp;a.quat_to_dir=d.quat_to_dir;a.ground_project_quat=function(a,b){return d.quat_project(a,d.AXIS_MY,d.AXIS_Y,d.AXIS_MZ,b)};a.cam_quat_to_mesh_quat=function(a,b){return d.cam_quat_to_mesh_quat(a,b)};a.quat_project=function(a,c,h,g,k){return 0!=q.dot(h,g)?(b.error("Wrong in-plane direction"),null):d.quat_project(a,c,h,g,k)};a.hash_code=d.hash_code;a.smooth=d.smooth;a.smooth_v=d.smooth_v;a.is_vector=d.is_vector;a.correct_cam_quat_up=d.correct_cam_quat_up;
a.quat_to_angle_axis=d.quat_to_angle_axis;a.random_from_array=d.random_from_array;a.xz_direction=d.xz_direction;a.line_plane_intersect=function(a,c,h,g,m){b.error_deprecated("util.line_plane_intersect","math.line_plane_intersect");k[0]=h[0];k[1]=h[1];k[2]=h[2];k[3]=g[0];k[4]=g[1];k[5]=g[2];return d.line_plane_intersect(a,c,k,m)};a.is_mesh=function(a){b.error_deprecated("util.is_mesh","objects.is_mesh");return c.is_mesh(a)};a.is_armature=function(a){b.error_deprecated("util.is_armature","objects.is_armature");
return c.is_armature(a)};a.angle_wrap_0_2pi=d.angle_wrap_0_2pi;a.angle_wrap_periodic=d.angle_wrap_periodic;a.smooth_step=d.smooth_step;a.lerp=d.lerp;a.deg_to_rad=d.deg_to_rad;a.rad_to_deg=d.rad_to_deg;a.dir_to_quat=d.dir_to_quat;a.is_ie11=u.is_ie11};"object"==typeof module&&module.exports&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,r){r("__print");var u=r("__version");a.version=u.version;a.version_str=u.version_str;a.type=u.type;a.date=u.date;a.date_str=u.date_str};"object"==typeof module&&module.exports&&b4w.module.version(exports);b4w.module.objects=function(a,r){var u=r("__geometry"),c=r("__objects"),b=r("__batch"),h=r("__obj_util"),d=r("__print"),q=r("__scenes");a.get_meta_tags=function(a){if(a)return c.get_meta_tags(a)};a.copy=function(a,b,f){return h.is_mesh(a)?h.is_dynamic(a)?u.has_dyn_geom(a)||u.check_shape_keys(a)||!f?-1==c.get_scene_objs(q.get_active(),"MESH",c.DATA_ID_ALL).indexOf(a)?(d.error('object "'+a.name+'" does not belong to the active scene.'),!1):c.copy(a,b||"",f):(d.error('object "'+a.name+'" has not dynamic geometry for deep copying.'),
!1):(d.error('object "'+a.name+'" is not dynamic.'),!1):(d.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,c,f){h.is_dynamic_mesh(a)?b.set_nodemat_value(a,c,f):d.error('The type of the object "'+a.name+'" is not "MESH" or it is not dynamic.')};a.get_nodemat_value=function(a,c){return h.is_dynamic_mesh(a)?b.get_nodemat_value(a,c):(d.error('The type of the object "'+a.name+'" is not "MESH" or it is not dynamic.'),null)};a.set_nodemat_rgb=function(a,c,f,q,g){h.is_dynamic_mesh(a)?
b.set_nodemat_rgb(a,c,f,q,g):d.error('The type of the object "'+a.name+'" is not "MESH" or it is not dynamic.')};a.get_nodemat_rgb=function(a,c,f){if(!h.is_dynamic_mesh(a))return d.error('The type of the object "'+a.name+'" is not "MESH" or it is not dynamic.'),null;f||(f=new Float32Array(3));return b.get_nodemat_rgb(a,c,f)};a.update_boundings=function(a){h.is_mesh(a)?u.has_dyn_geom(a)||u.check_shape_keys(a)?c.update_boundings(a):d.error('object "'+a.name+'" has not dynamic geometry.'):d.error('The type of the object "'+
a.name+'" is not "MESH".')};a.get_parent=h.get_parent;a.get_dg_parent=h.get_dg_parent;a.is_mesh=h.is_mesh;a.is_armature=h.is_armature;a.is_speaker=h.is_speaker;a.is_camera=h.is_camera;a.is_lamp=h.is_lamp;a.is_empty=h.is_empty;a.is_line=h.is_line;a.is_world=h.is_world;a.get_selectable_objects=function(){return c.get_selectable_objects()};a.get_outlining_objects=function(){return c.get_outlining_objects()}};b4w.module.main=function(a,r){function u(){window.performance||(G.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(G.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});K.set_timeline(0)}function c(a,b){for(var c=null,d=b?ja:la,e=0;e<d.length;e++){var f=d[e];try{c=a.getContext(f,O)}catch(g){}if(c)break}c&&l.detect_tegra_invalid_enum_issue(c);return c}function b(a,b,c){a.addEventListener("webglcontextlost",
function(a){a.preventDefault();G.error("WebGL context lost");d()},!1);x.setup_context(c);var e=x.get_renderer_info();e&&G.log("%cRENDERER INFO:","color: #00a",c.getParameter(e.UNMASKED_VENDOR_WEBGL)+", "+c.getParameter(e.UNMASKED_RENDERER_WEBGL));Q.setup_context(c);y.setup_context(c);I.setup_context(c);S.setup_context(c);C.setup_context(c);t.setup_context(c);H.setup_canvas(a);t.init(a,b);v.setup_dim(a.width,a.height,1);P.init();ka=p();k()}function h(){W=function(){}}function d(){q()||(ia=performance.now()/
1E3,P.pause(),D.pause(),I.pause(),f.pause())}function q(){return da<ia}function k(){ha(k);var a=performance.now()/1E3;aa||(aa=a);var b=a-aa;if(!(b<1/ba.max_fps)){for(var c=K.get_timeline(),d=0;d<ta.length;d++)ta[d](c,b);q()||(da>aa&&(b-=da-Math.max(ia,aa)),c+=b,K.set_timeline(c),C.update(),g.update(),H.update(),d=b,H.is_primary_loaded()&&(E.reset(),B.update(d),n.update(c,d),e.update(c,d),P.update(c,d),d&&w.update(d),H.is_primary_loaded()&&(D.update(c,d),H.is_primary_loaded()&&(z.update(),F.update(c,
d),H.is_primary_loaded()&&(f.update(),M.update(c,d),X.update(),W(d,c),H.is_primary_loaded()&&(v.update(c,d),f.update_visibility(),A&&(A(ca.toDataURL()),A=null)))))),ka(b));aa=a}}function p(){var a=60,b=0,c=ba.fps_measurement_interval,d=ba.fps_callback_interval;return function(e){e<1/ba.max_fps||(a=N.smooth(1/e,a,e,c),e=D.get_fps(),b=(b+1)%d,0==b&&fa(Math.round(a),e))}}var f=r("__anchors"),w=r("__animation"),g=r("__assets"),m=r("__config"),l=r("__compat"),t=r("__container"),F=r("__controls"),H=r("__data"),
C=r("__debug"),x=r("__extensions"),y=r("__geometry"),z=r("__input"),E=r("__hud"),e=r("__nla"),n=r("__logic_nodes"),M=r("__objects"),D=r("__physics"),G=r("__print"),Q=r("__renderer"),v=r("__scenes"),P=r("__sfx"),S=r("__shaders"),I=r("__textures"),K=r("__time"),B=r("__transform"),N=r("__util"),J=r("__version"),X=r("__particles"),O=m.context,ba=m.defaults,ca=null,ga=null,aa=0,ia=0,da=0,ta=[],fa=function(){},ka=function(){},W=function(){},A=null,la=["webgl","experimental-webgl"],ja=["webgl2","experimental-webgl2"],
ha=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/ba.max_fps)}}();a.init=function(a,d){m.set_paths();G.set_verbose(ba.console_verbose);var e=J.version_str()+" "+J.type()+" ("+J.date_str()+")";G.log("%cINIT ENGINE","color: #00a",e);if(!window.WebGLRenderingContext)return null;u();ca=a;d?(E.init(d),ga=d):(m.defaults.show_hud_debug_info=
!1,m.sfx.mix_mode=!1);l.apply_context_alpha_hack();l.check_user_agent("Chrome")||l.check_user_agent("Firefox")||(ba.webgl2=!1);e=c(a,ba.webgl2);!e&&ba.webgl2&&(ba.webgl2=!1,e=c(a,!1));if(!e)return null;G.log("%cINIT WEBGL "+(ba.webgl2?"2":"1"),"color: #00a");b(ca,ga,e);m.apply_quality();l.set_hardware_defaults(e);S.load_shaders();ba.ie11_edge_touchscreen_hack&&(a.style["touch-action"]="none");G.log("%cSET PRECISION:","color: #00a",ba.precision);return e};a.resize=function(a,b,c){G.error_deprecated("main.resize",
"container.resize");t.resize(a,b,c)};a.set_fps_callback=function(a){fa=a};a.clear_fps_callback=function(){fa=function(){}};a.set_render_callback=function(a){W=a};a.clear_render_callback=function(){h()};a.global_timeline=function(){G.error_deprecated("main.global_timeline","time.get_timeline");return K.get_timeline()};a.pause=d;a.resume=function(){q()&&(da=performance.now()/1E3,P.resume(),D.resume(),I.play(!0),f.resume())};a.is_paused=q;a.reset=function(){H.unload(0);ga=ca=null;da=ia=aa=0;fa=function(){};
ka=function(){};W=function(){};ta.length=0;K.reset()};a.canvas_data_url=function(a){A=a};a.get_canvas_elem=function(){G.error_deprecated("main.get_canvas_elem","container.get_canvas");return ca};a.detect_mobile=function(){return l.detect_mobile()};a.append_loop_cb=function(a){for(var b=0;b<ta.length;b++)if(ta[b]==a)return;ta.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<ta.length;b++)if(ta[b]==a){ta.splice(b,1);break}}};b4w.module.nla=function(a,r){var u=r("__nla"),c=r("__time"),b=r("__print"),h=r("__util");a.set_frame=function(a){a=h.clamp(a,u.get_frame_start(),u.get_frame_end());u.check_logic_nodes()?b.error("The active scene is using NLA script."):u.set_frame(a,c.get_timeline())};a.get_frame=function(){return u.get_frame(c.get_timeline())};a.stop=function(){u.check_logic_nodes()?b.error("The active scene is using NLA script."):u.stop_nla()};a.play=function(a){u.check_logic_nodes()?b.error("The active scene is using NLA script."):
u.play_nla(a)};a.is_play=function(){return u.is_play()};a.get_frame_start=function(){return u.get_frame_start()};a.get_frame_end=function(){return u.get_frame_end()};a.check_nla=function(){return u.check_nla()};a.check_nla_scripts=function(){return u.check_logic_nodes()};a.check_logic_nodes=function(){return u.check_logic_nodes()};a.set_range=function(a,c){u.check_logic_nodes()?b.error("The active scene is using NLA script."):(c=parseFloat(c)||u.get_frame_end(),a=parseFloat(a)||u.get_frame_end(),
c=h.clamp(c,u.get_frame_start(),u.get_frame_end()),a=h.clamp(a,u.get_frame_start(),c),u.set_range(a,c))};a.reset_range=function(){u.check_logic_nodes()?b.error("The active scene is using NLA script."):u.reset_range()};a.set_cyclic=function(a){u.check_logic_nodes()?b.error("The active scene is using NLA script."):u.set_cyclic(a)};a.clear_callback=function(){u.check_logic_nodes()?b.error("The active scene is using NLA script."):u.clear_callback()}};b4w.module.app=function(a,r){function u(){var a=Q.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=Q.is_paused(),Q.pause()):a||Q.resume()},!1)}function c(){var a=0,b=e.get_container(),c=Q.is_paused(),d=!0;Q.append_loop_cb(function(){if(0==a%10){var e=b.getBoundingClientRect();e.top>window.innerHeight||0>e.bottom?(d&&(c=Q.is_paused()),Q.pause(),d=!1):c||d||(Q.resume(),d=!0)}a++})}function b(a,b,c,d){var f=document.createElement("canvas"),g=document.getElementById(a);
f.style.position="absolute";f.style.left=0;f.style.top=0;f.style.width=g.offsetWidth+"px";f.style.height=g.offsetHeight+"px";f.width=g.offsetWidth*window.devicePixelRatio;f.height=g.offsetHeight*window.devicePixelRatio;b?(b=document.createElement("canvas"),b.style.position="absolute",f.style.left=0,f.style.top=0,b.style.pointerEvents="none"):b=null;g||(P.error('Warning: canvas container "'+a+'" not found, appending to body'),g=document.body);g.appendChild(f);if(!Q.init(f,b))return c&&C("Browser could not initialize WebGL",
"For more info visit","https://www.blend4web.com/doc/en/problems_and_solutions.html",d),!1;b&&e.insert_to_container(b,"LAST");return!0}function h(a,b){a?(b&&(document.getElementById(b).style.display="block"),J=document.getElementById(a)):(J=document.createElement("div"),J.innerHTML=0,J.style.cssText="position:absolute;top: 23px;right: 20px;font-size: 45px;line-height: 50px;font-weight: bold;color: #000;",e.insert_to_container(J,"JUST_AFTER_CANVAS"))}function d(a,b){var c=String(a);b&&(c+="/"+String(b));
J.innerHTML=c}function q(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function k(){var a=e.get_container();e.resize(a.clientWidth,a.clientHeight,!0)}function p(a,b,c){var d=Math.max(y.hover_get_distance(a),1),e=I.get_rotation(a,da);b=K.quat_to_dir(e,b,aa);b[1]=0;B.normalize(b,b);B.scale(b,d*c,b);c=I.get_translation(a,ia);B.add(c,b,c);y.set_translation(a,c)}function f(a,b){var c=y.hover_get_vertical_limits(a,fa);if(c.up!=c.down){var d=y.get_camera_angles(a,
ga)[1],c=(c.down-d)/(c.down-c.up),d=y.hover_get_distance_limits(a,fa),c=Math.max(c,2/d.max);y.hover_rotate(a,0,c*b)}}function w(a,b,c,d){I.move_local(a,5*b,5*c,5*d)}function g(a,b,c){var d=y.target_get_distance(a),e=Math.abs(b);c=Math.pow(e*c,1-Math.pow(e*c,.15));I.move_local(a,0,0>b?.001<d?-d*c:0:c/(1-c)*d,0)}function m(a,b,c,d,e){for(a=d*c;0<b;--b)d+=a,e+=a,a=d*c;return e}function l(a,b,c,d,e,f){f?(e=y.target_get_pivot(a,aa),f=y.get_translation(a),e=B.dist(e,f)+d,d=0<b?m(a,b,-c,e,d):m(a,-b,c/(1-
c),e,d)):d-=b*e*c;return d}function t(a,b,c,d,e){X=a;O=b;ba=c;var h=S.get_active_camera();F(h);var k=!1,m=null,q=!1;switch(y.get_move_style(h)){case y.MS_TARGET_CONTROLS:k=!a;break;case y.MS_EYE_CONTROLS:m=S.get_first_character();break;case y.MS_STATIC:return;case y.MS_HOVER_CONTROLS:q=!0}var r=y.get_velocities(h,ta);a=n.create_elapsed_sensor();if(v.has_simulated_physics(h)){var t=n.create_collision_sensor(h,null,!0);n.create_sensor_manifold(h,"CAMERA_COLLISION",n.CT_POSITIVE,[t],null,function(a,
b,c){c=n.get_sensor_payload(a,b,0).coll_dist;if(0>c){var d=n.get_sensor_payload(a,b,0).coll_norm;b=aa;B.scale(d,-.25*c,b);c=I.get_translation(a,ia);B.add(c,b,c);I.set_translation_v(a,c)}})}if(m){var t=I.get_translation(h),u=I.get_rotation(h),u=K.cam_quat_to_mesh_quat(u);t[1]-=.5;v.set_transform(m,t,u);E.append_stiff_trans(h,m,[0,.5,0]);var x=new Float32Array(2),D=!0;v.set_character_move_type(m,v.CM_FLY);n.create_kb_sensor_manifold(h,"TOGGLE_CHAR_MOVE_TYPE",n.CT_SHOT,n.KEY_C,function(){D=!D;v.set_character_move_type(m,
D?v.CM_FLY:v.CM_WALK)})}var z=function(a,b,c){if(1==c)switch(c=n.get_sensor_value(a,b,0),y.get_velocities(a,r),b){case "FORWARD":m?x[0]=1:q?(b=y.get_camera_angles(a,ga)[1],b=Math.abs(b)>=Math.PI/4?K.AXIS_MZ:K.AXIS_MY,p(a,b,.5*r.trans*c)):k?g(a,-r.zoom,c):w(a,0,-r.trans*c,0);break;case "BACKWARD":m?x[0]=-1:q?(b=y.get_camera_angles(a,ga)[1],b=Math.abs(b)>=Math.PI/4?K.AXIS_Z:K.AXIS_Y,p(a,b,.5*r.trans*c)):k?g(a,r.zoom,c):w(a,0,r.trans*c,0);break;case "UP":q?f(a,30*-r.zoom*c):m||w(a,0,0,-r.trans*c);break;
case "DOWN":q?f(a,30*r.zoom*c):m||w(a,0,0,r.trans*c);break;case "LEFT":m?x[1]=1:q?p(a,K.AXIS_MX,.5*r.trans*c):w(a,-r.trans*c,0,0);break;case "RIGHT":m?x[1]=-1:q?p(a,K.AXIS_X,.5*r.trans*c):w(a,r.trans*c,0,0);break;case "ROT_LEFT":k?y.target_rotate(a,.75*-r.rot*c,0):y.eye_rotate(a,.75*r.rot*c,0);break;case "ROT_RIGHT":k?y.target_rotate(a,.75*r.rot*c,0):y.eye_rotate(a,.75*-r.rot*c,0);break;case "ROT_UP":k?y.target_rotate(a,0,.75*-r.rot*c):y.eye_rotate(a,0,.75*r.rot*c);break;case "ROT_DOWN":k?y.target_rotate(a,
0,.75*r.rot*c):y.eye_rotate(a,0,.75*-r.rot*c)}else switch(b){case "FORWARD":case "BACKWARD":m&&(x[0]=0);break;case "LEFT":case "RIGHT":m&&(x[1]=0)}m&&(v.set_character_move_dir(m,x[0],x[1]),a=y.get_camera_angles_char(a,ca),v.set_character_rotation(m,a[0],a[1]))},C=G.check_enable_gamepad_indices(),t=C.length?C[C.length-1]:0,J,P,Q,H,M,da;b?J=P=Q=H=M=da=b=t=n.create_custom_sensor(0):(J=n.create_keyboard_sensor(n.KEY_W),P=n.create_keyboard_sensor(n.KEY_S),Q=n.create_keyboard_sensor(n.KEY_A),H=n.create_keyboard_sensor(n.KEY_D),
M=n.create_keyboard_sensor(n.KEY_R),da=n.create_keyboard_sensor(n.KEY_F),b=n.create_gamepad_btn_sensor(G.GMPD_BUTTON_6,t),t=n.create_gamepad_btn_sensor(G.GMPD_BUTTON_7,t));var fa=n.create_keyboard_sensor(n.KEY_UP),za=n.create_keyboard_sensor(n.KEY_DOWN),ea=n.create_keyboard_sensor(n.KEY_LEFT),Ta=n.create_keyboard_sensor(n.KEY_RIGHT),u=n.create_gamepad_axis_sensor(G.GMPD_AXIS_0,C),Ia=n.create_gamepad_axis_sensor(G.GMPD_AXIS_1,C),ra=n.create_gamepad_axis_sensor(G.GMPD_AXIS_2,C),C=n.create_gamepad_axis_sensor(G.GMPD_AXIS_3,
C),Fa=function(a){return a[0]&&(a[1]||a[2]||a[3])},Da=function(a){return a[0]&&(a[1]||.1<a[2])},Ba=function(a){return a[0]&&(a[1]||-.1>a[2])},va=function(a){return a[0]&&(a[1]||a[2]||.1<a[3])},zc=function(a){return a[0]&&(a[1]||a[2]||-.1>a[3])};q||(n.create_sensor_manifold(h,"FORWARD",n.CT_CONTINUOUS,[a,J,Ia],Ba,z),n.create_sensor_manifold(h,"BACKWARD",n.CT_CONTINUOUS,[a,P,Ia],Da,z));k?(n.create_sensor_manifold(h,"ROT_UP",n.CT_CONTINUOUS,[a,fa,M,C],zc,z),n.create_sensor_manifold(h,"ROT_DOWN",n.CT_CONTINUOUS,
[a,za,da,C],va,z),n.create_sensor_manifold(h,"ROT_LEFT",n.CT_CONTINUOUS,[a,ea,Q,ra],zc,z),n.create_sensor_manifold(h,"ROT_RIGHT",n.CT_CONTINUOUS,[a,Ta,H,ra],va,z)):q?(n.create_sensor_manifold(h,"LEFT",n.CT_CONTINUOUS,[a,ea,Q,u],zc,z),n.create_sensor_manifold(h,"RIGHT",n.CT_CONTINUOUS,[a,Ta,H,u],va,z),n.create_sensor_manifold(h,"FORWARD",n.CT_CONTINUOUS,[a,fa,J,Ia],zc,z),n.create_sensor_manifold(h,"BACKWARD",n.CT_CONTINUOUS,[a,za,P,Ia],va,z),n.create_sensor_manifold(h,"UP",n.CT_CONTINUOUS,[a,da,C],
Da,z),n.create_sensor_manifold(h,"DOWN",n.CT_CONTINUOUS,[a,M,C],Ba,z)):(n.create_sensor_manifold(h,"UP",n.CT_CONTINUOUS,[a,M,b],Fa,z),n.create_sensor_manifold(h,"DOWN",n.CT_CONTINUOUS,[a,da,t],Fa,z),n.create_sensor_manifold(h,"LEFT",n.CT_CONTINUOUS,[a,Q,u],Ba,z),n.create_sensor_manifold(h,"RIGHT",n.CT_CONTINUOUS,[a,H,u],Da,z),n.create_sensor_manifold(h,"ROT_UP",n.CT_CONTINUOUS,[a,fa,C],Ba,z),n.create_sensor_manifold(h,"ROT_DOWN",n.CT_CONTINUOUS,[a,za,C],Da,z),n.create_sensor_manifold(h,"ROT_LEFT",
n.CT_CONTINUOUS,[a,ea,ra],Ba,z),n.create_sensor_manifold(h,"ROT_RIGHT",n.CT_CONTINUOUS,[a,Ta,ra],Da,z));if(!c){var La=0;c=n.create_mouse_wheel_sensor(d);var nb=0,z=n.create_touch_zoom_sensor(d);n.create_sensor_manifold(h,"MOUSE_WHEEL",n.CT_LEVEL,[c],null,function(a,b,c){1==c&&(b=n.get_sensor_value(a,b,0),y.get_velocities(a,r),k||q?La=l(a,b,r.zoom,La,2,k):(r.trans*=1+b*r.zoom,y.set_velocities(a,r)))});n.create_sensor_manifold(h,"TOUCH_ZOOM",n.CT_LEVEL,[z],null,function(a,b,c,d){1==c&&(c=n.get_sensor_value(a,
b,0),y.get_velocities(a,r),n.get_sensor_payload(a,b,0)===n.PL_MULTITOUCH_MOVE_ZOOM&&(nb=l(a,c,.03*r.zoom,nb,2,k)))});n.create_sensor_manifold(h,"ZOOM_INTERPOL",n.CT_POSITIVE,[a],null,function(a,b,c){if(k||q)1E-5<Math.abs(La)||1E-5<Math.abs(nb)?(c=n.get_sensor_value(a,b,0),b=K.smooth(La,0,c,.1*N),La-=b,c=K.smooth(nb,0,c,.15*N),nb-=c,q?f(a,-(b+c)):(b=y.target_get_distance(a)+b+c,b=Math.max(b,.001),y.target_set_distance(a,b))):nb=La=0})}var na=0,yb=0,ua=0,Ga=0;c=function(a,b,c,d){if(1==c){c=n.get_sensor_value(a,
b,1);y.get_velocities(a,r);if(q)e=.003*r.trans,f=7.5E-4*r.rot;else var e=.003*r.rot,f=7.5E-4*r.trans;if(1===n.get_sensor_payload(a,b,0))na+="X"==d?-c*e:0,yb+="Y"==d?-c*e:0;else if(2===n.get_sensor_payload(a,b,0)||3===n.get_sensor_payload(a,b,0))ua+="X"==d?-c*f:0,Ga+="Y"==d?-c*f:0}};var Na=0,Ka=0,z=function(a,b,c){y.get_velocities(a,r);Na+=.002*r.trans};J=function(a,b,c){y.get_velocities(a,r);Ka+=.05*r.zoom};P=function(a,b,c){y.get_velocities(a,r);Na-=.002*r.trans};Q=function(a,b,c){y.get_velocities(a,
r);Ka-=.05*r.zoom};k?(n.create_sensor_manifold(h,"GMPD_PAN_Y_POS",n.CT_CONTINUOUS,[b],null,J),n.create_sensor_manifold(h,"GMPD_PAN_Y_NEG",n.CT_CONTINUOUS,[t],null,Q),n.create_sensor_manifold(h,"GMPD_PAN_X_POS",n.CT_CONTINUOUS,[u],function(a){return-.1>a[0]},P),n.create_sensor_manifold(h,"GMPD_PAN_X_NEG",n.CT_CONTINUOUS,[u],function(a){return.1<a[0]},z)):q&&(n.create_sensor_manifold(h,"GMPD_PAN_X_POS",n.CT_CONTINUOUS,[ra],function(a){return-.1>a[0]},P),n.create_sensor_manifold(h,"GMPD_PAN_X_NEG",n.CT_CONTINUOUS,
[ra],function(a){return.1<a[0]},z));if(e){e=n.create_mouse_move_sensor("X",window);b=n.create_mouse_move_sensor("Y",window);var t=n.create_mouse_click_sensor(d),u=n.create_mouse_click_sensor(window),Pa=!1,ra=function(a){a[2]?Pa=!0:a[0]||(Pa=!1);return Pa&&a[0]};n.create_sensor_manifold(h,"MOUSE_X",n.CT_POSITIVE,[u,e,t],ra,c,"X");n.create_sensor_manifold(h,"MOUSE_Y",n.CT_POSITIVE,[u,b,t],ra,c,"Y");e=G.get_device_by_type_element(G.DEVICE_MOUSE,window);G.switch_prevent_default(e,!1)}else e=n.create_mouse_move_sensor("X",
d),b=n.create_mouse_move_sensor("Y",d),t=n.create_mouse_click_sensor(d),n.create_sensor_manifold(h,"MOUSE_X",n.CT_LEVEL,[t,e],null,c,"X"),n.create_sensor_manifold(h,"MOUSE_Y",n.CT_LEVEL,[t,b],null,c,"Y");var Wa=0,ya=0,bc=0,Ib=0;e=n.create_touch_move_sensor("X",d);d=n.create_touch_move_sensor("Y",d);b=function(a,b,c,d){if(1==c){y.get_velocities(a,r);var e=q?.003*r.trans:.003*r.rot;c=n.get_sensor_value(a,b,0);n.get_sensor_payload(a,b,0)===n.PL_SINGLE_TOUCH_MOVE?(Wa+="X"==d?-c*e:0,ya+="Y"==d?-c*e:0):
n.get_sensor_payload(a,b,0)===n.PL_MULTITOUCH_MOVE_PAN&&(a=q?.003*r.rot:7.5E-4*r.trans,bc+="X"==d?-c*a:0,Ib+="Y"==d?-c*a:0)}};n.create_sensor_manifold(h,"TOUCH_X",n.CT_LEVEL,[e],null,b,"X");n.create_sensor_manifold(h,"TOUCH_Y",n.CT_LEVEL,[d],null,b,"Y");n.create_sensor_manifold(h,"ROT_TRANS_INTERPOL",n.CT_POSITIVE,[a],null,function(a,b,c){if(1E-5<Math.abs(na)||1E-5<Math.abs(yb)||1E-5<Math.abs(Wa)||1E-5<Math.abs(ya)||1E-5<Math.abs(ua)||1E-5<Math.abs(Ga)||1E-5<Math.abs(bc)||1E-5<Math.abs(Ib)||1E-5<
Math.abs(Na)||1E-5<Math.abs(Ka)){var d=n.get_sensor_value(a,b,0),e=K.smooth(na,0,d,.08*N),f=K.smooth(yb,0,d,.08*N);na-=e;yb-=f;var g=K.smooth(Wa,0,d,.12*N),h=K.smooth(ya,0,d,.12*N);Wa-=g;ya-=h;b=K.smooth(ua,0,d,.08*N);var l=K.smooth(Ga,0,d,.08*N);ua-=b;Ga-=l;c=K.smooth(bc,0,d,.12*N);var r=K.smooth(Ib,0,d,.12*N);bc-=c;Ib-=r;var t=K.smooth(Na,0,d,.08*N),d=K.smooth(Ka,0,d,.08*N);Na-=t;Ka-=d;k?(y.target_rotate(a,e+g,f+h),f=y.target_get_distance(a),y.target_pan_pivot(a,f*(b+c+t),f*(l+r+d))):q?(e+g&&p(a,
K.AXIS_X,.2*(e+g)),f+h&&(l=y.get_camera_angles(a,ga)[1],l=Math.abs(l)>Math.PI/4?K.AXIS_Z:K.AXIS_Y,p(a,l,.2*(f+h))),y.hover_rotate(a,b+c+t,0)):(y.eye_rotate(a,.5*(e+g),.5*(f+h)),m&&(a=y.get_camera_angles_char(a,ca),v.set_character_rotation(m,a[0],a[1])))}});n.create_kb_sensor_manifold(h,"DEC_STEREO_DIST",n.CT_SHOT,n.KEY_LEFT_SQ_BRACKET,function(a,b,c){b=y.get_stereo_distance(a);y.set_stereo_distance(a,.9*b)});n.create_kb_sensor_manifold(h,"INC_STEREO_DIST",n.CT_SHOT,n.KEY_RIGHT_SQ_BRACKET,function(a,
b,c){b=y.get_stereo_distance(a);y.set_stereo_distance(a,1.1*b)})}function F(a){var b=y.get_move_style(a),c=n.create_callback_sensor(function(){var c=y.get_move_style(a),d=c!=b;b=c;return d});n.create_sensor_manifold(a,"CHANGE_MOVE_STYLE",n.CT_POSITIVE,[c],null,function(a,b,c){H();t(X,O,ba)})}function H(){for(var a=S.get_active_camera(),b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL CHANGE_MOVE_STYLE".split(" "),
c=0;c<b.length;c++)n.remove_sensor_manifold(a,b[c]);y.get_move_style(a)==y.MS_EYE_CONTROLS&&S.get_first_character()&&E.remove(a)}function C(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div");if(d)for(var h=0;h<d.length;h++){var k=document.getElementById(d[h]);k&&k.parentNode.removeChild(k)}e.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";f.style.cssText="color:#fff;font-size:24px;";
g.style.cssText="color:#fff;font-size:20px;";f.innerHTML=a;g.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(f);e.appendChild(g);document.body.appendChild(e)}function x(a,b,c,d,e){function f(){var h=performance.now()-g;e(b+h*(c-b)/d);(h>=d||!a.parentNode)&&Q.remove_loop_cb(f)}var g=performance.now();Q.append_loop_cb(f)}r("animation");var y=r("camera"),z=r("config"),E=r("constraints"),e=r("container"),n=r("controls"),
M=r("data"),D=r("debug"),G=r("input"),Q=r("main"),v=r("physics"),P=r("print"),S=r("scenes"),I=r("transform"),K=r("util"),B=r("vec3"),N=1,J=null,X=!1,O=!1,ba=!1,ca=new Float32Array(2),ga=new Float32Array(2),aa=new Float32Array(3),ia=new Float32Array(3);new Float32Array(3);var da=new Float32Array(4),ta={},fa={};a.init=function(a){a=a||{};var f=!1,g=null,l=function(){},m=null,p=null,q=0,r=null,v=!0,t=!0,w=!0,x=!1,B=!1,D=!1,y=!1,E;for(E in a)switch(E){case "canvas_container_id":g=a.canvas_container_id;
break;case "callback":l=a.callback;break;case "autoresize":f=a.autoresize;break;case "do_not_use_onload":break;case "show_hud_debug_info":D=a.show_hud_debug_info;break;case "sfx_mix_mode":x=a.sfx_mix_mode;break;case "show_fps":B=a.show_fps;break;case "track_container_position":y=a.track_container_position;break;case "fps_wrapper_id":r=a.fps_wrapper_id;break;case "fps_elem_id":p=a.fps_elem_id;break;case "error_purge_elements":m=a.error_purge_elements;break;case "report_init_failure":w=a.report_init_failure;
break;case "pause_invisible":t=a.pause_invisible;break;case "key_pause_enabled":v=a.key_pause_enabled;break;case "force_container_ratio":q=a.force_container_ratio;break;default:z.set(E,a[E])}a=function(a){a.keyCode==n.KEY_P&&(Q.is_paused()?Q.resume():Q.pause())};v&&document.addEventListener("keydown",a,!1);z.set("show_hud_debug_info",D);z.set("sfx_mix_mode",x);var C=D||x||null,v=function(){var a=b(g,C,w,m),n=e.get_canvas();if(a){var v=e.get_container();k();B&&(h(p,r),Q.set_fps_callback(d));t&&(u(),
c());q&&Q.append_loop_cb(function(){v.style.height=v.clientWidth/q+"px"});f&&Q.append_loop_cb(function(){var a=v.clientWidth,b=v.clientHeight;a==n.clientWidth&&b==n.clientHeight||e.resize(a,b,!0)});y&&Q.append_loop_cb(function(){e.force_offsets_updating()});l(n,!0)}else l(n,!1)};"complete"==document.readyState?window.setTimeout(v,0):window.addEventListener("load",v,!1);window.addEventListener("unload",function(){M.cleanup()},!1)};a.resize_to_container=k;a.set_onclick=function(a,b){var c=q(a);c.addEventListener("mouseup",
function(a){b(c.value)},!1)};a.set_onchange=function(a,b){var c=q(a);c.addEventListener("change",function(a){a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,b){var c=q(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.enable_camera_controls=t;a.disable_camera_controls=H;a.set_camera_move_style=function(a){P.error_deprecated_arr("app.set_camera_move_style",["camera.static_setup","camera.eye_setup","camera.target_setup","camera.hover_setup","camera.hover_setup_rel"]);
var b=S.get_active_camera();y.set_move_style(b,a)};a.enable_object_controls=function(a,b){var c=v.is_vehicle_chassis(a)||v.is_vehicle_hull(a),d=function(a,b,d){if(1==d)switch(d=n.get_sensor_value(a,b,0),b){case "FORWARD":c?v.vehicle_throttle(a,1):I.move_local(a,0,0,1*d);break;case "BACKWARD":c?v.vehicle_throttle(a,-1):I.move_local(a,0,0,-1*d);break;case "LEFT":c?v.vehicle_steer(a,-1):I.move_local(a,1*d,0,0);break;case "RIGHT":c?v.vehicle_steer(a,1):I.move_local(a,-1*d,0,0)}else switch(b){case "FORWARD":case "BACKWARD":c&&
v.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":c&&v.vehicle_steer(a,0)}},e=n.create_elapsed_sensor(),f=n.create_keyboard_sensor(n.KEY_W),g=n.create_keyboard_sensor(n.KEY_S),h=n.create_keyboard_sensor(n.KEY_A),k=n.create_keyboard_sensor(n.KEY_D),l=n.create_keyboard_sensor(n.KEY_UP),m=n.create_keyboard_sensor(n.KEY_DOWN),p=n.create_keyboard_sensor(n.KEY_LEFT),q=n.create_keyboard_sensor(n.KEY_RIGHT),r=function(a){return a[0]&&(a[1]||a[2])};n.create_sensor_manifold(a,"FORWARD",n.CT_CONTINUOUS,
[e,f,l],r,d);n.create_sensor_manifold(a,"BACKWARD",n.CT_CONTINUOUS,[e,g,m],r,d);n.create_sensor_manifold(a,"LEFT",n.CT_CONTINUOUS,[e,h,p],r,d);n.create_sensor_manifold(a,"RIGHT",n.CT_CONTINUOUS,[e,k,q],r,d)};a.disable_object_controls=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)n.remove_sensor_manifold(a,b[c])};a.enable_controls=function(a){P.error_once("app.enable_controls() deprecated")};a.disable_controls=function(){P.error_once("app.disable_controls() deprecated")};
a.enable_debug_controls=function(){n.create_kb_sensor_manifold(null,"CAMERA_SHOT",n.CT_SHOT,n.KEY_K,function(){D.make_camera_frustum_shot()});n.create_kb_sensor_manifold(null,"LIGHT_SHOT",n.CT_SHOT,n.KEY_L,function(){D.make_light_frustum_shot()});n.create_kb_sensor_manifold(null,"TELEMETRY",n.CT_SHOT,n.KEY_T,function(){D.plot_telemetry()})};a.request_fullscreen=function(a,b,c){function d(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||
document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",
d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.requestFullScreen()};a.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.check_fullscreen=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||
window.document.webkitFullscreenEnabled?!0:!1};a.report_app_error=C;a.get_url_params=function(a){a=!!a;var b=decodeURIComponent(location.href.toString());if(-1==b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("="),f=e[0];1<e.length?(e=e[1],a?f in c?c[f].push(e):c[f]=[e]:c[f]=e):a?f in c||(c[f]=[]):c[f]=""}return c};a.css_animate=function(a,b,c,d,e,f,g,h){function k(e){a&&(l[b]=f+e+g,c>d&&e<=d||c<d&&e>=d)&&(l[b]=f+d+g,h())}if(a&&b&&isFinite(c)&&
isFinite(d)&&isFinite(e)){f=f||"";g=g||"";h=h||function(){};var l=a.style,m=b.charAt(0).toUpperCase()+b.slice(1);if(void 0==l[b])if(void 0!=l["webkit"+m])b="webkit"+m;else if(void 0!=l["ms"+m])b="ms"+m;else if(void 0!=l["moz"+m])b="moz"+m;else return;x(a,c,d,e,k)}};a.attr_animate=function(a,b,c,d,e,f){function g(e){a&&(0<=e&&a.setAttribute(b,e),c>d&&e<=d||c<d&&e>=d)&&(a.setAttribute(b,d),f())}a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)&&(f=f||function(){},x(a,c,d,e,g))};a.queue_animate=function(b){if(b.length){var c=
b.shift(),d=c.elem,e=c.prop,f=c.from,g=c.to,h=c.duration,k=c.opt_prefix,l=c.opt_suffix,m=function(){c.cb&&c.cb();a.queue_animate(b)};"css"==c.type?a.css_animate(d,e,f,g,h,k,l,m):"attr"==c.type&&a.attr_animate(d,e,f,g,h,m)}};a.set_camera_smooth_factor=function(a){N=a};a.get_camera_smooth_factor=function(){return N}};b4w.module.camera_anim=function(a,r){function u(a,b,d,e,g){d=f.angle_wrap_0_2pi(b-d);d=Math.min(d,2*Math.PI-d);b=f.angle_wrap_0_2pi(e-b);b=Math.min(b,2*Math.PI-b);if(1E-6>Math.abs(d)||1E-6>2*Math.PI-Math.abs(d))d=0;if(1E-6>Math.abs(b)||1E-6>2*Math.PI-Math.abs(b))b=0;c.is_eye_camera(a)?(g[0]=b,g[1]=d):(g[0]=d,g[1]=b);return g}var c=r("camera"),b=r("controls"),h=r("print"),d=r("scenes"),q=r("time"),k=r("transform"),p=r("tsr"),f=r("util"),w=r("vec3"),g=r("quat"),m=new Float32Array(2),l=new Float32Array(2),
t=new Float32Array(3),F=new Float32Array(3),H=new Float32Array(3),C=new Float32Array(4),x=p.create(),y=p.create(),z=p.create(),E={},e=!1,n=!1,M=!1,D=!1;a.track_to_target=function(a,d,e,l,n,p,q,r){if(!c.is_eye_camera(a))h.error("track_to_target(): wrong object");else if(a&&d){if(f.is_vector(d))var u=d;else u=H,k.get_object_center(d,!1,u);d=e||1;e=l||2;var x=n||1;n=p||1;F[0]=0;F[1]=-1;F[2]=0;var D=k.get_rotation(a);p=f.quat_to_dir(D,F);l=c.get_camera_angles(a,m);var y=k.get_translation(a);w.subtract(u,
y,t);w.normalize(t,t);var E=g.rotationTo(p,t,g.create());g.multiply(E,D,C);f.correct_cam_quat_up(C,!1);w.subtract(u,y,F);var z=w.length(F)*(1-1/e),u=Math.asin(t[1]);e=Math.acos(-t[2]/Math.abs(Math.cos(u)));0<t[0]&&(e=2*Math.PI-e);var M=e-l[0],aa=u-l[1];H[0]=0;H[1]=0;H[2]=-1;e=k.get_rotation(a);0>f.quat_to_dir(e,H)[1]?(aa=0<p[1]?u-Math.PI+l[1]:u+Math.PI+l[1],M=0<M?-Math.PI+M:Math.PI+M):Math.abs(M)>Math.PI&&(M=0<M?M-2*Math.PI:M+2*Math.PI);var ia=0,u=b.create_elapsed_sensor();p=Math.abs(M/d);d=Math.abs(aa/
d);var da=p>d?p:d,ta=da+x,fa=ta+n,ka=fa+x,W=M,A=aa,la=z,ja=function(){b.remove_sensor_manifold(a,"TRACK_TO_TARGET");q&&q()};b.create_sensor_manifold(a,"TRACK_TO_TARGET",b.CT_CONTINUOUS,[u],null,function(a,d,e){if(e)if(c.is_eye_camera(a))if(e=b.get_sensor_value(a,d,0),ia+=e,ia<da){var f=M/da*e;e*=aa/da;d=ia/da;d=6*d*(1-d);f*=d;e*=d;W-=f;A-=e;c.eye_rotate(a,f,e)}else ia<ta?(W&&(c.eye_rotate(a,W,A),W=0,r&&r()),d=(ia-da)/x,e=-z*e/x,la-=f,k.move_local(a,0,6*e*d*(1-d),0)):ia<fa?la&&(k.move_local(a,0,la,
0),la=0):ia<ka?(d=(ia-fa)/x,e=z*e/x,e=6*e*d*(1-d),k.move_local(a,0,e,0)):(k.set_translation_v(a,y),ja());else ja()})}};a.auto_rotate=function(a,e,g){function k(d,e,g){if(1==g)if(g=c.get_move_style(d),g==c.MS_STATIC)n();else if(g!=c.MS_TARGET_CONTROLS&&g!=c.MS_EYE_CONTROLS||!c.has_horizontal_rot_limits(d))q=null,e=b.get_sensor_value(d,e,0),c.rotate_camera(d,e*a,0);else{g=g==c.MS_EYE_CONTROLS?c.eye_get_horizontal_limits(d,E):c.target_get_horizontal_limits(d,E);if(null===q||g.left!=q.left||g.right!=
q.right){q=q||{};q.left=g.left;q.right=g.right;r=Math.min(.2,f.angle_wrap_0_2pi(q.right-q.left)/2);g=p;var h=q,v=c.get_camera_angles(g,m)[0];g=u(g,v,h.left,h.right,l);t=a*Math.min(1,g[0]/.2,g[1]/.2)}e=b.get_sensor_value(d,e,0);g=c.get_camera_angles(d,m)[0];g=u(d,g,q.left,q.right,l);g[1]>r&&g[0]>r?t=f.sign(t)*a:g[1]<r?t-=Math.pow(a,2)/.4*e:g[0]<r&&(t+=Math.pow(a,2)/.4*e);c.rotate_camera(d,e*t,0)}}function n(){b.remove_sensor_manifold(p,"AUTO_ROTATE");b.remove_sensor_manifold(p,"DISABLE_AUTO_ROTATE");
e()}e=e||function(){};var p=d.get_active_camera();if(c.is_static_camera(p))h.error("auto_rotate(): Wrong camera move style");else{var q={},r=0,t=0;if(b.check_sensor_manifold(p,"AUTO_ROTATE"))n();else{var w=b.create_mouse_move_sensor("X"),x=b.create_mouse_move_sensor("Y"),D=b.create_mouse_click_sensor(),y=b.create_touch_move_sensor(),z=b.create_touch_zoom_sensor(),C=b.create_elapsed_sensor();g=g?b.create_mouse_wheel_sensor():b.create_custom_sensor(0);b.create_sensor_manifold(p,"DISABLE_AUTO_ROTATE",
b.CT_LEVEL,[w,x,D,y,z,g],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]||a[5]},n);b.create_sensor_manifold(p,"AUTO_ROTATE",b.CT_CONTINUOUS,[C],function(a){return a[0]},k)}}};a.is_auto_rotate=function(){var a=d.get_active_camera();return b.check_sensor_manifold(a,"AUTO_ROTATE")};a.check_auto_rotate=function(){var a=d.get_active_camera();return c.get_move_style(a)==c.MS_STATIC?!1:!0};a.move_camera_to_point=function(a,b,d,g,l){if(c.get_move_style(a)!=c.MS_STATIC)h.error("move_camera_to_point(): wrong camera type");
else if(!e)if(a)if(b){d=d||1;g=g||.01;var m=f.is_vector(a)?a:k.get_tsr(a,x),n=f.is_vector(b)?b:k.get_tsr(b,y);b=w.distance(p.get_trans_view(m),p.get_trans_view(n))/d;d=f.quat_to_dir(p.get_quat_view(m),f.AXIS_MY,t);var r=f.quat_to_dir(p.get_quat_view(n),f.AXIS_MY,F);d=Math.min(Math.abs(w.dot(d,r)),1);g=Math.acos(d)/g;g=1E3*Math.max(b,g);e=!0;var u=q.animate(0,1,g,function(b){var c=p.interpolate(m,n,f.smooth_step(b),z);M?(q.clear_animation(u),e=M=!1):(k.set_tsr(a,c),1==b&&(e=!1,l&&l()))})}else h.error("move_camera_to_point(): you must specify the point object");
else h.error("move_camera_to_point(): you must specify the camera object")};a.rotate_camera=function(a,b,d,e,f){if(c.get_move_style(a)==c.MS_STATIC)h.error("rotate_camera(): not supported for STATIC cameras");else if(!n)if(a)if(b||d){n=!0;var g=0,k=0,l=0!=b?b:d,m=q.animate(0,l,e||1E3,function(e){D?(q.clear_animation(m),n=D=!1):(g-=e,k-=e,d&&b?c.rotate_camera(a,g,k):d?c.rotate_camera(a,0,k):b&&c.rotate_camera(a,g,0),k=g=e,e==l&&(n=!1,f&&f()))})}else h.error("rotate_camera(): you must specify the rotation angle");
else h.error("rotate_camera(): you must specify the camera object")};a.stop_cam_moving=function(){M=!0};a.stop_cam_rotating=function(){D=!0};a.is_moving=function(){return e};a.is_rotating=function(){return n}};b4w.module.gp_conf=function(a,r){function u(){Q.length=0;for(var a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],b=0;b<a.length;b++)a[b]&&Q.push(a[b]);return Q}function c(a){var b=t.get(a+"_gmpd_stngs","b4w");if(b){var b=JSON.parse(b),c;for(c in b)l.set_gamepad_key(a,c,b[c])}else c=JSON.stringify(H),t.set(a+"_gmpd_stngs",c,"b4w")}function b(a){I=!0;var b=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),
f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("div"),k=document.createElement("div"),m=document.createElement("div"),n=document.createElement("div"),q=document.createElement("div"),r=document.createElement("div"),t=document.createElement("div"),u=document.createElement("div"),w=document.createElement("div"),x=document.createElement("div"),D=document.createElement("div"),y=document.createElement("div"),E=document.createElement("div"),z=document.createElement("div"),
G=document.createElement("div"),Q=document.createElement("div"),K=document.createElement("div");e=b;b.style.cssText="position: absolute;height: auto;background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg26627" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="128.51mm" viewBox="0 0 636.63517 455.33329" width="179.67mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/"><defs id="defs26629"><linearGradient id="linearGradient4691"><stop id="stop4693" offset="0"/><stop id="stop4695" stop-opacity="0" offset="1"/></linearGradient><linearGradient id="linearGradient4358"><stop id="stop4360" stop-color="#2e2e2e" offset="0"/><stop id="stop4362" stop-color="#2e2e2e" stop-opacity="0" offset="1"/></linearGradient><linearGradient id="linearGradient4364" x1="1141.5" xlink:href="#linearGradient4358" gradientUnits="userSpaceOnUse" y1="255.95" gradientTransform="matrix(-1 0 0 1 1531.4 560.1)" x2="1165.2" y2="309.88"/><linearGradient id="linearGradient4368" x1="1141.5" xlink:href="#linearGradient4358" gradientUnits="userSpaceOnUse" y1="255.95" gradientTransform="translate(-896.37 560.1)" x2="1165.2" y2="309.88"/><linearGradient id="linearGradient4430" x1="959.32" gradientUnits="userSpaceOnUse" y1="653.07" gradientTransform="matrix(-1 0 0 1 1531.4 70.097)" x2="1467.6" y2="653.07"><stop id="stop4426" stop-color="#4f4f4f" offset="0"/><stop id="stop4428" stop-color="#4f4f4f" stop-opacity="0" offset="1"/></linearGradient><linearGradient id="linearGradient4701" x1="529.91" xlink:href="#linearGradient4691" gradientUnits="userSpaceOnUse" y1="111.1" gradientTransform="translate(-52.276 546.89)" x2="481.49" y2="85.746"/><linearGradient id="linearGradient4713" x1="529.91" xlink:href="#linearGradient4691" gradientUnits="userSpaceOnUse" y1="111.1" gradientTransform="matrix(-1 0 0 1 689.01 546.89)" x2="481.49" y2="85.746"/><linearGradient id="linearGradient4725" x1="367.39" xlink:href="#linearGradient4691" gradientUnits="userSpaceOnUse" y1="125.6" gradientTransform="matrix(-1.3272 0 0 .68317 806.95 579.14)" x2="367.39" y2="116.11"/></defs><metadata id="metadata26632"><rdf:RDF><cc:Work rdf:about="">    <dc:format>image/svg+xml</dc:format>    <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/>    <dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -597.03)"><g id="g20" fill-rule="evenodd"><path id="path4209" fill="#434343" d="m576.71 1052.4c42.015-1.9097 64.296-46.468 59.204-122.86-5.0928-76.387-27.374-175.69-44.562-224.7-17.188-49.015-25.501-62.531-26.737-65.565-3.7697-9.2504-11.278-19.949-62.379-27.691-28.97-4.3891-16.697-7.9577-27.084-9.4696-17.96-2.6141-43.609-1.229-52.203 1.6354-8.594 2.8645-12.709 29.16-24.486 35.207-11.777 6.0473-19.416 10.185-80.149 10.185s-68.372-4.1376-80.149-10.185c-11.777-6.0473-18.113-32.099-25.736-36.993-11.183-7.1796-26.985-5.6722-54.891-0.57481-5.64 1.0302-1.1304 7.6212-18.165 12.509-32.913 9.4438-52.094 3.7056-65.087 20.831-1.9807 2.6106-11.822 21.096-29.01 70.111-17.179 48.95-39.46 148.25-44.553 224.64-5.0929 76.39 17.188 120.99 59.204 122.89 73.339-1.7 55.219-116.53 258.4-116.53s185.05 114.82 258.4 116.49z"/><path id="path4366" fill="url(#linearGradient4368)" d="m249.77 838.51c-107.76 0-171.55 96.288-176.84 121.23-5.2294 24.634-17.658 55.705 3.8195 53.789 9.6996-0.8655 18.053-15.713 37.559-38.193 18.78-21.643 41.379-54.425 96.763-54.425s73.209-44.877 75.119-53.152c1.9098-8.2752 2.4146-27.976-36.418-29.25z"/><path id="path4217" fill="url(#linearGradient4364)" d="m385.23 838.51c107.76 0 171.55 96.288 176.84 121.23 5.2293 24.634 17.658 55.705-3.8195 53.789-9.6996-0.8655-18.053-15.713-37.559-38.193-18.78-21.643-41.379-54.425-96.763-54.425s-73.209-44.877-75.119-53.152c-1.9098-8.2752-2.4146-27.976 36.418-29.25z"/><path id="path4370" fill="url(#linearGradient4430)" d="m572.06 654.81c-60.48-19.09-76.79-18.6-89.84-17.96-13.05 0.63657-22.638 16.617-45.237 49.4s-67.48 125.27-116.23 125.27c-48.746 0-93.626-92.491-116.23-125.27-22.599-32.783-32.008-48.942-45.059-49.579-13.05-0.63648-35.251 1.8354-95.728 20.932l1.1161-2.3404c60.494-19.1 81.754-20.83 94.804-20.19 13.05 0.63657 22.281 13.049 44.88 45.832s67.48 123.49 116.23 123.49c48.746 0 93.626-90.709 116.23-123.49 22.599-32.783 31.83-45.195 44.88-45.832 13.05-0.63648 28.783-1.6248 89.26 17.472"/><path id="path4315" fill="#343434" d="m570.99 652.48c-60.477-19.097-76.074-18.269-89.124-17.633-13.05 0.63658-22.281 14.832-44.88 47.614-22.599 32.783-67.48 125.27-116.23 125.27-48.746 0-93.626-92.491-116.23-125.27-22.599-32.783-31.83-46.978-44.88-47.614-13.05-0.63648-34.715 1.2996-95.192 20.396l1.1161-2.3404c60.474-19.1 81.024-22.26 94.074-21.62 13.05 0.63658 22.281 13.049 44.88 45.832s67.48 123.49 116.23 123.49c48.746 0 93.626-90.709 116.23-123.49 22.599-32.783 31.83-45.195 44.88-45.832 13.05-0.63647 27.71-0.17274 88.186 18.924"/></g><g id="g15645" transform="matrix(.75439 0 0 1 1558.5 -6638.3)" fill-rule="evenodd"><rect id="rect15584" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="2" ry="1.8461" height="44.307" width="570" y="6558.3" x="100.71" fill="#4164bb"/><rect id="rect15331" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="2" ry="1.8461" height="44.307" width="570" y="6554.6" x="100.71" fill="#5276cf"/></g><text id="text15623-9" style="word-spacing:0px;letter-spacing:0px" font-weight="300" xml:space="preserve" font-size="22px" line-height="430.99999428%" y="-53.755863" x="1792.7805" font-family="&apos;Noto Sans CJK TC&apos;" fill="#ffffff"><tspan id="tspan15625-5" y="-53.755863" x="1792.7805"/></text><text id="text15657" style="word-spacing:0px;letter-spacing:0px" font-weight="300" xml:space="preserve" font-size="13px" line-height="430.99999428%" y="-3.7607465" x="1670.2437" font-family="&apos;Noto Sans CJK TC&apos;" fill="#828282"><tspan id="tspan15659" y="-3.7607465" x="1670.2437"/></text><g id="g34" fill-rule="evenodd"><path id="path4675" fill="#303030" d="m551.75 628.4c9.3003 4.1796 8.2375 11.558 2.1302 9.9581-6.1073-1.6003-33.792-9.1405-46.239-11.577-12.446-2.4363-34.904-3.0623-36.951-4.0165-2.0474-0.95416 0.93313-7.7247 5.491-7.3449 23.258 0.91012 59.905 6.0339 75.569 12.98z"/><path id="path4677" fill="#303030" d="m474.88 602.61c3.6488 0.63684 4.1169 1.3708 2.4115 5.2499-0.80967 1.8416-1.261 3.904-3.4715 3.7336-4.456-0.34344-16.578-1.2846-25.692-1.3764-9.1139-0.0918-23.83 1.217-25.307 0.79399-1.4771-0.42301-1.8834-4.9141 1.7769-6.7458 4.6221-1.3593 38.698-3.2021 50.281-1.6553z"/><path id="path4699" opacity=".384" fill="url(#linearGradient4701)" d="m475.53 611.7c-11.693-0.63604-8.4597-0.73151-44.068 54.448-6.5182 8.6489-22.874 37.231-36.865 35.326-6.7491-1.4177 15.436-67.299 22.724-75.767 11.112-12.911 19.255-16.122 58.209-14.007z"/><path id="path4703" fill="#303030" d="m84.068 628.4c-9.3003 4.1796-8.2375 11.558-2.1302 9.9581 6.1073-1.6003 33.792-9.1405 46.239-11.577 12.446-2.4363 34.904-3.0623 36.951-4.0165 2.0474-0.95416-0.93313-7.7247-5.491-7.3449-23.258 0.91012-59.905 6.0339-75.569 12.98z"/><path id="path4705" fill="#303030" d="m161.86 602.61c-3.6488 0.63684-4.1169 1.3708-2.4115 5.2499 0.80967 1.8416 1.261 3.904 3.4715 3.7336 4.456-0.34344 16.578-1.2846 25.692-1.3764 9.1139-0.0918 23.83 1.217 25.307 0.79399 1.4771-0.42301 1.8834-4.9141-1.7769-6.7458-4.6221-1.3593-38.698-3.2021-50.281-1.6553z"/><path id="path4711" opacity=".384" fill="url(#linearGradient4713)" d="m161.2 611.7c11.693-0.63604 8.4597-0.73151 44.068 54.448 6.5182 8.6489 22.874 37.231 36.865 35.326 6.7491-1.4177-15.436-67.299-22.724-75.767-11.112-12.911-19.255-16.122-58.209-14.007z"/><path id="path4717" opacity=".115" fill="url(#linearGradient4725)" d="m413.37 645.84c-9.0496 10.007-29.401 19.937-36.775 19.937h-52.205c-31.171 0-37.359 0.34506-47.75 0.51758-10.39 0.17253-18.682 0.65628-23.653-3.278-5.0513-3.9977-24-15.425-24-15.425 53.346 4.1464 144.49 4.3368 184.38-1.7523z"/></g></g><g id="layer1-0" fill-rule="evenodd" transform="translate(159.08 -720.76)"><g id="g4527-3" transform="translate(-961.22,330.69)"><ellipse id="circle4233-8" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="66.284" ry="66.279" cy="655.39" cx="1027.5" fill="#303030"/><ellipse id="circle4235-8" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="62.007" ry="62.003" cy="655.39" cx="1027.5" fill="#4c4c4c"/><ellipse id="circle4237-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="43.41" ry="43.408" cy="655.39" cx="1027.5" fill="#303030"/></g><g id="g4523-1" transform="translate(-961.22,330.69)"><ellipse id="circle4239-4" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="40.057" ry="40.054" cy="655.39" cx="1027.5" fill="#3b63c9"/><ellipse id="circle4243-3" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="36.23" ry="36.228" cy="655.39" cx="1027.5" fill="#5276cf"/></g><g id="g3506" transform="translate(-961.22,330.69)"><ellipse id="ellipse3508" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="66.284" ry="66.279" cy="655.39" cx="1027.5" fill="#303030"/><ellipse id="ellipse3510" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="62.007" ry="62.003" cy="655.39" cx="1027.5" fill="#4c4c4c"/><ellipse id="ellipse3512" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="43.41" ry="43.408" cy="655.39" cx="1027.5" fill="#303030"/></g></g><g id="layer1-7" fill-rule="evenodd" transform="translate(352.57 -719.72)"><g id="g4527-3-4" transform="translate(-961.22,330.69)"><ellipse id="circle4233-8-8" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="66.284" ry="66.279" cy="655.39" cx="1027.5" fill="#303030"/><ellipse id="circle4235-8-9" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="62.007" ry="62.003" cy="655.39" cx="1027.5" fill="#4c4c4c"/><ellipse id="circle4237-7-3" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="43.41" ry="43.408" cy="655.39" cx="1027.5" fill="#303030"/></g><g id="g4523-1-1" transform="translate(-961.22,330.69)"><ellipse id="circle4239-4-4" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="40.057" ry="40.054" cy="655.39" cx="1027.5" fill="#3b63c9"/><ellipse id="circle4243-3-5" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="36.23" ry="36.228" cy="655.39" cx="1027.5" fill="#5276cf"/></g><g id="g3506-2" transform="translate(-961.22,330.69)"><ellipse id="ellipse3508-1" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="66.284" ry="66.279" cy="655.39" cx="1027.5" fill="#303030"/><ellipse id="ellipse3510-1" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="62.007" ry="62.003" cy="655.39" cx="1027.5" fill="#4c4c4c"/><ellipse id="ellipse3512-4" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="43.41" ry="43.408" cy="655.39" cx="1027.5" fill="#303030"/></g></g></svg>')+
"');width: 637px;height: 455px;background-size: 100% 100%;left: 50%;margin-bottom: 40px;-moz-transform: translateX(-50%);-ms-transform: translateX(-50%);-webkit-transform: translateX(-50%);bottom: 0px;";c.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3904" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="35.924mm" width="35.926mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 127.29808 127.28933"><metadata id="metadata3909"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" fill-rule="evenodd" transform="translate(0 -925.07)"><ellipse id="circle4330" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="63.649" ry="63.645" cy="988.72" cx="63.649" fill="#303030"/><ellipse id="circle4223" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="59.705" ry="59.701" cy="988.72" cx="63.649" fill="#4c4c4c"/></g></svg>')+
"');position: absolute;top: 47px;left: 65px;width: 135px;height: 135px;";d.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3754" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.711mm" width="9.9653mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 35.3101 37.950677"><metadata id="metadata3759"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1014.4)"><path id="path4326" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m34.81 1017.1c-15.254-3.8172-24.634-1.7612-34.31 0v16.247h0.015c-0.013 0.097-0.013 0.1951-0.015 0.2928 0.0006 9.4753 7.6813 18.256 17.156 18.256 9.4739-0.0005 17.154-8.7813 17.154-18.256 0-0.097-0.014-0.1952-0.014-0.2928h0.014z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>')+
"');width: 36px;height: 38px;left: 49px;top: 8px;position: absolute;";f.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3790" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.9646mm" width="10.711mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 37.953175 35.3077"><metadata id="metadata3795"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1017.1)"><path id="path4324" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m35.298 1017.6c3.8175 15.253 1.7611 24.633 0 34.308h-16.248v-0.015c-0.098 0.01-0.1952 0.01-0.2928 0.015-9.476-0.0006-18.258-7.6807-18.257-17.154 0.0005-9.4733 8.7818-17.153 18.257-17.153 0.098 0 0.1952 0.01 0.2928 0.011v-0.011z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>')+
"');width: 38px;height: 36px;top: 47px;left: 84px;position: absolute;";g.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3754" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.711mm" width="9.9653mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 35.3101 37.950677"><metadata id="metadata3759"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1014.4)"><path id="path4328" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m34.81 1049.7c-15.254 3.8172-24.634 1.7612-34.31 0v-16.247h0.015c-0.013-0.097-0.013-0.1951-0.015-0.2928 0.0006-9.4753 7.6813-18.256 17.156-18.256 9.4739 0.0005 17.154 8.7813 17.154 18.256 0 0.097-0.014 0.1952-0.014 0.2928h0.014z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>')+
"');width: 36px;height: 38px;bottom: 11px;left: 51px;position: absolute;";h.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3790" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.9646mm" width="10.711mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 37.953175 35.3077"><metadata id="metadata3795"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1017.1)"><path id="path4324" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m2.6552 1051.9c-3.8175-15.253-1.7611-24.633 0-34.308h16.248v0.015c0.098-0.01 0.1952-0.01 0.2928-0.015 9.476 0.0006 18.258 7.6807 18.257 17.154-0.0005 9.4733-8.7818 17.153-18.257 17.153-0.098 0-0.1952-0.01-0.2928-0.011v0.011z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>')+
"');width: 38px;height: 36px;top: 47px;left: 13px;position: absolute;";k.style.cssText="position: absolute;top: 55px;left: 434px;width: 150px;height: 150px;";m.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>')+
"');width: 50px;height: 50px;left: 53px;top: 0px;position: absolute;";n.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>')+
"');width: 50px;height: 50px;left: 107px;top: 51px;position: absolute;";q.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>')+
"');width: 50px;height: 50px;left: 53px;bottom: 0px;position: absolute;";r.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>')+
"');width: 50px;height: 50px;top: 51px;position: absolute;";t.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3461" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="22.608mm" width="22.61mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 80.114398 80.108405"><metadata id="metadata3466"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(.0000019915 -972.25)"><g id="g3514-7" fill-rule="evenodd" transform="translate(-987.45 356.91)"><ellipse id="ellipse3516-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="40.057" ry="40.054" cy="655.39" cx="1027.5" fill="#3b63c9"/><ellipse id="ellipse3518-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="36.23" ry="36.228" cy="655.39" cx="1027.5" fill="#5276cf"/></g></g></svg>')+
"');position: absolute;top: 222px;left: 183px;width: 85px;height: 85px;";u.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3461" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="22.608mm" width="22.61mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 80.114398 80.108405"><metadata id="metadata3466"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(.0000019915 -972.25)"><g id="g3514-7" fill-rule="evenodd" transform="translate(-987.45 356.91)"><ellipse id="ellipse3516-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="40.057" ry="40.054" cy="655.39" cx="1027.5" fill="#3b63c9"/><ellipse id="ellipse3518-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="36.23" ry="36.228" cy="655.39" cx="1027.5" fill="#5276cf"/></g></g></svg>')+
"');position: absolute;top: 223px;left: 376px;width: 85px;height: 85px;";w.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3699" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.2811mm" width="9.2817mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 32.8879 32.88565"><metadata id="metadata3704"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" fill-rule="evenodd" transform="translate(0 -1019.5)"><ellipse id="ellipse4575" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="16.444" ry="16.443" cy="1035.9" cx="16.444" fill="#2e2e2e"/><ellipse id="ellipse4577" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="15.112" ry="15.11" stroke="#4364b2" cy="1035.9" cx="16.444" fill="#5276cf"/><ellipse id="ellipse4579" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="11.867" ry="11.866" cy="1035.9" cx="16.444" fill="#434343"/></g></svg>')+
"');position: absolute;top: 76px;left: 227px;width: 34px;height: 34px;";x.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3699" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.2811mm" width="9.2817mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 32.8879 32.88565"><metadata id="metadata3704"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" fill-rule="evenodd" transform="translate(0 -1019.5)"><ellipse id="ellipse4575" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="16.444" ry="16.443" cy="1035.9" cx="16.444" fill="#2e2e2e"/><ellipse id="ellipse4577" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="15.112" ry="15.11" stroke="#4364b2" cy="1035.9" cx="16.444" fill="#5276cf"/><ellipse id="ellipse4579" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="11.867" ry="11.866" cy="1035.9" cx="16.444" fill="#434343"/></g></svg>')+
"');position: absolute;top: 76px;left: 376px;width: 34px;height: 34px;";D.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="21.241671mm" height="8.8544388mm" viewBox="0 0 75.265762 31.373996" id="svg3447" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="l1.svg"><defs id="defs3449" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="1.4" inkscape:cx="-254.57869" inkscape:cy="228.81952" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3452"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(1.5000945e-8,-1020.9882)"><path style="fill:#5276cf;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.99999994px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="m 11.026383,1051.1651 c -7.4440599,1.9144 -7.5133499,2.2466 -9.7963799,-4.4934 -1.81058997,-5.3452 -2.44278,-8.8152 4.01547,-12.116 2.74038,-1.4007 13.7365799,-5.877 38.4768299,-10.72 24.26031,-4.749 25.16653,-2.7967 26.79132,0.3418 1.15503,2.2311 1.8961,4.1561 2.94279,6.651 3.08552,8.5188 2.92609,8.5778 -6.08214,9.5501 -19.09891,2.1414 -37.95723,5.8307 -56.34789,10.7865 z" id="path4289" inkscape:connector-curvature="0" sodipodi:nodetypes="cssssccc" /></g></svg>')+
"');position: absolute;top: 4px;left: 78px;width: 79px;height: 33px;";y.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3447" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="8.8544mm" width="21.242mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 75.265762 31.373996"><metadata id="metadata3452"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(1.5001e-8 -1021)"><path id="path4715" d="m64.239 1051.2c7.4441 1.9144 7.5134 2.2466 9.7964-4.4934 1.8106-5.3452 2.4428-8.8152-4.0155-12.116-2.7404-1.4007-13.737-5.877-38.477-10.72-24.26-4.749-25.167-2.7967-26.791 0.3418-1.155 2.2311-1.8961 4.1561-2.9428 6.651-3.0855 8.5188-2.9261 8.5778 6.0822 9.5501 19.099 2.1414 37.957 5.8307 56.348 10.786z" fill-rule="evenodd" fill="#5276cf"/></g></svg>')+
"');position: absolute;top: 4px;left: 477px;width: 79px;height: 33px;";E.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3560" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="4.7796mm" width="13.57mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 48.082162 16.935645"><metadata id="metadata3565"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1035.4)"><path id="path4727" d="m42.857 1052.2c4.7071 0.4081 4.7981 0.6563 5.1414-4.9139 0.16344-2.6517 0.16699-6.1108-0.72615-8.0342-0.59471-1.2808-1.7793-2.049-3.7642-2.4662-2.5264-0.531-16.253-1.4345-26.685-1.3241-15.118 0.16-15.362 1.4769-15.855 4.1522-0.35071 1.9018-0.5016 3.5056-0.74837 5.5967-0.55261 7.0693-0.44908 7.0921 5.0452 6.5411 11.661-1.1062 25.929-0.7359 37.592 0.4484z" fill-rule="evenodd" fill="#5276cf"/></g></svg>')+
"');position: absolute;top: -7px;left: 425px;width: 50px;height: 17px;";z.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3560" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="4.7796mm" width="13.57mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 48.082162 16.935645"><metadata id="metadata3565"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1035.4)"><path id="path4727" d="m42.857 1052.2c4.7071 0.4081 4.7981 0.6563 5.1414-4.9139 0.16344-2.6517 0.16699-6.1108-0.72615-8.0342-0.59471-1.2808-1.7793-2.049-3.7642-2.4662-2.5264-0.531-16.253-1.4345-26.685-1.3241-15.118 0.16-15.362 1.4769-15.855 4.1522-0.35071 1.9018-0.5016 3.5056-0.74837 5.5967-0.55261 7.0693-0.44908 7.0921 5.0452 6.5411 11.661-1.1062 25.929-0.7359 37.592 0.4484z" fill-rule="evenodd" fill="#5276cf"/></g></svg>')+
"');position: absolute;top: -7px;left: 164px;width: 50px;height: 17px;";G.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="24.603382mm" height="24.601696mm" viewBox="0 0 87.177338 87.171363" id="svg3640" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="main.svg"><defs id="defs3642" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="1.979899" inkscape:cx="61.113463" inkscape:cy="69.71796" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3645"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(0,-965.19093)"><ellipse ry="43.585682" rx="43.588669" style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:#2e2e2e;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.99999994;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" id="ellipse4372" cx="43.588669" cy="1008.7766" /><ellipse cy="1008.7766" cx="43.588669" id="circle4239-1" style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:#5276cf;fill-opacity:1;fill-rule:evenodd;stroke:#4364b2;stroke-width:0.99999994;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" rx="40.056705" ry="40.053959" /><ellipse style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:#434343;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.99999994;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" id="circle4243-0" cx="43.588669" cy="1008.7766" rx="31.455994" ry="31.453836" /></g></svg>')+
"');position: absolute;top: 68px;left: 274px;width: 92px;height: 92px;";Q.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3407" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="41.787mm" width="41.786mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 148.0624 148.06251"><metadata id="metadata3412"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -904.3)" fill="#e6e6e6"><path id="rect4545" d="m74.031 904.3-14.469 22.156h8.0313v8.2187h12.875v-8.2187h8.0625l-14.5-22.156z"/><path id="rect4603" d="m125.94 963.86v8.0313h-8.25v12.906h8.25v8.0313l22.125-14.5-22.125-14.469z"/><path id="rect4609" d="m67.594 1022v8.25h-8.0313l14.469 22.125 14.5-22.125h-8.0625v-8.25h-12.875z"/><path id="rect4615" d="m22.156 963.86-22.156 14.47l22.156 14.5v-8.2188h8.2188v-12.906h-8.2188v-7.8438z"/><path id="path4619" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m54.393 924.58c-15.821 5.7885-28.404 18.385-34.188 34.219h11.156c4.6667-10.175 12.865-18.361 23.031-23.031v-11.188zm39.219 0.031v11.156c10.167 4.6713 18.361 12.86 23.031 23.031h11.156c-5.7846-15.821-18.379-28.393-34.188-34.188zm-73.375 73.438c5.7899 15.816 18.348 28.403 34.156 34.188v-11.156c-10.163-4.6691-18.364-12.861-23.031-23.031h-11.125zm96.406 0c-4.6712 10.167-12.868 18.361-23.031 23.031v11.125c15.796-5.7901 28.366-18.352 34.156-34.156h-11.125z"/></g></svg>')+
"');position: absolute;top: 186px;left: 148px;width: 157px;height: 157px;";K.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3407" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="41.787mm" width="41.786mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 148.0624 148.06251"><metadata id="metadata3412"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -904.3)" fill="#e6e6e6"><path id="rect4545" d="m74.031 904.3-14.469 22.156h8.0313v8.2187h12.875v-8.2187h8.0625l-14.5-22.156z"/><path id="rect4603" d="m125.94 963.86v8.0313h-8.25v12.906h8.25v8.0313l22.125-14.5-22.125-14.469z"/><path id="rect4609" d="m67.594 1022v8.25h-8.0313l14.469 22.125 14.5-22.125h-8.0625v-8.25h-12.875z"/><path id="rect4615" d="m22.156 963.86-22.156 14.47l22.156 14.5v-8.2188h8.2188v-12.906h-8.2188v-7.8438z"/><path id="path4619" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m54.393 924.58c-15.821 5.7885-28.404 18.385-34.188 34.219h11.156c4.6667-10.175 12.865-18.361 23.031-23.031v-11.188zm39.219 0.031v11.156c10.167 4.6713 18.361 12.86 23.031 23.031h11.156c-5.7846-15.821-18.379-28.393-34.188-34.188zm-73.375 73.438c5.7899 15.816 18.348 28.403 34.156 34.188v-11.156c-10.163-4.6691-18.364-12.861-23.031-23.031h-11.125zm96.406 0c-4.6712 10.167-12.868 18.361-23.031 23.031v11.125c15.796-5.7901 28.366-18.352 34.156-34.156h-11.125z"/></g></svg>')+
"');position: absolute;top: 187px;left: 339px;width: 157px;height: 157px;";b.appendChild(Q);b.appendChild(K);c.appendChild(d);c.appendChild(f);c.appendChild(g);c.appendChild(h);b.appendChild(c);k.appendChild(m);k.appendChild(n);k.appendChild(q);k.appendChild(r);b.appendChild(k);b.appendChild(t);b.appendChild(u);b.appendChild(w);b.appendChild(x);b.appendChild(D);b.appendChild(y);b.appendChild(E);a.appendChild(b);b.appendChild(z);b.appendChild(G);v.length=0;C.length=0;P.length=0;S.length=0;v.push(q,
n,r,m,D,y,z,E,w,x,t,u,d,g,h,f,G);C.push('<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>',
'<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>',
'<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>',
'<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="21.241671mm" height="8.8544388mm" viewBox="0 0 75.265762 31.373996" id="svg3447" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="l1.svg"><defs id="defs3449" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="1.4" inkscape:cx="-254.57869" inkscape:cy="228.81952" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3452"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(1.5000945e-8,-1020.9882)"><path style="fill:#5276cf;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.99999994px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="m 11.026383,1051.1651 c -7.4440599,1.9144 -7.5133499,2.2466 -9.7963799,-4.4934 -1.81058997,-5.3452 -2.44278,-8.8152 4.01547,-12.116 2.74038,-1.4007 13.7365799,-5.877 38.4768299,-10.72 24.26031,-4.749 25.16653,-2.7967 26.79132,0.3418 1.15503,2.2311 1.8961,4.1561 2.94279,6.651 3.08552,8.5188 2.92609,8.5778 -6.08214,9.5501 -19.09891,2.1414 -37.95723,5.8307 -56.34789,10.7865 z" id="path4289" inkscape:connector-curvature="0" sodipodi:nodetypes="cssssccc" /></g></svg>',
'<svg id="svg3447" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="8.8544mm" width="21.242mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 75.265762 31.373996"><metadata id="metadata3452"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(1.5001e-8 -1021)"><path id="path4715" d="m64.239 1051.2c7.4441 1.9144 7.5134 2.2466 9.7964-4.4934 1.8106-5.3452 2.4428-8.8152-4.0155-12.116-2.7404-1.4007-13.737-5.877-38.477-10.72-24.26-4.749-25.167-2.7967-26.791 0.3418-1.155 2.2311-1.8961 4.1561-2.9428 6.651-3.0855 8.5188-2.9261 8.5778 6.0822 9.5501 19.099 2.1414 37.957 5.8307 56.348 10.786z" fill-rule="evenodd" fill="#5276cf"/></g></svg>',
'<svg id="svg3560" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="4.7796mm" width="13.57mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 48.082162 16.935645"><metadata id="metadata3565"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1035.4)"><path id="path4727" d="m42.857 1052.2c4.7071 0.4081 4.7981 0.6563 5.1414-4.9139 0.16344-2.6517 0.16699-6.1108-0.72615-8.0342-0.59471-1.2808-1.7793-2.049-3.7642-2.4662-2.5264-0.531-16.253-1.4345-26.685-1.3241-15.118 0.16-15.362 1.4769-15.855 4.1522-0.35071 1.9018-0.5016 3.5056-0.74837 5.5967-0.55261 7.0693-0.44908 7.0921 5.0452 6.5411 11.661-1.1062 25.929-0.7359 37.592 0.4484z" fill-rule="evenodd" fill="#5276cf"/></g></svg>',
'<svg id="svg3560" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="4.7796mm" width="13.57mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 48.082162 16.935645"><metadata id="metadata3565"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1035.4)"><path id="path4727" d="m42.857 1052.2c4.7071 0.4081 4.7981 0.6563 5.1414-4.9139 0.16344-2.6517 0.16699-6.1108-0.72615-8.0342-0.59471-1.2808-1.7793-2.049-3.7642-2.4662-2.5264-0.531-16.253-1.4345-26.685-1.3241-15.118 0.16-15.362 1.4769-15.855 4.1522-0.35071 1.9018-0.5016 3.5056-0.74837 5.5967-0.55261 7.0693-0.44908 7.0921 5.0452 6.5411 11.661-1.1062 25.929-0.7359 37.592 0.4484z" fill-rule="evenodd" fill="#5276cf"/></g></svg>',
'<svg id="svg3699" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.2811mm" width="9.2817mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 32.8879 32.88565"><metadata id="metadata3704"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" fill-rule="evenodd" transform="translate(0 -1019.5)"><ellipse id="ellipse4575" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="16.444" ry="16.443" cy="1035.9" cx="16.444" fill="#2e2e2e"/><ellipse id="ellipse4577" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="15.112" ry="15.11" stroke="#4364b2" cy="1035.9" cx="16.444" fill="#5276cf"/><ellipse id="ellipse4579" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="11.867" ry="11.866" cy="1035.9" cx="16.444" fill="#434343"/></g></svg>',
'<svg id="svg3699" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.2811mm" width="9.2817mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 32.8879 32.88565"><metadata id="metadata3704"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" fill-rule="evenodd" transform="translate(0 -1019.5)"><ellipse id="ellipse4575" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="16.444" ry="16.443" cy="1035.9" cx="16.444" fill="#2e2e2e"/><ellipse id="ellipse4577" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="15.112" ry="15.11" stroke="#4364b2" cy="1035.9" cx="16.444" fill="#5276cf"/><ellipse id="ellipse4579" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="11.867" ry="11.866" cy="1035.9" cx="16.444" fill="#434343"/></g></svg>',
'<svg id="svg3461" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="22.608mm" width="22.61mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 80.114398 80.108405"><metadata id="metadata3466"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(.0000019915 -972.25)"><g id="g3514-7" fill-rule="evenodd" transform="translate(-987.45 356.91)"><ellipse id="ellipse3516-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="40.057" ry="40.054" cy="655.39" cx="1027.5" fill="#3b63c9"/><ellipse id="ellipse3518-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="36.23" ry="36.228" cy="655.39" cx="1027.5" fill="#5276cf"/></g></g></svg>',
'<svg id="svg3461" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="22.608mm" width="22.61mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 80.114398 80.108405"><metadata id="metadata3466"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(.0000019915 -972.25)"><g id="g3514-7" fill-rule="evenodd" transform="translate(-987.45 356.91)"><ellipse id="ellipse3516-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="40.057" ry="40.054" cy="655.39" cx="1027.5" fill="#3b63c9"/><ellipse id="ellipse3518-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="36.23" ry="36.228" cy="655.39" cx="1027.5" fill="#5276cf"/></g></g></svg>',
'<svg id="svg3754" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.711mm" width="9.9653mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 35.3101 37.950677"><metadata id="metadata3759"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1014.4)"><path id="path4326" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m34.81 1017.1c-15.254-3.8172-24.634-1.7612-34.31 0v16.247h0.015c-0.013 0.097-0.013 0.1951-0.015 0.2928 0.0006 9.4753 7.6813 18.256 17.156 18.256 9.4739-0.0005 17.154-8.7813 17.154-18.256 0-0.097-0.014-0.1952-0.014-0.2928h0.014z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>',
'<svg id="svg3754" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.711mm" width="9.9653mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 35.3101 37.950677"><metadata id="metadata3759"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1014.4)"><path id="path4328" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m34.81 1049.7c-15.254 3.8172-24.634 1.7612-34.31 0v-16.247h0.015c-0.013-0.097-0.013-0.1951-0.015-0.2928 0.0006-9.4753 7.6813-18.256 17.156-18.256 9.4739 0.0005 17.154 8.7813 17.154 18.256 0 0.097-0.014 0.1952-0.014 0.2928h0.014z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>',
'<svg id="svg3790" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.9646mm" width="10.711mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 37.953175 35.3077"><metadata id="metadata3795"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1017.1)"><path id="path4324" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m2.6552 1051.9c-3.8175-15.253-1.7611-24.633 0-34.308h16.248v0.015c0.098-0.01 0.1952-0.01 0.2928-0.015 9.476 0.0006 18.258 7.6807 18.257 17.154-0.0005 9.4733-8.7818 17.153-18.257 17.153-0.098 0-0.1952-0.01-0.2928-0.011v0.011z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>',
'<svg id="svg3790" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.9646mm" width="10.711mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 37.953175 35.3077"><metadata id="metadata3795"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1017.1)"><path id="path4324" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m35.298 1017.6c3.8175 15.253 1.7611 24.633 0 34.308h-16.248v-0.015c-0.098 0.01-0.1952 0.01-0.2928 0.015-9.476-0.0006-18.258-7.6807-18.257-17.154 0.0005-9.4733 8.7818-17.153 18.257-17.153 0.098 0 0.1952 0.01 0.2928 0.011v-0.011z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="24.603382mm" height="24.601696mm" viewBox="0 0 87.177338 87.171363" id="svg3640" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="main.svg"><defs id="defs3642" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="1.979899" inkscape:cx="61.113463" inkscape:cy="69.71796" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3645"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(0,-965.19093)"><ellipse ry="43.585682" rx="43.588669" style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:#2e2e2e;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.99999994;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" id="ellipse4372" cx="43.588669" cy="1008.7766" /><ellipse cy="1008.7766" cx="43.588669" id="circle4239-1" style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:#5276cf;fill-opacity:1;fill-rule:evenodd;stroke:#4364b2;stroke-width:0.99999994;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" rx="40.056705" ry="40.053959" /><ellipse style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:#434343;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.99999994;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" id="circle4243-0" cx="43.588669" cy="1008.7766" rx="31.455994" ry="31.453836" /></g></svg>');
P.push(t,t,u,u);S.push(Q,K);for(a=0;a<v.length;a++)v[a].setAttribute("id","pad_btn_"+a),v[a].setAttribute("data-colorstate","B"),v[a].setAttribute("data-key",a),v[a].setAttribute("data-svgid",a);Q.setAttribute("id","pad_left_axis");Q.setAttribute("data-colorstate","GR");Q.setAttribute("data-key",l.GMPD_AXIS_0);Q.setAttribute("data-svgid",C.length);K.setAttribute("id","pad_right_axis");K.setAttribute("data-colorstate","GR");K.setAttribute("data-key",l.GMPD_AXIS_2);K.setAttribute("data-svgid",C.length+
1);C.push('<svg id="svg3407" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="41.787mm" width="41.786mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 148.0624 148.06251"><metadata id="metadata3412"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -904.3)" fill="#e6e6e6"><path id="rect4545" d="m74.031 904.3-14.469 22.156h8.0313v8.2187h12.875v-8.2187h8.0625l-14.5-22.156z"/><path id="rect4603" d="m125.94 963.86v8.0313h-8.25v12.906h8.25v8.0313l22.125-14.5-22.125-14.469z"/><path id="rect4609" d="m67.594 1022v8.25h-8.0313l14.469 22.125 14.5-22.125h-8.0625v-8.25h-12.875z"/><path id="rect4615" d="m22.156 963.86-22.156 14.47l22.156 14.5v-8.2188h8.2188v-12.906h-8.2188v-7.8438z"/><path id="path4619" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m54.393 924.58c-15.821 5.7885-28.404 18.385-34.188 34.219h11.156c4.6667-10.175 12.865-18.361 23.031-23.031v-11.188zm39.219 0.031v11.156c10.167 4.6713 18.361 12.86 23.031 23.031h11.156c-5.7846-15.821-18.379-28.393-34.188-34.188zm-73.375 73.438c5.7899 15.816 18.348 28.403 34.156 34.188v-11.156c-10.163-4.6691-18.364-12.861-23.031-23.031h-11.125zm96.406 0c-4.6712 10.167-12.868 18.361-23.031 23.031v11.125c15.796-5.7901 28.366-18.352 34.156-34.156h-11.125z"/></g></svg>',
'<svg id="svg3407" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="41.787mm" width="41.786mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 148.0624 148.06251"><metadata id="metadata3412"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -904.3)" fill="#e6e6e6"><path id="rect4545" d="m74.031 904.3-14.469 22.156h8.0313v8.2187h12.875v-8.2187h8.0625l-14.5-22.156z"/><path id="rect4603" d="m125.94 963.86v8.0313h-8.25v12.906h8.25v8.0313l22.125-14.5-22.125-14.469z"/><path id="rect4609" d="m67.594 1022v8.25h-8.0313l14.469 22.125 14.5-22.125h-8.0625v-8.25h-12.875z"/><path id="rect4615" d="m22.156 963.86-22.156 14.47l22.156 14.5v-8.2188h8.2188v-12.906h-8.2188v-7.8438z"/><path id="path4619" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m54.393 924.58c-15.821 5.7885-28.404 18.385-34.188 34.219h11.156c4.6667-10.175 12.865-18.361 23.031-23.031v-11.188zm39.219 0.031v11.156c10.167 4.6713 18.361 12.86 23.031 23.031h11.156c-5.7846-15.821-18.379-28.393-34.188-34.188zm-73.375 73.438c5.7899 15.816 18.348 28.403 34.156 34.188v-11.156c-10.163-4.6691-18.364-12.861-23.031-23.031h-11.125zm96.406 0c-4.6712 10.167-12.868 18.361-23.031 23.031v11.125c15.796-5.7901 28.366-18.352 34.156-34.156h-11.125z"/></g></svg>');
p(v,F);p(S,"#e6e6e6")}function h(a){return[m.create_gamepad_btn_sensor(l.GMPD_BUTTON_0,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_1,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_2,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_3,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_4,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_5,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_6,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_7,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_8,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_9,
a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_10,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_11,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_12,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_13,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_14,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_15,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_16,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_17,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_18,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_19,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_20,
a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_21,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_22,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_23,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_24,a),m.create_gamepad_btn_sensor(l.GMPD_BUTTON_25,a)]}function d(a){return[m.create_gamepad_axis_sensor(l.GMPD_AXIS_0,a),m.create_gamepad_axis_sensor(l.GMPD_AXIS_1,a),m.create_gamepad_axis_sensor(l.GMPD_AXIS_2,a),m.create_gamepad_axis_sensor(l.GMPD_AXIS_3,a),m.create_gamepad_axis_sensor(l.GMPD_AXIS_4,a),m.create_gamepad_axis_sensor(l.GMPD_AXIS_5,
a),m.create_gamepad_axis_sensor(l.GMPD_AXIS_6,a),m.create_gamepad_axis_sensor(l.GMPD_AXIS_7,a),m.create_gamepad_axis_sensor(l.GMPD_AXIS_8,a),m.create_gamepad_axis_sensor(l.GMPD_AXIS_9,a),m.create_gamepad_axis_sensor(l.GMPD_AXIS_10,a),m.create_gamepad_axis_sensor(l.GMPD_AXIS_11,a)]}function q(a,b){var c=document.createElement("input");c.style.cssText="display: inline-block;position = relative;";c.setAttribute("type","radio");c.setAttribute("name","choice");var d=document.createElement("label");d.textContent=
b;d.style.cssText="position = relative;display: inline-block;color: white;";a.appendChild(c);a.appendChild(d);return c}function k(a){E.removeChild(e);e=null;switch(a){case "PAD":D.checked=!0;b(E);break;case "WHEEL":M.checked=!0;var c=E;I=!1;var d=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("div"),k=document.createElement("div"),m=document.createElement("div"),n=document.createElement("div"),q=document.createElement("div"),
r=document.createElement("div"),t=document.createElement("div"),u=document.createElement("div"),w=document.createElement("div"),x=document.createElement("div"),y=document.createElement("div"),z=document.createElement("div"),G=document.createElement("div"),Q=document.createElement("div"),K=document.createElement("div"),H=document.createElement("div"),Ha=document.createElement("div"),R=document.createElement("div"),V=document.createElement("div"),Z=document.createElement("div"),qa=document.createElement("div");
document.createElement("div");document.createElement("div");a=document.createElement("div");var Aa=document.createElement("div"),U=document.createElement("div"),oa=document.createElement("div"),pa=document.createElement("div"),L=document.createElement("div");e=d;var ma="position: absolute;height: auto;background-image: url('data:image/svg+xml;base64,"+btoa('<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>')+
"');width: 19px;height: 19px;background-size: 100% 100%;";d.style.cssText="position: absolute;background-image: url('data:image/svg+xml;base64,"+btoa('<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="112.08413mm" height="128.46834mm" viewBox="0 0 397.14849 455.20277" id="svg3440" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel.svg"><defs id="defs3442" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="0.98994949" inkscape:cx="421.01508" inkscape:cy="52.510802" inkscape:document-units="px" inkscape:current-layer="g87" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3445"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title /></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(-2.3645008e-8,-597.15942)"><path inkscape:connector-curvature="0" style="fill:#4d4d4d;stroke:#6e6e6e;stroke-width:2.99125171;stroke-miterlimit:4;stroke-dasharray:none" id="path4140" d="m 307.84153,715.52552 c -4.35995,43.11849 -2.78952,86.66385 -15.90234,128.54337 -10.85452,25.86023 -13.33477,47.2976 6.91492,61.09536 7.23778,50.7442 78.38013,47.39232 82.20535,0 23.06079,-14.19054 13.49405,-42.79138 6.91492,-61.09536 -17.40045,-40.83001 -4.82581,-86.43019 -15.90235,-128.54337 -8.3177,-20.33228 -56.75348,-20.7661 -64.22927,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#cccccc;stroke:#1a1a1a;stroke-width:2.09465766;stroke-miterlimit:4;stroke-dasharray:none" id="path4266" d="m 313.11812,724.1957 -3.84514,68.80568 c 4.64168,13.40814 62.19981,10.8172 61.83082,0 l -3.84515,-68.80568 c -4.46942,-24.00369 -52.58756,-18.95946 -54.13979,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#353535;stroke:#2c2c2c;stroke-width:2.11880326;stroke-miterlimit:4;stroke-dasharray:none" id="path4156" d="m 304.91419,870.673 c -12.36924,67.40381 80.42804,69.69607 70.55134,0 -6.57605,-36.5947 -65.0964,-34.8253 -70.55134,0 z m 60.53812,3.9862 c 8.65841,48.24354 -57.58987,49.86644 -50.52489,0 4.7009,-26.27069 46.6394,-24.84292 50.52489,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#e6e6e6;stroke:#969696;stroke-width:2.99125171;stroke-miterlimit:4;stroke-dasharray:none" id="path4011" d="m 106.04576,696.97906 c -11.197076,4.25792 -17.123706,8.24834 -17.123706,8.24834 l -66.18493,16.33946 1.40291,30.64619 46.54715,-7.67623 c 17.00932,-1.6438 32.551896,8.94676 38.302026,23.34506 l 2.78663,65.4778 27.6363,0 2.78663,-65.4778 c 8.0428,-15.3291 20.46247,-27.10803 38.30202,-23.34506 l 46.54716,7.67623 1.40291,-30.64619 -66.18493,-16.33946 c 0,0 -5.92627,-3.99074 -17.12371,-8.24834 -13.45408,-4.31874 -26.62772,-4.20804 -39.08982,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#252525;stroke:#6e6e6e;stroke-width:2.99125171;stroke-miterlimit:4;stroke-dasharray:none" id="path2996" d="m 38.311064,931.09899 c -8.01574,5.05649 -22.76006,21.74743 -26.34852,58.0567 -4.1290804,35.18581 -4.8394604,60.59901 28.55878,61.68771 l 162.934726,0 c 39.19437,1.1693 30.46155,-41.5992 28.55878,-61.68771 -3.58839,-36.30927 -18.33277,-52.99983 -26.34851,-58.0567 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#373737;stroke:#6e6e6e;stroke-width:2.83429575;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none" id="path3019" d="m 26.230254,979.1291 c -11.50334,14.44882 -11.98241,47.3999 -0.33519,57.1202 l 191.802226,0 c 12.10111,-12.3068 9.93082,-46.99573 -0.33518,-57.1202 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#808080;stroke:#1a1a1a;stroke-width:2.14882827;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0" id="path4133" d="m 360.82498,854.6914 a 20.634815,21.265151 0 1 1 -41.269,0 20.634815,21.265151 0 1 1 41.269,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#333333;stroke:#000000;stroke-width:2.11880326;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0" id="path4280" d="m 351.64051,761.132 a 11.444622,11.75148 0 1 1 -22.88896,0 11.444622,11.75148 0 1 1 22.88896,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#313131;stroke:#565656;stroke-width:2.93434715;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0" id="path3993" d="m 125.52855,598.62659 c -68.528026,0 -124.0613764,57.81925 -124.0613764,129.13695 0,71.31265 55.5370404,129.13696 124.0613764,129.13696 68.52804,0 124.07984,-57.81926 124.07984,-129.13696 0,-71.31264 -55.55611,-129.13695 -124.07984,-129.13695 z m -1.00095,23.63932 c 10.01261,0.0734 20.238,1.32074 28.95237,3.51006 11.62203,3.80301 21.53624,8.52304 31.01135,16.15381 26.21752,19.0207 43.36275,50.36277 43.36275,85.83029 0,58.01564 -45.80548,105.05244 -102.30928,105.05244 -56.500726,0 -102.309276,-47.03364 -102.309276,-105.05244 0,-32.14848 14.06783,-60.91918 36.22336,-80.19121 11.45168,-11.11714 23.14136,-17.13322 37.3943,-21.79731 7.855846,-2.48302 17.655666,-3.5835 27.668276,-3.51006 z" stroke-miterlimit="4" /><g style="stroke-miterlimit:4;stroke-dasharray:none" id="g4127" stroke-miterlimit="4" transform="matrix(0.61498728,0,0,0.63147657,-18.171616,453.28593)"><g id="g4111"><path style="fill:#808080;stroke:#373737;stroke-width:3.56837296" inkscape:connector-curvature="0" id="rect3040" d="m 110.97,771.16 31.694,4.8776 1.3007,44.257 -32.995,0 z" /><path style="fill:#b3b3b3;stroke:#565656;stroke-width:3.4000001;stroke-linecap:butt;stroke-linejoin:miter" inkscape:connector-curvature="0" id="path3024" d="m 96.83,686.82 58.353,-5.0761 c 15.608,27.569 6.8304,64.333 -5.0761,90.545 l -53.841,-2.538 z" /></g><g id="g4115" transform="translate(97.984785,0)"><path style="fill:#808080;stroke:#373737;stroke-width:3.56837296" inkscape:connector-curvature="0" id="path4117" d="m 110.97,771.16 31.694,4.8776 1.3007,44.257 -32.995,0 z" /><path style="fill:#b3b3b3;stroke:#565656;stroke-width:3.4000001;stroke-linecap:butt;stroke-linejoin:miter" inkscape:connector-curvature="0" id="path4119" d="m 96.83,686.82 58.353,-5.0761 c 15.608,27.569 6.8304,64.333 -5.0761,90.545 l -53.841,-2.538 z" /></g><g id="g4121" transform="translate(195.96959,0)"><path style="fill:#808080;stroke:#373737;stroke-width:3.56837296" inkscape:connector-curvature="0" id="path4123" d="m 110.97,771.16 31.694,4.8776 1.3007,44.257 -32.995,0 z" /><path style="fill:#b3b3b3;stroke:#565656;stroke-width:3.4000001;stroke-linecap:butt;stroke-linejoin:miter" inkscape:connector-curvature="0" id="path4125" d="m 96.83,686.82 58.353,-5.0761 c 15.608,27.569 6.8304,64.333 -5.0761,90.545 l -53.841,-2.538 z" /></g></g><g style="fill:#666666;stroke:#969696;stroke-width:3.99777174;stroke-miterlimit:4;stroke-dasharray:none" id="g4051" transform="translate(-42.878584,98.083591)" stroke-miterlimit="4"><g id="g4437" transform="matrix(0.74686368,0,0,0.74686368,-73.374214,285.30447)"><path inkscape:connector-curvature="0" id="rect4348" style="color:#000000;text-indent:0;text-transform:none;block-progression:tb;fill:#ffffff" d="m 567.31,584.22 0,42.25 0,3.4062 0,42.25 3.375,0 0,-42.25 27.062,0 0,42.25 3.375,0 0,-42.25 27.062,0 0,42.25 3.375,0 0,-42.25 27.062,0 0,42.25 3.4062,0 0,-43.969 0,-1.6875 -1.7188,0 -28.75,0 0,-42.25 -3.375,0 0,42.25 -27.062,0 0,-42.25 -3.375,0 0,42.25 -27.062,0 0,-42.25 -3.375,0 z" /><g style="fill:#a02c2c;stroke:#ffffff;stroke-width:3.4000001;stroke-linecap:square" id="g87" /></g></g></g></svg>')+
"');width: 397px;height: 455px;-moz-transform: translateX(-50%);-ms-transform: translateX(-50%);-webkit-transform: translateX(-50%);transform: translateX(-50%);background-size: 100% 100%;left: 50%;margin-left: 25px;margin-bottom: 40px;bottom: 0px;";f.style.cssText=ma+"top: 132px;left: 331px;";g.style.cssText=ma+"top: 122px;left: 315px;";h.style.cssText=ma+"top: 122px;left: 347px;";k.style.cssText=ma+"top: 113px;left: 331px;";m.style.cssText="position: absolute;height: auto;background-image: url('data:image/svg+xml;base64,"+
btoa('<svg id="svg3400" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.507mm" width="15.1mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 53.504016 37.228838"><metadata id="metadata3405"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(-2.847e-7 -1015.1)"><path id="path4049" d="m26.584 1016.1c-12.631 0-23.15 9.858-25.478 22.922l50.705 12.18c0.47921-2.1565 0.73023-4.4099 0.73023-6.7204 0-15.677-11.621-28.382-25.957-28.382z" stroke="#5276cf" stroke-linecap="square" stroke-width="1.9247" fill="#666"/></g></svg>')+
"');width: 54px;height: 37px;background-size: 100% 100%;top: 84px;left: 166px;";n.style.cssText="position: absolute;height: auto;background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3400" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.507mm" width="15.1mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 53.504016 37.228838"><metadata id="metadata3405"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(-2.847e-7 -1015.1)"><path id="path4033" d="m26.92 1016.1c-14.337 0-25.957 12.707-25.957 28.382 0 2.3225 0.26742 4.5784 0.74876 6.7386l50.681-12.18c-2.321-13.072-12.841-22.944-25.476-22.944z" stroke="#5276cf" stroke-linecap="square" stroke-width="1.9247" fill="#666"/></g></svg>')+
"');width: 54px;height: 37px;background-size: 100% 100%;top: 84px;left: 36px;";q.style.cssText=ma+"top: 107px;left: 141px;";r.style.cssText=ma+"top: 107px;left: 90px;";t.style.cssText=ma+"top: 185px;left: 321px;";u.style.cssText=ma+"top: 185px;left: 340px;";w.style.cssText=ma+"top: 179px;left: 358px;";x.style.cssText=ma+"top: 178px;left: 303px;";y.style.cssText=ma+"top: 210px;left: 299px;";z.style.cssText=ma+"top: 279px;left: 299px;";G.style.cssText=ma+"top: 210px;left: 321px;";Q.style.cssText=ma+
"top: 279px;left: 321px;";K.style.cssText=ma+"top: 210px;left: 344px;";H.style.cssText=ma+"top: 278px;left: 344px;";Ha.style.cssText=ma+"top: 124px;left: 147px;";R.style.cssText=ma+"top: 138px;left: 133px;";V.style.cssText=ma+"top: 124px;left: 82px;";Z.style.cssText=ma+"top: 138px;left: 96px;";qa.style.cssText=ma+"top: 278px;left: 367px;";ma="position: absolute;background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3386" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="12.859mm" width="5.2917mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 18.749999 45.562501"><metadata id="metadata3391"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1006.8)"><path id="rect4575" d="m9.3125 1006.8-9.3125 14.25h5.3125v17.094h-5.1875l9.3125 14.219 9.3125-14.219h-5.1562v-17.094h5.0312l-9.3125-14.25z" fill="#e6e6e6"/></g></svg>')+
"');width: 19px;height: 46px;background-size: 100% 100%;";a.style.cssText=ma+"top: 291px;left: 50px;";Aa.style.cssText=ma+"top: 291px;left: 111px;";U.style.cssText=ma+"top: 291px;left: 171px;";oa.style.cssText="position: absolute;background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3458" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="50.447mm" width="83.899mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 297.28131 178.75"><metadata id="metadata3463"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -873.61)" fill="#e6e6e6"><path id="path4535" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m33.875 873.61-18.5 8.8125 5.0626 3.0625c-12.899 22.78-20.438 49.17-20.438 77.44 0 28.284 7.5315 54.691 20.438 77.469l-5.0626 3.0625 18.5 8.8125 0.6563-20.469-5.531 3.3c-12.002-21.2-18.937-45.8-18.937-72.18 0-26.362 6.9415-50.99 18.937-72.188l5.5313 3.3438-0.6563-20.469z"/><path id="path4551" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m263.38 873.71-0.6562 20.469 5.5312-3.3438c11.996 21.198 18.969 45.825 18.969 72.188 0 26.371-6.9672 51.011-18.969 72.219l-5.5312-3.3437 0.6562 20.469 18.5-8.8125-5.0312-3.0625c12.906-22.778 20.438-49.184 20.438-77.469 0-28.275-7.5391-54.665-20.438-77.438l5.0312-3.0625-18.5-8.8125z"/></g></svg>')+
"');width: 297px;height: 179px;background-size: 100% 100%;top: 43px;left: -25px;";pa.style.cssText="position: absolute;background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3378" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="2.9016mm" width="9.2516mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 32.781198 10.281199"><metadata id="metadata3383"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1042.1)"><path id="rect4585" d="m32.781 1047.2-7.875-5.125v2.8437h-17.031v-2.8437l-7.875 5.1 7.875 5.1562v-2.8437h17.031v2.8437z" fill="#e6e6e6"/></g></svg>')+
"');width: 33px;height: 10px;background-size: 100% 100%;top: 159px;left: 324px;";L.style.cssText="position: absolute;background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3378" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.2516mm" width="2.9016mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 10.281248 32.7812"><metadata id="metadata3383"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1019.6)"><path id="rect4585" d="m5.125 1019.6-5.125 7.9h2.8437v17.031h-2.8437l5.125 7.875 5.1562-7.875h-2.8438v-17.031h2.8438z" fill="#e6e6e6"/></g></svg>')+
"');width: 10px;height: 33px;background-size: 100% 100%;top: 148px;left: 335px;";c.appendChild(d);d.appendChild(a);d.appendChild(Aa);d.appendChild(U);d.appendChild(oa);d.appendChild(pa);d.appendChild(L);d.appendChild(f);d.appendChild(g);d.appendChild(h);d.appendChild(k);d.appendChild(m);d.appendChild(n);d.appendChild(q);d.appendChild(r);d.appendChild(t);d.appendChild(u);d.appendChild(w);d.appendChild(x);d.appendChild(y);d.appendChild(z);d.appendChild(G);d.appendChild(Q);d.appendChild(K);d.appendChild(H);
d.appendChild(Ha);d.appendChild(R);d.appendChild(V);d.appendChild(Z);d.appendChild(qa);v.length=0;C.length=0;P.length=0;S.length=0;v.push(f,g,h,k,m,n,q,r,t,u,w,x,y,z,G,Q,K,H,Ha,R,V,Z,qa);C.push('<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg id="svg3400" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.507mm" width="15.1mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 53.504016 37.228838"><metadata id="metadata3405"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(-2.847e-7 -1015.1)"><path id="path4049" d="m26.584 1016.1c-12.631 0-23.15 9.858-25.478 22.922l50.705 12.18c0.47921-2.1565 0.73023-4.4099 0.73023-6.7204 0-15.677-11.621-28.382-25.957-28.382z" stroke="#5276cf" stroke-linecap="square" stroke-width="1.9247" fill="#666"/></g></svg>',
'<svg id="svg3400" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.507mm" width="15.1mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 53.504016 37.228838"><metadata id="metadata3405"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(-2.847e-7 -1015.1)"><path id="path4033" d="m26.92 1016.1c-14.337 0-25.957 12.707-25.957 28.382 0 2.3225 0.26742 4.5784 0.74876 6.7386l50.681-12.18c-2.321-13.072-12.841-22.944-25.476-22.944z" stroke="#5276cf" stroke-linecap="square" stroke-width="1.9247" fill="#666"/></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>');
S.push(oa,a,U,Aa,pa,L);for(c=0;c<v.length;c++)v[c].setAttribute("id","wheel_btn_"+c),v[c].setAttribute("data-colorstate","B"),v[c].setAttribute("data-key",c),v[c].setAttribute("data-svgid",c);for(c=0;c<S.length;c++)v[c].setAttribute("id","wheel_axis_"+c),v[c].setAttribute("data-colorstate","GR");oa.setAttribute("data-key",l.GMPD_AXIS_0);oa.setAttribute("data-svgid",C.length);a.setAttribute("data-key",l.GMPD_AXIS_1);a.setAttribute("data-svgid",C.length+1);U.setAttribute("data-key",l.GMPD_AXIS_2);U.setAttribute("data-svgid",
C.length+2);Aa.setAttribute("data-key",l.GMPD_AXIS_3);Aa.setAttribute("data-svgid",C.length+3);pa.setAttribute("data-key",l.GMPD_AXIS_4);pa.setAttribute("data-svgid",C.length+4);L.setAttribute("data-key",l.GMPD_AXIS_5);L.setAttribute("data-svgid",C.length+5);C.push('<svg id="svg3458" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="50.447mm" width="83.899mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 297.28131 178.75"><metadata id="metadata3463"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -873.61)" fill="#e6e6e6"><path id="path4535" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m33.875 873.61-18.5 8.8125 5.0626 3.0625c-12.899 22.78-20.438 49.17-20.438 77.44 0 28.284 7.5315 54.691 20.438 77.469l-5.0626 3.0625 18.5 8.8125 0.6563-20.469-5.531 3.3c-12.002-21.2-18.937-45.8-18.937-72.18 0-26.362 6.9415-50.99 18.937-72.188l5.5313 3.3438-0.6563-20.469z"/><path id="path4551" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m263.38 873.71-0.6562 20.469 5.5312-3.3438c11.996 21.198 18.969 45.825 18.969 72.188 0 26.371-6.9672 51.011-18.969 72.219l-5.5312-3.3437 0.6562 20.469 18.5-8.8125-5.0312-3.0625c12.906-22.778 20.438-49.184 20.438-77.469 0-28.275-7.5391-54.665-20.438-77.438l5.0312-3.0625-18.5-8.8125z"/></g></svg>',
'<svg id="svg3386" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="12.859mm" width="5.2917mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 18.749999 45.562501"><metadata id="metadata3391"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1006.8)"><path id="rect4575" d="m9.3125 1006.8-9.3125 14.25h5.3125v17.094h-5.1875l9.3125 14.219 9.3125-14.219h-5.1562v-17.094h5.0312l-9.3125-14.25z" fill="#e6e6e6"/></g></svg>',
'<svg id="svg3386" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="12.859mm" width="5.2917mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 18.749999 45.562501"><metadata id="metadata3391"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1006.8)"><path id="rect4575" d="m9.3125 1006.8-9.3125 14.25h5.3125v17.094h-5.1875l9.3125 14.219 9.3125-14.219h-5.1562v-17.094h5.0312l-9.3125-14.25z" fill="#e6e6e6"/></g></svg>',
'<svg id="svg3386" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="12.859mm" width="5.2917mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 18.749999 45.562501"><metadata id="metadata3391"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1006.8)"><path id="rect4575" d="m9.3125 1006.8-9.3125 14.25h5.3125v17.094h-5.1875l9.3125 14.219 9.3125-14.219h-5.1562v-17.094h5.0312l-9.3125-14.25z" fill="#e6e6e6"/></g></svg>',
'<svg id="svg3378" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="2.9016mm" width="9.2516mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 32.781198 10.281199"><metadata id="metadata3383"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1042.1)"><path id="rect4585" d="m32.781 1047.2-7.875-5.125v2.8437h-17.031v-2.8437l-7.875 5.1 7.875 5.1562v-2.8437h17.031v2.8437z" fill="#e6e6e6"/></g></svg>',
'<svg id="svg3378" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.2516mm" width="2.9016mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 10.281248 32.7812"><metadata id="metadata3383"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1019.6)"><path id="rect4585" d="m5.125 1019.6-5.125 7.9h2.8437v17.031h-2.8437l5.125 7.875 5.1562-7.875h-2.8438v-17.031h2.8438z" fill="#e6e6e6"/></g></svg>');
p(v,F);p(S,"#e6e6e6")}}function p(a,b){for(var c=function(a){a=a.target;if(!(0>x||"G"==a.dataset.colorstate))if(0!=z){if("R"==a.dataset.colorstate&&(y=null,document.getElementById("action_label").textContent="Click on the buttons & arrows to setup your controller",z=0),"B"==a.dataset.colorstate||"GR"==a.dataset.colorstate){var c=parseFloat(y.dataset.svgid);y.style.backgroundImage="url('data:image/svg+xml;base64,"+btoa(C[c])+"')";y.setAttribute("data-colorstate",a.dataset.colorstate);y=a;c=parseFloat(a.dataset.svgid);
a.style.backgroundImage="url('data:image/svg+xml;base64,"+btoa(C[c].replace(b,"#ff0000"))+"')";a.setAttribute("data-colorstate","R")}}else{var c=parseFloat(a.dataset.svgid),d="B"==a.dataset.colorstate?1:2;z=d;a.style.backgroundImage="url('data:image/svg+xml;base64,"+btoa(C[c].replace(b,"#ff0000"))+"')";a.setAttribute("data-colorstate","R");1==d?document.getElementById("action_label").textContent="Now press the button on the device":document.getElementById("action_label").textContent="Now move the axis on the device";
y=a}},d=0;d<a.length;d++)a[d].addEventListener("click",c,!1)}function f(a){var b=document.createElement("label");b.style.cssText="position: relative;display: inline-block;width: 50px;color: white;margin: 0 10px;font-size: 36px;line-height: 50px;background-color: black;border: 3px solid white;border-radius: 5px;height: 50px;";b.textContent=a;return b}function w(){var a=window.innerWidth,b=window.innerHeight;E.style.zoom=750>=b&&400<b||750>=a&&400<a?"0.5":400>=a||400>=b?"0.3":"1"}r("config");var g=
r("container"),m=r("controls"),l=r("input"),t=r("storage"),F=/#5276cf/g,H={};H[l.GMPD_BUTTON_12]=l.GMPD_BUTTON_12;H[l.GMPD_BUTTON_13]=l.GMPD_BUTTON_13;H[l.GMPD_BUTTON_15]=l.GMPD_BUTTON_15;H[l.GMPD_BUTTON_14]=l.GMPD_BUTTON_14;H[l.GMPD_BUTTON_3]=l.GMPD_BUTTON_3;H[l.GMPD_BUTTON_0]=l.GMPD_BUTTON_0;H[l.GMPD_BUTTON_1]=l.GMPD_BUTTON_1;H[l.GMPD_BUTTON_2]=l.GMPD_BUTTON_2;H[l.GMPD_BUTTON_5]=l.GMPD_BUTTON_5;H[l.GMPD_BUTTON_7]=l.GMPD_BUTTON_7;H[l.GMPD_BUTTON_4]=l.GMPD_BUTTON_4;H[l.GMPD_BUTTON_6]=l.GMPD_BUTTON_6;
H[l.GMPD_BUTTON_8]=l.GMPD_BUTTON_8;H[l.GMPD_BUTTON_9]=l.GMPD_BUTTON_9;H[l.GMPD_BUTTON_10]=l.GMPD_BUTTON_10;H[l.GMPD_BUTTON_11]=l.GMPD_BUTTON_11;H[l.GMPD_BUTTON_16]=l.GMPD_BUTTON_16;var C=[],x=-1,y=null,z=0,E=null,e=null,n=null,M=null,D=null,G=null,Q=[],v=[],P=[],S=[],I=!0,K={};K[l.GMPD_AXIS_0]=-2;K[l.GMPD_AXIS_1]=-2;K[l.GMPD_AXIS_2]=-2;K[l.GMPD_AXIS_3]=-2;K[l.GMPD_AXIS_4]=-2;K[l.GMPD_AXIS_5]=-2;K[l.GMPD_AXIS_6]=-2;K[l.GMPD_AXIS_7]=-2;K[l.GMPD_AXIS_8]=-2;K[l.GMPD_AXIS_9]=-2;K[l.GMPD_AXIS_10]=-2;K[l.GMPD_AXIS_11]=
-2;K[l.GMPD_AXIS_12]=-2;a.show=function(){var a=document.createElement("div");E=a;a.style.cssText="position: absolute;width: 720px;height: 750px;top: 50%;left: 50%;-moz-transform: translateY(-50%) translateX(-50%);-ms-transform: translateY(-50%) translateX(-50%);-webkit-transform: translateY(-50%) translateX(-50%);transform: translateY(-50%) translateX(-50%);background-color: black;border: 4px solid white;border-radius: 35px;box-shadow: 0px 0px 20px 0px rgba(50, 50, 50, 1);";g.insert_to_container(a,
"LAST");b(a);var e=document.createElement("div");e.style.cssText="position: absolute;width: 637px;top: 0px;font-family: sans-serif;text-align: center;margin-top: 40px;-moz-transform: translateX(-50%);-ms-transform: translateX(-50%);-webkit-transform: translateX(-50%);transform: translateX(-50%);left: 50%;";var p=document.createElement("div");p.innerHTML="Select a device";p.style.cssText="color: #fff;display: inline-block;";e.appendChild(p);for(p=0;4>p;p++){var r=h(p),Q=function(){return!0},H=function(a,
b,c){if(b==x)for(c=0;c<v.length;c++){var d=v[c],e=m.get_sensor_value(a,b,c),f=c;if(0==z){if(e&&"B"==d.dataset.colorstate){var g=C[f];d.style.backgroundImage="url('data:image/svg+xml;base64,"+btoa(g.replace(F,"#00ff00"))+"')";d.setAttribute("data-colorstate","G")}e||"B"==d.dataset.colorstate||(g=C[f],d.style.backgroundImage="url('data:image/svg+xml;base64,"+btoa(g)+"')",d.setAttribute("data-colorstate","B"))}else e=l.get_pressed_gmpd_btn(x),0<=e&&y&&1==z&&(d=y.dataset.key,l.set_gamepad_key(x,d,e),
f=t.get(x+"gmpd_stngs","b4w")||"{}",f=JSON.parse(f),f[d]=e,t.set(x+"_gmpd_stngs",JSON.stringify(f),"b4w"),y=null,document.getElementById("action_label").textContent="Click on the buttons & arrows to setup your controller",z=0)}};m.create_sensor_manifold(null,p,m.CT_CONTINUOUS,r,Q,H)}0<u().length&&(x=0);var ca=[],p=document.createElement("div");p.style.cssText="margin-top: 20px;";for(r=0;4>r;r++)H=f(r),r==x&&(H.style.backgroundColor="green",n=H),c(r),p.appendChild(H),H.setAttribute("data-device_type",
"PAD"),ca.push(H),H.addEventListener("click",function(a){var b=u();a=a.target;for(var d=0;d<b.length;d++)ca[d]==a&&(x=d,n=a,c(x),k(a.dataset.device_type))},!1);e.appendChild(p);G=document.createElement("label");G.style.cssText="position: relative;display: block;color: white;";e.appendChild(G);p=document.createElement("div");p.style.cssText="margin-top: 20px;";r=q(p,"Pad");H=q(p,"Wheel");r.setAttribute("checked","true");r.onchange=function(){k("PAD");n&&n.setAttribute("data-device_type","PAD")};H.onchange=
function(){k("WHEEL");n&&n.setAttribute("data-device_type","WHEEL")};r.setAttribute("id","test");D=r;M=H;r=document.createElement("label");r.style.cssText+="color: #fff;display: block;";p.appendChild(r);r.textContent="Click on the buttons & arrows to setup your controller";r.setAttribute("id","action_label");e.appendChild(p);a.appendChild(e);a=m.create_elapsed_sensor();m.create_sensor_manifold(null,"UPDATE_GAMEPAD_DATA",m.CT_CONTINUOUS,[a],Q,function(a,b,c){a=u();b=a.length;-1==x&&a.length&&(x=a[0].index,
n=ca[x]);for(c=0;c<ca.length;c++)c<b?(ca[c].textContent=a[c].index,ca[c]==n?(ca[c].style.backgroundColor="green",G.textContent="Selected device: "+a[c].index+". Data: "+a[c].id):ca[c].style.backgroundColor="blue"):ca[c].style.backgroundColor="black";b||(x=-1,G.textContent="")});for(p=0;4>p;p++)r=d(p),Q=function(){return!0},H=function(a,b,c){if(b=="AXES"+x){for(c=0;c<P.length;c+=2){var d=P[c],e=a,f=b,g=c,h=20*m.get_sensor_value(e,f,g),e=20*m.get_sensor_value(e,f,g+1);d.style.transform="translate3d("+
h+"px, "+e+"px, 0px) rotate(0rad)"}if(I)for(c=0;12>c;c+=2){if(e=a,f=b,d=c,!(d+1>2*S.length)){h=m.get_sensor_value(e,f,d);e=m.get_sensor_value(e,f,d+1);if(-2<K[d]){var k=h-K[d],n=e-K[d+1],f=S[Math.floor(d/2)],g=f.dataset.svgid;0==z?f.style.backgroundImage=k||n?"url('data:image/svg+xml;base64,"+btoa(C[g].replace("#e6e6e6","#00ff00"))+"')":"url('data:image/svg+xml;base64,"+btoa(C[g])+"')":2==z&&(k=l.get_moved_gmpd_axis(x),0<=k&&(0!=k%2&&k--,z=0,f.style.backgroundImage="url('data:image/svg+xml;base64,"+
btoa(C[g])+"')",f=parseFloat(y.dataset.key),l.set_gamepad_key(x,f,k),l.set_gamepad_key(x,f+1,k+1),y=null,document.getElementById("action_label").textContent="Click on the buttons & arrows to setup your controller"))}K[d]=h;K[d+1]=e}}else for(c=0;12>c;c++)d=c,d>=S.length||(h=m.get_sensor_value(a,b,d),-2<K[d]&&(g=h-K[d],e=S[d],f=e.dataset.svgid,0==z?e.style.backgroundImage=g?"url('data:image/svg+xml;base64,"+btoa(C[f].replace("#e6e6e6","#00ff00"))+"')":"url('data:image/svg+xml;base64,"+btoa(C[f])+"')":
2==z&&(g=l.get_moved_gmpd_axis(x),0<=g&&(z=0,e.style.backgroundImage="url('data:image/svg+xml;base64,"+btoa(C[f])+"')",e=parseFloat(y.dataset.key),l.set_gamepad_key(x,e,g),y=null,document.getElementById("action_label").textContent="Click on the buttons & arrows to setup your controller"))),K[d]=h)}},m.create_sensor_manifold(null,"AXES"+p,m.CT_CONTINUOUS,r,Q,H);w();window.addEventListener("resize",w)};a.hide=function(){z=0;x=-1;D=M=y=n=null;P.length=0;v.length=0;S.length=0;g.get_container().removeChild(E);
E=null;m.remove_sensor_manifold(null,"UPDATE_GAMEPAD_DATA");for(var a=0;4>a;a++)m.remove_sensor_manifold(null,a),m.remove_sensor_manifold(null,"AXES"+a);window.removeEventListener("resize",w)}};b4w.module.gyroscope=function(a,r){function u(a){var h=b.create_gyro_angles_sensor(),r=b.create_gyro_quat_sensor(),u=!0;b.create_sensor_manifold(a,"CAMERA_ROTATE_GYRO",b.CT_CONTINUOUS,[h,r],null,function(a,h,r){if(0<r)if(c.is_eye_camera(a))h=b.get_sensor_payload(a,h,1),r=k.transformQuat(q.AXIS_Z,h,w),c.set_vertical_axis(a,r),d.set_rotation_v(a,h);else{f=b.get_sensor_payload(a,h,0);u&&(p[0]=f[0],p[1]=f[1],p[2]=f[2],u=!1);r=h=0;0==window.orientation&&(h=f[1]-p[1],r=f[0]-p[0],f[1]>m&&f[1]<g&&(r=0));
if(180==window.orientation){h=f[1]-p[1];0>f[1]&&(h=-h);r=p[0]-f[0];if(h>Math.PI/2||h<-Math.PI/2)h=0;f[1]>-g&&f[1]<-m&&(r=0)}if(-90==window.orientation){h=f[0]-p[0];if(h>Math.PI/2||h<-Math.PI/2)h=0;r=p[1]-f[1];if(f[0]>l||f[0]<t)r=0}if(90==window.orientation){h=p[0]-f[0];if(h>Math.PI/2||h<-Math.PI/2)h=0;r=f[1]-p[1];if(f[0]>l||f[0]<t)r=0}c.rotate_camera(a,r,h);p[0]=f[0];p[1]=f[1];p[2]=f[2]}})}var c=r("camera"),b=r("controls"),h=r("scenes"),d=r("transform"),q=r("util"),k=r("vec3"),p=new Float32Array(3),
f=new Float32Array(3),w=k.create(),g=q.deg_to_rad(110),m=q.deg_to_rad(70),l=q.deg_to_rad(70),t=-q.deg_to_rad(70);a.enable_camera_rotation=function(){var a=h.get_active_camera();u(a)};a.disable_camera_rotation=function(){var a=h.get_active_camera();b.remove_sensor_manifold(a,"CAMERA_ROTATE_GYRO")}};b4w.module.hmd_conf=function(a,r){function u(a){a=a.target.value;var b=M[a],c;for(c in e)if(c in b){var d=document.getElementById(c+"_slider");d&&(d.disabled="custom"!==a,d.value=b[c]);if(d=document.getElementById(c+"_number"))d.disabled="custom"!==a,d.value=b[c]}}function c(){g.remove_sensor_manifold(null,"UPDATE_HMD_RENDERING");d();k();C&&(C=!1,h())}function b(){d(!0);k();for(var a in e){var b=document.getElementById(a+"_slider");b&&(b.value=e[a]);if(b=document.getElementById(a+"_number"))b.value=
e[a]}}function h(){w.get_container().removeChild(x);document.head.removeChild(y);y=z=x=null}function d(a){var b=navigator.userAgent||navigator.vendor||window.opera,c=Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio,d=Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio,f=0,g=0,h=0;a:{var k=G;if(1==k.format&&k.devices&&k.devices.length)for(var m=0;m<k.devices.length;m++){var p=k.devices[m];if(p.rules&&("ios"==p.type&&n||"android"==p.type)){for(var q=
!1,r=0;r<p.rules.length;r++){var t=p.rules[r],u=c,w=d;if(t.ua&&0<=b.indexOf(t.ua)||!t.ua&&t.res&&t.res[0]&&t.res[1]&&Math.min(u,w)==Math.min(t.res[0],t.res[1])&&Math.max(u,w)==Math.max(t.res[0],t.res[1])){q=!0;break}}if(q){b=m;break a}}}else l.error("DPDB isn't correct.");b=-1}-1!=b&&(h=G.devices[b],g=h.dpi[1]||h.dpi,f=Math.round(25.4*c/(h.dpi[0]||h.dpi)),g=Math.round(25.4*d/g),h=Math.round(h.bw));c=F.get("hmd_conf","b4w");c=JSON.parse(c?c:"{}");e.first_distortion=!a&&parseFloat(c.first_distortion)||
.34;e.second_distortion=!a&&parseFloat(c.second_distortion)||.55;e.bevel_size=!a&&parseFloat(c.bevel_size)||h||4;e.screen_width=!a&&parseFloat(c.screen_width)||f||110;e.screen_height=!a&&parseFloat(c.screen_height)||g||65;e.screen_lense=!a&&parseFloat(c.screen_lense)||50;e.ipd=!a&&parseFloat(c.ipd)||64;e.baseline=!a&&parseFloat(c.baseline)||32;E=!0}function q(){F.set("hmd_conf",JSON.stringify(e),"b4w");h()}function k(){if(E){var a=m.get_device_by_type_element(m.DEVICE_HMD);a&&(m.set_config(a,m.HMD_DISTORTION,
[e.first_distortion,e.second_distortion]),m.get_value_param(a,m.HMD_WEBVR_TYPE)!=m.HMD_WEBVR_DESKTOP&&(m.set_config(a,m.HMD_BEVEL_SIZE,.001*e.bevel_size),m.set_config(a,m.HMD_SCREEN_WIDTH,.001*e.screen_width),m.set_config(a,m.HMD_SCREEN_HEIGHT,.001*e.screen_height),m.set_config(a,m.HMD_SCREEN_LENSE_DIST,.001*e.screen_lense),m.set_config(a,m.HMD_EYE_DISTANCE,.001*e.ipd),m.set_config(a,m.HMD_BASELINE_DIST,.001*e.baseline)),t.get_active_camera());E=!1}}function p(a){var b=a.target.id.split("_"),b=b.splice(0,
b.length-1).join("_");b in e&&e[b]!=a.target.value&&(E=!0,e[b]=a.target.value,document.getElementById(b+"_slider").value=a.target.value,document.getElementById(b+"_number").value=a.target.value)}function f(a,b){var c=document.createElement("button");c.onclick=a;c.style.cssText="display: inline-block;";c.innerHTML=b;return c}r("config");var w=r("container"),g=r("controls"),m=r("input"),l=r("print"),t=r("scenes"),F=r("storage"),H=r("util"),C=!1,x=null,y=null,z=null,E=!0,e={profile:"custom",first_distortion:0,
second_distortion:0,bevel_size:0,screen_width:0,screen_height:0,screen_lense:0,ipd:0,baseline:0},n=/iPad|iPhone|iPod/.test(navigator.platform),M={oculus_dk2:{name:"Oculus Rift DK2",type:2,first_distortion:.22,second_distortion:.28},cardboard_1:{name:"Cardboard (2014)",type:1,ipd:60,baseline:35,screen_lense:42,first_distortion:.441,second_distortion:.156},cardboard_2:{name:"Cardboard (2015)",type:1,ipd:64,baseline:35,screen_lense:39,first_distortion:.34,second_distortion:.55},custom:{name:"Custom",
type:0,ipd:64,baseline:35,screen_lense:39,first_distortion:0,second_distortion:0}},D=[{label:"Tray to lens-center distance.",is_mobile:!0,inputs:[{id:"baseline",max:"50",step:"0.5"}]},{label:"Interpupillary distance.",is_mobile:!0,inputs:[{id:"ipd",max:"100",step:"1"}]},{label:"Screen to lense distance.",is_mobile:!0,inputs:[{id:"screen_lense",max:"100",step:"1"}]},{label:"Screen height.",is_mobile:!0,inputs:[{id:"screen_height",max:"150",step:"1"}]},{label:"Screen width.",is_mobile:!0,inputs:[{id:"screen_width",
max:"200",step:"1"}]},{label:"Bevel width.",is_mobile:!0,inputs:[{id:"bevel_size",max:"20",step:"1"}]},{label:"Distortion coefficients.",inputs:[{id:"first_distortion",max:"1.0",step:"0.01"},{id:"second_distortion",max:"1.0",step:"0.01"}]}];a.check=function(){return m.can_use_device(m.DEVICE_HMD)};a.show=function(a){y=document.createElement("style");y.innerHTML="html{-webkit-tap-highlight-color:rgba(0,0,0,0);}input[type=range]:focus{outline:0}input[type=range]::-webkit-slider-runnable-track{width:100%;height:8.4px;cursor:pointer;box-shadow:0 0 10px 0 rgba(50,50,50,1);background:#000;border-radius:1.3px;border:.2px solid #010101}input[type=range]::-webkit-slider-thumb{box-shadow:0 0 10px 0 rgba(50,50,50,1);border:1px solid #000;height:36px;width:16px;border-radius:3px;background:#fff;cursor:pointer;-webkit-appearance:none;margin-top:-14px}input[type=range]:focus::-webkit-slider-runnable-track{background:#000}input[type=range]::-moz-range-track{width:100%;height:8.4px;cursor:pointer;box-shadow:0 0 10px 0 rgba(50,50,50,1);background:#000;border-radius:1.3px;border:.2px solid #010101}input[type=range]::-moz-range-thumb{box-shadow:0 0 10px 0 rgba(50,50,50,1);border:1px solid #000;height:36px;width:16px;border-radius:3px;background:#fff;cursor:pointer}input[type=range]::-ms-track{width:100%;height:8.4px;cursor:pointer;background:0 0;border-color:transparent;color:transparent}input[type=range]::-ms-fill-lower{background:#000;border:.2px solid #010101;border-radius:2.6px;box-shadow:0 0 10px 0 rgba(50,50,50,1)}input[type=range]::-ms-fill-upper{background:#000;border:.2px solid #010101;border-radius:2.6px;box-shadow:0 0 10px 0 rgba(50,50,50,1)}input[type=range]::-ms-thumb{box-shadow:0 0 10px 0 rgba(50,50,50,1);border:1px solid #000;height:36px;width:16px;border-radius:3px;background:#fff;cursor:pointer}.text_label,.value_label{display:inline-block;text-decoration:none;height:30px;line-height:28px;position:relative;text-align:center;font-family:Arial;font-size:15px}input[type=range]:focus::-ms-fill-lower{background:#000}input[type=range]:focus::-ms-fill-upper{background:#000}.text_label{float:left;color:#fff;width:auto;padding:0 10px;background-color:#000;border:3px solid #fff;border-radius:15px;box-shadow:0 0 10px 0 rgba(50,50,50,1);margin-right:15px}.input_text,.value_label{border:3px solid #fff;background-color:#000;color:#fff;box-shadow:0 0 10px 0 rgba(50,50,50,1)}.value_label{right:0;width:40px;border-radius:15px;margin-left:15px}.slider{position:relative;cursor:pointer}.border{position:relative;width:100%;height:50px}.input_slider,.input_text{margin:13.8px 0;-webkit-appearance:none;width:50%;position:relative;display:inline-block}.input_text{border-radius:4px;padding-left:4px}.input_slider,_:-moz-tree-row(hover){-webkit-appearance:none;width:50%;margin:-4.8px 0;position:relative;display:inline-block}:root .input_slider,_:-ms-fullscreen{-webkit-appearance:none;width:50%;margin:-2.8px 0;position:relative;display:inline-block}button,select{display:block}button{background-color:#000;color:#fff;width:100px;border:3px solid #fff;text-align:center;font-family:Arial;border-radius:15px;box-shadow:0 0 10px 0 rgba(50,50,50,1);font-size:15px;line-height:30px;margin-right:10px}select{clear:both}";
document.head.appendChild(y);var h=m.get_device_by_type_element(m.DEVICE_HMD);if(!C&&h){C=!0;d();var l=w.get_container(),n=m.get_device_by_type_element(m.DEVICE_MOUSE,l);m.switch_prevent_default(n,!1);n=m.get_device_by_type_element(m.DEVICE_TOUCH,l);m.switch_prevent_default(n,!1);x=document.createElement("div");x.class=a;l.appendChild(x);z=document.createElement("div");x.appendChild(z);z.style.cssText="position: absolute;background-color: #fff;left: 10px;top: 10px;right: 10px;bottom: 10px;bottom: 10px;min-width: 300px;overflow: auto;padding: 10px;border: 1px solid #ddd;border-radius: 4px;bottom: 10px;";
a=F.get("hmd_conf","b4w");a=JSON.parse(a?a:"{}").profile||"custom";l=document.createElement("div");n=document.createElement("label");n.innerHTML="Profile: ";n.className="text_label";l.appendChild(n);n=document.createElement("select");l.appendChild(n);l.style.cssText="margin: 20px 0;padding: 10px;";var r=m.get_device_by_type_element(m.DEVICE_HMD);if(r)for(var t in M)if(0==M[t].type||m.get_value_param(r,m.HMD_WEBVR_TYPE)==m.HMD_WEBVR_DESKTOP^1==M[t].type){var B=document.createElement("option");B.value=
t;B.text=M[t].name;n.appendChild(B)}n.value=a;H.is_ie11()?n.onchange=u:n.oninput=u;z.appendChild(l);for(t=0;t<D.length;t++)if(m.get_value_param(h,m.HMD_WEBVR_TYPE)!=m.HMD_WEBVR_DESKTOP||!D[t].is_mobile){a=D[t];l=document.createElement("div");n=document.createElement("label");n.className="text_label";n.textContent=a.label;l.appendChild(n);l.style.cssText="margin: 20px 0;float: left;display: inline-block;width: 50%;border: 1px solid #ddd;box-sizing: border-box;-webkit-box-sizing: border-box;padding: 10px;";
for(n=0;n<a.inputs.length;n++){r=a.inputs[n];B=document.createElement("div");B.style.cssText+="clear: both; margin-bottom: 10px;";var E=document.createElement("input");E.className="input_slider";E.setAttribute("id",r.id+"_slider");E.setAttribute("type","range");E.setAttribute("min","0.00");E.setAttribute("step",r.step);E.setAttribute("value",e[r.id]);E.setAttribute("max",r.max);E.style.cssText="float: left;";B.appendChild(E);var G=document.createElement("input");G.className="input_text";G.setAttribute("id",
r.id+"_number");G.setAttribute("type","number");G.setAttribute("min","0.00");G.setAttribute("step",r.step);G.setAttribute("value",e[r.id]);G.setAttribute("max",r.max);B.appendChild(G);H.is_ie11()?(E.onchange=p,G.onchange=p):(E.oninput=p,G.oninput=p);l.appendChild(B)}z.appendChild(l)}h=document.createElement("div");t=f(q,"SAVE");a=f(c,"CANCEL");l=f(b,"RESET");h.style.clear="both";h.appendChild(t);h.appendChild(a);h.appendChild(l);z.appendChild(h);h=g.create_timeline_sensor();g.create_sensor_manifold(null,
"UPDATE_HMD_RENDERING",g.CT_CONTINUOUS,[h],null,k)}};a.hide=c;a.reset=b;a.update=function(){d();k()};var G={_comment:"AUTOMATICALLY GENERATED BY generate_dpdb.py. DO NOT EDIT.",format:1,last_updated:"2016-01-26T23:11:18Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,
443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},
{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,
401.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,
255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1E3},
{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",
rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},
{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],
dpi:[217.7,231.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],
dpi:[415.6,431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,
136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],
dpi:285.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],
bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1E3},
{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},
{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,
328.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1E3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1E3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1E3}]}};b4w.module.hmd=function(a,r){function u(a,e){if(e){var n=q.get_active_camera();if(n){c.is_eye_camera(n)||(m=c.is_target_camera(n),l=c.is_hover_camera(n),t=c.is_static_camera(n),c.eye_setup(n));var n=b.create_elapsed_sensor(),r=!1;b.create_sensor_manifold(null,"HMD_ROTATE_CAMERA",b.CT_CONTINUOUS,[n,e],null,function(e,l,m){if(0<m&&(m=q.get_active_camera())&&(!r&&h.enable_split_screen(m)&&(w=k.get_rotation(m,w),r=!0),r&&c.is_eye_camera(m)&&(e=b.get_sensor_payload(e,l,1))))if(1==a){var n=f.transformQuat(p.AXIS_Z,
e,F);c.set_vertical_axis(m,n);k.set_rotation_v(m,e)}else if(2==a||3==a){l=k.get_rotation(m,y);l=d.invert(l,y);var t=d.multiply(w,l,y);l=c.get_vertical_axis(m,F);Math.abs(l[2])<Math.PI/4?n=f.cross(l,p.AXIS_Z,H):Math.abs(l[1])<Math.PI/4&&(n=f.cross(l,p.AXIS_Y,H));f.normalize(n,n);var t=f.transformQuat(n,t,C),u=f.dot(l,t),t=f.scaleAndAdd(t,l,-u,C);f.normalize(t,t);l=f.cross(l,n,F);n=Math.acos(p.clamp(f.dot(n,t),0,1));l=p.sign(f.dot(t,l));g+=n*l;n=d.setAxisAngle(p.AXIS_Y,-g,y);3!=a&&(l=p.quat_project(e,
p.AXIS_MY,p.AXIS_Y,p.AXIS_MZ,z),l=d.invert(l,z),e=d.multiply(l,e,z));e=d.multiply(n,e,x);n=f.transformQuat(p.AXIS_Z,e,F);c.set_vertical_axis(m,n);k.set_rotation_v(m,e);d.copy(e,w)}})}}}var c=r("camera"),b=r("controls"),h=r("input"),d=r("quat"),q=r("scenes"),k=r("transform"),p=r("util"),f=r("vec3"),w=d.create(),g=0,m=!1,l=!1,t=!1,F=f.create(),H=f.create(),C=f.create(),x=d.create(),y=d.create(),z=d.create();a.HMD_NONE_MOUSE_ALL_AXES=0;a.HMD_ALL_AXES_MOUSE_NONE=1;a.HMD_ROLL_PITCH_MOUSE_YAW=2;a.HMD_ALL_AXES_MOUSE_YAW=
3;a.enable_hmd=function(a){var c=null;if(c=h.get_device_by_type_element(h.DEVICE_HMD))c=h.get_value_param(c,h.HMD_WEBVR_TYPE)==h.HMD_WEBVR_DESKTOP?b.create_hmd_quat_sensor():b.create_gyro_quat_sensor(),u(a,c)};a.check_browser_support=function(){return Boolean(h.can_use_device(h.DEVICE_HMD))};a.get_hmd_device=function(){return null};a.reset=function(){h.reset_device(h.DEVICE_HMD)};a.disable_hmd=function(){b.remove_sensor_manifold(null,"HMD_ROTATE_CAMERA");h.disable_split_screen();var a=q.get_active_camera();
m?c.target_setup(a):l?c.hover_setup(a):t&&c.static_setup(a);c.set_vertical_axis(a,p.AXIS_Y);var d=k.get_rotation(a,x);k.set_rotation_v(a,d)}};b4w.module.mixer=function(a,r){function u(){C=H.length=0;x=c(100);y=new Float32Array(x.length);z=new Float32Array(x.length);var a=l.get_speaker_objects();if(a.length){H.push(b());for(var e=0;e<a.length;e++)H.push(d(a[e]));H.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function c(a){for(var b=new Float32Array(a),c=0,d=0;d<a;d++)b[d]=20*Math.pow(1E3,c),c+=1/
(a-1);return b}function b(){var a=h("MASTER");a.params.push(["VOLUME",l.get_volume(null),0,1,50,!1]);var b=l.get_compressor_params();b&&(a.params.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.params.push(["KNEE",b.knee,0,40,40,!1]),a.params.push(["RATIO",b.ratio,1,20,20,!1]),a.params.push(["ATTACK",b.attack,0,1,1E3,!1]),a.params.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=l.is_muted(null)?1:0;a.solo=-1;return a}function h(a){return{id:a,params:[],active_param:0,mute:-1,solo:-1,speaker:null}}
function d(a){var b=h(m.get_object_name(a));b.mute=l.is_muted(a)?1:0;b.solo=0;b.speaker=a;return b}function q(a){if(a.speaker){a.params.length=0;a.params.push(["VOLUME",l.get_volume(a.speaker),0,1,50,!1]);var b=l.get_positional_params(a.speaker);b&&(a.params.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.params.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.params.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=l.get_filter_params(a.speaker))a.params.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.params.push(["EQ_Q",
b.Q,0,10,100,!1]),a.params.push(["EQ_GAIN",b.gain,-70,30,100,!1]);t.clamp(a.active_param,0,a.params.length-1)}}function k(a){for(var b=0;b<H.length;b++){var c=H[b];if(c!=a&&1==c.solo)return!0}return!1}function p(a){for(var b=0;b<H.length;b++){var c=H[b];c!=a&&0==c.mute&&0==c.solo&&l.mute(c.speaker,!1)}}function f(){if(0==H.length)return[0,-1];var a=8*Math.floor(C/8),b=a+7,a=t.clamp(a,0,H.length-1),b=t.clamp(b,0,H.length-1);return[a,b]}var w=r("controls"),g=r("hud"),m=r("scenes"),l=r("sfx"),t=r("util"),
F="SWITCH_STRIP SWITCH_STRIP_HOLD SWITCH_PARAM INC_DEC INC_DEC_HOLD MUTE_SOLO".split(" "),H=[],C=0,x=null,y=null,z=null;a.enable_mixer_controls=function(){u();var a=w.create_keyboard_sensor(w.KEY_LEFT_SQ_BRACKET),b=w.create_keyboard_sensor(w.KEY_RIGHT_SQ_BRACKET),c=w.create_keyboard_sensor(w.KEY_SEMI_COLON),d=w.create_keyboard_sensor(w.KEY_SINGLE_QUOTE),h=w.create_keyboard_sensor(w.KEY_SHIFT),m=w.create_timer_sensor(.15,!0),r=w.create_timer_sensor(.05,!0),a=[a,b,c,d,h,m,r],b=function(a,b,c){if(1==
c){c=Boolean(w.get_sensor_value(a,b,0))?-1:1;if(H.length){1==c&&C<H.length-1?C++:-1==c&&0<C&&C--;c=f();for(var d=c[0];d<=c[1];d++)q(H[d])}"SWITCH_STRIP"==b?w.reset_timer_sensor(a,b,5,.15+.3):w.reset_timer_sensor(a,b,5,.15)}else w.reset_timer_sensor(a,b,5,10)};w.create_sensor_manifold(null,"SWITCH_STRIP",w.CT_TRIGGER,a,function(a){return(a[0]||a[1])&&!a[4]},b);w.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",w.CT_SHOT,a,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},b);w.create_sensor_manifold(null,
"SWITCH_PARAM",w.CT_SHOT,a,function(a){return(a[0]||a[1])&&a[4]},function(a,b,c){a=Boolean(w.get_sensor_value(a,b,0))?-1:1;(b=H[C])&&(1==a&&b.active_param<b.params.length-1?b.active_param++:-1==a&&0<b.active_param&&b.active_param--)});b=function(a,b,c){if(1==c){var d=Boolean(w.get_sensor_value(a,b,2))?-1:1,e=H[C];if(e)switch(c=e.params[e.active_param],c[1]=c[5]?c[1]*Math.pow(c[3]/c[2],d/c[4]):c[1]+(c[3]-c[2])/c[4]*d,c[1]=t.clamp(c[1],c[2],c[3]),c[0]){case "VOLUME":"MASTER"!=e.id?l.set_volume(e.speaker,
c[1]):l.set_volume(null,c[1]);break;case "DIST_REF":d=l.get_positional_params(e.speaker);d.dist_ref=c[1];l.set_positional_params(e.speaker,d);break;case "ATTENUATION":d=l.get_positional_params(e.speaker);d.attenuation=c[1];l.set_positional_params(e.speaker,d);break;case "DIST_MAX":d=l.get_positional_params(e.speaker);d.dist_max=c[1];l.set_positional_params(e.speaker,d);break;case "EQ_FREQ":d=l.get_filter_params(e.speaker);d.freq=c[1];l.set_filter_params(e.speaker,d);break;case "EQ_Q":d=l.get_filter_params(e.speaker);
d.Q=c[1];l.set_filter_params(e.speaker,d);break;case "EQ_GAIN":d=l.get_filter_params(e.speaker);d.gain=c[1];l.set_filter_params(e.speaker,d);break;case "THRESHOLD":e=l.get_compressor_params();e.threshold=c[1];l.set_compressor_params(e);break;case "KNEE":e=l.get_compressor_params();e.knee=c[1];l.set_compressor_params(e);break;case "RATIO":e=l.get_compressor_params();e.ratio=c[1];l.set_compressor_params(e);break;case "ATTACK":e=l.get_compressor_params();e.attack=c[1];l.set_compressor_params(e);break;
case "RELEASE":e=l.get_compressor_params();e.release=c[1];l.set_compressor_params(e);break;default:throw"Unknown strip param";}"INC_DEC"==b?w.reset_timer_sensor(a,b,6,.35):w.reset_timer_sensor(a,b,6,.05)}else w.reset_timer_sensor(a,b,6,10)};w.create_sensor_manifold(null,"INC_DEC",w.CT_TRIGGER,a,function(a){return(a[2]||a[3])&&!a[4]},b);w.create_sensor_manifold(null,"INC_DEC_HOLD",w.CT_SHOT,a,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},b);w.create_sensor_manifold(null,"MUTE_SOLO",w.CT_SHOT,a,function(a){return(a[2]||
a[3])&&a[4]},function(a,b,c){if(Boolean(w.get_sensor_value(a,b,2)))(a=H[C])&&0<=a.mute&&("MASTER"!=a.id?0==a.mute?(a.mute=1,l.mute(a.speaker,!0),1==a.solo&&(a.solo=0,k(a)||p(a))):(a.mute=0,k(a)||l.mute(a.speaker,!1)):0==a.mute?(a.mute=1,l.mute(null,!0)):(a.mute=0,l.mute(null,!1)));else if((a=H[C])&&0<=a.solo)if(0==a.solo)for(a.solo=1,l.mute(a.speaker,!1),1==a.mute&&(a.mute=0),b=0;b<H.length;b++)c=H[b],c!=a&&0==c.mute&&0==c.solo&&l.mute(c.speaker,!0);else a.solo=0,k(a)?l.mute(a.speaker,!0):p(a)});
a=w.create_elapsed_sensor();w.create_sensor_manifold(null,"MIXER_DRAW",w.CT_CONTINUOUS,[a],null,function(){if(H[C])for(var a=f(),b=a[0];b<=a[1];b++){var c=H[b];g.draw_mixer_strip(c.id,b==C,b%8,c.params,c.active_param,c.mute,c.solo);if(c.speaker&&l.get_filter_params(c.speaker)){l.get_filter_freq_response(c.speaker,x,y,z);for(c=0;c<y.length;c++)y[c]=20*Math.log(y[c])/Math.LN10;g.plot_array("EQ",b%8,y,20,2E4,-10,10)}}});a=w.create_timer_sensor(1,!0);w.create_sensor_manifold(null,"MIXER_UPDATE",w.CT_TRIGGER,
[a],null,function(){for(var a=f(),b=a[0];b<=a[1];b++)q(H[b])})};a.disable_mixer_controls=function(){for(var a=0;F.length;a++)w.remove_sensor_manifold(null,F[a])}};b4w.module.npc_ai=function(a,r){function u(a,b){var c=b.destination,d=H;m.get_translation(b.empty,d);var g=C;m.get_translation(b.collider,g);var h=0;b.y_cor_water?h=b.y_cor_water:b.y_correction&&(h=b.y_correction,b.type==n&&(h*=.5),b.type==D&&(h*=a));switch(b.type){case n:if(b.random&&b.reached){c[0]=(12*Math.random()-6)*b.speed+d[0];c[2]=(12*Math.random()-6)*b.speed+d[2];var p=E,d=x,r=b.speed,u=b.rot_speed;m.get_rotation(b.collider,p);t.transformQuat(l.AXIS_Z,p,d);d[1]=0;t.normalize(d,d);p=Math.sin(u/
2);r=.5*r/p;p=t.dist(c,g);p<2*r&&t.scaleAndAdd(c,d,2*r-p,c);b.reached=!1}c[1]=g[1];h&&(c[1]+=h);break;case M:case D:b.random&&b.reached&&(b.type==D?(b.speed=Math.random()+.1,r=b.max_depth-b.min_depth):r=b.max_height-b.min_height,c[0]=10*Math.random()-5+d[0],c[1]=g[1]+(Math.random()*r-.5*r),c[2]=10*Math.random()-5+d[2],b.reached=!1);h&&(c[1]=g[1]+h);break}var c=H,r=C,p=x,g=e,w=b.rig,d=b.collider,h=b.destination,F=b.speed,O=b.actions,ba=k.get_current_anim_name(w);if(!k.is_play(w)||!O.idle||-1==O.idle.indexOf(ba)){m.get_translation(d,
c);var u=h[0]-c[0],ca=h[2]-c[2],u=Math.sqrt(u*u+ca*ca);if(u>2*F*a)b.state=20,l.xz_direction(h,c,p),O=b.rig,k.is_animated(O)&&(w=b.speed,F=k.get_frame(O),O=k.get_anim_length(O),w*=O/24*(1-F/O),.9>u/w&&t.scaleAndAdd(h,p,w-u,h)),u=E,w=y,m.get_rotation(b.collider,u),t.transformQuat(l.AXIS_Z,u,r),w[0]=r[0],w[1]=0,w[2]=r[2],t.normalize(w,w),F=t.dot(w,p),O=Math.acos(F),O=Math.abs(O)/Math.PI,O=a/O*b.rot_speed*b.rotation_mult,f.rotationTo(w,p,g),f.rotationTo(l.AXIS_Z,w,u),1<=Math.abs(F)?f.copy(u,g):(f.multiply(g,
u,g),f.slerp(u,g,Math.min(O,1),g)),p=a,b.type!=M&&(p=Math.max(p,1/60),u=z,w=E,r=Math.asin(r[1]),f.setAxisAngle(l.AXIS_X,-r,w),r=Math.atan(b.y_correction/(b.speed*p)),f.setAxisAngle(l.AXIS_X,-r,u),f.slerp(w,u,p,u),f.multiply(g,u,g)),m.set_rotation_v(d,g),d=x,r=y,l.quat_to_dir(g,l.AXIS_Z,d),t.scale(d,b.speed*a,r),t.add(r,c,r),r[1]=b.type!=n?(h[1]-c[1])*a*.1+c[1]:h[1],m.set_translation_v(b.collider,r);else if(b.type==n)O.move?ba&&-1!=O.move.indexOf(ba)&&k.is_play(w)?b.state=20:(b.state=10,b.reached=
!0):(b.state=10,b.reached=!0);else if(b.type==D||b.type==M)b.reached=!0;if(q(b)&&(c=b.rig,!k.is_play(c))){g=null;switch(b.state){case 10:g=b.actions;g=g.idle?l.random_from_array(g.idle):null;break;case 20:g=k.get_current_anim_name(b.rig),d=h=b.actions,d.move_blends&&-1==d.move_blends.indexOf(g)&&d.move&&-1!=d.move.indexOf(g)&&.33<Math.random()?(h=b.actions,g=h.move.indexOf(g),g=h.move_blends[g]):(d=b.actions,d.move&&(-1!=d.move.indexOf(g)||!d.move_blends&&!d.move_start||!d.move_start&&!g||d.move_blends&&
-1!=d.move_blends.indexOf(g)||d.move_start&&-1!=d.move_start.indexOf(g))?(h=b.actions,h.move_blends?(d=h.move_blends.indexOf(g),-1!=d?(g=d+1,g=g<h.move.length?g:0,g=h.move[g]):g=-1!=h.move.indexOf(g)?g:l.random_from_array(h.move)):g=l.random_from_array(h.move)):(d=b.actions,g=d.move_start&&-1==d.move_start.indexOf(g)&&d.move&&-1==d.move.indexOf(g)?l.random_from_array(h.move_start):null))}g&&(k.apply(c,g),k.set_behavior(c,k.AB_FINISH_RESET),k.set_frame(c,0),k.play(c))}}}function c(a,b,c,d){if(d)if(1==
c)switch(d.type){case M:a:{for(c=0;3>c;c++){var e=p.get_sensor_payload(a,b,c).hit_fract;if(e){b=e;break a}}b=void 0}a=100*b;d.y_correction=a<d.min_height?10:a>d.max_height?-10:0;break;case n:a=p.get_sensor_payload(a,b,0).hit_fract;d.y_correction=d.prev_hit_pos==a?0:1-100*a;d.prev_hit_pos=a;break;case D:a=p.get_sensor_payload(a,b,0).hit_fract,"CLOSE_GROUND"==b?(d.y_correction=100*a-1,d.y_correction=.1>d.y_correction?.05:0):"CLOSE_WATER"==b&&(d.y_cor_water=100*a,d.y_cor_water=d.y_cor_water<d.min_depth?
-.02:d.y_cor_water>d.max_depth?.02:0)}else d.y_correction=0}function b(){for(var a=0;a<F.length;a++){var b=F[a];h(b);d(b);b.rig&&k.get_current_anim_name(b.rig)&&k.play(b.rig)}}function h(a){var b=t.create(),d=a.collider;switch(a.type){case M:var e=p.create_ray_sensor(d,b,[0,-100,0],"TERRAIN",!0),f=p.create_ray_sensor(d,b,[0,-100,0],"STONE",!0),b=p.create_ray_sensor(d,b,[0,-100,0],"WATER",!0),e=[e,f,b];p.create_sensor_manifold(d,"CLOSE_GROUND",p.CT_CONTINUOUS,e,function(a){return a[0]||a[1]||a[2]},
c,a);break;case n:e=p.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0);e=[e];p.create_sensor_manifold(d,"CLOSE_GROUND",p.CT_CONTINUOUS,e,null,c,a);break;case D:e=p.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0),b=p.create_ray_sensor(d,b,[0,100,0],"WATER",!0),e=[e],p.create_sensor_manifold(d,"CLOSE_WATER",p.CT_CONTINUOUS,[b],null,c,a),p.create_sensor_manifold(d,"CLOSE_GROUND",p.CT_CONTINUOUS,e,null,c,a)}}function d(a){function b(c,d,e){1==e?(m.get_translation(a.empty,a.destination),a.rotation_mult=
4):a.rotation_mult=1}var c=a.collider;if(a.type==n){var d=p.create_collision_sensor(c,"CONSTRUCTION",!1);p.create_sensor_manifold(c,"CONSTRUCTION_COLL",p.CT_CONTINUOUS,[d],null,b)}}function q(a){var b=a.rig;if(!k.is_play(b))return!0;b=k.get_current_anim_name(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.idle)return!1;if(-1==c.idle.indexOf(b))break;break;case 20:if(!c.move||-1!=c.move.indexOf(b)||c.move_start&&-1!=c.move_start.indexOf(b)||c.move_blends&&-1!=c.move_blends.indexOf(b))return!1;
break;default:return!1}return!0}var k=r("animation"),p=r("controls"),f=r("quat"),w=r("scenes"),g=r("time"),m=r("transform"),l=r("util"),t=r("vec3"),F=[];new Float32Array(9);var H=new Float32Array(3),C=new Float32Array(3),x=new Float32Array(3),y=new Float32Array(3),z=new Float32Array(4),E=new Float32Array(4),e=new Float32Array(4),n=a.NT_WALKING=10,M=a.NT_FLYING=20,D=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=new Float32Array(3);a.start=[];a.ended=[];a.fired=[];a.y_correction=null;
a.prev_hit_pos=null;a.y_cor_water=null;a.reached=!0;a.rotation_mult=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.fired[b]=!1;F.push(a)};a.enable_animation=function(){if(F.length){b();var a=p.create_elapsed_sensor();p.create_sensor_manifold(F[0].collider,"ELAPSED",p.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,b,c){if(1==c)for(a=p.get_sensor_value(a,b,0),b=0;b<F.length;b++){c=F[b];var d=a;if(w.is_visible(c.obj))if(c.random)u(d,c);else{for(var e=g.get_timeline(),
f=0;f<c.path.length;f++)if(!c.ended[f]){c.fired[f]||(c.fired[f]=!0,c.destination[0]=c.path[f][0],c.destination[1]=c.path[f][1],c.destination[2]=c.path[f][2],c.start[f]=e+c.delay[f]);if(e<c.start[f])break;u(d,c);c.ended[f]=c.reached;break}d=void 0;a:{for(d=0;d<c.path.length;d++)if(0==c.ended[d]){d=!1;break a}d=!0}if(d)for(d=0;d<c.path.length;d++)c.fired[d]=!1,c.ended[d]=!1}}})}};a.disable_animation=function(){if(!(0>=F.length))for(var a=0;a<F.length;a++){var b=F[a];p.check_sensor_manifolds(b.collider)&&
p.remove_sensor_manifold(b.collider);k.is_play(b.rig)&&k.stop(b.rig)}}};b4w.module.mouse=function(a,r){function u(){1==M&&(M=0);var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document);g.remove_sensor_manifold(t.get_active_camera(),"SMOOTH_PL")}function c(a){2==M&&(M=0);a.removeEventListener("mousedown",h,!1);a.removeEventListener("mouseup",d,!1);a.removeEventListener("mousemove",b,!1);g.remove_sensor_manifold(t.get_active_camera(),"SMOOTH_DRAG")}function b(a){e()&&(z[0]+=2*(a.clientX-x),z[1]+=
2*(a.clientY-y),x=a.clientX,y=a.clientY);a.preventDefault()}function h(a){x=a.clientX;y=a.clientY;a.currentTarget.addEventListener("mousemove",b,!1);a.preventDefault()}function d(a){a.currentTarget.removeEventListener("mousemove",b,!1);a.preventDefault()}function q(a,b,c,d){if(.01<Math.abs(z[0])||.01<Math.abs(z[1]))b=g.get_sensor_value(a,b,0),a=F.smooth(z[0],0,b,.1*C),b=F.smooth(z[1],0,b,.1*C),z[0]-=a,z[1]-=b,d(4E-4*-a,4E-4*-b)}function k(a,b){var c=t.get_first_character(),d=t.get_active_camera();
f.eye_rotate(d,a,b);c&&(d=f.get_camera_angles_char(d,E),m.set_character_rotation(c,d[0],d[1]))}function p(a){a=w.client_to_canvas_coords(a.clientX,a.clientY,E);(a=t.pick_object(a[0],a[1]))?(t.outlining_is_enabled(a)&&t.set_outline_intensity(a,1),t.outlining_is_enabled(n)&&a!=n&&t.set_outline_intensity(n,0)):t.outlining_is_enabled(n)&&t.set_outline_intensity(n,0);n=a}var f=r("camera"),w=r("container"),g=r("controls"),m=r("physics"),l=r("print"),t=r("scenes"),F=r("util"),H=r("main"),C=1,x=0,y=0,z=new Float32Array(2),
E=new Float32Array(2),e=null,n=null,M=0;a.request_pointerlock=function(a,b,d,e,f,h){function m(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){c(a);a.addEventListener("mousemove",e,!1);var f=t.get_active_camera();if(!g.check_sensor_manifold(f,"SMOOTH_PL")){var k=g.create_elapsed_sensor();g.create_sensor_manifold(f,"SMOOTH_PL",g.CT_CONTINUOUS,[k],null,q,h)}b()}else a.removeEventListener("mousemove",e,!1),M=0,document.removeEventListener("pointerlockchange",
m,!1),document.removeEventListener("webkitpointerlockchange",m,!1),document.removeEventListener("mozpointerlockchange",m,!1),d()}if(1!=M){M=1;b=b||function(){};d=d||function(){};h=h||k;f=f||function(){return!0};e=e||function(a){if(f()){if("number"==typeof a.movementX){var b=a.movementX;a=a.movementY}else"number"==typeof a.webkitMovementX?(b=a.webkitMovementX,a=a.webkitMovementY):"number"==typeof a.mozMovementX?(b=a.mozMovementX,a=a.mozMovementY):a=b=0;z[0]+=b;z[1]+=a}};document.addEventListener("pointerlockchange",
m,!1);document.addEventListener("webkitpointerlockchange",m,!1);document.addEventListener("mozpointerlockchange",m,!1);var n=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof n?n.apply(a):l.error("Pointer lock is not available")}};a.exit_pointerlock=u;a.check_pointerlock=function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,b,c){2!=M&&(M=2,u(),e=b||function(){return!0},
c=c||k,a.addEventListener("mousedown",h,!1),a.addEventListener("mouseup",d,!1),a=t.get_active_camera(),g.check_sensor_manifold(a,"SMOOTH_DRAG")||(b=g.create_elapsed_sensor(),g.create_sensor_manifold(a,"SMOOTH_DRAG",g.CT_CONTINUOUS,[b],null,q,c)))};a.exit_mouse_drag=c;a.enable_mouse_hover_outline=function(){H.detect_mobile()||w.get_canvas().addEventListener("mousemove",p)};a.disable_mouse_hover_outline=function(){H.detect_mobile()||(w.get_canvas().removeEventListener("mousemove",p),n&&t.set_outline_intensity(n,
0))};a.get_coords_x=function(a,b){var c=b?a.targetTouches:a.touches;return"clientX"in a?a.clientX:c&&"clientX"in c[0]?c[0].clientX:-1};a.get_coords_y=function(a,b){var c=b?a.targetTouches:a.touches;return"clientY"in a?a.clientY:c&&"clientY"in c[0]?c[0].clientY:-1};a.set_plock_smooth_factor=function(a){C=a};a.get_plock_smooth_factor=function(){return C}};b4w.module.preloader=function(a,r){var u=r("app"),c,b,h,d,q,k,p,f,w,g=null;a.create_simple_preloader=function(a){var f=null,p=null,r="#bf9221",u="#000",w;for(w in a)switch(w){case "canvas_container_id":f=a.canvas_container_id;break;case "background_container_id":p=a.background_container_id;break;case "bg_color":u=a.bg_color;break;case "bar_color":r=a.bar_color;break;case "preloader_fadeout":c=a.preloader_fadeout}a=document.createElement("div");w=document.createElement("div");a.id="simple_preloader_container";
var x=document.createElement("div"),y=document.createElement("div"),p=document.getElementById(p);g=document.getElementById(f);a.style.cssText="z-index: 4;background-color: "+u+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";w.style.cssText="position: absolute;left: 50%;top: 82%;width: 300px;height: 20px;margin-left: -150px;margin-top: -10px;border-style:solid;border-width:4px;border-color: #000;border-radius: 0px;";x.style.cssText="position: absolute;left: 0px;top: 1px;width: 0px;height: 18px;background-color: "+
r+";border-radius: 0px;";y.style.cssText="position: absolute;left: 50%;top: 50%;width: 100%;height: 100%;margin-left: -150px;margin-top: -10px;text-align: center;font-size: 17px;font-weight: bold;color: #000;font-family: Verdana;"+w.appendChild(x);w.appendChild(y);a.appendChild(w);document.body.appendChild(a);b="SIMPLE";h=a;d=x;q=y;k=p};a.create_rotation_preloader=function(a){var c=null,d=null,f="rgba(0,0,0,0)",r="",u="",w="rgba(0,0,0,0)",y;for(y in a)switch(y){case "canvas_container_id":c=a.canvas_container_id;
break;case "background_container_id":d=a.background_container_id;break;case "frame_bg_color":f=a.frame_bg_color;break;case "bg_color":w=a.bg_color;break;case "frame_class":r=a.frame_class;break;case "anim_elem_class":u=a.anim_elem_class}a=document.createElement("div");y=document.createElement("div");var z=document.createElement("div"),E=document.createElement("div"),d=document.getElementById(d);g=document.getElementById(c);a.style.cssText="z-index: 4;background-color: "+w+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";
y.style.cssText="position: absolute;left: 50%;top: 50%;width: 117px;height: 117px;margin-left: -58px;margin-top: -58px;background-color: "+f+";";z.style.cssText="position: absolute;left: 0px;top: 0px;width: 100%;height: 100%;background-position: center;background-repeat: no-repeat;";E.style.cssText="position: absolute;width: 100%;height: 100%;text-align: center;margin-top: 38px;font-size: 36px;color: #ffffff;font-family: Arial;font-weight: bold;";z.className=u;y.appendChild(z);y.className=r;y.appendChild(E);
a.appendChild(y);g.appendChild(a);b="ROTATION";h=a;p=z;q=E;k=d};a.create_advanced_preloader=function(a){var c=a.preloader_width,p=a.canvas_container_id,c=c/(c-a.img_width),r=document.getElementById(a.preloader_bar_id),u=document.getElementById(a.fill_band_id),C=document.getElementById(a.preloader_caption_id),x=document.getElementById(a.preloader_container_id);a=document.getElementById(a.background_container_id);g=document.getElementById(p);b="ADVANCED";d=r;f=u;w=c;q=C;h=x;k=a};a.update_preloader=
function(a){q.innerHTML=a+"%";"SIMPLE"==b&&(d.style.width=a+"%");"ADVANCED"==b&&(d.style.width=a/w+"%",f.style.width=100-a+"%");"ROTATION"==b&&(p.style.transform="rotate("+a+"deg)");100==a&&(c?(u.css_animate(k,"opacity",1,0,1500,null,null,function(){k.parentNode.removeChild(k)}),u.css_animate(h,"opacity",1,0,1E3,null,null,function(){h.parentNode.removeChild(h)})):(h.parentNode.removeChild(h),k&&k.parentNode.removeChild(k)))}};b4w.module.storage=function(a,r){function u(a){return h[a?a:b]?JSON.parse(h[a?a:b]):{}}var c=r("__print"),b="b4w",h=null;a.init=function(a){a?"b4w"!==a?b=a:c.error("b4w prefix denied"):c.warn("Prefix should be a string. Last declared storage prefix will be used.")};a.set=function(a,c,d){var q=u(d);q[a]=String(c);h[d?d:b]=JSON.stringify(q)};a.cleanup=function(a){delete h[a?a:b]};a.get=function(a,b){var c=u(b);return c[a]?c[a]:""};a.debug=function(a){c.log(u(a?a:b))};try{h=window.localStorage;try{h.tmp=
null,delete h.tmp}catch(d){c.warn("localStorage quota is limited. Disabling localStorage"),h=null}}catch(q){c.warn("Applying chrome localStorage bug workaround"),h=null}h||(c.warn("localStorage is not available, initializing temporary storage"),h={})};b4w.module.screenshooter=function(a,r){var u=r("main");a.shot=function(){u.canvas_data_url(function(a){var b=window.document.createElement("a");document.body.appendChild(b);b.style.display="none";b.href=a;b.download="screenshot.png";b.click();document.body.removeChild(b)})}};
